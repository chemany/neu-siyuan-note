(()=>{var mz=Object.defineProperty,bz=Object.defineProperties;var yz=Object.getOwnPropertyDescriptors;var uI=Object.getOwnPropertySymbols;var _z=Object.prototype.hasOwnProperty,wz=Object.prototype.propertyIsEnumerable;var fI=Math.pow,ck=(da,Zn,Tn)=>Zn in da?mz(da,Zn,{enumerable:!0,configurable:!0,writable:!0,value:Tn}):da[Zn]=Tn,Ys=(da,Zn)=>{for(var Tn in Zn||(Zn={}))_z.call(Zn,Tn)&&ck(da,Tn,Zn[Tn]);if(uI)for(var Tn of uI(Zn))wz.call(Zn,Tn)&&ck(da,Tn,Zn[Tn]);return da},ld=(da,Zn)=>bz(da,yz(Zn));var ty=(da,Zn,Tn)=>(ck(da,typeof Zn!="symbol"?Zn+"":Zn,Tn),Tn),dk=(da,Zn,Tn)=>{if(!Zn.has(da))throw TypeError("Cannot "+Tn)};var ie=(da,Zn,Tn)=>(dk(da,Zn,"read from private field"),Tn?Tn.call(da):Zn.get(da)),Ae=(da,Zn,Tn)=>{if(Zn.has(da))throw TypeError("Cannot add the same private member more than once");Zn instanceof WeakSet?Zn.add(da):Zn.set(da,Tn)},it=(da,Zn,Tn,dd)=>(dk(da,Zn,"write to private field"),dd?dd.call(da,Tn):Zn.set(da,Tn),Tn);var K0=(da,Zn,Tn,dd)=>({set _(Xe){it(da,Zn,Xe,Tn)},get _(){return ie(da,Zn,dd)}}),Se=(da,Zn,Tn)=>(dk(da,Zn,"access private method"),Tn);var Rt=(da,Zn,Tn)=>new Promise((dd,Xe)=>{var ce=X=>{try{I(Tn.next(X))}catch(x){Xe(x)}},ne=X=>{try{I(Tn.throw(X))}catch(x){Xe(x)}},I=X=>X.done?dd(X.value):Promise.resolve(X.value).then(ce,ne);I((Tn=Tn.apply(da,Zn)).next())});(()=>{var da={79:(Xe,ce,ne)=>{var I=ne(193),X=I.RegexTokeniser;ce.t=M;var x="'((?:\\\\.|[^'])*)";function M(C){var E="(?:[a-zA-Z\\-_]|\\\\.)",R=new X([{name:"identifier",regex:new RegExp("("+E+"(?:"+E+"|[0-9])*)")},{name:"dot",regex:/\./},{name:"colon",regex:/:/},{name:"gt",regex:/>/},{name:"whitespace",regex:/\s+/},{name:"arrow",regex:/=>/},{name:"equals",regex:/=/},{name:"startsWith",regex:/\^=/},{name:"open-paren",regex:/\(/},{name:"close-paren",regex:/\)/},{name:"open-square-bracket",regex:/\[/},{name:"close-square-bracket",regex:/\]/},{name:"string",regex:new RegExp(x+"'")},{name:"unterminated-string",regex:new RegExp(x)},{name:"integer",regex:/([0-9]+)/},{name:"choice",regex:/\|/},{name:"bang",regex:/(!)/}]);return R.tokenise(C)}},89:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X,x,M){var C=ne(7443),E=C.isObject,R=ne(7048),L;typeof Map=="function"&&(L=Map);var T=function(){var q=0,F=0;function Y(G,J){this[q]=G,this[q+F]=J,q++}return function(J){F=J.size,q=0;var z=new Array(J.size*2);return J.forEach(Y,z),z}}(),O=function(q){for(var F=new L,Y=q.length/2|0,G=0;G<Y;++G){var J=q[Y+G],z=q[G];F.set(J,z)}return F};function W(q){var F=!1,Y;if(L!==void 0&&q instanceof L)Y=T(q),F=!0;else{var G=R.keys(q),J=G.length;Y=new Array(J*2);for(var z=0;z<J;++z){var te=G[z];Y[z]=q[te],Y[z+J]=te}}this.constructor$(Y),this._isMap=F,this._init$(void 0,-3)}C.inherits(W,X),W.prototype._init=function(){},W.prototype._promiseFulfilled=function(q,F){this._values[F]=q;var Y=++this._totalResolved;if(Y>=this._length){var G;if(this._isMap)G=O(this._values);else{G={};for(var J=this.length(),z=0,te=this.length();z<te;++z)G[this._values[z+J]]=this._values[z]}return this._resolve(G),!0}return!1},W.prototype.shouldCopyValues=function(){return!1},W.prototype.getActualLength=function(q){return q>>1};function D(q){var F,Y=x(q);if(E(Y))Y instanceof I?F=Y._then(I.props,void 0,void 0,void 0,void 0):F=new W(Y).promise();else return M(`cannot await properties of a non-object

    See http://goo.gl/MqrFmX
`);return Y instanceof I&&F._propagateFrom(Y,2),F}I.prototype.props=function(){return D(this)},I.props=function(q){return D(q)}}},174:function(Xe,ce,ne){var I=ne(9796),X=ne(5584).Result;ce.createFootnotesReader=x.bind(this,"footnote"),ce.createEndnotesReader=x.bind(this,"endnote");function x(M,C){function E(T){return X.combine(T.getElementsByTagName("w:"+M).filter(R).map(L))}function R(T){var O=T.attributes["w:type"];return O!=="continuationSeparator"&&O!=="separator"}function L(T){var O=T.attributes["w:id"];return C.readXmlElements(T.children).map(function(W){return I.Note({noteType:M,noteId:O,body:W})})}return E}},193:(Xe,ce,ne)=>{ce.Parser=ne(1350).Parser,ce.rules=ne(8430),ce.errors=ne(6446),ce.results=ne(7042),ce.StringSource=ne(4305),ce.Token=ne(7140),ce.bottomUp=ne(3466),ce.RegexTokeniser=ne(1769).RegexTokeniser,ce.rule=function(I){var X;return function(x){return X||(X=I()),X(x)}}},232:function(Xe){(function(ce,ne){Xe.exports=ne()})(this,function(){"use strict";var ce=1e3,ne=6e4,I=36e5,X="millisecond",x="second",M="minute",C="hour",E="day",R="week",L="month",T="quarter",O="year",W="date",D="Invalid Date",q=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,F=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,Y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(le){var ue=["th","st","nd","rd"],A=le%100;return"["+le+(ue[(A-20)%10]||ue[A]||ue[0])+"]"}},G=function(le,ue,A){var N=String(le);return!N||N.length>=ue?le:""+Array(ue+1-N.length).join(A)+le},J={s:G,z:function(le){var ue=-le.utcOffset(),A=Math.abs(ue),N=Math.floor(A/60),oe=A%60;return(ue<=0?"+":"-")+G(N,2,"0")+":"+G(oe,2,"0")},m:function le(ue,A){if(ue.date()<A.date())return-le(A,ue);var N=12*(A.year()-ue.year())+(A.month()-ue.month()),oe=ue.clone().add(N,L),ge=A-oe<0,ve=ue.clone().add(N+(ge?-1:1),L);return+(-(N+(A-oe)/(ge?oe-ve:ve-oe))||0)},a:function(le){return le<0?Math.ceil(le)||0:Math.floor(le)},p:function(le){return{M:L,y:O,w:R,d:E,D:W,h:C,m:M,s:x,ms:X,Q:T}[le]||String(le||"").toLowerCase().replace(/s$/,"")},u:function(le){return le===void 0}},z="en",te={};te[z]=Y;var V="$isDayjsObject",de=function(le){return le instanceof me||!(!le||!le[V])},P=function le(ue,A,N){var oe;if(!ue)return z;if(typeof ue=="string"){var ge=ue.toLowerCase();te[ge]&&(oe=ge),A&&(te[ge]=A,oe=ge);var ve=ue.split("-");if(!oe&&ve.length>1)return le(ve[0])}else{var ke=ue.name;te[ke]=ue,oe=ke}return!N&&oe&&(z=oe),oe||!N&&z},p=function(le,ue){if(de(le))return le.clone();var A=typeof ue=="object"?ue:{};return A.date=le,A.args=arguments,new me(A)},K=J;K.l=P,K.i=de,K.w=function(le,ue){return p(le,{locale:ue.$L,utc:ue.$u,x:ue.$x,$offset:ue.$offset})};var me=function(){function le(A){this.$L=P(A.locale,null,!0),this.parse(A),this.$x=this.$x||A.x||{},this[V]=!0}var ue=le.prototype;return ue.parse=function(A){this.$d=function(N){var oe=N.date,ge=N.utc;if(oe===null)return new Date(NaN);if(K.u(oe))return new Date;if(oe instanceof Date)return new Date(oe);if(typeof oe=="string"&&!/Z$/i.test(oe)){var ve=oe.match(q);if(ve){var ke=ve[2]-1||0,Ye=(ve[7]||"0").substring(0,3);return ge?new Date(Date.UTC(ve[1],ke,ve[3]||1,ve[4]||0,ve[5]||0,ve[6]||0,Ye)):new Date(ve[1],ke,ve[3]||1,ve[4]||0,ve[5]||0,ve[6]||0,Ye)}}return new Date(oe)}(A),this.init()},ue.init=function(){var A=this.$d;this.$y=A.getFullYear(),this.$M=A.getMonth(),this.$D=A.getDate(),this.$W=A.getDay(),this.$H=A.getHours(),this.$m=A.getMinutes(),this.$s=A.getSeconds(),this.$ms=A.getMilliseconds()},ue.$utils=function(){return K},ue.isValid=function(){return this.$d.toString()!==D},ue.isSame=function(A,N){var oe=p(A);return this.startOf(N)<=oe&&oe<=this.endOf(N)},ue.isAfter=function(A,N){return p(A)<this.startOf(N)},ue.isBefore=function(A,N){return this.endOf(N)<p(A)},ue.$g=function(A,N,oe){return K.u(A)?this[N]:this.set(oe,A)},ue.unix=function(){return Math.floor(this.valueOf()/1e3)},ue.valueOf=function(){return this.$d.getTime()},ue.startOf=function(A,N){var oe=this,ge=!!K.u(N)||N,ve=K.p(A),ke=function(It,_t){var jt=K.w(oe.$u?Date.UTC(oe.$y,_t,It):new Date(oe.$y,_t,It),oe);return ge?jt:jt.endOf(E)},Ye=function(It,_t){return K.w(oe.toDate()[It].apply(oe.toDate("s"),(ge?[0,0,0,0]:[23,59,59,999]).slice(_t)),oe)},Le=this.$W,Fe=this.$M,st=this.$D,Ee="set"+(this.$u?"UTC":"");switch(ve){case O:return ge?ke(1,0):ke(31,11);case L:return ge?ke(1,Fe):ke(0,Fe+1);case R:var pt=this.$locale().weekStart||0,$t=(Le<pt?Le+7:Le)-pt;return ke(ge?st-$t:st+(6-$t),Fe);case E:case W:return Ye(Ee+"Hours",0);case C:return Ye(Ee+"Minutes",1);case M:return Ye(Ee+"Seconds",2);case x:return Ye(Ee+"Milliseconds",3);default:return this.clone()}},ue.endOf=function(A){return this.startOf(A,!1)},ue.$set=function(A,N){var oe,ge=K.p(A),ve="set"+(this.$u?"UTC":""),ke=(oe={},oe[E]=ve+"Date",oe[W]=ve+"Date",oe[L]=ve+"Month",oe[O]=ve+"FullYear",oe[C]=ve+"Hours",oe[M]=ve+"Minutes",oe[x]=ve+"Seconds",oe[X]=ve+"Milliseconds",oe)[ge],Ye=ge===E?this.$D+(N-this.$W):N;if(ge===L||ge===O){var Le=this.clone().set(W,1);Le.$d[ke](Ye),Le.init(),this.$d=Le.set(W,Math.min(this.$D,Le.daysInMonth())).$d}else ke&&this.$d[ke](Ye);return this.init(),this},ue.set=function(A,N){return this.clone().$set(A,N)},ue.get=function(A){return this[K.p(A)]()},ue.add=function(A,N){var oe,ge=this;A=Number(A);var ve=K.p(N),ke=function(Fe){var st=p(ge);return K.w(st.date(st.date()+Math.round(Fe*A)),ge)};if(ve===L)return this.set(L,this.$M+A);if(ve===O)return this.set(O,this.$y+A);if(ve===E)return ke(1);if(ve===R)return ke(7);var Ye=(oe={},oe[M]=ne,oe[C]=I,oe[x]=ce,oe)[ve]||1,Le=this.$d.getTime()+A*Ye;return K.w(Le,this)},ue.subtract=function(A,N){return this.add(-1*A,N)},ue.format=function(A){var N=this,oe=this.$locale();if(!this.isValid())return oe.invalidDate||D;var ge=A||"YYYY-MM-DDTHH:mm:ssZ",ve=K.z(this),ke=this.$H,Ye=this.$m,Le=this.$M,Fe=oe.weekdays,st=oe.months,Ee=oe.meridiem,pt=function(_t,jt,zt,mn){return _t&&(_t[jt]||_t(N,ge))||zt[jt].slice(0,mn)},$t=function(_t){return K.s(ke%12||12,_t,"0")},It=Ee||function(_t,jt,zt){var mn=_t<12?"AM":"PM";return zt?mn.toLowerCase():mn};return ge.replace(F,function(_t,jt){return jt||function(zt){switch(zt){case"YY":return String(N.$y).slice(-2);case"YYYY":return K.s(N.$y,4,"0");case"M":return Le+1;case"MM":return K.s(Le+1,2,"0");case"MMM":return pt(oe.monthsShort,Le,st,3);case"MMMM":return pt(st,Le);case"D":return N.$D;case"DD":return K.s(N.$D,2,"0");case"d":return String(N.$W);case"dd":return pt(oe.weekdaysMin,N.$W,Fe,2);case"ddd":return pt(oe.weekdaysShort,N.$W,Fe,3);case"dddd":return Fe[N.$W];case"H":return String(ke);case"HH":return K.s(ke,2,"0");case"h":return $t(1);case"hh":return $t(2);case"a":return It(ke,Ye,!0);case"A":return It(ke,Ye,!1);case"m":return String(Ye);case"mm":return K.s(Ye,2,"0");case"s":return String(N.$s);case"ss":return K.s(N.$s,2,"0");case"SSS":return K.s(N.$ms,3,"0");case"Z":return ve}return null}(_t)||ve.replace(":","")})},ue.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},ue.diff=function(A,N,oe){var ge,ve=this,ke=K.p(N),Ye=p(A),Le=(Ye.utcOffset()-this.utcOffset())*ne,Fe=this-Ye,st=function(){return K.m(ve,Ye)};switch(ke){case O:ge=st()/12;break;case L:ge=st();break;case T:ge=st()/3;break;case R:ge=(Fe-Le)/6048e5;break;case E:ge=(Fe-Le)/864e5;break;case C:ge=Fe/I;break;case M:ge=Fe/ne;break;case x:ge=Fe/ce;break;default:ge=Fe}return oe?ge:K.a(ge)},ue.daysInMonth=function(){return this.endOf(L).$D},ue.$locale=function(){return te[this.$L]},ue.locale=function(A,N){if(!A)return this.$L;var oe=this.clone(),ge=P(A,N,!0);return ge&&(oe.$L=ge),oe},ue.clone=function(){return K.w(this.$d,this)},ue.toDate=function(){return new Date(this.valueOf())},ue.toJSON=function(){return this.isValid()?this.toISOString():null},ue.toISOString=function(){return this.$d.toISOString()},ue.toString=function(){return this.$d.toUTCString()},le}(),pe=me.prototype;return p.prototype=pe,[["$ms",X],["$s",x],["$m",M],["$H",C],["$W",E],["$M",L],["$y",O],["$D",W]].forEach(function(le){pe[le[1]]=function(ue){return this.$g(ue,le[0],le[1])}}),p.extend=function(le,ue){return le.$i||(le(ue,me,p),le.$i=!0),p},p.locale=P,p.isDayjs=de,p.unix=function(le){return p(1e3*le)},p.en=te[z],p.Ls=te,p.p={},p})},314:function(Xe,ce,ne){(function(){var I,X,x=function(C,E){for(var R in E)M.call(E,R)&&(C[R]=E[R]);function L(){this.constructor=C}return L.prototype=E.prototype,C.prototype=new L,C.__super__=E.prototype,C},M={}.hasOwnProperty;X=ne(3523),Xe.exports=I=function(C){x(E,C);function E(R,L){if(E.__super__.constructor.call(this,R),L==null)throw new Error("Missing CDATA text. "+this.debugInfo());this.text=this.stringify.cdata(L)}return E.prototype.clone=function(){return Object.create(this)},E.prototype.toString=function(R){return this.options.writer.set(R).cdata(this)},E}(X)}).call(this)},409:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X,x,M,C,E){var R=I._getDomain,L=ne(7443),T=L.tryCatch,O=L.errorObj,W=I._async;function D(F,Y,G,J){this.constructor$(F),this._promise._captureStackTrace();var z=R();this._callback=z===null?Y:L.domainBind(z,Y),this._preservedValues=J===C?new Array(this.length()):null,this._limit=G,this._inFlight=0,this._queue=[],W.invoke(this._asyncInit,this,void 0)}L.inherits(D,X),D.prototype._asyncInit=function(){this._init$(void 0,-2)},D.prototype._init=function(){},D.prototype._promiseFulfilled=function(F,Y){var G=this._values,J=this.length(),z=this._preservedValues,te=this._limit;if(Y<0){if(Y=Y*-1-1,G[Y]=F,te>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(te>=1&&this._inFlight>=te)return G[Y]=F,this._queue.push(Y),!1;z!==null&&(z[Y]=F);var V=this._promise,de=this._callback,P=V._boundValue();V._pushContext();var p=T(de).call(P,F,Y,J),K=V._popContext();if(E.checkForgottenReturns(p,K,z!==null?"Promise.filter":"Promise.map",V),p===O)return this._reject(p.e),!0;var me=M(p,this._promise);if(me instanceof I){me=me._target();var pe=me._bitField;if(pe&50397184)if(pe&33554432)p=me._value();else return pe&16777216?(this._reject(me._reason()),!0):(this._cancel(),!0);else return te>=1&&this._inFlight++,G[Y]=me,me._proxy(this,(Y+1)*-1),!1}G[Y]=p}var le=++this._totalResolved;return le>=J?(z!==null?this._filter(G,z):this._resolve(G),!0):!1},D.prototype._drainQueue=function(){for(var F=this._queue,Y=this._limit,G=this._values;F.length>0&&this._inFlight<Y;){if(this._isResolved())return;var J=F.pop();this._promiseFulfilled(G[J],J)}},D.prototype._filter=function(F,Y){for(var G=Y.length,J=new Array(G),z=0,te=0;te<G;++te)F[te]&&(J[z++]=Y[te]);J.length=z,this._resolve(J)},D.prototype.preservedValues=function(){return this._preservedValues};function q(F,Y,G,J){if(typeof Y!="function")return x("expecting a function but got "+L.classString(Y));var z=0;if(G!==void 0)if(typeof G=="object"&&G!==null){if(typeof G.concurrency!="number")return I.reject(new TypeError("'concurrency' must be a number but it is "+L.classString(G.concurrency)));z=G.concurrency}else return I.reject(new TypeError("options argument must be an object but it is "+L.classString(G)));return z=typeof z=="number"&&isFinite(z)&&z>=1?z:0,new D(F,Y,z,J).promise()}I.prototype.map=function(F,Y){return q(this,F,Y,null)},I.map=function(F,Y,G,J){return q(F,Y,G,J)}}},413:(Xe,ce)=>{var ne=ce.fromArray=function(X){var x=0,M=function(){return x<X.length};return new I({hasNext:M,next:function(){if(M())return X[x++];throw new Error("No more elements")}})},I=function(X){this._iterator=X};I.prototype.map=function(X){var x=this._iterator;return new I({hasNext:function(){return x.hasNext()},next:function(){return X(x.next())}})},I.prototype.filter=function(X){var x=this._iterator,M=!1,C=!1,E,R=function(){if(!M)for(M=!0,C=!1;x.hasNext()&&!C;)E=x.next(),C=X(E)};return new I({hasNext:function(){return R(),C},next:function(){R();var L=E;return M=!1,L}})},I.prototype.first=function(){var X=this._iterator;return this._iterator.hasNext()?X.next():null},I.prototype.toArray=function(){for(var X=[];this._iterator.hasNext();)X.push(this._iterator.next());return X}},492:Xe=>{"use strict";function ce(I,X,x,M,C){for(var E=0;E<C;++E)x[E+M]=I[E+X],I[E+X]=void 0}function ne(I){this._capacity=I,this._length=0,this._front=0}ne.prototype._willBeOverCapacity=function(I){return this._capacity<I},ne.prototype._pushOne=function(I){var X=this.length();this._checkCapacity(X+1);var x=this._front+X&this._capacity-1;this[x]=I,this._length=X+1},ne.prototype.push=function(I,X,x){var M=this.length()+3;if(this._willBeOverCapacity(M)){this._pushOne(I),this._pushOne(X),this._pushOne(x);return}var C=this._front+M-3;this._checkCapacity(M);var E=this._capacity-1;this[C+0&E]=I,this[C+1&E]=X,this[C+2&E]=x,this._length=M},ne.prototype.shift=function(){var I=this._front,X=this[I];return this[I]=void 0,this._front=I+1&this._capacity-1,this._length--,X},ne.prototype.length=function(){return this._length},ne.prototype._checkCapacity=function(I){this._capacity<I&&this._resizeTo(this._capacity<<1)},ne.prototype._resizeTo=function(I){var X=this._capacity;this._capacity=I;var x=this._front,M=this._length,C=x+M&X-1;ce(this,0,this,X,C)},Xe.exports=ne},586:(Xe,ce)=>{ce.readContentTypesFromXml=I;var ne={png:"png",gif:"gif",jpeg:"jpeg",jpg:"jpeg",tif:"tiff",tiff:"tiff",bmp:"bmp"};ce.defaultContentTypes=X({},{});function I(x){var M={},C={};return x.children.forEach(function(E){if(E.name==="content-types:Default"&&(M[E.attributes.Extension]=E.attributes.ContentType),E.name==="content-types:Override"){var R=E.attributes.PartName;R.charAt(0)==="/"&&(R=R.substring(1)),C[R]=E.attributes.ContentType}}),X(C,M)}function X(x,M){return{findContentType:function(C){var E=x[C];if(E)return E;var R=C.split("."),L=R[R.length-1];if(M.hasOwnProperty(L))return M[L];var T=ne[L.toLowerCase()];return T?"image/"+T:null}}}},591:function(Xe){(function(){var ce;Xe.exports=ce=function(){function ne(I,X,x){if(this.options=I.options,this.stringify=I.stringify,this.parent=I,X==null)throw new Error("Missing attribute name. "+this.debugInfo(X));if(x==null)throw new Error("Missing attribute value. "+this.debugInfo(X));this.name=this.stringify.attName(X),this.value=this.stringify.attValue(x)}return ne.prototype.clone=function(){return Object.create(this)},ne.prototype.toString=function(I){return this.options.writer.set(I).attribute(this)},ne.prototype.debugInfo=function(I){return I=I||this.name,I==null?"parent: <"+this.parent.name+">":"attribute: {"+I+"}, parent: <"+this.parent.name+">"},ne}()}).call(this)},727:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X,x){var M=ne(7443),C=ne(9556).RangeError,E=ne(9556).AggregateError,R=M.isArray,L={};function T(W){this.constructor$(W),this._howMany=0,this._unwrap=!1,this._initialized=!1}M.inherits(T,X),T.prototype._init=function(){if(this._initialized){if(this._howMany===0){this._resolve([]);return}this._init$(void 0,-5);var W=R(this._values);!this._isResolved()&&W&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},T.prototype.init=function(){this._initialized=!0,this._init()},T.prototype.setUnwrap=function(){this._unwrap=!0},T.prototype.howMany=function(){return this._howMany},T.prototype.setHowMany=function(W){this._howMany=W},T.prototype._promiseFulfilled=function(W){return this._addFulfilled(W),this._fulfilled()===this.howMany()?(this._values.length=this.howMany(),this.howMany()===1&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0):!1},T.prototype._promiseRejected=function(W){return this._addRejected(W),this._checkOutcome()},T.prototype._promiseCancelled=function(){return this._values instanceof I||this._values==null?this._cancel():(this._addRejected(L),this._checkOutcome())},T.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var W=new E,D=this.length();D<this._values.length;++D)this._values[D]!==L&&W.push(this._values[D]);return W.length>0?this._reject(W):this._cancel(),!0}return!1},T.prototype._fulfilled=function(){return this._totalResolved},T.prototype._rejected=function(){return this._values.length-this.length()},T.prototype._addRejected=function(W){this._values.push(W)},T.prototype._addFulfilled=function(W){this._values[this._totalResolved++]=W},T.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},T.prototype._getRangeError=function(W){var D="Input array must contain at least "+this._howMany+" items but contains only "+W+" items";return new C(D)},T.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))};function O(W,D){if((D|0)!==D||D<0)return x(`expecting a positive integer

    See http://goo.gl/MqrFmX
`);var q=new T(W),F=q.promise();return q.setHowMany(D),q.init(),F}I.some=function(W,D){return O(W,D)},I.prototype.some=function(W){return O(this,W)},I._SomePromiseArray=T}},746:(Xe,ce)=>{ce.paragraph=ne,ce.run=I,ce.table=X,ce.bold=new M("bold"),ce.italic=new M("italic"),ce.underline=new M("underline"),ce.strikethrough=new M("strikethrough"),ce.allCaps=new M("allCaps"),ce.smallCaps=new M("smallCaps"),ce.highlight=x,ce.commentReference=new M("commentReference"),ce.lineBreak=new E({breakType:"line"}),ce.pageBreak=new E({breakType:"page"}),ce.columnBreak=new E({breakType:"column"}),ce.equalTo=L,ce.startsWith=T;function ne(D){return new M("paragraph",D)}function I(D){return new M("run",D)}function X(D){return new M("table",D)}function x(D){return new C(D)}function M(D,q){q=q||{},this._elementType=D,this._styleId=q.styleId,this._styleName=q.styleName,q.list&&(this._listIndex=q.list.levelIndex,this._listIsOrdered=q.list.isOrdered)}M.prototype.matches=function(D){return D.type===this._elementType&&(this._styleId===void 0||D.styleId===this._styleId)&&(this._styleName===void 0||D.styleName&&this._styleName.operator(this._styleName.operand,D.styleName))&&(this._listIndex===void 0||R(D,this._listIndex,this._listIsOrdered))&&(this._breakType===void 0||this._breakType===D.breakType)};function C(D){D=D||{},this._color=D.color}C.prototype.matches=function(D){return D.type==="highlight"&&(this._color===void 0||D.color===this._color)};function E(D){D=D||{},this._breakType=D.breakType}E.prototype.matches=function(D){return D.type==="break"&&(this._breakType===void 0||D.breakType===this._breakType)};function R(D,q,F){return D.numbering&&D.numbering.level==q&&D.numbering.isOrdered==F}function L(D){return{operator:O,operand:D}}function T(D){return{operator:W,operand:D}}function O(D,q){return D.toUpperCase()===q.toUpperCase()}function W(D,q){return q.toUpperCase().indexOf(D.toUpperCase())===0}},805:(Xe,ce,ne)=>{var I=ne(4390),X=ne(990);ce.writer=x;function x(M){return M=M||{},M.outputFormat==="markdown"?X.writer():I.writer(M)}},990:(Xe,ce,ne)=>{var I=ne(8291);function X(D){return x(D,D)}function x(D,q){return function(){return{start:D,end:q}}}function M(D){var q=D.href||"";return q?{start:"[",end:"]("+q+")",anchorPosition:"before"}:{}}function C(D){var q=D.src||"",F=D.alt||"";return q||F?{start:"!["+F+"]("+q+")"}:{}}function E(D){return function(q,F){return{start:F?`
`:"",end:F?"":`
`,list:{isOrdered:D.isOrdered,indent:F?F.indent+1:0,count:0}}}}function R(D,q,F){q=q||{indent:0,isOrdered:!1,count:0},q.count++,F.hasClosed=!1;var Y=q.isOrdered?q.count+".":"-",G=T("	",q.indent)+Y+" ";return{start:G,end:function(){if(!F.hasClosed)return F.hasClosed=!0,`
`}}}var L={p:x("",`

`),br:x("",`  
`),ul:E({isOrdered:!1}),ol:E({isOrdered:!0}),li:R,strong:X("__"),em:X("*"),a:M,img:C};(function(){for(var D=1;D<=6;D++)L["h"+D]=x(T("#",D)+" ",`

`)})();function T(D,q){return new Array(q+1).join(D)}function O(){var D=[],q=[],F=null,Y={};function G(P,p){p=p||{};var K=L[P]||function(){return{}},me=K(p,F,Y);q.push({end:me.end,list:F}),me.list&&(F=me.list);var pe=me.anchorPosition==="before";pe&&J(p),D.push(me.start||""),pe||J(p)}function J(P){P.id&&D.push('<a id="'+P.id+'"></a>')}function z(P){var p=q.pop();F=p.list;var K=I.isFunction(p.end)?p.end():p.end;D.push(K||"")}function te(P,p){G(P,p),z(P)}function V(P){D.push(W(P))}function de(){return D.join("")}return{asString:de,open:G,close:z,text:V,selfClosing:te}}ce.writer=O;function W(D){return D.replace(/\\/g,"\\\\").replace(/([\`\*_\{\}\[\]\(\)\#\+\-\.\!])/g,"\\$1")}},1025:function(Xe,ce,ne){(function(){var I,X,x,M,C,E,R,L=function(O,W){for(var D in W)T.call(W,D)&&(O[D]=W[D]);function q(){this.constructor=O}return q.prototype=W.prototype,O.prototype=new q,O.__super__=W.prototype,O},T={}.hasOwnProperty;R=ne(3626).isObject,E=ne(3523),I=ne(1388),x=ne(2012),X=ne(9235),M=ne(9721),Xe.exports=C=function(O){L(W,O);function W(D,q,F){var Y,G;W.__super__.constructor.call(this,D),this.name="!DOCTYPE",this.documentObject=D,R(q)&&(Y=q,q=Y.pubID,F=Y.sysID),F==null&&(G=[q,F],F=G[0],q=G[1]),q!=null&&(this.pubID=this.stringify.dtdPubID(q)),F!=null&&(this.sysID=this.stringify.dtdSysID(F))}return W.prototype.element=function(D,q){var F;return F=new X(this,D,q),this.children.push(F),this},W.prototype.attList=function(D,q,F,Y,G){var J;return J=new I(this,D,q,F,Y,G),this.children.push(J),this},W.prototype.entity=function(D,q){var F;return F=new x(this,!1,D,q),this.children.push(F),this},W.prototype.pEntity=function(D,q){var F;return F=new x(this,!0,D,q),this.children.push(F),this},W.prototype.notation=function(D,q){var F;return F=new M(this,D,q),this.children.push(F),this},W.prototype.toString=function(D){return this.options.writer.set(D).docType(this)},W.prototype.ele=function(D,q){return this.element(D,q)},W.prototype.att=function(D,q,F,Y,G){return this.attList(D,q,F,Y,G)},W.prototype.ent=function(D,q){return this.entity(D,q)},W.prototype.pent=function(D,q){return this.pEntity(D,q)},W.prototype.not=function(D,q){return this.notation(D,q)},W.prototype.up=function(){return this.root()||this.documentObject},W}(E)}).call(this)},1026:(Xe,ce,ne)=>{ce.O=x;var I=ne(9796),X=ne(5584).Result;function x(M){var C=M.bodyReader;function E(R){var L=R.first("w:body");if(L==null)throw new Error("Could not find the body element: are you sure this is a docx file?");var T=C.readXmlElements(L.children).map(function(O){return new I.Document(O,{notes:M.notes,comments:M.comments})});return new X(T.value,T.messages)}return{convertXmlToDocument:E}}},1088:(Xe,ce,ne)=>{var I=ne(4501);ce.Element=I.Element,ce.element=I.element,ce.emptyElement=I.emptyElement,ce.text=I.text,ce.readString=ne(9689).readString,ce.writeString=ne(5157).writeString},1125:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X,x,M,C,E){var R=ne(9556),L=R.TypeError,T=ne(7443),O=T.errorObj,W=T.tryCatch,D=[];function q(Y,G,J){for(var z=0;z<G.length;++z){J._pushContext();var te=W(G[z])(Y);if(J._popContext(),te===O){J._pushContext();var V=I.reject(O.e);return J._popContext(),V}var de=M(te,J);if(de instanceof I)return de}return null}function F(Y,G,J,z){if(E.cancellation()){var te=new I(x),V=this._finallyPromise=new I(x);this._promise=te.lastly(function(){return V}),te._captureStackTrace(),te._setOnCancel(this)}else{var de=this._promise=new I(x);de._captureStackTrace()}this._stack=z,this._generatorFunction=Y,this._receiver=G,this._generator=void 0,this._yieldHandlers=typeof J=="function"?[J].concat(D):D,this._yieldedPromise=null,this._cancellationPhase=!1}T.inherits(F,C),F.prototype._isResolved=function(){return this._promise===null},F.prototype._cleanup=function(){this._promise=this._generator=null,E.cancellation()&&this._finallyPromise!==null&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},F.prototype._promiseCancelled=function(){if(!this._isResolved()){var Y=typeof this._generator.return!="undefined",G;if(Y)this._promise._pushContext(),G=W(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var J=new I.CancellationError("generator .return() sentinel");I.coroutine.returnSentinel=J,this._promise._attachExtraTrace(J),this._promise._pushContext(),G=W(this._generator.throw).call(this._generator,J),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(G)}},F.prototype._promiseFulfilled=function(Y){this._yieldedPromise=null,this._promise._pushContext();var G=W(this._generator.next).call(this._generator,Y);this._promise._popContext(),this._continue(G)},F.prototype._promiseRejected=function(Y){this._yieldedPromise=null,this._promise._attachExtraTrace(Y),this._promise._pushContext();var G=W(this._generator.throw).call(this._generator,Y);this._promise._popContext(),this._continue(G)},F.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof I){var Y=this._yieldedPromise;this._yieldedPromise=null,Y.cancel()}},F.prototype.promise=function(){return this._promise},F.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},F.prototype._continue=function(Y){var G=this._promise;if(Y===O)return this._cleanup(),this._cancellationPhase?G.cancel():G._rejectCallback(Y.e,!1);var J=Y.value;if(Y.done===!0)return this._cleanup(),this._cancellationPhase?G.cancel():G._resolveCallback(J);var z=M(J,this._promise);if(!(z instanceof I)&&(z=q(z,this._yieldHandlers,this._promise),z===null)){this._promiseRejected(new L(`A value %s was yielded that could not be treated as a promise

    See http://goo.gl/MqrFmX

`.replace("%s",J)+`From coroutine:
`+this._stack.split(`
`).slice(1,-7).join(`
`)));return}z=z._target();var te=z._bitField;te&50397184?te&33554432?I._async.invoke(this._promiseFulfilled,this,z._value()):te&16777216?I._async.invoke(this._promiseRejected,this,z._reason()):this._promiseCancelled():(this._yieldedPromise=z,z._proxy(this,null))},I.coroutine=function(Y,G){if(typeof Y!="function")throw new L(`generatorFunction must be a function

    See http://goo.gl/MqrFmX
`);var J=Object(G).yieldHandler,z=F,te=new Error().stack;return function(){var V=Y.apply(this,arguments),de=new z(void 0,void 0,J,te),P=de.promise();return de._generator=V,de._promiseFulfilled(void 0),P}},I.coroutine.addYieldHandler=function(Y){if(typeof Y!="function")throw new L("expecting a function but got "+T.classString(Y));D.push(Y)},I.spawn=function(Y){if(E.deprecated("Promise.spawn()","Promise.coroutine()"),typeof Y!="function")return X(`generatorFunction must be a function

    See http://goo.gl/MqrFmX
`);var G=new F(Y,this),J=G.promise();return G._run(I.spawn),J}}},1350:(Xe,ce,ne)=>{var I=ne(3054);ce.Parser=function(X){var x=function(M,C){return M(new I(C))};return{parseTokens:x}}},1375:(Xe,ce)=>{ce.none=Object.create({value:function(){throw new Error("Called value on none")},isNone:function(){return!0},isSome:function(){return!1},map:function(){return ce.none},flatMap:function(){return ce.none},filter:function(){return ce.none},toArray:function(){return[]},orElse:ne,valueOrElse:ne});function ne(X){return typeof X=="function"?X():X}ce.some=function(X){return new I(X)};var I=function(X){this._value=X};I.prototype.value=function(){return this._value},I.prototype.isNone=function(){return!1},I.prototype.isSome=function(){return!0},I.prototype.map=function(X){return new I(X(this._value))},I.prototype.flatMap=function(X){return X(this._value)},I.prototype.filter=function(X){return X(this._value)?this:ce.none},I.prototype.toArray=function(){return[this._value]},I.prototype.orElse=function(X){return this},I.prototype.valueOrElse=function(X){return this._value},ce.isOption=function(X){return X===ce.none||X instanceof I},ce.fromNullable=function(X){return X==null?ce.none:new I(X)}},1388:function(Xe,ce,ne){(function(){var I,X,x=function(C,E){for(var R in E)M.call(E,R)&&(C[R]=E[R]);function L(){this.constructor=C}return L.prototype=E.prototype,C.prototype=new L,C.__super__=E.prototype,C},M={}.hasOwnProperty;X=ne(3523),Xe.exports=I=function(C){x(E,C);function E(R,L,T,O,W,D){if(E.__super__.constructor.call(this,R),L==null)throw new Error("Missing DTD element name. "+this.debugInfo());if(T==null)throw new Error("Missing DTD attribute name. "+this.debugInfo(L));if(!O)throw new Error("Missing DTD attribute type. "+this.debugInfo(L));if(!W)throw new Error("Missing DTD attribute default. "+this.debugInfo(L));if(W.indexOf("#")!==0&&(W="#"+W),!W.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(L));if(D&&!W.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(L));this.elementName=this.stringify.eleName(L),this.attributeName=this.stringify.attName(T),this.attributeType=this.stringify.dtdAttType(O),this.defaultValue=this.stringify.dtdAttDefault(D),this.defaultValueType=W}return E.prototype.toString=function(R){return this.options.writer.set(R).dtdAttList(this)},E}(X)}).call(this)},1394:(Xe,ce,ne)=>{var I;ce.Tt=C;var X=ne(8291),x=I=["p.Heading1 => h1:fresh","p.Heading2 => h2:fresh","p.Heading3 => h3:fresh","p.Heading4 => h4:fresh","p.Heading5 => h5:fresh","p.Heading6 => h6:fresh","p[style-name='Heading 1'] => h1:fresh","p[style-name='Heading 2'] => h2:fresh","p[style-name='Heading 3'] => h3:fresh","p[style-name='Heading 4'] => h4:fresh","p[style-name='Heading 5'] => h5:fresh","p[style-name='Heading 6'] => h6:fresh","p[style-name='heading 1'] => h1:fresh","p[style-name='heading 2'] => h2:fresh","p[style-name='heading 3'] => h3:fresh","p[style-name='heading 4'] => h4:fresh","p[style-name='heading 5'] => h5:fresh","p[style-name='heading 6'] => h6:fresh","p.Heading => h1:fresh","p[style-name='Heading'] => h1:fresh","r[style-name='Strong'] => strong","p[style-name='footnote text'] => p:fresh","r[style-name='footnote reference'] =>","p[style-name='endnote text'] => p:fresh","r[style-name='endnote reference'] =>","p[style-name='annotation text'] => p:fresh","r[style-name='annotation reference'] =>","p[style-name='Footnote'] => p:fresh","r[style-name='Footnote anchor'] =>","p[style-name='Endnote'] => p:fresh","r[style-name='Endnote anchor'] =>","p:unordered-list(1) => ul > li:fresh","p:unordered-list(2) => ul|ol > li > ul > li:fresh","p:unordered-list(3) => ul|ol > li > ul|ol > li > ul > li:fresh","p:unordered-list(4) => ul|ol > li > ul|ol > li > ul|ol > li > ul > li:fresh","p:unordered-list(5) => ul|ol > li > ul|ol > li > ul|ol > li > ul|ol > li > ul > li:fresh","p:ordered-list(1) => ol > li:fresh","p:ordered-list(2) => ul|ol > li > ol > li:fresh","p:ordered-list(3) => ul|ol > li > ul|ol > li > ol > li:fresh","p:ordered-list(4) => ul|ol > li > ul|ol > li > ul|ol > li > ol > li:fresh","p:ordered-list(5) => ul|ol > li > ul|ol > li > ul|ol > li > ul|ol > li > ol > li:fresh","r[style-name='Hyperlink'] =>","p[style-name='Normal'] => p:fresh","p.Body => p:fresh","p[style-name='Body'] => p:fresh"],M=I={externalFileAccess:!1,transformDocument:R,includeDefaultStyleMap:!0,includeEmbeddedStyleMap:!0};function C(L){return L=L||{},X.extend({},M,L,{customStyleMap:E(L.styleMap),readStyleMap:function(){var T=this.customStyleMap;return this.includeEmbeddedStyleMap&&(T=T.concat(E(this.embeddedStyleMap))),this.includeDefaultStyleMap&&(T=T.concat(x)),T}})}function E(L){return L?X.isString(L)?L.split(`
`).map(function(T){return T.trim()}).filter(function(T){return T!==""&&T.charAt(0)!=="#"}):L:[]}function R(L){return L}},1610:(Xe,ce,ne)=>{var I=ne(9796);function X(x){if(x.type==="text")return x.value;if(x.type===I.types.tab)return"	";var M=x.type==="paragraph"?`

`:"";return(x.children||[]).map(X).join("")+M}ce.w=X},1714:function(Xe,ce,ne){"use strict";var I=this&&this.__importDefault||function(F){return F&&F.__esModule?F:{default:F}};Object.defineProperty(ce,"__esModule",{value:!0}),ce.hex=ce.dec=ce.codePoint=void 0;for(var X=I(ne(2548)),x={},M=String.fromCodePoint?String.fromCodePoint:q,C=0,E=X.default;C<E.length;C++){var R=E[C],L=parseInt(R["Unicode dec"],10),T={codePoint:L,string:M(L)};x[R["Typeface name"].toUpperCase()+"_"+R["Dingbat dec"]]=T}function O(F,Y){return x[F.toUpperCase()+"_"+Y]}ce.codePoint=O;function W(F,Y){return O(F,parseInt(Y,10))}ce.dec=W;function D(F,Y){return O(F,parseInt(Y,16))}ce.hex=D;function q(F){if(F<=65535)return String.fromCharCode(F);var Y=Math.floor((F-65536)/1024)+55296,G=(F-65536)%1024+56320;return String.fromCharCode(Y,G)}},1726:(Xe,ce,ne)=>{"use strict";var I=ne(7443),X,x=function(){throw new Error(`No async scheduler available

    See http://goo.gl/MqrFmX
`)},M=I.getNativePromise();if(I.isNode&&typeof MutationObserver=="undefined"){var C=ne.g.setImmediate,E=process.nextTick;X=I.isRecentNode?function(L){C.call(ne.g,L)}:function(L){E.call(process,L)}}else if(typeof M=="function"&&typeof M.resolve=="function"){var R=M.resolve();X=function(L){R.then(L)}}else typeof MutationObserver!="undefined"&&!(typeof window!="undefined"&&window.navigator&&(window.navigator.standalone||window.cordova))?X=function(){var L=document.createElement("div"),T={attributes:!0},O=!1,W=document.createElement("div"),D=new MutationObserver(function(){L.classList.toggle("foo"),O=!1});D.observe(W,T);var q=function(){O||(O=!0,W.classList.toggle("foo"))};return function(Y){var G=new MutationObserver(function(){G.disconnect(),Y()});G.observe(L,T),q()}}():typeof setImmediate!="undefined"?X=function(L){setImmediate(L)}:typeof setTimeout!="undefined"?X=function(L){setTimeout(L,0)}:X=x;Xe.exports=X},1769:(Xe,ce,ne)=>{var I=ne(7140),X=ne(4305);ce.RegexTokeniser=x;function x(M){M=M.map(function(L){return{name:L.name,regex:new RegExp(L.regex.source,"g")}});function C(L,T){for(var O=new X(L,T),W=0,D=[];W<L.length;){var q=E(L,W,O);W=q.endIndex,D.push(q.token)}return D.push(R(L,O)),D}function E(L,T,O){for(var W=0;W<M.length;W++){var D=M[W].regex;D.lastIndex=T;var q=D.exec(L);if(q){var Y=T+q[0].length;if(q.index===T&&Y>T){var F=q[1],G=new I(M[W].name,F,O.range(T,Y));return{token:G,endIndex:Y}}}}var Y=T+1,G=new I("unrecognisedCharacter",L.substring(T,Y),O.range(T,Y));return{token:G,endIndex:Y}}function R(L,T){return new I("end",null,T.range(L.length,L.length))}return{tokenise:C}}},1882:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X,x,M,C){var E=ne(7443),R=E.tryCatch;I.method=function(L){if(typeof L!="function")throw new I.TypeError("expecting a function but got "+E.classString(L));return function(){var T=new I(X);T._captureStackTrace(),T._pushContext();var O=R(L).apply(this,arguments),W=T._popContext();return C.checkForgottenReturns(O,W,"Promise.method",T),T._resolveFromSyncValue(O),T}},I.attempt=I.try=function(L){if(typeof L!="function")return M("expecting a function but got "+E.classString(L));var T=new I(X);T._captureStackTrace(),T._pushContext();var O;if(arguments.length>1){C.deprecated("calling Promise.try with more than 1 argument");var W=arguments[1],D=arguments[2];O=E.isArray(W)?R(L).apply(D,W):R(L).call(D,W)}else O=R(L)();var q=T._popContext();return C.checkForgottenReturns(O,q,"Promise.try",T),T._resolveFromSyncValue(O),T},I.prototype._resolveFromSyncValue=function(L){L===E.errorObj?this._rejectCallback(L.e,!1):this._resolveCallback(L,!0)}}},2012:function(Xe,ce,ne){(function(){var I,X,x,M=function(E,R){for(var L in R)C.call(R,L)&&(E[L]=R[L]);function T(){this.constructor=E}return T.prototype=R.prototype,E.prototype=new T,E.__super__=R.prototype,E},C={}.hasOwnProperty;x=ne(3626).isObject,X=ne(3523),Xe.exports=I=function(E){M(R,E);function R(L,T,O,W){if(R.__super__.constructor.call(this,L),O==null)throw new Error("Missing DTD entity name. "+this.debugInfo(O));if(W==null)throw new Error("Missing DTD entity value. "+this.debugInfo(O));if(this.pe=!!T,this.name=this.stringify.eleName(O),!x(W))this.value=this.stringify.dtdEntityValue(W);else{if(!W.pubID&&!W.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(O));if(W.pubID&&!W.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(O));if(W.pubID!=null&&(this.pubID=this.stringify.dtdPubID(W.pubID)),W.sysID!=null&&(this.sysID=this.stringify.dtdSysID(W.sysID)),W.nData!=null&&(this.nData=this.stringify.dtdNData(W.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(O))}}return R.prototype.toString=function(L){return this.options.writer.set(L).dtdEntity(this)},R}(X)}).call(this)},2101:Xe=>{"use strict";function ce(x){if(typeof x!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(x))}function ne(x,M){for(var C="",E=0,R=-1,L=0,T,O=0;O<=x.length;++O){if(O<x.length)T=x.charCodeAt(O);else{if(T===47)break;T=47}if(T===47){if(!(R===O-1||L===1))if(R!==O-1&&L===2){if(C.length<2||E!==2||C.charCodeAt(C.length-1)!==46||C.charCodeAt(C.length-2)!==46){if(C.length>2){var W=C.lastIndexOf("/");if(W!==C.length-1){W===-1?(C="",E=0):(C=C.slice(0,W),E=C.length-1-C.lastIndexOf("/")),R=O,L=0;continue}}else if(C.length===2||C.length===1){C="",E=0,R=O,L=0;continue}}M&&(C.length>0?C+="/..":C="..",E=2)}else C.length>0?C+="/"+x.slice(R+1,O):C=x.slice(R+1,O),E=O-R-1;R=O,L=0}else T===46&&L!==-1?++L:L=-1}return C}function I(x,M){var C=M.dir||M.root,E=M.base||(M.name||"")+(M.ext||"");return C?C===M.root?C+E:C+x+E:E}var X={resolve:function(){for(var M="",C=!1,E,R=arguments.length-1;R>=-1&&!C;R--){var L;R>=0?L=arguments[R]:(E===void 0&&(E=process.cwd()),L=E),ce(L),L.length!==0&&(M=L+"/"+M,C=L.charCodeAt(0)===47)}return M=ne(M,!C),C?M.length>0?"/"+M:"/":M.length>0?M:"."},normalize:function(M){if(ce(M),M.length===0)return".";var C=M.charCodeAt(0)===47,E=M.charCodeAt(M.length-1)===47;return M=ne(M,!C),M.length===0&&!C&&(M="."),M.length>0&&E&&(M+="/"),C?"/"+M:M},isAbsolute:function(M){return ce(M),M.length>0&&M.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var M,C=0;C<arguments.length;++C){var E=arguments[C];ce(E),E.length>0&&(M===void 0?M=E:M+="/"+E)}return M===void 0?".":X.normalize(M)},relative:function(M,C){if(ce(M),ce(C),M===C||(M=X.resolve(M),C=X.resolve(C),M===C))return"";for(var E=1;E<M.length&&M.charCodeAt(E)===47;++E);for(var R=M.length,L=R-E,T=1;T<C.length&&C.charCodeAt(T)===47;++T);for(var O=C.length,W=O-T,D=L<W?L:W,q=-1,F=0;F<=D;++F){if(F===D){if(W>D){if(C.charCodeAt(T+F)===47)return C.slice(T+F+1);if(F===0)return C.slice(T+F)}else L>D&&(M.charCodeAt(E+F)===47?q=F:F===0&&(q=0));break}var Y=M.charCodeAt(E+F),G=C.charCodeAt(T+F);if(Y!==G)break;Y===47&&(q=F)}var J="";for(F=E+q+1;F<=R;++F)(F===R||M.charCodeAt(F)===47)&&(J.length===0?J+="..":J+="/..");return J.length>0?J+C.slice(T+q):(T+=q,C.charCodeAt(T)===47&&++T,C.slice(T))},_makeLong:function(M){return M},dirname:function(M){if(ce(M),M.length===0)return".";for(var C=M.charCodeAt(0),E=C===47,R=-1,L=!0,T=M.length-1;T>=1;--T)if(C=M.charCodeAt(T),C===47){if(!L){R=T;break}}else L=!1;return R===-1?E?"/":".":E&&R===1?"//":M.slice(0,R)},basename:function(M,C){if(C!==void 0&&typeof C!="string")throw new TypeError('"ext" argument must be a string');ce(M);var E=0,R=-1,L=!0,T;if(C!==void 0&&C.length>0&&C.length<=M.length){if(C.length===M.length&&C===M)return"";var O=C.length-1,W=-1;for(T=M.length-1;T>=0;--T){var D=M.charCodeAt(T);if(D===47){if(!L){E=T+1;break}}else W===-1&&(L=!1,W=T+1),O>=0&&(D===C.charCodeAt(O)?--O===-1&&(R=T):(O=-1,R=W))}return E===R?R=W:R===-1&&(R=M.length),M.slice(E,R)}else{for(T=M.length-1;T>=0;--T)if(M.charCodeAt(T)===47){if(!L){E=T+1;break}}else R===-1&&(L=!1,R=T+1);return R===-1?"":M.slice(E,R)}},extname:function(M){ce(M);for(var C=-1,E=0,R=-1,L=!0,T=0,O=M.length-1;O>=0;--O){var W=M.charCodeAt(O);if(W===47){if(!L){E=O+1;break}continue}R===-1&&(L=!1,R=O+1),W===46?C===-1?C=O:T!==1&&(T=1):C!==-1&&(T=-1)}return C===-1||R===-1||T===0||T===1&&C===R-1&&C===E+1?"":M.slice(C,R)},format:function(M){if(M===null||typeof M!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof M);return I("/",M)},parse:function(M){ce(M);var C={root:"",dir:"",base:"",ext:"",name:""};if(M.length===0)return C;var E=M.charCodeAt(0),R=E===47,L;R?(C.root="/",L=1):L=0;for(var T=-1,O=0,W=-1,D=!0,q=M.length-1,F=0;q>=L;--q){if(E=M.charCodeAt(q),E===47){if(!D){O=q+1;break}continue}W===-1&&(D=!1,W=q+1),E===46?T===-1?T=q:F!==1&&(F=1):T!==-1&&(F=-1)}return T===-1||W===-1||F===0||F===1&&T===W-1&&T===O+1?W!==-1&&(O===0&&R?C.base=C.name=M.slice(1,W):C.base=C.name=M.slice(O,W)):(O===0&&R?(C.name=M.slice(1,T),C.base=M.slice(1,W)):(C.name=M.slice(O,T),C.base=M.slice(O,W)),C.ext=M.slice(T,W)),O>0?C.dir=M.slice(0,O-1):R&&(C.dir="/"),C},sep:"/",delimiter:":",win32:null,posix:null};X.posix=X,Xe.exports=X},2119:Xe=>{"use strict";Xe.exports=window.pdfjsLib},2139:function(Xe,ce,ne){(function(){var I,X,x=function(C,E){for(var R in E)M.call(E,R)&&(C[R]=E[R]);function L(){this.constructor=C}return L.prototype=E.prototype,C.prototype=new L,C.__super__=E.prototype,C},M={}.hasOwnProperty;X=ne(3523),Xe.exports=I=function(C){x(E,C);function E(R){E.__super__.constructor.call(this,R),this.isDummy=!0}return E.prototype.clone=function(){return Object.create(this)},E.prototype.toString=function(R){return""},E}(X)}).call(this)},2323:(Xe,ce,ne)=>{var I=ne(5350),X=ne(9001);ce.openArrayBuffer=x,ce.splitPath=M,ce.joinPath=C;function x(E){return X.loadAsync(E).then(function(R){function L(D){return R.file(D)!==null}function T(D,q){return R.file(D).async("uint8array").then(function(F){if(q==="base64")return I.fromByteArray(F);if(q){var Y=new TextDecoder(q);return Y.decode(F)}else return F})}function O(D,q){R.file(D,q)}function W(){return R.generateAsync({type:"arraybuffer"})}return{exists:L,read:T,write:O,toArrayBuffer:W}})}function M(E){var R=E.lastIndexOf("/");return R===-1?{dirname:"",basename:E}:{dirname:E.substring(0,R),basename:E.substring(R+1)}}function C(){var E=Array.prototype.filter.call(arguments,function(L){return L}),R=[];return E.forEach(function(L){/^\//.test(L)?R=[L]:R.push(L)}),R.join("/")}},2464:(Xe,ce)=>{ce.readRelationships=ne,ce.defaultValue=new I([]),ce.Relationships=I;function ne(X){var x=[];return X.children.forEach(function(M){if(M.name==="relationships:Relationship"){var C={relationshipId:M.attributes.Id,target:M.attributes.Target,type:M.attributes.Type};x.push(C)}}),new I(x)}function I(X){var x={};X.forEach(function(C){x[C.relationshipId]=C.target});var M={};return X.forEach(function(C){M[C.type]||(M[C.type]=[]),M[C.type].push(C.target)}),{findTargetByRelationshipId:function(C){return x[C]},findTargetsByType:function(C){return M[C]||[]}}}},2548:(Xe,ce)=>{"use strict";Object.defineProperty(ce,"__esModule",{value:!0});var ne=[{"Typeface name":"Symbol","Dingbat dec":"32","Dingbat hex":"20","Unicode dec":"32","Unicode hex":"20"},{"Typeface name":"Symbol","Dingbat dec":"33","Dingbat hex":"21","Unicode dec":"33","Unicode hex":"21"},{"Typeface name":"Symbol","Dingbat dec":"34","Dingbat hex":"22","Unicode dec":"8704","Unicode hex":"2200"},{"Typeface name":"Symbol","Dingbat dec":"35","Dingbat hex":"23","Unicode dec":"35","Unicode hex":"23"},{"Typeface name":"Symbol","Dingbat dec":"36","Dingbat hex":"24","Unicode dec":"8707","Unicode hex":"2203"},{"Typeface name":"Symbol","Dingbat dec":"37","Dingbat hex":"25","Unicode dec":"37","Unicode hex":"25"},{"Typeface name":"Symbol","Dingbat dec":"38","Dingbat hex":"26","Unicode dec":"38","Unicode hex":"26"},{"Typeface name":"Symbol","Dingbat dec":"39","Dingbat hex":"27","Unicode dec":"8717","Unicode hex":"220D"},{"Typeface name":"Symbol","Dingbat dec":"40","Dingbat hex":"28","Unicode dec":"40","Unicode hex":"28"},{"Typeface name":"Symbol","Dingbat dec":"41","Dingbat hex":"29","Unicode dec":"41","Unicode hex":"29"},{"Typeface name":"Symbol","Dingbat dec":"42","Dingbat hex":"2A","Unicode dec":"42","Unicode hex":"2A"},{"Typeface name":"Symbol","Dingbat dec":"43","Dingbat hex":"2B","Unicode dec":"43","Unicode hex":"2B"},{"Typeface name":"Symbol","Dingbat dec":"44","Dingbat hex":"2C","Unicode dec":"44","Unicode hex":"2C"},{"Typeface name":"Symbol","Dingbat dec":"45","Dingbat hex":"2D","Unicode dec":"8722","Unicode hex":"2212"},{"Typeface name":"Symbol","Dingbat dec":"46","Dingbat hex":"2E","Unicode dec":"46","Unicode hex":"2E"},{"Typeface name":"Symbol","Dingbat dec":"47","Dingbat hex":"2F","Unicode dec":"47","Unicode hex":"2F"},{"Typeface name":"Symbol","Dingbat dec":"48","Dingbat hex":"30","Unicode dec":"48","Unicode hex":"30"},{"Typeface name":"Symbol","Dingbat dec":"49","Dingbat hex":"31","Unicode dec":"49","Unicode hex":"31"},{"Typeface name":"Symbol","Dingbat dec":"50","Dingbat hex":"32","Unicode dec":"50","Unicode hex":"32"},{"Typeface name":"Symbol","Dingbat dec":"51","Dingbat hex":"33","Unicode dec":"51","Unicode hex":"33"},{"Typeface name":"Symbol","Dingbat dec":"52","Dingbat hex":"34","Unicode dec":"52","Unicode hex":"34"},{"Typeface name":"Symbol","Dingbat dec":"53","Dingbat hex":"35","Unicode dec":"53","Unicode hex":"35"},{"Typeface name":"Symbol","Dingbat dec":"54","Dingbat hex":"36","Unicode dec":"54","Unicode hex":"36"},{"Typeface name":"Symbol","Dingbat dec":"55","Dingbat hex":"37","Unicode dec":"55","Unicode hex":"37"},{"Typeface name":"Symbol","Dingbat dec":"56","Dingbat hex":"38","Unicode dec":"56","Unicode hex":"38"},{"Typeface name":"Symbol","Dingbat dec":"57","Dingbat hex":"39","Unicode dec":"57","Unicode hex":"39"},{"Typeface name":"Symbol","Dingbat dec":"58","Dingbat hex":"3A","Unicode dec":"58","Unicode hex":"3A"},{"Typeface name":"Symbol","Dingbat dec":"59","Dingbat hex":"3B","Unicode dec":"59","Unicode hex":"3B"},{"Typeface name":"Symbol","Dingbat dec":"60","Dingbat hex":"3C","Unicode dec":"60","Unicode hex":"3C"},{"Typeface name":"Symbol","Dingbat dec":"61","Dingbat hex":"3D","Unicode dec":"61","Unicode hex":"3D"},{"Typeface name":"Symbol","Dingbat dec":"62","Dingbat hex":"3E","Unicode dec":"62","Unicode hex":"3E"},{"Typeface name":"Symbol","Dingbat dec":"63","Dingbat hex":"3F","Unicode dec":"63","Unicode hex":"3F"},{"Typeface name":"Symbol","Dingbat dec":"64","Dingbat hex":"40","Unicode dec":"8773","Unicode hex":"2245"},{"Typeface name":"Symbol","Dingbat dec":"65","Dingbat hex":"41","Unicode dec":"913","Unicode hex":"391"},{"Typeface name":"Symbol","Dingbat dec":"66","Dingbat hex":"42","Unicode dec":"914","Unicode hex":"392"},{"Typeface name":"Symbol","Dingbat dec":"67","Dingbat hex":"43","Unicode dec":"935","Unicode hex":"3A7"},{"Typeface name":"Symbol","Dingbat dec":"68","Dingbat hex":"44","Unicode dec":"916","Unicode hex":"394"},{"Typeface name":"Symbol","Dingbat dec":"69","Dingbat hex":"45","Unicode dec":"917","Unicode hex":"395"},{"Typeface name":"Symbol","Dingbat dec":"70","Dingbat hex":"46","Unicode dec":"934","Unicode hex":"3A6"},{"Typeface name":"Symbol","Dingbat dec":"71","Dingbat hex":"47","Unicode dec":"915","Unicode hex":"393"},{"Typeface name":"Symbol","Dingbat dec":"72","Dingbat hex":"48","Unicode dec":"919","Unicode hex":"397"},{"Typeface name":"Symbol","Dingbat dec":"73","Dingbat hex":"49","Unicode dec":"921","Unicode hex":"399"},{"Typeface name":"Symbol","Dingbat dec":"74","Dingbat hex":"4A","Unicode dec":"977","Unicode hex":"3D1"},{"Typeface name":"Symbol","Dingbat dec":"75","Dingbat hex":"4B","Unicode dec":"922","Unicode hex":"39A"},{"Typeface name":"Symbol","Dingbat dec":"76","Dingbat hex":"4C","Unicode dec":"923","Unicode hex":"39B"},{"Typeface name":"Symbol","Dingbat dec":"77","Dingbat hex":"4D","Unicode dec":"924","Unicode hex":"39C"},{"Typeface name":"Symbol","Dingbat dec":"78","Dingbat hex":"4E","Unicode dec":"925","Unicode hex":"39D"},{"Typeface name":"Symbol","Dingbat dec":"79","Dingbat hex":"4F","Unicode dec":"927","Unicode hex":"39F"},{"Typeface name":"Symbol","Dingbat dec":"80","Dingbat hex":"50","Unicode dec":"928","Unicode hex":"3A0"},{"Typeface name":"Symbol","Dingbat dec":"81","Dingbat hex":"51","Unicode dec":"920","Unicode hex":"398"},{"Typeface name":"Symbol","Dingbat dec":"82","Dingbat hex":"52","Unicode dec":"929","Unicode hex":"3A1"},{"Typeface name":"Symbol","Dingbat dec":"83","Dingbat hex":"53","Unicode dec":"931","Unicode hex":"3A3"},{"Typeface name":"Symbol","Dingbat dec":"84","Dingbat hex":"54","Unicode dec":"932","Unicode hex":"3A4"},{"Typeface name":"Symbol","Dingbat dec":"85","Dingbat hex":"55","Unicode dec":"933","Unicode hex":"3A5"},{"Typeface name":"Symbol","Dingbat dec":"86","Dingbat hex":"56","Unicode dec":"962","Unicode hex":"3C2"},{"Typeface name":"Symbol","Dingbat dec":"87","Dingbat hex":"57","Unicode dec":"937","Unicode hex":"3A9"},{"Typeface name":"Symbol","Dingbat dec":"88","Dingbat hex":"58","Unicode dec":"926","Unicode hex":"39E"},{"Typeface name":"Symbol","Dingbat dec":"89","Dingbat hex":"59","Unicode dec":"936","Unicode hex":"3A8"},{"Typeface name":"Symbol","Dingbat dec":"90","Dingbat hex":"5A","Unicode dec":"918","Unicode hex":"396"},{"Typeface name":"Symbol","Dingbat dec":"91","Dingbat hex":"5B","Unicode dec":"91","Unicode hex":"5B"},{"Typeface name":"Symbol","Dingbat dec":"92","Dingbat hex":"5C","Unicode dec":"8756","Unicode hex":"2234"},{"Typeface name":"Symbol","Dingbat dec":"93","Dingbat hex":"5D","Unicode dec":"93","Unicode hex":"5D"},{"Typeface name":"Symbol","Dingbat dec":"94","Dingbat hex":"5E","Unicode dec":"8869","Unicode hex":"22A5"},{"Typeface name":"Symbol","Dingbat dec":"95","Dingbat hex":"5F","Unicode dec":"95","Unicode hex":"5F"},{"Typeface name":"Symbol","Dingbat dec":"96","Dingbat hex":"60","Unicode dec":"8254","Unicode hex":"203E"},{"Typeface name":"Symbol","Dingbat dec":"97","Dingbat hex":"61","Unicode dec":"945","Unicode hex":"3B1"},{"Typeface name":"Symbol","Dingbat dec":"98","Dingbat hex":"62","Unicode dec":"946","Unicode hex":"3B2"},{"Typeface name":"Symbol","Dingbat dec":"99","Dingbat hex":"63","Unicode dec":"967","Unicode hex":"3C7"},{"Typeface name":"Symbol","Dingbat dec":"100","Dingbat hex":"64","Unicode dec":"948","Unicode hex":"3B4"},{"Typeface name":"Symbol","Dingbat dec":"101","Dingbat hex":"65","Unicode dec":"949","Unicode hex":"3B5"},{"Typeface name":"Symbol","Dingbat dec":"102","Dingbat hex":"66","Unicode dec":"966","Unicode hex":"3C6"},{"Typeface name":"Symbol","Dingbat dec":"103","Dingbat hex":"67","Unicode dec":"947","Unicode hex":"3B3"},{"Typeface name":"Symbol","Dingbat dec":"104","Dingbat hex":"68","Unicode dec":"951","Unicode hex":"3B7"},{"Typeface name":"Symbol","Dingbat dec":"105","Dingbat hex":"69","Unicode dec":"953","Unicode hex":"3B9"},{"Typeface name":"Symbol","Dingbat dec":"106","Dingbat hex":"6A","Unicode dec":"981","Unicode hex":"3D5"},{"Typeface name":"Symbol","Dingbat dec":"107","Dingbat hex":"6B","Unicode dec":"954","Unicode hex":"3BA"},{"Typeface name":"Symbol","Dingbat dec":"108","Dingbat hex":"6C","Unicode dec":"955","Unicode hex":"3BB"},{"Typeface name":"Symbol","Dingbat dec":"109","Dingbat hex":"6D","Unicode dec":"956","Unicode hex":"3BC"},{"Typeface name":"Symbol","Dingbat dec":"110","Dingbat hex":"6E","Unicode dec":"957","Unicode hex":"3BD"},{"Typeface name":"Symbol","Dingbat dec":"111","Dingbat hex":"6F","Unicode dec":"959","Unicode hex":"3BF"},{"Typeface name":"Symbol","Dingbat dec":"112","Dingbat hex":"70","Unicode dec":"960","Unicode hex":"3C0"},{"Typeface name":"Symbol","Dingbat dec":"113","Dingbat hex":"71","Unicode dec":"952","Unicode hex":"3B8"},{"Typeface name":"Symbol","Dingbat dec":"114","Dingbat hex":"72","Unicode dec":"961","Unicode hex":"3C1"},{"Typeface name":"Symbol","Dingbat dec":"115","Dingbat hex":"73","Unicode dec":"963","Unicode hex":"3C3"},{"Typeface name":"Symbol","Dingbat dec":"116","Dingbat hex":"74","Unicode dec":"964","Unicode hex":"3C4"},{"Typeface name":"Symbol","Dingbat dec":"117","Dingbat hex":"75","Unicode dec":"965","Unicode hex":"3C5"},{"Typeface name":"Symbol","Dingbat dec":"118","Dingbat hex":"76","Unicode dec":"982","Unicode hex":"3D6"},{"Typeface name":"Symbol","Dingbat dec":"119","Dingbat hex":"77","Unicode dec":"969","Unicode hex":"3C9"},{"Typeface name":"Symbol","Dingbat dec":"120","Dingbat hex":"78","Unicode dec":"958","Unicode hex":"3BE"},{"Typeface name":"Symbol","Dingbat dec":"121","Dingbat hex":"79","Unicode dec":"968","Unicode hex":"3C8"},{"Typeface name":"Symbol","Dingbat dec":"122","Dingbat hex":"7A","Unicode dec":"950","Unicode hex":"3B6"},{"Typeface name":"Symbol","Dingbat dec":"123","Dingbat hex":"7B","Unicode dec":"123","Unicode hex":"7B"},{"Typeface name":"Symbol","Dingbat dec":"124","Dingbat hex":"7C","Unicode dec":"124","Unicode hex":"7C"},{"Typeface name":"Symbol","Dingbat dec":"125","Dingbat hex":"7D","Unicode dec":"125","Unicode hex":"7D"},{"Typeface name":"Symbol","Dingbat dec":"126","Dingbat hex":"7E","Unicode dec":"126","Unicode hex":"7E"},{"Typeface name":"Symbol","Dingbat dec":"160","Dingbat hex":"A0","Unicode dec":"8364","Unicode hex":"20AC"},{"Typeface name":"Symbol","Dingbat dec":"161","Dingbat hex":"A1","Unicode dec":"978","Unicode hex":"3D2"},{"Typeface name":"Symbol","Dingbat dec":"162","Dingbat hex":"A2","Unicode dec":"8242","Unicode hex":"2032"},{"Typeface name":"Symbol","Dingbat dec":"163","Dingbat hex":"A3","Unicode dec":"8804","Unicode hex":"2264"},{"Typeface name":"Symbol","Dingbat dec":"164","Dingbat hex":"A4","Unicode dec":"8260","Unicode hex":"2044"},{"Typeface name":"Symbol","Dingbat dec":"165","Dingbat hex":"A5","Unicode dec":"8734","Unicode hex":"221E"},{"Typeface name":"Symbol","Dingbat dec":"166","Dingbat hex":"A6","Unicode dec":"402","Unicode hex":"192"},{"Typeface name":"Symbol","Dingbat dec":"167","Dingbat hex":"A7","Unicode dec":"9827","Unicode hex":"2663"},{"Typeface name":"Symbol","Dingbat dec":"168","Dingbat hex":"A8","Unicode dec":"9830","Unicode hex":"2666"},{"Typeface name":"Symbol","Dingbat dec":"169","Dingbat hex":"A9","Unicode dec":"9829","Unicode hex":"2665"},{"Typeface name":"Symbol","Dingbat dec":"170","Dingbat hex":"AA","Unicode dec":"9824","Unicode hex":"2660"},{"Typeface name":"Symbol","Dingbat dec":"171","Dingbat hex":"AB","Unicode dec":"8596","Unicode hex":"2194"},{"Typeface name":"Symbol","Dingbat dec":"172","Dingbat hex":"AC","Unicode dec":"8592","Unicode hex":"2190"},{"Typeface name":"Symbol","Dingbat dec":"173","Dingbat hex":"AD","Unicode dec":"8593","Unicode hex":"2191"},{"Typeface name":"Symbol","Dingbat dec":"174","Dingbat hex":"AE","Unicode dec":"8594","Unicode hex":"2192"},{"Typeface name":"Symbol","Dingbat dec":"175","Dingbat hex":"AF","Unicode dec":"8595","Unicode hex":"2193"},{"Typeface name":"Symbol","Dingbat dec":"176","Dingbat hex":"B0","Unicode dec":"176","Unicode hex":"B0"},{"Typeface name":"Symbol","Dingbat dec":"177","Dingbat hex":"B1","Unicode dec":"177","Unicode hex":"B1"},{"Typeface name":"Symbol","Dingbat dec":"178","Dingbat hex":"B2","Unicode dec":"8243","Unicode hex":"2033"},{"Typeface name":"Symbol","Dingbat dec":"179","Dingbat hex":"B3","Unicode dec":"8805","Unicode hex":"2265"},{"Typeface name":"Symbol","Dingbat dec":"180","Dingbat hex":"B4","Unicode dec":"215","Unicode hex":"D7"},{"Typeface name":"Symbol","Dingbat dec":"181","Dingbat hex":"B5","Unicode dec":"8733","Unicode hex":"221D"},{"Typeface name":"Symbol","Dingbat dec":"182","Dingbat hex":"B6","Unicode dec":"8706","Unicode hex":"2202"},{"Typeface name":"Symbol","Dingbat dec":"183","Dingbat hex":"B7","Unicode dec":"8226","Unicode hex":"2022"},{"Typeface name":"Symbol","Dingbat dec":"184","Dingbat hex":"B8","Unicode dec":"247","Unicode hex":"F7"},{"Typeface name":"Symbol","Dingbat dec":"185","Dingbat hex":"B9","Unicode dec":"8800","Unicode hex":"2260"},{"Typeface name":"Symbol","Dingbat dec":"186","Dingbat hex":"BA","Unicode dec":"8801","Unicode hex":"2261"},{"Typeface name":"Symbol","Dingbat dec":"187","Dingbat hex":"BB","Unicode dec":"8776","Unicode hex":"2248"},{"Typeface name":"Symbol","Dingbat dec":"188","Dingbat hex":"BC","Unicode dec":"8230","Unicode hex":"2026"},{"Typeface name":"Symbol","Dingbat dec":"189","Dingbat hex":"BD","Unicode dec":"9168","Unicode hex":"23D0"},{"Typeface name":"Symbol","Dingbat dec":"190","Dingbat hex":"BE","Unicode dec":"9135","Unicode hex":"23AF"},{"Typeface name":"Symbol","Dingbat dec":"191","Dingbat hex":"BF","Unicode dec":"8629","Unicode hex":"21B5"},{"Typeface name":"Symbol","Dingbat dec":"192","Dingbat hex":"C0","Unicode dec":"8501","Unicode hex":"2135"},{"Typeface name":"Symbol","Dingbat dec":"193","Dingbat hex":"C1","Unicode dec":"8465","Unicode hex":"2111"},{"Typeface name":"Symbol","Dingbat dec":"194","Dingbat hex":"C2","Unicode dec":"8476","Unicode hex":"211C"},{"Typeface name":"Symbol","Dingbat dec":"195","Dingbat hex":"C3","Unicode dec":"8472","Unicode hex":"2118"},{"Typeface name":"Symbol","Dingbat dec":"196","Dingbat hex":"C4","Unicode dec":"8855","Unicode hex":"2297"},{"Typeface name":"Symbol","Dingbat dec":"197","Dingbat hex":"C5","Unicode dec":"8853","Unicode hex":"2295"},{"Typeface name":"Symbol","Dingbat dec":"198","Dingbat hex":"C6","Unicode dec":"8709","Unicode hex":"2205"},{"Typeface name":"Symbol","Dingbat dec":"199","Dingbat hex":"C7","Unicode dec":"8745","Unicode hex":"2229"},{"Typeface name":"Symbol","Dingbat dec":"200","Dingbat hex":"C8","Unicode dec":"8746","Unicode hex":"222A"},{"Typeface name":"Symbol","Dingbat dec":"201","Dingbat hex":"C9","Unicode dec":"8835","Unicode hex":"2283"},{"Typeface name":"Symbol","Dingbat dec":"202","Dingbat hex":"CA","Unicode dec":"8839","Unicode hex":"2287"},{"Typeface name":"Symbol","Dingbat dec":"203","Dingbat hex":"CB","Unicode dec":"8836","Unicode hex":"2284"},{"Typeface name":"Symbol","Dingbat dec":"204","Dingbat hex":"CC","Unicode dec":"8834","Unicode hex":"2282"},{"Typeface name":"Symbol","Dingbat dec":"205","Dingbat hex":"CD","Unicode dec":"8838","Unicode hex":"2286"},{"Typeface name":"Symbol","Dingbat dec":"206","Dingbat hex":"CE","Unicode dec":"8712","Unicode hex":"2208"},{"Typeface name":"Symbol","Dingbat dec":"207","Dingbat hex":"CF","Unicode dec":"8713","Unicode hex":"2209"},{"Typeface name":"Symbol","Dingbat dec":"208","Dingbat hex":"D0","Unicode dec":"8736","Unicode hex":"2220"},{"Typeface name":"Symbol","Dingbat dec":"209","Dingbat hex":"D1","Unicode dec":"8711","Unicode hex":"2207"},{"Typeface name":"Symbol","Dingbat dec":"210","Dingbat hex":"D2","Unicode dec":"174","Unicode hex":"AE"},{"Typeface name":"Symbol","Dingbat dec":"211","Dingbat hex":"D3","Unicode dec":"169","Unicode hex":"A9"},{"Typeface name":"Symbol","Dingbat dec":"212","Dingbat hex":"D4","Unicode dec":"8482","Unicode hex":"2122"},{"Typeface name":"Symbol","Dingbat dec":"213","Dingbat hex":"D5","Unicode dec":"8719","Unicode hex":"220F"},{"Typeface name":"Symbol","Dingbat dec":"214","Dingbat hex":"D6","Unicode dec":"8730","Unicode hex":"221A"},{"Typeface name":"Symbol","Dingbat dec":"215","Dingbat hex":"D7","Unicode dec":"8901","Unicode hex":"22C5"},{"Typeface name":"Symbol","Dingbat dec":"216","Dingbat hex":"D8","Unicode dec":"172","Unicode hex":"AC"},{"Typeface name":"Symbol","Dingbat dec":"217","Dingbat hex":"D9","Unicode dec":"8743","Unicode hex":"2227"},{"Typeface name":"Symbol","Dingbat dec":"218","Dingbat hex":"DA","Unicode dec":"8744","Unicode hex":"2228"},{"Typeface name":"Symbol","Dingbat dec":"219","Dingbat hex":"DB","Unicode dec":"8660","Unicode hex":"21D4"},{"Typeface name":"Symbol","Dingbat dec":"220","Dingbat hex":"DC","Unicode dec":"8656","Unicode hex":"21D0"},{"Typeface name":"Symbol","Dingbat dec":"221","Dingbat hex":"DD","Unicode dec":"8657","Unicode hex":"21D1"},{"Typeface name":"Symbol","Dingbat dec":"222","Dingbat hex":"DE","Unicode dec":"8658","Unicode hex":"21D2"},{"Typeface name":"Symbol","Dingbat dec":"223","Dingbat hex":"DF","Unicode dec":"8659","Unicode hex":"21D3"},{"Typeface name":"Symbol","Dingbat dec":"224","Dingbat hex":"E0","Unicode dec":"9674","Unicode hex":"25CA"},{"Typeface name":"Symbol","Dingbat dec":"225","Dingbat hex":"E1","Unicode dec":"12296","Unicode hex":"3008"},{"Typeface name":"Symbol","Dingbat dec":"226","Dingbat hex":"E2","Unicode dec":"174","Unicode hex":"AE"},{"Typeface name":"Symbol","Dingbat dec":"227","Dingbat hex":"E3","Unicode dec":"169","Unicode hex":"A9"},{"Typeface name":"Symbol","Dingbat dec":"228","Dingbat hex":"E4","Unicode dec":"8482","Unicode hex":"2122"},{"Typeface name":"Symbol","Dingbat dec":"229","Dingbat hex":"E5","Unicode dec":"8721","Unicode hex":"2211"},{"Typeface name":"Symbol","Dingbat dec":"230","Dingbat hex":"E6","Unicode dec":"9115","Unicode hex":"239B"},{"Typeface name":"Symbol","Dingbat dec":"231","Dingbat hex":"E7","Unicode dec":"9116","Unicode hex":"239C"},{"Typeface name":"Symbol","Dingbat dec":"232","Dingbat hex":"E8","Unicode dec":"9117","Unicode hex":"239D"},{"Typeface name":"Symbol","Dingbat dec":"233","Dingbat hex":"E9","Unicode dec":"9121","Unicode hex":"23A1"},{"Typeface name":"Symbol","Dingbat dec":"234","Dingbat hex":"EA","Unicode dec":"9122","Unicode hex":"23A2"},{"Typeface name":"Symbol","Dingbat dec":"235","Dingbat hex":"EB","Unicode dec":"9123","Unicode hex":"23A3"},{"Typeface name":"Symbol","Dingbat dec":"236","Dingbat hex":"EC","Unicode dec":"9127","Unicode hex":"23A7"},{"Typeface name":"Symbol","Dingbat dec":"237","Dingbat hex":"ED","Unicode dec":"9128","Unicode hex":"23A8"},{"Typeface name":"Symbol","Dingbat dec":"238","Dingbat hex":"EE","Unicode dec":"9129","Unicode hex":"23A9"},{"Typeface name":"Symbol","Dingbat dec":"239","Dingbat hex":"EF","Unicode dec":"9130","Unicode hex":"23AA"},{"Typeface name":"Symbol","Dingbat dec":"240","Dingbat hex":"F0","Unicode dec":"63743","Unicode hex":"F8FF"},{"Typeface name":"Symbol","Dingbat dec":"241","Dingbat hex":"F1","Unicode dec":"12297","Unicode hex":"3009"},{"Typeface name":"Symbol","Dingbat dec":"242","Dingbat hex":"F2","Unicode dec":"8747","Unicode hex":"222B"},{"Typeface name":"Symbol","Dingbat dec":"243","Dingbat hex":"F3","Unicode dec":"8992","Unicode hex":"2320"},{"Typeface name":"Symbol","Dingbat dec":"244","Dingbat hex":"F4","Unicode dec":"9134","Unicode hex":"23AE"},{"Typeface name":"Symbol","Dingbat dec":"245","Dingbat hex":"F5","Unicode dec":"8993","Unicode hex":"2321"},{"Typeface name":"Symbol","Dingbat dec":"246","Dingbat hex":"F6","Unicode dec":"9118","Unicode hex":"239E"},{"Typeface name":"Symbol","Dingbat dec":"247","Dingbat hex":"F7","Unicode dec":"9119","Unicode hex":"239F"},{"Typeface name":"Symbol","Dingbat dec":"248","Dingbat hex":"F8","Unicode dec":"9120","Unicode hex":"23A0"},{"Typeface name":"Symbol","Dingbat dec":"249","Dingbat hex":"F9","Unicode dec":"9124","Unicode hex":"23A4"},{"Typeface name":"Symbol","Dingbat dec":"250","Dingbat hex":"FA","Unicode dec":"9125","Unicode hex":"23A5"},{"Typeface name":"Symbol","Dingbat dec":"251","Dingbat hex":"FB","Unicode dec":"9126","Unicode hex":"23A6"},{"Typeface name":"Symbol","Dingbat dec":"252","Dingbat hex":"FC","Unicode dec":"9131","Unicode hex":"23AB"},{"Typeface name":"Symbol","Dingbat dec":"253","Dingbat hex":"FD","Unicode dec":"9132","Unicode hex":"23AC"},{"Typeface name":"Symbol","Dingbat dec":"254","Dingbat hex":"FE","Unicode dec":"9133","Unicode hex":"23AD"},{"Typeface name":"Webdings","Dingbat dec":"32","Dingbat hex":"20","Unicode dec":"32","Unicode hex":"20"},{"Typeface name":"Webdings","Dingbat dec":"33","Dingbat hex":"21","Unicode dec":"128375","Unicode hex":"1F577"},{"Typeface name":"Webdings","Dingbat dec":"34","Dingbat hex":"22","Unicode dec":"128376","Unicode hex":"1F578"},{"Typeface name":"Webdings","Dingbat dec":"35","Dingbat hex":"23","Unicode dec":"128370","Unicode hex":"1F572"},{"Typeface name":"Webdings","Dingbat dec":"36","Dingbat hex":"24","Unicode dec":"128374","Unicode hex":"1F576"},{"Typeface name":"Webdings","Dingbat dec":"37","Dingbat hex":"25","Unicode dec":"127942","Unicode hex":"1F3C6"},{"Typeface name":"Webdings","Dingbat dec":"38","Dingbat hex":"26","Unicode dec":"127894","Unicode hex":"1F396"},{"Typeface name":"Webdings","Dingbat dec":"39","Dingbat hex":"27","Unicode dec":"128391","Unicode hex":"1F587"},{"Typeface name":"Webdings","Dingbat dec":"40","Dingbat hex":"28","Unicode dec":"128488","Unicode hex":"1F5E8"},{"Typeface name":"Webdings","Dingbat dec":"41","Dingbat hex":"29","Unicode dec":"128489","Unicode hex":"1F5E9"},{"Typeface name":"Webdings","Dingbat dec":"42","Dingbat hex":"2A","Unicode dec":"128496","Unicode hex":"1F5F0"},{"Typeface name":"Webdings","Dingbat dec":"43","Dingbat hex":"2B","Unicode dec":"128497","Unicode hex":"1F5F1"},{"Typeface name":"Webdings","Dingbat dec":"44","Dingbat hex":"2C","Unicode dec":"127798","Unicode hex":"1F336"},{"Typeface name":"Webdings","Dingbat dec":"45","Dingbat hex":"2D","Unicode dec":"127895","Unicode hex":"1F397"},{"Typeface name":"Webdings","Dingbat dec":"46","Dingbat hex":"2E","Unicode dec":"128638","Unicode hex":"1F67E"},{"Typeface name":"Webdings","Dingbat dec":"47","Dingbat hex":"2F","Unicode dec":"128636","Unicode hex":"1F67C"},{"Typeface name":"Webdings","Dingbat dec":"48","Dingbat hex":"30","Unicode dec":"128469","Unicode hex":"1F5D5"},{"Typeface name":"Webdings","Dingbat dec":"49","Dingbat hex":"31","Unicode dec":"128470","Unicode hex":"1F5D6"},{"Typeface name":"Webdings","Dingbat dec":"50","Dingbat hex":"32","Unicode dec":"128471","Unicode hex":"1F5D7"},{"Typeface name":"Webdings","Dingbat dec":"51","Dingbat hex":"33","Unicode dec":"9204","Unicode hex":"23F4"},{"Typeface name":"Webdings","Dingbat dec":"52","Dingbat hex":"34","Unicode dec":"9205","Unicode hex":"23F5"},{"Typeface name":"Webdings","Dingbat dec":"53","Dingbat hex":"35","Unicode dec":"9206","Unicode hex":"23F6"},{"Typeface name":"Webdings","Dingbat dec":"54","Dingbat hex":"36","Unicode dec":"9207","Unicode hex":"23F7"},{"Typeface name":"Webdings","Dingbat dec":"55","Dingbat hex":"37","Unicode dec":"9194","Unicode hex":"23EA"},{"Typeface name":"Webdings","Dingbat dec":"56","Dingbat hex":"38","Unicode dec":"9193","Unicode hex":"23E9"},{"Typeface name":"Webdings","Dingbat dec":"57","Dingbat hex":"39","Unicode dec":"9198","Unicode hex":"23EE"},{"Typeface name":"Webdings","Dingbat dec":"58","Dingbat hex":"3A","Unicode dec":"9197","Unicode hex":"23ED"},{"Typeface name":"Webdings","Dingbat dec":"59","Dingbat hex":"3B","Unicode dec":"9208","Unicode hex":"23F8"},{"Typeface name":"Webdings","Dingbat dec":"60","Dingbat hex":"3C","Unicode dec":"9209","Unicode hex":"23F9"},{"Typeface name":"Webdings","Dingbat dec":"61","Dingbat hex":"3D","Unicode dec":"9210","Unicode hex":"23FA"},{"Typeface name":"Webdings","Dingbat dec":"62","Dingbat hex":"3E","Unicode dec":"128474","Unicode hex":"1F5DA"},{"Typeface name":"Webdings","Dingbat dec":"63","Dingbat hex":"3F","Unicode dec":"128499","Unicode hex":"1F5F3"},{"Typeface name":"Webdings","Dingbat dec":"64","Dingbat hex":"40","Unicode dec":"128736","Unicode hex":"1F6E0"},{"Typeface name":"Webdings","Dingbat dec":"65","Dingbat hex":"41","Unicode dec":"127959","Unicode hex":"1F3D7"},{"Typeface name":"Webdings","Dingbat dec":"66","Dingbat hex":"42","Unicode dec":"127960","Unicode hex":"1F3D8"},{"Typeface name":"Webdings","Dingbat dec":"67","Dingbat hex":"43","Unicode dec":"127961","Unicode hex":"1F3D9"},{"Typeface name":"Webdings","Dingbat dec":"68","Dingbat hex":"44","Unicode dec":"127962","Unicode hex":"1F3DA"},{"Typeface name":"Webdings","Dingbat dec":"69","Dingbat hex":"45","Unicode dec":"127964","Unicode hex":"1F3DC"},{"Typeface name":"Webdings","Dingbat dec":"70","Dingbat hex":"46","Unicode dec":"127981","Unicode hex":"1F3ED"},{"Typeface name":"Webdings","Dingbat dec":"71","Dingbat hex":"47","Unicode dec":"127963","Unicode hex":"1F3DB"},{"Typeface name":"Webdings","Dingbat dec":"72","Dingbat hex":"48","Unicode dec":"127968","Unicode hex":"1F3E0"},{"Typeface name":"Webdings","Dingbat dec":"73","Dingbat hex":"49","Unicode dec":"127958","Unicode hex":"1F3D6"},{"Typeface name":"Webdings","Dingbat dec":"74","Dingbat hex":"4A","Unicode dec":"127965","Unicode hex":"1F3DD"},{"Typeface name":"Webdings","Dingbat dec":"75","Dingbat hex":"4B","Unicode dec":"128739","Unicode hex":"1F6E3"},{"Typeface name":"Webdings","Dingbat dec":"76","Dingbat hex":"4C","Unicode dec":"128269","Unicode hex":"1F50D"},{"Typeface name":"Webdings","Dingbat dec":"77","Dingbat hex":"4D","Unicode dec":"127956","Unicode hex":"1F3D4"},{"Typeface name":"Webdings","Dingbat dec":"78","Dingbat hex":"4E","Unicode dec":"128065","Unicode hex":"1F441"},{"Typeface name":"Webdings","Dingbat dec":"79","Dingbat hex":"4F","Unicode dec":"128066","Unicode hex":"1F442"},{"Typeface name":"Webdings","Dingbat dec":"80","Dingbat hex":"50","Unicode dec":"127966","Unicode hex":"1F3DE"},{"Typeface name":"Webdings","Dingbat dec":"81","Dingbat hex":"51","Unicode dec":"127957","Unicode hex":"1F3D5"},{"Typeface name":"Webdings","Dingbat dec":"82","Dingbat hex":"52","Unicode dec":"128740","Unicode hex":"1F6E4"},{"Typeface name":"Webdings","Dingbat dec":"83","Dingbat hex":"53","Unicode dec":"127967","Unicode hex":"1F3DF"},{"Typeface name":"Webdings","Dingbat dec":"84","Dingbat hex":"54","Unicode dec":"128755","Unicode hex":"1F6F3"},{"Typeface name":"Webdings","Dingbat dec":"85","Dingbat hex":"55","Unicode dec":"128364","Unicode hex":"1F56C"},{"Typeface name":"Webdings","Dingbat dec":"86","Dingbat hex":"56","Unicode dec":"128363","Unicode hex":"1F56B"},{"Typeface name":"Webdings","Dingbat dec":"87","Dingbat hex":"57","Unicode dec":"128360","Unicode hex":"1F568"},{"Typeface name":"Webdings","Dingbat dec":"88","Dingbat hex":"58","Unicode dec":"128264","Unicode hex":"1F508"},{"Typeface name":"Webdings","Dingbat dec":"89","Dingbat hex":"59","Unicode dec":"127892","Unicode hex":"1F394"},{"Typeface name":"Webdings","Dingbat dec":"90","Dingbat hex":"5A","Unicode dec":"127893","Unicode hex":"1F395"},{"Typeface name":"Webdings","Dingbat dec":"91","Dingbat hex":"5B","Unicode dec":"128492","Unicode hex":"1F5EC"},{"Typeface name":"Webdings","Dingbat dec":"92","Dingbat hex":"5C","Unicode dec":"128637","Unicode hex":"1F67D"},{"Typeface name":"Webdings","Dingbat dec":"93","Dingbat hex":"5D","Unicode dec":"128493","Unicode hex":"1F5ED"},{"Typeface name":"Webdings","Dingbat dec":"94","Dingbat hex":"5E","Unicode dec":"128490","Unicode hex":"1F5EA"},{"Typeface name":"Webdings","Dingbat dec":"95","Dingbat hex":"5F","Unicode dec":"128491","Unicode hex":"1F5EB"},{"Typeface name":"Webdings","Dingbat dec":"96","Dingbat hex":"60","Unicode dec":"11156","Unicode hex":"2B94"},{"Typeface name":"Webdings","Dingbat dec":"97","Dingbat hex":"61","Unicode dec":"10004","Unicode hex":"2714"},{"Typeface name":"Webdings","Dingbat dec":"98","Dingbat hex":"62","Unicode dec":"128690","Unicode hex":"1F6B2"},{"Typeface name":"Webdings","Dingbat dec":"99","Dingbat hex":"63","Unicode dec":"11036","Unicode hex":"2B1C"},{"Typeface name":"Webdings","Dingbat dec":"100","Dingbat hex":"64","Unicode dec":"128737","Unicode hex":"1F6E1"},{"Typeface name":"Webdings","Dingbat dec":"101","Dingbat hex":"65","Unicode dec":"128230","Unicode hex":"1F4E6"},{"Typeface name":"Webdings","Dingbat dec":"102","Dingbat hex":"66","Unicode dec":"128753","Unicode hex":"1F6F1"},{"Typeface name":"Webdings","Dingbat dec":"103","Dingbat hex":"67","Unicode dec":"11035","Unicode hex":"2B1B"},{"Typeface name":"Webdings","Dingbat dec":"104","Dingbat hex":"68","Unicode dec":"128657","Unicode hex":"1F691"},{"Typeface name":"Webdings","Dingbat dec":"105","Dingbat hex":"69","Unicode dec":"128712","Unicode hex":"1F6C8"},{"Typeface name":"Webdings","Dingbat dec":"106","Dingbat hex":"6A","Unicode dec":"128745","Unicode hex":"1F6E9"},{"Typeface name":"Webdings","Dingbat dec":"107","Dingbat hex":"6B","Unicode dec":"128752","Unicode hex":"1F6F0"},{"Typeface name":"Webdings","Dingbat dec":"108","Dingbat hex":"6C","Unicode dec":"128968","Unicode hex":"1F7C8"},{"Typeface name":"Webdings","Dingbat dec":"109","Dingbat hex":"6D","Unicode dec":"128372","Unicode hex":"1F574"},{"Typeface name":"Webdings","Dingbat dec":"110","Dingbat hex":"6E","Unicode dec":"11044","Unicode hex":"2B24"},{"Typeface name":"Webdings","Dingbat dec":"111","Dingbat hex":"6F","Unicode dec":"128741","Unicode hex":"1F6E5"},{"Typeface name":"Webdings","Dingbat dec":"112","Dingbat hex":"70","Unicode dec":"128660","Unicode hex":"1F694"},{"Typeface name":"Webdings","Dingbat dec":"113","Dingbat hex":"71","Unicode dec":"128472","Unicode hex":"1F5D8"},{"Typeface name":"Webdings","Dingbat dec":"114","Dingbat hex":"72","Unicode dec":"128473","Unicode hex":"1F5D9"},{"Typeface name":"Webdings","Dingbat dec":"115","Dingbat hex":"73","Unicode dec":"10067","Unicode hex":"2753"},{"Typeface name":"Webdings","Dingbat dec":"116","Dingbat hex":"74","Unicode dec":"128754","Unicode hex":"1F6F2"},{"Typeface name":"Webdings","Dingbat dec":"117","Dingbat hex":"75","Unicode dec":"128647","Unicode hex":"1F687"},{"Typeface name":"Webdings","Dingbat dec":"118","Dingbat hex":"76","Unicode dec":"128653","Unicode hex":"1F68D"},{"Typeface name":"Webdings","Dingbat dec":"119","Dingbat hex":"77","Unicode dec":"9971","Unicode hex":"26F3"},{"Typeface name":"Webdings","Dingbat dec":"120","Dingbat hex":"78","Unicode dec":"10680","Unicode hex":"29B8"},{"Typeface name":"Webdings","Dingbat dec":"121","Dingbat hex":"79","Unicode dec":"8854","Unicode hex":"2296"},{"Typeface name":"Webdings","Dingbat dec":"122","Dingbat hex":"7A","Unicode dec":"128685","Unicode hex":"1F6AD"},{"Typeface name":"Webdings","Dingbat dec":"123","Dingbat hex":"7B","Unicode dec":"128494","Unicode hex":"1F5EE"},{"Typeface name":"Webdings","Dingbat dec":"124","Dingbat hex":"7C","Unicode dec":"9168","Unicode hex":"23D0"},{"Typeface name":"Webdings","Dingbat dec":"125","Dingbat hex":"7D","Unicode dec":"128495","Unicode hex":"1F5EF"},{"Typeface name":"Webdings","Dingbat dec":"126","Dingbat hex":"7E","Unicode dec":"128498","Unicode hex":"1F5F2"},{"Typeface name":"Webdings","Dingbat dec":"128","Dingbat hex":"80","Unicode dec":"128697","Unicode hex":"1F6B9"},{"Typeface name":"Webdings","Dingbat dec":"129","Dingbat hex":"81","Unicode dec":"128698","Unicode hex":"1F6BA"},{"Typeface name":"Webdings","Dingbat dec":"130","Dingbat hex":"82","Unicode dec":"128713","Unicode hex":"1F6C9"},{"Typeface name":"Webdings","Dingbat dec":"131","Dingbat hex":"83","Unicode dec":"128714","Unicode hex":"1F6CA"},{"Typeface name":"Webdings","Dingbat dec":"132","Dingbat hex":"84","Unicode dec":"128700","Unicode hex":"1F6BC"},{"Typeface name":"Webdings","Dingbat dec":"133","Dingbat hex":"85","Unicode dec":"128125","Unicode hex":"1F47D"},{"Typeface name":"Webdings","Dingbat dec":"134","Dingbat hex":"86","Unicode dec":"127947","Unicode hex":"1F3CB"},{"Typeface name":"Webdings","Dingbat dec":"135","Dingbat hex":"87","Unicode dec":"9975","Unicode hex":"26F7"},{"Typeface name":"Webdings","Dingbat dec":"136","Dingbat hex":"88","Unicode dec":"127938","Unicode hex":"1F3C2"},{"Typeface name":"Webdings","Dingbat dec":"137","Dingbat hex":"89","Unicode dec":"127948","Unicode hex":"1F3CC"},{"Typeface name":"Webdings","Dingbat dec":"138","Dingbat hex":"8A","Unicode dec":"127946","Unicode hex":"1F3CA"},{"Typeface name":"Webdings","Dingbat dec":"139","Dingbat hex":"8B","Unicode dec":"127940","Unicode hex":"1F3C4"},{"Typeface name":"Webdings","Dingbat dec":"140","Dingbat hex":"8C","Unicode dec":"127949","Unicode hex":"1F3CD"},{"Typeface name":"Webdings","Dingbat dec":"141","Dingbat hex":"8D","Unicode dec":"127950","Unicode hex":"1F3CE"},{"Typeface name":"Webdings","Dingbat dec":"142","Dingbat hex":"8E","Unicode dec":"128664","Unicode hex":"1F698"},{"Typeface name":"Webdings","Dingbat dec":"143","Dingbat hex":"8F","Unicode dec":"128480","Unicode hex":"1F5E0"},{"Typeface name":"Webdings","Dingbat dec":"144","Dingbat hex":"90","Unicode dec":"128738","Unicode hex":"1F6E2"},{"Typeface name":"Webdings","Dingbat dec":"145","Dingbat hex":"91","Unicode dec":"128176","Unicode hex":"1F4B0"},{"Typeface name":"Webdings","Dingbat dec":"146","Dingbat hex":"92","Unicode dec":"127991","Unicode hex":"1F3F7"},{"Typeface name":"Webdings","Dingbat dec":"147","Dingbat hex":"93","Unicode dec":"128179","Unicode hex":"1F4B3"},{"Typeface name":"Webdings","Dingbat dec":"148","Dingbat hex":"94","Unicode dec":"128106","Unicode hex":"1F46A"},{"Typeface name":"Webdings","Dingbat dec":"149","Dingbat hex":"95","Unicode dec":"128481","Unicode hex":"1F5E1"},{"Typeface name":"Webdings","Dingbat dec":"150","Dingbat hex":"96","Unicode dec":"128482","Unicode hex":"1F5E2"},{"Typeface name":"Webdings","Dingbat dec":"151","Dingbat hex":"97","Unicode dec":"128483","Unicode hex":"1F5E3"},{"Typeface name":"Webdings","Dingbat dec":"152","Dingbat hex":"98","Unicode dec":"10031","Unicode hex":"272F"},{"Typeface name":"Webdings","Dingbat dec":"153","Dingbat hex":"99","Unicode dec":"128388","Unicode hex":"1F584"},{"Typeface name":"Webdings","Dingbat dec":"154","Dingbat hex":"9A","Unicode dec":"128389","Unicode hex":"1F585"},{"Typeface name":"Webdings","Dingbat dec":"155","Dingbat hex":"9B","Unicode dec":"128387","Unicode hex":"1F583"},{"Typeface name":"Webdings","Dingbat dec":"156","Dingbat hex":"9C","Unicode dec":"128390","Unicode hex":"1F586"},{"Typeface name":"Webdings","Dingbat dec":"157","Dingbat hex":"9D","Unicode dec":"128441","Unicode hex":"1F5B9"},{"Typeface name":"Webdings","Dingbat dec":"158","Dingbat hex":"9E","Unicode dec":"128442","Unicode hex":"1F5BA"},{"Typeface name":"Webdings","Dingbat dec":"159","Dingbat hex":"9F","Unicode dec":"128443","Unicode hex":"1F5BB"},{"Typeface name":"Webdings","Dingbat dec":"160","Dingbat hex":"A0","Unicode dec":"128373","Unicode hex":"1F575"},{"Typeface name":"Webdings","Dingbat dec":"161","Dingbat hex":"A1","Unicode dec":"128368","Unicode hex":"1F570"},{"Typeface name":"Webdings","Dingbat dec":"162","Dingbat hex":"A2","Unicode dec":"128445","Unicode hex":"1F5BD"},{"Typeface name":"Webdings","Dingbat dec":"163","Dingbat hex":"A3","Unicode dec":"128446","Unicode hex":"1F5BE"},{"Typeface name":"Webdings","Dingbat dec":"164","Dingbat hex":"A4","Unicode dec":"128203","Unicode hex":"1F4CB"},{"Typeface name":"Webdings","Dingbat dec":"165","Dingbat hex":"A5","Unicode dec":"128466","Unicode hex":"1F5D2"},{"Typeface name":"Webdings","Dingbat dec":"166","Dingbat hex":"A6","Unicode dec":"128467","Unicode hex":"1F5D3"},{"Typeface name":"Webdings","Dingbat dec":"167","Dingbat hex":"A7","Unicode dec":"128366","Unicode hex":"1F56E"},{"Typeface name":"Webdings","Dingbat dec":"168","Dingbat hex":"A8","Unicode dec":"128218","Unicode hex":"1F4DA"},{"Typeface name":"Webdings","Dingbat dec":"169","Dingbat hex":"A9","Unicode dec":"128478","Unicode hex":"1F5DE"},{"Typeface name":"Webdings","Dingbat dec":"170","Dingbat hex":"AA","Unicode dec":"128479","Unicode hex":"1F5DF"},{"Typeface name":"Webdings","Dingbat dec":"171","Dingbat hex":"AB","Unicode dec":"128451","Unicode hex":"1F5C3"},{"Typeface name":"Webdings","Dingbat dec":"172","Dingbat hex":"AC","Unicode dec":"128450","Unicode hex":"1F5C2"},{"Typeface name":"Webdings","Dingbat dec":"173","Dingbat hex":"AD","Unicode dec":"128444","Unicode hex":"1F5BC"},{"Typeface name":"Webdings","Dingbat dec":"174","Dingbat hex":"AE","Unicode dec":"127917","Unicode hex":"1F3AD"},{"Typeface name":"Webdings","Dingbat dec":"175","Dingbat hex":"AF","Unicode dec":"127900","Unicode hex":"1F39C"},{"Typeface name":"Webdings","Dingbat dec":"176","Dingbat hex":"B0","Unicode dec":"127896","Unicode hex":"1F398"},{"Typeface name":"Webdings","Dingbat dec":"177","Dingbat hex":"B1","Unicode dec":"127897","Unicode hex":"1F399"},{"Typeface name":"Webdings","Dingbat dec":"178","Dingbat hex":"B2","Unicode dec":"127911","Unicode hex":"1F3A7"},{"Typeface name":"Webdings","Dingbat dec":"179","Dingbat hex":"B3","Unicode dec":"128191","Unicode hex":"1F4BF"},{"Typeface name":"Webdings","Dingbat dec":"180","Dingbat hex":"B4","Unicode dec":"127902","Unicode hex":"1F39E"},{"Typeface name":"Webdings","Dingbat dec":"181","Dingbat hex":"B5","Unicode dec":"128247","Unicode hex":"1F4F7"},{"Typeface name":"Webdings","Dingbat dec":"182","Dingbat hex":"B6","Unicode dec":"127903","Unicode hex":"1F39F"},{"Typeface name":"Webdings","Dingbat dec":"183","Dingbat hex":"B7","Unicode dec":"127916","Unicode hex":"1F3AC"},{"Typeface name":"Webdings","Dingbat dec":"184","Dingbat hex":"B8","Unicode dec":"128253","Unicode hex":"1F4FD"},{"Typeface name":"Webdings","Dingbat dec":"185","Dingbat hex":"B9","Unicode dec":"128249","Unicode hex":"1F4F9"},{"Typeface name":"Webdings","Dingbat dec":"186","Dingbat hex":"BA","Unicode dec":"128254","Unicode hex":"1F4FE"},{"Typeface name":"Webdings","Dingbat dec":"187","Dingbat hex":"BB","Unicode dec":"128251","Unicode hex":"1F4FB"},{"Typeface name":"Webdings","Dingbat dec":"188","Dingbat hex":"BC","Unicode dec":"127898","Unicode hex":"1F39A"},{"Typeface name":"Webdings","Dingbat dec":"189","Dingbat hex":"BD","Unicode dec":"127899","Unicode hex":"1F39B"},{"Typeface name":"Webdings","Dingbat dec":"190","Dingbat hex":"BE","Unicode dec":"128250","Unicode hex":"1F4FA"},{"Typeface name":"Webdings","Dingbat dec":"191","Dingbat hex":"BF","Unicode dec":"128187","Unicode hex":"1F4BB"},{"Typeface name":"Webdings","Dingbat dec":"192","Dingbat hex":"C0","Unicode dec":"128421","Unicode hex":"1F5A5"},{"Typeface name":"Webdings","Dingbat dec":"193","Dingbat hex":"C1","Unicode dec":"128422","Unicode hex":"1F5A6"},{"Typeface name":"Webdings","Dingbat dec":"194","Dingbat hex":"C2","Unicode dec":"128423","Unicode hex":"1F5A7"},{"Typeface name":"Webdings","Dingbat dec":"195","Dingbat hex":"C3","Unicode dec":"128377","Unicode hex":"1F579"},{"Typeface name":"Webdings","Dingbat dec":"196","Dingbat hex":"C4","Unicode dec":"127918","Unicode hex":"1F3AE"},{"Typeface name":"Webdings","Dingbat dec":"197","Dingbat hex":"C5","Unicode dec":"128379","Unicode hex":"1F57B"},{"Typeface name":"Webdings","Dingbat dec":"198","Dingbat hex":"C6","Unicode dec":"128380","Unicode hex":"1F57C"},{"Typeface name":"Webdings","Dingbat dec":"199","Dingbat hex":"C7","Unicode dec":"128223","Unicode hex":"1F4DF"},{"Typeface name":"Webdings","Dingbat dec":"200","Dingbat hex":"C8","Unicode dec":"128385","Unicode hex":"1F581"},{"Typeface name":"Webdings","Dingbat dec":"201","Dingbat hex":"C9","Unicode dec":"128384","Unicode hex":"1F580"},{"Typeface name":"Webdings","Dingbat dec":"202","Dingbat hex":"CA","Unicode dec":"128424","Unicode hex":"1F5A8"},{"Typeface name":"Webdings","Dingbat dec":"203","Dingbat hex":"CB","Unicode dec":"128425","Unicode hex":"1F5A9"},{"Typeface name":"Webdings","Dingbat dec":"204","Dingbat hex":"CC","Unicode dec":"128447","Unicode hex":"1F5BF"},{"Typeface name":"Webdings","Dingbat dec":"205","Dingbat hex":"CD","Unicode dec":"128426","Unicode hex":"1F5AA"},{"Typeface name":"Webdings","Dingbat dec":"206","Dingbat hex":"CE","Unicode dec":"128476","Unicode hex":"1F5DC"},{"Typeface name":"Webdings","Dingbat dec":"207","Dingbat hex":"CF","Unicode dec":"128274","Unicode hex":"1F512"},{"Typeface name":"Webdings","Dingbat dec":"208","Dingbat hex":"D0","Unicode dec":"128275","Unicode hex":"1F513"},{"Typeface name":"Webdings","Dingbat dec":"209","Dingbat hex":"D1","Unicode dec":"128477","Unicode hex":"1F5DD"},{"Typeface name":"Webdings","Dingbat dec":"210","Dingbat hex":"D2","Unicode dec":"128229","Unicode hex":"1F4E5"},{"Typeface name":"Webdings","Dingbat dec":"211","Dingbat hex":"D3","Unicode dec":"128228","Unicode hex":"1F4E4"},{"Typeface name":"Webdings","Dingbat dec":"212","Dingbat hex":"D4","Unicode dec":"128371","Unicode hex":"1F573"},{"Typeface name":"Webdings","Dingbat dec":"213","Dingbat hex":"D5","Unicode dec":"127779","Unicode hex":"1F323"},{"Typeface name":"Webdings","Dingbat dec":"214","Dingbat hex":"D6","Unicode dec":"127780","Unicode hex":"1F324"},{"Typeface name":"Webdings","Dingbat dec":"215","Dingbat hex":"D7","Unicode dec":"127781","Unicode hex":"1F325"},{"Typeface name":"Webdings","Dingbat dec":"216","Dingbat hex":"D8","Unicode dec":"127782","Unicode hex":"1F326"},{"Typeface name":"Webdings","Dingbat dec":"217","Dingbat hex":"D9","Unicode dec":"9729","Unicode hex":"2601"},{"Typeface name":"Webdings","Dingbat dec":"218","Dingbat hex":"DA","Unicode dec":"127784","Unicode hex":"1F328"},{"Typeface name":"Webdings","Dingbat dec":"219","Dingbat hex":"DB","Unicode dec":"127783","Unicode hex":"1F327"},{"Typeface name":"Webdings","Dingbat dec":"220","Dingbat hex":"DC","Unicode dec":"127785","Unicode hex":"1F329"},{"Typeface name":"Webdings","Dingbat dec":"221","Dingbat hex":"DD","Unicode dec":"127786","Unicode hex":"1F32A"},{"Typeface name":"Webdings","Dingbat dec":"222","Dingbat hex":"DE","Unicode dec":"127788","Unicode hex":"1F32C"},{"Typeface name":"Webdings","Dingbat dec":"223","Dingbat hex":"DF","Unicode dec":"127787","Unicode hex":"1F32B"},{"Typeface name":"Webdings","Dingbat dec":"224","Dingbat hex":"E0","Unicode dec":"127772","Unicode hex":"1F31C"},{"Typeface name":"Webdings","Dingbat dec":"225","Dingbat hex":"E1","Unicode dec":"127777","Unicode hex":"1F321"},{"Typeface name":"Webdings","Dingbat dec":"226","Dingbat hex":"E2","Unicode dec":"128715","Unicode hex":"1F6CB"},{"Typeface name":"Webdings","Dingbat dec":"227","Dingbat hex":"E3","Unicode dec":"128719","Unicode hex":"1F6CF"},{"Typeface name":"Webdings","Dingbat dec":"228","Dingbat hex":"E4","Unicode dec":"127869","Unicode hex":"1F37D"},{"Typeface name":"Webdings","Dingbat dec":"229","Dingbat hex":"E5","Unicode dec":"127864","Unicode hex":"1F378"},{"Typeface name":"Webdings","Dingbat dec":"230","Dingbat hex":"E6","Unicode dec":"128718","Unicode hex":"1F6CE"},{"Typeface name":"Webdings","Dingbat dec":"231","Dingbat hex":"E7","Unicode dec":"128717","Unicode hex":"1F6CD"},{"Typeface name":"Webdings","Dingbat dec":"232","Dingbat hex":"E8","Unicode dec":"9413","Unicode hex":"24C5"},{"Typeface name":"Webdings","Dingbat dec":"233","Dingbat hex":"E9","Unicode dec":"9855","Unicode hex":"267F"},{"Typeface name":"Webdings","Dingbat dec":"234","Dingbat hex":"EA","Unicode dec":"128710","Unicode hex":"1F6C6"},{"Typeface name":"Webdings","Dingbat dec":"235","Dingbat hex":"EB","Unicode dec":"128392","Unicode hex":"1F588"},{"Typeface name":"Webdings","Dingbat dec":"236","Dingbat hex":"EC","Unicode dec":"127891","Unicode hex":"1F393"},{"Typeface name":"Webdings","Dingbat dec":"237","Dingbat hex":"ED","Unicode dec":"128484","Unicode hex":"1F5E4"},{"Typeface name":"Webdings","Dingbat dec":"238","Dingbat hex":"EE","Unicode dec":"128485","Unicode hex":"1F5E5"},{"Typeface name":"Webdings","Dingbat dec":"239","Dingbat hex":"EF","Unicode dec":"128486","Unicode hex":"1F5E6"},{"Typeface name":"Webdings","Dingbat dec":"240","Dingbat hex":"F0","Unicode dec":"128487","Unicode hex":"1F5E7"},{"Typeface name":"Webdings","Dingbat dec":"241","Dingbat hex":"F1","Unicode dec":"128746","Unicode hex":"1F6EA"},{"Typeface name":"Webdings","Dingbat dec":"242","Dingbat hex":"F2","Unicode dec":"128063","Unicode hex":"1F43F"},{"Typeface name":"Webdings","Dingbat dec":"243","Dingbat hex":"F3","Unicode dec":"128038","Unicode hex":"1F426"},{"Typeface name":"Webdings","Dingbat dec":"244","Dingbat hex":"F4","Unicode dec":"128031","Unicode hex":"1F41F"},{"Typeface name":"Webdings","Dingbat dec":"245","Dingbat hex":"F5","Unicode dec":"128021","Unicode hex":"1F415"},{"Typeface name":"Webdings","Dingbat dec":"246","Dingbat hex":"F6","Unicode dec":"128008","Unicode hex":"1F408"},{"Typeface name":"Webdings","Dingbat dec":"247","Dingbat hex":"F7","Unicode dec":"128620","Unicode hex":"1F66C"},{"Typeface name":"Webdings","Dingbat dec":"248","Dingbat hex":"F8","Unicode dec":"128622","Unicode hex":"1F66E"},{"Typeface name":"Webdings","Dingbat dec":"249","Dingbat hex":"F9","Unicode dec":"128621","Unicode hex":"1F66D"},{"Typeface name":"Webdings","Dingbat dec":"250","Dingbat hex":"FA","Unicode dec":"128623","Unicode hex":"1F66F"},{"Typeface name":"Webdings","Dingbat dec":"251","Dingbat hex":"FB","Unicode dec":"128506","Unicode hex":"1F5FA"},{"Typeface name":"Webdings","Dingbat dec":"252","Dingbat hex":"FC","Unicode dec":"127757","Unicode hex":"1F30D"},{"Typeface name":"Webdings","Dingbat dec":"253","Dingbat hex":"FD","Unicode dec":"127759","Unicode hex":"1F30F"},{"Typeface name":"Webdings","Dingbat dec":"254","Dingbat hex":"FE","Unicode dec":"127758","Unicode hex":"1F30E"},{"Typeface name":"Webdings","Dingbat dec":"255","Dingbat hex":"FF","Unicode dec":"128330","Unicode hex":"1F54A"},{"Typeface name":"Wingdings","Dingbat dec":"32","Dingbat hex":"20","Unicode dec":"32","Unicode hex":"20"},{"Typeface name":"Wingdings","Dingbat dec":"33","Dingbat hex":"21","Unicode dec":"128393","Unicode hex":"1F589"},{"Typeface name":"Wingdings","Dingbat dec":"34","Dingbat hex":"22","Unicode dec":"9986","Unicode hex":"2702"},{"Typeface name":"Wingdings","Dingbat dec":"35","Dingbat hex":"23","Unicode dec":"9985","Unicode hex":"2701"},{"Typeface name":"Wingdings","Dingbat dec":"36","Dingbat hex":"24","Unicode dec":"128083","Unicode hex":"1F453"},{"Typeface name":"Wingdings","Dingbat dec":"37","Dingbat hex":"25","Unicode dec":"128365","Unicode hex":"1F56D"},{"Typeface name":"Wingdings","Dingbat dec":"38","Dingbat hex":"26","Unicode dec":"128366","Unicode hex":"1F56E"},{"Typeface name":"Wingdings","Dingbat dec":"39","Dingbat hex":"27","Unicode dec":"128367","Unicode hex":"1F56F"},{"Typeface name":"Wingdings","Dingbat dec":"40","Dingbat hex":"28","Unicode dec":"128383","Unicode hex":"1F57F"},{"Typeface name":"Wingdings","Dingbat dec":"41","Dingbat hex":"29","Unicode dec":"9990","Unicode hex":"2706"},{"Typeface name":"Wingdings","Dingbat dec":"42","Dingbat hex":"2A","Unicode dec":"128386","Unicode hex":"1F582"},{"Typeface name":"Wingdings","Dingbat dec":"43","Dingbat hex":"2B","Unicode dec":"128387","Unicode hex":"1F583"},{"Typeface name":"Wingdings","Dingbat dec":"44","Dingbat hex":"2C","Unicode dec":"128234","Unicode hex":"1F4EA"},{"Typeface name":"Wingdings","Dingbat dec":"45","Dingbat hex":"2D","Unicode dec":"128235","Unicode hex":"1F4EB"},{"Typeface name":"Wingdings","Dingbat dec":"46","Dingbat hex":"2E","Unicode dec":"128236","Unicode hex":"1F4EC"},{"Typeface name":"Wingdings","Dingbat dec":"47","Dingbat hex":"2F","Unicode dec":"128237","Unicode hex":"1F4ED"},{"Typeface name":"Wingdings","Dingbat dec":"48","Dingbat hex":"30","Unicode dec":"128448","Unicode hex":"1F5C0"},{"Typeface name":"Wingdings","Dingbat dec":"49","Dingbat hex":"31","Unicode dec":"128449","Unicode hex":"1F5C1"},{"Typeface name":"Wingdings","Dingbat dec":"50","Dingbat hex":"32","Unicode dec":"128462","Unicode hex":"1F5CE"},{"Typeface name":"Wingdings","Dingbat dec":"51","Dingbat hex":"33","Unicode dec":"128463","Unicode hex":"1F5CF"},{"Typeface name":"Wingdings","Dingbat dec":"52","Dingbat hex":"34","Unicode dec":"128464","Unicode hex":"1F5D0"},{"Typeface name":"Wingdings","Dingbat dec":"53","Dingbat hex":"35","Unicode dec":"128452","Unicode hex":"1F5C4"},{"Typeface name":"Wingdings","Dingbat dec":"54","Dingbat hex":"36","Unicode dec":"8987","Unicode hex":"231B"},{"Typeface name":"Wingdings","Dingbat dec":"55","Dingbat hex":"37","Unicode dec":"128430","Unicode hex":"1F5AE"},{"Typeface name":"Wingdings","Dingbat dec":"56","Dingbat hex":"38","Unicode dec":"128432","Unicode hex":"1F5B0"},{"Typeface name":"Wingdings","Dingbat dec":"57","Dingbat hex":"39","Unicode dec":"128434","Unicode hex":"1F5B2"},{"Typeface name":"Wingdings","Dingbat dec":"58","Dingbat hex":"3A","Unicode dec":"128435","Unicode hex":"1F5B3"},{"Typeface name":"Wingdings","Dingbat dec":"59","Dingbat hex":"3B","Unicode dec":"128436","Unicode hex":"1F5B4"},{"Typeface name":"Wingdings","Dingbat dec":"60","Dingbat hex":"3C","Unicode dec":"128427","Unicode hex":"1F5AB"},{"Typeface name":"Wingdings","Dingbat dec":"61","Dingbat hex":"3D","Unicode dec":"128428","Unicode hex":"1F5AC"},{"Typeface name":"Wingdings","Dingbat dec":"62","Dingbat hex":"3E","Unicode dec":"9991","Unicode hex":"2707"},{"Typeface name":"Wingdings","Dingbat dec":"63","Dingbat hex":"3F","Unicode dec":"9997","Unicode hex":"270D"},{"Typeface name":"Wingdings","Dingbat dec":"64","Dingbat hex":"40","Unicode dec":"128398","Unicode hex":"1F58E"},{"Typeface name":"Wingdings","Dingbat dec":"65","Dingbat hex":"41","Unicode dec":"9996","Unicode hex":"270C"},{"Typeface name":"Wingdings","Dingbat dec":"66","Dingbat hex":"42","Unicode dec":"128399","Unicode hex":"1F58F"},{"Typeface name":"Wingdings","Dingbat dec":"67","Dingbat hex":"43","Unicode dec":"128077","Unicode hex":"1F44D"},{"Typeface name":"Wingdings","Dingbat dec":"68","Dingbat hex":"44","Unicode dec":"128078","Unicode hex":"1F44E"},{"Typeface name":"Wingdings","Dingbat dec":"69","Dingbat hex":"45","Unicode dec":"9756","Unicode hex":"261C"},{"Typeface name":"Wingdings","Dingbat dec":"70","Dingbat hex":"46","Unicode dec":"9758","Unicode hex":"261E"},{"Typeface name":"Wingdings","Dingbat dec":"71","Dingbat hex":"47","Unicode dec":"9757","Unicode hex":"261D"},{"Typeface name":"Wingdings","Dingbat dec":"72","Dingbat hex":"48","Unicode dec":"9759","Unicode hex":"261F"},{"Typeface name":"Wingdings","Dingbat dec":"73","Dingbat hex":"49","Unicode dec":"128400","Unicode hex":"1F590"},{"Typeface name":"Wingdings","Dingbat dec":"74","Dingbat hex":"4A","Unicode dec":"9786","Unicode hex":"263A"},{"Typeface name":"Wingdings","Dingbat dec":"75","Dingbat hex":"4B","Unicode dec":"128528","Unicode hex":"1F610"},{"Typeface name":"Wingdings","Dingbat dec":"76","Dingbat hex":"4C","Unicode dec":"9785","Unicode hex":"2639"},{"Typeface name":"Wingdings","Dingbat dec":"77","Dingbat hex":"4D","Unicode dec":"128163","Unicode hex":"1F4A3"},{"Typeface name":"Wingdings","Dingbat dec":"78","Dingbat hex":"4E","Unicode dec":"128369","Unicode hex":"1F571"},{"Typeface name":"Wingdings","Dingbat dec":"79","Dingbat hex":"4F","Unicode dec":"127987","Unicode hex":"1F3F3"},{"Typeface name":"Wingdings","Dingbat dec":"80","Dingbat hex":"50","Unicode dec":"127985","Unicode hex":"1F3F1"},{"Typeface name":"Wingdings","Dingbat dec":"81","Dingbat hex":"51","Unicode dec":"9992","Unicode hex":"2708"},{"Typeface name":"Wingdings","Dingbat dec":"82","Dingbat hex":"52","Unicode dec":"9788","Unicode hex":"263C"},{"Typeface name":"Wingdings","Dingbat dec":"83","Dingbat hex":"53","Unicode dec":"127778","Unicode hex":"1F322"},{"Typeface name":"Wingdings","Dingbat dec":"84","Dingbat hex":"54","Unicode dec":"10052","Unicode hex":"2744"},{"Typeface name":"Wingdings","Dingbat dec":"85","Dingbat hex":"55","Unicode dec":"128326","Unicode hex":"1F546"},{"Typeface name":"Wingdings","Dingbat dec":"86","Dingbat hex":"56","Unicode dec":"10014","Unicode hex":"271E"},{"Typeface name":"Wingdings","Dingbat dec":"87","Dingbat hex":"57","Unicode dec":"128328","Unicode hex":"1F548"},{"Typeface name":"Wingdings","Dingbat dec":"88","Dingbat hex":"58","Unicode dec":"10016","Unicode hex":"2720"},{"Typeface name":"Wingdings","Dingbat dec":"89","Dingbat hex":"59","Unicode dec":"10017","Unicode hex":"2721"},{"Typeface name":"Wingdings","Dingbat dec":"90","Dingbat hex":"5A","Unicode dec":"9770","Unicode hex":"262A"},{"Typeface name":"Wingdings","Dingbat dec":"91","Dingbat hex":"5B","Unicode dec":"9775","Unicode hex":"262F"},{"Typeface name":"Wingdings","Dingbat dec":"92","Dingbat hex":"5C","Unicode dec":"128329","Unicode hex":"1F549"},{"Typeface name":"Wingdings","Dingbat dec":"93","Dingbat hex":"5D","Unicode dec":"9784","Unicode hex":"2638"},{"Typeface name":"Wingdings","Dingbat dec":"94","Dingbat hex":"5E","Unicode dec":"9800","Unicode hex":"2648"},{"Typeface name":"Wingdings","Dingbat dec":"95","Dingbat hex":"5F","Unicode dec":"9801","Unicode hex":"2649"},{"Typeface name":"Wingdings","Dingbat dec":"96","Dingbat hex":"60","Unicode dec":"9802","Unicode hex":"264A"},{"Typeface name":"Wingdings","Dingbat dec":"97","Dingbat hex":"61","Unicode dec":"9803","Unicode hex":"264B"},{"Typeface name":"Wingdings","Dingbat dec":"98","Dingbat hex":"62","Unicode dec":"9804","Unicode hex":"264C"},{"Typeface name":"Wingdings","Dingbat dec":"99","Dingbat hex":"63","Unicode dec":"9805","Unicode hex":"264D"},{"Typeface name":"Wingdings","Dingbat dec":"100","Dingbat hex":"64","Unicode dec":"9806","Unicode hex":"264E"},{"Typeface name":"Wingdings","Dingbat dec":"101","Dingbat hex":"65","Unicode dec":"9807","Unicode hex":"264F"},{"Typeface name":"Wingdings","Dingbat dec":"102","Dingbat hex":"66","Unicode dec":"9808","Unicode hex":"2650"},{"Typeface name":"Wingdings","Dingbat dec":"103","Dingbat hex":"67","Unicode dec":"9809","Unicode hex":"2651"},{"Typeface name":"Wingdings","Dingbat dec":"104","Dingbat hex":"68","Unicode dec":"9810","Unicode hex":"2652"},{"Typeface name":"Wingdings","Dingbat dec":"105","Dingbat hex":"69","Unicode dec":"9811","Unicode hex":"2653"},{"Typeface name":"Wingdings","Dingbat dec":"106","Dingbat hex":"6A","Unicode dec":"128624","Unicode hex":"1F670"},{"Typeface name":"Wingdings","Dingbat dec":"107","Dingbat hex":"6B","Unicode dec":"128629","Unicode hex":"1F675"},{"Typeface name":"Wingdings","Dingbat dec":"108","Dingbat hex":"6C","Unicode dec":"9899","Unicode hex":"26AB"},{"Typeface name":"Wingdings","Dingbat dec":"109","Dingbat hex":"6D","Unicode dec":"128318","Unicode hex":"1F53E"},{"Typeface name":"Wingdings","Dingbat dec":"110","Dingbat hex":"6E","Unicode dec":"9724","Unicode hex":"25FC"},{"Typeface name":"Wingdings","Dingbat dec":"111","Dingbat hex":"6F","Unicode dec":"128911","Unicode hex":"1F78F"},{"Typeface name":"Wingdings","Dingbat dec":"112","Dingbat hex":"70","Unicode dec":"128912","Unicode hex":"1F790"},{"Typeface name":"Wingdings","Dingbat dec":"113","Dingbat hex":"71","Unicode dec":"10065","Unicode hex":"2751"},{"Typeface name":"Wingdings","Dingbat dec":"114","Dingbat hex":"72","Unicode dec":"10066","Unicode hex":"2752"},{"Typeface name":"Wingdings","Dingbat dec":"115","Dingbat hex":"73","Unicode dec":"128927","Unicode hex":"1F79F"},{"Typeface name":"Wingdings","Dingbat dec":"116","Dingbat hex":"74","Unicode dec":"10731","Unicode hex":"29EB"},{"Typeface name":"Wingdings","Dingbat dec":"117","Dingbat hex":"75","Unicode dec":"9670","Unicode hex":"25C6"},{"Typeface name":"Wingdings","Dingbat dec":"118","Dingbat hex":"76","Unicode dec":"10070","Unicode hex":"2756"},{"Typeface name":"Wingdings","Dingbat dec":"119","Dingbat hex":"77","Unicode dec":"11049","Unicode hex":"2B29"},{"Typeface name":"Wingdings","Dingbat dec":"120","Dingbat hex":"78","Unicode dec":"8999","Unicode hex":"2327"},{"Typeface name":"Wingdings","Dingbat dec":"121","Dingbat hex":"79","Unicode dec":"11193","Unicode hex":"2BB9"},{"Typeface name":"Wingdings","Dingbat dec":"122","Dingbat hex":"7A","Unicode dec":"8984","Unicode hex":"2318"},{"Typeface name":"Wingdings","Dingbat dec":"123","Dingbat hex":"7B","Unicode dec":"127989","Unicode hex":"1F3F5"},{"Typeface name":"Wingdings","Dingbat dec":"124","Dingbat hex":"7C","Unicode dec":"127990","Unicode hex":"1F3F6"},{"Typeface name":"Wingdings","Dingbat dec":"125","Dingbat hex":"7D","Unicode dec":"128630","Unicode hex":"1F676"},{"Typeface name":"Wingdings","Dingbat dec":"126","Dingbat hex":"7E","Unicode dec":"128631","Unicode hex":"1F677"},{"Typeface name":"Wingdings","Dingbat dec":"127","Dingbat hex":"7F","Unicode dec":"9647","Unicode hex":"25AF"},{"Typeface name":"Wingdings","Dingbat dec":"128","Dingbat hex":"80","Unicode dec":"127243","Unicode hex":"1F10B"},{"Typeface name":"Wingdings","Dingbat dec":"129","Dingbat hex":"81","Unicode dec":"10112","Unicode hex":"2780"},{"Typeface name":"Wingdings","Dingbat dec":"130","Dingbat hex":"82","Unicode dec":"10113","Unicode hex":"2781"},{"Typeface name":"Wingdings","Dingbat dec":"131","Dingbat hex":"83","Unicode dec":"10114","Unicode hex":"2782"},{"Typeface name":"Wingdings","Dingbat dec":"132","Dingbat hex":"84","Unicode dec":"10115","Unicode hex":"2783"},{"Typeface name":"Wingdings","Dingbat dec":"133","Dingbat hex":"85","Unicode dec":"10116","Unicode hex":"2784"},{"Typeface name":"Wingdings","Dingbat dec":"134","Dingbat hex":"86","Unicode dec":"10117","Unicode hex":"2785"},{"Typeface name":"Wingdings","Dingbat dec":"135","Dingbat hex":"87","Unicode dec":"10118","Unicode hex":"2786"},{"Typeface name":"Wingdings","Dingbat dec":"136","Dingbat hex":"88","Unicode dec":"10119","Unicode hex":"2787"},{"Typeface name":"Wingdings","Dingbat dec":"137","Dingbat hex":"89","Unicode dec":"10120","Unicode hex":"2788"},{"Typeface name":"Wingdings","Dingbat dec":"138","Dingbat hex":"8A","Unicode dec":"10121","Unicode hex":"2789"},{"Typeface name":"Wingdings","Dingbat dec":"139","Dingbat hex":"8B","Unicode dec":"127244","Unicode hex":"1F10C"},{"Typeface name":"Wingdings","Dingbat dec":"140","Dingbat hex":"8C","Unicode dec":"10122","Unicode hex":"278A"},{"Typeface name":"Wingdings","Dingbat dec":"141","Dingbat hex":"8D","Unicode dec":"10123","Unicode hex":"278B"},{"Typeface name":"Wingdings","Dingbat dec":"142","Dingbat hex":"8E","Unicode dec":"10124","Unicode hex":"278C"},{"Typeface name":"Wingdings","Dingbat dec":"143","Dingbat hex":"8F","Unicode dec":"10125","Unicode hex":"278D"},{"Typeface name":"Wingdings","Dingbat dec":"144","Dingbat hex":"90","Unicode dec":"10126","Unicode hex":"278E"},{"Typeface name":"Wingdings","Dingbat dec":"145","Dingbat hex":"91","Unicode dec":"10127","Unicode hex":"278F"},{"Typeface name":"Wingdings","Dingbat dec":"146","Dingbat hex":"92","Unicode dec":"10128","Unicode hex":"2790"},{"Typeface name":"Wingdings","Dingbat dec":"147","Dingbat hex":"93","Unicode dec":"10129","Unicode hex":"2791"},{"Typeface name":"Wingdings","Dingbat dec":"148","Dingbat hex":"94","Unicode dec":"10130","Unicode hex":"2792"},{"Typeface name":"Wingdings","Dingbat dec":"149","Dingbat hex":"95","Unicode dec":"10131","Unicode hex":"2793"},{"Typeface name":"Wingdings","Dingbat dec":"150","Dingbat hex":"96","Unicode dec":"128610","Unicode hex":"1F662"},{"Typeface name":"Wingdings","Dingbat dec":"151","Dingbat hex":"97","Unicode dec":"128608","Unicode hex":"1F660"},{"Typeface name":"Wingdings","Dingbat dec":"152","Dingbat hex":"98","Unicode dec":"128609","Unicode hex":"1F661"},{"Typeface name":"Wingdings","Dingbat dec":"153","Dingbat hex":"99","Unicode dec":"128611","Unicode hex":"1F663"},{"Typeface name":"Wingdings","Dingbat dec":"154","Dingbat hex":"9A","Unicode dec":"128606","Unicode hex":"1F65E"},{"Typeface name":"Wingdings","Dingbat dec":"155","Dingbat hex":"9B","Unicode dec":"128604","Unicode hex":"1F65C"},{"Typeface name":"Wingdings","Dingbat dec":"156","Dingbat hex":"9C","Unicode dec":"128605","Unicode hex":"1F65D"},{"Typeface name":"Wingdings","Dingbat dec":"157","Dingbat hex":"9D","Unicode dec":"128607","Unicode hex":"1F65F"},{"Typeface name":"Wingdings","Dingbat dec":"158","Dingbat hex":"9E","Unicode dec":"8729","Unicode hex":"2219"},{"Typeface name":"Wingdings","Dingbat dec":"159","Dingbat hex":"9F","Unicode dec":"8226","Unicode hex":"2022"},{"Typeface name":"Wingdings","Dingbat dec":"160","Dingbat hex":"A0","Unicode dec":"11037","Unicode hex":"2B1D"},{"Typeface name":"Wingdings","Dingbat dec":"161","Dingbat hex":"A1","Unicode dec":"11096","Unicode hex":"2B58"},{"Typeface name":"Wingdings","Dingbat dec":"162","Dingbat hex":"A2","Unicode dec":"128902","Unicode hex":"1F786"},{"Typeface name":"Wingdings","Dingbat dec":"163","Dingbat hex":"A3","Unicode dec":"128904","Unicode hex":"1F788"},{"Typeface name":"Wingdings","Dingbat dec":"164","Dingbat hex":"A4","Unicode dec":"128906","Unicode hex":"1F78A"},{"Typeface name":"Wingdings","Dingbat dec":"165","Dingbat hex":"A5","Unicode dec":"128907","Unicode hex":"1F78B"},{"Typeface name":"Wingdings","Dingbat dec":"166","Dingbat hex":"A6","Unicode dec":"128319","Unicode hex":"1F53F"},{"Typeface name":"Wingdings","Dingbat dec":"167","Dingbat hex":"A7","Unicode dec":"9642","Unicode hex":"25AA"},{"Typeface name":"Wingdings","Dingbat dec":"168","Dingbat hex":"A8","Unicode dec":"128910","Unicode hex":"1F78E"},{"Typeface name":"Wingdings","Dingbat dec":"169","Dingbat hex":"A9","Unicode dec":"128961","Unicode hex":"1F7C1"},{"Typeface name":"Wingdings","Dingbat dec":"170","Dingbat hex":"AA","Unicode dec":"128965","Unicode hex":"1F7C5"},{"Typeface name":"Wingdings","Dingbat dec":"171","Dingbat hex":"AB","Unicode dec":"9733","Unicode hex":"2605"},{"Typeface name":"Wingdings","Dingbat dec":"172","Dingbat hex":"AC","Unicode dec":"128971","Unicode hex":"1F7CB"},{"Typeface name":"Wingdings","Dingbat dec":"173","Dingbat hex":"AD","Unicode dec":"128975","Unicode hex":"1F7CF"},{"Typeface name":"Wingdings","Dingbat dec":"174","Dingbat hex":"AE","Unicode dec":"128979","Unicode hex":"1F7D3"},{"Typeface name":"Wingdings","Dingbat dec":"175","Dingbat hex":"AF","Unicode dec":"128977","Unicode hex":"1F7D1"},{"Typeface name":"Wingdings","Dingbat dec":"176","Dingbat hex":"B0","Unicode dec":"11216","Unicode hex":"2BD0"},{"Typeface name":"Wingdings","Dingbat dec":"177","Dingbat hex":"B1","Unicode dec":"8982","Unicode hex":"2316"},{"Typeface name":"Wingdings","Dingbat dec":"178","Dingbat hex":"B2","Unicode dec":"11214","Unicode hex":"2BCE"},{"Typeface name":"Wingdings","Dingbat dec":"179","Dingbat hex":"B3","Unicode dec":"11215","Unicode hex":"2BCF"},{"Typeface name":"Wingdings","Dingbat dec":"180","Dingbat hex":"B4","Unicode dec":"11217","Unicode hex":"2BD1"},{"Typeface name":"Wingdings","Dingbat dec":"181","Dingbat hex":"B5","Unicode dec":"10026","Unicode hex":"272A"},{"Typeface name":"Wingdings","Dingbat dec":"182","Dingbat hex":"B6","Unicode dec":"10032","Unicode hex":"2730"},{"Typeface name":"Wingdings","Dingbat dec":"183","Dingbat hex":"B7","Unicode dec":"128336","Unicode hex":"1F550"},{"Typeface name":"Wingdings","Dingbat dec":"184","Dingbat hex":"B8","Unicode dec":"128337","Unicode hex":"1F551"},{"Typeface name":"Wingdings","Dingbat dec":"185","Dingbat hex":"B9","Unicode dec":"128338","Unicode hex":"1F552"},{"Typeface name":"Wingdings","Dingbat dec":"186","Dingbat hex":"BA","Unicode dec":"128339","Unicode hex":"1F553"},{"Typeface name":"Wingdings","Dingbat dec":"187","Dingbat hex":"BB","Unicode dec":"128340","Unicode hex":"1F554"},{"Typeface name":"Wingdings","Dingbat dec":"188","Dingbat hex":"BC","Unicode dec":"128341","Unicode hex":"1F555"},{"Typeface name":"Wingdings","Dingbat dec":"189","Dingbat hex":"BD","Unicode dec":"128342","Unicode hex":"1F556"},{"Typeface name":"Wingdings","Dingbat dec":"190","Dingbat hex":"BE","Unicode dec":"128343","Unicode hex":"1F557"},{"Typeface name":"Wingdings","Dingbat dec":"191","Dingbat hex":"BF","Unicode dec":"128344","Unicode hex":"1F558"},{"Typeface name":"Wingdings","Dingbat dec":"192","Dingbat hex":"C0","Unicode dec":"128345","Unicode hex":"1F559"},{"Typeface name":"Wingdings","Dingbat dec":"193","Dingbat hex":"C1","Unicode dec":"128346","Unicode hex":"1F55A"},{"Typeface name":"Wingdings","Dingbat dec":"194","Dingbat hex":"C2","Unicode dec":"128347","Unicode hex":"1F55B"},{"Typeface name":"Wingdings","Dingbat dec":"195","Dingbat hex":"C3","Unicode dec":"11184","Unicode hex":"2BB0"},{"Typeface name":"Wingdings","Dingbat dec":"196","Dingbat hex":"C4","Unicode dec":"11185","Unicode hex":"2BB1"},{"Typeface name":"Wingdings","Dingbat dec":"197","Dingbat hex":"C5","Unicode dec":"11186","Unicode hex":"2BB2"},{"Typeface name":"Wingdings","Dingbat dec":"198","Dingbat hex":"C6","Unicode dec":"11187","Unicode hex":"2BB3"},{"Typeface name":"Wingdings","Dingbat dec":"199","Dingbat hex":"C7","Unicode dec":"11188","Unicode hex":"2BB4"},{"Typeface name":"Wingdings","Dingbat dec":"200","Dingbat hex":"C8","Unicode dec":"11189","Unicode hex":"2BB5"},{"Typeface name":"Wingdings","Dingbat dec":"201","Dingbat hex":"C9","Unicode dec":"11190","Unicode hex":"2BB6"},{"Typeface name":"Wingdings","Dingbat dec":"202","Dingbat hex":"CA","Unicode dec":"11191","Unicode hex":"2BB7"},{"Typeface name":"Wingdings","Dingbat dec":"203","Dingbat hex":"CB","Unicode dec":"128618","Unicode hex":"1F66A"},{"Typeface name":"Wingdings","Dingbat dec":"204","Dingbat hex":"CC","Unicode dec":"128619","Unicode hex":"1F66B"},{"Typeface name":"Wingdings","Dingbat dec":"205","Dingbat hex":"CD","Unicode dec":"128597","Unicode hex":"1F655"},{"Typeface name":"Wingdings","Dingbat dec":"206","Dingbat hex":"CE","Unicode dec":"128596","Unicode hex":"1F654"},{"Typeface name":"Wingdings","Dingbat dec":"207","Dingbat hex":"CF","Unicode dec":"128599","Unicode hex":"1F657"},{"Typeface name":"Wingdings","Dingbat dec":"208","Dingbat hex":"D0","Unicode dec":"128598","Unicode hex":"1F656"},{"Typeface name":"Wingdings","Dingbat dec":"209","Dingbat hex":"D1","Unicode dec":"128592","Unicode hex":"1F650"},{"Typeface name":"Wingdings","Dingbat dec":"210","Dingbat hex":"D2","Unicode dec":"128593","Unicode hex":"1F651"},{"Typeface name":"Wingdings","Dingbat dec":"211","Dingbat hex":"D3","Unicode dec":"128594","Unicode hex":"1F652"},{"Typeface name":"Wingdings","Dingbat dec":"212","Dingbat hex":"D4","Unicode dec":"128595","Unicode hex":"1F653"},{"Typeface name":"Wingdings","Dingbat dec":"213","Dingbat hex":"D5","Unicode dec":"9003","Unicode hex":"232B"},{"Typeface name":"Wingdings","Dingbat dec":"214","Dingbat hex":"D6","Unicode dec":"8998","Unicode hex":"2326"},{"Typeface name":"Wingdings","Dingbat dec":"215","Dingbat hex":"D7","Unicode dec":"11160","Unicode hex":"2B98"},{"Typeface name":"Wingdings","Dingbat dec":"216","Dingbat hex":"D8","Unicode dec":"11162","Unicode hex":"2B9A"},{"Typeface name":"Wingdings","Dingbat dec":"217","Dingbat hex":"D9","Unicode dec":"11161","Unicode hex":"2B99"},{"Typeface name":"Wingdings","Dingbat dec":"218","Dingbat hex":"DA","Unicode dec":"11163","Unicode hex":"2B9B"},{"Typeface name":"Wingdings","Dingbat dec":"219","Dingbat hex":"DB","Unicode dec":"11144","Unicode hex":"2B88"},{"Typeface name":"Wingdings","Dingbat dec":"220","Dingbat hex":"DC","Unicode dec":"11146","Unicode hex":"2B8A"},{"Typeface name":"Wingdings","Dingbat dec":"221","Dingbat hex":"DD","Unicode dec":"11145","Unicode hex":"2B89"},{"Typeface name":"Wingdings","Dingbat dec":"222","Dingbat hex":"DE","Unicode dec":"11147","Unicode hex":"2B8B"},{"Typeface name":"Wingdings","Dingbat dec":"223","Dingbat hex":"DF","Unicode dec":"129128","Unicode hex":"1F868"},{"Typeface name":"Wingdings","Dingbat dec":"224","Dingbat hex":"E0","Unicode dec":"129130","Unicode hex":"1F86A"},{"Typeface name":"Wingdings","Dingbat dec":"225","Dingbat hex":"E1","Unicode dec":"129129","Unicode hex":"1F869"},{"Typeface name":"Wingdings","Dingbat dec":"226","Dingbat hex":"E2","Unicode dec":"129131","Unicode hex":"1F86B"},{"Typeface name":"Wingdings","Dingbat dec":"227","Dingbat hex":"E3","Unicode dec":"129132","Unicode hex":"1F86C"},{"Typeface name":"Wingdings","Dingbat dec":"228","Dingbat hex":"E4","Unicode dec":"129133","Unicode hex":"1F86D"},{"Typeface name":"Wingdings","Dingbat dec":"229","Dingbat hex":"E5","Unicode dec":"129135","Unicode hex":"1F86F"},{"Typeface name":"Wingdings","Dingbat dec":"230","Dingbat hex":"E6","Unicode dec":"129134","Unicode hex":"1F86E"},{"Typeface name":"Wingdings","Dingbat dec":"231","Dingbat hex":"E7","Unicode dec":"129144","Unicode hex":"1F878"},{"Typeface name":"Wingdings","Dingbat dec":"232","Dingbat hex":"E8","Unicode dec":"129146","Unicode hex":"1F87A"},{"Typeface name":"Wingdings","Dingbat dec":"233","Dingbat hex":"E9","Unicode dec":"129145","Unicode hex":"1F879"},{"Typeface name":"Wingdings","Dingbat dec":"234","Dingbat hex":"EA","Unicode dec":"129147","Unicode hex":"1F87B"},{"Typeface name":"Wingdings","Dingbat dec":"235","Dingbat hex":"EB","Unicode dec":"129148","Unicode hex":"1F87C"},{"Typeface name":"Wingdings","Dingbat dec":"236","Dingbat hex":"EC","Unicode dec":"129149","Unicode hex":"1F87D"},{"Typeface name":"Wingdings","Dingbat dec":"237","Dingbat hex":"ED","Unicode dec":"129151","Unicode hex":"1F87F"},{"Typeface name":"Wingdings","Dingbat dec":"238","Dingbat hex":"EE","Unicode dec":"129150","Unicode hex":"1F87E"},{"Typeface name":"Wingdings","Dingbat dec":"239","Dingbat hex":"EF","Unicode dec":"8678","Unicode hex":"21E6"},{"Typeface name":"Wingdings","Dingbat dec":"240","Dingbat hex":"F0","Unicode dec":"8680","Unicode hex":"21E8"},{"Typeface name":"Wingdings","Dingbat dec":"241","Dingbat hex":"F1","Unicode dec":"8679","Unicode hex":"21E7"},{"Typeface name":"Wingdings","Dingbat dec":"242","Dingbat hex":"F2","Unicode dec":"8681","Unicode hex":"21E9"},{"Typeface name":"Wingdings","Dingbat dec":"243","Dingbat hex":"F3","Unicode dec":"11012","Unicode hex":"2B04"},{"Typeface name":"Wingdings","Dingbat dec":"244","Dingbat hex":"F4","Unicode dec":"8691","Unicode hex":"21F3"},{"Typeface name":"Wingdings","Dingbat dec":"245","Dingbat hex":"F5","Unicode dec":"11009","Unicode hex":"2B01"},{"Typeface name":"Wingdings","Dingbat dec":"246","Dingbat hex":"F6","Unicode dec":"11008","Unicode hex":"2B00"},{"Typeface name":"Wingdings","Dingbat dec":"247","Dingbat hex":"F7","Unicode dec":"11011","Unicode hex":"2B03"},{"Typeface name":"Wingdings","Dingbat dec":"248","Dingbat hex":"F8","Unicode dec":"11010","Unicode hex":"2B02"},{"Typeface name":"Wingdings","Dingbat dec":"249","Dingbat hex":"F9","Unicode dec":"129196","Unicode hex":"1F8AC"},{"Typeface name":"Wingdings","Dingbat dec":"250","Dingbat hex":"FA","Unicode dec":"129197","Unicode hex":"1F8AD"},{"Typeface name":"Wingdings","Dingbat dec":"251","Dingbat hex":"FB","Unicode dec":"128502","Unicode hex":"1F5F6"},{"Typeface name":"Wingdings","Dingbat dec":"252","Dingbat hex":"FC","Unicode dec":"10003","Unicode hex":"2713"},{"Typeface name":"Wingdings","Dingbat dec":"253","Dingbat hex":"FD","Unicode dec":"128503","Unicode hex":"1F5F7"},{"Typeface name":"Wingdings","Dingbat dec":"254","Dingbat hex":"FE","Unicode dec":"128505","Unicode hex":"1F5F9"},{"Typeface name":"Wingdings 2","Dingbat dec":"32","Dingbat hex":"20","Unicode dec":"32","Unicode hex":"20"},{"Typeface name":"Wingdings 2","Dingbat dec":"33","Dingbat hex":"21","Unicode dec":"128394","Unicode hex":"1F58A"},{"Typeface name":"Wingdings 2","Dingbat dec":"34","Dingbat hex":"22","Unicode dec":"128395","Unicode hex":"1F58B"},{"Typeface name":"Wingdings 2","Dingbat dec":"35","Dingbat hex":"23","Unicode dec":"128396","Unicode hex":"1F58C"},{"Typeface name":"Wingdings 2","Dingbat dec":"36","Dingbat hex":"24","Unicode dec":"128397","Unicode hex":"1F58D"},{"Typeface name":"Wingdings 2","Dingbat dec":"37","Dingbat hex":"25","Unicode dec":"9988","Unicode hex":"2704"},{"Typeface name":"Wingdings 2","Dingbat dec":"38","Dingbat hex":"26","Unicode dec":"9984","Unicode hex":"2700"},{"Typeface name":"Wingdings 2","Dingbat dec":"39","Dingbat hex":"27","Unicode dec":"128382","Unicode hex":"1F57E"},{"Typeface name":"Wingdings 2","Dingbat dec":"40","Dingbat hex":"28","Unicode dec":"128381","Unicode hex":"1F57D"},{"Typeface name":"Wingdings 2","Dingbat dec":"41","Dingbat hex":"29","Unicode dec":"128453","Unicode hex":"1F5C5"},{"Typeface name":"Wingdings 2","Dingbat dec":"42","Dingbat hex":"2A","Unicode dec":"128454","Unicode hex":"1F5C6"},{"Typeface name":"Wingdings 2","Dingbat dec":"43","Dingbat hex":"2B","Unicode dec":"128455","Unicode hex":"1F5C7"},{"Typeface name":"Wingdings 2","Dingbat dec":"44","Dingbat hex":"2C","Unicode dec":"128456","Unicode hex":"1F5C8"},{"Typeface name":"Wingdings 2","Dingbat dec":"45","Dingbat hex":"2D","Unicode dec":"128457","Unicode hex":"1F5C9"},{"Typeface name":"Wingdings 2","Dingbat dec":"46","Dingbat hex":"2E","Unicode dec":"128458","Unicode hex":"1F5CA"},{"Typeface name":"Wingdings 2","Dingbat dec":"47","Dingbat hex":"2F","Unicode dec":"128459","Unicode hex":"1F5CB"},{"Typeface name":"Wingdings 2","Dingbat dec":"48","Dingbat hex":"30","Unicode dec":"128460","Unicode hex":"1F5CC"},{"Typeface name":"Wingdings 2","Dingbat dec":"49","Dingbat hex":"31","Unicode dec":"128461","Unicode hex":"1F5CD"},{"Typeface name":"Wingdings 2","Dingbat dec":"50","Dingbat hex":"32","Unicode dec":"128203","Unicode hex":"1F4CB"},{"Typeface name":"Wingdings 2","Dingbat dec":"51","Dingbat hex":"33","Unicode dec":"128465","Unicode hex":"1F5D1"},{"Typeface name":"Wingdings 2","Dingbat dec":"52","Dingbat hex":"34","Unicode dec":"128468","Unicode hex":"1F5D4"},{"Typeface name":"Wingdings 2","Dingbat dec":"53","Dingbat hex":"35","Unicode dec":"128437","Unicode hex":"1F5B5"},{"Typeface name":"Wingdings 2","Dingbat dec":"54","Dingbat hex":"36","Unicode dec":"128438","Unicode hex":"1F5B6"},{"Typeface name":"Wingdings 2","Dingbat dec":"55","Dingbat hex":"37","Unicode dec":"128439","Unicode hex":"1F5B7"},{"Typeface name":"Wingdings 2","Dingbat dec":"56","Dingbat hex":"38","Unicode dec":"128440","Unicode hex":"1F5B8"},{"Typeface name":"Wingdings 2","Dingbat dec":"57","Dingbat hex":"39","Unicode dec":"128429","Unicode hex":"1F5AD"},{"Typeface name":"Wingdings 2","Dingbat dec":"58","Dingbat hex":"3A","Unicode dec":"128431","Unicode hex":"1F5AF"},{"Typeface name":"Wingdings 2","Dingbat dec":"59","Dingbat hex":"3B","Unicode dec":"128433","Unicode hex":"1F5B1"},{"Typeface name":"Wingdings 2","Dingbat dec":"60","Dingbat hex":"3C","Unicode dec":"128402","Unicode hex":"1F592"},{"Typeface name":"Wingdings 2","Dingbat dec":"61","Dingbat hex":"3D","Unicode dec":"128403","Unicode hex":"1F593"},{"Typeface name":"Wingdings 2","Dingbat dec":"62","Dingbat hex":"3E","Unicode dec":"128408","Unicode hex":"1F598"},{"Typeface name":"Wingdings 2","Dingbat dec":"63","Dingbat hex":"3F","Unicode dec":"128409","Unicode hex":"1F599"},{"Typeface name":"Wingdings 2","Dingbat dec":"64","Dingbat hex":"40","Unicode dec":"128410","Unicode hex":"1F59A"},{"Typeface name":"Wingdings 2","Dingbat dec":"65","Dingbat hex":"41","Unicode dec":"128411","Unicode hex":"1F59B"},{"Typeface name":"Wingdings 2","Dingbat dec":"66","Dingbat hex":"42","Unicode dec":"128072","Unicode hex":"1F448"},{"Typeface name":"Wingdings 2","Dingbat dec":"67","Dingbat hex":"43","Unicode dec":"128073","Unicode hex":"1F449"},{"Typeface name":"Wingdings 2","Dingbat dec":"68","Dingbat hex":"44","Unicode dec":"128412","Unicode hex":"1F59C"},{"Typeface name":"Wingdings 2","Dingbat dec":"69","Dingbat hex":"45","Unicode dec":"128413","Unicode hex":"1F59D"},{"Typeface name":"Wingdings 2","Dingbat dec":"70","Dingbat hex":"46","Unicode dec":"128414","Unicode hex":"1F59E"},{"Typeface name":"Wingdings 2","Dingbat dec":"71","Dingbat hex":"47","Unicode dec":"128415","Unicode hex":"1F59F"},{"Typeface name":"Wingdings 2","Dingbat dec":"72","Dingbat hex":"48","Unicode dec":"128416","Unicode hex":"1F5A0"},{"Typeface name":"Wingdings 2","Dingbat dec":"73","Dingbat hex":"49","Unicode dec":"128417","Unicode hex":"1F5A1"},{"Typeface name":"Wingdings 2","Dingbat dec":"74","Dingbat hex":"4A","Unicode dec":"128070","Unicode hex":"1F446"},{"Typeface name":"Wingdings 2","Dingbat dec":"75","Dingbat hex":"4B","Unicode dec":"128071","Unicode hex":"1F447"},{"Typeface name":"Wingdings 2","Dingbat dec":"76","Dingbat hex":"4C","Unicode dec":"128418","Unicode hex":"1F5A2"},{"Typeface name":"Wingdings 2","Dingbat dec":"77","Dingbat hex":"4D","Unicode dec":"128419","Unicode hex":"1F5A3"},{"Typeface name":"Wingdings 2","Dingbat dec":"78","Dingbat hex":"4E","Unicode dec":"128401","Unicode hex":"1F591"},{"Typeface name":"Wingdings 2","Dingbat dec":"79","Dingbat hex":"4F","Unicode dec":"128500","Unicode hex":"1F5F4"},{"Typeface name":"Wingdings 2","Dingbat dec":"80","Dingbat hex":"50","Unicode dec":"128504","Unicode hex":"1F5F8"},{"Typeface name":"Wingdings 2","Dingbat dec":"81","Dingbat hex":"51","Unicode dec":"128501","Unicode hex":"1F5F5"},{"Typeface name":"Wingdings 2","Dingbat dec":"82","Dingbat hex":"52","Unicode dec":"9745","Unicode hex":"2611"},{"Typeface name":"Wingdings 2","Dingbat dec":"83","Dingbat hex":"53","Unicode dec":"11197","Unicode hex":"2BBD"},{"Typeface name":"Wingdings 2","Dingbat dec":"84","Dingbat hex":"54","Unicode dec":"9746","Unicode hex":"2612"},{"Typeface name":"Wingdings 2","Dingbat dec":"85","Dingbat hex":"55","Unicode dec":"11198","Unicode hex":"2BBE"},{"Typeface name":"Wingdings 2","Dingbat dec":"86","Dingbat hex":"56","Unicode dec":"11199","Unicode hex":"2BBF"},{"Typeface name":"Wingdings 2","Dingbat dec":"87","Dingbat hex":"57","Unicode dec":"128711","Unicode hex":"1F6C7"},{"Typeface name":"Wingdings 2","Dingbat dec":"88","Dingbat hex":"58","Unicode dec":"10680","Unicode hex":"29B8"},{"Typeface name":"Wingdings 2","Dingbat dec":"89","Dingbat hex":"59","Unicode dec":"128625","Unicode hex":"1F671"},{"Typeface name":"Wingdings 2","Dingbat dec":"90","Dingbat hex":"5A","Unicode dec":"128628","Unicode hex":"1F674"},{"Typeface name":"Wingdings 2","Dingbat dec":"91","Dingbat hex":"5B","Unicode dec":"128626","Unicode hex":"1F672"},{"Typeface name":"Wingdings 2","Dingbat dec":"92","Dingbat hex":"5C","Unicode dec":"128627","Unicode hex":"1F673"},{"Typeface name":"Wingdings 2","Dingbat dec":"93","Dingbat hex":"5D","Unicode dec":"8253","Unicode hex":"203D"},{"Typeface name":"Wingdings 2","Dingbat dec":"94","Dingbat hex":"5E","Unicode dec":"128633","Unicode hex":"1F679"},{"Typeface name":"Wingdings 2","Dingbat dec":"95","Dingbat hex":"5F","Unicode dec":"128634","Unicode hex":"1F67A"},{"Typeface name":"Wingdings 2","Dingbat dec":"96","Dingbat hex":"60","Unicode dec":"128635","Unicode hex":"1F67B"},{"Typeface name":"Wingdings 2","Dingbat dec":"97","Dingbat hex":"61","Unicode dec":"128614","Unicode hex":"1F666"},{"Typeface name":"Wingdings 2","Dingbat dec":"98","Dingbat hex":"62","Unicode dec":"128612","Unicode hex":"1F664"},{"Typeface name":"Wingdings 2","Dingbat dec":"99","Dingbat hex":"63","Unicode dec":"128613","Unicode hex":"1F665"},{"Typeface name":"Wingdings 2","Dingbat dec":"100","Dingbat hex":"64","Unicode dec":"128615","Unicode hex":"1F667"},{"Typeface name":"Wingdings 2","Dingbat dec":"101","Dingbat hex":"65","Unicode dec":"128602","Unicode hex":"1F65A"},{"Typeface name":"Wingdings 2","Dingbat dec":"102","Dingbat hex":"66","Unicode dec":"128600","Unicode hex":"1F658"},{"Typeface name":"Wingdings 2","Dingbat dec":"103","Dingbat hex":"67","Unicode dec":"128601","Unicode hex":"1F659"},{"Typeface name":"Wingdings 2","Dingbat dec":"104","Dingbat hex":"68","Unicode dec":"128603","Unicode hex":"1F65B"},{"Typeface name":"Wingdings 2","Dingbat dec":"105","Dingbat hex":"69","Unicode dec":"9450","Unicode hex":"24EA"},{"Typeface name":"Wingdings 2","Dingbat dec":"106","Dingbat hex":"6A","Unicode dec":"9312","Unicode hex":"2460"},{"Typeface name":"Wingdings 2","Dingbat dec":"107","Dingbat hex":"6B","Unicode dec":"9313","Unicode hex":"2461"},{"Typeface name":"Wingdings 2","Dingbat dec":"108","Dingbat hex":"6C","Unicode dec":"9314","Unicode hex":"2462"},{"Typeface name":"Wingdings 2","Dingbat dec":"109","Dingbat hex":"6D","Unicode dec":"9315","Unicode hex":"2463"},{"Typeface name":"Wingdings 2","Dingbat dec":"110","Dingbat hex":"6E","Unicode dec":"9316","Unicode hex":"2464"},{"Typeface name":"Wingdings 2","Dingbat dec":"111","Dingbat hex":"6F","Unicode dec":"9317","Unicode hex":"2465"},{"Typeface name":"Wingdings 2","Dingbat dec":"112","Dingbat hex":"70","Unicode dec":"9318","Unicode hex":"2466"},{"Typeface name":"Wingdings 2","Dingbat dec":"113","Dingbat hex":"71","Unicode dec":"9319","Unicode hex":"2467"},{"Typeface name":"Wingdings 2","Dingbat dec":"114","Dingbat hex":"72","Unicode dec":"9320","Unicode hex":"2468"},{"Typeface name":"Wingdings 2","Dingbat dec":"115","Dingbat hex":"73","Unicode dec":"9321","Unicode hex":"2469"},{"Typeface name":"Wingdings 2","Dingbat dec":"116","Dingbat hex":"74","Unicode dec":"9471","Unicode hex":"24FF"},{"Typeface name":"Wingdings 2","Dingbat dec":"117","Dingbat hex":"75","Unicode dec":"10102","Unicode hex":"2776"},{"Typeface name":"Wingdings 2","Dingbat dec":"118","Dingbat hex":"76","Unicode dec":"10103","Unicode hex":"2777"},{"Typeface name":"Wingdings 2","Dingbat dec":"119","Dingbat hex":"77","Unicode dec":"10104","Unicode hex":"2778"},{"Typeface name":"Wingdings 2","Dingbat dec":"120","Dingbat hex":"78","Unicode dec":"10105","Unicode hex":"2779"},{"Typeface name":"Wingdings 2","Dingbat dec":"121","Dingbat hex":"79","Unicode dec":"10106","Unicode hex":"277A"},{"Typeface name":"Wingdings 2","Dingbat dec":"122","Dingbat hex":"7A","Unicode dec":"10107","Unicode hex":"277B"},{"Typeface name":"Wingdings 2","Dingbat dec":"123","Dingbat hex":"7B","Unicode dec":"10108","Unicode hex":"277C"},{"Typeface name":"Wingdings 2","Dingbat dec":"124","Dingbat hex":"7C","Unicode dec":"10109","Unicode hex":"277D"},{"Typeface name":"Wingdings 2","Dingbat dec":"125","Dingbat hex":"7D","Unicode dec":"10110","Unicode hex":"277E"},{"Typeface name":"Wingdings 2","Dingbat dec":"126","Dingbat hex":"7E","Unicode dec":"10111","Unicode hex":"277F"},{"Typeface name":"Wingdings 2","Dingbat dec":"128","Dingbat hex":"80","Unicode dec":"9737","Unicode hex":"2609"},{"Typeface name":"Wingdings 2","Dingbat dec":"129","Dingbat hex":"81","Unicode dec":"127765","Unicode hex":"1F315"},{"Typeface name":"Wingdings 2","Dingbat dec":"130","Dingbat hex":"82","Unicode dec":"9789","Unicode hex":"263D"},{"Typeface name":"Wingdings 2","Dingbat dec":"131","Dingbat hex":"83","Unicode dec":"9790","Unicode hex":"263E"},{"Typeface name":"Wingdings 2","Dingbat dec":"132","Dingbat hex":"84","Unicode dec":"11839","Unicode hex":"2E3F"},{"Typeface name":"Wingdings 2","Dingbat dec":"133","Dingbat hex":"85","Unicode dec":"10013","Unicode hex":"271D"},{"Typeface name":"Wingdings 2","Dingbat dec":"134","Dingbat hex":"86","Unicode dec":"128327","Unicode hex":"1F547"},{"Typeface name":"Wingdings 2","Dingbat dec":"135","Dingbat hex":"87","Unicode dec":"128348","Unicode hex":"1F55C"},{"Typeface name":"Wingdings 2","Dingbat dec":"136","Dingbat hex":"88","Unicode dec":"128349","Unicode hex":"1F55D"},{"Typeface name":"Wingdings 2","Dingbat dec":"137","Dingbat hex":"89","Unicode dec":"128350","Unicode hex":"1F55E"},{"Typeface name":"Wingdings 2","Dingbat dec":"138","Dingbat hex":"8A","Unicode dec":"128351","Unicode hex":"1F55F"},{"Typeface name":"Wingdings 2","Dingbat dec":"139","Dingbat hex":"8B","Unicode dec":"128352","Unicode hex":"1F560"},{"Typeface name":"Wingdings 2","Dingbat dec":"140","Dingbat hex":"8C","Unicode dec":"128353","Unicode hex":"1F561"},{"Typeface name":"Wingdings 2","Dingbat dec":"141","Dingbat hex":"8D","Unicode dec":"128354","Unicode hex":"1F562"},{"Typeface name":"Wingdings 2","Dingbat dec":"142","Dingbat hex":"8E","Unicode dec":"128355","Unicode hex":"1F563"},{"Typeface name":"Wingdings 2","Dingbat dec":"143","Dingbat hex":"8F","Unicode dec":"128356","Unicode hex":"1F564"},{"Typeface name":"Wingdings 2","Dingbat dec":"144","Dingbat hex":"90","Unicode dec":"128357","Unicode hex":"1F565"},{"Typeface name":"Wingdings 2","Dingbat dec":"145","Dingbat hex":"91","Unicode dec":"128358","Unicode hex":"1F566"},{"Typeface name":"Wingdings 2","Dingbat dec":"146","Dingbat hex":"92","Unicode dec":"128359","Unicode hex":"1F567"},{"Typeface name":"Wingdings 2","Dingbat dec":"147","Dingbat hex":"93","Unicode dec":"128616","Unicode hex":"1F668"},{"Typeface name":"Wingdings 2","Dingbat dec":"148","Dingbat hex":"94","Unicode dec":"128617","Unicode hex":"1F669"},{"Typeface name":"Wingdings 2","Dingbat dec":"149","Dingbat hex":"95","Unicode dec":"8901","Unicode hex":"22C5"},{"Typeface name":"Wingdings 2","Dingbat dec":"150","Dingbat hex":"96","Unicode dec":"128900","Unicode hex":"1F784"},{"Typeface name":"Wingdings 2","Dingbat dec":"151","Dingbat hex":"97","Unicode dec":"10625","Unicode hex":"2981"},{"Typeface name":"Wingdings 2","Dingbat dec":"152","Dingbat hex":"98","Unicode dec":"9679","Unicode hex":"25CF"},{"Typeface name":"Wingdings 2","Dingbat dec":"153","Dingbat hex":"99","Unicode dec":"9675","Unicode hex":"25CB"},{"Typeface name":"Wingdings 2","Dingbat dec":"154","Dingbat hex":"9A","Unicode dec":"128901","Unicode hex":"1F785"},{"Typeface name":"Wingdings 2","Dingbat dec":"155","Dingbat hex":"9B","Unicode dec":"128903","Unicode hex":"1F787"},{"Typeface name":"Wingdings 2","Dingbat dec":"156","Dingbat hex":"9C","Unicode dec":"128905","Unicode hex":"1F789"},{"Typeface name":"Wingdings 2","Dingbat dec":"157","Dingbat hex":"9D","Unicode dec":"8857","Unicode hex":"2299"},{"Typeface name":"Wingdings 2","Dingbat dec":"158","Dingbat hex":"9E","Unicode dec":"10687","Unicode hex":"29BF"},{"Typeface name":"Wingdings 2","Dingbat dec":"159","Dingbat hex":"9F","Unicode dec":"128908","Unicode hex":"1F78C"},{"Typeface name":"Wingdings 2","Dingbat dec":"160","Dingbat hex":"A0","Unicode dec":"128909","Unicode hex":"1F78D"},{"Typeface name":"Wingdings 2","Dingbat dec":"161","Dingbat hex":"A1","Unicode dec":"9726","Unicode hex":"25FE"},{"Typeface name":"Wingdings 2","Dingbat dec":"162","Dingbat hex":"A2","Unicode dec":"9632","Unicode hex":"25A0"},{"Typeface name":"Wingdings 2","Dingbat dec":"163","Dingbat hex":"A3","Unicode dec":"9633","Unicode hex":"25A1"},{"Typeface name":"Wingdings 2","Dingbat dec":"164","Dingbat hex":"A4","Unicode dec":"128913","Unicode hex":"1F791"},{"Typeface name":"Wingdings 2","Dingbat dec":"165","Dingbat hex":"A5","Unicode dec":"128914","Unicode hex":"1F792"},{"Typeface name":"Wingdings 2","Dingbat dec":"166","Dingbat hex":"A6","Unicode dec":"128915","Unicode hex":"1F793"},{"Typeface name":"Wingdings 2","Dingbat dec":"167","Dingbat hex":"A7","Unicode dec":"128916","Unicode hex":"1F794"},{"Typeface name":"Wingdings 2","Dingbat dec":"168","Dingbat hex":"A8","Unicode dec":"9635","Unicode hex":"25A3"},{"Typeface name":"Wingdings 2","Dingbat dec":"169","Dingbat hex":"A9","Unicode dec":"128917","Unicode hex":"1F795"},{"Typeface name":"Wingdings 2","Dingbat dec":"170","Dingbat hex":"AA","Unicode dec":"128918","Unicode hex":"1F796"},{"Typeface name":"Wingdings 2","Dingbat dec":"171","Dingbat hex":"AB","Unicode dec":"128919","Unicode hex":"1F797"},{"Typeface name":"Wingdings 2","Dingbat dec":"172","Dingbat hex":"AC","Unicode dec":"128920","Unicode hex":"1F798"},{"Typeface name":"Wingdings 2","Dingbat dec":"173","Dingbat hex":"AD","Unicode dec":"11049","Unicode hex":"2B29"},{"Typeface name":"Wingdings 2","Dingbat dec":"174","Dingbat hex":"AE","Unicode dec":"11045","Unicode hex":"2B25"},{"Typeface name":"Wingdings 2","Dingbat dec":"175","Dingbat hex":"AF","Unicode dec":"9671","Unicode hex":"25C7"},{"Typeface name":"Wingdings 2","Dingbat dec":"176","Dingbat hex":"B0","Unicode dec":"128922","Unicode hex":"1F79A"},{"Typeface name":"Wingdings 2","Dingbat dec":"177","Dingbat hex":"B1","Unicode dec":"9672","Unicode hex":"25C8"},{"Typeface name":"Wingdings 2","Dingbat dec":"178","Dingbat hex":"B2","Unicode dec":"128923","Unicode hex":"1F79B"},{"Typeface name":"Wingdings 2","Dingbat dec":"179","Dingbat hex":"B3","Unicode dec":"128924","Unicode hex":"1F79C"},{"Typeface name":"Wingdings 2","Dingbat dec":"180","Dingbat hex":"B4","Unicode dec":"128925","Unicode hex":"1F79D"},{"Typeface name":"Wingdings 2","Dingbat dec":"181","Dingbat hex":"B5","Unicode dec":"128926","Unicode hex":"1F79E"},{"Typeface name":"Wingdings 2","Dingbat dec":"182","Dingbat hex":"B6","Unicode dec":"11050","Unicode hex":"2B2A"},{"Typeface name":"Wingdings 2","Dingbat dec":"183","Dingbat hex":"B7","Unicode dec":"11047","Unicode hex":"2B27"},{"Typeface name":"Wingdings 2","Dingbat dec":"184","Dingbat hex":"B8","Unicode dec":"9674","Unicode hex":"25CA"},{"Typeface name":"Wingdings 2","Dingbat dec":"185","Dingbat hex":"B9","Unicode dec":"128928","Unicode hex":"1F7A0"},{"Typeface name":"Wingdings 2","Dingbat dec":"186","Dingbat hex":"BA","Unicode dec":"9686","Unicode hex":"25D6"},{"Typeface name":"Wingdings 2","Dingbat dec":"187","Dingbat hex":"BB","Unicode dec":"9687","Unicode hex":"25D7"},{"Typeface name":"Wingdings 2","Dingbat dec":"188","Dingbat hex":"BC","Unicode dec":"11210","Unicode hex":"2BCA"},{"Typeface name":"Wingdings 2","Dingbat dec":"189","Dingbat hex":"BD","Unicode dec":"11211","Unicode hex":"2BCB"},{"Typeface name":"Wingdings 2","Dingbat dec":"190","Dingbat hex":"BE","Unicode dec":"11200","Unicode hex":"2BC0"},{"Typeface name":"Wingdings 2","Dingbat dec":"191","Dingbat hex":"BF","Unicode dec":"11201","Unicode hex":"2BC1"},{"Typeface name":"Wingdings 2","Dingbat dec":"192","Dingbat hex":"C0","Unicode dec":"11039","Unicode hex":"2B1F"},{"Typeface name":"Wingdings 2","Dingbat dec":"193","Dingbat hex":"C1","Unicode dec":"11202","Unicode hex":"2BC2"},{"Typeface name":"Wingdings 2","Dingbat dec":"194","Dingbat hex":"C2","Unicode dec":"11043","Unicode hex":"2B23"},{"Typeface name":"Wingdings 2","Dingbat dec":"195","Dingbat hex":"C3","Unicode dec":"11042","Unicode hex":"2B22"},{"Typeface name":"Wingdings 2","Dingbat dec":"196","Dingbat hex":"C4","Unicode dec":"11203","Unicode hex":"2BC3"},{"Typeface name":"Wingdings 2","Dingbat dec":"197","Dingbat hex":"C5","Unicode dec":"11204","Unicode hex":"2BC4"},{"Typeface name":"Wingdings 2","Dingbat dec":"198","Dingbat hex":"C6","Unicode dec":"128929","Unicode hex":"1F7A1"},{"Typeface name":"Wingdings 2","Dingbat dec":"199","Dingbat hex":"C7","Unicode dec":"128930","Unicode hex":"1F7A2"},{"Typeface name":"Wingdings 2","Dingbat dec":"200","Dingbat hex":"C8","Unicode dec":"128931","Unicode hex":"1F7A3"},{"Typeface name":"Wingdings 2","Dingbat dec":"201","Dingbat hex":"C9","Unicode dec":"128932","Unicode hex":"1F7A4"},{"Typeface name":"Wingdings 2","Dingbat dec":"202","Dingbat hex":"CA","Unicode dec":"128933","Unicode hex":"1F7A5"},{"Typeface name":"Wingdings 2","Dingbat dec":"203","Dingbat hex":"CB","Unicode dec":"128934","Unicode hex":"1F7A6"},{"Typeface name":"Wingdings 2","Dingbat dec":"204","Dingbat hex":"CC","Unicode dec":"128935","Unicode hex":"1F7A7"},{"Typeface name":"Wingdings 2","Dingbat dec":"205","Dingbat hex":"CD","Unicode dec":"128936","Unicode hex":"1F7A8"},{"Typeface name":"Wingdings 2","Dingbat dec":"206","Dingbat hex":"CE","Unicode dec":"128937","Unicode hex":"1F7A9"},{"Typeface name":"Wingdings 2","Dingbat dec":"207","Dingbat hex":"CF","Unicode dec":"128938","Unicode hex":"1F7AA"},{"Typeface name":"Wingdings 2","Dingbat dec":"208","Dingbat hex":"D0","Unicode dec":"128939","Unicode hex":"1F7AB"},{"Typeface name":"Wingdings 2","Dingbat dec":"209","Dingbat hex":"D1","Unicode dec":"128940","Unicode hex":"1F7AC"},{"Typeface name":"Wingdings 2","Dingbat dec":"210","Dingbat hex":"D2","Unicode dec":"128941","Unicode hex":"1F7AD"},{"Typeface name":"Wingdings 2","Dingbat dec":"211","Dingbat hex":"D3","Unicode dec":"128942","Unicode hex":"1F7AE"},{"Typeface name":"Wingdings 2","Dingbat dec":"212","Dingbat hex":"D4","Unicode dec":"128943","Unicode hex":"1F7AF"},{"Typeface name":"Wingdings 2","Dingbat dec":"213","Dingbat hex":"D5","Unicode dec":"128944","Unicode hex":"1F7B0"},{"Typeface name":"Wingdings 2","Dingbat dec":"214","Dingbat hex":"D6","Unicode dec":"128945","Unicode hex":"1F7B1"},{"Typeface name":"Wingdings 2","Dingbat dec":"215","Dingbat hex":"D7","Unicode dec":"128946","Unicode hex":"1F7B2"},{"Typeface name":"Wingdings 2","Dingbat dec":"216","Dingbat hex":"D8","Unicode dec":"128947","Unicode hex":"1F7B3"},{"Typeface name":"Wingdings 2","Dingbat dec":"217","Dingbat hex":"D9","Unicode dec":"128948","Unicode hex":"1F7B4"},{"Typeface name":"Wingdings 2","Dingbat dec":"218","Dingbat hex":"DA","Unicode dec":"128949","Unicode hex":"1F7B5"},{"Typeface name":"Wingdings 2","Dingbat dec":"219","Dingbat hex":"DB","Unicode dec":"128950","Unicode hex":"1F7B6"},{"Typeface name":"Wingdings 2","Dingbat dec":"220","Dingbat hex":"DC","Unicode dec":"128951","Unicode hex":"1F7B7"},{"Typeface name":"Wingdings 2","Dingbat dec":"221","Dingbat hex":"DD","Unicode dec":"128952","Unicode hex":"1F7B8"},{"Typeface name":"Wingdings 2","Dingbat dec":"222","Dingbat hex":"DE","Unicode dec":"128953","Unicode hex":"1F7B9"},{"Typeface name":"Wingdings 2","Dingbat dec":"223","Dingbat hex":"DF","Unicode dec":"128954","Unicode hex":"1F7BA"},{"Typeface name":"Wingdings 2","Dingbat dec":"224","Dingbat hex":"E0","Unicode dec":"128955","Unicode hex":"1F7BB"},{"Typeface name":"Wingdings 2","Dingbat dec":"225","Dingbat hex":"E1","Unicode dec":"128956","Unicode hex":"1F7BC"},{"Typeface name":"Wingdings 2","Dingbat dec":"226","Dingbat hex":"E2","Unicode dec":"128957","Unicode hex":"1F7BD"},{"Typeface name":"Wingdings 2","Dingbat dec":"227","Dingbat hex":"E3","Unicode dec":"128958","Unicode hex":"1F7BE"},{"Typeface name":"Wingdings 2","Dingbat dec":"228","Dingbat hex":"E4","Unicode dec":"128959","Unicode hex":"1F7BF"},{"Typeface name":"Wingdings 2","Dingbat dec":"229","Dingbat hex":"E5","Unicode dec":"128960","Unicode hex":"1F7C0"},{"Typeface name":"Wingdings 2","Dingbat dec":"230","Dingbat hex":"E6","Unicode dec":"128962","Unicode hex":"1F7C2"},{"Typeface name":"Wingdings 2","Dingbat dec":"231","Dingbat hex":"E7","Unicode dec":"128964","Unicode hex":"1F7C4"},{"Typeface name":"Wingdings 2","Dingbat dec":"232","Dingbat hex":"E8","Unicode dec":"128966","Unicode hex":"1F7C6"},{"Typeface name":"Wingdings 2","Dingbat dec":"233","Dingbat hex":"E9","Unicode dec":"128969","Unicode hex":"1F7C9"},{"Typeface name":"Wingdings 2","Dingbat dec":"234","Dingbat hex":"EA","Unicode dec":"128970","Unicode hex":"1F7CA"},{"Typeface name":"Wingdings 2","Dingbat dec":"235","Dingbat hex":"EB","Unicode dec":"10038","Unicode hex":"2736"},{"Typeface name":"Wingdings 2","Dingbat dec":"236","Dingbat hex":"EC","Unicode dec":"128972","Unicode hex":"1F7CC"},{"Typeface name":"Wingdings 2","Dingbat dec":"237","Dingbat hex":"ED","Unicode dec":"128974","Unicode hex":"1F7CE"},{"Typeface name":"Wingdings 2","Dingbat dec":"238","Dingbat hex":"EE","Unicode dec":"128976","Unicode hex":"1F7D0"},{"Typeface name":"Wingdings 2","Dingbat dec":"239","Dingbat hex":"EF","Unicode dec":"128978","Unicode hex":"1F7D2"},{"Typeface name":"Wingdings 2","Dingbat dec":"240","Dingbat hex":"F0","Unicode dec":"10041","Unicode hex":"2739"},{"Typeface name":"Wingdings 2","Dingbat dec":"241","Dingbat hex":"F1","Unicode dec":"128963","Unicode hex":"1F7C3"},{"Typeface name":"Wingdings 2","Dingbat dec":"242","Dingbat hex":"F2","Unicode dec":"128967","Unicode hex":"1F7C7"},{"Typeface name":"Wingdings 2","Dingbat dec":"243","Dingbat hex":"F3","Unicode dec":"10031","Unicode hex":"272F"},{"Typeface name":"Wingdings 2","Dingbat dec":"244","Dingbat hex":"F4","Unicode dec":"128973","Unicode hex":"1F7CD"},{"Typeface name":"Wingdings 2","Dingbat dec":"245","Dingbat hex":"F5","Unicode dec":"128980","Unicode hex":"1F7D4"},{"Typeface name":"Wingdings 2","Dingbat dec":"246","Dingbat hex":"F6","Unicode dec":"11212","Unicode hex":"2BCC"},{"Typeface name":"Wingdings 2","Dingbat dec":"247","Dingbat hex":"F7","Unicode dec":"11213","Unicode hex":"2BCD"},{"Typeface name":"Wingdings 2","Dingbat dec":"248","Dingbat hex":"F8","Unicode dec":"8251","Unicode hex":"203B"},{"Typeface name":"Wingdings 2","Dingbat dec":"249","Dingbat hex":"F9","Unicode dec":"8258","Unicode hex":"2042"},{"Typeface name":"Wingdings 3","Dingbat dec":"32","Dingbat hex":"20","Unicode dec":"32","Unicode hex":"20"},{"Typeface name":"Wingdings 3","Dingbat dec":"33","Dingbat hex":"21","Unicode dec":"11104","Unicode hex":"2B60"},{"Typeface name":"Wingdings 3","Dingbat dec":"34","Dingbat hex":"22","Unicode dec":"11106","Unicode hex":"2B62"},{"Typeface name":"Wingdings 3","Dingbat dec":"35","Dingbat hex":"23","Unicode dec":"11105","Unicode hex":"2B61"},{"Typeface name":"Wingdings 3","Dingbat dec":"36","Dingbat hex":"24","Unicode dec":"11107","Unicode hex":"2B63"},{"Typeface name":"Wingdings 3","Dingbat dec":"37","Dingbat hex":"25","Unicode dec":"11110","Unicode hex":"2B66"},{"Typeface name":"Wingdings 3","Dingbat dec":"38","Dingbat hex":"26","Unicode dec":"11111","Unicode hex":"2B67"},{"Typeface name":"Wingdings 3","Dingbat dec":"39","Dingbat hex":"27","Unicode dec":"11113","Unicode hex":"2B69"},{"Typeface name":"Wingdings 3","Dingbat dec":"40","Dingbat hex":"28","Unicode dec":"11112","Unicode hex":"2B68"},{"Typeface name":"Wingdings 3","Dingbat dec":"41","Dingbat hex":"29","Unicode dec":"11120","Unicode hex":"2B70"},{"Typeface name":"Wingdings 3","Dingbat dec":"42","Dingbat hex":"2A","Unicode dec":"11122","Unicode hex":"2B72"},{"Typeface name":"Wingdings 3","Dingbat dec":"43","Dingbat hex":"2B","Unicode dec":"11121","Unicode hex":"2B71"},{"Typeface name":"Wingdings 3","Dingbat dec":"44","Dingbat hex":"2C","Unicode dec":"11123","Unicode hex":"2B73"},{"Typeface name":"Wingdings 3","Dingbat dec":"45","Dingbat hex":"2D","Unicode dec":"11126","Unicode hex":"2B76"},{"Typeface name":"Wingdings 3","Dingbat dec":"46","Dingbat hex":"2E","Unicode dec":"11128","Unicode hex":"2B78"},{"Typeface name":"Wingdings 3","Dingbat dec":"47","Dingbat hex":"2F","Unicode dec":"11131","Unicode hex":"2B7B"},{"Typeface name":"Wingdings 3","Dingbat dec":"48","Dingbat hex":"30","Unicode dec":"11133","Unicode hex":"2B7D"},{"Typeface name":"Wingdings 3","Dingbat dec":"49","Dingbat hex":"31","Unicode dec":"11108","Unicode hex":"2B64"},{"Typeface name":"Wingdings 3","Dingbat dec":"50","Dingbat hex":"32","Unicode dec":"11109","Unicode hex":"2B65"},{"Typeface name":"Wingdings 3","Dingbat dec":"51","Dingbat hex":"33","Unicode dec":"11114","Unicode hex":"2B6A"},{"Typeface name":"Wingdings 3","Dingbat dec":"52","Dingbat hex":"34","Unicode dec":"11116","Unicode hex":"2B6C"},{"Typeface name":"Wingdings 3","Dingbat dec":"53","Dingbat hex":"35","Unicode dec":"11115","Unicode hex":"2B6B"},{"Typeface name":"Wingdings 3","Dingbat dec":"54","Dingbat hex":"36","Unicode dec":"11117","Unicode hex":"2B6D"},{"Typeface name":"Wingdings 3","Dingbat dec":"55","Dingbat hex":"37","Unicode dec":"11085","Unicode hex":"2B4D"},{"Typeface name":"Wingdings 3","Dingbat dec":"56","Dingbat hex":"38","Unicode dec":"11168","Unicode hex":"2BA0"},{"Typeface name":"Wingdings 3","Dingbat dec":"57","Dingbat hex":"39","Unicode dec":"11169","Unicode hex":"2BA1"},{"Typeface name":"Wingdings 3","Dingbat dec":"58","Dingbat hex":"3A","Unicode dec":"11170","Unicode hex":"2BA2"},{"Typeface name":"Wingdings 3","Dingbat dec":"59","Dingbat hex":"3B","Unicode dec":"11171","Unicode hex":"2BA3"},{"Typeface name":"Wingdings 3","Dingbat dec":"60","Dingbat hex":"3C","Unicode dec":"11172","Unicode hex":"2BA4"},{"Typeface name":"Wingdings 3","Dingbat dec":"61","Dingbat hex":"3D","Unicode dec":"11173","Unicode hex":"2BA5"},{"Typeface name":"Wingdings 3","Dingbat dec":"62","Dingbat hex":"3E","Unicode dec":"11174","Unicode hex":"2BA6"},{"Typeface name":"Wingdings 3","Dingbat dec":"63","Dingbat hex":"3F","Unicode dec":"11175","Unicode hex":"2BA7"},{"Typeface name":"Wingdings 3","Dingbat dec":"64","Dingbat hex":"40","Unicode dec":"11152","Unicode hex":"2B90"},{"Typeface name":"Wingdings 3","Dingbat dec":"65","Dingbat hex":"41","Unicode dec":"11153","Unicode hex":"2B91"},{"Typeface name":"Wingdings 3","Dingbat dec":"66","Dingbat hex":"42","Unicode dec":"11154","Unicode hex":"2B92"},{"Typeface name":"Wingdings 3","Dingbat dec":"67","Dingbat hex":"43","Unicode dec":"11155","Unicode hex":"2B93"},{"Typeface name":"Wingdings 3","Dingbat dec":"68","Dingbat hex":"44","Unicode dec":"11136","Unicode hex":"2B80"},{"Typeface name":"Wingdings 3","Dingbat dec":"69","Dingbat hex":"45","Unicode dec":"11139","Unicode hex":"2B83"},{"Typeface name":"Wingdings 3","Dingbat dec":"70","Dingbat hex":"46","Unicode dec":"11134","Unicode hex":"2B7E"},{"Typeface name":"Wingdings 3","Dingbat dec":"71","Dingbat hex":"47","Unicode dec":"11135","Unicode hex":"2B7F"},{"Typeface name":"Wingdings 3","Dingbat dec":"72","Dingbat hex":"48","Unicode dec":"11140","Unicode hex":"2B84"},{"Typeface name":"Wingdings 3","Dingbat dec":"73","Dingbat hex":"49","Unicode dec":"11142","Unicode hex":"2B86"},{"Typeface name":"Wingdings 3","Dingbat dec":"74","Dingbat hex":"4A","Unicode dec":"11141","Unicode hex":"2B85"},{"Typeface name":"Wingdings 3","Dingbat dec":"75","Dingbat hex":"4B","Unicode dec":"11143","Unicode hex":"2B87"},{"Typeface name":"Wingdings 3","Dingbat dec":"76","Dingbat hex":"4C","Unicode dec":"11151","Unicode hex":"2B8F"},{"Typeface name":"Wingdings 3","Dingbat dec":"77","Dingbat hex":"4D","Unicode dec":"11149","Unicode hex":"2B8D"},{"Typeface name":"Wingdings 3","Dingbat dec":"78","Dingbat hex":"4E","Unicode dec":"11150","Unicode hex":"2B8E"},{"Typeface name":"Wingdings 3","Dingbat dec":"79","Dingbat hex":"4F","Unicode dec":"11148","Unicode hex":"2B8C"},{"Typeface name":"Wingdings 3","Dingbat dec":"80","Dingbat hex":"50","Unicode dec":"11118","Unicode hex":"2B6E"},{"Typeface name":"Wingdings 3","Dingbat dec":"81","Dingbat hex":"51","Unicode dec":"11119","Unicode hex":"2B6F"},{"Typeface name":"Wingdings 3","Dingbat dec":"82","Dingbat hex":"52","Unicode dec":"9099","Unicode hex":"238B"},{"Typeface name":"Wingdings 3","Dingbat dec":"83","Dingbat hex":"53","Unicode dec":"8996","Unicode hex":"2324"},{"Typeface name":"Wingdings 3","Dingbat dec":"84","Dingbat hex":"54","Unicode dec":"8963","Unicode hex":"2303"},{"Typeface name":"Wingdings 3","Dingbat dec":"85","Dingbat hex":"55","Unicode dec":"8997","Unicode hex":"2325"},{"Typeface name":"Wingdings 3","Dingbat dec":"86","Dingbat hex":"56","Unicode dec":"9251","Unicode hex":"2423"},{"Typeface name":"Wingdings 3","Dingbat dec":"87","Dingbat hex":"57","Unicode dec":"9085","Unicode hex":"237D"},{"Typeface name":"Wingdings 3","Dingbat dec":"88","Dingbat hex":"58","Unicode dec":"8682","Unicode hex":"21EA"},{"Typeface name":"Wingdings 3","Dingbat dec":"89","Dingbat hex":"59","Unicode dec":"11192","Unicode hex":"2BB8"},{"Typeface name":"Wingdings 3","Dingbat dec":"90","Dingbat hex":"5A","Unicode dec":"129184","Unicode hex":"1F8A0"},{"Typeface name":"Wingdings 3","Dingbat dec":"91","Dingbat hex":"5B","Unicode dec":"129185","Unicode hex":"1F8A1"},{"Typeface name":"Wingdings 3","Dingbat dec":"92","Dingbat hex":"5C","Unicode dec":"129186","Unicode hex":"1F8A2"},{"Typeface name":"Wingdings 3","Dingbat dec":"93","Dingbat hex":"5D","Unicode dec":"129187","Unicode hex":"1F8A3"},{"Typeface name":"Wingdings 3","Dingbat dec":"94","Dingbat hex":"5E","Unicode dec":"129188","Unicode hex":"1F8A4"},{"Typeface name":"Wingdings 3","Dingbat dec":"95","Dingbat hex":"5F","Unicode dec":"129189","Unicode hex":"1F8A5"},{"Typeface name":"Wingdings 3","Dingbat dec":"96","Dingbat hex":"60","Unicode dec":"129190","Unicode hex":"1F8A6"},{"Typeface name":"Wingdings 3","Dingbat dec":"97","Dingbat hex":"61","Unicode dec":"129191","Unicode hex":"1F8A7"},{"Typeface name":"Wingdings 3","Dingbat dec":"98","Dingbat hex":"62","Unicode dec":"129192","Unicode hex":"1F8A8"},{"Typeface name":"Wingdings 3","Dingbat dec":"99","Dingbat hex":"63","Unicode dec":"129193","Unicode hex":"1F8A9"},{"Typeface name":"Wingdings 3","Dingbat dec":"100","Dingbat hex":"64","Unicode dec":"129194","Unicode hex":"1F8AA"},{"Typeface name":"Wingdings 3","Dingbat dec":"101","Dingbat hex":"65","Unicode dec":"129195","Unicode hex":"1F8AB"},{"Typeface name":"Wingdings 3","Dingbat dec":"102","Dingbat hex":"66","Unicode dec":"129104","Unicode hex":"1F850"},{"Typeface name":"Wingdings 3","Dingbat dec":"103","Dingbat hex":"67","Unicode dec":"129106","Unicode hex":"1F852"},{"Typeface name":"Wingdings 3","Dingbat dec":"104","Dingbat hex":"68","Unicode dec":"129105","Unicode hex":"1F851"},{"Typeface name":"Wingdings 3","Dingbat dec":"105","Dingbat hex":"69","Unicode dec":"129107","Unicode hex":"1F853"},{"Typeface name":"Wingdings 3","Dingbat dec":"106","Dingbat hex":"6A","Unicode dec":"129108","Unicode hex":"1F854"},{"Typeface name":"Wingdings 3","Dingbat dec":"107","Dingbat hex":"6B","Unicode dec":"129109","Unicode hex":"1F855"},{"Typeface name":"Wingdings 3","Dingbat dec":"108","Dingbat hex":"6C","Unicode dec":"129111","Unicode hex":"1F857"},{"Typeface name":"Wingdings 3","Dingbat dec":"109","Dingbat hex":"6D","Unicode dec":"129110","Unicode hex":"1F856"},{"Typeface name":"Wingdings 3","Dingbat dec":"110","Dingbat hex":"6E","Unicode dec":"129112","Unicode hex":"1F858"},{"Typeface name":"Wingdings 3","Dingbat dec":"111","Dingbat hex":"6F","Unicode dec":"129113","Unicode hex":"1F859"},{"Typeface name":"Wingdings 3","Dingbat dec":"112","Dingbat hex":"70","Unicode dec":"9650","Unicode hex":"25B2"},{"Typeface name":"Wingdings 3","Dingbat dec":"113","Dingbat hex":"71","Unicode dec":"9660","Unicode hex":"25BC"},{"Typeface name":"Wingdings 3","Dingbat dec":"114","Dingbat hex":"72","Unicode dec":"9651","Unicode hex":"25B3"},{"Typeface name":"Wingdings 3","Dingbat dec":"115","Dingbat hex":"73","Unicode dec":"9661","Unicode hex":"25BD"},{"Typeface name":"Wingdings 3","Dingbat dec":"116","Dingbat hex":"74","Unicode dec":"9664","Unicode hex":"25C0"},{"Typeface name":"Wingdings 3","Dingbat dec":"117","Dingbat hex":"75","Unicode dec":"9654","Unicode hex":"25B6"},{"Typeface name":"Wingdings 3","Dingbat dec":"118","Dingbat hex":"76","Unicode dec":"9665","Unicode hex":"25C1"},{"Typeface name":"Wingdings 3","Dingbat dec":"119","Dingbat hex":"77","Unicode dec":"9655","Unicode hex":"25B7"},{"Typeface name":"Wingdings 3","Dingbat dec":"120","Dingbat hex":"78","Unicode dec":"9699","Unicode hex":"25E3"},{"Typeface name":"Wingdings 3","Dingbat dec":"121","Dingbat hex":"79","Unicode dec":"9698","Unicode hex":"25E2"},{"Typeface name":"Wingdings 3","Dingbat dec":"122","Dingbat hex":"7A","Unicode dec":"9700","Unicode hex":"25E4"},{"Typeface name":"Wingdings 3","Dingbat dec":"123","Dingbat hex":"7B","Unicode dec":"9701","Unicode hex":"25E5"},{"Typeface name":"Wingdings 3","Dingbat dec":"124","Dingbat hex":"7C","Unicode dec":"128896","Unicode hex":"1F780"},{"Typeface name":"Wingdings 3","Dingbat dec":"125","Dingbat hex":"7D","Unicode dec":"128898","Unicode hex":"1F782"},{"Typeface name":"Wingdings 3","Dingbat dec":"126","Dingbat hex":"7E","Unicode dec":"128897","Unicode hex":"1F781"},{"Typeface name":"Wingdings 3","Dingbat dec":"128","Dingbat hex":"80","Unicode dec":"128899","Unicode hex":"1F783"},{"Typeface name":"Wingdings 3","Dingbat dec":"129","Dingbat hex":"81","Unicode dec":"11205","Unicode hex":"2BC5"},{"Typeface name":"Wingdings 3","Dingbat dec":"130","Dingbat hex":"82","Unicode dec":"11206","Unicode hex":"2BC6"},{"Typeface name":"Wingdings 3","Dingbat dec":"131","Dingbat hex":"83","Unicode dec":"11207","Unicode hex":"2BC7"},{"Typeface name":"Wingdings 3","Dingbat dec":"132","Dingbat hex":"84","Unicode dec":"11208","Unicode hex":"2BC8"},{"Typeface name":"Wingdings 3","Dingbat dec":"133","Dingbat hex":"85","Unicode dec":"11164","Unicode hex":"2B9C"},{"Typeface name":"Wingdings 3","Dingbat dec":"134","Dingbat hex":"86","Unicode dec":"11166","Unicode hex":"2B9E"},{"Typeface name":"Wingdings 3","Dingbat dec":"135","Dingbat hex":"87","Unicode dec":"11165","Unicode hex":"2B9D"},{"Typeface name":"Wingdings 3","Dingbat dec":"136","Dingbat hex":"88","Unicode dec":"11167","Unicode hex":"2B9F"},{"Typeface name":"Wingdings 3","Dingbat dec":"137","Dingbat hex":"89","Unicode dec":"129040","Unicode hex":"1F810"},{"Typeface name":"Wingdings 3","Dingbat dec":"138","Dingbat hex":"8A","Unicode dec":"129042","Unicode hex":"1F812"},{"Typeface name":"Wingdings 3","Dingbat dec":"139","Dingbat hex":"8B","Unicode dec":"129041","Unicode hex":"1F811"},{"Typeface name":"Wingdings 3","Dingbat dec":"140","Dingbat hex":"8C","Unicode dec":"129043","Unicode hex":"1F813"},{"Typeface name":"Wingdings 3","Dingbat dec":"141","Dingbat hex":"8D","Unicode dec":"129044","Unicode hex":"1F814"},{"Typeface name":"Wingdings 3","Dingbat dec":"142","Dingbat hex":"8E","Unicode dec":"129046","Unicode hex":"1F816"},{"Typeface name":"Wingdings 3","Dingbat dec":"143","Dingbat hex":"8F","Unicode dec":"129045","Unicode hex":"1F815"},{"Typeface name":"Wingdings 3","Dingbat dec":"144","Dingbat hex":"90","Unicode dec":"129047","Unicode hex":"1F817"},{"Typeface name":"Wingdings 3","Dingbat dec":"145","Dingbat hex":"91","Unicode dec":"129048","Unicode hex":"1F818"},{"Typeface name":"Wingdings 3","Dingbat dec":"146","Dingbat hex":"92","Unicode dec":"129050","Unicode hex":"1F81A"},{"Typeface name":"Wingdings 3","Dingbat dec":"147","Dingbat hex":"93","Unicode dec":"129049","Unicode hex":"1F819"},{"Typeface name":"Wingdings 3","Dingbat dec":"148","Dingbat hex":"94","Unicode dec":"129051","Unicode hex":"1F81B"},{"Typeface name":"Wingdings 3","Dingbat dec":"149","Dingbat hex":"95","Unicode dec":"129052","Unicode hex":"1F81C"},{"Typeface name":"Wingdings 3","Dingbat dec":"150","Dingbat hex":"96","Unicode dec":"129054","Unicode hex":"1F81E"},{"Typeface name":"Wingdings 3","Dingbat dec":"151","Dingbat hex":"97","Unicode dec":"129053","Unicode hex":"1F81D"},{"Typeface name":"Wingdings 3","Dingbat dec":"152","Dingbat hex":"98","Unicode dec":"129055","Unicode hex":"1F81F"},{"Typeface name":"Wingdings 3","Dingbat dec":"153","Dingbat hex":"99","Unicode dec":"129024","Unicode hex":"1F800"},{"Typeface name":"Wingdings 3","Dingbat dec":"154","Dingbat hex":"9A","Unicode dec":"129026","Unicode hex":"1F802"},{"Typeface name":"Wingdings 3","Dingbat dec":"155","Dingbat hex":"9B","Unicode dec":"129025","Unicode hex":"1F801"},{"Typeface name":"Wingdings 3","Dingbat dec":"156","Dingbat hex":"9C","Unicode dec":"129027","Unicode hex":"1F803"},{"Typeface name":"Wingdings 3","Dingbat dec":"157","Dingbat hex":"9D","Unicode dec":"129028","Unicode hex":"1F804"},{"Typeface name":"Wingdings 3","Dingbat dec":"158","Dingbat hex":"9E","Unicode dec":"129030","Unicode hex":"1F806"},{"Typeface name":"Wingdings 3","Dingbat dec":"159","Dingbat hex":"9F","Unicode dec":"129029","Unicode hex":"1F805"},{"Typeface name":"Wingdings 3","Dingbat dec":"160","Dingbat hex":"A0","Unicode dec":"129031","Unicode hex":"1F807"},{"Typeface name":"Wingdings 3","Dingbat dec":"161","Dingbat hex":"A1","Unicode dec":"129032","Unicode hex":"1F808"},{"Typeface name":"Wingdings 3","Dingbat dec":"162","Dingbat hex":"A2","Unicode dec":"129034","Unicode hex":"1F80A"},{"Typeface name":"Wingdings 3","Dingbat dec":"163","Dingbat hex":"A3","Unicode dec":"129033","Unicode hex":"1F809"},{"Typeface name":"Wingdings 3","Dingbat dec":"164","Dingbat hex":"A4","Unicode dec":"129035","Unicode hex":"1F80B"},{"Typeface name":"Wingdings 3","Dingbat dec":"165","Dingbat hex":"A5","Unicode dec":"129056","Unicode hex":"1F820"},{"Typeface name":"Wingdings 3","Dingbat dec":"166","Dingbat hex":"A6","Unicode dec":"129058","Unicode hex":"1F822"},{"Typeface name":"Wingdings 3","Dingbat dec":"167","Dingbat hex":"A7","Unicode dec":"129060","Unicode hex":"1F824"},{"Typeface name":"Wingdings 3","Dingbat dec":"168","Dingbat hex":"A8","Unicode dec":"129062","Unicode hex":"1F826"},{"Typeface name":"Wingdings 3","Dingbat dec":"169","Dingbat hex":"A9","Unicode dec":"129064","Unicode hex":"1F828"},{"Typeface name":"Wingdings 3","Dingbat dec":"170","Dingbat hex":"AA","Unicode dec":"129066","Unicode hex":"1F82A"},{"Typeface name":"Wingdings 3","Dingbat dec":"171","Dingbat hex":"AB","Unicode dec":"129068","Unicode hex":"1F82C"},{"Typeface name":"Wingdings 3","Dingbat dec":"172","Dingbat hex":"AC","Unicode dec":"129180","Unicode hex":"1F89C"},{"Typeface name":"Wingdings 3","Dingbat dec":"173","Dingbat hex":"AD","Unicode dec":"129181","Unicode hex":"1F89D"},{"Typeface name":"Wingdings 3","Dingbat dec":"174","Dingbat hex":"AE","Unicode dec":"129182","Unicode hex":"1F89E"},{"Typeface name":"Wingdings 3","Dingbat dec":"175","Dingbat hex":"AF","Unicode dec":"129183","Unicode hex":"1F89F"},{"Typeface name":"Wingdings 3","Dingbat dec":"176","Dingbat hex":"B0","Unicode dec":"129070","Unicode hex":"1F82E"},{"Typeface name":"Wingdings 3","Dingbat dec":"177","Dingbat hex":"B1","Unicode dec":"129072","Unicode hex":"1F830"},{"Typeface name":"Wingdings 3","Dingbat dec":"178","Dingbat hex":"B2","Unicode dec":"129074","Unicode hex":"1F832"},{"Typeface name":"Wingdings 3","Dingbat dec":"179","Dingbat hex":"B3","Unicode dec":"129076","Unicode hex":"1F834"},{"Typeface name":"Wingdings 3","Dingbat dec":"180","Dingbat hex":"B4","Unicode dec":"129078","Unicode hex":"1F836"},{"Typeface name":"Wingdings 3","Dingbat dec":"181","Dingbat hex":"B5","Unicode dec":"129080","Unicode hex":"1F838"},{"Typeface name":"Wingdings 3","Dingbat dec":"182","Dingbat hex":"B6","Unicode dec":"129082","Unicode hex":"1F83A"},{"Typeface name":"Wingdings 3","Dingbat dec":"183","Dingbat hex":"B7","Unicode dec":"129081","Unicode hex":"1F839"},{"Typeface name":"Wingdings 3","Dingbat dec":"184","Dingbat hex":"B8","Unicode dec":"129083","Unicode hex":"1F83B"},{"Typeface name":"Wingdings 3","Dingbat dec":"185","Dingbat hex":"B9","Unicode dec":"129176","Unicode hex":"1F898"},{"Typeface name":"Wingdings 3","Dingbat dec":"186","Dingbat hex":"BA","Unicode dec":"129178","Unicode hex":"1F89A"},{"Typeface name":"Wingdings 3","Dingbat dec":"187","Dingbat hex":"BB","Unicode dec":"129177","Unicode hex":"1F899"},{"Typeface name":"Wingdings 3","Dingbat dec":"188","Dingbat hex":"BC","Unicode dec":"129179","Unicode hex":"1F89B"},{"Typeface name":"Wingdings 3","Dingbat dec":"189","Dingbat hex":"BD","Unicode dec":"129084","Unicode hex":"1F83C"},{"Typeface name":"Wingdings 3","Dingbat dec":"190","Dingbat hex":"BE","Unicode dec":"129086","Unicode hex":"1F83E"},{"Typeface name":"Wingdings 3","Dingbat dec":"191","Dingbat hex":"BF","Unicode dec":"129085","Unicode hex":"1F83D"},{"Typeface name":"Wingdings 3","Dingbat dec":"192","Dingbat hex":"C0","Unicode dec":"129087","Unicode hex":"1F83F"},{"Typeface name":"Wingdings 3","Dingbat dec":"193","Dingbat hex":"C1","Unicode dec":"129088","Unicode hex":"1F840"},{"Typeface name":"Wingdings 3","Dingbat dec":"194","Dingbat hex":"C2","Unicode dec":"129090","Unicode hex":"1F842"},{"Typeface name":"Wingdings 3","Dingbat dec":"195","Dingbat hex":"C3","Unicode dec":"129089","Unicode hex":"1F841"},{"Typeface name":"Wingdings 3","Dingbat dec":"196","Dingbat hex":"C4","Unicode dec":"129091","Unicode hex":"1F843"},{"Typeface name":"Wingdings 3","Dingbat dec":"197","Dingbat hex":"C5","Unicode dec":"129092","Unicode hex":"1F844"},{"Typeface name":"Wingdings 3","Dingbat dec":"198","Dingbat hex":"C6","Unicode dec":"129094","Unicode hex":"1F846"},{"Typeface name":"Wingdings 3","Dingbat dec":"199","Dingbat hex":"C7","Unicode dec":"129093","Unicode hex":"1F845"},{"Typeface name":"Wingdings 3","Dingbat dec":"200","Dingbat hex":"C8","Unicode dec":"129095","Unicode hex":"1F847"},{"Typeface name":"Wingdings 3","Dingbat dec":"201","Dingbat hex":"C9","Unicode dec":"11176","Unicode hex":"2BA8"},{"Typeface name":"Wingdings 3","Dingbat dec":"202","Dingbat hex":"CA","Unicode dec":"11177","Unicode hex":"2BA9"},{"Typeface name":"Wingdings 3","Dingbat dec":"203","Dingbat hex":"CB","Unicode dec":"11178","Unicode hex":"2BAA"},{"Typeface name":"Wingdings 3","Dingbat dec":"204","Dingbat hex":"CC","Unicode dec":"11179","Unicode hex":"2BAB"},{"Typeface name":"Wingdings 3","Dingbat dec":"205","Dingbat hex":"CD","Unicode dec":"11180","Unicode hex":"2BAC"},{"Typeface name":"Wingdings 3","Dingbat dec":"206","Dingbat hex":"CE","Unicode dec":"11181","Unicode hex":"2BAD"},{"Typeface name":"Wingdings 3","Dingbat dec":"207","Dingbat hex":"CF","Unicode dec":"11182","Unicode hex":"2BAE"},{"Typeface name":"Wingdings 3","Dingbat dec":"208","Dingbat hex":"D0","Unicode dec":"11183","Unicode hex":"2BAF"},{"Typeface name":"Wingdings 3","Dingbat dec":"209","Dingbat hex":"D1","Unicode dec":"129120","Unicode hex":"1F860"},{"Typeface name":"Wingdings 3","Dingbat dec":"210","Dingbat hex":"D2","Unicode dec":"129122","Unicode hex":"1F862"},{"Typeface name":"Wingdings 3","Dingbat dec":"211","Dingbat hex":"D3","Unicode dec":"129121","Unicode hex":"1F861"},{"Typeface name":"Wingdings 3","Dingbat dec":"212","Dingbat hex":"D4","Unicode dec":"129123","Unicode hex":"1F863"},{"Typeface name":"Wingdings 3","Dingbat dec":"213","Dingbat hex":"D5","Unicode dec":"129124","Unicode hex":"1F864"},{"Typeface name":"Wingdings 3","Dingbat dec":"214","Dingbat hex":"D6","Unicode dec":"129125","Unicode hex":"1F865"},{"Typeface name":"Wingdings 3","Dingbat dec":"215","Dingbat hex":"D7","Unicode dec":"129127","Unicode hex":"1F867"},{"Typeface name":"Wingdings 3","Dingbat dec":"216","Dingbat hex":"D8","Unicode dec":"129126","Unicode hex":"1F866"},{"Typeface name":"Wingdings 3","Dingbat dec":"217","Dingbat hex":"D9","Unicode dec":"129136","Unicode hex":"1F870"},{"Typeface name":"Wingdings 3","Dingbat dec":"218","Dingbat hex":"DA","Unicode dec":"129138","Unicode hex":"1F872"},{"Typeface name":"Wingdings 3","Dingbat dec":"219","Dingbat hex":"DB","Unicode dec":"129137","Unicode hex":"1F871"},{"Typeface name":"Wingdings 3","Dingbat dec":"220","Dingbat hex":"DC","Unicode dec":"129139","Unicode hex":"1F873"},{"Typeface name":"Wingdings 3","Dingbat dec":"221","Dingbat hex":"DD","Unicode dec":"129140","Unicode hex":"1F874"},{"Typeface name":"Wingdings 3","Dingbat dec":"222","Dingbat hex":"DE","Unicode dec":"129141","Unicode hex":"1F875"},{"Typeface name":"Wingdings 3","Dingbat dec":"223","Dingbat hex":"DF","Unicode dec":"129143","Unicode hex":"1F877"},{"Typeface name":"Wingdings 3","Dingbat dec":"224","Dingbat hex":"E0","Unicode dec":"129142","Unicode hex":"1F876"},{"Typeface name":"Wingdings 3","Dingbat dec":"225","Dingbat hex":"E1","Unicode dec":"129152","Unicode hex":"1F880"},{"Typeface name":"Wingdings 3","Dingbat dec":"226","Dingbat hex":"E2","Unicode dec":"129154","Unicode hex":"1F882"},{"Typeface name":"Wingdings 3","Dingbat dec":"227","Dingbat hex":"E3","Unicode dec":"129153","Unicode hex":"1F881"},{"Typeface name":"Wingdings 3","Dingbat dec":"228","Dingbat hex":"E4","Unicode dec":"129155","Unicode hex":"1F883"},{"Typeface name":"Wingdings 3","Dingbat dec":"229","Dingbat hex":"E5","Unicode dec":"129156","Unicode hex":"1F884"},{"Typeface name":"Wingdings 3","Dingbat dec":"230","Dingbat hex":"E6","Unicode dec":"129157","Unicode hex":"1F885"},{"Typeface name":"Wingdings 3","Dingbat dec":"231","Dingbat hex":"E7","Unicode dec":"129159","Unicode hex":"1F887"},{"Typeface name":"Wingdings 3","Dingbat dec":"232","Dingbat hex":"E8","Unicode dec":"129158","Unicode hex":"1F886"},{"Typeface name":"Wingdings 3","Dingbat dec":"233","Dingbat hex":"E9","Unicode dec":"129168","Unicode hex":"1F890"},{"Typeface name":"Wingdings 3","Dingbat dec":"234","Dingbat hex":"EA","Unicode dec":"129170","Unicode hex":"1F892"},{"Typeface name":"Wingdings 3","Dingbat dec":"235","Dingbat hex":"EB","Unicode dec":"129169","Unicode hex":"1F891"},{"Typeface name":"Wingdings 3","Dingbat dec":"236","Dingbat hex":"EC","Unicode dec":"129171","Unicode hex":"1F893"},{"Typeface name":"Wingdings 3","Dingbat dec":"237","Dingbat hex":"ED","Unicode dec":"129172","Unicode hex":"1F894"},{"Typeface name":"Wingdings 3","Dingbat dec":"238","Dingbat hex":"EE","Unicode dec":"129174","Unicode hex":"1F896"},{"Typeface name":"Wingdings 3","Dingbat dec":"239","Dingbat hex":"EF","Unicode dec":"129173","Unicode hex":"1F895"},{"Typeface name":"Wingdings 3","Dingbat dec":"240","Dingbat hex":"F0","Unicode dec":"129175","Unicode hex":"1F897"}];ce.default=ne},2843:Xe=>{function ce(ne){return Promise.resolve().then(()=>{var I=new Error("Cannot find module '"+ne+"'");throw I.code="MODULE_NOT_FOUND",I})}ce.keys=()=>[],ce.resolve=ce,ce.id=2843,Xe.exports=ce},2926:(Xe,ce,ne)=>{var I,X=ne(6881),x=ne(8994);I=M;function M(C){return function(E){return x.elementWithTag(X.element(C),[E])}}},2954:function(Xe,ce,ne){(function(){var I,X,x,M,C,E=function(L,T){for(var O in T)R.call(T,O)&&(L[O]=T[O]);function W(){this.constructor=L}return W.prototype=T.prototype,L.prototype=new W,L.__super__=T.prototype,L},R={}.hasOwnProperty;C=ne(3626).isPlainObject,X=ne(3523),M=ne(7005),x=ne(9265),Xe.exports=I=function(L){E(T,L);function T(O){T.__super__.constructor.call(this,null),this.name="?xml",O||(O={}),O.writer||(O.writer=new x),this.options=O,this.stringify=new M(O),this.isDocument=!0}return T.prototype.end=function(O){var W;return O?C(O)&&(W=O,O=this.options.writer.set(W)):O=this.options.writer,O.document(this)},T.prototype.toString=function(O){return this.options.writer.set(O).document(this)},T}(X)}).call(this)},3054:Xe=>{var ce=Xe.exports=function(ne,I){this._tokens=ne,this._startIndex=I||0};ce.prototype.head=function(){return this._tokens[this._startIndex]},ce.prototype.tail=function(ne){return new ce(this._tokens,this._startIndex+1)},ce.prototype.toArray=function(){return this._tokens.slice(this._startIndex)},ce.prototype.end=function(){return this._tokens[this._tokens.length-1]},ce.prototype.to=function(ne){var I=this.head().source,X=ne.head()||ne.end();return I.to(X.source)}},3197:Xe=>{"use strict";Xe.exports=function(ce){function ne(){return this.value}function I(){throw this.reason}ce.prototype.return=ce.prototype.thenReturn=function(X){return X instanceof ce&&X.suppressUnhandledRejections(),this._then(ne,void 0,void 0,{value:X},void 0)},ce.prototype.throw=ce.prototype.thenThrow=function(X){return this._then(I,void 0,void 0,{reason:X},void 0)},ce.prototype.catchThrow=function(X){if(arguments.length<=1)return this._then(void 0,I,void 0,{reason:X},void 0);var x=arguments[1],M=function(){throw x};return this.caught(X,M)},ce.prototype.catchReturn=function(X){if(arguments.length<=1)return X instanceof ce&&X.suppressUnhandledRejections(),this._then(void 0,ne,void 0,{value:X},void 0);var x=arguments[1];x instanceof ce&&x.suppressUnhandledRejections();var M=function(){return x};return this.caught(X,M)}}},3370:(Xe,ce)=>{ce.uriToZipEntryName=ne,ce.replaceFragment=I;function ne(X,x){return x.charAt(0)==="/"?x.substr(1):X+"/"+x}function I(X,x){var M=X.indexOf("#");return M!==-1&&(X=X.substring(0,M)),X+"#"+x}},3410:function(Xe,ce,ne){(function(){var I,X,x,M,C,E,R;R=ne(3626),C=R.assign,E=R.isFunction,I=ne(2954),X=ne(5251),M=ne(9265),x=ne(3556),Xe.exports.create=function(L,T,O,W){var D,q;if(L==null)throw new Error("Root element needs a name.");return W=C({},T,O,W),D=new I(W),q=D.element(L),W.headless||(D.declaration(W),(W.pubID!=null||W.sysID!=null)&&D.doctype(W)),q},Xe.exports.begin=function(L,T,O){var W;return E(L)&&(W=[L,T],T=W[0],O=W[1],L={}),T?new X(L,T,O):new I(L)},Xe.exports.stringWriter=function(L){return new M(L)},Xe.exports.streamWriter=function(L,T){return new x(L,T)}}).call(this)},3466:(Xe,ce,ne)=>{var I=ne(8430),X=ne(7042);ce.parser=function(C,E,R){var L={rule:D,leftAssociative:q,rightAssociative:F},T=new x(R.map(W)),O=I.firstOf(C,E);function W(J){return{name:J.name,rule:M(J.ruleBuilder.bind(null,L))}}function D(){return Y(T)}function q(J){return Y(T.untilExclusive(J))}function F(J){return Y(T.untilInclusive(J))}function Y(J){return G.bind(null,J)}function G(J,z){var te=O(z);return te.isSuccess()?J.apply(te):te}return L};function x(C){function E(W){return new x(C.slice(0,L().indexOf(W)))}function R(W){return new x(C.slice(0,L().indexOf(W)+1))}function L(){return C.map(function(W){return W.name})}function T(W){for(var D,q;;)if(D=O(W.remaining()),D.isSuccess())q=W.source().to(D.source()),W=X.success(D.value()(W.value(),q),D.remaining(),q);else return D.isFailure()?W:D}function O(W){return I.firstOf("infix",C.map(function(D){return D.rule}))(W)}return{apply:T,untilExclusive:E,untilInclusive:R}}ce.infix=function(C,E){function R(L){return ce.infix(C,function(T){var O=E(T);return function(W){var D=O(W);return D.map(function(q){return function(F,Y){return L(F,q,Y)}})}})}return{name:C,ruleBuilder:E,map:R}};var M=function(C){var E;return function(R){return E||(E=C()),E(R)}}},3523:function(Xe,ce,ne){(function(){var I,X,x,M,C,E,R,L,T,O,W,D,q,F,Y,G={}.hasOwnProperty;Y=ne(3626),F=Y.isObject,q=Y.isFunction,D=Y.isEmpty,W=Y.getValue,E=null,I=null,X=null,x=null,M=null,T=null,O=null,L=null,C=null,Xe.exports=R=function(){function J(z){this.parent=z,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.children=[],E||(E=ne(3879),I=ne(314),X=ne(4398),x=ne(4387),M=ne(1025),T=ne(7025),O=ne(4140),L=ne(9578),C=ne(2139))}return J.prototype.element=function(z,te,V){var de,P,p,K,me,pe,le,ue,A,N,oe;if(pe=null,te===null&&V==null&&(A=[{},null],te=A[0],V=A[1]),te==null&&(te={}),te=W(te),F(te)||(N=[te,V],V=N[0],te=N[1]),z!=null&&(z=W(z)),Array.isArray(z))for(p=0,le=z.length;p<le;p++)P=z[p],pe=this.element(P);else if(q(z))pe=this.element(z.apply());else if(F(z)){for(me in z)if(G.call(z,me))if(oe=z[me],q(oe)&&(oe=oe.apply()),F(oe)&&D(oe)&&(oe=null),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&me.indexOf(this.stringify.convertAttKey)===0)pe=this.attribute(me.substr(this.stringify.convertAttKey.length),oe);else if(!this.options.separateArrayItems&&Array.isArray(oe))for(K=0,ue=oe.length;K<ue;K++)P=oe[K],de={},de[me]=P,pe=this.element(de);else F(oe)?(pe=this.element(me),pe.element(oe)):pe=this.element(me,oe)}else this.options.skipNullNodes&&V===null?pe=this.dummy():!this.options.ignoreDecorators&&this.stringify.convertTextKey&&z.indexOf(this.stringify.convertTextKey)===0?pe=this.text(V):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&z.indexOf(this.stringify.convertCDataKey)===0?pe=this.cdata(V):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&z.indexOf(this.stringify.convertCommentKey)===0?pe=this.comment(V):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&z.indexOf(this.stringify.convertRawKey)===0?pe=this.raw(V):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&z.indexOf(this.stringify.convertPIKey)===0?pe=this.instruction(z.substr(this.stringify.convertPIKey.length),V):pe=this.node(z,te,V);if(pe==null)throw new Error("Could not create any elements with: "+z+". "+this.debugInfo());return pe},J.prototype.insertBefore=function(z,te,V){var de,P,p;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(z));return P=this.parent.children.indexOf(this),p=this.parent.children.splice(P),de=this.parent.element(z,te,V),Array.prototype.push.apply(this.parent.children,p),de},J.prototype.insertAfter=function(z,te,V){var de,P,p;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(z));return P=this.parent.children.indexOf(this),p=this.parent.children.splice(P+1),de=this.parent.element(z,te,V),Array.prototype.push.apply(this.parent.children,p),de},J.prototype.remove=function(){var z,te;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return z=this.parent.children.indexOf(this),[].splice.apply(this.parent.children,[z,z-z+1].concat(te=[])),this.parent},J.prototype.node=function(z,te,V){var de,P;return z!=null&&(z=W(z)),te||(te={}),te=W(te),F(te)||(P=[te,V],V=P[0],te=P[1]),de=new E(this,z,te),V!=null&&de.text(V),this.children.push(de),de},J.prototype.text=function(z){var te;return te=new O(this,z),this.children.push(te),this},J.prototype.cdata=function(z){var te;return te=new I(this,z),this.children.push(te),this},J.prototype.comment=function(z){var te;return te=new X(this,z),this.children.push(te),this},J.prototype.commentBefore=function(z){var te,V,de;return V=this.parent.children.indexOf(this),de=this.parent.children.splice(V),te=this.parent.comment(z),Array.prototype.push.apply(this.parent.children,de),this},J.prototype.commentAfter=function(z){var te,V,de;return V=this.parent.children.indexOf(this),de=this.parent.children.splice(V+1),te=this.parent.comment(z),Array.prototype.push.apply(this.parent.children,de),this},J.prototype.raw=function(z){var te;return te=new T(this,z),this.children.push(te),this},J.prototype.dummy=function(){var z;return z=new C(this),this.children.push(z),z},J.prototype.instruction=function(z,te){var V,de,P,p,K;if(z!=null&&(z=W(z)),te!=null&&(te=W(te)),Array.isArray(z))for(p=0,K=z.length;p<K;p++)V=z[p],this.instruction(V);else if(F(z))for(V in z)G.call(z,V)&&(de=z[V],this.instruction(V,de));else q(te)&&(te=te.apply()),P=new L(this,z,te),this.children.push(P);return this},J.prototype.instructionBefore=function(z,te){var V,de,P;return de=this.parent.children.indexOf(this),P=this.parent.children.splice(de),V=this.parent.instruction(z,te),Array.prototype.push.apply(this.parent.children,P),this},J.prototype.instructionAfter=function(z,te){var V,de,P;return de=this.parent.children.indexOf(this),P=this.parent.children.splice(de+1),V=this.parent.instruction(z,te),Array.prototype.push.apply(this.parent.children,P),this},J.prototype.declaration=function(z,te,V){var de,P;return de=this.document(),P=new x(de,z,te,V),de.children[0]instanceof x?de.children[0]=P:de.children.unshift(P),de.root()||de},J.prototype.doctype=function(z,te){var V,de,P,p,K,me,pe,le,ue,A;for(de=this.document(),P=new M(de,z,te),ue=de.children,p=K=0,pe=ue.length;K<pe;p=++K)if(V=ue[p],V instanceof M)return de.children[p]=P,P;for(A=de.children,p=me=0,le=A.length;me<le;p=++me)if(V=A[p],V.isRoot)return de.children.splice(p,0,P),P;return de.children.push(P),P},J.prototype.up=function(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent},J.prototype.root=function(){var z;for(z=this;z;){if(z.isDocument)return z.rootObject;if(z.isRoot)return z;z=z.parent}},J.prototype.document=function(){var z;for(z=this;z;){if(z.isDocument)return z;z=z.parent}},J.prototype.end=function(z){return this.document().end(z)},J.prototype.prev=function(){var z;for(z=this.parent.children.indexOf(this);z>0&&this.parent.children[z-1].isDummy;)z=z-1;if(z<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[z-1]},J.prototype.next=function(){var z;for(z=this.parent.children.indexOf(this);z<this.parent.children.length-1&&this.parent.children[z+1].isDummy;)z=z+1;if(z===-1||z===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[z+1]},J.prototype.importDocument=function(z){var te;return te=z.root().clone(),te.parent=this,te.isRoot=!1,this.children.push(te),this},J.prototype.debugInfo=function(z){var te,V;return z=z||this.name,z==null&&!((te=this.parent)!=null&&te.name)?"":z==null?"parent: <"+this.parent.name+">":(V=this.parent)!=null&&V.name?"node: <"+z+">, parent: <"+this.parent.name+">":"node: <"+z+">"},J.prototype.ele=function(z,te,V){return this.element(z,te,V)},J.prototype.nod=function(z,te,V){return this.node(z,te,V)},J.prototype.txt=function(z){return this.text(z)},J.prototype.dat=function(z){return this.cdata(z)},J.prototype.com=function(z){return this.comment(z)},J.prototype.ins=function(z,te){return this.instruction(z,te)},J.prototype.doc=function(){return this.document()},J.prototype.dec=function(z,te,V){return this.declaration(z,te,V)},J.prototype.dtd=function(z,te){return this.doctype(z,te)},J.prototype.e=function(z,te,V){return this.element(z,te,V)},J.prototype.n=function(z,te,V){return this.node(z,te,V)},J.prototype.t=function(z){return this.text(z)},J.prototype.d=function(z){return this.cdata(z)},J.prototype.c=function(z){return this.comment(z)},J.prototype.r=function(z){return this.raw(z)},J.prototype.i=function(z,te){return this.instruction(z,te)},J.prototype.u=function(){return this.up()},J.prototype.importXMLBuilder=function(z){return this.importDocument(z)},J}()}).call(this)},3556:function(Xe,ce,ne){(function(){var I,X,x,M,C,E,R,L,T,O,W,D,q,F,Y,G=function(z,te){for(var V in te)J.call(te,V)&&(z[V]=te[V]);function de(){this.constructor=z}return de.prototype=te.prototype,z.prototype=new de,z.__super__=te.prototype,z},J={}.hasOwnProperty;R=ne(4387),L=ne(1025),I=ne(314),X=ne(4398),O=ne(3879),D=ne(7025),F=ne(4140),W=ne(9578),T=ne(2139),x=ne(1388),M=ne(9235),C=ne(2012),E=ne(9721),Y=ne(6381),Xe.exports=q=function(z){G(te,z);function te(V,de){te.__super__.constructor.call(this,de),this.stream=V}return te.prototype.document=function(V){var de,P,p,K,me,pe,le,ue;for(pe=V.children,P=0,K=pe.length;P<K;P++)de=pe[P],de.isLastRootNode=!1;for(V.children[V.children.length-1].isLastRootNode=!0,le=V.children,ue=[],p=0,me=le.length;p<me;p++)if(de=le[p],!(de instanceof T))switch(!1){case!(de instanceof R):ue.push(this.declaration(de));break;case!(de instanceof L):ue.push(this.docType(de));break;case!(de instanceof X):ue.push(this.comment(de));break;case!(de instanceof W):ue.push(this.processingInstruction(de));break;default:ue.push(this.element(de))}return ue},te.prototype.attribute=function(V){return this.stream.write(" "+V.name+'="'+V.value+'"')},te.prototype.cdata=function(V,de){return this.stream.write(this.space(de)+"<![CDATA["+V.text+"]]>"+this.endline(V))},te.prototype.comment=function(V,de){return this.stream.write(this.space(de)+"<!-- "+V.text+" -->"+this.endline(V))},te.prototype.declaration=function(V,de){return this.stream.write(this.space(de)),this.stream.write('<?xml version="'+V.version+'"'),V.encoding!=null&&this.stream.write(' encoding="'+V.encoding+'"'),V.standalone!=null&&this.stream.write(' standalone="'+V.standalone+'"'),this.stream.write(this.spacebeforeslash+"?>"),this.stream.write(this.endline(V))},te.prototype.docType=function(V,de){var P,p,K,me;if(de||(de=0),this.stream.write(this.space(de)),this.stream.write("<!DOCTYPE "+V.root().name),V.pubID&&V.sysID?this.stream.write(' PUBLIC "'+V.pubID+'" "'+V.sysID+'"'):V.sysID&&this.stream.write(' SYSTEM "'+V.sysID+'"'),V.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(V)),me=V.children,p=0,K=me.length;p<K;p++)switch(P=me[p],!1){case!(P instanceof x):this.dtdAttList(P,de+1);break;case!(P instanceof M):this.dtdElement(P,de+1);break;case!(P instanceof C):this.dtdEntity(P,de+1);break;case!(P instanceof E):this.dtdNotation(P,de+1);break;case!(P instanceof I):this.cdata(P,de+1);break;case!(P instanceof X):this.comment(P,de+1);break;case!(P instanceof W):this.processingInstruction(P,de+1);break;default:throw new Error("Unknown DTD node type: "+P.constructor.name)}this.stream.write("]")}return this.stream.write(this.spacebeforeslash+">"),this.stream.write(this.endline(V))},te.prototype.element=function(V,de){var P,p,K,me,pe,le,ue,A;de||(de=0),A=this.space(de),this.stream.write(A+"<"+V.name),le=V.attributes;for(pe in le)J.call(le,pe)&&(P=le[pe],this.attribute(P));if(V.children.length===0||V.children.every(function(N){return N.value===""}))this.allowEmpty?this.stream.write("></"+V.name+">"):this.stream.write(this.spacebeforeslash+"/>");else if(this.pretty&&V.children.length===1&&V.children[0].value!=null)this.stream.write(">"),this.stream.write(V.children[0].value),this.stream.write("</"+V.name+">");else{for(this.stream.write(">"+this.newline),ue=V.children,K=0,me=ue.length;K<me;K++)switch(p=ue[K],!1){case!(p instanceof I):this.cdata(p,de+1);break;case!(p instanceof X):this.comment(p,de+1);break;case!(p instanceof O):this.element(p,de+1);break;case!(p instanceof D):this.raw(p,de+1);break;case!(p instanceof F):this.text(p,de+1);break;case!(p instanceof W):this.processingInstruction(p,de+1);break;case!(p instanceof T):break;default:throw new Error("Unknown XML node type: "+p.constructor.name)}this.stream.write(A+"</"+V.name+">")}return this.stream.write(this.endline(V))},te.prototype.processingInstruction=function(V,de){return this.stream.write(this.space(de)+"<?"+V.target),V.value&&this.stream.write(" "+V.value),this.stream.write(this.spacebeforeslash+"?>"+this.endline(V))},te.prototype.raw=function(V,de){return this.stream.write(this.space(de)+V.value+this.endline(V))},te.prototype.text=function(V,de){return this.stream.write(this.space(de)+V.value+this.endline(V))},te.prototype.dtdAttList=function(V,de){return this.stream.write(this.space(de)+"<!ATTLIST "+V.elementName+" "+V.attributeName+" "+V.attributeType),V.defaultValueType!=="#DEFAULT"&&this.stream.write(" "+V.defaultValueType),V.defaultValue&&this.stream.write(' "'+V.defaultValue+'"'),this.stream.write(this.spacebeforeslash+">"+this.endline(V))},te.prototype.dtdElement=function(V,de){return this.stream.write(this.space(de)+"<!ELEMENT "+V.name+" "+V.value),this.stream.write(this.spacebeforeslash+">"+this.endline(V))},te.prototype.dtdEntity=function(V,de){return this.stream.write(this.space(de)+"<!ENTITY"),V.pe&&this.stream.write(" %"),this.stream.write(" "+V.name),V.value?this.stream.write(' "'+V.value+'"'):(V.pubID&&V.sysID?this.stream.write(' PUBLIC "'+V.pubID+'" "'+V.sysID+'"'):V.sysID&&this.stream.write(' SYSTEM "'+V.sysID+'"'),V.nData&&this.stream.write(" NDATA "+V.nData)),this.stream.write(this.spacebeforeslash+">"+this.endline(V))},te.prototype.dtdNotation=function(V,de){return this.stream.write(this.space(de)+"<!NOTATION "+V.name),V.pubID&&V.sysID?this.stream.write(' PUBLIC "'+V.pubID+'" "'+V.sysID+'"'):V.pubID?this.stream.write(' PUBLIC "'+V.pubID+'"'):V.sysID&&this.stream.write(' SYSTEM "'+V.sysID+'"'),this.stream.write(this.spacebeforeslash+">"+this.endline(V))},te.prototype.endline=function(V){return V.isLastRootNode?"":this.newline},te}(Y)}).call(this)},3623:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X,x,M,C,E){var R=ne(7443),L=R.canEvaluate,T=R.tryCatch,O=R.errorObj,W;if(L){for(var D=function(te){return new Function("value","holder",`                             
            'use strict';                                                    
            holder.pIndex = value;                                           
            holder.checkFulfillment(this);                                   
            `.replace(/Index/g,te))},q=function(te){return new Function("promise","holder",`                           
            'use strict';                                                    
            holder.pIndex = promise;                                         
            `.replace(/Index/g,te))},F=function(te){for(var V=new Array(te),de=0;de<V.length;++de)V[de]="this.p"+(de+1);var P=V.join(" = ")+" = null;",p=`var promise;
`+V.map(function(le){return`                                                         
                promise = `+le+`;                                      
                if (promise instanceof Promise) {                            
                    promise.cancel();                                        
                }                                                            
            `}).join(`
`),K=V.join(", "),me="Holder$"+te,pe=`return function(tryCatch, errorObj, Promise, async) {    
            'use strict';                                                    
            function [TheName](fn) {                                         
                [TheProperties]                                              
                this.fn = fn;                                                
                this.asyncNeeded = true;                                     
                this.now = 0;                                                
            }                                                                
                                                                             
            [TheName].prototype._callFunction = function(promise) {          
                promise._pushContext();                                      
                var ret = tryCatch(this.fn)([ThePassedArguments]);           
                promise._popContext();                                       
                if (ret === errorObj) {                                      
                    promise._rejectCallback(ret.e, false);                   
                } else {                                                     
                    promise._resolveCallback(ret);                           
                }                                                            
            };                                                               
                                                                             
            [TheName].prototype.checkFulfillment = function(promise) {       
                var now = ++this.now;                                        
                if (now === [TheTotal]) {                                    
                    if (this.asyncNeeded) {                                  
                        async.invoke(this._callFunction, this, promise);     
                    } else {                                                 
                        this._callFunction(promise);                         
                    }                                                        
                                                                             
                }                                                            
            };                                                               
                                                                             
            [TheName].prototype._resultCancelled = function() {              
                [CancellationCode]                                           
            };                                                               
                                                                             
            return [TheName];                                                
        }(tryCatch, errorObj, Promise, async);                               
        `;return pe=pe.replace(/\[TheName\]/g,me).replace(/\[TheTotal\]/g,te).replace(/\[ThePassedArguments\]/g,K).replace(/\[TheProperties\]/g,P).replace(/\[CancellationCode\]/g,p),new Function("tryCatch","errorObj","Promise","async",pe)(T,O,I,C)},Y=[],G=[],J=[],z=0;z<8;++z)Y.push(F(z+1)),G.push(D(z+1)),J.push(q(z+1));W=function(te){this._reject(te)}}I.join=function(){var te=arguments.length-1,V;if(te>0&&typeof arguments[te]=="function"&&(V=arguments[te],te<=8&&L)){var oe=new I(M);oe._captureStackTrace();for(var de=Y[te-1],P=new de(V),p=G,K=0;K<te;++K){var me=x(arguments[K],oe);if(me instanceof I){me=me._target();var pe=me._bitField;pe&50397184?pe&33554432?p[K].call(oe,me._value(),P):pe&16777216?oe._reject(me._reason()):oe._cancel():(me._then(p[K],W,void 0,oe,P),J[K](me,P),P.asyncNeeded=!1)}else p[K].call(oe,me,P)}if(!oe._isFateSealed()){if(P.asyncNeeded){var le=E();le!==null&&(P.fn=R.domainBind(le,P.fn))}oe._setAsyncGuaranteed(),oe._setOnCancel(P)}return oe}for(var ue=arguments.length,A=new Array(ue),N=0;N<ue;++N)A[N]=arguments[N];V&&A.pop();var oe=new X(A).promise();return V!==void 0?oe.spread(V):oe}}},3626:function(Xe){(function(){var ce,ne,I,X,x,M,C,E=[].slice,R={}.hasOwnProperty;ce=function(){var L,T,O,W,D,q;if(q=arguments[0],D=2<=arguments.length?E.call(arguments,1):[],x(Object.assign))Object.assign.apply(null,arguments);else for(L=0,O=D.length;L<O;L++)if(W=D[L],W!=null)for(T in W)R.call(W,T)&&(q[T]=W[T]);return q},x=function(L){return!!L&&Object.prototype.toString.call(L)==="[object Function]"},M=function(L){var T;return!!L&&((T=typeof L)=="function"||T==="object")},I=function(L){return x(Array.isArray)?Array.isArray(L):Object.prototype.toString.call(L)==="[object Array]"},X=function(L){var T;if(I(L))return!L.length;for(T in L)if(R.call(L,T))return!1;return!0},C=function(L){var T,O;return M(L)&&(O=Object.getPrototypeOf(L))&&(T=O.constructor)&&typeof T=="function"&&T instanceof T&&Function.prototype.toString.call(T)===Function.prototype.toString.call(Object)},ne=function(L){return x(L.valueOf)?L.valueOf():L},Xe.exports.assign=ce,Xe.exports.isFunction=x,Xe.exports.isObject=M,Xe.exports.isArray=I,Xe.exports.isEmpty=X,Xe.exports.isPlainObject=C,Xe.exports.getValue=ne}).call(this)},3746:(Xe,ce,ne)=>{var I=ne(8291),X=ne(9482)();ce.defer=x,ce.when=X.resolve,ce.resolve=X.resolve,ce.all=X.all,ce.props=X.props,ce.reject=X.reject,ce.promisify=X.promisify,ce.mapSeries=X.mapSeries,ce.attempt=X.attempt,ce.nfcall=function(M){var C=Array.prototype.slice.call(arguments,1),E=X.promisify(M);return E.apply(null,C)},X.prototype.fail=X.prototype.caught,X.prototype.also=function(M){return this.then(function(C){var E=I.extend({},C,M(C));return X.props(E)})};function x(){var M,C,E=new X.Promise(function(R,L){M=R,C=L});return{resolve:M,reject:C,promise:E}}},3837:Xe=>{"use strict";Xe.exports=function(ce,ne){var I=ce.map;ce.prototype.filter=function(X,x){return I(this,X,x,ne)},ce.filter=function(X,x,M){return I(X,x,M,ne)}}},3879:function(Xe,ce,ne){(function(){var I,X,x,M,C,E,R,L=function(O,W){for(var D in W)T.call(W,D)&&(O[D]=W[D]);function q(){this.constructor=O}return q.prototype=W.prototype,O.prototype=new q,O.__super__=W.prototype,O},T={}.hasOwnProperty;R=ne(3626),E=R.isObject,C=R.isFunction,M=R.getValue,x=ne(3523),I=ne(591),Xe.exports=X=function(O){L(W,O);function W(D,q,F){if(W.__super__.constructor.call(this,D),q==null)throw new Error("Missing element name. "+this.debugInfo());this.name=this.stringify.eleName(q),this.attributes={},F!=null&&this.attribute(F),D.isDocument&&(this.isRoot=!0,this.documentObject=D,D.rootObject=this)}return W.prototype.clone=function(){var D,q,F,Y;F=Object.create(this),F.isRoot&&(F.documentObject=null),F.attributes={},Y=this.attributes;for(q in Y)T.call(Y,q)&&(D=Y[q],F.attributes[q]=D.clone());return F.children=[],this.children.forEach(function(G){var J;return J=G.clone(),J.parent=F,F.children.push(J)}),F},W.prototype.attribute=function(D,q){var F,Y;if(D!=null&&(D=M(D)),E(D))for(F in D)T.call(D,F)&&(Y=D[F],this.attribute(F,Y));else C(q)&&(q=q.apply()),(!this.options.skipNullAttributes||q!=null)&&(this.attributes[D]=new I(this,D,q));return this},W.prototype.removeAttribute=function(D){var q,F,Y;if(D==null)throw new Error("Missing attribute name. "+this.debugInfo());if(D=M(D),Array.isArray(D))for(F=0,Y=D.length;F<Y;F++)q=D[F],delete this.attributes[q];else delete this.attributes[D];return this},W.prototype.toString=function(D){return this.options.writer.set(D).element(this)},W.prototype.att=function(D,q){return this.attribute(D,q)},W.prototype.a=function(D,q){return this.attribute(D,q)},W}(x)}).call(this)},3927:(Xe,ce,ne)=>{var I=ne(8291),X=ne(9354);function x(G){return M(O(G))}function M(G){var J=[];return G.map(C).forEach(function(z){T(J,z)}),J}function C(G){return E[G.type](G)}var E={element:R,text:L,forceWrite:L};function R(G){return X.elementWithTag(G.tag,M(G.children))}function L(G){return G}function T(G,J){var z=G[G.length-1];J.type==="element"&&!J.tag.fresh&&z&&z.type==="element"&&J.tag.matchesElement(z.tag)?(J.tag.separator&&T(z.children,X.text(J.tag.separator)),J.children.forEach(function(te){T(z.children,te)})):G.push(J)}function O(G){return W(G,function(J){return D[J.type](J)})}function W(G,J){return I.flatten(I.map(G,J),!0)}var D={element:F,text:Y,forceWrite:q};function q(G){return[G]}function F(G){var J=O(G.children);return J.length===0&&!X.isVoidElement(G)?[]:[X.elementWithTag(G.tag,J)]}function Y(G){return G.value.length===0?[]:[G]}Xe.exports=x},3969:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X,x,M,C,E){var R=I._getDomain,L=ne(7443),T=L.tryCatch;function O(Y,G,J,z){this.constructor$(Y);var te=R();this._fn=te===null?G:L.domainBind(te,G),J!==void 0&&(J=I.resolve(J),J._attachCancellationCallback(this)),this._initialValue=J,this._currentCancellable=null,z===C?this._eachValues=Array(this._length):z===0?this._eachValues=null:this._eachValues=void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}L.inherits(O,X),O.prototype._gotAccum=function(Y){this._eachValues!==void 0&&this._eachValues!==null&&Y!==C&&this._eachValues.push(Y)},O.prototype._eachComplete=function(Y){return this._eachValues!==null&&this._eachValues.push(Y),this._eachValues},O.prototype._init=function(){},O.prototype._resolveEmptyArray=function(){this._resolve(this._eachValues!==void 0?this._eachValues:this._initialValue)},O.prototype.shouldCopyValues=function(){return!1},O.prototype._resolve=function(Y){this._promise._resolveCallback(Y),this._values=null},O.prototype._resultCancelled=function(Y){if(Y===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof I&&this._currentCancellable.cancel(),this._initialValue instanceof I&&this._initialValue.cancel())},O.prototype._iterate=function(Y){this._values=Y;var G,J,z=Y.length;if(this._initialValue!==void 0?(G=this._initialValue,J=0):(G=I.resolve(Y[0]),J=1),this._currentCancellable=G,!G.isRejected())for(;J<z;++J){var te={accum:null,value:Y[J],index:J,length:z,array:this};G=G._then(q,void 0,void 0,te,void 0)}this._eachValues!==void 0&&(G=G._then(this._eachComplete,void 0,void 0,this,void 0)),G._then(W,W,void 0,G,this)},I.prototype.reduce=function(Y,G){return D(this,Y,G,null)},I.reduce=function(Y,G,J,z){return D(Y,G,J,z)};function W(Y,G){this.isFulfilled()?G._resolve(Y):G._reject(Y)}function D(Y,G,J,z){if(typeof G!="function")return x("expecting a function but got "+L.classString(G));var te=new O(Y,G,J,z);return te.promise()}function q(Y){this.accum=Y,this.array._gotAccum(Y);var G=M(this.value,this.array._promise);return G instanceof I?(this.array._currentCancellable=G,G._then(F,void 0,void 0,this,void 0)):F.call(this,G)}function F(Y){var G=this.array,J=G._promise,z=T(G._fn);J._pushContext();var te;G._eachValues!==void 0?te=z.call(J._boundValue(),Y,this.index,this.length):te=z.call(J._boundValue(),this.accum,Y,this.index,this.length),te instanceof I&&(G._currentCancellable=te);var V=J._popContext();return E.checkForgottenReturns(te,V,G._eachValues!==void 0?"Promise.each":"Promise.reduce",J),te}}},3970:(Xe,ce,ne)=>{var I=ne(8291);ce.readNumberingXml=x,ce.Numbering=X,ce.defaultNumbering=new X({},{});function X(R,L,T){var O=I.flatten(I.values(L).map(function(F){return I.values(F.levels)})),W=I.indexBy(O.filter(function(F){return F.paragraphStyleId!=null}),"paragraphStyleId");function D(F,Y){var G=R[F];if(G){var J=L[G.abstractNumId];if(J){if(J.numStyleLink==null)return L[G.abstractNumId].levels[Y];var z=T.findNumberingStyleById(J.numStyleLink);return D(z.numId,Y)}else return null}else return null}function q(F){return W[F]||null}return{findLevel:D,findLevelByParagraphStyleId:q}}function x(R,L){if(!L||!L.styles)throw new Error("styles is missing");var T=M(R),O=E(R,T);return new X(O,T,L.styles)}function M(R){var L={};return R.getElementsByTagName("w:abstractNum").forEach(function(T){var O=T.attributes["w:abstractNumId"];L[O]=C(T)}),L}function C(R){var L={},T=null;R.getElementsByTagName("w:lvl").forEach(function(W){var D=W.attributes["w:ilvl"],q=W.firstOrEmpty("w:numFmt").attributes["w:val"],F=q!=="bullet",Y=W.firstOrEmpty("w:pStyle").attributes["w:val"];D===void 0?T={isOrdered:F,level:"0",paragraphStyleId:Y}:L[D]={isOrdered:F,level:D,paragraphStyleId:Y}}),T!==null&&L[T.level]===void 0&&(L[T.level]=T);var O=R.firstOrEmpty("w:numStyleLink").attributes["w:val"];return{levels:L,numStyleLink:O}}function E(R){var L={};return R.getElementsByTagName("w:num").forEach(function(T){var O=T.attributes["w:numId"],W=T.first("w:abstractNumId").attributes["w:val"];L[O]={abstractNumId:W}}),L}},4140:function(Xe,ce,ne){(function(){var I,X,x=function(C,E){for(var R in E)M.call(E,R)&&(C[R]=E[R]);function L(){this.constructor=C}return L.prototype=E.prototype,C.prototype=new L,C.__super__=E.prototype,C},M={}.hasOwnProperty;I=ne(3523),Xe.exports=X=function(C){x(E,C);function E(R,L){if(E.__super__.constructor.call(this,R),L==null)throw new Error("Missing element text. "+this.debugInfo());this.value=this.stringify.eleText(L)}return E.prototype.clone=function(){return Object.create(this)},E.prototype.toString=function(R){return this.options.writer.set(R).text(this)},E}(I)}).call(this)},4208:Xe=>{"use strict";Xe.exports=function(ce){var ne=!1,I=[];ce.prototype._promiseCreated=function(){},ce.prototype._pushContext=function(){},ce.prototype._popContext=function(){return null},ce._peekContext=ce.prototype._peekContext=function(){};function X(){this._trace=new X.CapturedTrace(M())}X.prototype._pushContext=function(){this._trace!==void 0&&(this._trace._promiseCreated=null,I.push(this._trace))},X.prototype._popContext=function(){if(this._trace!==void 0){var C=I.pop(),E=C._promiseCreated;return C._promiseCreated=null,E}return null};function x(){if(ne)return new X}function M(){var C=I.length-1;if(C>=0)return I[C]}return X.CapturedTrace=null,X.create=x,X.deactivateLongStackTraces=function(){},X.activateLongStackTraces=function(){var C=ce.prototype._pushContext,E=ce.prototype._popContext,R=ce._peekContext,L=ce.prototype._peekContext,T=ce.prototype._promiseCreated;X.deactivateLongStackTraces=function(){ce.prototype._pushContext=C,ce.prototype._popContext=E,ce._peekContext=R,ce.prototype._peekContext=L,ce.prototype._promiseCreated=T,ne=!1},ne=!0,ce.prototype._pushContext=X.prototype._pushContext,ce.prototype._popContext=X.prototype._popContext,ce._peekContext=ce.prototype._peekContext=M,ce.prototype._promiseCreated=function(){var O=this._peekContext();O&&O._promiseCreated==null&&(O._promiseCreated=this)}},X}},4305:Xe=>{var ce=Xe.exports=function(I,X){var x={asString:function(){return I},range:function(M,C){return new ne(I,X,M,C)}};return x},ne=function(I,X,x,M){this._string=I,this._description=X,this._startIndex=x,this._endIndex=M};ne.prototype.to=function(I){return new ne(this._string,this._description,this._startIndex,I._endIndex)},ne.prototype.describe=function(){var I=this._position(),X=this._description?this._description+`
`:"";return X+"Line number: "+I.lineNumber+`
Character number: `+I.characterNumber},ne.prototype.lineNumber=function(){return this._position().lineNumber},ne.prototype.characterNumber=function(){return this._position().characterNumber},ne.prototype._position=function(){for(var I=this,X=0,x=function(){return I._string.indexOf(`
`,X)},M=1;x()!==-1&&x()<this._startIndex;)X=x()+1,M+=1;var C=this._startIndex-X+1;return{lineNumber:M,characterNumber:C}}},4346:(Xe,ce,ne)=>{var I=ne(8291),X=ne(3746),x=ne(8994);ce.imgElement=M;function M(C){return function(E,R){return X.when(C(E)).then(function(L){var T={};return E.altText&&(T.alt=E.altText),I.extend(T,L),[x.freshElement("img",T)]})}}ce.inline=ce.imgElement,ce.dataUri=M(function(C){return C.readAsBase64String().then(function(E){return{src:"data:"+C.contentType+";base64,"+E}})})},4361:(Xe,ce,ne)=>{var I,X=ne(8291),x=ne(3746),M=ne(1088);I=E,ce.V=R;var C={"http://schemas.openxmlformats.org/wordprocessingml/2006/main":"w","http://schemas.openxmlformats.org/officeDocument/2006/relationships":"r","http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing":"wp","http://schemas.openxmlformats.org/drawingml/2006/main":"a","http://schemas.openxmlformats.org/drawingml/2006/picture":"pic","http://purl.oclc.org/ooxml/wordprocessingml/main":"w","http://purl.oclc.org/ooxml/officeDocument/relationships":"r","http://purl.oclc.org/ooxml/drawingml/wordprocessingDrawing":"wp","http://purl.oclc.org/ooxml/drawingml/main":"a","http://purl.oclc.org/ooxml/drawingml/picture":"pic","http://schemas.openxmlformats.org/package/2006/content-types":"content-types","http://schemas.openxmlformats.org/package/2006/relationships":"relationships","http://schemas.openxmlformats.org/markup-compatibility/2006":"mc","urn:schemas-microsoft-com:vml":"v","urn:schemas-microsoft-com:office:word":"office-word","http://schemas.microsoft.com/office/word/2010/wordml":"wordml"};function E(O){return M.readString(O,C).then(function(W){return T(W)[0]})}function R(O,W){return O.exists(W)?O.read(W,"utf-8").then(L).then(E):x.resolve(null)}function L(O){return O.replace(/^\uFEFF/g,"")}function T(O){return O.type==="element"?O.name==="mc:AlternateContent"?O.firstOrEmpty("mc:Fallback").children:(O.children=X.flatten(O.children.map(T,!0)),[O]):[O]}},4387:function(Xe,ce,ne){(function(){var I,X,x,M=function(E,R){for(var L in R)C.call(R,L)&&(E[L]=R[L]);function T(){this.constructor=E}return T.prototype=R.prototype,E.prototype=new T,E.__super__=R.prototype,E},C={}.hasOwnProperty;x=ne(3626).isObject,X=ne(3523),Xe.exports=I=function(E){M(R,E);function R(L,T,O,W){var D;R.__super__.constructor.call(this,L),x(T)&&(D=T,T=D.version,O=D.encoding,W=D.standalone),T||(T="1.0"),this.version=this.stringify.xmlVersion(T),O!=null&&(this.encoding=this.stringify.xmlEncoding(O)),W!=null&&(this.standalone=this.stringify.xmlStandalone(W))}return R.prototype.toString=function(L){return this.options.writer.set(L).declaration(this)},R}(X)}).call(this)},4390:(Xe,ce,ne)=>{var I=ne(8291);ce.writer=X;function X(L){return L=L||{},L.prettyPrint?M():C()}var x={div:!0,p:!0,ul:!0,li:!0};function M(){var L=0,T="  ",O=[],W=!0,D=!1,q=C();function F(P,p){x[P]&&V(),O.push(P),q.open(P,p),x[P]&&L++,W=!1}function Y(P){x[P]&&(L--,V()),O.pop(),q.close(P)}function G(P){te();var p=de()?P:P.replace(`
`,`
`+T);q.text(p)}function J(P,p){V(),q.selfClosing(P,p)}function z(){return O.length===0||x[O[O.length-1]]}function te(){D||(V(),D=!0)}function V(){if(D=!1,!W&&z()&&!de()){q._append(`
`);for(var P=0;P<L;P++)q._append(T)}}function de(){return I.some(O,function(P){return P==="pre"})}return{asString:q.asString,open:F,close:Y,text:G,selfClosing:J}}function C(){var L=[];function T(G,J){var z=D(J);L.push("<"+G+z+">")}function O(G){L.push("</"+G+">")}function W(G,J){var z=D(J);L.push("<"+G+z+" />")}function D(G){return I.map(G,function(J,z){return" "+z+'="'+R(J)+'"'}).join("")}function q(G){L.push(E(G))}function F(G){L.push(G)}function Y(){return L.join("")}return{asString:Y,open:T,close:O,text:q,selfClosing:W,_append:F}}function E(L){return L.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function R(L){return L.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},4398:function(Xe,ce,ne){(function(){var I,X,x=function(C,E){for(var R in E)M.call(E,R)&&(C[R]=E[R]);function L(){this.constructor=C}return L.prototype=E.prototype,C.prototype=new L,C.__super__=E.prototype,C},M={}.hasOwnProperty;X=ne(3523),Xe.exports=I=function(C){x(E,C);function E(R,L){if(E.__super__.constructor.call(this,R),L==null)throw new Error("Missing comment text. "+this.debugInfo());this.text=this.stringify.comment(L)}return E.prototype.clone=function(){return Object.create(this)},E.prototype.toString=function(R){return this.options.writer.set(R).comment(this)},E}(X)}).call(this)},4501:(Xe,ce,ne)=>{var I=ne(8291);ce.Element=x,ce.element=function(E,R,L){return new x(E,R,L)},ce.text=function(E){return{type:"text",value:E}};var X=ce.emptyElement={first:function(){return null},firstOrEmpty:function(){return X},attributes:{},children:[]};function x(E,R,L){this.type="element",this.name=E,this.attributes=R||{},this.children=L||[]}x.prototype.first=function(E){return I.find(this.children,function(R){return R.name===E})},x.prototype.firstOrEmpty=function(E){return this.first(E)||X},x.prototype.getElementsByTagName=function(E){var R=I.filter(this.children,function(L){return L.name===E});return C(R)},x.prototype.text=function(){if(this.children.length===0)return"";if(this.children.length!==1||this.children[0].type!=="text")throw new Error("Not implemented");return this.children[0].value};var M={getElementsByTagName:function(E){return C(I.flatten(this.map(function(R){return R.getElementsByTagName(E)},!0)))}};function C(E){return I.extend(E,M)}},4793:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I){var X=ne(7443),x=I._async,M=X.tryCatch,C=X.errorObj;function E(T,O){var W=this;if(!X.isArray(T))return R.call(W,T,O);var D=M(O).apply(W._boundValue(),[null].concat(T));D===C&&x.throwLater(D.e)}function R(T,O){var W=this,D=W._boundValue(),q=T===void 0?M(O).call(D,null):M(O).call(D,null,T);q===C&&x.throwLater(q.e)}function L(T,O){var W=this;if(!T){var D=new Error(T+"");D.cause=T,T=D}var q=M(O).call(W._boundValue(),T);q===C&&x.throwLater(q.e)}I.prototype.asCallback=I.prototype.nodeify=function(T,O){if(typeof T=="function"){var W=R;O!==void 0&&Object(O).spread&&(W=E),this._then(W,L,void 0,this,T)}return this}}},4927:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X){var x={},M=ne(7443),C=ne(5644),E=M.withAppended,R=M.maybeWrapAsError,L=M.canEvaluate,T=ne(9556).TypeError,O="Async",W={__isPromisified__:!0},D=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],q=new RegExp("^(?:"+D.join("|")+")$"),F=function(N){return M.isIdentifier(N)&&N.charAt(0)!=="_"&&N!=="constructor"};function Y(N){return!q.test(N)}function G(N){try{return N.__isPromisified__===!0}catch(oe){return!1}}function J(N,oe,ge){var ve=M.getDataPropertyOrDefault(N,oe+ge,W);return ve?G(ve):!1}function z(N,oe,ge){for(var ve=0;ve<N.length;ve+=2){var ke=N[ve];if(ge.test(ke)){for(var Ye=ke.replace(ge,""),Le=0;Le<N.length;Le+=2)if(N[Le]===Ye)throw new T(`Cannot promisify an API that has normal methods with '%s'-suffix

    See http://goo.gl/MqrFmX
`.replace("%s",oe))}}}function te(N,oe,ge,ve){for(var ke=M.inheritedDataKeys(N),Ye=[],Le=0;Le<ke.length;++Le){var Fe=ke[Le],st=N[Fe],Ee=ve===F?!0:F(Fe,st,N);typeof st=="function"&&!G(st)&&!J(N,Fe,oe)&&ve(Fe,st,N,Ee)&&Ye.push(Fe,st)}return z(Ye,oe,ge),Ye}var V=function(N){return N.replace(/([$])/,"\\$")},de,P=function(N){for(var oe=[N],ge=Math.max(0,N-1-3),ve=N-1;ve>=ge;--ve)oe.push(ve);for(var ve=N+1;ve<=3;++ve)oe.push(ve);return oe},p=function(N){return M.filledRange(N,"_arg","")},K=function(N){return M.filledRange(Math.max(N,3),"_arg","")},me=function(N){return typeof N.length=="number"?Math.max(Math.min(N.length,1024),0):0};de=function(N,oe,ge,ve,ke,Ye){var Le=Math.max(0,me(ve)-1),Fe=P(Le),st=typeof N=="string"||oe===x;function Ee(_t){var jt=p(_t).join(", "),zt=_t>0?", ":"",mn;return st?mn=`ret = callback.call(this, {{args}}, nodeback); break;
`:mn=oe===void 0?`ret = callback({{args}}, nodeback); break;
`:`ret = callback.call(receiver, {{args}}, nodeback); break;
`,mn.replace("{{args}}",jt).replace(", ",zt)}function pt(){for(var _t="",jt=0;jt<Fe.length;++jt)_t+="case "+Fe[jt]+":"+Ee(Fe[jt]);return _t+=`                                                             
        default:                                                             
            var args = new Array(len + 1);                                   
            var i = 0;                                                       
            for (var i = 0; i < len; ++i) {                                  
               args[i] = arguments[i];                                       
            }                                                                
            args[i] = nodeback;                                              
            [CodeForCall]                                                    
            break;                                                           
        `.replace("[CodeForCall]",st?`ret = callback.apply(this, args);
`:`ret = callback.apply(receiver, args);
`),_t}var $t=typeof N=="string"?"this != null ? this['"+N+"'] : fn":"fn",It=`'use strict';                                                
        var ret = function (Parameters) {                                    
            'use strict';                                                    
            var len = arguments.length;                                      
            var promise = new Promise(INTERNAL);                             
            promise._captureStackTrace();                                    
            var nodeback = nodebackForPromise(promise, `+Ye+`);   
            var ret;                                                         
            var callback = tryCatch([GetFunctionCode]);                      
            switch(len) {                                                    
                [CodeForSwitchCase]                                          
            }                                                                
            if (ret === errorObj) {                                          
                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);
            }                                                                
            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     
            return promise;                                                  
        };                                                                   
        notEnumerableProp(ret, '__isPromisified__', true);                   
        return ret;                                                          
    `.replace("[CodeForSwitchCase]",pt()).replace("[GetFunctionCode]",$t);return It=It.replace("Parameters",K(Le)),new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL",It)(I,ve,oe,E,R,C,M.tryCatch,M.errorObj,M.notEnumerableProp,X)};function pe(N,oe,ge,ve,ke,Ye){var Le=function(){return this}(),Fe=N;typeof Fe=="string"&&(N=ve);function st(){var Ee=oe;oe===x&&(Ee=this);var pt=new I(X);pt._captureStackTrace();var $t=typeof Fe=="string"&&this!==Le?this[Fe]:N,It=C(pt,Ye);try{$t.apply(Ee,E(arguments,It))}catch(_t){pt._rejectCallback(R(_t),!0,!0)}return pt._isFateSealed()||pt._setAsyncGuaranteed(),pt}return M.notEnumerableProp(st,"__isPromisified__",!0),st}var le=L?de:pe;function ue(N,oe,ge,ve,ke){for(var Ye=new RegExp(V(oe)+"$"),Le=te(N,oe,Ye,ge),Fe=0,st=Le.length;Fe<st;Fe+=2){var Ee=Le[Fe],pt=Le[Fe+1],$t=Ee+oe;if(ve===le)N[$t]=le(Ee,x,Ee,pt,oe,ke);else{var It=ve(pt,function(){return le(Ee,x,Ee,pt,oe,ke)});M.notEnumerableProp(It,"__isPromisified__",!0),N[$t]=It}}return M.toFastProperties(N),N}function A(N,oe,ge){return le(N,oe,void 0,N,null,ge)}I.promisify=function(N,oe){if(typeof N!="function")throw new T("expecting a function but got "+M.classString(N));if(G(N))return N;oe=Object(oe);var ge=oe.context===void 0?x:oe.context,ve=!!oe.multiArgs,ke=A(N,ge,ve);return M.copyDescriptors(N,ke,Y),ke},I.promisifyAll=function(N,oe){if(typeof N!="function"&&typeof N!="object")throw new T(`the target of promisifyAll must be an object or a function

    See http://goo.gl/MqrFmX
`);oe=Object(oe);var ge=!!oe.multiArgs,ve=oe.suffix;typeof ve!="string"&&(ve=O);var ke=oe.filter;typeof ke!="function"&&(ke=F);var Ye=oe.promisifier;if(typeof Ye!="function"&&(Ye=le),!M.isIdentifier(ve))throw new RangeError(`suffix must be a valid identifier

    See http://goo.gl/MqrFmX
`);for(var Le=M.inheritedDataKeys(N),Fe=0;Fe<Le.length;++Fe){var st=N[Le[Fe]];Le[Fe]!=="constructor"&&M.isClass(st)&&(ue(st.prototype,ve,ke,Ye,ge),ue(st,ve,ke,Ye,ge))}return ue(N,ve,ke,Ye,ge)}}},4951:(Xe,ce)=>{ce.readStylesXml=I,ce.Styles=ne,ce.defaultStyles=new ne({},{});function ne(E,R,L,T){return{findParagraphStyleById:function(O){return E[O]},findCharacterStyleById:function(O){return R[O]},findTableStyleById:function(O){return L[O]},findNumberingStyleById:function(O){return T[O]}}}ne.EMPTY=new ne({},{},{},{});function I(E){var R={},L={},T={},O={},W={paragraph:R,character:L,table:T,numbering:O};return E.getElementsByTagName("w:style").forEach(function(D){var q=X(D),F=W[q.type];F&&F[q.styleId]===void 0&&(F[q.styleId]=q)}),new ne(R,L,T,O)}function X(E){var R=E.attributes["w:type"];if(R==="numbering")return M(R,E);var L=C(E),T=x(E);return{type:R,styleId:L,name:T}}function x(E){var R=E.first("w:name");return R?R.attributes["w:val"]:null}function M(E,R){var L=C(R),T=R.firstOrEmpty("w:pPr").firstOrEmpty("w:numPr").firstOrEmpty("w:numId").attributes["w:val"];return{type:E,numId:T,styleId:L}}function C(E){return E.attributes["w:styleId"]}},5043:function(Xe,ce,ne){var I;(function(X){"use strict";function x(P,p){var K=(P&65535)+(p&65535),me=(P>>16)+(p>>16)+(K>>16);return me<<16|K&65535}function M(P,p){return P<<p|P>>>32-p}function C(P,p,K,me,pe,le){return x(M(x(x(p,P),x(me,le)),pe),K)}function E(P,p,K,me,pe,le,ue){return C(p&K|~p&me,P,p,pe,le,ue)}function R(P,p,K,me,pe,le,ue){return C(p&me|K&~me,P,p,pe,le,ue)}function L(P,p,K,me,pe,le,ue){return C(p^K^me,P,p,pe,le,ue)}function T(P,p,K,me,pe,le,ue){return C(K^(p|~me),P,p,pe,le,ue)}function O(P,p){P[p>>5]|=128<<p%32,P[(p+64>>>9<<4)+14]=p;var K,me,pe,le,ue,A=1732584193,N=-271733879,oe=-1732584194,ge=271733878;for(K=0;K<P.length;K+=16)me=A,pe=N,le=oe,ue=ge,A=E(A,N,oe,ge,P[K],7,-680876936),ge=E(ge,A,N,oe,P[K+1],12,-389564586),oe=E(oe,ge,A,N,P[K+2],17,606105819),N=E(N,oe,ge,A,P[K+3],22,-1044525330),A=E(A,N,oe,ge,P[K+4],7,-176418897),ge=E(ge,A,N,oe,P[K+5],12,1200080426),oe=E(oe,ge,A,N,P[K+6],17,-1473231341),N=E(N,oe,ge,A,P[K+7],22,-45705983),A=E(A,N,oe,ge,P[K+8],7,1770035416),ge=E(ge,A,N,oe,P[K+9],12,-1958414417),oe=E(oe,ge,A,N,P[K+10],17,-42063),N=E(N,oe,ge,A,P[K+11],22,-1990404162),A=E(A,N,oe,ge,P[K+12],7,1804603682),ge=E(ge,A,N,oe,P[K+13],12,-40341101),oe=E(oe,ge,A,N,P[K+14],17,-1502002290),N=E(N,oe,ge,A,P[K+15],22,1236535329),A=R(A,N,oe,ge,P[K+1],5,-165796510),ge=R(ge,A,N,oe,P[K+6],9,-1069501632),oe=R(oe,ge,A,N,P[K+11],14,643717713),N=R(N,oe,ge,A,P[K],20,-373897302),A=R(A,N,oe,ge,P[K+5],5,-701558691),ge=R(ge,A,N,oe,P[K+10],9,38016083),oe=R(oe,ge,A,N,P[K+15],14,-660478335),N=R(N,oe,ge,A,P[K+4],20,-405537848),A=R(A,N,oe,ge,P[K+9],5,568446438),ge=R(ge,A,N,oe,P[K+14],9,-1019803690),oe=R(oe,ge,A,N,P[K+3],14,-187363961),N=R(N,oe,ge,A,P[K+8],20,1163531501),A=R(A,N,oe,ge,P[K+13],5,-1444681467),ge=R(ge,A,N,oe,P[K+2],9,-51403784),oe=R(oe,ge,A,N,P[K+7],14,1735328473),N=R(N,oe,ge,A,P[K+12],20,-1926607734),A=L(A,N,oe,ge,P[K+5],4,-378558),ge=L(ge,A,N,oe,P[K+8],11,-2022574463),oe=L(oe,ge,A,N,P[K+11],16,1839030562),N=L(N,oe,ge,A,P[K+14],23,-35309556),A=L(A,N,oe,ge,P[K+1],4,-1530992060),ge=L(ge,A,N,oe,P[K+4],11,1272893353),oe=L(oe,ge,A,N,P[K+7],16,-155497632),N=L(N,oe,ge,A,P[K+10],23,-1094730640),A=L(A,N,oe,ge,P[K+13],4,681279174),ge=L(ge,A,N,oe,P[K],11,-358537222),oe=L(oe,ge,A,N,P[K+3],16,-722521979),N=L(N,oe,ge,A,P[K+6],23,76029189),A=L(A,N,oe,ge,P[K+9],4,-640364487),ge=L(ge,A,N,oe,P[K+12],11,-421815835),oe=L(oe,ge,A,N,P[K+15],16,530742520),N=L(N,oe,ge,A,P[K+2],23,-995338651),A=T(A,N,oe,ge,P[K],6,-198630844),ge=T(ge,A,N,oe,P[K+7],10,1126891415),oe=T(oe,ge,A,N,P[K+14],15,-1416354905),N=T(N,oe,ge,A,P[K+5],21,-57434055),A=T(A,N,oe,ge,P[K+12],6,1700485571),ge=T(ge,A,N,oe,P[K+3],10,-1894986606),oe=T(oe,ge,A,N,P[K+10],15,-1051523),N=T(N,oe,ge,A,P[K+1],21,-2054922799),A=T(A,N,oe,ge,P[K+8],6,1873313359),ge=T(ge,A,N,oe,P[K+15],10,-30611744),oe=T(oe,ge,A,N,P[K+6],15,-1560198380),N=T(N,oe,ge,A,P[K+13],21,1309151649),A=T(A,N,oe,ge,P[K+4],6,-145523070),ge=T(ge,A,N,oe,P[K+11],10,-1120210379),oe=T(oe,ge,A,N,P[K+2],15,718787259),N=T(N,oe,ge,A,P[K+9],21,-343485551),A=x(A,me),N=x(N,pe),oe=x(oe,le),ge=x(ge,ue);return[A,N,oe,ge]}function W(P){var p,K="",me=P.length*32;for(p=0;p<me;p+=8)K+=String.fromCharCode(P[p>>5]>>>p%32&255);return K}function D(P){var p,K=[];for(K[(P.length>>2)-1]=void 0,p=0;p<K.length;p+=1)K[p]=0;var me=P.length*8;for(p=0;p<me;p+=8)K[p>>5]|=(P.charCodeAt(p/8)&255)<<p%32;return K}function q(P){return W(O(D(P),P.length*8))}function F(P,p){var K,me=D(P),pe=[],le=[],ue;for(pe[15]=le[15]=void 0,me.length>16&&(me=O(me,P.length*8)),K=0;K<16;K+=1)pe[K]=me[K]^909522486,le[K]=me[K]^1549556828;return ue=O(pe.concat(D(p)),512+p.length*8),W(O(le.concat(ue),640))}function Y(P){var p="0123456789abcdef",K="",me,pe;for(pe=0;pe<P.length;pe+=1)me=P.charCodeAt(pe),K+=p.charAt(me>>>4&15)+p.charAt(me&15);return K}function G(P){return unescape(encodeURIComponent(P))}function J(P){return q(G(P))}function z(P){return Y(J(P))}function te(P,p){return F(G(P),G(p))}function V(P,p){return Y(te(P,p))}function de(P,p,K){return p?K?te(p,P):V(p,P):K?J(P):z(P)}I=function(){return de}.call(ce,ne,ce,Xe),I!==void 0&&(Xe.exports=I)})(this)},5157:(Xe,ce,ne)=>{var I=ne(8291),X=ne(3410);ce.writeString=x;function x(C,E){var R=I.invert(E),L={element:O,text:M};function T(q,F){return L[F.type](q,F)}function O(q,F){var Y=q.element(W(F.name),F.attributes);F.children.forEach(function(G){T(Y,G)})}function W(q){var F=/^\{(.*)\}(.*)$/.exec(q);if(F){var Y=R[F[1]];return Y+(Y===""?"":":")+F[2]}else return q}function D(q){var F=X.create(W(q.name),{version:"1.0",encoding:"UTF-8",standalone:!0});return I.forEach(E,function(Y,G){var J="xmlns"+(G===""?"":":"+G);F.attribute(J,Y)}),q.children.forEach(function(Y){T(F,Y)}),F.end()}return D(C)}function M(C,E){C.text(E.value)}},5199:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X){var x=ne(7443),M=x.errorObj,C=x.isObject;function E(D,q){if(C(D)){if(D instanceof I)return D;var F=L(D);if(F===M){q&&q._pushContext();var Y=I.reject(F.e);return q&&q._popContext(),Y}else if(typeof F=="function"){if(O(D)){var Y=new I(X);return D._then(Y._fulfill,Y._reject,void 0,Y,null),Y}return W(D,F,q)}}return D}function R(D){return D.then}function L(D){try{return R(D)}catch(q){return M.e=q,M}}var T={}.hasOwnProperty;function O(D){try{return T.call(D,"_promise0")}catch(q){return!1}}function W(D,q,F){var Y=new I(X),G=Y;F&&F._pushContext(),Y._captureStackTrace(),F&&F._popContext();var J=!0,z=x.tryCatch(q).call(D,te,V);J=!1,Y&&z===M&&(Y._rejectCallback(z.e,!0,!0),Y=null);function te(de){Y&&(Y._resolveCallback(de),Y=null)}function V(de){Y&&(Y._rejectCallback(de,J,!0),Y=null)}return G}return E}},5251:function(Xe,ce,ne){(function(){var I,X,x,M,C,E,R,L,T,O,W,D,q,F,Y,G,J,z,te,V,de,P={}.hasOwnProperty;de=ne(3626),te=de.isObject,z=de.isFunction,V=de.isPlainObject,J=de.getValue,W=ne(3879),X=ne(314),x=ne(4398),q=ne(7025),G=ne(4140),D=ne(9578),L=ne(4387),T=ne(1025),M=ne(1388),E=ne(2012),C=ne(9235),R=ne(9721),I=ne(591),Y=ne(7005),F=ne(9265),Xe.exports=O=function(){function p(K,me,pe){var le;this.name="?xml",K||(K={}),K.writer?V(K.writer)&&(le=K.writer,K.writer=new F(le)):K.writer=new F(K),this.options=K,this.writer=K.writer,this.stringify=new Y(K),this.onDataCallback=me||function(){},this.onEndCallback=pe||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}return p.prototype.node=function(K,me,pe){var le,ue;if(K==null)throw new Error("Missing node name.");if(this.root&&this.currentLevel===-1)throw new Error("Document can only have one root node. "+this.debugInfo(K));return this.openCurrent(),K=J(K),me===null&&pe==null&&(le=[{},null],me=le[0],pe=le[1]),me==null&&(me={}),me=J(me),te(me)||(ue=[me,pe],pe=ue[0],me=ue[1]),this.currentNode=new W(this,K,me),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,pe!=null&&this.text(pe),this},p.prototype.element=function(K,me,pe){return this.currentNode&&this.currentNode instanceof T?this.dtdElement.apply(this,arguments):this.node(K,me,pe)},p.prototype.attribute=function(K,me){var pe,le;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(K));if(K!=null&&(K=J(K)),te(K))for(pe in K)P.call(K,pe)&&(le=K[pe],this.attribute(pe,le));else z(me)&&(me=me.apply()),(!this.options.skipNullAttributes||me!=null)&&(this.currentNode.attributes[K]=new I(this,K,me));return this},p.prototype.text=function(K){var me;return this.openCurrent(),me=new G(this,K),this.onData(this.writer.text(me,this.currentLevel+1),this.currentLevel+1),this},p.prototype.cdata=function(K){var me;return this.openCurrent(),me=new X(this,K),this.onData(this.writer.cdata(me,this.currentLevel+1),this.currentLevel+1),this},p.prototype.comment=function(K){var me;return this.openCurrent(),me=new x(this,K),this.onData(this.writer.comment(me,this.currentLevel+1),this.currentLevel+1),this},p.prototype.raw=function(K){var me;return this.openCurrent(),me=new q(this,K),this.onData(this.writer.raw(me,this.currentLevel+1),this.currentLevel+1),this},p.prototype.instruction=function(K,me){var pe,le,ue,A,N;if(this.openCurrent(),K!=null&&(K=J(K)),me!=null&&(me=J(me)),Array.isArray(K))for(pe=0,A=K.length;pe<A;pe++)le=K[pe],this.instruction(le);else if(te(K))for(le in K)P.call(K,le)&&(ue=K[le],this.instruction(le,ue));else z(me)&&(me=me.apply()),N=new D(this,K,me),this.onData(this.writer.processingInstruction(N,this.currentLevel+1),this.currentLevel+1);return this},p.prototype.declaration=function(K,me,pe){var le;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return le=new L(this,K,me,pe),this.onData(this.writer.declaration(le,this.currentLevel+1),this.currentLevel+1),this},p.prototype.doctype=function(K,me,pe){if(this.openCurrent(),K==null)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new T(this,me,pe),this.currentNode.rootNodeName=K,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this},p.prototype.dtdElement=function(K,me){var pe;return this.openCurrent(),pe=new C(this,K,me),this.onData(this.writer.dtdElement(pe,this.currentLevel+1),this.currentLevel+1),this},p.prototype.attList=function(K,me,pe,le,ue){var A;return this.openCurrent(),A=new M(this,K,me,pe,le,ue),this.onData(this.writer.dtdAttList(A,this.currentLevel+1),this.currentLevel+1),this},p.prototype.entity=function(K,me){var pe;return this.openCurrent(),pe=new E(this,!1,K,me),this.onData(this.writer.dtdEntity(pe,this.currentLevel+1),this.currentLevel+1),this},p.prototype.pEntity=function(K,me){var pe;return this.openCurrent(),pe=new E(this,!0,K,me),this.onData(this.writer.dtdEntity(pe,this.currentLevel+1),this.currentLevel+1),this},p.prototype.notation=function(K,me){var pe;return this.openCurrent(),pe=new R(this,K,me),this.onData(this.writer.dtdNotation(pe,this.currentLevel+1),this.currentLevel+1),this},p.prototype.up=function(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this},p.prototype.end=function(){for(;this.currentLevel>=0;)this.up();return this.onEnd()},p.prototype.openCurrent=function(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)},p.prototype.openNode=function(K){if(!K.isOpen)return!this.root&&this.currentLevel===0&&K instanceof W&&(this.root=K),this.onData(this.writer.openNode(K,this.currentLevel),this.currentLevel),K.isOpen=!0},p.prototype.closeNode=function(K){if(!K.isClosed)return this.onData(this.writer.closeNode(K,this.currentLevel),this.currentLevel),K.isClosed=!0},p.prototype.onData=function(K,me){return this.documentStarted=!0,this.onDataCallback(K,me+1)},p.prototype.onEnd=function(){return this.documentCompleted=!0,this.onEndCallback()},p.prototype.debugInfo=function(K){return K==null?"":"node: <"+K+">"},p.prototype.ele=function(){return this.element.apply(this,arguments)},p.prototype.nod=function(K,me,pe){return this.node(K,me,pe)},p.prototype.txt=function(K){return this.text(K)},p.prototype.dat=function(K){return this.cdata(K)},p.prototype.com=function(K){return this.comment(K)},p.prototype.ins=function(K,me){return this.instruction(K,me)},p.prototype.dec=function(K,me,pe){return this.declaration(K,me,pe)},p.prototype.dtd=function(K,me,pe){return this.doctype(K,me,pe)},p.prototype.e=function(K,me,pe){return this.element(K,me,pe)},p.prototype.n=function(K,me,pe){return this.node(K,me,pe)},p.prototype.t=function(K){return this.text(K)},p.prototype.d=function(K){return this.cdata(K)},p.prototype.c=function(K){return this.comment(K)},p.prototype.r=function(K){return this.raw(K)},p.prototype.i=function(K,me){return this.instruction(K,me)},p.prototype.att=function(){return this.currentNode&&this.currentNode instanceof T?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},p.prototype.a=function(){return this.currentNode&&this.currentNode instanceof T?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},p.prototype.ent=function(K,me){return this.entity(K,me)},p.prototype.pent=function(K,me){return this.pEntity(K,me)},p.prototype.not=function(K,me){return this.notation(K,me)},p}()}).call(this)},5350:(Xe,ce)=>{"use strict";ce.byteLength=R,ce.toByteArray=T,ce.fromByteArray=D;for(var ne=[],I=[],X=typeof Uint8Array!="undefined"?Uint8Array:Array,x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",M=0,C=x.length;M<C;++M)ne[M]=x[M],I[x.charCodeAt(M)]=M;I[45]=62,I[95]=63;function E(q){var F=q.length;if(F%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var Y=q.indexOf("=");Y===-1&&(Y=F);var G=Y===F?0:4-Y%4;return[Y,G]}function R(q){var F=E(q),Y=F[0],G=F[1];return(Y+G)*3/4-G}function L(q,F,Y){return(F+Y)*3/4-Y}function T(q){var F,Y=E(q),G=Y[0],J=Y[1],z=new X(L(q,G,J)),te=0,V=J>0?G-4:G,de;for(de=0;de<V;de+=4)F=I[q.charCodeAt(de)]<<18|I[q.charCodeAt(de+1)]<<12|I[q.charCodeAt(de+2)]<<6|I[q.charCodeAt(de+3)],z[te++]=F>>16&255,z[te++]=F>>8&255,z[te++]=F&255;return J===2&&(F=I[q.charCodeAt(de)]<<2|I[q.charCodeAt(de+1)]>>4,z[te++]=F&255),J===1&&(F=I[q.charCodeAt(de)]<<10|I[q.charCodeAt(de+1)]<<4|I[q.charCodeAt(de+2)]>>2,z[te++]=F>>8&255,z[te++]=F&255),z}function O(q){return ne[q>>18&63]+ne[q>>12&63]+ne[q>>6&63]+ne[q&63]}function W(q,F,Y){for(var G,J=[],z=F;z<Y;z+=3)G=(q[z]<<16&16711680)+(q[z+1]<<8&65280)+(q[z+2]&255),J.push(O(G));return J.join("")}function D(q){for(var F,Y=q.length,G=Y%3,J=[],z=16383,te=0,V=Y-G;te<V;te+=z)J.push(W(q,te,te+z>V?V:te+z));return G===1?(F=q[Y-1],J.push(ne[F>>2]+ne[F<<4&63]+"==")):G===2&&(F=(q[Y-2]<<8)+q[Y-1],J.push(ne[F>>10]+ne[F>>4&63]+ne[F<<2&63]+"=")),J.join("")}},5395:Xe=>{"use strict";Xe.exports=function(ce){function ne(R){R!==void 0?(R=R._target(),this._bitField=R._bitField,this._settledValueField=R._isFateSealed()?R._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}ne.prototype._settledValue=function(){return this._settledValueField};var I=ne.prototype.value=function(){if(!this.isFulfilled())throw new TypeError(`cannot get fulfillment value of a non-fulfilled promise

    See http://goo.gl/MqrFmX
`);return this._settledValue()},X=ne.prototype.error=ne.prototype.reason=function(){if(!this.isRejected())throw new TypeError(`cannot get rejection reason of a non-rejected promise

    See http://goo.gl/MqrFmX
`);return this._settledValue()},x=ne.prototype.isFulfilled=function(){return(this._bitField&33554432)!==0},M=ne.prototype.isRejected=function(){return(this._bitField&16777216)!==0},C=ne.prototype.isPending=function(){return(this._bitField&50397184)===0},E=ne.prototype.isResolved=function(){return(this._bitField&50331648)!==0};ne.prototype.isCancelled=function(){return(this._bitField&8454144)!==0},ce.prototype.__isCancelled=function(){return(this._bitField&65536)===65536},ce.prototype._isCancelled=function(){return this._target().__isCancelled()},ce.prototype.isCancelled=function(){return(this._target()._bitField&8454144)!==0},ce.prototype.isPending=function(){return C.call(this._target())},ce.prototype.isRejected=function(){return M.call(this._target())},ce.prototype.isFulfilled=function(){return x.call(this._target())},ce.prototype.isResolved=function(){return E.call(this._target())},ce.prototype.value=function(){return I.call(this._target())},ce.prototype.reason=function(){var R=this._target();return R._unsetRejectionIsUnhandled(),X.call(R)},ce.prototype._value=function(){return this._settledValue()},ce.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},ce.PromiseInspection=ne}},5457:(Xe,ce,ne)=>{var I;ce.M=O,I=D;var X=ne(1714),x=ne(8291),M=ne(9796),C=ne(5584).Result,E=ne(5584).warning,R=ne(1088),L=ne(8101),T=ne(3370);function O(p){return{readXmlElement:function(K){return new W(p).readXmlElement(K)},readXmlElements:function(K){return new W(p).readXmlElements(K)}}}function W(p){var K=[],me=[],pe=[],le=p.relationships,ue=p.contentTypes,A=p.docxFile,N=p.files,oe=p.numbering,ge=p.styles;function ve(lt){var St=lt.map(ke);return V(St)}function ke(lt){if(lt.type==="element"){var St=mt[lt.name];if(St)return St(lt);if(!Object.prototype.hasOwnProperty.call(F,lt.name)){var Xt=E("An unrecognised element was ignored: "+lt.name);return Y([Xt])}}return G()}function Ye(lt){return It(lt).map(function(St){return{type:"paragraphProperties",styleId:St.styleId,styleName:St.name,alignment:lt.firstOrEmpty("w:jc").attributes["w:val"],numbering:D(St.styleId,lt.firstOrEmpty("w:numPr"),oe),indent:Le(lt.firstOrEmpty("w:ind"))}})}function Le(lt){return{start:lt.attributes["w:start"]||lt.attributes["w:left"],end:lt.attributes["w:end"]||lt.attributes["w:right"],firstLine:lt.attributes["w:firstLine"],hanging:lt.attributes["w:hanging"]}}function Fe(lt){return _t(lt).map(function(St){var Xt=lt.firstOrEmpty("w:sz").attributes["w:val"],Qt=/^[0-9]+$/.test(Xt)?parseInt(Xt,10)/2:null;return{type:"runProperties",styleId:St.styleId,styleName:St.name,verticalAlignment:lt.firstOrEmpty("w:vertAlign").attributes["w:val"],font:lt.firstOrEmpty("w:rFonts").attributes["w:ascii"],fontSize:Qt,isBold:Ee(lt.first("w:b")),isUnderline:st(lt.first("w:u")),isItalic:Ee(lt.first("w:i")),isStrikethrough:Ee(lt.first("w:strike")),isAllCaps:Ee(lt.first("w:caps")),isSmallCaps:Ee(lt.first("w:smallCaps")),highlight:$t(lt.firstOrEmpty("w:highlight").attributes["w:val"])}})}function st(lt){if(lt){var St=lt.attributes["w:val"];return St!==void 0&&St!=="false"&&St!=="0"&&St!=="none"}else return!1}function Ee(lt){if(lt){var St=lt.attributes["w:val"];return St!=="false"&&St!=="0"}else return!1}function pt(lt){return lt!=="false"&&lt!=="0"}function $t(lt){return!lt||lt==="none"?null:lt}function It(lt){return zt(lt,"w:pStyle","Paragraph",ge.findParagraphStyleById)}function _t(lt){return zt(lt,"w:rStyle","Run",ge.findCharacterStyleById)}function jt(lt){return zt(lt,"w:tblStyle","Table",ge.findTableStyleById)}function zt(lt,St,Xt,Qt){var un=[],Mt=lt.first(St),ua=null,Gt=null;if(Mt&&(ua=Mt.attributes["w:val"],ua)){var cr=Qt(ua);cr?Gt=cr.name:un.push(Xa(Xt,ua))}return z({styleId:ua,name:Gt},un)}function mn(lt){var St=lt.attributes["w:fldCharType"];if(St==="begin")K.push({type:"begin",fldChar:lt}),me=[];else if(St==="end"){var Xt=K.pop();if(Xt.type==="begin"&&(Xt=En(Xt)),Xt.type==="checkbox")return J(M.checkbox({checked:Xt.checked}))}else if(St==="separate"){var Qt=K.pop(),un=En(Qt);K.push(un)}return G()}function Qn(){var lt=x.last(K.filter(function(St){return St.type==="hyperlink"}));return lt?lt.options:null}function En(lt){return Q(me.join(""),lt.type==="begin"?lt.fldChar:R.emptyElement)}function Q(lt,St){var Xt=/\s*HYPERLINK "(.*)"/.exec(lt);if(Xt)return{type:"hyperlink",options:{href:Xt[1]}};var Qt=/\s*HYPERLINK\s+\\l\s+"(.*)"/.exec(lt);if(Qt)return{type:"hyperlink",options:{anchor:Qt[1]}};var un=/\s*FORMCHECKBOX\s*/.exec(lt);if(un){var Mt=St.firstOrEmpty("w:ffData").firstOrEmpty("w:checkBox"),ua=Mt.first("w:checked"),Gt=ua==null?Ee(Mt.first("w:default")):Ee(ua);return{type:"checkbox",checked:Gt}}return{type:"unknown"}}function ot(lt){return me.push(lt.text()),G()}function gt(lt){var St=lt.attributes["w:font"],Xt=lt.attributes["w:char"],Qt=X.hex(St,Xt);return Qt==null&&/^F0..$/.test(Xt)&&(Qt=X.hex(St,Xt.substring(2))),Qt==null?Y([E("A w:sym element with an unsupported character was ignored: char "+Xt+" in font "+St)]):J(new M.Text(Qt.string))}function ye(lt){return function(St){var Xt=St.attributes["w:id"];return J(new M.NoteReference({noteType:lt,noteId:Xt}))}}function _e(lt){return J(M.commentReference({commentId:lt.attributes["w:id"]}))}function $e(lt){return ve(lt.children)}var mt={"w:p":function(lt){var St=lt.firstOrEmpty("w:pPr"),Xt=!!St.firstOrEmpty("w:rPr").first("w:del");if(Xt)return lt.children.forEach(function(un){pe.push(un)}),G();var Qt=lt.children;return pe.length>0&&(Qt=pe.concat(Qt),pe=[]),te.map(Ye(St),ve(Qt),function(un,Mt){return new M.Paragraph(Mt,un)}).insertExtra()},"w:r":function(lt){return te.map(Fe(lt.firstOrEmpty("w:rPr")),ve(lt.children),function(St,Xt){var Qt=Qn();return Qt!==null&&(Xt=[new M.Hyperlink(Xt,Qt)]),new M.Run(Xt,St)})},"w:fldChar":mn,"w:instrText":ot,"w:t":function(lt){return J(new M.Text(lt.text()))},"w:tab":function(lt){return J(new M.Tab)},"w:noBreakHyphen":function(){return J(new M.Text("\u2011"))},"w:softHyphen":function(lt){return J(new M.Text("\xAD"))},"w:sym":gt,"w:hyperlink":function(lt){var St=lt.attributes["r:id"],Xt=lt.attributes["w:anchor"];return ve(lt.children).map(function(Qt){function un(ua){var Gt=lt.attributes["w:tgtFrame"]||null;return new M.Hyperlink(Qt,x.extend({targetFrame:Gt},ua))}if(St){var Mt=le.findTargetByRelationshipId(St);return Xt&&(Mt=T.replaceFragment(Mt,Xt)),un({href:Mt})}else return Xt?un({anchor:Xt}):Qt})},"w:tbl":yt,"w:tr":ut,"w:tc":kt,"w:footnoteReference":ye("footnote"),"w:endnoteReference":ye("endnote"),"w:commentReference":_e,"w:br":function(lt){var St=lt.attributes["w:type"];return St==null||St==="textWrapping"?J(M.lineBreak):St==="page"?J(M.pageBreak):St==="column"?J(M.columnBreak):Y([E("Unsupported break type: "+St)])},"w:bookmarkStart":function(lt){var St=lt.attributes["w:name"];return St==="_GoBack"?G():J(new M.BookmarkStart({name:St}))},"mc:AlternateContent":function(lt){return $e(lt.firstOrEmpty("mc:Fallback"))},"w:sdt":function(lt){var St=ve(lt.firstOrEmpty("w:sdtContent").children);return St.map(function(Xt){var Qt=lt.firstOrEmpty("w:sdtPr").first("wordml:checkbox");if(Qt){var un=Qt.first("wordml:checked"),Mt=!!un&&pt(un.attributes["wordml:val"]),ua=M.checkbox({checked:Mt}),Gt=!1,cr=Xt.map(L._elementsOfType(M.types.text,function(Wa){return Wa.value.length>0&&!Gt?(Gt=!0,ua):Wa}));return Gt?cr:ua}else return Xt})},"w:ins":$e,"w:object":$e,"w:smartTag":$e,"w:drawing":$e,"w:pict":function(lt){return $e(lt).toExtra()},"v:roundrect":$e,"v:shape":$e,"v:textbox":$e,"w:txbxContent":$e,"wp:inline":Tt,"wp:anchor":Tt,"v:imagedata":yn,"v:group":$e,"v:rect":$e};return{readXmlElement:ke,readXmlElements:ve};function yt(lt){var St=nt(lt.firstOrEmpty("w:tblPr"));return ve(lt.children).flatMap(je).flatMap(function(Xt){return St.map(function(Qt){return M.Table(Xt,Qt)})})}function nt(lt){return jt(lt).map(function(St){return{styleId:St.styleId,styleName:St.name}})}function ut(lt){var St=lt.firstOrEmpty("w:trPr"),Xt=!!St.first("w:del");if(Xt)return G();var Qt=!!St.first("w:tblHeader");return ve(lt.children).map(function(un){return M.TableRow(un,{isHeader:Qt})})}function kt(lt){return ve(lt.children).map(function(St){var Xt=lt.firstOrEmpty("w:tcPr"),Qt=Xt.firstOrEmpty("w:gridSpan").attributes["w:val"],un=Qt?parseInt(Qt,10):1,Mt=M.TableCell(St,{colSpan:un});return Mt._vMerge=Ne(Xt),Mt})}function Ne(lt){var St=lt.first("w:vMerge");if(St){var Xt=St.attributes["w:val"];return Xt==="continue"||!Xt}else return null}function je(lt){var St=x.any(lt,function(un){return un.type!==M.types.tableRow});if(St)return ct(lt),z(lt,[E("unexpected non-row element in table, cell merging may be incorrect")]);var Xt=x.any(lt,function(un){return x.any(un.children,function(Mt){return Mt.type!==M.types.tableCell})});if(Xt)return ct(lt),z(lt,[E("unexpected non-cell element in table row, cell merging may be incorrect")]);var Qt={};return lt.forEach(function(un){var Mt=0;un.children.forEach(function(ua){ua._vMerge&&Qt[Mt]?Qt[Mt].rowSpan++:(Qt[Mt]=ua,ua._vMerge=!1),Mt+=ua.colSpan})}),lt.forEach(function(un){un.children=un.children.filter(function(Mt){return!Mt._vMerge}),un.children.forEach(function(Mt){delete Mt._vMerge})}),J(lt)}function ct(lt){lt.forEach(function(St){var Xt=L.getDescendantsOfType(St,M.types.tableCell);Xt.forEach(function(Qt){delete Qt._vMerge})})}function Tt(lt){var St=lt.getElementsByTagName("a:graphic").getElementsByTagName("a:graphicData").getElementsByTagName("pic:pic").getElementsByTagName("pic:blipFill").getElementsByTagName("a:blip");return V(St.map(pn.bind(null,lt)))}function pn(lt,St){var Xt=lt.first("wp:docPr").attributes,Qt=bn(Xt.descr)?Xt.title:Xt.descr,un=Bn(St);return un===null?Y([E("Could not find image file for a:blip element")]):Kn(un,Qt)}function bn(lt){return lt==null||/^\s*$/.test(lt)}function Bn(lt){var St=lt.attributes["r:embed"],Xt=lt.attributes["r:link"];if(St)return Jt(St);if(Xt){var Qt=le.findTargetByRelationshipId(Xt);return{path:Qt,read:N.read.bind(N,Qt)}}else return null}function yn(lt){var St=lt.attributes["r:id"];return St?Kn(Jt(St),lt.attributes["o:title"]):Y([E("A v:imagedata element without a relationship ID was ignored")])}function Jt(lt){var St=T.uriToZipEntryName("word",le.findTargetByRelationshipId(lt));return{path:St,read:A.read.bind(A,St)}}function Kn(lt,St){var Xt=ue.findContentType(lt.path),Qt=M.Image({readImage:lt.read,altText:St,contentType:Xt}),un=q[Xt]?[]:E("Image of type "+Xt+" is unlikely to display in web browsers");return z(Qt,un)}function Xa(lt,St){return E(lt+" style with ID "+St+" was referenced but not defined in the document")}}function D(p,K,me){var pe=K.firstOrEmpty("w:ilvl").attributes["w:val"],le=K.firstOrEmpty("w:numId").attributes["w:val"];if(pe!==void 0&&le!==void 0)return me.findLevel(le,pe);if(p!=null){var ue=me.findLevelByParagraphStyleId(p);if(ue!=null)return ue}return le!==void 0?me.findLevel(le,"0"):null}var q={"image/png":!0,"image/gif":!0,"image/jpeg":!0,"image/svg+xml":!0,"image/tiff":!0},F={"office-word:wrap":!0,"v:shadow":!0,"v:shapetype":!0,"w:annotationRef":!0,"w:bookmarkEnd":!0,"w:sectPr":!0,"w:proofErr":!0,"w:lastRenderedPageBreak":!0,"w:commentRangeStart":!0,"w:commentRangeEnd":!0,"w:del":!0,"w:footnoteRef":!0,"w:endnoteRef":!0,"w:pPr":!0,"w:rPr":!0,"w:tblPr":!0,"w:tblGrid":!0,"w:trPr":!0,"w:tcPr":!0};function Y(p){return new te(null,null,p)}function G(){return new te(null)}function J(p){return new te(p)}function z(p,K){return new te(p,null,K)}function te(p,K,me){this.value=p||[],this.extra=K||[],this._result=new C({element:this.value,extra:K},me),this.messages=this._result.messages}te.prototype.toExtra=function(){return new te(null,de(this.extra,this.value),this.messages)},te.prototype.insertExtra=function(){var p=this.extra;return p&&p.length?new te(de(this.value,p),null,this.messages):this},te.prototype.map=function(p){var K=this._result.map(function(me){return p(me.element)});return new te(K.value,this.extra,K.messages)},te.prototype.flatMap=function(p){var K=this._result.flatMap(function(me){return p(me.element)._result});return new te(K.value.element,de(this.extra,K.value.extra),K.messages)},te.map=function(p,K,me){return new te(me(p.value,K.value),de(p.extra,K.extra),p.messages.concat(K.messages))};function V(p){var K=C.combine(x.pluck(p,"_result"));return new te(x.flatten(x.pluck(K.value,"element")),x.filter(x.flatten(x.pluck(K.value,"extra")),P),K.messages)}function de(p,K){return x.flatten([p,K])}function P(p){return p}},5584:(Xe,ce,ne)=>{var I=ne(8291);ce.Result=X,ce.success=x,ce.warning=M,ce.error=C;function X(T,O){this.value=T,this.messages=O||[]}X.prototype.map=function(T){return new X(T(this.value),this.messages)},X.prototype.flatMap=function(T){var O=T(this.value);return new X(O.value,E([this,O]))},X.prototype.flatMapThen=function(T){var O=this;return T(this.value).then(function(W){return new X(W.value,E([O,W]))})},X.combine=function(T){var O=I.flatten(I.pluck(T,"value")),W=E(T);return new X(O,W)};function x(T){return new X(T,[])}function M(T){return{type:"warning",message:T}}function C(T){return{type:"error",message:T.message,error:T}}function E(T){var O=[];return I.flatten(I.pluck(T,"messages"),!0).forEach(function(W){R(O,W)||O.push(W)}),O}function R(T,O){return I.find(T,L.bind(null,O))!==void 0}function L(T,O){return T.type===O.type&&T.message===O.message}},5644:(Xe,ce,ne)=>{"use strict";var I=ne(7443),X=I.maybeWrapAsError,x=ne(9556),M=x.OperationalError,C=ne(7048);function E(O){return O instanceof Error&&C.getPrototypeOf(O)===Error.prototype}var R=/^(?:name|message|stack|cause)$/;function L(O){var W;if(E(O)){W=new M(O),W.name=O.name,W.message=O.message,W.stack=O.stack;for(var D=C.keys(O),q=0;q<D.length;++q){var F=D[q];R.test(F)||(W[F]=O[F])}return W}return I.markAsOriginatingFromRejection(O),O}function T(O,W){return function(D,q){if(O!==null){if(D){var F=L(X(D));O._attachExtraTrace(F),O._reject(F)}else if(!W)O._fulfill(q);else{for(var Y=arguments.length,G=new Array(Math.max(Y-1,0)),J=1;J<Y;++J)G[J-1]=arguments[J];O._fulfill(G)}O=null}}}Xe.exports=T},5715:(Xe,ce,ne)=>{"use strict";var I;try{throw new Error}catch(T){I=T}var X=ne(1726),x=ne(492),M=ne(7443);function C(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new x(16),this._normalQueue=new x(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var T=this;this.drainQueues=function(){T._drainQueues()},this._schedule=X}C.prototype.setScheduler=function(T){var O=this._schedule;return this._schedule=T,this._customScheduler=!0,O},C.prototype.hasCustomScheduler=function(){return this._customScheduler},C.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},C.prototype.disableTrampolineIfNecessary=function(){M.hasDevTools&&(this._trampolineEnabled=!1)},C.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},C.prototype.fatalError=function(T,O){O?(process.stderr.write("Fatal "+(T instanceof Error?T.stack:T)+`
`),process.exit(2)):this.throwLater(T)},C.prototype.throwLater=function(T,O){if(arguments.length===1&&(O=T,T=function(){throw O}),typeof setTimeout!="undefined")setTimeout(function(){T(O)},0);else try{this._schedule(function(){T(O)})}catch(W){throw new Error(`No async scheduler available

    See http://goo.gl/MqrFmX
`)}};function E(T,O,W){this._lateQueue.push(T,O,W),this._queueTick()}function R(T,O,W){this._normalQueue.push(T,O,W),this._queueTick()}function L(T){this._normalQueue._pushOne(T),this._queueTick()}M.hasDevTools?(C.prototype.invokeLater=function(T,O,W){this._trampolineEnabled?E.call(this,T,O,W):this._schedule(function(){setTimeout(function(){T.call(O,W)},100)})},C.prototype.invoke=function(T,O,W){this._trampolineEnabled?R.call(this,T,O,W):this._schedule(function(){T.call(O,W)})},C.prototype.settlePromises=function(T){this._trampolineEnabled?L.call(this,T):this._schedule(function(){T._settlePromises()})}):(C.prototype.invokeLater=E,C.prototype.invoke=R,C.prototype.settlePromises=L),C.prototype._drainQueue=function(T){for(;T.length()>0;){var O=T.shift();if(typeof O!="function"){O._settlePromises();continue}var W=T.shift(),D=T.shift();O.call(W,D)}},C.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},C.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},C.prototype._reset=function(){this._isTickUsed=!1},Xe.exports=C,Xe.exports.firstLineError=I},5793:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X,x){var M=ne(7443),C=I.TimeoutError;function E(D){this.handle=D}E.prototype._resultCancelled=function(){clearTimeout(this.handle)};var R=function(D){return L(+this).thenReturn(D)},L=I.delay=function(D,q){var F,Y;return q!==void 0?(F=I.resolve(q)._then(R,null,null,D,void 0),x.cancellation()&&q instanceof I&&F._setOnCancel(q)):(F=new I(X),Y=setTimeout(function(){F._fulfill()},+D),x.cancellation()&&F._setOnCancel(new E(Y)),F._captureStackTrace()),F._setAsyncGuaranteed(),F};I.prototype.delay=function(D){return L(D,this)};var T=function(D,q,F){var Y;typeof q!="string"?q instanceof Error?Y=q:Y=new C("operation timed out"):Y=new C(q),M.markAsOriginatingFromRejection(Y),D._attachExtraTrace(Y),D._reject(Y),F!=null&&F.cancel()};function O(D){return clearTimeout(this.handle),D}function W(D){throw clearTimeout(this.handle),D}I.prototype.timeout=function(D,q){D=+D;var F,Y,G=new E(setTimeout(function(){F.isPending()&&T(F,q,Y)},D));return x.cancellation()?(Y=this.then(),F=Y._then(O,W,void 0,G,void 0),F._setOnCancel(G)):F=this._then(O,W,void 0,G,void 0),F}}},5818:(Xe,ce,ne)=>{var I,X=ne(8291),x=ne(9623),M=ne(7067),C=ne(6421).w,E=ne(1610).w,R=ne(6987)._T,L=ne(1394).Tt,T=ne(9819),O=ne(5584).Result;ce.aY=W,I=D,I=q,I=J,ne(4346),ne(8101),ne(2926),I=z,I=F;function W(te,V){return q(te,V)}function D(te,V){var de=Object.create(V||{});return de.outputFormat="markdown",q(te,de)}function q(te,V){return V=L(V),T.openZip(te).tap(function(de){return M.readStyleMap(de).then(function(P){V.embeddedStyleMap=P})}).then(function(de){return x.read(de,te,V).then(function(P){return P.map(V.transformDocument)}).then(function(P){return Y(P,V)})})}function F(te){return T.openZip(te).then(M.readStyleMap)}function Y(te,V){var de=G(V.readStyleMap()),P=X.extend({},V,{styleMap:de.value}),p=new C(P);return te.flatMapThen(function(K){return de.flatMapThen(function(me){return p.convertToHtml(K)})})}function G(te){return O.combine((te||[]).map(R)).map(function(V){return V.filter(function(de){return!!de})})}function J(te){return T.openZip(te).then(x.read).then(function(V){return V.map(E)})}function z(te,V){return T.openZip(te).tap(function(de){return M.writeStyleMap(de,V)}).then(function(de){return de.toArrayBuffer()}).then(function(de){return{toArrayBuffer:function(){return de},toBuffer:function(){return Buffer.from(de)}}})}I=function(){throw new Error(`Use a raw string instead of mammoth.styleMapping e.g. "p[style-name='Title'] => h1" instead of mammoth.styleMapping("p[style-name='Title'] => h1")`)}},5927:(Xe,ce,ne)=>{var I=ne(8167),X=I.find,x=I.NAMESPACE;function M(fe){return fe!==""}function C(fe){return fe?fe.split(/[\t\n\f\r ]+/).filter(M):[]}function E(fe,he){return fe.hasOwnProperty(he)||(fe[he]=!0),fe}function R(fe){if(!fe)return[];var he=C(fe);return Object.keys(he.reduce(E,{}))}function L(fe){return function(he){return fe&&fe.indexOf(he)!==-1}}function T(fe,he){for(var Ge in fe)Object.prototype.hasOwnProperty.call(fe,Ge)&&(he[Ge]=fe[Ge])}function O(fe,he){var Ge=fe.prototype;if(!(Ge instanceof he)){let Ot=function(){};var ft=Ot;Ot.prototype=he.prototype,Ot=new Ot,T(Ge,Ot),fe.prototype=Ge=Ot}Ge.constructor!=fe&&(typeof fe!="function"&&console.error("unknown Class:"+fe),Ge.constructor=fe)}var W={},D=W.ELEMENT_NODE=1,q=W.ATTRIBUTE_NODE=2,F=W.TEXT_NODE=3,Y=W.CDATA_SECTION_NODE=4,G=W.ENTITY_REFERENCE_NODE=5,J=W.ENTITY_NODE=6,z=W.PROCESSING_INSTRUCTION_NODE=7,te=W.COMMENT_NODE=8,V=W.DOCUMENT_NODE=9,de=W.DOCUMENT_TYPE_NODE=10,P=W.DOCUMENT_FRAGMENT_NODE=11,p=W.NOTATION_NODE=12,K={},me={},pe=K.INDEX_SIZE_ERR=(me[1]="Index size error",1),le=K.DOMSTRING_SIZE_ERR=(me[2]="DOMString size error",2),ue=K.HIERARCHY_REQUEST_ERR=(me[3]="Hierarchy request error",3),A=K.WRONG_DOCUMENT_ERR=(me[4]="Wrong document",4),N=K.INVALID_CHARACTER_ERR=(me[5]="Invalid character",5),oe=K.NO_DATA_ALLOWED_ERR=(me[6]="No data allowed",6),ge=K.NO_MODIFICATION_ALLOWED_ERR=(me[7]="No modification allowed",7),ve=K.NOT_FOUND_ERR=(me[8]="Not found",8),ke=K.NOT_SUPPORTED_ERR=(me[9]="Not supported",9),Ye=K.INUSE_ATTRIBUTE_ERR=(me[10]="Attribute in use",10),Le=K.INVALID_STATE_ERR=(me[11]="Invalid state",11),Fe=K.SYNTAX_ERR=(me[12]="Syntax error",12),st=K.INVALID_MODIFICATION_ERR=(me[13]="Invalid modification",13),Ee=K.NAMESPACE_ERR=(me[14]="Invalid namespace",14),pt=K.INVALID_ACCESS_ERR=(me[15]="Invalid access",15);function $t(fe,he){if(he instanceof Error)var Ge=he;else Ge=this,Error.call(this,me[fe]),this.message=me[fe],Error.captureStackTrace&&Error.captureStackTrace(this,$t);return Ge.code=fe,he&&(this.message=this.message+": "+he),Ge}$t.prototype=Error.prototype,T(K,$t);function It(){}It.prototype={length:0,item:function(fe){return fe>=0&&fe<this.length?this[fe]:null},toString:function(fe,he){for(var Ge=[],ft=0;ft<this.length;ft++)os(this[ft],Ge,fe,he);return Ge.join("")},filter:function(fe){return Array.prototype.filter.call(this,fe)},indexOf:function(fe){return Array.prototype.indexOf.call(this,fe)}};function _t(fe,he){this._node=fe,this._refresh=he,jt(this)}function jt(fe){var he=fe._node._inc||fe._node.ownerDocument._inc;if(fe._inc!==he){var Ge=fe._refresh(fe._node);if(kn(fe,"length",Ge.length),!fe.$$length||Ge.length<fe.$$length)for(var ft=Ge.length;ft in fe;ft++)Object.prototype.hasOwnProperty.call(fe,ft)&&delete fe[ft];T(Ge,fe),fe._inc=he}}_t.prototype.item=function(fe){return jt(this),this[fe]||null},O(_t,It);function zt(){}function mn(fe,he){for(var Ge=fe.length;Ge--;)if(fe[Ge]===he)return Ge}function Qn(fe,he,Ge,ft){if(ft?he[mn(he,ft)]=Ge:he[he.length++]=Ge,fe){Ge.ownerElement=fe;var Ot=fe.ownerDocument;Ot&&(ft&&mt(Ot,fe,ft),$e(Ot,fe,Ge))}}function En(fe,he,Ge){var ft=mn(he,Ge);if(ft>=0){for(var Ot=he.length-1;ft<Ot;)he[ft]=he[++ft];if(he.length=Ot,fe){var at=fe.ownerDocument;at&&(mt(at,fe,Ge),Ge.ownerElement=null)}}else throw new $t(ve,new Error(fe.tagName+"@"+Ge))}zt.prototype={length:0,item:It.prototype.item,getNamedItem:function(fe){for(var he=this.length;he--;){var Ge=this[he];if(Ge.nodeName==fe)return Ge}},setNamedItem:function(fe){var he=fe.ownerElement;if(he&&he!=this._ownerElement)throw new $t(Ye);var Ge=this.getNamedItem(fe.nodeName);return Qn(this._ownerElement,this,fe,Ge),Ge},setNamedItemNS:function(fe){var he=fe.ownerElement,Ge;if(he&&he!=this._ownerElement)throw new $t(Ye);return Ge=this.getNamedItemNS(fe.namespaceURI,fe.localName),Qn(this._ownerElement,this,fe,Ge),Ge},removeNamedItem:function(fe){var he=this.getNamedItem(fe);return En(this._ownerElement,this,he),he},removeNamedItemNS:function(fe,he){var Ge=this.getNamedItemNS(fe,he);return En(this._ownerElement,this,Ge),Ge},getNamedItemNS:function(fe,he){for(var Ge=this.length;Ge--;){var ft=this[Ge];if(ft.localName==he&&ft.namespaceURI==fe)return ft}return null}};function Q(){}Q.prototype={hasFeature:function(fe,he){return!0},createDocument:function(fe,he,Ge){var ft=new _e;if(ft.implementation=this,ft.childNodes=new It,ft.doctype=Ge||null,Ge&&ft.appendChild(Ge),he){var Ot=ft.createElementNS(fe,he);ft.appendChild(Ot)}return ft},createDocumentType:function(fe,he,Ge){var ft=new ua;return ft.name=fe,ft.nodeName=fe,ft.publicId=he||"",ft.systemId=Ge||"",ft}};function ot(){}ot.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(fe,he){return Jt(this,fe,he)},replaceChild:function(fe,he){Jt(this,fe,he,yn),he&&this.removeChild(he)},removeChild:function(fe){return nt(this,fe)},appendChild:function(fe){return this.insertBefore(fe,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(fe){return dr(this.ownerDocument||this,this,fe)},normalize:function(){for(var fe=this.firstChild;fe;){var he=fe.nextSibling;he&&he.nodeType==F&&fe.nodeType==F?(this.removeChild(he),fe.appendData(he.data)):(fe.normalize(),fe=he)}},isSupported:function(fe,he){return this.ownerDocument.implementation.hasFeature(fe,he)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(fe){for(var he=this;he;){var Ge=he._nsMap;if(Ge){for(var ft in Ge)if(Object.prototype.hasOwnProperty.call(Ge,ft)&&Ge[ft]===fe)return ft}he=he.nodeType==q?he.ownerDocument:he.parentNode}return null},lookupNamespaceURI:function(fe){for(var he=this;he;){var Ge=he._nsMap;if(Ge&&Object.prototype.hasOwnProperty.call(Ge,fe))return Ge[fe];he=he.nodeType==q?he.ownerDocument:he.parentNode}return null},isDefaultNamespace:function(fe){var he=this.lookupPrefix(fe);return he==null}};function gt(fe){return fe=="<"&&"&lt;"||fe==">"&&"&gt;"||fe=="&"&&"&amp;"||fe=='"'&&"&quot;"||"&#"+fe.charCodeAt()+";"}T(W,ot),T(W,ot.prototype);function ye(fe,he){if(he(fe))return!0;if(fe=fe.firstChild)do if(ye(fe,he))return!0;while(fe=fe.nextSibling)}function _e(){this.ownerDocument=this}function $e(fe,he,Ge){fe&&fe._inc++;var ft=Ge.namespaceURI;ft===x.XMLNS&&(he._nsMap[Ge.prefix?Ge.localName:""]=Ge.value)}function mt(fe,he,Ge,ft){fe&&fe._inc++;var Ot=Ge.namespaceURI;Ot===x.XMLNS&&delete he._nsMap[Ge.prefix?Ge.localName:""]}function yt(fe,he,Ge){if(fe&&fe._inc){fe._inc++;var ft=he.childNodes;if(Ge)ft[ft.length++]=Ge;else{for(var Ot=he.firstChild,at=0;Ot;)ft[at++]=Ot,Ot=Ot.nextSibling;ft.length=at,delete ft[ft.length]}}}function nt(fe,he){var Ge=he.previousSibling,ft=he.nextSibling;return Ge?Ge.nextSibling=ft:fe.firstChild=ft,ft?ft.previousSibling=Ge:fe.lastChild=Ge,he.parentNode=null,he.previousSibling=null,he.nextSibling=null,yt(fe.ownerDocument,fe),he}function ut(fe){return fe&&(fe.nodeType===ot.DOCUMENT_NODE||fe.nodeType===ot.DOCUMENT_FRAGMENT_NODE||fe.nodeType===ot.ELEMENT_NODE)}function kt(fe){return fe&&(je(fe)||ct(fe)||Ne(fe)||fe.nodeType===ot.DOCUMENT_FRAGMENT_NODE||fe.nodeType===ot.COMMENT_NODE||fe.nodeType===ot.PROCESSING_INSTRUCTION_NODE)}function Ne(fe){return fe&&fe.nodeType===ot.DOCUMENT_TYPE_NODE}function je(fe){return fe&&fe.nodeType===ot.ELEMENT_NODE}function ct(fe){return fe&&fe.nodeType===ot.TEXT_NODE}function Tt(fe,he){var Ge=fe.childNodes||[];if(X(Ge,je)||Ne(he))return!1;var ft=X(Ge,Ne);return!(he&&ft&&Ge.indexOf(ft)>Ge.indexOf(he))}function pn(fe,he){var Ge=fe.childNodes||[];function ft(at){return je(at)&&at!==he}if(X(Ge,ft))return!1;var Ot=X(Ge,Ne);return!(he&&Ot&&Ge.indexOf(Ot)>Ge.indexOf(he))}function bn(fe,he,Ge){if(!ut(fe))throw new $t(ue,"Unexpected parent node type "+fe.nodeType);if(Ge&&Ge.parentNode!==fe)throw new $t(ve,"child not in parent");if(!kt(he)||Ne(he)&&fe.nodeType!==ot.DOCUMENT_NODE)throw new $t(ue,"Unexpected node type "+he.nodeType+" for parent node type "+fe.nodeType)}function Bn(fe,he,Ge){var ft=fe.childNodes||[],Ot=he.childNodes||[];if(he.nodeType===ot.DOCUMENT_FRAGMENT_NODE){var at=Ot.filter(je);if(at.length>1||X(Ot,ct))throw new $t(ue,"More than one element or text in fragment");if(at.length===1&&!Tt(fe,Ge))throw new $t(ue,"Element in fragment can not be inserted before doctype")}if(je(he)&&!Tt(fe,Ge))throw new $t(ue,"Only one element can be added and only after doctype");if(Ne(he)){if(X(ft,Ne))throw new $t(ue,"Only one doctype is allowed");var fa=X(ft,je);if(Ge&&ft.indexOf(fa)<ft.indexOf(Ge))throw new $t(ue,"Doctype can only be inserted before an element");if(!Ge&&fa)throw new $t(ue,"Doctype can not be appended since element is present")}}function yn(fe,he,Ge){var ft=fe.childNodes||[],Ot=he.childNodes||[];if(he.nodeType===ot.DOCUMENT_FRAGMENT_NODE){var at=Ot.filter(je);if(at.length>1||X(Ot,ct))throw new $t(ue,"More than one element or text in fragment");if(at.length===1&&!pn(fe,Ge))throw new $t(ue,"Element in fragment can not be inserted before doctype")}if(je(he)&&!pn(fe,Ge))throw new $t(ue,"Only one element can be added and only after doctype");if(Ne(he)){let wi=function(vi){return Ne(vi)&&vi!==Ge};var Yt=wi;if(X(ft,wi))throw new $t(ue,"Only one doctype is allowed");var fa=X(ft,je);if(Ge&&ft.indexOf(fa)<ft.indexOf(Ge))throw new $t(ue,"Doctype can only be inserted before an element")}}function Jt(fe,he,Ge,ft){bn(fe,he,Ge),fe.nodeType===ot.DOCUMENT_NODE&&(ft||Bn)(fe,he,Ge);var Ot=he.parentNode;if(Ot&&Ot.removeChild(he),he.nodeType===P){var at=he.firstChild;if(at==null)return he;var fa=he.lastChild}else at=fa=he;var Yt=Ge?Ge.previousSibling:fe.lastChild;at.previousSibling=Yt,fa.nextSibling=Ge,Yt?Yt.nextSibling=at:fe.firstChild=at,Ge==null?fe.lastChild=fa:Ge.previousSibling=fa;do{at.parentNode=fe;var wi=fe.ownerDocument||fe;Kn(at,wi)}while(at!==fa&&(at=at.nextSibling));return yt(fe.ownerDocument||fe,fe),he.nodeType==P&&(he.firstChild=he.lastChild=null),he}function Kn(fe,he){if(fe.ownerDocument!==he){if(fe.ownerDocument=he,fe.nodeType===D&&fe.attributes)for(var Ge=0;Ge<fe.attributes.length;Ge++){var ft=fe.attributes.item(Ge);ft&&(ft.ownerDocument=he)}for(var Ot=fe.firstChild;Ot;)Kn(Ot,he),Ot=Ot.nextSibling}}function Xa(fe,he){he.parentNode&&he.parentNode.removeChild(he),he.parentNode=fe,he.previousSibling=fe.lastChild,he.nextSibling=null,he.previousSibling?he.previousSibling.nextSibling=he:fe.firstChild=he,fe.lastChild=he,yt(fe.ownerDocument,fe,he);var Ge=fe.ownerDocument||fe;return Kn(he,Ge),he}_e.prototype={nodeName:"#document",nodeType:V,doctype:null,documentElement:null,_inc:1,insertBefore:function(fe,he){if(fe.nodeType==P){for(var Ge=fe.firstChild;Ge;){var ft=Ge.nextSibling;this.insertBefore(Ge,he),Ge=ft}return fe}return Jt(this,fe,he),Kn(fe,this),this.documentElement===null&&fe.nodeType===D&&(this.documentElement=fe),fe},removeChild:function(fe){return this.documentElement==fe&&(this.documentElement=null),nt(this,fe)},replaceChild:function(fe,he){Jt(this,fe,he,yn),Kn(fe,this),he&&this.removeChild(he),je(fe)&&(this.documentElement=fe)},importNode:function(fe,he){return io(this,fe,he)},getElementById:function(fe){var he=null;return ye(this.documentElement,function(Ge){if(Ge.nodeType==D&&Ge.getAttribute("id")==fe)return he=Ge,!0}),he},getElementsByClassName:function(fe){var he=R(fe);return new _t(this,function(Ge){var ft=[];return he.length>0&&ye(Ge.documentElement,function(Ot){if(Ot!==Ge&&Ot.nodeType===D){var at=Ot.getAttribute("class");if(at){var fa=fe===at;if(!fa){var Yt=R(at);fa=he.every(L(Yt))}fa&&ft.push(Ot)}}}),ft})},createElement:function(fe){var he=new lt;he.ownerDocument=this,he.nodeName=fe,he.tagName=fe,he.localName=fe,he.childNodes=new It;var Ge=he.attributes=new zt;return Ge._ownerElement=he,he},createDocumentFragment:function(){var fe=new pl;return fe.ownerDocument=this,fe.childNodes=new It,fe},createTextNode:function(fe){var he=new Qt;return he.ownerDocument=this,he.appendData(fe),he},createComment:function(fe){var he=new un;return he.ownerDocument=this,he.appendData(fe),he},createCDATASection:function(fe){var he=new Mt;return he.ownerDocument=this,he.appendData(fe),he},createProcessingInstruction:function(fe,he){var Ge=new hl;return Ge.ownerDocument=this,Ge.tagName=Ge.nodeName=Ge.target=fe,Ge.nodeValue=Ge.data=he,Ge},createAttribute:function(fe){var he=new St;return he.ownerDocument=this,he.name=fe,he.nodeName=fe,he.localName=fe,he.specified=!0,he},createEntityReference:function(fe){var he=new Wa;return he.ownerDocument=this,he.nodeName=fe,he},createElementNS:function(fe,he){var Ge=new lt,ft=he.split(":"),Ot=Ge.attributes=new zt;return Ge.childNodes=new It,Ge.ownerDocument=this,Ge.nodeName=he,Ge.tagName=he,Ge.namespaceURI=fe,ft.length==2?(Ge.prefix=ft[0],Ge.localName=ft[1]):Ge.localName=he,Ot._ownerElement=Ge,Ge},createAttributeNS:function(fe,he){var Ge=new St,ft=he.split(":");return Ge.ownerDocument=this,Ge.nodeName=he,Ge.name=he,Ge.namespaceURI=fe,Ge.specified=!0,ft.length==2?(Ge.prefix=ft[0],Ge.localName=ft[1]):Ge.localName=he,Ge}},O(_e,ot);function lt(){this._nsMap={}}lt.prototype={nodeType:D,hasAttribute:function(fe){return this.getAttributeNode(fe)!=null},getAttribute:function(fe){var he=this.getAttributeNode(fe);return he&&he.value||""},getAttributeNode:function(fe){return this.attributes.getNamedItem(fe)},setAttribute:function(fe,he){var Ge=this.ownerDocument.createAttribute(fe);Ge.value=Ge.nodeValue=""+he,this.setAttributeNode(Ge)},removeAttribute:function(fe){var he=this.getAttributeNode(fe);he&&this.removeAttributeNode(he)},appendChild:function(fe){return fe.nodeType===P?this.insertBefore(fe,null):Xa(this,fe)},setAttributeNode:function(fe){return this.attributes.setNamedItem(fe)},setAttributeNodeNS:function(fe){return this.attributes.setNamedItemNS(fe)},removeAttributeNode:function(fe){return this.attributes.removeNamedItem(fe.nodeName)},removeAttributeNS:function(fe,he){var Ge=this.getAttributeNodeNS(fe,he);Ge&&this.removeAttributeNode(Ge)},hasAttributeNS:function(fe,he){return this.getAttributeNodeNS(fe,he)!=null},getAttributeNS:function(fe,he){var Ge=this.getAttributeNodeNS(fe,he);return Ge&&Ge.value||""},setAttributeNS:function(fe,he,Ge){var ft=this.ownerDocument.createAttributeNS(fe,he);ft.value=ft.nodeValue=""+Ge,this.setAttributeNode(ft)},getAttributeNodeNS:function(fe,he){return this.attributes.getNamedItemNS(fe,he)},getElementsByTagName:function(fe){return new _t(this,function(he){var Ge=[];return ye(he,function(ft){ft!==he&&ft.nodeType==D&&(fe==="*"||ft.tagName==fe)&&Ge.push(ft)}),Ge})},getElementsByTagNameNS:function(fe,he){return new _t(this,function(Ge){var ft=[];return ye(Ge,function(Ot){Ot!==Ge&&Ot.nodeType===D&&(fe==="*"||Ot.namespaceURI===fe)&&(he==="*"||Ot.localName==he)&&ft.push(Ot)}),ft})}},_e.prototype.getElementsByTagName=lt.prototype.getElementsByTagName,_e.prototype.getElementsByTagNameNS=lt.prototype.getElementsByTagNameNS,O(lt,ot);function St(){}St.prototype.nodeType=q,O(St,ot);function Xt(){}Xt.prototype={data:"",substringData:function(fe,he){return this.data.substring(fe,fe+he)},appendData:function(fe){fe=this.data+fe,this.nodeValue=this.data=fe,this.length=fe.length},insertData:function(fe,he){this.replaceData(fe,0,he)},appendChild:function(fe){throw new Error(me[ue])},deleteData:function(fe,he){this.replaceData(fe,he,"")},replaceData:function(fe,he,Ge){var ft=this.data.substring(0,fe),Ot=this.data.substring(fe+he);Ge=ft+Ge+Ot,this.nodeValue=this.data=Ge,this.length=Ge.length}},O(Xt,ot);function Qt(){}Qt.prototype={nodeName:"#text",nodeType:F,splitText:function(fe){var he=this.data,Ge=he.substring(fe);he=he.substring(0,fe),this.data=this.nodeValue=he,this.length=he.length;var ft=this.ownerDocument.createTextNode(Ge);return this.parentNode&&this.parentNode.insertBefore(ft,this.nextSibling),ft}},O(Qt,Xt);function un(){}un.prototype={nodeName:"#comment",nodeType:te},O(un,Xt);function Mt(){}Mt.prototype={nodeName:"#cdata-section",nodeType:Y},O(Mt,Xt);function ua(){}ua.prototype.nodeType=de,O(ua,ot);function Gt(){}Gt.prototype.nodeType=p,O(Gt,ot);function cr(){}cr.prototype.nodeType=J,O(cr,ot);function Wa(){}Wa.prototype.nodeType=G,O(Wa,ot);function pl(){}pl.prototype.nodeName="#document-fragment",pl.prototype.nodeType=P,O(pl,ot);function hl(){}hl.prototype.nodeType=z,O(hl,ot);function va(){}va.prototype.serializeToString=function(fe,he,Ge){return gn.call(fe,he,Ge)},ot.prototype.toString=gn;function gn(fe,he){var Ge=[],ft=this.nodeType==9&&this.documentElement||this,Ot=ft.prefix,at=ft.namespaceURI;if(at&&Ot==null){var Ot=ft.lookupPrefix(at);if(Ot==null)var fa=[{namespace:at,prefix:null}]}return os(this,Ge,fe,he,fa),Ge.join("")}function Ut(fe,he,Ge){var ft=fe.prefix||"",Ot=fe.namespaceURI;if(!Ot||ft==="xml"&&Ot===x.XML||Ot===x.XMLNS)return!1;for(var at=Ge.length;at--;){var fa=Ge[at];if(fa.prefix===ft)return fa.namespace!==Ot}return!0}function rs(fe,he,Ge){fe.push(" ",he,'="',Ge.replace(/[<>&"\t\n\r]/g,gt),'"')}function os(fe,he,Ge,ft,Ot){if(Ot||(Ot=[]),ft)if(fe=ft(fe),fe){if(typeof fe=="string"){he.push(fe);return}}else return;switch(fe.nodeType){case D:var at=fe.attributes,fa=at.length,Fa=fe.firstChild,Yt=fe.tagName;Ge=x.isHTML(fe.namespaceURI)||Ge;var wi=Yt;if(!Ge&&!fe.prefix&&fe.namespaceURI){for(var vi,xi=0;xi<at.length;xi++)if(at.item(xi).name==="xmlns"){vi=at.item(xi).value;break}if(!vi)for(var Za=Ot.length-1;Za>=0;Za--){var Ts=Ot[Za];if(Ts.prefix===""&&Ts.namespace===fe.namespaceURI){vi=Ts.namespace;break}}if(vi!==fe.namespaceURI)for(var Za=Ot.length-1;Za>=0;Za--){var Ts=Ot[Za];if(Ts.namespace===fe.namespaceURI){Ts.prefix&&(wi=Ts.prefix+":"+Yt);break}}}he.push("<",wi);for(var ls=0;ls<fa;ls++){var Va=at.item(ls);Va.prefix=="xmlns"?Ot.push({prefix:Va.localName,namespace:Va.value}):Va.nodeName=="xmlns"&&Ot.push({prefix:"",namespace:Va.value})}for(var ls=0;ls<fa;ls++){var Va=at.item(ls);if(Ut(Va,Ge,Ot)){var Zi=Va.prefix||"",Ca=Va.namespaceURI;rs(he,Zi?"xmlns:"+Zi:"xmlns",Ca),Ot.push({prefix:Zi,namespace:Ca})}os(Va,he,Ge,ft,Ot)}if(Yt===wi&&Ut(fe,Ge,Ot)){var Zi=fe.prefix||"",Ca=fe.namespaceURI;rs(he,Zi?"xmlns:"+Zi:"xmlns",Ca),Ot.push({prefix:Zi,namespace:Ca})}if(Fa||Ge&&!/^(?:meta|link|img|br|hr|input)$/i.test(Yt)){if(he.push(">"),Ge&&/^script$/i.test(Yt))for(;Fa;)Fa.data?he.push(Fa.data):os(Fa,he,Ge,ft,Ot.slice()),Fa=Fa.nextSibling;else for(;Fa;)os(Fa,he,Ge,ft,Ot.slice()),Fa=Fa.nextSibling;he.push("</",wi,">")}else he.push("/>");return;case V:case P:for(var Fa=fe.firstChild;Fa;)os(Fa,he,Ge,ft,Ot.slice()),Fa=Fa.nextSibling;return;case q:return rs(he,fe.name,fe.value);case F:return he.push(fe.data.replace(/[<&>]/g,gt));case Y:return he.push("<![CDATA[",fe.data,"]]>");case te:return he.push("<!--",fe.data,"-->");case de:var Oa=fe.publicId,so=fe.systemId;if(he.push("<!DOCTYPE ",fe.name),Oa)he.push(" PUBLIC ",Oa),so&&so!="."&&he.push(" ",so),he.push(">");else if(so&&so!=".")he.push(" SYSTEM ",so,">");else{var ud=fe.internalSubset;ud&&he.push(" [",ud,"]"),he.push(">")}return;case z:return he.push("<?",fe.target," ",fe.data,"?>");case G:return he.push("&",fe.nodeName,";");default:he.push("??",fe.nodeName)}}function io(fe,he,Ge){var ft;switch(he.nodeType){case D:ft=he.cloneNode(!1),ft.ownerDocument=fe;case P:break;case q:Ge=!0;break}if(ft||(ft=he.cloneNode(!1)),ft.ownerDocument=fe,ft.parentNode=null,Ge)for(var Ot=he.firstChild;Ot;)ft.appendChild(io(fe,Ot,Ge)),Ot=Ot.nextSibling;return ft}function dr(fe,he,Ge){var ft=new he.constructor;for(var Ot in he)if(Object.prototype.hasOwnProperty.call(he,Ot)){var at=he[Ot];typeof at!="object"&&at!=ft[Ot]&&(ft[Ot]=at)}switch(he.childNodes&&(ft.childNodes=new It),ft.ownerDocument=fe,ft.nodeType){case D:var fa=he.attributes,Yt=ft.attributes=new zt,wi=fa.length;Yt._ownerElement=ft;for(var vi=0;vi<wi;vi++)ft.setAttributeNode(dr(fe,fa.item(vi),!0));break;case q:Ge=!0}if(Ge)for(var xi=he.firstChild;xi;)ft.appendChild(dr(fe,xi,Ge)),xi=xi.nextSibling;return ft}function kn(fe,he,Ge){fe[he]=Ge}try{if(Object.defineProperty){let fe=function(he){switch(he.nodeType){case D:case P:var Ge=[];for(he=he.firstChild;he;)he.nodeType!==7&&he.nodeType!==8&&Ge.push(fe(he)),he=he.nextSibling;return Ge.join("");default:return he.nodeValue}};var gl=fe;Object.defineProperty(_t.prototype,"length",{get:function(){return jt(this),this.$$length}}),Object.defineProperty(ot.prototype,"textContent",{get:function(){return fe(this)},set:function(he){switch(this.nodeType){case D:case P:for(;this.firstChild;)this.removeChild(this.firstChild);(he||String(he))&&this.appendChild(this.ownerDocument.createTextNode(he));break;default:this.data=he,this.value=he,this.nodeValue=he}}}),kn=function(he,Ge,ft){he["$$"+Ge]=ft}}}catch(fe){}ce.DocumentType=ua,ce.DOMException=$t,ce.DOMImplementation=Q,ce.Element=lt,ce.Node=ot,ce.NodeList=It,ce.XMLSerializer=va},6188:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X,x){var M=I.PromiseInspection,C=ne(7443);function E(R){this.constructor$(R)}C.inherits(E,X),E.prototype._promiseResolved=function(R,L){this._values[R]=L;var T=++this._totalResolved;return T>=this._length?(this._resolve(this._values),!0):!1},E.prototype._promiseFulfilled=function(R,L){var T=new M;return T._bitField=33554432,T._settledValueField=R,this._promiseResolved(L,T)},E.prototype._promiseRejected=function(R,L){var T=new M;return T._bitField=16777216,T._settledValueField=R,this._promiseResolved(L,T)},I.settle=function(R){return x.deprecated(".settle()",".reflect()"),new E(R).promise()},I.prototype.settle=function(){return I.settle(this)}}},6265:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X){var x=I._getDomain,M=I._async,C=ne(9556).Warning,E=ne(7443),R=E.canAttachTrace,L,T,O=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,W=/\((?:timers\.js):\d+:\d+\)/,D=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,q=null,F=null,Y=!1,G,J=!!(E.env("BLUEBIRD_DEBUG")!=0&&(E.env("BLUEBIRD_DEBUG")||E.env("NODE_ENV")==="development")),z=!!(E.env("BLUEBIRD_WARNINGS")!=0&&(J||E.env("BLUEBIRD_WARNINGS"))),te=!!(E.env("BLUEBIRD_LONG_STACK_TRACES")!=0&&(J||E.env("BLUEBIRD_LONG_STACK_TRACES"))),V=E.env("BLUEBIRD_W_FORGOTTEN_RETURN")!=0&&(z||!!E.env("BLUEBIRD_W_FORGOTTEN_RETURN"));I.prototype.suppressUnhandledRejections=function(){var Ne=this._target();Ne._bitField=Ne._bitField&-1048577|524288},I.prototype._ensurePossibleRejectionHandled=function(){this._bitField&524288||(this._setRejectionIsUnhandled(),M.invokeLater(this._notifyUnhandledRejection,this,void 0))},I.prototype._notifyUnhandledRejectionIsHandled=function(){Q("rejectionHandled",L,void 0,this)},I.prototype._setReturnedNonUndefined=function(){this._bitField=this._bitField|268435456},I.prototype._returnedNonUndefined=function(){return(this._bitField&268435456)!==0},I.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var Ne=this._settledValue();this._setUnhandledRejectionIsNotified(),Q("unhandledRejection",T,Ne,this)}},I.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=this._bitField|262144},I.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-262145},I.prototype._isUnhandledRejectionNotified=function(){return(this._bitField&262144)>0},I.prototype._setRejectionIsUnhandled=function(){this._bitField=this._bitField|1048576},I.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-1048577,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},I.prototype._isRejectionUnhandled=function(){return(this._bitField&1048576)>0},I.prototype._warn=function(Ne,je,ct){return $t(Ne,je,ct||this)},I.onPossiblyUnhandledRejection=function(Ne){var je=x();T=typeof Ne=="function"?je===null?Ne:E.domainBind(je,Ne):void 0},I.onUnhandledRejectionHandled=function(Ne){var je=x();L=typeof Ne=="function"?je===null?Ne:E.domainBind(je,Ne):void 0};var de=function(){};I.longStackTraces=function(){if(M.haveItemsQueued()&&!kt.longStackTraces)throw new Error(`cannot enable long stack traces after promises have been created

    See http://goo.gl/MqrFmX
`);if(!kt.longStackTraces&&ye()){var Ne=I.prototype._captureStackTrace,je=I.prototype._attachExtraTrace;kt.longStackTraces=!0,de=function(){if(M.haveItemsQueued()&&!kt.longStackTraces)throw new Error(`cannot enable long stack traces after promises have been created

    See http://goo.gl/MqrFmX
`);I.prototype._captureStackTrace=Ne,I.prototype._attachExtraTrace=je,X.deactivateLongStackTraces(),M.enableTrampoline(),kt.longStackTraces=!1},I.prototype._captureStackTrace=Fe,I.prototype._attachExtraTrace=st,X.activateLongStackTraces(),M.disableTrampolineIfNecessary()}},I.hasLongStackTraces=function(){return kt.longStackTraces&&ye()};var P=function(){try{if(typeof CustomEvent=="function"){var Ne=new CustomEvent("CustomEvent");return E.global.dispatchEvent(Ne),function(je,ct){var Tt=new CustomEvent(je.toLowerCase(),{detail:ct,cancelable:!0});return!E.global.dispatchEvent(Tt)}}else if(typeof Event=="function"){var Ne=new Event("CustomEvent");return E.global.dispatchEvent(Ne),function(ct,Tt){var pn=new Event(ct.toLowerCase(),{cancelable:!0});return pn.detail=Tt,!E.global.dispatchEvent(pn)}}else{var Ne=document.createEvent("CustomEvent");return Ne.initCustomEvent("testingtheevent",!1,!0,{}),E.global.dispatchEvent(Ne),function(ct,Tt){var pn=document.createEvent("CustomEvent");return pn.initCustomEvent(ct.toLowerCase(),!1,!0,Tt),!E.global.dispatchEvent(pn)}}}catch(je){}return function(){return!1}}(),p=function(){return E.isNode?function(){return process.emit.apply(process,arguments)}:E.global?function(Ne){var je="on"+Ne.toLowerCase(),ct=E.global[je];return ct?(ct.apply(E.global,[].slice.call(arguments,1)),!0):!1}:function(){return!1}}();function K(Ne,je){return{promise:je}}var me={promiseCreated:K,promiseFulfilled:K,promiseRejected:K,promiseResolved:K,promiseCancelled:K,promiseChained:function(Ne,je,ct){return{promise:je,child:ct}},warning:function(Ne,je){return{warning:je}},unhandledRejection:function(Ne,je,ct){return{reason:je,promise:ct}},rejectionHandled:K},pe=function(Ne){var je=!1;try{je=p.apply(null,arguments)}catch(Tt){M.throwLater(Tt),je=!0}var ct=!1;try{ct=P(Ne,me[Ne].apply(null,arguments))}catch(Tt){M.throwLater(Tt),ct=!0}return ct||je};I.config=function(Ne){if(Ne=Object(Ne),"longStackTraces"in Ne&&(Ne.longStackTraces?I.longStackTraces():!Ne.longStackTraces&&I.hasLongStackTraces()&&de()),"warnings"in Ne){var je=Ne.warnings;kt.warnings=!!je,V=kt.warnings,E.isObject(je)&&"wForgottenReturn"in je&&(V=!!je.wForgottenReturn)}if("cancellation"in Ne&&Ne.cancellation&&!kt.cancellation){if(M.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");I.prototype._clearCancellationData=ge,I.prototype._propagateFrom=ve,I.prototype._onCancel=N,I.prototype._setOnCancel=oe,I.prototype._attachCancellationCallback=A,I.prototype._execute=ue,Ye=ve,kt.cancellation=!0}return"monitoring"in Ne&&(Ne.monitoring&&!kt.monitoring?(kt.monitoring=!0,I.prototype._fireEvent=pe):!Ne.monitoring&&kt.monitoring&&(kt.monitoring=!1,I.prototype._fireEvent=le)),I};function le(){return!1}I.prototype._fireEvent=le,I.prototype._execute=function(Ne,je,ct){try{Ne(je,ct)}catch(Tt){return Tt}},I.prototype._onCancel=function(){},I.prototype._setOnCancel=function(Ne){},I.prototype._attachCancellationCallback=function(Ne){},I.prototype._captureStackTrace=function(){},I.prototype._attachExtraTrace=function(){},I.prototype._clearCancellationData=function(){},I.prototype._propagateFrom=function(Ne,je){};function ue(Ne,je,ct){var Tt=this;try{Ne(je,ct,function(pn){if(typeof pn!="function")throw new TypeError("onCancel must be a function, got: "+E.toString(pn));Tt._attachCancellationCallback(pn)})}catch(pn){return pn}}function A(Ne){if(!this._isCancellable())return this;var je=this._onCancel();je!==void 0?E.isArray(je)?je.push(Ne):this._setOnCancel([je,Ne]):this._setOnCancel(Ne)}function N(){return this._onCancelField}function oe(Ne){this._onCancelField=Ne}function ge(){this._cancellationParent=void 0,this._onCancelField=void 0}function ve(Ne,je){if(je&1){this._cancellationParent=Ne;var ct=Ne._branchesRemainingToCancel;ct===void 0&&(ct=0),Ne._branchesRemainingToCancel=ct+1}je&2&&Ne._isBound()&&this._setBoundTo(Ne._boundTo)}function ke(Ne,je){je&2&&Ne._isBound()&&this._setBoundTo(Ne._boundTo)}var Ye=ke;function Le(){var Ne=this._boundTo;return Ne!==void 0&&Ne instanceof I?Ne.isFulfilled()?Ne.value():void 0:Ne}function Fe(){this._trace=new nt(this._peekContext())}function st(Ne,je){if(R(Ne)){var ct=this._trace;if(ct!==void 0&&je&&(ct=ct._parent),ct!==void 0)ct.attachExtraTrace(Ne);else if(!Ne.__stackCleaned__){var Tt=Qn(Ne);E.notEnumerableProp(Ne,"stack",Tt.message+`
`+Tt.stack.join(`
`)),E.notEnumerableProp(Ne,"__stackCleaned__",!0)}}}function Ee(Ne,je,ct,Tt,pn){if(Ne===void 0&&je!==null&&V){if(pn!==void 0&&pn._returnedNonUndefined()||!(Tt._bitField&65535))return;ct&&(ct=ct+" ");var bn="",Bn="";if(je._trace){for(var yn=je._trace.stack.split(`
`),Jt=zt(yn),Kn=Jt.length-1;Kn>=0;--Kn){var Xa=Jt[Kn];if(!W.test(Xa)){var lt=Xa.match(D);lt&&(bn="at "+lt[1]+":"+lt[2]+":"+lt[3]+" ");break}}if(Jt.length>0){for(var St=Jt[0],Kn=0;Kn<yn.length;++Kn)if(yn[Kn]===St){Kn>0&&(Bn=`
`+yn[Kn-1]);break}}}var Xt="a promise was created in a "+ct+"handler "+bn+"but was not returned from it, see http://goo.gl/rRqMUw"+Bn;Tt._warn(Xt,!0,je)}}function pt(Ne,je){var ct=Ne+" is deprecated and will be removed in a future version.";return je&&(ct+=" Use "+je+" instead."),$t(ct)}function $t(Ne,je,ct){if(kt.warnings){var Tt=new C(Ne),pn;if(je)ct._attachExtraTrace(Tt);else if(kt.longStackTraces&&(pn=I._peekContext()))pn.attachExtraTrace(Tt);else{var bn=Qn(Tt);Tt.stack=bn.message+`
`+bn.stack.join(`
`)}pe("warning",Tt)||En(Tt,"",!0)}}function It(Ne,je){for(var ct=0;ct<je.length-1;++ct)je[ct].push("From previous event:"),je[ct]=je[ct].join(`
`);return ct<je.length&&(je[ct]=je[ct].join(`
`)),Ne+`
`+je.join(`
`)}function _t(Ne){for(var je=0;je<Ne.length;++je)(Ne[je].length===0||je+1<Ne.length&&Ne[je][0]===Ne[je+1][0])&&(Ne.splice(je,1),je--)}function jt(Ne){for(var je=Ne[0],ct=1;ct<Ne.length;++ct){for(var Tt=Ne[ct],pn=je.length-1,bn=je[pn],Bn=-1,yn=Tt.length-1;yn>=0;--yn)if(Tt[yn]===bn){Bn=yn;break}for(var yn=Bn;yn>=0;--yn){var Jt=Tt[yn];if(je[pn]===Jt)je.pop(),pn--;else break}je=Tt}}function zt(Ne){for(var je=[],ct=0;ct<Ne.length;++ct){var Tt=Ne[ct],pn=Tt==="    (No stack trace)"||q.test(Tt),bn=pn&&_e(Tt);pn&&!bn&&(Y&&Tt.charAt(0)!==" "&&(Tt="    "+Tt),je.push(Tt))}return je}function mn(Ne){for(var je=Ne.stack.replace(/\s+$/g,"").split(`
`),ct=0;ct<je.length;++ct){var Tt=je[ct];if(Tt==="    (No stack trace)"||q.test(Tt))break}return ct>0&&Ne.name!="SyntaxError"&&(je=je.slice(ct)),je}function Qn(Ne){var je=Ne.stack,ct=Ne.toString();return je=typeof je=="string"&&je.length>0?mn(Ne):["    (No stack trace)"],{message:ct,stack:Ne.name=="SyntaxError"?je:zt(je)}}function En(Ne,je,ct){if(typeof console!="undefined"){var Tt;if(E.isObject(Ne)){var pn=Ne.stack;Tt=je+F(pn,Ne)}else Tt=je+String(Ne);typeof G=="function"?G(Tt,ct):(typeof console.log=="function"||typeof console.log=="object")&&console.log(Tt)}}function Q(Ne,je,ct,Tt){var pn=!1;try{typeof je=="function"&&(pn=!0,Ne==="rejectionHandled"?je(Tt):je(ct,Tt))}catch(bn){M.throwLater(bn)}Ne==="unhandledRejection"?!pe(Ne,ct,Tt)&&!pn&&En(ct,"Unhandled rejection "):pe(Ne,Tt)}function ot(Ne){var je;if(typeof Ne=="function")je="[function "+(Ne.name||"anonymous")+"]";else{je=Ne&&typeof Ne.toString=="function"?Ne.toString():E.toString(Ne);var ct=/\[object [a-zA-Z0-9$_]+\]/;if(ct.test(je))try{var Tt=JSON.stringify(Ne);je=Tt}catch(pn){}je.length===0&&(je="(empty array)")}return"(<"+gt(je)+">, no stack trace)"}function gt(Ne){var je=41;return Ne.length<je?Ne:Ne.substr(0,je-3)+"..."}function ye(){return typeof ut=="function"}var _e=function(){return!1},$e=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function mt(Ne){var je=Ne.match($e);if(je)return{fileName:je[1],line:parseInt(je[2],10)}}function yt(Ne,je){if(ye()){for(var ct=Ne.stack.split(`
`),Tt=je.stack.split(`
`),pn=-1,bn=-1,Bn,yn,Jt=0;Jt<ct.length;++Jt){var Kn=mt(ct[Jt]);if(Kn){Bn=Kn.fileName,pn=Kn.line;break}}for(var Jt=0;Jt<Tt.length;++Jt){var Kn=mt(Tt[Jt]);if(Kn){yn=Kn.fileName,bn=Kn.line;break}}pn<0||bn<0||!Bn||!yn||Bn!==yn||pn>=bn||(_e=function(Xa){if(O.test(Xa))return!0;var lt=mt(Xa);return!!(lt&&lt.fileName===Bn&&pn<=lt.line&&lt.line<=bn)})}}function nt(Ne){this._parent=Ne,this._promisesCreated=0;var je=this._length=1+(Ne===void 0?0:Ne._length);ut(this,nt),je>32&&this.uncycle()}E.inherits(nt,Error),X.CapturedTrace=nt,nt.prototype.uncycle=function(){var Ne=this._length;if(!(Ne<2)){for(var je=[],ct={},Tt=0,pn=this;pn!==void 0;++Tt)je.push(pn),pn=pn._parent;Ne=this._length=Tt;for(var Tt=Ne-1;Tt>=0;--Tt){var bn=je[Tt].stack;ct[bn]===void 0&&(ct[bn]=Tt)}for(var Tt=0;Tt<Ne;++Tt){var Bn=je[Tt].stack,yn=ct[Bn];if(yn!==void 0&&yn!==Tt){yn>0&&(je[yn-1]._parent=void 0,je[yn-1]._length=1),je[Tt]._parent=void 0,je[Tt]._length=1;var Jt=Tt>0?je[Tt-1]:this;yn<Ne-1?(Jt._parent=je[yn+1],Jt._parent.uncycle(),Jt._length=Jt._parent._length+1):(Jt._parent=void 0,Jt._length=1);for(var Kn=Jt._length+1,Xa=Tt-2;Xa>=0;--Xa)je[Xa]._length=Kn,Kn++;return}}}},nt.prototype.attachExtraTrace=function(Ne){if(!Ne.__stackCleaned__){this.uncycle();for(var je=Qn(Ne),ct=je.message,Tt=[je.stack],pn=this;pn!==void 0;)Tt.push(zt(pn.stack.split(`
`))),pn=pn._parent;jt(Tt),_t(Tt),E.notEnumerableProp(Ne,"stack",It(ct,Tt)),E.notEnumerableProp(Ne,"__stackCleaned__",!0)}};var ut=function(){var je=/^\s*at\s*/,ct=function(Bn,yn){return typeof Bn=="string"?Bn:yn.name!==void 0&&yn.message!==void 0?yn.toString():ot(yn)};if(typeof Error.stackTraceLimit=="number"&&typeof Error.captureStackTrace=="function"){Error.stackTraceLimit+=6,q=je,F=ct;var Tt=Error.captureStackTrace;return _e=function(Bn){return O.test(Bn)},function(Bn,yn){Error.stackTraceLimit+=6,Tt(Bn,yn),Error.stackTraceLimit-=6}}var pn=new Error;if(typeof pn.stack=="string"&&pn.stack.split(`
`)[0].indexOf("stackDetection@")>=0)return q=/@/,F=ct,Y=!0,function(yn){yn.stack=new Error().stack};var bn;try{throw new Error}catch(Bn){bn="stack"in Bn}return!("stack"in pn)&&bn&&typeof Error.stackTraceLimit=="number"?(q=je,F=ct,function(yn){Error.stackTraceLimit+=6;try{throw new Error}catch(Jt){yn.stack=Jt.stack}Error.stackTraceLimit-=6}):(F=function(Bn,yn){return typeof Bn=="string"?Bn:(typeof yn=="object"||typeof yn=="function")&&yn.name!==void 0&&yn.message!==void 0?yn.toString():ot(yn)},null)}([]);typeof console!="undefined"&&typeof console.warn!="undefined"&&(G=function(Ne){console.warn(Ne)},E.isNode&&process.stderr.isTTY?G=function(Ne,je){var ct=je?"\x1B[33m":"\x1B[31m";console.warn(ct+Ne+`\x1B[0m
`)}:!E.isNode&&typeof new Error().stack=="string"&&(G=function(Ne,je){console.warn("%c"+Ne,je?"color: darkorange":"color: red")}));var kt={warnings:z,longStackTraces:!1,cancellation:!1,monitoring:!1};return te&&I.longStackTraces(),{longStackTraces:function(){return kt.longStackTraces},warnings:function(){return kt.warnings},cancellation:function(){return kt.cancellation},monitoring:function(){return kt.monitoring},propagateFromFunction:function(){return Ye},boundValueFunction:function(){return Le},checkForgottenReturns:Ee,setBounds:yt,warn:$t,deprecated:pt,CapturedTrace:nt,fireDomEvent:P,fireGlobalEvent:p}}},6381:function(Xe){(function(){var ce,ne={}.hasOwnProperty;Xe.exports=ce=function(){function I(X){var x,M,C,E,R,L,T,O,W;X||(X={}),this.pretty=X.pretty||!1,this.allowEmpty=(M=X.allowEmpty)!=null?M:!1,this.pretty?(this.indent=(C=X.indent)!=null?C:"  ",this.newline=(E=X.newline)!=null?E:`
`,this.offset=(R=X.offset)!=null?R:0,this.dontprettytextnodes=(L=X.dontprettytextnodes)!=null?L:0):(this.indent="",this.newline="",this.offset=0,this.dontprettytextnodes=0),this.spacebeforeslash=(T=X.spacebeforeslash)!=null?T:"",this.spacebeforeslash===!0&&(this.spacebeforeslash=" "),this.newlinedefault=this.newline,this.prettydefault=this.pretty,O=X.writer||{};for(x in O)ne.call(O,x)&&(W=O[x],this[x]=W)}return I.prototype.set=function(X){var x,M,C;X||(X={}),"pretty"in X&&(this.pretty=X.pretty),"allowEmpty"in X&&(this.allowEmpty=X.allowEmpty),this.pretty?(this.indent="indent"in X?X.indent:"  ",this.newline="newline"in X?X.newline:`
`,this.offset="offset"in X?X.offset:0,this.dontprettytextnodes="dontprettytextnodes"in X?X.dontprettytextnodes:0):(this.indent="",this.newline="",this.offset=0,this.dontprettytextnodes=0),this.spacebeforeslash="spacebeforeslash"in X?X.spacebeforeslash:"",this.spacebeforeslash===!0&&(this.spacebeforeslash=" "),this.newlinedefault=this.newline,this.prettydefault=this.pretty,M=X.writer||{};for(x in M)ne.call(M,x)&&(C=M[x],this[x]=C);return this},I.prototype.space=function(X){var x;return this.pretty?(x=(X||0)+this.offset+1,x>0?new Array(x).join(this.indent):""):""},I}()}).call(this)},6421:(Xe,ce,ne)=>{var I,X=ne(8291),x=ne(3746),M=ne(9796),C=ne(6881),E=ne(5584),R=ne(4346),L=ne(8994),T=ne(805);ce.w=O;function O(z){return{convertToHtml:function(te){var V=X.indexBy(te.type===M.types.document?te.comments:[],"commentId"),de=new W(z,V);return de.convertToHtml(te)}}}function W(z,te){var V=1,de=[],P=[];z=X.extend({ignoreEmptyParagraphs:!0},z);var p=z.idPrefix===void 0?"":z.idPrefix,K=z.ignoreEmptyParagraphs,me=C.topLevelElement("p"),pe=z.styleMap||[];function le(ye){var _e=[],$e=A(ye,_e,{}),mt=[];G($e,function(nt){nt.type==="deferred"&&mt.push(nt)});var yt={};return x.mapSeries(mt,function(nt){return nt.value().then(function(ut){yt[nt.id]=ut})}).then(function(){function nt(kt){return Y(kt,function(Ne){return Ne.type==="deferred"?yt[Ne.id]:Ne.children?[X.extend({},Ne,{children:nt(Ne.children)})]:[Ne]})}var ut=T.writer({prettyPrint:z.prettyPrint,outputFormat:z.outputFormat});return L.write(ut,L.simplify(nt($e))),new E.Result(ut.asString(),_e)})}function ue(ye,_e,$e){return Y(ye,function(mt){return A(mt,_e,$e)})}function A(ye,_e,$e){if(!$e)throw new Error("options not set");var mt=gt[ye.type];return mt?mt(ye,_e,$e):[]}function N(ye,_e,$e){return oe(ye,_e).wrap(function(){var mt=ue(ye.children,_e,$e);return K?mt:[L.forceWrite].concat(mt)})}function oe(ye,_e){var $e=Ye(ye);return $e?$e.to:(ye.styleId&&_e.push(F("paragraph",ye)),me)}function ge(ye,_e,$e){var mt=function(){return ue(ye.children,_e,$e)},yt=[];if(ye.highlight!==null){var nt=ke({type:"highlight",color:ye.highlight});nt&&yt.push(nt)}ye.isSmallCaps&&yt.push(ve("smallCaps")),ye.isAllCaps&&yt.push(ve("allCaps")),ye.isStrikethrough&&yt.push(ve("strikethrough","s")),ye.isUnderline&&yt.push(ve("underline")),ye.verticalAlignment===M.verticalAlignment.subscript&&yt.push(C.element("sub",{},{fresh:!1})),ye.verticalAlignment===M.verticalAlignment.superscript&&yt.push(C.element("sup",{},{fresh:!1})),ye.isItalic&&yt.push(ve("italic","em")),ye.isBold&&yt.push(ve("bold","strong"));var ut=C.empty,kt=Ye(ye);return kt?ut=kt.to:ye.styleId&&_e.push(F("run",ye)),yt.push(ut),yt.forEach(function(Ne){mt=Ne.wrap.bind(Ne,mt)}),mt()}function ve(ye,_e){var $e=ke({type:ye});return $e||(_e?C.element(_e,{},{fresh:!1}):C.empty)}function ke(ye,_e){var $e=Ye(ye);return $e?$e.to:_e}function Ye(ye){for(var _e=0;_e<pe.length;_e++)if(pe[_e].from.matches(ye))return pe[_e]}function Le(ye){return function(_e,$e){return x.attempt(function(){return ye(_e,$e)}).caught(function(mt){return $e.push(E.error(mt)),[]})}}function Fe(ye){return Ee(ye.noteType,ye.noteId)}function st(ye){return pt(ye.noteType,ye.noteId)}function Ee(ye,_e){return $t(ye+"-"+_e)}function pt(ye,_e){return $t(ye+"-ref-"+_e)}function $t(ye){return p+ye}var It=C.elements([C.element("table",{},{fresh:!0})]);function _t(ye,_e,$e){return ke(ye,It).wrap(function(){return jt(ye,_e,$e)})}function jt(ye,_e,$e){var mt=X.findIndex(ye.children,function(kt){return!kt.type===M.types.tableRow||!kt.isHeader});mt===-1&&(mt=ye.children.length);var yt;if(mt===0)yt=ue(ye.children,_e,X.extend({},$e,{isTableHeader:!1}));else{var nt=ue(ye.children.slice(0,mt),_e,X.extend({},$e,{isTableHeader:!0})),ut=ue(ye.children.slice(mt),_e,X.extend({},$e,{isTableHeader:!1}));yt=[L.freshElement("thead",{},nt),L.freshElement("tbody",{},ut)]}return[L.forceWrite].concat(yt)}function zt(ye,_e,$e){var mt=ue(ye.children,_e,$e);return[L.freshElement("tr",{},[L.forceWrite].concat(mt))]}function mn(ye,_e,$e){var mt=$e.isTableHeader?"th":"td",yt=ue(ye.children,_e,$e),nt={};return ye.colSpan!==1&&(nt.colspan=ye.colSpan.toString()),ye.rowSpan!==1&&(nt.rowspan=ye.rowSpan.toString()),[L.freshElement(mt,nt,[L.forceWrite].concat(yt))]}function Qn(ye,_e,$e){return ke(ye,C.ignore).wrap(function(){var mt=te[ye.commentId],yt=P.length+1,nt="["+J(mt)+yt+"]";return P.push({label:nt,comment:mt}),[L.freshElement("a",{href:"#"+Ee("comment",ye.commentId),id:pt("comment",ye.commentId)},[L.text(nt)])]})}function En(ye,_e,$e){var mt=ye.label,yt=ye.comment,nt=ue(yt.body,_e,$e).concat([L.nonFreshElement("p",{},[L.text(" "),L.freshElement("a",{href:"#"+pt("comment",yt.commentId)},[L.text("\u2191")])])]);return[L.freshElement("dt",{id:Ee("comment",yt.commentId)},[L.text("Comment "+mt)]),L.freshElement("dd",{},nt)]}function Q(ye,_e,$e){return ot(ye).wrap(function(){return[]})}function ot(ye){var _e=Ye(ye);return _e?_e.to:ye.breakType==="line"?C.topLevelElement("br"):C.empty}var gt={document:function(ye,_e,$e){var mt=ue(ye.children,_e,$e),yt=de.map(function(ut){return ye.notes.resolve(ut)}),nt=ue(yt,_e,$e);return mt.concat([L.freshElement("ol",{},nt),L.freshElement("dl",{},Y(P,function(ut){return En(ut,_e,$e)}))])},paragraph:N,run:ge,text:function(ye,_e,$e){return[L.text(ye.value)]},tab:function(ye,_e,$e){return[L.text("	")]},hyperlink:function(ye,_e,$e){var mt=ye.anchor?"#"+$t(ye.anchor):ye.href,yt={href:mt};ye.targetFrame!=null&&(yt.target=ye.targetFrame);var nt=ue(ye.children,_e,$e);return[L.nonFreshElement("a",yt,nt)]},checkbox:function(ye){var _e={type:"checkbox"};return ye.checked&&(_e.checked="checked"),[L.freshElement("input",_e)]},bookmarkStart:function(ye,_e,$e){var mt=L.freshElement("a",{id:$t(ye.name)},[L.forceWrite]);return[mt]},noteReference:function(ye,_e,$e){de.push(ye);var mt=L.freshElement("a",{href:"#"+Fe(ye),id:st(ye)},[L.text("["+V+++"]")]);return[L.freshElement("sup",{},[mt])]},note:function(ye,_e,$e){var mt=ue(ye.body,_e,$e),yt=L.elementWithTag(C.element("p",{},{fresh:!1}),[L.text(" "),L.freshElement("a",{href:"#"+st(ye)},[L.text("\u2191")])]),nt=mt.concat([yt]);return L.freshElement("li",{id:Fe(ye)},nt)},commentReference:Qn,comment:En,image:q(Le(z.convertImage||R.dataUri)),table:_t,tableRow:zt,tableCell:mn,break:Q};return{convertToHtml:le}}var D=1;function q(z){return function(te,V,de){return[{type:"deferred",id:D++,value:function(){return z(te,V,de)}}]}}function F(z,te){return E.warning("Unrecognised "+z+" style: '"+te.styleName+"' (Style ID: "+te.styleId+")")}function Y(z,te){return X.flatten(z.map(te),!0)}function G(z,te){z.forEach(function(V){te(V),V.children&&G(V.children,te)})}var J=I=function(te){return te.authorInitials||""}},6436:(Xe,ce,ne)=>{"use strict";var I=Object.create;if(I){var X=I(null),x=I(null);X[" size"]=x[" size"]=0}Xe.exports=function(M){var C=ne(7443),E=C.canEvaluate,R=C.isIdentifier,L,T,O=function(J){return new Function("ensureMethod",`                                    
        return function(obj) {                                               
            'use strict'                                                     
            var len = this.length;                                           
            ensureMethod(obj, 'methodName');                                 
            switch(len) {                                                    
                case 1: return obj.methodName(this[0]);                      
                case 2: return obj.methodName(this[0], this[1]);             
                case 3: return obj.methodName(this[0], this[1], this[2]);    
                case 0: return obj.methodName();                             
                default:                                                     
                    return obj.methodName.apply(obj, this);                  
            }                                                                
        };                                                                   
        `.replace(/methodName/g,J))(q)},W=function(J){return new Function("obj",`                                             
        'use strict';                                                        
        return obj.propertyName;                                             
        `.replace("propertyName",J))},D=function(J,z,te){var V=te[J];if(typeof V!="function"){if(!R(J))return null;if(V=z(J),te[J]=V,te[" size"]++,te[" size"]>512){for(var de=Object.keys(te),P=0;P<256;++P)delete te[de[P]];te[" size"]=de.length-256}}return V};L=function(J){return D(J,O,X)},T=function(J){return D(J,W,x)};function q(J,z){var te;if(J!=null&&(te=J[z]),typeof te!="function"){var V="Object "+C.classString(J)+" has no method '"+C.toString(z)+"'";throw new M.TypeError(V)}return te}function F(J){var z=this.pop(),te=q(J,z);return te.apply(J,this)}M.prototype.call=function(J){for(var z=arguments.length,te=new Array(Math.max(z-1,0)),V=1;V<z;++V)te[V-1]=arguments[V];if(E){var de=L(J);if(de!==null)return this._then(de,void 0,void 0,te,void 0)}return te.push(J),this._then(F,void 0,void 0,te,void 0)};function Y(J){return J[this]}function G(J){var z=+this;return z<0&&(z=Math.max(0,z+J.length)),J[z]}M.prototype.get=function(J){var z=typeof J=="number",te;if(z)te=G;else if(E){var V=T(J);te=V!==null?V:Y}else te=Y;return this._then(te,void 0,void 0,J,void 0)}}},6446:(Xe,ce)=>{ce.error=function(I){return new ne(I)};var ne=function(I){this.expected=I.expected,this.actual=I.actual,this._location=I.location};ne.prototype.describe=function(){var I=this._location?this._location.describe()+`:
`:"";return I+"Expected "+this.expected+`
but got `+this.actual},ne.prototype.lineNumber=function(){return this._location.lineNumber()},ne.prototype.characterNumber=function(){return this._location.characterNumber()}},6535:(Xe,ce,ne)=>{var I=ne(5927);ce.DOMImplementation=I.DOMImplementation,ce.XMLSerializer=I.XMLSerializer,ce.DOMParser=ne(7527).DOMParser},6627:(Xe,ce,ne)=>{var I=ne(8167).NAMESPACE,X=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,x=new RegExp("[\\-\\.0-9"+X.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),M=new RegExp("^"+X.source+x.source+"*(?::"+X.source+x.source+"*)?$"),C=0,E=1,R=2,L=3,T=4,O=5,W=6,D=7;function q(pe,le){this.message=pe,this.locator=le,Error.captureStackTrace&&Error.captureStackTrace(this,q)}q.prototype=new Error,q.prototype.name=q.name;function F(){}F.prototype={parse:function(pe,le,ue){var A=this.domBuilder;A.startDocument(),de(le,le={}),Y(pe,le,ue,A,this.errorHandler),A.endDocument()}};function Y(pe,le,ue,A,N){function oe(ut){if(ut>65535){ut-=65536;var kt=55296+(ut>>10),Ne=56320+(ut&1023);return String.fromCharCode(kt,Ne)}else return String.fromCharCode(ut)}function ge(ut){var kt=ut.slice(1,-1);return Object.hasOwnProperty.call(ue,kt)?ue[kt]:kt.charAt(0)==="#"?oe(parseInt(kt.substr(1).replace("x","0x"))):(N.error("entity not found:"+ut),ut)}function ve(ut){if(ut>$t){var kt=pe.substring($t,ut).replace(/&#?\w+;/g,ge);st&&ke($t),A.characters(kt,0,ut-$t),$t=ut}}function ke(ut,kt){for(;ut>=Le&&(kt=Fe.exec(pe));)Ye=kt.index,Le=Ye+kt[0].length,st.lineNumber++;st.columnNumber=ut-Ye+1}for(var Ye=0,Le=0,Fe=/.*(?:\r\n?|\n)|.*$/g,st=A.locator,Ee=[{currentNSMap:le}],pt={},$t=0;;){try{var It=pe.indexOf("<",$t);if(It<0){if(!pe.substr($t).match(/^\s*$/)){var _t=A.doc,jt=_t.createTextNode(pe.substr($t));_t.appendChild(jt),A.currentElement=jt}return}switch(It>$t&&ve(It),pe.charAt(It+1)){case"/":var _e=pe.indexOf(">",It+3),zt=pe.substring(It+2,_e).replace(/[ \t\n\r]+$/g,""),mn=Ee.pop();_e<0?(zt=pe.substring(It+2).replace(/[\s<].*/,""),N.error("end tag name: "+zt+" is not complete:"+mn.tagName),_e=It+1+zt.length):zt.match(/\s</)&&(zt=zt.replace(/[\s<].*/,""),N.error("end tag name: "+zt+" maybe not complete"),_e=It+1+zt.length);var Qn=mn.localNSMap,En=mn.tagName==zt,Q=En||mn.tagName&&mn.tagName.toLowerCase()==zt.toLowerCase();if(Q){if(A.endElement(mn.uri,mn.localName,zt),Qn)for(var ot in Qn)Object.prototype.hasOwnProperty.call(Qn,ot)&&A.endPrefixMapping(ot);En||N.fatalError("end tag name: "+zt+" is not match the current start tagName:"+mn.tagName)}else Ee.push(mn);_e++;break;case"?":st&&ke(It),_e=p(pe,It,A);break;case"!":st&&ke(It),_e=P(pe,It,A,N);break;default:st&&ke(It);var gt=new K,ye=Ee[Ee.length-1].currentNSMap,_e=J(pe,It,gt,ye,ge,N),$e=gt.length;if(!gt.closed&&V(pe,_e,gt.tagName,pt)&&(gt.closed=!0,ue.nbsp||N.warning("unclosed xml attribute")),st&&$e){for(var mt=G(st,{}),yt=0;yt<$e;yt++){var nt=gt[yt];ke(nt.offset),nt.locator=G(st,{})}A.locator=mt,z(gt,A,ye)&&Ee.push(gt),A.locator=st}else z(gt,A,ye)&&Ee.push(gt);I.isHTML(gt.uri)&&!gt.closed?_e=te(pe,_e,gt.tagName,ge,A):_e++}}catch(ut){if(ut instanceof q)throw ut;N.error("element parse error: "+ut),_e=-1}_e>$t?$t=_e:ve(Math.max(It,$t)+1)}}function G(pe,le){return le.lineNumber=pe.lineNumber,le.columnNumber=pe.columnNumber,le}function J(pe,le,ue,A,N,oe){function ge(Ee,pt,$t){ue.attributeNames.hasOwnProperty(Ee)&&oe.fatalError("Attribute "+Ee+" redefined"),ue.addValue(Ee,pt.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,N),$t)}for(var ve,ke,Ye=++le,Le=C;;){var Fe=pe.charAt(Ye);switch(Fe){case"=":if(Le===E)ve=pe.slice(le,Ye),Le=L;else if(Le===R)Le=L;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(Le===L||Le===E)if(Le===E&&(oe.warning('attribute value must after "="'),ve=pe.slice(le,Ye)),le=Ye+1,Ye=pe.indexOf(Fe,le),Ye>0)ke=pe.slice(le,Ye),ge(ve,ke,le-1),Le=O;else throw new Error("attribute value no end '"+Fe+"' match");else if(Le==T)ke=pe.slice(le,Ye),ge(ve,ke,le),oe.warning('attribute "'+ve+'" missed start quot('+Fe+")!!"),le=Ye+1,Le=O;else throw new Error('attribute value must after "="');break;case"/":switch(Le){case C:ue.setTagName(pe.slice(le,Ye));case O:case W:case D:Le=D,ue.closed=!0;case T:case E:break;case R:ue.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return oe.error("unexpected end of input"),Le==C&&ue.setTagName(pe.slice(le,Ye)),Ye;case">":switch(Le){case C:ue.setTagName(pe.slice(le,Ye));case O:case W:case D:break;case T:case E:ke=pe.slice(le,Ye),ke.slice(-1)==="/"&&(ue.closed=!0,ke=ke.slice(0,-1));case R:Le===R&&(ke=ve),Le==T?(oe.warning('attribute "'+ke+'" missed quot(")!'),ge(ve,ke,le)):((!I.isHTML(A[""])||!ke.match(/^(?:disabled|checked|selected)$/i))&&oe.warning('attribute "'+ke+'" missed value!! "'+ke+'" instead!!'),ge(ke,ke,le));break;case L:throw new Error("attribute value missed!!")}return Ye;case"\x80":Fe=" ";default:if(Fe<=" ")switch(Le){case C:ue.setTagName(pe.slice(le,Ye)),Le=W;break;case E:ve=pe.slice(le,Ye),Le=R;break;case T:var ke=pe.slice(le,Ye);oe.warning('attribute "'+ke+'" missed quot(")!!'),ge(ve,ke,le);case O:Le=W;break}else switch(Le){case R:var st=ue.tagName;(!I.isHTML(A[""])||!ve.match(/^(?:disabled|checked|selected)$/i))&&oe.warning('attribute "'+ve+'" missed value!! "'+ve+'" instead2!!'),ge(ve,ve,le),le=Ye,Le=E;break;case O:oe.warning('attribute space is required"'+ve+'"!!');case W:Le=E,le=Ye;break;case L:Le=T,le=Ye;break;case D:throw new Error("elements closed character '/' and '>' must be connected to")}}Ye++}}function z(pe,le,ue){for(var A=pe.tagName,N=null,Fe=pe.length;Fe--;){var oe=pe[Fe],ge=oe.qName,ve=oe.value,st=ge.indexOf(":");if(st>0)var ke=oe.prefix=ge.slice(0,st),Ye=ge.slice(st+1),Le=ke==="xmlns"&&Ye;else Ye=ge,ke=null,Le=ge==="xmlns"&&"";oe.localName=Ye,Le!==!1&&(N==null&&(N={},de(ue,ue={})),ue[Le]=N[Le]=ve,oe.uri=I.XMLNS,le.startPrefixMapping(Le,ve))}for(var Fe=pe.length;Fe--;){oe=pe[Fe];var ke=oe.prefix;ke&&(ke==="xml"&&(oe.uri=I.XML),ke!=="xmlns"&&(oe.uri=ue[ke||""]))}var st=A.indexOf(":");st>0?(ke=pe.prefix=A.slice(0,st),Ye=pe.localName=A.slice(st+1)):(ke=null,Ye=pe.localName=A);var Ee=pe.uri=ue[ke||""];if(le.startElement(Ee,Ye,A,pe),pe.closed){if(le.endElement(Ee,Ye,A),N)for(ke in N)Object.prototype.hasOwnProperty.call(N,ke)&&le.endPrefixMapping(ke)}else return pe.currentNSMap=ue,pe.localNSMap=N,!0}function te(pe,le,ue,A,N){if(/^(?:script|textarea)$/i.test(ue)){var oe=pe.indexOf("</"+ue+">",le),ge=pe.substring(le+1,oe);if(/[&<]/.test(ge))return/^script$/i.test(ue)?(N.characters(ge,0,ge.length),oe):(ge=ge.replace(/&#?\w+;/g,A),N.characters(ge,0,ge.length),oe)}return le+1}function V(pe,le,ue,A){var N=A[ue];return N==null&&(N=pe.lastIndexOf("</"+ue+">"),N<le&&(N=pe.lastIndexOf("</"+ue)),A[ue]=N),N<le}function de(pe,le){for(var ue in pe)Object.prototype.hasOwnProperty.call(pe,ue)&&(le[ue]=pe[ue])}function P(pe,le,ue,A){var N=pe.charAt(le+2);switch(N){case"-":if(pe.charAt(le+3)==="-"){var oe=pe.indexOf("-->",le+4);return oe>le?(ue.comment(pe,le+4,oe-le-4),oe+3):(A.error("Unclosed comment"),-1)}else return-1;default:if(pe.substr(le+3,6)=="CDATA["){var oe=pe.indexOf("]]>",le+9);return ue.startCDATA(),ue.characters(pe,le+9,oe-le-9),ue.endCDATA(),oe+3}var ge=me(pe,le),ve=ge.length;if(ve>1&&/!doctype/i.test(ge[0][0])){var ke=ge[1][0],Ye=!1,Le=!1;ve>3&&(/^public$/i.test(ge[2][0])?(Ye=ge[3][0],Le=ve>4&&ge[4][0]):/^system$/i.test(ge[2][0])&&(Le=ge[3][0]));var Fe=ge[ve-1];return ue.startDTD(ke,Ye,Le),ue.endDTD(),Fe.index+Fe[0].length}}return-1}function p(pe,le,ue){var A=pe.indexOf("?>",le);if(A){var N=pe.substring(le,A).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(N){var oe=N[0].length;return ue.processingInstruction(N[1],N[2]),A+2}else return-1}return-1}function K(){this.attributeNames={}}K.prototype={setTagName:function(pe){if(!M.test(pe))throw new Error("invalid tagName:"+pe);this.tagName=pe},addValue:function(pe,le,ue){if(!M.test(pe))throw new Error("invalid attribute:"+pe);this.attributeNames[pe]=this.length,this[this.length++]={qName:pe,value:le,offset:ue}},length:0,getLocalName:function(pe){return this[pe].localName},getLocator:function(pe){return this[pe].locator},getQName:function(pe){return this[pe].qName},getURI:function(pe){return this[pe].uri},getValue:function(pe){return this[pe].value}};function me(pe,le){var ue,A=[],N=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(N.lastIndex=le,N.exec(pe);ue=N.exec(pe);)if(A.push(ue),ue[1])return A}ce.XMLReader=F,ce.ParseError=q},6881:(Xe,ce,ne)=>{var I=ne(8291),X=ne(8994);ce.topLevelElement=x,ce.elements=M,ce.element=E;function x(L,T){return M([E(L,T,{fresh:!0})])}function M(L){return new C(L.map(function(T){return I.isString(T)?E(T):T}))}function C(L){this._elements=L}C.prototype.wrap=function(T){for(var O=T(),W=this._elements.length-1;W>=0;W--)O=this._elements[W].wrapNodes(O);return O};function E(L,T,O){return O=O||{},new R(L,T,O)}function R(L,T,O){var W={};I.isArray(L)?(L.forEach(function(D){W[D]=!0}),L=L[0]):W[L]=!0,this.tagName=L,this.tagNames=W,this.attributes=T||{},this.fresh=O.fresh,this.separator=O.separator}R.prototype.matchesElement=function(L){return this.tagNames[L.tagName]&&I.isEqual(this.attributes||{},L.attributes||{})},R.prototype.wrap=function(T){return this.wrapNodes(T())},R.prototype.wrapNodes=function(T){return[X.elementWithTag(this,T)]},ce.empty=M([]),ce.ignore={wrap:function(){return[]}}},6987:(Xe,ce,ne)=>{var I,X=ne(8291),x=ne(193),M=ne(746),C=ne(6881),E=ne(79).t,R=ne(5584);I=D,I=O,ce._T=L;function L(pe){return P(me,pe)}function T(){return x.rules.sequence(x.rules.sequence.capture(W()),x.rules.tokenOfType("whitespace"),x.rules.tokenOfType("arrow"),x.rules.sequence.capture(x.rules.optional(x.rules.sequence(x.rules.tokenOfType("whitespace"),x.rules.sequence.capture(q())).head())),x.rules.tokenOfType("end")).map(function(pe,le){return{from:pe,to:le.valueOrElse(C.empty)}})}function O(pe){return P(W(),pe)}function W(){var pe=x.rules.sequence,le=function(En,Q){return x.rules.then(x.rules.token("identifier",En),function(){return Q})},ue=le("p",M.paragraph),A=le("r",M.run),N=x.rules.firstOf("p or r or table",ue,A),oe=x.rules.sequence(x.rules.tokenOfType("dot"),x.rules.sequence.cut(),x.rules.sequence.capture(F)).map(function(En){return{styleId:En}}),ge=x.rules.firstOf("style name matcher",x.rules.then(x.rules.sequence(x.rules.tokenOfType("equals"),x.rules.sequence.cut(),x.rules.sequence.capture(G)).head(),function(En){return{styleName:M.equalTo(En)}}),x.rules.then(x.rules.sequence(x.rules.tokenOfType("startsWith"),x.rules.sequence.cut(),x.rules.sequence.capture(G)).head(),function(En){return{styleName:M.startsWith(En)}})),ve=x.rules.sequence(x.rules.tokenOfType("open-square-bracket"),x.rules.sequence.cut(),x.rules.token("identifier","style-name"),x.rules.sequence.capture(ge),x.rules.tokenOfType("close-square-bracket")).head(),ke=x.rules.firstOf("list type",le("ordered-list",{isOrdered:!0}),le("unordered-list",{isOrdered:!1})),Ye=pe(x.rules.tokenOfType("colon"),pe.capture(ke),pe.cut(),x.rules.tokenOfType("open-paren"),pe.capture(Y),x.rules.tokenOfType("close-paren")).map(function(En,Q){return{list:{isOrdered:En.isOrdered,levelIndex:Q-1}}});function Le(En){var Q=x.rules.firstOf.apply(x.rules.firstOf,["matcher suffix"].concat(En)),ot=x.rules.zeroOrMore(Q);return x.rules.then(ot,function(gt){var ye={};return gt.forEach(function(_e){X.extend(ye,_e)}),ye})}var Fe=pe(pe.capture(N),pe.capture(Le([oe,ve,Ye]))).map(function(En,Q){return En(Q)}),st=pe(x.rules.token("identifier","table"),pe.capture(Le([oe,ve]))).map(function(En){return M.table(En)}),Ee=le("b",M.bold),pt=le("i",M.italic),$t=le("u",M.underline),It=le("strike",M.strikethrough),_t=le("all-caps",M.allCaps),jt=le("small-caps",M.smallCaps),zt=pe(x.rules.token("identifier","highlight"),x.rules.sequence.capture(x.rules.optional(x.rules.sequence(x.rules.tokenOfType("open-square-bracket"),x.rules.sequence.cut(),x.rules.token("identifier","color"),x.rules.tokenOfType("equals"),x.rules.sequence.capture(G),x.rules.tokenOfType("close-square-bracket")).head()))).map(function(En){return M.highlight({color:En.valueOrElse(void 0)})}),mn=le("comment-reference",M.commentReference),Qn=pe(x.rules.token("identifier","br"),pe.cut(),x.rules.tokenOfType("open-square-bracket"),x.rules.token("identifier","type"),x.rules.tokenOfType("equals"),pe.capture(G),x.rules.tokenOfType("close-square-bracket")).map(function(En){switch(En){case"line":return M.lineBreak;case"page":return M.pageBreak;case"column":return M.columnBreak;default:}});return x.rules.firstOf("element type",Fe,st,Ee,pt,$t,It,_t,jt,zt,mn,Qn)}function D(pe){return P(q(),pe)}function q(){var pe=x.rules.sequence.capture,le=x.rules.tokenOfType("whitespace"),ue=x.rules.then(x.rules.optional(x.rules.sequence(x.rules.tokenOfType("colon"),x.rules.token("identifier","fresh"))),function(ge){return ge.map(function(){return!0}).valueOrElse(!1)}),A=x.rules.then(x.rules.optional(x.rules.sequence(x.rules.tokenOfType("colon"),x.rules.token("identifier","separator"),x.rules.tokenOfType("open-paren"),pe(G),x.rules.tokenOfType("close-paren")).head()),function(ge){return ge.valueOrElse("")}),N=x.rules.oneOrMoreWithSeparator(F,x.rules.tokenOfType("choice")),oe=x.rules.sequence(pe(N),pe(x.rules.zeroOrMore(de)),pe(ue),pe(A)).map(function(ge,ve,ke,Ye){var Le={},Fe={};return ve.forEach(function(st){st.append&&Le[st.name]?Le[st.name]+=" "+st.value:Le[st.name]=st.value}),ke&&(Fe.fresh=!0),Ye&&(Fe.separator=Ye),C.element(ge,Le,Fe)});return x.rules.firstOf("html path",x.rules.then(x.rules.tokenOfType("bang"),function(){return C.ignore}),x.rules.then(x.rules.zeroOrMoreWithSeparator(oe,x.rules.sequence(le,x.rules.tokenOfType("gt"),le)),C.elements))}var F=x.rules.then(x.rules.tokenOfType("identifier"),z),Y=x.rules.tokenOfType("integer"),G=x.rules.then(x.rules.tokenOfType("string"),z),J={n:`
`,r:"\r",t:"	"};function z(pe){return pe.replace(/\\(.)/g,function(le,ue){return J[ue]||ue})}var te=x.rules.sequence(x.rules.tokenOfType("open-square-bracket"),x.rules.sequence.cut(),x.rules.sequence.capture(F),x.rules.tokenOfType("equals"),x.rules.sequence.capture(G),x.rules.tokenOfType("close-square-bracket")).map(function(pe,le){return{name:pe,value:le,append:!1}}),V=x.rules.sequence(x.rules.tokenOfType("dot"),x.rules.sequence.cut(),x.rules.sequence.capture(F)).map(function(pe){return{name:"class",value:pe,append:!0}}),de=x.rules.firstOf("attribute or class",te,V);function P(pe,le){var ue=E(le),A=x.Parser(),N=A.parseTokens(pe,ue);return N.isSuccess()?R.success(N.value()):new R.Result(null,[R.warning(p(le,N))])}function p(pe,le){return"Did not understand this style mapping, so ignored it: "+pe+`
`+le.errors().map(K).join(`
`)}function K(pe){return"Error was at character number "+pe.characterNumber()+": Expected "+pe.expected+" but got "+pe.actual}var me=T()},7005:function(Xe){(function(){var ce,ne=function(X,x){return function(){return X.apply(x,arguments)}},I={}.hasOwnProperty;Xe.exports=ce=function(){function X(x){this.assertLegalChar=ne(this.assertLegalChar,this);var M,C,E;x||(x={}),this.noDoubleEncoding=x.noDoubleEncoding,C=x.stringify||{};for(M in C)I.call(C,M)&&(E=C[M],this[M]=E)}return X.prototype.eleName=function(x){return x=""+x||"",this.assertLegalChar(x)},X.prototype.eleText=function(x){return x=""+x||"",this.assertLegalChar(this.elEscape(x))},X.prototype.cdata=function(x){return x=""+x||"",x=x.replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(x)},X.prototype.comment=function(x){if(x=""+x||"",x.match(/--/))throw new Error("Comment text cannot contain double-hypen: "+x);return this.assertLegalChar(x)},X.prototype.raw=function(x){return""+x||""},X.prototype.attName=function(x){return x=""+x||""},X.prototype.attValue=function(x){return x=""+x||"",this.attEscape(x)},X.prototype.insTarget=function(x){return""+x||""},X.prototype.insValue=function(x){if(x=""+x||"",x.match(/\?>/))throw new Error("Invalid processing instruction value: "+x);return x},X.prototype.xmlVersion=function(x){if(x=""+x||"",!x.match(/1\.[0-9]+/))throw new Error("Invalid version number: "+x);return x},X.prototype.xmlEncoding=function(x){if(x=""+x||"",!x.match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+x);return x},X.prototype.xmlStandalone=function(x){return x?"yes":"no"},X.prototype.dtdPubID=function(x){return""+x||""},X.prototype.dtdSysID=function(x){return""+x||""},X.prototype.dtdElementValue=function(x){return""+x||""},X.prototype.dtdAttType=function(x){return""+x||""},X.prototype.dtdAttDefault=function(x){return x!=null?""+x||"":x},X.prototype.dtdEntityValue=function(x){return""+x||""},X.prototype.dtdNData=function(x){return""+x||""},X.prototype.convertAttKey="@",X.prototype.convertPIKey="?",X.prototype.convertTextKey="#text",X.prototype.convertCDataKey="#cdata",X.prototype.convertCommentKey="#comment",X.prototype.convertRawKey="#raw",X.prototype.assertLegalChar=function(x){var M;if(M=x.match(/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/),M)throw new Error("Invalid character in string: "+x+" at index "+M.index);return x},X.prototype.elEscape=function(x){var M;return M=this.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,x.replace(M,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")},X.prototype.attEscape=function(x){var M;return M=this.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,x.replace(M,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")},X}()}).call(this)},7025:function(Xe,ce,ne){(function(){var I,X,x=function(C,E){for(var R in E)M.call(E,R)&&(C[R]=E[R]);function L(){this.constructor=C}return L.prototype=E.prototype,C.prototype=new L,C.__super__=E.prototype,C},M={}.hasOwnProperty;I=ne(3523),Xe.exports=X=function(C){x(E,C);function E(R,L){if(E.__super__.constructor.call(this,R),L==null)throw new Error("Missing raw text. "+this.debugInfo());this.value=this.stringify.raw(L)}return E.prototype.clone=function(){return Object.create(this)},E.prototype.toString=function(R){return this.options.writer.set(R).raw(this)},E}(I)}).call(this)},7042:Xe=>{Xe.exports={failure:function(ne,I){if(ne.length<1)throw new Error("Failure must have errors");return new ce({status:"failure",remaining:I,errors:ne})},error:function(ne,I){if(ne.length<1)throw new Error("Failure must have errors");return new ce({status:"error",remaining:I,errors:ne})},success:function(ne,I,X){return new ce({status:"success",value:ne,source:X,remaining:I,errors:[]})},cut:function(ne){return new ce({status:"cut",remaining:ne,errors:[]})}};var ce=function(ne){this._value=ne.value,this._status=ne.status,this._hasValue=ne.value!==void 0,this._remaining=ne.remaining,this._source=ne.source,this._errors=ne.errors};ce.prototype.map=function(ne){return this._hasValue?new ce({value:ne(this._value,this._source),status:this._status,remaining:this._remaining,source:this._source,errors:this._errors}):this},ce.prototype.changeRemaining=function(ne){return new ce({value:this._value,status:this._status,remaining:ne,source:this._source,errors:this._errors})},ce.prototype.isSuccess=function(){return this._status==="success"||this._status==="cut"},ce.prototype.isFailure=function(){return this._status==="failure"},ce.prototype.isError=function(){return this._status==="error"},ce.prototype.isCut=function(){return this._status==="cut"},ce.prototype.value=function(){return this._value},ce.prototype.remaining=function(){return this._remaining},ce.prototype.source=function(){return this._source},ce.prototype.errors=function(){return this._errors}},7048:Xe=>{var ce=function(){"use strict";return this===void 0}();if(ce)Xe.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:ce,propertyIsWritable:function(T,O){var W=Object.getOwnPropertyDescriptor(T,O);return!!(!W||W.writable||W.set)}};else{var ne={}.hasOwnProperty,I={}.toString,X={}.constructor.prototype,x=function(T){var O=[];for(var W in T)ne.call(T,W)&&O.push(W);return O},M=function(T,O){return{value:T[O]}},C=function(T,O,W){return T[O]=W.value,T},E=function(T){return T},R=function(T){try{return Object(T).constructor.prototype}catch(O){return X}},L=function(T){try{return I.call(T)==="[object Array]"}catch(O){return!1}};Xe.exports={isArray:L,keys:x,names:x,defineProperty:C,getDescriptor:M,freeze:E,getPrototypeOf:R,isES5:ce,propertyIsWritable:function(){return!0}}}},7067:(Xe,ce,ne)=>{var I=ne(8291),X=ne(3746),x=ne(1088);ce.writeStyleMap=R,ce.readStyleMap=W;var M="http://schemas.zwobble.org/mammoth/style-map",C="mammoth/style-map",E="/"+C;function R(D,q){return D.write(C,q),L(D).then(function(){return T(D)})}function L(D){var q="word/_rels/document.xml.rels",F="http://schemas.openxmlformats.org/package/2006/relationships",Y="{"+F+"}Relationship";return D.read(q,"utf8").then(x.readString).then(function(G){var J=G.children;O(J,Y,"Id",{Id:"rMammothStyleMap",Type:M,Target:E});var z={"":F};return D.write(q,x.writeString(G,z))})}function T(D){var q="[Content_Types].xml",F="http://schemas.openxmlformats.org/package/2006/content-types",Y="{"+F+"}Override";return D.read(q,"utf8").then(x.readString).then(function(G){var J=G.children;O(J,Y,"PartName",{PartName:E,ContentType:"text/prs.mammoth.style-map"});var z={"":F};return D.write(q,x.writeString(G,z))})}function O(D,q,F,Y){var G=I.find(D,function(J){return J.name===q&&J.attributes[F]===Y[F]});G?G.attributes=Y:D.push(x.element(q,Y))}function W(D){return D.exists(C)?D.read(C,"utf8"):X.resolve(null)}},7140:Xe=>{Xe.exports=function(ce,ne,I){this.name=ce,this.value=ne,I&&(this.source=I)}},7443:function(Xe,ce,ne){"use strict";var I=ne(7048),X=typeof navigator=="undefined",x={e:{}},M,C=typeof self!="undefined"?self:typeof window!="undefined"?window:typeof ne.g!="undefined"?ne.g:this!==void 0?this:null;function E(){try{var Ee=M;return M=null,Ee.apply(this,arguments)}catch(pt){return x.e=pt,x}}function R(Ee){return M=Ee,E}var L=function(Ee,pt){var $t={}.hasOwnProperty;function It(){this.constructor=Ee,this.constructor$=pt;for(var _t in pt.prototype)$t.call(pt.prototype,_t)&&_t.charAt(_t.length-1)!=="$"&&(this[_t+"$"]=pt.prototype[_t])}return It.prototype=pt.prototype,Ee.prototype=new It,Ee.prototype};function T(Ee){return Ee==null||Ee===!0||Ee===!1||typeof Ee=="string"||typeof Ee=="number"}function O(Ee){return typeof Ee=="function"||typeof Ee=="object"&&Ee!==null}function W(Ee){return T(Ee)?new Error(p(Ee)):Ee}function D(Ee,pt){var $t=Ee.length,It=new Array($t+1),_t;for(_t=0;_t<$t;++_t)It[_t]=Ee[_t];return It[_t]=pt,It}function q(Ee,pt,$t){if(I.isES5){var It=Object.getOwnPropertyDescriptor(Ee,pt);if(It!=null)return It.get==null&&It.set==null?It.value:$t}else return{}.hasOwnProperty.call(Ee,pt)?Ee[pt]:void 0}function F(Ee,pt,$t){if(T(Ee))return Ee;var It={value:$t,configurable:!0,enumerable:!1,writable:!0};return I.defineProperty(Ee,pt,It),Ee}function Y(Ee){throw Ee}var G=function(){var Ee=[Array.prototype,Object.prototype,Function.prototype],pt=function(_t){for(var jt=0;jt<Ee.length;++jt)if(Ee[jt]===_t)return!0;return!1};if(I.isES5){var $t=Object.getOwnPropertyNames;return function(_t){for(var jt=[],zt=Object.create(null);_t!=null&&!pt(_t);){var mn;try{mn=$t(_t)}catch(ot){return jt}for(var Qn=0;Qn<mn.length;++Qn){var En=mn[Qn];if(!zt[En]){zt[En]=!0;var Q=Object.getOwnPropertyDescriptor(_t,En);Q!=null&&Q.get==null&&Q.set==null&&jt.push(En)}}_t=I.getPrototypeOf(_t)}return jt}}else{var It={}.hasOwnProperty;return function(_t){if(pt(_t))return[];var jt=[];e:for(var zt in _t)if(It.call(_t,zt))jt.push(zt);else{for(var mn=0;mn<Ee.length;++mn)if(It.call(Ee[mn],zt))continue e;jt.push(zt)}return jt}}}(),J=/this\s*\.\s*\S+\s*=/;function z(Ee){try{if(typeof Ee=="function"){var pt=I.names(Ee.prototype),$t=I.isES5&&pt.length>1,It=pt.length>0&&!(pt.length===1&&pt[0]==="constructor"),_t=J.test(Ee+"")&&I.names(Ee).length>0;if($t||It||_t)return!0}return!1}catch(jt){return!1}}function te(Ee){function pt(){}pt.prototype=Ee;for(var $t=8;$t--;)new pt;return Ee}var V=/^[a-z$_][a-z$_0-9]*$/i;function de(Ee){return V.test(Ee)}function P(Ee,pt,$t){for(var It=new Array(Ee),_t=0;_t<Ee;++_t)It[_t]=pt+_t+$t;return It}function p(Ee){try{return Ee+""}catch(pt){return"[no string representation]"}}function K(Ee){return Ee!==null&&typeof Ee=="object"&&typeof Ee.message=="string"&&typeof Ee.name=="string"}function me(Ee){try{F(Ee,"isOperational",!0)}catch(pt){}}function pe(Ee){return Ee==null?!1:Ee instanceof Error.__BluebirdErrorTypes__.OperationalError||Ee.isOperational===!0}function le(Ee){return K(Ee)&&I.propertyIsWritable(Ee,"stack")}var ue=function(){return"stack"in new Error?function(Ee){return le(Ee)?Ee:new Error(p(Ee))}:function(Ee){if(le(Ee))return Ee;try{throw new Error(p(Ee))}catch(pt){return pt}}}();function A(Ee){return{}.toString.call(Ee)}function N(Ee,pt,$t){for(var It=I.names(Ee),_t=0;_t<It.length;++_t){var jt=It[_t];if($t(jt))try{I.defineProperty(pt,jt,I.getDescriptor(Ee,jt))}catch(zt){}}}var oe=function(Ee){return I.isArray(Ee)?Ee:null};if(typeof Symbol!="undefined"&&Symbol.iterator){var ge=typeof Array.from=="function"?function(Ee){return Array.from(Ee)}:function(Ee){for(var pt=[],$t=Ee[Symbol.iterator](),It;!(It=$t.next()).done;)pt.push(It.value);return pt};oe=function(Ee){return I.isArray(Ee)?Ee:Ee!=null&&typeof Ee[Symbol.iterator]=="function"?ge(Ee):null}}var ve=typeof process!="undefined"&&A(process).toLowerCase()==="[object process]",ke=typeof process!="undefined"&&typeof process.env!="undefined";function Ye(Ee){return ke?process.env[Ee]:void 0}function Le(){if(typeof Promise=="function")try{var Ee=new Promise(function(){});if({}.toString.call(Ee)==="[object Promise]")return Promise}catch(pt){}}function Fe(Ee,pt){return Ee.bind(pt)}var st={isClass:z,isIdentifier:de,inheritedDataKeys:G,getDataPropertyOrDefault:q,thrower:Y,isArray:I.isArray,asArray:oe,notEnumerableProp:F,isPrimitive:T,isObject:O,isError:K,canEvaluate:X,errorObj:x,tryCatch:R,inherits:L,withAppended:D,maybeWrapAsError:W,toFastProperties:te,filledRange:P,toString:p,canAttachTrace:le,ensureErrorObject:ue,originatesFromRejection:pe,markAsOriginatingFromRejection:me,classString:A,copyDescriptors:N,hasDevTools:typeof chrome!="undefined"&&chrome&&typeof chrome.loadTimes=="function",isNode:ve,hasEnvVariables:ke,env:Ye,global:C,getNativePromise:Le,domainBind:Fe};st.isRecentNode=st.isNode&&function(){var Ee=process.versions.node.split(".").map(Number);return Ee[0]===0&&Ee[1]>10||Ee[0]>0}(),st.isNode&&st.toFastProperties(process);try{throw new Error}catch(Ee){st.lastLineError=Ee}Xe.exports=st},7453:(Xe,ce,ne)=>{var I=ne(6535),X=ne(5927);function x(M){var C=null,E=new I.DOMParser({errorHandler:function(L,T){C={level:L,message:T}}}),R=E.parseFromString(M);if(C===null)return R;throw new Error(C.level+": "+C.message)}ce.parseFromString=x,ce.Node=X.Node},7460:(Xe,ce,ne)=>{"use strict";var I=ne(8167).freeze;ce.XML_ENTITIES=I({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),ce.HTML_ENTITIES=I({Aacute:"\xC1",aacute:"\xE1",Abreve:"\u0102",abreve:"\u0103",ac:"\u223E",acd:"\u223F",acE:"\u223E\u0333",Acirc:"\xC2",acirc:"\xE2",acute:"\xB4",Acy:"\u0410",acy:"\u0430",AElig:"\xC6",aelig:"\xE6",af:"\u2061",Afr:"\u{1D504}",afr:"\u{1D51E}",Agrave:"\xC0",agrave:"\xE0",alefsym:"\u2135",aleph:"\u2135",Alpha:"\u0391",alpha:"\u03B1",Amacr:"\u0100",amacr:"\u0101",amalg:"\u2A3F",AMP:"&",amp:"&",And:"\u2A53",and:"\u2227",andand:"\u2A55",andd:"\u2A5C",andslope:"\u2A58",andv:"\u2A5A",ang:"\u2220",ange:"\u29A4",angle:"\u2220",angmsd:"\u2221",angmsdaa:"\u29A8",angmsdab:"\u29A9",angmsdac:"\u29AA",angmsdad:"\u29AB",angmsdae:"\u29AC",angmsdaf:"\u29AD",angmsdag:"\u29AE",angmsdah:"\u29AF",angrt:"\u221F",angrtvb:"\u22BE",angrtvbd:"\u299D",angsph:"\u2222",angst:"\xC5",angzarr:"\u237C",Aogon:"\u0104",aogon:"\u0105",Aopf:"\u{1D538}",aopf:"\u{1D552}",ap:"\u2248",apacir:"\u2A6F",apE:"\u2A70",ape:"\u224A",apid:"\u224B",apos:"'",ApplyFunction:"\u2061",approx:"\u2248",approxeq:"\u224A",Aring:"\xC5",aring:"\xE5",Ascr:"\u{1D49C}",ascr:"\u{1D4B6}",Assign:"\u2254",ast:"*",asymp:"\u2248",asympeq:"\u224D",Atilde:"\xC3",atilde:"\xE3",Auml:"\xC4",auml:"\xE4",awconint:"\u2233",awint:"\u2A11",backcong:"\u224C",backepsilon:"\u03F6",backprime:"\u2035",backsim:"\u223D",backsimeq:"\u22CD",Backslash:"\u2216",Barv:"\u2AE7",barvee:"\u22BD",Barwed:"\u2306",barwed:"\u2305",barwedge:"\u2305",bbrk:"\u23B5",bbrktbrk:"\u23B6",bcong:"\u224C",Bcy:"\u0411",bcy:"\u0431",bdquo:"\u201E",becaus:"\u2235",Because:"\u2235",because:"\u2235",bemptyv:"\u29B0",bepsi:"\u03F6",bernou:"\u212C",Bernoullis:"\u212C",Beta:"\u0392",beta:"\u03B2",beth:"\u2136",between:"\u226C",Bfr:"\u{1D505}",bfr:"\u{1D51F}",bigcap:"\u22C2",bigcirc:"\u25EF",bigcup:"\u22C3",bigodot:"\u2A00",bigoplus:"\u2A01",bigotimes:"\u2A02",bigsqcup:"\u2A06",bigstar:"\u2605",bigtriangledown:"\u25BD",bigtriangleup:"\u25B3",biguplus:"\u2A04",bigvee:"\u22C1",bigwedge:"\u22C0",bkarow:"\u290D",blacklozenge:"\u29EB",blacksquare:"\u25AA",blacktriangle:"\u25B4",blacktriangledown:"\u25BE",blacktriangleleft:"\u25C2",blacktriangleright:"\u25B8",blank:"\u2423",blk12:"\u2592",blk14:"\u2591",blk34:"\u2593",block:"\u2588",bne:"=\u20E5",bnequiv:"\u2261\u20E5",bNot:"\u2AED",bnot:"\u2310",Bopf:"\u{1D539}",bopf:"\u{1D553}",bot:"\u22A5",bottom:"\u22A5",bowtie:"\u22C8",boxbox:"\u29C9",boxDL:"\u2557",boxDl:"\u2556",boxdL:"\u2555",boxdl:"\u2510",boxDR:"\u2554",boxDr:"\u2553",boxdR:"\u2552",boxdr:"\u250C",boxH:"\u2550",boxh:"\u2500",boxHD:"\u2566",boxHd:"\u2564",boxhD:"\u2565",boxhd:"\u252C",boxHU:"\u2569",boxHu:"\u2567",boxhU:"\u2568",boxhu:"\u2534",boxminus:"\u229F",boxplus:"\u229E",boxtimes:"\u22A0",boxUL:"\u255D",boxUl:"\u255C",boxuL:"\u255B",boxul:"\u2518",boxUR:"\u255A",boxUr:"\u2559",boxuR:"\u2558",boxur:"\u2514",boxV:"\u2551",boxv:"\u2502",boxVH:"\u256C",boxVh:"\u256B",boxvH:"\u256A",boxvh:"\u253C",boxVL:"\u2563",boxVl:"\u2562",boxvL:"\u2561",boxvl:"\u2524",boxVR:"\u2560",boxVr:"\u255F",boxvR:"\u255E",boxvr:"\u251C",bprime:"\u2035",Breve:"\u02D8",breve:"\u02D8",brvbar:"\xA6",Bscr:"\u212C",bscr:"\u{1D4B7}",bsemi:"\u204F",bsim:"\u223D",bsime:"\u22CD",bsol:"\\",bsolb:"\u29C5",bsolhsub:"\u27C8",bull:"\u2022",bullet:"\u2022",bump:"\u224E",bumpE:"\u2AAE",bumpe:"\u224F",Bumpeq:"\u224E",bumpeq:"\u224F",Cacute:"\u0106",cacute:"\u0107",Cap:"\u22D2",cap:"\u2229",capand:"\u2A44",capbrcup:"\u2A49",capcap:"\u2A4B",capcup:"\u2A47",capdot:"\u2A40",CapitalDifferentialD:"\u2145",caps:"\u2229\uFE00",caret:"\u2041",caron:"\u02C7",Cayleys:"\u212D",ccaps:"\u2A4D",Ccaron:"\u010C",ccaron:"\u010D",Ccedil:"\xC7",ccedil:"\xE7",Ccirc:"\u0108",ccirc:"\u0109",Cconint:"\u2230",ccups:"\u2A4C",ccupssm:"\u2A50",Cdot:"\u010A",cdot:"\u010B",cedil:"\xB8",Cedilla:"\xB8",cemptyv:"\u29B2",cent:"\xA2",CenterDot:"\xB7",centerdot:"\xB7",Cfr:"\u212D",cfr:"\u{1D520}",CHcy:"\u0427",chcy:"\u0447",check:"\u2713",checkmark:"\u2713",Chi:"\u03A7",chi:"\u03C7",cir:"\u25CB",circ:"\u02C6",circeq:"\u2257",circlearrowleft:"\u21BA",circlearrowright:"\u21BB",circledast:"\u229B",circledcirc:"\u229A",circleddash:"\u229D",CircleDot:"\u2299",circledR:"\xAE",circledS:"\u24C8",CircleMinus:"\u2296",CirclePlus:"\u2295",CircleTimes:"\u2297",cirE:"\u29C3",cire:"\u2257",cirfnint:"\u2A10",cirmid:"\u2AEF",cirscir:"\u29C2",ClockwiseContourIntegral:"\u2232",CloseCurlyDoubleQuote:"\u201D",CloseCurlyQuote:"\u2019",clubs:"\u2663",clubsuit:"\u2663",Colon:"\u2237",colon:":",Colone:"\u2A74",colone:"\u2254",coloneq:"\u2254",comma:",",commat:"@",comp:"\u2201",compfn:"\u2218",complement:"\u2201",complexes:"\u2102",cong:"\u2245",congdot:"\u2A6D",Congruent:"\u2261",Conint:"\u222F",conint:"\u222E",ContourIntegral:"\u222E",Copf:"\u2102",copf:"\u{1D554}",coprod:"\u2210",Coproduct:"\u2210",COPY:"\xA9",copy:"\xA9",copysr:"\u2117",CounterClockwiseContourIntegral:"\u2233",crarr:"\u21B5",Cross:"\u2A2F",cross:"\u2717",Cscr:"\u{1D49E}",cscr:"\u{1D4B8}",csub:"\u2ACF",csube:"\u2AD1",csup:"\u2AD0",csupe:"\u2AD2",ctdot:"\u22EF",cudarrl:"\u2938",cudarrr:"\u2935",cuepr:"\u22DE",cuesc:"\u22DF",cularr:"\u21B6",cularrp:"\u293D",Cup:"\u22D3",cup:"\u222A",cupbrcap:"\u2A48",CupCap:"\u224D",cupcap:"\u2A46",cupcup:"\u2A4A",cupdot:"\u228D",cupor:"\u2A45",cups:"\u222A\uFE00",curarr:"\u21B7",curarrm:"\u293C",curlyeqprec:"\u22DE",curlyeqsucc:"\u22DF",curlyvee:"\u22CE",curlywedge:"\u22CF",curren:"\xA4",curvearrowleft:"\u21B6",curvearrowright:"\u21B7",cuvee:"\u22CE",cuwed:"\u22CF",cwconint:"\u2232",cwint:"\u2231",cylcty:"\u232D",Dagger:"\u2021",dagger:"\u2020",daleth:"\u2138",Darr:"\u21A1",dArr:"\u21D3",darr:"\u2193",dash:"\u2010",Dashv:"\u2AE4",dashv:"\u22A3",dbkarow:"\u290F",dblac:"\u02DD",Dcaron:"\u010E",dcaron:"\u010F",Dcy:"\u0414",dcy:"\u0434",DD:"\u2145",dd:"\u2146",ddagger:"\u2021",ddarr:"\u21CA",DDotrahd:"\u2911",ddotseq:"\u2A77",deg:"\xB0",Del:"\u2207",Delta:"\u0394",delta:"\u03B4",demptyv:"\u29B1",dfisht:"\u297F",Dfr:"\u{1D507}",dfr:"\u{1D521}",dHar:"\u2965",dharl:"\u21C3",dharr:"\u21C2",DiacriticalAcute:"\xB4",DiacriticalDot:"\u02D9",DiacriticalDoubleAcute:"\u02DD",DiacriticalGrave:"`",DiacriticalTilde:"\u02DC",diam:"\u22C4",Diamond:"\u22C4",diamond:"\u22C4",diamondsuit:"\u2666",diams:"\u2666",die:"\xA8",DifferentialD:"\u2146",digamma:"\u03DD",disin:"\u22F2",div:"\xF7",divide:"\xF7",divideontimes:"\u22C7",divonx:"\u22C7",DJcy:"\u0402",djcy:"\u0452",dlcorn:"\u231E",dlcrop:"\u230D",dollar:"$",Dopf:"\u{1D53B}",dopf:"\u{1D555}",Dot:"\xA8",dot:"\u02D9",DotDot:"\u20DC",doteq:"\u2250",doteqdot:"\u2251",DotEqual:"\u2250",dotminus:"\u2238",dotplus:"\u2214",dotsquare:"\u22A1",doublebarwedge:"\u2306",DoubleContourIntegral:"\u222F",DoubleDot:"\xA8",DoubleDownArrow:"\u21D3",DoubleLeftArrow:"\u21D0",DoubleLeftRightArrow:"\u21D4",DoubleLeftTee:"\u2AE4",DoubleLongLeftArrow:"\u27F8",DoubleLongLeftRightArrow:"\u27FA",DoubleLongRightArrow:"\u27F9",DoubleRightArrow:"\u21D2",DoubleRightTee:"\u22A8",DoubleUpArrow:"\u21D1",DoubleUpDownArrow:"\u21D5",DoubleVerticalBar:"\u2225",DownArrow:"\u2193",Downarrow:"\u21D3",downarrow:"\u2193",DownArrowBar:"\u2913",DownArrowUpArrow:"\u21F5",DownBreve:"\u0311",downdownarrows:"\u21CA",downharpoonleft:"\u21C3",downharpoonright:"\u21C2",DownLeftRightVector:"\u2950",DownLeftTeeVector:"\u295E",DownLeftVector:"\u21BD",DownLeftVectorBar:"\u2956",DownRightTeeVector:"\u295F",DownRightVector:"\u21C1",DownRightVectorBar:"\u2957",DownTee:"\u22A4",DownTeeArrow:"\u21A7",drbkarow:"\u2910",drcorn:"\u231F",drcrop:"\u230C",Dscr:"\u{1D49F}",dscr:"\u{1D4B9}",DScy:"\u0405",dscy:"\u0455",dsol:"\u29F6",Dstrok:"\u0110",dstrok:"\u0111",dtdot:"\u22F1",dtri:"\u25BF",dtrif:"\u25BE",duarr:"\u21F5",duhar:"\u296F",dwangle:"\u29A6",DZcy:"\u040F",dzcy:"\u045F",dzigrarr:"\u27FF",Eacute:"\xC9",eacute:"\xE9",easter:"\u2A6E",Ecaron:"\u011A",ecaron:"\u011B",ecir:"\u2256",Ecirc:"\xCA",ecirc:"\xEA",ecolon:"\u2255",Ecy:"\u042D",ecy:"\u044D",eDDot:"\u2A77",Edot:"\u0116",eDot:"\u2251",edot:"\u0117",ee:"\u2147",efDot:"\u2252",Efr:"\u{1D508}",efr:"\u{1D522}",eg:"\u2A9A",Egrave:"\xC8",egrave:"\xE8",egs:"\u2A96",egsdot:"\u2A98",el:"\u2A99",Element:"\u2208",elinters:"\u23E7",ell:"\u2113",els:"\u2A95",elsdot:"\u2A97",Emacr:"\u0112",emacr:"\u0113",empty:"\u2205",emptyset:"\u2205",EmptySmallSquare:"\u25FB",emptyv:"\u2205",EmptyVerySmallSquare:"\u25AB",emsp:"\u2003",emsp13:"\u2004",emsp14:"\u2005",ENG:"\u014A",eng:"\u014B",ensp:"\u2002",Eogon:"\u0118",eogon:"\u0119",Eopf:"\u{1D53C}",eopf:"\u{1D556}",epar:"\u22D5",eparsl:"\u29E3",eplus:"\u2A71",epsi:"\u03B5",Epsilon:"\u0395",epsilon:"\u03B5",epsiv:"\u03F5",eqcirc:"\u2256",eqcolon:"\u2255",eqsim:"\u2242",eqslantgtr:"\u2A96",eqslantless:"\u2A95",Equal:"\u2A75",equals:"=",EqualTilde:"\u2242",equest:"\u225F",Equilibrium:"\u21CC",equiv:"\u2261",equivDD:"\u2A78",eqvparsl:"\u29E5",erarr:"\u2971",erDot:"\u2253",Escr:"\u2130",escr:"\u212F",esdot:"\u2250",Esim:"\u2A73",esim:"\u2242",Eta:"\u0397",eta:"\u03B7",ETH:"\xD0",eth:"\xF0",Euml:"\xCB",euml:"\xEB",euro:"\u20AC",excl:"!",exist:"\u2203",Exists:"\u2203",expectation:"\u2130",ExponentialE:"\u2147",exponentiale:"\u2147",fallingdotseq:"\u2252",Fcy:"\u0424",fcy:"\u0444",female:"\u2640",ffilig:"\uFB03",fflig:"\uFB00",ffllig:"\uFB04",Ffr:"\u{1D509}",ffr:"\u{1D523}",filig:"\uFB01",FilledSmallSquare:"\u25FC",FilledVerySmallSquare:"\u25AA",fjlig:"fj",flat:"\u266D",fllig:"\uFB02",fltns:"\u25B1",fnof:"\u0192",Fopf:"\u{1D53D}",fopf:"\u{1D557}",ForAll:"\u2200",forall:"\u2200",fork:"\u22D4",forkv:"\u2AD9",Fouriertrf:"\u2131",fpartint:"\u2A0D",frac12:"\xBD",frac13:"\u2153",frac14:"\xBC",frac15:"\u2155",frac16:"\u2159",frac18:"\u215B",frac23:"\u2154",frac25:"\u2156",frac34:"\xBE",frac35:"\u2157",frac38:"\u215C",frac45:"\u2158",frac56:"\u215A",frac58:"\u215D",frac78:"\u215E",frasl:"\u2044",frown:"\u2322",Fscr:"\u2131",fscr:"\u{1D4BB}",gacute:"\u01F5",Gamma:"\u0393",gamma:"\u03B3",Gammad:"\u03DC",gammad:"\u03DD",gap:"\u2A86",Gbreve:"\u011E",gbreve:"\u011F",Gcedil:"\u0122",Gcirc:"\u011C",gcirc:"\u011D",Gcy:"\u0413",gcy:"\u0433",Gdot:"\u0120",gdot:"\u0121",gE:"\u2267",ge:"\u2265",gEl:"\u2A8C",gel:"\u22DB",geq:"\u2265",geqq:"\u2267",geqslant:"\u2A7E",ges:"\u2A7E",gescc:"\u2AA9",gesdot:"\u2A80",gesdoto:"\u2A82",gesdotol:"\u2A84",gesl:"\u22DB\uFE00",gesles:"\u2A94",Gfr:"\u{1D50A}",gfr:"\u{1D524}",Gg:"\u22D9",gg:"\u226B",ggg:"\u22D9",gimel:"\u2137",GJcy:"\u0403",gjcy:"\u0453",gl:"\u2277",gla:"\u2AA5",glE:"\u2A92",glj:"\u2AA4",gnap:"\u2A8A",gnapprox:"\u2A8A",gnE:"\u2269",gne:"\u2A88",gneq:"\u2A88",gneqq:"\u2269",gnsim:"\u22E7",Gopf:"\u{1D53E}",gopf:"\u{1D558}",grave:"`",GreaterEqual:"\u2265",GreaterEqualLess:"\u22DB",GreaterFullEqual:"\u2267",GreaterGreater:"\u2AA2",GreaterLess:"\u2277",GreaterSlantEqual:"\u2A7E",GreaterTilde:"\u2273",Gscr:"\u{1D4A2}",gscr:"\u210A",gsim:"\u2273",gsime:"\u2A8E",gsiml:"\u2A90",Gt:"\u226B",GT:">",gt:">",gtcc:"\u2AA7",gtcir:"\u2A7A",gtdot:"\u22D7",gtlPar:"\u2995",gtquest:"\u2A7C",gtrapprox:"\u2A86",gtrarr:"\u2978",gtrdot:"\u22D7",gtreqless:"\u22DB",gtreqqless:"\u2A8C",gtrless:"\u2277",gtrsim:"\u2273",gvertneqq:"\u2269\uFE00",gvnE:"\u2269\uFE00",Hacek:"\u02C7",hairsp:"\u200A",half:"\xBD",hamilt:"\u210B",HARDcy:"\u042A",hardcy:"\u044A",hArr:"\u21D4",harr:"\u2194",harrcir:"\u2948",harrw:"\u21AD",Hat:"^",hbar:"\u210F",Hcirc:"\u0124",hcirc:"\u0125",hearts:"\u2665",heartsuit:"\u2665",hellip:"\u2026",hercon:"\u22B9",Hfr:"\u210C",hfr:"\u{1D525}",HilbertSpace:"\u210B",hksearow:"\u2925",hkswarow:"\u2926",hoarr:"\u21FF",homtht:"\u223B",hookleftarrow:"\u21A9",hookrightarrow:"\u21AA",Hopf:"\u210D",hopf:"\u{1D559}",horbar:"\u2015",HorizontalLine:"\u2500",Hscr:"\u210B",hscr:"\u{1D4BD}",hslash:"\u210F",Hstrok:"\u0126",hstrok:"\u0127",HumpDownHump:"\u224E",HumpEqual:"\u224F",hybull:"\u2043",hyphen:"\u2010",Iacute:"\xCD",iacute:"\xED",ic:"\u2063",Icirc:"\xCE",icirc:"\xEE",Icy:"\u0418",icy:"\u0438",Idot:"\u0130",IEcy:"\u0415",iecy:"\u0435",iexcl:"\xA1",iff:"\u21D4",Ifr:"\u2111",ifr:"\u{1D526}",Igrave:"\xCC",igrave:"\xEC",ii:"\u2148",iiiint:"\u2A0C",iiint:"\u222D",iinfin:"\u29DC",iiota:"\u2129",IJlig:"\u0132",ijlig:"\u0133",Im:"\u2111",Imacr:"\u012A",imacr:"\u012B",image:"\u2111",ImaginaryI:"\u2148",imagline:"\u2110",imagpart:"\u2111",imath:"\u0131",imof:"\u22B7",imped:"\u01B5",Implies:"\u21D2",in:"\u2208",incare:"\u2105",infin:"\u221E",infintie:"\u29DD",inodot:"\u0131",Int:"\u222C",int:"\u222B",intcal:"\u22BA",integers:"\u2124",Integral:"\u222B",intercal:"\u22BA",Intersection:"\u22C2",intlarhk:"\u2A17",intprod:"\u2A3C",InvisibleComma:"\u2063",InvisibleTimes:"\u2062",IOcy:"\u0401",iocy:"\u0451",Iogon:"\u012E",iogon:"\u012F",Iopf:"\u{1D540}",iopf:"\u{1D55A}",Iota:"\u0399",iota:"\u03B9",iprod:"\u2A3C",iquest:"\xBF",Iscr:"\u2110",iscr:"\u{1D4BE}",isin:"\u2208",isindot:"\u22F5",isinE:"\u22F9",isins:"\u22F4",isinsv:"\u22F3",isinv:"\u2208",it:"\u2062",Itilde:"\u0128",itilde:"\u0129",Iukcy:"\u0406",iukcy:"\u0456",Iuml:"\xCF",iuml:"\xEF",Jcirc:"\u0134",jcirc:"\u0135",Jcy:"\u0419",jcy:"\u0439",Jfr:"\u{1D50D}",jfr:"\u{1D527}",jmath:"\u0237",Jopf:"\u{1D541}",jopf:"\u{1D55B}",Jscr:"\u{1D4A5}",jscr:"\u{1D4BF}",Jsercy:"\u0408",jsercy:"\u0458",Jukcy:"\u0404",jukcy:"\u0454",Kappa:"\u039A",kappa:"\u03BA",kappav:"\u03F0",Kcedil:"\u0136",kcedil:"\u0137",Kcy:"\u041A",kcy:"\u043A",Kfr:"\u{1D50E}",kfr:"\u{1D528}",kgreen:"\u0138",KHcy:"\u0425",khcy:"\u0445",KJcy:"\u040C",kjcy:"\u045C",Kopf:"\u{1D542}",kopf:"\u{1D55C}",Kscr:"\u{1D4A6}",kscr:"\u{1D4C0}",lAarr:"\u21DA",Lacute:"\u0139",lacute:"\u013A",laemptyv:"\u29B4",lagran:"\u2112",Lambda:"\u039B",lambda:"\u03BB",Lang:"\u27EA",lang:"\u27E8",langd:"\u2991",langle:"\u27E8",lap:"\u2A85",Laplacetrf:"\u2112",laquo:"\xAB",Larr:"\u219E",lArr:"\u21D0",larr:"\u2190",larrb:"\u21E4",larrbfs:"\u291F",larrfs:"\u291D",larrhk:"\u21A9",larrlp:"\u21AB",larrpl:"\u2939",larrsim:"\u2973",larrtl:"\u21A2",lat:"\u2AAB",lAtail:"\u291B",latail:"\u2919",late:"\u2AAD",lates:"\u2AAD\uFE00",lBarr:"\u290E",lbarr:"\u290C",lbbrk:"\u2772",lbrace:"{",lbrack:"[",lbrke:"\u298B",lbrksld:"\u298F",lbrkslu:"\u298D",Lcaron:"\u013D",lcaron:"\u013E",Lcedil:"\u013B",lcedil:"\u013C",lceil:"\u2308",lcub:"{",Lcy:"\u041B",lcy:"\u043B",ldca:"\u2936",ldquo:"\u201C",ldquor:"\u201E",ldrdhar:"\u2967",ldrushar:"\u294B",ldsh:"\u21B2",lE:"\u2266",le:"\u2264",LeftAngleBracket:"\u27E8",LeftArrow:"\u2190",Leftarrow:"\u21D0",leftarrow:"\u2190",LeftArrowBar:"\u21E4",LeftArrowRightArrow:"\u21C6",leftarrowtail:"\u21A2",LeftCeiling:"\u2308",LeftDoubleBracket:"\u27E6",LeftDownTeeVector:"\u2961",LeftDownVector:"\u21C3",LeftDownVectorBar:"\u2959",LeftFloor:"\u230A",leftharpoondown:"\u21BD",leftharpoonup:"\u21BC",leftleftarrows:"\u21C7",LeftRightArrow:"\u2194",Leftrightarrow:"\u21D4",leftrightarrow:"\u2194",leftrightarrows:"\u21C6",leftrightharpoons:"\u21CB",leftrightsquigarrow:"\u21AD",LeftRightVector:"\u294E",LeftTee:"\u22A3",LeftTeeArrow:"\u21A4",LeftTeeVector:"\u295A",leftthreetimes:"\u22CB",LeftTriangle:"\u22B2",LeftTriangleBar:"\u29CF",LeftTriangleEqual:"\u22B4",LeftUpDownVector:"\u2951",LeftUpTeeVector:"\u2960",LeftUpVector:"\u21BF",LeftUpVectorBar:"\u2958",LeftVector:"\u21BC",LeftVectorBar:"\u2952",lEg:"\u2A8B",leg:"\u22DA",leq:"\u2264",leqq:"\u2266",leqslant:"\u2A7D",les:"\u2A7D",lescc:"\u2AA8",lesdot:"\u2A7F",lesdoto:"\u2A81",lesdotor:"\u2A83",lesg:"\u22DA\uFE00",lesges:"\u2A93",lessapprox:"\u2A85",lessdot:"\u22D6",lesseqgtr:"\u22DA",lesseqqgtr:"\u2A8B",LessEqualGreater:"\u22DA",LessFullEqual:"\u2266",LessGreater:"\u2276",lessgtr:"\u2276",LessLess:"\u2AA1",lesssim:"\u2272",LessSlantEqual:"\u2A7D",LessTilde:"\u2272",lfisht:"\u297C",lfloor:"\u230A",Lfr:"\u{1D50F}",lfr:"\u{1D529}",lg:"\u2276",lgE:"\u2A91",lHar:"\u2962",lhard:"\u21BD",lharu:"\u21BC",lharul:"\u296A",lhblk:"\u2584",LJcy:"\u0409",ljcy:"\u0459",Ll:"\u22D8",ll:"\u226A",llarr:"\u21C7",llcorner:"\u231E",Lleftarrow:"\u21DA",llhard:"\u296B",lltri:"\u25FA",Lmidot:"\u013F",lmidot:"\u0140",lmoust:"\u23B0",lmoustache:"\u23B0",lnap:"\u2A89",lnapprox:"\u2A89",lnE:"\u2268",lne:"\u2A87",lneq:"\u2A87",lneqq:"\u2268",lnsim:"\u22E6",loang:"\u27EC",loarr:"\u21FD",lobrk:"\u27E6",LongLeftArrow:"\u27F5",Longleftarrow:"\u27F8",longleftarrow:"\u27F5",LongLeftRightArrow:"\u27F7",Longleftrightarrow:"\u27FA",longleftrightarrow:"\u27F7",longmapsto:"\u27FC",LongRightArrow:"\u27F6",Longrightarrow:"\u27F9",longrightarrow:"\u27F6",looparrowleft:"\u21AB",looparrowright:"\u21AC",lopar:"\u2985",Lopf:"\u{1D543}",lopf:"\u{1D55D}",loplus:"\u2A2D",lotimes:"\u2A34",lowast:"\u2217",lowbar:"_",LowerLeftArrow:"\u2199",LowerRightArrow:"\u2198",loz:"\u25CA",lozenge:"\u25CA",lozf:"\u29EB",lpar:"(",lparlt:"\u2993",lrarr:"\u21C6",lrcorner:"\u231F",lrhar:"\u21CB",lrhard:"\u296D",lrm:"\u200E",lrtri:"\u22BF",lsaquo:"\u2039",Lscr:"\u2112",lscr:"\u{1D4C1}",Lsh:"\u21B0",lsh:"\u21B0",lsim:"\u2272",lsime:"\u2A8D",lsimg:"\u2A8F",lsqb:"[",lsquo:"\u2018",lsquor:"\u201A",Lstrok:"\u0141",lstrok:"\u0142",Lt:"\u226A",LT:"<",lt:"<",ltcc:"\u2AA6",ltcir:"\u2A79",ltdot:"\u22D6",lthree:"\u22CB",ltimes:"\u22C9",ltlarr:"\u2976",ltquest:"\u2A7B",ltri:"\u25C3",ltrie:"\u22B4",ltrif:"\u25C2",ltrPar:"\u2996",lurdshar:"\u294A",luruhar:"\u2966",lvertneqq:"\u2268\uFE00",lvnE:"\u2268\uFE00",macr:"\xAF",male:"\u2642",malt:"\u2720",maltese:"\u2720",Map:"\u2905",map:"\u21A6",mapsto:"\u21A6",mapstodown:"\u21A7",mapstoleft:"\u21A4",mapstoup:"\u21A5",marker:"\u25AE",mcomma:"\u2A29",Mcy:"\u041C",mcy:"\u043C",mdash:"\u2014",mDDot:"\u223A",measuredangle:"\u2221",MediumSpace:"\u205F",Mellintrf:"\u2133",Mfr:"\u{1D510}",mfr:"\u{1D52A}",mho:"\u2127",micro:"\xB5",mid:"\u2223",midast:"*",midcir:"\u2AF0",middot:"\xB7",minus:"\u2212",minusb:"\u229F",minusd:"\u2238",minusdu:"\u2A2A",MinusPlus:"\u2213",mlcp:"\u2ADB",mldr:"\u2026",mnplus:"\u2213",models:"\u22A7",Mopf:"\u{1D544}",mopf:"\u{1D55E}",mp:"\u2213",Mscr:"\u2133",mscr:"\u{1D4C2}",mstpos:"\u223E",Mu:"\u039C",mu:"\u03BC",multimap:"\u22B8",mumap:"\u22B8",nabla:"\u2207",Nacute:"\u0143",nacute:"\u0144",nang:"\u2220\u20D2",nap:"\u2249",napE:"\u2A70\u0338",napid:"\u224B\u0338",napos:"\u0149",napprox:"\u2249",natur:"\u266E",natural:"\u266E",naturals:"\u2115",nbsp:"\xA0",nbump:"\u224E\u0338",nbumpe:"\u224F\u0338",ncap:"\u2A43",Ncaron:"\u0147",ncaron:"\u0148",Ncedil:"\u0145",ncedil:"\u0146",ncong:"\u2247",ncongdot:"\u2A6D\u0338",ncup:"\u2A42",Ncy:"\u041D",ncy:"\u043D",ndash:"\u2013",ne:"\u2260",nearhk:"\u2924",neArr:"\u21D7",nearr:"\u2197",nearrow:"\u2197",nedot:"\u2250\u0338",NegativeMediumSpace:"\u200B",NegativeThickSpace:"\u200B",NegativeThinSpace:"\u200B",NegativeVeryThinSpace:"\u200B",nequiv:"\u2262",nesear:"\u2928",nesim:"\u2242\u0338",NestedGreaterGreater:"\u226B",NestedLessLess:"\u226A",NewLine:`
`,nexist:"\u2204",nexists:"\u2204",Nfr:"\u{1D511}",nfr:"\u{1D52B}",ngE:"\u2267\u0338",nge:"\u2271",ngeq:"\u2271",ngeqq:"\u2267\u0338",ngeqslant:"\u2A7E\u0338",nges:"\u2A7E\u0338",nGg:"\u22D9\u0338",ngsim:"\u2275",nGt:"\u226B\u20D2",ngt:"\u226F",ngtr:"\u226F",nGtv:"\u226B\u0338",nhArr:"\u21CE",nharr:"\u21AE",nhpar:"\u2AF2",ni:"\u220B",nis:"\u22FC",nisd:"\u22FA",niv:"\u220B",NJcy:"\u040A",njcy:"\u045A",nlArr:"\u21CD",nlarr:"\u219A",nldr:"\u2025",nlE:"\u2266\u0338",nle:"\u2270",nLeftarrow:"\u21CD",nleftarrow:"\u219A",nLeftrightarrow:"\u21CE",nleftrightarrow:"\u21AE",nleq:"\u2270",nleqq:"\u2266\u0338",nleqslant:"\u2A7D\u0338",nles:"\u2A7D\u0338",nless:"\u226E",nLl:"\u22D8\u0338",nlsim:"\u2274",nLt:"\u226A\u20D2",nlt:"\u226E",nltri:"\u22EA",nltrie:"\u22EC",nLtv:"\u226A\u0338",nmid:"\u2224",NoBreak:"\u2060",NonBreakingSpace:"\xA0",Nopf:"\u2115",nopf:"\u{1D55F}",Not:"\u2AEC",not:"\xAC",NotCongruent:"\u2262",NotCupCap:"\u226D",NotDoubleVerticalBar:"\u2226",NotElement:"\u2209",NotEqual:"\u2260",NotEqualTilde:"\u2242\u0338",NotExists:"\u2204",NotGreater:"\u226F",NotGreaterEqual:"\u2271",NotGreaterFullEqual:"\u2267\u0338",NotGreaterGreater:"\u226B\u0338",NotGreaterLess:"\u2279",NotGreaterSlantEqual:"\u2A7E\u0338",NotGreaterTilde:"\u2275",NotHumpDownHump:"\u224E\u0338",NotHumpEqual:"\u224F\u0338",notin:"\u2209",notindot:"\u22F5\u0338",notinE:"\u22F9\u0338",notinva:"\u2209",notinvb:"\u22F7",notinvc:"\u22F6",NotLeftTriangle:"\u22EA",NotLeftTriangleBar:"\u29CF\u0338",NotLeftTriangleEqual:"\u22EC",NotLess:"\u226E",NotLessEqual:"\u2270",NotLessGreater:"\u2278",NotLessLess:"\u226A\u0338",NotLessSlantEqual:"\u2A7D\u0338",NotLessTilde:"\u2274",NotNestedGreaterGreater:"\u2AA2\u0338",NotNestedLessLess:"\u2AA1\u0338",notni:"\u220C",notniva:"\u220C",notnivb:"\u22FE",notnivc:"\u22FD",NotPrecedes:"\u2280",NotPrecedesEqual:"\u2AAF\u0338",NotPrecedesSlantEqual:"\u22E0",NotReverseElement:"\u220C",NotRightTriangle:"\u22EB",NotRightTriangleBar:"\u29D0\u0338",NotRightTriangleEqual:"\u22ED",NotSquareSubset:"\u228F\u0338",NotSquareSubsetEqual:"\u22E2",NotSquareSuperset:"\u2290\u0338",NotSquareSupersetEqual:"\u22E3",NotSubset:"\u2282\u20D2",NotSubsetEqual:"\u2288",NotSucceeds:"\u2281",NotSucceedsEqual:"\u2AB0\u0338",NotSucceedsSlantEqual:"\u22E1",NotSucceedsTilde:"\u227F\u0338",NotSuperset:"\u2283\u20D2",NotSupersetEqual:"\u2289",NotTilde:"\u2241",NotTildeEqual:"\u2244",NotTildeFullEqual:"\u2247",NotTildeTilde:"\u2249",NotVerticalBar:"\u2224",npar:"\u2226",nparallel:"\u2226",nparsl:"\u2AFD\u20E5",npart:"\u2202\u0338",npolint:"\u2A14",npr:"\u2280",nprcue:"\u22E0",npre:"\u2AAF\u0338",nprec:"\u2280",npreceq:"\u2AAF\u0338",nrArr:"\u21CF",nrarr:"\u219B",nrarrc:"\u2933\u0338",nrarrw:"\u219D\u0338",nRightarrow:"\u21CF",nrightarrow:"\u219B",nrtri:"\u22EB",nrtrie:"\u22ED",nsc:"\u2281",nsccue:"\u22E1",nsce:"\u2AB0\u0338",Nscr:"\u{1D4A9}",nscr:"\u{1D4C3}",nshortmid:"\u2224",nshortparallel:"\u2226",nsim:"\u2241",nsime:"\u2244",nsimeq:"\u2244",nsmid:"\u2224",nspar:"\u2226",nsqsube:"\u22E2",nsqsupe:"\u22E3",nsub:"\u2284",nsubE:"\u2AC5\u0338",nsube:"\u2288",nsubset:"\u2282\u20D2",nsubseteq:"\u2288",nsubseteqq:"\u2AC5\u0338",nsucc:"\u2281",nsucceq:"\u2AB0\u0338",nsup:"\u2285",nsupE:"\u2AC6\u0338",nsupe:"\u2289",nsupset:"\u2283\u20D2",nsupseteq:"\u2289",nsupseteqq:"\u2AC6\u0338",ntgl:"\u2279",Ntilde:"\xD1",ntilde:"\xF1",ntlg:"\u2278",ntriangleleft:"\u22EA",ntrianglelefteq:"\u22EC",ntriangleright:"\u22EB",ntrianglerighteq:"\u22ED",Nu:"\u039D",nu:"\u03BD",num:"#",numero:"\u2116",numsp:"\u2007",nvap:"\u224D\u20D2",nVDash:"\u22AF",nVdash:"\u22AE",nvDash:"\u22AD",nvdash:"\u22AC",nvge:"\u2265\u20D2",nvgt:">\u20D2",nvHarr:"\u2904",nvinfin:"\u29DE",nvlArr:"\u2902",nvle:"\u2264\u20D2",nvlt:"<\u20D2",nvltrie:"\u22B4\u20D2",nvrArr:"\u2903",nvrtrie:"\u22B5\u20D2",nvsim:"\u223C\u20D2",nwarhk:"\u2923",nwArr:"\u21D6",nwarr:"\u2196",nwarrow:"\u2196",nwnear:"\u2927",Oacute:"\xD3",oacute:"\xF3",oast:"\u229B",ocir:"\u229A",Ocirc:"\xD4",ocirc:"\xF4",Ocy:"\u041E",ocy:"\u043E",odash:"\u229D",Odblac:"\u0150",odblac:"\u0151",odiv:"\u2A38",odot:"\u2299",odsold:"\u29BC",OElig:"\u0152",oelig:"\u0153",ofcir:"\u29BF",Ofr:"\u{1D512}",ofr:"\u{1D52C}",ogon:"\u02DB",Ograve:"\xD2",ograve:"\xF2",ogt:"\u29C1",ohbar:"\u29B5",ohm:"\u03A9",oint:"\u222E",olarr:"\u21BA",olcir:"\u29BE",olcross:"\u29BB",oline:"\u203E",olt:"\u29C0",Omacr:"\u014C",omacr:"\u014D",Omega:"\u03A9",omega:"\u03C9",Omicron:"\u039F",omicron:"\u03BF",omid:"\u29B6",ominus:"\u2296",Oopf:"\u{1D546}",oopf:"\u{1D560}",opar:"\u29B7",OpenCurlyDoubleQuote:"\u201C",OpenCurlyQuote:"\u2018",operp:"\u29B9",oplus:"\u2295",Or:"\u2A54",or:"\u2228",orarr:"\u21BB",ord:"\u2A5D",order:"\u2134",orderof:"\u2134",ordf:"\xAA",ordm:"\xBA",origof:"\u22B6",oror:"\u2A56",orslope:"\u2A57",orv:"\u2A5B",oS:"\u24C8",Oscr:"\u{1D4AA}",oscr:"\u2134",Oslash:"\xD8",oslash:"\xF8",osol:"\u2298",Otilde:"\xD5",otilde:"\xF5",Otimes:"\u2A37",otimes:"\u2297",otimesas:"\u2A36",Ouml:"\xD6",ouml:"\xF6",ovbar:"\u233D",OverBar:"\u203E",OverBrace:"\u23DE",OverBracket:"\u23B4",OverParenthesis:"\u23DC",par:"\u2225",para:"\xB6",parallel:"\u2225",parsim:"\u2AF3",parsl:"\u2AFD",part:"\u2202",PartialD:"\u2202",Pcy:"\u041F",pcy:"\u043F",percnt:"%",period:".",permil:"\u2030",perp:"\u22A5",pertenk:"\u2031",Pfr:"\u{1D513}",pfr:"\u{1D52D}",Phi:"\u03A6",phi:"\u03C6",phiv:"\u03D5",phmmat:"\u2133",phone:"\u260E",Pi:"\u03A0",pi:"\u03C0",pitchfork:"\u22D4",piv:"\u03D6",planck:"\u210F",planckh:"\u210E",plankv:"\u210F",plus:"+",plusacir:"\u2A23",plusb:"\u229E",pluscir:"\u2A22",plusdo:"\u2214",plusdu:"\u2A25",pluse:"\u2A72",PlusMinus:"\xB1",plusmn:"\xB1",plussim:"\u2A26",plustwo:"\u2A27",pm:"\xB1",Poincareplane:"\u210C",pointint:"\u2A15",Popf:"\u2119",popf:"\u{1D561}",pound:"\xA3",Pr:"\u2ABB",pr:"\u227A",prap:"\u2AB7",prcue:"\u227C",prE:"\u2AB3",pre:"\u2AAF",prec:"\u227A",precapprox:"\u2AB7",preccurlyeq:"\u227C",Precedes:"\u227A",PrecedesEqual:"\u2AAF",PrecedesSlantEqual:"\u227C",PrecedesTilde:"\u227E",preceq:"\u2AAF",precnapprox:"\u2AB9",precneqq:"\u2AB5",precnsim:"\u22E8",precsim:"\u227E",Prime:"\u2033",prime:"\u2032",primes:"\u2119",prnap:"\u2AB9",prnE:"\u2AB5",prnsim:"\u22E8",prod:"\u220F",Product:"\u220F",profalar:"\u232E",profline:"\u2312",profsurf:"\u2313",prop:"\u221D",Proportion:"\u2237",Proportional:"\u221D",propto:"\u221D",prsim:"\u227E",prurel:"\u22B0",Pscr:"\u{1D4AB}",pscr:"\u{1D4C5}",Psi:"\u03A8",psi:"\u03C8",puncsp:"\u2008",Qfr:"\u{1D514}",qfr:"\u{1D52E}",qint:"\u2A0C",Qopf:"\u211A",qopf:"\u{1D562}",qprime:"\u2057",Qscr:"\u{1D4AC}",qscr:"\u{1D4C6}",quaternions:"\u210D",quatint:"\u2A16",quest:"?",questeq:"\u225F",QUOT:'"',quot:'"',rAarr:"\u21DB",race:"\u223D\u0331",Racute:"\u0154",racute:"\u0155",radic:"\u221A",raemptyv:"\u29B3",Rang:"\u27EB",rang:"\u27E9",rangd:"\u2992",range:"\u29A5",rangle:"\u27E9",raquo:"\xBB",Rarr:"\u21A0",rArr:"\u21D2",rarr:"\u2192",rarrap:"\u2975",rarrb:"\u21E5",rarrbfs:"\u2920",rarrc:"\u2933",rarrfs:"\u291E",rarrhk:"\u21AA",rarrlp:"\u21AC",rarrpl:"\u2945",rarrsim:"\u2974",Rarrtl:"\u2916",rarrtl:"\u21A3",rarrw:"\u219D",rAtail:"\u291C",ratail:"\u291A",ratio:"\u2236",rationals:"\u211A",RBarr:"\u2910",rBarr:"\u290F",rbarr:"\u290D",rbbrk:"\u2773",rbrace:"}",rbrack:"]",rbrke:"\u298C",rbrksld:"\u298E",rbrkslu:"\u2990",Rcaron:"\u0158",rcaron:"\u0159",Rcedil:"\u0156",rcedil:"\u0157",rceil:"\u2309",rcub:"}",Rcy:"\u0420",rcy:"\u0440",rdca:"\u2937",rdldhar:"\u2969",rdquo:"\u201D",rdquor:"\u201D",rdsh:"\u21B3",Re:"\u211C",real:"\u211C",realine:"\u211B",realpart:"\u211C",reals:"\u211D",rect:"\u25AD",REG:"\xAE",reg:"\xAE",ReverseElement:"\u220B",ReverseEquilibrium:"\u21CB",ReverseUpEquilibrium:"\u296F",rfisht:"\u297D",rfloor:"\u230B",Rfr:"\u211C",rfr:"\u{1D52F}",rHar:"\u2964",rhard:"\u21C1",rharu:"\u21C0",rharul:"\u296C",Rho:"\u03A1",rho:"\u03C1",rhov:"\u03F1",RightAngleBracket:"\u27E9",RightArrow:"\u2192",Rightarrow:"\u21D2",rightarrow:"\u2192",RightArrowBar:"\u21E5",RightArrowLeftArrow:"\u21C4",rightarrowtail:"\u21A3",RightCeiling:"\u2309",RightDoubleBracket:"\u27E7",RightDownTeeVector:"\u295D",RightDownVector:"\u21C2",RightDownVectorBar:"\u2955",RightFloor:"\u230B",rightharpoondown:"\u21C1",rightharpoonup:"\u21C0",rightleftarrows:"\u21C4",rightleftharpoons:"\u21CC",rightrightarrows:"\u21C9",rightsquigarrow:"\u219D",RightTee:"\u22A2",RightTeeArrow:"\u21A6",RightTeeVector:"\u295B",rightthreetimes:"\u22CC",RightTriangle:"\u22B3",RightTriangleBar:"\u29D0",RightTriangleEqual:"\u22B5",RightUpDownVector:"\u294F",RightUpTeeVector:"\u295C",RightUpVector:"\u21BE",RightUpVectorBar:"\u2954",RightVector:"\u21C0",RightVectorBar:"\u2953",ring:"\u02DA",risingdotseq:"\u2253",rlarr:"\u21C4",rlhar:"\u21CC",rlm:"\u200F",rmoust:"\u23B1",rmoustache:"\u23B1",rnmid:"\u2AEE",roang:"\u27ED",roarr:"\u21FE",robrk:"\u27E7",ropar:"\u2986",Ropf:"\u211D",ropf:"\u{1D563}",roplus:"\u2A2E",rotimes:"\u2A35",RoundImplies:"\u2970",rpar:")",rpargt:"\u2994",rppolint:"\u2A12",rrarr:"\u21C9",Rrightarrow:"\u21DB",rsaquo:"\u203A",Rscr:"\u211B",rscr:"\u{1D4C7}",Rsh:"\u21B1",rsh:"\u21B1",rsqb:"]",rsquo:"\u2019",rsquor:"\u2019",rthree:"\u22CC",rtimes:"\u22CA",rtri:"\u25B9",rtrie:"\u22B5",rtrif:"\u25B8",rtriltri:"\u29CE",RuleDelayed:"\u29F4",ruluhar:"\u2968",rx:"\u211E",Sacute:"\u015A",sacute:"\u015B",sbquo:"\u201A",Sc:"\u2ABC",sc:"\u227B",scap:"\u2AB8",Scaron:"\u0160",scaron:"\u0161",sccue:"\u227D",scE:"\u2AB4",sce:"\u2AB0",Scedil:"\u015E",scedil:"\u015F",Scirc:"\u015C",scirc:"\u015D",scnap:"\u2ABA",scnE:"\u2AB6",scnsim:"\u22E9",scpolint:"\u2A13",scsim:"\u227F",Scy:"\u0421",scy:"\u0441",sdot:"\u22C5",sdotb:"\u22A1",sdote:"\u2A66",searhk:"\u2925",seArr:"\u21D8",searr:"\u2198",searrow:"\u2198",sect:"\xA7",semi:";",seswar:"\u2929",setminus:"\u2216",setmn:"\u2216",sext:"\u2736",Sfr:"\u{1D516}",sfr:"\u{1D530}",sfrown:"\u2322",sharp:"\u266F",SHCHcy:"\u0429",shchcy:"\u0449",SHcy:"\u0428",shcy:"\u0448",ShortDownArrow:"\u2193",ShortLeftArrow:"\u2190",shortmid:"\u2223",shortparallel:"\u2225",ShortRightArrow:"\u2192",ShortUpArrow:"\u2191",shy:"\xAD",Sigma:"\u03A3",sigma:"\u03C3",sigmaf:"\u03C2",sigmav:"\u03C2",sim:"\u223C",simdot:"\u2A6A",sime:"\u2243",simeq:"\u2243",simg:"\u2A9E",simgE:"\u2AA0",siml:"\u2A9D",simlE:"\u2A9F",simne:"\u2246",simplus:"\u2A24",simrarr:"\u2972",slarr:"\u2190",SmallCircle:"\u2218",smallsetminus:"\u2216",smashp:"\u2A33",smeparsl:"\u29E4",smid:"\u2223",smile:"\u2323",smt:"\u2AAA",smte:"\u2AAC",smtes:"\u2AAC\uFE00",SOFTcy:"\u042C",softcy:"\u044C",sol:"/",solb:"\u29C4",solbar:"\u233F",Sopf:"\u{1D54A}",sopf:"\u{1D564}",spades:"\u2660",spadesuit:"\u2660",spar:"\u2225",sqcap:"\u2293",sqcaps:"\u2293\uFE00",sqcup:"\u2294",sqcups:"\u2294\uFE00",Sqrt:"\u221A",sqsub:"\u228F",sqsube:"\u2291",sqsubset:"\u228F",sqsubseteq:"\u2291",sqsup:"\u2290",sqsupe:"\u2292",sqsupset:"\u2290",sqsupseteq:"\u2292",squ:"\u25A1",Square:"\u25A1",square:"\u25A1",SquareIntersection:"\u2293",SquareSubset:"\u228F",SquareSubsetEqual:"\u2291",SquareSuperset:"\u2290",SquareSupersetEqual:"\u2292",SquareUnion:"\u2294",squarf:"\u25AA",squf:"\u25AA",srarr:"\u2192",Sscr:"\u{1D4AE}",sscr:"\u{1D4C8}",ssetmn:"\u2216",ssmile:"\u2323",sstarf:"\u22C6",Star:"\u22C6",star:"\u2606",starf:"\u2605",straightepsilon:"\u03F5",straightphi:"\u03D5",strns:"\xAF",Sub:"\u22D0",sub:"\u2282",subdot:"\u2ABD",subE:"\u2AC5",sube:"\u2286",subedot:"\u2AC3",submult:"\u2AC1",subnE:"\u2ACB",subne:"\u228A",subplus:"\u2ABF",subrarr:"\u2979",Subset:"\u22D0",subset:"\u2282",subseteq:"\u2286",subseteqq:"\u2AC5",SubsetEqual:"\u2286",subsetneq:"\u228A",subsetneqq:"\u2ACB",subsim:"\u2AC7",subsub:"\u2AD5",subsup:"\u2AD3",succ:"\u227B",succapprox:"\u2AB8",succcurlyeq:"\u227D",Succeeds:"\u227B",SucceedsEqual:"\u2AB0",SucceedsSlantEqual:"\u227D",SucceedsTilde:"\u227F",succeq:"\u2AB0",succnapprox:"\u2ABA",succneqq:"\u2AB6",succnsim:"\u22E9",succsim:"\u227F",SuchThat:"\u220B",Sum:"\u2211",sum:"\u2211",sung:"\u266A",Sup:"\u22D1",sup:"\u2283",sup1:"\xB9",sup2:"\xB2",sup3:"\xB3",supdot:"\u2ABE",supdsub:"\u2AD8",supE:"\u2AC6",supe:"\u2287",supedot:"\u2AC4",Superset:"\u2283",SupersetEqual:"\u2287",suphsol:"\u27C9",suphsub:"\u2AD7",suplarr:"\u297B",supmult:"\u2AC2",supnE:"\u2ACC",supne:"\u228B",supplus:"\u2AC0",Supset:"\u22D1",supset:"\u2283",supseteq:"\u2287",supseteqq:"\u2AC6",supsetneq:"\u228B",supsetneqq:"\u2ACC",supsim:"\u2AC8",supsub:"\u2AD4",supsup:"\u2AD6",swarhk:"\u2926",swArr:"\u21D9",swarr:"\u2199",swarrow:"\u2199",swnwar:"\u292A",szlig:"\xDF",Tab:"	",target:"\u2316",Tau:"\u03A4",tau:"\u03C4",tbrk:"\u23B4",Tcaron:"\u0164",tcaron:"\u0165",Tcedil:"\u0162",tcedil:"\u0163",Tcy:"\u0422",tcy:"\u0442",tdot:"\u20DB",telrec:"\u2315",Tfr:"\u{1D517}",tfr:"\u{1D531}",there4:"\u2234",Therefore:"\u2234",therefore:"\u2234",Theta:"\u0398",theta:"\u03B8",thetasym:"\u03D1",thetav:"\u03D1",thickapprox:"\u2248",thicksim:"\u223C",ThickSpace:"\u205F\u200A",thinsp:"\u2009",ThinSpace:"\u2009",thkap:"\u2248",thksim:"\u223C",THORN:"\xDE",thorn:"\xFE",Tilde:"\u223C",tilde:"\u02DC",TildeEqual:"\u2243",TildeFullEqual:"\u2245",TildeTilde:"\u2248",times:"\xD7",timesb:"\u22A0",timesbar:"\u2A31",timesd:"\u2A30",tint:"\u222D",toea:"\u2928",top:"\u22A4",topbot:"\u2336",topcir:"\u2AF1",Topf:"\u{1D54B}",topf:"\u{1D565}",topfork:"\u2ADA",tosa:"\u2929",tprime:"\u2034",TRADE:"\u2122",trade:"\u2122",triangle:"\u25B5",triangledown:"\u25BF",triangleleft:"\u25C3",trianglelefteq:"\u22B4",triangleq:"\u225C",triangleright:"\u25B9",trianglerighteq:"\u22B5",tridot:"\u25EC",trie:"\u225C",triminus:"\u2A3A",TripleDot:"\u20DB",triplus:"\u2A39",trisb:"\u29CD",tritime:"\u2A3B",trpezium:"\u23E2",Tscr:"\u{1D4AF}",tscr:"\u{1D4C9}",TScy:"\u0426",tscy:"\u0446",TSHcy:"\u040B",tshcy:"\u045B",Tstrok:"\u0166",tstrok:"\u0167",twixt:"\u226C",twoheadleftarrow:"\u219E",twoheadrightarrow:"\u21A0",Uacute:"\xDA",uacute:"\xFA",Uarr:"\u219F",uArr:"\u21D1",uarr:"\u2191",Uarrocir:"\u2949",Ubrcy:"\u040E",ubrcy:"\u045E",Ubreve:"\u016C",ubreve:"\u016D",Ucirc:"\xDB",ucirc:"\xFB",Ucy:"\u0423",ucy:"\u0443",udarr:"\u21C5",Udblac:"\u0170",udblac:"\u0171",udhar:"\u296E",ufisht:"\u297E",Ufr:"\u{1D518}",ufr:"\u{1D532}",Ugrave:"\xD9",ugrave:"\xF9",uHar:"\u2963",uharl:"\u21BF",uharr:"\u21BE",uhblk:"\u2580",ulcorn:"\u231C",ulcorner:"\u231C",ulcrop:"\u230F",ultri:"\u25F8",Umacr:"\u016A",umacr:"\u016B",uml:"\xA8",UnderBar:"_",UnderBrace:"\u23DF",UnderBracket:"\u23B5",UnderParenthesis:"\u23DD",Union:"\u22C3",UnionPlus:"\u228E",Uogon:"\u0172",uogon:"\u0173",Uopf:"\u{1D54C}",uopf:"\u{1D566}",UpArrow:"\u2191",Uparrow:"\u21D1",uparrow:"\u2191",UpArrowBar:"\u2912",UpArrowDownArrow:"\u21C5",UpDownArrow:"\u2195",Updownarrow:"\u21D5",updownarrow:"\u2195",UpEquilibrium:"\u296E",upharpoonleft:"\u21BF",upharpoonright:"\u21BE",uplus:"\u228E",UpperLeftArrow:"\u2196",UpperRightArrow:"\u2197",Upsi:"\u03D2",upsi:"\u03C5",upsih:"\u03D2",Upsilon:"\u03A5",upsilon:"\u03C5",UpTee:"\u22A5",UpTeeArrow:"\u21A5",upuparrows:"\u21C8",urcorn:"\u231D",urcorner:"\u231D",urcrop:"\u230E",Uring:"\u016E",uring:"\u016F",urtri:"\u25F9",Uscr:"\u{1D4B0}",uscr:"\u{1D4CA}",utdot:"\u22F0",Utilde:"\u0168",utilde:"\u0169",utri:"\u25B5",utrif:"\u25B4",uuarr:"\u21C8",Uuml:"\xDC",uuml:"\xFC",uwangle:"\u29A7",vangrt:"\u299C",varepsilon:"\u03F5",varkappa:"\u03F0",varnothing:"\u2205",varphi:"\u03D5",varpi:"\u03D6",varpropto:"\u221D",vArr:"\u21D5",varr:"\u2195",varrho:"\u03F1",varsigma:"\u03C2",varsubsetneq:"\u228A\uFE00",varsubsetneqq:"\u2ACB\uFE00",varsupsetneq:"\u228B\uFE00",varsupsetneqq:"\u2ACC\uFE00",vartheta:"\u03D1",vartriangleleft:"\u22B2",vartriangleright:"\u22B3",Vbar:"\u2AEB",vBar:"\u2AE8",vBarv:"\u2AE9",Vcy:"\u0412",vcy:"\u0432",VDash:"\u22AB",Vdash:"\u22A9",vDash:"\u22A8",vdash:"\u22A2",Vdashl:"\u2AE6",Vee:"\u22C1",vee:"\u2228",veebar:"\u22BB",veeeq:"\u225A",vellip:"\u22EE",Verbar:"\u2016",verbar:"|",Vert:"\u2016",vert:"|",VerticalBar:"\u2223",VerticalLine:"|",VerticalSeparator:"\u2758",VerticalTilde:"\u2240",VeryThinSpace:"\u200A",Vfr:"\u{1D519}",vfr:"\u{1D533}",vltri:"\u22B2",vnsub:"\u2282\u20D2",vnsup:"\u2283\u20D2",Vopf:"\u{1D54D}",vopf:"\u{1D567}",vprop:"\u221D",vrtri:"\u22B3",Vscr:"\u{1D4B1}",vscr:"\u{1D4CB}",vsubnE:"\u2ACB\uFE00",vsubne:"\u228A\uFE00",vsupnE:"\u2ACC\uFE00",vsupne:"\u228B\uFE00",Vvdash:"\u22AA",vzigzag:"\u299A",Wcirc:"\u0174",wcirc:"\u0175",wedbar:"\u2A5F",Wedge:"\u22C0",wedge:"\u2227",wedgeq:"\u2259",weierp:"\u2118",Wfr:"\u{1D51A}",wfr:"\u{1D534}",Wopf:"\u{1D54E}",wopf:"\u{1D568}",wp:"\u2118",wr:"\u2240",wreath:"\u2240",Wscr:"\u{1D4B2}",wscr:"\u{1D4CC}",xcap:"\u22C2",xcirc:"\u25EF",xcup:"\u22C3",xdtri:"\u25BD",Xfr:"\u{1D51B}",xfr:"\u{1D535}",xhArr:"\u27FA",xharr:"\u27F7",Xi:"\u039E",xi:"\u03BE",xlArr:"\u27F8",xlarr:"\u27F5",xmap:"\u27FC",xnis:"\u22FB",xodot:"\u2A00",Xopf:"\u{1D54F}",xopf:"\u{1D569}",xoplus:"\u2A01",xotime:"\u2A02",xrArr:"\u27F9",xrarr:"\u27F6",Xscr:"\u{1D4B3}",xscr:"\u{1D4CD}",xsqcup:"\u2A06",xuplus:"\u2A04",xutri:"\u25B3",xvee:"\u22C1",xwedge:"\u22C0",Yacute:"\xDD",yacute:"\xFD",YAcy:"\u042F",yacy:"\u044F",Ycirc:"\u0176",ycirc:"\u0177",Ycy:"\u042B",ycy:"\u044B",yen:"\xA5",Yfr:"\u{1D51C}",yfr:"\u{1D536}",YIcy:"\u0407",yicy:"\u0457",Yopf:"\u{1D550}",yopf:"\u{1D56A}",Yscr:"\u{1D4B4}",yscr:"\u{1D4CE}",YUcy:"\u042E",yucy:"\u044E",Yuml:"\u0178",yuml:"\xFF",Zacute:"\u0179",zacute:"\u017A",Zcaron:"\u017D",zcaron:"\u017E",Zcy:"\u0417",zcy:"\u0437",Zdot:"\u017B",zdot:"\u017C",zeetrf:"\u2128",ZeroWidthSpace:"\u200B",Zeta:"\u0396",zeta:"\u03B6",Zfr:"\u2128",zfr:"\u{1D537}",ZHcy:"\u0416",zhcy:"\u0436",zigrarr:"\u21DD",Zopf:"\u2124",zopf:"\u{1D56B}",Zscr:"\u{1D4B5}",zscr:"\u{1D4CF}",zwj:"\u200D",zwnj:"\u200C"}),ce.entityMap=ce.HTML_ENTITIES},7527:(Xe,ce,ne)=>{var I,X=ne(8167),x=ne(5927),M=ne(7460),C=ne(6627),E=x.DOMImplementation,R=X.NAMESPACE,L=C.ParseError,T=C.XMLReader;function O(z){return z.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028]/g,`
`)}function W(z){this.options=z||{locator:{}}}W.prototype.parseFromString=function(z,te){var V=this.options,de=new T,P=V.domBuilder||new q,p=V.errorHandler,K=V.locator,me=V.xmlns||{},pe=/\/x?html?$/.test(te),le=pe?M.HTML_ENTITIES:M.XML_ENTITIES;K&&P.setDocumentLocator(K),de.errorHandler=D(p,P,K),de.domBuilder=V.domBuilder||P,pe&&(me[""]=R.HTML),me.xml=me.xml||R.XML;var ue=V.normalizeLineEndings||O;return z&&typeof z=="string"?de.parse(ue(z),me,le):de.errorHandler.error("invalid doc source"),P.doc};function D(z,te,V){if(!z){if(te instanceof q)return te;z=te}var de={},P=z instanceof Function;V=V||{};function p(K){var me=z[K];!me&&P&&(me=z.length==2?function(pe){z(K,pe)}:z),de[K]=me&&function(pe){me("[xmldom "+K+"]	"+pe+Y(V))}||function(){}}return p("warning"),p("error"),p("fatalError"),de}function q(){this.cdata=!1}function F(z,te){te.lineNumber=z.lineNumber,te.columnNumber=z.columnNumber}q.prototype={startDocument:function(){this.doc=new E().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(z,te,V,de){var P=this.doc,p=P.createElementNS(z,V||te),K=de.length;J(this,p),this.currentElement=p,this.locator&&F(this.locator,p);for(var me=0;me<K;me++){var z=de.getURI(me),pe=de.getValue(me),V=de.getQName(me),le=P.createAttributeNS(z,V);this.locator&&F(de.getLocator(me),le),le.value=le.nodeValue=pe,p.setAttributeNode(le)}},endElement:function(z,te,V){var de=this.currentElement,P=de.tagName;this.currentElement=de.parentNode},startPrefixMapping:function(z,te){},endPrefixMapping:function(z){},processingInstruction:function(z,te){var V=this.doc.createProcessingInstruction(z,te);this.locator&&F(this.locator,V),J(this,V)},ignorableWhitespace:function(z,te,V){},characters:function(z,te,V){if(z=G.apply(this,arguments),z){if(this.cdata)var de=this.doc.createCDATASection(z);else var de=this.doc.createTextNode(z);this.currentElement?this.currentElement.appendChild(de):/^\s*$/.test(z)&&this.doc.appendChild(de),this.locator&&F(this.locator,de)}},skippedEntity:function(z){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(z){(this.locator=z)&&(z.lineNumber=0)},comment:function(z,te,V){z=G.apply(this,arguments);var de=this.doc.createComment(z);this.locator&&F(this.locator,de),J(this,de)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(z,te,V){var de=this.doc.implementation;if(de&&de.createDocumentType){var P=de.createDocumentType(z,te,V);this.locator&&F(this.locator,P),J(this,P),this.doc.doctype=P}},warning:function(z){console.warn("[xmldom warning]	"+z,Y(this.locator))},error:function(z){console.error("[xmldom error]	"+z,Y(this.locator))},fatalError:function(z){throw new L(z,this.locator)}};function Y(z){if(z)return`
@`+(z.systemId||"")+"#[line:"+z.lineNumber+",col:"+z.columnNumber+"]"}function G(z,te,V){return typeof z=="string"?z.substr(te,V):z.length>=te+V||te?new java.lang.String(z,te,V)+"":z}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(z){q.prototype[z]=function(){return null}});function J(z,te){z.currentElement?z.currentElement.appendChild(te):z.doc.appendChild(te)}I=q,I=O,ce.DOMParser=W},7781:Xe=>{"use strict";Xe.exports=function(ce){var ne=ce._SomePromiseArray;function I(X){var x=new ne(X),M=x.promise();return x.setHowMany(1),x.setUnwrap(),x.init(),M}ce.any=function(X){return I(X)},ce.prototype.any=function(){return I(this)}}},7894:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X,x,M){var C=ne(7443),E=function(L){return L.then(function(T){return R(T,L)})};function R(L,T){var O=x(L);if(O instanceof I)return E(O);if(L=C.asArray(L),L===null)return M("expecting an array or an iterable object but got "+C.classString(L));var W=new I(X);T!==void 0&&W._propagateFrom(T,3);for(var D=W._fulfill,q=W._reject,F=0,Y=L.length;F<Y;++F){var G=L[F];G===void 0&&!(F in L)||I.cast(G)._then(D,q,void 0,W,null)}return W}I.race=function(L){return R(L,void 0)},I.prototype.race=function(){return R(this,void 0)}}},7954:Xe=>{"use strict";Xe.exports=function(ce,ne){var I=ce.reduce,X=ce.all;function x(){return X(this)}function M(C,E){return I(C,E,ne,ne)}ce.prototype.each=function(C){return I(this,C,ne,0)._then(x,void 0,void 0,this,void 0)},ce.prototype.mapSeries=function(C){return I(this,C,ne,ne)},ce.each=function(C,E){return I(C,E,ne,0)._then(x,void 0,void 0,C,void 0)},ce.mapSeries=M}},8101:(Xe,ce,ne)=>{var I=ne(8291);ce.paragraph=X,ce.run=x,ce._elements=C,ce._elementsOfType=M,ce.getDescendantsOfType=E,ce.getDescendants=R;function X(T){return M("paragraph",T)}function x(T){return M("run",T)}function M(T,O){return C(function(W){return W.type===T?O(W):W})}function C(T){return function O(W){if(W.children){var D=I.map(W.children,O);W=I.extend(W,{children:D})}return T(W)}}function E(T,O){return R(T).filter(function(W){return W.type===O})}function R(T){var O=[];return L(T,function(W){O.push(W)}),O}function L(T,O){T.children&&T.children.forEach(function(W){L(W,O),O(W)})}},8167:(Xe,ce)=>{"use strict";function ne(C,E,R){if(R===void 0&&(R=Array.prototype),C&&typeof R.find=="function")return R.find.call(C,E);for(var L=0;L<C.length;L++)if(Object.prototype.hasOwnProperty.call(C,L)){var T=C[L];if(E.call(void 0,T,L,C))return T}}function I(C,E){return E===void 0&&(E=Object),E&&typeof E.freeze=="function"?E.freeze(C):C}function X(C,E){if(C===null||typeof C!="object")throw new TypeError("target is not an object");for(var R in E)Object.prototype.hasOwnProperty.call(E,R)&&(C[R]=E[R]);return C}var x=I({HTML:"text/html",isHTML:function(C){return C===x.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),M=I({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(C){return C===M.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});ce.assign=X,ce.find=ne,ce.freeze=I,ce.MIME_TYPE=x,ce.NAMESPACE=M},8204:Xe=>{"use strict";Xe.exports=function(ce,ne,I,X){var x=!1,M=function(L,T){this._reject(T)},C=function(L,T){T.promiseRejectionQueued=!0,T.bindingPromise._then(M,M,null,this,L)},E=function(L,T){this._bitField&50397184||this._resolveCallback(T.target)},R=function(L,T){T.promiseRejectionQueued||this._reject(L)};ce.prototype.bind=function(L){x||(x=!0,ce.prototype._propagateFrom=X.propagateFromFunction(),ce.prototype._boundValue=X.boundValueFunction());var T=I(L),O=new ce(ne);O._propagateFrom(this,1);var W=this._target();if(O._setBoundTo(T),T instanceof ce){var D={promiseRejectionQueued:!1,promise:O,target:W,bindingPromise:T};W._then(ne,C,void 0,O,D),T._then(E,R,void 0,O,D),O._setOnCancel(T)}else O._resolveCallback(W);return O},ce.prototype._setBoundTo=function(L){L!==void 0?(this._bitField=this._bitField|2097152,this._boundTo=L):this._bitField=this._bitField&-2097153},ce.prototype._isBound=function(){return(this._bitField&2097152)===2097152},ce.bind=function(L,T){return ce.resolve(T).bind(L)}}},8223:(Xe,ce,ne)=>{var I=ne(9796),X=ne(5584).Result;function x(M){function C(R){return X.combine(R.getElementsByTagName("w:comment").map(E))}function E(R){var L=R.attributes["w:id"];function T(O){return(R.attributes[O]||"").trim()||null}return M.readXmlElements(R.children).map(function(O){return I.comment({commentId:L,body:O,authorName:T("w:author"),authorInitials:T("w:initials")})})}return C}ce.createCommentsReader=x},8291:(Xe,ce,ne)=>{"use strict";ne.r(ce),ne.d(ce,{VERSION:()=>X,after:()=>df,all:()=>Jl,allKeys:()=>lt,any:()=>bd,assign:()=>kn,before:()=>uf,bind:()=>Ds,bindAll:()=>cf,chain:()=>of,chunk:()=>wh,clone:()=>ft,collect:()=>qi,compact:()=>yh,compose:()=>by,constant:()=>gt,contains:()=>Ls,countBy:()=>xy,create:()=>Ge,debounce:()=>ch,default:()=>Ty,defaults:()=>gl,defer:()=>Kl,delay:()=>pr,detect:()=>Zl,difference:()=>_h,drop:()=>Bo,each:()=>zn,escape:()=>oh,every:()=>Jl,extend:()=>dr,extendOwn:()=>kn,filter:()=>Fo,find:()=>Zl,findIndex:()=>gd,findKey:()=>Ei,findLastIndex:()=>ff,findWhere:()=>yy,first:()=>Ql,flatten:()=>vd,foldl:()=>Sn,foldr:()=>md,forEach:()=>zn,functions:()=>os,get:()=>wi,groupBy:()=>gh,has:()=>vi,head:()=>Ql,identity:()=>xi,include:()=>Ls,includes:()=>Ls,indexBy:()=>na,indexOf:()=>hf,initial:()=>bh,inject:()=>Sn,intersection:()=>Wi,invert:()=>rs,invoke:()=>Qi,isArguments:()=>En,isArray:()=>zt,isArrayBuffer:()=>Ye,isBoolean:()=>pe,isDataView:()=>jt,isDate:()=>oe,isElement:()=>le,isEmpty:()=>Tt,isEqual:()=>Xa,isError:()=>ve,isFinite:()=>Q,isFunction:()=>st,isMap:()=>Wa,isMatch:()=>pn,isNaN:()=>ot,isNull:()=>K,isNumber:()=>N,isObject:()=>p,isRegExp:()=>ge,isSet:()=>hl,isString:()=>A,isSymbol:()=>ke,isTypedArray:()=>ut,isUndefined:()=>me,isWeakMap:()=>pl,isWeakSet:()=>va,iteratee:()=>Zi,keys:()=>ct,last:()=>ky,lastIndexOf:()=>fh,map:()=>qi,mapObject:()=>Fa,matcher:()=>Za,matches:()=>Za,max:()=>xe,memoize:()=>fr,methods:()=>os,min:()=>oo,mixin:()=>vh,negate:()=>hd,noop:()=>Oa,now:()=>ro,object:()=>Ed,omit:()=>gf,once:()=>Xl,pairs:()=>Ut,partial:()=>ml,partition:()=>Ey,pick:()=>wd,pluck:()=>Po,property:()=>Ts,propertyOf:()=>so,random:()=>fd,range:()=>Sy,reduce:()=>Sn,reduceRight:()=>md,reject:()=>ph,rest:()=>Bo,restArguments:()=>P,result:()=>Mo,sample:()=>No,select:()=>Fo,shuffle:()=>pi,size:()=>_d,some:()=>bd,sortBy:()=>vy,sortedIndex:()=>pf,tail:()=>Bo,take:()=>Ql,tap:()=>Ot,template:()=>pd,templateSettings:()=>gy,throttle:()=>Ji,times:()=>ud,toArray:()=>hh,toPath:()=>at,transpose:()=>mf,unescape:()=>hy,union:()=>xd,uniq:()=>Pa,unique:()=>Pa,uniqueId:()=>pv,unzip:()=>mf,values:()=>gn,where:()=>wy,without:()=>hr,wrap:()=>my,zip:()=>bf});var I={};ne.r(I),ne.d(I,{VERSION:()=>X,after:()=>df,all:()=>Jl,allKeys:()=>lt,any:()=>bd,assign:()=>kn,before:()=>uf,bind:()=>Ds,bindAll:()=>cf,chain:()=>of,chunk:()=>wh,clone:()=>ft,collect:()=>qi,compact:()=>yh,compose:()=>by,constant:()=>gt,contains:()=>Ls,countBy:()=>xy,create:()=>Ge,debounce:()=>ch,default:()=>xh,defaults:()=>gl,defer:()=>Kl,delay:()=>pr,detect:()=>Zl,difference:()=>_h,drop:()=>Bo,each:()=>zn,escape:()=>oh,every:()=>Jl,extend:()=>dr,extendOwn:()=>kn,filter:()=>Fo,find:()=>Zl,findIndex:()=>gd,findKey:()=>Ei,findLastIndex:()=>ff,findWhere:()=>yy,first:()=>Ql,flatten:()=>vd,foldl:()=>Sn,foldr:()=>md,forEach:()=>zn,functions:()=>os,get:()=>wi,groupBy:()=>gh,has:()=>vi,head:()=>Ql,identity:()=>xi,include:()=>Ls,includes:()=>Ls,indexBy:()=>na,indexOf:()=>hf,initial:()=>bh,inject:()=>Sn,intersection:()=>Wi,invert:()=>rs,invoke:()=>Qi,isArguments:()=>En,isArray:()=>zt,isArrayBuffer:()=>Ye,isBoolean:()=>pe,isDataView:()=>jt,isDate:()=>oe,isElement:()=>le,isEmpty:()=>Tt,isEqual:()=>Xa,isError:()=>ve,isFinite:()=>Q,isFunction:()=>st,isMap:()=>Wa,isMatch:()=>pn,isNaN:()=>ot,isNull:()=>K,isNumber:()=>N,isObject:()=>p,isRegExp:()=>ge,isSet:()=>hl,isString:()=>A,isSymbol:()=>ke,isTypedArray:()=>ut,isUndefined:()=>me,isWeakMap:()=>pl,isWeakSet:()=>va,iteratee:()=>Zi,keys:()=>ct,last:()=>ky,lastIndexOf:()=>fh,map:()=>qi,mapObject:()=>Fa,matcher:()=>Za,matches:()=>Za,max:()=>xe,memoize:()=>fr,methods:()=>os,min:()=>oo,mixin:()=>vh,negate:()=>hd,noop:()=>Oa,now:()=>ro,object:()=>Ed,omit:()=>gf,once:()=>Xl,pairs:()=>Ut,partial:()=>ml,partition:()=>Ey,pick:()=>wd,pluck:()=>Po,property:()=>Ts,propertyOf:()=>so,random:()=>fd,range:()=>Sy,reduce:()=>Sn,reduceRight:()=>md,reject:()=>ph,rest:()=>Bo,restArguments:()=>P,result:()=>Mo,sample:()=>No,select:()=>Fo,shuffle:()=>pi,size:()=>_d,some:()=>bd,sortBy:()=>vy,sortedIndex:()=>pf,tail:()=>Bo,take:()=>Ql,tap:()=>Ot,template:()=>pd,templateSettings:()=>gy,throttle:()=>Ji,times:()=>ud,toArray:()=>hh,toPath:()=>at,transpose:()=>mf,unescape:()=>hy,union:()=>xd,uniq:()=>Pa,unique:()=>Pa,uniqueId:()=>pv,unzip:()=>mf,values:()=>gn,where:()=>wy,without:()=>hr,wrap:()=>my,zip:()=>bf});var X="1.13.7",x=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||Function("return this")()||{},M=Array.prototype,C=Object.prototype,E=typeof Symbol!="undefined"?Symbol.prototype:null,R=M.push,L=M.slice,T=C.toString,O=C.hasOwnProperty,W=typeof ArrayBuffer!="undefined",D=typeof DataView!="undefined",q=Array.isArray,F=Object.keys,Y=Object.create,G=W&&ArrayBuffer.isView,J=isNaN,z=isFinite,te=!{toString:null}.propertyIsEnumerable("toString"),V=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],de=Math.pow(2,53)-1;function P(se,be){return be=be==null?se.length-1:+be,function(){for(var Ue=Math.max(arguments.length-be,0),Ke=Array(Ue),dt=0;dt<Ue;dt++)Ke[dt]=arguments[dt+be];switch(be){case 0:return se.call(this,Ke);case 1:return se.call(this,arguments[0],Ke);case 2:return se.call(this,arguments[0],arguments[1],Ke)}var rt=Array(be+1);for(dt=0;dt<be;dt++)rt[dt]=arguments[dt];return rt[be]=Ke,se.apply(this,rt)}}function p(se){var be=typeof se;return be==="function"||be==="object"&&!!se}function K(se){return se===null}function me(se){return se===void 0}function pe(se){return se===!0||se===!1||T.call(se)==="[object Boolean]"}function le(se){return!!(se&&se.nodeType===1)}function ue(se){var be="[object "+se+"]";return function(Ue){return T.call(Ue)===be}}const A=ue("String"),N=ue("Number"),oe=ue("Date"),ge=ue("RegExp"),ve=ue("Error"),ke=ue("Symbol"),Ye=ue("ArrayBuffer");var Le=ue("Function"),Fe=x.document&&x.document.childNodes;typeof Int8Array!="object"&&typeof Fe!="function"&&(Le=function(se){return typeof se=="function"||!1});const st=Le,Ee=ue("Object");var pt=D&&(!/\[native code\]/.test(String(DataView))||Ee(new DataView(new ArrayBuffer(8)))),$t=typeof Map!="undefined"&&Ee(new Map),It=ue("DataView");function _t(se){return se!=null&&st(se.getInt8)&&Ye(se.buffer)}const jt=pt?_t:It,zt=q||ue("Array");function mn(se,be){return se!=null&&O.call(se,be)}var Qn=ue("Arguments");(function(){Qn(arguments)||(Qn=function(se){return mn(se,"callee")})})();const En=Qn;function Q(se){return!ke(se)&&z(se)&&!isNaN(parseFloat(se))}function ot(se){return N(se)&&J(se)}function gt(se){return function(){return se}}function ye(se){return function(be){var Ue=se(be);return typeof Ue=="number"&&Ue>=0&&Ue<=de}}function _e(se){return function(be){return be==null?void 0:be[se]}}const $e=_e("byteLength"),mt=ye($e);var yt=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function nt(se){return G?G(se)&&!jt(se):mt(se)&&yt.test(T.call(se))}const ut=W?nt:gt(!1),kt=_e("length");function Ne(se){for(var be={},Ue=se.length,Ke=0;Ke<Ue;++Ke)be[se[Ke]]=!0;return{contains:function(dt){return be[dt]===!0},push:function(dt){return be[dt]=!0,se.push(dt)}}}function je(se,be){be=Ne(be);var Ue=V.length,Ke=se.constructor,dt=st(Ke)&&Ke.prototype||C,rt="constructor";for(mn(se,rt)&&!be.contains(rt)&&be.push(rt);Ue--;)rt=V[Ue],rt in se&&se[rt]!==dt[rt]&&!be.contains(rt)&&be.push(rt)}function ct(se){if(!p(se))return[];if(F)return F(se);var be=[];for(var Ue in se)mn(se,Ue)&&be.push(Ue);return te&&je(se,be),be}function Tt(se){if(se==null)return!0;var be=kt(se);return typeof be=="number"&&(zt(se)||A(se)||En(se))?be===0:kt(ct(se))===0}function pn(se,be){var Ue=ct(be),Ke=Ue.length;if(se==null)return!Ke;for(var dt=Object(se),rt=0;rt<Ke;rt++){var Nt=Ue[rt];if(be[Nt]!==dt[Nt]||!(Nt in dt))return!1}return!0}function bn(se){if(se instanceof bn)return se;if(!(this instanceof bn))return new bn(se);this._wrapped=se}bn.VERSION=X,bn.prototype.value=function(){return this._wrapped},bn.prototype.valueOf=bn.prototype.toJSON=bn.prototype.value,bn.prototype.toString=function(){return String(this._wrapped)};function Bn(se){return new Uint8Array(se.buffer||se,se.byteOffset||0,$e(se))}var yn="[object DataView]";function Jt(se,be,Ue,Ke){if(se===be)return se!==0||1/se===1/be;if(se==null||be==null)return!1;if(se!==se)return be!==be;var dt=typeof se;return dt!=="function"&&dt!=="object"&&typeof be!="object"?!1:Kn(se,be,Ue,Ke)}function Kn(se,be,Ue,Ke){se instanceof bn&&(se=se._wrapped),be instanceof bn&&(be=be._wrapped);var dt=T.call(se);if(dt!==T.call(be))return!1;if(pt&&dt=="[object Object]"&&jt(se)){if(!jt(be))return!1;dt=yn}switch(dt){case"[object RegExp]":case"[object String]":return""+se==""+be;case"[object Number]":return+se!=+se?+be!=+be:+se==0?1/+se===1/be:+se==+be;case"[object Date]":case"[object Boolean]":return+se==+be;case"[object Symbol]":return E.valueOf.call(se)===E.valueOf.call(be);case"[object ArrayBuffer]":case yn:return Kn(Bn(se),Bn(be),Ue,Ke)}var rt=dt==="[object Array]";if(!rt&&ut(se)){var Nt=$e(se);if(Nt!==$e(be))return!1;if(se.buffer===be.buffer&&se.byteOffset===be.byteOffset)return!0;rt=!0}if(!rt){if(typeof se!="object"||typeof be!="object")return!1;var tn=se.constructor,Un=be.constructor;if(tn!==Un&&!(st(tn)&&tn instanceof tn&&st(Un)&&Un instanceof Un)&&"constructor"in se&&"constructor"in be)return!1}Ue=Ue||[],Ke=Ke||[];for(var Fn=Ue.length;Fn--;)if(Ue[Fn]===se)return Ke[Fn]===be;if(Ue.push(se),Ke.push(be),rt){if(Fn=se.length,Fn!==be.length)return!1;for(;Fn--;)if(!Jt(se[Fn],be[Fn],Ue,Ke))return!1}else{var ki=ct(se),Ra;if(Fn=ki.length,ct(be).length!==Fn)return!1;for(;Fn--;)if(Ra=ki[Fn],!(mn(be,Ra)&&Jt(se[Ra],be[Ra],Ue,Ke)))return!1}return Ue.pop(),Ke.pop(),!0}function Xa(se,be){return Jt(se,be)}function lt(se){if(!p(se))return[];var be=[];for(var Ue in se)be.push(Ue);return te&&je(se,be),be}function St(se){var be=kt(se);return function(Ue){if(Ue==null)return!1;var Ke=lt(Ue);if(kt(Ke))return!1;for(var dt=0;dt<be;dt++)if(!st(Ue[se[dt]]))return!1;return se!==Gt||!st(Ue[Xt])}}var Xt="forEach",Qt="has",un=["clear","delete"],Mt=["get",Qt,"set"],ua=un.concat(Xt,Mt),Gt=un.concat(Mt),cr=["add"].concat(un,Xt,Qt);const Wa=$t?St(ua):ue("Map"),pl=$t?St(Gt):ue("WeakMap"),hl=$t?St(cr):ue("Set"),va=ue("WeakSet");function gn(se){for(var be=ct(se),Ue=be.length,Ke=Array(Ue),dt=0;dt<Ue;dt++)Ke[dt]=se[be[dt]];return Ke}function Ut(se){for(var be=ct(se),Ue=be.length,Ke=Array(Ue),dt=0;dt<Ue;dt++)Ke[dt]=[be[dt],se[be[dt]]];return Ke}function rs(se){for(var be={},Ue=ct(se),Ke=0,dt=Ue.length;Ke<dt;Ke++)be[se[Ue[Ke]]]=Ue[Ke];return be}function os(se){var be=[];for(var Ue in se)st(se[Ue])&&be.push(Ue);return be.sort()}function io(se,be){return function(Ue){var Ke=arguments.length;if(be&&(Ue=Object(Ue)),Ke<2||Ue==null)return Ue;for(var dt=1;dt<Ke;dt++)for(var rt=arguments[dt],Nt=se(rt),tn=Nt.length,Un=0;Un<tn;Un++){var Fn=Nt[Un];(!be||Ue[Fn]===void 0)&&(Ue[Fn]=rt[Fn])}return Ue}}const dr=io(lt),kn=io(ct),gl=io(lt,!0);function fe(){return function(){}}function he(se){if(!p(se))return{};if(Y)return Y(se);var be=fe();be.prototype=se;var Ue=new be;return be.prototype=null,Ue}function Ge(se,be){var Ue=he(se);return be&&kn(Ue,be),Ue}function ft(se){return p(se)?zt(se)?se.slice():dr({},se):se}function Ot(se,be){return be(se),se}function at(se){return zt(se)?se:[se]}bn.toPath=at;function fa(se){return bn.toPath(se)}function Yt(se,be){for(var Ue=be.length,Ke=0;Ke<Ue;Ke++){if(se==null)return;se=se[be[Ke]]}return Ue?se:void 0}function wi(se,be,Ue){var Ke=Yt(se,fa(be));return me(Ke)?Ue:Ke}function vi(se,be){be=fa(be);for(var Ue=be.length,Ke=0;Ke<Ue;Ke++){var dt=be[Ke];if(!mn(se,dt))return!1;se=se[dt]}return!!Ue}function xi(se){return se}function Za(se){return se=kn({},se),function(be){return pn(be,se)}}function Ts(se){return se=fa(se),function(be){return Yt(be,se)}}function ls(se,be,Ue){if(be===void 0)return se;switch(Ue==null?3:Ue){case 1:return function(Ke){return se.call(be,Ke)};case 3:return function(Ke,dt,rt){return se.call(be,Ke,dt,rt)};case 4:return function(Ke,dt,rt,Nt){return se.call(be,Ke,dt,rt,Nt)}}return function(){return se.apply(be,arguments)}}function Va(se,be,Ue){return se==null?xi:st(se)?ls(se,be,Ue):p(se)&&!zt(se)?Za(se):Ts(se)}function Zi(se,be){return Va(se,be,1/0)}bn.iteratee=Zi;function Ca(se,be,Ue){return bn.iteratee!==Zi?bn.iteratee(se,be):Va(se,be,Ue)}function Fa(se,be,Ue){be=Ca(be,Ue);for(var Ke=ct(se),dt=Ke.length,rt={},Nt=0;Nt<dt;Nt++){var tn=Ke[Nt];rt[tn]=be(se[tn],tn,se)}return rt}function Oa(){}function so(se){return se==null?Oa:function(be){return wi(se,be)}}function ud(se,be,Ue){var Ke=Array(Math.max(0,se));be=ls(be,Ue,1);for(var dt=0;dt<se;dt++)Ke[dt]=be(dt);return Ke}function fd(se,be){return be==null&&(be=se,se=0),se+Math.floor(Math.random()*(be-se+1))}const ro=Date.now||function(){return new Date().getTime()};function Qe(se){var be=function(rt){return se[rt]},Ue="(?:"+ct(se).join("|")+")",Ke=RegExp(Ue),dt=RegExp(Ue,"g");return function(rt){return rt=rt==null?"":""+rt,Ke.test(rt)?rt.replace(dt,be):rt}}const sf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},oh=Qe(sf),ta=rs(sf),hy=Qe(ta),gy=bn.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var lh=/(.)^/,rf={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},uv=/\\|'|\r|\n|\u2028|\u2029/g;function fv(se){return"\\"+rf[se]}var ha=/^\s*(\w|\$)+\s*$/;function pd(se,be,Ue){!be&&Ue&&(be=Ue),be=gl({},be,bn.templateSettings);var Ke=RegExp([(be.escape||lh).source,(be.interpolate||lh).source,(be.evaluate||lh).source].join("|")+"|$","g"),dt=0,rt="__p+='";se.replace(Ke,function(Fn,ki,Ra,Eh,es){return rt+=se.slice(dt,es).replace(uv,fv),dt=es+Fn.length,ki?rt+=`'+
((__t=(`+ki+`))==null?'':_.escape(__t))+
'`:Ra?rt+=`'+
((__t=(`+Ra+`))==null?'':__t)+
'`:Eh&&(rt+=`';
`+Eh+`
__p+='`),Fn}),rt+=`';
`;var Nt=be.variable;if(Nt){if(!ha.test(Nt))throw new Error("variable is not a bare identifier: "+Nt)}else rt=`with(obj||{}){
`+rt+`}
`,Nt="obj";rt=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+rt+`return __p;
`;var tn;try{tn=new Function(Nt,"_",rt)}catch(Fn){throw Fn.source=rt,Fn}var Un=function(Fn){return tn.call(this,Fn,bn)};return Un.source="function("+Nt+`){
`+rt+"}",Un}function Mo(se,be,Ue){be=fa(be);var Ke=be.length;if(!Ke)return st(Ue)?Ue.call(se):Ue;for(var dt=0;dt<Ke;dt++){var rt=se==null?void 0:se[be[dt]];rt===void 0&&(rt=Ue,dt=Ke),se=st(rt)?rt.call(se):rt}return se}var _n=0;function pv(se){var be=++_n+"";return se?se+be:be}function of(se){var be=bn(se);return be._chain=!0,be}function lf(se,be,Ue,Ke,dt){if(!(Ke instanceof be))return se.apply(Ue,dt);var rt=he(se.prototype),Nt=se.apply(rt,dt);return p(Nt)?Nt:rt}var ur=P(function(se,be){var Ue=ur.placeholder,Ke=function(){for(var dt=0,rt=be.length,Nt=Array(rt),tn=0;tn<rt;tn++)Nt[tn]=be[tn]===Ue?arguments[dt++]:be[tn];for(;dt<arguments.length;)Nt.push(arguments[dt++]);return lf(se,Ke,this,this,Nt)};return Ke});ur.placeholder=bn;const ml=ur,Ds=P(function(se,be,Ue){if(!st(se))throw new TypeError("Bind must be called on a function");var Ke=P(function(dt){return lf(se,Ke,be,this,Ue.concat(dt))});return Ke}),Cs=ye(kt);function bl(se,be,Ue,Ke){if(Ke=Ke||[],!be&&be!==0)be=1/0;else if(be<=0)return Ke.concat(se);for(var dt=Ke.length,rt=0,Nt=kt(se);rt<Nt;rt++){var tn=se[rt];if(Cs(tn)&&(zt(tn)||En(tn)))if(be>1)bl(tn,be-1,Ue,Ke),dt=Ke.length;else for(var Un=0,Fn=tn.length;Un<Fn;)Ke[dt++]=tn[Un++];else Ue||(Ke[dt++]=tn)}return Ke}const cf=P(function(se,be){be=bl(be,!1,!1);var Ue=be.length;if(Ue<1)throw new Error("bindAll must be passed function names");for(;Ue--;){var Ke=be[Ue];se[Ke]=Ds(se[Ke],se)}return se});function fr(se,be){var Ue=function(Ke){var dt=Ue.cache,rt=""+(be?be.apply(this,arguments):Ke);return mn(dt,rt)||(dt[rt]=se.apply(this,arguments)),dt[rt]};return Ue.cache={},Ue}const pr=P(function(se,be,Ue){return setTimeout(function(){return se.apply(null,Ue)},be)}),Kl=ml(pr,bn,1);function Ji(se,be,Ue){var Ke,dt,rt,Nt,tn=0;Ue||(Ue={});var Un=function(){tn=Ue.leading===!1?0:ro(),Ke=null,Nt=se.apply(dt,rt),Ke||(dt=rt=null)},Fn=function(){var ki=ro();!tn&&Ue.leading===!1&&(tn=ki);var Ra=be-(ki-tn);return dt=this,rt=arguments,Ra<=0||Ra>be?(Ke&&(clearTimeout(Ke),Ke=null),tn=ki,Nt=se.apply(dt,rt),Ke||(dt=rt=null)):!Ke&&Ue.trailing!==!1&&(Ke=setTimeout(Un,Ra)),Nt};return Fn.cancel=function(){clearTimeout(Ke),tn=0,Ke=dt=rt=null},Fn}function ch(se,be,Ue){var Ke,dt,rt,Nt,tn,Un=function(){var ki=ro()-dt;be>ki?Ke=setTimeout(Un,be-ki):(Ke=null,Ue||(Nt=se.apply(tn,rt)),Ke||(rt=tn=null))},Fn=P(function(ki){return tn=this,rt=ki,dt=ro(),Ke||(Ke=setTimeout(Un,be),Ue&&(Nt=se.apply(tn,rt))),Nt});return Fn.cancel=function(){clearTimeout(Ke),Ke=rt=tn=null},Fn}function my(se,be){return ml(be,se)}function hd(se){return function(){return!se.apply(this,arguments)}}function by(){var se=arguments,be=se.length-1;return function(){for(var Ue=be,Ke=se[be].apply(this,arguments);Ue--;)Ke=se[Ue].call(this,Ke);return Ke}}function df(se,be){return function(){if(--se<1)return be.apply(this,arguments)}}function uf(se,be){var Ue;return function(){return--se>0&&(Ue=be.apply(this,arguments)),se<=1&&(be=null),Ue}}const Xl=ml(uf,2);function Ei(se,be,Ue){be=Ca(be,Ue);for(var Ke=ct(se),dt,rt=0,Nt=Ke.length;rt<Nt;rt++)if(dt=Ke[rt],be(se[dt],dt,se))return dt}function dh(se){return function(be,Ue,Ke){Ue=Ca(Ue,Ke);for(var dt=kt(be),rt=se>0?0:dt-1;rt>=0&&rt<dt;rt+=se)if(Ue(be[rt],rt,be))return rt;return-1}}const gd=dh(1),ff=dh(-1);function pf(se,be,Ue,Ke){Ue=Ca(Ue,Ke,1);for(var dt=Ue(be),rt=0,Nt=kt(se);rt<Nt;){var tn=Math.floor((rt+Nt)/2);Ue(se[tn])<dt?rt=tn+1:Nt=tn}return rt}function uh(se,be,Ue){return function(Ke,dt,rt){var Nt=0,tn=kt(Ke);if(typeof rt=="number")se>0?Nt=rt>=0?rt:Math.max(rt+tn,Nt):tn=rt>=0?Math.min(rt+1,tn):rt+tn+1;else if(Ue&&rt&&tn)return rt=Ue(Ke,dt),Ke[rt]===dt?rt:-1;if(dt!==dt)return rt=be(L.call(Ke,Nt,tn),ot),rt>=0?rt+Nt:-1;for(rt=se>0?Nt:tn-1;rt>=0&&rt<tn;rt+=se)if(Ke[rt]===dt)return rt;return-1}}const hf=uh(1,gd,pf),fh=uh(-1,ff);function Zl(se,be,Ue){var Ke=Cs(se)?gd:Ei,dt=Ke(se,be,Ue);if(dt!==void 0&&dt!==-1)return se[dt]}function yy(se,be){return Zl(se,Za(be))}function zn(se,be,Ue){be=ls(be,Ue);var Ke,dt;if(Cs(se))for(Ke=0,dt=se.length;Ke<dt;Ke++)be(se[Ke],Ke,se);else{var rt=ct(se);for(Ke=0,dt=rt.length;Ke<dt;Ke++)be(se[rt[Ke]],rt[Ke],se)}return se}function qi(se,be,Ue){be=Ca(be,Ue);for(var Ke=!Cs(se)&&ct(se),dt=(Ke||se).length,rt=Array(dt),Nt=0;Nt<dt;Nt++){var tn=Ke?Ke[Nt]:Nt;rt[Nt]=be(se[tn],tn,se)}return rt}function _y(se){var be=function(Ue,Ke,dt,rt){var Nt=!Cs(Ue)&&ct(Ue),tn=(Nt||Ue).length,Un=se>0?0:tn-1;for(rt||(dt=Ue[Nt?Nt[Un]:Un],Un+=se);Un>=0&&Un<tn;Un+=se){var Fn=Nt?Nt[Un]:Un;dt=Ke(dt,Ue[Fn],Fn,Ue)}return dt};return function(Ue,Ke,dt,rt){var Nt=arguments.length>=3;return be(Ue,ls(Ke,rt,4),dt,Nt)}}const Sn=_y(1),md=_y(-1);function Fo(se,be,Ue){var Ke=[];return be=Ca(be,Ue),zn(se,function(dt,rt,Nt){be(dt,rt,Nt)&&Ke.push(dt)}),Ke}function ph(se,be,Ue){return Fo(se,hd(Ca(be)),Ue)}function Jl(se,be,Ue){be=Ca(be,Ue);for(var Ke=!Cs(se)&&ct(se),dt=(Ke||se).length,rt=0;rt<dt;rt++){var Nt=Ke?Ke[rt]:rt;if(!be(se[Nt],Nt,se))return!1}return!0}function bd(se,be,Ue){be=Ca(be,Ue);for(var Ke=!Cs(se)&&ct(se),dt=(Ke||se).length,rt=0;rt<dt;rt++){var Nt=Ke?Ke[rt]:rt;if(be(se[Nt],Nt,se))return!0}return!1}function Ls(se,be,Ue,Ke){return Cs(se)||(se=gn(se)),(typeof Ue!="number"||Ke)&&(Ue=0),hf(se,be,Ue)>=0}const Qi=P(function(se,be,Ue){var Ke,dt;return st(be)?dt=be:(be=fa(be),Ke=be.slice(0,-1),be=be[be.length-1]),qi(se,function(rt){var Nt=dt;if(!Nt){if(Ke&&Ke.length&&(rt=Yt(rt,Ke)),rt==null)return;Nt=rt[be]}return Nt==null?Nt:Nt.apply(rt,Ue)})});function Po(se,be){return qi(se,Ts(be))}function wy(se,be){return Fo(se,Za(be))}function xe(se,be,Ue){var Ke=-1/0,dt=-1/0,rt,Nt;if(be==null||typeof be=="number"&&typeof se[0]!="object"&&se!=null){se=Cs(se)?se:gn(se);for(var tn=0,Un=se.length;tn<Un;tn++)rt=se[tn],rt!=null&&rt>Ke&&(Ke=rt)}else be=Ca(be,Ue),zn(se,function(Fn,ki,Ra){Nt=be(Fn,ki,Ra),(Nt>dt||Nt===-1/0&&Ke===-1/0)&&(Ke=Fn,dt=Nt)});return Ke}function oo(se,be,Ue){var Ke=1/0,dt=1/0,rt,Nt;if(be==null||typeof be=="number"&&typeof se[0]!="object"&&se!=null){se=Cs(se)?se:gn(se);for(var tn=0,Un=se.length;tn<Un;tn++)rt=se[tn],rt!=null&&rt<Ke&&(Ke=rt)}else be=Ca(be,Ue),zn(se,function(Fn,ki,Ra){Nt=be(Fn,ki,Ra),(Nt<dt||Nt===1/0&&Ke===1/0)&&(Ke=Fn,dt=Nt)});return Ke}var hv=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function hh(se){return se?zt(se)?L.call(se):A(se)?se.match(hv):Cs(se)?qi(se,xi):gn(se):[]}function No(se,be,Ue){if(be==null||Ue)return Cs(se)||(se=gn(se)),se[fd(se.length-1)];var Ke=hh(se),dt=kt(Ke);be=Math.max(Math.min(be,dt),0);for(var rt=dt-1,Nt=0;Nt<be;Nt++){var tn=fd(Nt,rt),Un=Ke[Nt];Ke[Nt]=Ke[tn],Ke[tn]=Un}return Ke.slice(0,be)}function pi(se){return No(se,1/0)}function vy(se,be,Ue){var Ke=0;return be=Ca(be,Ue),Po(qi(se,function(dt,rt,Nt){return{value:dt,index:Ke++,criteria:be(dt,rt,Nt)}}).sort(function(dt,rt){var Nt=dt.criteria,tn=rt.criteria;if(Nt!==tn){if(Nt>tn||Nt===void 0)return 1;if(Nt<tn||tn===void 0)return-1}return dt.index-rt.index}),"value")}function yd(se,be){return function(Ue,Ke,dt){var rt=be?[[],[]]:{};return Ke=Ca(Ke,dt),zn(Ue,function(Nt,tn){var Un=Ke(Nt,tn,Ue);se(rt,Nt,Un)}),rt}}const gh=yd(function(se,be,Ue){mn(se,Ue)?se[Ue].push(be):se[Ue]=[be]}),na=yd(function(se,be,Ue){se[Ue]=be}),xy=yd(function(se,be,Ue){mn(se,Ue)?se[Ue]++:se[Ue]=1}),Ey=yd(function(se,be,Ue){se[Ue?0:1].push(be)},!0);function _d(se){return se==null?0:Cs(se)?se.length:ct(se).length}function mh(se,be,Ue){return be in Ue}const wd=P(function(se,be){var Ue={},Ke=be[0];if(se==null)return Ue;st(Ke)?(be.length>1&&(Ke=ls(Ke,be[1])),be=lt(se)):(Ke=mh,be=bl(be,!1,!1),se=Object(se));for(var dt=0,rt=be.length;dt<rt;dt++){var Nt=be[dt],tn=se[Nt];Ke(tn,Nt,se)&&(Ue[Nt]=tn)}return Ue}),gf=P(function(se,be){var Ue=be[0],Ke;return st(Ue)?(Ue=hd(Ue),be.length>1&&(Ke=be[1])):(be=qi(bl(be,!1,!1),String),Ue=function(dt,rt){return!Ls(be,rt)}),wd(se,Ue,Ke)});function bh(se,be,Ue){return L.call(se,0,Math.max(0,se.length-(be==null||Ue?1:be)))}function Ql(se,be,Ue){return se==null||se.length<1?be==null||Ue?void 0:[]:be==null||Ue?se[0]:bh(se,se.length-be)}function Bo(se,be,Ue){return L.call(se,be==null||Ue?1:be)}function ky(se,be,Ue){return se==null||se.length<1?be==null||Ue?void 0:[]:be==null||Ue?se[se.length-1]:Bo(se,Math.max(0,se.length-be))}function yh(se){return Fo(se,Boolean)}function vd(se,be){return bl(se,be,!1)}const _h=P(function(se,be){return be=bl(be,!0,!0),Fo(se,function(Ue){return!Ls(be,Ue)})}),hr=P(function(se,be){return _h(se,be)});function Pa(se,be,Ue,Ke){pe(be)||(Ke=Ue,Ue=be,be=!1),Ue!=null&&(Ue=Ca(Ue,Ke));for(var dt=[],rt=[],Nt=0,tn=kt(se);Nt<tn;Nt++){var Un=se[Nt],Fn=Ue?Ue(Un,Nt,se):Un;be&&!Ue?((!Nt||rt!==Fn)&&dt.push(Un),rt=Fn):Ue?Ls(rt,Fn)||(rt.push(Fn),dt.push(Un)):Ls(dt,Un)||dt.push(Un)}return dt}const xd=P(function(se){return Pa(bl(se,!0,!0))});function Wi(se){for(var be=[],Ue=arguments.length,Ke=0,dt=kt(se);Ke<dt;Ke++){var rt=se[Ke];if(!Ls(be,rt)){var Nt;for(Nt=1;Nt<Ue&&Ls(arguments[Nt],rt);Nt++);Nt===Ue&&be.push(rt)}}return be}function mf(se){for(var be=se&&xe(se,kt).length||0,Ue=Array(be),Ke=0;Ke<be;Ke++)Ue[Ke]=Po(se,Ke);return Ue}const bf=P(mf);function Ed(se,be){for(var Ue={},Ke=0,dt=kt(se);Ke<dt;Ke++)be?Ue[se[Ke]]=be[Ke]:Ue[se[Ke][0]]=se[Ke][1];return Ue}function Sy(se,be,Ue){be==null&&(be=se||0,se=0),Ue||(Ue=be<se?-1:1);for(var Ke=Math.max(Math.ceil((be-se)/Ue),0),dt=Array(Ke),rt=0;rt<Ke;rt++,se+=Ue)dt[rt]=se;return dt}function wh(se,be){if(be==null||be<1)return[];for(var Ue=[],Ke=0,dt=se.length;Ke<dt;)Ue.push(L.call(se,Ke,Ke+=be));return Ue}function Ay(se,be){return se._chain?bn(be).chain():be}function vh(se){return zn(os(se),function(be){var Ue=bn[be]=se[be];bn.prototype[be]=function(){var Ke=[this._wrapped];return R.apply(Ke,arguments),Ay(this,Ue.apply(bn,Ke))}}),bn}zn(["pop","push","reverse","shift","sort","splice","unshift"],function(se){var be=M[se];bn.prototype[se]=function(){var Ue=this._wrapped;return Ue!=null&&(be.apply(Ue,arguments),(se==="shift"||se==="splice")&&Ue.length===0&&delete Ue[0]),Ay(this,Ue)}}),zn(["concat","join","slice"],function(se){var be=M[se];bn.prototype[se]=function(){var Ue=this._wrapped;return Ue!=null&&(Ue=be.apply(Ue,arguments)),Ay(this,Ue)}});const xh=bn;var cs=vh(I);cs._=cs;const Ty=cs},8296:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X,x,M,C){var E=ne(7443),R=E.isArray;function L(O){switch(O){case-2:return[];case-3:return{}}}function T(O){var W=this._promise=new I(X);O instanceof I&&W._propagateFrom(O,3),W._setOnCancel(this),this._values=O,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return E.inherits(T,C),T.prototype.length=function(){return this._length},T.prototype.promise=function(){return this._promise},T.prototype._init=function O(W,D){var q=x(this._values,this._promise);if(q instanceof I){q=q._target();var F=q._bitField;if(this._values=q,F&50397184)if(F&33554432)q=q._value();else return F&16777216?this._reject(q._reason()):this._cancel();else return this._promise._setAsyncGuaranteed(),q._then(O,this._reject,void 0,this,D)}if(q=E.asArray(q),q===null){var Y=M("expecting an array or an iterable object but got "+E.classString(q)).reason();this._promise._rejectCallback(Y,!1);return}if(q.length===0){D===-5?this._resolveEmptyArray():this._resolve(L(D));return}this._iterate(q)},T.prototype._iterate=function(O){var W=this.getActualLength(O.length);this._length=W,this._values=this.shouldCopyValues()?new Array(W):this._values;for(var D=this._promise,q=!1,F=null,Y=0;Y<W;++Y){var G=x(O[Y],D);G instanceof I?(G=G._target(),F=G._bitField):F=null,q?F!==null&&G.suppressUnhandledRejections():F!==null?F&50397184?F&33554432?q=this._promiseFulfilled(G._value(),Y):F&16777216?q=this._promiseRejected(G._reason(),Y):q=this._promiseCancelled(Y):(G._proxy(this,Y),this._values[Y]=G):q=this._promiseFulfilled(G,Y)}q||D._setAsyncGuaranteed()},T.prototype._isResolved=function(){return this._values===null},T.prototype._resolve=function(O){this._values=null,this._promise._fulfill(O)},T.prototype._cancel=function(){this._isResolved()||!this._promise._isCancellable()||(this._values=null,this._promise._cancel())},T.prototype._reject=function(O){this._values=null,this._promise._rejectCallback(O,!1)},T.prototype._promiseFulfilled=function(O,W){this._values[W]=O;var D=++this._totalResolved;return D>=this._length?(this._resolve(this._values),!0):!1},T.prototype._promiseCancelled=function(){return this._cancel(),!0},T.prototype._promiseRejected=function(O){return this._totalResolved++,this._reject(O),!0},T.prototype._resultCancelled=function(){if(!this._isResolved()){var O=this._values;if(this._cancel(),O instanceof I)O.cancel();else for(var W=0;W<O.length;++W)O[W]instanceof I&&O[W].cancel()}},T.prototype.shouldCopyValues=function(){return!0},T.prototype.getActualLength=function(O){return O},T}},8419:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X,x,M,C,E){var R=ne(7443),L=ne(9556).TypeError,T=ne(7443).inherits,O=R.errorObj,W=R.tryCatch,D={};function q(V){setTimeout(function(){throw V},0)}function F(V){var de=x(V);return de!==V&&typeof V._isDisposable=="function"&&typeof V._getDisposer=="function"&&V._isDisposable()&&de._setDisposable(V._getDisposer()),de}function Y(V,de){var P=0,p=V.length,K=new I(C);function me(){if(P>=p)return K._fulfill();var pe=F(V[P++]);if(pe instanceof I&&pe._isDisposable()){try{pe=x(pe._getDisposer().tryDispose(de),V.promise)}catch(le){return q(le)}if(pe instanceof I)return pe._then(me,q,null,null,null)}me()}return me(),K}function G(V,de,P){this._data=V,this._promise=de,this._context=P}G.prototype.data=function(){return this._data},G.prototype.promise=function(){return this._promise},G.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():D},G.prototype.tryDispose=function(V){var de=this.resource(),P=this._context;P!==void 0&&P._pushContext();var p=de!==D?this.doDispose(de,V):null;return P!==void 0&&P._popContext(),this._promise._unsetDisposable(),this._data=null,p},G.isDisposer=function(V){return V!=null&&typeof V.resource=="function"&&typeof V.tryDispose=="function"};function J(V,de,P){this.constructor$(V,de,P)}T(J,G),J.prototype.doDispose=function(V,de){var P=this.data();return P.call(V,V,de)};function z(V){return G.isDisposer(V)?(this.resources[this.index]._setDisposable(V),V.promise()):V}function te(V){this.length=V,this.promise=null,this[V-1]=null}te.prototype._resultCancelled=function(){for(var V=this.length,de=0;de<V;++de){var P=this[de];P instanceof I&&P.cancel()}},I.using=function(){var V=arguments.length;if(V<2)return X("you must pass at least 2 arguments to Promise.using");var de=arguments[V-1];if(typeof de!="function")return X("expecting a function but got "+R.classString(de));var P,p=!0;V===2&&Array.isArray(arguments[0])?(P=arguments[0],V=P.length,p=!1):(P=arguments,V--);for(var K=new te(V),me=0;me<V;++me){var pe=P[me];if(G.isDisposer(pe)){var le=pe;pe=pe.promise(),pe._setDisposable(le)}else{var ue=x(pe);ue instanceof I&&(pe=ue._then(z,null,null,{resources:K,index:me},void 0))}K[me]=pe}for(var A=new Array(K.length),me=0;me<A.length;++me)A[me]=I.resolve(K[me]).reflect();var N=I.all(A).then(function(ge){for(var ve=0;ve<ge.length;++ve){var ke=ge[ve];if(ke.isRejected())return O.e=ke.error(),O;if(!ke.isFulfilled()){N.cancel();return}ge[ve]=ke.value()}oe._pushContext(),de=W(de);var Ye=p?de.apply(void 0,ge):de(ge),Le=oe._popContext();return E.checkForgottenReturns(Ye,Le,"Promise.using",oe),Ye}),oe=N.lastly(function(){var ge=new I.PromiseInspection(N);return Y(K,ge)});return K.promise=oe,oe._setOnCancel(K),oe},I.prototype._setDisposable=function(V){this._bitField=this._bitField|131072,this._disposer=V},I.prototype._isDisposable=function(){return(this._bitField&131072)>0},I.prototype._getDisposer=function(){return this._disposer},I.prototype._unsetDisposable=function(){this._bitField=this._bitField&-131073,this._disposer=void 0},I.prototype.disposer=function(V){if(typeof V=="function")return new J(V,this,M());throw new L}}},8430:(Xe,ce,ne)=>{var I=ne(8291),X=ne(1375),x=ne(7042),M=ne(6446),C=ne(413);ce.token=function(D,q){var F=q!==void 0;return function(Y){var G=Y.head();if(G&&G.name===D&&(!F||G.value===q))return x.success(G.value,Y.tail(),G.source);var J=O({name:D,value:q});return W(Y,J)}},ce.tokenOfType=function(D){return ce.token(D)},ce.firstOf=function(D,q){return I.isArray(q)||(q=Array.prototype.slice.call(arguments,1)),function(F){return C.fromArray(q).map(function(Y){return Y(F)}).filter(function(Y){return Y.isSuccess()||Y.isError()}).first()||W(F,D)}},ce.then=function(D,q){return function(F){var Y=D(F);return Y.map||console.log(Y),Y.map(q)}},ce.sequence=function(){var D=Array.prototype.slice.call(arguments,0),q=function(Y){var G=I.foldl(D,function(z,te){var V=z.result,de=z.hasCut;if(!V.isSuccess())return{result:V,hasCut:de};var P=te(V.remaining());if(P.isCut())return{result:V,hasCut:!0};if(P.isSuccess()){var p;te.isCaptured?p=V.value().withValue(te,P.value()):p=V.value();var K=P.remaining(),me=Y.to(K);return{result:x.success(p,K,me),hasCut:de}}else return de?{result:x.error(P.errors(),P.remaining()),hasCut:de}:{result:P,hasCut:de}},{result:x.success(new E,Y),hasCut:!1}).result,J=Y.to(G.remaining());return G.map(function(z){return z.withValue(ce.sequence.source,J)})};q.head=function(){var Y=I.find(D,F);return ce.then(q,ce.sequence.extract(Y))},q.map=function(Y){return ce.then(q,function(G){return Y.apply(this,G.toArray())})};function F(Y){return Y.isCaptured}return q};var E=function(D,q){this._values=D||{},this._valuesArray=q||[]};E.prototype.withValue=function(D,q){if(D.captureName&&D.captureName in this._values)throw new Error('Cannot add second value for capture "'+D.captureName+'"');var F=I.clone(this._values);F[D.captureName]=q;var Y=this._valuesArray.concat([q]);return new E(F,Y)},E.prototype.get=function(D){if(D.captureName in this._values)return this._values[D.captureName];throw new Error('No value for capture "'+D.captureName+'"')},E.prototype.toArray=function(){return this._valuesArray},ce.sequence.capture=function(D,q){var F=function(){return D.apply(this,arguments)};return F.captureName=q,F.isCaptured=!0,F},ce.sequence.extract=function(D){return function(q){return q.get(D)}},ce.sequence.applyValues=function(D){var q=Array.prototype.slice.call(arguments,1);return function(F){var Y=q.map(function(G){return F.get(G)});return D.apply(this,Y)}},ce.sequence.source={captureName:"\u2603source\u2603"},ce.sequence.cut=function(){return function(D){return x.cut(D)}},ce.optional=function(D){return function(q){var F=D(q);return F.isSuccess()?F.map(X.some):F.isFailure()?x.success(X.none,q):F}},ce.zeroOrMoreWithSeparator=function(D,q){return T(D,q,!1)},ce.oneOrMoreWithSeparator=function(D,q){return T(D,q,!0)};var R=ce.zeroOrMore=function(D){return function(q){for(var F=[],Y;(Y=D(q))&&Y.isSuccess();)q=Y.remaining(),F.push(Y.value());return Y.isError()?Y:x.success(F,q)}};ce.oneOrMore=function(D){return ce.oneOrMoreWithSeparator(D,L)};function L(D){return x.success(null,D)}var T=function(D,q,F){return function(Y){var G=D(Y);if(G.isSuccess()){var J=ce.sequence.capture(D,"main"),z=R(ce.then(ce.sequence(q,J),ce.sequence.extract(J))),te=z(G.remaining());return x.success([G.value()].concat(te.value()),te.remaining())}else return F||G.isError()?G:x.success([],Y)}};ce.leftAssociative=function(D,q,F){var Y;F?Y=[{func:F,rule:q}]:Y=q,Y=Y.map(function(J){return ce.then(J.rule,function(z){return function(te,V){return J.func(te,z,V)}})});var G=ce.firstOf.apply(null,["rules"].concat(Y));return function(J){var z=J,te=D(J);if(!te.isSuccess())return te;for(var V=G(te.remaining());V.isSuccess();){var de=V.remaining(),P=z.to(V.remaining()),p=V.value();te=x.success(p(te.value(),P),de,P),V=G(te.remaining())}return V.isError()?V:te}},ce.leftAssociative.firstOf=function(){return Array.prototype.slice.call(arguments,0)},ce.nonConsuming=function(D){return function(q){return D(q).changeRemaining(q)}};var O=function(D){return D.value?D.name+' "'+D.value+'"':D.name};function W(D,q){var F,Y=D.head();return Y?F=M.error({expected:q,actual:O(Y),location:Y.source}):F=M.error({expected:q,actual:"end of tokens"}),x.failure([F],D)}},8994:(Xe,ce,ne)=>{var I=ne(9354);ce.freshElement=I.freshElement,ce.nonFreshElement=I.nonFreshElement,ce.elementWithTag=I.elementWithTag,ce.text=I.text,ce.forceWrite=I.forceWrite,ce.simplify=ne(3927);function X(R,L){L.forEach(function(T){x(R,T)})}function x(R,L){M[L.type](R,L)}var M={element:C,text:E,forceWrite:function(){}};function C(R,L){I.isVoidElement(L)?R.selfClosing(L.tag.tagName,L.tag.attributes):(R.open(L.tag.tagName,L.tag.attributes),X(R,L.children),R.close(L.tag.tagName))}function E(R,L){R.text(L.value)}ce.write=X},9001:(Xe,ce,ne)=>{/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(I){Xe.exports=I()})(function(){return function I(X,x,M){function C(L,T){if(!x[L]){if(!X[L]){var O=void 0;if(!T&&O)return require(L,!0);if(E)return E(L,!0);var W=new Error("Cannot find module '"+L+"'");throw W.code="MODULE_NOT_FOUND",W}var D=x[L]={exports:{}};X[L][0].call(D.exports,function(q){var F=X[L][1][q];return C(F||q)},D,D.exports,I,X,x,M)}return x[L].exports}for(var E=void 0,R=0;R<M.length;R++)C(M[R]);return C}({1:[function(I,X,x){"use strict";var M=I("./utils"),C=I("./support"),E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";x.encode=function(R){for(var L,T,O,W,D,q,F,Y=[],G=0,J=R.length,z=J,te=M.getTypeOf(R)!=="string";G<R.length;)z=J-G,O=te?(L=R[G++],T=G<J?R[G++]:0,G<J?R[G++]:0):(L=R.charCodeAt(G++),T=G<J?R.charCodeAt(G++):0,G<J?R.charCodeAt(G++):0),W=L>>2,D=(3&L)<<4|T>>4,q=1<z?(15&T)<<2|O>>6:64,F=2<z?63&O:64,Y.push(E.charAt(W)+E.charAt(D)+E.charAt(q)+E.charAt(F));return Y.join("")},x.decode=function(R){var L,T,O,W,D,q,F=0,Y=0,G="data:";if(R.substr(0,G.length)===G)throw new Error("Invalid base64 input, it looks like a data url.");var J,z=3*(R=R.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(R.charAt(R.length-1)===E.charAt(64)&&z--,R.charAt(R.length-2)===E.charAt(64)&&z--,z%1!=0)throw new Error("Invalid base64 input, bad content length.");for(J=C.uint8array?new Uint8Array(0|z):new Array(0|z);F<R.length;)L=E.indexOf(R.charAt(F++))<<2|(W=E.indexOf(R.charAt(F++)))>>4,T=(15&W)<<4|(D=E.indexOf(R.charAt(F++)))>>2,O=(3&D)<<6|(q=E.indexOf(R.charAt(F++))),J[Y++]=L,D!==64&&(J[Y++]=T),q!==64&&(J[Y++]=O);return J}},{"./support":30,"./utils":32}],2:[function(I,X,x){"use strict";var M=I("./external"),C=I("./stream/DataWorker"),E=I("./stream/Crc32Probe"),R=I("./stream/DataLengthProbe");function L(T,O,W,D,q){this.compressedSize=T,this.uncompressedSize=O,this.crc32=W,this.compression=D,this.compressedContent=q}L.prototype={getContentWorker:function(){var T=new C(M.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new R("data_length")),O=this;return T.on("end",function(){if(this.streamInfo.data_length!==O.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),T},getCompressedWorker:function(){return new C(M.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},L.createWorkerFrom=function(T,O,W){return T.pipe(new E).pipe(new R("uncompressedSize")).pipe(O.compressWorker(W)).pipe(new R("compressedSize")).withStreamInfo("compression",O)},X.exports=L},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(I,X,x){"use strict";var M=I("./stream/GenericWorker");x.STORE={magic:"\0\0",compressWorker:function(){return new M("STORE compression")},uncompressWorker:function(){return new M("STORE decompression")}},x.DEFLATE=I("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(I,X,x){"use strict";var M=I("./utils"),C=function(){for(var E,R=[],L=0;L<256;L++){E=L;for(var T=0;T<8;T++)E=1&E?3988292384^E>>>1:E>>>1;R[L]=E}return R}();X.exports=function(E,R){return E!==void 0&&E.length?M.getTypeOf(E)!=="string"?function(L,T,O,W){var D=C,q=W+O;L^=-1;for(var F=W;F<q;F++)L=L>>>8^D[255&(L^T[F])];return-1^L}(0|R,E,E.length,0):function(L,T,O,W){var D=C,q=W+O;L^=-1;for(var F=W;F<q;F++)L=L>>>8^D[255&(L^T.charCodeAt(F))];return-1^L}(0|R,E,E.length,0):0}},{"./utils":32}],5:[function(I,X,x){"use strict";x.base64=!1,x.binary=!1,x.dir=!1,x.createFolders=!0,x.date=null,x.compression=null,x.compressionOptions=null,x.comment=null,x.unixPermissions=null,x.dosPermissions=null},{}],6:[function(I,X,x){"use strict";var M=null;M=typeof Promise!="undefined"?Promise:I("lie"),X.exports={Promise:M}},{lie:37}],7:[function(I,X,x){"use strict";var M=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",C=I("pako"),E=I("./utils"),R=I("./stream/GenericWorker"),L=M?"uint8array":"array";function T(O,W){R.call(this,"FlateWorker/"+O),this._pako=null,this._pakoAction=O,this._pakoOptions=W,this.meta={}}x.magic="\b\0",E.inherits(T,R),T.prototype.processChunk=function(O){this.meta=O.meta,this._pako===null&&this._createPako(),this._pako.push(E.transformTo(L,O.data),!1)},T.prototype.flush=function(){R.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},T.prototype.cleanUp=function(){R.prototype.cleanUp.call(this),this._pako=null},T.prototype._createPako=function(){this._pako=new C[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var O=this;this._pako.onData=function(W){O.push({data:W,meta:O.meta})}},x.compressWorker=function(O){return new T("Deflate",O)},x.uncompressWorker=function(){return new T("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(I,X,x){"use strict";function M(D,q){var F,Y="";for(F=0;F<q;F++)Y+=String.fromCharCode(255&D),D>>>=8;return Y}function C(D,q,F,Y,G,J){var z,te,V=D.file,de=D.compression,P=J!==L.utf8encode,p=E.transformTo("string",J(V.name)),K=E.transformTo("string",L.utf8encode(V.name)),me=V.comment,pe=E.transformTo("string",J(me)),le=E.transformTo("string",L.utf8encode(me)),ue=K.length!==V.name.length,A=le.length!==me.length,N="",oe="",ge="",ve=V.dir,ke=V.date,Ye={crc32:0,compressedSize:0,uncompressedSize:0};q&&!F||(Ye.crc32=D.crc32,Ye.compressedSize=D.compressedSize,Ye.uncompressedSize=D.uncompressedSize);var Le=0;q&&(Le|=8),P||!ue&&!A||(Le|=2048);var Fe=0,st=0;ve&&(Fe|=16),G==="UNIX"?(st=798,Fe|=function(pt,$t){var It=pt;return pt||(It=$t?16893:33204),(65535&It)<<16}(V.unixPermissions,ve)):(st=20,Fe|=function(pt){return 63&(pt||0)}(V.dosPermissions)),z=ke.getUTCHours(),z<<=6,z|=ke.getUTCMinutes(),z<<=5,z|=ke.getUTCSeconds()/2,te=ke.getUTCFullYear()-1980,te<<=4,te|=ke.getUTCMonth()+1,te<<=5,te|=ke.getUTCDate(),ue&&(oe=M(1,1)+M(T(p),4)+K,N+="up"+M(oe.length,2)+oe),A&&(ge=M(1,1)+M(T(pe),4)+le,N+="uc"+M(ge.length,2)+ge);var Ee="";return Ee+=`
\0`,Ee+=M(Le,2),Ee+=de.magic,Ee+=M(z,2),Ee+=M(te,2),Ee+=M(Ye.crc32,4),Ee+=M(Ye.compressedSize,4),Ee+=M(Ye.uncompressedSize,4),Ee+=M(p.length,2),Ee+=M(N.length,2),{fileRecord:O.LOCAL_FILE_HEADER+Ee+p+N,dirRecord:O.CENTRAL_FILE_HEADER+M(st,2)+Ee+M(pe.length,2)+"\0\0\0\0"+M(Fe,4)+M(Y,4)+p+N+pe}}var E=I("../utils"),R=I("../stream/GenericWorker"),L=I("../utf8"),T=I("../crc32"),O=I("../signature");function W(D,q,F,Y){R.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=q,this.zipPlatform=F,this.encodeFileName=Y,this.streamFiles=D,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}E.inherits(W,R),W.prototype.push=function(D){var q=D.meta.percent||0,F=this.entriesCount,Y=this._sources.length;this.accumulate?this.contentBuffer.push(D):(this.bytesWritten+=D.data.length,R.prototype.push.call(this,{data:D.data,meta:{currentFile:this.currentFile,percent:F?(q+100*(F-Y-1))/F:100}}))},W.prototype.openedSource=function(D){this.currentSourceOffset=this.bytesWritten,this.currentFile=D.file.name;var q=this.streamFiles&&!D.file.dir;if(q){var F=C(D,q,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:F.fileRecord,meta:{percent:0}})}else this.accumulate=!0},W.prototype.closedSource=function(D){this.accumulate=!1;var q=this.streamFiles&&!D.file.dir,F=C(D,q,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(F.dirRecord),q)this.push({data:function(Y){return O.DATA_DESCRIPTOR+M(Y.crc32,4)+M(Y.compressedSize,4)+M(Y.uncompressedSize,4)}(D),meta:{percent:100}});else for(this.push({data:F.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},W.prototype.flush=function(){for(var D=this.bytesWritten,q=0;q<this.dirRecords.length;q++)this.push({data:this.dirRecords[q],meta:{percent:100}});var F=this.bytesWritten-D,Y=function(G,J,z,te,V){var de=E.transformTo("string",V(te));return O.CENTRAL_DIRECTORY_END+"\0\0\0\0"+M(G,2)+M(G,2)+M(J,4)+M(z,4)+M(de.length,2)+de}(this.dirRecords.length,F,D,this.zipComment,this.encodeFileName);this.push({data:Y,meta:{percent:100}})},W.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},W.prototype.registerPrevious=function(D){this._sources.push(D);var q=this;return D.on("data",function(F){q.processChunk(F)}),D.on("end",function(){q.closedSource(q.previous.streamInfo),q._sources.length?q.prepareNextSource():q.end()}),D.on("error",function(F){q.error(F)}),this},W.prototype.resume=function(){return!!R.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},W.prototype.error=function(D){var q=this._sources;if(!R.prototype.error.call(this,D))return!1;for(var F=0;F<q.length;F++)try{q[F].error(D)}catch(Y){}return!0},W.prototype.lock=function(){R.prototype.lock.call(this);for(var D=this._sources,q=0;q<D.length;q++)D[q].lock()},X.exports=W},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(I,X,x){"use strict";var M=I("../compressions"),C=I("./ZipFileWorker");x.generateWorker=function(E,R,L){var T=new C(R.streamFiles,L,R.platform,R.encodeFileName),O=0;try{E.forEach(function(W,D){O++;var q=function(J,z){var te=J||z,V=M[te];if(!V)throw new Error(te+" is not a valid compression method !");return V}(D.options.compression,R.compression),F=D.options.compressionOptions||R.compressionOptions||{},Y=D.dir,G=D.date;D._compressWorker(q,F).withStreamInfo("file",{name:W,dir:Y,date:G,comment:D.comment||"",unixPermissions:D.unixPermissions,dosPermissions:D.dosPermissions}).pipe(T)}),T.entriesCount=O}catch(W){T.error(W)}return T}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(I,X,x){"use strict";function M(){if(!(this instanceof M))return new M;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var C=new M;for(var E in this)typeof this[E]!="function"&&(C[E]=this[E]);return C}}(M.prototype=I("./object")).loadAsync=I("./load"),M.support=I("./support"),M.defaults=I("./defaults"),M.version="3.10.1",M.loadAsync=function(C,E){return new M().loadAsync(C,E)},M.external=I("./external"),X.exports=M},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(I,X,x){"use strict";var M=I("./utils"),C=I("./external"),E=I("./utf8"),R=I("./zipEntries"),L=I("./stream/Crc32Probe"),T=I("./nodejsUtils");function O(W){return new C.Promise(function(D,q){var F=W.decompressed.getContentWorker().pipe(new L);F.on("error",function(Y){q(Y)}).on("end",function(){F.streamInfo.crc32!==W.decompressed.crc32?q(new Error("Corrupted zip : CRC32 mismatch")):D()}).resume()})}X.exports=function(W,D){var q=this;return D=M.extend(D||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:E.utf8decode}),T.isNode&&T.isStream(W)?C.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):M.prepareContent("the loaded zip file",W,!0,D.optimizedBinaryString,D.base64).then(function(F){var Y=new R(D);return Y.load(F),Y}).then(function(F){var Y=[C.Promise.resolve(F)],G=F.files;if(D.checkCRC32)for(var J=0;J<G.length;J++)Y.push(O(G[J]));return C.Promise.all(Y)}).then(function(F){for(var Y=F.shift(),G=Y.files,J=0;J<G.length;J++){var z=G[J],te=z.fileNameStr,V=M.resolve(z.fileNameStr);q.file(V,z.decompressed,{binary:!0,optimizedBinaryString:!0,date:z.date,dir:z.dir,comment:z.fileCommentStr.length?z.fileCommentStr:null,unixPermissions:z.unixPermissions,dosPermissions:z.dosPermissions,createFolders:D.createFolders}),z.dir||(q.file(V).unsafeOriginalName=te)}return Y.zipComment.length&&(q.comment=Y.zipComment),q})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(I,X,x){"use strict";var M=I("../utils"),C=I("../stream/GenericWorker");function E(R,L){C.call(this,"Nodejs stream input adapter for "+R),this._upstreamEnded=!1,this._bindStream(L)}M.inherits(E,C),E.prototype._bindStream=function(R){var L=this;(this._stream=R).pause(),R.on("data",function(T){L.push({data:T,meta:{percent:0}})}).on("error",function(T){L.isPaused?this.generatedError=T:L.error(T)}).on("end",function(){L.isPaused?L._upstreamEnded=!0:L.end()})},E.prototype.pause=function(){return!!C.prototype.pause.call(this)&&(this._stream.pause(),!0)},E.prototype.resume=function(){return!!C.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},X.exports=E},{"../stream/GenericWorker":28,"../utils":32}],13:[function(I,X,x){"use strict";var M=I("readable-stream").Readable;function C(E,R,L){M.call(this,R),this._helper=E;var T=this;E.on("data",function(O,W){T.push(O)||T._helper.pause(),L&&L(W)}).on("error",function(O){T.emit("error",O)}).on("end",function(){T.push(null)})}I("../utils").inherits(C,M),C.prototype._read=function(){this._helper.resume()},X.exports=C},{"../utils":32,"readable-stream":16}],14:[function(I,X,x){"use strict";X.exports={isNode:typeof Buffer!="undefined",newBufferFrom:function(M,C){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(M,C);if(typeof M=="number")throw new Error('The "data" argument must not be a number');return new Buffer(M,C)},allocBuffer:function(M){if(Buffer.alloc)return Buffer.alloc(M);var C=new Buffer(M);return C.fill(0),C},isBuffer:function(M){return Buffer.isBuffer(M)},isStream:function(M){return M&&typeof M.on=="function"&&typeof M.pause=="function"&&typeof M.resume=="function"}}},{}],15:[function(I,X,x){"use strict";function M(V,de,P){var p,K=E.getTypeOf(de),me=E.extend(P||{},T);me.date=me.date||new Date,me.compression!==null&&(me.compression=me.compression.toUpperCase()),typeof me.unixPermissions=="string"&&(me.unixPermissions=parseInt(me.unixPermissions,8)),me.unixPermissions&&16384&me.unixPermissions&&(me.dir=!0),me.dosPermissions&&16&me.dosPermissions&&(me.dir=!0),me.dir&&(V=G(V)),me.createFolders&&(p=Y(V))&&J.call(this,p,!0);var pe=K==="string"&&me.binary===!1&&me.base64===!1;P&&P.binary!==void 0||(me.binary=!pe),(de instanceof O&&de.uncompressedSize===0||me.dir||!de||de.length===0)&&(me.base64=!1,me.binary=!0,de="",me.compression="STORE",K="string");var le=null;le=de instanceof O||de instanceof R?de:q.isNode&&q.isStream(de)?new F(V,de):E.prepareContent(V,de,me.binary,me.optimizedBinaryString,me.base64);var ue=new W(V,le,me);this.files[V]=ue}var C=I("./utf8"),E=I("./utils"),R=I("./stream/GenericWorker"),L=I("./stream/StreamHelper"),T=I("./defaults"),O=I("./compressedObject"),W=I("./zipObject"),D=I("./generate"),q=I("./nodejsUtils"),F=I("./nodejs/NodejsStreamInputAdapter"),Y=function(V){V.slice(-1)==="/"&&(V=V.substring(0,V.length-1));var de=V.lastIndexOf("/");return 0<de?V.substring(0,de):""},G=function(V){return V.slice(-1)!=="/"&&(V+="/"),V},J=function(V,de){return de=de!==void 0?de:T.createFolders,V=G(V),this.files[V]||M.call(this,V,null,{dir:!0,createFolders:de}),this.files[V]};function z(V){return Object.prototype.toString.call(V)==="[object RegExp]"}var te={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(V){var de,P,p;for(de in this.files)p=this.files[de],(P=de.slice(this.root.length,de.length))&&de.slice(0,this.root.length)===this.root&&V(P,p)},filter:function(V){var de=[];return this.forEach(function(P,p){V(P,p)&&de.push(p)}),de},file:function(V,de,P){if(arguments.length!==1)return V=this.root+V,M.call(this,V,de,P),this;if(z(V)){var p=V;return this.filter(function(me,pe){return!pe.dir&&p.test(me)})}var K=this.files[this.root+V];return K&&!K.dir?K:null},folder:function(V){if(!V)return this;if(z(V))return this.filter(function(K,me){return me.dir&&V.test(K)});var de=this.root+V,P=J.call(this,de),p=this.clone();return p.root=P.name,p},remove:function(V){V=this.root+V;var de=this.files[V];if(de||(V.slice(-1)!=="/"&&(V+="/"),de=this.files[V]),de&&!de.dir)delete this.files[V];else for(var P=this.filter(function(K,me){return me.name.slice(0,V.length)===V}),p=0;p<P.length;p++)delete this.files[P[p].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(V){var de,P={};try{if((P=E.extend(V||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:C.utf8encode})).type=P.type.toLowerCase(),P.compression=P.compression.toUpperCase(),P.type==="binarystring"&&(P.type="string"),!P.type)throw new Error("No output type specified.");E.checkSupport(P.type),P.platform!=="darwin"&&P.platform!=="freebsd"&&P.platform!=="linux"&&P.platform!=="sunos"||(P.platform="UNIX"),P.platform==="win32"&&(P.platform="DOS");var p=P.comment||this.comment||"";de=D.generateWorker(this,P,p)}catch(K){(de=new R("error")).error(K)}return new L(de,P.type||"string",P.mimeType)},generateAsync:function(V,de){return this.generateInternalStream(V).accumulate(de)},generateNodeStream:function(V,de){return(V=V||{}).type||(V.type="nodebuffer"),this.generateInternalStream(V).toNodejsStream(de)}};X.exports=te},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(I,X,x){"use strict";X.exports=I("stream")},{stream:void 0}],17:[function(I,X,x){"use strict";var M=I("./DataReader");function C(E){M.call(this,E);for(var R=0;R<this.data.length;R++)E[R]=255&E[R]}I("../utils").inherits(C,M),C.prototype.byteAt=function(E){return this.data[this.zero+E]},C.prototype.lastIndexOfSignature=function(E){for(var R=E.charCodeAt(0),L=E.charCodeAt(1),T=E.charCodeAt(2),O=E.charCodeAt(3),W=this.length-4;0<=W;--W)if(this.data[W]===R&&this.data[W+1]===L&&this.data[W+2]===T&&this.data[W+3]===O)return W-this.zero;return-1},C.prototype.readAndCheckSignature=function(E){var R=E.charCodeAt(0),L=E.charCodeAt(1),T=E.charCodeAt(2),O=E.charCodeAt(3),W=this.readData(4);return R===W[0]&&L===W[1]&&T===W[2]&&O===W[3]},C.prototype.readData=function(E){if(this.checkOffset(E),E===0)return[];var R=this.data.slice(this.zero+this.index,this.zero+this.index+E);return this.index+=E,R},X.exports=C},{"../utils":32,"./DataReader":18}],18:[function(I,X,x){"use strict";var M=I("../utils");function C(E){this.data=E,this.length=E.length,this.index=0,this.zero=0}C.prototype={checkOffset:function(E){this.checkIndex(this.index+E)},checkIndex:function(E){if(this.length<this.zero+E||E<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+E+"). Corrupted zip ?")},setIndex:function(E){this.checkIndex(E),this.index=E},skip:function(E){this.setIndex(this.index+E)},byteAt:function(){},readInt:function(E){var R,L=0;for(this.checkOffset(E),R=this.index+E-1;R>=this.index;R--)L=(L<<8)+this.byteAt(R);return this.index+=E,L},readString:function(E){return M.transformTo("string",this.readData(E))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var E=this.readInt(4);return new Date(Date.UTC(1980+(E>>25&127),(E>>21&15)-1,E>>16&31,E>>11&31,E>>5&63,(31&E)<<1))}},X.exports=C},{"../utils":32}],19:[function(I,X,x){"use strict";var M=I("./Uint8ArrayReader");function C(E){M.call(this,E)}I("../utils").inherits(C,M),C.prototype.readData=function(E){this.checkOffset(E);var R=this.data.slice(this.zero+this.index,this.zero+this.index+E);return this.index+=E,R},X.exports=C},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(I,X,x){"use strict";var M=I("./DataReader");function C(E){M.call(this,E)}I("../utils").inherits(C,M),C.prototype.byteAt=function(E){return this.data.charCodeAt(this.zero+E)},C.prototype.lastIndexOfSignature=function(E){return this.data.lastIndexOf(E)-this.zero},C.prototype.readAndCheckSignature=function(E){return E===this.readData(4)},C.prototype.readData=function(E){this.checkOffset(E);var R=this.data.slice(this.zero+this.index,this.zero+this.index+E);return this.index+=E,R},X.exports=C},{"../utils":32,"./DataReader":18}],21:[function(I,X,x){"use strict";var M=I("./ArrayReader");function C(E){M.call(this,E)}I("../utils").inherits(C,M),C.prototype.readData=function(E){if(this.checkOffset(E),E===0)return new Uint8Array(0);var R=this.data.subarray(this.zero+this.index,this.zero+this.index+E);return this.index+=E,R},X.exports=C},{"../utils":32,"./ArrayReader":17}],22:[function(I,X,x){"use strict";var M=I("../utils"),C=I("../support"),E=I("./ArrayReader"),R=I("./StringReader"),L=I("./NodeBufferReader"),T=I("./Uint8ArrayReader");X.exports=function(O){var W=M.getTypeOf(O);return M.checkSupport(W),W!=="string"||C.uint8array?W==="nodebuffer"?new L(O):C.uint8array?new T(M.transformTo("uint8array",O)):new E(M.transformTo("array",O)):new R(O)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(I,X,x){"use strict";x.LOCAL_FILE_HEADER="PK",x.CENTRAL_FILE_HEADER="PK",x.CENTRAL_DIRECTORY_END="PK",x.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",x.ZIP64_CENTRAL_DIRECTORY_END="PK",x.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(I,X,x){"use strict";var M=I("./GenericWorker"),C=I("../utils");function E(R){M.call(this,"ConvertWorker to "+R),this.destType=R}C.inherits(E,M),E.prototype.processChunk=function(R){this.push({data:C.transformTo(this.destType,R.data),meta:R.meta})},X.exports=E},{"../utils":32,"./GenericWorker":28}],25:[function(I,X,x){"use strict";var M=I("./GenericWorker"),C=I("../crc32");function E(){M.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}I("../utils").inherits(E,M),E.prototype.processChunk=function(R){this.streamInfo.crc32=C(R.data,this.streamInfo.crc32||0),this.push(R)},X.exports=E},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(I,X,x){"use strict";var M=I("../utils"),C=I("./GenericWorker");function E(R){C.call(this,"DataLengthProbe for "+R),this.propName=R,this.withStreamInfo(R,0)}M.inherits(E,C),E.prototype.processChunk=function(R){if(R){var L=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=L+R.data.length}C.prototype.processChunk.call(this,R)},X.exports=E},{"../utils":32,"./GenericWorker":28}],27:[function(I,X,x){"use strict";var M=I("../utils"),C=I("./GenericWorker");function E(R){C.call(this,"DataWorker");var L=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,R.then(function(T){L.dataIsReady=!0,L.data=T,L.max=T&&T.length||0,L.type=M.getTypeOf(T),L.isPaused||L._tickAndRepeat()},function(T){L.error(T)})}M.inherits(E,C),E.prototype.cleanUp=function(){C.prototype.cleanUp.call(this),this.data=null},E.prototype.resume=function(){return!!C.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,M.delay(this._tickAndRepeat,[],this)),!0)},E.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(M.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},E.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var R=null,L=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":R=this.data.substring(this.index,L);break;case"uint8array":R=this.data.subarray(this.index,L);break;case"array":case"nodebuffer":R=this.data.slice(this.index,L)}return this.index=L,this.push({data:R,meta:{percent:this.max?this.index/this.max*100:0}})},X.exports=E},{"../utils":32,"./GenericWorker":28}],28:[function(I,X,x){"use strict";function M(C){this.name=C||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}M.prototype={push:function(C){this.emit("data",C)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(C){this.emit("error",C)}return!0},error:function(C){return!this.isFinished&&(this.isPaused?this.generatedError=C:(this.isFinished=!0,this.emit("error",C),this.previous&&this.previous.error(C),this.cleanUp()),!0)},on:function(C,E){return this._listeners[C].push(E),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(C,E){if(this._listeners[C])for(var R=0;R<this._listeners[C].length;R++)this._listeners[C][R].call(this,E)},pipe:function(C){return C.registerPrevious(this)},registerPrevious:function(C){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=C.streamInfo,this.mergeStreamInfo(),this.previous=C;var E=this;return C.on("data",function(R){E.processChunk(R)}),C.on("end",function(){E.end()}),C.on("error",function(R){E.error(R)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var C=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),C=!0),this.previous&&this.previous.resume(),!C},flush:function(){},processChunk:function(C){this.push(C)},withStreamInfo:function(C,E){return this.extraStreamInfo[C]=E,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var C in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,C)&&(this.streamInfo[C]=this.extraStreamInfo[C])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var C="Worker "+this.name;return this.previous?this.previous+" -> "+C:C}},X.exports=M},{}],29:[function(I,X,x){"use strict";var M=I("../utils"),C=I("./ConvertWorker"),E=I("./GenericWorker"),R=I("../base64"),L=I("../support"),T=I("../external"),O=null;if(L.nodestream)try{O=I("../nodejs/NodejsStreamOutputAdapter")}catch(q){}function W(q,F){return new T.Promise(function(Y,G){var J=[],z=q._internalType,te=q._outputType,V=q._mimeType;q.on("data",function(de,P){J.push(de),F&&F(P)}).on("error",function(de){J=[],G(de)}).on("end",function(){try{var de=function(P,p,K){switch(P){case"blob":return M.newBlob(M.transformTo("arraybuffer",p),K);case"base64":return R.encode(p);default:return M.transformTo(P,p)}}(te,function(P,p){var K,me=0,pe=null,le=0;for(K=0;K<p.length;K++)le+=p[K].length;switch(P){case"string":return p.join("");case"array":return Array.prototype.concat.apply([],p);case"uint8array":for(pe=new Uint8Array(le),K=0;K<p.length;K++)pe.set(p[K],me),me+=p[K].length;return pe;case"nodebuffer":return Buffer.concat(p);default:throw new Error("concat : unsupported type '"+P+"'")}}(z,J),V);Y(de)}catch(P){G(P)}J=[]}).resume()})}function D(q,F,Y){var G=F;switch(F){case"blob":case"arraybuffer":G="uint8array";break;case"base64":G="string"}try{this._internalType=G,this._outputType=F,this._mimeType=Y,M.checkSupport(G),this._worker=q.pipe(new C(G)),q.lock()}catch(J){this._worker=new E("error"),this._worker.error(J)}}D.prototype={accumulate:function(q){return W(this,q)},on:function(q,F){var Y=this;return q==="data"?this._worker.on(q,function(G){F.call(Y,G.data,G.meta)}):this._worker.on(q,function(){M.delay(F,arguments,Y)}),this},resume:function(){return M.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(q){if(M.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new O(this,{objectMode:this._outputType!=="nodebuffer"},q)}},X.exports=D},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(I,X,x){"use strict";if(x.base64=!0,x.array=!0,x.string=!0,x.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined",x.nodebuffer=typeof Buffer!="undefined",x.uint8array=typeof Uint8Array!="undefined",typeof ArrayBuffer=="undefined")x.blob=!1;else{var M=new ArrayBuffer(0);try{x.blob=new Blob([M],{type:"application/zip"}).size===0}catch(E){try{var C=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);C.append(M),x.blob=C.getBlob("application/zip").size===0}catch(R){x.blob=!1}}}try{x.nodestream=!!I("readable-stream").Readable}catch(E){x.nodestream=!1}},{"readable-stream":16}],31:[function(I,X,x){"use strict";for(var M=I("./utils"),C=I("./support"),E=I("./nodejsUtils"),R=I("./stream/GenericWorker"),L=new Array(256),T=0;T<256;T++)L[T]=252<=T?6:248<=T?5:240<=T?4:224<=T?3:192<=T?2:1;L[254]=L[254]=1;function O(){R.call(this,"utf-8 decode"),this.leftOver=null}function W(){R.call(this,"utf-8 encode")}x.utf8encode=function(D){return C.nodebuffer?E.newBufferFrom(D,"utf-8"):function(q){var F,Y,G,J,z,te=q.length,V=0;for(J=0;J<te;J++)(64512&(Y=q.charCodeAt(J)))==55296&&J+1<te&&(64512&(G=q.charCodeAt(J+1)))==56320&&(Y=65536+(Y-55296<<10)+(G-56320),J++),V+=Y<128?1:Y<2048?2:Y<65536?3:4;for(F=C.uint8array?new Uint8Array(V):new Array(V),J=z=0;z<V;J++)(64512&(Y=q.charCodeAt(J)))==55296&&J+1<te&&(64512&(G=q.charCodeAt(J+1)))==56320&&(Y=65536+(Y-55296<<10)+(G-56320),J++),Y<128?F[z++]=Y:(Y<2048?F[z++]=192|Y>>>6:(Y<65536?F[z++]=224|Y>>>12:(F[z++]=240|Y>>>18,F[z++]=128|Y>>>12&63),F[z++]=128|Y>>>6&63),F[z++]=128|63&Y);return F}(D)},x.utf8decode=function(D){return C.nodebuffer?M.transformTo("nodebuffer",D).toString("utf-8"):function(q){var F,Y,G,J,z=q.length,te=new Array(2*z);for(F=Y=0;F<z;)if((G=q[F++])<128)te[Y++]=G;else if(4<(J=L[G]))te[Y++]=65533,F+=J-1;else{for(G&=J===2?31:J===3?15:7;1<J&&F<z;)G=G<<6|63&q[F++],J--;1<J?te[Y++]=65533:G<65536?te[Y++]=G:(G-=65536,te[Y++]=55296|G>>10&1023,te[Y++]=56320|1023&G)}return te.length!==Y&&(te.subarray?te=te.subarray(0,Y):te.length=Y),M.applyFromCharCode(te)}(D=M.transformTo(C.uint8array?"uint8array":"array",D))},M.inherits(O,R),O.prototype.processChunk=function(D){var q=M.transformTo(C.uint8array?"uint8array":"array",D.data);if(this.leftOver&&this.leftOver.length){if(C.uint8array){var F=q;(q=new Uint8Array(F.length+this.leftOver.length)).set(this.leftOver,0),q.set(F,this.leftOver.length)}else q=this.leftOver.concat(q);this.leftOver=null}var Y=function(J,z){var te;for((z=z||J.length)>J.length&&(z=J.length),te=z-1;0<=te&&(192&J[te])==128;)te--;return te<0||te===0?z:te+L[J[te]]>z?te:z}(q),G=q;Y!==q.length&&(C.uint8array?(G=q.subarray(0,Y),this.leftOver=q.subarray(Y,q.length)):(G=q.slice(0,Y),this.leftOver=q.slice(Y,q.length))),this.push({data:x.utf8decode(G),meta:D.meta})},O.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:x.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},x.Utf8DecodeWorker=O,M.inherits(W,R),W.prototype.processChunk=function(D){this.push({data:x.utf8encode(D.data),meta:D.meta})},x.Utf8EncodeWorker=W},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(I,X,x){"use strict";var M=I("./support"),C=I("./base64"),E=I("./nodejsUtils"),R=I("./external");function L(F){return F}function T(F,Y){for(var G=0;G<F.length;++G)Y[G]=255&F.charCodeAt(G);return Y}I("setimmediate"),x.newBlob=function(F,Y){x.checkSupport("blob");try{return new Blob([F],{type:Y})}catch(J){try{var G=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return G.append(F),G.getBlob(Y)}catch(z){throw new Error("Bug : can't construct the Blob.")}}};var O={stringifyByChunk:function(F,Y,G){var J=[],z=0,te=F.length;if(te<=G)return String.fromCharCode.apply(null,F);for(;z<te;)Y==="array"||Y==="nodebuffer"?J.push(String.fromCharCode.apply(null,F.slice(z,Math.min(z+G,te)))):J.push(String.fromCharCode.apply(null,F.subarray(z,Math.min(z+G,te)))),z+=G;return J.join("")},stringifyByChar:function(F){for(var Y="",G=0;G<F.length;G++)Y+=String.fromCharCode(F[G]);return Y},applyCanBeUsed:{uint8array:function(){try{return M.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(F){return!1}}(),nodebuffer:function(){try{return M.nodebuffer&&String.fromCharCode.apply(null,E.allocBuffer(1)).length===1}catch(F){return!1}}()}};function W(F){var Y=65536,G=x.getTypeOf(F),J=!0;if(G==="uint8array"?J=O.applyCanBeUsed.uint8array:G==="nodebuffer"&&(J=O.applyCanBeUsed.nodebuffer),J)for(;1<Y;)try{return O.stringifyByChunk(F,G,Y)}catch(z){Y=Math.floor(Y/2)}return O.stringifyByChar(F)}function D(F,Y){for(var G=0;G<F.length;G++)Y[G]=F[G];return Y}x.applyFromCharCode=W;var q={};q.string={string:L,array:function(F){return T(F,new Array(F.length))},arraybuffer:function(F){return q.string.uint8array(F).buffer},uint8array:function(F){return T(F,new Uint8Array(F.length))},nodebuffer:function(F){return T(F,E.allocBuffer(F.length))}},q.array={string:W,array:L,arraybuffer:function(F){return new Uint8Array(F).buffer},uint8array:function(F){return new Uint8Array(F)},nodebuffer:function(F){return E.newBufferFrom(F)}},q.arraybuffer={string:function(F){return W(new Uint8Array(F))},array:function(F){return D(new Uint8Array(F),new Array(F.byteLength))},arraybuffer:L,uint8array:function(F){return new Uint8Array(F)},nodebuffer:function(F){return E.newBufferFrom(new Uint8Array(F))}},q.uint8array={string:W,array:function(F){return D(F,new Array(F.length))},arraybuffer:function(F){return F.buffer},uint8array:L,nodebuffer:function(F){return E.newBufferFrom(F)}},q.nodebuffer={string:W,array:function(F){return D(F,new Array(F.length))},arraybuffer:function(F){return q.nodebuffer.uint8array(F).buffer},uint8array:function(F){return D(F,new Uint8Array(F.length))},nodebuffer:L},x.transformTo=function(F,Y){if(Y=Y||"",!F)return Y;x.checkSupport(F);var G=x.getTypeOf(Y);return q[G][F](Y)},x.resolve=function(F){for(var Y=F.split("/"),G=[],J=0;J<Y.length;J++){var z=Y[J];z==="."||z===""&&J!==0&&J!==Y.length-1||(z===".."?G.pop():G.push(z))}return G.join("/")},x.getTypeOf=function(F){return typeof F=="string"?"string":Object.prototype.toString.call(F)==="[object Array]"?"array":M.nodebuffer&&E.isBuffer(F)?"nodebuffer":M.uint8array&&F instanceof Uint8Array?"uint8array":M.arraybuffer&&F instanceof ArrayBuffer?"arraybuffer":void 0},x.checkSupport=function(F){if(!M[F.toLowerCase()])throw new Error(F+" is not supported by this platform")},x.MAX_VALUE_16BITS=65535,x.MAX_VALUE_32BITS=-1,x.pretty=function(F){var Y,G,J="";for(G=0;G<(F||"").length;G++)J+="\\x"+((Y=F.charCodeAt(G))<16?"0":"")+Y.toString(16).toUpperCase();return J},x.delay=function(F,Y,G){setImmediate(function(){F.apply(G||null,Y||[])})},x.inherits=function(F,Y){function G(){}G.prototype=Y.prototype,F.prototype=new G},x.extend=function(){var F,Y,G={};for(F=0;F<arguments.length;F++)for(Y in arguments[F])Object.prototype.hasOwnProperty.call(arguments[F],Y)&&G[Y]===void 0&&(G[Y]=arguments[F][Y]);return G},x.prepareContent=function(F,Y,G,J,z){return R.Promise.resolve(Y).then(function(te){return M.blob&&(te instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(te))!==-1)&&typeof FileReader!="undefined"?new R.Promise(function(V,de){var P=new FileReader;P.onload=function(p){V(p.target.result)},P.onerror=function(p){de(p.target.error)},P.readAsArrayBuffer(te)}):te}).then(function(te){var V=x.getTypeOf(te);return V?(V==="arraybuffer"?te=x.transformTo("uint8array",te):V==="string"&&(z?te=C.decode(te):G&&J!==!0&&(te=function(de){return T(de,M.uint8array?new Uint8Array(de.length):new Array(de.length))}(te))),te):R.Promise.reject(new Error("Can't read the data of '"+F+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(I,X,x){"use strict";var M=I("./reader/readerFor"),C=I("./utils"),E=I("./signature"),R=I("./zipEntry"),L=I("./support");function T(O){this.files=[],this.loadOptions=O}T.prototype={checkSignature:function(O){if(!this.reader.readAndCheckSignature(O)){this.reader.index-=4;var W=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+C.pretty(W)+", expected "+C.pretty(O)+")")}},isSignature:function(O,W){var D=this.reader.index;this.reader.setIndex(O);var q=this.reader.readString(4)===W;return this.reader.setIndex(D),q},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var O=this.reader.readData(this.zipCommentLength),W=L.uint8array?"uint8array":"array",D=C.transformTo(W,O);this.zipComment=this.loadOptions.decodeFileName(D)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var O,W,D,q=this.zip64EndOfCentralSize-44;0<q;)O=this.reader.readInt(2),W=this.reader.readInt(4),D=this.reader.readData(W),this.zip64ExtensibleData[O]={id:O,length:W,value:D}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var O,W;for(O=0;O<this.files.length;O++)W=this.files[O],this.reader.setIndex(W.localHeaderOffset),this.checkSignature(E.LOCAL_FILE_HEADER),W.readLocalPart(this.reader),W.handleUTF8(),W.processAttributes()},readCentralDir:function(){var O;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(E.CENTRAL_FILE_HEADER);)(O=new R({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(O);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var O=this.reader.lastIndexOfSignature(E.CENTRAL_DIRECTORY_END);if(O<0)throw this.isSignature(0,E.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(O);var W=O;if(this.checkSignature(E.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===C.MAX_VALUE_16BITS||this.diskWithCentralDirStart===C.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===C.MAX_VALUE_16BITS||this.centralDirRecords===C.MAX_VALUE_16BITS||this.centralDirSize===C.MAX_VALUE_32BITS||this.centralDirOffset===C.MAX_VALUE_32BITS){if(this.zip64=!0,(O=this.reader.lastIndexOfSignature(E.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(O),this.checkSignature(E.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,E.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(E.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(E.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var D=this.centralDirOffset+this.centralDirSize;this.zip64&&(D+=20,D+=12+this.zip64EndOfCentralSize);var q=W-D;if(0<q)this.isSignature(W,E.CENTRAL_FILE_HEADER)||(this.reader.zero=q);else if(q<0)throw new Error("Corrupted zip: missing "+Math.abs(q)+" bytes.")},prepareReader:function(O){this.reader=M(O)},load:function(O){this.prepareReader(O),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},X.exports=T},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(I,X,x){"use strict";var M=I("./reader/readerFor"),C=I("./utils"),E=I("./compressedObject"),R=I("./crc32"),L=I("./utf8"),T=I("./compressions"),O=I("./support");function W(D,q){this.options=D,this.loadOptions=q}W.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(D){var q,F;if(D.skip(22),this.fileNameLength=D.readInt(2),F=D.readInt(2),this.fileName=D.readData(this.fileNameLength),D.skip(F),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((q=function(Y){for(var G in T)if(Object.prototype.hasOwnProperty.call(T,G)&&T[G].magic===Y)return T[G];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+C.pretty(this.compressionMethod)+" unknown (inner file : "+C.transformTo("string",this.fileName)+")");this.decompressed=new E(this.compressedSize,this.uncompressedSize,this.crc32,q,D.readData(this.compressedSize))},readCentralPart:function(D){this.versionMadeBy=D.readInt(2),D.skip(2),this.bitFlag=D.readInt(2),this.compressionMethod=D.readString(2),this.date=D.readDate(),this.crc32=D.readInt(4),this.compressedSize=D.readInt(4),this.uncompressedSize=D.readInt(4);var q=D.readInt(2);if(this.extraFieldsLength=D.readInt(2),this.fileCommentLength=D.readInt(2),this.diskNumberStart=D.readInt(2),this.internalFileAttributes=D.readInt(2),this.externalFileAttributes=D.readInt(4),this.localHeaderOffset=D.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");D.skip(q),this.readExtraFields(D),this.parseZIP64ExtraField(D),this.fileComment=D.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var D=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),D==0&&(this.dosPermissions=63&this.externalFileAttributes),D==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var D=M(this.extraFields[1].value);this.uncompressedSize===C.MAX_VALUE_32BITS&&(this.uncompressedSize=D.readInt(8)),this.compressedSize===C.MAX_VALUE_32BITS&&(this.compressedSize=D.readInt(8)),this.localHeaderOffset===C.MAX_VALUE_32BITS&&(this.localHeaderOffset=D.readInt(8)),this.diskNumberStart===C.MAX_VALUE_32BITS&&(this.diskNumberStart=D.readInt(4))}},readExtraFields:function(D){var q,F,Y,G=D.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});D.index+4<G;)q=D.readInt(2),F=D.readInt(2),Y=D.readData(F),this.extraFields[q]={id:q,length:F,value:Y};D.setIndex(G)},handleUTF8:function(){var D=O.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=L.utf8decode(this.fileName),this.fileCommentStr=L.utf8decode(this.fileComment);else{var q=this.findExtraFieldUnicodePath();if(q!==null)this.fileNameStr=q;else{var F=C.transformTo(D,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(F)}var Y=this.findExtraFieldUnicodeComment();if(Y!==null)this.fileCommentStr=Y;else{var G=C.transformTo(D,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(G)}}},findExtraFieldUnicodePath:function(){var D=this.extraFields[28789];if(D){var q=M(D.value);return q.readInt(1)!==1||R(this.fileName)!==q.readInt(4)?null:L.utf8decode(q.readData(D.length-5))}return null},findExtraFieldUnicodeComment:function(){var D=this.extraFields[25461];if(D){var q=M(D.value);return q.readInt(1)!==1||R(this.fileComment)!==q.readInt(4)?null:L.utf8decode(q.readData(D.length-5))}return null}},X.exports=W},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(I,X,x){"use strict";function M(q,F,Y){this.name=q,this.dir=Y.dir,this.date=Y.date,this.comment=Y.comment,this.unixPermissions=Y.unixPermissions,this.dosPermissions=Y.dosPermissions,this._data=F,this._dataBinary=Y.binary,this.options={compression:Y.compression,compressionOptions:Y.compressionOptions}}var C=I("./stream/StreamHelper"),E=I("./stream/DataWorker"),R=I("./utf8"),L=I("./compressedObject"),T=I("./stream/GenericWorker");M.prototype={internalStream:function(q){var F=null,Y="string";try{if(!q)throw new Error("No output type specified.");var G=(Y=q.toLowerCase())==="string"||Y==="text";Y!=="binarystring"&&Y!=="text"||(Y="string"),F=this._decompressWorker();var J=!this._dataBinary;J&&!G&&(F=F.pipe(new R.Utf8EncodeWorker)),!J&&G&&(F=F.pipe(new R.Utf8DecodeWorker))}catch(z){(F=new T("error")).error(z)}return new C(F,Y,"")},async:function(q,F){return this.internalStream(q).accumulate(F)},nodeStream:function(q,F){return this.internalStream(q||"nodebuffer").toNodejsStream(F)},_compressWorker:function(q,F){if(this._data instanceof L&&this._data.compression.magic===q.magic)return this._data.getCompressedWorker();var Y=this._decompressWorker();return this._dataBinary||(Y=Y.pipe(new R.Utf8EncodeWorker)),L.createWorkerFrom(Y,q,F)},_decompressWorker:function(){return this._data instanceof L?this._data.getContentWorker():this._data instanceof T?this._data:new E(this._data)}};for(var O=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],W=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},D=0;D<O.length;D++)M.prototype[O[D]]=W;X.exports=M},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(I,X,x){(function(M){"use strict";var C,E,R=M.MutationObserver||M.WebKitMutationObserver;if(R){var L=0,T=new R(q),O=M.document.createTextNode("");T.observe(O,{characterData:!0}),C=function(){O.data=L=++L%2}}else if(M.setImmediate||M.MessageChannel===void 0)C="document"in M&&"onreadystatechange"in M.document.createElement("script")?function(){var F=M.document.createElement("script");F.onreadystatechange=function(){q(),F.onreadystatechange=null,F.parentNode.removeChild(F),F=null},M.document.documentElement.appendChild(F)}:function(){setTimeout(q,0)};else{var W=new M.MessageChannel;W.port1.onmessage=q,C=function(){W.port2.postMessage(0)}}var D=[];function q(){var F,Y;E=!0;for(var G=D.length;G;){for(Y=D,D=[],F=-1;++F<G;)Y[F]();G=D.length}E=!1}X.exports=function(F){D.push(F)!==1||E||C()}}).call(this,typeof ne.g!="undefined"?ne.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],37:[function(I,X,x){"use strict";var M=I("immediate");function C(){}var E={},R=["REJECTED"],L=["FULFILLED"],T=["PENDING"];function O(G){if(typeof G!="function")throw new TypeError("resolver must be a function");this.state=T,this.queue=[],this.outcome=void 0,G!==C&&F(this,G)}function W(G,J,z){this.promise=G,typeof J=="function"&&(this.onFulfilled=J,this.callFulfilled=this.otherCallFulfilled),typeof z=="function"&&(this.onRejected=z,this.callRejected=this.otherCallRejected)}function D(G,J,z){M(function(){var te;try{te=J(z)}catch(V){return E.reject(G,V)}te===G?E.reject(G,new TypeError("Cannot resolve promise with itself")):E.resolve(G,te)})}function q(G){var J=G&&G.then;if(G&&(typeof G=="object"||typeof G=="function")&&typeof J=="function")return function(){J.apply(G,arguments)}}function F(G,J){var z=!1;function te(P){z||(z=!0,E.reject(G,P))}function V(P){z||(z=!0,E.resolve(G,P))}var de=Y(function(){J(V,te)});de.status==="error"&&te(de.value)}function Y(G,J){var z={};try{z.value=G(J),z.status="success"}catch(te){z.status="error",z.value=te}return z}(X.exports=O).prototype.finally=function(G){if(typeof G!="function")return this;var J=this.constructor;return this.then(function(z){return J.resolve(G()).then(function(){return z})},function(z){return J.resolve(G()).then(function(){throw z})})},O.prototype.catch=function(G){return this.then(null,G)},O.prototype.then=function(G,J){if(typeof G!="function"&&this.state===L||typeof J!="function"&&this.state===R)return this;var z=new this.constructor(C);return this.state!==T?D(z,this.state===L?G:J,this.outcome):this.queue.push(new W(z,G,J)),z},W.prototype.callFulfilled=function(G){E.resolve(this.promise,G)},W.prototype.otherCallFulfilled=function(G){D(this.promise,this.onFulfilled,G)},W.prototype.callRejected=function(G){E.reject(this.promise,G)},W.prototype.otherCallRejected=function(G){D(this.promise,this.onRejected,G)},E.resolve=function(G,J){var z=Y(q,J);if(z.status==="error")return E.reject(G,z.value);var te=z.value;if(te)F(G,te);else{G.state=L,G.outcome=J;for(var V=-1,de=G.queue.length;++V<de;)G.queue[V].callFulfilled(J)}return G},E.reject=function(G,J){G.state=R,G.outcome=J;for(var z=-1,te=G.queue.length;++z<te;)G.queue[z].callRejected(J);return G},O.resolve=function(G){return G instanceof this?G:E.resolve(new this(C),G)},O.reject=function(G){var J=new this(C);return E.reject(J,G)},O.all=function(G){var J=this;if(Object.prototype.toString.call(G)!=="[object Array]")return this.reject(new TypeError("must be an array"));var z=G.length,te=!1;if(!z)return this.resolve([]);for(var V=new Array(z),de=0,P=-1,p=new this(C);++P<z;)K(G[P],P);return p;function K(me,pe){J.resolve(me).then(function(le){V[pe]=le,++de!==z||te||(te=!0,E.resolve(p,V))},function(le){te||(te=!0,E.reject(p,le))})}},O.race=function(G){var J=this;if(Object.prototype.toString.call(G)!=="[object Array]")return this.reject(new TypeError("must be an array"));var z=G.length,te=!1;if(!z)return this.resolve([]);for(var V=-1,de=new this(C);++V<z;)P=G[V],J.resolve(P).then(function(p){te||(te=!0,E.resolve(de,p))},function(p){te||(te=!0,E.reject(de,p))});var P;return de}},{immediate:36}],38:[function(I,X,x){"use strict";var M={};(0,I("./lib/utils/common").assign)(M,I("./lib/deflate"),I("./lib/inflate"),I("./lib/zlib/constants")),X.exports=M},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(I,X,x){"use strict";var M=I("./zlib/deflate"),C=I("./utils/common"),E=I("./utils/strings"),R=I("./zlib/messages"),L=I("./zlib/zstream"),T=Object.prototype.toString,O=0,W=-1,D=0,q=8;function F(G){if(!(this instanceof F))return new F(G);this.options=C.assign({level:W,method:q,chunkSize:16384,windowBits:15,memLevel:8,strategy:D,to:""},G||{});var J=this.options;J.raw&&0<J.windowBits?J.windowBits=-J.windowBits:J.gzip&&0<J.windowBits&&J.windowBits<16&&(J.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new L,this.strm.avail_out=0;var z=M.deflateInit2(this.strm,J.level,J.method,J.windowBits,J.memLevel,J.strategy);if(z!==O)throw new Error(R[z]);if(J.header&&M.deflateSetHeader(this.strm,J.header),J.dictionary){var te;if(te=typeof J.dictionary=="string"?E.string2buf(J.dictionary):T.call(J.dictionary)==="[object ArrayBuffer]"?new Uint8Array(J.dictionary):J.dictionary,(z=M.deflateSetDictionary(this.strm,te))!==O)throw new Error(R[z]);this._dict_set=!0}}function Y(G,J){var z=new F(J);if(z.push(G,!0),z.err)throw z.msg||R[z.err];return z.result}F.prototype.push=function(G,J){var z,te,V=this.strm,de=this.options.chunkSize;if(this.ended)return!1;te=J===~~J?J:J===!0?4:0,typeof G=="string"?V.input=E.string2buf(G):T.call(G)==="[object ArrayBuffer]"?V.input=new Uint8Array(G):V.input=G,V.next_in=0,V.avail_in=V.input.length;do{if(V.avail_out===0&&(V.output=new C.Buf8(de),V.next_out=0,V.avail_out=de),(z=M.deflate(V,te))!==1&&z!==O)return this.onEnd(z),!(this.ended=!0);V.avail_out!==0&&(V.avail_in!==0||te!==4&&te!==2)||(this.options.to==="string"?this.onData(E.buf2binstring(C.shrinkBuf(V.output,V.next_out))):this.onData(C.shrinkBuf(V.output,V.next_out)))}while((0<V.avail_in||V.avail_out===0)&&z!==1);return te===4?(z=M.deflateEnd(this.strm),this.onEnd(z),this.ended=!0,z===O):te!==2||(this.onEnd(O),!(V.avail_out=0))},F.prototype.onData=function(G){this.chunks.push(G)},F.prototype.onEnd=function(G){G===O&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=C.flattenChunks(this.chunks)),this.chunks=[],this.err=G,this.msg=this.strm.msg},x.Deflate=F,x.deflate=Y,x.deflateRaw=function(G,J){return(J=J||{}).raw=!0,Y(G,J)},x.gzip=function(G,J){return(J=J||{}).gzip=!0,Y(G,J)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(I,X,x){"use strict";var M=I("./zlib/inflate"),C=I("./utils/common"),E=I("./utils/strings"),R=I("./zlib/constants"),L=I("./zlib/messages"),T=I("./zlib/zstream"),O=I("./zlib/gzheader"),W=Object.prototype.toString;function D(F){if(!(this instanceof D))return new D(F);this.options=C.assign({chunkSize:16384,windowBits:0,to:""},F||{});var Y=this.options;Y.raw&&0<=Y.windowBits&&Y.windowBits<16&&(Y.windowBits=-Y.windowBits,Y.windowBits===0&&(Y.windowBits=-15)),!(0<=Y.windowBits&&Y.windowBits<16)||F&&F.windowBits||(Y.windowBits+=32),15<Y.windowBits&&Y.windowBits<48&&!(15&Y.windowBits)&&(Y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new T,this.strm.avail_out=0;var G=M.inflateInit2(this.strm,Y.windowBits);if(G!==R.Z_OK)throw new Error(L[G]);this.header=new O,M.inflateGetHeader(this.strm,this.header)}function q(F,Y){var G=new D(Y);if(G.push(F,!0),G.err)throw G.msg||L[G.err];return G.result}D.prototype.push=function(F,Y){var G,J,z,te,V,de,P=this.strm,p=this.options.chunkSize,K=this.options.dictionary,me=!1;if(this.ended)return!1;J=Y===~~Y?Y:Y===!0?R.Z_FINISH:R.Z_NO_FLUSH,typeof F=="string"?P.input=E.binstring2buf(F):W.call(F)==="[object ArrayBuffer]"?P.input=new Uint8Array(F):P.input=F,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new C.Buf8(p),P.next_out=0,P.avail_out=p),(G=M.inflate(P,R.Z_NO_FLUSH))===R.Z_NEED_DICT&&K&&(de=typeof K=="string"?E.string2buf(K):W.call(K)==="[object ArrayBuffer]"?new Uint8Array(K):K,G=M.inflateSetDictionary(this.strm,de)),G===R.Z_BUF_ERROR&&me===!0&&(G=R.Z_OK,me=!1),G!==R.Z_STREAM_END&&G!==R.Z_OK)return this.onEnd(G),!(this.ended=!0);P.next_out&&(P.avail_out!==0&&G!==R.Z_STREAM_END&&(P.avail_in!==0||J!==R.Z_FINISH&&J!==R.Z_SYNC_FLUSH)||(this.options.to==="string"?(z=E.utf8border(P.output,P.next_out),te=P.next_out-z,V=E.buf2string(P.output,z),P.next_out=te,P.avail_out=p-te,te&&C.arraySet(P.output,P.output,z,te,0),this.onData(V)):this.onData(C.shrinkBuf(P.output,P.next_out)))),P.avail_in===0&&P.avail_out===0&&(me=!0)}while((0<P.avail_in||P.avail_out===0)&&G!==R.Z_STREAM_END);return G===R.Z_STREAM_END&&(J=R.Z_FINISH),J===R.Z_FINISH?(G=M.inflateEnd(this.strm),this.onEnd(G),this.ended=!0,G===R.Z_OK):J!==R.Z_SYNC_FLUSH||(this.onEnd(R.Z_OK),!(P.avail_out=0))},D.prototype.onData=function(F){this.chunks.push(F)},D.prototype.onEnd=function(F){F===R.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=C.flattenChunks(this.chunks)),this.chunks=[],this.err=F,this.msg=this.strm.msg},x.Inflate=D,x.inflate=q,x.inflateRaw=function(F,Y){return(Y=Y||{}).raw=!0,q(F,Y)},x.ungzip=q},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(I,X,x){"use strict";var M=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";x.assign=function(R){for(var L=Array.prototype.slice.call(arguments,1);L.length;){var T=L.shift();if(T){if(typeof T!="object")throw new TypeError(T+"must be non-object");for(var O in T)T.hasOwnProperty(O)&&(R[O]=T[O])}}return R},x.shrinkBuf=function(R,L){return R.length===L?R:R.subarray?R.subarray(0,L):(R.length=L,R)};var C={arraySet:function(R,L,T,O,W){if(L.subarray&&R.subarray)R.set(L.subarray(T,T+O),W);else for(var D=0;D<O;D++)R[W+D]=L[T+D]},flattenChunks:function(R){var L,T,O,W,D,q;for(L=O=0,T=R.length;L<T;L++)O+=R[L].length;for(q=new Uint8Array(O),L=W=0,T=R.length;L<T;L++)D=R[L],q.set(D,W),W+=D.length;return q}},E={arraySet:function(R,L,T,O,W){for(var D=0;D<O;D++)R[W+D]=L[T+D]},flattenChunks:function(R){return[].concat.apply([],R)}};x.setTyped=function(R){R?(x.Buf8=Uint8Array,x.Buf16=Uint16Array,x.Buf32=Int32Array,x.assign(x,C)):(x.Buf8=Array,x.Buf16=Array,x.Buf32=Array,x.assign(x,E))},x.setTyped(M)},{}],42:[function(I,X,x){"use strict";var M=I("./common"),C=!0,E=!0;try{String.fromCharCode.apply(null,[0])}catch(O){C=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(O){E=!1}for(var R=new M.Buf8(256),L=0;L<256;L++)R[L]=252<=L?6:248<=L?5:240<=L?4:224<=L?3:192<=L?2:1;function T(O,W){if(W<65537&&(O.subarray&&E||!O.subarray&&C))return String.fromCharCode.apply(null,M.shrinkBuf(O,W));for(var D="",q=0;q<W;q++)D+=String.fromCharCode(O[q]);return D}R[254]=R[254]=1,x.string2buf=function(O){var W,D,q,F,Y,G=O.length,J=0;for(F=0;F<G;F++)(64512&(D=O.charCodeAt(F)))==55296&&F+1<G&&(64512&(q=O.charCodeAt(F+1)))==56320&&(D=65536+(D-55296<<10)+(q-56320),F++),J+=D<128?1:D<2048?2:D<65536?3:4;for(W=new M.Buf8(J),F=Y=0;Y<J;F++)(64512&(D=O.charCodeAt(F)))==55296&&F+1<G&&(64512&(q=O.charCodeAt(F+1)))==56320&&(D=65536+(D-55296<<10)+(q-56320),F++),D<128?W[Y++]=D:(D<2048?W[Y++]=192|D>>>6:(D<65536?W[Y++]=224|D>>>12:(W[Y++]=240|D>>>18,W[Y++]=128|D>>>12&63),W[Y++]=128|D>>>6&63),W[Y++]=128|63&D);return W},x.buf2binstring=function(O){return T(O,O.length)},x.binstring2buf=function(O){for(var W=new M.Buf8(O.length),D=0,q=W.length;D<q;D++)W[D]=O.charCodeAt(D);return W},x.buf2string=function(O,W){var D,q,F,Y,G=W||O.length,J=new Array(2*G);for(D=q=0;D<G;)if((F=O[D++])<128)J[q++]=F;else if(4<(Y=R[F]))J[q++]=65533,D+=Y-1;else{for(F&=Y===2?31:Y===3?15:7;1<Y&&D<G;)F=F<<6|63&O[D++],Y--;1<Y?J[q++]=65533:F<65536?J[q++]=F:(F-=65536,J[q++]=55296|F>>10&1023,J[q++]=56320|1023&F)}return T(J,q)},x.utf8border=function(O,W){var D;for((W=W||O.length)>O.length&&(W=O.length),D=W-1;0<=D&&(192&O[D])==128;)D--;return D<0||D===0?W:D+R[O[D]]>W?D:W}},{"./common":41}],43:[function(I,X,x){"use strict";X.exports=function(M,C,E,R){for(var L=65535&M|0,T=M>>>16&65535|0,O=0;E!==0;){for(E-=O=2e3<E?2e3:E;T=T+(L=L+C[R++]|0)|0,--O;);L%=65521,T%=65521}return L|T<<16|0}},{}],44:[function(I,X,x){"use strict";X.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(I,X,x){"use strict";var M=function(){for(var C,E=[],R=0;R<256;R++){C=R;for(var L=0;L<8;L++)C=1&C?3988292384^C>>>1:C>>>1;E[R]=C}return E}();X.exports=function(C,E,R,L){var T=M,O=L+R;C^=-1;for(var W=L;W<O;W++)C=C>>>8^T[255&(C^E[W])];return-1^C}},{}],46:[function(I,X,x){"use strict";var M,C=I("../utils/common"),E=I("./trees"),R=I("./adler32"),L=I("./crc32"),T=I("./messages"),O=0,W=4,D=0,q=-2,F=-1,Y=4,G=2,J=8,z=9,te=286,V=30,de=19,P=2*te+1,p=15,K=3,me=258,pe=me+K+1,le=42,ue=113,A=1,N=2,oe=3,ge=4;function ve(Q,ot){return Q.msg=T[ot],ot}function ke(Q){return(Q<<1)-(4<Q?9:0)}function Ye(Q){for(var ot=Q.length;0<=--ot;)Q[ot]=0}function Le(Q){var ot=Q.state,gt=ot.pending;gt>Q.avail_out&&(gt=Q.avail_out),gt!==0&&(C.arraySet(Q.output,ot.pending_buf,ot.pending_out,gt,Q.next_out),Q.next_out+=gt,ot.pending_out+=gt,Q.total_out+=gt,Q.avail_out-=gt,ot.pending-=gt,ot.pending===0&&(ot.pending_out=0))}function Fe(Q,ot){E._tr_flush_block(Q,0<=Q.block_start?Q.block_start:-1,Q.strstart-Q.block_start,ot),Q.block_start=Q.strstart,Le(Q.strm)}function st(Q,ot){Q.pending_buf[Q.pending++]=ot}function Ee(Q,ot){Q.pending_buf[Q.pending++]=ot>>>8&255,Q.pending_buf[Q.pending++]=255&ot}function pt(Q,ot){var gt,ye,_e=Q.max_chain_length,$e=Q.strstart,mt=Q.prev_length,yt=Q.nice_match,nt=Q.strstart>Q.w_size-pe?Q.strstart-(Q.w_size-pe):0,ut=Q.window,kt=Q.w_mask,Ne=Q.prev,je=Q.strstart+me,ct=ut[$e+mt-1],Tt=ut[$e+mt];Q.prev_length>=Q.good_match&&(_e>>=2),yt>Q.lookahead&&(yt=Q.lookahead);do if(ut[(gt=ot)+mt]===Tt&&ut[gt+mt-1]===ct&&ut[gt]===ut[$e]&&ut[++gt]===ut[$e+1]){$e+=2,gt++;do;while(ut[++$e]===ut[++gt]&&ut[++$e]===ut[++gt]&&ut[++$e]===ut[++gt]&&ut[++$e]===ut[++gt]&&ut[++$e]===ut[++gt]&&ut[++$e]===ut[++gt]&&ut[++$e]===ut[++gt]&&ut[++$e]===ut[++gt]&&$e<je);if(ye=me-(je-$e),$e=je-me,mt<ye){if(Q.match_start=ot,yt<=(mt=ye))break;ct=ut[$e+mt-1],Tt=ut[$e+mt]}}while((ot=Ne[ot&kt])>nt&&--_e!=0);return mt<=Q.lookahead?mt:Q.lookahead}function $t(Q){var ot,gt,ye,_e,$e,mt,yt,nt,ut,kt,Ne=Q.w_size;do{if(_e=Q.window_size-Q.lookahead-Q.strstart,Q.strstart>=Ne+(Ne-pe)){for(C.arraySet(Q.window,Q.window,Ne,Ne,0),Q.match_start-=Ne,Q.strstart-=Ne,Q.block_start-=Ne,ot=gt=Q.hash_size;ye=Q.head[--ot],Q.head[ot]=Ne<=ye?ye-Ne:0,--gt;);for(ot=gt=Ne;ye=Q.prev[--ot],Q.prev[ot]=Ne<=ye?ye-Ne:0,--gt;);_e+=Ne}if(Q.strm.avail_in===0)break;if(mt=Q.strm,yt=Q.window,nt=Q.strstart+Q.lookahead,ut=_e,kt=void 0,kt=mt.avail_in,ut<kt&&(kt=ut),gt=kt===0?0:(mt.avail_in-=kt,C.arraySet(yt,mt.input,mt.next_in,kt,nt),mt.state.wrap===1?mt.adler=R(mt.adler,yt,kt,nt):mt.state.wrap===2&&(mt.adler=L(mt.adler,yt,kt,nt)),mt.next_in+=kt,mt.total_in+=kt,kt),Q.lookahead+=gt,Q.lookahead+Q.insert>=K)for($e=Q.strstart-Q.insert,Q.ins_h=Q.window[$e],Q.ins_h=(Q.ins_h<<Q.hash_shift^Q.window[$e+1])&Q.hash_mask;Q.insert&&(Q.ins_h=(Q.ins_h<<Q.hash_shift^Q.window[$e+K-1])&Q.hash_mask,Q.prev[$e&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=$e,$e++,Q.insert--,!(Q.lookahead+Q.insert<K)););}while(Q.lookahead<pe&&Q.strm.avail_in!==0)}function It(Q,ot){for(var gt,ye;;){if(Q.lookahead<pe){if($t(Q),Q.lookahead<pe&&ot===O)return A;if(Q.lookahead===0)break}if(gt=0,Q.lookahead>=K&&(Q.ins_h=(Q.ins_h<<Q.hash_shift^Q.window[Q.strstart+K-1])&Q.hash_mask,gt=Q.prev[Q.strstart&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=Q.strstart),gt!==0&&Q.strstart-gt<=Q.w_size-pe&&(Q.match_length=pt(Q,gt)),Q.match_length>=K)if(ye=E._tr_tally(Q,Q.strstart-Q.match_start,Q.match_length-K),Q.lookahead-=Q.match_length,Q.match_length<=Q.max_lazy_match&&Q.lookahead>=K){for(Q.match_length--;Q.strstart++,Q.ins_h=(Q.ins_h<<Q.hash_shift^Q.window[Q.strstart+K-1])&Q.hash_mask,gt=Q.prev[Q.strstart&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=Q.strstart,--Q.match_length!=0;);Q.strstart++}else Q.strstart+=Q.match_length,Q.match_length=0,Q.ins_h=Q.window[Q.strstart],Q.ins_h=(Q.ins_h<<Q.hash_shift^Q.window[Q.strstart+1])&Q.hash_mask;else ye=E._tr_tally(Q,0,Q.window[Q.strstart]),Q.lookahead--,Q.strstart++;if(ye&&(Fe(Q,!1),Q.strm.avail_out===0))return A}return Q.insert=Q.strstart<K-1?Q.strstart:K-1,ot===W?(Fe(Q,!0),Q.strm.avail_out===0?oe:ge):Q.last_lit&&(Fe(Q,!1),Q.strm.avail_out===0)?A:N}function _t(Q,ot){for(var gt,ye,_e;;){if(Q.lookahead<pe){if($t(Q),Q.lookahead<pe&&ot===O)return A;if(Q.lookahead===0)break}if(gt=0,Q.lookahead>=K&&(Q.ins_h=(Q.ins_h<<Q.hash_shift^Q.window[Q.strstart+K-1])&Q.hash_mask,gt=Q.prev[Q.strstart&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=Q.strstart),Q.prev_length=Q.match_length,Q.prev_match=Q.match_start,Q.match_length=K-1,gt!==0&&Q.prev_length<Q.max_lazy_match&&Q.strstart-gt<=Q.w_size-pe&&(Q.match_length=pt(Q,gt),Q.match_length<=5&&(Q.strategy===1||Q.match_length===K&&4096<Q.strstart-Q.match_start)&&(Q.match_length=K-1)),Q.prev_length>=K&&Q.match_length<=Q.prev_length){for(_e=Q.strstart+Q.lookahead-K,ye=E._tr_tally(Q,Q.strstart-1-Q.prev_match,Q.prev_length-K),Q.lookahead-=Q.prev_length-1,Q.prev_length-=2;++Q.strstart<=_e&&(Q.ins_h=(Q.ins_h<<Q.hash_shift^Q.window[Q.strstart+K-1])&Q.hash_mask,gt=Q.prev[Q.strstart&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=Q.strstart),--Q.prev_length!=0;);if(Q.match_available=0,Q.match_length=K-1,Q.strstart++,ye&&(Fe(Q,!1),Q.strm.avail_out===0))return A}else if(Q.match_available){if((ye=E._tr_tally(Q,0,Q.window[Q.strstart-1]))&&Fe(Q,!1),Q.strstart++,Q.lookahead--,Q.strm.avail_out===0)return A}else Q.match_available=1,Q.strstart++,Q.lookahead--}return Q.match_available&&(ye=E._tr_tally(Q,0,Q.window[Q.strstart-1]),Q.match_available=0),Q.insert=Q.strstart<K-1?Q.strstart:K-1,ot===W?(Fe(Q,!0),Q.strm.avail_out===0?oe:ge):Q.last_lit&&(Fe(Q,!1),Q.strm.avail_out===0)?A:N}function jt(Q,ot,gt,ye,_e){this.good_length=Q,this.max_lazy=ot,this.nice_length=gt,this.max_chain=ye,this.func=_e}function zt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=J,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new C.Buf16(2*P),this.dyn_dtree=new C.Buf16(2*(2*V+1)),this.bl_tree=new C.Buf16(2*(2*de+1)),Ye(this.dyn_ltree),Ye(this.dyn_dtree),Ye(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new C.Buf16(p+1),this.heap=new C.Buf16(2*te+1),Ye(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new C.Buf16(2*te+1),Ye(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function mn(Q){var ot;return Q&&Q.state?(Q.total_in=Q.total_out=0,Q.data_type=G,(ot=Q.state).pending=0,ot.pending_out=0,ot.wrap<0&&(ot.wrap=-ot.wrap),ot.status=ot.wrap?le:ue,Q.adler=ot.wrap===2?0:1,ot.last_flush=O,E._tr_init(ot),D):ve(Q,q)}function Qn(Q){var ot=mn(Q);return ot===D&&function(gt){gt.window_size=2*gt.w_size,Ye(gt.head),gt.max_lazy_match=M[gt.level].max_lazy,gt.good_match=M[gt.level].good_length,gt.nice_match=M[gt.level].nice_length,gt.max_chain_length=M[gt.level].max_chain,gt.strstart=0,gt.block_start=0,gt.lookahead=0,gt.insert=0,gt.match_length=gt.prev_length=K-1,gt.match_available=0,gt.ins_h=0}(Q.state),ot}function En(Q,ot,gt,ye,_e,$e){if(!Q)return q;var mt=1;if(ot===F&&(ot=6),ye<0?(mt=0,ye=-ye):15<ye&&(mt=2,ye-=16),_e<1||z<_e||gt!==J||ye<8||15<ye||ot<0||9<ot||$e<0||Y<$e)return ve(Q,q);ye===8&&(ye=9);var yt=new zt;return(Q.state=yt).strm=Q,yt.wrap=mt,yt.gzhead=null,yt.w_bits=ye,yt.w_size=1<<yt.w_bits,yt.w_mask=yt.w_size-1,yt.hash_bits=_e+7,yt.hash_size=1<<yt.hash_bits,yt.hash_mask=yt.hash_size-1,yt.hash_shift=~~((yt.hash_bits+K-1)/K),yt.window=new C.Buf8(2*yt.w_size),yt.head=new C.Buf16(yt.hash_size),yt.prev=new C.Buf16(yt.w_size),yt.lit_bufsize=1<<_e+6,yt.pending_buf_size=4*yt.lit_bufsize,yt.pending_buf=new C.Buf8(yt.pending_buf_size),yt.d_buf=1*yt.lit_bufsize,yt.l_buf=3*yt.lit_bufsize,yt.level=ot,yt.strategy=$e,yt.method=gt,Qn(Q)}M=[new jt(0,0,0,0,function(Q,ot){var gt=65535;for(gt>Q.pending_buf_size-5&&(gt=Q.pending_buf_size-5);;){if(Q.lookahead<=1){if($t(Q),Q.lookahead===0&&ot===O)return A;if(Q.lookahead===0)break}Q.strstart+=Q.lookahead,Q.lookahead=0;var ye=Q.block_start+gt;if((Q.strstart===0||Q.strstart>=ye)&&(Q.lookahead=Q.strstart-ye,Q.strstart=ye,Fe(Q,!1),Q.strm.avail_out===0)||Q.strstart-Q.block_start>=Q.w_size-pe&&(Fe(Q,!1),Q.strm.avail_out===0))return A}return Q.insert=0,ot===W?(Fe(Q,!0),Q.strm.avail_out===0?oe:ge):(Q.strstart>Q.block_start&&(Fe(Q,!1),Q.strm.avail_out),A)}),new jt(4,4,8,4,It),new jt(4,5,16,8,It),new jt(4,6,32,32,It),new jt(4,4,16,16,_t),new jt(8,16,32,32,_t),new jt(8,16,128,128,_t),new jt(8,32,128,256,_t),new jt(32,128,258,1024,_t),new jt(32,258,258,4096,_t)],x.deflateInit=function(Q,ot){return En(Q,ot,J,15,8,0)},x.deflateInit2=En,x.deflateReset=Qn,x.deflateResetKeep=mn,x.deflateSetHeader=function(Q,ot){return Q&&Q.state?Q.state.wrap!==2?q:(Q.state.gzhead=ot,D):q},x.deflate=function(Q,ot){var gt,ye,_e,$e;if(!Q||!Q.state||5<ot||ot<0)return Q?ve(Q,q):q;if(ye=Q.state,!Q.output||!Q.input&&Q.avail_in!==0||ye.status===666&&ot!==W)return ve(Q,Q.avail_out===0?-5:q);if(ye.strm=Q,gt=ye.last_flush,ye.last_flush=ot,ye.status===le)if(ye.wrap===2)Q.adler=0,st(ye,31),st(ye,139),st(ye,8),ye.gzhead?(st(ye,(ye.gzhead.text?1:0)+(ye.gzhead.hcrc?2:0)+(ye.gzhead.extra?4:0)+(ye.gzhead.name?8:0)+(ye.gzhead.comment?16:0)),st(ye,255&ye.gzhead.time),st(ye,ye.gzhead.time>>8&255),st(ye,ye.gzhead.time>>16&255),st(ye,ye.gzhead.time>>24&255),st(ye,ye.level===9?2:2<=ye.strategy||ye.level<2?4:0),st(ye,255&ye.gzhead.os),ye.gzhead.extra&&ye.gzhead.extra.length&&(st(ye,255&ye.gzhead.extra.length),st(ye,ye.gzhead.extra.length>>8&255)),ye.gzhead.hcrc&&(Q.adler=L(Q.adler,ye.pending_buf,ye.pending,0)),ye.gzindex=0,ye.status=69):(st(ye,0),st(ye,0),st(ye,0),st(ye,0),st(ye,0),st(ye,ye.level===9?2:2<=ye.strategy||ye.level<2?4:0),st(ye,3),ye.status=ue);else{var mt=J+(ye.w_bits-8<<4)<<8;mt|=(2<=ye.strategy||ye.level<2?0:ye.level<6?1:ye.level===6?2:3)<<6,ye.strstart!==0&&(mt|=32),mt+=31-mt%31,ye.status=ue,Ee(ye,mt),ye.strstart!==0&&(Ee(ye,Q.adler>>>16),Ee(ye,65535&Q.adler)),Q.adler=1}if(ye.status===69)if(ye.gzhead.extra){for(_e=ye.pending;ye.gzindex<(65535&ye.gzhead.extra.length)&&(ye.pending!==ye.pending_buf_size||(ye.gzhead.hcrc&&ye.pending>_e&&(Q.adler=L(Q.adler,ye.pending_buf,ye.pending-_e,_e)),Le(Q),_e=ye.pending,ye.pending!==ye.pending_buf_size));)st(ye,255&ye.gzhead.extra[ye.gzindex]),ye.gzindex++;ye.gzhead.hcrc&&ye.pending>_e&&(Q.adler=L(Q.adler,ye.pending_buf,ye.pending-_e,_e)),ye.gzindex===ye.gzhead.extra.length&&(ye.gzindex=0,ye.status=73)}else ye.status=73;if(ye.status===73)if(ye.gzhead.name){_e=ye.pending;do{if(ye.pending===ye.pending_buf_size&&(ye.gzhead.hcrc&&ye.pending>_e&&(Q.adler=L(Q.adler,ye.pending_buf,ye.pending-_e,_e)),Le(Q),_e=ye.pending,ye.pending===ye.pending_buf_size)){$e=1;break}$e=ye.gzindex<ye.gzhead.name.length?255&ye.gzhead.name.charCodeAt(ye.gzindex++):0,st(ye,$e)}while($e!==0);ye.gzhead.hcrc&&ye.pending>_e&&(Q.adler=L(Q.adler,ye.pending_buf,ye.pending-_e,_e)),$e===0&&(ye.gzindex=0,ye.status=91)}else ye.status=91;if(ye.status===91)if(ye.gzhead.comment){_e=ye.pending;do{if(ye.pending===ye.pending_buf_size&&(ye.gzhead.hcrc&&ye.pending>_e&&(Q.adler=L(Q.adler,ye.pending_buf,ye.pending-_e,_e)),Le(Q),_e=ye.pending,ye.pending===ye.pending_buf_size)){$e=1;break}$e=ye.gzindex<ye.gzhead.comment.length?255&ye.gzhead.comment.charCodeAt(ye.gzindex++):0,st(ye,$e)}while($e!==0);ye.gzhead.hcrc&&ye.pending>_e&&(Q.adler=L(Q.adler,ye.pending_buf,ye.pending-_e,_e)),$e===0&&(ye.status=103)}else ye.status=103;if(ye.status===103&&(ye.gzhead.hcrc?(ye.pending+2>ye.pending_buf_size&&Le(Q),ye.pending+2<=ye.pending_buf_size&&(st(ye,255&Q.adler),st(ye,Q.adler>>8&255),Q.adler=0,ye.status=ue)):ye.status=ue),ye.pending!==0){if(Le(Q),Q.avail_out===0)return ye.last_flush=-1,D}else if(Q.avail_in===0&&ke(ot)<=ke(gt)&&ot!==W)return ve(Q,-5);if(ye.status===666&&Q.avail_in!==0)return ve(Q,-5);if(Q.avail_in!==0||ye.lookahead!==0||ot!==O&&ye.status!==666){var yt=ye.strategy===2?function(nt,ut){for(var kt;;){if(nt.lookahead===0&&($t(nt),nt.lookahead===0)){if(ut===O)return A;break}if(nt.match_length=0,kt=E._tr_tally(nt,0,nt.window[nt.strstart]),nt.lookahead--,nt.strstart++,kt&&(Fe(nt,!1),nt.strm.avail_out===0))return A}return nt.insert=0,ut===W?(Fe(nt,!0),nt.strm.avail_out===0?oe:ge):nt.last_lit&&(Fe(nt,!1),nt.strm.avail_out===0)?A:N}(ye,ot):ye.strategy===3?function(nt,ut){for(var kt,Ne,je,ct,Tt=nt.window;;){if(nt.lookahead<=me){if($t(nt),nt.lookahead<=me&&ut===O)return A;if(nt.lookahead===0)break}if(nt.match_length=0,nt.lookahead>=K&&0<nt.strstart&&(Ne=Tt[je=nt.strstart-1])===Tt[++je]&&Ne===Tt[++je]&&Ne===Tt[++je]){ct=nt.strstart+me;do;while(Ne===Tt[++je]&&Ne===Tt[++je]&&Ne===Tt[++je]&&Ne===Tt[++je]&&Ne===Tt[++je]&&Ne===Tt[++je]&&Ne===Tt[++je]&&Ne===Tt[++je]&&je<ct);nt.match_length=me-(ct-je),nt.match_length>nt.lookahead&&(nt.match_length=nt.lookahead)}if(nt.match_length>=K?(kt=E._tr_tally(nt,1,nt.match_length-K),nt.lookahead-=nt.match_length,nt.strstart+=nt.match_length,nt.match_length=0):(kt=E._tr_tally(nt,0,nt.window[nt.strstart]),nt.lookahead--,nt.strstart++),kt&&(Fe(nt,!1),nt.strm.avail_out===0))return A}return nt.insert=0,ut===W?(Fe(nt,!0),nt.strm.avail_out===0?oe:ge):nt.last_lit&&(Fe(nt,!1),nt.strm.avail_out===0)?A:N}(ye,ot):M[ye.level].func(ye,ot);if(yt!==oe&&yt!==ge||(ye.status=666),yt===A||yt===oe)return Q.avail_out===0&&(ye.last_flush=-1),D;if(yt===N&&(ot===1?E._tr_align(ye):ot!==5&&(E._tr_stored_block(ye,0,0,!1),ot===3&&(Ye(ye.head),ye.lookahead===0&&(ye.strstart=0,ye.block_start=0,ye.insert=0))),Le(Q),Q.avail_out===0))return ye.last_flush=-1,D}return ot!==W?D:ye.wrap<=0?1:(ye.wrap===2?(st(ye,255&Q.adler),st(ye,Q.adler>>8&255),st(ye,Q.adler>>16&255),st(ye,Q.adler>>24&255),st(ye,255&Q.total_in),st(ye,Q.total_in>>8&255),st(ye,Q.total_in>>16&255),st(ye,Q.total_in>>24&255)):(Ee(ye,Q.adler>>>16),Ee(ye,65535&Q.adler)),Le(Q),0<ye.wrap&&(ye.wrap=-ye.wrap),ye.pending!==0?D:1)},x.deflateEnd=function(Q){var ot;return Q&&Q.state?(ot=Q.state.status)!==le&&ot!==69&&ot!==73&&ot!==91&&ot!==103&&ot!==ue&&ot!==666?ve(Q,q):(Q.state=null,ot===ue?ve(Q,-3):D):q},x.deflateSetDictionary=function(Q,ot){var gt,ye,_e,$e,mt,yt,nt,ut,kt=ot.length;if(!Q||!Q.state||($e=(gt=Q.state).wrap)===2||$e===1&&gt.status!==le||gt.lookahead)return q;for($e===1&&(Q.adler=R(Q.adler,ot,kt,0)),gt.wrap=0,kt>=gt.w_size&&($e===0&&(Ye(gt.head),gt.strstart=0,gt.block_start=0,gt.insert=0),ut=new C.Buf8(gt.w_size),C.arraySet(ut,ot,kt-gt.w_size,gt.w_size,0),ot=ut,kt=gt.w_size),mt=Q.avail_in,yt=Q.next_in,nt=Q.input,Q.avail_in=kt,Q.next_in=0,Q.input=ot,$t(gt);gt.lookahead>=K;){for(ye=gt.strstart,_e=gt.lookahead-(K-1);gt.ins_h=(gt.ins_h<<gt.hash_shift^gt.window[ye+K-1])&gt.hash_mask,gt.prev[ye&gt.w_mask]=gt.head[gt.ins_h],gt.head[gt.ins_h]=ye,ye++,--_e;);gt.strstart=ye,gt.lookahead=K-1,$t(gt)}return gt.strstart+=gt.lookahead,gt.block_start=gt.strstart,gt.insert=gt.lookahead,gt.lookahead=0,gt.match_length=gt.prev_length=K-1,gt.match_available=0,Q.next_in=yt,Q.input=nt,Q.avail_in=mt,gt.wrap=$e,D},x.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(I,X,x){"use strict";X.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(I,X,x){"use strict";X.exports=function(M,C){var E,R,L,T,O,W,D,q,F,Y,G,J,z,te,V,de,P,p,K,me,pe,le,ue,A,N;E=M.state,R=M.next_in,A=M.input,L=R+(M.avail_in-5),T=M.next_out,N=M.output,O=T-(C-M.avail_out),W=T+(M.avail_out-257),D=E.dmax,q=E.wsize,F=E.whave,Y=E.wnext,G=E.window,J=E.hold,z=E.bits,te=E.lencode,V=E.distcode,de=(1<<E.lenbits)-1,P=(1<<E.distbits)-1;e:do{z<15&&(J+=A[R++]<<z,z+=8,J+=A[R++]<<z,z+=8),p=te[J&de];t:for(;;){if(J>>>=K=p>>>24,z-=K,(K=p>>>16&255)===0)N[T++]=65535&p;else{if(!(16&K)){if(!(64&K)){p=te[(65535&p)+(J&(1<<K)-1)];continue t}if(32&K){E.mode=12;break e}M.msg="invalid literal/length code",E.mode=30;break e}me=65535&p,(K&=15)&&(z<K&&(J+=A[R++]<<z,z+=8),me+=J&(1<<K)-1,J>>>=K,z-=K),z<15&&(J+=A[R++]<<z,z+=8,J+=A[R++]<<z,z+=8),p=V[J&P];n:for(;;){if(J>>>=K=p>>>24,z-=K,!(16&(K=p>>>16&255))){if(!(64&K)){p=V[(65535&p)+(J&(1<<K)-1)];continue n}M.msg="invalid distance code",E.mode=30;break e}if(pe=65535&p,z<(K&=15)&&(J+=A[R++]<<z,(z+=8)<K&&(J+=A[R++]<<z,z+=8)),D<(pe+=J&(1<<K)-1)){M.msg="invalid distance too far back",E.mode=30;break e}if(J>>>=K,z-=K,(K=T-O)<pe){if(F<(K=pe-K)&&E.sane){M.msg="invalid distance too far back",E.mode=30;break e}if(ue=G,(le=0)===Y){if(le+=q-K,K<me){for(me-=K;N[T++]=G[le++],--K;);le=T-pe,ue=N}}else if(Y<K){if(le+=q+Y-K,(K-=Y)<me){for(me-=K;N[T++]=G[le++],--K;);if(le=0,Y<me){for(me-=K=Y;N[T++]=G[le++],--K;);le=T-pe,ue=N}}}else if(le+=Y-K,K<me){for(me-=K;N[T++]=G[le++],--K;);le=T-pe,ue=N}for(;2<me;)N[T++]=ue[le++],N[T++]=ue[le++],N[T++]=ue[le++],me-=3;me&&(N[T++]=ue[le++],1<me&&(N[T++]=ue[le++]))}else{for(le=T-pe;N[T++]=N[le++],N[T++]=N[le++],N[T++]=N[le++],2<(me-=3););me&&(N[T++]=N[le++],1<me&&(N[T++]=N[le++]))}break}}break}}while(R<L&&T<W);R-=me=z>>3,J&=(1<<(z-=me<<3))-1,M.next_in=R,M.next_out=T,M.avail_in=R<L?L-R+5:5-(R-L),M.avail_out=T<W?W-T+257:257-(T-W),E.hold=J,E.bits=z}},{}],49:[function(I,X,x){"use strict";var M=I("../utils/common"),C=I("./adler32"),E=I("./crc32"),R=I("./inffast"),L=I("./inftrees"),T=1,O=2,W=0,D=-2,q=1,F=852,Y=592;function G(le){return(le>>>24&255)+(le>>>8&65280)+((65280&le)<<8)+((255&le)<<24)}function J(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new M.Buf16(320),this.work=new M.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function z(le){var ue;return le&&le.state?(ue=le.state,le.total_in=le.total_out=ue.total=0,le.msg="",ue.wrap&&(le.adler=1&ue.wrap),ue.mode=q,ue.last=0,ue.havedict=0,ue.dmax=32768,ue.head=null,ue.hold=0,ue.bits=0,ue.lencode=ue.lendyn=new M.Buf32(F),ue.distcode=ue.distdyn=new M.Buf32(Y),ue.sane=1,ue.back=-1,W):D}function te(le){var ue;return le&&le.state?((ue=le.state).wsize=0,ue.whave=0,ue.wnext=0,z(le)):D}function V(le,ue){var A,N;return le&&le.state?(N=le.state,ue<0?(A=0,ue=-ue):(A=1+(ue>>4),ue<48&&(ue&=15)),ue&&(ue<8||15<ue)?D:(N.window!==null&&N.wbits!==ue&&(N.window=null),N.wrap=A,N.wbits=ue,te(le))):D}function de(le,ue){var A,N;return le?(N=new J,(le.state=N).window=null,(A=V(le,ue))!==W&&(le.state=null),A):D}var P,p,K=!0;function me(le){if(K){var ue;for(P=new M.Buf32(512),p=new M.Buf32(32),ue=0;ue<144;)le.lens[ue++]=8;for(;ue<256;)le.lens[ue++]=9;for(;ue<280;)le.lens[ue++]=7;for(;ue<288;)le.lens[ue++]=8;for(L(T,le.lens,0,288,P,0,le.work,{bits:9}),ue=0;ue<32;)le.lens[ue++]=5;L(O,le.lens,0,32,p,0,le.work,{bits:5}),K=!1}le.lencode=P,le.lenbits=9,le.distcode=p,le.distbits=5}function pe(le,ue,A,N){var oe,ge=le.state;return ge.window===null&&(ge.wsize=1<<ge.wbits,ge.wnext=0,ge.whave=0,ge.window=new M.Buf8(ge.wsize)),N>=ge.wsize?(M.arraySet(ge.window,ue,A-ge.wsize,ge.wsize,0),ge.wnext=0,ge.whave=ge.wsize):(N<(oe=ge.wsize-ge.wnext)&&(oe=N),M.arraySet(ge.window,ue,A-N,oe,ge.wnext),(N-=oe)?(M.arraySet(ge.window,ue,A-N,N,0),ge.wnext=N,ge.whave=ge.wsize):(ge.wnext+=oe,ge.wnext===ge.wsize&&(ge.wnext=0),ge.whave<ge.wsize&&(ge.whave+=oe))),0}x.inflateReset=te,x.inflateReset2=V,x.inflateResetKeep=z,x.inflateInit=function(le){return de(le,15)},x.inflateInit2=de,x.inflate=function(le,ue){var A,N,oe,ge,ve,ke,Ye,Le,Fe,st,Ee,pt,$t,It,_t,jt,zt,mn,Qn,En,Q,ot,gt,ye,_e=0,$e=new M.Buf8(4),mt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!le||!le.state||!le.output||!le.input&&le.avail_in!==0)return D;(A=le.state).mode===12&&(A.mode=13),ve=le.next_out,oe=le.output,Ye=le.avail_out,ge=le.next_in,N=le.input,ke=le.avail_in,Le=A.hold,Fe=A.bits,st=ke,Ee=Ye,ot=W;e:for(;;)switch(A.mode){case q:if(A.wrap===0){A.mode=13;break}for(;Fe<16;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}if(2&A.wrap&&Le===35615){$e[A.check=0]=255&Le,$e[1]=Le>>>8&255,A.check=E(A.check,$e,2,0),Fe=Le=0,A.mode=2;break}if(A.flags=0,A.head&&(A.head.done=!1),!(1&A.wrap)||(((255&Le)<<8)+(Le>>8))%31){le.msg="incorrect header check",A.mode=30;break}if((15&Le)!=8){le.msg="unknown compression method",A.mode=30;break}if(Fe-=4,Q=8+(15&(Le>>>=4)),A.wbits===0)A.wbits=Q;else if(Q>A.wbits){le.msg="invalid window size",A.mode=30;break}A.dmax=1<<Q,le.adler=A.check=1,A.mode=512&Le?10:12,Fe=Le=0;break;case 2:for(;Fe<16;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}if(A.flags=Le,(255&A.flags)!=8){le.msg="unknown compression method",A.mode=30;break}if(57344&A.flags){le.msg="unknown header flags set",A.mode=30;break}A.head&&(A.head.text=Le>>8&1),512&A.flags&&($e[0]=255&Le,$e[1]=Le>>>8&255,A.check=E(A.check,$e,2,0)),Fe=Le=0,A.mode=3;case 3:for(;Fe<32;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}A.head&&(A.head.time=Le),512&A.flags&&($e[0]=255&Le,$e[1]=Le>>>8&255,$e[2]=Le>>>16&255,$e[3]=Le>>>24&255,A.check=E(A.check,$e,4,0)),Fe=Le=0,A.mode=4;case 4:for(;Fe<16;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}A.head&&(A.head.xflags=255&Le,A.head.os=Le>>8),512&A.flags&&($e[0]=255&Le,$e[1]=Le>>>8&255,A.check=E(A.check,$e,2,0)),Fe=Le=0,A.mode=5;case 5:if(1024&A.flags){for(;Fe<16;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}A.length=Le,A.head&&(A.head.extra_len=Le),512&A.flags&&($e[0]=255&Le,$e[1]=Le>>>8&255,A.check=E(A.check,$e,2,0)),Fe=Le=0}else A.head&&(A.head.extra=null);A.mode=6;case 6:if(1024&A.flags&&(ke<(pt=A.length)&&(pt=ke),pt&&(A.head&&(Q=A.head.extra_len-A.length,A.head.extra||(A.head.extra=new Array(A.head.extra_len)),M.arraySet(A.head.extra,N,ge,pt,Q)),512&A.flags&&(A.check=E(A.check,N,pt,ge)),ke-=pt,ge+=pt,A.length-=pt),A.length))break e;A.length=0,A.mode=7;case 7:if(2048&A.flags){if(ke===0)break e;for(pt=0;Q=N[ge+pt++],A.head&&Q&&A.length<65536&&(A.head.name+=String.fromCharCode(Q)),Q&&pt<ke;);if(512&A.flags&&(A.check=E(A.check,N,pt,ge)),ke-=pt,ge+=pt,Q)break e}else A.head&&(A.head.name=null);A.length=0,A.mode=8;case 8:if(4096&A.flags){if(ke===0)break e;for(pt=0;Q=N[ge+pt++],A.head&&Q&&A.length<65536&&(A.head.comment+=String.fromCharCode(Q)),Q&&pt<ke;);if(512&A.flags&&(A.check=E(A.check,N,pt,ge)),ke-=pt,ge+=pt,Q)break e}else A.head&&(A.head.comment=null);A.mode=9;case 9:if(512&A.flags){for(;Fe<16;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}if(Le!==(65535&A.check)){le.msg="header crc mismatch",A.mode=30;break}Fe=Le=0}A.head&&(A.head.hcrc=A.flags>>9&1,A.head.done=!0),le.adler=A.check=0,A.mode=12;break;case 10:for(;Fe<32;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}le.adler=A.check=G(Le),Fe=Le=0,A.mode=11;case 11:if(A.havedict===0)return le.next_out=ve,le.avail_out=Ye,le.next_in=ge,le.avail_in=ke,A.hold=Le,A.bits=Fe,2;le.adler=A.check=1,A.mode=12;case 12:if(ue===5||ue===6)break e;case 13:if(A.last){Le>>>=7&Fe,Fe-=7&Fe,A.mode=27;break}for(;Fe<3;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}switch(A.last=1&Le,Fe-=1,3&(Le>>>=1)){case 0:A.mode=14;break;case 1:if(me(A),A.mode=20,ue!==6)break;Le>>>=2,Fe-=2;break e;case 2:A.mode=17;break;case 3:le.msg="invalid block type",A.mode=30}Le>>>=2,Fe-=2;break;case 14:for(Le>>>=7&Fe,Fe-=7&Fe;Fe<32;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}if((65535&Le)!=(Le>>>16^65535)){le.msg="invalid stored block lengths",A.mode=30;break}if(A.length=65535&Le,Fe=Le=0,A.mode=15,ue===6)break e;case 15:A.mode=16;case 16:if(pt=A.length){if(ke<pt&&(pt=ke),Ye<pt&&(pt=Ye),pt===0)break e;M.arraySet(oe,N,ge,pt,ve),ke-=pt,ge+=pt,Ye-=pt,ve+=pt,A.length-=pt;break}A.mode=12;break;case 17:for(;Fe<14;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}if(A.nlen=257+(31&Le),Le>>>=5,Fe-=5,A.ndist=1+(31&Le),Le>>>=5,Fe-=5,A.ncode=4+(15&Le),Le>>>=4,Fe-=4,286<A.nlen||30<A.ndist){le.msg="too many length or distance symbols",A.mode=30;break}A.have=0,A.mode=18;case 18:for(;A.have<A.ncode;){for(;Fe<3;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}A.lens[mt[A.have++]]=7&Le,Le>>>=3,Fe-=3}for(;A.have<19;)A.lens[mt[A.have++]]=0;if(A.lencode=A.lendyn,A.lenbits=7,gt={bits:A.lenbits},ot=L(0,A.lens,0,19,A.lencode,0,A.work,gt),A.lenbits=gt.bits,ot){le.msg="invalid code lengths set",A.mode=30;break}A.have=0,A.mode=19;case 19:for(;A.have<A.nlen+A.ndist;){for(;jt=(_e=A.lencode[Le&(1<<A.lenbits)-1])>>>16&255,zt=65535&_e,!((_t=_e>>>24)<=Fe);){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}if(zt<16)Le>>>=_t,Fe-=_t,A.lens[A.have++]=zt;else{if(zt===16){for(ye=_t+2;Fe<ye;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}if(Le>>>=_t,Fe-=_t,A.have===0){le.msg="invalid bit length repeat",A.mode=30;break}Q=A.lens[A.have-1],pt=3+(3&Le),Le>>>=2,Fe-=2}else if(zt===17){for(ye=_t+3;Fe<ye;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}Fe-=_t,Q=0,pt=3+(7&(Le>>>=_t)),Le>>>=3,Fe-=3}else{for(ye=_t+7;Fe<ye;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}Fe-=_t,Q=0,pt=11+(127&(Le>>>=_t)),Le>>>=7,Fe-=7}if(A.have+pt>A.nlen+A.ndist){le.msg="invalid bit length repeat",A.mode=30;break}for(;pt--;)A.lens[A.have++]=Q}}if(A.mode===30)break;if(A.lens[256]===0){le.msg="invalid code -- missing end-of-block",A.mode=30;break}if(A.lenbits=9,gt={bits:A.lenbits},ot=L(T,A.lens,0,A.nlen,A.lencode,0,A.work,gt),A.lenbits=gt.bits,ot){le.msg="invalid literal/lengths set",A.mode=30;break}if(A.distbits=6,A.distcode=A.distdyn,gt={bits:A.distbits},ot=L(O,A.lens,A.nlen,A.ndist,A.distcode,0,A.work,gt),A.distbits=gt.bits,ot){le.msg="invalid distances set",A.mode=30;break}if(A.mode=20,ue===6)break e;case 20:A.mode=21;case 21:if(6<=ke&&258<=Ye){le.next_out=ve,le.avail_out=Ye,le.next_in=ge,le.avail_in=ke,A.hold=Le,A.bits=Fe,R(le,Ee),ve=le.next_out,oe=le.output,Ye=le.avail_out,ge=le.next_in,N=le.input,ke=le.avail_in,Le=A.hold,Fe=A.bits,A.mode===12&&(A.back=-1);break}for(A.back=0;jt=(_e=A.lencode[Le&(1<<A.lenbits)-1])>>>16&255,zt=65535&_e,!((_t=_e>>>24)<=Fe);){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}if(jt&&!(240&jt)){for(mn=_t,Qn=jt,En=zt;jt=(_e=A.lencode[En+((Le&(1<<mn+Qn)-1)>>mn)])>>>16&255,zt=65535&_e,!(mn+(_t=_e>>>24)<=Fe);){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}Le>>>=mn,Fe-=mn,A.back+=mn}if(Le>>>=_t,Fe-=_t,A.back+=_t,A.length=zt,jt===0){A.mode=26;break}if(32&jt){A.back=-1,A.mode=12;break}if(64&jt){le.msg="invalid literal/length code",A.mode=30;break}A.extra=15&jt,A.mode=22;case 22:if(A.extra){for(ye=A.extra;Fe<ye;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}A.length+=Le&(1<<A.extra)-1,Le>>>=A.extra,Fe-=A.extra,A.back+=A.extra}A.was=A.length,A.mode=23;case 23:for(;jt=(_e=A.distcode[Le&(1<<A.distbits)-1])>>>16&255,zt=65535&_e,!((_t=_e>>>24)<=Fe);){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}if(!(240&jt)){for(mn=_t,Qn=jt,En=zt;jt=(_e=A.distcode[En+((Le&(1<<mn+Qn)-1)>>mn)])>>>16&255,zt=65535&_e,!(mn+(_t=_e>>>24)<=Fe);){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}Le>>>=mn,Fe-=mn,A.back+=mn}if(Le>>>=_t,Fe-=_t,A.back+=_t,64&jt){le.msg="invalid distance code",A.mode=30;break}A.offset=zt,A.extra=15&jt,A.mode=24;case 24:if(A.extra){for(ye=A.extra;Fe<ye;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}A.offset+=Le&(1<<A.extra)-1,Le>>>=A.extra,Fe-=A.extra,A.back+=A.extra}if(A.offset>A.dmax){le.msg="invalid distance too far back",A.mode=30;break}A.mode=25;case 25:if(Ye===0)break e;if(pt=Ee-Ye,A.offset>pt){if((pt=A.offset-pt)>A.whave&&A.sane){le.msg="invalid distance too far back",A.mode=30;break}$t=pt>A.wnext?(pt-=A.wnext,A.wsize-pt):A.wnext-pt,pt>A.length&&(pt=A.length),It=A.window}else It=oe,$t=ve-A.offset,pt=A.length;for(Ye<pt&&(pt=Ye),Ye-=pt,A.length-=pt;oe[ve++]=It[$t++],--pt;);A.length===0&&(A.mode=21);break;case 26:if(Ye===0)break e;oe[ve++]=A.length,Ye--,A.mode=21;break;case 27:if(A.wrap){for(;Fe<32;){if(ke===0)break e;ke--,Le|=N[ge++]<<Fe,Fe+=8}if(Ee-=Ye,le.total_out+=Ee,A.total+=Ee,Ee&&(le.adler=A.check=A.flags?E(A.check,oe,Ee,ve-Ee):C(A.check,oe,Ee,ve-Ee)),Ee=Ye,(A.flags?Le:G(Le))!==A.check){le.msg="incorrect data check",A.mode=30;break}Fe=Le=0}A.mode=28;case 28:if(A.wrap&&A.flags){for(;Fe<32;){if(ke===0)break e;ke--,Le+=N[ge++]<<Fe,Fe+=8}if(Le!==(4294967295&A.total)){le.msg="incorrect length check",A.mode=30;break}Fe=Le=0}A.mode=29;case 29:ot=1;break e;case 30:ot=-3;break e;case 31:return-4;case 32:default:return D}return le.next_out=ve,le.avail_out=Ye,le.next_in=ge,le.avail_in=ke,A.hold=Le,A.bits=Fe,(A.wsize||Ee!==le.avail_out&&A.mode<30&&(A.mode<27||ue!==4))&&pe(le,le.output,le.next_out,Ee-le.avail_out)?(A.mode=31,-4):(st-=le.avail_in,Ee-=le.avail_out,le.total_in+=st,le.total_out+=Ee,A.total+=Ee,A.wrap&&Ee&&(le.adler=A.check=A.flags?E(A.check,oe,Ee,le.next_out-Ee):C(A.check,oe,Ee,le.next_out-Ee)),le.data_type=A.bits+(A.last?64:0)+(A.mode===12?128:0)+(A.mode===20||A.mode===15?256:0),(st==0&&Ee===0||ue===4)&&ot===W&&(ot=-5),ot)},x.inflateEnd=function(le){if(!le||!le.state)return D;var ue=le.state;return ue.window&&(ue.window=null),le.state=null,W},x.inflateGetHeader=function(le,ue){var A;return le&&le.state&&2&(A=le.state).wrap?((A.head=ue).done=!1,W):D},x.inflateSetDictionary=function(le,ue){var A,N=ue.length;return le&&le.state?(A=le.state).wrap!==0&&A.mode!==11?D:A.mode===11&&C(1,ue,N,0)!==A.check?-3:pe(le,ue,N,N)?(A.mode=31,-4):(A.havedict=1,W):D},x.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(I,X,x){"use strict";var M=I("../utils/common"),C=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],E=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],R=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],L=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];X.exports=function(T,O,W,D,q,F,Y,G){var J,z,te,V,de,P,p,K,me,pe=G.bits,le=0,ue=0,A=0,N=0,oe=0,ge=0,ve=0,ke=0,Ye=0,Le=0,Fe=null,st=0,Ee=new M.Buf16(16),pt=new M.Buf16(16),$t=null,It=0;for(le=0;le<=15;le++)Ee[le]=0;for(ue=0;ue<D;ue++)Ee[O[W+ue]]++;for(oe=pe,N=15;1<=N&&Ee[N]===0;N--);if(N<oe&&(oe=N),N===0)return q[F++]=20971520,q[F++]=20971520,G.bits=1,0;for(A=1;A<N&&Ee[A]===0;A++);for(oe<A&&(oe=A),le=ke=1;le<=15;le++)if(ke<<=1,(ke-=Ee[le])<0)return-1;if(0<ke&&(T===0||N!==1))return-1;for(pt[1]=0,le=1;le<15;le++)pt[le+1]=pt[le]+Ee[le];for(ue=0;ue<D;ue++)O[W+ue]!==0&&(Y[pt[O[W+ue]]++]=ue);if(P=T===0?(Fe=$t=Y,19):T===1?(Fe=C,st-=257,$t=E,It-=257,256):(Fe=R,$t=L,-1),le=A,de=F,ve=ue=Le=0,te=-1,V=(Ye=1<<(ge=oe))-1,T===1&&852<Ye||T===2&&592<Ye)return 1;for(;;){for(p=le-ve,me=Y[ue]<P?(K=0,Y[ue]):Y[ue]>P?(K=$t[It+Y[ue]],Fe[st+Y[ue]]):(K=96,0),J=1<<le-ve,A=z=1<<ge;q[de+(Le>>ve)+(z-=J)]=p<<24|K<<16|me|0,z!==0;);for(J=1<<le-1;Le&J;)J>>=1;if(J!==0?(Le&=J-1,Le+=J):Le=0,ue++,--Ee[le]==0){if(le===N)break;le=O[W+Y[ue]]}if(oe<le&&(Le&V)!==te){for(ve===0&&(ve=oe),de+=A,ke=1<<(ge=le-ve);ge+ve<N&&!((ke-=Ee[ge+ve])<=0);)ge++,ke<<=1;if(Ye+=1<<ge,T===1&&852<Ye||T===2&&592<Ye)return 1;q[te=Le&V]=oe<<24|ge<<16|de-F|0}}return Le!==0&&(q[de+Le]=le-ve<<24|4194304|0),G.bits=oe,0}},{"../utils/common":41}],51:[function(I,X,x){"use strict";X.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(I,X,x){"use strict";var M=I("../utils/common"),C=0,E=1;function R(_e){for(var $e=_e.length;0<=--$e;)_e[$e]=0}var L=0,T=29,O=256,W=O+1+T,D=30,q=19,F=2*W+1,Y=15,G=16,J=7,z=256,te=16,V=17,de=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],p=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],K=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],me=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],pe=new Array(2*(W+2));R(pe);var le=new Array(2*D);R(le);var ue=new Array(512);R(ue);var A=new Array(256);R(A);var N=new Array(T);R(N);var oe,ge,ve,ke=new Array(D);function Ye(_e,$e,mt,yt,nt){this.static_tree=_e,this.extra_bits=$e,this.extra_base=mt,this.elems=yt,this.max_length=nt,this.has_stree=_e&&_e.length}function Le(_e,$e){this.dyn_tree=_e,this.max_code=0,this.stat_desc=$e}function Fe(_e){return _e<256?ue[_e]:ue[256+(_e>>>7)]}function st(_e,$e){_e.pending_buf[_e.pending++]=255&$e,_e.pending_buf[_e.pending++]=$e>>>8&255}function Ee(_e,$e,mt){_e.bi_valid>G-mt?(_e.bi_buf|=$e<<_e.bi_valid&65535,st(_e,_e.bi_buf),_e.bi_buf=$e>>G-_e.bi_valid,_e.bi_valid+=mt-G):(_e.bi_buf|=$e<<_e.bi_valid&65535,_e.bi_valid+=mt)}function pt(_e,$e,mt){Ee(_e,mt[2*$e],mt[2*$e+1])}function $t(_e,$e){for(var mt=0;mt|=1&_e,_e>>>=1,mt<<=1,0<--$e;);return mt>>>1}function It(_e,$e,mt){var yt,nt,ut=new Array(Y+1),kt=0;for(yt=1;yt<=Y;yt++)ut[yt]=kt=kt+mt[yt-1]<<1;for(nt=0;nt<=$e;nt++){var Ne=_e[2*nt+1];Ne!==0&&(_e[2*nt]=$t(ut[Ne]++,Ne))}}function _t(_e){var $e;for($e=0;$e<W;$e++)_e.dyn_ltree[2*$e]=0;for($e=0;$e<D;$e++)_e.dyn_dtree[2*$e]=0;for($e=0;$e<q;$e++)_e.bl_tree[2*$e]=0;_e.dyn_ltree[2*z]=1,_e.opt_len=_e.static_len=0,_e.last_lit=_e.matches=0}function jt(_e){8<_e.bi_valid?st(_e,_e.bi_buf):0<_e.bi_valid&&(_e.pending_buf[_e.pending++]=_e.bi_buf),_e.bi_buf=0,_e.bi_valid=0}function zt(_e,$e,mt,yt){var nt=2*$e,ut=2*mt;return _e[nt]<_e[ut]||_e[nt]===_e[ut]&&yt[$e]<=yt[mt]}function mn(_e,$e,mt){for(var yt=_e.heap[mt],nt=mt<<1;nt<=_e.heap_len&&(nt<_e.heap_len&&zt($e,_e.heap[nt+1],_e.heap[nt],_e.depth)&&nt++,!zt($e,yt,_e.heap[nt],_e.depth));)_e.heap[mt]=_e.heap[nt],mt=nt,nt<<=1;_e.heap[mt]=yt}function Qn(_e,$e,mt){var yt,nt,ut,kt,Ne=0;if(_e.last_lit!==0)for(;yt=_e.pending_buf[_e.d_buf+2*Ne]<<8|_e.pending_buf[_e.d_buf+2*Ne+1],nt=_e.pending_buf[_e.l_buf+Ne],Ne++,yt===0?pt(_e,nt,$e):(pt(_e,(ut=A[nt])+O+1,$e),(kt=P[ut])!==0&&Ee(_e,nt-=N[ut],kt),pt(_e,ut=Fe(--yt),mt),(kt=p[ut])!==0&&Ee(_e,yt-=ke[ut],kt)),Ne<_e.last_lit;);pt(_e,z,$e)}function En(_e,$e){var mt,yt,nt,ut=$e.dyn_tree,kt=$e.stat_desc.static_tree,Ne=$e.stat_desc.has_stree,je=$e.stat_desc.elems,ct=-1;for(_e.heap_len=0,_e.heap_max=F,mt=0;mt<je;mt++)ut[2*mt]!==0?(_e.heap[++_e.heap_len]=ct=mt,_e.depth[mt]=0):ut[2*mt+1]=0;for(;_e.heap_len<2;)ut[2*(nt=_e.heap[++_e.heap_len]=ct<2?++ct:0)]=1,_e.depth[nt]=0,_e.opt_len--,Ne&&(_e.static_len-=kt[2*nt+1]);for($e.max_code=ct,mt=_e.heap_len>>1;1<=mt;mt--)mn(_e,ut,mt);for(nt=je;mt=_e.heap[1],_e.heap[1]=_e.heap[_e.heap_len--],mn(_e,ut,1),yt=_e.heap[1],_e.heap[--_e.heap_max]=mt,_e.heap[--_e.heap_max]=yt,ut[2*nt]=ut[2*mt]+ut[2*yt],_e.depth[nt]=(_e.depth[mt]>=_e.depth[yt]?_e.depth[mt]:_e.depth[yt])+1,ut[2*mt+1]=ut[2*yt+1]=nt,_e.heap[1]=nt++,mn(_e,ut,1),2<=_e.heap_len;);_e.heap[--_e.heap_max]=_e.heap[1],function(Tt,pn){var bn,Bn,yn,Jt,Kn,Xa,lt=pn.dyn_tree,St=pn.max_code,Xt=pn.stat_desc.static_tree,Qt=pn.stat_desc.has_stree,un=pn.stat_desc.extra_bits,Mt=pn.stat_desc.extra_base,ua=pn.stat_desc.max_length,Gt=0;for(Jt=0;Jt<=Y;Jt++)Tt.bl_count[Jt]=0;for(lt[2*Tt.heap[Tt.heap_max]+1]=0,bn=Tt.heap_max+1;bn<F;bn++)ua<(Jt=lt[2*lt[2*(Bn=Tt.heap[bn])+1]+1]+1)&&(Jt=ua,Gt++),lt[2*Bn+1]=Jt,St<Bn||(Tt.bl_count[Jt]++,Kn=0,Mt<=Bn&&(Kn=un[Bn-Mt]),Xa=lt[2*Bn],Tt.opt_len+=Xa*(Jt+Kn),Qt&&(Tt.static_len+=Xa*(Xt[2*Bn+1]+Kn)));if(Gt!==0){do{for(Jt=ua-1;Tt.bl_count[Jt]===0;)Jt--;Tt.bl_count[Jt]--,Tt.bl_count[Jt+1]+=2,Tt.bl_count[ua]--,Gt-=2}while(0<Gt);for(Jt=ua;Jt!==0;Jt--)for(Bn=Tt.bl_count[Jt];Bn!==0;)St<(yn=Tt.heap[--bn])||(lt[2*yn+1]!==Jt&&(Tt.opt_len+=(Jt-lt[2*yn+1])*lt[2*yn],lt[2*yn+1]=Jt),Bn--)}}(_e,$e),It(ut,ct,_e.bl_count)}function Q(_e,$e,mt){var yt,nt,ut=-1,kt=$e[1],Ne=0,je=7,ct=4;for(kt===0&&(je=138,ct=3),$e[2*(mt+1)+1]=65535,yt=0;yt<=mt;yt++)nt=kt,kt=$e[2*(yt+1)+1],++Ne<je&&nt===kt||(Ne<ct?_e.bl_tree[2*nt]+=Ne:nt!==0?(nt!==ut&&_e.bl_tree[2*nt]++,_e.bl_tree[2*te]++):Ne<=10?_e.bl_tree[2*V]++:_e.bl_tree[2*de]++,ut=nt,ct=(Ne=0)===kt?(je=138,3):nt===kt?(je=6,3):(je=7,4))}function ot(_e,$e,mt){var yt,nt,ut=-1,kt=$e[1],Ne=0,je=7,ct=4;for(kt===0&&(je=138,ct=3),yt=0;yt<=mt;yt++)if(nt=kt,kt=$e[2*(yt+1)+1],!(++Ne<je&&nt===kt)){if(Ne<ct)for(;pt(_e,nt,_e.bl_tree),--Ne!=0;);else nt!==0?(nt!==ut&&(pt(_e,nt,_e.bl_tree),Ne--),pt(_e,te,_e.bl_tree),Ee(_e,Ne-3,2)):Ne<=10?(pt(_e,V,_e.bl_tree),Ee(_e,Ne-3,3)):(pt(_e,de,_e.bl_tree),Ee(_e,Ne-11,7));ut=nt,ct=(Ne=0)===kt?(je=138,3):nt===kt?(je=6,3):(je=7,4)}}R(ke);var gt=!1;function ye(_e,$e,mt,yt){Ee(_e,(L<<1)+(yt?1:0),3),function(nt,ut,kt,Ne){jt(nt),Ne&&(st(nt,kt),st(nt,~kt)),M.arraySet(nt.pending_buf,nt.window,ut,kt,nt.pending),nt.pending+=kt}(_e,$e,mt,!0)}x._tr_init=function(_e){gt||(function(){var $e,mt,yt,nt,ut,kt=new Array(Y+1);for(nt=yt=0;nt<T-1;nt++)for(N[nt]=yt,$e=0;$e<1<<P[nt];$e++)A[yt++]=nt;for(A[yt-1]=nt,nt=ut=0;nt<16;nt++)for(ke[nt]=ut,$e=0;$e<1<<p[nt];$e++)ue[ut++]=nt;for(ut>>=7;nt<D;nt++)for(ke[nt]=ut<<7,$e=0;$e<1<<p[nt]-7;$e++)ue[256+ut++]=nt;for(mt=0;mt<=Y;mt++)kt[mt]=0;for($e=0;$e<=143;)pe[2*$e+1]=8,$e++,kt[8]++;for(;$e<=255;)pe[2*$e+1]=9,$e++,kt[9]++;for(;$e<=279;)pe[2*$e+1]=7,$e++,kt[7]++;for(;$e<=287;)pe[2*$e+1]=8,$e++,kt[8]++;for(It(pe,W+1,kt),$e=0;$e<D;$e++)le[2*$e+1]=5,le[2*$e]=$t($e,5);oe=new Ye(pe,P,O+1,W,Y),ge=new Ye(le,p,0,D,Y),ve=new Ye(new Array(0),K,0,q,J)}(),gt=!0),_e.l_desc=new Le(_e.dyn_ltree,oe),_e.d_desc=new Le(_e.dyn_dtree,ge),_e.bl_desc=new Le(_e.bl_tree,ve),_e.bi_buf=0,_e.bi_valid=0,_t(_e)},x._tr_stored_block=ye,x._tr_flush_block=function(_e,$e,mt,yt){var nt,ut,kt=0;0<_e.level?(_e.strm.data_type===2&&(_e.strm.data_type=function(Ne){var je,ct=4093624447;for(je=0;je<=31;je++,ct>>>=1)if(1&ct&&Ne.dyn_ltree[2*je]!==0)return C;if(Ne.dyn_ltree[18]!==0||Ne.dyn_ltree[20]!==0||Ne.dyn_ltree[26]!==0)return E;for(je=32;je<O;je++)if(Ne.dyn_ltree[2*je]!==0)return E;return C}(_e)),En(_e,_e.l_desc),En(_e,_e.d_desc),kt=function(Ne){var je;for(Q(Ne,Ne.dyn_ltree,Ne.l_desc.max_code),Q(Ne,Ne.dyn_dtree,Ne.d_desc.max_code),En(Ne,Ne.bl_desc),je=q-1;3<=je&&Ne.bl_tree[2*me[je]+1]===0;je--);return Ne.opt_len+=3*(je+1)+5+5+4,je}(_e),nt=_e.opt_len+3+7>>>3,(ut=_e.static_len+3+7>>>3)<=nt&&(nt=ut)):nt=ut=mt+5,mt+4<=nt&&$e!==-1?ye(_e,$e,mt,yt):_e.strategy===4||ut===nt?(Ee(_e,2+(yt?1:0),3),Qn(_e,pe,le)):(Ee(_e,4+(yt?1:0),3),function(Ne,je,ct,Tt){var pn;for(Ee(Ne,je-257,5),Ee(Ne,ct-1,5),Ee(Ne,Tt-4,4),pn=0;pn<Tt;pn++)Ee(Ne,Ne.bl_tree[2*me[pn]+1],3);ot(Ne,Ne.dyn_ltree,je-1),ot(Ne,Ne.dyn_dtree,ct-1)}(_e,_e.l_desc.max_code+1,_e.d_desc.max_code+1,kt+1),Qn(_e,_e.dyn_ltree,_e.dyn_dtree)),_t(_e),yt&&jt(_e)},x._tr_tally=function(_e,$e,mt){return _e.pending_buf[_e.d_buf+2*_e.last_lit]=$e>>>8&255,_e.pending_buf[_e.d_buf+2*_e.last_lit+1]=255&$e,_e.pending_buf[_e.l_buf+_e.last_lit]=255&mt,_e.last_lit++,$e===0?_e.dyn_ltree[2*mt]++:(_e.matches++,$e--,_e.dyn_ltree[2*(A[mt]+O+1)]++,_e.dyn_dtree[2*Fe($e)]++),_e.last_lit===_e.lit_bufsize-1},x._tr_align=function(_e){Ee(_e,2,3),pt(_e,z,pe),function($e){$e.bi_valid===16?(st($e,$e.bi_buf),$e.bi_buf=0,$e.bi_valid=0):8<=$e.bi_valid&&($e.pending_buf[$e.pending++]=255&$e.bi_buf,$e.bi_buf>>=8,$e.bi_valid-=8)}(_e)}},{"../utils/common":41}],53:[function(I,X,x){"use strict";X.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(I,X,x){(function(M){(function(C,E){"use strict";if(!C.setImmediate){var R,L,T,O,W=1,D={},q=!1,F=C.document,Y=Object.getPrototypeOf&&Object.getPrototypeOf(C);Y=Y&&Y.setTimeout?Y:C,R={}.toString.call(C.process)==="[object process]"?function(te){process.nextTick(function(){J(te)})}:function(){if(C.postMessage&&!C.importScripts){var te=!0,V=C.onmessage;return C.onmessage=function(){te=!1},C.postMessage("","*"),C.onmessage=V,te}}()?(O="setImmediate$"+Math.random()+"$",C.addEventListener?C.addEventListener("message",z,!1):C.attachEvent("onmessage",z),function(te){C.postMessage(O+te,"*")}):C.MessageChannel?((T=new MessageChannel).port1.onmessage=function(te){J(te.data)},function(te){T.port2.postMessage(te)}):F&&"onreadystatechange"in F.createElement("script")?(L=F.documentElement,function(te){var V=F.createElement("script");V.onreadystatechange=function(){J(te),V.onreadystatechange=null,L.removeChild(V),V=null},L.appendChild(V)}):function(te){setTimeout(J,0,te)},Y.setImmediate=function(te){typeof te!="function"&&(te=new Function(""+te));for(var V=new Array(arguments.length-1),de=0;de<V.length;de++)V[de]=arguments[de+1];var P={callback:te,args:V};return D[W]=P,R(W),W++},Y.clearImmediate=G}function G(te){delete D[te]}function J(te){if(q)setTimeout(J,0,te);else{var V=D[te];if(V){q=!0;try{(function(de){var P=de.callback,p=de.args;switch(p.length){case 0:P();break;case 1:P(p[0]);break;case 2:P(p[0],p[1]);break;case 3:P(p[0],p[1],p[2]);break;default:P.apply(E,p)}})(V)}finally{G(te),q=!1}}}}function z(te){te.source===C&&typeof te.data=="string"&&te.data.indexOf(O)===0&&J(+te.data.slice(O.length))}})(typeof self=="undefined"?M===void 0?this:M:self)}).call(this,typeof ne.g!="undefined"?ne.g:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}]},{},[10])(10)})},9087:(Xe,ce,ne)=>{var I=ne(3746);ce.s=X;function X(){function x(M){return I.reject(new Error("could not open external image: '"+M+`'
cannot open linked files from a web browser`))}return{read:x}}},9213:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X,x,M){var C=ne(7443),E=C.tryCatch,R=C.errorObj,L=I._async;I.prototype.break=I.prototype.cancel=function(){if(!M.cancellation())return this._warn("cancellation is disabled");for(var T=this,O=T;T._isCancellable();){if(!T._cancelBy(O)){O._isFollowing()?O._followee().cancel():O._cancelBranched();break}var W=T._cancellationParent;if(W==null||!W._isCancellable()){T._isFollowing()?T._followee().cancel():T._cancelBranched();break}else T._isFollowing()&&T._followee().cancel(),T._setWillBeCancelled(),O=T,T=W}},I.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},I.prototype._enoughBranchesHaveCancelled=function(){return this._branchesRemainingToCancel===void 0||this._branchesRemainingToCancel<=0},I.prototype._cancelBy=function(T){return T===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),this._enoughBranchesHaveCancelled()?(this._invokeOnCancel(),!0):!1)},I.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},I.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),L.invoke(this._cancelPromises,this,void 0))},I.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},I.prototype._unsetOnCancel=function(){this._onCancelField=void 0},I.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},I.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},I.prototype._doInvokeOnCancel=function(T,O){if(C.isArray(T))for(var W=0;W<T.length;++W)this._doInvokeOnCancel(T[W],O);else if(T!==void 0)if(typeof T=="function"){if(!O){var D=E(T).call(this._boundValue());D===R&&(this._attachExtraTrace(D.e),L.throwLater(D.e))}}else T._resultCancelled(this)},I.prototype._invokeOnCancel=function(){var T=this._onCancel();this._unsetOnCancel(),L.invoke(this._doInvokeOnCancel,this,T)},I.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},I.prototype._resultCancelled=function(){this.cancel()}}},9235:function(Xe,ce,ne){(function(){var I,X,x=function(C,E){for(var R in E)M.call(E,R)&&(C[R]=E[R]);function L(){this.constructor=C}return L.prototype=E.prototype,C.prototype=new L,C.__super__=E.prototype,C},M={}.hasOwnProperty;X=ne(3523),Xe.exports=I=function(C){x(E,C);function E(R,L,T){if(E.__super__.constructor.call(this,R),L==null)throw new Error("Missing DTD element name. "+this.debugInfo());T||(T="(#PCDATA)"),Array.isArray(T)&&(T="("+T.join(",")+")"),this.name=this.stringify.eleName(L),this.value=this.stringify.dtdElementValue(T)}return E.prototype.toString=function(R){return this.options.writer.set(R).dtdElement(this)},E}(X)}).call(this)},9265:function(Xe,ce,ne){(function(){var I,X,x,M,C,E,R,L,T,O,W,D,q,F,Y,G=function(z,te){for(var V in te)J.call(te,V)&&(z[V]=te[V]);function de(){this.constructor=z}return de.prototype=te.prototype,z.prototype=new de,z.__super__=te.prototype,z},J={}.hasOwnProperty;R=ne(4387),L=ne(1025),I=ne(314),X=ne(4398),O=ne(3879),D=ne(7025),F=ne(4140),W=ne(9578),T=ne(2139),x=ne(1388),M=ne(9235),C=ne(2012),E=ne(9721),Y=ne(6381),Xe.exports=q=function(z){G(te,z);function te(V){te.__super__.constructor.call(this,V)}return te.prototype.document=function(V){var de,P,p,K,me;for(this.textispresent=!1,K="",me=V.children,P=0,p=me.length;P<p;P++)de=me[P],!(de instanceof T)&&(K+=function(){switch(!1){case!(de instanceof R):return this.declaration(de);case!(de instanceof L):return this.docType(de);case!(de instanceof X):return this.comment(de);case!(de instanceof W):return this.processingInstruction(de);default:return this.element(de,0)}}.call(this));return this.pretty&&K.slice(-this.newline.length)===this.newline&&(K=K.slice(0,-this.newline.length)),K},te.prototype.attribute=function(V){return" "+V.name+'="'+V.value+'"'},te.prototype.cdata=function(V,de){return this.space(de)+"<![CDATA["+V.text+"]]>"+this.newline},te.prototype.comment=function(V,de){return this.space(de)+"<!-- "+V.text+" -->"+this.newline},te.prototype.declaration=function(V,de){var P;return P=this.space(de),P+='<?xml version="'+V.version+'"',V.encoding!=null&&(P+=' encoding="'+V.encoding+'"'),V.standalone!=null&&(P+=' standalone="'+V.standalone+'"'),P+=this.spacebeforeslash+"?>",P+=this.newline,P},te.prototype.docType=function(V,de){var P,p,K,me,pe;if(de||(de=0),me=this.space(de),me+="<!DOCTYPE "+V.root().name,V.pubID&&V.sysID?me+=' PUBLIC "'+V.pubID+'" "'+V.sysID+'"':V.sysID&&(me+=' SYSTEM "'+V.sysID+'"'),V.children.length>0){for(me+=" [",me+=this.newline,pe=V.children,p=0,K=pe.length;p<K;p++)P=pe[p],me+=function(){switch(!1){case!(P instanceof x):return this.dtdAttList(P,de+1);case!(P instanceof M):return this.dtdElement(P,de+1);case!(P instanceof C):return this.dtdEntity(P,de+1);case!(P instanceof E):return this.dtdNotation(P,de+1);case!(P instanceof I):return this.cdata(P,de+1);case!(P instanceof X):return this.comment(P,de+1);case!(P instanceof W):return this.processingInstruction(P,de+1);default:throw new Error("Unknown DTD node type: "+P.constructor.name)}}.call(this);me+="]"}return me+=this.spacebeforeslash+">",me+=this.newline,me},te.prototype.element=function(V,de){var P,p,K,me,pe,le,ue,A,N,oe,ge,ve,ke;de||(de=0),ke=!1,this.textispresent?(this.newline="",this.pretty=!1):(this.newline=this.newlinedefault,this.pretty=this.prettydefault),ve=this.space(de),A="",A+=ve+"<"+V.name,N=V.attributes;for(ue in N)J.call(N,ue)&&(P=N[ue],A+=this.attribute(P));if(V.children.length===0||V.children.every(function(Ye){return Ye.value===""}))this.allowEmpty?A+="></"+V.name+">"+this.newline:A+=this.spacebeforeslash+"/>"+this.newline;else if(this.pretty&&V.children.length===1&&V.children[0].value!=null)A+=">",A+=V.children[0].value,A+="</"+V.name+">"+this.newline;else{if(this.dontprettytextnodes){for(oe=V.children,K=0,pe=oe.length;K<pe;K++)if(p=oe[K],p.value!=null){this.textispresent++,ke=!0;break}}for(this.textispresent&&(this.newline="",this.pretty=!1,ve=this.space(de)),A+=">"+this.newline,ge=V.children,me=0,le=ge.length;me<le;me++)p=ge[me],A+=function(){switch(!1){case!(p instanceof I):return this.cdata(p,de+1);case!(p instanceof X):return this.comment(p,de+1);case!(p instanceof O):return this.element(p,de+1);case!(p instanceof D):return this.raw(p,de+1);case!(p instanceof F):return this.text(p,de+1);case!(p instanceof W):return this.processingInstruction(p,de+1);case!(p instanceof T):return"";default:throw new Error("Unknown XML node type: "+p.constructor.name)}}.call(this);ke&&this.textispresent--,this.textispresent||(this.newline=this.newlinedefault,this.pretty=this.prettydefault),A+=ve+"</"+V.name+">"+this.newline}return A},te.prototype.processingInstruction=function(V,de){var P;return P=this.space(de)+"<?"+V.target,V.value&&(P+=" "+V.value),P+=this.spacebeforeslash+"?>"+this.newline,P},te.prototype.raw=function(V,de){return this.space(de)+V.value+this.newline},te.prototype.text=function(V,de){return this.space(de)+V.value+this.newline},te.prototype.dtdAttList=function(V,de){var P;return P=this.space(de)+"<!ATTLIST "+V.elementName+" "+V.attributeName+" "+V.attributeType,V.defaultValueType!=="#DEFAULT"&&(P+=" "+V.defaultValueType),V.defaultValue&&(P+=' "'+V.defaultValue+'"'),P+=this.spacebeforeslash+">"+this.newline,P},te.prototype.dtdElement=function(V,de){return this.space(de)+"<!ELEMENT "+V.name+" "+V.value+this.spacebeforeslash+">"+this.newline},te.prototype.dtdEntity=function(V,de){var P;return P=this.space(de)+"<!ENTITY",V.pe&&(P+=" %"),P+=" "+V.name,V.value?P+=' "'+V.value+'"':(V.pubID&&V.sysID?P+=' PUBLIC "'+V.pubID+'" "'+V.sysID+'"':V.sysID&&(P+=' SYSTEM "'+V.sysID+'"'),V.nData&&(P+=" NDATA "+V.nData)),P+=this.spacebeforeslash+">"+this.newline,P},te.prototype.dtdNotation=function(V,de){var P;return P=this.space(de)+"<!NOTATION "+V.name,V.pubID&&V.sysID?P+=' PUBLIC "'+V.pubID+'" "'+V.sysID+'"':V.pubID?P+=' PUBLIC "'+V.pubID+'"':V.sysID&&(P+=' SYSTEM "'+V.sysID+'"'),P+=this.spacebeforeslash+">"+this.newline,P},te.prototype.openNode=function(V,de){var P,p,K,me;if(de||(de=0),V instanceof O){K=this.space(de)+"<"+V.name,me=V.attributes;for(p in me)J.call(me,p)&&(P=me[p],K+=this.attribute(P));return K+=(V.children?">":"/>")+this.newline,K}else return K=this.space(de)+"<!DOCTYPE "+V.rootNodeName,V.pubID&&V.sysID?K+=' PUBLIC "'+V.pubID+'" "'+V.sysID+'"':V.sysID&&(K+=' SYSTEM "'+V.sysID+'"'),K+=(V.children?" [":">")+this.newline,K},te.prototype.closeNode=function(V,de){switch(de||(de=0),!1){case!(V instanceof O):return this.space(de)+"</"+V.name+">"+this.newline;case!(V instanceof L):return this.space(de)+"]>"+this.newline}},te}(Y)}).call(this)},9354:(Xe,ce,ne)=>{var I=ne(6881);function X(T,O,W){return M(I.element(T,O,{fresh:!1}),W)}function x(T,O,W){var D=I.element(T,O,{fresh:!0});return M(D,W)}function M(T,O){return{type:"element",tag:T,children:O||[]}}function C(T){return{type:"text",value:T}}var E={type:"forceWrite"};ce.freshElement=x,ce.nonFreshElement=X,ce.elementWithTag=M,ce.text=C,ce.forceWrite=E;var R={br:!0,hr:!0,img:!0,input:!0};function L(T){return T.children.length===0&&R[T.tag.tagName]}ce.isVoidElement=L},9461:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I){var X=ne(7443),x=ne(7048).keys,M=X.tryCatch,C=X.errorObj;function E(R,L,T){return function(O){var W=T._boundValue();e:for(var D=0;D<R.length;++D){var q=R[D];if(q===Error||q!=null&&q.prototype instanceof Error){if(O instanceof q)return M(L).call(W,O)}else if(typeof q=="function"){var F=M(q).call(W,O);if(F===C)return F;if(F)return M(L).call(W,O)}else if(X.isObject(O)){for(var Y=x(q),G=0;G<Y.length;++G){var J=Y[G];if(q[J]!=O[J])continue e}return M(L).call(W,O)}}return I}}return E}},9482:(Xe,ce,ne)=>{"use strict";Xe.exports=function(){var I=function(){return new D(`circular promise resolution chain

    See http://goo.gl/MqrFmX
`)},X=function(){return new A.PromiseInspection(this._target())},x=function(ve){return A.reject(new D(ve))};function M(){}var C={},E=ne(7443),R;E.isNode?R=function(){var ve=process.domain;return ve===void 0&&(ve=null),ve}:R=function(){return null},E.notEnumerableProp(A,"_getDomain",R);var L=ne(7048),T=ne(5715),O=new T;L.defineProperty(A,"_async",{value:O});var W=ne(9556),D=A.TypeError=W.TypeError;A.RangeError=W.RangeError;var q=A.CancellationError=W.CancellationError;A.TimeoutError=W.TimeoutError,A.OperationalError=W.OperationalError,A.RejectionError=W.OperationalError,A.AggregateError=W.AggregateError;var F=function(){},Y={},G={},J=ne(5199)(A,F),z=ne(8296)(A,F,J,x,M),te=ne(4208)(A),V=te.create,de=ne(6265)(A,te),P=de.CapturedTrace,p=ne(9580)(A,J),K=ne(9461)(G),me=ne(5644),pe=E.errorObj,le=E.tryCatch;function ue(ve,ke){if(typeof ke!="function")throw new D("expecting a function but got "+E.classString(ke));if(ve.constructor!==A)throw new D(`the promise constructor cannot be invoked directly

    See http://goo.gl/MqrFmX
`)}function A(ve){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,ve!==F&&(ue(this,ve),this._resolveFromExecutor(ve)),this._promiseCreated(),this._fireEvent("promiseCreated",this)}A.prototype.toString=function(){return"[object Promise]"},A.prototype.caught=A.prototype.catch=function(ve){var ke=arguments.length;if(ke>1){var Ye=new Array(ke-1),Le=0,Fe;for(Fe=0;Fe<ke-1;++Fe){var st=arguments[Fe];if(E.isObject(st))Ye[Le++]=st;else return x("expecting an object but got A catch statement predicate "+E.classString(st))}return Ye.length=Le,ve=arguments[Fe],this.then(void 0,K(Ye,ve,this))}return this.then(void 0,ve)},A.prototype.reflect=function(){return this._then(X,X,void 0,this,void 0)},A.prototype.then=function(ve,ke){if(de.warnings()&&arguments.length>0&&typeof ve!="function"&&typeof ke!="function"){var Ye=".then() only accepts functions but was passed: "+E.classString(ve);arguments.length>1&&(Ye+=", "+E.classString(ke)),this._warn(Ye)}return this._then(ve,ke,void 0,void 0,void 0)},A.prototype.done=function(ve,ke){var Ye=this._then(ve,ke,void 0,void 0,void 0);Ye._setIsFinal()},A.prototype.spread=function(ve){return typeof ve!="function"?x("expecting a function but got "+E.classString(ve)):this.all()._then(ve,void 0,void 0,Y,void 0)},A.prototype.toJSON=function(){var ve={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(ve.fulfillmentValue=this.value(),ve.isFulfilled=!0):this.isRejected()&&(ve.rejectionReason=this.reason(),ve.isRejected=!0),ve},A.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new z(this).promise()},A.prototype.error=function(ve){return this.caught(E.originatesFromRejection,ve)},A.getNewLibraryCopy=Xe.exports,A.is=function(ve){return ve instanceof A},A.fromNode=A.fromCallback=function(ve){var ke=new A(F);ke._captureStackTrace();var Ye=arguments.length>1?!!Object(arguments[1]).multiArgs:!1,Le=le(ve)(me(ke,Ye));return Le===pe&&ke._rejectCallback(Le.e,!0),ke._isFateSealed()||ke._setAsyncGuaranteed(),ke},A.all=function(ve){return new z(ve).promise()},A.cast=function(ve){var ke=J(ve);return ke instanceof A||(ke=new A(F),ke._captureStackTrace(),ke._setFulfilled(),ke._rejectionHandler0=ve),ke},A.resolve=A.fulfilled=A.cast,A.reject=A.rejected=function(ve){var ke=new A(F);return ke._captureStackTrace(),ke._rejectCallback(ve,!0),ke},A.setScheduler=function(ve){if(typeof ve!="function")throw new D("expecting a function but got "+E.classString(ve));return O.setScheduler(ve)},A.prototype._then=function(ve,ke,Ye,Le,Fe){var st=Fe!==void 0,Ee=st?Fe:new A(F),pt=this._target(),$t=pt._bitField;st||(Ee._propagateFrom(this,3),Ee._captureStackTrace(),Le===void 0&&this._bitField&2097152&&($t&50397184?Le=this._boundValue():Le=pt===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,Ee));var It=R();if($t&50397184){var _t,jt,zt=pt._settlePromiseCtx;$t&33554432?(jt=pt._rejectionHandler0,_t=ve):$t&16777216?(jt=pt._fulfillmentHandler0,_t=ke,pt._unsetRejectionIsUnhandled()):(zt=pt._settlePromiseLateCancellationObserver,jt=new q("late cancellation observer"),pt._attachExtraTrace(jt),_t=ke),O.invoke(zt,pt,{handler:It===null?_t:typeof _t=="function"&&E.domainBind(It,_t),promise:Ee,receiver:Le,value:jt})}else pt._addCallbacks(ve,ke,Ee,Le,It);return Ee},A.prototype._length=function(){return this._bitField&65535},A.prototype._isFateSealed=function(){return(this._bitField&117506048)!==0},A.prototype._isFollowing=function(){return(this._bitField&67108864)===67108864},A.prototype._setLength=function(ve){this._bitField=this._bitField&-65536|ve&65535},A.prototype._setFulfilled=function(){this._bitField=this._bitField|33554432,this._fireEvent("promiseFulfilled",this)},A.prototype._setRejected=function(){this._bitField=this._bitField|16777216,this._fireEvent("promiseRejected",this)},A.prototype._setFollowing=function(){this._bitField=this._bitField|67108864,this._fireEvent("promiseResolved",this)},A.prototype._setIsFinal=function(){this._bitField=this._bitField|4194304},A.prototype._isFinal=function(){return(this._bitField&4194304)>0},A.prototype._unsetCancelled=function(){this._bitField=this._bitField&-65537},A.prototype._setCancelled=function(){this._bitField=this._bitField|65536,this._fireEvent("promiseCancelled",this)},A.prototype._setWillBeCancelled=function(){this._bitField=this._bitField|8388608},A.prototype._setAsyncGuaranteed=function(){O.hasCustomScheduler()||(this._bitField=this._bitField|134217728)},A.prototype._receiverAt=function(ve){var ke=ve===0?this._receiver0:this[ve*4-4+3];if(ke!==C)return ke===void 0&&this._isBound()?this._boundValue():ke},A.prototype._promiseAt=function(ve){return this[ve*4-4+2]},A.prototype._fulfillmentHandlerAt=function(ve){return this[ve*4-4+0]},A.prototype._rejectionHandlerAt=function(ve){return this[ve*4-4+1]},A.prototype._boundValue=function(){},A.prototype._migrateCallback0=function(ve){var ke=ve._bitField,Ye=ve._fulfillmentHandler0,Le=ve._rejectionHandler0,Fe=ve._promise0,st=ve._receiverAt(0);st===void 0&&(st=C),this._addCallbacks(Ye,Le,Fe,st,null)},A.prototype._migrateCallbackAt=function(ve,ke){var Ye=ve._fulfillmentHandlerAt(ke),Le=ve._rejectionHandlerAt(ke),Fe=ve._promiseAt(ke),st=ve._receiverAt(ke);st===void 0&&(st=C),this._addCallbacks(Ye,Le,Fe,st,null)},A.prototype._addCallbacks=function(ve,ke,Ye,Le,Fe){var st=this._length();if(st>=65531&&(st=0,this._setLength(0)),st===0)this._promise0=Ye,this._receiver0=Le,typeof ve=="function"&&(this._fulfillmentHandler0=Fe===null?ve:E.domainBind(Fe,ve)),typeof ke=="function"&&(this._rejectionHandler0=Fe===null?ke:E.domainBind(Fe,ke));else{var Ee=st*4-4;this[Ee+2]=Ye,this[Ee+3]=Le,typeof ve=="function"&&(this[Ee+0]=Fe===null?ve:E.domainBind(Fe,ve)),typeof ke=="function"&&(this[Ee+1]=Fe===null?ke:E.domainBind(Fe,ke))}return this._setLength(st+1),st},A.prototype._proxy=function(ve,ke){this._addCallbacks(void 0,void 0,ke,ve,null)},A.prototype._resolveCallback=function(ve,ke){if(!(this._bitField&117506048)){if(ve===this)return this._rejectCallback(I(),!1);var Ye=J(ve,this);if(!(Ye instanceof A))return this._fulfill(ve);ke&&this._propagateFrom(Ye,2);var Le=Ye._target();if(Le===this){this._reject(I());return}var Fe=Le._bitField;if(Fe&50397184)if(Fe&33554432)this._fulfill(Le._value());else if(Fe&16777216)this._reject(Le._reason());else{var pt=new q("late cancellation observer");Le._attachExtraTrace(pt),this._reject(pt)}else{var st=this._length();st>0&&Le._migrateCallback0(this);for(var Ee=1;Ee<st;++Ee)Le._migrateCallbackAt(this,Ee);this._setFollowing(),this._setLength(0),this._setFollowee(Le)}}},A.prototype._rejectCallback=function(ve,ke,Ye){var Le=E.ensureErrorObject(ve),Fe=Le===ve;if(!Fe&&!Ye&&de.warnings()){var st="a promise was rejected with a non-error: "+E.classString(ve);this._warn(st,!0)}this._attachExtraTrace(Le,ke?Fe:!1),this._reject(ve)},A.prototype._resolveFromExecutor=function(ve){var ke=this;this._captureStackTrace(),this._pushContext();var Ye=!0,Le=this._execute(ve,function(Fe){ke._resolveCallback(Fe)},function(Fe){ke._rejectCallback(Fe,Ye)});Ye=!1,this._popContext(),Le!==void 0&&ke._rejectCallback(Le,!0)},A.prototype._settlePromiseFromHandler=function(ve,ke,Ye,Le){var Fe=Le._bitField;if(!(Fe&65536)){Le._pushContext();var st;ke===Y?!Ye||typeof Ye.length!="number"?(st=pe,st.e=new D("cannot .spread() a non-array: "+E.classString(Ye))):st=le(ve).apply(this._boundValue(),Ye):st=le(ve).call(ke,Ye);var Ee=Le._popContext();Fe=Le._bitField,!(Fe&65536)&&(st===G?Le._reject(Ye):st===pe?Le._rejectCallback(st.e,!1):(de.checkForgottenReturns(st,Ee,"",Le,this),Le._resolveCallback(st)))}},A.prototype._target=function(){for(var ve=this;ve._isFollowing();)ve=ve._followee();return ve},A.prototype._followee=function(){return this._rejectionHandler0},A.prototype._setFollowee=function(ve){this._rejectionHandler0=ve},A.prototype._settlePromise=function(ve,ke,Ye,Le){var Fe=ve instanceof A,st=this._bitField,Ee=(st&134217728)!==0;st&65536?(Fe&&ve._invokeInternalOnCancel(),Ye instanceof p&&Ye.isFinallyHandler()?(Ye.cancelPromise=ve,le(ke).call(Ye,Le)===pe&&ve._reject(pe.e)):ke===X?ve._fulfill(X.call(Ye)):Ye instanceof M?Ye._promiseCancelled(ve):Fe||ve instanceof z?ve._cancel():Ye.cancel()):typeof ke=="function"?Fe?(Ee&&ve._setAsyncGuaranteed(),this._settlePromiseFromHandler(ke,Ye,Le,ve)):ke.call(Ye,Le,ve):Ye instanceof M?Ye._isResolved()||(st&33554432?Ye._promiseFulfilled(Le,ve):Ye._promiseRejected(Le,ve)):Fe&&(Ee&&ve._setAsyncGuaranteed(),st&33554432?ve._fulfill(Le):ve._reject(Le))},A.prototype._settlePromiseLateCancellationObserver=function(ve){var ke=ve.handler,Ye=ve.promise,Le=ve.receiver,Fe=ve.value;typeof ke=="function"?Ye instanceof A?this._settlePromiseFromHandler(ke,Le,Fe,Ye):ke.call(Le,Fe,Ye):Ye instanceof A&&Ye._reject(Fe)},A.prototype._settlePromiseCtx=function(ve){this._settlePromise(ve.promise,ve.handler,ve.receiver,ve.value)},A.prototype._settlePromise0=function(ve,ke,Ye){var Le=this._promise0,Fe=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(Le,ve,Fe,ke)},A.prototype._clearCallbackDataAtIndex=function(ve){var ke=ve*4-4;this[ke+2]=this[ke+3]=this[ke+0]=this[ke+1]=void 0},A.prototype._fulfill=function(ve){var ke=this._bitField;if(!((ke&117506048)>>>16)){if(ve===this){var Ye=I();return this._attachExtraTrace(Ye),this._reject(Ye)}this._setFulfilled(),this._rejectionHandler0=ve,(ke&65535)>0&&(ke&134217728?this._settlePromises():O.settlePromises(this))}},A.prototype._reject=function(ve){var ke=this._bitField;if(!((ke&117506048)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=ve,this._isFinal())return O.fatalError(ve,E.isNode);(ke&65535)>0?O.settlePromises(this):this._ensurePossibleRejectionHandled()}},A.prototype._fulfillPromises=function(ve,ke){for(var Ye=1;Ye<ve;Ye++){var Le=this._fulfillmentHandlerAt(Ye),Fe=this._promiseAt(Ye),st=this._receiverAt(Ye);this._clearCallbackDataAtIndex(Ye),this._settlePromise(Fe,Le,st,ke)}},A.prototype._rejectPromises=function(ve,ke){for(var Ye=1;Ye<ve;Ye++){var Le=this._rejectionHandlerAt(Ye),Fe=this._promiseAt(Ye),st=this._receiverAt(Ye);this._clearCallbackDataAtIndex(Ye),this._settlePromise(Fe,Le,st,ke)}},A.prototype._settlePromises=function(){var ve=this._bitField,ke=ve&65535;if(ke>0){if(ve&16842752){var Ye=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,Ye,ve),this._rejectPromises(ke,Ye)}else{var Le=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,Le,ve),this._fulfillPromises(ke,Le)}this._setLength(0)}this._clearCancellationData()},A.prototype._settledValue=function(){var ve=this._bitField;if(ve&33554432)return this._rejectionHandler0;if(ve&16777216)return this._fulfillmentHandler0};function N(ve){this.promise._resolveCallback(ve)}function oe(ve){this.promise._rejectCallback(ve,!1)}A.defer=A.pending=function(){de.deprecated("Promise.defer","new Promise");var ve=new A(F);return{promise:ve,resolve:N,reject:oe}},E.notEnumerableProp(A,"_makeSelfResolutionError",I),ne(1882)(A,F,J,x,de),ne(8204)(A,F,J,de),ne(9213)(A,z,x,de),ne(3197)(A),ne(5395)(A),ne(3623)(A,z,J,F,O,R),A.Promise=A,A.version="3.4.7",ne(409)(A,z,x,J,F,de),ne(6436)(A),ne(8419)(A,x,J,V,F,de),ne(5793)(A,F,de),ne(1125)(A,x,F,J,M,de),ne(4793)(A),ne(4927)(A,F),ne(89)(A,z,J,x),ne(7894)(A,F,J,x),ne(3969)(A,z,x,J,F,de),ne(6188)(A,z,de),ne(727)(A,z,x),ne(3837)(A,F),ne(7954)(A,F),ne(7781)(A),E.toFastProperties(A),E.toFastProperties(A.prototype);function ge(ve){var ke=new A(F);ke._fulfillmentHandler0=ve,ke._rejectionHandler0=ve,ke._promise0=ve,ke._receiver0=ve}return ge({a:1}),ge({b:2}),ge({c:3}),ge(1),ge(function(){}),ge(void 0),ge(!1),ge(new A(F)),de.setBounds(T.firstLineError,E.lastLineError),A}},9556:(Xe,ce,ne)=>{"use strict";var I=ne(7048),X=I.freeze,x=ne(7443),M=x.inherits,C=x.notEnumerableProp;function E(z,te){function V(de){if(!(this instanceof V))return new V(de);C(this,"message",typeof de=="string"?de:te),C(this,"name",z),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return M(V,Error),V}var R,L,T=E("Warning","warning"),O=E("CancellationError","cancellation error"),W=E("TimeoutError","timeout error"),D=E("AggregateError","aggregate error");try{R=TypeError,L=RangeError}catch(z){R=E("TypeError","type error"),L=E("RangeError","range error")}for(var q="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),F=0;F<q.length;++F)typeof Array.prototype[q[F]]=="function"&&(D.prototype[q[F]]=Array.prototype[q[F]]);I.defineProperty(D.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),D.prototype.isOperational=!0;var Y=0;D.prototype.toString=function(){var z=Array(Y*4+1).join(" "),te=`
`+z+`AggregateError of:
`;Y++,z=Array(Y*4+1).join(" ");for(var V=0;V<this.length;++V){for(var de=this[V]===this?"[Circular AggregateError]":this[V]+"",P=de.split(`
`),p=0;p<P.length;++p)P[p]=z+P[p];de=P.join(`
`),te+=de+`
`}return Y--,te};function G(z){if(!(this instanceof G))return new G(z);C(this,"name","OperationalError"),C(this,"message",z),this.cause=z,this.isOperational=!0,z instanceof Error?(C(this,"message",z.message),C(this,"stack",z.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}M(G,Error);var J=Error.__BluebirdErrorTypes__;J||(J=X({CancellationError:O,TimeoutError:W,OperationalError:G,RejectionError:G,AggregateError:D}),I.defineProperty(Error,"__BluebirdErrorTypes__",{value:J,writable:!1,enumerable:!1,configurable:!1})),Xe.exports={Error,TypeError:R,RangeError:L,CancellationError:J.CancellationError,OperationalError:J.OperationalError,TimeoutError:J.TimeoutError,AggregateError:J.AggregateError,Warning:T}},9578:function(Xe,ce,ne){(function(){var I,X,x=function(C,E){for(var R in E)M.call(E,R)&&(C[R]=E[R]);function L(){this.constructor=C}return L.prototype=E.prototype,C.prototype=new L,C.__super__=E.prototype,C},M={}.hasOwnProperty;I=ne(3523),Xe.exports=X=function(C){x(E,C);function E(R,L,T){if(E.__super__.constructor.call(this,R),L==null)throw new Error("Missing instruction target. "+this.debugInfo());this.target=this.stringify.insTarget(L),T&&(this.value=this.stringify.insValue(T))}return E.prototype.clone=function(){return Object.create(this)},E.prototype.toString=function(R){return this.options.writer.set(R).processingInstruction(this)},E}(I)}).call(this)},9580:(Xe,ce,ne)=>{"use strict";Xe.exports=function(I,X){var x=ne(7443),M=I.CancellationError,C=x.errorObj;function E(D,q,F){this.promise=D,this.type=q,this.handler=F,this.called=!1,this.cancelPromise=null}E.prototype.isFinallyHandler=function(){return this.type===0};function R(D){this.finallyHandler=D}R.prototype._resultCancelled=function(){L(this.finallyHandler)};function L(D,q){return D.cancelPromise!=null?(arguments.length>1?D.cancelPromise._reject(q):D.cancelPromise._cancel(),D.cancelPromise=null,!0):!1}function T(){return W.call(this,this.promise._target()._settledValue())}function O(D){if(!L(this,D))return C.e=D,C}function W(D){var q=this.promise,F=this.handler;if(!this.called){this.called=!0;var Y=this.isFinallyHandler()?F.call(q._boundValue()):F.call(q._boundValue(),D);if(Y!==void 0){q._setReturnedNonUndefined();var G=X(Y,q);if(G instanceof I){if(this.cancelPromise!=null)if(G._isCancelled()){var J=new M("late cancellation observer");return q._attachExtraTrace(J),C.e=J,C}else G.isPending()&&G._attachCancellationCallback(new R(this));return G._then(T,O,void 0,this,void 0)}}}return q.isRejected()?(L(this),C.e=D,C):(L(this),D)}return I.prototype._passThrough=function(D,q,F,Y){return typeof D!="function"?this.then():this._then(F,Y,void 0,new E(this,q,D),void 0)},I.prototype.lastly=I.prototype.finally=function(D){return this._passThrough(D,0,W,W)},I.prototype.tap=function(D){return this._passThrough(D,1,W)},E}},9623:(Xe,ce,ne)=>{ce.read=Y,ce._findPartPaths=G;var I=ne(3746),X=ne(9796),x=ne(5584).Result,M=ne(2323),C=ne(4361).V,E=ne(5457).M,R=ne(1026).O,L=ne(2464),T=ne(586),O=ne(3970),W=ne(4951),D=ne(174),q=ne(8223),F=ne(9087).s;function Y(pe,le,ue){le=le||{},ue=ue||{};var A=new F({externalFileAccess:ue.externalFileAccess,relativeToFile:le.path});return I.props({contentTypes:P(pe),partPaths:G(pe),docxFile:pe,files:A}).also(function(N){return{styles:K(pe,N.partPaths.styles)}}).also(function(N){return{numbering:p(pe,N.partPaths.numbering,N.styles)}}).also(function(N){return{footnotes:V(N.partPaths.footnotes,N,function(oe,ge){return ge?D.createFootnotesReader(oe)(ge):new x([])}),endnotes:V(N.partPaths.endnotes,N,function(oe,ge){return ge?D.createEndnotesReader(oe)(ge):new x([])}),comments:V(N.partPaths.comments,N,function(oe,ge){return ge?q.createCommentsReader(oe)(ge):new x([])})}}).also(function(N){return{notes:N.footnotes.flatMap(function(oe){return N.endnotes.map(function(ge){return new X.Notes(oe.concat(ge))})})}}).then(function(N){return V(N.partPaths.mainDocument,N,function(oe,ge){return N.notes.flatMap(function(ve){return N.comments.flatMap(function(ke){var Ye=new R({bodyReader:oe,notes:ve,comments:ke});return Ye.convertXmlToDocument(ge)})})})})}function G(pe){return me(pe).then(function(le){var ue=J({docxFile:pe,relationships:le,relationshipType:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",basePath:"",fallbackPath:"word/document.xml"});if(!pe.exists(ue))throw new Error("Could not find main document part. Are you sure this is a valid .docx file?");return te({filename:de(ue),readElement:L.readRelationships,defaultValue:L.defaultValue})(pe).then(function(A){function N(oe){return J({docxFile:pe,relationships:A,relationshipType:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/"+oe,basePath:M.splitPath(ue).dirname,fallbackPath:"word/"+oe+".xml"})}return{mainDocument:ue,comments:N("comments"),endnotes:N("endnotes"),footnotes:N("footnotes"),numbering:N("numbering"),styles:N("styles")}})})}function J(pe){var le=pe.docxFile,ue=pe.relationships,A=pe.relationshipType,N=pe.basePath,oe=pe.fallbackPath,ge=ue.findTargetsByType(A),ve=ge.map(function(Ye){return z(M.joinPath(N,Ye),"/")}),ke=ve.filter(function(Ye){return le.exists(Ye)});return ke.length===0?oe:ke[0]}function z(pe,le){return pe.substring(0,le.length)===le?pe.substring(le.length):pe}function te(pe){return function(le){return C(le,pe.filename).then(function(ue){return ue?pe.readElement(ue):pe.defaultValue})}}function V(pe,le,ue){var A=te({filename:de(pe),readElement:L.readRelationships,defaultValue:L.defaultValue});return A(le.docxFile).then(function(N){var oe=new E({relationships:N,contentTypes:le.contentTypes,docxFile:le.docxFile,numbering:le.numbering,styles:le.styles,files:le.files});return C(le.docxFile,pe).then(function(ge){return ue(oe,ge)})})}function de(pe){var le=M.splitPath(pe);return M.joinPath(le.dirname,"_rels",le.basename+".rels")}var P=te({filename:"[Content_Types].xml",readElement:T.readContentTypesFromXml,defaultValue:T.defaultContentTypes});function p(pe,le,ue){return te({filename:le,readElement:function(A){return O.readNumberingXml(A,{styles:ue})},defaultValue:O.defaultNumbering})(pe)}function K(pe,le){return te({filename:le,readElement:W.readStylesXml,defaultValue:W.defaultStyles})(pe)}var me=te({filename:"_rels/.rels",readElement:L.readRelationships,defaultValue:L.defaultValue})},9689:(Xe,ce,ne)=>{var I=ne(3746),X=ne(8291),x=ne(7453),M=ne(4501),C=M.Element;ce.readString=R;var E=x.Node;function R(L,T){T=T||{};try{var O=x.parseFromString(L,"text/xml")}catch(F){return I.reject(F)}if(O.documentElement.tagName==="parsererror")return I.resolve(new Error(O.documentElement.textContent));function W(F){switch(F.nodeType){case E.ELEMENT_NODE:return D(F);case E.TEXT_NODE:return M.text(F.nodeValue)}}function D(F){var Y=q(F),G=[];X.forEach(F.childNodes,function(z){var te=W(z);te&&G.push(te)});var J={};return X.forEach(F.attributes,function(z){J[q(z)]=z.value}),new C(Y,J,G)}function q(F){if(F.namespaceURI){var Y=T[F.namespaceURI],G;return Y?G=Y+":":G="{"+F.namespaceURI+"}",G+F.localName}else return F.localName}return I.resolve(W(O.documentElement))}},9721:function(Xe,ce,ne){(function(){var I,X,x=function(C,E){for(var R in E)M.call(E,R)&&(C[R]=E[R]);function L(){this.constructor=C}return L.prototype=E.prototype,C.prototype=new L,C.__super__=E.prototype,C},M={}.hasOwnProperty;X=ne(3523),Xe.exports=I=function(C){x(E,C);function E(R,L,T){if(E.__super__.constructor.call(this,R),L==null)throw new Error("Missing DTD notation name. "+this.debugInfo(L));if(!T.pubID&&!T.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(L));this.name=this.stringify.eleName(L),T.pubID!=null&&(this.pubID=this.stringify.dtdPubID(T.pubID)),T.sysID!=null&&(this.sysID=this.stringify.dtdSysID(T.sysID))}return E.prototype.toString=function(R){return this.options.writer.set(R).dtdNotation(this)},E}(X)}).call(this)},9796:(Xe,ce,ne)=>{var I=ne(8291),X=ce.types={document:"document",paragraph:"paragraph",run:"run",text:"text",tab:"tab",checkbox:"checkbox",hyperlink:"hyperlink",noteReference:"noteReference",image:"image",note:"note",commentReference:"commentReference",comment:"comment",table:"table",tableRow:"tableRow",tableCell:"tableCell",break:"break",bookmarkStart:"bookmarkStart"};function x(p,K){return K=K||{},{type:X.document,children:p,notes:K.notes||new D({}),comments:K.comments||[]}}function M(p,K){K=K||{};var me=K.indent||{};return{type:X.paragraph,children:p,styleId:K.styleId||null,styleName:K.styleName||null,numbering:K.numbering||null,alignment:K.alignment||null,indent:{start:me.start||null,end:me.end||null,firstLine:me.firstLine||null,hanging:me.hanging||null}}}function C(p,K){return K=K||{},{type:X.run,children:p,styleId:K.styleId||null,styleName:K.styleName||null,isBold:!!K.isBold,isUnderline:!!K.isUnderline,isItalic:!!K.isItalic,isStrikethrough:!!K.isStrikethrough,isAllCaps:!!K.isAllCaps,isSmallCaps:!!K.isSmallCaps,verticalAlignment:K.verticalAlignment||E.baseline,font:K.font||null,fontSize:K.fontSize||null,highlight:K.highlight||null}}var E={baseline:"baseline",superscript:"superscript",subscript:"subscript"};function R(p){return{type:X.text,value:p}}function L(){return{type:X.tab}}function T(p){return{type:X.checkbox,checked:p.checked}}function O(p,K){return{type:X.hyperlink,children:p,href:K.href,anchor:K.anchor,targetFrame:K.targetFrame}}function W(p){return{type:X.noteReference,noteType:p.noteType,noteId:p.noteId}}function D(p){this._notes=I.indexBy(p,function(K){return G(K.noteType,K.noteId)})}D.prototype.resolve=function(p){return this.findNoteByKey(G(p.noteType,p.noteId))},D.prototype.findNoteByKey=function(p){return this._notes[p]||null};function q(p){return{type:X.note,noteType:p.noteType,noteId:p.noteId,body:p.body}}function F(p){return{type:X.commentReference,commentId:p.commentId}}function Y(p){return{type:X.comment,commentId:p.commentId,body:p.body,authorName:p.authorName,authorInitials:p.authorInitials}}function G(p,K){return p+"-"+K}function J(p){return{type:X.image,read:function(K){return K?p.readImage(K):p.readImage().then(function(me){return Buffer.from(me)})},readAsArrayBuffer:function(){return p.readImage()},readAsBase64String:function(){return p.readImage("base64")},readAsBuffer:function(){return p.readImage().then(function(K){return Buffer.from(K)})},altText:p.altText,contentType:p.contentType}}function z(p,K){return K=K||{},{type:X.table,children:p,styleId:K.styleId||null,styleName:K.styleName||null}}function te(p,K){return K=K||{},{type:X.tableRow,children:p,isHeader:K.isHeader||!1}}function V(p,K){return K=K||{},{type:X.tableCell,children:p,colSpan:K.colSpan==null?1:K.colSpan,rowSpan:K.rowSpan==null?1:K.rowSpan}}function de(p){return{type:X.break,breakType:p}}function P(p){return{type:X.bookmarkStart,name:p.name}}ce.document=ce.Document=x,ce.paragraph=ce.Paragraph=M,ce.run=ce.Run=C,ce.text=ce.Text=R,ce.tab=ce.Tab=L,ce.checkbox=ce.Checkbox=T,ce.Hyperlink=O,ce.noteReference=ce.NoteReference=W,ce.Notes=D,ce.Note=q,ce.commentReference=F,ce.comment=Y,ce.Image=J,ce.Table=z,ce.TableRow=te,ce.TableCell=V,ce.lineBreak=de("line"),ce.pageBreak=de("page"),ce.columnBreak=de("column"),ce.BookmarkStart=P,ce.verticalAlignment=E},9819:(Xe,ce,ne)=>{var I=ne(3746),X=ne(2323);ce.openZip=x;function x(M){return M.arrayBuffer?I.resolve(X.openArrayBuffer(M.arrayBuffer)):I.reject(new Error("Could not find file in options"))}}},Zn={};function Tn(Xe){var ce=Zn[Xe];if(ce!==void 0)return ce.exports;var ne=Zn[Xe]={exports:{}};return da[Xe].call(ne.exports,ne,ne.exports,Tn),ne.exports}Tn.n=Xe=>{var ce=Xe&&Xe.__esModule?()=>Xe.default:()=>Xe;return Tn.d(ce,{a:ce}),ce},Tn.d=(Xe,ce)=>{for(var ne in ce)Tn.o(ce,ne)&&!Tn.o(Xe,ne)&&Object.defineProperty(Xe,ne,{enumerable:!0,get:ce[ne]})},Tn.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch(Xe){if(typeof window=="object")return window}}(),Tn.o=(Xe,ce)=>Object.prototype.hasOwnProperty.call(Xe,ce),Tn.r=Xe=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(Xe,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(Xe,"__esModule",{value:!0})};var dd={};(()=>{"use strict";var Cc,mu,Lc,up,bu,Ic,Lw,pI,fp,sm,rm,om,yu,Nl,lm,pp,hp,rr,Mw,hI,Fw,gI,cm,dm,Pi,um,fm,nl,pm,_u,wu,mp,Mc,Cr,hm,gm,bp,yp,Xr,_p,wp,mm,Fc,Lr,bm,bi,vu,Bl,nf,vp,X0,xu,ny,Pw,mI,ym,uk,Zr,fl,Nw,bI,_m,fk,Bw,yI,$w,_I,xp,Z0,wm,pk,Ow,wI,Eu,al,ku,Su,Ep,Pc,Nc,vm,Au,ay,xm,hk,Em,gk,km,mk,Bc,nh,Rw,vI,Uw,xI,Sm,kp,Am,Tm,bk,Dm,yk,Hw,EI,Cm,_k,Lm,wk,Im,vk,Tu,iy,qw,kI,Sp,$c,Jr,$l,Du,Fm,Pm,xk,Ww,SI,Nm,Ek,Vw,AI,zw,TI,Yw,DI,Gw,CI,Oc,il,Ap,J0,jw,LI,Qr,Bm,kk,Cu,sy,$m,Sk,Kw,II,Om,Ak,Xw,MI,Xi,Tp,Lu,Zw,FI,Rm,Tk,Um,Dk,Jw,PI,Qw,NI,Hm,Ck,e0,BI,t0,$I,Dp,Q0,Iu,ry,Rc,ah,n0,OI,qm,Lk,Wm,Ik,Cp,ev,a0,RI,Vm,Mk,zm,Fk,Mu,oy,Ym,Lp,i0,UI,Uc,Co,jl,Ip,tv,Mp,nv,Hc,ih,Fp,av,Gm,Pk,s0,HI,r0,qI,jm,Nk,o0,WI,l0,VI,Km,Bk,Pp,As,qc,Wc,c0,zI,Fu,ly,d0,YI,u0,GI,f0,jI,p0,KI,Xm,$k,h0,XI,Pu,cy,g0,ZI,m0,JI,b0,QI,y0,e5,Zm,Ok,sl,Nu,Jm,Bu,$u,Qm,Vs,Ol,Np,Ni,eo,_0,t5,Bp,iv,eb,Rk,w0,n5,Ou,dy,tb,Ru,nb,Vc,zc,sh,v0,a5,ab,Uk,x0,i5,$p,sv,E0,s5,ib,Hk,Op,sb,qk,rb,Wk,ob,Vk,lb,zk,k0,r5,Rl,af,S0,o5,cb,Yk,db,Gk,A0,l5,T0,c5,D0,d5,ub,fb,pb,hb,gb,Rp,mb,Yc,bb,jk,rl,Up,Lo,Hp,qp,Wp,Gc,yb,Kk,C0,u5,_b,Xk,Ul,to,Hl,jc,Vp,rv,wb,Zk,Kc,vb,xb,Uu,ol,or,Xc,L0,f5,I0,p5,M0,h5,Hu,Eb,qu,kb,Zc,Jc,Sb,Ab,Tb,Wu,Yp,Gp,Wl,Vu,Qc,ed,rh,jp,ov,zu,uy,Db,Jk,Cb,Qk,Lb,e2,Ib,t2,Mb,n2,F0,g5,P0,m5,Fb,a2,Vl,Yu,Pb,i2,td,Nb,Bb,ll,Ir,Gu,$b,Ob,Rb,Ub,Hb,qb,nd,ju,Ku,Xu,Kp,ad,Xp,Wb,Zp,Zu,id,Jp,N0,b5,B0,y5,$0,_5,Ju,fy,Qp,lv,O0,w5,Vb,s2,R0,v5,cl,cd,zb,r2,U0,x5,H0,E5,q0,k5,Yb,o2,W0,S5,eh,cv,Io,th,dv,V0,A5,z0,T5,Gb,l2,jb,c2,sd,Kb,d2,Y0,D5,G0,C5,Xb,u2,Qu,py,rI;var Xe={};Tn.r(Xe),Tn.d(Xe,{copyPlainText:()=>kt,encodeBase64:()=>ye,exportByMobile:()=>mt,getEventName:()=>Ne,getLocalStorage:()=>ua,getScreenWidth:()=>Xa,getTextSiyuanFromTextHTML:()=>_e,isDisabledFeature:()=>pn,isHuawei:()=>Tt,isIPad:()=>yn,isIPhone:()=>bn,isInAndroid:()=>St,isInHarmony:()=>Qt,isInIOS:()=>Xt,isMac:()=>Jt,isNotCtrl:()=>ct,isOnlyMeta:()=>je,isSafari:()=>Bn,isWin11:()=>Kn,isWindows:()=>lt,openByMobile:()=>$e,readClipboard:()=>nt,readText:()=>yt,setStorageVal:()=>Gt,updateHotkeyAfterTip:()=>un,updateHotkeyTip:()=>Mt,writeText:()=>ut});const ce=new Set(["docker","ios","android","harmony"]),ne=new Set(["ios","android","harmony"]),I=()=>ce.has(window.siyuan.config.system.container),X=()=>ne.has(window.siyuan.config.system.container),x=()=>!!document.getElementById("sidebar"),M=()=>I()?window.siyuan.config.system.container:window.siyuan.config.system.os,C=()=>window.navigator.userAgent.startsWith("SiYuan/")?E()?"desktop-window":"desktop":"browser-desktop",E=()=>!document.getElementById("toolbar"),R=()=>"ontouchstart"in window&&navigator.maxTouchPoints>1,L=(t,e)=>t.length===e.length&&t.every(n=>e.includes(n)),T=(t,e)=>Math.floor(Math.random()*(e-t+1))+t,O=(t,e=window.location.search)=>{const n=e.substring(e.indexOf("?")),a=n.indexOf("#");return new URLSearchParams(n.substring(0,a>=0?a:void 0)).get(t)},W=()=>!0,D=t=>/^\(\(\d{14}-\w{7} '.*'\)\)$/.test(t),q=t=>/^<<assets\/.+\/\d{14}-\w{7} ".+">>$/.test(t),F=t=>/^[_a-zA-Z][_.\-0-9a-zA-Z]*$/.test(t),Y=t=>Function(`"use strict";return (${t})`)(),G=(t,e)=>{if(t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e))return!0;if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(!t||!e||typeof t!="object"&&typeof e!="object")return t===e;if(t.prototype!==e.prototype)return!1;const n=Object.keys(t);return n.length!==Object.keys(e).length?!1:n.every(a=>G(t[a],e[a]))},J=t=>{if(!t)return"";const e=t.match(/^(.*) \((\d+)\)$/);return e?t=`${e[1]} (${parseInt(e[2])+1})`:t=`${t} (1)`,t},z="3.4.0",te="production",V=navigator.platform.toUpperCase().indexOf("MAC")>-1?"\u2303":"\u2325",de=()=>{const t={};for(let e=1;e<=32;e++)t[e+111]="F"+e;return t},P=class{};P.SIYUAN_VERSION=z,P.NODE_ENV=te,P.SIYUAN_APPID=Math.random().toString(36).substring(8),P.ASSETS_ADDRESS="https://assets.b3logfile.com/siyuan/",P.PROTYLE_CDN="/stage/protyle",P.UPLOAD_ADDRESS="/upload",P.SERVICE_WORKER_PATH="/service-worker.js",P.SIYUAN_DROP_FILE="application/siyuan-file",P.SIYUAN_DROP_GUTTER="application/siyuan-gutter",P.SIYUAN_DROP_TAB="application/siyuan-tab",P.SIYUAN_DROP_EDITOR="application/siyuan-editor",P.SIYUAN_CMD="siyuan-cmd",P.SIYUAN_GET="siyuan-get",P.SIYUAN_EVENT="siyuan-event",P.SIYUAN_CONFIG_TRAY="siyuan-config-tray",P.SIYUAN_QUIT="siyuan-quit",P.SIYUAN_HOTKEY="siyuan-hotkey",P.SIYUAN_INIT="siyuan-init",P.SIYUAN_SEND_WINDOWS="siyuan-send-windows",P.SIYUAN_SAVE_CLOSE="siyuan-save-close",P.SIYUAN_AUTO_LAUNCH="siyuan-auto-launch",P.SIYUAN_OPEN_WORKSPACE="siyuan-open-workspace",P.SIYUAN_OPEN_URL="siyuan-open-url",P.SIYUAN_OPEN_WINDOW="siyuan-open-window",P.SIYUAN_OPEN_FILE="siyuan-open-file",P.SIYUAN_EXPORT_PDF="siyuan-export-pdf",P.SIYUAN_EXPORT_NEWWINDOW="siyuan-export-newwindow",P.SIYUAN_CONTEXT_MENU="siyuan-context-menu",P.SIYUAN_SHOW_WINDOW="siyuan-show-window",P.SIYUAN_RELOAD_WINDOW="siyuan-reload-window",P.CUSTOM_SY_READONLY="custom-sy-readonly",P.CUSTOM_SY_FULLWIDTH="custom-sy-fullwidth",P.CUSTOM_SY_AV_VIEW="custom-sy-av-view",P.CUSTOM_REMINDER_WECHAT="custom-reminder-wechat",P.CUSTOM_RIFF_DECKS="custom-riff-decks",P.SIZE_DATABASE_MAZ_SIZE=102400,P.SIZE_SCROLL_TB=24,P.SIZE_SCROLL_STEP=256,P.SIZE_LINK_TEXT_MAX=64,P.SIZE_TOOLBAR_HEIGHT=x()?0:32,P.SIZE_GET_MAX=102400,P.SIZE_UNDO=64,P.SIZE_TITLE=512,P.SIZE_EDITOR_WIDTH=760,P.SIZE_ZOOM=[{zoom:.67,position:{x:0,y:2}},{zoom:.75,position:{x:1,y:4}},{zoom:.8,position:{x:2,y:4}},{zoom:.9,position:{x:5,y:6}},{zoom:1,position:{x:8,y:8}},{zoom:1.1,position:{x:12,y:9}},{zoom:1.25,position:{x:18,y:12}},{zoom:1.5,position:{x:27,y:16}},{zoom:1.75,position:{x:36,y:20}},{zoom:2,position:{x:45,y:23}},{zoom:2.5,position:{x:63,y:31}},{zoom:3,position:{x:80,y:39}}],P.CB_MOVE_NOLIST="cb-move-nolist",P.CB_MOUNT_REMOVE="cb-mount-remove",P.CB_GET_APPEND="cb-get-append",P.CB_GET_BEFORE="cb-get-before",P.CB_GET_UNCHANGEID="cb-get-unchangeid",P.CB_GET_HL="cb-get-hl",P.CB_GET_FOCUS="cb-get-focus",P.CB_GET_FOCUSFIRST="cb-get-focusfirst",P.CB_GET_SETID="cb-get-setid",P.CB_GET_OUTLINE="cb-get-outline",P.CB_GET_ALL="cb-get-all",P.CB_GET_BACKLINK="cb-get-backlink",P.CB_GET_UNUNDO="cb-get-unundo",P.CB_GET_SCROLL="cb-get-scroll",P.CB_GET_CONTEXT="cb-get-context",P.CB_GET_ROOTSCROLL="cb-get-rootscroll",P.CB_GET_HTML="cb-get-html",P.CB_GET_HISTORY="cb-get-history",P.CB_GET_OPENNEW="cb-get-opennew",P.LOCAL_ZOOM="local-zoom",P.LOCAL_SEARCHDATA="local-searchdata",P.LOCAL_SEARCHKEYS="local-searchkeys",P.LOCAL_SEARCHASSET="local-searchasset",P.LOCAL_SEARCHUNREF="local-searchunref",P.LOCAL_DOCINFO="local-docinfo",P.LOCAL_DAILYNOTEID="local-dailynoteid",P.LOCAL_HISTORY="local-history",P.LOCAL_CODELANG="local-codelang",P.LOCAL_FONTSTYLES="local-fontstyles",P.LOCAL_EXPORTPDF="local-exportpdf",P.LOCAL_EXPORTWORD="local-exportword",P.LOCAL_EXPORTIMG="local-exportimg",P.LOCAL_BAZAAR="local-bazaar",P.LOCAL_PDFTHEME="local-pdftheme",P.LOCAL_LAYOUTS="local-layouts",P.LOCAL_AI="local-ai",P.LOCAL_PLUGINTOPUNPIN="local-plugintopunpin",P.LOCAL_FLASHCARD="local-flashcard",P.LOCAL_FILEPOSITION="local-fileposition",P.LOCAL_FILESPATHS="local-filespaths",P.LOCAL_DIALOGPOSITION="local-dialogposition",P.LOCAL_SESSION_FIRSTLOAD="local-session-firstload",P.LOCAL_OUTLINE="local-outline",P.LOCAL_PLUGIN_DOCKS="local-plugin-docks",P.LOCAL_IMAGES="local-images",P.LOCAL_EMOJIS="local-emojis",P.LOCAL_MOVE_PATH="local-move-path",P.LOCAL_RECENT_DOCS="local-recent-docs",P.DIALOG_CONFIRM="dialog-confirm",P.DIALOG_OPENCARD="dialog-opencard",P.DIALOG_MAKECARD="dialog-makecard",P.DIALOG_VIEWCARDS="dialog-viewcards",P.DIALOG_DIALYNOTE="dialog-dialynote",P.DIALOG_RECENTDOCS="dialog-recentdocs",P.DIALOG_SWITCHTAB="dialog-switchtab",P.DIALOG_SEARCH="dialog-search",P.DIALOG_REPLACE="dialog-replace",P.DIALOG_GLOBALSEARCH="dialog-globalsearch",P.DIALOG_HISTORYCOMPARE="dialog-historycompare",P.DIALOG_ACCESSAUTHCODE="dialog-accessauthcode",P.DIALOG_AICUSTOMACTION="dialog-aicustomaction",P.DIALOG_AIUPDATECUSTOMACTION="dialog-aiupdatecustomaction",P.DIALOG_BACKGROUNDLINK="dialog-backgroundlink",P.DIALOG_BACKGROUNDRANDOM="dialog-backgroundrandom",P.DIALOG_CHANGELOG="dialog-changelog",P.DIALOG_COMMANDPANEL="dialog-commandpanel",P.DIALOG_DEACTIVATEUSER="dialog-deactivateuser",P.DIALOG_EMOJIS="dialog-emojis",P.DIALOG_EXPORTIMAGE="dialog-exportimage",P.DIALOG_EXPORTTEMPLATE="dialog-exporttemplate",P.DIALOG_EXPORTWORD="dialog-exportword",P.DIALOG_HISTORY="dialog-history",P.DIALOG_HISTORYDOC="dialog-historydoc",P.DIALOG_MOVEPATHTO="dialog-movepathto",P.DIALOG_RENAME="dialog-rename",P.DIALOG_RENAMEASSETS="dialog-renameassets",P.DIALOG_RENAMEBOOKMARK="dialog-renamebookmark",P.DIALOG_RENAMETAG="dialog-renametag",P.DIALOG_REPLACETYPE="dialog-replacetype",P.DIALOG_SAVECRITERION="dialog-savecriterion",P.DIALOG_SEARCHTYPE="dialog-searchtype",P.DIALOG_SEARCHASSETSTYPE="dialog-searchassetstype",P.DIALOG_SETTING="dialog-setting",P.DIALOG_SNAPSHOTTAG="dialog-snapshottag",P.DIALOG_SNAPSHOTMEMO="dialog-snapshotmemo",P.DIALOG_SNIPPETS="dialog-snippets",P.DIALOG_SYNCADDCLOUDDIR="dialog-syncaddclouddir",P.DIALOG_SYNCCHOOSEDIR="dialog-syncchoosedir",P.DIALOG_SYNCCHOOSEDIRECTION="dialog-syncchoosedirection",P.DIALOG_TRANSFERBLOCKREF="dialog-transferblockref",P.DIALOG_WECHATREMINDER="dialog-wechatreminder",P.DIALOG_PASSWORD="dialog-password",P.DIALOG_SETPASSWORD="dialog-setpassword",P.DIALOG_BOOTSYNCFAILED="dialog-bootsyncfailed",P.DIALOG_KERNELFAULT="dialog-kernelfault",P.DIALOG_STATEEXCEPTED="dialog-stateexcepted",P.DIALOG_ATTR="dialog-attr",P.DIALOG_SETCUSTOMATTR="dialog-setcustomattr",P.DIALOG_CREATENOTEBOOK="dialog-createnotebook",P.DIALOG_NOTEBOOKCONF="dialog-notebookconf",P.DIALOG_CREATEWORKSPACE="dialog-createworkspace",P.DIALOG_OPENWORKSPACE="dialog-openworkspace",P.DIALOG_SAVEWORKSPACE="dialog-saveworkspace",P.MENU_BAR_WORKSPACE="barWorkspace",P.MENU_BAR_PLUGIN="topBarPlugin",P.MENU_BAR_ZOOM="barZoom",P.MENU_BAR_MODE="barmode",P.MENU_BAR_MORE="barmore",P.MENU_STATUS_HELP="statusHelp",P.MENU_STATUS_BACKGROUND_TASK="statusBackgroundTask",P.MENU_DOCK_MOBILE="dockMobileMenu",P.MENU_BLOCK_SINGLE="block-single",P.MENU_BLOCK_MULTI="block-multi",P.MENU_TITLE="titleMenu",P.MENU_FROM_TITLE_PROTYLE="title-protyle",P.MENU_FROM_TITLE_BREADCRUMB="title-breadcrumb",P.MENU_BREADCRUMB_MORE="breadcrumbMore",P.MENU_BREADCRUMB_MOBILE_PATH="breadcrumb-mobile-path",P.MENU_DOC_TREE_MORE="docTreeMore",P.MENU_FROM_DOC_TREE_MORE_NOTEBOOK="tree-notebook",P.MENU_FROM_DOC_TREE_MORE_DOC="tree-doc",P.MENU_FROM_DOC_TREE_MORE_ITEMS="tree-items",P.MENU_TAG="tagMenu",P.MENU_BOOKMARK="bookmarkMenu",P.MENU_OUTLINE_CONTEXT="outline-context",P.MENU_OUTLINE_EXPAND_LEVEL="outline-expand-level",P.MENU_AV_VIEW="av-view",P.MENU_AV_HEADER_CELL="av-header-cell",P.MENU_AV_HEADER_ADD="av-header-add",P.MENU_AV_ADD_FILTER="av-add-filter",P.MENU_AV_ADD_SORT="av-add-sort",P.MENU_AV_COL_OPTION="av-col-option",P.MENU_AV_COL_FORMAT_NUMBER="av-col-format-number",P.MENU_AV_GROUP_DATE="avGroupDate",P.MENU_AV_GROUP_SORT="avGroupSort",P.MENU_AV_ASSET_EDIT="av-asset-edit",P.MENU_AV_CALC="av-calc",P.MENU_AV_PAGE_SIZE="av-page-size",P.MENU_SEARCH_MORE="searchMore",P.MENU_SEARCH_METHOD="searchMethod",P.MENU_SEARCH_ASSET_MORE="searchAssetMore",P.MENU_SEARCH_ASSET_METHOD="searchAssetMethod",P.MENU_SEARCH_UNREF_MORE="searchUnRefMore",P.MENU_SEARCH_HISTORY="search-history",P.MENU_SEARCH_REPLACE_HISTORY="search-replace-history",P.MENU_SEARCH_ASSET_HISTORY="search-asset-history",P.MENU_MOVE_PATH_HISTORY="move-path-history",P.MENU_BACKGROUND_ASSET="background-asset",P.MENU_AI="ai",P.MENU_TAB="tab",P.MENU_TAB_LIST="tabList",P.MENU_INLINE_CONTEXT="inline-context",P.MENU_INLINE_IMG="inline-img",P.MENU_INLINE_FILE_ANNOTATION_REF="inline-file-annotation-ref",P.MENU_INLINE_REF="inline-block-ref",P.MENU_INLINE_A="inline-a",P.MENU_INLINE_TAG="inline-tag",P.MENU_INLINE_MATH="inline-math",P.TIMEOUT_OPENDIALOG=50,P.TIMEOUT_DBLCLICK=190,P.TIMEOUT_INPUT=256,P.TIMEOUT_LOAD=300,P.TIMEOUT_TRANSITION=300,P.TIMEOUT_COUNT=1e3,P.HELP_PATH={ar_SA:"20210808180117-6v0mkxr",de_DE:"20210808180117-6v0mkxr",en_US:"20210808180117-6v0mkxr",es_ES:"20210808180117-6v0mkxr",fr_FR:"20210808180117-6v0mkxr",he_IL:"20210808180117-6v0mkxr",it_IT:"20210808180117-6v0mkxr",ja_JP:"20240530133126-axarxgx",pl_PL:"20210808180117-6v0mkxr",pt_BR:"20210808180117-6v0mkxr",ru_RU:"20210808180117-6v0mkxr",zh_CHT:"20211226090932-5lcq56f",zh_CN:"20210808180117-czj9bvb"},P.QUICK_DECK_ID="20230218211946-2kw8jgx",P.KEYCODELIST=Object.assign(de(),{8:"\u232B",9:"\u21E5",13:"\u21A9",16:"\u21E7",17:"\u2303",18:"\u2325",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"\u2190",38:"\u2191",39:"\u2192",40:"\u2193",44:"PrintScreen",45:"Insert",46:"\u2326",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"\u2318",92:"\u2318",93:"ContextMenu",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",182:"MyComputer",183:"MyCalculator",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"}),P.SIYUAN_KEYMAP={general:{mainMenu:{default:"\u2325\\",custom:"\u2325\\"},commandPanel:{default:"\u2325\u21E7P",custom:"\u2325\u21E7P"},editReadonly:{default:"\u21E7\u2318G",custom:"\u21E7\u2318G"},syncNow:{default:"F9",custom:"F9"},enterBack:{default:"\u2325\u2190",custom:"\u2325\u2190"},enter:{default:"\u2325\u2192",custom:"\u2325\u2192"},goForward:{default:"\u2318]",custom:"\u2318]"},goBack:{default:"\u2318[",custom:"\u2318["},newFile:{default:"\u2318N",custom:"\u2318N"},search:{default:"\u2318F",custom:"\u2318F"},globalSearch:{default:"\u2318P",custom:"\u2318P"},stickSearch:{default:"\u21E7\u2318F",custom:"\u21E7\u2318F"},replace:{default:"\u2318R",custom:"\u2318R"},closeTab:{default:"\u2318W",custom:"\u2318W"},fileTree:{default:V+"1",custom:V+"1"},outline:{default:V+"2",custom:V+"2"},bookmark:{default:V+"3",custom:V+"3"},tag:{default:V+"4",custom:V+"4"},dailyNote:{default:V+"5",custom:V+"5"},inbox:{default:V+"6",custom:V+"6"},backlinks:{default:V+"7",custom:V+"7"},graphView:{default:V+"8",custom:V+"8"},globalGraph:{default:V+"9",custom:V+"9"},riffCard:{default:V+"0",custom:V+"0"},ai:{default:"",custom:""},config:{default:"\u2325P",custom:"\u2325P"},dataHistory:{default:"\u2325H",custom:"\u2325H"},toggleWin:{default:"\u2325M",custom:"\u2325M"},lockScreen:{default:"\u2325N",custom:"\u2325N"},recentDocs:{default:"\u2318E",custom:"\u2318E"},goToTab1:{default:"\u23181",custom:"\u23181"},goToTab2:{default:"\u23182",custom:"\u23182"},goToTab3:{default:"\u23183",custom:"\u23183"},goToTab4:{default:"\u23184",custom:"\u23184"},goToTab5:{default:"\u23185",custom:"\u23185"},goToTab6:{default:"\u23186",custom:"\u23186"},goToTab7:{default:"\u23187",custom:"\u23187"},goToTab8:{default:"\u23188",custom:"\u23188"},goToTab9:{default:"\u23189",custom:"\u23189"},goToTabNext:{default:"\u21E7\u2318]",custom:"\u21E7\u2318]"},goToTabPrev:{default:"\u21E7\u2318[",custom:"\u21E7\u2318["},goToEditTabNext:{default:"\u2303\u21E5",custom:"\u2303\u21E5"},goToEditTabPrev:{default:"\u2303\u21E7\u21E5",custom:"\u2303\u21E7\u21E5"},recentClosed:{default:"\u21E7\u2318T",custom:"\u21E7\u2318T"},move:{default:"",custom:""},selectOpen1:{default:"",custom:""},toggleDock:{default:"",custom:""},splitLR:{default:"",custom:""},splitMoveR:{default:"",custom:""},splitTB:{default:"",custom:""},splitMoveB:{default:"",custom:""},closeOthers:{default:"",custom:""},closeAll:{default:"",custom:""},closeUnmodified:{default:"",custom:""},closeLeft:{default:"",custom:""},closeRight:{default:"",custom:""},tabToWindow:{default:"",custom:""},addToDatabase:{default:"",custom:""},unsplit:{default:"",custom:""},unsplitAll:{default:"",custom:""}},editor:{general:{duplicate:{default:"\u2318D",custom:"\u2318D"},expandDown:{default:"\u2325\u21E7\u2193",custom:"\u2325\u21E7\u2193"},expandUp:{default:"\u2325\u21E7\u2191",custom:"\u2325\u21E7\u2191"},expand:{default:"\u2318\u2193",custom:"\u2318\u2193"},collapse:{default:"\u2318\u2191",custom:"\u2318\u2191"},insertBottom:{default:"\u2325\u2318.",custom:"\u2325\u2318."},refTab:{default:"\u21E7\u2318.",custom:"\u21E7\u2318."},openBy:{default:"\u2325,",custom:"\u2325,"},insertRight:{default:"\u2325.",custom:"\u2325."},attr:{default:"\u2325\u2318A",custom:"\u2325\u2318A"},quickMakeCard:{default:"\u2325\u2318F",custom:"\u2325\u2318F"},refresh:{default:"F5",custom:"F5"},copyBlockRef:{default:"\u21E7\u2318C",custom:"\u21E7\u2318C"},copyProtocol:{default:"\u21E7\u2318H",custom:"\u21E7\u2318H"},copyBlockEmbed:{default:"\u21E7\u2318E",custom:"\u21E7\u2318E"},copyHPath:{default:"\u21E7\u2318P",custom:"\u21E7\u2318P"},undo:{default:"\u2318Z",custom:"\u2318Z"},redo:{default:"\u2318Y",custom:"\u2318Y"},rename:{default:"F2",custom:"F2"},newNameFile:{default:"F3",custom:"F3"},newContentFile:{default:"F4",custom:"F4"},newNameSettingFile:{default:"\u2318F3",custom:"\u2318F3"},showInFolder:{default:"\u2325A",custom:"\u2325A"},outline:{default:"\u2325O",custom:"\u2325O"},backlinks:{default:"\u2325B",custom:"\u2325B"},graphView:{default:"\u2325G",custom:"\u2325G"},spaceRepetition:{default:"\u2325F",custom:"\u2325F"},fullscreen:{default:"\u2325Y",custom:"\u2325Y"},alignLeft:{default:"\u2325L",custom:"\u2325L"},alignCenter:{default:"\u2325C",custom:"\u2325C"},alignRight:{default:"\u2325R",custom:"\u2325R"},wysiwyg:{default:"\u2325\u23187",custom:"\u2325\u23187"},preview:{default:"\u2325\u23189",custom:"\u2325\u23189"},insertBefore:{default:"\u21E7\u2318B",custom:"\u21E7\u2318B"},insertAfter:{default:"\u21E7\u2318A",custom:"\u21E7\u2318A"},jumpToParentNext:{default:"\u21E7\u2318N",custom:"\u21E7\u2318N"},jumpToParentPrev:{default:"\u21E7\u2318M",custom:"\u21E7\u2318M"},jumpToParent:{default:"\u21E7\u2318J",custom:"\u21E7\u2318J"},moveToUp:{default:"\u21E7\u2318\u2191",custom:"\u21E7\u2318\u2191"},moveToDown:{default:"\u21E7\u2318\u2193",custom:"\u21E7\u2318\u2193"},duplicateCompletely:{default:"",custom:""},copyPlainText:{default:"",custom:""},copyID:{default:"",custom:""},copyProtocolInMd:{default:"",custom:""},netImg2LocalAsset:{default:"",custom:""},netAssets2LocalAssets:{default:"",custom:""},optimizeTypography:{default:"",custom:""},hLayout:{default:"",custom:""},vLayout:{default:"",custom:""},refPopover:{default:"",custom:""},copyText:{default:"",custom:""},exitFocus:{default:"",custom:""},ai:{default:"",custom:""},switchReadonly:{default:"",custom:""},switchAdjust:{default:"",custom:""},rtl:{default:"",custom:""},ltr:{default:"",custom:""},aiWriting:{default:"",custom:""},openInNewTab:{default:"",custom:""}},insert:{appearance:{default:"\u2325\u2318X",custom:"\u2325\u2318X"},lastUsed:{default:"\u2325X",custom:"\u2325X"},ref:{default:"\u2325[",custom:"\u2325["},kbd:{default:"\u2318'",custom:"\u2318'"},sup:{default:"\u2318H",custom:"\u2318H"},sub:{default:"\u2318J",custom:"\u2318J"},bold:{default:"\u2318B",custom:"\u2318B"},"inline-math":{default:"\u2318M",custom:"\u2318M"},memo:{default:"\u2325\u2318M",custom:"\u2325\u2318M"},underline:{default:"\u2318U",custom:"\u2318U"},italic:{default:"\u2318I",custom:"\u2318I"},mark:{default:"\u2325D",custom:"\u2325D"},tag:{default:"\u2318T",custom:"\u2318T"},strike:{default:"\u21E7\u2318S",custom:"\u21E7\u2318S"},"inline-code":{default:"\u2318G",custom:"\u2318G"},link:{default:"\u2318K",custom:"\u2318K"},check:{default:"\u2318L",custom:"\u2318L"},"ordered-list":{default:"",custom:""},list:{default:"",custom:""},table:{default:"\u2318O",custom:"\u2318O"},code:{default:"\u21E7\u2318K",custom:"\u21E7\u2318K"},quote:{default:"",custom:""},clearInline:{default:"\u2318\\",custom:"\u2318\\"}},heading:{paragraph:{default:"\u2325\u23180",custom:"\u2325\u23180"},heading1:{default:"\u2325\u23181",custom:"\u2325\u23181"},heading2:{default:"\u2325\u23182",custom:"\u2325\u23182"},heading3:{default:"\u2325\u23183",custom:"\u2325\u23183"},heading4:{default:"\u2325\u23184",custom:"\u2325\u23184"},heading5:{default:"\u2325\u23185",custom:"\u2325\u23185"},heading6:{default:"\u2325\u23186",custom:"\u2325\u23186"}},list:{indent:{default:"\u21E5",custom:"\u21E5"},outdent:{default:"\u21E7\u21E5",custom:"\u21E7\u21E5"},checkToggle:{default:"\u2318\u21A9",custom:"\u2318\u21A9"}},table:{insertRowAbove:{default:"",custom:""},insertRowBelow:{default:"",custom:""},insertColumnLeft:{default:"",custom:""},insertColumnRight:{default:"",custom:""},moveToUp:{default:"\u2325\u2318T",custom:"\u2325\u2318T"},moveToDown:{default:"\u2325\u2318B",custom:"\u2325\u2318B"},moveToLeft:{default:"\u2325\u2318L",custom:"\u2325\u2318L"},moveToRight:{default:"\u2325\u2318R",custom:"\u2325\u2318R"},"delete-row":{default:"\u2318-",custom:"\u2318-"},"delete-column":{default:"\u21E7\u2318-",custom:"\u21E7\u2318-"}}},plugin:{}},P.SIYUAN_EMPTY_LAYOUT={hideDock:!1,layout:{direction:"tb",size:"0px",type:"normal",instance:"Layout",children:[{direction:"lr",size:"auto",type:"normal",instance:"Layout",children:[{direction:"tb",size:"0px",type:"left",instance:"Layout",children:[{instance:"Wnd",children:[]},{instance:"Wnd",resize:"tb",children:[]}]},{direction:"lr",resize:"lr",size:"auto",type:"center",instance:"Layout",children:[{instance:"Wnd",children:[{instance:"Tab",children:[]}]}]},{direction:"tb",size:"0px",resize:"lr",type:"right",instance:"Layout",children:[{instance:"Wnd",children:[]},{instance:"Wnd",resize:"tb",children:[]}]}]},{direction:"lr",size:"0px",resize:"tb",type:"bottom",instance:"Layout",children:[{instance:"Wnd",children:[]},{instance:"Wnd",resize:"lr",children:[]}]}]},bottom:{pin:!0,data:[]},left:{pin:!0,data:[[{type:"file",size:{width:232,height:0},show:!0,icon:"iconFiles",hotkeyLangId:"fileTree"},{type:"outline",size:{width:232,height:0},show:!1,icon:"iconAlignCenter",hotkeyLangId:"outline"},{type:"inbox",size:{width:320,height:0},show:!1,icon:"iconInbox",hotkeyLangId:"inbox"}],[{type:"bookmark",size:{width:232,height:0},show:!1,icon:"iconBookmark",hotkeyLangId:"bookmark"},{type:"tag",size:{width:232,height:0},show:!1,icon:"iconTags",hotkeyLangId:"tag"}]]},right:{pin:!0,data:[[{type:"graph",size:{width:320,height:0},show:!1,icon:"iconGraph",hotkeyLangId:"graphView"},{type:"globalGraph",size:{width:320,height:0},show:!1,icon:"iconGlobalGraph",hotkeyLangId:"globalGraph"},{type:"ai",size:{width:320,height:0},show:!0,icon:"iconSparkles",hotkeyLangId:"ai"}],[{type:"backlink",size:{width:320,height:0},show:!1,icon:"iconLink",hotkeyLangId:"backlinks"}]]}},P.SIYUAN_DEFAULT_REPLACETYPES={text:!0,imgText:!0,imgTitle:!0,imgSrc:!0,aText:!0,aTitle:!0,aHref:!0,code:!0,em:!0,strong:!0,inlineMath:!0,inlineMemo:!0,blockRef:!0,fileAnnotationRef:!0,kbd:!0,mark:!0,s:!0,sub:!0,sup:!0,tag:!0,u:!0,docTitle:!0,codeBlock:!0,mathBlock:!0,htmlBlock:!0},P.SIYUAN_IMAGE_VIP=`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
<path fill="#ffd00f" d="M2.288 12.643l23.487 12.853c0.286 0.153 0.477 0.45 0.477 0.791 0 0.082-0.011 0.161-0.032 0.237l0.001-0.006c-0.119 0.395-0.479 0.678-0.905 0.678-0.004 0-0.009-0-0.013-0h-19.439c-0.958 0-1.766-0.684-1.885-1.595l-1.691-12.956z"></path>
<path fill="#ffd00f" d="M29.676 12.643l-1.691 12.957c-0.119 0.911-0.927 1.594-1.884 1.594h-19.442c-0.004 0-0.009 0-0.013 0-0.425 0-0.785-0.281-0.903-0.668l-0.002-0.007c-0.019-0.070-0.031-0.15-0.031-0.232 0-0.341 0.191-0.638 0.472-0.788l0.005-0.002 23.487-12.853z"></path>
<path fill="#ffe668" d="M15.413 8.369l10.394 15.921c0.378 0.579 0.407 1.317 0.076 1.924-0.328 0.591-0.948 0.985-1.66 0.985-0 0-0.001 0-0.001 0h-17.617c-0.694 0-1.331-0.378-1.661-0.985-0.144-0.26-0.229-0.569-0.229-0.899 0-0.382 0.114-0.736 0.31-1.033l-0.004 0.007 10.394-15.921z"></path>
<path fill="#ffdd4e" d="M15.396 8.403l11.659 15.921c0.401 0.579 0.432 1.317 0.081 1.924-0.361 0.594-1.005 0.985-1.741 0.985-0.008 0-0.017-0-0.025-0h-9.344l-0.63-18.83z"></path>
<path fill="#ffd00f" d="M13.868 6.478c0 0.946 0.767 1.712 1.712 1.712s1.712-0.767 1.712-1.712v0c0-0.945-0.766-1.712-1.712-1.712s-1.712 0.766-1.712 1.712v0zM28.577 10.818c0 0.945 0.766 1.712 1.712 1.712s1.712-0.766 1.712-1.712v0c0-0.945-0.766-1.712-1.712-1.712s-1.712 0.766-1.712 1.712v0zM0 10.822c0 0.945 0.766 1.712 1.712 1.712s1.712-0.766 1.712-1.712v0c0-0.945-0.766-1.712-1.712-1.712s-1.712 0.766-1.712 1.712v0z"></path>
</svg>`,P.SIYUAN_ASSETS_IMAGE=[".apng",".ico",".cur",".jpg",".jpe",".jpeg",".jfif",".pjp",".pjpeg",".png",".gif",".webp",".bmp",".svg",".avif"],P.SIYUAN_ASSETS_AUDIO=[".mp3",".wav",".ogg",".m4a",".aac",".flac"],P.SIYUAN_ASSETS_VIDEO=[".mov",".weba",".mkv",".mp4",".webm"],P.SIYUAN_ASSETS_DOCUMENT=[".doc",".docx",".xls",".xlsx",".ppt",".pptx",".odt",".ods",".odp"],P.SIYUAN_ASSETS_TEXT=[".md",".markdown",".txt",".json",".xml",".html",".css",".js",".ts",".py",".go",".java",".c",".cpp",".h",".sh",".yaml",".yml",".toml",".ini",".conf",".log"],P.SIYUAN_ASSETS_EXTS=[".pdf"].concat(P.SIYUAN_ASSETS_IMAGE).concat(P.SIYUAN_ASSETS_AUDIO).concat(P.SIYUAN_ASSETS_VIDEO).concat(P.SIYUAN_ASSETS_DOCUMENT).concat(P.SIYUAN_ASSETS_TEXT),P.SIYUAN_ASSETS_SEARCH=[".txt",".md",".markdown",".docx",".xlsx",".pptx",".pdf",".json",".log",".sql",".html",".xml",".java",".h",".c",".cpp",".go",".rs",".swift",".kt",".py",".php",".js",".css",".ts",".sh",".bat",".cmd",".ini",".yaml",".rst",".adoc",".textile",".opml",".org",".wiki",".epub",".cs"],P.SIYUAN_CONFIG_APPEARANCE_DARK_CODE=["a11y-dark","agate","an-old-hope","androidstudio","arta","atom-one-dark","atom-one-dark-reasonable","base16/3024","base16/apathy","base16/apprentice","base16/ashes","base16/atelier-cave","base16/atelier-dune","base16/atelier-estuary","base16/atelier-forest","base16/atelier-heath","base16/atelier-lakeside","base16/atelier-plateau","base16/atelier-savanna","base16/atelier-seaside","base16/atelier-sulphurpool","base16/atlas","base16/bespin","base16/black-metal","base16/black-metal-bathory","base16/black-metal-burzum","base16/black-metal-dark-funeral","base16/black-metal-gorgoroth","base16/black-metal-immortal","base16/black-metal-khold","base16/black-metal-marduk","base16/black-metal-mayhem","base16/black-metal-nile","base16/black-metal-venom","base16/brewer","base16/bright","base16/brogrammer","base16/brush-trees-dark","base16/chalk","base16/circus","base16/classic-dark","base16/codeschool","base16/colors","base16/danqing","base16/darcula","base16/dark-violet","base16/darkmoss","base16/darktooth","base16/decaf","base16/default-dark","base16/dracula","base16/edge-dark","base16/eighties","base16/embers","base16/equilibrium-dark","base16/equilibrium-gray-dark","base16/espresso","base16/eva","base16/eva-dim","base16/flat","base16/framer","base16/gigavolt","base16/google-dark","base16/grayscale-dark","base16/green-screen","base16/gruvbox-dark-hard","base16/gruvbox-dark-medium","base16/gruvbox-dark-pale","base16/gruvbox-dark-soft","base16/hardcore","base16/harmonic16-dark","base16/heetch-dark","base16/helios","base16/hopscotch","base16/horizon-dark","base16/humanoid-dark","base16/ia-dark","base16/icy-dark","base16/ir-black","base16/isotope","base16/kimber","base16/london-tube","base16/macintosh","base16/marrakesh","base16/materia","base16/material","base16/material-darker","base16/material-palenight","base16/material-vivid","base16/mellow-purple","base16/mocha","base16/monokai","base16/nebula","base16/nord","base16/nova","base16/ocean","base16/oceanicnext","base16/onedark","base16/outrun-dark","base16/papercolor-dark","base16/paraiso","base16/pasque","base16/phd","base16/pico","base16/pop","base16/porple","base16/qualia","base16/railscasts","base16/rebecca","base16/ros-pine","base16/ros-pine-moon","base16/sandcastle","base16/seti-ui","base16/silk-dark","base16/snazzy","base16/solar-flare","base16/solarized-dark","base16/spacemacs","base16/summercamp","base16/summerfruit-dark","base16/synth-midnight-terminal-dark","base16/tango","base16/tender","base16/tomorrow-night","base16/twilight","base16/unikitty-dark","base16/vulcan","base16/windows-10","base16/windows-95","base16/windows-high-contrast","base16/windows-nt","base16/woodland","base16/xcode-dusk","base16/zenburn","codepen-embed","cybertopia-cherry","cybertopia-dimmer","cybertopia-icecap","cybertopia-saturated","dark","devibeans","far","felipec","github-dark","github-dark-dimmed","gml","gradient-dark","hybrid","ir-black","isbl-editor-dark","kimbie-dark","lioshi","monokai","monokai-sublime","night-owl","nnfx-dark","nord","obsidian","panda-syntax-dark","paraiso-dark","pojoaque","qtcreator-dark","rainbow","rose-pine","rose-pine-moon","shades-of-purple","srcery","stackoverflow-dark","sunburst","tomorrow-night-blue","tomorrow-night-bright","tokyo-night-dark","vs2015","xt256"],P.SIYUAN_CONFIG_APPEARANCE_LIGHT_CODE=["ant-design","1c-light","a11y-light","arduino-light","ascetic","atom-one-light","base16/atelier-cave-light","base16/atelier-dune-light","base16/atelier-estuary-light","base16/atelier-forest-light","base16/atelier-heath-light","base16/atelier-lakeside-light","base16/atelier-plateau-light","base16/atelier-savanna-light","base16/atelier-seaside-light","base16/atelier-sulphurpool-light","base16/brush-trees","base16/classic-light","base16/cupcake","base16/cupertino","base16/default-light","base16/dirtysea","base16/edge-light","base16/equilibrium-gray-light","base16/equilibrium-light","base16/fruit-soda","base16/github","base16/google-light","base16/grayscale-light","base16/gruvbox-light-hard","base16/gruvbox-light-medium","base16/gruvbox-light-soft","base16/harmonic16-light","base16/heetch-light","base16/humanoid-light","base16/horizon-light","base16/ia-light","base16/material-lighter","base16/mexico-light","base16/one-light","base16/papercolor-light","base16/ros-pine-dawn","base16/sagelight","base16/shapeshifter","base16/silk-light","base16/solar-flare-light","base16/solarized-light","base16/summerfruit-light","base16/synth-midnight-terminal-light","base16/tomorrow","base16/unikitty-light","base16/windows-10-light","base16/windows-95-light","base16/windows-high-contrast-light","brown-paper","base16/windows-nt-light","color-brewer","docco","foundation","github","googlecode","gradient-light","grayscale","idea","intellij-light","isbl-editor-light","kimbie-light","lightfair","magula","mono-blue","nnfx-light","panda-syntax-light","paraiso-light","purebasic","qtcreator-light","rose-pine-dawn","routeros","school-book","stackoverflow-light","tokyo-night-light","vs","xcode","default"],P.ZWSP="\u200B",P.INLINE_TYPE=["block-ref","kbd","text","file-annotation-ref","a","strong","em","u","s","mark","sup","sub","tag","code","inline-math","inline-memo","clear"],P.BLOCK_HINT_KEYS=["((","[[","\uFF08\uFF08","\u3010\u3010"],P.BLOCK_HINT_CLOSE_KEYS={"((":"))","[[":"]]","\uFF08\uFF08":"\uFF09\uFF09","\u3010\u3010":"\u3011\u3011"},P.ALIAS_CODE_LANGUAGES=["js","ts","html","toml","c#","bat"],P.SIYUAN_RENDER_CODE_LANGUAGES=["abc","plantuml","mermaid","flowchart","echarts","mindmap","graphviz","math"],P.PROTYLE_TOOLBAR=x()?["block-ref","a","|","text","strong","em","u","clear","|","code","tag","inline-math","inline-memo"]:["block-ref","a","|","text","strong","em","u","s","mark","sup","sub","clear","|","code","kbd","tag","inline-math","inline-memo"];let p=P;const K=()=>([1e7].toString()+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(parseInt(t,10)^window.crypto.getRandomValues(new Uint32Array(1))[0]&15>>parseInt(t,10)/4).toString(16)),me=(t,e,n=!1)=>{let a=N(t,e,n),i=!1,s=!1;for(;a&&(n?a.tagName!=="BODY":!a.classList.contains("protyle-wysiwyg"))&&!s;)i=N(a.parentElement,e,n),i?a=i:s=!0;return a||!1},pe=(t,e)=>{let n=A(t,e),a=!1,i=!1;for(;n&&!n.classList.contains("protyle-wysiwyg")&&!i;)a=A(n.parentElement,e),a?n=a:i=!0;return n||!1},le=(t,e,n,a=!1)=>{let i=ue(t,e,n,a),s=!1,r=!1;for(;i&&!i.classList.contains("protyle-wysiwyg")&&!r;)s=ue(i.parentElement,e,n,a),s?i=s:r=!0;return i||!1},ue=(t,e,n,a=!1)=>{var i;if(!t||t.nodeType===9)return!1;t.nodeType===3&&(t=t.parentElement);let s=t,r=!1;for(;s&&!r&&(a?s.tagName!=="BODY":!s.classList.contains("protyle-wysiwyg"));)typeof n=="string"&&((i=s.getAttribute(e))!=null&&i.split(" ").includes(n))||typeof n!="string"&&s.hasAttribute(e)?r=!0:s=s.parentElement;return r&&s},A=(t,e)=>{if(!t||t.nodeType===9)return!1;t.nodeType===3&&(t=t.parentElement);let n=t,a=!1;for(;n&&!a&&!n.classList.contains("protyle-wysiwyg");)n.nodeName===e?a=!0:n=n.parentElement;return a&&n},N=(t,e,n=!1)=>{var a;if(!t||t.nodeType===9)return!1;t.nodeType===3&&(t=t.parentElement);let i=t,s=!1;for(;i&&!s&&(n?i.tagName!=="BODY":!i.classList.contains("protyle-wysiwyg"));)(a=i.classList)!=null&&a.contains(e)?s=!0:i=i.parentElement;return s&&i},oe=t=>{var e;const n=ue(t,"data-node-id",null);return n&&n.tagName!=="BUTTON"&&((e=n.getAttribute("data-type"))!=null&&e.startsWith("Node"))?n:!1},ge=t=>{const e=le(t,"data-type","NodeBlockQueryEmbed");return e?e===t?!1:e:!1},ve=t=>N(t,"av__gallery-cover")?N(t,"av"):!1,ke=t=>{let e=t;for(;e;){if(e.previousElementSibling&&e.previousElementSibling.getAttribute("data-node-id"))return e.previousElementSibling;const n=oe(e.parentElement);if(n)e=n;else return!1}},Ye=t=>{let e;return Array.from(t.querySelectorAll("[data-node-id]")).reverse().find(n=>{if(!ge(n))return e=n,!0}),e||t},Le=t=>{let e;return Array.from(t.querySelectorAll("[data-node-id]")).find(n=>{if(!ge(n)&&!n.classList.contains("li")&&!n.classList.contains("sb"))return e=n,!0}),e||t},Fe=t=>{let e=t;for(;e;){if(e.nextElementSibling&&!e.nextElementSibling.classList.contains("protyle-attr"))return e.nextElementSibling;const n=oe(e.parentElement);if(n)e=n;else return!1}return!1},st=t=>{let e=t;for(;e;)if(e.classList.contains("list")||e.classList.contains("li")||e.classList.contains("bq")||e.classList.contains("sb"))e=e.querySelector("[data-node-id]");else return e;return!1},Ee=t=>{if(!t||t.getAttribute("contenteditable")==="true"&&!t.classList.contains("protyle-wysiwyg"))return t;const e=t.querySelector('[contenteditable="true"]');if(e&&!ue(e,"data-type","NodeBlockQueryEmbed"))return e},pt=t=>{if(t.classList.contains("sb")){let e=!1;return Array.from(t.querySelectorAll("[data-node-id]")).find(n=>{if(!pt(n))return e=!0,!0}),!e}return["NodeBlockQueryEmbed","NodeThematicBreak","NodeMathBlock","NodeHTMLBlock","NodeIFrame","NodeWidget","NodeVideo","NodeAudio"].includes(t.getAttribute("data-type"))||t.getAttribute("data-type")==="NodeCodeBlock"&&t.classList.contains("render-node")},$t=t=>{var e,n;let a=t;for(;a.parentElement&&!a.parentElement.classList.contains("protyle-wysiwyg");)if(!a.parentElement.getAttribute("data-node-id"))a=a.parentElement;else{let i=!1;if(Array.from(a.parentElement.querySelectorAll('[contenteditable="true"]')).find(s=>{if(s.textContent.replace(p.ZWSP,"").replace(`
`,"")!=="")return i=!0,!0}),i||(e=a.previousElementSibling)!=null&&e.getAttribute("data-node-id")||(n=a.nextElementSibling)!=null&&n.getAttribute("data-node-id"))break;a=a.parentElement}return a},It=t=>{if(t.parentElement.getAttribute("data-type")==="NodeBlockquote"&&t.parentElement.childElementCount===2)for(;t.parentElement&&!t.parentElement.classList.contains("protyle-wysiwyg");)if(t.parentElement.getAttribute("data-type")==="NodeBlockquote"&&t.parentElement.childElementCount===2)t=t.parentElement;else{t=It(t);break}else if(t.parentElement.getAttribute("data-type")==="NodeSuperBlock"&&t.parentElement.childElementCount===2)for(;t.parentElement&&!t.parentElement.classList.contains("protyle-wysiwyg");)if(t.parentElement.getAttribute("data-type")==="NodeSuperBlock"&&t.parentElement.childElementCount===2)t=t.parentElement;else{t=It(t);break}else if(t.parentElement.getAttribute("data-type")==="NodeListItem"&&t.parentElement.childElementCount===3)for(;t.parentElement&&!t.parentElement.classList.contains("protyle-wysiwyg");)if(t.parentElement.getAttribute("data-type")==="NodeListItem"&&t.parentElement.childElementCount===3)t=t.parentElement;else if(t.parentElement.getAttribute("data-type")==="NodeList"&&t.parentElement.childElementCount===2)t=t.parentElement;else{t=It(t);break}else if(t.parentElement.getAttribute("data-type")==="NodeList"&&t.parentElement.childElementCount===2)for(;t.parentElement&&!t.parentElement.classList.contains("protyle-wysiwyg");)if(t.parentElement.getAttribute("data-type")==="NodeList"&&t.parentElement.childElementCount===2)t=t.parentElement;else if(t.parentElement.getAttribute("data-type")==="NodeListItem"&&t.parentElement.childElementCount===3)t=t.parentElement;else{t=It(t);break}return t},_t=t=>{let e=t.nextSibling;for(;e;)if(e.textContent===""&&e.nodeType===3)e=e.nextSibling;else return e;return!1},jt=t=>{if(t.endContainer.nodeType===3&&t.endContainer.textContent.length!==t.endOffset&&t.endContainer.textContent!==p.ZWSP&&t.endContainer.textContent!==`
`)return!1;let e=t.endContainer;for(t.endContainer.nodeType!==3&&(e=t.endContainer.childNodes[t.endOffset]);e;){if(_t(e))return!1;if(e.parentElement.getAttribute("spellcheck"))return!0;e=e.parentElement}return!0},zt=t=>{let e=t.previousSibling;for(;e;)if(e.textContent===""&&e.nodeType===3)e=e.previousSibling;else return e;return!1},mn=t=>{let e=t.nextElementSibling;if(e)return e.tagName==="LI"?e:e.tagName==="UL"?e.firstElementChild:!1;for(e=t.parentElement;e.tagName==="UL";)if(!e.nextElementSibling)e=e.parentElement;else{if(e.nextElementSibling.tagName==="LI")return e.nextElementSibling;if(e.nextElementSibling.tagName==="UL")return e.nextElementSibling.firstElementChild}return!1},Qn=t=>{let e=t.previousElementSibling;if(e)return e.tagName==="LI"?e:e.tagName==="UL"?e.lastElementChild:!1;for(e=t.parentElement;e.tagName==="UL";)if(!e.previousElementSibling)e=e.parentElement;else{if(e.previousElementSibling.tagName==="LI")return e.previousElementSibling;if(e.previousElementSibling.tagName==="UL"){const n=e.previousElementSibling.querySelectorAll(".b3-list-item");return n[n.length-1]}}return!1},En=()=>{const t=document.getElementById("message");t.innerHTML='<div class="fn__flex-1"></div>',t.addEventListener("click",e=>{let n=e.target;for(;n&&!n.isEqualNode(t);){if(n.classList.contains("b3-snackbar__close")){ot(n.parentElement.getAttribute("data-id")),e.preventDefault();break}else{if(n.tagName==="A"||n.tagName==="BUTTON")break;if(n.classList.contains("b3-snackbar")){(getSelection().rangeCount===0||!getSelection().getRangeAt(0).toString())&&ot(n.getAttribute("data-id")),e.preventDefault(),e.stopPropagation();break}}n=n.parentElement}}),document.querySelectorAll("#tempMessage > div").forEach(e=>{Q(e.innerHTML,parseInt(e.getAttribute("data-timeout")),e.getAttribute("data-type"),e.getAttribute("data-message-id")),e.remove()})},Q=(t,e=6e3,n="info",a)=>{const i=document.getElementById("message").firstElementChild;if(!i){let c=document.getElementById("tempMessage");c||(document.body.insertAdjacentHTML("beforeend",`<div style="font-size: 14px;top: 22px;position: fixed;z-index: 100;right: 30px;line-height: 20px;word-break: break-word;display: flex;flex-direction: column;align-items: flex-end;" 
id="tempMessage"></div>`),c=document.getElementById("tempMessage")),c.insertAdjacentHTML("beforeend",`<div style="background: white;padding: 8px 16px;border-radius: 6px;margin-bottom: 16px;"  
data-timeout="${e}" 
data-type="${n}" 
data-message-id="${a||""}">${t}</div>`);return}const s=a||K(),r=i.querySelector(`.b3-snackbar[data-id="${s}"]`),o=t+(n==="error"?" v"+p.SIYUAN_VERSION:"");if(r){if(window.clearTimeout(parseInt(r.getAttribute("data-timeoutid"))),r.innerHTML=`<div data-type="textMenu" class="b3-snackbar__content${e===0?" b3-snackbar__content--close":""}">${o}</div>${e===0?'<svg class="b3-snackbar__close"><use xlink:href="#iconCloseRound"></use></svg>':""}`,n==="error"?r.classList.add("b3-snackbar--error"):r.classList.remove("b3-snackbar--error"),e>0){const c=window.setTimeout(()=>{ot(s)},e);r.setAttribute("data-timeoutid",c.toString())}return}let l=`<div data-id="${s}" class="b3-snackbar--hide b3-snackbar${n==="error"?" b3-snackbar--error":""}"><div data-type="textMenu" class="b3-snackbar__content${e===0?" b3-snackbar__content--close":""}">${o}</div>`;if(e===0)l+='<svg class="b3-snackbar__close"><use xlink:href="#iconCloseRound"></use></svg>';else if(e!==-1){const c=window.setTimeout(()=>{ot(s)},e);l=l.replace("<div data-id",`<div data-timeoutid="${c}" data-id`)}return i.parentElement.classList.add("b3-snackbars--show"),i.parentElement.style.zIndex=(++window.siyuan.zIndex).toString(),i.insertAdjacentHTML("afterbegin",l+"</div>"),setTimeout(()=>{i.querySelectorAll(".b3-snackbar--hide").forEach(c=>{c.classList.remove("b3-snackbar--hide")})}),i.firstElementChild.nextElementSibling&&i.firstElementChild.nextElementSibling.innerHTML===i.firstElementChild.innerHTML&&i.firstElementChild.nextElementSibling.remove(),i.scrollTo({top:0,behavior:"smooth"}),s},ot=t=>{const e=document.getElementById("message").firstElementChild;if(e)if(t){const n=e.querySelector(`[data-id="${t}"]`);n&&(n.classList.add("b3-snackbar--hide"),window.clearTimeout(parseInt(n.getAttribute("data-timeoutid"))),setTimeout(()=>{n.remove(),e.childElementCount===0&&(e.parentElement.classList.remove("b3-snackbars--show"),e.innerHTML="")},p.TIMEOUT_INPUT));let a=!1;Array.from(e.children).find(i=>{if(!i.classList.contains("b3-snackbar--hide"))return a=!0,!0}),a?e.parentElement.classList.add("b3-snackbars--show"):e.parentElement.classList.remove("b3-snackbars--show")}else e.parentElement.classList.remove("b3-snackbars--show"),setTimeout(()=>{e.innerHTML=""},p.TIMEOUT_INPUT)};var gt=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const ye=t=>{if(typeof Buffer!="undefined")return Buffer.from(t,"utf8").toString("base64");{const n=new TextEncoder().encode(t);let a="";const i=32768;for(let s=0;s<n.length;s+=i){const r=n.subarray(s,Math.min(s+i,n.length));a+=String.fromCharCode(...r)}return btoa(a)}},_e=t=>{const e=t.match(/<!--data-siyuan='([^']+)'-->/);let n="",a=t;if(e)try{if(typeof Buffer!="undefined")n=Buffer.from(e[1],"base64").toString("utf8");else{const i=new TextDecoder,s=Uint8Array.from(atob(e[1]),r=>r.charCodeAt(0));n=i.decode(s)}a=t.replace(/<!--data-siyuan='[^']+'-->/,"")}catch(i){console.log("Failed to decode siyuan data from HTML comment:",i)}return{textSiyuan:n,textHtml:a}},$e=t=>{if(t)if(Xt())if(t.startsWith("assets/"))window.webkit.messageHandlers.openLink.postMessage(location.origin+"/assets/"+encodeURIComponent(t.replace("assets/","")));else if(t.startsWith("/"))window.webkit.messageHandlers.openLink.postMessage(location.origin+t);else try{new URL(t),window.webkit.messageHandlers.openLink.postMessage(t)}catch(e){window.webkit.messageHandlers.openLink.postMessage("https://"+t)}else St()?window.JSAndroid.openExternal(t):Qt()?window.JSHarmony.openExternal(t):window.open(t)},mt=t=>{t&&(Xt()?$e(t):St()?window.JSAndroid.exportByDefault(t):Qt()?window.JSHarmony.exportByDefault(t):window.open(t))},yt=()=>St()?window.JSAndroid.readClipboard():Qt()?window.JSHarmony.readClipboard():typeof navigator.clipboard=="undefined"?(alert(window.siyuan.languages.clipboardPermissionDenied),""):navigator.clipboard.readText().catch(()=>{alert(window.siyuan.languages.clipboardPermissionDenied)})||"",nt=()=>gt(void 0,null,function*(){const t={textPlain:"",textHTML:"",siyuanHTML:""};if(St()){t.textPlain=window.JSAndroid.readClipboard(),t.textHTML=window.JSAndroid.readHTMLClipboard();const e=_e(t.textHTML);return t.textHTML=e.textHtml,t.siyuanHTML=e.textSiyuan,t}if(Qt()){t.textPlain=window.JSHarmony.readClipboard(),t.textHTML=window.JSHarmony.readHTMLClipboard();const e=_e(t.textHTML);return t.textHTML=e.textHtml,t.siyuanHTML=e.textSiyuan,t}if(typeof navigator.clipboard=="undefined")return alert(window.siyuan.languages.clipboardPermissionDenied),t;try{const e=yield navigator.clipboard.read().catch(()=>{alert(window.siyuan.languages.clipboardPermissionDenied)});if(!e)return t;for(const n of e){if(n.types.includes("text/html")){const a=yield n.getType("text/html");t.textHTML=yield a.text();const i=_e(t.textHTML);t.textHTML=i.textHtml,t.siyuanHTML=i.textSiyuan}if(n.types.includes("text/plain")){const a=yield n.getType("text/plain");t.textPlain=yield a.text()}if(n.types.includes("image/png")){const a=yield n.getType("image/png");t.files=[new File([a],"image.png",{type:"image/png",lastModified:Date.now()})]}}return t}catch(e){return t}}),ut=t=>{let e;getSelection().rangeCount>0&&(e=getSelection().getRangeAt(0).cloneRange());try{if(St()){window.JSAndroid.writeClipboard(t);return}if(Qt()){window.JSHarmony.writeClipboard(t);return}if(Xt()){window.webkit.messageHandlers.setClipboard.postMessage(t);return}navigator.clipboard.writeText(t)}catch(n){if(Xt())window.webkit.messageHandlers.setClipboard.postMessage(t);else if(St())window.JSAndroid.writeClipboard(t);else if(Qt())window.JSHarmony.writeClipboard(t);else{const a=document.createElement("textarea");a.value=t,a.style.position="fixed",document.body.appendChild(a),a.focus(),a.select(),document.execCommand("copy"),document.body.removeChild(a),e&&Pt(e)}}},kt=t=>gt(void 0,null,function*(){t=t.replace(new RegExp(p.ZWSP,"g"),""),yield ut(t)}),Ne=()=>bn()?"touchstart":"click",je=t=>Jt()?!!(t.metaKey&&!t.ctrlKey):!!(!t.metaKey&&t.ctrlKey),ct=t=>!t.metaKey&&!t.ctrlKey,Tt=()=>window.siyuan.config.system.osPlatform.toLowerCase().indexOf("huawei")>-1,pn=t=>{var e;return((e=window.siyuan.config.system.disabledFeatures)==null?void 0:e.indexOf(t))>-1},bn=()=>navigator.userAgent.indexOf("iPhone")>-1,Bn=()=>{const t=navigator.userAgent;return t.includes("Safari")&&!t.includes("Chrome")&&!t.includes("Chromium")},yn=()=>navigator.userAgent.indexOf("iPad")>-1,Jt=()=>navigator.platform.toUpperCase().indexOf("MAC")>-1,Kn=()=>gt(void 0,null,function*(){if(!navigator.userAgentData||!navigator.userAgentData.getHighEntropyValues)return!1;const t=yield navigator.userAgentData.getHighEntropyValues(["platformVersion"]);return navigator.userAgentData.platform==="Windows"&&parseInt(t.platformVersion.split(".")[0])>=13}),Xa=()=>St()?window.JSAndroid.getScreenWidthPx():Qt()?window.JSHarmony.getScreenWidthPx():window.outerWidth,lt=()=>navigator.platform.toUpperCase().indexOf("WIN")>-1,St=()=>window.siyuan.config.system.container==="android"&&window.JSAndroid,Xt=()=>{var t;return window.siyuan.config.system.container==="ios"&&((t=window.webkit)==null?void 0:t.messageHandlers)},Qt=()=>window.siyuan.config.system.container==="harmony"&&window.JSHarmony,un=(t,e=" ")=>t?e+Mt(t):"",Mt=t=>{if(!t||Jt())return t;const e=[];(t.indexOf("\u2318")>-1||t.indexOf("\u2303")>-1)&&e.push("Ctrl"),t.indexOf("\u21E7")>-1&&e.push("Shift"),t.indexOf("\u2325")>-1&&e.push("Alt");const n=t.replace(/[]/g,"");return n&&e.push({"\u21E5":"Tab","\u232B":"Backspace","\u2326":"Delete","\u21A9":"Enter"}[n]||n),e.join("+")},ua=t=>{ae("/api/storage/getLocalStorage",void 0,e=>{window.siyuan.storage=e.data;const n={};n[p.LOCAL_SEARCHASSET]={keys:[],col:"",row:"",layout:0,method:0,types:{},sort:0,k:""},n[p.LOCAL_SEARCHUNREF]={col:"",row:"",layout:0},p.SIYUAN_ASSETS_SEARCH.forEach(a=>{n[p.LOCAL_SEARCHASSET].types[a]=!0}),n[p.LOCAL_SEARCHKEYS]={keys:[],replaceKeys:[],col:"",row:"",layout:0,colTab:"",rowTab:"",layoutTab:0},n[p.LOCAL_PDFTHEME]={light:"light",dark:"dark",annoColor:"var(--b3-pdf-background1)"},n[p.LOCAL_LAYOUTS]=[],n[p.LOCAL_AI]=[],n[p.LOCAL_PLUGIN_DOCKS]={},n[p.LOCAL_PLUGINTOPUNPIN]=[],n[p.LOCAL_OUTLINE]={keepCurrentExpand:!1},n[p.LOCAL_FILEPOSITION]={},n[p.LOCAL_DIALOGPOSITION]={},n[p.LOCAL_HISTORY]={notebookId:"%",type:0,operation:"all",sideWidth:"256px",sideDocWidth:"256px",sideDiffWidth:"256px"},n[p.LOCAL_FLASHCARD]={fullscreen:!1},n[p.LOCAL_BAZAAR]={theme:"0",template:"0",icon:"0",widget:"0"},n[p.LOCAL_EXPORTWORD]={removeAssets:!1,mergeSubdocs:!1},n[p.LOCAL_EXPORTPDF]={landscape:!1,marginType:"0",scale:1,pageSize:"A4",removeAssets:!0,keepFold:!1,mergeSubdocs:!1,watermark:!1},n[p.LOCAL_EXPORTIMG]={keepFold:!1,watermark:!1},n[p.LOCAL_DOCINFO]={id:""},n[p.LOCAL_IMAGES]={file:"1f4c4",note:"1f5c3",folder:"1f4d1"},n[p.LOCAL_EMOJIS]={currentTab:"emoji"},n[p.LOCAL_FONTSTYLES]=[],n[p.LOCAL_FILESPATHS]=[],n[p.LOCAL_SEARCHDATA]={page:1,sort:0,group:0,hasReplace:!1,method:0,hPath:"",idPath:[],k:"",r:"",types:{document:window.siyuan.config.search.document,heading:window.siyuan.config.search.heading,list:window.siyuan.config.search.list,listItem:window.siyuan.config.search.listItem,codeBlock:window.siyuan.config.search.codeBlock,htmlBlock:window.siyuan.config.search.htmlBlock,mathBlock:window.siyuan.config.search.mathBlock,table:window.siyuan.config.search.table,blockquote:window.siyuan.config.search.blockquote,superBlock:window.siyuan.config.search.superBlock,paragraph:window.siyuan.config.search.paragraph,embedBlock:window.siyuan.config.search.embedBlock,databaseBlock:window.siyuan.config.search.databaseBlock},replaceTypes:Object.assign({},p.SIYUAN_DEFAULT_REPLACETYPES)},n[p.LOCAL_ZOOM]=1,n[p.LOCAL_MOVE_PATH]={keys:[],k:""},n[p.LOCAL_RECENT_DOCS]={type:"viewedAt"},[p.LOCAL_EXPORTIMG,p.LOCAL_SEARCHKEYS,p.LOCAL_PDFTHEME,p.LOCAL_BAZAAR,p.LOCAL_EXPORTWORD,p.LOCAL_EXPORTPDF,p.LOCAL_DOCINFO,p.LOCAL_FONTSTYLES,p.LOCAL_SEARCHDATA,p.LOCAL_ZOOM,p.LOCAL_LAYOUTS,p.LOCAL_AI,p.LOCAL_PLUGINTOPUNPIN,p.LOCAL_SEARCHASSET,p.LOCAL_FLASHCARD,p.LOCAL_DIALOGPOSITION,p.LOCAL_SEARCHUNREF,p.LOCAL_HISTORY,p.LOCAL_OUTLINE,p.LOCAL_FILEPOSITION,p.LOCAL_FILESPATHS,p.LOCAL_IMAGES,p.LOCAL_PLUGIN_DOCKS,p.LOCAL_EMOJIS,p.LOCAL_MOVE_PATH,p.LOCAL_RECENT_DOCS].forEach(a=>{if(typeof e.data[a]=="string")try{const i=JSON.parse(e.data[a]);typeof i=="number"?window.siyuan.storage[a]=i:window.siyuan.storage[a]=Object.assign(n[a],i)}catch(i){window.siyuan.storage[a]=n[a]}else typeof e.data[a]=="undefined"&&(window.siyuan.storage[a]=n[a])}),(!window.siyuan.storage[p.LOCAL_SEARCHDATA].replaceTypes||Object.keys(window.siyuan.storage[p.LOCAL_SEARCHDATA].replaceTypes).length===0)&&(window.siyuan.storage[p.LOCAL_SEARCHDATA].replaceTypes=Object.assign({},p.SIYUAN_DEFAULT_REPLACETYPES)),t()})},Gt=(t,e,n)=>{window.siyuan.config.readonly||window.siyuan.isPublish||ae("/api/storage/setLocalStorageVal",{app:p.SIYUAN_APPID,key:t,val:e},()=>{n&&n()})},cr=t=>{var e,n,a;if(t.cmd==="msg"){const i=Q(t.msg,t.data.closeTimeout,t.code===0?"info":"error",t.data.id);return(e=document.querySelector("#message #addMicrosoftDefenderExclusion"))==null||e.addEventListener("click",s=>{s.target.innerHTML='<svg class="fn__rotate" style="margin-right: 0;"><use xlink:href="#iconRefresh"></use></svg>',ae("/api/system/addMicrosoftDefenderExclusion",{},()=>{ot(i)})},{once:!0}),(n=document.querySelector("#message #ignoreAddMicrosoftDefenderExclusion"))==null||n.addEventListener("click",()=>{ot(i),ae("/api/system/ignoreAddMicrosoftDefenderExclusion")},{once:!0}),!1}if(t.cmd==="cmsg")return ot(t.data.id),!1;if(t.cmd==="cprogress"){const i=document.getElementById("progress");return i&&i.remove(),!1}return t.cmd==="reloadui"?((a=t.data)!=null&&a.resetScroll?(window.siyuan.storage[p.LOCAL_FILEPOSITION]={},Gt(p.LOCAL_FILEPOSITION,window.siyuan.storage[p.LOCAL_FILEPOSITION],()=>{Ss({cb(){window.location.reload()},errorExit:!1})})):Ss({cb(){window.location.reload()},errorExit:!1}),!1):t.code<0?(Q(t.msg,t.data&&t.data.closeTimeout||0,t.code===-1?"error":"info"),!1):t};class Wa{constructor(e){this.app=e.app,e.msgCallback&&this.connect(e)}connect(e){const n=`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.host}/ws`,a=o=>{var l;const d=`; ${document.cookie}`.split(`; ${o}=`);return d.length===2&&((l=d.pop())==null?void 0:l.split(";").shift())||null},i=localStorage.getItem("siyuan_token")||a("siyuan_token");let s=`${n}?app=${p.SIYUAN_APPID}&id=${e.id}${e.type?"&type="+e.type:""}`;i&&(s+=`&token=${encodeURIComponent(i)}`);const r=new WebSocket(s);r.onopen=()=>{e.callback&&e.callback.call(this),document.getElementById("errorLog")&&(LE(this.app,{upsertRootIDs:[],removeRootIDs:[]}),window.siyuan.dialogs.find(l=>{if(l.element.id==="errorLog")return l.destroy(),!0}))},r.onmessage=o=>{if(e.msgCallback){const l=JSON.parse(o.data),c=cr(l);e.msgCallback.call(this,c)}},r.onclose=o=>{0<=o.reason.indexOf("unauthenticated")||0>o.reason.indexOf("close websocket")&&(console.warn("WebSocket is closed. Reconnect will be attempted in 3 second.",o),setTimeout(()=>{this.connect({id:e.id,type:e.type,msgCallback:e.msgCallback})},3e3))},r.onerror=o=>{o.target.url.endsWith("&type=main")&&o.target.readyState===3&&dL()},this.ws=r}send(e,n,a=!1){if(this.ws){if(this.ws.readyState!==WebSocket.OPEN){console.debug(`WebSocket not ready (state=${this.ws.readyState}), skip sending: ${e}`);return}this.reqId=a?0:new Date().getTime(),this.ws.send(JSON.stringify({cmd:e,reqId:this.reqId,param:n}))}}}var pl=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const hl=(t,e)=>pl(void 0,null,function*(){if(document.getElementById(e))return!1;const n=new XMLHttpRequest;n.open("GET",t,!1),n.setRequestHeader("Accept","text/javascript, application/javascript, application/ecmascript, application/x-ecmascript, */*; q=0.01"),n.send("");const a=document.createElement("script");a.type="text/javascript",a.text=n.responseText,a.id=e,document.head.appendChild(a),typeof Lute=="undefined"&&window.location.reload()}),va=(t,e)=>new Promise(n=>{if(document.getElementById(e))return n(!1),!1;const a=document.createElement("script");a.src=t,a.async=!0,document.head.appendChild(a),a.onload=()=>{if(document.getElementById(e))return a.remove(),n(!1),!1;a.id=e,n(!0)}}),gn=(t,e,n,a=0,i=0)=>{t.style.top=n+"px",t.style.left=e+"px";const s=t.getBoundingClientRect();if(s.bottom>window.innerHeight||s.top<p.SIZE_TOOLBAR_HEIGHT){const r=n-s.height-a;r>p.SIZE_TOOLBAR_HEIGHT&&r+s.height<window.innerHeight?t.style.top=r+"px":r<=p.SIZE_TOOLBAR_HEIGHT?t.style.top=p.SIZE_TOOLBAR_HEIGHT+"px":t.style.top=Math.max(p.SIZE_TOOLBAR_HEIGHT,window.innerHeight-s.height)+"px"}s.right>window.innerWidth?t.style.left=`${window.innerWidth-s.width-i}px`:s.left<0&&(t.style.left="0")},Ut=(t,e,n=!1)=>{if(!e){if(t.includes("dialog")){const a=window.siyuan.dialogs.length;for(let i=0;i<a;i++)window.siyuan.dialogs[i].destroy()}return}if(t.includes("hint")&&(clearTimeout(e.hint.timeId),e.hint.element.classList.add("fn__none")),e.gutter&&t.includes("gutter")&&(e.gutter.element.classList.add("fn__none"),e.gutter.element.innerHTML="",e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--hl").forEach(a=>{a.classList.remove("protyle-wysiwyg--hl")})),e.gutter&&t.includes("gutterOnly")&&(e.gutter.element.classList.add("fn__none"),e.gutter.element.innerHTML=""),e.toolbar&&t.includes("toolbar")&&(e.toolbar.element.classList.add("fn__none"),e.toolbar.element.style.display=""),e.toolbar&&t.includes("util")){const a=e.toolbar.subElement.querySelector('[data-type="pin"]');(n||!a||a&&a.getAttribute("aria-label")===window.siyuan.languages.pin)&&(e.toolbar.subElement.classList.add("fn__none"),e.toolbar.subElementCloseCB&&(e.toolbar.subElementCloseCB(),e.toolbar.subElementCloseCB=void 0))}t.includes("select")&&e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select").forEach(a=>{a.classList.remove("protyle-wysiwyg--select"),a.removeAttribute("select-start"),a.removeAttribute("select-end")})},rs=t=>{t.includes("toolbar")&&document.querySelectorAll(".protyle-toolbar").forEach(e=>{e.classList.add("fn__none"),e.style.display=""}),t.includes("util")&&Es().forEach(e=>{if(e.protyle.toolbar){const n=e.protyle.toolbar.subElement.querySelector('[data-type="pin"]');(!n||n&&n.getAttribute("aria-label")===window.siyuan.languages.pin)&&(e.protyle.toolbar.subElement.classList.add("fn__none"),e.protyle.toolbar.subElementCloseCB&&(e.protyle.toolbar.subElementCloseCB(),e.protyle.toolbar.subElementCloseCB=void 0))}}),t.includes("pdfutil")&&document.querySelectorAll(".pdf__util").forEach(e=>{e.classList.add("fn__none")}),t.includes("gutter")&&document.querySelectorAll(".protyle-gutters").forEach(e=>{e.classList.add("fn__none"),e.innerHTML=""})},os=(t,e)=>{t.addEventListener("mousedown",n=>{if(N(n.target,"protyle-util")&&!t.classList.contains("protyle-util"))return;let a=N(n.target,"resize__move"),i,s;const r=t.getBoundingClientRect();if(a?(i=n.clientX-r.left,s=n.clientY-r.top):(i=n.clientX,s=n.clientY,a=N(n.target,"resize__rd")||N(n.target,"resize__r")||N(n.target,"resize__rt")||N(n.target,"resize__d")||N(n.target,"resize__l")||N(n.target,"resize__ld")||N(n.target,"resize__lt")||N(n.target,"resize__t")),!a)return;const o=t.clientHeight,l=t.clientWidth,c=a.className.split("resize__")[1].split(" ")[0],d=document;t.style.userSelect="none",t.classList.contains("b3-dialog__container")&&t.parentElement.style.display!=="block"&&(t.parentElement.style.display="block",t.style.left=r.left+"px",t.style.top=r.top+"px",t.style.width=r.width+"px"),d.ondragstart=()=>!1;let u=!1;d.onmousemove=g=>{if(u=!0,!!t)if(c==="move"){let f=g.clientX-i,h=g.clientY-s;f>window.innerWidth-l&&(f=window.innerWidth-l),h>window.innerHeight-o&&(h=window.innerHeight-o),t.style.left=Math.max(f,0)+"px",t.style.top=Math.max(h,p.SIZE_TOOLBAR_HEIGHT)+"px"}else c==="r"&&g.clientX-i+l>200&&g.clientX-i+l<window.innerWidth?(t.style.width=g.clientX-i+l+"px",t.style.maxWidth="none"):c==="d"&&g.clientY-s+o>160&&g.clientY-s+o<window.innerHeight-p.SIZE_TOOLBAR_HEIGHT?(t.style.height=g.clientY-s+o+"px",t.style.maxHeight=""):c==="t"&&g.clientY>p.SIZE_TOOLBAR_HEIGHT&&s-g.clientY+o>160?(t.style.top=g.clientY+"px",t.style.maxHeight="",t.style.height=s-g.clientY+o+"px"):c==="l"&&g.clientX>0&&i-g.clientX+l>200?(t.style.left=g.clientX+"px",t.style.width=i-g.clientX+l+"px",t.style.maxWidth="none"):c==="rd"&&g.clientX-i+l>200&&g.clientX-i+l<window.innerWidth&&g.clientY-s+o>160&&g.clientY-s+o<window.innerHeight-p.SIZE_TOOLBAR_HEIGHT?(t.style.height=g.clientY-s+o+"px",t.style.maxHeight="",t.style.maxWidth="none",t.style.width=g.clientX-i+l+"px"):c==="rt"&&g.clientX-i+l>200&&g.clientX-i+l<window.innerWidth&&g.clientY>p.SIZE_TOOLBAR_HEIGHT&&s-g.clientY+o>160?(t.style.width=g.clientX-i+l+"px",t.style.top=g.clientY+"px",t.style.maxHeight="",t.style.maxWidth="none",t.style.height=s-g.clientY+o+"px"):c==="lt"&&g.clientX>0&&i-g.clientX+l>200&&g.clientY>p.SIZE_TOOLBAR_HEIGHT&&s-g.clientY+o>160?(t.style.left=g.clientX+"px",t.style.width=i-g.clientX+l+"px",t.style.top=g.clientY+"px",t.style.maxHeight="",t.style.maxWidth="none",t.style.height=s-g.clientY+o+"px"):c==="ld"&&g.clientX>0&&i-g.clientX+l>200&&g.clientY-s+o>160&&g.clientY-s+o<window.innerHeight-p.SIZE_TOOLBAR_HEIGHT&&(t.style.left=g.clientX+"px",t.style.width=i-g.clientX+l+"px",t.style.height=g.clientY-s+o+"px",t.style.maxHeight="",t.style.maxWidth="none")},d.onmouseup=()=>{if(!t)return;window.siyuan.dragElement&&(window.siyuan.dragElement.style.opacity="",window.siyuan.dragElement=void 0),t.style.userSelect="auto",d.onmousemove=null,d.onmouseup=null,d.ondragstart=null,d.onselectstart=null,d.onselect=null,rs(["gutter"]);const g=N(t,"b3-dialog--open");if(g){const f=g.dataset.key;f&&t.offsetWidth&&(window.siyuan.storage[p.LOCAL_DIALOGPOSITION][f]={width:t.offsetWidth,height:t.offsetHeight,left:parseInt(t.style.left),top:parseInt(t.style.top)},Gt(p.LOCAL_DIALOGPOSITION,window.siyuan.storage[p.LOCAL_DIALOGPOSITION]))}u&&e&&e(c)}})},io=t=>{t.classList.add("protyle-wysiwyg--hl"),setTimeout(function(){t.classList.remove("protyle-wysiwyg--hl")},1024)},dr=(t,e,n="nearest")=>{let a;const i=t.wysiwyg.element;if(!t.preview.element.classList.contains("fn__none")){a=document.getElementById(e),a&&(t.preview.element.scrollTop=a.offsetTop,io(a));return}if(Array.from(i.querySelectorAll(`[data-node-id="${e}"]`)).find(s=>{if(!ge(s))return a=s,!0}),a)return kn(t,a,n),io(a),a;if(e===t.block.rootID&&t.options.render.title&&t.title.editElement)return io(t.title.editElement),t.title.editElement},kn=(t,e,n="nearest",a="auto")=>{var i,s,r,o,l,c;if(!t.disabled&&!e&&getSelection().rangeCount>0){const g=getSelection().getRangeAt(0),f=oe(g.startContainer);if(f){if(f.classList.contains("code-block")){const v=document.createElement("br");g.insertNode(v),v.scrollIntoView({block:n,behavior:a}),v.remove();return}if(f.classList.contains("av")&&f.dataset.render==="true"){if(((s=(i=f.querySelector(".av__row--header"))==null?void 0:i.getAttribute("style"))==null?void 0:s.indexOf("transform"))>-1||((o=(r=f.querySelector(".av__row--footer"))==null?void 0:r.getAttribute("style"))==null?void 0:o.indexOf("transform"))>-1)return;const v=f.querySelector(".av__cell--select, .av__row--select, .av__gallery-item--select");v?v.scrollIntoView({block:n,behavior:a}):f.scrollIntoView({block:n,behavior:a});return}const h=g.cloneRange(),m=document.createElement("br");g.insertNode(m);const b=t.contentElement,y=m.getBoundingClientRect().top-b.getBoundingClientRect().top;let _=0;y<0?_=b.scrollTop+y:y>b.clientHeight-74&&(_=b.scrollTop+(y+74-b.clientHeight)),_!==0&&b.scroll({top:_,behavior:a}),m.remove(),Pt(h);return}}if(!e&&((l=document.activeElement)==null?void 0:l.tagName)!=="TEXTAREA"&&((c=document.activeElement)==null?void 0:c.tagName)!=="INPUT"&&(e=oe(hn(t.wysiwyg.element).startContainer)),!e)return;const d=e.getBoundingClientRect(),u=t.contentElement.getBoundingClientRect();if(n==="start"){t.contentElement.scroll({top:t.contentElement.scrollTop+d.top-u.top,behavior:a});return}if(n==="nearest"){d.top<u.top?t.contentElement.scroll({top:t.contentElement.scrollTop+d.top-u.top,behavior:a}):d.bottom>u.bottom&&t.contentElement.scroll({top:t.contentElement.scrollTop+d.bottom-u.bottom,behavior:a});return}n==="center"&&t.contentElement.scroll({top:t.contentElement.scrollTop+d.top-(u.top+u.height/2),behavior:a})};var gl=Tn(2101);class fe{constructor(e){this.disableClose=e.disableClose,this.id=K(),window.siyuan.dialogs.push(this),this.destroyCallback=e.destroyCallback,this.element=document.createElement("div");let n,a;if(!x()&&e.positionId){const i=window.siyuan.storage[p.LOCAL_DIALOGPOSITION][e.positionId];i&&i.left+i.width+34<=window.innerWidth&&i.top+i.height<=window.innerHeight&&(n=i.left+"px",a=i.top+"px",e.width=i.width+"px",e.height=i.height+"px")}this.element.innerHTML=`<div class="b3-dialog" style="z-index: ${++window.siyuan.zIndex};${typeof n=="string"?"display:block":""}">
<div class="b3-dialog__scrim"${e.transparent?'style="background-color:transparent"':""}></div>
<div class="b3-dialog__container ${e.containerClassName||""}" style="width:${e.width||"auto"};height:${e.height||"auto"};
left:${n||"auto"};top:${a||"auto"}">
  <svg ${x()&&e.title?'style="top:0;right:0;"':""} class="b3-dialog__close${this.disableClose||e.hideCloseIcon?" fn__none":""}"><use xlink:href="#iconCloseRound"></use></svg>
  <div class="resize__move b3-dialog__header${e.title?"":" fn__none"}" onselectstart="return false;">${e.title||""}</div>
  <div class="b3-dialog__body">${e.content}</div>
  <div class="resize__rd"></div><div class="resize__ld"></div><div class="resize__lt"></div><div class="resize__rt"></div><div class="resize__r"></div><div class="resize__d"></div><div class="resize__t"></div><div class="resize__l"></div>
</div></div>`,this.element.querySelector(".b3-dialog__scrim").addEventListener("click",i=>{this.disableClose||this.destroy(),i.preventDefault(),i.stopPropagation()}),this.disableClose||this.element.querySelector(".b3-dialog__close").addEventListener("click",i=>{this.destroy(),i.preventDefault(),i.stopPropagation()}),document.body.append(this.element),e.disableAnimation?this.element.classList.add("b3-dialog--open"):setTimeout(()=>{this.element.classList.add("b3-dialog--open")},p.TIMEOUT_OPENDIALOG),os(this.element.querySelector(".b3-dialog__container"),e.resizeCallback)}destroy(e){this.element.classList.remove("b3-dialog--open"),setTimeout(()=>{var n;this.element.querySelector(".b3-dialog").style.zIndex<window.siyuan.menus.menu.element.style.zIndex&&window.siyuan.menus.menu.remove(),this.element.remove(),this.destroyCallback&&this.destroyCallback(e),window.siyuan.dialogs.find((a,i)=>{if(a.id===this.id)return window.siyuan.dialogs.splice(i,1),!0}),(n=document.getElementById("drag"))==null||n.classList.remove("fn__hidden")},p.TIMEOUT_DBLCLICK)}bindInput(e,n,a=!0){e.focus();let i;e.addEventListener("keydown",s=>{if(s.isComposing||s.repeat){s.preventDefault();return}if(s.key==="Escape"){this.destroy(),s.preventDefault(),s.stopPropagation();return}if(!s.shiftKey&&ct(s)&&s.key==="Enter"&&n&&a){if(i&&s.timeStamp-i<124)return;i=s.timeStamp,n(),s.preventDefault(),s.stopPropagation()}})}}const he=t=>t&&t.replace(/&/g,"&amp;").replace(/</g,"&lt;"),Ge=t=>t.replace(/</g,"&lt;"),ft=t=>t&&t.replace(/"/g,"&quot;").replace(/'/g,"&apos;"),Ot=t=>t&&t.replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&amp;lt;").replace(/&lt;/g,"&amp;lt;");var at=Tn(232);const fa=()=>{const t=window.siyuan.emojis[T(0,window.siyuan.emojis.length-1)];return typeof t.items[T(0,t.items.length-1)]=="undefined"?"1f600":t.items[T(0,t.items.length-1)].unicode},Yt=(t,e="",n=!1,a=!1)=>{if(!t)return"";let i="";if(t.startsWith("api/icon/getDynamicIcon"))i=`<img class="${e}" ${a?"data-":""}src="${t}"/>`;else if(t.indexOf(".")>-1)i=`<img class="${e}" ${a?"data-":""}src="/emojis/${t}"/>`;else try{t.split("-").forEach(s=>{s.length<5?i+=String.fromCodePoint(parseInt("0"+s,16)):i+=String.fromCodePoint(parseInt(s,16))}),n&&(i=`<span class="${e}">${i}</span>`)}catch(s){}return i},wi=t=>{const e=new IntersectionObserver(n=>{n.forEach(a=>{const i=a.target.getAttribute("data-index");if((typeof a.isIntersecting=="undefined"?a.intersectionRatio!==0:a.isIntersecting)&&i){let s="";window.siyuan.emojis[parseInt(i)].items.forEach(r=>{s+=`<button data-unicode="${r.unicode}" class="emojis__item ariaLabel" aria-label="${Fa(r)}">
${Yt(r.unicode)}</button>`}),a.target.innerHTML=s,a.target.removeAttribute("data-index"),a.target.style.minHeight=""}})});t.querySelectorAll(".emojis__content").forEach(n=>{e.observe(n)})},vi=t=>{const e=new IntersectionObserver(n=>{n.forEach(a=>{const i=a.target.getAttribute("data-src");(typeof a.isIntersecting=="undefined"?a.intersectionRatio!==0:a.isIntersecting)&&i&&(a.target.src=i,a.target.removeAttribute("data-src"))})});t.querySelectorAll("img").forEach(n=>{e.observe(n)})},xi=(t="",e)=>{let n="";const a=[];t&&(n=`<div class="emojis__title">${window.siyuan.languages.emoji}</div><div class="emojis__content">`);let i=0,s="";const r=[];window.siyuan.emojis.forEach((l,c)=>{t||(n+=`<div class="emojis__title" data-type="${c+1}">${Oa(c)}</div><div style="min-height:${c===0?"30px":"300px"}" class="emojis__content"${c>1?' data-index="'+c+'"':""}>`),l.items.length===0&&c===0&&!t&&(n+=`<div style="margin-left: 4px">${window.siyuan.languages.setEmojiTip}</div>`),l.items.forEach(d=>{if(t){if(window.siyuan.config.editor.emoji.includes(d.unicode)&&(Yt(d.unicode)===t||d.keywords.toLowerCase().indexOf(t.toLowerCase())>-1||d.description.toLowerCase().indexOf(t.toLowerCase())>-1||d.description_zh_cn.toLowerCase().indexOf(t.toLowerCase())>-1||d.description_ja_jp.toLowerCase().indexOf(t.toLowerCase())>-1)&&a.push(d),e&&i>e)return;(Yt(d.unicode)===t||d.keywords.toLowerCase().indexOf(t.toLowerCase())>-1||d.description.toLowerCase().indexOf(t.toLowerCase())>-1||d.description_zh_cn.toLowerCase().indexOf(t.toLowerCase())>-1||d.description_ja_jp.toLowerCase().indexOf(t.toLowerCase())>-1)&&(l.id==="custom"?r.push(d):s+=`<button data-unicode="${d.unicode}" class="emojis__item ariaLabel" aria-label="${Fa(d)}">
${Yt(d.unicode,void 0,!1,!0)}</button>`,i++)}else window.siyuan.config.editor.emoji.includes(d.unicode)&&a.push(d),c<2&&(n+=`<button data-unicode="${d.unicode}" class="emojis__item ariaLabel" aria-label="${Fa(d)}">
${Yt(d.unicode,void 0,!1,!0)}</button>`)}),t||(n+="</div>")}),t&&(r.sort((l,c)=>{const d=l.keywords.split("/"),u=c.keywords.split("/");return d[d.length-1].toLowerCase().indexOf(t.toLowerCase())<u[u.length-1].toLowerCase().indexOf(t.toLowerCase())?-1:0}).sort((l,c)=>{const d=l.keywords.split("/"),u=c.keywords.split("/");return d[d.length-1].toLowerCase().indexOf(t.toLowerCase())===u[u.length-1].toLowerCase().indexOf(t.toLowerCase())&&d[d.length-1].length<u[u.length-1].length?-1:0}).forEach(l=>{n+=`<button data-unicode="${l.unicode}" class="emojis__item ariaLabel" aria-label="${Fa(l)}">
${Yt(l.unicode,void 0,!1,!0)}</button>`}),n=n+s+"</div>");let o="";return a.length>0&&(o=`<div class="emojis__title" data-type="0">${window.siyuan.languages.recentEmoji}</div><div class="emojis__content">`,window.siyuan.config.editor.emoji.forEach(l=>{const c=a.filter(d=>d.unicode===l);c[0]&&(o+=`<button data-unicode="${c[0].unicode}" class="emojis__item ariaLabel" aria-label="${Fa(c[0])}">
${Yt(c[0].unicode,void 0,!1,!0)}
</button>`)}),o+="</div>"),o+n===""?`<div class="emojis__title">${window.siyuan.languages.emptyContent}</div>`:o+n},Za=t=>{window.siyuan.config.editor.emoji.unshift(t),window.siyuan.config.editor.emoji.length>p.SIZE_UNDO&&window.siyuan.config.editor.emoji.pop(),window.siyuan.config.editor.emoji=Array.from(new Set(window.siyuan.config.editor.emoji)),ae("/api/setting/setEmoji",{emoji:window.siyuan.config.editor.emoji})},Ts=(t,e)=>{const n={1:["Sun","\u5468\u65E5","\u9031\u65E5"],2:["SUN","\u5468\u5929","\u9031\u5929"],3:["Sunday","\u661F\u671F\u65E5","\u661F\u671F\u65E5"],4:["SUNDAY","\u661F\u671F\u5929","\u661F\u671F\u5929"]};let a=0;return t===""&&(t=window.siyuan.config.lang),t==="zh_CN"?a=1:t==="zh_CHT"&&(a=2),`<option value="1" ${e==="1"?" selected":""}>${n[1][a]}</option>
<option value="2" ${e==="2"?" selected":""}>${n[2][a]}</option>
<option value="3" ${e==="3"?" selected":""}>${n[3][a]}</option>
<option value="4" ${e==="4"?" selected":""}>${n[4][a]}</option>`},ls=(t,e)=>{if(!t)return;let n="";window.siyuan.emojis[parseInt(t)].items.forEach(a=>{n+=`<button data-unicode="${a.unicode}" class="emojis__item ariaLabel" aria-label="${Fa(a)}">${Yt(a.unicode)}</button>`}),e.innerHTML=n,e.removeAttribute("data-index"),e.removeAttribute("style")},Va=(t,e,n,a,i)=>{e!=="av"?window.siyuan.menus.menu.remove():window.siyuan.menus.menu.removeScrollEvent();const s="api/icon/getDynamicIcon?",r={color:"#d23f31",lang:"",date:at().format("YYYY-MM-DD"),weekdayType:"1",type:"1",content:"SiYuan"};if(i&&i.getAttribute("src").startsWith(s)){const b=new URLSearchParams(i.getAttribute("src").replace(s,""));r.color=b.get("color")||"#d23f31",r.color.startsWith("#")||(r.color="#"+r.color),r.lang=b.get("lang")||"",r.date=b.get("date")||"",r.weekdayType=b.get("weekdayType")||"1",r.type=b.get("type")||"1",r.content=b.get("content")||"SiYuan"}const o=new fe({disableAnimation:!0,transparent:!0,hideCloseIcon:!0,width:x()?"80vw":"368px",height:"50vh",content:`<div class="emojis">
    <div class="emojis__tabheader">
        <div data-type="tab-emoji" class="ariaLabel block__icon block__icon--show" aria-label="${window.siyuan.languages.emoji}"><svg><use xlink:href="#iconEmoji"></use></svg></div>
        <div class="fn__space"></div>
        <div data-type="tab-dynamic" class="ariaLabel block__icon block__icon--show" aria-label="${window.siyuan.languages.dynamicIcon}"><svg><use xlink:href="#iconCalendar"></use></svg></div>
        <div class="fn__flex-1"></div>
        <span class="block__icon block__icon--show fn__flex-center ariaLabel" data-action="remove" aria-label="${window.siyuan.languages.remove}"><svg><use xlink:href="#iconTrashcan"></use></svg></span>
    </div>
    <div class="emojis__tabbody">
        <div class="fn__none" data-type="tab-emoji">
            <div class="fn__hr"></div>
            <div class="fn__flex">
                <span class="fn__space"></span>
                <label class="b3-form__icon fn__flex-1" style="overflow:initial;">
                    <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>
                    <input class="b3-form__icon-input b3-text-field fn__block" placeholder="${window.siyuan.languages.search}">
                </label>
                <span class="fn__space"></span>
                <span class="block__icon block__icon--show fn__flex-center ariaLabel" data-action="random" aria-label="${window.siyuan.languages.random}"><svg><use xlink:href="#iconRefresh"></use></svg></span>
                <span class="fn__space"></span>
            </div>
            <div class="emojis__panel">${xi()}</div>
            <div class="fn__flex">
                ${[["2b50",window.siyuan.languages.recentEmoji],["1f527",Oa(0)],["1f60d",Oa(1)],["1f433",Oa(2)],["1f96a",Oa(3)],["1f3a8",Oa(4)],["1f3dd-fe0f",Oa(5)],["1f52e",Oa(6)],["267e-fe0f",Oa(7)],["1f6a9",Oa(8)]].map(([b,y],_)=>`<div data-type="${_}" class="emojis__type ariaLabel" aria-label="${y}">${Yt(b)}</div>`).join("")}
            </div>
        </div>
        <div class="fn__none" data-type="tab-dynamic">
            <div class="fn__flex emoji__dynamic-color">
                <div class="color__square fn__pointer${r.color==="#d23f31"?" color__square--current":""}" style="background-color:#d23f31"></div>
                <div class="color__square fn__pointer${r.color==="#3575f0"?" color__square--current":""}" style="background-color:#3575f0"></div>
                <div class="color__square fn__pointer${r.color==="#f3a92f"?" color__square--current":""}" style="background-color:#f3a92f"></div>
                <div class="color__square fn__pointer${r.color==="#65b84d"?" color__square--current":""}" style="background-color:#65b84d"></div>
                <div class="color__square fn__pointer${r.color==="#e099ff"?" color__square--current":""}" style="background-color:#e099ff"></div>
                <div class="color__square fn__pointer${r.color==="#ea5d97"?" color__square--current":""}" style="background-color:#ea5d97"></div>
                <div class="color__square fn__pointer${r.color==="#93627f"?" color__square--current":""}" style="background-color:#93627f"></div>
                <div class="color__square fn__pointer${r.color==="#5f6368"?" color__square--current":""}" style="background-color:#5f6368"></div>
                <div class="fn__space--small"></div>
                <input type="text" class="b3-text-field fn__flex-1 fn__flex-center" value="${r.color}">
            </div>
            <div class="fn__flex">
                <span class="fn__space"></span>
                <span class="fn__flex-center ft__on-surface" style="width: 89px">${window.siyuan.languages.language}</span>
                <span class="fn__space--small"></span>
                <select class="b3-select fn__flex-1">
                    <option value="" ${r.lang===""?" selected":""}>${window.siyuan.languages.themeOS}</option>
                    <option value="en_US" ${r.lang==="en_US"?" selected":""}>English (en_US)</option>
                    <option value="zh_CHT" ${r.lang==="zh_CHT"?" selected":""}>\u7E41\u9AD4\u4E2D\u6587 (zh_CHT)</option>
                    <option value="zh_CN" ${r.lang==="zh_CN"?" selected":""}>\u7B80\u4F53\u4E2D\u6587 (zh_CN)</option>
                </select>
                <span class="fn__space"></span>
            </div>
            <div class="fn__hr"></div>
            <div class="fn__flex">
                <span class="fn__space"></span>
                <span class="fn__flex-center ft__on-surface" style="width: 89px">${window.siyuan.languages.date}</span>
                <span class="fn__space--small"></span>
                <input type="date" max="9999-12-31" class="b3-text-field fn__flex-1" value="${r.date}"/>
                <span class="fn__space--small"></span>
                <span data-action="clearDate" class="ariaLabel block__icon block__icon--show" aria-label="${window.siyuan.languages.dynamicIconDateEmptyInfo}"><svg><use xlink:href="#iconTrashcan"></use></svg></span>
                <span class="fn__space"></span>
            </div>
            <div class="fn__hr"></div>
            <div class="fn__flex">
                <span class="fn__space"></span>
                <span class="fn__flex-center ft__on-surface" style="width: 89px">${window.siyuan.languages.format}</span>
                <span class="fn__space--small"></span>
                <select class="b3-select fn__flex-1">
                    ${Ts(r.lang,r.weekdayType)}
                </select>
                <span class="fn__space"></span>
            </div>
            <div class="fn__flex fn__flex-wrap">
                <img class="emoji__dynamic-item${r.type==="1"?" emoji__dynamic-item--current":""}" src="${s}type=1&color=${encodeURIComponent(r.color)}&date=${r.date}&weekdayType=${r.weekdayType}&lang=${r.lang}">
                <img class="emoji__dynamic-item${r.type==="2"?" emoji__dynamic-item--current":""}" src="${s}type=2&color=${encodeURIComponent(r.color)}&date=${r.date}&weekdayType=${r.weekdayType}&lang=${r.lang}">
                <img class="emoji__dynamic-item${r.type==="3"?" emoji__dynamic-item--current":""}" src="${s}type=3&color=${encodeURIComponent(r.color)}&date=${r.date}&weekdayType=${r.weekdayType}&lang=${r.lang}">
                <img class="emoji__dynamic-item${r.type==="4"?" emoji__dynamic-item--current":""}" src="${s}type=4&color=${encodeURIComponent(r.color)}&date=${r.date}&weekdayType=${r.weekdayType}&lang=${r.lang}">
                <img class="emoji__dynamic-item${r.type==="5"?" emoji__dynamic-item--current":""}" src="${s}type=5&color=${encodeURIComponent(r.color)}&date=${r.date}&weekdayType=${r.weekdayType}&lang=${r.lang}">
                <img class="emoji__dynamic-item${r.type==="6"?" emoji__dynamic-item--current":""}" src="${s}type=6&color=${encodeURIComponent(r.color)}&date=${r.date}&weekdayType=${r.weekdayType}&lang=${r.lang}">
                <img class="emoji__dynamic-item${r.type==="7"?" emoji__dynamic-item--current":""}" src="${s}type=7&color=${encodeURIComponent(r.color)}&date=${r.date}&weekdayType=${r.weekdayType}&lang=${r.lang}">
            </div>
            <div class="fn__hr"></div>
            <div class="fn__flex">
                <span class="fn__space"></span>
                <span class="fn__flex-center ft__on-surface" style="width: 89px">${window.siyuan.languages.custom}</span>
                <span class="fn__space--small"></span>
                <input type="text" class="b3-text-field fn__flex-1" value="">
                <span class="fn__space"></span>
            </div>
            <div>
                <img data-type="text" class="emoji__dynamic-item${r.type==="8"?" emoji__dynamic-item--current":""}" src="${s}type=8&color=${encodeURIComponent(r.color)}&content=${encodeURIComponent(r.content)}&id=${t}">
            </div>
        </div>
    </div>
</div>`});o.element.setAttribute("data-key",p.DIALOG_EMOJIS),o.element.querySelector(".b3-dialog__container").setAttribute("data-menu","true");const l=o.element.querySelector(".b3-dialog");l.style.justifyContent="inherit",l.style.alignItems="inherit";const c=window.siyuan.storage[p.LOCAL_EMOJIS].currentTab;o.element.querySelector(`.emojis__tabheader [data-type="tab-${c}"]`).classList.add("block__icon--active"),o.element.querySelector(`.emojis__tabbody [data-type="tab-${c}"]`).classList.remove("fn__none"),gn(o.element.querySelector(".b3-dialog__container"),n.x,n.y,n.h,n.w),o.element.querySelector(".emojis__item").classList.add("emojis__item--current");const d=o.element.querySelector('[data-type="tab-emoji"] .b3-text-field'),u=o.element.querySelector(".emojis__panel");d.addEventListener("compositionend",()=>{var b;u.innerHTML=xi(d.value),d.value?u.nextElementSibling.classList.add("fn__none"):u.nextElementSibling.classList.remove("fn__none"),u.scrollTop=0,(b=o.element.querySelector(".emojis__item"))==null||b.classList.add("emojis__item--current"),d.value===""&&wi(o.element),vi(o.element)}),d.addEventListener("input",b=>{var y;b.isComposing||(u.innerHTML=xi(d.value),d.value?u.nextElementSibling.classList.add("fn__none"):u.nextElementSibling.classList.remove("fn__none"),u.scrollTop=0,(y=o.element.querySelector(".emojis__item"))==null||y.classList.add("emojis__item--current"),d.value===""&&wi(o.element),vi(o.element))}),d.addEventListener("keydown",b=>{var y,_,v,U;if(b.isComposing||b.key.indexOf("Arrow")===-1&&b.key!=="Enter")return;const ee=o.element.querySelector(".emojis__item--current");if(!ee)return;if(b.key==="Enter"){const k=ee.getAttribute("data-unicode");e==="notebook"?ae("/api/notebook/setNotebookIcon",{notebook:t,icon:k},()=>{o.destroy(),Za(k),Ca(k,t,"iconFilesRoot")}):e==="doc"&&ae("/api/attr/setBlockAttrs",{id:t,attrs:{icon:k}},()=>{o.destroy(),Za(k),Ca(k,t),Zi(k,t)}),a&&a(k),b.preventDefault(),b.stopPropagation();return}let Z;if(b.key==="ArrowLeft")ee.previousElementSibling?(ee.classList.remove("emojis__item--current"),Z=ee.previousElementSibling,b.preventDefault(),b.stopPropagation()):(y=ee.parentElement.previousElementSibling)!=null&&y.previousElementSibling&&(ee.classList.remove("emojis__item--current"),Z=ee.parentElement.previousElementSibling.previousElementSibling.lastElementChild,b.preventDefault(),b.stopPropagation());else if(b.key==="ArrowRight")ee.nextElementSibling?(ee.classList.remove("emojis__item--current"),Z=ee.nextElementSibling,b.preventDefault(),b.stopPropagation()):(_=ee.parentElement.nextElementSibling)!=null&&_.nextElementSibling&&(ee.classList.remove("emojis__item--current"),Z=ee.parentElement.nextElementSibling.nextElementSibling.firstElementChild,b.preventDefault(),b.stopPropagation());else if(b.key==="ArrowDown"){if(ee.nextElementSibling){ee.classList.remove("emojis__item--current");let k=Math.floor(ee.parentElement.clientWidth/(ee.clientWidth+2));for(Z=ee;Z.nextElementSibling&&k>0;)Z=Z.nextElementSibling,k--}else{const k=(v=ee.parentElement.nextElementSibling)==null?void 0:v.nextElementSibling;k&&(Z=k.firstElementChild,ee.classList.remove("emojis__item--current"))}b.preventDefault(),b.stopPropagation()}else if(b.key==="ArrowUp"){if(ee.previousElementSibling){ee.classList.remove("emojis__item--current");let k=Math.floor(ee.parentElement.clientWidth/(ee.clientWidth+2));for(Z=ee;Z.previousElementSibling&&k>0;)Z=Z.previousElementSibling,k--}else{const k=(U=ee.parentElement.previousElementSibling)==null?void 0:U.previousElementSibling;k&&(Z=k.lastElementChild,ee.classList.remove("emojis__item--current"))}b.preventDefault(),b.stopPropagation()}if(Z){Z.classList.add("emojis__item--current");const k=d.clientHeight+6;Z.offsetTop-k<u.scrollTop?u.scrollTop=Z.offsetTop-k-6:Z.offsetTop-k-u.clientHeight+Z.clientHeight>u.scrollTop&&(u.scrollTop=Z.offsetTop-k-u.clientHeight+Z.clientHeight)}}),!x()&&c==="emoji"&&d.focus(),wi(o.element),vi(o.element),o.element.addEventListener("click",b=>{var y,_;let v=b.target;for(;v&&v!==o.element;){if(v.classList.contains("emojis__type")){const U=u.querySelector(`[data-type="${v.getAttribute("data-type")}"]`);if(U){const ee=U.nextElementSibling.getAttribute("data-index");ee&&(ls((y=U.previousElementSibling)==null?void 0:y.getAttribute("data-index"),U.previousElementSibling),ls(ee,U.nextElementSibling)),u.scrollTo({top:U.offsetTop-77})}break}else if(v.getAttribute("data-action")==="remove"){e==="notebook"?ae("/api/notebook/setNotebookIcon",{notebook:t,icon:""},()=>{o.destroy(),Ca("",t,"iconFilesRoot")}):e==="doc"&&ae("/api/attr/setBlockAttrs",{id:t,attrs:{icon:""}},()=>{o.destroy(),Ca("",t),Zi("",t)}),a&&a("");break}else if(v.classList.contains("emojis__item")||v.getAttribute("data-action")==="random"||v.classList.contains("emoji__dynamic-item")){let U="";v.classList.contains("emojis__item")?(U=v.getAttribute("data-unicode"),o.destroy()):v.classList.contains("emoji__dynamic-item")?(U=v.getAttribute("src"),o.destroy()):U=fa(),e==="notebook"?ae("/api/notebook/setNotebookIcon",{notebook:t,icon:U},()=>{Za(U),Ca(U,t,"iconFilesRoot")}):e==="doc"&&ae("/api/attr/setBlockAttrs",{id:t,attrs:{icon:U}},()=>{Za(U),Ca(U,t),Zi(U,t)}),a&&a(U);break}else if((_=v.getAttribute("data-type"))!=null&&_.startsWith("tab-")){l.querySelectorAll('.emojis__tabheader [data-type|="tab"]').forEach(U=>{U.dataset.type===v.dataset.type?U.classList.add("block__icon--active"):U.classList.remove("block__icon--active")}),l.querySelectorAll(".emojis__tabbody > div").forEach(U=>{U.dataset.type===v.dataset.type?U.classList.remove("fn__none"):U.classList.add("fn__none")}),window.siyuan.storage[p.LOCAL_EMOJIS].currentTab=v.dataset.type.replace("tab-",""),Gt(p.LOCAL_EMOJIS,window.siyuan.storage[p.LOCAL_EMOJIS]);break}else if(v.classList.contains("color__square")){h[0].value=v.getAttribute("style").replace("background-color:",""),h[0].dispatchEvent(new CustomEvent("input"));break}else if(v.dataset.action==="clearDate"){f.value="",f.dispatchEvent(new CustomEvent("change"));break}v=v.parentElement}});const g=o.element.querySelectorAll('[data-type="tab-dynamic"] .b3-select');g[0].addEventListener("change",()=>{o.element.querySelectorAll(".fn__flex-wrap .emoji__dynamic-item").forEach(b=>{const y=new URLSearchParams(b.getAttribute("src").replace(s,""));g[0].value?y.set("lang",g[0].value):y.delete("lang"),b.setAttribute("src",s+y.toString()),g[1].innerHTML=Ts(g[0].value,g[1].value)})}),g[1].addEventListener("change",()=>{o.element.querySelectorAll(".fn__flex-wrap .emoji__dynamic-item").forEach(b=>{const y=new URLSearchParams(b.getAttribute("src").replace(s,""));y.set("weekdayType",g[1].value),b.setAttribute("src",s+y.toString())})});const f=o.element.querySelector('[data-type="tab-dynamic"] [type="date"]');f.addEventListener("change",()=>{o.element.querySelectorAll(".fn__flex-wrap .emoji__dynamic-item").forEach(b=>{const y=new URLSearchParams(b.getAttribute("src").replace(s,""));y.set("date",f.value?at(f.value).format("YYYY-MM-DD"):""),b.setAttribute("src",s+y.toString())})});const h=o.element.querySelectorAll('[data-type="tab-dynamic"] [type="text"]'),m=o.element.querySelector('.emoji__dynamic-item[data-type="text"]');h[0].addEventListener("input",()=>{h[0].value.startsWith("#")&&(o.element.querySelectorAll(".emoji__dynamic-item").forEach(b=>{const y=new URLSearchParams(b.getAttribute("src").replace(s,""));y.set("color",h[0].value),b.setAttribute("src",s+y.toString())}),o.element.querySelectorAll(".color__square").forEach(b=>{b.style.backgroundColor===h[0].value?b.classList.add("color__square--current"):b.classList.remove("color__square--current")}))}),h[1].value=r.content,h[1].addEventListener("input",()=>{const b=new URLSearchParams(m.getAttribute("src").replace(s,""));b.set("content",h[1].value),m.setAttribute("src",s+b.toString())})},Zi=(t,e)=>{Cn().outline.forEach(n=>{n.blockId===e&&(n.headerElement.nextElementSibling.firstElementChild.outerHTML=Yt(t||window.siyuan.storage[p.LOCAL_IMAGES].file,"b3-list-item__graphic",!0))})},Ca=(t,e,n="iconFile")=>{let a;const i=Vn("file");if(i){const s=i.data.file;n==="iconFile"?a=s.element.querySelector(`[data-node-id="${e}"] .b3-list-item__icon`):a=s.element.querySelector(`[data-node-id="${e}"] .b3-list-item__icon`)||s.element.querySelector(`[data-url="${e}"] .b3-list-item__icon`)||s.closeElement.querySelector(`[data-url="${e}"] .b3-list-item__icon`)}a&&(a.innerHTML=Yt(t||(n==="iconFile"?a.previousElementSibling.classList.contains("fn__hidden")?window.siyuan.storage[p.LOCAL_IMAGES].file:window.siyuan.storage[p.LOCAL_IMAGES].folder:window.siyuan.storage[p.LOCAL_IMAGES].note))),n!=="iconFile"&&fr()},Fa=t=>window.siyuan.config.lang==="zh_CN"?t.description_zh_cn:window.siyuan.config.lang==="ja_JP"?t.description_ja_jp:t.description,Oa=t=>window.siyuan.config.lang==="zh_CN"?window.siyuan.emojis[t].title_zh_cn:window.siyuan.config.lang==="ja_JP"?window.siyuan.emojis[t].title_ja_jp:window.siyuan.emojis[t].title,so=t=>{if(window.siyuan.emojis[0].items.length>0){const e={};window.siyuan.emojis[0].items.forEach(n=>{e[n.keywords]=t.options.hint.emojiPath+"/"+n.unicode}),t.lute.PutEmojis(e)}},ud=()=>{ae("/api/system/getEmojiConf",{},t=>{window.siyuan.emojis=t.data,Es().forEach(e=>{so(e.protyle)})})},fd=(t,e)=>{if(t.includes("\u2303")){if(!e.ctrlKey)return!1}else if(Jt()?e.ctrlKey:t.includes("\u2318")?!e.ctrlKey:e.ctrlKey)return!1;if(t.includes("\u2325")){if(!e.altKey)return!1}else if(e.altKey)return!1;if(t.includes("\u21E7")){if(!e.shiftKey)return!1}else if(e.shiftKey)return!1;if(t.includes("\u2318")){if(Jt()?!e.metaKey:!e.ctrlKey)return!1}else if(Jt()?e.metaKey:t.includes("\u2303")?!e.ctrlKey:e.ctrlKey)return!1;return!0},ro=(t,e)=>{const n=t.replace(e,p.ZWSP).split("");return n.forEach((a,i)=>{a===p.ZWSP&&(n[i]=e)}),n},Qe=(t,e)=>{if(!t)return!1;if(t.startsWith("\u2303")&&!Jt()){if(t==="\u2303D")return!1;t=t.replace("\u2318","").replace("\u2303","\u2318").replace("\u2318\u21E7","\u21E7\u2318").replace("\u2318\u2325\u21E7","\u2325\u21E7\u2318").replace("\u2318\u2325","\u2325\u2318")}if(t.indexOf("\u21E7")===-1&&t.indexOf("\u2318")===-1&&t.indexOf("\u2325")===-1&&t.indexOf("\u2303")===-1)return!!(ct(e)&&!e.altKey&&!e.shiftKey&&t===p.KEYCODELIST[e.keyCode]);let n=t.split("");if(t.indexOf("F")>-1?n.forEach((i,s)=>{i==="F"&&(n[s]="F"+n.splice(s+1,1),n[s+1]&&(n[s+1]+=n.splice(s+1,1)))}):t.indexOf("PageUp")>-1?n=ro(t,"PageUp"):t.indexOf("PageDown")>-1?n=ro(t,"PageDown"):t.indexOf("Home")>-1?n=ro(t,"Home"):t.indexOf("End")>-1&&(n=ro(t,"End")),t.startsWith("\u21E7")&&n.length===2)return!!(ct(e)&&!e.altKey&&e.shiftKey&&n[1]===p.KEYCODELIST[e.keyCode]);if(t.startsWith("\u2325")){let i=n.length===3?n[2]:n[1];n.length===4&&(i=n[3]);const s=i===p.KEYCODELIST[e.keyCode];return!!(s&&e.altKey&&!e.shiftKey&&n.length<4&&(n.length===3?je(e)&&t.startsWith("\u2325\u2318"):ct(e))||s&&t.startsWith("\u2325\u21E7\u2318")&&n.length===4&&e.altKey&&e.shiftKey&&je(e)||s&&t.startsWith("\u2325\u21E7")&&n.length===3&&e.altKey&&e.shiftKey&&ct(e))}if(t.startsWith("\u2303")){if(!Jt())return!1;let i=n.length===3?n[2]:n[1];n.length===4?i=n[3]:n.length===5&&(i=n[4]);const s=i===p.KEYCODELIST[e.keyCode];return!!(s&&e.ctrlKey&&!e.altKey&&!e.shiftKey&&n.length<4&&(n.length===3?e.metaKey&&t.startsWith("\u2303\u2318"):!e.metaKey)||s&&t.startsWith("\u2303\u21E7")&&n.length===3&&e.ctrlKey&&!e.altKey&&e.shiftKey&&!e.metaKey||s&&t.startsWith("\u2303\u2325")&&n.length===3&&e.ctrlKey&&e.altKey&&!e.shiftKey&&!e.metaKey||s&&n.length===4&&e.ctrlKey&&(t.startsWith("\u2303\u2325\u21E7")&&e.shiftKey&&!e.metaKey&&e.altKey||t.startsWith("\u2303\u2325\u2318")&&!e.shiftKey&&e.metaKey&&e.altKey||t.startsWith("\u2303\u21E7\u2318")&&e.shiftKey&&e.metaKey&&!e.altKey)||s&&n.length===5&&e.ctrlKey&&e.shiftKey&&e.metaKey&&e.altKey)}const a=n.length>2&&n[0]==="\u21E7";return je(e)&&!e.altKey&&(!a&&!e.shiftKey||a&&e.shiftKey)?(a?n[2]:n[1])===p.KEYCODELIST[e.keyCode]:!1},sf=t=>{let e=!1;return Object.keys(window.siyuan.config.keymap).find(n=>{const a=window.siyuan.config.keymap[n];if(Object.keys(a).find(i=>{const s=a[i];if(typeof s.custom=="string"){if(s.custom===t)return e=!0,!0}else if(Object.keys(s).forEach(r=>{if(s[r].custom===t)return e=!0,!0}),e)return!0}),e)return!0}),e},oh=()=>{window.siyuan.config.keymap.general&&Object.keys(window.siyuan.config.keymap.general).forEach(t=>{["fileTree","outline","bookmark","tag","dailyNote","inbox","backlinks","graphView","globalGraph","riffCard"].includes(t)&&(navigator.platform.toUpperCase().indexOf("MAC")>-1?(window.siyuan.config.keymap.general[t].default=window.siyuan.config.keymap.general[t].default.replace("\u2325","\u2303"),window.siyuan.config.keymap.general[t].default===window.siyuan.config.keymap.general[t].custom&&(window.siyuan.config.keymap.general[t].custom=window.siyuan.config.keymap.general[t].default.replace("\u2325","\u2303"))):(window.siyuan.config.keymap.general[t].default=window.siyuan.config.keymap.general[t].default.replace("\u2303","\u2325"),window.siyuan.config.keymap.general[t].default===window.siyuan.config.keymap.general[t].custom&&(window.siyuan.config.keymap.general[t].custom=window.siyuan.config.keymap.general[t].default.replace("\u2303","\u2325"))))})};class ta{constructor(e,n){if(this.menu=window.siyuan.menus.menu,this.isOpen=!1,this.element=this.menu.element,e){const a=this.menu.element.getAttribute("data-name");a&&a===e&&(this.isOpen=!0)}this.menu.remove(),this.isOpen||(e&&this.menu.element.setAttribute("data-name",e),this.menu.removeCB=n)}showSubMenu(e){this.menu.showSubMenu(e)}addItem(e){if(!this.isOpen)return this.menu.addItem(e)}addSeparator(e,n=!1){let a,i,s=!1;if(typeof e=="object"?(s=e.ignore||!1,i=e.index,a=e.id):typeof e=="number"&&(i=e,s=n),!(s||this.isOpen))return this.menu.addItem({id:a,type:"separator",index:i})}open(e){this.isOpen||this.menu.popup(e)}fullscreen(e="all"){this.isOpen||this.menu.fullscreen(e)}close(){this.menu.remove()}}const hy=(t,e)=>{},gy=()=>{const t=new URLSearchParams(window.location.search),e=t.get("url");let n="",a=!1;if(/^web\+siyuan:\/\/blocks\/\d{14}-\w{7}/.test(e))n=e.substring(20,42),a=O("focus",e)==="1";else if(window.JSAndroid){const i=window.JSAndroid.getBlockURL();n=rf(i),a=O("focus",i)==="1"}else n=t.get("id"),a=t.get("focus")==="1";return{id:n,isZoomIn:a}},lh=t=>/^siyuan:\/\/blocks\/\d{14}-\w{7}/.test(t),rf=t=>t.substring(16,38),uv=(t=window.location.href)=>{const e=new URL(window.location.origin);e.pathname="/",e.searchParams.set("to",t),window.location.href=e.href},fv=()=>{let t=document.getElementById("baseURL");t||(t=document.createElement("base"),t.id="baseURL"),t.setAttribute("href",location.origin),document.getElementsByTagName("head")[0].appendChild(t)},ha=(t,e=!0,n=!1)=>{let a=t;return e&&(a=_n().basename(t)),n&&a.endsWith(".sy")&&(a=a.substr(0,a.length-3)),a},pd=t=>_n().basename(t,_n().extname(t)).replace(/-\d{14}-\w{7}/,""),Mo=t=>!t||(t=t.trim(),1>t.length)?!1:(t=t.toLowerCase(),t.startsWith("assets/")||t.startsWith("file://")||t.startsWith("\\\\")?!0:lt()?t.indexOf(":")===1:t.startsWith("/")),_n=()=>gl.posix?gl.posix:gl,pv=()=>path,of=t=>{const e=[];return t.forEach(n=>{if(n.getAttribute("data-type")!=="navigation-root"){const a=n.getAttribute("data-path");e.find(s=>{if(a.startsWith(s.replace(".sy","")))return!0})||e.push(a)}}),e},lf=(t,e,n)=>{ae("/api/filetree/moveDocs",{toNotebook:e,fromPaths:t,toPath:n})},ur=(t,e,n,a,i=!1)=>{if(window.siyuan.dialogs.find(f=>{if(f.element.querySelector("#foldList"))return f.destroy(),!0}))return;const r=new fe({title:`<div style="padding: 8px;">
    ${a||window.siyuan.languages.move}
    <div style="max-height: 16px;line-height: 14px;-webkit-mask-image: linear-gradient(to top, rgba(0, 0, 0, 0) 0, #000 6px);padding-bottom: 4px;margin-bottom: -4px" class="ft__smaller ft__on-surface fn__hidescrollbar"></div>
</div>`,content:`<div class="b3-form__icon" style="margin: 8px">
    <span data-menu="true" class="b3-form__icon-list fn__a b3-tooltips b3-tooltips__s" aria-label="${Mt("\u2325\u2193")}">
        <svg class="svg--mid"><use xlink:href="#iconSearch"></use></svg>
        <svg class="svg--smaller"><use xlink:href="#iconDown"></use></svg>
    </span>
    <input class="b3-text-field fn__block" style="padding-left: 42px;" value="" placeholder="${window.siyuan.languages.search}">
</div>
<ul id="foldList" class="fn__flex-1 fn__none b3-list b3-list--background${x()?" b3-list--mobile":""}" style="overflow: auto;position: relative"></ul>
<div id="foldTree" class="fn__flex-1${x()?" b3-list--mobile":""}" style="overflow: auto;position: relative"></div>
<div class="fn__hr"></div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"50vw",height:x()?"80vh":"70vh",destroyCallback(){n&&Pt(n)}});r.element.querySelector(".b3-dialog__header").setAttribute("style","padding:0"),r.element.setAttribute("data-key",p.DIALOG_MOVEPATHTO),e&&e.length>0&&ae("/api/filetree/getHPathsByPaths",{paths:e},f=>{r.element.querySelector(".b3-dialog__header .ft__smaller").innerHTML=he(f.data.join(" "))});const o=r.element.querySelector("#foldList"),l=r.element.querySelector("#foldTree");fr(f=>{let h="";f.forEach(m=>{if(!m.closed){let b="";i&&(b=`<span class="counter counter--right b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.flashcardNewCard}">${m.newFlashcardCount}</span>
<span class="counter counter--right b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.flashcardDueCard}">${m.dueFlashcardCount}</span>
<span class="counter counter--right b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.flashcardCard}">${m.flashcardCount}</span>`),h+=`<ul class="b3-list b3-list--background">
<li class="b3-list-item${h===""?" b3-list-item--focus":""}" data-path="/" data-box="${m.id}">
    <span class="b3-list-item__toggle b3-list-item__toggle--hl">
        <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>
    </span>
    ${Yt(m.icon||window.siyuan.storage[p.LOCAL_IMAGES].note,"b3-list-item__graphic",!0)}
    <span class="b3-list-item__text">${he(m.name)}</span>
    ${b}
</li></ul>`}}),l.innerHTML=h},i);const c=r.element.querySelector(".b3-text-field");c.value=window.siyuan.storage[p.LOCAL_MOVE_PATH].k,c.select();const d=f=>{if(!(f&&f.isComposing)){if(c.value.trim()===""){o.classList.add("fn__none"),l.classList.remove("fn__none");return}l.classList.add("fn__none"),o.classList.remove("fn__none"),o.scrollTo(0,0),ae("/api/filetree/searchDocs",{k:c.value,flashcard:i},h=>{let m="";h.data.forEach(b=>{let y="";i&&(y=`<span class="fn__flex-1"></span>
<span class="counter counter--right b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.flashcardNewCard}">${b.newFlashcardCount}</span>
<span class="counter counter--right b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.flashcardDueCard}">${b.dueFlashcardCount}</span>
<span class="counter counter--right b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.flashcardCard}">${b.flashcardCount}</span>`),m+=`<li class="b3-list-item${m===""?" b3-list-item--focus":""}" data-path="${b.path}" data-box="${b.box}">
    ${Yt(b.boxIcon||window.siyuan.storage[p.LOCAL_IMAGES].note,"b3-list-item__graphic",!0)}
    <span class="b3-list-item__showall" style="padding: 4px 0">${he(b.hPath)}</span>
    ${y}
</li>`}),o.innerHTML=m})}},u=()=>{const f=window.siyuan.storage[p.LOCAL_MOVE_PATH].keys;if(!f||f.length===0||f.length===1&&f[0]===c.value)return;const h=new ta(p.MENU_MOVE_PATH_HISTORY);if(h.isOpen)return;h.element.classList.add("b3-menu--list"),h.addItem({iconHTML:"",label:window.siyuan.languages.clearHistory,click(){window.siyuan.storage[p.LOCAL_MOVE_PATH].keys=[],Gt(p.LOCAL_MOVE_PATH,window.siyuan.storage[p.LOCAL_MOVE_PATH])}});const m=h.addSeparator(1);let b=!0;f.forEach(_=>{if(_!==c.value&&_){const v=h.addItem({iconHTML:"",label:he(_),action:"iconCloseRound",bind(U){U.addEventListener("click",ee=>{var Z;N(ee.target,"b3-menu__action")?(f.find((k,w)=>{if(k===_)return f.splice(w,1),!0}),window.siyuan.storage[p.LOCAL_MOVE_PATH].keys=f,Gt(p.LOCAL_MOVE_PATH,window.siyuan.storage[p.LOCAL_MOVE_PATH]),(Z=U.previousElementSibling)!=null&&Z.classList.contains("b3-menu__separator")&&!U.nextElementSibling?window.siyuan.menus.menu.remove():U.remove()):(c.value=U.textContent,d(),window.siyuan.menus.menu.remove()),ee.preventDefault(),ee.stopPropagation()})}});b&&v.classList.add("b3-menu__item--current"),b=!1}}),b&&m.remove();const y=c.getBoundingClientRect();h.open({x:y.left,y:y.bottom})};d(),c.addEventListener("compositionend",f=>{d(f)}),c.addEventListener("input",f=>{d(f)}),c.addEventListener("blur",()=>{if(c.value){let f=window.siyuan.storage[p.LOCAL_MOVE_PATH].keys;f.splice(0,0,c.value),f=Array.from(new Set(f)),f.length>window.siyuan.config.search.limit&&f.splice(window.siyuan.config.search.limit,f.length-window.siyuan.config.search.limit),window.siyuan.storage[p.LOCAL_MOVE_PATH].keys=f}window.siyuan.storage[p.LOCAL_MOVE_PATH].k=c.value,Gt(p.LOCAL_MOVE_PATH,window.siyuan.storage[p.LOCAL_MOVE_PATH])});const g=28;c.addEventListener("keydown",f=>{if(f.isComposing)return;if(Qe("\u2325\u2193",f)){f.stopPropagation(),u();return}if(window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_MOVE_PATH_HISTORY)return;const h=o.classList.contains("fn__none")?l:o,m=h.querySelectorAll(".b3-list-item--focus");if(m.length===0)return;let b=m[0];if(f.key.startsWith("Arrow")&&m.forEach((y,_)=>{_!==0&&y.classList.remove("b3-list-item--focus")}),o.classList.contains("fn__none")){if(f.key==="ArrowRight"&&!b.querySelector(".b3-list-item__arrow--open")&&!b.querySelector(".b3-list-item__toggle").classList.contains("fn__hidden")||f.key==="ArrowLeft"&&b.querySelector(".b3-list-item__arrow--open")){ml(b,i),f.preventDefault();return}if(f.key==="ArrowLeft"){let y=b.parentElement.previousElementSibling;if(y){y.tagName!=="LI"&&(y=h.querySelector(".b3-list-item")),b.classList.remove("b3-list-item--focus"),y.classList.add("b3-list-item--focus");const _=y.getBoundingClientRect(),v=h.getBoundingClientRect();(_.top<v.top||_.bottom>v.bottom)&&y.scrollIntoView(_.top<v.top)}return f.preventDefault(),!0}if(f.key==="ArrowDown"||f.key==="ArrowRight"){let y=b;for(;y;)if(y.nextElementSibling)if(y.nextElementSibling.classList.contains("fn__none"))y=y.nextElementSibling;else{y.nextElementSibling.tagName==="UL"?y=y.nextElementSibling.firstElementChild:y=y.nextElementSibling;break}else{if(y.parentElement.id==="foldTree")break;y=y.parentElement}if(y.classList.contains("b3-list-item")){b.classList.remove("b3-list-item--focus"),y.classList.add("b3-list-item--focus");const _=y.getBoundingClientRect(),v=l.getBoundingClientRect();(_.top<v.top||_.bottom>v.bottom)&&y.scrollIntoView(_.top<v.top)}return f.preventDefault(),!0}if(f.key==="ArrowUp"){let y=b;for(;y;)if(y.previousElementSibling)if(y.previousElementSibling.classList.contains("fn__none"))y=y.previousElementSibling;else{if(y.previousElementSibling.tagName==="LI")y=y.previousElementSibling;else{const _=y.previousElementSibling.querySelectorAll(".b3-list-item");y=_[_.length-1]}break}else{if(y.parentElement.id==="foldTree")break;y=y.parentElement}if(y.classList.contains("b3-list-item")){b.classList.remove("b3-list-item--focus"),y.classList.add("b3-list-item--focus");const _=y.getBoundingClientRect(),v=l.getBoundingClientRect();(_.top<v.top||_.bottom>v.bottom)&&y.scrollIntoView(_.top<v.top)}f.preventDefault()}}else{if(f.key==="ArrowDown"){b.classList.remove("b3-list-item--focus"),b.nextElementSibling?b.nextElementSibling.classList.add("b3-list-item--focus"):h.children[0].classList.add("b3-list-item--focus"),b=h.querySelector(".b3-list-item--focus"),(h.scrollTop<b.offsetTop-h.clientHeight+g||h.scrollTop>b.offsetTop)&&(h.scrollTop=b.offsetTop-h.clientHeight+g),f.preventDefault();return}if(f.key==="ArrowUp"){if(b.classList.remove("b3-list-item--focus"),b.previousElementSibling)b.previousElementSibling.classList.add("b3-list-item--focus");else{const y=h.children.length;h.children[y-1].classList.add("b3-list-item--focus")}b=h.querySelector(".b3-list-item--focus"),(h.scrollTop<b.offsetTop-h.clientHeight+g||h.scrollTop>b.offsetTop-g*2)&&(h.scrollTop=b.offsetTop-g*2),f.preventDefault();return}}if(f.key==="Enter"){const y=h.querySelectorAll(".b3-list-item--focus");if(y.length===0)return;const _=[],v=[];y.forEach(U=>{_.push(U.getAttribute("data-path")),v.push(U.getAttribute("data-box"))}),t(_,v),r.destroy(),f.preventDefault()}}),r.element.addEventListener("click",f=>{let h=f.target;for(;h&&!h.isEqualNode(r.element);){if(h.classList.contains("b3-list-item__toggle")){ml(h.parentElement,i),f.preventDefault(),f.stopPropagation();break}else if(h.classList.contains("b3-form__icon-list")){u(),f.preventDefault(),f.stopPropagation();break}else if(h.classList.contains("b3-button--text")){const b=(o.classList.contains("fn__none")?l:o).querySelectorAll(".b3-list-item--focus");if(b.length===0)return;const y=[],_=[];b.forEach(v=>{y.push(v.getAttribute("data-path")),_.push(v.getAttribute("data-box"))}),t(y,_),r.destroy(),f.preventDefault(),f.stopPropagation();break}else if(h.classList.contains("b3-button--cancel")){r.destroy(),f.preventDefault(),f.stopPropagation();break}else if(h.classList.contains("b3-list-item")){const b=(o.classList.contains("fn__none")?l:o).querySelectorAll(".b3-list-item--focus");if(b.length===0)return;a===window.siyuan.languages.specifyPath&&je(f)?b.length===1&&b[0]===h||h.classList.toggle("b3-list-item--focus"):(b[0].classList.remove("b3-list-item--focus"),h.classList.add("b3-list-item--focus")),h.getAttribute("data-path")==="/"&&ml(h,i),f.preventDefault(),f.stopPropagation();break}h=h.parentElement}c.focus()})},ml=(t,e)=>{const n=t.querySelector(".b3-list-item__arrow");if(n.classList.contains("b3-list-item__arrow--open")){n.classList.remove("b3-list-item__arrow--open"),t.nextElementSibling&&t.nextElementSibling.tagName==="UL"&&t.nextElementSibling.classList.add("fn__none");return}if(t.nextElementSibling&&t.nextElementSibling.tagName==="UL"){n.classList.add("b3-list-item__arrow--open"),t.nextElementSibling.classList.remove("fn__none");return}const a=t.getAttribute("data-box");ae("/api/filetree/listDocsByPath",{notebook:a,path:t.getAttribute("data-path"),flashcard:e,app:p.SIYUAN_APPID},i=>{if(i.data.files.length===0){Q(window.siyuan.languages.emptyContent);return}let s="";if(i.data.files.forEach(o=>{let l="";e?l=`<span class="counter counter--right b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.flashcardNewCard}">${o.newFlashcardCount}</span>
<span class="counter counter--right b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.flashcardDueCard}">${o.dueFlashcardCount}</span>
<span class="counter counter--right b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.flashcardCard}">${o.flashcardCount}</span>`:o.count&&o.count>0&&(l=`<span class="popover__block counter b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.ref}">${o.count}</span>`),s+=`<li data-box="${a}" class="b3-list-item" data-path="${o.path}">
    <span style="padding-left: ${o.path.split("/").length*8}px" class="b3-list-item__toggle b3-list-item__toggle--hl${o.subFileCount===0?" fn__hidden":""}">
        <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>
    </span>
    ${Yt(o.icon||(o.subFileCount===0?window.siyuan.storage[p.LOCAL_IMAGES].file:window.siyuan.storage[p.LOCAL_IMAGES].folder),"b3-list-item__graphic",!0)}
    <span class="b3-list-item__text ariaLabel" data-position="parentE" aria-label="${ha(o.name,!0,!0)} <small class='ft__on-surface'>${o.hSize}</small>${o.bookmark?"<br>"+window.siyuan.languages.bookmark+" "+o.bookmark:""}${o.name1?"<br>"+window.siyuan.languages.name+" "+o.name1:""}${o.alias?"<br>"+window.siyuan.languages.alias+" "+o.alias:""}${o.memo?"<br>"+window.siyuan.languages.memo+" "+o.memo:""}${o.subFileCount!==0?window.siyuan.languages.includeSubFile.replace("x",o.subFileCount):""}<br>${window.siyuan.languages.modifiedAt} ${o.hMtime}<br>${window.siyuan.languages.createdAt} ${o.hCtime}">${ha(o.name,!0,!0)}</span>
    ${l}
</li>`}),s==="")return;n.classList.add("b3-list-item__arrow--open"),t.insertAdjacentHTML("afterend",`<ul class="file-tree__sliderDown">${s}</ul>`);const r=t.nextElementSibling;setTimeout(()=>{r.setAttribute("style",`height:${r.childElementCount*t.clientHeight}px;`),setTimeout(()=>{r.classList.remove("file-tree__sliderDown"),r.removeAttribute("style")},120)},2)})},Ds=t=>{let e="";return window.siyuan.notebooks.find(n=>{if(n.id===t)return e=n.name,!0}),e},Cs=t=>{let e="";return window.siyuan.notebooks.find(n=>{if(n.id===t)return e=n.icon,!0}),e},bl=(t,e)=>{window.siyuan.notebooks.find(n=>{if(n.id===t)return n.name=e,!0})},cf=()=>{let t=0;return window.siyuan.notebooks.forEach(e=>{e.closed||t++}),t},fr=(t,e=!1)=>{ae("/api/notebook/lsNotebooks",{flashcard:e},n=>{e||(window.siyuan.notebooks=n.data.notebooks),t&&t(n.data.notebooks)})},pr=(t,e=["edit","more"])=>{let n=!0;if(t){const a=t.getAttribute("data-readonly");if(typeof a=="string")n=a==="false";else return'<div class="protyle-icons"></div>'}return e.length===3?`<div class="protyle-icons">
    <span aria-label="${window.siyuan.languages.refresh}" class="b3-tooltips__nw b3-tooltips protyle-icon protyle-icon--first protyle-action__reload"><svg><use xlink:href="#iconRefresh"></use></svg></span>
    <span aria-label="${window.siyuan.languages.edit}" class="b3-tooltips__nw b3-tooltips protyle-icon protyle-action__edit${n?"":" fn__none"}"><svg><use xlink:href="#iconEdit"></use></svg></span>
    <span aria-label="${window.siyuan.languages.more}" class="b3-tooltips__nw b3-tooltips protyle-icon protyle-action__menu protyle-icon--last"><svg><use xlink:href="#iconMore"></use></svg></span>
</div>`:`<div class="protyle-icons">
    <span aria-label="${window.siyuan.languages.edit}" class="b3-tooltips__nw b3-tooltips protyle-icon protyle-icon--first protyle-action__edit${n?"":" fn__none"}"><svg><use xlink:href="#iconEdit"></use></svg></span>
    <span aria-label="${window.siyuan.languages.more}" class="b3-tooltips__nw b3-tooltips protyle-icon protyle-action__menu protyle-icon--last${n?"":" protyle-icon--first"}"><svg><use xlink:href="#iconMore"></use></svg></span>
</div>`},Kl=t=>{if(t.querySelector(".protyle-cursor"))return;const e=t.getAttribute("data-type");e==="NodeBlockQueryEmbed"?t.insertAdjacentHTML("afterbegin",`<div class="protyle-icons${ge(t)?" fn__none":""}">
    <span aria-label="${window.siyuan.languages.refresh}" class="b3-tooltips__nw b3-tooltips protyle-icon protyle-action__reload protyle-icon--first"><svg class="fn__rotate"><use xlink:href="#iconRefresh"></use></svg></span>
    <span aria-label="${window.siyuan.languages.update} SQL" class="b3-tooltips__nw b3-tooltips protyle-icon protyle-action__edit"><svg><use xlink:href="#iconEdit"></use></svg></span>
    <span aria-label="${window.siyuan.languages.more}" class="b3-tooltips__nw b3-tooltips protyle-icon protyle-action__menu protyle-icon--last"><svg><use xlink:href="#iconMore"></use></svg></span>
</div><div class="protyle-cursor">${p.ZWSP}</div>`):(e==="NodeMathBlock"||t.getAttribute("data-subtype")==="math")&&(t.firstElementChild.innerHTML=`<span></span><span class="protyle-cursor">${p.ZWSP}</span>`)},Ji=t=>(t.querySelectorAll("protyle-html").forEach(e=>{e.setAttribute("data-content",Lute.UnEscapeHTMLStr(e.getAttribute("data-content")))}),t),ch="%%params",my=t=>{let e={responsive:"resize"};const n=t.substring(0,t.indexOf(`
`));if(n.startsWith(ch))try{e=Y(n.substring(ch.length))}catch(a){console.error(`Failed to parse ABCJS params: ${a}`)}return e},hd=(t,e=p.PROTYLE_CDN)=>{let n=[];t.getAttribute("data-subtype")==="abc"?n=[t]:n=Array.from(t.querySelectorAll('[data-subtype="abc"]')),n.length!==0&&n.length>0&&va(`${e}/js/abcjs/abcjs-basic-min.js?v=6.5.0`,"protyleAbcjsScript").then(()=>{const a=N(t,"protyle-wysiwyg",!0);n.forEach(i=>{if(i.getAttribute("data-render")==="true")return;i.firstElementChild.classList.contains("protyle-icons")||i.insertAdjacentHTML("afterbegin",pr(a));const s=i.firstElementChild.nextElementSibling;s.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span><div contenteditable="false"></div>`;const r=Lute.UnEscapeHTMLStr(i.getAttribute("data-content"));window.ABCJS.renderAbc(s.lastElementChild,r,my(r)),i.setAttribute("data-render","true")})})};var by=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const df=(t,e=p.PROTYLE_CDN)=>{let n=[];t.getAttribute("data-subtype")==="echarts"?n=[t]:n=Array.from(t.querySelectorAll('[data-subtype="echarts"]')),n.length!==0&&n.length>0&&va(`${e}/js/echarts/echarts.min.js?v=5.3.2`,"protyleEchartsScript").then(()=>{va(`${e}/js/echarts/echarts-gl.min.js?v=2.0.9`,"protyleEchartsGLScript").then(()=>{const a=N(t,"protyle-wysiwyg",!0);let i;a&&a.clientWidth>0&&n[0].firstElementChild.clientWidth===0&&a.firstElementChild&&(i=a.firstElementChild.clientWidth),n.forEach(s=>by(void 0,null,function*(){var r,o,l;if(s.getAttribute("data-render")==="true")return;s.firstElementChild.classList.contains("protyle-icons")||s.insertAdjacentHTML("afterbegin",pr(a,["refresh","edit","more"]));const c=s.firstElementChild.nextElementSibling;if(!s.getAttribute("data-content")){c.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span>`;return}try{!c.lastElementChild||c.childElementCount===1?c.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span><div style="height:${s.style.height||"420px"}" contenteditable="false"></div>`:c.lastElementChild.classList.remove("ft__error");const d=window.echarts.getInstanceById((r=c.lastElementChild)==null?void 0:r.getAttribute("_echarts_instance_")),u=yield Y(Lute.UnEscapeHTMLStr(s.getAttribute("data-content")));d&&(((o=d.getOption().series[0])==null?void 0:o.type)!==((l=u.series[0])==null?void 0:l.type)&&d.clear(),d==null||d.resize()),window.echarts.init(c.lastElementChild,window.siyuan.config.appearance.mode===1?"dark":void 0,{width:i}).setOption(u)}catch(d){window.echarts.dispose(c.lastElementChild),c.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span><div class="ft__error" style="height:${s.style.height||"420px"}" contenteditable="false">echarts render error: <br>${d}</div>`}s.setAttribute("data-render","true")}))})})},uf=(t,e=p.PROTYLE_CDN)=>{let n=[];t.getAttribute("data-subtype")==="graphviz"?n=[t]:n=Array.from(t.querySelectorAll('[data-subtype="graphviz"]')),n.length!==0&&va(`${e}/js/graphviz/viz.js?v=3.11.0`,"protyleGraphVizScript").then(()=>{const a=N(t,"protyle-wysiwyg",!0);n.forEach(i=>{if(i.getAttribute("data-render")==="true")return;i.firstElementChild.classList.contains("protyle-icons")||i.insertAdjacentHTML("afterbegin",pr(a));const s=i.firstElementChild.nextElementSibling;if(!i.getAttribute("data-content")){s.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span>`;return}try{Viz.instance().then(r=>{const o=r.renderSVGElement(Lute.UnEscapeHTMLStr(i.getAttribute("data-content")));s.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span><div contenteditable="false">${o.outerHTML}</div>`}).catch(r=>{s.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span><div class="ft__error" contenteditable="false">graphviz render error: <br>${r}</div>`})}catch(r){console.error("Graphviz error",r)}i.setAttribute("data-render","true")})})},Xl=(t,e)=>{if(!document.getElementById(e)){const n=document.createElement("link");n.id=e,n.rel="stylesheet",n.type="text/css",n.href=t;const a=document.querySelector("#pluginsStyle");a?a.before(n):document.getElementsByTagName("head")[0].appendChild(n)}},Ei=(t,e=p.PROTYLE_CDN,n=!1)=>{let a=[];t.getAttribute("data-subtype")==="math"?a=[t]:a=Array.from(t.querySelectorAll('[data-subtype="math"]')),a.length!==0&&(Xl(`${e}/js/katex/katex.min.css?v=0.16.9`,"protyleKatexStyle"),va(`${e}/js/katex/katex.min.js?v=0.16.9`,"protyleKatexScript").then(()=>{va(`${e}/js/katex/mhchem.min.js?v=0.16.9`,"protyleKatexMhchemScript").then(()=>{a.forEach(i=>{var s,r;if(i.getAttribute("data-render")==="true")return;i.setAttribute("data-render","true");let o={};try{o=Y(window.siyuan.config.editor.katexMacros||"{}")}catch(c){console.warn("KaTex macros is not JSON",c)}const l=i.tagName==="DIV";try{const c=window.katex.renderToString(Lute.UnEscapeHTMLStr(i.getAttribute("data-content")),{displayMode:l,output:"html",macros:o,trust:!0,strict:u=>u==="unicodeTextInMathMode"?"ignore":"warn"}),d=oe(i);if(l){Kl(i),i.firstElementChild.firstElementChild.classList.remove("ft__error"),i.firstElementChild.firstElementChild.setAttribute("contenteditable","false"),i.firstElementChild.firstElementChild.innerHTML=c;const u=i.querySelectorAll(".base");u.length>0&&u[u.length-1].insertAdjacentHTML("afterend","<span class='fn__flex-1'></span>");const g=i.querySelector(".katex-html > .newline");g&&(g.parentElement.style.display="block")}else{i.classList.remove("ft__error"),i.innerHTML=c,d&&i.getBoundingClientRect().width>d.clientWidth?(i.style.maxWidth="100%",i.style.overflowX="auto",i.style.overflowY="hidden",i.style.display="inline-block"):(i.style.maxWidth="",i.style.overflowX="",i.style.overflowY="",i.style.display="");const u=_t(i);u?u&&u.nodeType!==3&&(((s=u.getAttribute("data-type"))==null?void 0:s.indexOf("inline-math"))>-1||u.classList.contains("img"))?i.after(document.createTextNode(p.ZWSP)):u&&!u.textContent.startsWith(`
`)&&u.textContent!==p.ZWSP&&i.insertAdjacentHTML("beforeend","&#xFEFF;"):i.parentElement.tagName!=="TH"&&i.parentElement.tagName!=="TD"?i.insertAdjacentText("afterend",`
`):i.insertAdjacentText("afterend",p.ZWSP),(r=i.previousSibling)!=null&&r.textContent.endsWith(`
`)?i.insertAdjacentText("beforebegin",p.ZWSP):!zt(i)&&["TH","TD"].includes(i.parentElement.tagName)&&i.insertAdjacentText("afterbegin",p.ZWSP)}n&&setTimeout(()=>{if(l){const u=i.querySelector(".katex-display");u.clientWidth<u.scrollWidth&&u.firstElementChild.setAttribute("style",`font-size:${u.clientWidth*100/u.scrollWidth}%`)}else d&&i.offsetWidth>d.clientWidth&&i.firstElementChild.setAttribute("style",`font-size:${d.clientWidth*100/i.offsetWidth}%`)})}catch(c){l?(Kl(i),i.firstElementChild.firstElementChild.setAttribute("contenteditable","false"),i.firstElementChild.firstElementChild.innerHTML=c.message,i.firstElementChild.firstElementChild.classList.add("ft__error")):(i.innerHTML=c.message,i.classList.add("ft__error"))}})})}))};var dh=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const gd=(t,e=p.PROTYLE_CDN)=>{let n=[];t.getAttribute("data-subtype")==="mermaid"?n=[t]:n=Array.from(t.querySelectorAll('[data-subtype="mermaid"]')),n.length!==0&&va(`${e}/js/mermaid/mermaid.min.js?v=11.12.0`,"protyleMermaidScript").then(()=>{va(`${e}/js/mermaid/mermaid-zenuml.min.js?v=0.2.2`,"protyleMermaidZenumlScript").then(()=>dh(void 0,null,function*(){yield window.mermaid.registerExternalDiagrams([window.zenuml]),window.mermaid.registerIconPacks([{name:"logos",loader:()=>fetch(`${e}/js/mermaid/icons.json?v=11.11.0`).then(i=>i.json())}]);const a={securityLevel:"loose",altFontFamily:"sans-serif",fontFamily:"sans-serif",startOnLoad:!1,flowchart:{htmlLabels:!0,useMaxWidth:!0},sequence:{useMaxWidth:!0,diagramMarginX:8,diagramMarginY:8,boxMargin:8,showSequenceNumbers:!0},gantt:{leftPadding:75,rightPadding:20}};if(window.siyuan.config.appearance.mode===1&&(a.theme="dark"),window.mermaid.initialize(a),n[0].firstElementChild.clientWidth===0){const i=new MutationObserver(()=>{ff(n),i.disconnect()}),s=ue(n[0],"fold","1");if(s)i.observe(s,{attributeFilter:["fold"]});else{const r=N(n[0],"card__block",!0);r&&i.observe(r,{attributeFilter:["class"]})}}else ff(n)}))})},ff=t=>{const e=N(t[0],"protyle-wysiwyg",!0);t.forEach(n=>dh(void 0,null,function*(){if(n.getAttribute("data-render")==="true")return;n.firstElementChild.classList.contains("protyle-icons")||n.insertAdjacentHTML("afterbegin",pr(e));const a=n.firstElementChild.nextElementSibling;if(!n.getAttribute("data-content")){a.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span>`;return}const i="mermaid"+Lute.NewNodeID();try{a.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span><div contenteditable="false"><span id="${i}"></span></div>`;const s=yield window.mermaid.render(i,Lute.UnEscapeHTMLStr(n.getAttribute("data-content")));a.lastElementChild.innerHTML=s.svg}catch(s){const r=document.querySelector("#"+i);a.lastElementChild.innerHTML=`${r.outerHTML}<div class="fn__hr"></div><div class="ft__error">${s.message.replace(/\n/,"<br>")}</div>`,r.parentElement.remove()}n.setAttribute("data-render","true")}))},pf=(t,e=p.PROTYLE_CDN)=>{let n=[];t.getAttribute("data-subtype")==="mindmap"?n=[t]:n=Array.from(t.querySelectorAll('[data-subtype="mindmap"]')),n.length!==0&&va(`${e}/js/echarts/echarts.min.js?v=0.0.0`,"protyleEchartsScript").then(()=>{const a=N(t,"protyle-wysiwyg",!0);let i;a&&a.clientWidth>0&&n[0].firstElementChild.clientWidth===0&&a.firstElementChild&&(i=a.firstElementChild.clientWidth),n.forEach(s=>{if(s.getAttribute("data-render")==="true")return;s.firstElementChild.classList.contains("protyle-icons")||s.insertAdjacentHTML("afterbegin",pr(a));const r=s.firstElementChild.nextElementSibling;if(!s.getAttribute("data-content")){r.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span>`;return}try{!r.lastElementChild||r.childElementCount===1?r.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span><div style="height:${s.style.height||"420px"}" contenteditable="false"></div>`:r.lastElementChild.classList.remove("ft__error"),window.echarts.init(r.lastElementChild,window.siyuan.config.appearance.mode===1?"dark":void 0,{width:i}).setOption({series:[{data:[JSON.parse(Lute.EChartsMindmapStr(Lute.UnEscapeHTMLStr(s.getAttribute("data-content"))))],initialTreeDepth:-1,itemStyle:{borderWidth:0,color:"#4285f4"},label:{backgroundColor:"#f6f8fa",borderColor:"#d1d5da",borderRadius:6,borderWidth:.5,color:"#586069",lineHeight:20,offset:[-5,0],padding:[0,5],position:"insideRight"},lineStyle:{color:"#d1d5da",width:1},roam:!0,symbol:(o,l)=>{var c;return(c=l==null?void 0:l.data)!=null&&c.children?"circle":"path://"},type:"tree"}],tooltip:{trigger:"item",triggerOn:"mousemove"},backgroundColor:"transparent"})}catch(o){window.echarts.dispose(r.lastElementChild),r.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span><div class="ft__error" style="height:${s.style.height||"420px"}" contenteditable="false">Mindmap render error: <br>${o}</div>`}s.setAttribute("data-render","true")})})},uh=(t,e=p.PROTYLE_CDN)=>{let n=[];t.getAttribute("data-subtype")==="flowchart"?n=[t]:n=Array.from(t.querySelectorAll('[data-subtype="flowchart"]')),n.length!==0&&va(`${e}/js/flowchart.js/flowchart.min.js?v=1.18.0`,"protyleFlowchartScript").then(()=>{if(n[0].firstElementChild.clientWidth===0){const a=new MutationObserver(()=>{hf(n),a.disconnect()}),i=ue(n[0],"fold","1");if(i)a.observe(i,{attributeFilter:["fold"]});else{const s=N(n[0],"card__block",!0);s&&a.observe(s,{attributeFilter:["class"]})}}else hf(n)})},hf=t=>{const e=N(t[0],"protyle-wysiwyg",!0);t.forEach(n=>{if(n.getAttribute("data-render")==="true")return;n.firstElementChild.classList.contains("protyle-icons")||n.insertAdjacentHTML("afterbegin",pr(e));const a=n.firstElementChild.nextElementSibling;if(!n.getAttribute("data-content")){a.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span>`;return}try{a.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span><div contenteditable="false"></div>`,flowchart.parse(Lute.UnEscapeHTMLStr(n.getAttribute("data-content"))).drawSVG(a.lastElementChild)}catch(i){a.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span><div class="ft__error" contenteditable="false">Flow Chart render error: <br>${i}</div>`}n.setAttribute("data-render","true")})},fh=(t,e=p.PROTYLE_CDN)=>{let n=[];t.getAttribute("data-subtype")==="plantuml"?n=[t]:n=Array.from(t.querySelectorAll('[data-subtype="plantuml"]')),n.length!==0&&va(`${e}/js/plantuml/plantuml-encoder.min.js?v=0.0.0`,"protylePlantumlScript").then(()=>{const a=N(t,"protyle-wysiwyg",!0);n.forEach(i=>{if(i.getAttribute("data-render")==="true")return;i.firstElementChild.classList.contains("protyle-icons")||i.insertAdjacentHTML("afterbegin",pr(a));const s=i.firstElementChild.nextElementSibling;if(!i.getAttribute("data-content")){s.innerHTML=`<span style="position: absolute;left:0;top:0;width: 1px;">${p.ZWSP}</span>`;return}try{const r=`${window.siyuan.config.editor.plantUMLServePath}${window.plantumlEncoder.encode(Lute.UnEscapeHTMLStr(i.getAttribute("data-content")))}`;s.innerHTML=`<object type="image/svg+xml" data="${r}"/>`,s.classList.remove("ft__error"),s.firstElementChild.addEventListener("error",()=>{s.innerHTML=`<img src=${r}">`})}catch(r){s.classList.add("ft__error"),s.innerHTML=`plantuml render error: <br>${r}`}i.setAttribute("data-render","true")})})},Zl=t=>{let e=[];t.getAttribute("data-type")==="NodeHTMLBlock"?e=[t]:e=Array.from(t.querySelectorAll('[data-type="NodeHTMLBlock"]')),e.length!==0&&e.length>0&&e.forEach(n=>{n.firstElementChild.firstElementChild.setAttribute("aria-label",window.siyuan.languages.edit),n.firstElementChild.lastElementChild.setAttribute("aria-label",window.siyuan.languages.more)})},yy=(t,e,n)=>{const a=document.createElement("div");a.innerHTML=t;let i=!1;if((a.childElementCount===1&&a.lastElementChild.style.fontFamily.indexOf("monospace")>-1||a.childElementCount===1&&a.querySelectorAll("pre").length===1||t.indexOf(`
<p class="p1">`)===0||a.childElementCount===1&&a.firstElementChild.tagName==="TABLE"&&a.querySelector(".line-number")&&a.querySelector(".line-content"))&&(i=!0),i){let s=e||t;return/\n/.test(s)?n.lute.Md2BlockDOM(s):(s=s.replace("<","&lt;").replace(">","&gt;"),"`"+s+"`")}return!1},zn=t=>{const e=t.getAttribute("data-subtype");if(!p.SIYUAN_RENDER_CODE_LANGUAGES.includes(e)||t.getAttribute("data-type")!=="NodeHTMLBlock"){hd(t),Zl(t),fh(t),gd(t),uh(t),df(t),pf(t),uf(t),Ei(t);return}e==="abc"?hd(t):e==="plantuml"?fh(t):e==="mermaid"?gd(t):e==="flowchart"?uh(t):e==="echarts"?df(t):e==="mindmap"?pf(t):e==="graphviz"?uf(t):e==="math"?Ei(t):t.getAttribute("data-type")==="NodeHTMLBlock"&&Zl(t)},qi=(t,e)=>{let n="";return t.forEach(a=>{typeof a=="string"?n+=`<option value="${a}" ${e===a?"selected":""}>${a}</option>`:n+=`<option value="${a.name}" ${e===a.name?"selected":""}>${a.label}</option>`}),n},_y=(t,e)=>{let n="";return t.forEach(a=>{n+=`<option value="${a.name}" ${e===a.name?"selected":""}>${a.label} (${a.name})</option>`}),n},Sn=(t,e,n,a,i=!1)=>{if(!e&&!t){n();return}const s=new fe({title:t,content:`<div class="b3-dialog__content">
    <div class="ft__breakword">${e}</div>
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel" id="cancelDialogConfirmBtn">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button ${i?"b3-button--remove":"b3-button--text"}" id="confirmDialogConfirmBtn">${window.siyuan.languages[i?"delete":"confirm"]}</button>
</div>`,width:x()?"92vw":"520px"});s.element.addEventListener("click",r=>{let o=r.target;const l=typeof r.detail=="string";for(;o&&o!==s.element||l;){if(o.id==="cancelDialogConfirmBtn"||l&&r.detail==="Escape"){a&&a(s),s.destroy();break}else if(o.id==="confirmDialogConfirmBtn"||l&&r.detail==="Enter"){n&&n(s),s.destroy();break}o=o.parentElement}}),s.element.setAttribute("data-key",p.DIALOG_CONFIRM)},md=()=>{ae("/api/snippet/getSnippet",{type:"all",enabled:2},t=>{t.data.snippets.forEach(e=>{const n=`snippet${e.type==="css"?"CSS":"JS"}${e.id}`;let a=document.getElementById(n);if(!window.siyuan.config.snippet.enabledCSS&&e.type==="css"||!window.siyuan.config.snippet.enabledJS&&e.type==="js"){a&&a.remove();return}if(!e.enabled){a&&a.remove();return}if(a){if(a.innerHTML===e.content)return;a.remove()}e.type==="css"?document.head.insertAdjacentHTML("beforeend",`<style id="${n}">${e.content}</style>`):e.type==="js"&&(a=document.createElement("script"),a.type="text/javascript",a.text=e.content,a.id=n,document.head.appendChild(a))})})},Fo=()=>{ae("/api/snippet/getSnippet",{type:"all",enabled:2},t=>{let e="",n="";t.data.snippets.forEach(s=>{s.type==="css"?e+=Jl(s):n+=Jl(s)});const a=new fe({width:"70vw",height:"80vh",content:`<div class="layout-tab-bar fn__flex fn__flex-shrink" style="border-radius: var(--b3-border-radius-b) var(--b3-border-radius-b) 0 0">
    <div data-type="css" class="item item--full item--focus"><span class="fn__flex-1"></span><span class="item__text">CSS</span><span class="fn__flex-1"></span></div>
    <div data-type="js" class="item item--full"><span class="fn__flex-1"></span><span class="item__text">JS</span><span class="fn__flex-1"></span></div>
</div>
<div class="fn__flex-1" style="overflow:auto;padding: 16px 24px">
    <div>
        <div class="fn__flex">
            <div class="b3-form__icon fn__flex-1">
                <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>
                <input data-type="css" data-action="search" type="text" placeholder="${window.siyuan.languages.search}" class="b3-text-field b3-form__icon-input fn__block">
            </div>
            <div class="fn__space"></div>
            <span aria-label="${window.siyuan.languages.addAttr} CSS" id="addCodeSnippetCSS" class="b3-tooltips b3-tooltips__sw block__icon block__icon--show">
                <svg><use xlink:href="#iconAdd"></use></svg>
            </span>
            <div class="fn__space"></div>
            <input data-action="toggleCSS" class="b3-switch fn__flex-center" type="checkbox"${window.siyuan.config.snippet.enabledCSS?" checked":""}>
        </div>
        ${e}
    </div>
    <div class="fn__none">
        <div class="fn__flex">
             <div class="b3-form__icon fn__flex-1">
                <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>
                <input data-type="js" data-action="search" type="text" placeholder="${window.siyuan.languages.search}" class="b3-text-field b3-form__icon-input fn__block">
            </div>
            <div class="fn__space"></div>
            <span aria-label="${window.siyuan.languages.addAttr} JS" id="addCodeSnippetJS" class="b3-tooltips b3-tooltips__sw block__icon block__icon--show">
                <svg><use xlink:href="#iconAdd"></use></svg>
            </span>
            <div class="fn__space"></div>
            <input data-action="toggleJS" class="b3-switch fn__flex-center" type="checkbox"${window.siyuan.config.snippet.enabledJS?" checked":""}>
        </div>
        ${n}
    </div>
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,destroyCallback:s=>{(s==null?void 0:s.cancel)!=="true"&&Ls(a,t.data.snippets,i,!0)}});t.data.snippets.forEach(s=>{const r=a.element.querySelector(`[data-id="${s.id}"] input`);r.value=s.name;const o=a.element.querySelector(`[data-id="${s.id}"] textarea`);o.textContent=s.content});const i=[];a.element.setAttribute("data-key",p.DIALOG_SNIPPETS),a.element.addEventListener("click",s=>{let r=s.target;for(;r&&r!==a.element;){if(r.id==="addCodeSnippetCSS"||r.id==="addCodeSnippetJS"){r.parentElement.insertAdjacentHTML("afterend",Jl({type:r.id==="addCodeSnippetCSS"?"css":"js",name:"",content:"",enabled:!0,disabledInPublish:!1})),s.stopPropagation(),s.preventDefault();break}else if(r.classList.contains("b3-button--cancel")){a.destroy({cancel:"true"}),s.stopPropagation(),s.preventDefault();break}else if(r.classList.contains("b3-button--text")){Ls(a,t.data.snippets,i),s.stopPropagation(),s.preventDefault();break}else if(r.classList.contains("item")){r.getAttribute("data-type")==="css"?(r.classList.add("item--focus"),r.nextElementSibling.classList.remove("item--focus"),r.parentElement.nextElementSibling.firstElementChild.classList.remove("fn__none"),r.parentElement.nextElementSibling.lastElementChild.classList.add("fn__none")):(r.classList.add("item--focus"),r.previousElementSibling.classList.remove("item--focus"),r.parentElement.nextElementSibling.firstElementChild.classList.add("fn__none"),r.parentElement.nextElementSibling.lastElementChild.classList.remove("fn__none")),s.stopPropagation(),s.preventDefault();break}else if(r.dataset.action==="remove"){const o=r.parentElement.parentElement;i.push("#snippet"+(o.getAttribute("data-type")==="css"?"CSS":"JS")+o.getAttribute("data-id")),o.remove(),s.stopPropagation(),s.preventDefault();break}r=r.parentElement}}),a.element.querySelectorAll('[data-action="search"]').forEach(s=>{s.addEventListener("input",r=>{r.isComposing||ph(a,s)}),s.addEventListener("compositionend",()=>{ph(a,s)})})})},ph=(t,e)=>{t.element.querySelectorAll(`.fn__flex-1 > div > [data-type="${e.dataset.type}"]`).forEach(n=>{const a=n.querySelector("input").value.toLowerCase(),i=n.querySelector("textarea").value.toLowerCase(),s=e.value.toLowerCase();!s||a&&(s.includes(a)||a.includes(s))||i&&(i.includes(s)||s.includes(i))?n.classList.remove("fn__none"):n.classList.add("fn__none")})},Jl=t=>`<div data-id="${t.id||""}" data-type="${t.type}">
    <div class="fn__hr--b"></div>
    <div class="fn__flex">
        <input type="text" class="fn__size200 b3-text-field" placeholder="${window.siyuan.languages.title}">
        <div class="fn__space"></div>
        <label class="fn__flex${window.siyuan.config.publish.enable?"":" fn__none"}">
            <input data-type="disabledInPublish" type="checkbox" class="b3-switch fn__flex-center" ${t.disabledInPublish?"":" checked"}>
            <div class="fn__space"></div>
            <span class="fn__flex-center">${window.siyuan.languages.publishService}</span>
        </label>
        <div class="fn__flex-1"></div>
        <div class="fn__space"></div>
        <span aria-label="${window.siyuan.languages.remove}" data-action="remove" class="b3-tooltips b3-tooltips__sw block__icon block__icon--show">
            <svg><use xlink:href="#iconTrashcan"></use></svg>
        </span>
        <div class="fn__space"></div>
        <input data-type="snippet" class="b3-switch fn__flex-center" type="checkbox"${t.enabled?" checked":""}>
    </div>
    <div class="fn__hr"></div>
    <textarea class="fn__block b3-text-field" placeholder="${window.siyuan.languages.codeSnippet}" style="resize: vertical;font-family:var(--b3-font-family-code)" spellcheck="false"></textarea>
    <div class="fn__hr--b"></div>
</div>`,bd=(t,e,n)=>{ae("/api/snippet/setSnippet",{snippets:e},()=>{n.forEach(a=>{const i=document.querySelector(a);i&&i.remove()}),window.siyuan.config.snippet.enabledCSS=t.element.querySelector('.b3-switch[data-action="toggleCSS"]').checked,window.siyuan.config.snippet.enabledJS=t.element.querySelector('.b3-switch[data-action="toggleJS"]').checked,ae("/api/setting/setSnippet",window.siyuan.config.snippet,()=>{Yg()}),md(),t.destroy({cancel:"true"})})},Ls=(t,e,n,a=!1)=>{const i=[];t.element.querySelectorAll("[data-id]").forEach(s=>{i.push({disabledInPublish:!s.querySelector('.b3-switch[data-type="disabledInPublish"]').checked,id:s.getAttribute("data-id"),name:s.querySelector("input").value,type:s.getAttribute("data-type"),content:s.querySelector("textarea").value,enabled:s.querySelector('.b3-switch[data-type="snippet"]').checked})}),G(e,i)&&window.siyuan.config.snippet.enabledCSS===t.element.querySelector('.b3-switch[data-action="toggleCSS"]').checked&&window.siyuan.config.snippet.enabledJS===t.element.querySelector('.b3-switch[data-action="toggleJS"]').checked?t.destroy({cancel:"true"}):a?Sn(window.siyuan.languages.save,window.siyuan.languages.snippetsTip,()=>{bd(t,i,n)}):bd(t,i,n)},Qi=(t,e)=>{let n="";switch(t){case"NodeDocument":n="iconFile";break;case"NodeThematicBreak":n="iconLine";break;case"NodeParagraph":n="iconParagraph";break;case"NodeHeading":e?n="icon"+e.toUpperCase():n="iconHeadings";break;case"NodeBlockquote":n="iconQuote";break;case"NodeList":e==="t"?n="iconCheck":e==="o"?n="iconOrderedList":n="iconList";break;case"NodeListItem":n="iconListItem";break;case"NodeCodeBlock":case"NodeYamlFrontMatter":n="iconCode";break;case"NodeTable":n="iconTable";break;case"NodeBlockQueryEmbed":n="iconSQL";break;case"NodeSuperBlock":n="iconSuper";break;case"NodeMathBlock":n="iconMath";break;case"NodeHTMLBlock":n="iconHTML5";break;case"NodeWidget":n="iconBoth";break;case"NodeIFrame":n="iconLanguage";break;case"NodeVideo":n="iconVideo";break;case"NodeAudio":n="iconRecord";break;case"NodeAttributeView":n="iconDatabase";break}return n};class Po{constructor(e){this.click=e.click,this.ctrlClick=e.ctrlClick,this.altClick=e.altClick,this.shiftClick=e.shiftClick,this.rightClick=e.rightClick,this.toggleClick=e.toggleClick,this.element=e.element,this.blockExtHTML=e.blockExtHTML,this.topExtHTML=e.topExtHTML,this.updateData(e.data),this.bindEvent()}updateData(e){this.data=e,!this.data||this.data.length===0?this.element.innerHTML=`<ul class="b3-list b3-list--background"><li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li></ul>`:(this.element.innerHTML=this.genHTML(this.data),Ei(this.element))}genHTML(e){let n=`<ul${e[0].depth===0?" class='b3-list b3-list--background'":""}>`;return e.forEach(a=>{let i="",s='<svg class="b3-list-item__graphic"><use xlink:href="#iconFolder"></use></svg>';a.type==="bookmark"?s='<svg class="b3-list-item__graphic"><use xlink:href="#iconBookmark"></use></svg>':a.type==="tag"?s='<svg class="b3-list-item__graphic"><use xlink:href="#iconTags"></use></svg>':a.type==="backlink"?(i=` aria-label="${Ot(a.hPath)}"`,s=`<svg class="b3-list-item__graphic popover__block" data-id="${a.id}"><use xlink:href="#${Qi(a.nodeType,a.subType)}"></use></svg>`):a.type==="outline"&&(i=` aria-label="${Ot(Lute.BlockDOM2Content(a.name))}"`,s=`<svg class="b3-list-item__graphic popover__block" data-id="${a.id}" style="height: 22px;width: 10px;"><use xlink:href="#${Qi(a.nodeType,a.subType)}"></use></svg>`);let r="";a.count&&(r=`<span class="counter">${a.count}</span>`);const o=a.children&&a.children.length>0||a.blocks&&a.blocks.length>0;let l="";x()?a.depth>0&&(l=`padding-left: ${(a.depth-1)*20+24}px`):l=`padding-left: ${a.depth*18||4}px;margin-right: 2px`;const c=o||a.type==="backlink"&&!x();n+=`<li class="b3-list-item${x()?"":" b3-list-item--hide-action"}" 
${a.id?'data-node-id="'+a.id+'"':""} 
${a.box?'data-notebook-id="'+a.box+'"':""} 
style="--file-toggle-width:${a.depth===0?22:(a.depth+1)*18}px" 
data-treetype="${a.type}" 
data-type="${a.nodeType}" 
data-subtype="${a.subType}" 
${a.label?"data-label='"+a.label+"'":""}>
    <span style="${l}" class="b3-list-item__toggle${c?" b3-list-item__toggle--hl":""}${c?"":" fn__hidden"}">
        <svg data-id="${a.id||encodeURIComponent(a.name+a.depth)}" class="b3-list-item__arrow${(a.type==="outline"?!a.folded:o)?" b3-list-item__arrow--open":""}"><use xlink:href="#iconRight"></use></svg>
    </span>
    ${s}
    <span class="b3-list-item__text ariaLabel" data-position="parentE"${i}>${a.name}</span>
    ${this.topExtHTML||""}
    ${r}
</li>`,a.children&&a.children.length>0&&(n+=this.genHTML(a.children)+"</ul>"),a.blocks&&a.blocks.length>0&&(n+=this.genBlockHTML(a.blocks,a.type==="outline"?!a.folded:!0,a.type)+"</ul>")}),n}genBlockHTML(e,n=!1,a){let i=`<ul class="${n?"":"fn__none"}">`;return e.forEach(s=>{let r="";s.count&&(r=`<span class="counter">${s.count}</span>`);let o;a==="outline"?o=`<svg data-showref="true" class="b3-list-item__graphic popover__block" data-id="${s.id}" style="height: 22px;width: 10px;"><use xlink:href="#${Qi(s.type,s.subType)}"></use></svg>`:s.type==="NodeDocument"?o=`<span data-showref="true" class="b3-list-item__graphic popover__block" data-id="${s.id}">${Yt(s.ial.icon||window.siyuan.storage[p.LOCAL_IMAGES].file)}</span>`:o=`<svg data-showref="true" class="b3-list-item__graphic popover__block" data-id="${s.id}"><use xlink:href="#${Qi(s.type,s.subType)}"></use></svg>`;let l="";x()?s.depth>0&&(l=`padding-left: ${(s.depth-1)*20+24}px`):l=`padding-left: ${s.depth*18||4}px;margin-right: 2px`,i+=`<li class="b3-list-item${x()?"":" b3-list-item--hide-action"}"  
style="--file-toggle-width:${s.depth===0?22:(s.depth+1)*18}px" 
data-node-id="${s.id}" 
data-ref-text="${encodeURIComponent(s.refText)}" 
data-def-id="${s.defID}" 
data-type="${s.type}" 
data-subtype="${s.subType}" 
data-treetype="${a}" 
data-def-path="${s.defPath}">
    <span style="${l}" class="b3-list-item__toggle${s.children?" b3-list-item__toggle--hl":""}${s.children?"":" fn__hidden"}">
        <svg data-id="${s.id}" class="b3-list-item__arrow${(a==="outline"?!s.folded:n)?" b3-list-item__arrow--open":""}"><use xlink:href="#iconRight"></use></svg>
    </span>
    ${o}
    <span class="b3-list-item__text ariaLabel" data-position="parentE" ${a==="outline"?' aria-label="'+Ot(Lute.BlockDOM2Content(s.content))+'"':""}>${s.content}</span>
    ${r}
    ${this.blockExtHTML||""}
</li>`,s.children&&s.children.length>0&&(i+=this.genBlockHTML(s.children,a==="outline"?!s.folded:!1,a)+"</ul>")}),i}toggleBlocks(e){if(this.toggleClick){this.toggleClick(e);return}if(!e.nextElementSibling)return;const n=e.firstElementChild.firstElementChild;n.classList.contains("b3-list-item__arrow--open")?(n.classList.remove("b3-list-item__arrow--open"),e.nextElementSibling.classList.add("fn__none"),e.nextElementSibling.nextElementSibling&&e.nextElementSibling.nextElementSibling.tagName==="UL"&&e.nextElementSibling.nextElementSibling.classList.add("fn__none")):(n.classList.add("b3-list-item__arrow--open"),e.nextElementSibling.classList.remove("fn__none"),e.nextElementSibling.nextElementSibling&&e.nextElementSibling.nextElementSibling.tagName==="UL"&&e.nextElementSibling.nextElementSibling.classList.remove("fn__none"))}setCurrent(e){e.classList.contains("b3-list--empty")||(this.element.querySelectorAll("li").forEach(n=>{n.classList.remove("b3-list-item--focus")}),e.classList.add("b3-list-item--focus"))}bindEvent(){this.element.addEventListener("contextmenu",e=>{let n=e.target;for(;n&&!n.isEqualNode(this.element);){if(n.tagName==="LI"&&this.rightClick){this.rightClick(n,e),e.preventDefault(),e.stopPropagation();break}n=n.parentElement}}),this.element.addEventListener("click",e=>{let n=e.target;for(;n&&!n.isEqualNode(this.element);){if(n.classList.contains("b3-list-item__toggle")&&!n.classList.contains("fn__hidden")&&!window.siyuan.ctrlIsPressed&&!window.siyuan.altIsPressed){this.toggleBlocks(n.parentElement),this.setCurrent(n.parentElement),e.preventDefault();break}if(n.classList.contains("b3-list-item__action")&&this.click){const a=A(n,"LI");a&&this.click(a,e),e.preventDefault(),e.stopPropagation();break}else if(n.tagName==="LI"){this.setCurrent(n),n.getAttribute("data-node-id")||n.getAttribute("data-treetype")==="tag"?(this.ctrlClick&&window.siyuan.ctrlIsPressed?this.ctrlClick(n,e):this.altClick&&window.siyuan.altIsPressed?this.altClick(n,e):this.shiftClick&&window.siyuan.shiftIsPressed?this.shiftClick(n):this.click&&this.click(n,e),e.stopPropagation()):this.toggleBlocks(n),e.preventDefault();break}n=n.parentElement}}),this.element.addEventListener("dragstart",e=>{const n=A(e.target,"LI");n&&(e.dataTransfer.setData("text/html",n.outerHTML),n.style.opacity="0.38",window.siyuan.dragElement=n)}),this.element.addEventListener("dragend",e=>{const n=A(e.target,"LI");n&&(n.style.opacity="1"),window.siyuan.dragElement=void 0})}expandAll(){this.element.querySelectorAll("ul").forEach(e=>{e.classList.contains("b3-list")||e.classList.remove("fn__none")}),this.element.querySelectorAll(".b3-list-item__arrow").forEach(e=>{e.classList.add("b3-list-item__arrow--open")})}collapseAll(){this.element.querySelectorAll("ul").forEach(e=>{e.classList.contains("b3-list")||e.classList.add("fn__none")}),this.element.querySelectorAll(".b3-list-item__arrow").forEach(e=>{e.classList.remove("b3-list-item__arrow--open")})}getExpandIds(){const e=[];return this.element.querySelectorAll(".b3-list-item__arrow--open").forEach(n=>{e.push(n.getAttribute("data-id"))}),e}setExpandIds(e){!e||e.length===0||this.element.querySelectorAll(".b3-list-item__arrow").forEach(n=>{e.includes(n.getAttribute("data-id"))?(n.classList.add("b3-list-item__arrow--open"),n.parentElement.parentElement.nextElementSibling&&n.parentElement.parentElement.nextElementSibling.classList.remove("fn__none")):(n.classList.remove("b3-list-item__arrow--open"),n.parentElement.parentElement.nextElementSibling&&n.parentElement.parentElement.nextElementSibling.tagName==="UL"&&n.parentElement.parentElement.nextElementSibling.classList.add("fn__none"))})}}class wy{constructor(){this.wheelEvent="onwheel"in document.createElement("div")?"wheel":"mousewheel",this.element=document.getElementById("commonMenu"),this.element.querySelector(".b3-menu__title .b3-menu__label").innerHTML=window.siyuan.languages.back,this.element.addEventListener(x()?"click":"mouseover",e=>{const n=e.target;if(x()&&(N(n,"b3-menu__title")||typeof e.detail=="string"&&e.detail==="back")){const r=this.element.querySelectorAll(".b3-menu__item--show");r.length>0?r[r.length-1].classList.remove("b3-menu__item--show"):(this.element.style.transform="",setTimeout(()=>{this.remove()},p.TIMEOUT_DBLCLICK));return}const a=N(n,"b3-menu__item");if(!a||a.classList.contains("b3-menu__item--readonly"))return;const i=a.querySelector(".b3-menu__submenu");this.element.querySelectorAll(".b3-menu__item--show").forEach(s=>{!s.contains(a)&&s!==a&&!a.contains(s)&&s.classList.remove("b3-menu__item--show")}),this.element.querySelectorAll(".b3-menu__item--current").forEach(s=>{s.classList.remove("b3-menu__item--current")}),a.classList.add("b3-menu__item--current"),i&&(a.classList.add("b3-menu__item--show"),this.element.classList.contains("b3-menu--fullscreen")||this.showSubMenu(i))})}showSubMenu(e){const n=e.parentElement.getBoundingClientRect();e.style.top=n.top-8+"px",e.style.left=n.right+8+"px",e.style.bottom="auto";const a=e.getBoundingClientRect();a.right>window.innerWidth&&(n.left-8>a.width?e.style.left=n.left-8-a.width+"px":e.style.left=window.innerWidth-a.width+"px"),a.bottom>window.innerHeight&&(e.style.top="auto",e.style.bottom="8px")}preventDefault(e){!N(e.target,"b3-menu")&&!N(e.target,"keyboard__bar")&&e.preventDefault()}addItem(e){const n=new xe(e);if(n)return this.append(n.element,e.index),n.element}removeScrollEvent(){window.removeEventListener(x()?"touchmove":this.wheelEvent,this.preventDefault,!1)}remove(e=!1){var n;if(e){const a=window.siyuan.menus.menu.element.querySelectorAll(".b3-menu__item--show");if(a.length>0){const i=a[a.length-1];i.classList.remove("b3-menu__item--show"),i.classList.add("b3-menu__item--current"),(n=i.querySelector(".b3-menu__item--current"))==null||n.classList.remove("b3-menu__item--current");return}}window.siyuan.menus.menu.removeCB&&(window.siyuan.menus.menu.removeCB(),window.siyuan.menus.menu.removeCB=void 0),this.removeScrollEvent(),this.element.firstElementChild.classList.add("fn__none"),this.element.lastElementChild.innerHTML="",this.element.lastElementChild.removeAttribute("style"),this.element.classList.add("fn__none"),this.element.classList.remove("b3-menu--list","b3-menu--fullscreen"),this.element.removeAttribute("style"),this.element.removeAttribute("data-name"),this.element.removeAttribute("data-from"),this.data=void 0}append(e,n){if(e){if(typeof n=="number"){const a=this.element.querySelectorAll(".b3-menu__items > .b3-menu__separator")[n];if(a){a.before(e);return}}this.element.lastElementChild.append(e)}}popup(e){this.element.lastElementChild.innerHTML!==""&&(window.addEventListener(x()?"touchmove":this.wheelEvent,this.preventDefault,{passive:!1}),this.element.style.zIndex=(++window.siyuan.zIndex).toString(),this.element.classList.remove("fn__none"),gn(this.element,e.x-(e.isLeft?this.element.clientWidth:0),e.y,e.h,e.w))}fullscreen(e="all"){this.element.lastElementChild.innerHTML!==""&&(this.element.classList.add("b3-menu--fullscreen"),this.element.style.zIndex=(++window.siyuan.zIndex).toString(),this.element.firstElementChild.classList.remove("fn__none"),this.element.classList.remove("fn__none"),window.addEventListener("touchmove",this.preventDefault,{passive:!1}),setTimeout(()=>{e==="bottom"?(this.element.style.transform="translateY(-50vh)",this.element.style.height="50vh"):this.element.style.transform="translateY(-100%)"}),this.element.lastElementChild.scrollTop=0)}}class xe{constructor(e){if(!e.ignore){if(e.type==="empty"){this.element=document.createElement("div"),this.element.innerHTML=e.label,e.bind&&e.bind(this.element);return}if(this.element=document.createElement("button"),e.disabled&&this.element.setAttribute("disabled","disabled"),e.id&&this.element.setAttribute("data-id",e.id),e.type==="separator"){this.element.classList.add("b3-menu__separator");return}if(this.element.classList.add("b3-menu__item"),e.current&&this.element.classList.add("b3-menu__item--selected"),e.click&&this.element.addEventListener("click",n=>{if(this.element.getAttribute("disabled"))return;let a=e.click(this.element,n);a instanceof Promise&&(a=!1),n.preventDefault(),n.stopImmediatePropagation(),n.stopPropagation(),this.element.parentElement&&!a&&window.siyuan.menus.menu.remove()}),e.type==="readonly"&&this.element.classList.add("b3-menu__item--readonly"),(e.icon==="iconTrashcan"||e.warning)&&this.element.classList.add("b3-menu__item--warning"),e.element)this.element.append(e.element);else{let n=`<span class="b3-menu__label">${e.label||"&nbsp;"}</span>`;typeof e.iconHTML=="string"?n=e.iconHTML+n:n=`<svg class="b3-menu__icon ${e.iconClass||""}" style="${e.icon==="iconClose"?"height:10px;":""}"><use xlink:href="#${e.icon||""}"></use></svg>${n}`,e.accelerator&&(n+=`<span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt(e.accelerator)}</span>`),e.action&&(n+=`<svg class="b3-menu__action${e.action==="iconCloseRound"?" b3-menu__action--close":""}"><use xlink:href="#${e.action}"></use></svg>`),e.checked&&(n+='<svg class="b3-menu__checked"><use xlink:href="#iconSelect"></use></svg></span>'),this.element.innerHTML=n}if(e.bind&&(this.element.classList.add("b3-menu__item--custom"),e.bind(this.element)),e.submenu){const n=document.createElement("div");n.classList.add("b3-menu__submenu"),n.innerHTML='<div class="b3-menu__items"></div>',e.submenu.forEach(a=>{var i;n.firstElementChild.append(((i=new xe(a))==null?void 0:i.element)||"")}),this.element.insertAdjacentHTML("beforeend",'<svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>'),this.element.append(n)}}}}const oo=(t,e)=>{let n=t;for(;n&&(n.classList.contains("b3-menu__separator")||n.classList.contains("b3-menu__item--readonly")||n.getBoundingClientRect().height===0)&&!n.querySelector(".b3-text-field");)e?n=n.nextElementSibling:n=n.previousElementSibling;return n},hv=t=>{if(window.siyuan.menus.menu.element.classList.contains("fn__none")||t.altKey||t.shiftKey||t.ctrlKey||t.metaKey)return!1;const e=t.target;if(window.siyuan.menus.menu.element.contains(e)&&["INPUT","TEXTAREA"].includes(e.tagName))return!1;const n=p.KEYCODELIST[t.keyCode];if(n==="\u2193"||n==="\u2191"){const a=window.siyuan.menus.menu.element.querySelector(".b3-menu__item--current");let i;if(a?(a.classList.remove("b3-menu__item--current","b3-menu__item--show"),n==="\u2191"?(i=oo(a.previousElementSibling,!1),i||(i=oo(a.parentElement.lastElementChild,!1))):(i=oo(a.nextElementSibling,!0),i||(i=oo(a.parentElement.firstElementChild,!0)))):n==="\u2191"?i=oo(window.siyuan.menus.menu.element.lastElementChild.lastElementChild,!1):i=oo(window.siyuan.menus.menu.element.lastElementChild.firstElementChild,!0),i){i.classList.contains("b3-menu__item")&&i.classList.add("b3-menu__item--current");const s=i.querySelector(":scope > .b3-text-field");s&&s.focus(),i.classList.remove("b3-menu__item--show");const r=i.parentElement.getBoundingClientRect(),o=i.getBoundingClientRect();(r.top>o.top||r.bottom<o.bottom)&&i.scrollIntoView(r.top>o.top)}return!0}else if(n==="\u2192"){const a=window.siyuan.menus.menu.element.querySelector(".b3-menu__item--current");if(!a)return!0;const i=a.querySelector(".b3-menu__submenu");if(!i)return!0;a.classList.remove("b3-menu__item--current"),a.classList.add("b3-menu__item--show");const s=oo(i.firstElementChild.firstElementChild,!0);return s&&s.classList.add("b3-menu__item--current"),window.siyuan.menus.menu.showSubMenu(i),!0}else if(n==="\u2190"){const a=window.siyuan.menus.menu.element.querySelector(".b3-menu__submenu .b3-menu__item--current");if(!a)return!0;const i=N(a,"b3-menu__item--show");return i&&(i.classList.remove("b3-menu__item--show"),i.classList.add("b3-menu__item--current"),a.classList.remove("b3-menu__item--current")),!0}else if(n==="\u21A9"){const a=window.siyuan.menus.menu.element.querySelector(".b3-menu__item--current");if(a){const i=a.querySelector(".b3-menu__submenu");if(i){a.classList.remove("b3-menu__item--current"),a.classList.add("b3-menu__item--show");const o=oo(i.firstElementChild.firstElementChild,!0);return o&&o.classList.add("b3-menu__item--current"),window.siyuan.menus.menu.showSubMenu(i),!0}const s=a.querySelector(".b3-text-field"),r=a.querySelector(".b3-switch");if(s)return s.focus(),!0;r?r.click():a.dispatchEvent(new CustomEvent(Ne())),window.siyuan.menus.menu.element.contains(a)&&window.siyuan.menus.menu.remove()}else return!1;return!0}};class hh{constructor(){this.menus=[]}addSeparator(e,n){typeof e=="number"?this.menus.splice(e,0,{type:"separator",id:n}):this.menus.push({type:"separator",id:n})}addItem(e){typeof e.index=="number"?this.menus.splice(e.index,0,e):this.menus.push(e)}}const No=(t,e)=>t&&(!t.classList.contains(e)||t.getBoundingClientRect().height===0),pi=(t,e,n="b3-list-item--focus",a)=>{var i;let s=t.querySelector("."+n);if(!s&&a){a.classList.add(n),a.scrollIntoView(!0);return}if(!s)return;const r=n.split("--")[0];if(e.key==="ArrowDown"){for(e.preventDefault(),e.stopPropagation(),s.classList.remove(n),s=s.nextElementSibling;No(s,r);)s=s.nextElementSibling;if(!s)for(s=t.children[0];No(s,r);)s=s.nextElementSibling;return s?(s.classList.add(n),(t.scrollTop<s.offsetTop-t.clientHeight+s.clientHeight||t.scrollTop>s.offsetTop)&&s.scrollIntoView(t.scrollTop>s.offsetTop),s):void 0}else if(e.key==="ArrowUp"){for(e.preventDefault(),e.stopPropagation(),s.classList.remove(n),s=s.previousElementSibling;No(s,r);)s=s.previousElementSibling;if(!s)for(s=t.children[t.children.length-1];s&&(s.classList.contains("fn__none")||!s.classList.contains(r));)s=s.previousElementSibling;if(!s)return;s.classList.add(n);const o=t.scrollTop>s.offsetTop-(((i=s.previousElementSibling)==null?void 0:i.clientHeight)||0);return(t.scrollTop<s.offsetTop-t.clientHeight+s.clientHeight||o)&&s.scrollIntoView(o),s}else if(e.key==="Home"){for(e.preventDefault(),e.stopPropagation(),s.classList.remove(n),s=t.children[0];No(s,r);)s=s.nextElementSibling;return s?(s.classList.add(n),s.scrollIntoView(),s):void 0}else if(e.key==="End"){for(e.preventDefault(),e.stopPropagation(),s.classList.remove(n),s=t.children[t.children.length-1];No(s,r);)s=s.previousElementSibling;return s?(s.classList.add(n),s.scrollIntoView(!1),s):void 0}},vy=(t,e,n="b3-list-item--focus",a)=>{var i,s;let r=t.querySelector("."+n);if(!r&&a){a.classList.add(n),a.scrollIntoView(!0);return}if(!r)return;const o=n.split("--")[0];if(e.key==="ArrowLeft"){e.preventDefault(),e.stopPropagation(),r.classList.remove(n),r.parentElement.classList.contains("b3-list")?r.querySelector(".b3-list-item__arrow--open")?(r.querySelector(".b3-list-item__arrow--open").classList.remove("b3-list-item__arrow--open"),r.nextElementSibling.classList.add("fn__none")):r=t.firstElementChild:r=r.parentElement.previousElementSibling,r.classList.add(n);const l=t.scrollTop>r.offsetTop-46-(((i=r.previousElementSibling)==null?void 0:i.clientHeight)||0);return(t.scrollTop<r.offsetTop-46-t.clientHeight+r.clientHeight||l)&&r.scrollIntoView(l),r}else{if(e.key==="ArrowRight")return e.preventDefault(),e.stopPropagation(),r.classList.remove(n),r.parentElement.classList.contains("b3-list")?r.querySelector(".b3-list-item__arrow--open")?r=r.nextElementSibling.firstElementChild:(r.querySelector(".b3-list-item__arrow").classList.add("b3-list-item__arrow--open"),r.nextElementSibling.classList.remove("fn__none")):r.nextElementSibling?r=r.nextElementSibling:r.parentElement.nextElementSibling&&(r=r.parentElement.nextElementSibling),r.classList.add(n),(t.scrollTop<r.offsetTop-46-t.clientHeight+r.clientHeight||t.scrollTop>r.offsetTop-46)&&r.scrollIntoView(t.scrollTop>r.offsetTop-46),r;if(e.key==="ArrowDown")return e.preventDefault(),e.stopPropagation(),r.classList.remove(n),r.nextElementSibling?(r=r.nextElementSibling,r.classList.contains(o)||(r.classList.contains("fn__none")?(r=r.nextElementSibling,r||(r=t.firstElementChild)):r=r.firstElementChild)):r=r.parentElement.nextElementSibling||t.firstElementChild,r.classList.add(n),(t.scrollTop<r.offsetTop-46-t.clientHeight+r.clientHeight||t.scrollTop>r.offsetTop-46)&&r.scrollIntoView(t.scrollTop>r.offsetTop-46),r;if(e.key==="ArrowUp"){e.preventDefault(),e.stopPropagation(),r.classList.remove(n),r.previousElementSibling?(r=r.previousElementSibling,r.classList.contains(o)||(r.classList.contains("fn__none")?r=r.previousElementSibling:r=r.lastElementChild)):r.parentElement.classList.contains("b3-list")?t.lastElementChild.classList.contains("fn__none")?r=t.lastElementChild.previousElementSibling:r=t.lastElementChild.lastElementChild:r=r.parentElement.previousElementSibling,r.classList.add(n);const l=t.scrollTop>r.offsetTop-46-(((s=r.previousElementSibling)==null?void 0:s.clientHeight)||0);return(t.scrollTop<r.offsetTop-46-t.clientHeight+r.clientHeight||l)&&r.scrollIntoView(l),r}else{if(e.key==="Home")return e.preventDefault(),e.stopPropagation(),r.classList.remove(n),r=t.children[0],r.classList.add(n),r.scrollIntoView(),r;if(e.key==="End")return e.preventDefault(),e.stopPropagation(),r.classList.remove(n),t.lastElementChild.classList.contains("fn__none")?r=t.lastElementChild.previousElementSibling:r=t.lastElementChild.lastElementChild,r.classList.add(n),r.scrollIntoView(!1),r}}},yd=t=>{const e=new fe({title:window.siyuan.languages.rename,content:`<div class="b3-dialog__content">
    <input class="b3-text-field fn__block">
    <div class="b3-list fn__flex-1 b3-list--background fn__none protyle-hint" style="    position: absolute;
    width: calc(100% - 48px);">
        <img style="margin: 0 auto;display: block;width: 64px;height: 64px" src="/stage/loading-pure.svg">
    </div>
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"});e.element.setAttribute("data-key",p.DIALOG_RENAMETAG);const n=e.element.querySelectorAll(".b3-button");n[0].addEventListener("click",()=>{e.destroy()}),n[1].addEventListener("click",()=>{ae("/api/tag/renameTag",{oldLabel:t,newLabel:a.value},()=>{e.destroy(),Vn("tag").data.tag.update()})});const a=e.element.querySelector("input");a.value=t,a.focus(),a.select();const i=e.element.querySelector(".b3-list--background");a.addEventListener("keydown",s=>{if(s.stopPropagation(),!s.isComposing){if(pi(i,s),s.key==="Escape")i.classList.contains("fn__none")?e.destroy():i.classList.add("fn__none"),s.preventDefault();else if(!s.shiftKey&&ct(s)&&s.key==="Enter"){if(i.classList.contains("fn__none"))n[1].click();else{const r=i.querySelector(".b3-list-item--focus");a.value=r.dataset.type==="new"?r.querySelector("mark").textContent.trim():r.textContent.trim(),i.classList.add("fn__none")}s.preventDefault()}}}),a.addEventListener("input",s=>{s.stopPropagation(),i.classList.remove("fn__none"),ae("/api/search/searchTag",{k:a.value.trim()},r=>{let o="",l=!1;r.data.tags.forEach((c,d)=>{o+=`<div class="b3-list-item${d===0?" b3-list-item--focus":""}">
    <div class="fn__flex-1">${c}</div>
</div>`,c===`<mark>${r.data.k}</mark>`&&(l=!0)}),!l&&r.data.k&&(o=`<div data-type="new" class="b3-list-item${o?"":" b3-list-item--focus"}"><div class="fn__flex-1">${window.siyuan.languages.new} <mark>${he(r.data.k)}</mark></div></div>`+o),i.innerHTML=o})}),i.addEventListener("click",s=>{const r=s.target,o=N(r,"b3-list-item");o&&(a.value=o.dataset.type==="new"?o.querySelector("mark").textContent.trim():o.textContent.trim(),i.classList.add("fn__none"))})},gh=()=>_n().basename(window.siyuan.config.system.workspaceDir.replace(/\\/g,"/")),na=(t,e)=>{t&&ae("/api/block/checkBlockFold",{id:t},n=>{e(n.data.isFolded,n.data.isFolded?[p.CB_GET_FOCUS,p.CB_GET_ALL]:[p.CB_GET_FOCUS,p.CB_GET_CONTEXT,p.CB_GET_ROOTSCROLL],n.data.isRoot)})},xy=()=>{let t;const e=Vn("file");if(!e)return!1;t=e.data.file.element;const n=[];Object.keys(p.HELP_PATH).forEach(a=>{n.push(p.HELP_PATH[a])}),t.childNodes.forEach(a=>{a.querySelector('[data-type="addLocal"]')||n.includes(a.getAttribute("data-url"))||a.querySelector('[data-type="more-root"]').insertAdjacentHTML("beforebegin",`<span data-type="addLocal" class="b3-list-item__action">
    <svg><use xlink:href="#iconRiffCard"></use></svg>
</span>`)})};var Ey=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const _d=t=>({id:"export",label:window.siyuan.languages.export,icon:"iconUpload",click(){return Ey(this,null,function*(){mt(t)})}}),mh=(t,e,n,a,i=!1)=>{const s=[{id:"insertRight",icon:"iconLayoutRight",label:window.siyuan.languages.insertRight,accelerator:e.length===1?`${Mt(window.siyuan.config.keymap.editor.general.insertRight.custom)}/${Mt("\u2325"+window.siyuan.languages.click)}`:void 0,click:()=>{n?dn({app:t,id:e[0],position:"right",action:[p.CB_GET_FOCUS,p.CB_GET_SCROLL]}):e.forEach(r=>{na(r,(o,l)=>{dn({app:t,id:r,position:"right",action:l,zoomIn:o})})})}},{id:"insertBottom",icon:"iconLayoutBottom",label:window.siyuan.languages.insertBottom,accelerator:e.length===1?"\u21E7\u2318"+window.siyuan.languages.click:"",click:()=>{n?dn({app:t,id:e[0],position:"bottom",action:[p.CB_GET_FOCUS,p.CB_GET_SCROLL]}):e.forEach(r=>{na(r,(o,l)=>{dn({app:t,id:r,position:"bottom",action:l,zoomIn:o})})})}}];if(window.siyuan.config.fileTree.openFilesUseCurrentTab&&s.push({id:"openInNewTab",label:window.siyuan.languages.openInNewTab,accelerator:e.length===1?"\u2325\u2318"+window.siyuan.languages.click:void 0,click:()=>{n?dn({app:t,id:e[0],action:[p.CB_GET_FOCUS,p.CB_GET_SCROLL],removeCurrentTab:!1}):e.forEach(r=>{na(r,(o,l)=>{dn({app:t,id:r,action:l,zoomIn:o,removeCurrentTab:!1})})})}}),s.push({id:"separator_1",type:"separator"}),s.push({id:"preview",icon:"iconPreview",label:window.siyuan.languages.preview,click:()=>{e.forEach(r=>{dn({app:t,id:r,mode:"preview"})})}}),i)return s;window.siyuan.menus.menu.append(new xe({id:"openBy",label:window.siyuan.languages.openBy,icon:"iconOpen",submenu:s}).element)},wd=t=>{if(St())window.JSAndroid.writeImageClipboard(t);else{const e=document.createElement("canvas"),n=document.createElement("img");n.onload=a=>{e.width=a.target.width,e.height=a.target.height,e.getContext("2d").drawImage(a.target,0,0,a.target.width,a.target.height),e.toBlob(i=>{navigator.clipboard.write([new ClipboardItem({"image/png":i})])},"image/png",1)},n.src=t}};var gf=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const bh=()=>gf(void 0,null,function*(){const t=yield wn("/api/petal/loadPetals",{frontend:C()});let e="";return t.data.forEach(n=>{e+=n.css||""}),e}),Ql=t=>(["ant","material"].includes(window.siyuan.config.appearance.icon)?"":`<script src="${t}appearance/icons/material/icon.js?v=${p.SIYUAN_VERSION}"><\/script>`)+`<script src="${t}appearance/icons/${window.siyuan.config.appearance.icon}/icon.js?v=${p.SIYUAN_VERSION}"><\/script>`,Bo=t=>{if(["html","htmlmd"].includes(t.type)){const e=Q(window.siyuan.languages.exporting,-1),n=t.type==="htmlmd"?"/api/export/exportMdHTML":"/api/export/exportHTML";ae(n,{id:t.id,pdf:!1,removeAssets:!1,merge:!0,savePath:""},a=>gf(void 0,null,function*(){const i=yield yh(a,void 0,"",t);ae("/api/export/exportBrowserHTML",{folder:a.data.folder,html:i,name:a.data.name},s=>{if(ot(e),s.code===-1){Q(window.siyuan.languages._kernel[14]+": "+s.msg,0,"error");return}window.open(s.data.zip),Q(window.siyuan.languages.exported)})}));return}},ky=()=>{let t="";return document.querySelectorAll("style").forEach(e=>{e.id.startsWith("snippet")&&(t+=e.outerHTML)}),t},yh=(t,e,n,a,i)=>gf(void 0,null,function*(){let s=window.siyuan.config.appearance.themeLight,r=0;["html","htmlmd"].includes(a.type)&&window.siyuan.config.appearance.mode===1&&(s=window.siyuan.config.appearance.themeDark,r=1);const o=window.siyuan.config.appearance.mode===1&&window.siyuan.config.appearance.themeDark==="midnight"||window.siyuan.config.appearance.mode===0&&window.siyuan.config.appearance.themeLight==="daylight";let l="";o||(l=`<link rel="stylesheet" type="text/css" id="themeStyle" href="${n}appearance/themes/${s}/theme.css?${p.SIYUAN_VERSION}"/>`);const c=Xa(),d=St()||Qt()?{js:`document.body.style.minWidth = "${c}px";`,css:`@page { size: A4; margin: 10mm 0 10mm 0; }
.protyle-wysiwyg {padding: 0; margin: 0;}`}:{js:"",css:""},u=`<!DOCTYPE html>
<html lang="${window.siyuan.config.appearance.lang}" data-theme-mode="${CA()}" data-light-theme="${window.siyuan.config.appearance.themeLight}" data-dark-theme="${window.siyuan.config.appearance.themeDark}">
<head>
    <base href="${n}">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <meta name="mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" type="text/css" id="baseStyle" href="${n}stage/build/export/base.css?v=${p.SIYUAN_VERSION}"/>
    <link rel="stylesheet" type="text/css" id="themeDefaultStyle" href="${n}appearance/themes/${s}/theme.css?v=${p.SIYUAN_VERSION}"/>
    <script src="${n}stage/protyle/js/protyle-html.js?v=${p.SIYUAN_VERSION}"><\/script>
    ${l}
    <title>${t.data.name}</title>
    <!-- Exported by SiYuan v${p.SIYUAN_VERSION} -->
    <style>
        body {font-family: var(--b3-font-family);background-color: var(--b3-theme-background);color: var(--b3-theme-on-background)}
        ${yield Qh(!1,n)}
        ${yield bh()}
        ${d.css}
    </style>
    ${ky()}
</head>
<body>
<div class="${["htmlmd","word"].includes(a.type)?"b3-typography":"protyle-wysiwyg"+(window.siyuan.config.editor.displayBookmarkIcon?" protyle-wysiwyg--attr":"")}" 
style="max-width: 800px;margin: 0 auto;" id="preview">${t.data.content}</div>
${Ql(n)}
<script src="${n}stage/build/export/protyle-method.js?v=${p.SIYUAN_VERSION}"><\/script>
<script src="${n}stage/protyle/js/lute/lute.min.js?v=${p.SIYUAN_VERSION}"><\/script>  
<script>
    ${d.js}
    window.siyuan = {
      config: {
        appearance: { mode: ${r}, codeBlockThemeDark: "${window.siyuan.config.appearance.codeBlockThemeDark}", codeBlockThemeLight: "${window.siyuan.config.appearance.codeBlockThemeLight}" },
        editor: { 
          codeLineWrap: true,
          fontSize: ${window.siyuan.config.editor.fontSize},
          codeLigatures: ${window.siyuan.config.editor.codeLigatures},
          plantUMLServePath: "${window.siyuan.config.editor.plantUMLServePath}",
          codeSyntaxHighlightLineNum: ${window.siyuan.config.editor.codeSyntaxHighlightLineNum},
          katexMacros: decodeURI(\`${encodeURI(window.siyuan.config.editor.katexMacros)}\`),
        }
      },
      languages: {copy:"${window.siyuan.languages.copy}"}
    };
    const previewElement = document.getElementById('preview');
    Protyle.highlightRender(previewElement, "stage/protyle");
    Protyle.mathRender(previewElement, "stage/protyle", ${a.type==="pdf"});
    Protyle.mermaidRender(previewElement, "stage/protyle");
    Protyle.flowchartRender(previewElement, "stage/protyle");
    Protyle.graphvizRender(previewElement, "stage/protyle");
    Protyle.chartRender(previewElement, "stage/protyle");
    Protyle.mindmapRender(previewElement, "stage/protyle");
    Protyle.abcRender(previewElement, "stage/protyle");
    Protyle.htmlRender(previewElement);
    Protyle.plantumlRender(previewElement, "stage/protyle");
    document.querySelectorAll(".protyle-action__copy").forEach((item) => {
      item.addEventListener("click", (event) => {
            let text = item.parentElement.nextElementSibling.textContent.trimEnd();
            text = text.replace(/\xA0/g, " "); // Replace non-breaking spaces with normal spaces when copying
            navigator.clipboard.writeText(text);
            event.preventDefault();
            event.stopPropagation();
      })
    });
<\/script></body></html>`;if(typeof e=="undefined")return u}),vd=(t,e="outerHTML")=>{if(!t.querySelector("[data-type='block-render']"))return t[e];const n=t.cloneNode(!0);return n.querySelectorAll("span[data-render='1'][data-type='block-render']").forEach(a=>{a.innerHTML="",a.setAttribute("data-render","2")}),n[e]},_h=t=>{const e=document.createElement("template");return e.innerHTML=t,e.content.querySelectorAll('[contenteditable="false"][spellcheck]').forEach(n=>{N(n,"protyle-wysiwyg__embed")||n.setAttribute("contenteditable","true")}),e.innerHTML},hr=(t,e,n)=>{if(x())return;const a=e.getBoundingClientRect();if(a.height===0||!t){Pa();return}const i=document.getElementById("tooltip");i.className=n?`tooltip tooltip--${n}`:"tooltip",i.innerHTML=t,i.removeAttribute("style");const s=e.getAttribute("data-position"),r=e.parentElement.getBoundingClientRect();let o,l;if(s==="parentE")l=Math.max(0,r.top-(i.clientHeight-r.height)/2),l>window.innerHeight-i.clientHeight&&(l=window.innerHeight-i.clientHeight),o=r.right+8,o+i.clientWidth>window.innerWidth&&(o=r.left-i.clientWidth-8);else if(s==="parentW")l=Math.max(0,r.top-(i.clientHeight-r.height)/2),l>window.innerHeight-i.clientHeight&&(l=window.innerHeight-i.clientHeight),o=r.left-i.clientWidth,o<0&&(o=r.right);else if(s!=null&&s.endsWith("west")){const c=parseInt(s)||.5;l=Math.max(0,a.top-(i.clientHeight-a.height)/2),l>window.innerHeight-i.clientHeight&&(l=window.innerHeight-i.clientHeight),o=a.left-i.clientWidth-c,o<0&&(o=a.right)}else if(s==="north")o=Math.max(0,a.left-(i.clientWidth-a.width)/2),l=a.top-i.clientHeight-.5,l<0&&(a.top<window.innerHeight-a.bottom?(l=a.bottom+.5,i.style.maxHeight=window.innerHeight-l+"px"):(l=0,i.style.maxHeight=a.top-.5+"px")),o+i.clientWidth>window.innerWidth&&(o=window.innerWidth-i.clientWidth);else{const c=parseInt(s)||.5;o=Math.max(0,a.left-(i.clientWidth-a.width)/2),l=a.bottom+c,l+i.clientHeight>window.innerHeight&&(a.top-c>window.innerHeight-l?(l=a.top-c-i.clientHeight,i.style.maxHeight=a.top-c+"px"):i.style.maxHeight=window.innerHeight-l+"px"),o+i.clientWidth>window.innerWidth&&(o=window.innerWidth-i.clientWidth)}i.style.top=l+"px",i.style.left=o+"px"},Pa=()=>{document.getElementById("tooltip").classList.add("fn__none")},xd=(t,e)=>/\r\n|\r|\n|\u2028|\u2029|\t/.test(t)?(e?hr(window.siyuan.languages.fileNameRule,e,"error"):Q(window.siyuan.languages.fileNameRule),!1):t.length>p.SIZE_TITLE?(e?hr(window.siyuan.languages._kernel[106],e,"error"):Q(window.siyuan.languages._kernel[106]),!1):!0,Wi=t=>(t.indexOf("/")>-1&&(Q(window.siyuan.languages.fileNameRule),t=t.replace(/\//g,"\uFF0F")),t.replace(/\r\n|\r|\n|\u2028|\u2029|\t|/g,"").substring(0,p.SIZE_TITLE)),mf=t=>t.replace(/\\\\|\/|"|:|\*|\?|\\|'|<|>|\|/g,""),bf=t=>{if(window.siyuan.config.readonly)return;const e=new fe({title:window.siyuan.languages.rename,content:`<div class="b3-dialog__content"><input class="b3-text-field fn__block" value=""></div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px",destroyCallback(){t.range&&Pt(t.range)}});e.element.setAttribute("data-key",p.DIALOG_RENAME);const n=e.element.querySelector("input"),a=e.element.querySelectorAll(".b3-button");e.bindInput(n,()=>{a[1].click()}),n.value=Lute.UnEscapeHTMLStr(t.name),n.focus(),n.select(),a[0].addEventListener("click",()=>{e.destroy()}),a[1].addEventListener("click",()=>{if(!xd(n.value))return!1;if(n.value===t.name)return e.destroy(),!1;n.value.trim()===""?n.value=window.siyuan.languages.untitled:n.value=Wi(n.value),t.type==="notebook"?ae("/api/notebook/renameNotebook",{notebook:t.notebookId,name:n.value},()=>{bl(t.notebookId,n.value)}):ae("/api/filetree/renameDoc",{notebook:t.notebookId,path:t.path,title:n.value}),e.destroy()})},Ed=t=>{const e=new fe({title:window.siyuan.languages.rename,content:`<div class="b3-dialog__content"><input class="b3-text-field fn__block" value=""></div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"});e.element.setAttribute("data-key",p.DIALOG_RENAMEASSETS);const n=e.element.querySelector("input"),a=e.element.querySelectorAll(".b3-button");e.bindInput(n,()=>{a[1].click()});const i=pd(t);n.value=i,n.focus(),n.select(),a[0].addEventListener("click",()=>{e.destroy()}),a[1].addEventListener("click",()=>{if(n.value===i||!n.value)return e.destroy(),!1;ae("/api/asset/renameAsset",{oldPath:t,newName:n.value},s=>{Cn().asset.forEach(r=>{r.path===t&&(r.path=s.data.newPath,r.parent.updateTitle(ha(s.data.newPath)))}),Es().forEach(r=>{r.reload(!1)}),e.destroy()})})},Sy=t=>{if(getSelection().rangeCount===0)return;const e=getSelection().getRangeAt(0),n=oe(e.startContainer);if(!n)return;let a=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));a.length===0&&(a=[n]);let i="",s=e.toString();if(s===""){if(s=a[0].textContent,a.forEach(r=>{i+=vd(r)}),!s)return}else{const r=document.createElement("div");r.appendChild(e.cloneContents()),i=r.innerHTML}s.length>10&&(s=s.substr(0,10)+"..."),s=Wi(s),ae("/api/filetree/createDoc",{notebook:t.notebookId,path:_n().join(ha(t.path,!1,!0),Lute.NewNodeID()+".sy"),title:s,md:t.lute.BlockDOM2StdMd(i)})};var wh=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const Ay=(t,e)=>{},vh=t=>{const e=new fe({title:window.siyuan.languages.exportAsImage,content:`<div class="b3-dialog__content" style="${x()?"padding:8px;":""};background-color: var(--b3-theme-background)">
    <div style="${x()?"margin: 8px 0":"padding: 48px;margin: 8px 0"}" class="export-img">
        <div ${x()?'style="padding:8px"':""} class="protyle-wysiwyg${window.siyuan.config.editor.displayBookmarkIcon?" protyle-wysiwyg--attr":""}"></div>
        <div class="export-img__watermark"></div>
    </div>
</div>
<div class="b3-dialog__action">
    <label class="fn__flex">
        ${window.siyuan.languages.exportPDF5}
        <span class="fn__space"></span>
        <input id="keepFold" class="b3-switch fn__flex-center" type="checkbox" ${window.siyuan.storage[p.LOCAL_EXPORTIMG].keepFold?"checked":""}>
    </label>
    <label class="fn__flex" style="margin-left: 24px">
        ${window.siyuan.languages.export30}
        <span class="fn__space"></span>
        <input id="watermark" class="b3-switch fn__flex-center" type="checkbox" ${window.siyuan.storage[p.LOCAL_EXPORTIMG].watermark?"checked":""}>
    </label>
    <span class="fn__flex-1 export-img__space"></span>
    <button disabled class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button disabled class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>
 <div class="fn__loading"><img height="128px" width="128px" src="stage/loading-pure.svg"></div>`,width:x()?"92vw":"990px",height:"70vh"});e.element.setAttribute("data-key",p.DIALOG_EXPORTIMAGE);const n=e.element.querySelectorAll(".b3-button");n[0].addEventListener("click",()=>{e.destroy()}),n[1].addEventListener("click",()=>wh(void 0,null,function*(){const l=Q(window.siyuan.languages.exporting,0),c=e.element.querySelector(".b3-dialog__container");c.style.height="";const d=e.element.querySelector(".b3-dialog__content");d.style.overflow="hidden",Gt(p.LOCAL_EXPORTIMG,window.siyuan.storage[p.LOCAL_EXPORTIMG]);const u=a.querySelectorAll("[data-subtype='plantuml']");for(let g=0;g<u.length;g++){const f=u[g].querySelector("object");if(f){const m=yield(yield fetch(f.getAttribute("data"))).text();f.insertAdjacentHTML("beforebegin",m),f.remove()}}a.querySelectorAll(".protyle-linenumber__rows span").forEach((g,f)=>{g.textContent=(f+1).toString()}),setTimeout(()=>{va("/stage/protyle/js/html-to-image.min.js?v=1.11.13","protyleHtml2image").then(()=>wh(void 0,null,function*(){let g=yield window.htmlToImage.toBlob(e.element.querySelector(".b3-dialog__content"));(bn()||Bn())&&(yield window.htmlToImage.toBlob(d),yield window.htmlToImage.toBlob(d),yield window.htmlToImage.toBlob(d),g=yield window.htmlToImage.toBlob(d));const f=new FormData;f.append("file",g,n[1].getAttribute("data-title")),f.append("type","image/png"),ae("/api/export/exportAsFile",f,h=>{$e(h.data.file)}),ot(l),e.destroy()}))},p.TIMEOUT_LOAD)}));const a=e.element.querySelector(".protyle-wysiwyg"),i=e.element.querySelector("#keepFold");i.addEventListener("change",()=>{n[0].setAttribute("disabled","disabled"),n[1].setAttribute("disabled","disabled"),n[1].parentElement.insertAdjacentHTML("afterend",'<div class="fn__loading"><img height="128px" width="128px" src="stage/loading-pure.svg"></div>'),window.siyuan.storage[p.LOCAL_EXPORTIMG].keepFold=i.checked,ae("/api/export/exportPreviewHTML",{id:t,keepFold:i.checked,image:!0},l=>{o(l)})});const s=e.element.querySelector("#watermark");s.addEventListener("change",()=>{window.siyuan.storage[p.LOCAL_EXPORTIMG].watermark=s.checked,r()});const r=()=>{const l=e.element.querySelector(".export-img__watermark");l.innerHTML="",s.checked?window.siyuan.config.export.imageWatermarkDesc?l.innerHTML=window.siyuan.config.export.imageWatermarkDesc:window.siyuan.config.export.imageWatermarkStr&&(window.siyuan.config.export.imageWatermarkStr.startsWith("http")?l.setAttribute("style",`background-image: url(${window.siyuan.config.export.imageWatermarkStr});background-repeat: repeat;position: absolute;top: 0;left: 0;width: 100%;height: 100%;border-radius: var(--b3-border-radius-b);`):va("/stage/protyle/js/html-to-image.min.js?v=1.11.13","protyleHtml2image").then(()=>{const c=Math.max(e.element.querySelector(".export-img").clientWidth/3,150);l.setAttribute("style",`width: ${c}px;height: ${c}px;display: flex;justify-content: center;align-items: center;color: var(--b3-border-color);font-size: 14px;`),l.innerHTML=`<div style="transform: rotate(-45deg)">${window.siyuan.config.export.imageWatermarkStr}</div>`,window.htmlToImage.toCanvas(l).then(d=>{l.innerHTML="",l.setAttribute("style",`background-image: url(${d.toDataURL("image/png")});background-repeat: repeat;position: absolute;top: 0;left: 0;width: 100%;height: 100%;border-radius: var(--b3-border-radius-b);`)})})):l.removeAttribute("style")},o=l=>{a.innerHTML=l.data.content,a.setAttribute("data-doc-type",l.data.type||"NodeDocument"),Object.keys(l.data.attrs).forEach(c=>{a.setAttribute(c,l.data.attrs[c])}),a.querySelectorAll(".code-block").forEach(c=>{c.setAttribute("linewrap","true")}),zn(a),ra(a),a.querySelectorAll("table").forEach(c=>{c.clientWidth>c.parentElement.clientWidth&&(c.setAttribute("style",`margin-bottom:${c.parentElement.clientWidth*c.clientHeight/c.clientWidth-c.parentElement.clientHeight+1}px;transform: scale(${c.parentElement.clientWidth/c.clientWidth});transform-origin: top left;`),c.parentElement.style.overflow="hidden")}),r(),n[0].removeAttribute("disabled"),n[1].removeAttribute("disabled"),e.element.querySelector(".fn__loading").remove()};ae("/api/export/exportPreviewHTML",{id:t,keepFold:i.checked,image:!0},l=>{o(l),n[1].setAttribute("data-title",l.data.name+".png")})},xh=(t,e,n)=>{if(t.getAttribute("custom-pinthead")==="true"){const a=t.querySelector("table");a.clientHeight+a.scrollTop<e.offsetTop+e.clientHeight?a.scrollTop=e.offsetTop-a.clientHeight+e.clientHeight+1:a.scrollTop>e.offsetTop-e.clientHeight&&(a.scrollTop=e.offsetTop-e.clientHeight+1)}else kn(n,e)},cs=t=>{let e=t.previousElementSibling,n=0;for(;e;)n++,e=e.previousElementSibling;return n},Ty=(t,e,n=!0)=>{let a=t.previousElementSibling;return a||(t.parentElement.previousElementSibling?a=t.parentElement.previousElementSibling.lastElementChild:t.parentElement.parentElement.tagName==="TBODY"&&t.parentElement.parentElement.previousElementSibling?a=t.parentElement.parentElement.previousElementSibling.lastElementChild.lastElementChild:a=null),a&&(e.selectNodeContents(a),n||e.collapse(!1),Pt(e)),a},se=(t,e,n,a,i)=>{i.insertNode(document.createElement("wbr"));const s=n.outerHTML,r=n.querySelector("table"),o=r.rows[0].cells.length,l=r.rows.length,c=[];for(let d=0;d<l;d++){for(let u=0;u<o;u++)r.rows[d].cells[u]===e[c.length]&&c.push(u);if(c.length>0)break}for(let d=0;d<l;d++)c.forEach(u=>{r.rows[d].cells[u].setAttribute("align",a)});Ht(t,n.getAttribute("data-node-id"),n.outerHTML,s),cn(r,i)},be=(t,e,n,a)=>{const i=document.createElement("wbr");e.insertNode(i);const s=a.outerHTML;i.remove();let r="";for(let l=0;l<n.parentElement.childElementCount;l++)r+=`<td align="${n.parentElement.children[l].getAttribute("align")||""}"></td>`;let o;if(n.tagName==="TH"){const l=a.querySelector("tbody");l?(l.insertAdjacentHTML("afterbegin",`<tr>${r}</tr>`),o=l.firstElementChild):(n.parentElement.parentElement.insertAdjacentHTML("afterend",`<tbody><tr>${r}</tr></tbody>`),o=n.parentElement.parentElement.nextElementSibling.firstElementChild)}else n.parentElement.insertAdjacentHTML("afterend",`<tr>${r}</tr>`),o=n.parentElement.nextElementSibling;e.selectNodeContents(o.cells[cs(n)]),e.collapse(!0),Pt(e),Ht(t,a.getAttribute("data-node-id"),a.outerHTML,s),xh(a,o,t)},Ue=(t,e,n,a)=>{const i=document.createElement("wbr");e.insertNode(i);const s=a.outerHTML;i.remove();let r="",o=!1;for(let c=0;c<n.parentElement.childElementCount;c++){const d=n.parentElement.children[c];d.className==="fn__none"&&(o=!0),n.tagName==="TH"?r+=`<th class="${d.className}" colspan="${d.colSpan}" align="${d.getAttribute("align")}"></th>`:r+=`<td class="${d.className}" colspan="${d.colSpan}" align="${d.getAttribute("align")}"></td>`}if(o){let c=n.parentElement.previousElementSibling,d=1;for(;c;)d++,Array.from(c.children).forEach(u=>{u.rowSpan>=d&&u.rowSpan>1&&(u.rowSpan=u.rowSpan+1)}),c=c.previousElementSibling}let l;n.parentElement.parentElement.tagName==="THEAD"&&!n.parentElement.previousElementSibling?(n.parentElement.parentElement.insertAdjacentHTML("beforebegin",`<thead><tr>${r}</tr></thead>`),l=a.querySelector("thead tr"),n.parentElement.parentElement.nextElementSibling.insertAdjacentHTML("afterbegin",n.parentElement.parentElement.innerHTML.replace(/<th/g,"<td").replace(/<\/th>/g,"</td>")),n.parentElement.parentElement.remove()):(n.parentElement.insertAdjacentHTML("beforebegin",`<tr>${r}</tr>`),l=n.parentElement.previousElementSibling),e.selectNodeContents(l.cells[cs(n)]),e.collapse(!0),Pt(e),Ht(t,a.getAttribute("data-node-id"),a.outerHTML,s),xh(a,l,t)},Ke=(t,e,n,a,i)=>{const s=document.createElement("wbr");i.insertNode(s);const r=e.outerHTML;s.remove();const o=cs(n),l=e.querySelector("table");for(let c=0;c<l.rows.length;c++){const d=l.rows[c].cells[o],u=document.createElement(d.tagName);d.insertAdjacentElement(a,u),d===n?(u.innerHTML="<wbr> ",u.offsetLeft+u.clientWidth>e.firstElementChild.scrollLeft+e.firstElementChild.clientWidth&&(e.firstElementChild.scrollLeft=u.offsetLeft+u.clientWidth-e.firstElementChild.clientWidth)):u.textContent=" "}l.querySelectorAll("col")[o].insertAdjacentHTML(a,"<col style='min-width: 60px;'>"),cn(e,i),Ht(t,e.getAttribute("data-node-id"),e.outerHTML,r)},dt=(t,e,n,a)=>{if(n.parentElement.parentElement.tagName!=="THEAD"){const i=document.createElement("wbr");e.insertNode(i);const s=a.outerHTML;i.remove();const r=cs(n),o=n.parentElement.parentElement;let l=o.previousElementSibling.lastElementChild;n.parentElement.previousElementSibling&&(l=n.parentElement.previousElementSibling),o.childElementCount===1?o.remove():n.parentElement.remove(),e.selectNodeContents(l.cells[r]),e.collapse(!0),Pt(e),xh(a,l,t),Ht(t,a.getAttribute("data-node-id"),a.outerHTML,s)}},rt=(t,e,n,a)=>{var i;const s=document.createElement("wbr");e.insertNode(s);const r=n.outerHTML;s.remove();const o=cs(a),l=a.previousElementSibling||a.nextElementSibling;if(l)e.selectNodeContents(l),e.collapse(!0),l.offsetLeft+l.clientWidth>n.firstElementChild.scrollLeft+n.firstElementChild.clientWidth&&(n.firstElementChild.scrollLeft=l.offsetLeft+l.clientWidth-n.firstElementChild.clientWidth);else{n.classList.add("protyle-wysiwyg--select"),gr(t,n,e,"remove");return}const c=n.querySelector("table");for(let d=0;d<c.rows.length;d++){const u=c.rows[d].cells;if(u.length===1){c.remove();break}u[o].remove()}(i=n.querySelectorAll("col")[o])==null||i.remove(),Ht(t,n.getAttribute("data-node-id"),n.outerHTML,r),Pt(e)},Nt=(t,e,n,a)=>{const i=n.parentElement;if(i.parentElement.tagName==="THEAD")return;e.insertNode(document.createElement("wbr"));const s=a.outerHTML;if(i.previousElementSibling)i.after(i.previousElementSibling);else{const r=i.parentElement.previousElementSibling.firstElementChild;r.querySelectorAll("th").forEach(o=>{const l=document.createElement("td");l.innerHTML=o.innerHTML,o.parentNode.replaceChild(l,o)}),i.querySelectorAll("td").forEach(o=>{const l=document.createElement("th");l.innerHTML=o.innerHTML,o.parentNode.replaceChild(l,o)}),i.after(r),i.parentElement.previousElementSibling.append(i)}Ht(t,a.getAttribute("data-node-id"),a.outerHTML,s),cn(a,e),kn(t,i)},tn=(t,e,n,a)=>{const i=n.parentElement;if(i.parentElement.tagName==="TBODY"&&!i.nextElementSibling||i.parentElement.tagName==="THEAD"&&!i.parentElement.nextElementSibling)return;e.insertNode(document.createElement("wbr"));const s=a.outerHTML;if(i.nextElementSibling)i.before(i.nextElementSibling);else{const r=i.parentElement.nextElementSibling.firstElementChild;r.querySelectorAll("td").forEach(o=>{const l=document.createElement("th");l.innerHTML=o.innerHTML,o.parentNode.replaceChild(l,o)}),i.querySelectorAll("th").forEach(o=>{const l=document.createElement("td");l.innerHTML=o.innerHTML,o.parentNode.replaceChild(l,o)}),i.after(r),i.parentElement.nextElementSibling.insertAdjacentElement("afterbegin",i)}Ht(t,a.getAttribute("data-node-id"),a.outerHTML,s),cn(a,e),kn(t,i)},Un=(t,e,n,a)=>{if(!n.previousElementSibling)return;e.insertNode(document.createElement("wbr"));const i=a.outerHTML;let s=0;Array.from(n.parentElement.children).find((o,l)=>{if(n===o)return s=l,!0}),a.querySelectorAll("tr").forEach(o=>{o.cells[s].after(o.cells[s-1])}),n.offsetLeft<a.firstElementChild.scrollLeft&&(a.firstElementChild.scrollLeft=n.offsetLeft);const r=a.querySelectorAll("col");r[s].after(r[s-1]),Ht(t,a.getAttribute("data-node-id"),a.outerHTML,i),cn(a,e)},Fn=(t,e,n,a)=>{if(!n.nextElementSibling)return;e.insertNode(document.createElement("wbr"));const i=a.outerHTML;let s=0;Array.from(n.parentElement.children).find((o,l)=>{if(n===o)return s=l,!0}),a.querySelectorAll("tr").forEach(o=>{o.cells[s].before(o.cells[s+1])}),n.offsetLeft+n.clientWidth>a.firstElementChild.scrollLeft+a.firstElementChild.clientWidth&&(a.firstElementChild.scrollLeft=n.offsetLeft+n.clientWidth-a.firstElementChild.clientWidth);const r=a.querySelectorAll("col");r[s].before(r[s+1]),Ht(t,a.getAttribute("data-node-id"),a.outerHTML,i),cn(a,e)},ki=(t,e,n)=>{var a,i;const s=A(n.startContainer,"TD")||A(n.startContainer,"TH"),r=oe(n.startContainer);if(!s||!r)return!1;if(e.key==="Backspace"&&n.toString()===""){const k=zt(n.startContainer);if(n.startOffset===1&&k.nodeType===1&&k.tagName==="BR"&&n.startContainer.textContent.length===1&&!_t(n.startContainer))return k.insertAdjacentHTML("beforebegin","<br>"),!1}if(e.key==="Enter"&&e.shiftKey&&ct(e)&&!e.altKey){const k=document.createElement("wbr");n.insertNode(k);const w=r.outerHTML;if(k.remove(),s&&!s.innerHTML.endsWith("<br>")&&s.insertAdjacentHTML("beforeend","<br>"),n.extractContents(),t.toolbar.getCurrentType(n).includes("code")&&n.startContainer.nodeType!==3){const B=document.createElement("br");n.startContainer.after(B),n.setStartAfter(B)}else n.insertNode(document.createElement("br"));return n.collapse(!1),kn(t),Ht(t,r.getAttribute("data-node-id"),r.outerHTML,w),e.preventDefault(),!0}if(!r.classList.contains("protyle-wysiwyg--select")&&!N(r,"protyle-wysiwyg--select")){if(ct(e)&&!e.shiftKey&&!e.altKey&&e.key==="Enter"){e.preventDefault();const k=s.parentElement;if(!k.nextElementSibling&&k.parentElement.tagName==="TBODY"||k.parentElement.tagName==="THEAD"&&!k.parentElement.nextElementSibling)return Ms(t,"afterend",r.getAttribute("data-node-id")),!0;let w=k.nextElementSibling;return w||(w=k.parentElement.nextElementSibling.firstChild),w&&(n.selectNodeContents(w.cells[cs(s)]),n.collapse(!0),kn(t)),!0}if(e.key==="ArrowRight"&&n.toString()===""&&!r.nextElementSibling&&s===r.querySelector("table").lastElementChild.lastElementChild.lastElementChild&&ya(s,t.wysiwyg.element,n).start===s.textContent.length)return e.preventDefault(),Ms(t,"afterend",r.getAttribute("data-node-id")),!0;if(e.key==="Tab"&&ct(e)){if(e.shiftKey)return Ty(s,n),e.preventDefault(),!0;let k=s.nextElementSibling;return k||(s.parentElement.nextElementSibling?k=s.parentElement.nextElementSibling.firstElementChild:s.parentElement.parentElement.tagName==="THEAD"&&s.parentElement.parentElement.nextElementSibling?k=s.parentElement.parentElement.nextElementSibling.firstElementChild.firstElementChild:k=null),k?n.selectNodeContents(k):be(t,n,s.parentElement.firstElementChild,r),e.preventDefault(),!0}if(e.key==="ArrowUp"&&ct(e)&&!e.shiftKey&&!e.altKey){const k=n.startContainer;let w;for(k.nodeType!==3&&(k.tagName==="TH"||k.tagName==="TD")?w=k.childNodes[Math.min(n.startOffset,k.childNodes.length-1)]:k.parentElement.tagName==="SPAN"?w=k.parentElement.previousElementSibling:w=k.previousElementSibling;w;){if(w.tagName==="BR"&&zt(w))return!1;w=w.previousElementSibling}const S=s.parentElement;let B=S.previousElementSibling;return B||(B=S.parentElement.previousElementSibling.lastElementChild),!B||(B==null?void 0:B.tagName)==="COL"?!1:(n.selectNodeContents(B.cells[cs(s)]),n.collapse(!1),kn(t),e.preventDefault(),!0)}if(e.key==="ArrowDown"&&ct(e)&&!e.shiftKey&&!e.altKey){const k=n.endContainer;let w;for(k.nodeType!==3&&(k.tagName==="TH"||k.tagName==="TD")?w=(a=k.childNodes[Math.max(0,n.endOffset-1)])==null?void 0:a.nextElementSibling:k.parentElement.tagName==="SPAN"?w=k.parentElement.nextElementSibling:w=k.nextElementSibling;w;){if(w.tagName==="BR"&&w.nextSibling)return!1;w=w.nextElementSibling}const S=s.parentElement;if(!S.nextElementSibling&&S.parentElement.tagName==="TBODY"||S.parentElement.tagName==="THEAD"&&!S.parentElement.nextElementSibling)return!1;let B=S.nextElementSibling;return B||(B=S.parentElement.nextElementSibling.firstChild),B?(n.selectNodeContents(B.cells[cs(s)]),n.collapse(!0),kn(t),e.preventDefault(),!0):!1}if(ct(e)&&!e.shiftKey&&!e.altKey&&e.key==="Backspace"&&ya(s,t.wysiwyg.element,n).start===0&&n.toString()===""&&(n.startOffset===0||n.startOffset===1&&s.querySelectorAll("br").length===1))return!Ty(s,n,!1)&&r.previousElementSibling&&qt(r.previousElementSibling,void 0,!1),kn(t),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.editor.general.alignLeft.custom,e))return se(t,[s],r,"left",n),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.editor.general.alignCenter.custom,e))return se(t,[s],r,"center",n),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.editor.general.alignRight.custom,e))return se(t,[s],r,"right",n),e.preventDefault(),!0}const o=r.querySelector("table"),l=s.parentElement.querySelector(".fn__none");let c=!1,d=!1;Array.from(s.parentElement.children).forEach(k=>{k.colSpan>1&&(c=!0),k.rowSpan>1&&(d=!0)});let u=!1,g=!1,f=!1,h=s.parentElement.previousElementSibling;!h&&s.parentElement.parentElement.tagName==="TBODY"&&(h=o.querySelector("thead").lastElementChild),h&&(u=h.querySelector(".fn__none"),Array.from(h.children).forEach(k=>{k.colSpan>1&&(g=!0),k.rowSpan>1&&(f=!0)}));let m=!1,b=!1,y=!1,_=s.parentElement.nextElementSibling;!_&&s.parentElement.parentElement.tagName==="THEAD"&&(_=(i=o.querySelector("tbody"))==null?void 0:i.firstElementChild),_&&(m=_.querySelector(".fn__none"),Array.from(_.children).forEach(k=>{k.colSpan>1&&(b=!0),k.rowSpan>1&&(y=!0)}));const v=cs(s);let U=!0;Array.from(o.rows).find(k=>{const w=k.cells[v];if(w.classList.contains("fn__none")||w.colSpan>1||w.rowSpan>1)return U=!1,!0});let ee=!0;Array.from(o.rows).find(k=>{const w=k.cells[v+1];if(w&&(w.classList.contains("fn__none")||w.colSpan>1||w.rowSpan>1))return ee=!1,!0});let Z=!0;if(Array.from(o.rows).find(k=>{const w=k.cells[v-1];if(w&&(w.classList.contains("fn__none")||w.colSpan>1||w.rowSpan>1))return Z=!1,!0}),Qe(window.siyuan.config.keymap.editor.table.moveToUp.custom,e))return(!l||l&&!d&&c)&&(!u||u&&!f&&g)&&Nt(t,n,s,r),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.editor.table.moveToDown.custom,e))return(!l||l&&!d&&c)&&(!m||m&&!y&&b)&&tn(t,n,s,r),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.editor.table.moveToLeft.custom,e))return U&&Z&&Un(t,n,s,r),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.editor.table.moveToRight.custom,e))return U&&ee&&Fn(t,n,s,r),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.editor.table.insertRowAbove.custom,e))return Ue(t,n,s,r),e.preventDefault(),e.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.table.insertRowBelow.custom,e))return(!m||m&&!y&&b)&&be(t,n,s,r),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.editor.table.insertColumnLeft.custom,e))return(U||Z)&&Ke(t,r,s,"beforebegin",n),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.editor.table.insertColumnRight.custom,e))return(U||ee)&&Ke(t,r,s,"afterend",n),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.editor.table["delete-row"].custom,e))return(!l&&!d||l&&!d&&c)&&dt(t,n,s,r),e.preventDefault(),e.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.table["delete-column"].custom,e))return U&&rt(t,n,r,s),e.preventDefault(),!0},Ra=t=>t.item.offsetLeft+6>t.tableSelectElement.offsetLeft+t.scrollLeft&&t.item.offsetLeft+t.item.clientWidth-6<t.tableSelectElement.offsetLeft+t.scrollLeft+t.tableSelectElement.clientWidth&&t.item.offsetTop+6>t.tableSelectElement.offsetTop+t.scrollTop&&t.item.offsetTop+t.item.clientHeight-6<t.tableSelectElement.offsetTop+t.scrollTop+t.tableSelectElement.clientHeight,Eh=(t,e)=>{var n;if(!e)return;const a=e.querySelector(".table__select"),i=[],s=e.firstElementChild.scrollLeft,r=e.querySelector("table").scrollTop;if(e.querySelectorAll("th, td").forEach(l=>{!l.classList.contains("fn__none")&&Ra({tableSelectElement:a,scrollLeft:s,scrollTop:r,item:l})&&i.push(l)}),a.removeAttribute("style"),getSelection().rangeCount>0){const l=getSelection().getRangeAt(0);e.contains(l.startContainer)&&l.insertNode(document.createElement("wbr"))}const o=e.outerHTML;(n=e.querySelector("wbr"))==null||n.remove(),e.setAttribute("updated",at().format("YYYYMMDDHHmmss")),i.forEach(l=>{l.innerHTML=""}),Ht(t,e.getAttribute("data-node-id"),e.outerHTML,o)},es=(t,e=0,n=1e3)=>{t.scroll.lastScrollTop=-1,setTimeout(()=>{t.scroll.lastScrollTop=e},n)};var Dy=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const L5=(t,e)=>{const n=[],a=/file:\/\/([^\s\n\r]+)/g;let i;for(;(i=a.exec(t))!==null;)try{let s=decodeURIComponent(i[1]);s=s.trim(),s&&n.push(s)}catch(s){}if(n.length===0&&e)for(a.lastIndex=0;(i=a.exec(e))!==null;)try{let s=decodeURIComponent(i[1]);s=s.trim(),s&&n.push(s)}catch(s){}if(n.length===0&&t){const s=t.split(`
`).map(o=>o.trim()).filter(o=>o);if(s.length>0&&s.every(o=>{const l=/^[A-Za-z]:[\\\/]/.test(o),c=/^\\\\[^\\]+\\/.test(o),d=/^\/[^\/\s]/.test(o)&&!o.includes("://");return l||c||d}))for(const o of s)n.push(o)}return n},p2=t=>{const e=t.dataset.type;let n="";if(["NodeHeading","NodeParagraph"].includes(e))n=Ee(t).innerHTML;else if(e==="NodeHTMLBlock")n="HTML";else if(e==="NodeAttributeView")n=t.querySelector(".av__title").textContent||window.siyuan.languages.database;else if(e==="NodeThematicBreak")n=window.siyuan.languages.line;else if(e==="NodeIFrame")n="IFrame";else if(e==="NodeWidget")n=window.siyuan.languages.widget;else if(e==="NodeVideo")n=window.siyuan.languages.video;else if(e==="NodeAudio")n=window.siyuan.languages.audio;else if(["NodeCodeBlock","NodeTable"].includes(e))n=kh(t);else if(t.classList.contains("render-node"))n+=t.dataset.subtype||Lute.UnEscapeHTMLStr(t.getAttribute("data-content"));else if(["NodeBlockquote","NodeList","NodeSuperBlock","NodeListItem"].includes(e)&&(Array.from(t.querySelectorAll("[data-node-id]")).find(a=>{if(!["NodeBlockquote","NodeList","NodeSuperBlock","NodeListItem"].includes(a.getAttribute("data-type")))return n=p2(t.querySelector("[data-node-id]")),!0}),n))return n;return n+` <span data-type="block-ref" data-subtype="s" data-id="${t.getAttribute("data-node-id")}">*</span>`},kh=(t,e=!1)=>{let n="";const a=t.dataset.type;return a==="NodeHTMLBlock"?n+=Lute.UnEscapeHTMLStr(t.querySelector("protyle-html").getAttribute("data-content")):a==="NodeAttributeView"?(t.querySelectorAll(".av__row").forEach(i=>{i.querySelectorAll(".av__cell").forEach(s=>{n+=Rd(s)+" "}),n+=`
`}),n=n.trimEnd()):a==="NodeThematicBreak"?n+="---":a==="NodeIFrame"||a==="NodeWidget"?n+=t.querySelector("iframe").getAttribute("src"):a==="NodeVideo"?n+=t.querySelector("video").getAttribute("src"):a==="NodeAudio"?n+=t.querySelector("audio").getAttribute("src"):t.classList.contains("render-node")?n+=Lute.UnEscapeHTMLStr(t.getAttribute("data-content")):["NodeHeading","NodeParagraph","NodeCodeBlock"].includes(a)?n+=t.querySelector("[spellcheck]").textContent:a==="NodeTable"?(t.querySelectorAll("th, td").forEach(i=>{n+=i.textContent.trim()+"	",i.nextElementSibling||(n=n.slice(0,-1)+`
`)}),n=n.slice(0,-1)):!e&&["NodeBlockquote","NodeList","NodeSuperBlock","NodeListItem"].includes(a)&&t.querySelectorAll("[data-node-id]").forEach(i=>{const s=kh(i,!0);n+=s?s+`
`:""}),n},h2=(t,e)=>Dy(void 0,null,function*(){try{let n=(yield yt())||"";n=n.replace(/<span data-type="text".*?>(.*?)<\/span>/g,"$1"),n=n.replace(/\\/g,"\\\\").replace(/\*/g,"\\*").replace(/_/g,"\\_").replace(/\[/g,"\\[").replace(/]/g,"\\]").replace(/!/g,"\\!").replace(/`/g,"\\`").replace(/</g,"\\<").replace(/>/g,"\\>").replace(/&/g,"\\&").replace(/~/g,"\\~").replace(/\{/g,"\\{").replace(/}/g,"\\}").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/=/g,"\\=").replace(/#/g,"\\#").replace(/\$/g,"\\$").replace(/\^/g,"\\^").replace(/\|/g,"\\|").replace(/\./g,"\\."),_f(t,{textPlain:n,textHTML:"",target:e})}catch(n){console.log(n)}}),gv=t=>Dy(void 0,null,function*(){if([].length===0){let n=(yield yt())||"";if(getSelection().rangeCount>0){const i=getSelection().getRangeAt(0);if(ue(i.startContainer,"data-type","code")||N(i.startContainer,"hljs")){Aa(n.replace(/\u200D```/g,"```").replace(/```/g,"\u200D```"),t);return}}n=n.replace(/<sub>/g,"__@sub@__").replace(/<\/sub>/g,"__@/sub@__"),n=n.replace(/<sup>/g,"__@sup@__").replace(/<\/sup>/g,"__@/sup@__"),n=n.replace(/<kbd>/g,"__@kbd@__").replace(/<\/kbd>/g,"__@/kbd@__"),n=n.replace(/<u>/g,"__@u@__").replace(/<\/u>/g,"__@/u@__"),n=n.replace(/<span data-type="text".*?>(.*?)<\/span>/g,"$1"),n=n.replace(/</g,";;;lt;;;").replace(/>/g,";;;gt;;;"),n=n.replace(/__@sub@__/g,"<sub>").replace(/__@\/sub@__/g,"</sub>"),n=n.replace(/__@sup@__/g,"<sup>").replace(/__@\/sup@__/g,"</sup>"),n=n.replace(/__@kbd@__/g,"<kbd>").replace(/__@\/kbd@__/g,"</kbd>"),n=n.replace(/__@u@__/g,"<u>").replace(/__@\/u@__/g,"</u>"),Sh(t);const a=t.lute.BlockDOM2EscapeMarkerContent(t.lute.Md2BlockDOM(n));yf(t),Aa(a,t,!1,!1,!0)}}),Sh=t=>{t.lute.SetInlineAsterisk(!0),t.lute.SetGFMStrikethrough(!0),t.lute.SetInlineMath(!0),t.lute.SetSub(!0),t.lute.SetSup(!0),t.lute.SetTag(!0),t.lute.SetInlineUnderscore(!0)},yf=t=>{t.lute.SetInlineAsterisk(window.siyuan.config.editor.markdown.inlineAsterisk),t.lute.SetGFMStrikethrough(window.siyuan.config.editor.markdown.inlineStrikethrough),t.lute.SetInlineMath(window.siyuan.config.editor.markdown.inlineMath),t.lute.SetSub(window.siyuan.config.editor.markdown.inlineSub),t.lute.SetSup(window.siyuan.config.editor.markdown.inlineSup),t.lute.SetTag(window.siyuan.config.editor.markdown.inlineTag),t.lute.SetInlineUnderscore(window.siyuan.config.editor.markdown.inlineUnderscore),t.lute.SetMark(window.siyuan.config.editor.markdown.inlineMark)},g2=(t,e)=>Dy(void 0,null,function*(){if(t&&t.app&&t.app.plugins)for(let n=0;n<t.app.plugins.length;n++){const a=yield new Promise(i=>{t.app.plugins[n].eventBus.emit("paste",{protyle:t,resolve:i,textHTML:"",textPlain:"",siyuanHTML:"",files:e})&&i(void 0)});a!=null&&a.files&&(e=a.files)}Qv(e,t,!0)}),_f=(t,e)=>Dy(void 0,null,function*(){var n;("clipboardData"in e||"dataTransfer"in e)&&(e.stopPropagation(),e.preventDefault());let a,i,s,r;if("clipboardData"in e)a=e.clipboardData.getData("text/html"),i=e.clipboardData.getData("text/plain"),s=e.clipboardData.getData("text/siyuan"),r=e.clipboardData.files;else if("dataTransfer"in e)a=e.dataTransfer.getData("text/html"),i=e.dataTransfer.getData("text/plain"),s=e.dataTransfer.getData("text/siyuan"),e.dataTransfer.types[0]==="Files"&&(r=e.dataTransfer.items);else{if(((n=e.localFiles)==null?void 0:n.length)>0){g2(t,e.localFiles);return}a=e.textHTML,i=e.textPlain,s=e.siyuanHTML,r=e.files}i=i.replace(/\r\n|\r|\u2028|\u2029/g,`
`);const o=L5(i,a);if(o.length>0&&!s){g2(t,o);return}if((a.replace(/&amp;/g,"&").replace(/<(|\/)(html|body|meta)[^>]*?>/ig,"").trim()===`<a href="${i}">${i}</a>`||a.replace(/&amp;/g,"&").replace(/<(|\/)(html|body|meta)[^>]*?>/ig,"").trim()===`<!--StartFragment--><a href="${i}">${i}</a><!--EndFragment-->`)&&(a=""),i.endsWith(p.ZWSP)&&!a&&!s&&(s=i.substr(0,i.length-1)),a&&i&&!s){const g=_e(a);s=g.textSiyuan,a=g.textHtml}if(!s){const g=new DOMParser().parseFromString(a,"text/html");g.body&&g.body.innerHTML&&(a=g.body.innerHTML),a.startsWith(`
<!--StartFragment-->`)&&a.endsWith(`<!--EndFragment-->

`)&&(a=g.body.innerHTML.trim().replace("<!--StartFragment-->","").replace("<!--EndFragment-->","")),a=Lute.Sanitize(a)}if(t&&t.app&&t.app.plugins)for(let g=0;g<t.app.plugins.length;g++){const f=yield new Promise(h=>{t.app.plugins[g].eventBus.emit("paste",{protyle:t,resolve:h,textHTML:a,textPlain:i,siyuanHTML:s,files:r})&&h(void 0)});f!=null&&f.textHTML&&(a=f.textHTML),f!=null&&f.textPlain&&(i=f.textPlain),f!=null&&f.siyuanHTML&&(s=f.siyuanHTML),f!=null&&f.files&&(r=f.files)}const l=oe(e.target);if(!l){r&&r.length>0&&_l(t,r);return}t.hint.enableExtend=p.BLOCK_HINT_KEYS.includes(t.hint.splitChar),Ut(t.hint.enableExtend?["select"]:["select","hint"],t),t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--hl").forEach(g=>{g.classList.remove("protyle-wysiwyg--hl")});const c=yy(a,i,t),d=hn(t.wysiwyg.element);if(l.getAttribute("data-type")==="NodeCodeBlock"||t.toolbar.getCurrentType(d).includes("code")){Aa(i.replace(/\u200D```/g,"```").replace(/```/g,"\u200D```"),t);return}else if(s){const g=document.createElement("div");if(g.innerHTML=s,d.toString()){let m=[],b;if(g.childNodes.length===1&&g.childElementCount===1&&(m=(g.firstElementChild.getAttribute("data-type")||"").split(" "),(m.includes("block-ref")||m.includes("a"))&&(b=g.firstElementChild)),!b){const y=document.createElement("template");y.innerHTML=t.lute.SpinBlockDOM(s),y.content.firstChild.nodeType!==3&&y.content.firstElementChild.classList.contains("p")&&(y.innerHTML=y.content.firstElementChild.firstElementChild.innerHTML.trim()),y.content.childNodes.length===1&&y.content.childElementCount===1&&(m=(y.content.firstElementChild.getAttribute("data-type")||"").split(" "),(m.includes("block-ref")||m.includes("a"))&&(b=y.content.firstElementChild))}if(m.includes("block-ref")){const y=t.toolbar.setInlineMark(t,"block-ref","range",{type:"id",color:`${b.dataset.id}${p.ZWSP}s${p.ZWSP}${d.toString()}`});y[0]&&t.toolbar.range.selectNodeContents(y[0]);return}if(m.includes("a")){t.toolbar.setInlineMark(t,"a","range",{type:"a",color:`${b.dataset.href}${p.ZWSP}${d.toString()}`});return}}let f=!1;g.querySelectorAll("[data-node-id]").forEach(m=>{const b=Lute.NewNodeID();m.setAttribute("data-node-id",b),m.removeAttribute(p.CUSTOM_RIFF_DECKS),m.classList.remove("protyle-wysiwyg--select","protyle-wysiwyg--hl"),m.setAttribute("updated",b.split("-")[0]),m.removeAttribute("refcount"),f=!0}),l.classList.contains("table")&&(f=!1),g.querySelectorAll('[contenteditable="false"][spellcheck]').forEach(m=>{m.setAttribute("contenteditable","true")});let h=g.innerHTML;if(!l.classList.contains("av")&&h.startsWith("[[{")&&h.endsWith("}]]"))try{const m=JSON.parse(h);m.length>0&&m[0].length>0&&m[0][0].id&&m[0][0].type?Aa(i,t,f):Aa(h,t,f)}catch(m){Aa(h,t,f)}else-1<h.indexOf("NodeHTMLBlock")&&(h=Lute.UnEscapeHTMLStr(h)),h=h.replace(/\u200D```/g,"```"),Aa(h,t,f,!1,!0);$n(t,t.wysiwyg.element),zn(t.wysiwyg.element),ra(t.wysiwyg.element),Ua(t.wysiwyg.element,t)}else if(c)c.startsWith('<div data-type="NodeCodeBlock" class="code-block" data-node-id="')?(Aa(c,t,!0,!1,!0),ra(t.wysiwyg.element)):Aa(c,t),Ut(["hint"],t);else{let g=!1;if(a.replace("<!--StartFragment--><!--EndFragment-->","").trim()!==""){a=a.replace("<!--StartFragment-->","").replace("<!--EndFragment-->","").trim(),r&&r.length===1&&(a.startsWith("<img")||a.startsWith("<table")&&a.indexOf("<img")>-1)?g=!1:g=!0;let f=!1;const h=document.createElement("div");h.innerHTML=a;const m=document.createTreeWalker(h,NodeFilter.SHOW_TEXT,null);let b=null;for(;b=m.nextNode();)if(b.nodeValue&&(b.nodeValue.match(/\n/g)||[]).length>=2){f=!0;break}const y=a.toLowerCase();i&&i.trim()!==""&&(a.startsWith("<span")||a.startsWith("<br"))&&f&&0>y.indexOf('class="katex')&&0>y.indexOf('class="math')&&0>y.indexOf("</a>")&&0>y.indexOf("</img>")&&0>y.indexOf("</code>")&&0>y.indexOf("</b>")&&0>y.indexOf("</strong>")&&0>y.indexOf("</i>")&&0>y.indexOf("</em>")&&0>y.indexOf("</ol>")&&0>y.indexOf("</ul>")&&0>y.indexOf("</table>")&&0>y.indexOf("</blockquote>")&&0>y.indexOf("</h1>")&&0>y.indexOf("</h2>")&&0>y.indexOf("</h3>")&&0>y.indexOf("</h4>")&&0>y.indexOf("</h5>")&&0>y.indexOf("</h6>")&&(g=!1)}if(g){const f=document.createElement("div");f.innerHTML=a,f.querySelectorAll("a").forEach(m=>{m.innerHTML.trim()===""&&m.remove()});let h;if(f.childElementCount===1&&f.childNodes.length===1&&(f.firstElementChild.tagName==="A"?h=f.firstElementChild:f.firstElementChild.tagName==="P"&&f.firstElementChild.childElementCount===1&&f.firstElementChild.childNodes.length===1&&f.firstElementChild.firstElementChild.tagName==="A"&&(h=f.firstElementChild.firstElementChild)),h){const m=d.toString(),b=t.toolbar.setInlineMark(t,"a","range",{type:"a",color:`${h.getAttribute("href")}${p.ZWSP}${m||h.textContent}`});m||(b[0].lastChild&&d.setEnd(b[0].lastChild,b[0].lastChild.textContent.length),d.collapse(!1));return}ae("/api/lute/html2BlockDOM",{dom:f.innerHTML},m=>{Aa(m.data,t,!1,!1,!0),t.wysiwyg.element.querySelectorAll('[data-type~="block-ref"]').forEach(b=>{b.textContent===""&&ae("/api/block/getRefText",{id:b.getAttribute("data-id")},y=>{b.innerHTML=y.data})}),$n(t,t.wysiwyg.element),zn(t.wysiwyg.element),ra(t.wysiwyg.element),Ua(t.wysiwyg.element,t),kn(t,void 0,"nearest","smooth")});return}else if(r&&r.length>0){_l(t,r);return}else if(i.trim()!==""&&(r&&r.length===0||!r)){if(d.toString()!==""){const h=i.split(`
`)[0];if(D(i)){const m=t.toolbar.setInlineMark(t,"block-ref","range",{type:"id",color:`${i.substring(2,24)}${p.ZWSP}s${p.ZWSP}${d.toString()}`});m[0]&&t.toolbar.range.selectNodeContents(m[0]);return}else if(q(h)){t.toolbar.setInlineMark(t,"file-annotation-ref","range",{type:"file-annotation-ref",color:h.substring(2).replace(/ ".+">>$/,"")});return}else{const m=i.startsWith("assets/")?i:t.lute.GetLinkDest(i);if(m){t.toolbar.setInlineMark(t,"a","range",{type:"a",color:m});return}}}i=i.replace(/\u200D```/g,"```");const f=t.lute.Md2BlockDOM(i);Aa(f,t,!1,!1,!0)}$n(t,t.wysiwyg.element),zn(t.wysiwyg.element),ra(t.wysiwyg.element),Ua(t.wysiwyg.element,t)}const u=l.querySelector(".av__cell--select");l.classList.contains("av")&&u?vl(l,u):kn(t,void 0,"nearest","smooth")}),Ah=(t,e,n,a)=>{!Gs()||(!e||e.length===0)&&!n||setTimeout(()=>{t.highlight.markHL.clear(),t.highlight.mark.clear(),t.highlight.rangeIndex=0,t.highlight.ranges=[];let i=!1,s;typeof n=="string"&&Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id='${n}']`)).find(f=>{if(!ge(f))return s=f,!0}),!s&&n===t.block.rootID&&t.title&&!t.title.element.classList.contains("fn__none")&&(s=t.title.element);const r=[],o=[];let l=0;const c=document.createTreeWalker(t.contentElement,NodeFilter.SHOW_TEXT);let d=c.nextNode();for(;d;)r.push(d),l+=d.textContent.length,o.push(l),d=c.nextNode();const u=t.contentElement.textContent,g=[];if(e&&e.length>0&&e.forEach(f=>{if(!f)return;let h=0,m=0,b=0;for(;(h=u.indexOf(f,h))!==-1;){const y=new Range;m=h+f.length;try{for(;b<r.length&&o[b]<=h;)b++;let _=r[b];for(y.setStart(_,h-(b?o[b-1]:0));b<r.length&&o[b]<m;)b++;_=r[b],y.setEnd(_,m-(b?o[b-1]:0));let v=!1;!i&&s&&s.contains(_)&&(i=!0,v=!0),g.push({range:y,startIndex:h,isCurrent:v})}catch(_){console.error("searchMarkRender error:",_)}h=m}}),!i&&s){const f=u.indexOf(s.textContent);if(f>-1){const h=new Range;let m=0;for(;r.length&&o[m]<=f;)m++;h.setStart(r[m],0),g.push({range:h,startIndex:f,isCurrent:!0})}}g.sort((f,h)=>h.startIndex>f.startIndex?-1:0).forEach((f,h)=>{typeof n=="string"&&f.isCurrent||typeof n=="number"&&n===h?(t.highlight.rangeIndex=h,t.highlight.markHL.add(f.range)):t.highlight.mark.add(f.range),t.highlight.ranges.push(f.range)}),CSS.highlights.set("search-mark-"+t.highlight.styleElement.dataset.uuid,t.highlight.mark),typeof n!="undefined"&&CSS.highlights.set("search-mark-hl-"+t.highlight.styleElement.dataset.uuid,t.highlight.markHL),a&&a()},t.wysiwyg.element.querySelector(".hljs")?p.TIMEOUT_TRANSITION:0)},Gs=()=>!!(CSS&&CSS.highlights),Th=(t,e=!1)=>{if(!t.wysiwyg.element.firstElementChild||window.siyuan.config.readonly)return;const n={rootId:t.block.rootID,startId:t.wysiwyg.element.firstElementChild.getAttribute("data-node-id"),endId:t.wysiwyg.element.lastElementChild.getAttribute("data-node-id"),scrollTop:t.contentElement.scrollTop||parseInt(t.contentElement.getAttribute("data-scrolltop"))||0};let a;if(getSelection().rangeCount>0&&(a=getSelection().getRangeAt(0)),(!a||!t.wysiwyg.element.contains(a.startContainer))&&(a=t.toolbar.range),a&&t.wysiwyg.element.contains(a.startContainer)){const i=oe(a.startContainer);if(i){const s=ya(i,void 0,a);n.focusId=i.getAttribute("data-node-id"),n.focusStart=s.start,n.focusEnd=s.end}}return t.block.showAll&&(n.zoomInId=t.block.id),e?n:(window.siyuan.storage[p.LOCAL_FILEPOSITION][t.block.rootID]=n,new Promise(i=>{Gt(p.LOCAL_FILEPOSITION,window.siyuan.storage[p.LOCAL_FILEPOSITION],()=>{i(!0)})}))},mv=t=>{var e,n,a,i,s,r,o,l,c,d,u,g,f,h;let m=[];if(t.mergedOptions?m=t.mergedOptions.action:t.focus?m=[p.CB_GET_UNUNDO,p.CB_GET_FOCUS]:m=[p.CB_GET_UNUNDO],(e=t.scrollAttr)!=null&&e.zoomInId&&((n=t.scrollAttr)!=null&&n.rootId)&&t.scrollAttr.zoomInId!==t.scrollAttr.rootId){ae("/api/filetree/getDoc",{id:t.scrollAttr.zoomInId,size:p.SIZE_GET_MAX,query:(a=t.protyle.query)==null?void 0:a.key,queryMethod:(i=t.protyle.query)==null?void 0:i.method,queryTypes:(s=t.protyle.query)==null?void 0:s.types,highlight:!Gs()},b=>{var y,_,v,U,ee;b.code===1?ae("/api/filetree/getDoc",{id:t.scrollAttr.rootId||((y=t.mergedOptions)==null?void 0:y.blockId)||((_=t.protyle.block)==null?void 0:_.rootID)||t.scrollAttr.startId,query:(v=t.protyle.query)==null?void 0:v.key,queryMethod:(U=t.protyle.query)==null?void 0:U.method,queryTypes:(ee=t.protyle.query)==null?void 0:ee.types,highlight:!Gs()},Z=>{_a({data:Z,protyle:t.protyle,action:m,scrollAttr:t.scrollAttr,afterCB:t.cb?()=>{t.cb(Z.data.keywords)}:void 0,updateReadonly:t.updateReadonly})}):(m.push(p.CB_GET_ALL),_a({data:b,protyle:t.protyle,action:m,scrollAttr:t.scrollAttr,afterCB:t.cb?()=>{t.cb(b.data.keywords)}:void 0,updateReadonly:t.updateReadonly}))});return}ae("/api/filetree/getDoc",{id:((r=t.scrollAttr)==null?void 0:r.rootId)||((o=t.mergedOptions)==null?void 0:o.blockId)||((l=t.protyle.block)==null?void 0:l.rootID)||((c=t.scrollAttr)==null?void 0:c.startId),startID:(d=t.scrollAttr)==null?void 0:d.startId,endID:(u=t.scrollAttr)==null?void 0:u.endId,query:(g=t.protyle.query)==null?void 0:g.key,queryMethod:(f=t.protyle.query)==null?void 0:f.method,queryTypes:(h=t.protyle.query)==null?void 0:h.types,highlight:!Gs()},b=>{_a({data:b,protyle:t.protyle,action:m,scrollAttr:t.scrollAttr,afterCB:t.cb?()=>{t.cb(b.data.keywords)}:void 0,updateReadonly:t.updateReadonly})})},$o=(t,e,n)=>{if(!t.preview.element.classList.contains("fn__none")){t.preview.render(t),tg(t);return}if(window.siyuan.config.editor.displayBookmarkIcon?t.wysiwyg.element.classList.add("protyle-wysiwyg--attr"):t.wysiwyg.element.classList.remove("protyle-wysiwyg--attr"),t.title&&(t.title.element.removeAttribute("data-render"),t.title.element.setAttribute("spellcheck",window.siyuan.config.editor.spellcheck.toString()),window.siyuan.config.editor.displayBookmarkIcon?t.title.element.classList.add("protyle-wysiwyg--attr"):t.title.element.classList.remove("protyle-wysiwyg--attr")),t.lute.SetProtyleMarkNetImg(window.siyuan.config.editor.displayNetImgMark),t.lute.SetSpellcheck(window.siyuan.config.editor.spellcheck),yf(t),t.lute.SetGFMStrikethrough1(!1),Ud(t),t.options.backlinkData){const a=t.element.getAttribute("data-ismention")==="true",i=N(t.element,"sy__backlink");if(i){const s=i.querySelectorAll(".b3-text-field"),r=a?s[1].value:s[0].value;ae(a?"/api/ref/getBackmentionDoc":"/api/ref/getBacklinkDoc",{defID:t.element.getAttribute("data-defid"),refTreeID:t.block.rootID,highlight:!Gs(),keyword:r},o=>{t.options.backlinkData=a?o.data.backmentions:o.data.backlinks,fA(t,t.options.backlinkData),Ah(t,o.data.keywords)})}}else es(t),mv({protyle:t,focus:e,scrollAttr:Th(t,!0),updateReadonly:n,cb(a){var i;(i=t.query)!=null&&i.key&&Ah(t,a,t.highlight.rangeIndex)}})},m2=t=>{const e=document.getElementById("model");e.style.transform="translateY(0px)",e.style.zIndex=(++window.siyuan.zIndex).toString();const n=e.querySelector(".toolbar__icon");t.icon?(n.classList.remove("fn__none"),n.querySelector("use").setAttribute("xlink:href","#"+t.icon)):n.classList.add("fn__none"),e.querySelector(".toolbar__text").innerHTML=t.title;const a=e.querySelector("#modelMain");a.innerHTML=t.html,t.bindEvent(a)},Cy=(t,e)=>{let n=`<option value="">${window.siyuan.languages.currentNotebook}</option>`;const a=[];return Object.keys(p.HELP_PATH).forEach(i=>{a.push(p.HELP_PATH[i])}),window.siyuan.notebooks.forEach(i=>{a.includes(i.id)||i.id===e||(n+=`<option value="${i.id}" ${t===i.id?"selected":""}>${he(i.name)}</option>`)}),n},I5=t=>{const e=`<div class="fn__flex">${he(t.name)}
<div class="fn__space"></div>
<button class="b3-button b3-button--small fn__flex-center">${window.siyuan.languages.copy} ID</button></div>`,n=`<div class="b3-dialog__content" style="background-color: var(--b3-theme-background);">
<div class="b3-label config__item">
    ${window.siyuan.languages.fileTree12}
    <div class="b3-label__text">${window.siyuan.languages.fileTree13}</div>
    <span class="fn__hr"></span>
    <div class="fn__flex">
        <select style="min-width: 200px" class="b3-select" id="docCreateSaveBox">${Cy(t.conf.docCreateSaveBox,t.box)}</select>
        <div class="fn__space"></div>
        <input class="b3-text-field fn__flex-1" id="docCreateSavePath" value="">
    </div>
</div>
<div class="b3-label config__item">
    ${window.siyuan.languages.fileTree5}
    <div class="b3-label__text">${window.siyuan.languages.fileTree6}</div>
    <span class="fn__hr"></span>
    <div class="fn__flex">
        <select style="min-width: 200px" class="b3-select" id="refCreateSaveBox">${Cy(t.conf.refCreateSaveBox,t.box)}</select>
        <div class="fn__space"></div>
        <input class="b3-text-field fn__flex-1" id="refCreateSavePath" value="">
    </div>
</div>
<div class="b3-label">
    ${window.siyuan.languages.fileTree11}
    <div class="b3-label__text">${window.siyuan.languages.fileTree14}</div>
    <div class="fn__hr"></div>
    <input class="b3-text-field fn__flex-center fn__block" id="dailyNoteSavePath" value="">
    <div class="fn__hr"></div>
    <div class="b3-label__text">${window.siyuan.languages.fileTree15}</div>
    <div class="fn__hr"></div>
    <input class="b3-text-field fn__flex-center fn__block" id="dailyNoteTemplatePath" value="${t.conf.dailyNoteTemplatePath}">
</div></div>`;if(x())m2({title:e,icon:"iconSettings",html:`<div>${n}</div>`,bindEvent(){b2(document.querySelector("#model"),t)}});else{const a=new fe({width:"80vw",title:e,content:n});a.element.setAttribute("data-key",p.DIALOG_NOTEBOOKCONF),b2(a.element,t)}},b2=(t,e)=>{t.querySelector(".b3-button--small").addEventListener("click",()=>{ut(e.box),Q(window.siyuan.languages.copied)});const n=t.querySelector("#dailyNoteSavePath");n.value=e.conf.dailyNoteSavePath;const a=t.querySelector("#docCreateSavePath");a.value=e.conf.docCreateSavePath;const i=t.querySelector("#refCreateSavePath");i.value=e.conf.refCreateSavePath;const s=t.querySelector("#dailyNoteTemplatePath");s.value=e.conf.dailyNoteTemplatePath,t.querySelectorAll("input, select").forEach(r=>{r.addEventListener("change",()=>{ae("/api/notebook/setNotebookConf",{notebook:e.box,conf:{refCreateSavePath:i.value,refCreateSaveBox:t.querySelector("#refCreateSaveBox").value,docCreateSaveBox:t.querySelector("#docCreateSaveBox").value,docCreateSavePath:a.value,dailyNoteSavePath:n.value,dailyNoteTemplatePath:s.value}})})})};var M5=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const ds=t=>M5(void 0,null,function*(){const e=window.siyuan.storage[p.LOCAL_SEARCHDATA];let n="",a=[];if(t.notebookId){if(n=Ds(t.notebookId),a.push(t.notebookId),t.searchPath&&t.searchPath!=="/"){const l=yield wn("/api/filetree/getHPathByPath",{notebook:t.notebookId,path:t.searchPath.endsWith(".sy")?t.searchPath:t.searchPath+".sy"});n=_n().join(n,l.data),a[0]=_n().join(a[0],t.searchPath)}}else p.DIALOG_GLOBALSEARCH===t.hotkey&&(e.removed?(n="",a=[]):(n=e.hPath,a=[...e.idPath]));const i={removed:e.removed,k:t.key||e.k,r:e.r,hasReplace:t.hotkey===p.DIALOG_REPLACE,method:e.method,hPath:n,idPath:a,group:e.group,sort:e.sort,types:Object.assign({},e.types),replaceTypes:Object.assign({},e.replaceTypes),page:t.key?1:e.page};if(window.siyuan.dialogs.find(l=>{if(l.element.querySelector("#searchList")){const c=l.element.querySelector(".b3-dialog__body"),d=JSON.parse(JSON.stringify(l.data)),u=getSelection().rangeCount>0?getSelection().getRangeAt(0).toString():void 0;if(u&&(d.k=u),l.element.setAttribute("data-key",t.hotkey),t.hotkey===p.DIALOG_REPLACE)d.hasReplace=!0,Td(c,d,l.data,l.editors.edit);else if(t.hotkey===p.DIALOG_GLOBALSEARCH)d.hasReplace=!1,d.hPath="",d.idPath=[],Td(c,d,l.data,l.editors.edit);else if(t.hotkey===p.DIALOG_SEARCH){d.hasReplace=!1;const g=l.editors.edit.protyle.path;ae("/api/filetree/getHPathsByPaths",{paths:[g]},f=>{d.idPath=[_n().join(l.editors.edit.protyle.notebookId,g)],d.hPath=f.data[0],l.data.idPath=d.idPath,l.data.hPath=d.hPath,Td(c,d,l.data,l.editors.edit)})}return!0}}))return;let r;getSelection().rangeCount>0&&(r=getSelection().getRangeAt(0));const o=new fe({positionId:t.hotkey,content:"",width:"80vw",height:"90vh",destroyCallback(l){r&&!l&&Pt(r),o.editors.edit.destroy(),o.editors.unRefEdit.destroy()},resizeCallback(l){l!=="d"&&l!=="t"&&(o.element.querySelector("#searchUnRefPanel").classList.contains("fn__none")?o.editors.edit.resize():o.editors.unRefEdit.resize())}});o.element.setAttribute("data-key",t.hotkey),o.editors=X2(t.app,i,o.element.querySelector(".b3-dialog__body"),()=>{o.destroy({focus:"false"})}),o.data=i}),bv=t=>{var e,n,a;const i=(n=(e=Vn("file"))==null?void 0:e.data)==null?void 0:n.file;if(i instanceof js){const s=i.element.querySelector(`li[data-path="${t}"]`);if(s){((a=s.nextElementSibling)==null?void 0:a.tagName)==="UL"&&s.nextElementSibling.remove();const r=s.parentElement;if(r&&r.childElementCount===1){const o=r.previousElementSibling;if(o&&o.tagName==="LI"){const l=o.querySelector(".b3-list-item__toggle");l&&l.classList.add("fn__hidden");const c=o.querySelector(".b3-list-item__arrow");c&&c.classList.remove("b3-list-item__arrow--open")}r.remove()}else s.remove()}}},y2=(t,e)=>{if(window.siyuan.config.fileTree.removeDocWithoutConfirm){ae("/api/filetree/removeDoc",{notebook:t,path:e},()=>{bv(e)});return}ae("/api/block/getDocInfo",{id:ha(e,!0,!0)},n=>{const a=he(n.data.name);let i=`${window.siyuan.languages.confirmDeleteTip.replace("${x}",a)}
<div class="fn__hr"></div>
<div class="ft__smaller ft__on-surface">${window.siyuan.languages.rollbackTip.replace("${x}",window.siyuan.config.editor.historyRetentionDays)}</div>`;n.data.subFileCount>0&&(i=`${window.siyuan.languages.andSubFile.replace("${x}",a).replace("${y}",n.data.subFileCount)}
<div class="fn__hr"></div>
<div class="ft__smaller ft__on-surface">${window.siyuan.languages.rollbackTip.replace("${x}",window.siyuan.config.editor.historyRetentionDays)}</div>`),Sn(window.siyuan.languages.deleteOpConfirm,i,()=>{ae("/api/filetree/removeDoc",{notebook:t,path:e},()=>{bv(e)})},void 0,!0)})},Ly=t=>{if(t.length===1){const e=pe(t[0],"UL");if(e){const n=e.getAttribute("data-url");t[0].getAttribute("data-type")==="navigation-file"?y2(n,t[0].getAttribute("data-path")):Sn(window.siyuan.languages.deleteOpConfirm,`${window.siyuan.languages.confirmDeleteTip.replace("${x}",Lute.EscapeHTMLStr(Ds(n)))}
<div class="fn__hr"></div>
<div class="ft__smaller ft__on-surface">${window.siyuan.languages.rollbackTip.replace("${x}",window.siyuan.config.editor.historyRetentionDays)}</div>`,()=>{ae("/api/notebook/removeNotebook",{notebook:n,callback:p.CB_MOUNT_REMOVE},()=>{var a,i;const s=(i=(a=Vn("file"))==null?void 0:a.data)==null?void 0:i.file;if(s instanceof js){const r=s.element.querySelector(`ul[data-url="${n}"]`);r&&r.remove()}})},void 0,!0)}}else{const e=[];if(t.forEach(n=>{n.getAttribute("data-path")!=="/"&&e.push(n.getAttribute("data-path"))}),e.length===0){Q(window.siyuan.languages.notBatchRemove);return}Sn(window.siyuan.languages.deleteOpConfirm,`${window.siyuan.languages.confirmRemoveAll.replace("${count}",e.length)}
<div class="fn__hr"></div>
<div class="ft__smaller ft__on-surface">${window.siyuan.languages.rollbackTip.replace("${x}",window.siyuan.config.editor.historyRetentionDays)}</div>`,()=>{ae("/api/filetree/removeDocs",{paths:e},()=>{e.forEach(n=>bv(n))})},void 0,!0)}};var F5=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const Iy=(t,e)=>{t.element.querySelector(".wysiwygLoading")||(Ud(t),Ut(["toolbar"],t),ae(`/api/format/net${e}2LocalAssets`,{id:t.block.rootID},()=>{Es().forEach(n=>{n.protyle.block.rootID===t.block.rootID&&$o(n.protyle,n.protyle.element===t.element)})}))},kd=(t,e)=>{var n,a;setTimeout(()=>{rs(["gutter"])},p.TIMEOUT_TRANSITION);const i=t.className.includes("fullscreen");if(i?(t.classList.remove("fullscreen"),(n=document.getElementById("drag"))==null||n.classList.remove("fn__hidden")):(t.classList.add("fullscreen"),(a=document.getElementById("drag"))==null||a.classList.add("fn__hidden")),E()){const s=[];rp(window.siyuan.layout.layout,s),s.find(r=>F5(void 0,null,function*(){const o=r.headersElement.parentElement;if(o.getBoundingClientRect().top<=0)return o.querySelector(".item--readonly .fn__flex-1").style.WebkitAppRegion=i?"drag":"",!0}))}if(window.siyuan.config.system.os!=="darwin"&&!E()){const s=document.getElementById("windowControls");i?s.style.zIndex="":(window.siyuan.zIndex++,s.style.zIndex=window.siyuan.zIndex.toString())}if(e){i?e.querySelector("use").setAttribute("xlink:href","#iconFullscreen"):e.querySelector("use").setAttribute("xlink:href","#iconFullscreenExit");const s=N(t,"layout--float");s&&(i?(s.setAttribute("data-temp",s.style.transform),s.style.transform="none"):(s.style.transform=s.getAttribute("data-temp"),s.removeAttribute("data-temp")));return}t.classList.contains("protyle")&&(window.siyuan.editorIsFullscreen=!i),Cn().editor.forEach(s=>{t!==s.element&&(window.siyuan.editorIsFullscreen,s.element.classList.contains("fullscreen")&&(s.element.classList.remove("fullscreen"),Ai(s.editor.protyle)))})},_2=(t,e)=>{if(!window.siyuan.config.readonly){const n=t.querySelector("use").getAttribute("xlink:href")!=="#iconUnlock";window.siyuan.config.editor.readOnly?n?eg(e):br(e):ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{[p.CUSTOM_SY_READONLY]:n?"false":"true"}})}},P5=()=>{};var My=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const Fy=(t,e=0)=>{let n=0,a=0;return t.cards.forEach((i,s)=>{s>e||(i.state===0?n++:a++)}),`<span class="ariaLabel" aria-label="${window.siyuan.languages.flashcardNewCard}">
    <span class="ft__error">${n}</span> /
    <span class="ariaLabel ft__primary" aria-label="${window.siyuan.languages.flashcardNewCard}">${t.unreviewedNewCardCount}</span>
</span>
<span class="fn__space"></span>+<span class="fn__space"></span>
<span class="ariaLabel" aria-label="${window.siyuan.languages.flashcardReviewCard}">
    <span class="ft__error">${a}</span> /
    <span class="ft__success">${t.unreviewedOldCardCount}</span>
</span>`},Py=t=>{let e;return e=`<div class="block__icons">
        ${t.isTab?'<div class="fn__flex-1"></div>':`<div class="block__logo">
            <svg class="block__logoicon"><use xlink:href="#iconRiffCard"></use></svg>${window.siyuan.languages.riffCard}
        </div>`}
        <span class="fn__flex-1 resize__move" style="min-height: 100%"></span>
        <div data-type="count" class="ft__on-surface ft__smaller fn__flex-center${t.cardsData.cards.length===0?" fn__none":" fn__flex"}">${Fy(t.cardsData)}</span></div>
        <div class="fn__space"></div>
        <button data-id="${t.id||""}" data-cardtype="${t.cardType}" data-type="filter" class="block__icon block__icon--show">
            <svg><use xlink:href="#iconFilter"></use></svg>
        </button>
        <div class="fn__space"></div>
        <div data-type="fullscreen" class="b3-tooltips b3-tooltips__sw block__icon block__icon--show" aria-label="${window.siyuan.languages.fullscreen}">
            <svg><use xlink:href="#iconFullscreen"></use></svg>
        </div>
        <div class="fn__space${t.cardsData.cards.length===0?" fn__none":""}"></div>
        <div data-type="more" class="${t.cardsData.cards.length===0?"fn__none ":""}b3-tooltips b3-tooltips__sw block__icon block__icon--show" aria-label="${window.siyuan.languages.more}">
            <svg><use xlink:href="#iconMore"></use></svg>
        </div>
        <div class="fn__space${t.isTab?" fn__none":""}"></div>
        <div data-type="sticktab" class="b3-tooltips b3-tooltips__sw block__icon block__icon--show${t.isTab?" fn__none":""}" aria-label="${window.siyuan.languages.openBy}">
            <svg><use xlink:href="#iconOpen"></use></svg>
        </div>
    </div>`,`<div class="card__main">
    ${e}
    <div class="card__block fn__flex-1 ${t.cardsData.cards.length===0?"fn__none":""}" data-type="render"></div>
    <div class="card__empty card__empty--space${t.cardsData.cards.length===0?"":" fn__none"}" data-type="empty">
        <div>\u{1F52E}</div>
        ${window.siyuan.languages.noDueCard}
    </div>
    <div class="fn__flex card__action fn__none">
        <button class="b3-button b3-button--cancel" disabled="disabled" data-type="-2" style="width: 25%;min-width: 86px;display: flex">
            <svg><use xlink:href="#iconLeft"></use></svg>
            ${x()?"":"(p / q)"}
        </button>
        <span class="fn__space"></span>
        <button data-type="-1" class="b3-button fn__flex-1">${window.siyuan.languages.cardShowAnswer}${x()?"":" ("+window.siyuan.languages.space+" / "+window.siyuan.languages.enterKey+")"}</button>
    </div>
    <div class="fn__flex card__action fn__none">
        <div>
            <button class="b3-button b3-button--cancel" disabled="disabled" style="display: flex;margin-bottom: 8px;height: 28px;padding: 0;" data-type="-2"><svg><use xlink:href="#iconLeft"></use></svg>${x()?"":"(p / q)"}</button>
            <button data-type="-3" aria-label="0 / x" class="b3-button b3-button--cancel b3-tooltips__n b3-tooltips">
                <div class="card__icon">\u{1F4A4}</div>
                ${window.siyuan.languages.skip}${x()?"":" (0)"}
            </button>
        </div>
        <div>
            <span></span>
            <button data-type="1" aria-label="1 / j / a" class="b3-button b3-button--error b3-tooltips__n b3-tooltips">
                <div class="card__icon">\u{1F648}</div>
                ${window.siyuan.languages.cardRatingAgain}${x()?"":" (1)"}
            </button>
        </div>
        <div>
            <span></span>
            <button data-type="2" aria-label="2 / k / s" class="b3-button b3-button--warning b3-tooltips__n b3-tooltips">
                <div class="card__icon">\u{1F62C}</div>
                ${window.siyuan.languages.cardRatingHard}${x()?"":" (2)"}
            </button>
        </div>
        <div>
            <span></span>
            <button data-type="3" aria-label="3 / l / d / ${window.siyuan.languages.space} / ${window.siyuan.languages.enterKey}" class="b3-button b3-button--info b3-tooltips__n b3-tooltips">
                <div class="card__icon">\u{1F60A}</div>
                ${window.siyuan.languages.cardRatingGood}${x()?"":" (3)"}
            </button>
        </div>
        <div>
            <span></span>
            <button data-type="4" aria-label="4 / ; / f" class="b3-button b3-button--success b3-tooltips__n b3-tooltips">
                <div class="card__icon">\u{1F308}</div>
                ${window.siyuan.languages.cardRatingEasy}${x()?"":" (4)"}
            </button>
        </div>
    </div>
</div>`},w2=(t,e,n,a)=>{ae("/api/block/getDocInfo",{id:t},i=>{e.wysiwyg.renderCustom(i.data.ial),ae("/api/filetree/getDoc",{id:t,mode:0,size:p.SIZE_GET_MAX},s=>{_a({updateReadonly:!0,data:s,protyle:e,action:s.data.rootID===s.data.id?[]:[p.CB_GET_ALL],afterCB:()=>{if(e.element.classList.contains("fn__none"))return;let r=!1;!window.siyuan.config.flashcard.superBlock&&!window.siyuan.config.flashcard.heading&&!window.siyuan.config.flashcard.list&&!window.siyuan.config.flashcard.mark?r=!1:(window.siyuan.config.flashcard.superBlock&&e.wysiwyg.element.querySelector(":scope > .sb")&&(r=!0),window.siyuan.config.flashcard.heading&&e.wysiwyg.element.querySelector(':scope > [data-type="NodeHeading"]')&&(r=!0),window.siyuan.config.flashcard.list&&e.wysiwyg.element.querySelector(".list, .li")&&(r=!0),window.siyuan.config.flashcard.mark&&e.wysiwyg.element.querySelector('span[data-type~="mark"]')&&(r=!0));const o=n.querySelectorAll(".card__action");r?(window.siyuan.config.flashcard.superBlock&&e.element.classList.add("card__block--hidesb"),window.siyuan.config.flashcard.heading&&e.element.classList.add("card__block--hideh"),window.siyuan.config.flashcard.list&&e.element.classList.add("card__block--hideli"),window.siyuan.config.flashcard.mark&&e.element.classList.add("card__block--hidemark"),o[0].classList.remove("fn__none"),o[1].classList.add("fn__none")):(e.element.classList.remove("card__block--hidemark","card__block--hideli","card__block--hidesb","card__block--hideh"),o[0].classList.add("fn__none"),o[1].querySelectorAll("button.b3-button").forEach((l,c)=>{c<2||(l.previousElementSibling.textContent=a.nextDues[c-1])}),o[1].classList.remove("fn__none"))}})})})},Ny=t=>My(void 0,null,function*(){window.siyuan.storage[p.LOCAL_FLASHCARD].fullscreen&&kd(t.element.querySelector(".card__main"),t.element.querySelector('[data-type="fullscreen"]'));let e=0;typeof t.index=="number"&&(e=t.index);const n=new ar(t.app,t.element.querySelector("[data-type='render']"),{blockId:"",action:[p.CB_GET_ALL],render:{background:!1,gutter:!0,breadcrumbDocName:!0,title:!0,hideTitleOnZoom:!0},typewriterMode:!1});window.siyuan.mobile&&(window.siyuan.mobile.popEditor=n),t.cardsData.cards.length>0&&w2(t.cardsData.cards[e].blockID,n.protyle,t.element,t.cardsData.cards[e]),t.element.setAttribute("data-key",p.DIALOG_OPENCARD);const a=t.element.querySelectorAll(".card__action");t.index===0||typeof t.index=="undefined"?(a[0].firstElementChild.setAttribute("disabled","disabled"),a[1].querySelector(".b3-button").setAttribute("disabled","disabled")):(a[0].firstElementChild.removeAttribute("disabled"),a[1].querySelector(".b3-button").removeAttribute("disabled"));const i=t.element.querySelector('[data-type="count"]'),s=t.element.querySelector('[data-type="filter"]'),r=()=>{const o=s.getAttribute("data-cardtype"),l=s.getAttribute("data-id");ae(o==="all"?"/api/riff/getRiffDueCards":o==="doc"?"/api/riff/getTreeRiffDueCards":"/api/riff/getNotebookRiffDueCards",{rootID:l,deckID:l,notebook:l},c=>My(void 0,null,function*(){e=0,t.cardsData=c.data;for(let d=0;d<t.app.plugins.length;d++)t.cardsData=yield t.app.plugins[d].updateCards(t.cardsData);t.cardsData.cards.length>0?$y({countElement:i,editor:n,actionElements:a,index:e,cardsData:t.cardsData}):v2(i,n,a)}))};return i.innerHTML=Fy(t.cardsData,e),t.element.firstChild.addEventListener("click",o=>{const l=o.target;let c="";const d=t.cardsData.cards[e],u=s.getAttribute("data-id");if(typeof o.detail=="string")["1","j","a"].includes(o.detail)?c="1":["2","k","s"].includes(o.detail)?c="2":["3","l","d"].includes(o.detail)?c="3":["4",";","f"].includes(o.detail)?c="4":[" ","enter"].includes(o.detail)?c="-1":["p","q"].includes(o.detail)?c="-2":["0","x"].includes(o.detail)&&(c="-3");else{if(ue(l,"data-type","fullscreen")){kd(t.element.querySelector(".card__main"),t.element.querySelector('[data-type="fullscreen"]')),Ai(n.protyle),window.siyuan.storage[p.LOCAL_FLASHCARD].fullscreen=!window.siyuan.storage[p.LOCAL_FLASHCARD].fullscreen,Gt(p.LOCAL_FLASHCARD,window.siyuan.storage[p.LOCAL_FLASHCARD]),o.stopPropagation(),o.preventDefault();return}const f=ue(l,"data-type","more");if(f&&d){if(o.stopPropagation(),o.preventDefault(),s.getAttribute("data-cardtype")==="all"&&s.getAttribute("data-id")){Q(window.siyuan.languages.noSupportTip);return}const _=new ta;_.addItem({id:"setDueTime",icon:"iconClock",label:window.siyuan.languages.setDueTime,click(){const U=new fe({title:window.siyuan.languages.setDueTime,content:`<div class="b3-dialog__content">
    <div class="b3-label__text">${window.siyuan.languages.showCardDay}</div>
    <div class="fn__hr"></div>
    <input class="b3-text-field fn__block" value="1" type="number" step="1" min="1">
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"}),ee=U.element.querySelector("input"),Z=U.element.querySelectorAll(".b3-button");U.bindInput(ee,()=>{Z[1].click()}),ee.focus(),ee.select(),Z[0].addEventListener("click",()=>{U.destroy()}),Z[1].addEventListener("click",()=>{ae("/api/riff/batchSetRiffCardsDueTime",{cardDues:[{id:d.cardID,due:at().add(parseInt(ee.value),"day").format("YYYYMMDDHHmmss")}]},()=>{a[0].classList.add("fn__none"),a[1].classList.remove("fn__none"),d.state===0?t.cardsData.unreviewedNewCardCount--:t.cardsData.unreviewedOldCardCount--,t.element.firstElementChild.dispatchEvent(new CustomEvent("click",{detail:"0"})),t.cardsData.cards.splice(e,1),e--,U.destroy()})})}}),d.state!==0&&_.addItem({id:"reset",icon:"iconRefresh",label:window.siyuan.languages.reset,click(){ae("/api/riff/resetRiffCards",{type:s.getAttribute("data-cardtype"),id:u,deckID:p.QUICK_DECK_ID,blockIDs:[d.blockID]},()=>{const U=window.siyuan.languages._time["1m"].replace("%s","");d.lapses=0,d.lastReview=-621355968e5,d.reps=0,d.state=0,d.nextDues={1:U,2:U.replace("1","5"),3:U.replace("1","10"),4:window.siyuan.languages._time["1d"].replace("%s","").replace("1","6")},a[1].querySelectorAll("button.b3-button").forEach((ee,Z)=>{Z<2||(ee.previousElementSibling.textContent=d.nextDues[Z-1])}),t.cardsData.unreviewedOldCardCount--,t.cardsData.unreviewedNewCardCount++,i.innerHTML=Fy(t.cardsData,e)})}}),_.addItem({id:"removeRiffCard",icon:"iconTrashcan",label:`${window.siyuan.languages.remove} <b>${window.siyuan.languages.riffCard}</b>`,click(){a[0].classList.add("fn__none"),a[1].classList.remove("fn__none"),d.state===0?t.cardsData.unreviewedNewCardCount--:t.cardsData.unreviewedOldCardCount--,t.element.firstElementChild.dispatchEvent(new CustomEvent("click",{detail:"0"})),et(void 0,[{action:"removeFlashcards",deckID:p.QUICK_DECK_ID,blockIDs:[d.blockID]}]),t.cardsData.cards.splice(e,1),e--}}),_.addSeparator(),_.addItem({id:"forgetCountAndRevisionCountAndCardStatusAndLastReviewTime",iconHTML:"",type:"readonly",label:`<div class="fn__flex">
    <div class="fn__flex-1 ft__breakword">${window.siyuan.languages.forgetCount}</div>
    <div class="fn__space"></div>
    <div>${d.lapses}</div>
</div><div class="fn__flex">
    <div class="fn__flex-1 ft__breakword">${window.siyuan.languages.revisionCount}</div>
    <div class="fn__space"></div>
    <div>${d.reps}</div>
</div><div class="fn__flex">
    <div class="fn__flex-1 ft__breakword">${window.siyuan.languages.cardStatus}</div>
    <div class="fn__space"></div>
    <div class="${d.state===0?"ft__primary":"ft__success"}">${d.state===0?window.siyuan.languages.flashcardNewCard:window.siyuan.languages.flashcardReviewCard}</div>
</div><div class="fn__flex${d.lastReview>0?"":" fn__none"}">
    <div class="fn__flex-1 ft__breakword" style="width: 170px;">${window.siyuan.languages.lastReviewTime}</div>
    <div class="fn__space"></div>
    <div>${at(d.lastReview).format("YYYY-MM-DD")}</div>
</div>`});const v=f.getBoundingClientRect();_.open({x:v.left,y:v.bottom});return}const h=ue(l,"data-type","sticktab");if(h){const _=new ta;_.addItem({id:"openInNewTab",icon:"iconOpen",label:window.siyuan.languages.openInNewTab,click(){qs({app:t.app,custom:{icon:"iconRiffCard",title:window.siyuan.languages.spaceRepetition,data:{cardsData:t.cardsData,index:e,cardType:s.getAttribute("data-cardtype"),id:u,title:t.title},id:"siyuan-card"}}),t.dialog.destroy()}}),_.addItem({id:"insertRight",icon:"iconLayoutRight",label:window.siyuan.languages.insertRight,click(){qs({app:t.app,position:"right",custom:{icon:"iconRiffCard",title:window.siyuan.languages.spaceRepetition,data:{cardsData:t.cardsData,index:e,cardType:s.getAttribute("data-cardtype"),id:u,title:t.title},id:"siyuan-card"}}),t.dialog.destroy()}});const v=h.getBoundingClientRect();_.open({x:v.left,y:v.bottom}),o.stopPropagation(),o.preventDefault();return}if(ue(l,"data-type","close")){t.dialog&&t.dialog.destroy(),o.stopPropagation(),o.preventDefault();return}const b=ue(l,"data-type","filter");if(b){ae("/api/riff/getRiffDecks",{},_=>{window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(new xe({id:"all",iconHTML:"",label:window.siyuan.languages.all,click(){s.setAttribute("data-id",""),s.setAttribute("data-cardtype","all"),r()}}).element),window.siyuan.menus.menu.append(new xe({id:"fileTree",iconHTML:"",label:window.siyuan.languages.fileTree,click(){ur((U,ee)=>{s.setAttribute("data-id",U[0]==="/"?ee[0]:ha(U[0],!0,!0)),s.setAttribute("data-cardtype",U[0]==="/"?"notebook":"doc"),r()},[],void 0,window.siyuan.languages.specifyPath,!0)}}).element),(t.title||_.data.length>0)&&window.siyuan.menus.menu.append(new xe({type:"separator"}).element),t.title&&(window.siyuan.menus.menu.append(new xe({iconHTML:"",label:he(t.title),click(){s.setAttribute("data-id",t.id),s.setAttribute("data-cardtype",t.cardType),r()}}).element),_.data.length>0&&window.siyuan.menus.menu.append(new xe({type:"separator"}).element)),_.data.forEach(U=>{window.siyuan.menus.menu.append(new xe({iconHTML:"",label:he(U.name),click(){s.setAttribute("data-id",U.id),s.setAttribute("data-cardtype","all"),r()}}).element)});const v=b.getBoundingClientRect();window.siyuan.menus.menu.popup({x:v.left,y:v.bottom})}),o.stopPropagation(),o.preventDefault();return}if(ue(l,"data-type","newround")){r(),o.stopPropagation(),o.preventDefault();return}}if(!c){const g=N(l,"b3-button");g&&(c=g.getAttribute("data-type"))}if(!(!c||!d)){if(o.preventDefault(),o.stopPropagation(),Ut(["toolbar","hint","util","gutter"],n.protyle),c==="-1")if(a[0].classList.contains("fn__none"))c="3";else{n.protyle.element.classList.remove("card__block--hidemark","card__block--hideli","card__block--hidesb","card__block--hideh"),a[0].classList.add("fn__none"),a[1].querySelectorAll("button.b3-button").forEach((g,f)=>{f<2||(g.previousElementSibling.textContent=d.nextDues[f-1])}),a[1].classList.remove("fn__none"),By(t.app,d,c);return}else if(c==="-2"){e>0&&(e--,$y({countElement:i,editor:n,actionElements:a,index:e,cardsData:t.cardsData}),By(t.app,t.cardsData.cards[e+1],c));return}["1","2","3","4","-3"].includes(c)&&a[0].classList.contains("fn__none")&&ae(c==="-3"?"/api/riff/skipReviewRiffCard":"/api/riff/reviewRiffCard",{deckID:d.deckID,cardID:d.cardID,rating:parseInt(c),reviewedCards:t.cardsData.cards},()=>{if(e++,e>t.cardsData.cards.length-1){const g=s.getAttribute("data-cardtype");ae(g==="all"?"/api/riff/getRiffDueCards":g==="doc"?"/api/riff/getTreeRiffDueCards":"/api/riff/getNotebookRiffDueCards",{rootID:u,deckID:u,notebook:u,reviewedCards:t.cardsData.cards},f=>My(void 0,null,function*(){By(t.app,t.cardsData.cards[e-1],c),e=0,t.cardsData=f.data;for(let h=0;h<t.app.plugins.length;h++)t.cardsData=yield t.app.plugins[h].updateCards(t.cardsData);t.cardsData.cards.length===0?t.cardsData.unreviewedCount>0?N5(i,n,a,f.data.unreviewedCount):v2(i,n,a):$y({countElement:i,editor:n,actionElements:a,index:e,cardsData:t.cardsData})}));return}$y({countElement:i,editor:n,actionElements:a,index:e,cardsData:t.cardsData}),By(t.app,t.cardsData.cards[e-1],c)})}}),n}),By=(t,e,n)=>{t.plugins.forEach(a=>{a.eventBus.emit("click-flashcard-action",{type:n,card:e})})},wf=t=>{window.siyuan.config.readonly||ae("/api/riff/getRiffDueCards",{deckID:""},e=>{Sd(t,e.data,"all")})},Sd=(t,e,n,a,i)=>My(void 0,null,function*(){if(window.siyuan.dialogs.find(u=>{if(u.element.getAttribute("data-key")===p.DIALOG_OPENCARD)return u.destroy(),!0}))return;let r;getSelection().rangeCount>0&&(r=getSelection().getRangeAt(0));for(let u=0;u<t.plugins.length;u++)e=yield t.plugins[u].updateCards(e);const o=new fe({positionId:p.DIALOG_OPENCARD,content:Py({id:a,cardType:n,cardsData:e,isTab:!1}),width:x()?"100vw":"80vw",height:x()?"100vh":"70vh",destroyCallback(){l&&(l.destroy(),window.siyuan.mobile&&(window.siyuan.mobile.popEditor=null)),r&&Pt(r)},resizeCallback(u){u!=="d"&&u!=="t"&&l&&l.resize()}});o.element.querySelector(".b3-dialog__scrim").style.backgroundColor="var(--b3-theme-surface)",o.element.querySelector(".b3-dialog__container").style.maxWidth="1024px";const l=yield Ny({app:t,element:o.element,cardsData:e,title:i,id:a,cardType:n,dialog:o});l.resize(),o.editors={card:l};const c=o.element.querySelector(".block__icons button.block__icon");c.focus();const d=document.createRange();d.selectNodeContents(c),d.collapse(),Pt(d),P5()}),$y=t=>{t.editor.protyle.element.classList.remove("fn__none"),t.editor.protyle.element.nextElementSibling.classList.add("fn__none"),t.countElement.innerHTML=Fy(t.cardsData,t.index),t.countElement.classList.remove("fn__none"),t.index===0?(t.actionElements[0].firstElementChild.setAttribute("disabled","disabled"),t.actionElements[1].querySelector(".b3-button").setAttribute("disabled","disabled")):(t.actionElements[0].firstElementChild.removeAttribute("disabled"),t.actionElements[1].querySelector(".b3-button").removeAttribute("disabled")),w2(t.cardsData.cards[t.index].blockID,t.editor.protyle,ue(t.countElement,"data-key",p.DIALOG_OPENCARD),t.cardsData.cards[t.index])},v2=(t,e,n)=>{t.classList.add("fn__none"),e.protyle.element.classList.add("fn__none");const a=e.protyle.element.nextElementSibling;a.innerHTML=`<div>\u{1F52E}</div>${window.siyuan.languages.noDueCard}`,a.classList.remove("fn__none"),n[0].classList.add("fn__none"),n[1].classList.add("fn__none");const i=t.parentElement.querySelector('[data-type="more"]');i.classList.add("fn__none"),i.previousElementSibling.classList.add("fn__none")},N5=(t,e,n,a)=>{t.classList.add("fn__none"),e.protyle.element.classList.add("fn__none");const i=e.protyle.element.nextElementSibling;i.innerHTML=`<div>\u267B\uFE0F </div>
<span>${window.siyuan.languages.continueReview2.replace("${count}",a)}</span>
<div class="fn__hr"></div>
<button data-type="newround" class="b3-button fn__size200">${window.siyuan.languages.continueReview1}</button>`,i.classList.remove("fn__none"),n[0].classList.add("fn__none"),n[1].classList.add("fn__none")},vf=(t,e,n,a,i)=>{let s=1,r;ae(`/api/riff/get${a}RiffCards`,{id:e,page:s},o=>{var l;const c=new fe({positionId:p.DIALOG_VIEWCARDS,content:`<div class="fn__flex-column" style="height: 100%">
    <div class="block__icons">
        <span class="fn__flex-1 fn__flex-center resize__move">${he(n)}</span>
        <span class="fn__space"></span>
        <span data-type="resetAll" class="block__icon block__icon--show b3-tooltips b3-tooltips__w${a===""&&e===""?" fn__none":""}" aria-label="${window.siyuan.languages.reset}"><svg><use xlink:href='#iconUndo'></use></svg></span>
        <span class="fn__space"></span>
        <span data-type="previous" class="block__icon block__icon--show b3-tooltips b3-tooltips__w" disabled="disabled" aria-label="${window.siyuan.languages.previousLabel}"><svg><use xlink:href='#iconLeft'></use></svg></span>
        <span class="fn__space"></span>
        <span data-type="next" class="block__icon block__icon--show b3-tooltips b3-tooltips__w" disabled="disabled" aria-label="${window.siyuan.languages.nextLabel}"><svg><use xlink:href='#iconRight'></use></svg></span>
        <span class="fn__space"></span>
        <span class="fn__flex-center ft__on-surface">${s}/${o.data.pageCount||1}</span>
        <span class="fn__space"></span>
        <span class="counter">${o.data.total}</span>
        ${x()?`<span class="fn__space"></span>
<div data-type="close" class="block__icon block__icon--show">
    <svg><use xlink:href="#iconCloseRound"></use></svg>
</div>`:""}
    </div>
    <div class="${x()?"fn__flex-column":"fn__flex"} fn__flex-1" style="min-height: auto">
        <ul class="fn__flex-1 b3-list b3-list--background" style="user-select: none">
            ${yv(o.data.blocks,n,a)}
        </ul>
        <div id="cardPreview" style="border-bottom-right-radius:var(--b3-border-radius-b);" class="fn__flex-1 fn__none"></div>
        <div class="fn__flex-1 card__empty">${window.siyuan.languages.emptyContent}</div>
    </div>
</div>`,width:x()?"100vw":"80vw",height:x()?"100vh":"70vh",destroyCallback(){r&&(r.destroy(),window.siyuan.mobile&&(window.siyuan.mobile.popEditor=null))},resizeCallback(f){f!=="d"&&f!=="t"&&r&&r.resize()}});o.data.blocks.length>0&&(r=new ar(t,c.element.querySelector("#cardPreview"),{blockId:"",action:[p.CB_GET_ALL],render:{gutter:!0,breadcrumbDocName:!0,title:!0,hideTitleOnZoom:!0},typewriterMode:!1}),window.siyuan.mobile&&(window.siyuan.mobile.popEditor=r),c.editors={card:r},r.resize(),Ad(r,(l=c.element.querySelector(".b3-list-item--focus"))==null?void 0:l.getAttribute("data-id")));const d=c.element.querySelector('[data-type="previous"]'),u=c.element.querySelector('[data-type="next"]'),g=c.element.querySelector(".b3-list--background");o.data.pageCount>1&&u.removeAttribute("disabled"),c.element.setAttribute("data-key",p.DIALOG_VIEWCARDS),c.element.addEventListener("click",f=>{var h;if(typeof f.detail=="string"){let b=g.querySelector(".b3-list-item--focus");if(b){b.classList.remove("b3-list-item--focus"),f.detail==="arrowup"?b=b.previousElementSibling||b.parentElement.lastElementChild:f.detail==="arrowdown"?b=b.nextElementSibling||b.parentElement.firstElementChild:f.detail==="home"?b=b.parentElement.firstElementChild:f.detail==="end"&&(b=b.parentElement.lastElementChild);const y=b.getBoundingClientRect(),_=b.parentElement.getBoundingClientRect();(y.top<_.top||y.bottom>_.bottom)&&b.scrollIntoView(y.top<_.top),Ad(r,b.getAttribute("data-id")),b.classList.add("b3-list-item--focus")}f.stopPropagation(),f.preventDefault();return}let m=f.target;for(;m&&c.element!==m;){const b=m.getAttribute("data-type");if(b==="close"){c.destroy(),f.stopPropagation(),f.preventDefault();break}else if(b==="previous"){if(s<=1)return;s--,s<=1&&d.setAttribute("disabled","disabled"),ae(`/api/riff/get${a}RiffCards`,{id:e,page:s},y=>{var _;s===y.data.pageCount?u.setAttribute("disabled","disabled"):y.data.pageCount>1&&u.removeAttribute("disabled"),u.nextElementSibling.nextElementSibling.textContent=`${s}/${y.data.pageCount||1}`,g.innerHTML=yv(y.data.blocks,n,a),g.scrollTop=0,Ad(r,(_=c.element.querySelector(".b3-list-item--focus"))==null?void 0:_.getAttribute("data-id"))}),f.stopPropagation(),f.preventDefault();break}else if(b==="next"){if(s>=o.data.pageCount)return;s++,d.removeAttribute("disabled"),ae(`/api/riff/get${a}RiffCards`,{id:e,page:s},y=>{var _;s===y.data.pageCount?u.setAttribute("disabled","disabled"):y.data.pageCount>1&&u.removeAttribute("disabled"),u.nextElementSibling.nextElementSibling.textContent=`${s}/${y.data.pageCount||1}`,g.innerHTML=yv(y.data.blocks,n,a),g.scrollTop=0,Ad(r,(_=c.element.querySelector(".b3-list-item--focus"))==null?void 0:_.getAttribute("data-id"))}),f.stopPropagation(),f.preventDefault();break}else if(b==="reset"){ae("/api/riff/resetRiffCards",{type:a===""?"deck":a.toLowerCase(),deckID:a===""?e:p.QUICK_DECK_ID,id:e,blockIDs:[m.getAttribute("data-id")]},()=>{m.parentElement.querySelector(".ariaLabel.b3-list-item__meta").textContent=at().format("YYYY-MM-DD")}),f.stopPropagation(),f.preventDefault();break}else if(b==="resetAll"){Sn(window.siyuan.languages.reset,window.siyuan.languages.resetCardTip.replace("${x}",c.element.querySelector(".counter").textContent),()=>{ae("/api/riff/resetRiffCards",{type:a===""?"deck":a.toLowerCase(),deckID:a===""?e:p.QUICK_DECK_ID,id:e},()=>{c.element.querySelectorAll(".ariaLabel.b3-list-item__meta").forEach(y=>{y.textContent=at().format("YYYY-MM-DD")})})}),f.stopPropagation(),f.preventDefault();break}else if(b==="card-item"){Ad(r,m.getAttribute("data-id")),(h=g.querySelector(".b3-list-item--focus"))==null||h.classList.remove("b3-list-item--focus"),m.classList.add("b3-list-item--focus"),f.stopPropagation(),f.preventDefault();break}else if(b==="remove"){ae("/api/riff/removeRiffCards",{deckID:a===""?e:p.QUICK_DECK_ID,blockIDs:[m.getAttribute("data-id")]},y=>{var _;let v=m.parentElement.nextElementSibling;v||(v=m.parentElement.previousElementSibling),!v&&m.parentElement.parentElement.childElementCount>1&&(v=m.parentElement.parentElement.firstElementChild),v?(Ad(r,v.getAttribute("data-id")),(_=g.querySelector(".b3-list-item--focus"))==null||_.classList.remove("b3-list-item--focus"),v.classList.add("b3-list-item--focus"),m.parentElement.remove()):(Ad(r,""),g.innerHTML=`<div class="b3-list--empty">${window.siyuan.languages.emptyContent}</div>`),c.element.querySelector(".counter").textContent=(parseInt(c.element.querySelector(".counter").textContent)-1).toString(),i&&i(y)}),f.stopPropagation(),f.preventDefault();break}m=m.parentElement}})})},yv=(t,e,n)=>{let a="",i=!0;const s=e.split("/");return s.splice(0,1),t.forEach(r=>{var o,l,c,d;if(r.type){let u;n===""?u=Ds(r.box)+ha(Lute.UnEscapeHTMLStr(r.hPath),!1):(u=ha(Lute.UnEscapeHTMLStr(r.hPath),!1).replace("/"+s.join("/"),""),u.startsWith("/")&&(u=u.substring(1))),a+=`<div data-type="card-item" class="b3-list-item${i?" b3-list-item--focus":""}${x()?"":" b3-list-item--hide-action"}" data-id="${r.id}">
<svg class="b3-list-item__graphic"><use xlink:href="#${Qi(r.type)}"></use></svg>
${Yt(r.ial.icon,"b3-list-item__graphic",!0)}
<span class="b3-list-item__text">${r.content||p.ZWSP}</span>
<span class="${x()||!u?"fn__none ":""}b3-list-item__meta b3-list-item__meta--ellipsis" title="${ft(u)}">${he(u)}</span>
<span data-position="parentE" aria-label="${window.siyuan.languages.revisionCount}" class="ariaLabel counter${((o=r.riffCard)==null?void 0:o.reps)===0?" fn__none":""}">${(l=r.riffCard)==null?void 0:l.reps}</span>
<span data-position="parentE" aria-label="${window.siyuan.languages.nextDue}" class="ariaLabel b3-list-item__meta${(c=r.riffCard)!=null&&c.due?"":" fn__none"}">${at((d=r.riffCard)==null?void 0:d.due).format("YYYY-MM-DD")}</span>
<span data-position="parentE" data-type="reset" data-id="${r.id}" class="b3-list-item__action ariaLabel" aria-label="${window.siyuan.languages.reset}">
    <svg><use xlink:href="#iconUndo"></use></svg>
</span>
<span data-position="parentE" data-type="remove" data-id="${r.id}" class="b3-list-item__action b3-list-item__action--warning ariaLabel" aria-label="${window.siyuan.languages.removeDeck}">
    <svg><use xlink:href="#iconTrashcan"></use></svg>
</span>
</div>`,i=!1}else a+=`<div data-type="card-item" class="b3-list-item${x()?"":" b3-list-item--hide-action"}">
<span class="b3-list-item__text">${r.content}</span>
<span data-position="parentE" data-type="remove" data-id="${r.id}" class="b3-list-item__action b3-list-item__action--warning ariaLabel" aria-label="${window.siyuan.languages.removeDeck}">
    <svg><use xlink:href="#iconTrashcan"></use></svg>
</span>
</div>`}),t.length===0&&(a=`<div class="b3-list--empty">${window.siyuan.languages.emptyContent}</div>`),a},Ad=(t,e)=>{if(!e){t.protyle.element.classList.add("fn__none"),t.protyle.element.nextElementSibling.classList.remove("fn__none");return}t.protyle.element.classList.remove("fn__none"),t.protyle.element.nextElementSibling.classList.add("fn__none"),t.protyle.scroll.lastScrollTop=0,Ud(t.protyle),ae("/api/block/getDocInfo",{id:e},n=>{t.protyle.wysiwyg.renderCustom(n.data.ial),ae("/api/filetree/getDoc",{id:e,mode:0,size:p.SIZE_GET_MAX},a=>{_a({updateReadonly:!0,data:a,protyle:t.protyle,action:a.data.rootID===a.data.id?[]:[p.CB_GET_ALL]})})})},Oy=(t,e,n)=>{t.addEventListener("mousedown",a=>{const i=N(e,"b3-dialog__body")||N(e,"protyle-util");if(!i)return;i.style.userSelect="none",i.style.pointerEvents="none";const s=document;s.ondragstart=()=>!1;const r=a.clientX,o=e.clientWidth,l=i.clientWidth-256;s.onmousemove=c=>{const d=o+(c.clientX-r);d<256||d>l||(e.style.width=d+"px")},s.onmouseup=()=>{i.style.userSelect="auto",i.style.pointerEvents="",s.onmousemove=null,s.onmouseup=null,s.ondragstart=null,s.onselectstart=null,s.onselect=null,n&&(window.siyuan.storage[p.LOCAL_HISTORY][n]=e.clientWidth+"px",Gt(p.LOCAL_HISTORY,window.siyuan.storage[p.LOCAL_HISTORY]))}})};let Dh,Ch=!1;const Ry=(t,e,n)=>{const a=t.querySelector('[data-type="docprevious"]'),i=t.querySelector('[data-type="docnext"]');e>1?a.removeAttribute("disabled"):a.setAttribute("disabled","disabled");const s=t.querySelector('.b3-select[data-type="opselect"]'),r=t.querySelector(".b3-list--background");t.querySelector(".protyle-title__input").classList.add("fn__none"),t.querySelector('.history__text[data-type="docPanel"]').classList.add("fn__none"),t.querySelector('.history__text[data-type="mdPanel"]').classList.add("fn__none"),ae("/api/history/searchHistory",{query:n,page:e,op:s.value,type:3},o=>{e<o.data.pageCount?i.removeAttribute("disabled"):i.setAttribute("disabled","disabled");const l=t.querySelector('[data-type="jumpRepoPage"]');o.data.pageCount>1?l.removeAttribute("disabled"):l.setAttribute("disabled","disabled"),l.setAttribute("data-totalpage",o.data.pageCount.toString()),l.textContent=e.toString();const c=i.nextElementSibling.nextElementSibling;if(c.classList.remove("fn__none"),c.textContent=window.siyuan.languages.pageCountAndHistoryCount.replace("${x}",o.data.pageCount).replace("${y}",o.data.totalCount),o.data.histories.length===0){r.innerHTML=`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`;return}let d="";o.data.histories.forEach(u=>{d+=`<li class="b3-list-item b3-list-item--hide-action" data-created="${u}">
    <span class="b3-list-item__text">${at(parseInt(u)*1e3).format("YYYY-MM-DD HH:mm:ss")}</span>
    <span class="fn__space"></span>
    <span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="rollback" aria-label="${window.siyuan.languages.rollback}">
        <svg><use xlink:href="#iconUndo"></use></svg>
    </span>
</li>`}),r.innerHTML=d})},x2=t=>{const e=`<div class="history__action">
    <div class="block__icons">
        <span data-type="docprevious" class="block__icon block__icon--show b3-tooltips b3-tooltips__e" disabled="disabled" aria-label="${window.siyuan.languages.previousLabel}"><svg><use xlink:href="#iconLeft"></use></svg></span>
        <button class="b3-button b3-button--text ft__selectnone" data-type="jumpRepoPage" disabled>1</button>
        <span data-type="docnext" class="block__icon block__icon--show b3-tooltips b3-tooltips__e" disabled="disabled" aria-label="${window.siyuan.languages.nextLabel}"><svg><use xlink:href="#iconRight"></use></svg></span>
        <span class="fn__space"></span>
        <span class="ft__on-surface fn__flex-shrink ft__selectnone fn__none">${window.siyuan.languages.pageCountAndHistoryCount}</span>
        <span class="fn__space"></span>
        <div class="fn__flex-1"></div>
        <select data-type="opselect" class="b3-select">
            <option value="all" selected>${window.siyuan.languages.allOp}</option>
            <option value="update">${window.siyuan.languages.historyUpdate}</option>
            <option value="format">${window.siyuan.languages.historyFormat}</option>
            <option value="sync">${window.siyuan.languages.historySync}</option>
            <option value="replace">${window.siyuan.languages.historyReplace}</option>
            <option value="outline">${window.siyuan.languages.historyOutline}</option>
        </select>
    </div>
</div>
<div class="fn__flex fn__flex-1 history__panel">
    <ul class="b3-list b3-list--background history__side" ${x()?"":`style="width: ${window.siyuan.storage[p.LOCAL_HISTORY].sideDocWidth}"`}>
        <li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>
    </ul>
    <div class="history__resize"></div>
    <div class="fn__flex-1 fn__flex-column">
        <div class="protyle-title__input fn__none ft__center ft__breakword"></div>
        <textarea class="fn__flex-1 history__text fn__none" readonly data-type="mdPanel"></textarea>
        <div class="fn__flex-1 history__text fn__none" style="padding: 0" data-type="docPanel"></div>
    </div>
</div>`,n=new fe({title:t.pathString,content:e,width:x()?"100vw":"90vw",height:x()?"100vh":"80vh",containerClassName:"b3-dialog__container--theme",destroyCallback(){Dh=void 0}});n.element.setAttribute("data-key",p.DIALOG_HISTORYDOC);const a=n.element.querySelector(".b3-select");a.addEventListener("change",()=>{Ry(n.element,1,t.id)});const i=n.element.querySelector('.history__text[data-type="docPanel"]'),s=n.element.querySelector('.history__text[data-type="mdPanel"]');Ry(n.element,1,t.id),Dh=new ar(t.app,i,{blockId:"",history:{created:""},action:[p.CB_GET_HISTORY],render:{background:!1,gutter:!1,breadcrumb:!1,breadcrumbDocName:!1},typewriterMode:!1}),br(Dh.protyle);const r=n.element.querySelector('[data-type="jumpRepoPage"]'),o=n.element.querySelector(".protyle-title__input");n.element.addEventListener("click",l=>{let c=l.target;for(;c&&!c.isEqualNode(n.element);){const d=c.getAttribute("data-type");if(d==="rollback"&&!Ch){E2(c.parentElement,a.value,t.id,u=>{const g=u.path;Ch=!1;const f=window.siyuan.languages.rollbackConfirm.replace("${name}",he(u.title)).replace("${time}",c.previousElementSibling.previousElementSibling.textContent.trim());Sn("\u26A0\uFE0F "+window.siyuan.languages.rollback,f,()=>{ae("/api/history/rollbackDocHistory",{notebook:t.notebookId,historyPath:g})})}),l.stopPropagation(),l.preventDefault();break}else if(c.classList.contains("b3-list-item")&&!Ch){E2(c,a.value,t.id,u=>{var g;const f=u.path;ae("/api/history/getDocHistoryContent",{historyPath:f},h=>{h.data.isLargeDoc?(s.value=h.data.content,s.classList.remove("fn__none"),i.classList.add("fn__none")):(s.classList.add("fn__none"),i.classList.remove("fn__none"),_a({data:h,protyle:Dh.protyle,action:[p.CB_GET_HISTORY,p.CB_GET_HTML]})),o.textContent=u.title,o.classList.remove("fn__none"),Ch=!1}),(g=c.parentElement.querySelector(".b3-list-item--focus"))==null||g.classList.remove("b3-list-item--focus"),c.classList.add("b3-list-item--focus")}),l.stopPropagation(),l.preventDefault();break}else if((d==="docprevious"||d==="docnext")&&c.getAttribute("disabled")!=="disabled"){const u=parseInt(r.textContent);Ry(n.element,d==="docprevious"?u-1:u+1,t.id),l.stopPropagation(),l.preventDefault();break}else if(d==="jumpRepoPage"){const u=parseInt(c.getAttribute("data-totalpage")||"1");Sn(window.siyuan.languages.jumpToPage.replace("${x}",u),`<input class="b3-text-field fn__block" type="number" min="1" max="${u}" value="${r.textContent}">`,g=>{const f=g.element.querySelector(".b3-text-field");f.value!==""&&Ry(n.element,Math.max(1,Math.min(parseInt(f.value),u)),t.id)})}c=c.parentElement}}),Oy(n.element.querySelector(".history__resize"),n.element.querySelector(".history__side"),"sideDocWidth")},E2=(t,e,n,a)=>{Ch=!0;const i=t.getAttribute("data-path");i&&a(i);const s=t.getAttribute("data-created");Dh.protyle.options.history.created=s,ae("/api/history/getHistoryItems",{query:n,op:e,type:3,created:s},r=>{a(r.data.items[0])})},Lh=t=>`<li data-id="${t.id}" data-name="${ft(t.name)}" class="b3-list-item b3-list-item--narrow${x()?"":" b3-list-item--hide-action"}">
<span class="b3-list-item__text">
    <span>${he(t.name)}</span>
    <span class="b3-list-item__meta">${t.size}</span>
</span>
<span data-type="rename" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.rename}">
    <svg><use xlink:href="#iconEdit"></use></svg>
</span>
<span data-type="delete" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.delete}">
    <svg><use xlink:href="#iconTrashcan"></use></svg>
</span>
<span data-type="view" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.cardPreview}">
    <svg><use xlink:href="#iconEye"></use></svg>
</span>
<span data-type="remove" class="b3-list-item__action b3-list-item__action--warning b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.removeDeck}">
    <svg><use xlink:href="#iconMin"></use></svg>
</span>
<span data-type="add" style="display: flex" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.addDeck}">
    <svg><use xlink:href="#iconAdd"></use></svg>
</span>
<span class="b3-list-item__meta${x()?" fn__none":""}">${t.updated}</span>
</li>`,Ih=(t,e)=>{window.siyuan.dialogs.find(n=>{if(n.element.getAttribute("data-key")===p.DIALOG_MAKECARD)return Ut(["dialog"]),!0}),ae("/api/riff/getRiffDecks",{},n=>{let a="";n.data.forEach(s=>{a+=Lh(s)});const i=new fe({positionId:p.DIALOG_MAKECARD,width:x()?"92vw":"50vw",height:"70vh",title:window.siyuan.languages.riffCard,content:`<div class="b3-dialog__content fn__flex-column" style="box-sizing: border-box;height: 100%">
    <div class="fn__flex">
        <input class="b3-text-field fn__flex-1">
        <span class="fn__space"></span>
        <span data-type="create" class="block__icon block__icon--show b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.createDeck}">
            <svg><use xlink:href="#iconAdd"></use></svg>
        </span>
        <span class="fn__space"></span>
        <span data-type="viewall" class="block__icon block__icon--show b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.cardPreview}">
            <svg><use xlink:href="#iconEye"></use></svg>
        </span>
    </div>
    <div class="fn__hr"></div>
    <ul class="b3-list b3-list--background fn__flex-1">${a}</ul>
</div>`});i.element.setAttribute("data-key",p.DIALOG_MAKECARD),i.element.addEventListener("click",s=>{let r=s.target;for(;r&&r!==i.element;){const o=r.getAttribute("data-type");if(o==="create"){let l="";const c=i.element.querySelector(".b3-text-field");c.value?(l&&ot(l),ae("/api/riff/createRiffDeck",{name:c.value},d=>{i.element.querySelector(".b3-list").insertAdjacentHTML("afterbegin",Lh(d.data)),c.value=""})):(l=Q(window.siyuan.languages._kernel[142]),c.focus()),s.stopPropagation(),s.preventDefault();break}else if(o==="add"){ae("/api/riff/addRiffCards",{deckID:r.parentElement.getAttribute("data-id"),blockIDs:e},l=>{r.parentElement.outerHTML=Lh(l.data)}),s.stopPropagation(),s.preventDefault();break}else if(o==="remove"){ae("/api/riff/removeRiffCards",{deckID:r.parentElement.getAttribute("data-id"),blockIDs:e},l=>{r.parentElement.outerHTML=Lh(l.data)}),s.stopPropagation(),s.preventDefault();break}else if(o==="delete"){Sn(window.siyuan.languages.deleteOpConfirm,`${window.siyuan.languages.confirmDelete} <b>${he(r.parentElement.getAttribute("data-name"))}</b>?`,()=>{ae("/api/riff/removeRiffDeck",{deckID:r.parentElement.getAttribute("data-id")},()=>{r.parentElement.remove()})},void 0,!0),s.stopPropagation(),s.preventDefault();break}else if(o==="view"){vf(t,r.parentElement.getAttribute("data-id"),r.parentElement.getAttribute("data-name"),"",l=>{r.parentElement.outerHTML=Lh(l.data)}),s.stopPropagation(),s.preventDefault();break}else if(o==="viewall"){vf(t,"",window.siyuan.languages.all,""),s.stopPropagation(),s.preventDefault();break}else if(o==="rename"){const l=new fe({title:window.siyuan.languages.rename,content:`<div class="b3-dialog__content"><input class="b3-text-field fn__block" value=""></div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"}),c=l.element.querySelector("input"),d=l.element.querySelectorAll(".b3-button");l.bindInput(c,()=>{d[1].click()}),c.value=r.parentElement.getAttribute("data-name"),c.focus(),c.select(),d[0].addEventListener("click",()=>{l.destroy()}),d[1].addEventListener("click",()=>{ae("/api/riff/renameRiffDeck",{name:c.value,deckID:r.parentElement.getAttribute("data-id")},()=>{r.parentElement.querySelector(".b3-list-item__text span").textContent=c.value,r.parentElement.setAttribute("data-name",c.value)}),l.destroy()}),s.stopPropagation(),s.preventDefault();break}r=r.parentElement}})})},Mh=(t,e)=>{let n=!0;const a=[];e.forEach(i=>{i.getAttribute("data-type")!=="NodeThematicBreak"&&(i.classList.remove("protyle-wysiwyg--select"),a.push(i.getAttribute("data-node-id")),(i.getAttribute(p.CUSTOM_RIFF_DECKS)||"").indexOf(p.QUICK_DECK_ID)===-1&&(n=!1))}),n?et(t,[{action:"removeFlashcards",deckID:p.QUICK_DECK_ID,blockIDs:a}],[{action:"addFlashcards",deckID:p.QUICK_DECK_ID,blockIDs:a}]):et(t,[{action:"addFlashcards",deckID:p.QUICK_DECK_ID,blockIDs:a}],[{action:"removeFlashcards",deckID:p.QUICK_DECK_ID,blockIDs:a}])};class B5{constructor(e=""){this.eventTarget=document.appendChild(document.createComment(e))}on(e,n){this.eventTarget.addEventListener(e,n)}once(e,n){this.eventTarget.addEventListener(e,n,{once:!0})}off(e,n){this.eventTarget.removeEventListener(e,n)}emit(e,n){return this.eventTarget.dispatchEvent(new CustomEvent(e,{detail:n,cancelable:!0}))}}const Is=t=>{const e=new hh;t.detail.menu=e,t.plugins.forEach(n=>{n.eventBus.emit(t.type,t.detail)}),e.menus.length>0&&(t.separatorPosition==="top"&&window.siyuan.menus.menu.append(new xe({id:"separator_pluginTop",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"plugin",label:window.siyuan.languages.plugin,icon:"iconPlugin",type:"submenu",submenu:e.menus}).element),t.separatorPosition==="bottom"&&window.siyuan.menus.menu.append(new xe({id:"separator_pluginBottom",type:"separator"}).element))},Fh=t=>{if(t.protyle.disabled)return;const e=new ta(p.MENU_AV_VIEW);if(e.isOpen)return;e.addItem({id:"rename",icon:"iconEdit",label:window.siyuan.languages.rename,click(){var a;(a=document.querySelector(".av__panel"))==null||a.remove(),Vi({protyle:t.protyle,blockElement:t.blockElement,type:"config",cb:i=>{i.querySelector('.b3-text-field[data-type="name"]').focus()}})}}),e.addItem({id:"config",icon:"iconSettings",label:window.siyuan.languages.config,click(){var a;(a=document.querySelector(".av__panel"))==null||a.remove(),Vi({protyle:t.protyle,blockElement:t.blockElement,type:"config"})}}),e.addSeparator(),e.addItem({id:"duplicate",icon:"iconCopy",label:window.siyuan.languages.duplicate,click(){var a;(a=document.querySelector(".av__panel"))==null||a.remove();const i=Lute.NewNodeID();et(t.protyle,[{action:"duplicateAttrViewView",avID:t.blockElement.dataset.avId,previousID:t.element.dataset.id,id:i,blockID:t.blockElement.dataset.nodeId}],[{action:"removeAttrViewView",avID:t.blockElement.dataset.avId,id:i,blockID:t.blockElement.dataset.nodeId}])}}),t.blockElement.querySelectorAll(".layout-tab-bar .item").length>1&&e.addItem({id:"delete",icon:"iconTrashcan",label:window.siyuan.languages.delete,click(){var a;(a=document.querySelector(".av__panel"))==null||a.remove(),et(t.protyle,[{action:"removeAttrViewView",avID:t.blockElement.dataset.avId,id:t.element.dataset.id,blockID:t.blockElement.dataset.nodeId}])}});const n=t.element.getBoundingClientRect();e.open({x:n.left,y:n.bottom})},k2=t=>{const e=t.menuElement.querySelector('.b3-text-field[data-type="name"]');e.addEventListener("blur",()=>{e.value!==e.dataset.value&&(et(t.protyle,[{action:"setAttrViewViewName",avID:t.data.id,id:t.data.viewID,data:e.value}],[{action:"setAttrViewViewName",avID:t.data.id,id:t.data.viewID,data:e.dataset.value}]),e.dataset.value=e.value)}),e.addEventListener("keydown",a=>{a.isComposing||a.key==="Enter"&&(a.preventDefault(),e.blur(),t.menuElement.parentElement.remove())}),e.select(),e.value=e.dataset.value;const n=t.menuElement.querySelector('.b3-text-field[data-type="desc"]');e.nextElementSibling.addEventListener("click",()=>{const a=n.parentElement;a.classList.toggle("fn__none"),a.classList.contains("fn__none")||n.focus()}),n.addEventListener("blur",()=>{n.value!==n.dataset.value&&(et(t.protyle,[{action:"setAttrViewViewDesc",avID:t.data.id,id:t.data.viewID,data:n.value}],[{action:"setAttrViewViewDesc",avID:t.data.id,id:t.data.viewID,data:n.dataset.value}]),n.dataset.value=n.value)}),n.addEventListener("keydown",a=>{a.isComposing||a.key==="Enter"&&(a.preventDefault(),n.blur(),t.menuElement.parentElement.remove())}),n.addEventListener("input",()=>{e.nextElementSibling.setAttribute("aria-label",n.value?he(n.value):window.siyuan.languages.addDesc)})},S2=t=>{const e=t.view,n=ma(t);return`<div class="b3-menu__items">
<button class="b3-menu__item" data-type="nobg">
    <span class="b3-menu__label ft__center">${window.siyuan.languages.config}</span>
</button>
<button class="b3-menu__separator"></button>
<button class="b3-menu__item" data-type="nobg">
    <div class="fn__block">
        <div class="fn__flex">
            <span class="b3-menu__avemoji" data-type="update-view-icon">${e.icon?Yt(e.icon):`<svg style="height: 14px;width: 14px"><use xlink:href="#${Uy(t.viewType)}"></use></svg>`}</span>
            <div class="b3-form__icona fn__block">
                <input data-type="name" class="b3-text-field b3-form__icona-input" type="text" data-value="${ft(e.name)}">
                <svg data-position="north" class="b3-form__icona-icon ariaLabel" aria-label="${e.desc?Ot(e.desc):window.siyuan.languages.addDesc}"><use xlink:href="#iconInfo"></use></svg>
            </div>
        </div>
        <div class="fn__none">
            <div class="fn__hr"></div>
            <textarea placeholder="${window.siyuan.languages.addDesc}" rows="1" data-type="desc" class="b3-text-field fn__block" type="text" data-value="${ft(e.desc)}">${e.desc}</textarea>
        </div>
        <div class="fn__hr"></div>
    </div>
</button>
<button class="b3-menu__item" data-type="go-layout">
    <svg class="b3-menu__icon"><use xlink:href="#${Uy(t.viewType)}"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.layout}</span>
    <span class="b3-menu__accelerator">${D2(t.viewType)}</span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>
<button class="b3-menu__separator"></button>
<button class="b3-menu__item" data-type="go-properties">
    <svg class="b3-menu__icon"><use xlink:href="#iconList"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.fields}</span>
    <span class="b3-menu__accelerator">${n.filter(a=>!a.hidden).length}/${n.length}</span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>
<button class="b3-menu__item" data-type="goFilters">
    <svg class="b3-menu__icon"><use xlink:href="#iconFilter"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.filter}</span>
    <span class="b3-menu__accelerator">${e.filters.length}</span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>
<button class="b3-menu__item" data-type="goSorts">
    <svg class="b3-menu__icon"><use xlink:href="#iconSort"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.sort}</span>
    <span class="b3-menu__accelerator">${e.sorts.length}</span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>
<button class="b3-menu__item" data-type="goGroups">
    <svg class="b3-menu__icon"><use xlink:href="#iconGroups"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.group}</span>
    <span class="b3-menu__accelerator">${t.view.group&&t.view.group.field?n.filter(a=>a.id===t.view.group.field)[0].name:""}</span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>
<button class="b3-menu__separator"></button>
<button class="b3-menu__item" data-type="duplicate-view">
    <svg class="b3-menu__icon">
        <use xlink:href="#iconCopy"></use>
    </svg>
    <span class="b3-menu__label">${window.siyuan.languages.duplicate}</span>
</button>
<button class="b3-menu__item${t.views.length>1?"":" fn__none"}" data-type="delete-view">
    <svg class="b3-menu__icon"><use xlink:href="#iconTrashcan"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.delete}</span>
</button>
</div>`},$5=t=>{const e=t.menuElement.querySelector(".b3-text-field");e.focus(),e.addEventListener("keydown",n=>{if(n.stopPropagation(),!n.isComposing)if(pi(t.menuElement.querySelector(".fn__flex-1"),n,"b3-menu__item--current"),n.key==="Enter"){const a=t.menuElement.querySelector(".b3-menu__item--current");a&&(et(t.protyle,[{action:"setAttrViewBlockView",blockID:t.blockElement.getAttribute("data-node-id"),id:a.dataset.id,avID:t.blockElement.getAttribute("data-av-id")}],[{action:"setAttrViewBlockView",blockID:t.blockElement.getAttribute("data-node-id"),id:t.blockElement.querySelector(".av__views .item--focus").getAttribute("data-id"),avID:t.blockElement.getAttribute("data-av-id")}]),t.menuElement.remove(),qt(t.blockElement))}else n.key==="Escape"&&(t.menuElement.remove(),qt(t.blockElement))}),e.addEventListener("input",n=>{n.isComposing||A2(t.menuElement)}),e.addEventListener("compositionend",()=>{A2(t.menuElement)})},A2=t=>{var e;const a=t.querySelector(".b3-text-field").value;t.querySelectorAll('.b3-menu__item[draggable="true"]').forEach(i=>{!a||a.toLowerCase().indexOf(i.textContent.trim().toLowerCase())>-1||i.textContent.trim().toLowerCase().indexOf(a.toLowerCase())>-1?i.classList.remove("fn__none"):(i.classList.add("fn__none"),i.classList.remove("b3-menu__item--current"))}),t.querySelector(".b3-menu__item--current")||(e=t.querySelector(".fn__flex-1 .b3-menu__item:not(.fn__none)"))==null||e.classList.add("b3-menu__item--current")},O5=(t,e)=>{let n="";return t.forEach(a=>{n+=`<button draggable="true" class="b3-menu__item${a.id===e?" b3-menu__item--current":""}" data-id="${a.id}">
    <svg class="b3-menu__icon fn__grab"><use xlink:href="#iconDrag"></use></svg>
    <div class="b3-menu__label fn__flex" data-type="av-view-switch" data-av-type="${a.type}">
        ${a.icon?Yt(a.icon,"b3-menu__icon",!0):`<svg class="b3-menu__icon"><use xlink:href="#${Uy(a.type)}"></use></svg>`}
        <span class="fn__ellipsis">${a.name}</span>
    </div>
    <svg class="b3-menu__action" data-type="av-view-edit"><use xlink:href="#iconEdit"></use></svg>
</button>`}),`<div class="b3-menu__items fn__flex-column">
<button class="b3-menu__item" data-type="av-add">
    <svg class="b3-menu__icon"><use xlink:href="#iconAdd"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.newView}</span>
</button>
<button class="b3-menu__separator"></button>
<div class="b3-menu__item fn__flex-shrink" data-type="nobg">
    <input class="b3-text-field fn__block" type="text" style="margin: 4px 0" placeholder="${window.siyuan.languages.search}">
</div>
<div class="fn__flex-1" style="overflow: auto">
    ${n}
</div>
</div>`},T2=(t,e)=>{var n;const a=Lute.NewNodeID(),i=e.getAttribute("data-av-id"),s=e.querySelector(".av__views"),r=new ta(void 0,()=>{s.classList.remove("av__views--show")});r.addItem({icon:"iconTable",label:window.siyuan.languages.table,click(){et(t,[{action:"addAttrViewView",avID:i,id:a,blockID:e.getAttribute("data-node-id")}],[{action:"removeAttrViewView",avID:i,id:a,blockID:e.getAttribute("data-node-id")}])}}),r.addItem({icon:"iconBoard",label:window.siyuan.languages.kanban,click(){et(t,[{action:"addAttrViewView",avID:i,layout:"kanban",id:a,blockID:e.getAttribute("data-node-id")}],[{action:"removeAttrViewView",layout:"kanban",avID:i,id:a,blockID:e.getAttribute("data-node-id")}])}}),r.addItem({icon:"iconGallery",label:window.siyuan.languages.gallery,click(){et(t,[{action:"addAttrViewView",avID:i,layout:"gallery",id:a,blockID:e.getAttribute("data-node-id")}],[{action:"removeAttrViewView",layout:"gallery",avID:i,id:a,blockID:e.getAttribute("data-node-id")}])}}),s.classList.add("av__views--show");const o=(n=s.querySelector('.block__icon[data-type="av-add"]'))==null?void 0:n.getBoundingClientRect();r.open({x:o.left,y:o.bottom+8})},Uy=t=>{switch(t){case"table":return"iconTable";case"gallery":return"iconGallery";case"kanban":return"iconBoard"}},D2=t=>{switch(t){case"table":return window.siyuan.languages.table;case"gallery":return window.siyuan.languages.gallery;case"kanban":return window.siyuan.languages.kanban}},ma=t=>t.viewType==="table"?t.view.columns:t.view.fields,R5=t=>{const e=window.siyuan.dragElement.parentElement;if(e.scrollWidth>e.clientWidth){const i=e.getBoundingClientRect();t.clientX<i.left?e.scroll({left:e.scrollLeft-p.SIZE_SCROLL_STEP,behavior:"smooth"}):t.clientX>i.right&&e.scroll({left:e.scrollLeft+p.SIZE_SCROLL_STEP,behavior:"smooth"})}const n=N(document.elementFromPoint(t.clientX,window.siyuan.dragElement.getBoundingClientRect().top+10),"item");if(!n||e!==window.siyuan.dragElement.parentElement||n===window.siyuan.dragElement)return;const a=n.getBoundingClientRect();if(a.left+a.width/2<t.clientX){if(n.nextElementSibling&&n.nextElementSibling===window.siyuan.dragElement)return;n.after(window.siyuan.dragElement)}else{if(n.previousElementSibling&&n.previousElementSibling===window.siyuan.dragElement)return;n.before(window.siyuan.dragElement)}},si=(t,e)=>{t.includes("cell")&&e.querySelectorAll(".av__cell--select, .av__cell--active").forEach(n=>{var a;(a=n.querySelector(".av__drag-fill"))==null||a.remove(),n.classList.remove("av__cell--select","av__cell--active")}),t.includes("row")&&e.querySelectorAll(".av__row--select").forEach(n=>{n.classList.remove("av__row--select"),n.querySelector(".av__firstcol use").setAttribute("xlink:href","#iconUncheck"),ec(n)}),t.includes("galleryItem")&&e.querySelectorAll(".av__gallery-item--select").forEach(n=>{n.classList.remove("av__gallery-item--select")}),t.includes("av")&&e.querySelectorAll(" .av__cell--select, .av__cell--active, .av__row--select, .av__gallery-item--select").forEach(n=>{var a;n.classList.contains("av__row--select")?(n.classList.remove("av__row--select"),n.querySelector(".av__firstcol use").setAttribute("xlink:href","#iconUncheck"),ec(n)):((a=n.querySelector(".av__drag-fill"))==null||a.remove(),n.classList.remove("av__cell--select","av__cell--active","av__gallery-item--select"))}),t.includes("img")&&e.querySelectorAll(".img--select").forEach(n=>{n.classList.remove("img--select")})},C2=t=>{var e,n,a;const i=t.blockElement.getAttribute("data-av-type");t.blockElement.querySelector('[data-type="av-search"]').value="";const s=t.groupID?`.av__body[data-group-id="${t.groupID}"] `:"";let r=t.previousId?t.blockElement.querySelector(s+`.av__gallery-item[data-id="${t.previousId}"]`):t.blockElement.querySelector(s+".av__gallery-item");t.blockElement.querySelector('.av__views [data-type="av-sort"]').classList.contains("block__icon--active")&&(r=t.blockElement.querySelector(s+".av__gallery-add").previousElementSibling);const l=t.blockElement.querySelector(`.av__body[data-group-id="${t.groupID}"] `);if(l&&["updated","created"].includes(l.getAttribute("data-dtype"))&&l.getAttribute("data-content")!=="_@today@_"&&(r=(e=t.blockElement.querySelector('.av__body[data-content="_@today@_"] .av__gallery-add'))==null?void 0:e.previousElementSibling,!r))return;let c="";r==null||r.querySelectorAll(".av__cell").forEach(g=>{var f;let h=1;const m=Ns(g);if(m==="lineNumber"){const y=(f=g.querySelector(".av__celltext"))==null?void 0:f.getAttribute("data-value");y&&(h=parseInt(y))}const b=`<div class="av__cell${m==="checkbox"?" av__cell-uncheck":""}" 
data-field-id="${g.dataset.fieldId}" 
data-wrap="${g.dataset.wrap}" 
data-dtype="${g.dataset.dtype}" 
${m==="block"?' data-detached="true"':""}>${ho(po(m,null),h,!1,i)}</div>`;g.previousElementSibling.classList.contains("av__gallery-name")?c+=`<div class="av__gallery-field av__gallery-field--name" data-empty="${g.parentElement.dataset.empty}">
    ${g.previousElementSibling.outerHTML}
    ${b}
</div>`:c+=`<div class="av__gallery-field" data-empty="${g.parentElement.dataset.empty}">
    ${g.previousElementSibling.outerHTML}
    ${b}
</div>`}),si(["galleryItem"],t.blockElement);let d="";const u=((n=r==null?void 0:r.querySelector(".av__gallery-cover"))==null?void 0:n.className)||"fn__none";t.srcIDs.forEach(()=>{d+=`<div class="av__gallery-item" data-type="ghost">
    <div class="${u}"><span style="width: 100%;height: 100%;border-radius: var(--b3-border-radius) var(--b3-border-radius) 0 0;" class="av__pulse"></span></div>
    <div class="av__gallery-fields">${c}</div>
</div>`}),r?r.insertAdjacentHTML("afterend",d):(a=t.blockElement.querySelector(s+".av__gallery"))==null||a.insertAdjacentHTML("afterbegin",d),ae("/api/av/getAttributeViewAddingBlockDefaultValues",{avID:t.blockElement.getAttribute("data-av-id"),viewID:t.blockElement.getAttribute(p.CUSTOM_SY_AV_VIEW),groupID:t.groupID,previousID:t.previousId},g=>{if(g.data.values){let f;const h=Object.keys(g.data.values);t.blockElement.querySelectorAll('[data-type="ghost"]').forEach(m=>{m.querySelectorAll(".av__cell").forEach(b=>{if(!f&&b.getAttribute("data-detached")==="true"&&(f=b),h.includes(b.dataset.fieldId)){const y=g.data.values[b.dataset.fieldId];y.type==="checkbox"&&b.parentElement.querySelector(".av__gallery-tip")&&(y.checkbox.content=b.getAttribute("aria-label").split('<div class="ft__on-surface">')[0]),b.innerHTML=ho(y,void 0,!1,i),u_(b,y)}})})}L2(t.blockElement)})},Pr=(t,e)=>NS(t)?t.getAttribute("data-row-id"):N(t,e==="table"?"av__row":"av__gallery-item").dataset.id,lo=(t,e)=>{const n=N(t,"av__row");if(!n)return;const a=t.querySelector("use");n.classList.contains("av__row--header")||e==="unselectAll"?a.getAttribute("xlink:href")==="#iconCheck"||e==="unselectAll"?n.parentElement.querySelectorAll(".av__firstcol").forEach(i=>{i.querySelector("use").setAttribute("xlink:href","#iconUncheck");const s=N(i,"av__row");s&&s.classList.remove("av__row--select")}):n.parentElement.querySelectorAll(".av__firstcol").forEach(i=>{i.querySelector("use").setAttribute("xlink:href","#iconCheck");const s=N(i,"av__row");s&&s.classList.add("av__row--select")}):e==="select"||a.getAttribute("xlink:href")==="#iconUncheck"&&e==="toggle"?(n.classList.add("av__row--select"),a.setAttribute("xlink:href","#iconCheck")):(e==="unselect"||a.getAttribute("xlink:href")==="#iconCheck"&&e==="toggle")&&(n.classList.remove("av__row--select"),a.setAttribute("xlink:href","#iconUncheck")),qt(oe(n)),ec(n)},ec=t=>{const e=oe(t);if(!e)return;const n=t.parentElement.querySelectorAll(".av__row--select:not(.av__row--header)").length,a=t.parentElement.querySelectorAll(".av__row:not(.av__row--header)").length,i=t.parentElement.firstElementChild,s=i.querySelector("use");a===n&&a!==0?(i.classList.add("av__row--select"),s.setAttribute("xlink:href","#iconCheck")):n===0?(i.classList.remove("av__row--select"),s.setAttribute("xlink:href","#iconUncheck")):n>0&&(i.classList.add("av__row--select"),s.setAttribute("xlink:href","#iconIndeterminateCheck"));const r=e.querySelector(".av__counter"),o=e.querySelectorAll(".av__row--select:not(.av__row--header)").length;if(o===0){r.classList.add("fn__none");return}r.classList.remove("fn__none"),r.innerHTML=`${o} ${window.siyuan.languages.selected}`},L2=t=>{const e=t.getAttribute("data-av-type");t.querySelectorAll(".av__body").forEach(n=>{const a=n.dataset.pageSize;if(a){const i=n.querySelectorAll(e==="table"?".av__row:not(.av__row--header)":".av__gallery-item").length;parseInt(a)<i&&(n.dataset.pageSize=i.toString())}})},Hy=t=>{var e;t.blockElement.querySelector('[data-type="av-search"]').value="";const n=t.groupID?`.av__body[data-group-id="${t.groupID}"] `:"";let a=t.blockElement.querySelector(n+`.av__row[data-id="${t.previousId}"]`)||t.blockElement.querySelector(n+".av__row--header");t.blockElement.querySelector('.av__views [data-type="av-sort"]').classList.contains("block__icon--active")&&(a=t.blockElement.querySelector(n+".av__row--util").previousElementSibling);const s=t.blockElement.querySelector(`.av__body[data-group-id="${t.groupID}"] `);if(s&&["updated","created"].includes(s.getAttribute("data-dtype"))&&s.getAttribute("data-content")!=="_@today@_"&&(a=(e=t.blockElement.querySelector('.av__body[data-content="_@today@_"] .av__row--util'))==null?void 0:e.previousElementSibling),!a)return;let r='<div class="av__colsticky"><div class="av__firstcol"><svg><use xlink:href="#iconUncheck"></use></svg></div></div>';const o=a.querySelectorAll(".av__colsticky .av__cell").length-1;o>-1&&(r='<div class="av__colsticky"><div class="av__firstcol"><svg><use xlink:href="#iconUncheck"></use></svg></div>'),a.querySelectorAll(".av__cell").forEach((c,d)=>{var u;let g=1;const f=Ns(c);if(f==="lineNumber"){const h=(u=c.querySelector(".av__celltext"))==null?void 0:u.getAttribute("data-value");h&&(g=parseInt(h))}r+=`<div class="av__cell${f==="checkbox"?" av__cell-uncheck":""}" data-col-id="${c.dataset.colId}" 
data-wrap="${c.dataset.wrap}" 
data-dtype="${c.dataset.dtype}" 
style="width: ${c.style.width};${c.dataset.dtype==="number"?"text-align: right;":""}" 
${f==="block"?' data-detached="true"':""}>${ho(po(f,null),g)}</div>`,o===d&&(r+="</div>")});let l="";si(["cell","row"],t.blockElement),t.srcIDs.forEach(()=>{l+=`<div class="av__row" data-type="ghost">
    ${r}
</div>`}),a.insertAdjacentHTML("afterend",l),ae("/api/av/getAttributeViewAddingBlockDefaultValues",{avID:t.blockElement.getAttribute("data-av-id"),viewID:t.blockElement.getAttribute(p.CUSTOM_SY_AV_VIEW),groupID:t.groupID,previousID:t.previousId},c=>{if(c.data.values){let d;const u=Object.keys(c.data.values);t.blockElement.querySelectorAll('[data-type="ghost"]').forEach(g=>{g.querySelectorAll(".av__cell").forEach(f=>{if(!d&&f.getAttribute("data-detached")==="true"&&(d=f),u.includes(f.dataset.colId)){const h=c.data.values[f.dataset.colId];f.innerHTML=ho(h),u_(f,h)}})})}L2(t.blockElement)})},tc=(t,e,n)=>{if(t.dataset.avType!=="table")return;const a=t.querySelectorAll(".av__row--header");a.length>0&&(n==="top"||n==="all")&&a.forEach(s=>{const r=s.parentElement.getBoundingClientRect(),o=Math.floor(e.top-r.top);o>0&&o<r.height-s.clientHeight?s.style.transform=`translateY(${o}px)`:s.style.transform=""});const i=t.querySelectorAll(".av__row--footer");i.length>0&&(n==="bottom"||n==="all")&&i.forEach(s=>{if(s.querySelector(".av__calc--ashow")){const r=s.parentElement.getBoundingClientRect(),o=Math.ceil(e.bottom-r.bottom);o<0&&-o<r.height-s.clientHeight?s.style.transform=`translateY(${o}px)`:s.style.transform=""}else s.style.transform=""})},xf=t=>{var e;if(t.currentPageSize===t.newPageSize)return;t.nodeElement.querySelectorAll(".av__body").forEach(a=>{a.dataset.pageSize=t.newPageSize});const n=t.nodeElement.getAttribute("data-node-id");et(t.protyle,[{action:"setAttrViewPageSize",avID:t.avID,data:parseInt(t.newPageSize),blockID:n}],[{action:"setAttrViewPageSize",data:parseInt(t.currentPageSize),avID:t.avID,blockID:n}]),(e=document.querySelector(".av__panel"))==null||e.remove()},I2=t=>{const e=new ta(p.MENU_AV_PAGE_SIZE);if(e.isOpen)return;const n=t.target.dataset.size;e.addItem({iconHTML:"",label:"5",checked:n==="5",click(){xf({currentPageSize:n,newPageSize:"5",protyle:t.protyle,avID:t.avID,nodeElement:t.nodeElement})}}),e.addItem({iconHTML:"",label:"10",checked:n==="10",click(){xf({currentPageSize:n,newPageSize:"10",protyle:t.protyle,avID:t.avID,nodeElement:t.nodeElement})}}),e.addItem({iconHTML:"",checked:n==="25",label:"25",click(){xf({currentPageSize:n,newPageSize:"25",protyle:t.protyle,avID:t.avID,nodeElement:t.nodeElement})}}),e.addItem({iconHTML:"",checked:n==="50",label:"50",click(){xf({currentPageSize:n,newPageSize:"50",protyle:t.protyle,avID:t.avID,nodeElement:t.nodeElement})}}),e.addItem({iconHTML:"",checked:n==="100",label:"100",click(){xf({currentPageSize:n,newPageSize:"100",protyle:t.protyle,avID:t.avID,nodeElement:t.nodeElement})}}),e.addItem({iconHTML:"",checked:n===p.SIZE_DATABASE_MAZ_SIZE.toString(),label:window.siyuan.languages.all,click(){xf({currentPageSize:n,newPageSize:p.SIZE_DATABASE_MAZ_SIZE.toString(),protyle:t.protyle,avID:t.avID,nodeElement:t.nodeElement})}});const a=t.target.getBoundingClientRect();e.open({x:a.left,y:a.bottom})},M2=(t,e)=>{const n=t.querySelectorAll(".av__row--select:not(.av__row--header), .av__gallery-item--select");if(n.length===0)return;const a=t.getAttribute("data-av-id"),i=[],s=[];n.forEach(o=>{s.push(o.getAttribute("data-id"))}),n.forEach(o=>{var l;const c=qo("block",o.querySelector('.av__cell[data-dtype="block"]'));i.push({action:"insertAttrViewBlock",avID:a,previousID:((l=o.previousElementSibling)==null?void 0:l.getAttribute("data-id"))||"",srcs:[{itemID:Lute.NewNodeID(),id:o.getAttribute("data-id"),isDetached:c.isDetached,content:c.block.content}],blockID:t.dataset.nodeId,groupID:o.parentElement.getAttribute("data-group-id")})});const r=at().format("YYYYMMDDHHmmss");i.push({action:"doUpdateUpdated",id:t.dataset.nodeId,data:t.getAttribute("updated")}),et(e,[{action:"removeAttrViewBlock",srcIDs:s,avID:a},{action:"doUpdateUpdated",id:t.dataset.nodeId,data:r}],i),n.forEach(o=>{o.remove()}),tc(t,e.contentElement.getBoundingClientRect(),"all"),ec(t.querySelector(".av__row")),t.setAttribute("updated",r)},nc=t=>{const e=t.blockElement.getAttribute("data-av-id"),n=[],a=[];new Array(t.count).fill(0).forEach(()=>{const s=Lute.NewNodeID();n.push(s),a.push({itemID:Lute.NewNodeID(),id:s,isDetached:!0,content:""})});const i=at().format("YYYYMMDDHHmmss");et(t.protyle,[{action:"insertAttrViewBlock",avID:e,previousID:t.previousID,srcs:a,blockID:t.blockElement.dataset.nodeId,groupID:t.groupID},{action:"doUpdateUpdated",id:t.blockElement.dataset.nodeId,data:i}],[{action:"removeAttrViewBlock",srcIDs:n,avID:e},{action:"doUpdateUpdated",id:t.blockElement.dataset.nodeId,data:t.blockElement.getAttribute("updated")}]),["gallery","kanban"].includes(t.blockElement.getAttribute("data-av-type"))?C2({blockElement:t.blockElement,protyle:t.protyle,srcIDs:n,previousId:t.previousID,groupID:t.groupID}):Hy({protyle:t.protyle,blockElement:t.blockElement,srcIDs:n,previousId:t.previousID,groupID:t.groupID}),t.blockElement.setAttribute("updated",i)},_v=(t,e,n,a=!0,i)=>{ae("/api/av/searchAttributeView",{keyword:e,excludes:a&&n?[n]:void 0},s=>{let r="";s.data.results.forEach((o,l)=>{const c=o.children&&o.children.length>0&&a;r+=`<div class="b3-list-item b3-list-item--narrow${l===0?" b3-list-item--focus":""}" data-av-id="${o.avID}" data-block-id="${o.blockID}">
    <span class="b3-list-item__toggle b3-list-item__toggle--hl${a?"":" fn__none"}" style="height:auto;align-self: stretch;margin: 4px 0;">
        <svg class="b3-list-item__arrow">${c?'<use xlink:href="#iconRight"></use>':""}</svg>
    </span>
    <span class="fn__space--small"></span>
    <div class="b3-list-item--two fn__flex-1">
        <div class="b3-list-item__first">
            <span class="b3-list-item__text">${he(o.avName||window.siyuan.languages._kernel[267])}</span>
        </div>
        <div class="b3-list-item__meta b3-list-item__showall">${Ge(o.hPath)}</div>
    </div>
    <svg aria-label="${window.siyuan.languages.thisDatabase}" style="margin: 0 0 0 4px" class="b3-list-item__hinticon ariaLabel${o.avID===n?"":" fn__none"}"><use xlink:href="#iconInfo"></use></svg>
</div>`,c&&(r+='<div class="fn__none">',o.children.forEach(d=>{const u=D2(d.viewLayout);r+=`<div style="padding-left: 48px;" class="b3-list-item b3-list-item--narrow" data-av-id="${d.avID}" data-view-id="${d.viewID}">
<span class="b3-list-item__text">${he(d.viewName)}</span> 
<span class="b3-list-item__meta">${u}</span>
</div>`}),r+="</div>")}),t.innerHTML=r,i&&i()})},F2=(t,e,n)=>{e.dataset.avId=n.dataset.avId,e.dataset.blockId=n.dataset.blockId,e.querySelector(".b3-menu__accelerator").textContent=n.querySelector(".b3-list-item__hinticon").classList.contains("fn__none")?n.querySelector(".b3-list-item__text").textContent:window.siyuan.languages.thisDatabase;const a=N(e,"b3-menu__items");a&&Nh(a,t,!0)},Ph=(t,e,n,a=!0)=>{window.siyuan.menus.menu.remove();const i=new ta;i.addItem({iconHTML:"",type:"empty",label:`<div class="fn__flex-column b3-menu__filter"${x()?"":' style="width: 50vw"'} >
    <input class="b3-text-field fn__flex-shrink"/>
    <div class="fn__hr"></div>
    <div class="b3-list fn__flex-1 b3-list--background">
        <img style="margin: 0 auto;display: block;width: 64px;height: 64px" src="/stage/loading-pure.svg">
    </div>
</div>`,bind(r){const o=r.querySelector(".b3-list"),l=r.querySelector("input");l.addEventListener("keydown",c=>{if(!c.isComposing&&(vy(o,c),c.key==="Enter")){c.preventDefault(),c.stopPropagation();const d=o.querySelector(".b3-list-item--focus");n?n(d):F2(t,e,d),window.siyuan.menus.menu.remove()}}),l.addEventListener("input",c=>{c.stopPropagation(),!c.isComposing&&_v(o,l.value,t,a)}),l.addEventListener("compositionend",()=>{_v(o,l.value,t,a)}),r.lastElementChild.addEventListener("click",c=>{let d=c.target;for(;d&&!d.classList.contains("b3-list");){if(d.classList.contains("b3-list-item__toggle")){d.firstElementChild.classList.contains("b3-list-item__arrow--open")?(d.firstElementChild.classList.remove("b3-list-item__arrow--open"),d.parentElement.nextElementSibling.classList.add("fn__none")):(d.firstElementChild.classList.add("b3-list-item__arrow--open"),d.parentElement.nextElementSibling.classList.remove("fn__none")),c.preventDefault(),c.stopPropagation();break}else if(d.classList.contains("b3-list-item")){c.preventDefault(),c.stopPropagation(),n?n(d):F2(t,e,d),window.siyuan.menus.menu.remove();break}d=d.parentElement}}),_v(o,"",t,a,()=>{const c=e.getBoundingClientRect();i.open({x:c.left,y:c.bottom,h:c.height}),r.querySelector("input").focus()})}}),i.element.querySelector(".b3-menu__items").setAttribute("style","overflow: initial");const s=me(e,"block__popover",!0);i.element.setAttribute("data-from",s?s.dataset.level+"popover":"app")},U5=t=>{const e=t.avElement.querySelector('input[data-type="colName"]'),a=t.avElement.querySelector('.b3-menu__item[data-type="goSearchAV"]').getAttribute("data-av-id"),i=t.avElement.querySelector(".b3-menu__item").getAttribute("data-col-id");let s;t.colsData.find(o=>{if(o.id===i)return o.relation||(o.relation={}),s=o,!0});const r=t.avElement.querySelector('[data-type="name"]').value;et(t.protyle,[{action:"updateAttrViewColRelation",avID:t.avID,keyID:i,id:a||s.relation.avID,backRelationKeyID:s.relation.avID===a&&s.relation.backKeyID||Lute.NewNodeID(),isTwoWay:t.avElement.querySelector(".b3-switch").checked,name:e.value,format:r},{action:"doUpdateUpdated",id:t.blockElement.getAttribute("data-node-id"),data:at().format("YYYYMMDDHHmmss")}],[{action:"updateAttrViewColRelation",avID:t.avID,keyID:i,id:s.relation.avID||a,backRelationKeyID:s.relation.backKeyID,isTwoWay:s.relation.isTwoWay,name:e.dataset.oldValue,format:s.name}]),t.avElement.remove(),us(t.blockElement.querySelector(`.av__row--header .av__cell[data-col-id="${i}"]`),void 0,{name:r}),qt(t.blockElement)},Nh=(t,e,n=!1)=>{const a=t.querySelector('.b3-menu__item[data-type="goSearchAV"]'),i=a.nextElementSibling,s=i.querySelector(".b3-switch"),r=i.nextElementSibling,o=r.nextElementSibling,l=JSON.parse(a.dataset.oldValue);if(l.avID){const c=r.querySelector("input");n&&(a.dataset.avId!==l.avID?(c.value="",s.checked=!1):(c.value=c.dataset.oldValue,s.checked=l.isTwoWay)),s.checked?r.classList.remove("fn__none"):r.classList.add("fn__none"),a.dataset.avId&&l.avID!==a.dataset.avId||l.isTwoWay!==s.checked||c.dataset.oldValue!==c.value?o.classList.remove("fn__none"):o.classList.add("fn__none")}else a.dataset.avId&&(s.checked?r.classList.remove("fn__none"):r.classList.add("fn__none"),o.classList.remove("fn__none"))},wv=t=>{const e=t.querySelector(".b3-form__icona .b3-text-field");t.querySelector(".b3-menu__icon.fn__grab")?(e.nextElementSibling.classList.remove("fn__none"),e.style.paddingRight="26px"):(e.nextElementSibling.classList.add("fn__none"),e.style.paddingRight="")},co=t=>{if(t.type==="selected")return`<svg class="b3-menu__icon fn__grab"><use xlink:href="#iconDrag"></use></svg>
<span class="b3-menu__label fn__ellipsis ${t.isDetached?"":" popover__block"}" ${t.isDetached?"":'style="color:var(--b3-protyle-inline-blockref-color)"'} data-id="${t.id}">${t.text}</span>
<svg class="b3-menu__action"><use xlink:href="#iconMin"></use></svg>`;if(t.type==="empty")return t.newName?`<button class="b3-menu__item" data-type="setRelationCell">
    <span class="b3-menu__label fn__ellipsis">${window.siyuan.languages.newRowInRelation.replace("${x}",t.text).replace("${y}",t.newName)}</span>
</button>`:`<button class="b3-menu__item">
    <span class="b3-menu__label">${window.siyuan.languages.emptyContent}</span>
</button>`;if(t.type=="unselect")return`<button data-row-id="${t.rowId}" class="${t.className||"b3-menu__item ariaLabel"}" data-position="west" data-type="setRelationCell">
    <span class="b3-menu__label fn__ellipsis${t.isDetached?"":" popover__block"}" ${t.isDetached?"":'style="color:var(--b3-protyle-inline-blockref-color)"'} data-id="${t.id}">${t.text}</span>
    <svg class="b3-menu__action"><use xlink:href="#iconAdd"></use></svg>
</button>`},P2=(t,e,n)=>{ae("/api/av/getAttributeViewPrimaryKeyValues",{id:t.firstElementChild.getAttribute("data-av-id"),keyword:n},a=>{const i=a.data.rows.values||[];let s="",r="";const o=[];e.querySelectorAll(".av__cell--relation").forEach(c=>{const d=c.querySelector(".av__celltext");o.push(c.dataset.rowId),r+=`<button data-row-id="${c.dataset.rowId}" data-position="west" data-type="setRelationCell" 
class="b3-menu__item ariaLabel${d.textContent.indexOf(n)>-1?"":" fn__none"}" 
draggable="true">${co({type:"selected",id:d.dataset.id,isDetached:!d.classList.contains("av__celltext--ref"),text:Lute.EscapeHTMLStr(d.textContent||window.siyuan.languages.untitled)})}</button>`}),i.forEach(c=>{o.includes(c.blockID)||(s+=co({type:"unselect",rowId:c.blockID,id:c.block.id,isDetached:c.isDetached,text:Lute.EscapeHTMLStr(c.block.content||window.siyuan.languages.untitled)}))});const l=t.querySelector(".popover__block");t.querySelector(".b3-menu__items").innerHTML=`${r}
<button class="b3-menu__separator"></button>
${s}
${n?co({type:"empty",newName:Lute.EscapeHTMLStr(n),text:`<span style="color: var(--b3-protyle-inline-blockref-color);" class="popover__block" data-id="${l.getAttribute("data-id")}">${l.textContent}</span>`}):s?"":co({type:"empty"})}`,t.querySelector(".b3-menu__items .b3-menu__item:not(.fn__none)").classList.add("b3-menu__item--current"),wv(t)})},H5=t=>{ae("/api/av/getAttributeViewPrimaryKeyValues",{id:t.menuElement.firstElementChild.getAttribute("data-av-id"),keyword:""},e=>{const n=e.data.rows.values||[];let a="",i="";const s=[];t.cellElements[0].querySelectorAll(".av__cell--relation").forEach(d=>{const u=d.querySelector(".av__celltext");s.push(d.dataset.rowId),i+=`<button data-row-id="${d.dataset.rowId}" data-position="west" data-type="setRelationCell" class="b3-menu__item ariaLabel" 
draggable="true">${co({type:"selected",id:u.dataset.id,isDetached:!u.classList.contains("av__celltext--ref"),text:Lute.EscapeHTMLStr(u.textContent||window.siyuan.languages.untitled)})}</button>`}),n.forEach(d=>{s.includes(d.blockID)||(a+=co({type:"unselect",rowId:d.blockID,id:d.block.id,isDetached:d.isDetached,text:Lute.EscapeHTMLStr(d.block.content||window.siyuan.languages.untitled)}))}),t.menuElement.querySelector(".b3-menu__items").innerHTML=`${i}
<button class="b3-menu__separator"></button>
${a||co({type:"empty"})}`;const r=t.cellElements[t.cellElements.length-1].getBoundingClientRect();gn(t.menuElement,r.left,r.bottom,r.height),t.menuElement.querySelector(".b3-menu__items .b3-menu__item:not(.fn__none)").classList.add("b3-menu__item--current");const o=t.menuElement.querySelector("input");o.focus();const l=o.parentElement.parentElement.querySelector(".popover__block");l.innerHTML=Lute.EscapeHTMLStr(e.data.name),l.setAttribute("data-id",e.data.blockIDs[0]);const c=t.menuElement.querySelector(".b3-menu__items");o.addEventListener("keydown",d=>{if(d.isComposing)return;pi(c,d,"b3-menu__item--current");const u=t.menuElement.querySelector(".b3-menu__item--current");d.key==="Enter"&&u&&u.getAttribute("data-type")==="setRelationCell"&&(N2(t.protyle,t.blockElement,u,t.cellElements),d.preventDefault(),d.stopPropagation())}),o.addEventListener("input",d=>{d.isComposing||(P2(t.menuElement,t.cellElements[0],o.value),d.stopPropagation())}),o.addEventListener("compositionend",d=>{d.stopPropagation(),P2(t.menuElement,t.cellElements[0],o.value)}),wv(t.menuElement),t.menuElement.querySelector('[data-type="copyRelatedItems"]').addEventListener("click",()=>{let d="";const u=t.menuElement.querySelectorAll('.b3-menu__item[draggable="true"]');u.forEach(g=>{u.length>1&&(d+="- ");const f=g.querySelector(".b3-menu__label");!f.dataset.id||f.dataset.id==="undefined"?d+=f.textContent+`
`:d+=`((${f.dataset.id} "${f.textContent}"))
`}),d&&(ut(d.trimEnd()),Q(window.siyuan.languages.copied))})})},q5=(t,e)=>{let n;return ma(t).find(a=>{if(a.id===$s(e[0],t.viewType))return n=a.relation,!0}),n&&n.avID?`<div data-av-id="${n.avID}" class="fn__flex-column">
<div class="b3-menu__item" data-type="nobg">
    <div class="b3-form__icona fn__flex-1" style="overflow: visible">
        <input class="b3-text-field fn__block" style="min-width: 190px"/>
        <svg class="b3-form__icona-icon ariaLabel fn__none" data-position="north" data-type="copyRelatedItems" aria-label="${window.siyuan.languages.copy} ${window.siyuan.languages.relatedItems}"><use xlink:href="#iconCopy"></use></svg>
    </div>
    <span class="fn__space"></span>
    <span style="color: var(--b3-protyle-inline-blockref-color);max-width: 200px" data-id="" class="popover__block fn__pointer fn__ellipsis"></span>
</div>
<div class="b3-menu__items">
    <img style="margin: 0 auto;display: block;width: 64px;height: 64px" src="/stage/loading-pure.svg">
</div>`:""},N2=(t,e,n,a)=>{const i=N(n,"b3-menu");if(!i||i.querySelector(".dragover__bottom, .dragover__top"))return;if(!e.contains(a[0])){const r=e.getAttribute("data-av-type"),o=Pr(a[0],r);r==="table"?a[0]=e.querySelector(`.av__row[data-id="${o}"] .av__cell[data-col-id="${a[0].dataset.colId}"]`)||e.querySelector(`.fn__flex-1[data-col-id="${a[0].dataset.colId}"]`):a[0]=e.querySelector(`.av__gallery-item[data-id="${o}"] .av__cell[data-field-id="${a[0].dataset.fieldId}"]`)}const s={blockIDs:[],contents:[]};if(i.querySelectorAll('[draggable="true"]').forEach(r=>{const o=r.getAttribute("data-row-id"),l=r.querySelector(".b3-menu__label");s.blockIDs.push(o),s.contents.push({type:"block",block:{id:l.getAttribute("data-id"),content:l.textContent},isDetached:!l.classList.contains("popover__block")})}),n.classList.contains("b3-menu__item")){const r=n.getAttribute("data-row-id"),o=n.querySelector(".b3-menu__label").getAttribute("data-id"),l=i.querySelector(".b3-menu__separator"),c=i.querySelector("input").value;if(n.getAttribute("draggable")){!l.nextElementSibling.getAttribute("data-row-id")&&!c&&l.nextElementSibling.remove();const d=s.blockIDs.indexOf(r);s.blockIDs.splice(d,1),s.contents.splice(d,1),l.after(n),n.outerHTML=co({type:"unselect",rowId:r,id:o,isDetached:!n.querySelector(".popover__block"),text:Lute.EscapeHTMLStr(n.querySelector(".b3-menu__label").textContent),className:n.className})}else if(r)s.blockIDs.push(r),s.contents.push({type:"block",block:{id:o,content:n.firstElementChild.textContent},isDetached:!n.firstElementChild.getAttribute("style")}),l.before(n),n.outerHTML=`<button data-row-id="${r}" data-position="west" data-type="setRelationCell" class="${n.className}" 
draggable="true">${co({type:"selected",rowId:r,id:o,isDetached:!n.querySelector(".popover__block"),text:Lute.EscapeHTMLStr(n.querySelector(".b3-menu__label").textContent)})}</button>`,l.nextElementSibling||l.insertAdjacentHTML("afterend",co({type:"empty"}));else{const d=n.querySelector(".popover__block").getAttribute("data-id"),u=n.querySelector("b").textContent,g=Lute.NewNodeID(),f=N(a[0],"av__body");et(t,[{action:"insertAttrViewBlock",avID:i.firstElementChild.getAttribute("data-av-id"),srcs:[{itemID:g,id:Lute.NewNodeID(),isDetached:!0,content:u}],blockID:d,groupID:f?f.getAttribute("data-group-id"):""},{action:"doUpdateUpdated",id:d,data:at().format("YYYYMMDDHHmmss")}]),s.blockIDs.push(g),s.contents.push({type:"block",block:{content:u},isDetached:!0}),l.insertAdjacentHTML("beforebegin",`<button data-row-id="${g}" data-position="west" data-type="setRelationCell" 
class="${n.className} ariaLabel" draggable="true">${co({type:"selected",rowId:g,isDetached:!0,text:Lute.EscapeHTMLStr(u)})}</button>`)}}fs(t,e,s,a),wv(i)},vv=t=>{const e=[];t.forEach(n=>{const a=n.getAttribute("data-node-id");a&&e.push({itemID:Lute.NewNodeID(),id:a,isDetached:!1})}),e.length>0&&Ph("",t[0],n=>{const a=n.dataset.avId,i=n.dataset.viewId;et(void 0,[{action:"insertAttrViewBlock",ignoreDefaultFill:!i,viewID:i,avID:a,srcs:e,blockID:n.dataset.blockId},{action:"doUpdateUpdated",id:n.dataset.blockId,data:at().format("YYYYMMDDHHmmss")}])})},qy=(t,e,n)=>{var a,i;if(e&&((i=(a=t.title)==null?void 0:a.editElement)!=null&&i.contains(e.startContainer))||n==="title")Ph("",t.breadcrumb.element,s=>{const r=s.dataset.avId,o=s.dataset.viewId;et(t,[{action:"insertAttrViewBlock",ignoreDefaultFill:!o,viewID:o,avID:r,srcs:[{itemID:Lute.NewNodeID(),id:t.block.rootID,isDetached:!1}],blockID:s.dataset.blockId},{action:"doUpdateUpdated",id:s.dataset.blockId,data:at().format("YYYYMMDDHHmmss")}],[{action:"removeAttrViewBlock",srcIDs:[t.block.rootID],avID:r}]),Pt(e)});else{let s;const r=[];if(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select").forEach(o=>{s||(s=o),r.push(o.getAttribute("data-node-id"))}),!s){const o=oe(e.startContainer);o&&(s=o,r.push(o.getAttribute("data-node-id")))}s||(s=t.wysiwyg.element,r.push(t.block.rootID)),Ph("",s,o=>{const l=[],c=[];r.forEach(g=>{l.push(g),c.push({itemID:Lute.NewNodeID(),id:g,isDetached:!1})});const d=o.dataset.avId,u=o.dataset.viewId;et(t,[{action:"insertAttrViewBlock",ignoreDefaultFill:!u,viewID:u,avID:d,srcs:c,blockID:o.dataset.blockId},{action:"doUpdateUpdated",id:o.dataset.blockId,data:at().format("YYYYMMDDHHmmss")}],[{action:"removeAttrViewBlock",srcIDs:l,avID:d}]),Pt(e)})}};var B2=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const $2=(t,e)=>{if(window.siyuan.menus.menu.element.setAttribute("data-from",p.MENU_FROM_DOC_TREE_MORE_ITEMS),!Array.from(t).find(i=>{if(i.getAttribute("data-type")==="navigation-file")return!0}))return window.siyuan.menus.menu;const a=[];if(t.forEach(i=>{const s=i.getAttribute("data-node-id");s&&a.push(s)}),a.length>0&&window.siyuan.menus.menu.append(new xe({id:"copy",label:window.siyuan.languages.copy,type:"submenu",icon:"iconCopy",submenu:sc(a).concat([{id:"duplicate",iconHTML:"",label:window.siyuan.languages.duplicate,accelerator:window.siyuan.config.keymap.editor.general.duplicate.custom,click(){a.forEach(i=>{ae("/api/filetree/duplicateDoc",{id:i})})}}])}).element),window.siyuan.menus.menu.append(ix(of(Array.from(t)))),a.length>0&&window.siyuan.menus.menu.append(new xe({id:"addToDatabase",label:window.siyuan.languages.addToDatabase,accelerator:window.siyuan.config.keymap.general.addToDatabase.custom,icon:"iconDatabase",click:()=>{vv(Array.from(t))}}).element),window.siyuan.menus.menu.append(new xe({id:"delete",icon:"iconTrashcan",label:window.siyuan.languages.delete,accelerator:"\u2326",click:()=>{Ly(Array.from(t))}}).element),a.length===0)return window.siyuan.menus.menu;if(window.siyuan.menus.menu.append(new xe({id:"separator_1",type:"separator"}).element),!window.siyuan.config.readonly){const i=[{id:"quickMakeCard",iconHTML:"",accelerator:window.siyuan.config.keymap.editor.general.quickMakeCard.custom,label:window.siyuan.languages.quickMakeCard,click:()=>{et(void 0,[{action:"addFlashcards",deckID:p.QUICK_DECK_ID,blockIDs:a}],[{action:"removeFlashcards",deckID:p.QUICK_DECK_ID,blockIDs:a}])}},{id:"removeCard",iconHTML:"",label:window.siyuan.languages.removeCard,click:()=>{et(void 0,[{action:"removeFlashcards",deckID:p.QUICK_DECK_ID,blockIDs:a}],[{action:"addFlashcards",deckID:p.QUICK_DECK_ID,blockIDs:a}])}}];window.siyuan.config.flashcard.deck&&i.push({id:"addToDeck",iconHTML:"",label:window.siyuan.languages.addToDeck,click:()=>{Ih(e,a)}}),window.siyuan.menus.menu.append(new xe({id:"riffCard",label:window.siyuan.languages.riffCard,icon:"iconRiffCard",submenu:i}).element),window.siyuan.menus.menu.append(new xe({id:"separator_2",type:"separator"}).element)}return mh(e,a),window.siyuan.menus.menu.append(new xe({id:"export",label:window.siyuan.languages.export,type:"submenu",icon:"iconUpload",submenu:[{id:"exportMarkdown",label:"Markdown .zip",icon:"iconMarkdown",click:()=>{const i=Q(window.siyuan.languages.exporting,-1);ae(" /api/export/exportMds",{ids:a},s=>{ot(i),$e(s.data.zip)})}}]}).element),e.plugins&&Is({plugins:e.plugins,type:"open-menu-doctree",detail:{elements:t,type:"docs"},separatorPosition:"top"}),window.siyuan.menus.menu},Wy=(t,e)=>{window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_DOC_TREE_MORE);const n=A(e,"DIV");if(!n)return window.siyuan.menus.menu;e.classList.contains("b3-list-item--focus")||(n.querySelectorAll(".b3-list-item--focus").forEach(r=>{r.classList.remove("b3-list-item--focus"),r.removeAttribute("select-end"),r.removeAttribute("select-start")}),e.classList.add("b3-list-item--focus"));const a=n.querySelectorAll(".b3-list-item--focus");if(a.length>1)return $2(a,t);window.siyuan.menus.menu.element.setAttribute("data-from",p.MENU_FROM_DOC_TREE_MORE_NOTEBOOK);const i=e.parentElement.getAttribute("data-url"),s=Ds(i);if(!window.siyuan.config.readonly){window.siyuan.menus.menu.append(OS({path:"/",notebookId:i,name:s,type:"notebook"})),window.siyuan.menus.menu.append(new xe({id:"config",label:window.siyuan.languages.config,icon:"iconSettings",click:()=>{ae("/api/notebook/getNotebookConf",{notebook:i},o=>{I5(o.data)})}}).element);const r=R2("notebook",parseInt(e.parentElement.getAttribute("data-sortmode")),o=>(ae("/api/notebook/setNotebookConf",{notebook:i,conf:{sortMode:o}},()=>{var l;e.parentElement.setAttribute("data-sortmode",o.toString());let c;c=Vn("file").data.file;const d=e.querySelector(".b3-list-item__arrow--open");d&&(d.classList.remove("b3-list-item__arrow--open"),(l=e.nextElementSibling)==null||l.remove(),c.getLeaf(e,i))}),!0));window.siyuan.menus.menu.append(new xe({id:"sort",icon:"iconSort",label:window.siyuan.languages.sort,type:"submenu",submenu:r}).element)}return window.siyuan.config.readonly||window.siyuan.menus.menu.append(new xe({id:"riffCard",label:window.siyuan.languages.riffCard,type:"submenu",icon:"iconRiffCard",submenu:[{id:"spaceRepetition",iconHTML:"",label:window.siyuan.languages.spaceRepetition,accelerator:window.siyuan.config.keymap.editor.general.spaceRepetition.custom,click:()=>{ae("/api/riff/getNotebookRiffDueCards",{notebook:i},r=>{Sd(t,r.data,"notebook",i,s)})}},{id:"manage",iconHTML:"",label:window.siyuan.languages.manage,click:()=>{vf(t,i,s,"Notebook")}}]}).element),window.siyuan.menus.menu.append(new xe({id:"search",label:window.siyuan.languages.search,accelerator:window.siyuan.config.keymap.general.search.custom,icon:"iconSearch",click(){ds({app:t,hotkey:p.DIALOG_SEARCH,notebookId:i})}}).element),window.siyuan.config.readonly||window.siyuan.menus.menu.append(new xe({id:"replace",label:window.siyuan.languages.replace,accelerator:window.siyuan.config.keymap.general.replace.custom,icon:"iconReplace",click(){ds({app:t,hotkey:p.DIALOG_REPLACE,notebookId:i})}}).element),window.siyuan.config.readonly||(window.siyuan.menus.menu.append(new xe({id:"separator_1",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"close",label:window.siyuan.languages.close,icon:"iconClose",click:()=>{ae("/api/notebook/closeNotebook",{notebook:i})}}).element),window.siyuan.menus.menu.append(new xe({id:"delete",icon:"iconTrashcan",label:window.siyuan.languages.delete,accelerator:"\u2326",click:()=>{Ly(Array.from(n.querySelectorAll(".b3-list-item--focus")))}}).element)),window.siyuan.menus.menu.append(new xe({id:"separator_2",type:"separator"}).element),O2(i,"/"),window.siyuan.menus.menu.append(new xe({id:"export",label:window.siyuan.languages.export,type:"submenu",icon:"iconUpload",submenu:[{id:"exportSiYuanZip",label:"SiYuan .sy.zip",icon:"iconSiYuan",click:()=>{const r=Q(window.siyuan.languages.exporting,-1);ae("/api/export/exportNotebookSY",{id:i},o=>{ot(r),$e(o.data.zip)})}},{id:"exportMarkdown",label:"Markdown .zip",icon:"iconMarkdown",click:()=>{const r=Q(window.siyuan.languages.exporting,-1);ae("/api/export/exportNotebookMd",{notebook:i},o=>{ot(r),$e(o.data.zip)})}}]}).element),t.plugins&&Is({plugins:t.plugins,type:"open-menu-doctree",detail:{elements:a,type:"notebook"},separatorPosition:"top"}),window.siyuan.menus.menu},Vy=(t,e,n,a)=>{window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_DOC_TREE_MORE);const i=A(a,"DIV");if(!i)return window.siyuan.menus.menu;a.classList.contains("b3-list-item--focus")||(i.querySelectorAll(".b3-list-item--focus").forEach(l=>{l.classList.remove("b3-list-item--focus"),l.removeAttribute("select-end"),l.removeAttribute("select-start")}),a.classList.add("b3-list-item--focus"));const s=i.querySelectorAll(".b3-list-item--focus");if(s.length>1)return $2(s,t);const r=a.getAttribute("data-node-id");let o=a.getAttribute("data-name");if(o=ha(o,!1,!0),!window.siyuan.config.readonly){let l,c;const d=pe(a,"UL");if((window.siyuan.config.fileTree.sort===6||d&&d.dataset.sortmode==="6")&&(window.siyuan.menus.menu.append(new xe({id:"newDocAbove",icon:"iconBefore",label:window.siyuan.languages.newDocAbove,click:()=>{const u=[];Array.from(a.parentElement.children).forEach(g=>{g.tagName==="LI"&&(g===a&&u.push(void 0),u.push(g.getAttribute("data-path")))}),Oo({app:t,notebookId:e,currentPath:_n().dirname(n),paths:u,useSavePath:!1,listDocTree:!0})}}).element),window.siyuan.menus.menu.append(new xe({id:"newDocBelow",icon:"iconAfter",label:window.siyuan.languages.newDocBelow,click:()=>{const u=[];Array.from(a.parentElement.children).forEach(g=>{g.tagName==="LI"&&(u.push(g.getAttribute("data-path")),g===a&&u.push(void 0))}),Oo({app:t,notebookId:e,currentPath:_n().dirname(n),paths:u,useSavePath:!1,listDocTree:!0})}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_1",type:"separator"}).element)),window.siyuan.menus.menu.append(new xe({id:"copy",label:window.siyuan.languages.copy,type:"submenu",icon:"iconCopy",submenu:sc([r]).concat([{id:"duplicate",iconHTML:"",label:window.siyuan.languages.duplicate,accelerator:window.siyuan.config.keymap.editor.general.duplicate.custom,click(){ae("/api/filetree/duplicateDoc",{id:r})}}])}).element),window.siyuan.menus.menu.append(ix(of(Array.from(i.querySelectorAll(".b3-list-item--focus"))))),window.siyuan.menus.menu.append(new xe({id:"addToDatabase",label:window.siyuan.languages.addToDatabase,accelerator:window.siyuan.config.keymap.general.addToDatabase.custom,icon:"iconDatabase",click:()=>{vv([a])}}).element),window.siyuan.menus.menu.append(new xe({id:"delete",icon:"iconTrashcan",label:window.siyuan.languages.delete,accelerator:"\u2326",click:()=>{Ly(Array.from(i.querySelectorAll(".b3-list-item--focus")))}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_2",type:"separator"}).element),window.siyuan.menus.menu.append(OS({path:n,notebookId:e,name:o,type:"file"})),window.siyuan.menus.menu.append(new xe({id:"attr",label:window.siyuan.languages.attr,icon:"iconAttr",click(){ae("/api/block/getDocInfo",{id:r},u=>{Zs(u.data.ial)})}}).element),!window.siyuan.config.readonly){const u=[{id:"spaceRepetition",iconHTML:"",label:window.siyuan.languages.spaceRepetition,accelerator:window.siyuan.config.keymap.editor.general.spaceRepetition.custom,click:()=>{ae("/api/riff/getTreeRiffDueCards",{rootID:r},g=>{Sd(t,g.data,"doc",r,o)})}},{id:"manage",iconHTML:"",label:window.siyuan.languages.manage,click:()=>{ae("/api/filetree/getHPathByID",{id:r},g=>{vf(t,r,_n().join(Ds(e),g.data),"Tree")})}},{id:"quickMakeCard",iconHTML:"",accelerator:window.siyuan.config.keymap.editor.general.quickMakeCard.custom,label:window.siyuan.languages.quickMakeCard,click:()=>{et(void 0,[{action:"addFlashcards",deckID:p.QUICK_DECK_ID,blockIDs:[r]}],[{action:"removeFlashcards",deckID:p.QUICK_DECK_ID,blockIDs:[r]}])}},{id:"removeCard",iconHTML:"",label:window.siyuan.languages.removeCard,click:()=>{et(void 0,[{action:"removeFlashcards",deckID:p.QUICK_DECK_ID,blockIDs:[r]}],[{action:"addFlashcards",deckID:p.QUICK_DECK_ID,blockIDs:[r]}])}}];window.siyuan.config.flashcard.deck&&u.push({id:"addToDeck",iconHTML:"",label:window.siyuan.languages.addToDeck,click:()=>{Ih(t,[r])}}),window.siyuan.menus.menu.append(new xe({id:"riffCard",label:window.siyuan.languages.riffCard,type:"submenu",icon:"iconRiffCard",submenu:u}).element)}window.siyuan.menus.menu.append(new xe({id:"search",label:window.siyuan.languages.search,icon:"iconSearch",accelerator:window.siyuan.config.keymap.general.search.custom,click(){return B2(this,null,function*(){const u=ha(n,!1,!0);ds({app:t,hotkey:p.DIALOG_SEARCH,notebookId:e,searchPath:u})})}}).element),window.siyuan.menus.menu.append(new xe({id:"replace",label:window.siyuan.languages.replace,accelerator:window.siyuan.config.keymap.general.replace.custom,icon:"iconReplace",click(){return B2(this,null,function*(){const u=ha(n,!1,!0);ds({app:t,hotkey:p.DIALOG_REPLACE,notebookId:e,searchPath:u})})}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_3",type:"separator"}).element)}return mh(t,[r],e,n),window.siyuan.config.readonly||window.siyuan.menus.menu.append(new xe({id:"fileHistory",label:window.siyuan.languages.fileHistory,icon:"iconHistory",click(){x2({app:t,id:r,notebookId:e,pathString:o})}}).element),O2(e,n),window.siyuan.menus.menu.append($S(r)),t.plugins&&Is({plugins:t.plugins,type:"open-menu-doctree",detail:{elements:s,type:"doc"},separatorPosition:"top"}),window.siyuan.menus.menu.element.setAttribute("data-from",p.MENU_FROM_DOC_TREE_MORE_DOC),window.siyuan.menus.menu},O2=(t,e)=>{if(window.siyuan.config.readonly)return;const n=()=>{let a;a=Vn("file").data.file;const i=a.element.querySelector(`[data-path="${e}"]`);i.querySelector(".b3-list-item__toggle").classList.remove("fn__hidden"),a.getLeaf(i,t,!0),window.siyuan.menus.menu.remove()};window.siyuan.menus.menu.append(new xe({id:"import",icon:"iconDownload",label:window.siyuan.languages.import,submenu:[{id:"importSiYuanZip",icon:"iconSiYuan",label:'SiYuan .sy.zip<input class="b3-form__upload" type="file" accept="application/zip">',bind:a=>{a.querySelector(".b3-form__upload").addEventListener("change",i=>{const s=new FormData;s.append("file",i.target.files[0]),s.append("notebook",t),s.append("toPath",e),ae("/api/import/importSY",s,()=>{n()})})}},{id:"importMarkdownZip",icon:"iconMarkdown",label:'Markdown .zip<input class="b3-form__upload" type="file" accept="application/zip">',bind:a=>{a.querySelector(".b3-form__upload").addEventListener("change",i=>{const s=new FormData;s.append("file",i.target.files[0]),s.append("notebook",t),s.append("toPath",e),ae("/api/import/importZipMd",s,()=>{n()})})}}]}).element)},R2=(t,e,n)=>{const a=[{id:"fileNameASC",icon:e===0?"iconSelect":void 0,label:window.siyuan.languages.fileNameASC,click:()=>{n(0)}},{id:"fileNameDESC",icon:e===1?"iconSelect":void 0,label:window.siyuan.languages.fileNameDESC,click:()=>{n(1)}},{id:"fileNameNatASC",icon:e===4?"iconSelect":void 0,label:window.siyuan.languages.fileNameNatASC,click:()=>{n(4)}},{id:"fileNameNatDESC",icon:e===5?"iconSelect":void 0,label:window.siyuan.languages.fileNameNatDESC,click:()=>{n(5)}},{id:"separator_1",type:"separator"},{id:"createdASC",icon:e===9?"iconSelect":void 0,label:window.siyuan.languages.createdASC,click:()=>{n(9)}},{id:"createdDESC",icon:e===10?"iconSelect":void 0,label:window.siyuan.languages.createdDESC,click:()=>{n(10)}},{id:"modifiedASC",icon:e===2?"iconSelect":void 0,label:window.siyuan.languages.modifiedASC,click:()=>{n(2)}},{id:"modifiedDESC",icon:e===3?"iconSelect":void 0,label:window.siyuan.languages.modifiedDESC,click:()=>{n(3)}},{id:"separator_2",type:"separator"},{id:"refCountASC",icon:e===7?"iconSelect":void 0,label:window.siyuan.languages.refCountASC,click:()=>{n(7)}},{id:"refCountDESC",icon:e===8?"iconSelect":void 0,label:window.siyuan.languages.refCountDESC,click:()=>{n(8)}},{id:"separator_3",type:"separator"},{id:"docSizeASC",icon:e===11?"iconSelect":void 0,label:window.siyuan.languages.docSizeASC,click:()=>{n(11)}},{id:"docSizeDESC",icon:e===12?"iconSelect":void 0,label:window.siyuan.languages.docSizeDESC,click:()=>{n(12)}},{id:"separator_4",type:"separator"},{id:"subDocCountASC",icon:e===13?"iconSelect":void 0,label:window.siyuan.languages.subDocCountASC,click:()=>{n(13)}},{id:"subDocCountDESC",icon:e===14?"iconSelect":void 0,label:window.siyuan.languages.subDocCountDESC,click:()=>{n(14)}},{id:"separator_5",type:"separator"},{id:"customSort",icon:e===6?"iconSelect":void 0,label:window.siyuan.languages.customSort,click:()=>{n(6)}}];return t==="notebook"&&a.push({id:"sortByFiletree",icon:e===15?"iconSelect":void 0,label:window.siyuan.languages.sortByFiletree,click:()=>{n(15)}}),a},zy=(t,e)=>{ae("/api/filetree/createDailyNote",{notebook:e,app:p.SIYUAN_APPID},n=>{dn({app:t,id:n.data.id,action:[p.CB_GET_FOCUS]})})},xv=t=>{if(window.siyuan.dialogs.find(s=>{if(s.element.getAttribute("data-key")===p.DIALOG_DIALYNOTE)return s.destroy(),!0}))return;const n=cf();if(n===0){Q(window.siyuan.languages.newFileTip);return}if(n===1){let s="";window.siyuan.notebooks.find(r=>{r.closed||(s=r.id)}),zy(t,s);return}const a=window.siyuan.storage[p.LOCAL_DAILYNOTEID],i=window.siyuan.notebooks.find(s=>{if(s.id===a&&!s.closed)return!0});if(a&&i&&!x())zy(t,a);else{let s="";window.siyuan.notebooks.forEach(c=>{c.closed||(s+=`<option value="${c.id}">${c.name}</option>`)});const r=new fe({positionId:p.DIALOG_DIALYNOTE,title:window.siyuan.languages.plsChoose,content:`<div class="b3-dialog__content">
    <select class="b3-select fn__block">${s}</select>
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"});r.element.setAttribute("data-key",p.DIALOG_DIALYNOTE);const o=r.element.querySelectorAll(".b3-button"),l=r.element.querySelector(".b3-select");l.value=a,o[0].addEventListener("click",()=>{r.destroy()}),o[1].addEventListener("click",()=>{const c=l.value;window.siyuan.storage[p.LOCAL_DAILYNOTEID]=c,Gt(p.LOCAL_DAILYNOTEID,window.siyuan.storage[p.LOCAL_DAILYNOTEID]),zy(t,c),r.destroy()})}},U2=()=>{const t=new fe({title:window.siyuan.languages.newNotebook,content:`<div class="b3-dialog__content">
    <input placeholder="${window.siyuan.languages.notebookName}" class="b3-text-field fn__block">
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"});t.element.setAttribute("data-key",p.DIALOG_CREATENOTEBOOK);const e=t.element.querySelectorAll(".b3-button");t.bindInput(t.element.querySelector("input"),()=>{e[1].dispatchEvent(new CustomEvent("click"))}),e[0].addEventListener("click",()=>{t.destroy()}),e[1].addEventListener("click",()=>{const n=t.element.querySelector("input").value;if(!xd(n))return!1;ae("/api/notebook/createNotebook",{name:n},a=>{var i;a.code===0&&((i=a.data)!=null&&i.notebook)&&fr(()=>{var s,r;const o=(r=(s=Vn("file"))==null?void 0:s.data)==null?void 0:r.file;o instanceof js&&o.init(!1)})}),t.destroy()})};var Ev=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class js extends Wa{constructor(e){super({app:e.app,type:"filetree",id:e.tab.id,msgCallback(a){if(a)switch(a.cmd){case"reloadDocInfo":this.updateDocInfo(a);break;case"moveDoc":this.onMove(a);break;case"reloadFiletree":fr(()=>{this.init(!1)});break;case"mount":this.onMount(a),e.app.plugins.forEach(i=>{i.eventBus.emit("opened-notebook",a)});break;case"createnotebook":this.onCreateNotebook(a);break;case"unmount":this.onRemove(a),e.app.plugins.forEach(i=>{i.eventBus.emit("closed-notebook",a)});break;case"removeDoc":this.onRemove(a);break;case"create":this.selectItem(a.data.box.id,a.data.path);break;case"createdailynote":case"heading2doc":case"li2doc":this.selectItem(a.data.box.id,a.data.path);break;case"renamenotebook":this.element.querySelector(`[data-url="${a.data.box}"] .b3-list-item__text`).innerHTML=he(a.data.name);break;case"rename":this.onRename(a.data);break}}}),this.lastSelectedElement=null,e.tab.panelElement.classList.add("fn__flex-column","file-tree","sy__file"),e.tab.panelElement.innerHTML=`<div class="block__icons">
    <div class="block__logo">
        <svg class="block__logoicon"><use xlink:href="#iconFiles"></use></svg>${window.siyuan.languages.fileTree}
    </div>
    <span class="fn__flex-1 fn__space"></span>
    <span data-type="focus" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.selectOpen1}${un(window.siyuan.config.keymap.general.selectOpen1.custom)}"><svg><use xlink:href='#iconFocus'></use></svg></span>
    <span class="fn__space"></span>
    <span data-type="collapse" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.collapse}${un(window.siyuan.config.keymap.editor.general.collapse.custom)}">
        <svg><use xlink:href="#iconContract"></use></svg>
    </span>
    <div class="fn__space${window.siyuan.config.readonly?" fn__none":""}"></div>
    <div data-type="more" class="b3-tooltips b3-tooltips__sw block__icon${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.more}">
        <svg><use xlink:href="#iconMore"></use></svg>
    </div> 
    <span class="fn__space"></span>
    <span data-type="min" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.min}${un(window.siyuan.config.keymap.general.closeTab.custom)}"><svg><use xlink:href='#iconMin'></use></svg></span>
</div>
<div class="fn__flex-1" style="padding-top: 2px;"></div>
<ul class="b3-list fn__flex-column" style="min-height: auto;height:30px;transition: height  .2s cubic-bezier(0, 0, .2, 1) 0ms">
    <li class="b3-list-item" data-type="toggle">
        <span class="b3-list-item__toggle">
            <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>
        </span>
        <span class="b3-list-item__text">${window.siyuan.languages.closeNotebook}</span>
        <span class="counter" style="cursor: auto"></span>
    </li>
    <ul class="fn__none fn__flex-1"></ul>
</ul>`,this.actionsElement=e.tab.panelElement.firstElementChild,this.element=this.actionsElement.nextElementSibling,this.closeElement=e.tab.panelElement.lastElementChild,this.closeElement.addEventListener("click",a=>{ca(this.element.parentElement);let i=a.target;for(;i&&!i.isEqualNode(this.closeElement);){const s=i.getAttribute("data-type");if(i.classList.contains("b3-list-item__icon")){a.preventDefault(),a.stopPropagation();const r=i.getBoundingClientRect();Va(i.parentElement.getAttribute("data-url"),"notebook",{x:r.left,y:r.bottom,h:r.height,w:r.width},void 0,i.querySelector("img"));break}else if(s==="toggle"){const r=i.querySelector("svg");r.classList.contains("b3-list-item__arrow--open")?(this.closeElement.style.height="30px",r.classList.remove("b3-list-item__arrow--open"),this.closeElement.lastElementChild.classList.add("fn__none")):(this.closeElement.style.height="40%",r.classList.add("b3-list-item__arrow--open"),this.closeElement.lastElementChild.classList.remove("fn__none")),window.siyuan.menus.menu.remove(),a.stopPropagation(),a.preventDefault();break}else if(s==="open"){ae("/api/notebook/openNotebook",{notebook:i.getAttribute("data-url")}),window.siyuan.menus.menu.remove(),a.stopPropagation(),a.preventDefault();break}i=i.parentElement}}),this.actionsElement.querySelector('[data-type="collapse"]').addEventListener("click",()=>{Array.from(this.element.children).forEach(a=>{const i=a.firstElementChild,s=i.querySelector(".b3-list-item__arrow");s.classList.contains("b3-list-item__arrow--open")&&(s.classList.remove("b3-list-item__arrow--open"),i.nextElementSibling.remove())}),window.siyuan.storage[p.LOCAL_FILESPATHS]=[],Gt(p.LOCAL_FILESPATHS,[])}),this.actionsElement.addEventListener("click",a=>{let i=a.target;for(;i&&!i.isEqualNode(this.actionsElement);){const s=i.getAttribute("data-type");if(s==="min"){Vn("file").toggleModel("file",!1,!0),a.preventDefault(),a.stopPropagation(),window.siyuan.menus.menu.remove();break}else if(s==="focus"){AA(),a.preventDefault();break}else if(s==="more"){this.initMoreMenu().popup({x:a.clientX,y:a.clientY}),a.preventDefault(),a.stopPropagation();break}i=i.parentElement}ca(this.element.parentElement)}),this.element.addEventListener("mousedown",a=>{if(a.button!==1||!window.siyuan.config.fileTree.openFilesUseCurrentTab)return;let i=a.target;for(;i&&!i.isEqualNode(this.element);){if(i.tagName==="LI"&&!i.getAttribute("data-opening")){i.setAttribute("data-opening","true"),dn({app:e.app,removeCurrentTab:!1,id:i.getAttribute("data-node-id"),action:[p.CB_GET_FOCUS,p.CB_GET_SCROLL],afterOpen(){i.removeAttribute("data-opening")}}),a.stopPropagation(),a.preventDefault();break}i=i.parentElement}}),this.element.addEventListener("click",a=>{var i,s;let r=a.target;const o=pe(r,"UL");let l=!0;if(o){const c=o.getAttribute("data-url");for(;r&&!r.isEqualNode(this.element);){if(ct(a)&&r.classList.contains("b3-list-item__icon")&&window.siyuan.config.system.container!=="ios"){a.preventDefault(),a.stopPropagation();const d=r.getBoundingClientRect();r.parentElement.getAttribute("data-type")==="navigation-file"?Va(r.parentElement.getAttribute("data-node-id"),"doc",{x:d.left,y:d.bottom,h:d.height,w:d.width},void 0,r.querySelector("img")):Va(r.parentElement.parentElement.getAttribute("data-url"),"notebook",{x:d.left,y:d.bottom,h:d.height,w:d.width},void 0,r.querySelector("img"));break}else if(ct(a)&&r.classList.contains("b3-list-item__toggle")){this.getLeaf(r.parentElement,c),a.preventDefault(),a.stopPropagation(),window.siyuan.menus.menu.remove();break}else if(ct(a)&&r.classList.contains("b3-list-item__action")){const d=r.getAttribute("data-type"),u=r.parentElement.getAttribute("data-path");window.siyuan.config.readonly||(d==="new"?Oo({app:e.app,notebookId:c,currentPath:u,useSavePath:!1,listDocTree:!0}):d==="more-root"?Wy(e.app,r.parentElement).popup({x:a.clientX,y:a.clientY}):d==="addLocal"&&(ae("/api/filetree/moveLocalShorthands",{notebook:c}),this.element.querySelectorAll('[data-type="addLocal"]').forEach(g=>{g.remove()}))),d==="more-file"&&Vy(e.app,c,u,r.parentElement).popup({x:a.clientX,y:a.clientY}),a.preventDefault(),a.stopPropagation();break}else if(r.tagName==="LI"){if(je(a)&&!a.altKey&&!a.shiftKey)r.classList.toggle("b3-list-item--focus"),this.lastSelectedElement=r;else if(a.shiftKey&&!a.altKey&&ct(a)){document.contains(this.lastSelectedElement)||(this.lastSelectedElement=null),this.lastSelectedElement||(this.lastSelectedElement=this.element.querySelector(".b3-list-item--focus")),this.lastSelectedElement||(this.lastSelectedElement=r.parentElement.firstElementChild),this.element.querySelectorAll(".b3-list-item--focus").forEach(m=>{m.classList.remove("b3-list-item--focus")});const d=Array.from(this.element.querySelectorAll("li.b3-list-item")),u=d.indexOf(this.lastSelectedElement),g=d.indexOf(r),f=Math.min(u,g),h=Math.max(u,g);for(let m=f;m<=h;m++)d[m].classList.add("b3-list-item--focus")}else if(this.lastSelectedElement=r,this.setCurrent(r,!1),r.getAttribute("data-type")==="navigation-file"){if(l=!1,r.getAttribute("data-opening"))return;r.setAttribute("data-opening","true"),a.altKey&&ct(a)&&!a.shiftKey?dn({app:e.app,id:r.getAttribute("data-node-id"),position:"right",action:[p.CB_GET_FOCUS,p.CB_GET_SCROLL],afterOpen(){r.removeAttribute("data-opening")}}):!a.altKey&&je(a)&&a.shiftKey?dn({app:e.app,id:r.getAttribute("data-node-id"),position:"bottom",action:[p.CB_GET_FOCUS,p.CB_GET_SCROLL],afterOpen(){r.removeAttribute("data-opening")}}):window.siyuan.config.fileTree.openFilesUseCurrentTab&&a.altKey&&je(a)&&!a.shiftKey?dn({app:e.app,removeCurrentTab:!1,id:r.getAttribute("data-node-id"),action:[p.CB_GET_FOCUS,p.CB_GET_SCROLL],afterOpen(){r.removeAttribute("data-opening")}}):dn({app:e.app,id:r.getAttribute("data-node-id"),action:[p.CB_GET_FOCUS,p.CB_GET_SCROLL],afterOpen(){r.removeAttribute("data-opening")}})}else r.getAttribute("data-type")==="navigation-root"&&this.getLeaf(r,c);(i=this.element.querySelector('[select-end="true"]'))==null||i.removeAttribute("select-end"),(s=this.element.querySelector('[select-start="true"]'))==null||s.removeAttribute("select-start"),window.siyuan.menus.menu.remove(),a.stopPropagation(),a.preventDefault();break}r=r.parentElement}}l&&ca(this.element.parentElement)}),this.element.addEventListener("dragstart",a=>{if(R()){a.stopPropagation(),a.preventDefault();return}window.getSelection().removeAllRanges(),Pa();const i=A(a.target,"LI");if(i){this.parent.panelElement.classList.add("sy__file--disablehover");let s=Array.from(this.element.querySelectorAll(".b3-list-item--focus"));i.classList.contains("b3-list-item--focus")||(s.forEach(l=>{l.classList.remove("b3-list-item--focus")}),i.classList.add("b3-list-item--focus"),s=[i]);let r="";const o=document.createElement("ul");s.forEach((l,c)=>{o.append(l.cloneNode(!0)),l.style.opacity="0.38";const d=l.dataset.nodeId||l.dataset.path;d&&(r+=d,c<s.length-1&&(r+=","))}),o.setAttribute("style",`width: 219px;position: fixed;top:-${s.length*30}px`),o.setAttribute("class","b3-list b3-list--background"),document.body.append(o),a.dataTransfer.setDragImage(o,16,16),a.dataTransfer.setData(p.SIYUAN_DROP_FILE,r),a.dataTransfer.dropEffect="move",window.siyuan.dragElement=document.createElement("div"),window.siyuan.dragElement.innerText=r,setTimeout(()=>{o.remove()})}}),this.element.addEventListener("dragend",()=>{this.parent.panelElement.classList.remove("sy__file--disablehover"),this.element.querySelectorAll(".b3-list-item--focus").forEach((a,i)=>{if(a.style.opacity="",i===0){const s=a.querySelector(".ariaLabel");s&&hr(s.getAttribute("aria-label"),s)}}),window.siyuan.dragElement=void 0,document.querySelectorAll(".layout-tab-bars--drag").forEach(a=>{a.classList.remove("layout-tab-bars--drag")})}),this.element.addEventListener("dragover",a=>{if(window.siyuan.config.readonly||a.dataTransfer.types.includes(p.SIYUAN_DROP_TAB))return;const i=this.element.getBoundingClientRect();(a.clientY<i.top+p.SIZE_SCROLL_TB||a.clientY>i.bottom-p.SIZE_SCROLL_TB)&&this.element.scroll({top:this.element.scrollTop+(a.clientY<i.top+p.SIZE_SCROLL_TB?-p.SIZE_SCROLL_STEP:p.SIZE_SCROLL_STEP),behavior:"smooth"});let s=A(a.target,"LI");if(s||(s=A(document.elementFromPoint(a.clientX,a.clientY-1),"LI")),!s||!window.siyuan.dragElement){a.preventDefault();return}this.element.querySelectorAll(".dragover, .dragover__bottom, .dragover__top").forEach(u=>{u.classList.remove("dragover","dragover__bottom","dragover__top")});let r="";for(const u of a.dataTransfer.items)u.type.startsWith(p.SIYUAN_DROP_GUTTER)&&(r=u.type);if(r){const u=r.replace(p.SIYUAN_DROP_GUTTER,"").split(p.ZWSP);if(!["nodelistitem","nodeheading"].includes(u[0])){a.preventDefault();return}}else if(s.classList.contains("b3-list-item--focus"))return;let o=!r;Array.from(this.element.querySelectorAll(".b3-list-item--focus")).find(u=>{if(u.getAttribute("data-type")==="navigation-file")return o=!1,!0});const l=s.getAttribute("data-type");if(o&&l!=="navigation-root"){a.preventDefault();return}const c=ue(s,"data-sortmode",null);if(!c)return;const d=c.getAttribute("data-sortmode");if(o&&l==="navigation-root"&&window.siyuan.config.fileTree.sort===6||!o&&l!=="navigation-root"&&(d==="6"||window.siyuan.config.fileTree.sort===6&&d==="15")){const u=s.getBoundingClientRect(),g=u.height*.2;l==="navigation-root"&&o?a.clientY>u.top+u.height/2?s.classList.add("dragover__bottom"):s.classList.add("dragover__top"):a.clientY>u.bottom-g?s.classList.add("dragover__bottom"):a.clientY<u.top+g&&s.classList.add("dragover__top"),a.preventDefault()}if(s.classList.contains("dragover__top")||s.classList.contains("dragover__bottom")||l==="navigation-root"&&o){a.preventDefault();return}s.classList.add("dragover"),a.preventDefault()});let n=0;this.element.addEventListener("dragleave",()=>{n--,n===0&&this.element.querySelectorAll(".dragover, .dragover__bottom, .dragover__top").forEach(a=>{a.classList.remove("dragover","dragover__bottom","dragover__top")})}),this.element.addEventListener("dragenter",a=>{a.preventDefault(),n++}),this.element.addEventListener("drop",a=>Ev(this,null,function*(){n=0;const i=this.element.querySelector(".dragover, .dragover__bottom, .dragover__top");if(!i)return;const s=pe(i,"UL");if(!s)return;const r=this.element.scrollTop,o=s.getAttribute("data-url"),l=i.getAttribute("data-path");let c="";for(const f of a.dataTransfer.items)f.type.startsWith(p.SIYUAN_DROP_GUTTER)&&(c=f.type);if(c){const f=c.replace(p.SIYUAN_DROP_GUTTER,"").split(p.ZWSP);if(["nodelistitem","nodeheading"].includes(f[0])){const h={targetNoteBook:o,pushMode:0};i.classList.contains("dragover")?h.targetPath=l:i.classList.contains("dragover__bottom")?h.previousPath=l:i.classList.contains("dragover__top")&&(i.previousElementSibling?h.previousPath=i.previousElementSibling.getAttribute("data-path"):h.targetPath=i.parentElement.previousElementSibling.getAttribute("data-path")),f[0]==="nodeheading"?(h.srcHeadingID=f[2].split(",")[0],ae("/api/filetree/heading2Doc",h)):(h.srcListItemID=f[2].split(",")[0],ae("/api/filetree/li2Doc",h))}i.classList.remove("dragover","dragover__bottom","dragover__top"),window.siyuan.dragElement=void 0;return}if(window.siyuan.dragElement=void 0,!a.dataTransfer.getData(p.SIYUAN_DROP_FILE)){i.classList.remove("dragover","dragover__bottom","dragover__top");return}const d=[],u=[],g=[];if(this.element.querySelectorAll(".b3-list-item--focus").forEach(f=>{if(f.getAttribute("data-type")==="navigation-root")d.push(f);else{const h=f.getAttribute("data-path");if(!g.find(b=>{if(h.startsWith(b.replace(".sy","")))return!0})){if(i.getAttribute("data-path").startsWith(f.dataset.path.replace(".sy","")))return;u.push(f),g.push(h)}}}),i.classList.contains("dragover")){ae("/api/filetree/moveDocs",{toNotebook:o,fromPaths:g,toPath:l}),i.classList.remove("dragover","dragover__bottom","dragover__top");return}if(i.classList.contains("dragover__bottom")||i.classList.contains("dragover__top")){const f=s.getAttribute("data-sortmode");if(window.siyuan.config.fileTree.sort===6&&d.length>0&&i.getAttribute("data-path")==="/"){i.classList.contains("dragover__top")?d.forEach(m=>{i.parentElement.before(m.parentElement)}):d.reverse().forEach(m=>{i.parentElement.after(m.parentElement)});const h=[];Array.from(this.element.children).forEach(m=>{h.push(m.getAttribute("data-url"))}),ae("/api/notebook/changeSortNotebook",{notebooks:h})}else if((f==="6"||window.siyuan.config.fileTree.sort===6&&f==="15")&&u.length>0){let h=!1;const m=_n().dirname(l);g.length>0&&(yield wn("/api/filetree/moveDocs",{toNotebook:o,fromPaths:g,toPath:m==="/"?"/":m+".sy",callback:p.CB_MOVE_NOLIST}),u.forEach(y=>{y.setAttribute("data-path",_n().join(m,y.getAttribute("data-node-id")+".sy"))}),h=!0),i.classList.contains("dragover__top")?u.forEach(y=>{let _;y.nextElementSibling&&y.nextElementSibling.tagName==="UL"&&(_=y.nextElementSibling),i.before(y),_&&y.after(_)}):i.classList.contains("dragover__bottom")&&u.reverse().forEach(y=>{let _;y.nextElementSibling&&y.nextElementSibling.tagName==="UL"&&(_=y.nextElementSibling),i.nextElementSibling&&i.nextElementSibling.tagName==="UL"?i.nextElementSibling.after(y):i.after(y),_&&y.after(_)});const b=[];Array.from(i.parentElement.children).forEach(y=>{y.tagName==="LI"&&b.push(y.getAttribute("data-path"))}),ae("/api/filetree/changeSort",{paths:b,notebook:o},()=>{h&&ae("/api/filetree/listDocsByPath",{notebook:o,path:m==="/"?"/":m+".sy",app:p.SIYUAN_APPID},y=>{if(y.data.path==="/"&&y.data.files.length===0){Q(window.siyuan.languages.emptyContent);return}this.onLsHTML(y.data,r)})})}}i.classList.remove("dragover","dragover__bottom","dragover__top")})),this.init()}updateDocInfo(e){var n;const a=this.element.querySelector(`li[data-node-id="${e.data.rootID}"]`);a&&(a.setAttribute("data-count",e.data.subFileCount),(n=a.querySelector(".ariaLabel"))==null||n.setAttribute("aria-label",this.genDocAriaLabel(e.data,Ge)))}updateItemArrow(e,n){const a=this.element.querySelector(`[data-url="${e}"]`);if(!a)return;let i=n,s;for(;!s;)if(s=a.querySelector(`[data-path="${i}"]`),s){const r=s.querySelector(".fn__hidden");r?r.classList.remove("fn__hidden"):this.getLeaf(s,e,!0);break}else{const r=_n().dirname(i);if(r==="/"){a.firstElementChild.querySelector(".b3-list-item__arrow--open")&&this.getLeaf(a.firstElementChild,e,!0);break}else i=r+".sy"}}genNotebook(e){const n=`<span class="b3-list-item__icon b3-tooltips b3-tooltips__e" aria-label="${window.siyuan.languages.changeIcon}">${Yt(e.icon||window.siyuan.storage[p.LOCAL_IMAGES].note)}</span>`;return e.closed?`<li data-url="${e.id}" class="b3-list-item b3-list-item--hide-action">
    <span class="b3-list-item__toggle fn__hidden">
        <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>
    </span>
    ${n}
    <span class="b3-list-item__text" style="cursor: default;">${he(e.name)}</span>
    <span data-type="open" data-url="${e.id}" class="b3-list-item__action b3-tooltips b3-tooltips__w${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.openBy}">
        <svg><use xlink:href="#iconOpen"></use></svg>
    </span>
</li>`:`<ul class="b3-list b3-list--background" data-url="${e.id}" data-sort="${e.sort}" data-sortmode="${e.sortMode}">
<li class="b3-list-item b3-list-item--hide-action" ${window.siyuan.config.fileTree.sort===6?'draggable="true"':""} 
style="--file-toggle-width:22px" 
data-type="navigation-root" data-path="/">
    <span class="b3-list-item__toggle b3-list-item__toggle--hl">
        <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>
    </span>
    ${n}
    <span class="b3-list-item__text ariaLabel" data-position="parentE">${he(e.name)}</span>
    <span data-type="more-root" class="b3-list-item__action b3-tooltips b3-tooltips__w${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.more}">
        <svg><use xlink:href="#iconMore"></use></svg>
    </span>
    <span data-type="new" class="b3-list-item__action b3-tooltips b3-tooltips__w${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.newSubDoc}">
        <svg><use xlink:href="#iconAdd"></use></svg>
    </span>
</li></ul>`}init(e=!0){let n="",a="",i=0;window.siyuan.notebooks.forEach(o=>{o.closed?(i++,a+=this.genNotebook(o)):n+=this.genNotebook(o)}),this.element.innerHTML=n,this.closeElement.lastElementChild.innerHTML=a;const s=this.closeElement.querySelector(".counter");if(s.textContent=i.toString(),i?this.closeElement.classList.remove("fn__none"):this.closeElement.classList.add("fn__none"),window.siyuan.storage[p.LOCAL_FILESPATHS].forEach(o=>{o.openPaths.forEach(l=>{this.selectItem(o.notebookId,l,void 0,!1,!1)})}),!e)return;const r=this.closeElement.querySelector("svg");n!==""?(this.closeElement.style.height="30px",r.classList.remove("b3-list-item__arrow--open"),this.closeElement.lastElementChild.classList.add("fn__none")):(this.closeElement.style.height="40%",r.classList.add("b3-list-item__arrow--open"),this.closeElement.lastElementChild.classList.remove("fn__none"))}onRemove(e){if(e.cmd==="unmount"){if(fr(n=>{const a=this.element.querySelector(`ul[data-url="${e.data.box}"] li[data-path="/"]`);if(a&&(a.parentElement.remove(),p.CB_MOUNT_REMOVE!==e.callback)){let i="";n.find(r=>{r.closed&&(i+=this.genNotebook(r))}),this.closeElement.lastElementChild.innerHTML=i;const s=this.closeElement.querySelector(".counter");s.textContent=(parseInt(s.textContent)+1).toString(),this.closeElement.classList.remove("fn__none")}}),p.CB_MOUNT_REMOVE===e.callback){const n=this.closeElement.querySelector(`li[data-url="${e.data.box}"]`);if(n){n.remove();const a=this.closeElement.querySelector(".counter");a.textContent=(parseInt(a.textContent)-1).toString(),a.textContent==="0"&&this.closeElement.classList.add("fn__none")}}return}e.data.ids.forEach(n=>{var a;const i=this.element.querySelector(`li.b3-list-item[data-node-id="${n}"]`);if(i){((a=i.nextElementSibling)==null?void 0:a.tagName)==="UL"&&i.nextElementSibling.remove();const s=i.parentElement.previousElementSibling;if(i.parentElement.childElementCount===1){if(s){const r=s.querySelector("svg");r.classList.remove("b3-list-item__arrow--open"),s.dataset.type!=="navigation-root"&&r.parentElement.classList.add("fn__hidden");const o=r.parentElement.nextElementSibling;o.innerHTML===Yt(window.siyuan.storage[p.LOCAL_IMAGES].folder)&&(o.innerHTML=Yt(window.siyuan.storage[p.LOCAL_IMAGES].file))}i.parentElement.remove()}else i.remove()}})}onCreateNotebook(e){e.data.existed||fr(n=>{if(this.element.querySelector(`[data-url="${e.data.box.id}"]`))return;const a=this.genNotebook(e.data.box);if(this.element.childElementCount===0)this.element.innerHTML=a;else{let i,s=!1;n.find(r=>{if(!r.closed){if(r.id===e.data.box.id){if(i){const o=this.element.querySelector(`[data-url="${i}"]`);o&&(o.insertAdjacentHTML("afterend",a),s=!0)}return s||this.element.insertAdjacentHTML("afterbegin",a),!0}i=r.id}}),!s&&!this.element.querySelector(`[data-url="${e.data.box.id}"]`)&&this.element.insertAdjacentHTML("afterbegin",a)}})}onMount(e){if(e.data.existed)return;const n=this.closeElement.querySelector(`li[data-url="${e.data.box.id}"]`);if(n){const a=this.closeElement.querySelector(".counter");a.textContent=(parseInt(a.textContent)-1).toString(),a.textContent==="0"&&this.closeElement.classList.add("fn__none"),n.remove()}fr(a=>{const i=this.genNotebook(e.data.box);if(this.element.childElementCount===0)this.element.innerHTML=i;else{let s;a.find((r,o)=>{if(r.id===e.data.box.id){for(;o>0;)if(a[o-1].closed)o--;else{s=a[o-1].id;break}return!0}}),s?this.element.querySelector(`[data-url="${s}"]`).insertAdjacentHTML("afterend",i):this.element.insertAdjacentHTML("afterbegin",i)}})}onRename(e){const n=this.element.querySelector(`ul[data-url="${e.box}"] li[data-path="${e.path}"]`);n&&(n.setAttribute("data-name",Lute.EscapeHTMLStr(e.title)),n.querySelector(".b3-list-item__text").innerHTML=he(e.title))}onMove(e){const n=this.element.querySelector(`ul[data-url="${e.data.fromNotebook}"] li[data-path="${e.data.fromPath}"]`);if(n)if(n.nextElementSibling&&n.nextElementSibling.tagName==="UL"&&n.nextElementSibling.remove(),n.parentElement.childElementCount===1){if(n.parentElement.previousElementSibling){const i=n.parentElement.previousElementSibling;i.getAttribute("data-type")!=="navigation-root"&&i.querySelector(".b3-list-item__toggle").classList.add("fn__hidden"),i.querySelector(".b3-list-item__arrow").classList.remove("b3-list-item__arrow--open");const s=i.querySelector(".b3-list-item__icon");s.innerHTML===Yt(window.siyuan.storage[p.LOCAL_IMAGES].folder)&&(s.innerHTML=Yt(window.siyuan.storage[p.LOCAL_IMAGES].file))}n.parentElement.remove()}else n.remove();else{const i=this.element.querySelector(`ul[data-url="${e.data.fromNotebook}"] li[data-path="${_n().dirname(e.data.fromPath)}.sy"]`);i&&i.getAttribute("data-count")==="1"&&(i.querySelector(".b3-list-item__toggle").classList.add("fn__hidden"),i.querySelector(".b3-list-item__arrow").classList.remove("b3-list-item__arrow--open"))}const a=this.element.querySelector(`[data-url="${e.data.toNotebook}"] li[data-path="${e.data.toPath}"]`);if(a){a.querySelector(".b3-list-item__toggle").classList.remove("fn__hidden");const i=a.querySelector(".b3-list-item__icon");i.innerHTML===Yt(window.siyuan.storage[p.LOCAL_IMAGES].file)&&(i.innerHTML=Yt(window.siyuan.storage[p.LOCAL_IMAGES].folder)),a.querySelector(".b3-list-item__arrow").classList.contains("b3-list-item__arrow--open")&&e.callback!==p.CB_MOVE_NOLIST&&this.getLeaf(a,e.data.toNotebook,!0)}}onLsHTML(e,n){if(e.files.length===0)return;const a=this.element.querySelector(`ul[data-url="${e.box}"] li[data-path="${e.path}"]`);if(!a)return;let i="";e.files.forEach(r=>{i+=this.genFileHTML(r)});let s=a.nextElementSibling;if(s&&s.tagName==="UL"){const r=document.createElement("template");r.innerHTML=i,s.querySelectorAll(":scope > .b3-list-item > .b3-list-item__toggle> .b3-list-item__arrow--open").forEach(o=>{const l=N(o,"b3-list-item");if(l){const c=r.content.querySelector(`.b3-list-item[data-node-id="${l.getAttribute("data-node-id")}"]`);c.after(l.nextElementSibling),c.querySelector(".b3-list-item__arrow").classList.add("b3-list-item__arrow--open")}}),s.innerHTML=r.innerHTML,typeof n=="number"&&this.element.scroll({top:n,behavior:"smooth"});return}a.querySelector(".b3-list-item__arrow").classList.add("b3-list-item__arrow--open"),a.insertAdjacentHTML("afterend",`<ul class="file-tree__sliderDown">${i}</ul>`),s=a.nextElementSibling,setTimeout(()=>{s.setAttribute("style",`top: -1px;position: relative;height:${s.childElementCount*(a.clientHeight+1)-1}px;`),setTimeout(()=>{this.element.querySelectorAll(".file-tree__sliderDown").forEach(r=>{r.classList.remove("file-tree__sliderDown"),r.removeAttribute("style")}),typeof n=="number"&&this.element.scroll({top:n,behavior:"smooth"})},120)},2)}onLsSelect(e,n,a,i){return Ev(this,null,function*(){let s="";if(e.files.forEach(d=>{s+=this.genFileHTML(d)}),s==="")return;const r=this.element.querySelector(`ul[data-url="${e.box}"] li[data-path="${e.path}"]`);if(!r)return;r.nextElementSibling&&r.nextElementSibling.tagName==="UL"&&r.nextElementSibling.remove();const o=r.querySelector(".b3-list-item__arrow");o.classList.add("b3-list-item__arrow--open"),o.parentElement.classList.remove("fn__hidden");const l=r.querySelector(".b3-list-item__icon");l.textContent===Yt(window.siyuan.storage[p.LOCAL_IMAGES].file)&&(l.textContent=Yt(window.siyuan.storage[p.LOCAL_IMAGES].folder)),r.insertAdjacentHTML("afterend",`<ul>${s}</ul>`);let c;for(let d=0;d<e.files.length;d++){const u=e.files[d];if(n===u.path)c=yield this.selectItem(e.box,n,void 0,a,i);else if(n.startsWith(u.path.replace(".sy",""))){const g=yield wn("/api/filetree/listDocsByPath",{notebook:e.box,path:u.path,app:p.SIYUAN_APPID});c=yield this.selectItem(g.data.box,n,g.data,a,i)}}return i&&this.setCurrent(c),c})}setCurrent(e,n=!0){if(e&&(this.element.querySelectorAll("li.b3-list-item--focus").forEach(a=>{a.classList.remove("b3-list-item--focus")}),e.classList.add("b3-list-item--focus"),n)){const a=this.element.getBoundingClientRect();this.element.scrollTop=this.element.scrollTop+(e.getBoundingClientRect().top-(a.top+a.height/2))}}getLeaf(e,n,a=!1){var i;const s=e.querySelector(".b3-list-item__arrow");if(s.classList.contains("b3-list-item__arrow--open")&&!a){s.classList.remove("b3-list-item__arrow--open"),(i=e.nextElementSibling)==null||i.remove(),this.getOpenPaths();return}ae("/api/filetree/listDocsByPath",{notebook:n,path:e.getAttribute("data-path"),app:p.SIYUAN_APPID},r=>{if(r.data.path==="/"&&r.data.files.length===0){Oo({app:this.app,notebookId:n,currentPath:"/",useSavePath:!1,listDocTree:!0});return}this.onLsHTML(r.data),this.getOpenPaths()})}selectItem(e,n,a,i=!0,s=!0){return Ev(this,null,function*(){const r=this.element.querySelector(`[data-url="${e}"]`);if(!r)return;let o=n,l;for(;!l;)if(l=r.querySelector(`[data-path="${o}"]`),!l){const c=_n().dirname(o);c==="/"?o=c:o=c+".sy"}if(l.getAttribute("data-path")===n)return i&&this.getOpenPaths(),s&&this.setCurrent(l),l;if(a&&a.path===o)l=yield this.onLsSelect(a,n,i,s);else{const c=yield wn("/api/filetree/listDocsByPath",{notebook:e,path:o,app:p.SIYUAN_APPID});l=yield this.onLsSelect(c.data,n,i,s)}return l})}getOpenPaths(){const e=[];this.element.querySelectorAll(".b3-list[data-url]").forEach(n=>{const a={notebookId:n.getAttribute("data-url"),openPaths:[]};if(n.querySelectorAll(".b3-list-item__arrow--open").forEach(i=>{const s=A(i,"LI");s&&a.openPaths.push(s.getAttribute("data-path"))}),a.openPaths.length>0){for(let i=0;i<a.openPaths.length;i++)for(let s=i+1;s<a.openPaths.length;s++)a.openPaths[s].startsWith(a.openPaths[i].replace(".sy",""))&&(a.openPaths.splice(i,1),s--);a.openPaths.forEach((i,s)=>{var r,o,l;const c=(l=(o=(r=this.element.querySelector(`[data-url="${a.notebookId}"] li[data-path="${i}"]`))==null?void 0:r.nextElementSibling)==null?void 0:o.firstElementChild)==null?void 0:l.getAttribute("data-path");c&&(a.openPaths[s]=c)}),e.push(a)}}),window.siyuan.storage[p.LOCAL_FILESPATHS]=e,Gt(p.LOCAL_FILESPATHS,e)}genDocAriaLabel(e,n){return`${n(ha(e.name,!0,!0))} <small class='ft__on-surface'>${e.hSize}</small>${e.bookmark?"<br>"+window.siyuan.languages.bookmark+" "+n(e.bookmark):""}${e.name1?"<br>"+window.siyuan.languages.name+" "+n(e.name1):""}${e.alias?"<br>"+window.siyuan.languages.alias+" "+n(e.alias):""}${e.memo?"<br>"+window.siyuan.languages.memo+" "+n(e.memo):""}${e.subFileCount!==0?window.siyuan.languages.includeSubFile.replace("x",e.subFileCount):""}<br>${window.siyuan.languages.modifiedAt} ${e.hMtime}<br>${window.siyuan.languages.createdAt} ${e.hCtime}`}genFileHTML(e){let n="";e.count&&e.count>0&&(n=`<span class="popover__block counter b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.ref}">${e.count}</span>`);const a=this.genDocAriaLabel(e,Ot),i=(e.path.split("/").length-1)*18;return`<li data-node-id="${e.id}" data-name="${Lute.EscapeHTMLStr(e.name)}" draggable="true" data-count="${e.subFileCount}" 
data-type="navigation-file" 
style="--file-toggle-width:${i+18}px" 
class="b3-list-item b3-list-item--hide-action" data-path="${e.path}">
    <span style="padding-left: ${i}px" class="b3-list-item__toggle b3-list-item__toggle--hl${e.subFileCount===0?" fn__hidden":""}">
        <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>
    </span>
    <span class="b3-list-item__icon b3-tooltips b3-tooltips__n popover__block" data-id="${e.id}" aria-label="${window.siyuan.languages.changeIcon}">${Yt(e.icon||(e.subFileCount===0?window.siyuan.storage[p.LOCAL_IMAGES].file:window.siyuan.storage[p.LOCAL_IMAGES].folder))}</span>
    <span class="b3-list-item__text ariaLabel" data-position="parentE"
aria-label="${a}">${ha(e.name,!0,!0)}</span>
    <span data-type="more-file" class="b3-list-item__action b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.more}">
        <svg><use xlink:href="#iconMore"></use></svg>
    </span>
    <span data-type="new" class="b3-list-item__action b3-tooltips b3-tooltips__nw${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.newSubDoc}">
        <svg><use xlink:href="#iconAdd"></use></svg>
    </span>
    ${n}
</li>`}initMoreMenu(){if(window.siyuan.menus.menu.remove(),window.siyuan.config.readonly||window.siyuan.menus.menu.append(new xe({icon:"iconFilesRoot",label:window.siyuan.languages.newNotebook,click:()=>{U2()}}).element),window.siyuan.menus.menu.append(new xe({icon:"iconRefresh",label:window.siyuan.languages.rebuildIndex,click:()=>{this.element.getAttribute("disabled")||(this.element.setAttribute("disabled","disabled"),uL(()=>{this.element.removeAttribute("disabled"),this.init(!1)}))}}).element),!window.siyuan.config.readonly){const e=R2("notebooks",window.siyuan.config.fileTree.sort,n=>{window.siyuan.config.fileTree.sort=n,ae("/api/setting/setFiletree",{sort:window.siyuan.config.fileTree.sort,alwaysSelectOpenedFile:window.siyuan.config.fileTree.alwaysSelectOpenedFile,refCreateSavePath:window.siyuan.config.fileTree.refCreateSavePath,docCreateSavePath:window.siyuan.config.fileTree.docCreateSavePath,openFilesUseCurrentTab:window.siyuan.config.fileTree.openFilesUseCurrentTab,maxListCount:window.siyuan.config.fileTree.maxListCount},()=>{fr(()=>{this.init(!1)})})});window.siyuan.menus.menu.append(new xe({icon:"iconSort",label:window.siyuan.languages.sort,type:"submenu",submenu:e}).element)}return window.siyuan.menus.menu}}const H2=(t,e)=>{var n,a;const i=(a=(n=Vn("file"))==null?void 0:n.data)==null?void 0:a.file;if(i instanceof js){const s=e.endsWith(".sy")?e:e+".sy";i.selectItem(t,s)}},W5=t=>{let e="",n="";if(Cn().editor.find(a=>{const i=a.parent.headElement;if(i.classList.contains("item--focus")&&(e=a.editor.protyle.notebookId,t?n=a.editor.protyle.path:n=_n().dirname(a.editor.protyle.path),N(i,"layout__wnd--active")))return!0}),!e){const a=Vn("file").data.file;if(a instanceof js){const i=a.element.querySelector(".b3-list-item--focus");if(i){const s=pe(i,"UL");s&&(e=s.getAttribute("data-url"));const r=i.getAttribute("data-path");t?n=r:n=_n().dirname(r)}}}return e||window.siyuan.notebooks.find(a=>{if(!a.closed)return e=a.id,n="/",!0}),{notebookId:e,currentPath:n}},Oo=t=>{if(cf()===0){Q(window.siyuan.languages.newFileTip);return}if(!t.notebookId){const e=W5(t.useSavePath);t.notebookId=e.notebookId,t.currentPath=e.currentPath}ae("/api/filetree/getDocCreateSavePath",{notebook:t.notebookId},e=>{if(t.useSavePath||(e.data.box=t.notebookId),e.data.path.indexOf("/")>-1&&t.useSavePath||t.name)if(e.data.path.startsWith("/")||t.currentPath==="/"){const n=_n().join(e.data.path,t.name||(e.data.path.endsWith("/")?window.siyuan.languages.untitled:""));ae("/api/filetree/createDocWithMd",{notebook:e.data.box,path:n,markdown:"",listDocTree:t.listDocTree},a=>{t.afterCB&&t.afterCB(a.data,_n().basename(n)),t.listDocTree&&ae("/api/block/getBlockInfo",{id:a.data},i=>{var s;(s=i.data)!=null&&s.path&&H2(e.data.box,i.data.path.replace(".sy",""))}),dn({app:t.app,id:a.data,action:[p.CB_GET_CONTEXT,p.CB_GET_OPENNEW]})})}else ae("/api/filetree/getHPathByPath",{notebook:e.data.box,path:t.notebookId===e.data.box?t.currentPath.endsWith(".sy")?t.currentPath:t.currentPath+".sy":e.data.path||"/"},n=>{const a=_n().join(n.data,e.data.path,t.name||(e.data.path.endsWith("/")?window.siyuan.languages.untitled:""));ae("/api/filetree/createDocWithMd",{notebook:e.data.box,path:a,parentID:ha(t.currentPath,!0,!0),markdown:"",listDocTree:t.listDocTree},i=>{t.afterCB&&t.afterCB(i.data,_n().basename(a)),dn({app:t.app,id:i.data,action:[p.CB_GET_CONTEXT,p.CB_GET_OPENNEW]})})});else{const n=_n().basename(e.data.path||window.siyuan.languages.untitled);if(!xd(n))return;if(t.notebookId!==e.data.box){const s=_n().join(e.data.path||"/",t.name||(e.data.path.endsWith("/")?window.siyuan.languages.untitled:""));ae("/api/filetree/createDocWithMd",{notebook:e.data.box,path:s,markdown:"",listDocTree:t.listDocTree},r=>{t.afterCB&&t.afterCB(r.data,_n().basename(s)),dn({app:t.app,id:r.data,action:[p.CB_GET_CONTEXT,p.CB_GET_OPENNEW]})});return}const a=Lute.NewNodeID(),i=_n().join(ha(t.currentPath,!1,!0),a+".sy");t.paths&&(t.paths[t.paths.indexOf(void 0)]=i),ae("/api/filetree/createDoc",{notebook:e.data.box,path:i,title:n,md:"",sorts:t.paths,listDocTree:t.listDocTree},()=>{t.afterCB&&t.afterCB(a,n),t.listDocTree&&H2(e.data.box,i.replace(".sy","")),dn({app:t.app,id:a,action:[p.CB_GET_CONTEXT,p.CB_GET_OPENNEW]})})}})},kv=(t,e,n)=>{ae("/api/filetree/getRefCreateSavePath",{notebook:e},a=>{let i=t;e!==a.data.box&&(i=a.data.path||"/"),a.data.path?a.data.path.startsWith("/")?n(ha(a.data.path,!1,!0),a.data.box):ae("/api/filetree/getHPathByPath",{notebook:a.data.box,path:i},s=>{n(ha(_n().join(s.data,a.data.path),!1,!0),a.data.box)}):ae("/api/filetree/getHPathByPath",{notebook:a.data.box,path:i},s=>{n(ha(s.data,!1,!0),a.data.box)})})},Sv=(t,e)=>{Ut(["dialog"]),Oo({app:t,useSavePath:!0,name:Wi(e.trim())||window.siyuan.languages.untitled})},q2=(t,e,n,a,i)=>{const s=Wi(e.trim()?e.trim():t.lute.BlockDOM2Content(n.outerHTML).replace(/\n/g,"").trim())||window.siyuan.languages.untitled,r=_n().join(a,s);ae("/api/filetree/getIDsByHPath",{path:r,notebook:i},o=>{const l=s.substring(0,window.siyuan.config.editor.blockRefDynamicAnchorTextMaxLen);if(o.data&&o.data.length>0){const c=t.toolbar.setInlineMark(t,"block-ref","range",{type:"id",color:`${o.data[0]}${p.ZWSP}d${p.ZWSP}${l}`});c[0]&&t.toolbar.range.selectNodeContents(c[0])}else ae("/api/filetree/createDocWithMd",{notebook:i,path:r,parentID:t.notebookId===i?t.block.rootID:"",markdown:""},c=>{const d=t.toolbar.setInlineMark(t,"block-ref","range",{type:"id",color:`${c.data}${p.ZWSP}d${p.ZWSP}${l}`});d[0]&&t.toolbar.range.selectNodeContents(d[0])});Ut(["toolbar"],t)})};var V5=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const z5=(t,e)=>{const n=new fe({title:window.siyuan.languages.searchType,content:`<div class="b3-dialog__content">
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconMath"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.math}
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="mathBlock" type="checkbox"${t.types.mathBlock?" checked":""}>
    </label>
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconTable"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.table}
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="table" type="checkbox"${t.types.table?" checked":""}>
    </label>
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconParagraph"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.paragraph}
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="paragraph" type="checkbox"${t.types.paragraph?" checked":""}>
    </label>
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconHeadings"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.headings}
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="heading" type="checkbox"${t.types.heading?" checked":""}>
    </label>
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconCode"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.code}
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="codeBlock" type="checkbox"${t.types.codeBlock?" checked":""}>
    </label>
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconHTML5"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            HTML
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="htmlBlock" type="checkbox"${t.types.htmlBlock?" checked":""}>
    </label>
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconDatabase"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.database}
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="databaseBlock" type="checkbox"${t.types.databaseBlock?" checked":""}>
    </label>    
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconSQL"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.embedBlock}
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="embedBlock" type="checkbox"${t.types.embedBlock?" checked":""}>
    </label>
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconVideo"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.video}
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="videoBlock" type="checkbox"${t.types.videoBlock?" checked":""}>
    </label>
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconRecord"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.audio}
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="audioBlock" type="checkbox"${t.types.audioBlock?" checked":""}>
    </label>
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconLanguage"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            IFrame
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="iframeBlock" type="checkbox"${t.types.iframeBlock?" checked":""}>
    </label>
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconBoth"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.widget}
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="widgetBlock" type="checkbox"${t.types.widgetBlock?" checked":""}>
    </label>
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconQuote"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.quote} <sup>[1]</sup>
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="blockquote" type="checkbox"${t.types.blockquote?" checked":""}>
    </label>
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconSuper"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.superBlock} <sup>[1]</sup>
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="superBlock" type="checkbox"${t.types.superBlock?" checked":""}>
    </label>
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconList"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.list1} <sup>[1]</sup>
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="list" type="checkbox"${t.types.list?" checked":""}>
    </label>
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconListItem"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.listItem} <sup>[1]</sup>
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="listItem" type="checkbox"${t.types.listItem?" checked":""}>
    </label>
    <label class="fn__flex b3-label">
        <svg class="ft__on-surface svg fn__flex-center"><use xlink:href="#iconFile"></use></svg>
        <span class="fn__space"></span>
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.doc}
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="document" type="checkbox"${t.types.document?" checked":""}>
    </label>
    <span class="fn__space"></span>
    <div class="fn__flex-1">
        <div class="b3-label__text">[1] ${window.siyuan.languages.containerBlockTip1}</div>
    </div>    
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px",height:"70vh"});n.element.setAttribute("data-key",p.DIALOG_SEARCHTYPE);const a=n.element.querySelectorAll(".b3-button");a[0].addEventListener("click",()=>{n.destroy()}),a[1].addEventListener("click",()=>{n.element.querySelectorAll(".b3-switch").forEach(i=>{t.types[i.getAttribute("data-type")]=i.checked}),e(),window.siyuan.storage[p.LOCAL_SEARCHDATA]=Object.assign({},t),Gt(p.LOCAL_SEARCHDATA,window.siyuan.storage[p.LOCAL_SEARCHDATA]),n.destroy()})},Y5=t=>{let e="";Object.keys(p.SIYUAN_DEFAULT_REPLACETYPES).forEach(i=>{e+=`<label class="fn__flex b3-label">
    <span class="fn__space"></span>
    <div class="fn__flex-1 fn__flex-center">
        ${window.siyuan.languages.replaceTypes[i]}
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" data-type="${i}" type="checkbox"${t.replaceTypes[i]?" checked":""}>
</label>`});const n=new fe({title:window.siyuan.languages.replaceType,content:`<div class="b3-dialog__content">${e}</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px",height:"70vh"});n.element.setAttribute("data-key",p.DIALOG_REPLACETYPE);const a=n.element.querySelectorAll(".b3-button");a[0].addEventListener("click",()=>{n.destroy()}),a[1].addEventListener("click",()=>{n.element.querySelectorAll(".b3-switch").forEach(i=>{t.replaceTypes[i.getAttribute("data-type")]=i.checked}),window.siyuan.storage[p.LOCAL_SEARCHDATA]=Object.assign({},t),Gt(p.LOCAL_SEARCHDATA,window.siyuan.storage[p.LOCAL_SEARCHDATA]),n.destroy()})},G5=(t,e)=>{if(!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_SEARCH_METHOD){window.siyuan.menus.menu.remove();return}window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_SEARCH_METHOD),window.siyuan.menus.menu.append(new xe({icon:"iconExact",label:window.siyuan.languages.keyword,current:t.method===0,click(){t.method=0,e()}}).element),window.siyuan.menus.menu.append(new xe({icon:"iconQuote",label:window.siyuan.languages.querySyntax,current:t.method===1,click(){t.method=1,e()}}).element),window.siyuan.menus.menu.append(new xe({icon:"iconDatabase",label:"SQL",current:t.method===2,click(){t.method=2,e()}}).element),window.siyuan.menus.menu.append(new xe({icon:"iconRegex",label:window.siyuan.languages.regex,current:t.method===3,click(){t.method=3,e()}}).element)},Yy=(t,e,n,a,i)=>{t.removed=!1;const s=t;s.name=a,e.push(Object.assign({},s)),window.siyuan.storage[p.LOCAL_SEARCHDATA]=Object.assign({},t),Gt(p.LOCAL_SEARCHDATA,window.siyuan.storage[p.LOCAL_SEARCHDATA]),ae("/api/storage/setCriterion",{criterion:s},()=>{var r;i.destroy();const o=n.querySelector("#criteria").firstElementChild;o.classList.remove("fn__none"),(r=o.querySelector(".b3-chip--current"))==null||r.classList.remove("b3-chip--current"),o.insertAdjacentHTML("beforeend",`<div data-type="set-criteria" class="b3-chip b3-chip--current b3-chip--middle b3-chip--pointer">${s.name}<svg class="b3-chip__close" data-type="remove-criteria"><use xlink:href="#iconCloseRound"></use></svg></div>`)})},W2=(t,e,n)=>{const a=new fe({title:window.siyuan.languages.saveCriterion,content:`<div class="b3-dialog__content">
        <input class="b3-text-field fn__block" placeholder="${window.siyuan.languages.memo}">
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"});a.element.setAttribute("data-key",p.DIALOG_SAVECRITERION);const i=a.element.querySelectorAll(".b3-button");a.bindInput(a.element.querySelector("input"),()=>{i[1].dispatchEvent(new CustomEvent("click"))}),i[0].addEventListener("click",()=>{a.destroy()}),i[1].addEventListener("click",()=>{const s=a.element.querySelector("input"),r=s.value.trim();if(!r){Q(window.siyuan.languages._kernel[142]);return}x()?(t.k=document.querySelector("#toolbarSearch").value,t.r=n.querySelector("#toolbarReplace").value):(t.k=n.querySelector("#searchInput").value,t.r=n.querySelector("#replaceInput").value);const o=n.querySelector("#criteria").firstElementChild;let l="",c="";if(e.forEach(d=>{d.name===r&&(l=d.name),V2(d,t)&&(c=d.name)}),s.blur(),l&&!c)Sn(window.siyuan.languages.confirm,window.siyuan.languages.searchOverwrite,()=>{Array.from(o.children).forEach(d=>{d.textContent===r&&d.remove()}),e.find((d,u)=>{if(d.name===r)return e.splice(u,1),!0}),Yy(t,e,n,r,a)});else if(l&&c)if(l===c)a.destroy();else{const d=l===r?c:l;Sn(window.siyuan.languages.confirm,window.siyuan.languages.searchRemoveName.replace("${x}",d).replace("${y}",r),()=>{Array.from(o.children).forEach(u=>{(u.textContent===c||u.textContent===l)&&u.remove()}),e.find((u,g)=>{if(u.name===d||u.name===l)return ae("/api/storage/removeCriterion",{name:d}),e.splice(g,1),!0}),Yy(t,e,n,r,a)})}else!l&&c?Sn(window.siyuan.languages.confirm,window.siyuan.languages.searchUpdateName.replace("${x}",c).replace("${y}",r),()=>{Array.from(o.children).forEach(d=>{d.textContent===c&&d.remove()}),e.find((d,u)=>{if(d.name===c)return ae("/api/storage/removeCriterion",{name:c}),e.splice(u,1),!0}),Yy(t,e,n,r,a)}):Yy(t,e,n,r,a)})},j5=(t,e,n,a,i,s)=>V5(void 0,null,function*(){if(!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_SEARCH_MORE){window.siyuan.menus.menu.remove();return}window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_SEARCH_MORE);const r=[{iconHTML:"",label:window.siyuan.languages.type,current:t.sort===0,click(){t.sort=0,a()}},{iconHTML:"",label:window.siyuan.languages.createdASC,current:t.sort===1,click(){t.sort=1,a()}},{iconHTML:"",label:window.siyuan.languages.createdDESC,current:t.sort===2,click(){t.sort=2,a()}},{iconHTML:"",label:window.siyuan.languages.modifiedASC,current:t.sort===3,click(){t.sort=3,a()}},{iconHTML:"",label:window.siyuan.languages.modifiedDESC,current:t.sort===4,click(){t.sort=4,a()}},{iconHTML:"",label:window.siyuan.languages.sortByRankAsc,current:t.sort===6,click(){t.sort=6,a()}},{iconHTML:"",label:window.siyuan.languages.sortByRankDesc,current:t.sort===7,click(){t.sort=7,a()}}];t.group===1&&r.push({iconHTML:"",label:window.siyuan.languages.sortByContent,current:t.sort===5,click(){t.sort=5,a()}}),window.siyuan.menus.menu.append(new xe({iconHTML:"",label:window.siyuan.languages.sort,type:"submenu",submenu:r}).element),window.siyuan.menus.menu.append(new xe({iconHTML:"",label:window.siyuan.languages.group,type:"submenu",submenu:[{iconHTML:"",label:window.siyuan.languages.noGroupBy,current:t.group===0,click(){x()?(n.querySelector('[data-type="expand"]').classList.add("fn__none"),n.querySelector('[data-type="contract"]').classList.add("fn__none")):n.querySelector("#searchCollapse").parentElement.classList.add("fn__none"),t.group=0,t.sort===5&&(t.sort=0),a()}},{iconHTML:"",label:window.siyuan.languages.groupByDoc,current:t.group===1,click(){x()?(n.querySelector('[data-type="expand"]').classList.remove("fn__none"),n.querySelector('[data-type="contract"]').classList.remove("fn__none")):n.querySelector("#searchCollapse").parentElement.classList.remove("fn__none"),t.group=1,a()}}]}).element),s&&s(),window.siyuan.menus.menu.append(new xe({type:"separator"}).element),window.siyuan.menus.menu.append(new xe({label:window.siyuan.languages.saveCriterion,iconHTML:"",click(){W2(t,e,n)}}).element),window.siyuan.menus.menu.append(new xe({iconHTML:"",label:window.siyuan.languages.removeCriterion,click(){i()}}).element)}),V2=(t,e)=>!!(e.group===t.group&&e.hPath===t.hPath&&e.hasReplace===t.hasReplace&&e.k===t.k&&e.method===t.method&&e.r===t.r&&e.sort===t.sort&&G(e.types,t.types)&&G(e.replaceTypes,t.replaceTypes)&&G(e.idPath,t.idPath)),K5=(t,e,n)=>{ae("/api/storage/getCriteria",{},a=>{let i="";a.data.forEach(s=>{e.push(s);let r=!1;V2(s,n)&&(r=!0),i+=`<div data-type="set-criteria" class="${r?"b3-chip--current ":""}b3-chip b3-chip--middle b3-chip--pointer">${he(s.name)}<svg class="b3-chip__close" data-type="remove-criteria"><use xlink:href="#iconCloseRound"></use></svg></div>`}),t.innerHTML=`<div class="b3-chips${i?"":" fn__none"}">
    ${i}
</div>
<span class="fn__flex-1"></span>
<button data-type="saveCriterion" class="b3-button b3-button--small b3-button--outline fn__flex-center">${window.siyuan.languages.saveCriterion}</button>
<span class="fn__space"></span>
<button data-type="removeCriterion" aria-label="${window.siyuan.languages.useCriterion}" class="ariaLabel b3-button b3-button--small b3-button--outline fn__flex-center fn__flex-shrink" data-position="9south">${window.siyuan.languages.removeCriterion}</button>
<span class="fn__space"></span>`})},X5=t=>{const e=[];return t.querySelectorAll(".b3-list-item__text mark").forEach(n=>{e.push(n.textContent)}),e.length===0&&t.querySelectorAll(".b3-list-item__meta mark").forEach(n=>{e.push(n.textContent)}),[...new Set(e)].join(" ")},Av=(t,e,n)=>{t.value===""?(e.classList.add("fn__none"),typeof n=="number"&&(t.style.paddingRight=t.dataset.oldPaddingRight)):(e.classList.remove("fn__none"),typeof n=="number"&&t.style.setProperty("padding-right",`${n*2+e.clientWidth}px`,"important"))},Bh=t=>{t.inputElement.dataset.oldPaddingRight=t.inputElement.style.paddingRight,t.inputElement.insertAdjacentHTML("afterend",`<svg class="${t.className||"b3-form__icon-clear"} ariaLabel" aria-label="${window.siyuan.languages.clear}" style="${t.right?"right: "+t.right+"px;":""}${t.height?"height:"+t.height+"px;":""}${t.width?"width:"+t.width:""}">
<use xlink:href="#iconCloseRound"></use></svg>`);const e=t.inputElement.nextElementSibling;e.addEventListener("click",()=>{t.inputElement.value="",t.inputElement.focus(),Av(t.inputElement,e,t.right),t.clearCB&&t.clearCB()}),t.inputElement.addEventListener("input",()=>{Av(t.inputElement,e,t.right)}),Av(t.inputElement,e,t.right)},z2=t=>{const e=window.siyuan.storage[p.LOCAL_SEARCHKEYS];if(!e.replaceKeys||e.replaceKeys.length===0||e.length===1&&e[0]===t.value)return;const n=new ta(p.MENU_SEARCH_REPLACE_HISTORY);if(n.isOpen)return;n.element.classList.add("b3-menu--list"),n.addItem({iconHTML:"",label:window.siyuan.languages.clearHistory,click(){window.siyuan.storage[p.LOCAL_SEARCHKEYS].replaceKeys=[],Gt(p.LOCAL_SEARCHKEYS,window.siyuan.storage[p.LOCAL_SEARCHKEYS])}});const a=n.addSeparator(1);let i=!0;e.replaceKeys.forEach(r=>{if(r!==t.value&&r){const o=n.addItem({iconHTML:"",label:he(r),action:"iconCloseRound",bind(l){l.addEventListener("click",c=>{var d;N(c.target,"b3-menu__action")?(e.replaceKeys.find((u,g)=>{if(u===r)return e.replaceKeys.splice(g,1),!0}),window.siyuan.storage[p.LOCAL_SEARCHKEYS].replaceKeys=e.replaceKeys,Gt(p.LOCAL_SEARCHKEYS,window.siyuan.storage[p.LOCAL_SEARCHKEYS]),(d=l.previousElementSibling)!=null&&d.classList.contains("b3-menu__separator")&&!l.nextElementSibling?window.siyuan.menus.menu.remove():l.remove()):(t.value=l.textContent,window.siyuan.menus.menu.remove()),c.preventDefault(),c.stopPropagation()})}});i&&o.classList.add("b3-menu__item--current"),i=!1}}),i&&a.remove();const s=t.previousElementSibling.getBoundingClientRect();n.open({x:s.left,y:s.bottom})},Y2=(t,e,n)=>{const a=t.querySelector("#searchInput, #toolbarSearch"),i=window.siyuan.storage[p.LOCAL_SEARCHKEYS];if(!i.keys||i.keys.length===0||i.length===1&&i[0]===a.value)return;const s=new ta(p.MENU_SEARCH_HISTORY);if(s.isOpen)return;s.element.classList.add("b3-menu--list"),s.addItem({iconHTML:"",label:window.siyuan.languages.clearHistory,click(){window.siyuan.storage[p.LOCAL_SEARCHKEYS].keys=[],Gt(p.LOCAL_SEARCHKEYS,window.siyuan.storage[p.LOCAL_SEARCHKEYS])}});const r=s.addSeparator(1);let o=!0;i.keys.forEach(c=>{if(c!==a.value&&c){const d=s.addItem({iconHTML:"",label:he(c),action:"iconCloseRound",bind(u){u.addEventListener("click",g=>{var f;N(g.target,"b3-menu__action")?(i.keys.find((h,m)=>{if(h===c)return i.keys.splice(m,1),!0}),window.siyuan.storage[p.LOCAL_SEARCHKEYS].keys=i.keys,Gt(p.LOCAL_SEARCHKEYS,window.siyuan.storage[p.LOCAL_SEARCHKEYS]),(f=u.previousElementSibling)!=null&&f.classList.contains("b3-menu__separator")&&!u.nextElementSibling?window.siyuan.menus.menu.remove():u.remove()):(a.value=u.textContent,e.page=1,$i(t,e,n,!0),window.siyuan.menus.menu.remove()),g.preventDefault(),g.stopPropagation()})}});o&&d.classList.add("b3-menu__item--current"),o=!1}}),o&&r.remove();const l=a.previousElementSibling.getBoundingClientRect();s.open({x:l.left,y:l.bottom})},G2=t=>{const e=t.querySelector("#searchAssetInput"),n=window.siyuan.storage[p.LOCAL_SEARCHASSET].keys;if(!n||n.length===0||n.length===1&&n[0]===e.value)return;const a=new ta(p.MENU_SEARCH_ASSET_HISTORY);if(a.isOpen)return;a.element.classList.add("b3-menu--list"),a.addItem({iconHTML:"",label:window.siyuan.languages.clearHistory,click(){window.siyuan.storage[p.LOCAL_SEARCHASSET].keys=[],Gt(p.LOCAL_SEARCHASSET,window.siyuan.storage[p.LOCAL_SEARCHASSET])}});const i=a.addSeparator(1);let s=!0;n.forEach(o=>{if(o!==e.value&&o){const l=a.addItem({iconHTML:"",label:he(o),action:"iconCloseRound",bind(c){c.addEventListener("click",d=>{var u;N(d.target,"b3-menu__action")?(n.find((g,f)=>{if(g===o)return n.splice(f,1),!0}),window.siyuan.storage[p.LOCAL_SEARCHASSET].keys=n,Gt(p.LOCAL_SEARCHASSET,window.siyuan.storage[p.LOCAL_SEARCHASSET]),(u=c.previousElementSibling)!=null&&u.classList.contains("b3-menu__separator")&&!c.nextElementSibling?window.siyuan.menus.menu.remove():c.remove()):(e.value=c.textContent,Ks(t),window.siyuan.menus.menu.remove()),d.preventDefault(),d.stopPropagation()})}});s&&l.classList.add("b3-menu__item--current"),s=!1}}),s&&i.remove();const r=e.previousElementSibling.getBoundingClientRect();a.open({x:r.left,y:r.bottom})},j2=(t,e)=>{let n=window.siyuan.storage[p.LOCAL_SEARCHKEYS][t];n.splice(0,0,e),n=Array.from(new Set(n)),n.length>window.siyuan.config.search.limit&&n.splice(window.siyuan.config.search.limit,n.length-window.siyuan.config.search.limit),window.siyuan.storage[p.LOCAL_SEARCHKEYS][t]=n,Gt(p.LOCAL_SEARCHKEYS,window.siyuan.storage[p.LOCAL_SEARCHKEYS])},Z5=t=>{if(!t.value)return;let e=window.siyuan.storage[p.LOCAL_SEARCHASSET].keys;e.splice(0,0,t.value),e=Array.from(new Set(e)),e.length>window.siyuan.config.search.limit&&e.splice(window.siyuan.config.search.limit,e.length-window.siyuan.config.search.limit),window.siyuan.storage[p.LOCAL_SEARCHASSET].k=t.value,window.siyuan.storage[p.LOCAL_SEARCHASSET].keys=e,Gt(p.LOCAL_SEARCHASSET,window.siyuan.storage[p.LOCAL_SEARCHASSET])},J5=(t,e)=>{if(window.siyuan.menus.menu.remove(),t.previousElementSibling.classList.add("fn__none"),t.classList.remove("fn__none"),t.innerHTML){t.querySelector("#searchAssetInput").select();return}const n=window.siyuan.storage[p.LOCAL_SEARCHASSET];t.parentElement.querySelector(".fn__loading--top").classList.remove("fn__none");let a="";if(t.innerHTML=`<div class="block__icons">
    <span data-type="assetPrevious" class="block__icon block__icon--show ariaLabel" data-position="9south" disabled="disabled" aria-label="${window.siyuan.languages.previousLabel}"><svg><use xlink:href='#iconLeft'></use></svg></span>
    <span class="fn__space"></span>
    <span data-type="assetNext" class="block__icon block__icon--show ariaLabel" data-position="9south" disabled="disabled" aria-label="${window.siyuan.languages.nextLabel}"><svg><use xlink:href='#iconRight'></use></svg></span>
    <span class="fn__space"></span>
    <span id="searchAssetResult" class="ft__selectnone"></span>
    <span class="fn__flex-1${e?"":" resize__move"}" style="min-height: 100%"></span>
    <span class="fn__space"></span>
    <span id="assetMore" aria-label="${window.siyuan.languages.more}" class="block__icon block__icon--show ariaLabel" data-position="9south">
        <svg><use xlink:href="#iconMore"></use></svg>
    </span>
    <span class="fn__space"></span>
    <span id="searchAssetClose" aria-label="${e?window.siyuan.languages.stickSearch:window.siyuan.languages.globalSearch}" class="block__icon block__icon--show ariaLabel" data-position="9south">
        <svg><use xlink:href="#iconBack"></use></svg>
    </span>
</div>
<div class="b3-form__icon search__header">
    <div class="fn__flex-1" style="position: relative">
        <span class="search__history-icon ariaLabel" id="assetHistoryBtn" aria-label="${Mt("\u2325\u2193")}">
            <svg data-menu="true" class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>
            <svg class="search__arrowdown"><use xlink:href="#iconDown"></use></svg>
        </span>
        <input id="searchAssetInput" value="${n.k}" class="b3-text-field b3-text-field--text" placeholder="${window.siyuan.languages.keyword}">
    </div>
    <div class="block__icons">
        <span data-type="assetRefresh" aria-label="${window.siyuan.languages.refresh}" class="block__icon ariaLabel" data-position="9south">
            <svg><use xlink:href="#iconRefresh"></use></svg>
        </span>
        <span class="fn__space"></span>
        ${$h(n.method,"assetSyntaxCheck")}
        <span class="fn__space"></span>
        <span id="assetFilter" aria-label="${window.siyuan.languages.type}" class="block__icon ariaLabel" data-position="9south">
            <svg><use xlink:href="#iconFilter"></use></svg>
        </span>
    </div>
</div>
<div class="search__layout${n.layout===1?" search__layout--row":""}">
    <div id="searchAssetList" class="fn__flex-1 search__list b3-list b3-list--background"></div>
    <div class="search__drag"></div>
    <div id="searchAssetPreview" class="fn__flex-1 search__preview b3-typography" style="padding: 8px;box-sizing: border-box;"></div>
</div>
<div class="search__tip${e?" fn__none":""}">
    <kbd>\u2191/\u2193/PageUp/PageDown</kbd> ${window.siyuan.languages.searchTip1}
    ${a}
    <kbd>${window.siyuan.languages.click}</kbd> ${window.siyuan.languages.searchTip3}
    <kbd>Esc</kbd> ${window.siyuan.languages.searchTip5}
</div>`,t.querySelector("#searchAssetList").innerHTML!=="")return;const i=t.querySelector("#searchAssetPreview");n.layout===1?n.col&&(i.style.width=n.col,i.classList.remove("fn__flex-1")):n.row&&(i.classList.remove("fn__flex-1"),i.style.height=n.row);const s=t.querySelector("#searchAssetInput");s.select(),s.addEventListener("compositionend",o=>{o.isComposing||Ks(t,n)}),s.addEventListener("input",o=>{o.isComposing||Ks(t,n)}),s.addEventListener("blur",()=>{Z5(s)}),Ks(t,n),Bh({right:8,height:s.clientHeight,inputElement:s,clearCB(){Ks(t,n)}});const r=t.querySelector(".search__drag");r.addEventListener("mousedown",o=>{const l=document,c=r.previousElementSibling,d=n.layout===1?"lr":"tb",u=o[d==="lr"?"clientX":"clientY"],g=d==="lr"?c.offsetWidth:c.offsetHeight,f=d==="lr"?i.offsetWidth:i.offsetHeight;i.classList.remove("fn__flex-1"),i.style[d==="lr"?"width":"height"]=f+"px",t.style.userSelect="none",l.onmousemove=h=>{h.preventDefault(),h.stopPropagation();const m=g+(h[d==="lr"?"clientX":"clientY"]-u),b=f-(h[d==="lr"?"clientX":"clientY"]-u);m<120||b<120||(i.style[d==="lr"?"width":"height"]=b+"px")},l.onmouseup=()=>{t.style.userSelect="none",l.onmousemove=null,l.onmouseup=null,l.ondragstart=null,l.onselectstart=null,l.onselect=null,window.siyuan.storage[p.LOCAL_SEARCHASSET][d==="lr"?"col":"row"]=i[d==="lr"?"offsetWidth":"offsetHeight"]+"px",Gt(p.LOCAL_SEARCHASSET,window.siyuan.storage[p.LOCAL_SEARCHASSET])}}),r.addEventListener("dblclick",()=>{i.style[n.layout===1?"width":"height"]="",i.classList.add("fn__flex-1");const o=n.layout===1?"lr":"tb";window.siyuan.storage[p.LOCAL_SEARCHASSET][o==="lr"?"col":"row"]="",Gt(p.LOCAL_SEARCHASSET,window.siyuan.storage[p.LOCAL_SEARCHASSET])})};let K2;const Ks=(t,e,n=1)=>{const a=t.parentElement.querySelector(".fn__loading--top");a.classList.remove("fn__none"),clearTimeout(K2),K2=window.setTimeout(()=>{e||(e=window.siyuan.storage[p.LOCAL_SEARCHASSET]);const i=t.querySelector('[data-type="assetPrevious"]');n>1?i.removeAttribute("disabled"):i.setAttribute("disabled","disabled");const s=t.querySelector("#searchAssetInput");ae("/api/search/fullTextSearchAssetContent",{page:n,query:s.value,types:e.types,method:e.method,orderBy:e.sort},r=>{var o,l;a.classList.add("fn__none");const c=t.querySelector('[data-type="assetNext"]');n<r.data.pageCount?c.removeAttribute("disabled"):c.setAttribute("disabled","disabled");let d="";r.data.assetContents.forEach((g,f)=>{d+=`<div data-type="search-item" class="b3-list-item${f===0?" b3-list-item--focus":""}" data-id="${g.id}">
<span class="ft__on-surface">${g.ext}</span>
<span class="fn__space"></span>
<span class="b3-list-item__text">${g.content}</span>
<span class="b3-list-item__meta">${g.hSize}</span>
<span class="b3-list-item__meta b3-list-item__meta--ellipsis ariaLabel" aria-label="${Ot(g.path)}">${g.name}</span>
</div>`});const u=t.querySelector("#searchAssetPreview");r.data.assetContents.length>0?(u.classList.remove("fn__none"),(o=t.querySelector(".search__drag"))==null||o.classList.remove("fn__none"),Gy(u,r.data.assetContents[0].id,s.value,e.method)):(u.classList.add("fn__none"),(l=t.querySelector(".search__drag"))==null||l.classList.add("fn__none")),t.querySelector("#searchAssetResult").innerHTML=`<span class="fn__flex-center">${n}/${r.data.pageCount||1}</span><span class="fn__space"></span>
<span class="ft__on-surface">${window.siyuan.languages.total} ${r.data.matchedAssetCount}</span>`,t.querySelector("#searchAssetList").innerHTML=d||`<div class="search__empty">
    ${window.siyuan.languages.emptyContent}
</div>`})},p.TIMEOUT_INPUT)},Gy=(t,e,n,a)=>{ae("/api/search/getAssetContent",{id:e,query:n,queryMethod:a},i=>{t.innerHTML=`<p style="white-space: pre-wrap;">${i.data.assetContent.content}</p>`;const s=t.querySelector("mark");if(s){s.classList.add("mark--hl");const r=t.getBoundingClientRect();t.scrollTop=t.scrollTop+s.getBoundingClientRect().top-r.top-r.height/2}})},Q5=t=>{let e;const n=Array.from(t.querySelectorAll("mark"));if(n.find((a,i)=>{if(a.classList.contains("mark--hl")){a.classList.remove("mark--hl"),e=n[i+1];return}}),e||(e=n[0]),e){e.classList.add("mark--hl");const a=t.getBoundingClientRect();t.scrollTop=t.scrollTop+e.getBoundingClientRect().top-a.top-a.height/2}},eM=(t,e)=>{const n=window.siyuan.storage[p.LOCAL_SEARCHASSET].method;if(!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_SEARCH_ASSET_METHOD){window.siyuan.menus.menu.remove();return}window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_SEARCH_ASSET_METHOD),window.siyuan.menus.menu.append(new xe({icon:"iconExact",label:window.siyuan.languages.keyword,current:n===0,click(){window.siyuan.storage[p.LOCAL_SEARCHASSET].method=0,e()}}).element),window.siyuan.menus.menu.append(new xe({icon:"iconQuote",label:window.siyuan.languages.querySyntax,current:n===1,click(){window.siyuan.storage[p.LOCAL_SEARCHASSET].method=1,e()}}).element),window.siyuan.menus.menu.append(new xe({icon:"iconRegex",label:window.siyuan.languages.regex,current:n===3,click(){window.siyuan.storage[p.LOCAL_SEARCHASSET].method=3,e()}}).element);const a=t.getBoundingClientRect();window.siyuan.menus.menu.popup({x:a.right,y:a.bottom,isLeft:!0})},tM=t=>{let e="";return p.SIYUAN_ASSETS_SEARCH.sort((n,a)=>n.localeCompare(a)).forEach(n=>{e+=`<label class="fn__flex b3-label">
        <div class="fn__flex-1 fn__flex-center">
            ${n}
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" data-type="${n}" type="checkbox" ${t[n]?" checked":""}>
    </label>`}),e},nM=t=>{const e=window.siyuan.storage[p.LOCAL_SEARCHASSET].types,n=new fe({title:window.siyuan.languages.type,content:`<div class="b3-dialog__content">${tM(e)}</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:"520px",height:"70vh"});n.element.setAttribute("data-key",p.DIALOG_SEARCHASSETSTYPE);const a=n.element.querySelectorAll(".b3-button");a[0].addEventListener("click",()=>{n.destroy()}),a[1].addEventListener("click",()=>{n.element.querySelectorAll(".b3-switch").forEach(i=>{e[i.getAttribute("data-type")]=i.checked}),Ks(t),Gt(p.LOCAL_SEARCHASSET,window.siyuan.storage[p.LOCAL_SEARCHASSET]),n.destroy()})},aM=(t,e,n)=>{if(!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_SEARCH_ASSET_MORE){window.siyuan.menus.menu.remove();return}window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_SEARCH_ASSET_MORE);const a=window.siyuan.storage[p.LOCAL_SEARCHASSET],i=[{iconHTML:"",label:window.siyuan.languages.sortByRankAsc,current:a.sort===1,click(){a.sort=1,n()}},{iconHTML:"",label:window.siyuan.languages.sortByRankDesc,current:a.sort===0,click(){a.sort=0,n()}},{iconHTML:"",label:window.siyuan.languages.modifiedASC,current:a.sort===3,click(){a.sort=3,n()}},{iconHTML:"",label:window.siyuan.languages.modifiedDESC,current:a.sort===2,click(){a.sort=2,n()}}];window.siyuan.menus.menu.append(new xe({iconHTML:"",label:window.siyuan.languages.sort,type:"submenu",submenu:i}).element),window.siyuan.menus.menu.append(new xe({iconHTML:"",label:window.siyuan.languages.layout,type:"submenu",submenu:[{iconHTML:"",label:window.siyuan.languages.topBottomLayout,current:a.layout===0,click(){e.querySelector(".search__layout").classList.remove("search__layout--row");const r=e.querySelector("#searchAssetPreview");r.style.width="",a.row?(r.style.height=a.row,r.classList.remove("fn__flex-1")):r.classList.add("fn__flex-1"),a.layout=0,Gt(p.LOCAL_SEARCHASSET,window.siyuan.storage[p.LOCAL_SEARCHASSET])}},{iconHTML:"",label:window.siyuan.languages.leftRightLayout,current:a.layout===1,click(){const r=e.querySelector("#searchAssetPreview");e.querySelector(".search__layout").classList.add("search__layout--row"),r.style.height="",a.col?(r.style.width=a.col,r.classList.remove("fn__flex-1")):r.classList.add("fn__flex-1"),a.layout=1,Gt(p.LOCAL_SEARCHASSET,window.siyuan.storage[p.LOCAL_SEARCHASSET])}}]}).element),window.siyuan.menus.menu.append(new xe({iconHTML:"",label:window.siyuan.languages.rebuildIndex,click(){e.parentElement.querySelector(".fn__loading--top").classList.remove("fn__none"),ae("/api/asset/fullReindexAssetContent",{},()=>{Ks(e,a)})}}).element);const s=t.getBoundingClientRect();window.siyuan.menus.menu.popup({x:s.right,y:s.bottom,isLeft:!0})},iM=(t,e)=>{if(window.siyuan.menus.menu.remove(),t.previousElementSibling.previousElementSibling.classList.add("fn__none"),t.classList.remove("fn__none"),t.querySelector("#searchUnRefResult").innerHTML||(t.parentElement.querySelector(".fn__loading--top").classList.remove("fn__none"),t.querySelector("#searchUnRefList").innerHTML!==""))return;const n=window.siyuan.storage[p.LOCAL_SEARCHUNREF];n.layout===1?n.col&&(e.protyle.element.style.width=n.col,e.protyle.element.classList.remove("fn__flex-1")):n.row&&(e.protyle.element.classList.remove("fn__flex-1"),e.protyle.element.style.height=n.row);const a=t.querySelector(".search__drag");a.addEventListener("mousedown",i=>{const s=document,r=a.nextElementSibling,o=a.previousElementSibling,l=n.layout===1?"lr":"tb",c=i[l==="lr"?"clientX":"clientY"],d=l==="lr"?o.clientWidth:o.clientHeight,u=l==="lr"?r.clientWidth:r.clientHeight;r.classList.remove("fn__flex-1"),r.style[l==="lr"?"width":"height"]=u+"px",t.style.userSelect="none",s.onmousemove=g=>{g.preventDefault(),g.stopPropagation();const f=d+(g[l==="lr"?"clientX":"clientY"]-c),h=u-(g[l==="lr"?"clientX":"clientY"]-c);f<120||h<120||(r.style[l==="lr"?"width":"height"]=h+"px")},s.onmouseup=()=>{t.style.userSelect="",s.onmousemove=null,s.onmouseup=null,s.ondragstart=null,s.onselectstart=null,s.onselect=null,window.siyuan.storage[p.LOCAL_SEARCHUNREF][l==="lr"?"col":"row"]=r[l==="lr"?"clientWidth":"clientHeight"]+"px",Gt(p.LOCAL_SEARCHUNREF,window.siyuan.storage[p.LOCAL_SEARCHUNREF]),l==="lr"&&Ai(e.protyle)}}),a.addEventListener("dblclick",()=>{e.protyle.element.style[n.layout===1?"width":"height"]="",e.protyle.element.classList.add("fn__flex-1");const i=n.layout===1?"lr":"tb";window.siyuan.storage[p.LOCAL_SEARCHUNREF][i==="lr"?"col":"row"]="",Gt(p.LOCAL_SEARCHUNREF,window.siyuan.storage[p.LOCAL_SEARCHUNREF]),i==="lr"&&Ai(e.protyle)}),Ef(t,e)},Ef=(t,e,n=1)=>{const a=t.querySelector('[data-type="unRefPrevious"]');n>1?a.removeAttribute("disabled"):a.setAttribute("disabled","disabled"),ae("/api/search/listInvalidBlockRefs",{page:n},i=>{var s,r;t.parentElement.querySelector(".fn__loading--top").classList.add("fn__none");const o=t.querySelector('[data-type="unRefNext"]');n<i.data.pageCount?o.removeAttribute("disabled"):o.setAttribute("disabled","disabled");let l="";i.data.blocks.forEach((c,d)=>{const u=Ds(c.box)+ha(c.hPath,!1);l+=`<div data-type="search-item" class="b3-list-item${d===0?" b3-list-item--focus":""}" data-node-id="${c.id}" data-root-id="${c.rootID}">
<svg class="b3-list-item__graphic"><use xlink:href="#${Qi(c.type)}"></use></svg>
${Yt(c.ial.icon,"b3-list-item__graphic",!0)}
<span class="b3-list-item__text">${c.content}</span>
${Cv(c)}
<span class="b3-list-item__meta b3-list-item__meta--ellipsis ariaLabel" aria-label="${Ot(u)}">${Ge(u)}</span>
</div>`}),i.data.blocks.length>0?(e.protyle.element.classList.remove("fn__none"),(s=t.querySelector(".search__drag"))==null||s.classList.remove("fn__none"),Dd({edit:e,id:i.data.blocks[0].id})):(e.protyle.element.classList.add("fn__none"),(r=t.querySelector(".search__drag"))==null||r.classList.add("fn__none")),t.querySelector("#searchUnRefResult").innerHTML=`${n}/${i.data.pageCount||1}<span class="fn__space"></span>
<span class="ft__on-surface">${window.siyuan.languages.findInDoc.replace("${x}",i.data.matchedRootCount).replace("${y}",i.data.matchedBlockCount)}</span>`,t.querySelector("#searchUnRefList").innerHTML=l||`<div class="search__empty">
    ${window.siyuan.languages.emptyContent}
</div>`})},sM=(t,e,n)=>{const a=new ta(p.MENU_SEARCH_UNREF_MORE);if(a.isOpen)return;const i=window.siyuan.storage[p.LOCAL_SEARCHUNREF];a.addItem({icon:"iconLayout",label:window.siyuan.languages.layout,type:"submenu",submenu:[{iconHTML:"",label:window.siyuan.languages.topBottomLayout,current:i.layout===0,click(){e.querySelector(".search__layout").classList.remove("search__layout--row"),n.protyle.element.style.width="",i.row?(n.protyle.element.style.height=i.row,n.protyle.element.classList.remove("fn__flex-1")):n.protyle.element.classList.add("fn__flex-1"),Ai(n.protyle),i.layout=0,Gt(p.LOCAL_SEARCHUNREF,window.siyuan.storage[p.LOCAL_SEARCHUNREF])}},{iconHTML:"",label:window.siyuan.languages.leftRightLayout,current:i.layout===1,click(){e.querySelector(".search__layout").classList.add("search__layout--row"),n.protyle.element.style.height="",i.col?(n.protyle.element.style.width=i.col,n.protyle.element.classList.remove("fn__flex-1")):n.protyle.element.classList.add("fn__flex-1"),Ai(n.protyle),i.layout=1,Gt(p.LOCAL_SEARCHUNREF,window.siyuan.storage[p.LOCAL_SEARCHUNREF])}}]}),a.addItem({icon:"iconRefresh",label:window.siyuan.languages.refresh,click(){e.parentElement.querySelector(".fn__loading--top").classList.remove("fn__none"),Ef(e,n)}});const s=t.getBoundingClientRect();a.open({x:s.right,y:s.bottom,isLeft:!0})},Tv=()=>({audioBlock:window.siyuan.config.search.audioBlock,videoBlock:window.siyuan.config.search.videoBlock,iframeBlock:window.siyuan.config.search.iframeBlock,widgetBlock:window.siyuan.config.search.widgetBlock,document:window.siyuan.config.search.document,heading:window.siyuan.config.search.heading,list:window.siyuan.config.search.list,listItem:window.siyuan.config.search.listItem,codeBlock:window.siyuan.config.search.codeBlock,htmlBlock:window.siyuan.config.search.htmlBlock,mathBlock:window.siyuan.config.search.mathBlock,table:window.siyuan.config.search.table,blockquote:window.siyuan.config.search.blockquote,superBlock:window.siyuan.config.search.superBlock,paragraph:window.siyuan.config.search.paragraph,embedBlock:window.siyuan.config.search.embedBlock,databaseBlock:window.siyuan.config.search.databaseBlock}),Ro=(t,e,n,a)=>{if(e=e.trim(),Cn().search.find(r=>(r.parent.parent.switchTab(r.parent.headElement),r.updateSearch(e,n),!0)))return;const s=window.siyuan.storage[p.LOCAL_SEARCHDATA];qs({app:t,searchData:{k:e,r:"",hasReplace:!1,method:a?a.method:s.method,hPath:"",idPath:[],group:s.group,sort:s.sort,types:Object.assign({},s.types),replaceTypes:Object.assign({},s.replaceTypes),removed:s.removed,page:1},position:window.siyuan.layout.centerLayout.children.length>1||window.innerWidth>1024?"right":void 0})},X2=(t,e,n,a)=>{let i=!0,s=!1;e.idPath.forEach(U=>{U.endsWith(".sy")&&(i=!1),U.split("/").length>1&&(s=!0)});const r=window.siyuan.storage[p.LOCAL_SEARCHKEYS],o=window.siyuan.storage[p.LOCAL_SEARCHUNREF];n.innerHTML=`<div class="fn__flex-column" style="height: 100%;${a?"border-radius: var(--b3-border-radius-b);overflow: hidden;":""}">
    <div class="block__icons" style="overflow: auto">
        <span data-position="9south" data-type="previous" class="block__icon block__icon--show ariaLabel" disabled="disabled" aria-label="${window.siyuan.languages.previousLabel}"><svg><use xlink:href='#iconLeft'></use></svg></span>
        <span class="fn__space"></span>
        <span data-position="9south" data-type="next" class="block__icon block__icon--show ariaLabel" disabled="disabled" aria-label="${window.siyuan.languages.nextLabel}"><svg><use xlink:href='#iconRight'></use></svg></span>
        <span class="fn__space"></span>
        <span id="searchResult" class="fn__flex-shrink ft__selectnone"></span>
        <span class="fn__space"></span>
        <span class="fn__flex-1${a?" resize__move":""}" style="min-height: 100%"></span>
        <span id="searchPathInput" data-position="9south" class="search__path ft__on-surface fn__flex-center ft__smaller fn__ellipsis ariaLabel" aria-label="${Ot(e.hPath)}">
            ${he(e.hPath)}
            <svg class="search__rmpath${e.hPath?"":" fn__none"}"><use xlink:href="#iconCloseRound"></use></svg>
        </span>
        <span class="fn__space"></span>
        <span data-position="9south" id="searchInclude" ${s?"":"disabled"} aria-label="${window.siyuan.languages.includeChildDoc}" class="block__icon block__icon--show ariaLabel">
            <svg${i?' class="ft__primary"':""}><use xlink:href="#iconInclude"></use></svg>
        </span>
        <span class="fn__space"></span>
        <span id="searchPath" aria-label="${window.siyuan.languages.specifyPath}" class="block__icon block__icon--show ariaLabel" data-position="9south">
            <svg><use xlink:href="#iconFolder"></use></svg>
        </span>
        <span class="fn__space"></span>
        <span id="searchMore" aria-label="${window.siyuan.languages.more}" class="block__icon block__icon--show ariaLabel" data-position="9south">
            <svg><use xlink:href="#iconMore"></use></svg>
        </span>
        <span class="${a?"":"fn__none "}fn__space"></span>
        <span id="searchOpen" aria-label="${window.siyuan.languages.openInNewTab}" class="${a?"":"fn__none "}block__icon block__icon--show ariaLabel" data-position="9south">
            <svg><use xlink:href="#iconLayoutRight"></use></svg>
        </span>
        <span class="fn__space"></span>
        <span id="searchUnRef" aria-label="${window.siyuan.languages.listInvalidRefBlocks}" class="block__icon block__icon--show ariaLabel" data-position="9south">
            <svg><use xlink:href="#iconLinkOff"></use></svg>
        </span>
        <span class="fn__space"></span>
        <span id="searchAsset" aria-label="${window.siyuan.languages.searchAssetContent}" class="block__icon block__icon--show ariaLabel" data-position="9south">
            <svg><use xlink:href="#iconExact"></use></svg>
        </span>
    </div>
    <div class="b3-form__icon search__header">
        <div style="position: relative" class="fn__flex-1">
            <span class="search__history-icon ariaLabel" id="searchHistoryBtn" aria-label="${Mt("\u2325\u2193")}">
                <svg data-menu="true" class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>
                <svg class="search__arrowdown"><use xlink:href="#iconDown"></use></svg>
            </span>
            <input id="searchInput" class="b3-text-field b3-text-field--text" placeholder="${window.siyuan.languages.showRecentUpdatedBlocks}" autocomplete="off" autocorrect="off" spellcheck="false">
        </div>
        <div class="block__icons">
            <span id="searchFilter" aria-label="${window.siyuan.languages.searchType}" class="block__icon ariaLabel" data-position="9south">
                <svg><use xlink:href="#iconFilter"></use></svg>
            </span> 
            <span class="fn__space"></span>
            ${$h(e.method,"searchSyntaxCheck")}
            <span class="fn__space"></span>
            <span id="searchReplace" aria-label="${window.siyuan.languages.replace}" class="block__icon ariaLabel" data-position="9south">
                <svg><use xlink:href="#iconReplace"></use></svg>
            </span>
            <span class="fn__space"></span>
            <span id="searchRefresh" aria-label="${window.siyuan.languages.refresh}" class="block__icon ariaLabel" data-position="9south">
                <svg><use xlink:href="#iconRefresh"></use></svg>
            </span>
            <div class="fn__flex${e.group===0?" fn__none":""}">
                <span class="fn__space"></span>
                <span id="searchExpand" class="block__icon block__icon--show ariaLabel" data-position="9south" aria-label="${window.siyuan.languages.expand}">
                    <svg><use xlink:href="#iconExpand"></use></svg>
                </span>
                <span class="fn__space"></span>
                <span id="searchCollapse" class="block__icon block__icon--show ariaLabel" data-position="9south" aria-label="${window.siyuan.languages.collapse}">
                    <svg><use xlink:href="#iconContract"></use></svg>
                </span>
            </div>
        </div>
    </div>
    <div class="b3-form__icon search__header${e.hasReplace?"":" fn__none"}">
        <div class="fn__flex-1" style="position: relative">
            <span class="search__history-icon ariaLabel" id="replaceHistoryBtn" aria-label="${Mt("\u2325\u2193")}">
                <svg data-menu="true" class="b3-form__icon-icon"><use xlink:href="#iconReplace"></use></svg>
                <svg class="search__arrowdown"><use xlink:href="#iconDown"></use></svg>
            </span>
            <input id="replaceInput" class="b3-text-field b3-text-field--text">
        </div>
        <div class="fn__space"></div>
        <svg class="fn__rotate fn__none svg" style="padding: 0 8px;align-self: center;margin-right: 8px"><use xlink:href="#iconRefresh"></use></svg>
        <span id="replaceFilter" aria-label="${window.siyuan.languages.replaceType}" class="block__icon ariaLabel fn__flex-center" data-position="9south">
            <svg><use xlink:href="#iconFilter"></use></svg>
        </span>
        <span class="fn__space"></span>
        <button id="replaceAllBtn" class="b3-button b3-button--small b3-button--outline fn__flex-center">${window.siyuan.languages.replaceAll}</button>
        <div class="fn__space"></div>
        <button id="replaceBtn" class="b3-button b3-button--small b3-button--outline fn__flex-center">\u21B5 ${window.siyuan.languages.replace}</button>
        <div class="fn__space"></div>
    </div>
    <div id="criteria" class="search__header"></div>
    <div class="search__layout${(a?r.layout===1:r.layoutTab===1)?" search__layout--row":""}">
        <div id="searchList" class="fn__flex-1 search__list b3-list b3-list--background"></div>
        <div class="search__drag"></div>
        <div id="searchPreview" class="fn__flex-1 search__preview"></div>
    </div>
    <div class="search__tip${a?"":" fn__none"}">
        <kbd>\u2191/\u2193/PageUp/PageDown</kbd> ${window.siyuan.languages.searchTip1}
        <kbd>${Mt(window.siyuan.config.keymap.general.newFile.custom)}</kbd> ${window.siyuan.languages.new}
        <kbd>${window.siyuan.languages.enterKey}/${window.siyuan.languages.doubleClick}</kbd> ${window.siyuan.languages.searchTip2}
        <kbd>${window.siyuan.languages.click}</kbd> ${window.siyuan.languages.searchTip3}
        <kbd>${Mt(window.siyuan.config.keymap.editor.general.insertRight.custom)}/${Mt("\u2325"+window.siyuan.languages.click)}</kbd> ${window.siyuan.languages.searchTip4}
        <kbd>Esc</kbd> ${window.siyuan.languages.searchTip5}
    </div>
</div>
<div class="fn__flex-column fn__none" id="searchAssets" style="height: 100%;${a?"border-radius: var(--b3-border-radius-b);overflow: hidden;":""}"></div>
<div class="fn__flex-column fn__none" id="searchUnRefPanel" style="height: 100%;${a?"border-radius: var(--b3-border-radius-b);overflow: hidden;":""}">
    <div class="block__icons">
        <span data-type="unRefPrevious" class="block__icon block__icon--show ariaLabel" data-position="9south" disabled="disabled" aria-label="${window.siyuan.languages.previousLabel}"><svg><use xlink:href='#iconLeft'></use></svg></span>
        <span class="fn__space"></span>
        <span data-type="unRefNext" class="block__icon block__icon--show ariaLabel" data-position="9south" disabled="disabled" aria-label="${window.siyuan.languages.nextLabel}"><svg><use xlink:href='#iconRight'></use></svg></span>
        <span class="fn__space"></span>
        <span id="searchUnRefResult" class="ft__selectnone"></span>
        <span class="fn__flex-1${a?" resize__move":""}" style="min-height: 100%"></span>
        <span class="fn__space"></span>
        <span id="unRefMore" aria-label="${window.siyuan.languages.more}" class="block__icon block__icon--show ariaLabel" data-position="9south">
            <svg><use xlink:href="#iconMore"></use></svg>
        </span>
        <span class="fn__space"></span>
        <span id="searchUnRefClose" aria-label="${a?window.siyuan.languages.globalSearch:window.siyuan.languages.stickSearch}" class="block__icon block__icon--show ariaLabel" data-position="9south">
            <svg><use xlink:href="#iconBack"></use></svg>
        </span>
    </div>
    <div class="search__layout${o.layout===1?" search__layout--row":""}">
        <div id="searchUnRefList" class="fn__flex-1 search__list b3-list b3-list--background"></div>
        <div class="search__drag"></div>
        <div id="searchUnRefPreview" class="fn__flex-1 search__preview"></div>
    </div>
    <div class="search__tip${a?"":" fn__none"}">
        <kbd>\u2191/\u2193/PageUp/PageDown</kbd> ${window.siyuan.languages.searchTip1}
        <kbd>${window.siyuan.languages.enterKey}/${window.siyuan.languages.doubleClick}</kbd> ${window.siyuan.languages.searchTip2}
        <kbd>${Mt(window.siyuan.config.keymap.editor.general.insertRight.custom)}/${Mt("\u2325"+window.siyuan.languages.click)}</kbd> ${window.siyuan.languages.searchTip4}
        <kbd>Esc</kbd> ${window.siyuan.languages.searchTip5}
    </div>
</div>
<div class="fn__loading fn__loading--top"><img width="120px" src="/stage/loading-pure.svg"></div>`;const l=[];K5(n.querySelector("#criteria"),l,e);const c=n.querySelector("#searchList"),d=n.querySelector("#searchInput"),u=n.querySelector("#replaceInput"),g=new ar(t,n.querySelector("#searchPreview"),{blockId:"",render:{gutter:!0,breadcrumbDocName:!0,title:!0}});g.resize();const f=new ar(t,n.querySelector("#searchUnRefPreview"),{blockId:"",render:{gutter:!0,breadcrumbDocName:!0,title:!0}});f.resize(),a?r.layout===1?r.col&&(g.protyle.element.style.width=r.col,g.protyle.element.classList.remove("fn__flex-1")):r.row&&(g.protyle.element.classList.remove("fn__flex-1"),g.protyle.element.style.height=r.row):r.layoutTab===1?r.colTab&&(g.protyle.element.style.width=r.colTab,g.protyle.element.classList.remove("fn__flex-1")):r.rowTab&&(g.protyle.element.classList.remove("fn__flex-1"),g.protyle.element.style.height=r.rowTab);let h,m=new Date().getTime();d.value=e.k||"",u.value=e.r||"",d.select();const b=n.querySelector(".search__drag");b.addEventListener("mousedown",U=>{const ee=document,Z=b.nextElementSibling,k=b.previousElementSibling,w=window.siyuan.storage[p.LOCAL_SEARCHKEYS][a?"layout":"layoutTab"]===1?"lr":"tb",S=U[w==="lr"?"clientX":"clientY"],B=w==="lr"?k.clientWidth:k.clientHeight,H=w==="lr"?Z.clientWidth:Z.clientHeight;Z.classList.remove("fn__flex-1"),Z.style[w==="lr"?"width":"height"]=H+"px",n.style.userSelect="none",ee.onmousemove=j=>{j.preventDefault(),j.stopPropagation();const re=B+(j[w==="lr"?"clientX":"clientY"]-S),Te=H-(j[w==="lr"?"clientX":"clientY"]-S);re<120||Te<120||(Z.style[w==="lr"?"width":"height"]=Te+"px")},ee.onmouseup=()=>{n.style.userSelect="",ee.onmousemove=null,ee.onmouseup=null,ee.ondragstart=null,ee.onselectstart=null,ee.onselect=null,window.siyuan.storage[p.LOCAL_SEARCHKEYS][w==="lr"?a?"col":"colTab":a?"row":"rowTab"]=Z[w==="lr"?"clientWidth":"clientHeight"]+"px",Gt(p.LOCAL_SEARCHKEYS,window.siyuan.storage[p.LOCAL_SEARCHKEYS]),w==="lr"&&Ai(g.protyle)}}),b.addEventListener("dblclick",()=>{g.protyle.element.style[y.layout===1?"width":"height"]="",g.protyle.element.classList.add("fn__flex-1");const U=window.siyuan.storage[p.LOCAL_SEARCHKEYS][a?"layout":"layoutTab"]===1?"lr":"tb";window.siyuan.storage[p.LOCAL_SEARCHKEYS][U==="lr"?a?"col":"colTab":a?"row":"rowTab"]="",Gt(p.LOCAL_SEARCHKEYS,window.siyuan.storage[p.LOCAL_SEARCHKEYS]),U==="lr"&&Ai(g.protyle)});const y=window.siyuan.storage[p.LOCAL_SEARCHASSET],_=n.querySelector("#searchAssets"),v=n.querySelector("#searchUnRefPanel");return n.addEventListener("click",U=>{var ee,Z,k;let w=U.target;const S=n.querySelector("#searchPathInput");for(;w&&w!==n;){const B=w.getAttribute("data-type");if(B==="removeCriterion"){Td(n,{removed:!0,sort:0,group:0,hasReplace:!1,method:0,hPath:"",idPath:[],k:"",r:"",page:1,types:Tv(),replaceTypes:Object.assign({},p.SIYUAN_DEFAULT_REPLACETYPES)},e,g,!0),(ee=n.querySelector(".b3-chip--current"))==null||ee.classList.remove("b3-chip--current"),U.stopPropagation(),U.preventDefault();break}else if(B==="saveCriterion"){W2(e,l,n),U.stopPropagation(),U.preventDefault();break}else if(B==="next"){w.getAttribute("disabled")||e.page<parseInt(w.parentElement.querySelector("#searchResult").getAttribute("data-pagecount"))&&(e.page++,$i(n,e,g)),U.stopPropagation(),U.preventDefault();break}else if(B==="previous"){w.getAttribute("disabled")||e.page>1&&(e.page--,$i(n,e,g)),U.stopPropagation(),U.preventDefault();break}else if(w.classList.contains("b3-chip")&&B==="set-criteria"){e.removed=!1,(Z=w.parentElement.querySelector(".b3-chip--current"))==null||Z.classList.remove("b3-chip--current"),w.classList.add("b3-chip--current"),l.find(H=>{if(H.name===w.innerText.trim())return Td(n,H,e,g),!0}),U.stopPropagation(),U.preventDefault();break}else if(w.classList.contains("b3-chip__close")&&B==="remove-criteria"){const H=w.parentElement.textContent;ae("/api/storage/removeCriterion",{name:H}),l.find((j,re)=>{if(j.name===H)return l.splice(re,1),!0}),w.parentElement.classList.contains("b3-chip--current")&&Td(n,{removed:!0,sort:0,group:0,hasReplace:!1,method:0,hPath:"",idPath:[],k:"",r:"",page:1,types:Tv(),replaceTypes:Object.assign({},p.SIYUAN_DEFAULT_REPLACETYPES)},e,g,!0),w.parentElement.remove(),U.stopPropagation(),U.preventDefault();break}else if(w.classList.contains("search__rmpath")){e.idPath=[],e.hPath="",e.page=1,S.textContent="",S.setAttribute("aria-label",""),$i(n,e,g,!0);const H=n.querySelector("#searchInclude");H.firstElementChild.classList.add("ft__primary"),H.setAttribute("disabled","disabled"),U.stopPropagation(),U.preventDefault();break}else if(w.id==="searchExpand"){Array.from(c.children).forEach(H=>{H.classList.contains("b3-list-item")&&(H.querySelector(".b3-list-item__arrow").classList.add("b3-list-item__arrow--open"),H.nextElementSibling.classList.remove("fn__none"))}),U.stopPropagation(),U.preventDefault();break}else if(w.id==="searchCollapse"){Array.from(c.children).forEach(H=>{H.classList.contains("b3-list-item")&&(H.querySelector(".b3-list-item__arrow").classList.remove("b3-list-item__arrow--open"),H.nextElementSibling.classList.add("fn__none"))}),U.stopPropagation(),U.preventDefault();break}else if(w.id==="searchPath"){ur((H,j)=>{ae("/api/filetree/getHPathsByPaths",{paths:H},re=>{e.idPath=[];const Te=[];let Be=!1;H.forEach((Ce,Je)=>{Ce==="/"?(e.idPath.push(j[Je]),Te.push(Ds(j[Je]))):(Be=!0,e.idPath.push(_n().join(j[Je],Ce.replace(".sy",""))))}),re.data&&Te.push(...re.data),e.hPath=Te.join(" "),e.page=1,S.innerHTML=`${Ge(e.hPath)}<svg class="search__rmpath"><use xlink:href="#iconCloseRound"></use></svg>`,S.setAttribute("aria-label",he(e.hPath));const Ie=n.querySelector("#searchInclude");Ie.firstElementChild.classList.add("ft__primary"),Be?Ie.removeAttribute("disabled"):Ie.setAttribute("disabled","disabled"),$i(n,e,g,!0)})},[],void 0,window.siyuan.languages.specifyPath),U.stopPropagation(),U.preventDefault();break}else if(w.id==="searchInclude"){if(U.stopPropagation(),U.preventDefault(),w.hasAttribute("disabled"))return;const H=w.firstElementChild;H.classList.toggle("ft__primary"),H.classList.contains("ft__primary")?e.idPath.forEach((j,re)=>{j.endsWith(".sy")&&(e.idPath[re]=j.replace(".sy",""))}):e.idPath.forEach((j,re)=>{!j.endsWith(".sy")&&j.split("/").length>1&&(e.idPath[re]=j+".sy")}),e.page=1,$i(n,e,g,!0);break}else if(w.id==="searchReplace"){e.hasReplace=!e.hasReplace,n.querySelectorAll(".search__header")[1].classList.toggle("fn__none"),(k=n.querySelector("#criteria .b3-chip--current"))==null||k.classList.remove("b3-chip--current"),U.stopPropagation(),U.preventDefault();break}else if(w.id==="searchUnRef"){iM(v,f),U.stopPropagation(),U.preventDefault();break}else if(w.id==="unRefMore"){sM(w,v,f),U.stopPropagation(),U.preventDefault();break}else if(w.id==="searchUnRefClose"){window.siyuan.menus.menu.remove(),v.classList.add("fn__none"),_.previousElementSibling.classList.remove("fn__none"),d.select(),U.stopPropagation(),U.preventDefault();break}else if(B==="unRefPrevious"){if(!w.getAttribute("disabled")){let H=parseInt(v.querySelector("#searchUnRefResult").textContent);H>1&&(H--,Ef(v,f,H))}U.stopPropagation(),U.preventDefault();break}else if(B==="unRefNext"){if(!w.getAttribute("disabled")){let H=parseInt(v.querySelector("#searchUnRefResult").textContent);H<parseInt(v.querySelector("#searchUnRefResult").textContent.split("/")[1])&&(H++,Ef(v,f,H))}U.stopPropagation(),U.preventDefault();break}else if(w.id==="searchAsset"){J5(_,!a),U.stopPropagation(),U.preventDefault();break}else if(w.id==="searchAssetClose"){window.siyuan.menus.menu.remove(),_.classList.add("fn__none"),_.previousElementSibling.classList.remove("fn__none"),d.select(),U.stopPropagation(),U.preventDefault();break}else if(w.id==="searchOpen"){e.k=d.value,e.r=u.value,qs({app:t,searchData:e,position:window.siyuan.layout.centerLayout.children.length>1||window.innerWidth>1024?"right":void 0}),a&&a(),U.stopPropagation(),U.preventDefault();break}else if(w.id==="searchRefresh"){$i(n,e,g),U.stopPropagation(),U.preventDefault();break}else if(w.id==="searchMore"){j5(e,l,n,()=>{e.page=1,$i(n,e,g,!0)},()=>{var j;Td(n,{removed:!0,sort:0,group:0,hasReplace:!1,method:0,hPath:"",idPath:[],k:"",r:"",page:1,types:Tv(),replaceTypes:Object.assign({},p.SIYUAN_DEFAULT_REPLACETYPES)},e,g,!0),(j=n.querySelector("#criteria .b3-chip--current"))==null||j.classList.remove("b3-chip--current")},()=>{const j=window.siyuan.storage[p.LOCAL_SEARCHKEYS],re=N(n,"b3-dialog__container");window.siyuan.menus.menu.append(new xe({iconHTML:"",label:window.siyuan.languages.layout,type:"submenu",submenu:[{iconHTML:"",label:window.siyuan.languages.topBottomLayout,current:re?j.layout===0:j.layoutTab===0,click(){n.querySelector(".search__layout").classList.remove("search__layout--row"),g.protyle.element.style.width="",re&&j.row||!re&&j.rowTab?(g.protyle.element.style.height=re?j.row:j.rowTab,g.protyle.element.classList.remove("fn__flex-1")):g.protyle.element.classList.add("fn__flex-1"),Ai(g.protyle),re?j.layout=0:j.layoutTab=0,Gt(p.LOCAL_SEARCHKEYS,window.siyuan.storage[p.LOCAL_SEARCHKEYS])}},{iconHTML:"",label:window.siyuan.languages.leftRightLayout,current:re?j.layout===1:j.layoutTab===1,click(){n.querySelector(".search__layout").classList.add("search__layout--row"),g.protyle.element.style.height="",re&&j.col||!re&&j.colTab?(g.protyle.element.style.width=re?j.col:j.colTab,g.protyle.element.classList.remove("fn__flex-1")):g.protyle.element.classList.add("fn__flex-1"),Ai(g.protyle),re?j.layout=1:j.layoutTab=1,Gt(p.LOCAL_SEARCHKEYS,window.siyuan.storage[p.LOCAL_SEARCHKEYS])}}]}).element)});const H=w.getBoundingClientRect();window.siyuan.menus.menu.popup({x:H.right,y:H.bottom,isLeft:!0}),U.stopPropagation(),U.preventDefault();break}else if(w.id==="searchFilter"){window.siyuan.menus.menu.remove(),z5(e,()=>{e.page=1,$i(n,e,g,!0)}),U.stopPropagation(),U.preventDefault();break}else if(w.id==="replaceFilter"){window.siyuan.menus.menu.remove(),Y5(e),U.stopPropagation(),U.preventDefault();break}else if(B==="assetPrevious"){if(!w.getAttribute("disabled")){let H=parseInt(_.querySelector("#searchAssetResult .fn__flex-center").textContent.split("/")[0]);H>1&&(H--,Ks(_,y,H))}U.stopPropagation(),U.preventDefault();break}else if(B==="assetNext"){if(!w.getAttribute("disabled")){let H=parseInt(_.querySelector("#searchAssetResult .fn__flex-center").textContent.split("/")[0]);H<parseInt(_.querySelector("#searchAssetResult .fn__flex-center").textContent.split("/")[1])&&(H++,Ks(_,y,H))}U.stopPropagation(),U.preventDefault();break}else if(w.id==="assetMore"){aM(w,_,()=>{Ks(_),Gt(p.LOCAL_SEARCHASSET,y)}),U.stopPropagation(),U.preventDefault();break}else if(w.id==="assetFilter"){nM(_),U.stopPropagation(),U.preventDefault();break}else if(w.id==="assetSyntaxCheck"){eM(w,()=>{n.querySelector("#assetSyntaxCheck").outerHTML=$h(y.method,"assetSyntaxCheck"),Ks(_,y),Gt(p.LOCAL_SEARCHASSET,y)}),U.stopPropagation(),U.preventDefault();break}else if(w.id==="searchSyntaxCheck"){G5(e,()=>{n.querySelector("#searchSyntaxCheck").outerHTML=$h(e.method,"searchSyntaxCheck"),e.page=1,$i(n,e,g,!0)});const H=w.getBoundingClientRect();window.siyuan.menus.menu.popup({x:H.right,y:H.bottom,isLeft:!0}),U.stopPropagation(),U.preventDefault();break}else if(w.id==="searchHistoryBtn"){Y2(n,e,g),U.stopPropagation(),U.preventDefault();return}else if(w.id==="assetHistoryBtn"){G2(_),U.stopPropagation(),U.preventDefault();return}else if(w.id==="replaceHistoryBtn"){z2(n.querySelector("#replaceInput")),U.stopPropagation(),U.preventDefault();return}else if(w.id==="replaceAllBtn"){Dv(n,e,g,!0),U.stopPropagation(),U.preventDefault();break}else if(B==="assetRefresh"){Ks(_),U.stopPropagation(),U.preventDefault();break}else if(w.id==="replaceBtn"){Dv(n,e,g,!1),U.stopPropagation(),U.preventDefault();break}else if(w.classList.contains("b3-list-item__toggle")){w.parentElement.nextElementSibling.classList.toggle("fn__none"),w.firstElementChild.classList.toggle("b3-list-item__arrow--open"),U.stopPropagation(),U.preventDefault();break}else if(w.classList.contains("b3-list-item")){const H=n.querySelector("#searchAssetInput");if(B==="search-new")e.method==0&&Sv(t,d.value);else if(B==="search-item"){const j=w.dataset.id?"asset":v.classList.contains("fn__none")?"doc":"unRef";let re=U.detail===1,Te=U.detail===2;if(yn()){const Be=new Date().getTime();re=Be-m>p.TIMEOUT_DBLCLICK,Te=!re,m=Be}if(re)h=window.setTimeout(()=>{if(j==="asset")w.classList.contains("b3-list-item--focus")?w.classList.contains("b3-list-item--focus")&&(Q5(n.querySelector("#searchAssetPreview")),H.focus()):(_.querySelector(".b3-list-item--focus").classList.remove("b3-list-item--focus"),w.classList.add("b3-list-item--focus"),Gy(n.querySelector("#searchAssetPreview"),w.dataset.id,H.value,window.siyuan.storage[p.LOCAL_SEARCHASSET].method),H.focus());else if(U.altKey){const Be=w.getAttribute("data-node-id");na(Be,(Ie,Ce)=>{dn({app:t,id:Be,action:Ce,zoomIn:Ie,position:"right"}),a&&a()})}else w.classList.contains("b3-list-item--focus")?j==="doc"&&w.classList.contains("b3-list-item--focus")&&(rM({edit:g,id:w.getAttribute("data-node-id"),target:w}),d.focus()):((j==="doc"?c:v).querySelector(".b3-list-item--focus").classList.remove("b3-list-item--focus"),w.classList.add("b3-list-item--focus"),Dd({edit:j==="doc"?g:f,id:w.getAttribute("data-node-id"),config:j==="doc"?e:null,value:j==="doc"?d.value:null}),d.focus())},p.TIMEOUT_DBLCLICK);else if(Te&&ct(U)&&(clearTimeout(h),j!=="asset")){const Be=w.getAttribute("data-node-id");na(Be,(Ie,Ce)=>{dn({app:t,id:Be,action:Ce,zoomIn:Ie}),a&&a()})}window.siyuan.menus.menu.remove()}else w.querySelector(".b3-list-item__toggle")&&(w.nextElementSibling.classList.toggle("fn__none"),w.firstElementChild.firstElementChild.classList.toggle("b3-list-item__arrow--open"));U.stopPropagation(),U.preventDefault();break}w=w.parentElement}},!1),d.addEventListener("compositionend",U=>{e.page=1,!U.isComposing&&$i(n,e,g,!0)}),d.addEventListener("input",U=>{e.page=1,!U.isComposing&&$i(n,e,g,!0)}),d.addEventListener("blur",()=>{e.removed&&(e.k=d.value,window.siyuan.storage[p.LOCAL_SEARCHDATA]=Object.assign({},e),Gt(p.LOCAL_SEARCHDATA,window.siyuan.storage[p.LOCAL_SEARCHDATA])),j2("keys",d.value)}),Bh({inputElement:d,right:8,height:d.clientHeight,clearCB(){e.page=1,$i(n,e,g)}}),Bh({right:8,inputElement:u,height:d.clientHeight}),$i(n,e,g),{edit:g,unRefEdit:f}},$h=(t,e)=>{let n="",a="";switch(t){case 0:n=window.siyuan.languages.keyword,a="Exact";break;case 1:n=window.siyuan.languages.querySyntax,a="Quote";break;case 2:n="SQL",a="Database";break;case 3:n=window.siyuan.languages.regex,a="Regex";break}return`<span id="${e}" aria-label="${window.siyuan.languages.searchMethod} ${n}" class="block__icon ariaLabel" data-position="9south">
    <svg><use xlink:href="#icon${a}"></use></svg>
</span>`},Td=(t,e,n,a,i=!1)=>{const s=N(t,"b3-dialog--open");if(s&&s.getAttribute("data-key")===p.DIALOG_SEARCH&&(e.hPath=n.hPath,e.idPath=[...n.idPath]),n.hasReplace!==e.hasReplace){const d=t.querySelectorAll(".search__header")[1];e.hasReplace?d.classList.remove("fn__none"):d.classList.add("fn__none")}const r=t.querySelector("#searchPathInput");e.hPath?(r.innerHTML=`${Ge(e.hPath)}<svg class="search__rmpath"><use xlink:href="#iconCloseRound"></use></svg>`,r.setAttribute("aria-label",he(e.hPath))):(r.innerHTML="",r.setAttribute("aria-label","")),n.group!==e.group&&(e.group===0?t.querySelector("#searchExpand").parentElement.classList.add("fn__none"):t.querySelector("#searchExpand").parentElement.classList.remove("fn__none"));let o=!0,l=!1;e.idPath.forEach(d=>{d.endsWith(".sy")&&(o=!1),d.split("/").length>1&&(l=!0)});const c=t.querySelector("#searchInclude");o?c.firstElementChild.classList.add("ft__primary"):c.firstElementChild.classList.remove("ft__primary"),l?c.removeAttribute("disabled"):c.setAttribute("disabled","disabled"),(e.k||i)&&(t.querySelector("#searchInput").value=e.k),t.querySelector("#replaceInput").value=e.r,t.querySelector("#searchSyntaxCheck").outerHTML=$h(e.method,"searchSyntaxCheck"),n=JSON.parse(JSON.stringify(e)),window.siyuan.storage[p.LOCAL_SEARCHDATA]=JSON.parse(JSON.stringify(e)),Gt(p.LOCAL_SEARCHDATA,window.siyuan.storage[p.LOCAL_SEARCHDATA]),$i(t,n,a),window.siyuan.menus.menu.remove()},Z2=(t,e,n)=>{t.scrollTop=t.scrollTop+e.getBoundingClientRect().top-n.top-n.height/2;const a=N(e.startContainer,"table");if(a){const i=A(e.startContainer,"TD")||A(e.startContainer,"TH");i&&(a.firstElementChild.scrollLeft=i.offsetLeft,a.getAttribute("custom-pinthead")==="true"&&(t.scrollTop=t.scrollTop+a.getBoundingClientRect().top-n.top,a.querySelector("table").scrollTop=i.offsetTop))}},rM=t=>{const e=t.edit.protyle.contentElement.getBoundingClientRect();if(Gs()){t.edit.protyle.highlight.markHL.clear(),t.edit.protyle.highlight.mark.clear(),t.edit.protyle.highlight.rangeIndex++,t.edit.protyle.highlight.rangeIndex>=t.edit.protyle.highlight.ranges.length&&(t.edit.protyle.highlight.rangeIndex=0);let i;t.edit.protyle.highlight.ranges.forEach((s,r)=>{t.edit.protyle.highlight.rangeIndex===r?(t.edit.protyle.highlight.markHL.add(s),i=s):t.edit.protyle.highlight.mark.add(s)}),i&&(i.toString()?Z2(t.edit.protyle.contentElement,i,e):dr(t.edit.protyle,t.id,"center"));return}let n;const a=Array.from(t.edit.protyle.wysiwyg.element.querySelectorAll('span[data-type~="search-mark"]'));a.find((i,s)=>{if(i.classList.contains("search-mark--hl")){i.classList.remove("search-mark--hl"),n=a[s+1];return}}),n||(n=a[0]),n&&(n.classList.add("search-mark--hl"),t.edit.protyle.contentElement.scrollTop=t.edit.protyle.contentElement.scrollTop+n.getBoundingClientRect().top-e.top-e.height/2)};let jy;const Dd=t=>{jy=t.id,na(t.id,e=>{jy===t.id&&(t.edit.protyle.scroll.lastScrollTop=0,Ud(t.edit.protyle),ae("/api/block/getDocInfo",{id:t.id},n=>{var a,i;jy===t.id&&(t.edit.protyle.options.render.title&&t.edit.protyle.title.render(t.edit.protyle,n),ae("/api/filetree/getDoc",{id:t.id,query:t.value||null,queryMethod:((a=t.config)==null?void 0:a.method)||null,queryTypes:((i=t.config)==null?void 0:i.types)||null,mode:e?0:3,size:e?p.SIZE_GET_MAX:window.siyuan.config.editor.dynamicLoadBlocks,zoom:e,highlight:!Gs()},s=>{var r,o;if(jy!==t.id)return;t.edit.protyle.query={key:t.value||null,method:((r=t.config)==null?void 0:r.method)||null,types:((o=t.config)==null?void 0:o.types)||null},_a({updateReadonly:!0,data:s,protyle:t.edit.protyle,action:e?[p.CB_GET_ALL,p.CB_GET_HTML]:[p.CB_GET_HTML]});const l=t.edit.protyle.contentElement.getBoundingClientRect();if(Gs()){let c;Ah(t.edit.protyle,s.data.keywords,t.id,()=>{const d=()=>{const u=t.edit.protyle.highlight.ranges[t.edit.protyle.highlight.rangeIndex];t.edit.protyle.highlight.ranges.length>0&&u&&u.toString()?Z2(t.edit.protyle.contentElement,u,l):dr(t.edit.protyle,t.id,"center")};c&&c.disconnect(),d(),c=new ResizeObserver(()=>{d()}),c.observe(t.edit.protyle.wysiwyg.element),setTimeout(()=>{c.disconnect()},p.TIMEOUT_COUNT)})}else{const c=t.edit.protyle.wysiwyg.element.querySelectorAll('span[data-type~="search-mark"]');if(c.length===0)return;c[0].classList.add("search-mark--hl"),t.edit.protyle.contentElement.scrollTop=t.edit.protyle.contentElement.scrollTop+c[0].getBoundingClientRect().top-l.top-l.height/2}}))}))})},Dv=(t,e,n,a)=>{if(e.method===2){Q(window.siyuan.languages._kernel[132]);return}const i=t.querySelector("#searchList"),s=t.querySelector("#replaceInput"),r=t.querySelector("#searchInput"),o=t.querySelector("svg.fn__rotate");if(!o.classList.contains("fn__none"))return;j2("replaceKeys",s.value);const l=i.querySelector(".b3-list-item--focus");if(!l||l.dataset.type==="search-new")return;o.classList.remove("fn__none");const c=l.getAttribute("data-node-id");ae("/api/search/findReplace",{k:e.method===0||e.method===1?X5(l):r.value,r:s.value,method:e.method,types:e.types,paths:e.idPath||[],groupBy:e.group,orderBy:e.sort,page:e.page,ids:a?[]:[c],replaceTypes:e.replaceTypes},d=>{var u;if(o.classList.add("fn__none"),d.code===1){Q(d.msg);return}if(a){$i(t,e,n,!1);return}const g=l.getAttribute("data-root-id");Cn().editor.forEach(h=>{g===h.editor.protyle.block.rootID&&$o(h.editor.protyle,!1)});let f=l.getAttribute("data-node-id");if(l.nextElementSibling?f=l.nextElementSibling.getAttribute("data-node-id"):l.previousElementSibling&&(f=l.previousElementSibling.getAttribute("data-node-id")),e.group===1&&!f){const h=l.parentElement.nextElementSibling||((u=l.parentElement.previousElementSibling.previousElementSibling)==null?void 0:u.previousElementSibling);h&&(f=h.nextElementSibling.firstElementChild.getAttribute("data-node-id"))}$i(t,e,n,!1,{currentId:c,newId:f})})},$i=(t,e,n,a=!1,i)=>{let s=parseInt(t.getAttribute("data-timeout")||"0");clearTimeout(s),s=window.setTimeout(()=>{var r,o;a&&((r=t.querySelector("#criteria .b3-chip--current"))==null||r.classList.remove("b3-chip--current"));const l=t.querySelector(".fn__loading--top");l.classList.remove("fn__none");const c=t.querySelector("#searchInput");e.query=c.value,t.querySelector("#searchList").scrollTo(0,0);const d=t.querySelector('[data-type="previous"]'),u=t.querySelector('[data-type="next"]');(o=n.protyle)==null||o.app.plugins.forEach(f=>{f.eventBus.emit("input-search",{protyle:n,config:e,searchElement:c})});const g=t.querySelector("#searchResult");e.query===""&&(!e.idPath||e.idPath.length===0)?ae("/api/block/getRecentUpdatedBlocks",{},f=>{window.siyuan.reqIds["/api/block/getRecentUpdatedBlocks"]&&window.siyuan.reqIds["/api/search/fullTextSearchBlock"]&&window.siyuan.reqIds["/api/block/getRecentUpdatedBlocks"]<window.siyuan.reqIds["/api/search/fullTextSearchBlock"]||(J2(f.data,n,t,e),l.classList.add("fn__none"),g.innerHTML="",d.setAttribute("disabled","true"),u.setAttribute("disabled","true"))}):(e.page>1?d.removeAttribute("disabled"):d.setAttribute("disabled","disabled"),ae("/api/search/fullTextSearchBlock",{query:e.query,method:e.method,types:e.types,paths:e.idPath||[],groupBy:e.group,orderBy:e.sort,page:e.page||1},f=>{if(window.siyuan.reqIds["/api/block/getRecentUpdatedBlocks"]&&window.siyuan.reqIds["/api/search/fullTextSearchBlock"]&&window.siyuan.reqIds["/api/block/getRecentUpdatedBlocks"]>window.siyuan.reqIds["/api/search/fullTextSearchBlock"])return;e.page||(e.page=1),e.page<f.data.pageCount?u.removeAttribute("disabled"):u.setAttribute("disabled","disabled"),J2(f.data.blocks,n,t,e,i);let h=window.siyuan.languages.findInDoc.replace("${x}",f.data.matchedRootCount).replace("${y}",f.data.matchedBlockCount);f.data.docMode&&(h=window.siyuan.languages.matchDoc.replace("${x}",f.data.matchedRootCount)),g.innerHTML=`${e.page}/${f.data.pageCount||1}<span class="fn__space"></span>
<span class="ft__on-surface">${h}</span>`,l.classList.add("fn__none"),g.setAttribute("data-pagecount",f.data.pageCount||1)}))},p.TIMEOUT_INPUT),t.setAttribute("data-timeout",s.toString())},Cv=t=>{let e="";return t.name&&(e+=`<span class="b3-list-item__meta fn__flex" style="max-width: 30%"><svg class="b3-list-item__hinticon"><use xlink:href="#iconN"></use></svg><span class="b3-list-item__hinttext">${t.name}</span></span>`),t.alias&&(e+=`<span class="b3-list-item__meta fn__flex" style="max-width: 30%"><svg class="b3-list-item__hinticon"><use xlink:href="#iconA"></use></svg><span class="b3-list-item__hinttext">${t.alias}</span></span>`),t.memo&&(e+=`<span class="b3-list-item__meta fn__flex" style="max-width: 30%"><svg class="b3-list-item__hinticon"><use xlink:href="#iconM"></use></svg><span class="b3-list-item__hinttext">${t.memo}</span></span>`),e},J2=(t,e,n,a,i)=>{let s="",r,o;if(t.forEach(l=>{const c=Ds(l.box)+ha(l.hPath,!1);let d="";l.children?(s+=`<div class="b3-list-item">
<span class="b3-list-item__toggle b3-list-item__toggle--hl">
    <svg class="b3-list-item__arrow b3-list-item__arrow--open"><use xlink:href="#iconRight"></use></svg>
</span>
${Yt(Cs(l.box)||window.siyuan.storage[p.LOCAL_IMAGES].note,"b3-list-item__graphic",!0)}
<span class="b3-list-item__text ariaLabel" style="color: var(--b3-theme-on-surface)" aria-label="${Ot(c)}">${Ge(c)}</span>
</div><div>`,l.children.forEach(u=>{i&&(u.id===i.currentId&&(r=u),u.id===i.newId&&(o=u)),u.refCount&&(d=`<span class="popover__block counter b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.ref}">${u.refCount}</span>`),s+=`<div style="padding-left: 36px" data-type="search-item" class="b3-list-item" data-node-id="${u.id}" data-root-id="${u.rootID}">
<svg class="b3-list-item__graphic popover__block" data-id="${u.id}"><use xlink:href="#${Qi(u.type)}"></use></svg>
${Yt(u.ial.icon,"b3-list-item__graphic",!0)}
<span class="b3-list-item__text">${u.content}</span>
${Cv(u)}
${u.tag?`<span class="b3-list-item__meta b3-list-item__meta--ellipsis">${u.tag.replace(/#/g,"")}</span>`:""}
${d}
</div>`}),s+="</div>"):(i&&(l.id===i.currentId&&(r=l),l.id===i.newId&&(o=l)),l.refCount&&(d=`<span class="popover__block counter b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.ref}">${l.refCount}</span>`),s+=`<div data-type="search-item" class="b3-list-item" data-node-id="${l.id}" data-root-id="${l.rootID}">
<svg class="b3-list-item__graphic popover__block" data-id="${l.id}"><use xlink:href="#${Qi(l.type)}"></use></svg>
${Yt(l.ial.icon,"b3-list-item__graphic",!0)}
<span class="b3-list-item__text">${l.content}</span>
${Cv(l)}
${l.tag?`<span class="b3-list-item__meta b3-list-item__meta--ellipsis">${l.tag.replace(/#/g,"")}</span>`:""}
<span class="b3-list-item__meta b3-list-item__meta--ellipsis ariaLabel" aria-label="${Ot(c)}">${Ge(c)}</span>
${d}
</div>`)}),r||(r=o),!r&&t.length>0&&(t[0].children?r=t[0].children[0]:r=t[0]),r?(e.protyle.element.classList.remove("fn__none"),n.querySelector(".search__drag").classList.remove("fn__none"),Dd({edit:e,id:r.id,config:a,value:n.querySelector("#searchInput").value})):(e.protyle.element.classList.add("fn__none"),n.querySelector(".search__drag").classList.add("fn__none")),n.querySelector("#searchList").innerHTML=s||(a.method===0?`<div class="b3-list-item b3-list-item--focus" data-type="search-new">
    <svg class="b3-list-item__graphic"><use xlink:href="#iconFile"></use></svg>
    <span class="b3-list-item__text">
        ${window.siyuan.languages.newFile} <mark>${he(n.querySelector("#searchInput").value)}</mark>
    </span>
    <kbd class="b3-list-item__meta">${window.siyuan.languages.enterNew}</kbd>
</div>
<div class="search__empty">
    ${window.siyuan.languages.enterNewTip}
</div>`:`<div class="b3-list-item b3-list-item--focus" data-type="search-new">
    <span class="b3-list-item__text">
        ${window.siyuan.languages.emptyContent}
    </span>
</div>`),r){const l=n.querySelector(`[data-node-id="${r.id}"]`);l&&(l.classList.add("b3-list-item--focus"),!l.previousElementSibling&&l.parentElement.previousElementSibling?l.parentElement.previousElementSibling.scrollIntoView():l.scrollIntoView())}},Q2=t=>{var e;const n=parseInt(t.getAttribute("data-subtype").substr(1));let a=t.nextElementSibling;for(;a;){const i=parseInt((e=a.getAttribute("data-subtype"))==null?void 0:e.substr(1));if(!a.classList.contains("protyle-attr")&&(isNaN(i)||i>n)){const s=a;a=a.nextElementSibling,s.remove()}else break}};class oM{constructor(){this.hasUndo=!1,this.redoStack=[],this.undoStack=[]}undo(e){if(e.disabled||this.undoStack.length===0)return;const n=this.undoStack.pop();if(this.render(e,n,!1),this.hasUndo=!0,this.redoStack.push(n),e.breadcrumb){const a=e.breadcrumb.element.parentElement.querySelector('[data-type="undo"]');a&&(this.undoStack.length===0&&a.setAttribute("disabled","true"),e.breadcrumb.element.parentElement.querySelector('[data-type="redo"]').removeAttribute("disabled"))}}redo(e){if(e.disabled||this.redoStack.length===0)return;const n=this.redoStack.pop();if(this.render(e,n,!0),this.undoStack.push(n),e.breadcrumb){const a=e.breadcrumb.element.parentElement.querySelector('[data-type="redo"]');a&&(e.breadcrumb.element.parentElement.querySelector('[data-type="undo"]').removeAttribute("disabled"),this.redoStack.length===0&&a.setAttribute("disabled","true"))}}render(e,n,a){var i;Ut(["hint","gutter"],e),e.wysiwyg.lastHTMLs={},a?(n.doOperations.forEach(s=>{f_(e,s,!0)}),et(e,n.doOperations)):(n.undoOperations.forEach(s=>{f_(e,s,!0)}),et(e,n.undoOperations)),(i=document.querySelector(".av__panel"))==null||i.remove(),es(e),kn(e)}replace(e,n){if(this.hasUndo&&this.redoStack.length>0&&(this.undoStack.push(this.redoStack.pop()),this.redoStack=[],this.hasUndo=!1,n.breadcrumb)){const a=n.breadcrumb.element.parentElement.querySelector('[data-type="redo"]');a&&a.setAttribute("disabled","true")}this.undoStack.length>0&&(this.undoStack[this.undoStack.length-1].doOperations=e)}add(e,n,a){if(this.undoStack.push({undoOperations:n,doOperations:e}),this.undoStack.length>p.SIZE_UNDO&&this.undoStack.shift(),this.hasUndo&&(this.redoStack=[],this.hasUndo=!1),a.breadcrumb){const i=a.breadcrumb.element.parentElement.querySelector('[data-type="undo"]');i&&i.removeAttribute("disabled")}}clear(){this.undoStack=[],this.redoStack=[]}}const uo=t=>!1,lM=(t,e,n)=>{var a,i,s,r,o,l,c,d,u;let g,f="",h=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));if(h.length===0){let b=It(e);const y=ue(b,"fold","1");y&&(b=y),(a=b.previousElementSibling)!=null&&a.classList.contains("protyle-action")&&(b=It(b.parentElement)),h=[b]}const m=h[0].getAttribute("data-type");if(m==="NodeListItem"&&!h[0].previousElementSibling&&((s=(i=h[0].parentElement.previousElementSibling)==null?void 0:i.previousElementSibling)!=null&&s.classList.contains("protyle-action")))if((r=h[0].parentElement.parentElement.previousElementSibling)!=null&&r.classList.contains("li")){if(g=h[0].parentElement.parentElement.previousElementSibling.querySelector(".list"),n.insertNode(document.createElement("wbr")),f=h[0].parentElement.parentElement.parentElement.outerHTML,!g){const b=Lute.NewNodeID();h[0].parentElement.parentElement.previousElementSibling.lastElementChild.insertAdjacentHTML("beforebegin",`<div data-subtype="${h[0].getAttribute("data-subtype")}" data-node-id="${b}" data-type="NodeList" class="list" updated="${b.split("-")[0]}"><div id="moveTempLi"></div><div class="protyle-attr" contenteditable="false">&ZeroWidthSpace;</div></div>`),g=h[0].parentElement.parentElement.previousElementSibling.querySelector(".list")}}else return;if(m==="NodeList"&&((l=(o=h[0].previousElementSibling)==null?void 0:o.previousElementSibling)!=null&&l.classList.contains("protyle-action")))if((c=h[0].parentElement.previousElementSibling)!=null&&c.classList.contains("li")){if(g=h[0].parentElement.previousElementSibling.querySelector(".list"),n.insertNode(document.createElement("wbr")),f=h[0].parentElement.parentElement.outerHTML,!g){const b=Lute.NewNodeID();h[0].parentElement.previousElementSibling.lastElementChild.insertAdjacentHTML("beforebegin",`<div data-subtype="${h[0].getAttribute("data-subtype")}" data-node-id="${b}" data-type="NodeList" class="list" updated="${b.split("-")[0]}"><div id="moveTempLi"></div><div class="protyle-attr" contenteditable="false">&ZeroWidthSpace;</div></div>`),g=h[0].parentElement.previousElementSibling.querySelector(".list")}}else return;if(g){g=g.lastElementChild.previousElementSibling;const b=h[0].classList.contains("list")?h[0]:h[0].parentElement;h.reverse().forEach(y=>{y.classList.contains("list")?g.after(y.firstElementChild):g.after(y)}),g.id==="moveTempLi"&&(g=g.nextElementSibling,g.previousElementSibling.remove()),b.childElementCount===1?b.remove():b.getAttribute("data-subtype")==="o"&&b.classList.contains("list")&&xa(b,1),g.getAttribute("data-subtype")==="o"&&xa(g.parentElement),Ht(t,g.parentElement.parentElement.parentElement.getAttribute("data-node-id"),g.parentElement.parentElement.parentElement.outerHTML,f),es(t),cn(g.parentElement,n),kn(t);return}if(!(!h[0].previousElementSibling||(d=h[0].previousElementSibling)!=null&&d.classList.contains("protyle-action"))){if(g=h[0].previousElementSibling,h[0].getAttribute("data-subtype")==="o"&&m==="NodeListItem"){const b=h[0].parentElement.outerHTML;h[h.length-1].after(g),xa(h[0].parentElement,1),Ht(t,h[0].parentElement.getAttribute("data-node-id"),h[0].parentElement.outerHTML,b)}else{const b=g.getAttribute("data-node-id");et(t,[{action:"move",id:b,previousID:h[h.length-1].getAttribute("data-node-id")}],[{action:"move",id:b,previousID:(u=g.previousElementSibling)==null?void 0:u.getAttribute("data-node-id"),parentID:g.parentElement.getAttribute("data-node-id")||t.block.parentID}]),h[h.length-1].after(g)}es(t),kn(t)}},cM=(t,e,n)=>{var a,i,s,r,o,l,c;let d,u="",g=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));if(g.length===0){let h=It(e);const m=ue(h,"fold","1");m&&(h=m),(a=h.previousElementSibling)!=null&&a.classList.contains("protyle-action")&&(h=It(h.parentElement)),g=[h]}const f=g[0].getAttribute("data-type");if(f==="NodeListItem"&&g[g.length-1].nextElementSibling.classList.contains("protyle-attr")&&((i=g[0].parentElement.parentElement)!=null&&i.classList.contains("li")))if((s=g[0].parentElement.parentElement.nextElementSibling)!=null&&s.classList.contains("li")){if(d=g[0].parentElement.parentElement.nextElementSibling.querySelector(".list > .li"),n.insertNode(document.createElement("wbr")),u=g[0].parentElement.parentElement.parentElement.outerHTML,!d){const h=Lute.NewNodeID();g[0].parentElement.parentElement.nextElementSibling.lastElementChild.insertAdjacentHTML("beforebegin",`<div data-subtype="${g[0].getAttribute("data-subtype")}" data-node-id="${h}" data-type="NodeList" class="list" updated="${h.split("-")[0]}"><div class="protyle-attr" contenteditable="false">&ZeroWidthSpace;</div></div>`),d=g[0].parentElement.parentElement.nextElementSibling.querySelector(".list > div")}}else return;if(f==="NodeList"&&g[g.length-1].nextElementSibling.classList.contains("protyle-attr")&&((r=g[0].parentElement)!=null&&r.classList.contains("li")))if((o=g[0].parentElement.nextElementSibling)!=null&&o.classList.contains("li")){if(d=g[0].parentElement.nextElementSibling.querySelector(".list > .li"),n.insertNode(document.createElement("wbr")),u=g[0].parentElement.parentElement.outerHTML,!d){const h=Lute.NewNodeID();g[0].parentElement.nextElementSibling.lastElementChild.insertAdjacentHTML("beforebegin",`<div data-subtype="${g[0].getAttribute("data-subtype")}" data-node-id="${h}" data-type="NodeList" class="list" updated="${h.split("-")[0]}"><div class="protyle-attr" contenteditable="false">&ZeroWidthSpace;</div></div>`),d=g[0].parentElement.nextElementSibling.querySelector(".list > div")}}else return;if(d){const h=g[0].classList.contains("list")?g[0]:g[0].parentElement;g.forEach(m=>{m.classList.contains("list")?d.before(m.firstElementChild):d.before(m)}),h.childElementCount===1?h.remove():h.getAttribute("data-subtype")==="o"&&h.classList.contains("list")&&xa(h,1),d.getAttribute("data-subtype")==="o"&&xa(d.parentElement,1),Ht(t,d.parentElement.parentElement.parentElement.getAttribute("data-node-id"),d.parentElement.parentElement.parentElement.outerHTML,u),es(t),cn(d.parentElement,n),kn(t);return}if(!(!g[g.length-1].nextElementSibling||(l=g[g.length-1].nextElementSibling)!=null&&l.classList.contains("protyle-attr"))){if(d=g[g.length-1].nextElementSibling,d.getAttribute("data-subtype")==="o"&&d.getAttribute("data-type")==="NodeListItem"){const h=d.parentElement.outerHTML;g[0].before(d),xa(d.parentElement,1),Ht(t,d.parentElement.getAttribute("data-node-id"),d.parentElement.outerHTML,h)}else{const h=d.getAttribute("data-node-id");et(t,[{action:"move",id:h,previousID:(c=g[0].previousElementSibling)==null?void 0:c.getAttribute("data-node-id"),parentID:d.parentElement.getAttribute("data-node-id")||t.block.parentID}],[{action:"move",id:h,previousID:g[g.length-1].getAttribute("data-node-id")}]),g[0].before(d)}es(t),kn(t)}},eS=(t,e,n)=>{if(e.method===2){showMessage(window.siyuan.languages._kernel[132]);return}const a=t.querySelector("#searchList"),i=t.querySelector("#toolbarReplace"),s=i.parentElement.querySelector(".fn__rotate");if(!s.classList.contains("fn__none"))return;saveKeyList("replaceKeys",i.value);const r=a.querySelector(".b3-list-item--focus");if(!r)return;s.classList.remove("fn__none"),s.nextElementSibling.classList.add("fn__none");const o=r.getAttribute("data-node-id");fetchPost("/api/search/findReplace",{k:e.method===0||e.method===1?getKeyByLiElement(r):document.querySelector("#toolbarSearch").value,r:i.value,ids:n?[]:[o],types:e.types,method:e.method,replaceTypes:e.replaceTypes,paths:e.idPath||[],groupBy:e.group,orderBy:e.sort,page:e.page},l=>{var c;if(s.classList.add("fn__none"),s.nextElementSibling.classList.remove("fn__none"),l.code===1){showMessage(l.msg);return}if(n){Xs(e,t,!1);return}reloadProtyle(window.siyuan.mobile.editor.protyle,!1);let d=r.getAttribute("data-node-id");if(r.nextElementSibling?d=r.nextElementSibling.getAttribute("data-node-id"):r.previousElementSibling&&(d=r.previousElementSibling.getAttribute("data-node-id")),e.group===1&&!d){const u=r.parentElement.nextElementSibling||((c=r.parentElement.previousElementSibling.previousElementSibling)==null?void 0:c.previousElementSibling);u&&(d=u.nextElementSibling.firstElementChild.getAttribute("data-node-id"))}Xs(e,t,!1,{currentId:o,newId:d})})},Lv=(t,e,n)=>{n.hasReplace!==e.hasReplace&&(e.hasReplace?(t.querySelector('[data-type="toggle-replace"]').classList.add("toolbar__icon--active"),t.querySelector(".toolbar").classList.remove("fn__none")):(t.querySelector('[data-type="toggle-replace"]').classList.remove("toolbar__icon--active"),t.querySelector(".toolbar").classList.add("fn__none")));const a=t.querySelector("#searchPath");e.hPath?(a.classList.remove("fn__none"),a.innerHTML=`<div class="b3-chip b3-chip--middle">${escapeHtml(e.hPath)}<svg data-type="remove-path" class="b3-chip__close"><use xlink:href="#iconCloseRound"></use></svg></div>`):a.classList.add("fn__none"),n.group!==e.group&&(e.group===0?(t.querySelector('[data-type="expand"]').classList.add("fn__none"),t.querySelector('[data-type="contract"]').classList.add("fn__none")):(t.querySelector('[data-type="expand"]').classList.remove("fn__none"),t.querySelector('[data-type="contract"]').classList.remove("fn__none")));let i=!0,s=!1;e.idPath.forEach(o=>{o.endsWith(".sy")&&(i=!1),o.split("/").length>1&&(s=!0)});const r=t.querySelector('[data-type="include"]');i?r.classList.add("toolbar__icon--active"):r.classList.remove("toolbar__icon--active"),s?r.removeAttribute("disabled"):r.setAttribute("disabled","disabled"),document.querySelector("#toolbarSearch").value=e.k,t.querySelector("#toolbarReplace").value=e.r,Object.assign(n,e),window.siyuan.storage[Constants.LOCAL_SEARCHDATA]=Object.assign({},n),setStorageVal(Constants.LOCAL_SEARCHDATA,window.siyuan.storage[Constants.LOCAL_SEARCHDATA]),Xs(n,t),window.siyuan.menus.menu.remove()},tS=(t,e,n,a)=>{const i=document.querySelector("#searchList");let s="",r,o;t.forEach(c=>{const d=getNotebookName(c.box)+getDisplayName(c.hPath,!1);c.children?(s+=`<div class="b3-list-item">
<span class="b3-list-item__toggle b3-list-item__toggle--hl">
    <svg class="b3-list-item__arrow b3-list-item__arrow--open"><use xlink:href="#iconRight"></use></svg>
</span>
${unicode2Emoji(getNotebookIcon(c.box)||window.siyuan.storage[Constants.LOCAL_IMAGES].note,"b3-list-item__graphic",!0)}
<span class="b3-list-item__text" style="color: var(--b3-theme-on-surface)">${escapeGreat(d)}</span>
</div><div>`,c.children.forEach(u=>{a&&(u.id===a.currentId&&(r=u),u.id===a.newId&&(o=u)),s+=`<div style="padding-left: 36px" data-type="search-item" class="b3-list-item" data-node-id="${u.id}">
<svg class="b3-list-item__graphic"><use xlink:href="#${getIconByType(u.type)}"></use></svg>
${unicode2Emoji(u.ial.icon,"b3-list-item__graphic",!0)}
<span class="b3-list-item__text">${u.content}</span>
${u.tag?`<span class="b3-list-item__meta b3-list-item__meta--ellipsis">${u.tag.replace(/#/g,"")}</span>`:""}
</div>`}),s+="</div>"):(a&&(c.id===a.currentId&&(r=c),c.id===a.newId&&(o=c)),s+=`<div class="b3-list-item b3-list-item--two" data-type="search-item" data-node-id="${c.id}">
    <div class="b3-list-item__first">
        <svg class="b3-list-item__graphic"><use xlink:href="#${getIconByType(c.type)}"></use></svg>
        ${unicode2Emoji(c.ial.icon,"b3-list-item__graphic",!0)}
        <span class="b3-list-item__text">${c.content}</span>
    </div>
    <div class="fn__flex">
        ${c.tag?`<span class="b3-list-item__meta b3-list-item__meta--ellipsis">${c.tag.replace(/#/g,"")}</span><span class="fn__space"></span>`:""}
        <span class="b3-list-item__text b3-list-item__meta">${escapeGreat(d)}</span>
    </div>
</div>`)}),i.innerHTML=s||`<div class="b3-list-item b3-list-item--focus" data-type="search-new">
    <svg class="b3-list-item__graphic"><use xlink:href="#iconFile"></use></svg>
    <span class="b3-list-item__text">
        ${window.siyuan.languages.newFile} <mark>${document.querySelector("#toolbarSearch").value}</mark>
    </span>
</div>`,i.scrollTop=0;let l="";if(n){let c=window.siyuan.languages.findInDoc.replace("${x}",n.data.matchedRootCount).replace("${y}",n.data.matchedBlockCount);n.data.docMode&&(c=window.siyuan.languages.matchDoc.replace("${x}",n.data.matchedRootCount)),l=`<span class="fn__flex-center">${c}</span>
<span class="fn__flex-1"></span>
<span class="fn__flex-center">${e.page}/${n.data.pageCount||1}</span>`}if(i.previousElementSibling.querySelector('[data-type="result"]').innerHTML=l,r||(r=o),!r&&t.length>0&&(t[0].children?r=t[0].children[0]:r=t[0]),r){const c=i.querySelector(`[data-node-id="${r.id}"]`);c&&(c.classList.add("b3-list-item--focus"),c.scrollIntoView())}};let nS=0;const Xs=(t,e,n=!1,a)=>{clearTimeout(nS),nS=window.setTimeout(()=>{var i;n&&((i=e.querySelector("#criteria .b3-chip--current"))==null||i.classList.remove("b3-chip--current"));const s=e.querySelector(".fn__loading--top");s.classList.remove("fn__none");const r=e.querySelector('[data-type="previous"]'),o=e.querySelector('[data-type="next"]'),l=document.getElementById("toolbarSearch");t.query=l.value,t.query===""&&(!t.idPath||t.idPath.length===0)?fetchPost("/api/block/getRecentUpdatedBlocks",{},c=>{tS(c.data,t,void 0,a),s.classList.add("fn__none"),r.setAttribute("disabled","true"),o.setAttribute("disabled","true")}):(t.page||(t.page=1),t.page>1?r.removeAttribute("disabled"):r.setAttribute("disabled","disabled"),fetchPost("/api/search/fullTextSearchBlock",{query:t.query,method:t.method,types:t.types,paths:t.idPath||[],groupBy:t.group,orderBy:t.sort,page:t.page},c=>{tS(c.data.blocks,t,c,a),s.classList.add("fn__none"),t.page<c.data.pageCount?o.removeAttribute("disabled"):o.setAttribute("disabled","disabled")}))},Constants.TIMEOUT_INPUT)},dM=(t,e,n)=>{const a=document.getElementById("toolbarSearch");a.value=n.k||"",a.addEventListener("compositionend",d=>{d&&d.isComposing||(n.page=1,Xs(n,e,!0))}),a.addEventListener("input",d=>{d&&d.isComposing||(n.page=1,Xs(n,e,!0))}),a.addEventListener("blur",()=>{n.removed&&(n.k=a.value,window.siyuan.storage[Constants.LOCAL_SEARCHDATA]=Object.assign({},n),setStorageVal(Constants.LOCAL_SEARCHDATA,window.siyuan.storage[Constants.LOCAL_SEARCHDATA])),saveKeyList("keys",a.value)}),addClearButton({inputElement:a,className:"toolbar__icon",clearCB(){n.page=1,Xs(n,e)}});const i=e.querySelector(".toolbar .toolbar__title");i.value=n.r||"",addClearButton({inputElement:i,className:"toolbar__icon"});const s=[];initCriteriaMenu(e.querySelector("#criteria"),s,n);const r=document.querySelector("#searchAssetsPanel"),o=document.querySelector("#searchUnRefPanel"),l=e.querySelector("#searchList"),c=window.siyuan.storage[Constants.LOCAL_SEARCHASSET];e.addEventListener("click",d=>{var u,g;let f=d.target;for(;f&&f!==e;){const h=f.getAttribute("data-type");if(h==="replaceHistory"){toggleReplaceHistory(f.nextElementSibling),d.stopPropagation(),d.preventDefault();break}else if(h==="assetHistory"){toggleAssetHistory(r),d.stopPropagation(),d.preventDefault();break}else if(h==="previous"){f.getAttribute("disabled")||(n.page--,Xs(n,e)),d.stopPropagation(),d.preventDefault();break}else if(h==="next"){f.getAttribute("disabled")||(n.page++,Xs(n,e)),d.stopPropagation(),d.preventDefault();break}else if(h==="set-criteria"){n.removed=!1,(u=f.parentElement.querySelector(".b3-chip--current"))==null||u.classList.remove("b3-chip--current"),f.classList.add("b3-chip--current"),s.find(m=>{if(m.name===f.innerText.trim())return Lv(e,m,n),!0}),d.stopPropagation(),d.preventDefault();break}else if(h==="remove-criteria"){const m=f.parentElement.innerText.trim();fetchPost("/api/storage/removeCriterion",{name:m}),s.find((b,y)=>{if(b.name===m)return s.splice(y,1),!0}),f.parentElement.classList.contains("b3-chip--current")&&Lv(e,{removed:!0,sort:0,group:0,hasReplace:!1,method:0,hPath:"",idPath:[],k:"",r:"",page:1,types:getDefaultType(),replaceTypes:Object.assign({},Constants.SIYUAN_DEFAULT_REPLACETYPES)},n),f.parentElement.parentElement.childElementCount===1&&f.parentElement.parentElement.classList.add("fn__none"),f.parentElement.remove(),d.stopPropagation(),d.preventDefault();break}else if(h==="remove-path"){n.idPath=[],n.hPath="",e.querySelector("#searchPath").classList.add("fn__none"),n.page=1,Xs(n,e,!0);const m=e.querySelector('[data-type="include"]');m.classList.remove("toolbar__icon--active"),m.setAttribute("disabled","disabled"),d.stopPropagation(),d.preventDefault();break}else if(h==="expand"){Array.from(l.children).forEach(m=>{m.classList.contains("b3-list-item")&&(m.querySelector(".b3-list-item__arrow").classList.add("b3-list-item__arrow--open"),m.nextElementSibling.classList.remove("fn__none"))}),d.stopPropagation(),d.preventDefault();break}else if(h==="contract"){Array.from(l.children).forEach(m=>{m.classList.contains("b3-list-item")&&(m.querySelector(".b3-list-item__arrow").classList.remove("b3-list-item__arrow--open"),m.nextElementSibling.classList.add("fn__none"))}),d.stopPropagation(),d.preventDefault();break}else if(h==="currentPath"&&!f.hasAttribute("disabled")){const m=getCurrentEditor().protyle;fetchPost("/api/filetree/getHPathsByPaths",{paths:[m.path]},b=>{n.idPath=[pathPosix().join(m.notebookId,m.path)],n.hPath=b.data[0];const y=e.querySelector("#searchPath");y.classList.remove("fn__none"),y.innerHTML=`<div class="b3-chip b3-chip--middle">${escapeHtml(n.hPath)}<svg data-type="remove-path" class="b3-chip__close"><use xlink:href="#iconCloseRound"></use></svg></div>`;const _=e.querySelector('[data-type="include"]');_.classList.remove("toolbar__icon--active"),_.removeAttribute("disabled"),n.page=1,Xs(n,e,!0)}),d.stopPropagation(),d.preventDefault();break}else if(h==="path"){movePathTo((m,b)=>{fetchPost("/api/filetree/getHPathsByPaths",{paths:m},y=>{n.idPath=[];const _=[];let v=!1;m.forEach((Z,k)=>{Z==="/"?(n.idPath.push(b[k]),_.push(getNotebookName(b[k]))):(v=!0,n.idPath.push(pathPosix().join(b[k],Z.replace(".sy",""))))}),y.data&&_.push(...y.data),n.hPath=_.join(" ");const U=e.querySelector("#searchPath");U.classList.remove("fn__none"),U.innerHTML=`<div class="b3-chip b3-chip--middle">${escapeHtml(n.hPath)}<svg data-type="remove-path" class="b3-chip__close"><use xlink:href="#iconCloseRound"></use></svg></div>`;const ee=e.querySelector('[data-type="include"]');ee.classList.add("toolbar__icon--active"),v?ee.removeAttribute("disabled"):ee.setAttribute("disabled","disabled"),n.page=1,Xs(n,e,!0)})},[],void 0,window.siyuan.languages.specifyPath),d.stopPropagation(),d.preventDefault();break}else if(h==="include"&&!f.hasAttribute("disabled")){f.classList.toggle("toolbar__icon--active"),f.classList.contains("toolbar__icon--active")?n.idPath.forEach((m,b)=>{m.endsWith(".sy")&&(n.idPath[b]=m.replace(".sy",""))}):n.idPath.forEach((m,b)=>{!m.endsWith(".sy")&&m.split("/").length>1&&(n.idPath[b]=m+".sy")}),n.page=1,Xs(n,e,!0),d.stopPropagation(),d.preventDefault();break}else if(h==="toggle-replace"){n.hasReplace=!n.hasReplace,i.parentElement.classList.toggle("fn__none"),f.classList.toggle("toolbar__icon--active"),d.stopPropagation(),d.preventDefault();break}else if(h==="more"){moreMenu(n,s,e,()=>{n.page=1,Xs(n,e,!0)},()=>{Lv(e,{removed:!0,sort:0,group:0,hasReplace:!1,method:0,hPath:"",idPath:[],k:"",r:"",page:1,types:getDefaultType(),replaceTypes:Object.assign({},Constants.SIYUAN_DEFAULT_REPLACETYPES)},n)}),window.siyuan.menus.menu.fullscreen(),d.stopPropagation(),d.preventDefault();break}else if(h==="replace-all"){eS(e,n,!0),d.stopPropagation(),d.preventDefault();break}else if(h==="refreshUnRef"){Ky(o),d.stopPropagation(),d.preventDefault();break}else if(h==="unRefPrevious"){if(!f.getAttribute("disabled")){let m=parseInt(o.querySelector("#searchUnRefResult").lastElementChild.textContent);m>1&&(m--,Ky(o,m))}d.stopPropagation(),d.preventDefault();break}else if(h==="unRefNext"){const m=o.querySelector("#searchUnRefResult").lastElementChild;let b=parseInt(m.textContent);b<parseInt(m.textContent.split("/")[1])&&(b++,Ky(o,b)),d.stopPropagation(),d.preventDefault();break}else if(h==="queryAsset"){assetMethodMenu(f,()=>{assetInputEvent(r,c),setStorageVal(Constants.LOCAL_SEARCHASSET,c)}),d.stopPropagation(),d.preventDefault();break}else if(h==="filterAsset"){assetFilterMenu(r),d.stopPropagation(),d.preventDefault();break}else if(h==="moreAsset"){assetMoreMenu(f,r,()=>{assetInputEvent(r),setStorageVal(Constants.LOCAL_SEARCHASSET,c)}),d.stopPropagation(),d.preventDefault();break}else if(h==="goAsset"){uM(),d.stopPropagation(),d.preventDefault();break}else if(h==="goSearch"){r.classList.add("fn__none"),o.classList.add("fn__none"),d.stopPropagation(),d.preventDefault();break}else if(h==="assetPrevious"){f.getAttribute("disabled")||assetInputEvent(r,c,parseInt(r.querySelector("#searchAssetResult .fn__flex-center").textContent.split("/")[1])-1),d.stopPropagation(),d.preventDefault();break}else if(h==="assetNext"){f.getAttribute("disabled")||assetInputEvent(r,c,parseInt(r.querySelector("#searchAssetResult .fn__flex-center").textContent.split("/")[1])+1),d.stopPropagation(),d.preventDefault();break}else if(h==="replace"){eS(e,n,!1),d.stopPropagation(),d.preventDefault();break}else if(f.classList.contains("b3-list-item__toggle")){f.parentElement.nextElementSibling.classList.toggle("fn__none"),f.firstElementChild.classList.toggle("b3-list-item__arrow--open"),d.stopPropagation(),d.preventDefault();break}else if(f.classList.contains("b3-list-item")){if(f.getAttribute("data-type")==="search-new")newFileByName(t,a.value);else if(f.getAttribute("data-type")==="search-item"){const m=f.getAttribute("data-node-id");m?((g=window.siyuan.mobile.editor)!=null&&g.protyle&&preventScroll(window.siyuan.mobile.editor.protyle),checkFold(m,b=>{openMobileFileById(t,m,b?[Constants.CB_GET_ALL]:[Constants.CB_GET_HL,Constants.CB_GET_CONTEXT,Constants.CB_GET_ROOTSCROLL])}),closePanel()):f.classList.contains("b3-list-item--focus")?f.classList.contains("b3-list-item--focus")&&renderNextAssetMark(e.querySelector("#searchAssetPreview")):(e.querySelector("#searchAssetList .b3-list-item--focus").classList.remove("b3-list-item--focus"),f.classList.add("b3-list-item--focus"),renderPreview(e.querySelector("#searchAssetPreview"),f.dataset.id,e.querySelector("#searchAssetInput").value,window.siyuan.storage[Constants.LOCAL_SEARCHASSET].method))}else f.querySelector(".b3-list-item__toggle")&&(f.nextElementSibling.classList.toggle("fn__none"),f.firstElementChild.firstElementChild.classList.toggle("b3-list-item__arrow--open"));d.stopPropagation(),d.preventDefault();break}f=f.parentElement}},!1)},vz=(t,e)=>{var n;const a=JSON.parse(JSON.stringify(window.siyuan.storage[Constants.LOCAL_SEARCHDATA])),i=(((n=getCurrentEditor())==null?void 0:n.protyle.toolbar.range)||(getSelection().rangeCount>0?getSelection().getRangeAt(0):document.createRange())).toString();i&&(a.k=i),e&&Object.keys(e).forEach(o=>{a[o]=e[o]}),activeBlur();let s=!0,r=!1;a.idPath.forEach(o=>{o.endsWith(".sy")&&(s=!1),o.split("/").length>1&&(r=!0)}),openModel({title:`<div class="fn__flex">
    <span data-menu="true" class="toolbar__icon toolbar__icon--history" data-type="history">
        <svg class="svg--mid"><use xlink:href="#iconSearch"></use></svg>
        <svg class="svg--smaller"><use xlink:href="#iconDown"></use></svg>
    </span>
    <input id="toolbarSearch" placeholder="${window.siyuan.languages.showRecentUpdatedBlocks}" class="toolbar__title fn__block" autocomplete="off" autocorrect="off" spellcheck="false">
    <svg id="toolbarSearchNew" class="toolbar__icon"><use xlink:href="#iconFile"></use></svg>
</div>`,html:`<div class="fn__flex-column" style="height: 100%">
    <div class="toolbar toolbar--border${a.hasReplace?"":" fn__none"}">
        <span data-menu="true" class="toolbar__icon toolbar__icon--history" data-type="replaceHistory">
            <svg class="svg--mid"><use xlink:href="#iconReplace"></use></svg>
            <svg class="svg--smaller"><use xlink:href="#iconDown"></use></svg>
        </span>
        <input id="toolbarReplace" class="toolbar__title">
        <svg class="fn__rotate fn__none toolbar__icon"><use xlink:href="#iconRefresh"></use></svg>
        <div class="fn__space"></div>
        <button data-type="replace-all" class="b3-button b3-button--outline fn__flex-center">${window.siyuan.languages.replaceAll}</button>
        <div class="fn__space"></div>
        <button data-type="replace" class="b3-button b3-button--outline fn__flex-center">${window.siyuan.languages.replace}</button>
        <div class="fn__space"></div>
    </div>
    <div id="criteria" style="background-color: var(--b3-theme-background);"></div>
    <div class="toolbar">
        <span class="fn__space"></span>
        <span data-type="result" class="fn__flex-1 fn__flex"></span>
        <span class="fn__space"></span>
        <svg data-type="previous" disabled="disabled" class="toolbar__icon"><use xlink:href="#iconLeft"></use></svg>
        <svg data-type="next" disabled="disabled" class="toolbar__icon"><use xlink:href="#iconRight"></use></svg>
    </div>
    <div id="searchList" style="overflow:auto;" class="fn__flex-1 b3-list b3-list--background"></div>
    <div id="searchPath" class="b3-chips${a.hPath?"":" fn__none"}" style="background-color: var(--b3-theme-background);">
        <div class="b3-chip b3-chip--middle">
            ${escapeHtml(a.hPath)}
            <svg data-type="remove-path" class="b3-chip__close"><use xlink:href="#iconCloseRound"></use></svg>
        </div>
    </div>
    <div class="toolbar">
        <span class="fn__flex-1"></span>
        <svg data-type="toggle-replace" class="toolbar__icon${a.hasReplace?" toolbar__icon--active":""}"><use xlink:href="#iconReplace"></use></svg>
        <svg ${r?"":"disabled"} data-type="include" class="toolbar__icon${s?" toolbar__icon--active":""}"><use xlink:href="#iconInclude"></use></svg>
        <svg data-type="path" class="toolbar__icon"><use xlink:href="#iconFolder"></use></svg>
        <svg ${document.querySelector("#empty").classList.contains("fn__none")?"":"disabled"} data-type="currentPath" class="toolbar__icon"><use xlink:href="#iconFocus"></use></svg>
        <svg data-type="expand" class="toolbar__icon${a.group===0?" fn__none":""}"><use xlink:href="#iconExpand"></use></svg>
        <svg data-type="contract" class="toolbar__icon${a.group===0?" fn__none":""}"><use xlink:href="#iconContract"></use></svg>
        <svg data-type="more" class="toolbar__icon"><use xlink:href="#iconMore"></use></svg>
        <svg data-type="goAsset" class="toolbar__icon"><use xlink:href="#iconExact"></use></svg>
        <span class="fn__flex-1"></span>
     </div>
     <div class="fn__none fn__flex-column" style="position: fixed;top: 0;width: 100%;background: var(--b3-theme-surface);height: 100%;" id="searchAssetsPanel">
        <div class="toolbar toolbar--border">
           <span data-menu="true" class="toolbar__icon toolbar__icon--history" data-type="assetHistory">
                <svg class="svg--mid"><use xlink:href="#iconSearch"></use></svg>
                <svg class="svg--smaller"><use xlink:href="#iconDown"></use></svg>
            </span>
            <input id="searchAssetInput" placeholder="${window.siyuan.languages.keyword}" class="toolbar__title fn__block">
        </div>
        <div class="toolbar">
            <span class="fn__space"></span>
            <span id="searchAssetResult" class="fn__flex-1 fn__flex"><span class="fn__flex-1"></span></span>
            <span class="fn__space"></span>
            <svg data-type="assetPrevious" disabled="disabled" class="toolbar__icon"><use xlink:href="#iconLeft"></use></svg>
            <svg data-type="assetNext" disabled="disabled" class="toolbar__icon"><use xlink:href="#iconRight"></use></svg>
        </div>
        <div id="searchAssetList" style="overflow:auto;" class="fn__flex-1 b3-list b3-list--background"></div>
        <div id="searchAssetPreview" class="fn__flex-1 search__preview b3-typography" style="padding: 8px;border-bottom: 1px solid var(--b3-border-color);"></div>
        <div class="toolbar">
            <span class="fn__flex-1"></span>
            <svg data-type="queryAsset" class="toolbar__icon"><use xlink:href="#iconRegex"></use></svg>
            <svg data-type="filterAsset" class="toolbar__icon"><use xlink:href="#iconFilter"></use></svg>
            <svg data-type="moreAsset" class="toolbar__icon"><use xlink:href="#iconMore"></use></svg>
            <svg data-type="goSearch" class="toolbar__icon"><use xlink:href="#iconBack"></use></svg>
            <span class="fn__flex-1"></span>
         </div>
    </div>
     <div class="fn__none fn__flex-column" style="position: fixed;top: 0;width: 100%;background: var(--b3-theme-surface);height: 100%;" id="searchUnRefPanel">
        <div class="toolbar">
            <span class="fn__space"></span>
            <span id="searchUnRefResult" class="fn__flex-1 fn__flex"></span>
            <span class="fn__space"></span>
            <svg data-type="unRefPrevious" disabled="disabled" class="toolbar__icon"><use xlink:href="#iconLeft"></use></svg>
            <svg data-type="unRefNext" disabled="disabled" class="toolbar__icon"><use xlink:href="#iconRight"></use></svg>
        </div>
        <div id="searchUnRefList" style="overflow:auto;" class="fn__flex-1 b3-list b3-list--background"></div>
        <div class="toolbar">
            <span class="fn__flex-1"></span>
            <svg data-type="refreshUnRef" class="toolbar__icon"><use xlink:href="#iconRefresh"></use></svg>
            <svg data-type="goSearch" class="toolbar__icon"><use xlink:href="#iconBack"></use></svg>
            <span class="fn__flex-1"></span>
         </div>
    </div>
     <div class="fn__loading fn__loading--top"><img width="120px" src="/stage/loading-pure.svg"></div>
</div>`,bindEvent(o){document.querySelector("#toolbarSearchNew").addEventListener("click",()=>{newFileByName(t,document.querySelector("#toolbarSearch").value)}),document.querySelector('.toolbar [data-type="history"]').addEventListener("click",()=>{toggleSearchHistory(document.querySelector("#model"),a,void 0)}),dM(t,o.firstElementChild,a),Xs(a,o)}})},uM=()=>{const t=document.querySelector("#searchAssetsPanel");if(t.classList.remove("fn__none"),t.querySelector("#searchAssetList").innerHTML)return;const n=window.siyuan.storage[Constants.LOCAL_SEARCHASSET],a=t.querySelector("input");a.value=n.k,a.addEventListener("compositionend",i=>{i.isComposing||assetInputEvent(t,n)}),a.addEventListener("input",i=>{i.isComposing||assetInputEvent(t,n)}),a.addEventListener("blur",()=>{saveAssetKeyList(a)}),assetInputEvent(t,n),addClearButton({inputElement:a,className:"toolbar__icon",clearCB(){assetInputEvent(t,n)}})},xz=()=>{window.siyuan.menus.menu.remove();const t=document.querySelector("#searchUnRefPanel");t.classList.remove("fn__none"),!t.querySelector("#searchUnRefList").innerHTML&&Ky(t)},Ky=(t,e=1)=>{const n=t.querySelector('[data-type="unRefPrevious"]');e>1?n.removeAttribute("disabled"):n.setAttribute("disabled","disabled"),fetchPost("/api/search/listInvalidBlockRefs",{page:e},a=>{t.parentElement.querySelector(".fn__loading--top").classList.add("fn__none");const i=t.querySelector('[data-type="unRefNext"]');e<a.data.pageCount?i.removeAttribute("disabled"):i.setAttribute("disabled","disabled");let s="";a.data.blocks.forEach((r,o)=>{const l=getNotebookName(r.box)+getDisplayName(r.hPath,!1);s+=`<div class="b3-list-item b3-list-item--two${o===0?" b3-list-item--focus":""}" data-type="search-item" data-node-id="${r.id}">
<div class="b3-list-item__first">
    <svg class="b3-list-item__graphic"><use xlink:href="#${getIconByType(r.type)}"></use></svg>
    ${unicode2Emoji(r.ial.icon,"b3-list-item__graphic",!0)}
    <span class="b3-list-item__text">${r.content}</span>
</div>
<span class="b3-list-item__text b3-list-item__meta">${escapeGreat(l)}</span>
</div>`}),t.querySelector("#searchUnRefResult").innerHTML=`<span class="fn__flex-center">${window.siyuan.languages.findInDoc.replace("${x}",a.data.matchedRootCount).replace("${y}",a.data.matchedBlockCount)}</span>
<span class="fn__flex-1"></span>
<span class="fn__flex-center">${e}/${a.data.pageCount||1}</span>`,t.querySelector("#searchUnRefList").innerHTML=s||`<div class="search__empty">
    ${window.siyuan.languages.emptyContent}
</div>`})},Ez=t=>{fetchPost("/api/storage/getRecentDocs",{sortBy:"viewedAt"},e=>{let n="";e.data.forEach((a,i)=>{n+=`<li data-index="${i}" data-node-id="${a.rootID}" class="b3-list-item${i===0?" b3-list-item--focus":""}">
${unicode2Emoji(a.icon||window.siyuan.storage[Constants.LOCAL_IMAGES].file,"b3-list-item__graphic",!0)}
<span class="b3-list-item__text">${escapeHtml(a.title)}</span>
</li>`}),openModel({title:window.siyuan.languages.recentDocs,icon:"iconList",html:`<ul class="b3-list b3-list--mobile">${n}</ul>`,bindEvent(a){a.firstElementChild.addEventListener("click",i=>{const s=hasClosestByClassName(i.target,"b3-list-item");s&&openMobileFileById(t,s.dataset.nodeId,[Constants.CB_GET_SCROLL])})}})})},Cd=t=>{if(!t)return"";const e=_n().extname(t).toLowerCase();return p.SIYUAN_ASSETS_IMAGE.includes(e)?`<img style="max-height: 100%" src="${t}">`:p.SIYUAN_ASSETS_AUDIO.includes(e)?`<audio style="max-width: 100%" controls="controls" src="${t}"></audio>`:p.SIYUAN_ASSETS_VIDEO.includes(e)?`<video style="max-width: 100%" controls="controls" src="${t}"></video>`:t},fM=()=>{Cn().asset.forEach(t=>{const e=t.pdfObject;if(!e)return;const{pdfDocument:n,pdfViewer:a}=e;if(!n)return;const i=t.element.querySelector("#viewerContainer");if(i.clientHeight===0)return;if(i){const r=i.getAttribute("data-scrolltop");r&&(i.scrollTo(0,parseInt(r)),i.removeAttribute("data-scrolltop"))}const s=a.currentScaleValue;(s==="auto"||s==="page-fit"||s==="page-width")&&(a.currentScaleValue=s),a.update()})},aS=(t,e,n,a)=>{let i="";if(p.SIYUAN_ASSETS_AUDIO.includes(t))i=`<div data-node-id="${Lute.NewNodeID()}" data-type="NodeAudio" class="iframe" updated="${at().format("YYYYMMDDHHmmss")}"><div class="iframe-content"><audio controls="controls" src="${e}"></audio>${p.ZWSP}</div><div class="protyle-attr" contenteditable="false">${p.ZWSP}</div></div>`;else if(p.SIYUAN_ASSETS_IMAGE.includes(t)){let s="";e.startsWith("assets/")||(s='<span class="img__net"><svg><use xlink:href="#iconLanguage"></use></svg></span>'),i=`<span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span class="protyle-icon protyle-icon--only"><svg><use xlink:href="#iconMore"></use></svg></span></span><img src="${e}" data-src="${e}" alt="${n}" /><span class="protyle-action__drag"></span>${s}<span class="protyle-action__title"></span></span><span> </span></span>`}else p.SIYUAN_ASSETS_VIDEO.includes(t)?i=`<div data-node-id="${Lute.NewNodeID()}" data-type="NodeVideo" class="iframe" updated="${at().format("YYYYMMDDHHmmss")}"><div class="iframe-content">${p.ZWSP}<video controls="controls" src="${e}"></video><span class="protyle-action__drag" contenteditable="false"></span></div><div class="protyle-attr" contenteditable="false">${p.ZWSP}</div></div>`:i=`<span data-type="a" data-href="${e}">${a}</span>`;return i},Iv=(t,e)=>{if(!t||t.length===0)return`<li style="padding-left: 40px;" class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`;let n="";return t.forEach((a,i)=>{let s="";e&&(s=`data-id2="${e[i].fileID}"`),n+=`<li style="padding-left: 40px;" class="b3-list-item" ${s} data-id="${a.fileID}">
    <span class="b3-list-item__text" title="${ft(a.path)} ${a.hSize}">${he(a.title)}</span>
</li>`}),n};let Ld,kf;const iS=(t,e)=>{if(!N(e,"history__side"))return;const a=N(e,"b3-dialog__container");if(!a)return;const i=a.querySelector('[data-type="editors"]'),s=i.firstElementChild,r=i.lastElementChild;Ld||(Ld=new ar(t,s.lastElementChild,{blockId:"",history:{snapshot:""},action:[p.CB_GET_HISTORY],render:{background:!1,gutter:!1,breadcrumb:!1,breadcrumbDocName:!1},typewriterMode:!1}),br(Ld.protyle),kf=new ar(t,r.lastElementChild,{blockId:"",action:[p.CB_GET_HISTORY],history:{snapshot:""},render:{background:!1,gutter:!1,breadcrumb:!1,breadcrumbDocName:!1},typewriterMode:!1}),br(kf.protyle)),ae("/api/repo/openRepoSnapshotDoc",{id:e.getAttribute("data-id")},l=>{s.classList.remove("fn__none");const c=s.querySelector("textarea"),d=_n().extname(l.data.content).toLowerCase(),u=s.querySelector(".protyle-title__input");p.SIYUAN_ASSETS_IMAGE.concat(p.SIYUAN_ASSETS_AUDIO).concat(p.SIYUAN_ASSETS_VIDEO).includes(d)?(c.previousElementSibling.innerHTML=Cd(l.data.content),c.previousElementSibling.classList.remove("fn__none"),c.classList.add("fn__none"),s.lastElementChild.classList.add("fn__none")):l.data.displayInText?(c.value=l.data.content,c.classList.remove("fn__none"),s.lastElementChild.classList.add("fn__none"),c.previousElementSibling.classList.add("fn__none")):(c.classList.add("fn__none"),s.lastElementChild.classList.remove("fn__none"),c.previousElementSibling.classList.add("fn__none"),Ld.protyle.options.history.snapshot=a.querySelector(".b3-dialog__header code").getAttribute("data-snapshot"),_a({data:l,protyle:Ld.protyle,action:[p.CB_GET_HISTORY,p.CB_GET_HTML]})),u.textContent=l.data.title,s.querySelector(".history__date").textContent=at(l.data.updated).format("YYYY-MM-DD HH:mm")});const o=e.getAttribute("data-id2");o?(r.classList.remove("fn__none"),ae("/api/repo/openRepoSnapshotDoc",{id:o},l=>{const c=r.querySelector("textarea"),d=_n().extname(l.data.content).toLowerCase(),u=r.querySelector(".protyle-title__input");p.SIYUAN_ASSETS_IMAGE.concat(p.SIYUAN_ASSETS_AUDIO).concat(p.SIYUAN_ASSETS_VIDEO).includes(d)?(c.previousElementSibling.innerHTML=Cd(l.data.content),c.previousElementSibling.classList.remove("fn__none"),c.classList.add("fn__none"),r.lastElementChild.classList.add("fn__none")):l.data.displayInText?(c.value=l.data.content,c.classList.remove("fn__none"),r.lastElementChild.classList.add("fn__none"),c.previousElementSibling.classList.add("fn__none")):(c.classList.add("fn__none"),r.lastElementChild.classList.remove("fn__none"),c.previousElementSibling.classList.add("fn__none"),kf.protyle.options.history.snapshot=a.querySelectorAll(".b3-dialog__header code")[1].getAttribute("data-snapshot"),_a({data:l,protyle:kf.protyle,action:[p.CB_GET_HISTORY,p.CB_GET_HTML]})),u.textContent=l.data.title,r.querySelector(".history__date").textContent=at(l.data.updated).format("YYYY-MM-DD HH:mm")})):r.classList.add("fn__none")},pM=(t,e)=>{if(e.length!==2)return;let n,a;e[0].time>e[1].time?(n=e[1].id,a=e[0].id):(n=e[0].id,a=e[1].id);const i=new fe({title:window.siyuan.languages.compare,content:"",width:x()?"92vw":"90vw",height:"80vh",containerClassName:"b3-dialog__container--theme",destroyCallback(){Ld=void 0,kf=void 0}});i.element.setAttribute("data-key",p.DIALOG_HISTORYCOMPARE),i.element.addEventListener("click",s=>{var r;if(typeof s.detail=="string"){iS(t,i.element.querySelector(".history__side .b3-list-item--focus")),s.stopPropagation(),s.preventDefault();return}let o=s.target;for(;o&&o!==i.element;){if(o.classList.contains("b3-list-item")&&!o.dataset.id){o.nextElementSibling.classList.toggle("fn__none"),o.querySelector("svg").classList.toggle("b3-list-item__arrow--open"),s.preventDefault(),s.stopPropagation();break}else if(o.classList.contains("b3-list-item")&&o.dataset.id){if(o.classList.contains("b3-list-item--focus"))return;(r=i.element.querySelector(".history__side .b3-list-item--focus"))==null||r.classList.remove("b3-list-item--focus"),o.classList.add("b3-list-item--focus"),iS(t,o),s.preventDefault(),s.stopPropagation();break}else if(o.classList.contains("block__icon")){o.getAttribute("data-direct")==="left"?(o.setAttribute("data-direct","right"),Mv(a,n,i,"right")):(o.setAttribute("data-direct","left"),Mv(n,a,i,"left")),s.preventDefault(),s.stopPropagation();break}o=o.parentElement}}),Mv(n,a,i,"left")},Mv=(t,e,n,a)=>{Ld=void 0,kf=void 0;const i=x();ae("/api/repo/diffRepoSnapshots",{left:t,right:e},s=>{const r=n.element.querySelector(".b3-dialog__header");r.innerHTML=`<div style="padding: 0;min-height: auto;" class="block__icons">
    <span class="fn__flex-1"></span>
    <code class="fn__code${i?" fn__none":""}" data-snapshot="${t}">${t.substring(0,7)}</code>
    ${i?"":'<span class="fn__space"></span>'}
    ${at(s.data.left.created).format("YYYY-MM-DD HH:mm")}
    <span class="fn__space"></span>
    <span class="block__icon block__icon--show b3-tooltips b3-tooltips__s" aria-label="${window.siyuan.languages.switchDirect}" data-direct="${a}"><svg><use xlink:href="#iconScrollHoriz"></use></svg></span>
    <span class="fn__space"></span>
    <code class="fn__code${i?" fn__none":""}" data-snapshot="${e}">${e.substring(0,7)}</code>
    ${i?"":'<span class="fn__space"></span>'}
    ${at(s.data.right.created).format("YYYY-MM-DD HH:mm")}
    <span class="fn__flex-1"></span>
</div>`,r.nextElementSibling.innerHTML=`<div class="fn__flex history__panel" style="height: 100%">
    <div class="history__side" ${x()?"":`style="width: ${window.siyuan.storage[p.LOCAL_HISTORY].sideDiffWidth}"`}>
        <ul class="b3-list b3-list--background">
            <li class="b3-list-item">
                <span class="b3-list-item__toggle b3-list-item__toggle--hl">
                    <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>
                </span>
                <span style="padding-left: 4px" class="b3-list-item__text">${window.siyuan.languages.update}</span>
                <span class="counter${s.data.updatesLeft.length===0?" fn__none":""}">${s.data.updatesLeft.length}</span>
            </li>
            <ul class="fn__none">${Iv(s.data.updatesLeft,s.data.updatesRight)}</ul>
        </ul>
        <ul class="b3-list b3-list--background">
            <li class="b3-list-item">
                <span class="b3-list-item__toggle b3-list-item__toggle--hl">
                    <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>
                </span>
                <span style="padding-left: 4px" class="b3-list-item__text">${window.siyuan.languages.addAttr}</span>
                <span class="counter${s.data.addsLeft.length===0?" fn__none":""}">${s.data.addsLeft.length}</span>
            </li>
            <ul class="fn__none">${Iv(s.data.addsLeft)}</ul>
        </ul>
        <ul class="b3-list b3-list--background">
            <li class="b3-list-item">
                <span class="b3-list-item__toggle b3-list-item__toggle--hl">
                    <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>
                </span>
                <span style="padding-left: 4px" class="b3-list-item__text">${window.siyuan.languages.remove}</span>
                <span class="counter${s.data.removesRight.length===0?" fn__none":""}">${s.data.removesRight.length}</span>
            </li>
            <ul class="fn__none">${Iv(s.data.removesRight)}</ul>
        </ul>
    </div>
    <div class="history__resize"></div>
    <div class="fn__flex-1 fn__flex" data-type="editors">
        <div class="fn__none fn__flex-1 fn__flex-column">
            <div class="history__date">${at(s.data.left.created).format("YYYY-MM-DD HH:mm")}</div>
            <div class="protyle-title__input ft__center ft__breakword">${s.data.left.title}</div>
            <div class="ft__center"></div>
            <textarea class="history__text fn__none fn__flex-1" readonly></textarea>
            <div class="fn__flex-1"></div>
        </div>
        <div class="fn__none fn__flex-1 fn__flex-column" style="border-left: 1px solid var(--b3-border-color);">
            <div class="history__date">${s.data.right.title} ${at(s.data.right.created).format("YYYY-MM-DD HH:mm")}</div>
            <div class="protyle-title__input ft__center ft__breakword">${s.data.right.title}</div>
            <div class="ft__center"></div>
            <textarea class="history__text fn__none fn__flex-1" readonly></textarea>
            <div class="fn__flex-1"></div>
        </div>
    </div>
</div>`,Oy(n.element.querySelector(".history__resize"),n.element.querySelector(".history__side"),"sideDiffWidth")})};let Id;const Sf=(t,e)=>{const n=t.querySelector('[data-type="docprevious"]'),a=t.querySelector('[data-type="docnext"]');t.setAttribute("data-page",e.toString()),e>1?n.removeAttribute("disabled"):n.setAttribute("disabled","disabled");const i=t.querySelector('button[data-type="jumpHistoryPage"]');i.textContent=`${e}`;const s=t.querySelector(".b3-text-field"),r=t.querySelector('.b3-select[data-type="opselect"]'),o=t.querySelector('.b3-select[data-type="typeselect"]'),l=t.querySelector('.b3-select[data-type="notebookselect"]'),c=t.querySelector('.history__text[data-type="docPanel"]'),d=t.querySelector('.history__text[data-type="assetPanel"]'),u=t.querySelector('.history__text[data-type="mdPanel"]'),g=t.querySelector(".b3-list");t.querySelector(".protyle-title__input").classList.add("fn__none"),d.classList.add("fn__none"),u.classList.add("fn__none"),c.classList.add("fn__none"),o.value==="2"?(l.setAttribute("disabled","disabled"),window.siyuan.storage[p.LOCAL_HISTORY].type!==2&&(r.value="all"),r.querySelector('option[value="clean"]').classList.remove("fn__none"),r.querySelector('option[value="update"]').classList.remove("fn__none"),r.querySelector('option[value="delete"]').classList.add("fn__none"),r.querySelector('option[value="format"]').classList.add("fn__none"),r.querySelector('option[value="sync"]').classList.remove("fn__none"),r.querySelector('option[value="replace"]').classList.add("fn__none"),r.querySelector('option[value="outline"]').classList.add("fn__none")):(l.removeAttribute("disabled"),window.siyuan.storage[p.LOCAL_HISTORY].type===2&&(r.value="all"),r.querySelector('option[value="clean"]').classList.add("fn__none"),r.querySelector('option[value="update"]').classList.remove("fn__none"),r.querySelector('option[value="delete"]').classList.remove("fn__none"),r.querySelector('option[value="format"]').classList.remove("fn__none"),r.querySelector('option[value="sync"]').classList.remove("fn__none"),r.querySelector('option[value="replace"]').classList.remove("fn__none"),r.querySelector('option[value="outline"]').classList.remove("fn__none")),window.siyuan.storage[p.LOCAL_HISTORY].notebookId=l.value,window.siyuan.storage[p.LOCAL_HISTORY].type=parseInt(o.value),window.siyuan.storage[p.LOCAL_HISTORY].operation=r.value,Gt(p.LOCAL_HISTORY,window.siyuan.storage[p.LOCAL_HISTORY]),ae("/api/history/searchHistory",{notebook:l.value,query:s.value,page:e,op:r.value,type:parseInt(o.value)},f=>{e<f.data.pageCount?a.removeAttribute("disabled"):a.setAttribute("disabled","disabled"),i.setAttribute("data-totalpage",(f.data.pageCount||1).toString());const h=a.nextElementSibling.nextElementSibling;if(h.textContent=`${window.siyuan.languages.pageCountAndHistoryCount.replace("${x}",f.data.pageCount).replace("${y}",f.data.totalCount||1)}`,h.classList.remove("fn__none"),f.data.histories.length===0){g.innerHTML=`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`;return}let m="";f.data.histories.forEach(b=>{m+=`<li class="b3-list-item" data-type="toggle" data-created="${b}">
    <span class="b3-list-item__toggle b3-list-item__toggle--hl"><svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg></span>
    <span style="padding-left: 4px" class="b3-list-item__text">${at(parseInt(b)*1e3).format("YYYY-MM-DD HH:mm:ss")}</span>
</li>`}),g.innerHTML=m})},sS=(t,e,n)=>{if(t.data.snapshots.length===0){e.lastElementChild.innerHTML=`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`;return}let a="";n==="getCloudRepoTagSnapshots"?a=`<span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="downloadSnapshot" aria-label="${window.siyuan.languages.download}"><svg><use xlink:href="#iconDownload"></use></svg></span>
<span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="removeCloudRepoTagSnapshot" aria-label="${window.siyuan.languages.remove}"><svg><use xlink:href="#iconTrashcan"></use></svg></span>`:n==="getCloudRepoSnapshots"?a=`<span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="downloadSnapshot" aria-label="${window.siyuan.languages.download}"><svg><use xlink:href="#iconDownload"></use></svg></span>`:n==="getRepoTagSnapshots"?a=`<span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="uploadSnapshot" aria-label="${window.siyuan.languages.upload}"><svg><use xlink:href="#iconUpload"></use></svg></span>
<span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="rollback" aria-label="${window.siyuan.languages.rollback}"><svg><use xlink:href="#iconUndo"></use></svg></span>
<span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="removeRepoTagSnapshot" aria-label="${window.siyuan.languages.remove}"><svg><use xlink:href="#iconTrashcan"></use></svg></span>`:n==="getRepoSnapshots"&&(a=`<span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="genTag" aria-label="${window.siyuan.languages.tagSnapshot}"><svg><use xlink:href="#iconTags"></use></svg></span>
<span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="rollback" aria-label="${window.siyuan.languages.rollback}"><svg><use xlink:href="#iconUndo"></use></svg></span>`);let i="";const s=x();t.data.snapshots.forEach(r=>{let o="";r.typesCount&&(o=`<div class="b3-list-item__meta${s?" fn__none":""}">
${window.siyuan.languages.fileCount} ${r.count}<span class="fn__space"></span>`,r.typesCount.forEach(c=>{o+=`${c.type} ${c.count}<span class="fn__space"></span>`}),o+="</div>");const l=`<div${s?' style="padding-top:8px"':""}>
    <span data-type="hCreated">${r.hCreated}</span>
    <span class="fn__space"></span>
    ${r.hSize}
    <span class="fn__space"></span>
    ${r.systemOS}${r.systemName&&r.systemOS?"/":""}${r.systemName}
    <span class="fn__space"></span>
    <span class="b3-chip b3-chip--secondary b3-chip--small${r.tag?"":" fn__none"}">${r.tag}</span>
</div>
<div class="b3-list-item__meta${s?" fn__none":""}">
    ${he(r.memo)}
    <span class="fn__space"></span>
    <code class="fn__code">${r.id.substring(0,7)}</code>
</div>
${o}`;i+=`<li class="b3-list-item b3-list-item--hide-action" data-type="repoitem" data-id="${r.id}" data-tag="${r.tag}">
<div class="fn__flex-1">${l}</div>
${a}
</li>`}),e.lastElementChild.innerHTML=`${i}`},ac=(t,e)=>{const n=t.querySelector(".b3-select");n.disabled=!0;const a=n.value;t.lastElementChild.innerHTML='<li style="position: relative;height: 100%;"><div class="fn__loading"><img width="64px" src="/stage/loading-pure.svg"></div></li>';const i=t.querySelector('button[data-type="jumpRepoPage"]');i.textContent=`${e}`;const s=t.querySelector('[data-type="previous"]'),r=t.querySelector('[data-type="next"]'),o=r.nextElementSibling.nextElementSibling;t.setAttribute("data-init","true"),a==="getRepoTagSnapshots"||a==="getCloudRepoTagSnapshots"?(ae(`/api/repo/${a}`,{},l=>{sS(l,t,a),n.disabled=!1}),s.classList.add("fn__none"),r.classList.add("fn__none"),o.classList.add("fn__none"),i.classList.add("fn__none")):(s.classList.remove("fn__none"),r.classList.remove("fn__none"),i.classList.remove("fn__none"),t.setAttribute("data-page",e.toString()),e>1?s.removeAttribute("disabled"):s.setAttribute("disabled","disabled"),r.setAttribute("disabled","disabled"),ae(`/api/repo/${a}`,{page:e},l=>{n.disabled=!1,e<l.data.pageCount?r.removeAttribute("disabled"):r.setAttribute("disabled","disabled"),i.setAttribute("data-totalpage",(l.data.pageCount||1).toString()),o.textContent=`${window.siyuan.languages.pageCountAndSnapshotCount.replace("${x}",l.data.pageCount).replace("${y}",l.data.totalCount||1)}`,o.classList.remove("fn__none"),sS(l,t,a)}))},hM=t=>{t.setAttribute("data-init","true"),ae("/api/history/getNotebookHistory",{},e=>{if(e.data.histories.length===0){t.innerHTML=`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`;return}let n="";e.data.histories.forEach((a,i)=>{n+=`<li class="b3-list-item" style="padding-left: 0" data-type="rmtoggle">
    <span style="padding-left: 8px" class="b3-list-item__toggle"><svg class="b3-list-item__arrow${i===0?" b3-list-item__arrow--open":""}${a.items.length>0?"":" fn__hidden"}"><use xlink:href="#iconRight"></use></svg></span>
    <span class="b3-list-item__text">${a.hCreated}</span>
</li>`,a.items.length>0&&(n+=`<ul class="${i===0?"":"fn__none"}">`,a.items.forEach(s=>{n+=`<li data-type="notebook" data-path="${s.path}" class="b3-list-item b3-list-item--hide-action" style="padding-left: 32px">
    <span class="b3-list-item__text">${he(s.title)}</span>
    <span class="fn__space"></span>
    <span class="b3-list-item__action b3-tooltips b3-tooltips__w" data-type="rollback" aria-label="${window.siyuan.languages.rollback}">
        <svg><use xlink:href="#iconUndo"></use></svg>
    </span>
</li>`}),n+="</ul>")}),t.innerHTML=n})},Xy=t=>{if(window.siyuan.config.readonly||window.siyuan.dialogs.find(s=>{if(s.element.querySelector("#historyContainer"))return s.destroy(),!0}))return;const n=window.siyuan.storage[p.LOCAL_HISTORY];let a=`<option value='%' ${n.notebookId==="%"?"selected":""}>${window.siyuan.languages.allNotebooks}</option>`;window.siyuan.notebooks.forEach(s=>{s.closed||(a+=` <option value="${s.id}"${s.id===n.notebookId?" selected":""}>${he(s.name)}</option>`)});const i=`<div class="fn__flex-column" style="height: 100%;">
    <div class="layout-tab-bar fn__flex" ${x()?"":'style="border-radius: var(--b3-border-radius-b) var(--b3-border-radius-b) 0 0"'}>
        <div data-type="doc" class="item item--full item--focus"><span class="fn__flex-1"></span><span class="item__text">${window.siyuan.languages.fileHistory}</span><span class="fn__flex-1"></span></div>
        <div data-type="notebook" style="min-width: 160px" class="item item--full"><span class="fn__flex-1"></span><span class="item__text">${window.siyuan.languages.removedNotebook}</span><span class="fn__flex-1"></span></div>
        <div data-type="repo" class="item item--full"><span class="fn__flex-1"></span><span class="item__text">${window.siyuan.languages.dataSnapshot}</span><span class="fn__flex-1"></span></div>
    </div>
    <div class="fn__flex-1 fn__flex" id="historyContainer">
        <div data-type="doc" class="history__repo fn__block" data-init="true">
            <div class="history__action">
                <div class="block__icons">
                    <span data-type="docprevious" class="block__icon block__icon--show b3-tooltips b3-tooltips__e" disabled="disabled" aria-label="${window.siyuan.languages.previousLabel}"><svg><use xlink:href='#iconLeft'></use></svg></span>
                    <button class="b3-button b3-button--text ft__selectnone" data-type="jumpHistoryPage" data-totalpage="1">1</button>
                    <span data-type="docnext" class="block__icon block__icon--show b3-tooltips b3-tooltips__e" disabled="disabled" aria-label="${window.siyuan.languages.nextLabel}"><svg><use xlink:href='#iconRight'></use></svg></span>
                    <span class="fn__space"></span>
                    <span class="ft__on-surface fn__flex-shrink ft__selectnone fn__none">${window.siyuan.languages.pageCountAndHistoryCount}</span>
                    <span class="fn__space"></span>
                    <div class="fn__flex-1"></div>
                    <div style="position: relative">
                        <svg class="b3-form__icon-icon ft__on-surface"><use xlink:href="#iconSearch"></use></svg>
                        <input class="b3-text-field b3-form__icon-input ${x()?"fn__size96":"fn__size200"}">
                    </div>
                    <span class="fn__space"></span>
                    <select data-type="typeselect" class="b3-select ${x()?"fn__size96":"fn__size200"}">
                        <option value="0" ${n.type===0?"selected":""}>${window.siyuan.languages.docName}</option>
                        <option value="1" ${n.type===1?"selected":""}>${window.siyuan.languages.docNameAndContent}</option>
                        <option value="2" ${n.type===2?"selected":""}>${window.siyuan.languages.assets}</option>
                    </select>
                    <span class="fn__space"></span>
                    <select data-type="opselect" class="b3-select${x()?" fn__size96":""}">
                        <option value="all" ${n.operation==="all"?"selected":""}>${window.siyuan.languages.allOp}</option>
                        <option value="clean" ${n.operation==="clean"?"selected":""}>${window.siyuan.languages.historyClean}</option>
                        <option value="update" ${n.operation==="update"?"selected":""}>${window.siyuan.languages.historyUpdate}</option>
                        <option value="delete" ${n.operation==="delete"?"selected":""}>${window.siyuan.languages.historyDelete}</option>
                        <option value="format" ${n.operation==="format"?"selected":""}>${window.siyuan.languages.historyFormat}</option>
                        <option value="sync" ${n.operation==="sync"?"selected":""}>${window.siyuan.languages.historySync}</option>
                        <option value="replace" ${n.operation==="replace"?"selected":""}>${window.siyuan.languages.historyReplace}</option>
                        <option value="outline" ${n.operation==="outline"?"selected":""}>${window.siyuan.languages.historyOutline}</option>
                    </select>
                    <span class="fn__space"></span>
                    <select data-type="notebookselect" class="b3-select ${x()?"fn__size96":"fn__size200"}">
                        ${a}
                    </select>
                    <span class="fn__space"></span>
                    <button data-type="rebuildIndex" class="b3-button b3-button--outline">${window.siyuan.languages.rebuildIndex}</button>
                </div>
            </div>
            <div class="fn__flex fn__flex-1 history__panel">
                <ul class="b3-list b3-list--background history__side" ${x()?"":`style="width: ${n.sideWidth}"`}>
                    <li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>
                </ul>
                <div class="history__resize"></div>
                <div class="fn__flex-column fn__flex-1">
                    <div class="protyle-title__input ft__center ft__breakword fn__none"></div>
                    <div class="fn__flex-1 history__text fn__none" data-type="assetPanel"></div>
                    <textarea class="fn__flex-1 history__text fn__none" data-type="mdPanel"></textarea>
                    <div class="fn__flex-1 history__text fn__none" style="padding: 0" data-type="docPanel"></div>
                </div>
            </div>
        </div>
        <ul data-type="notebook" style="padding: 8px 0;" class="fn__none b3-list b3-list--background">
            <li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>
        </ul>
        <div data-type="repo" class="fn__none history__repo">
            <div class="history__action">
                <div class="block__icons">
                    <span data-type="previous" class="block__icon block__icon--show b3-tooltips b3-tooltips__e" disabled="disabled" aria-label="${window.siyuan.languages.previousLabel}"><svg><use xlink:href='#iconLeft'></use></svg></span>
                    <button class="b3-button b3-button--text ft__selectnone" data-type="jumpRepoPage" data-totalpage="1">1</button>
                    <span data-type="next" class="block__icon block__icon--show b3-tooltips b3-tooltips__e" disabled="disabled" aria-label="${window.siyuan.languages.nextLabel}"><svg><use xlink:href='#iconRight'></use></svg></span>
                    <span class="fn__space"></span>
                    <span class="ft__on-surface fn__flex-shrink ft__selectnone fn__none">${window.siyuan.languages.pageCountAndSnapshotCount}</span>
                    <span class="fn__space"></span>
                    <div class="fn__flex-1"></div>
                    <select class="b3-select ${x()?"fn__size96":"fn__size200"}">
                        <option value="getRepoSnapshots">${window.siyuan.languages.localSnapshot}</option>
                        <option value="getRepoTagSnapshots">${window.siyuan.languages.localTagSnapshot}</option>
                        <option value="getCloudRepoSnapshots">${window.siyuan.languages.cloudSnapshot}</option>
                        <option value="getCloudRepoTagSnapshots">${window.siyuan.languages.cloudTagSnapshot}</option>
                    </select>
                    <span class="fn__space"></span>
                    <button class="b3-button b3-button--outline" disabled data-type="compare">${window.siyuan.languages.compare}</button>
                    <span class="fn__space"></span>
                    <button class="b3-button b3-button--outline" data-type="genRepo">
                        <svg><use xlink:href="#iconAdd"></use></svg>${window.siyuan.languages.createSnapshot}
                    </button>
                </div>    
            </div>
            <ul class="b3-list b3-list--background fn__flex-1" style="padding-bottom: 8px">
                <li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>
            </ul>
        </div>
    </div>
</div>`;if(x())m2({html:i,icon:"iconHistory",title:window.siyuan.languages.dataHistory,bindEvent(s){s.firstElementChild.setAttribute("style","background-color:var(--b3-theme-background);height:100%"),rS(t,s.firstElementChild)}});else{const s=new fe({content:i,width:"90vw",height:"80vh",containerClassName:"b3-dialog__container--theme",destroyCallback(){Id=void 0}});s.element.setAttribute("data-key",p.DIALOG_HISTORY),s.element.querySelector("input").focus(),rS(t,s.element,s),Oy(s.element.querySelector(".history__resize"),s.element.querySelector(".history__side"),"sideWidth")}},rS=(t,e,n)=>{const a=e.querySelector("#historyContainer [data-type=doc]");a.querySelectorAll(".b3-select").forEach(u=>{u.addEventListener("change",()=>{Sf(a,1)})}),a.querySelector(".b3-text-field").addEventListener("input",u=>{u.isComposing||Sf(a,1)}),a.querySelector(".b3-text-field").addEventListener("compositionend",()=>{Sf(a,1)});const i=a.querySelector('.history__text[data-type="docPanel"]'),s=a.querySelector('.history__text[data-type="assetPanel"]'),r=a.querySelector('.history__text[data-type="mdPanel"]'),o=a.querySelector(".protyle-title__input");Sf(a,1),Id=new ar(t,i,{blockId:"",history:{created:""},action:[p.CB_GET_HISTORY],render:{background:!1,gutter:!1,breadcrumb:!1,breadcrumbDocName:!1},typewriterMode:!1}),br(Id.protyle);const l=e.querySelector('#historyContainer [data-type="repo"]'),c=e.querySelector('#historyContainer [data-type="doc"]'),d=l.querySelector(".b3-select");d.addEventListener("change",()=>{ac(l,1);const u=e.querySelector(".b3-button[data-type='compare']");u.setAttribute("disabled","disabled"),u.removeAttribute("data-ids")}),e.addEventListener("click",u=>{var g;let f=u.target;for(;f&&!f.isEqualNode(e);){const h=f.getAttribute("data-type");if(f.classList.contains("item")){f.parentElement.querySelector(".item--focus").classList.remove("item--focus"),Array.from(e.querySelector("#historyContainer").children).forEach(m=>{m.getAttribute("data-type")===h?(m.classList.remove("fn__none"),m.classList.add("fn__block"),f.classList.add("item--focus"),m.getAttribute("data-init")!=="true"&&(h==="notebook"?hM(m):h==="repo"&&ac(m,1))):(m.classList.add("fn__none"),m.classList.remove("fn__block"))}),u.stopPropagation(),u.preventDefault();break}else if(f.classList.contains("b3-list-item__action")&&h==="rollback"&&!window.siyuan.config.readonly){const m=f.parentElement.getAttribute("data-type");let b=f.previousElementSibling.previousElementSibling.textContent.trim(),y=at(parseInt(f.parentElement.getAttribute("data-created"))*1e3).format("YYYY-MM-DD HH:mm:ss");m==="notebook"?y=f.parentElement.parentElement.previousElementSibling.textContent.trim():m==="repoitem"&&(b=window.siyuan.languages.workspaceData,y=f.parentElement.querySelector("span[data-type='hCreated']").textContent.trim());const _=window.siyuan.languages.rollbackConfirm.replace("${name}",b).replace("${time}",y);Sn("\u26A0\uFE0F "+window.siyuan.languages.rollback,_,()=>{m==="assets"?ae("/api/history/rollbackAssetsHistory",{historyPath:f.parentElement.getAttribute("data-path")}):m==="doc"?ae("/api/history/rollbackDocHistory",{notebook:f.parentElement.getAttribute("data-notebook-id"),historyPath:f.parentElement.getAttribute("data-path")}):m==="notebook"?ae("/api/history/rollbackNotebookHistory",{historyPath:f.parentElement.getAttribute("data-path")}):ae("/api/repo/checkoutRepo",{id:f.parentElement.getAttribute("data-id")})}),u.stopPropagation(),u.preventDefault();break}else if(h==="more"){f.parentElement.parentElement.querySelectorAll(".b3-list-item__meta").forEach(m=>{m.classList.toggle("fn__none")}),u.stopPropagation(),u.preventDefault();break}else if(h==="toggle"){const m=f.firstElementChild.firstElementChild;if(m.classList.contains("b3-list-item__arrow--open"))f.nextElementSibling.classList.add("fn__none"),m.classList.remove("b3-list-item__arrow--open");else if(f.nextElementSibling&&f.nextElementSibling.tagName==="UL")f.nextElementSibling.classList.remove("fn__none"),m.classList.add("b3-list-item__arrow--open");else{const b=a.querySelector(".b3-text-field"),y=a.querySelector('.b3-select[data-type="opselect"]'),_=a.querySelector('.b3-select[data-type="typeselect"]'),v=a.querySelector('.b3-select[data-type="notebookselect"]'),U=f.getAttribute("data-created");ae("/api/history/getHistoryItems",{notebook:v.value,query:b.value,op:y.value,type:parseInt(_.value),created:U},ee=>{m.classList.add("b3-list-item__arrow--open");let Z="",k="";ee.data.items.forEach(w=>{let S=" b3-chip b3-chip--list ";w.op==="clean"?(S+="b3-chip--primary ",k=window.siyuan.languages.historyClean):w.op==="update"?(S+="b3-chip--info ",k=window.siyuan.languages.historyUpdate):w.op==="delete"?(S+="b3-chip--error ",k=window.siyuan.languages.historyDelete):w.op==="format"?(S+="b3-chip--pink ",k=window.siyuan.languages.historyFormat):w.op==="sync"?(S+="b3-chip--success ",k=window.siyuan.languages.historySync):w.op==="replace"?(S+="b3-chip--secondary ",k=window.siyuan.languages.historyReplace):w.op==="outline"&&(S+="b3-chip--warning ",k=window.siyuan.languages.historyOutline),Z+=`<li data-notebook-id="${w.notebook}" data-created="${U}" data-type="${_.value==="2"?"assets":"doc"}" data-path="${w.path}" class="b3-list-item b3-list-item--hide-action" style="padding-left: 22px">
    <span class="${y.value==="all"?"":"fn__none"}${S}ariaLabel" data-position="6south" aria-label="${k}">${w.op.substring(0,1).toUpperCase()}</span>
    <span class="b3-list-item__text" title="${ft(w.title)}">${he(w.title)}</span>
    <span class="fn__space"></span>
    <span class="b3-list-item__action ariaLabel" data-type="rollback" data-position="6south" aria-label="${window.siyuan.languages.rollback}">
        <svg><use xlink:href="#iconUndo"></use></svg>
    </span>
</li>`}),f.insertAdjacentHTML("afterend",`<ul>${Z}</ul>`)})}u.stopPropagation(),u.preventDefault();break}else if(h==="rmtoggle"){f.nextElementSibling.classList.toggle("fn__none"),f.firstElementChild.firstElementChild.classList.toggle("b3-list-item__arrow--open"),u.stopPropagation(),u.preventDefault();break}else if(f.classList.contains("b3-list-item")&&h==="repoitem"&&["getRepoSnapshots","getRepoTagSnapshots"].includes(d.value)){const m=e.querySelector(".b3-button[data-type='compare']"),b=JSON.parse(m.getAttribute("data-ids")||"[]"),y=f.getAttribute("data-id");if(f.classList.contains("b3-list-item--focus"))f.classList.remove("b3-list-item--focus"),b.forEach((_,v)=>{y===_.id&&b.splice(v,1)});else{for(f.classList.add("b3-list-item--focus");b.length>1;)b[0].id!==y&&((g=f.parentElement.querySelector(`.b3-list-item[data-id="${b.splice(0,1)[0].id}"]`))==null||g.classList.remove("b3-list-item--focus"));b.push({id:y,time:f.querySelector('[data-type="hCreated"]').textContent})}b.length===2?m.removeAttribute("disabled"):m.setAttribute("disabled","disabled"),m.setAttribute("data-ids",JSON.stringify(b)),u.stopPropagation(),u.preventDefault();break}else if(f.classList.contains("b3-list-item")&&(h==="assets"||h==="doc")){const m=f.getAttribute("data-path");if(h==="assets")s.classList.remove("fn__none"),s.innerHTML=Cd(m);else if(h==="doc"){const y=a.querySelector(".b3-text-field").value;ae("/api/history/getDocHistoryContent",{historyPath:m,highlight:!Gs(),k:y},_=>{_.data.isLargeDoc?(r.value=_.data.content,r.classList.remove("fn__none"),i.classList.add("fn__none")):(r.classList.add("fn__none"),i.classList.remove("fn__none"),Id.protyle.options.history.created=f.dataset.created,_a({data:_,protyle:Id.protyle,action:[p.CB_GET_HISTORY,p.CB_GET_HTML]}),Ah(Id.protyle,y.split(" ")))})}o.classList.remove("fn__none"),o.textContent=f.querySelector(".b3-list-item__text").textContent;let b=N(f,"b3-list");b&&(b=b.querySelector(".b3-list-item--focus"),b&&b.classList.remove("b3-list-item--focus")),f.classList.add("b3-list-item--focus"),u.stopPropagation(),u.preventDefault();break}else if(h==="genRepo"){const m=new fe({title:window.siyuan.languages.snapshotMemo,content:`<div class="b3-dialog__content">
    <textarea class="b3-text-field fn__block" placeholder="${window.siyuan.languages.snapshotMemoTip}"></textarea>
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"});m.element.setAttribute("data-key",p.DIALOG_SNAPSHOTMEMO);const b=m.element.querySelector("textarea");b.focus();const y=m.element.querySelectorAll(".b3-button");m.bindInput(b,()=>{y[1].click()}),y[0].addEventListener("click",()=>{m.destroy()}),y[1].addEventListener("click",()=>{ae("/api/repo/createSnapshot",{memo:b.value},()=>{ac(l,1)}),m.destroy()}),u.stopPropagation(),u.preventDefault();break}else if(h==="removeRepoTagSnapshot"||h==="removeCloudRepoTagSnapshot"){const m=f.parentElement.getAttribute("data-tag");Sn(window.siyuan.languages.deleteOpConfirm,`${window.siyuan.languages.confirmDelete} <i>${m}</i>?`,()=>{ae("/api/repo/"+h,{tag:m},()=>{ac(l,1)})},void 0,!0),u.stopPropagation(),u.preventDefault();break}else if(h==="uploadSnapshot"){ae("/api/repo/uploadCloudSnapshot",{tag:f.parentElement.getAttribute("data-tag"),id:f.parentElement.getAttribute("data-id")}),u.stopPropagation(),u.preventDefault();break}else if(h==="downloadSnapshot"){ae("/api/repo/downloadCloudSnapshot",{tag:f.parentElement.getAttribute("data-tag"),id:f.parentElement.getAttribute("data-id")}),u.stopPropagation(),u.preventDefault();break}else if(h==="genTag"){const m=new fe({title:window.siyuan.languages.tagSnapshot,content:`<div class="b3-dialog__content">
    <input class="b3-text-field fn__block" value="${at().format("YYYYMMDDHHmmss")}" placeholder="${window.siyuan.languages.tagSnapshotTip}">
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.tagSnapshot}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.tagSnapshotUpload}</button>
</div>`,width:x()?"92vw":"520px"});m.element.setAttribute("data-key",p.DIALOG_SNAPSHOTTAG);const b=m.element.querySelector(".b3-text-field");b.select();const y=m.element.querySelectorAll(".b3-button");y[0].addEventListener("click",()=>{m.destroy()}),y[2].addEventListener("click",()=>{ae("/api/repo/tagSnapshot",{id:f.parentElement.getAttribute("data-id"),name:b.value},()=>{ae("/api/repo/uploadCloudSnapshot",{tag:b.value,id:f.parentElement.getAttribute("data-id")},()=>{ac(l,1)})}),m.destroy()}),y[1].addEventListener("click",()=>{ae("/api/repo/tagSnapshot",{id:f.parentElement.getAttribute("data-id"),name:b.value},()=>{ac(l,1)}),m.destroy()}),u.stopPropagation(),u.preventDefault();break}else if((h==="previous"||h==="next")&&f.getAttribute("disabled")!=="disabled"){const m=parseInt(l.getAttribute("data-page"));ac(l,h==="previous"?m-1:m+1),u.stopPropagation(),u.preventDefault();break}else if(h==="jumpRepoPage"){const m=parseInt(l.getAttribute("data-page")),b=parseInt(f.getAttribute("data-totalpage")||"1");b>1&&Sn(window.siyuan.languages.jumpToPage.replace("${x}",b),`<input class="b3-text-field fn__block" type="number" min="1" max="${b}" value="${m}">`,y=>{const _=y.element.querySelector(".b3-text-field");if(_.value==="")return;let v=parseInt(_.value);v=Math.max(1,Math.min(v,b)),ac(l,v)})}else if(h==="jumpHistoryPage"){const m=parseInt(c.getAttribute("data-page")),b=parseInt(f.getAttribute("data-totalpage")||"1");b>1&&Sn(window.siyuan.languages.jumpToPage.replace("${x}",b),`<input class="b3-text-field fn__block" type="number" min="1" max="${b}" value="${m}">`,y=>{const _=y.element.querySelector(".b3-text-field");if(_.value==="")return;let v=parseInt(_.value);v=Math.max(1,Math.min(v,b)),Sf(a,v)})}else if((h==="docprevious"||h==="docnext")&&f.getAttribute("disabled")!=="disabled"){const m=parseInt(a.getAttribute("data-page"));Sf(a,h==="docprevious"?m-1:m+1),u.stopPropagation(),u.preventDefault();break}else if(h==="rebuildIndex"){ae("/api/history/reindexHistory"),n?n.destroy():(kM(),Id=void 0),u.stopPropagation(),u.preventDefault();break}else if(h==="compare"&&!f.getAttribute("disabled")){pM(t,JSON.parse(f.getAttribute("data-ids")||"[]")),u.stopPropagation(),u.preventDefault();break}f=f.parentElement}})},kz=t=>{setTitle(window.siyuan.languages.siyuanNote),document.getElementById("toolbarName").classList.add("fn__hidden"),document.getElementById("editor").classList.add("fn__none");const e=document.getElementById("empty");e.classList.remove("fn__none"),e.innerHTML===""&&(e.innerHTML=`<div id="emptySearch" class="b3-list-item">
    <svg class="b3-list-item__graphic"><use xlink:href="#iconSearch"></use></svg><span class="fn__space"></span><span class="b3-list-item__text">${window.siyuan.languages.search}</span>
</div>
<div id="emptyRecent" class="b3-list-item">
    <svg class="b3-list-item__graphic"><use xlink:href="#iconList"></use></svg><span class="fn__space"></span><span class="b3-list-item__text">${window.siyuan.languages.recentDocs}</span>
</div>
<div id="emptyHistory" class="b3-list-item${window.siyuan.config.readonly?" fn__none":""}">
    <svg class="b3-list-item__graphic"><use xlink:href="#iconHistory"></use></svg><span class="fn__space"></span><span class="b3-list-item__text">${window.siyuan.languages.dataHistory}</span>
</div>
<div id="emptyNewFile" class="b3-list-item${getOpenNotebookCount()>0||!window.siyuan.config.readonly?"":" fn__none"}">
    <svg class="b3-list-item__graphic"><use xlink:href="#iconFile"></use></svg><span class="fn__space"></span><span class="b3-list-item__text">${window.siyuan.languages.newFile}</span>
</div>
<div class="b3-list-item" id="emptyNewNotebook${window.siyuan.config.readonly?" fn__none":""}">
    <svg class="b3-list-item__graphic"><use xlink:href="#iconFilesRoot"></use></svg><span class="fn__space"></span><span class="b3-list-item__text">${window.siyuan.languages.newNotebook}</span>
</div>
`,e.addEventListener("click",n=>{let a=n.target;for(;a&&!a.isEqualNode(e);){if(a.id==="emptySearch"){popSearch(t),n.stopPropagation(),n.preventDefault();break}else if(a.id==="emptyRecent"){getRecentDocs(t),n.stopPropagation(),n.preventDefault();break}else if(a.id==="emptyHistory"){openHistory(t),n.stopPropagation(),n.preventDefault();break}else if(a.id==="emptyNewFile"){newFile({app:t,useSavePath:!0}),n.stopPropagation(),n.preventDefault();break}else if(a.id==="emptyNewNotebook"){newNotebook(),n.stopPropagation(),n.preventDefault();break}a=a.parentElement}}))},gM=()=>{const t=document.getElementById("toolbarName");Gg(t.value),t.classList.remove("fn__hidden"),document.getElementById("editor").classList.remove("fn__none"),document.getElementById("empty").classList.add("fn__none")},Zy=()=>window.siyuan.mobile.popEditor||window.siyuan.mobile.editor,mM=(t,e,n=[p.CB_GET_HL])=>{window.siyuan.storage[p.LOCAL_DOCINFO]={id:e},Gt(p.LOCAL_DOCINFO,window.siyuan.storage[p.LOCAL_DOCINFO]);const a=document.querySelector(".av__panel");if(a&&!a.classList.contains("fn__none")&&a.dispatchEvent(new CustomEvent("click",{detail:"close"})),window.siyuan.mobile.editor){Th(window.siyuan.mobile.editor.protyle),Ut(["toolbar","hint","util"],window.siyuan.mobile.editor.protyle),window.siyuan.mobile.editor.protyle.contentElement.classList.contains("fn__none")&&Hd(window.siyuan.mobile.editor.protyle,"wysiwyg");let i;if(Array.from(window.siyuan.mobile.editor.protyle.wysiwyg.element.querySelectorAll(`[data-node-id="${e}"]`)).find(s=>{if(!ge(s))return i=s,!0}),i){Ov(),n.includes(p.CB_GET_HL)?dr(window.siyuan.mobile.editor.protyle,e):kn(window.siyuan.mobile.editor.protyle,i),fS(),ae("/api/storage/updateRecentDocViewTime",{rootID:window.siyuan.mobile.editor.protyle.block.rootID});return}}ae("/api/block/getBlockInfo",{id:e},i=>{if(i.code===3){Q(i.msg);return}const s={blockId:e,rootId:i.data.rootID,action:n,render:{scroll:!0,title:!0,titleShowTop:!0,background:!0,gutter:!0},typewriterMode:!0,preview:{actions:["mp-wechat","zhihu","yuque"]}};window.siyuan.mobile.editor?(window.siyuan.mobile.editor.protyle.title.element.removeAttribute("data-render"),Ov(),Ud(window.siyuan.mobile.editor.protyle),window.siyuan.mobile.editor.protyle.block.rootID!==i.data.rootID?(window.siyuan.mobile.editor.protyle.wysiwyg.element.innerHTML="",ae("/api/storage/updateRecentDocOpenTime",{rootID:i.data.rootID})):ae("/api/storage/updateRecentDocViewTime",{rootID:i.data.rootID}),n.includes(p.CB_GET_SCROLL)&&window.siyuan.storage[p.LOCAL_FILEPOSITION][i.data.rootID]?mv({protyle:window.siyuan.mobile.editor.protyle,scrollAttr:window.siyuan.storage[p.LOCAL_FILEPOSITION][i.data.rootID],mergedOptions:s,cb(){t.plugins.forEach(r=>{r.eventBus.emit("switch-protyle",{protyle:window.siyuan.mobile.editor.protyle})})}}):ae("/api/filetree/getDoc",{id:e,size:n.includes(p.CB_GET_ALL)?p.SIZE_GET_MAX:window.siyuan.config.editor.dynamicLoadBlocks,mode:n.includes(p.CB_GET_CONTEXT)?3:0},r=>{_a({data:r,protyle:window.siyuan.mobile.editor.protyle,action:n,afterCB(){t.plugins.forEach(o=>{o.eventBus.emit("switch-protyle",{protyle:window.siyuan.mobile.editor.protyle})})}})}),window.siyuan.mobile.editor.protyle.undo.clear()):(ae("/api/storage/updateRecentDocOpenTime",{rootID:i.data.rootID}),window.siyuan.mobile.editor=new ar(t,document.getElementById("editor"),s)),gM(),fS()})};class Md{constructor(e,n){this.element=document.createElement("button");const a=n.hotkey?` ${Mt(n.hotkey)}`:"",i=n.tip||window.siyuan.languages[n.lang];this.element.classList.add("protyle-toolbar__item","b3-tooltips",`b3-tooltips__${n.tipPosition}`),this.element.setAttribute("data-type",n.name),this.element.setAttribute("aria-label",i+a),this.element.innerHTML=`<svg><use xlink:href="#${n.icon}"></use></svg>`,!["text","a","block-ref","inline-math","inline-memo"].includes(n.name)&&this.element.addEventListener(Ne(),s=>{s.preventDefault(),p.INLINE_TYPE.includes(n.name)?e.toolbar.setInlineMark(e,n.name,"toolbar"):n.click&&n.click(e.getInstance())})}}class bM extends Md{constructor(e,n){super(e,n),this.element.addEventListener("click",()=>{e.toolbar.element.classList.add("fn__none"),e.toolbar.subElement.innerHTML="",e.toolbar.subElement.style.width="",e.toolbar.subElement.style.padding="",e.toolbar.subElement.append(Fv(e,lS(e))),e.toolbar.subElement.style.zIndex=(++window.siyuan.zIndex).toString(),e.toolbar.subElement.classList.remove("fn__none"),e.toolbar.subElementCloseCB=void 0,Pt(e.toolbar.range);const a=Dr(e.wysiwyg.element,e.toolbar.range);gn(e.toolbar.subElement,a.left,a.top+18,26)})}}const Fv=(t,e)=>{let n="";["","var(--b3-font-color1)","var(--b3-font-color2)","var(--b3-font-color3)","var(--b3-font-color4)","var(--b3-font-color5)","var(--b3-font-color6)","var(--b3-font-color7)","var(--b3-font-color8)","var(--b3-font-color9)","var(--b3-font-color10)","var(--b3-font-color11)","var(--b3-font-color12)","var(--b3-font-color13)"].forEach(f=>{n+=`<button ${f?`class="color__square" style="color:${f}"`:`class="color__square ariaLabel" data-position="3south" aria-label="${window.siyuan.languages.default}"`} data-type="color">A</button>`});let a="";["","var(--b3-font-background1)","var(--b3-font-background2)","var(--b3-font-background3)","var(--b3-font-background4)","var(--b3-font-background5)","var(--b3-font-background6)","var(--b3-font-background7)","var(--b3-font-background8)","var(--b3-font-background9)","var(--b3-font-background10)","var(--b3-font-background11)","var(--b3-font-background12)","var(--b3-font-background13)"].forEach(f=>{a+=`<button ${f?`class="color__square" style="background-color:${f}"`:`class="color__square ariaLabel" data-position="3south" aria-label="${window.siyuan.languages.default}"`} data-type="backgroundColor"></button>`});const i=document.createElement("div");i.classList.add("protyle-font");let s=!1;e==null||e.find(f=>{if(f.classList.contains("li"))return s=!0,!0});let r="";const o=window.siyuan.storage[p.LOCAL_FONTSTYLES];o.length>0&&(r=`<div data-id="lastUsed" class="fn__flex">
    ${window.siyuan.languages.lastUsed}
    <span class="fn__space"></span>
    <kbd class="fn__kbd fn__flex-center${window.siyuan.config.keymap.editor.insert.lastUsed.custom?"":" fn__none"}">${Mt(window.siyuan.config.keymap.editor.insert.lastUsed.custom)}</kbd>
</div>
<div class="fn__hr--small"></div>
<div data-id="lastUsedWrap" class="fn__flex fn__flex-wrap" style="align-items: center">`,o.forEach(f=>{const h=f.split(p.ZWSP);switch(h[0]){case"color":r+=`<button class="color__square ariaLabel" data-position="3south" aria-label="${window.siyuan.languages.colorFont}${h[1]?"":" "+window.siyuan.languages.default}" ${h[1]?`style="color:${h[1]}"`:""} data-type="${h[0]}">A</button>`;break;case"backgroundColor":r+=`<button class="color__square ariaLabel" data-position="3south" aria-label="${window.siyuan.languages.colorPrimary}${h[1]?"":" "+window.siyuan.languages.default}" ${h[1]?`style="background-color:${h[1]}"`:""} data-type="${h[0]}"></button>`;break;case"style2":r+=`<button data-type="${h[0]}" class="protyle-font__style" style="-webkit-text-stroke: 0.2px var(--b3-theme-on-background);-webkit-text-fill-color : transparent;">${window.siyuan.languages.hollow}</button>`;break;case"style4":r+=`<button data-type="${h[0]}" class="protyle-font__style" style="text-shadow: 1px 1px var(--b3-theme-surface-lighter), 2px 2px var(--b3-theme-surface-lighter), 3px 3px var(--b3-theme-surface-lighter), 4px 4px var(--b3-theme-surface-lighter)">${window.siyuan.languages.shadow}</button>`;break;case"fontSize":s||(r+=`<button data-type="${h[0]}" class="protyle-font__style">${h[1]}</button>`);break;case"style1":r+=`<button class="color__square ariaLabel" data-position="3south" aria-label="${window.siyuan.languages.color}${h[1]?"":" "+window.siyuan.languages.default}" ${h[1]?`style="background-color:${h[1]};color:${h[2]}"`:""} data-type="${h[0]}">A</button>`;break;case"clear":r+=`<button style="height: 26px;display: flex;align-items: center;padding: 0 5px;" data-type="${h[0]}" class="protyle-font__style ariaLabel" aria-label="${window.siyuan.languages.clearFontStyle}"><svg class="svg--mid"><use xlink:href="#iconTrashcan"></use></svg></button>`;break}}),r+="</div>");let l,c=window.siyuan.config.editor.fontSize+"px";e&&e.length>0?l=e[0]:(l=t.toolbar.range.cloneContents().querySelector('[data-type~="text"]'),l||(l=ue(t.toolbar.range.startContainer,"data-type","text"))),l&&(c=l.style.fontSize||window.siyuan.config.editor.fontSize+"px"),i.innerHTML=`${r}
<div class="fn__hr"></div>
<div data-id="color">${window.siyuan.languages.color}</div>
<div class="fn__hr--small"></div>
<div data-id="colorWrap" class="fn__flex fn__flex-wrap">
    <button class="color__square ariaLabel" data-position="3south" data-type="style1" aria-label="${window.siyuan.languages.default}">A</button>
    <button class="color__square" data-type="style1" style="color: var(--b3-card-error-color);background-color: var(--b3-card-error-background);">A</button>
    <button class="color__square" data-type="style1" style="color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);">A</button>
    <button class="color__square" data-type="style1" style="color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);">A</button>
    <button class="color__square" data-type="style1" style="color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);">A</button>
</div>
<div class="fn__hr"></div>
<div data-id="colorFont">${window.siyuan.languages.colorFont}</div>
<div class="fn__hr--small"></div>
<div data-id="colorFontWrap" class="fn__flex fn__flex-wrap">
    ${n}
</div>
<div class="fn__hr"></div>
<div data-id="colorPrimary">${window.siyuan.languages.colorPrimary}</div>
<div class="fn__hr--small"></div>
<div data-id="colorPrimaryWrap" class="fn__flex fn__flex-wrap">
    ${a}
</div>
<div class="fn__hr"></div>
<div data-id="fontStyle">${window.siyuan.languages.fontStyle}</div>
<div class="fn__hr--small"></div>
<div data-id="fontStyleWrap" class="fn__flex">
    <button data-type="style2" class="protyle-font__style" style="-webkit-text-stroke: 0.2px var(--b3-theme-on-background);-webkit-text-fill-color : transparent;">${window.siyuan.languages.hollow}</button>
    <button data-type="style4" class="protyle-font__style" style="text-shadow: 1px 1px var(--b3-theme-surface-lighter), 2px 2px var(--b3-theme-surface-lighter), 3px 3px var(--b3-theme-surface-lighter), 4px 4px var(--b3-theme-surface-lighter)">${window.siyuan.languages.shadow}</button>
</div>
<div class="fn__hr${s?" fn__none":""}"></div>
<div data-id="fontSize" class="fn__flex${s?" fn__none":""}">
    ${window.siyuan.languages.fontSize}
    <span class="fn__flex-1"></span>
    <label class="fn__flex">
        ${window.siyuan.languages.relativeFontSize}
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" ${c.endsWith("em")?"checked":""} type="checkbox">
        <span class="fn__space--small"></span>
    </label>
</div>
<div data-id="fontSizeWrap" class="${s?" fn__none":""}">
    <div class="fn__hr"></div>
    <div class="b3-tooltips b3-tooltips__n fn__flex${c.endsWith("em")?" fn__none":""}" aria-label="${c}">   
        <input class="b3-slider fn__block" id="fontSizePX" max="72" min="9" step="1" type="range" value="${parseInt(c)}">
    </div>
    <div class="b3-tooltips b3-tooltips__n fn__flex${c.endsWith("em")?"":" fn__none"}" aria-label="${parseFloat(c)*100}%">   
        <input class="b3-slider fn__block" id="fontSizeEM" max="4.5" min="0.56" step="0.01" type="range" value="${parseFloat(c)}">
    </div>
</div>
<div class="fn__hr--b"></div>
<div data-id="clearFontStyle" class="fn__flex">
    <div class="fn__space--small"></div>
    <button class="b3-button b3-button--remove fn__block" data-type="clear">
        <svg><use xlink:href="#iconTrashcan"></use></svg>${window.siyuan.languages.clearFontStyle}
    </button>
    <div class="fn__space--small"></div>
</div>`,i.addEventListener("click",function(f){let h=f.target;for(;h&&!h.isEqualNode(i);){const m=h.getAttribute("data-type");if(h.tagName==="BUTTON"){m==="style1"?fo(t,e,m,h.style.backgroundColor+p.ZWSP+h.style.color):m==="fontSize"?fo(t,e,m,h.textContent.trim()):m==="backgroundColor"?fo(t,e,m,h.style.backgroundColor):m==="color"?fo(t,e,m,h.style.color):fo(t,e,m);break}h=h.parentElement}});const d=i.querySelector(".b3-switch"),u=i.querySelector("#fontSizePX"),g=i.querySelector("#fontSizeEM");return d.addEventListener("change",function(){if(d.checked){const f=parseFloat((parseInt(u.value)/16).toFixed(2));g.parentElement.setAttribute("aria-label",(f*100).toString()+"%"),g.value=f.toString(),u.parentElement.classList.add("fn__none"),g.parentElement.classList.remove("fn__none"),fo(t,e,"fontSize",g.value+"em")}else{const f=Math.round(parseFloat(g.value)*16);u.parentElement.setAttribute("aria-label",f+"px"),u.value=f.toString(),u.parentElement.classList.remove("fn__none"),g.parentElement.classList.add("fn__none"),fo(t,e,"fontSize",u.value+"px")}}),u.addEventListener("change",function(){fo(t,e,"fontSize",u.value+"px")}),g.addEventListener("change",function(){fo(t,e,"fontSize",g.value+"em")}),u.addEventListener("input",function(){u.parentElement.setAttribute("aria-label",u.value+"px")}),g.addEventListener("input",function(){g.parentElement.setAttribute("aria-label",(parseFloat(g.value)*100).toFixed(0)+"%")}),i},fo=(t,e,n,a)=>{let i=window.siyuan.storage[p.LOCAL_FONTSTYLES];if(n)i.splice(0,0,`${n}${p.ZWSP}${a}`),i=[...new Set(i)],i.length>8&&i.splice(8,1),window.siyuan.storage[p.LOCAL_FONTSTYLES]=i,Gt(p.LOCAL_FONTSTYLES,window.siyuan.storage[p.LOCAL_FONTSTYLES]);else if(i.length===0)n="style1",a="var(--b3-card-error-color)"+p.ZWSP+"var(--b3-card-error-background)";else{const s=i[0].split(p.ZWSP);n=s.splice(0,1)[0],a=s.join(p.ZWSP)}e&&e.length>0?(lc(e,t,s=>{if(n==="clear")s.style.color="",s.style.webkitTextFillColor="",s.style.webkitTextStroke="",s.style.textShadow="",s.style.backgroundColor="",s.style.fontSize="",s.style.removeProperty("--b3-parent-background");else if(n==="style1"){const r=a.split(p.ZWSP);s.style.backgroundColor=r[0],s.style.color=r[1],s.style.setProperty("--b3-parent-background",r[0])}else n==="style2"?(s.style.webkitTextStroke="0.2px var(--b3-theme-on-background)",s.style.webkitTextFillColor="transparent"):n==="style4"?s.style.textShadow="1px 1px var(--b3-theme-surface-lighter), 2px 2px var(--b3-theme-surface-lighter), 3px 3px var(--b3-theme-surface-lighter), 4px 4px var(--b3-theme-surface-lighter)":n==="color"?s.style.color=a:n==="backgroundColor"?(s.style.backgroundColor=a,s.style.setProperty("--b3-parent-background",a)):n==="fontSize"&&(s.style.fontSize=a);(n==="fontSize"||n==="clear")&&s.getAttribute("data-type")==="NodeCodeBlock"&&Rf(s.querySelector(".hljs"))}),Pt(t.toolbar.range)):n==="clear"?t.toolbar.setInlineMark(t,"clear","range",{type:"text"}):t.toolbar.setInlineMark(t,"text","range",{type:n,color:a})},Pv=(t,e)=>{const n=s=>{const r=s.split(p.ZWSP),o=r.splice(0,1)[0];t.setAttribute("data-id",o),t.setAttribute("data-subtype",r.splice(0,1)[0]),t.removeAttribute("data-href");let l=r.join("");l.replace(/\s/g,"")===""&&(l=o),t.innerText=l},a=s=>{const r=s.split(p.ZWSP);t.setAttribute("data-href",r[0]),t.removeAttribute("data-subtype"),t.removeAttribute("data-id"),r[1]&&(t.textContent=r[1])},i=s=>{const r=s.split(p.ZWSP);t.setAttribute("data-id",r[0]),t.removeAttribute("data-href"),t.removeAttribute("data-subtype"),r[1]&&(t.textContent=r[1])};if(e){switch(e.type){case"color":t.style.color=e.color;break;case"fontSize":t.style.fontSize=e.color;break;case"backgroundColor":t.style.backgroundColor=e.color;break;case"style1":t.style.backgroundColor=e.color.split(p.ZWSP)[0],t.style.color=e.color.split(p.ZWSP)[1];break;case"style2":t.style.webkitTextStroke="0.2px var(--b3-theme-on-background)",t.style.webkitTextFillColor="transparent";break;case"style4":t.style.textShadow="1px 1px var(--b3-theme-surface-lighter), 2px 2px var(--b3-theme-surface-lighter), 3px 3px var(--b3-theme-surface-lighter), 4px 4px var(--b3-theme-surface-lighter)";break;case"id":n(e.color);break;case"inline-math":t.className="render-node",t.setAttribute("contenteditable","false"),t.setAttribute("data-subtype","math"),t.setAttribute("data-content",t.textContent.replace(p.ZWSP,"")),t.removeAttribute("data-render"),t.textContent="";break;case"a":a(e.color);break;case"file-annotation-ref":i(e.color);break;case"inline-memo":t.removeAttribute("contenteditable"),t.removeAttribute("data-content");break}t.getAttribute("style")||t.removeAttribute("style")}},oS=(t,e,n)=>{if(!n&&t){const a=e.getAttribute("data-type").split(" ");return a.includes("inline-math")||a.includes("inline-memo")||a.includes("a")||a.includes("block-ref")&&(t.getAttribute("data-id")!==e.getAttribute("data-id")||t.getAttribute("data-subtype")!==e.getAttribute("data-subtype")||t.textContent!==e.textContent)||a.includes("file-annotation-ref")&&(t.getAttribute("data-id")!==e.getAttribute("data-id")||t.textContent!==e.textContent)?!1:e.style.color===t.style.color&&e.style.webkitTextFillColor===t.style.webkitTextFillColor&&e.style.webkitTextStroke===t.style.webkitTextStroke&&e.style.textShadow===t.style.textShadow&&e.style.backgroundColor===t.style.backgroundColor&&e.style.fontSize===t.style.fontSize}if(n){if(n.type==="text")return!e.style.color&&!e.style.webkitTextFillColor&&!e.style.webkitTextStroke&&!e.style.textShadow&&!e.style.fontSize&&!e.style.backgroundColor;if(n.type==="color")return n.color===e.style.color;if(n.type==="backgroundColor")return n.color===e.style.backgroundColor;if(n.type==="style1")return n.color.split(p.ZWSP)[0]===e.style.color&&n.color.split(p.ZWSP)[1]===e.style.backgroundColor;if(n.type==="style2")return e.style.webkitTextFillColor==="transparent"&&e.style.webkitTextStroke==="0.2px var(--b3-theme-on-background)";if(n.type==="style4")return e.style.textShadow==="1px 1px var(--b3-theme-surface-lighter), 2px 2px var(--b3-theme-surface-lighter), 3px 3px var(--b3-theme-surface-lighter), 4px 4px var(--b3-theme-surface-lighter)";if(n.type==="fontSize")return n.color===e.style.fontSize}return!1},lS=t=>{let e;if(t.toolbar.range.toString()===""&&(e=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select")),e.length===0)){const n=oe(t.toolbar.range.startContainer);n&&(e=[n])}return e},yM=(t,e,n)=>{var a,i,s;if(N(t,"protyle-wysiwyg__embed"))return;const r=pt(t);if(!r&&t.classList.contains("protyle-wysiwyg--select")){qa(Ee(t),e,!1),e.collapse(!1),Ut(["select"],n);return}if((a=n.observerLoad)==null||a.disconnect(),r||t.classList.contains("table")){t.classList.contains("protyle-wysiwyg--select")&&t.classList.contains("render-node")?n.toolbar.showRender(n,t):Ms(n,"afterend");return}const o=Ee(t);if(o.querySelectorAll(".img--select").forEach(w=>{w.classList.remove("img--select")}),t.getAttribute("data-type")==="NodeAttributeView")return!0;const l=o.innerHTML.trimStart(),c=o.textContent.trimStart();if((l.startsWith("```")||l.startsWith("\xB7\xB7\xB7")||l.startsWith("~~~")||l.indexOf("\n```")>-1&&c.indexOf("\n```")>-1||l.indexOf(`
~~~`)>-1&&c.indexOf(`
~~~`)>-1||l.indexOf(`
\xB7\xB7\xB7`)>-1&&c.indexOf(`
\xB7\xB7\xB7`)>-1)&&!(l.indexOf(`
`)===-1&&l.replace(/|~/g,"`").replace(/^`{3,}/g,"").indexOf("`")>-1)){if(t.classList.contains("p")){const w=t.outerHTML;let S=o.innerHTML.replace(/\n(~||`){3,}/g,"\n```").trim().replace(/^(~||`){3,}/g,"```");S.endsWith("\n```")||(S+="<wbr>\n```"),o.innerHTML=S,t.outerHTML=n.lute.SpinBlockDOM(t.outerHTML),t=n.wysiwyg.element.querySelector(`[data-node-id="${t.getAttribute("data-node-id")}"]`);const B=t.querySelector(".protyle-action__language");return B?(window.siyuan.storage[p.LOCAL_CODELANG]&&B.textContent===""?B.textContent=window.siyuan.storage[p.LOCAL_CODELANG]:p.SIYUAN_RENDER_CODE_LANGUAGES.includes(B.textContent)||(window.siyuan.storage[p.LOCAL_CODELANG]=B.textContent,Gt(p.LOCAL_CODELANG,window.siyuan.storage[p.LOCAL_CODELANG])),p.SIYUAN_RENDER_CODE_LANGUAGES.includes(B.textContent)?(t.dataset.content="",t.dataset.subtype=B.textContent,t.className="render-node",t.innerHTML=`<div spin="1"></div><div class="protyle-attr" contenteditable="false">${p.ZWSP}</div>`,n.toolbar.showRender(n,t),zn(t)):ra(t)):(n.toolbar.showRender(n,t),zn(t)),Ht(n,t.getAttribute("data-node-id"),t.outerHTML,w),!0}}if(t.getAttribute("data-type")==="NodeCodeBlock"){const w=document.createElement("wbr");e.insertNode(w);const S=t.outerHTML;return w.remove(),e.extractContents(),o.textContent.endsWith(`
`)||o.insertAdjacentText("beforeend",`
`),e.insertNode(document.createTextNode(`
`)),e.collapse(!1),e.insertNode(w),o.parentElement.removeAttribute("data-render"),ra(t),Ht(n,t.getAttribute("data-node-id"),t.outerHTML,S),kn(n),!0}if(o.textContent.replace(p.ZWSP,"").replace(`
`,"")===""&&t.nextElementSibling&&t.nextElementSibling.classList.contains("protyle-attr")&&t.parentElement.getAttribute("data-type")==="NodeBlockquote"){e.insertNode(document.createElement("wbr"));const w=$t(t),S=t.getAttribute("data-node-id"),B=w.getAttribute("data-node-id"),H={action:"insert",id:S,data:t.outerHTML},j={action:"insert",id:B,data:w.outerHTML};return B===S?(H.previousID=t.parentElement.getAttribute("data-node-id"),j.previousID=t.previousElementSibling.getAttribute("data-node-id"),t.parentElement.after(t)):(H.previousID=w.previousElementSibling?w.previousElementSibling.getAttribute("data-node-id"):void 0,H.parentID=w.parentElement.getAttribute("data-node-id")||n.block.parentID,j.previousID=H.previousID,j.parentID=H.parentID,w.after(t),w.remove()),et(n,[{action:"delete",id:B},H],[{action:"delete",id:S},j]),B===S&&t.parentElement.classList.contains("sb")&&t.parentElement.getAttribute("data-sb-layout")==="col"&&Qs({protyle:n,selectsElement:[t.previousElementSibling,t],type:"BlocksMergeSuperBlock",level:"row"}),cn(t,e),!0}const d=ya(o,n.wysiwyg.element,e);if(t.parentElement.getAttribute("data-type")==="NodeListItem"&&(t.nextElementSibling.classList.contains("protyle-attr")||t.nextElementSibling.classList.contains("list")&&((i=t.previousElementSibling)!=null&&i.classList.contains("protyle-action"))||d.start===0&&t.previousElementSibling.classList.contains("protyle-action")||t.parentElement.getAttribute("fold")==="1")&&_M(n,t,e))return!0;if(o.textContent!==""&&e.toString()===""&&d.start===0){let w;t.previousElementSibling&&t.previousElementSibling.getAttribute("data-type")==="NodeHeading"&&t.previousElementSibling.getAttribute("fold")==="1"?w=Hh(t.previousElementSibling,!1,!0):w=Fs(!1,!0);const S=w.getAttribute("data-node-id");return et(n,[{action:"insert",data:w.outerHTML,id:S,previousID:t.previousElementSibling?t.previousElementSibling.getAttribute("data-node-id"):"",parentID:t.parentElement.getAttribute("data-node-id")||n.block.parentID}],[{action:"delete",id:S}]),w.querySelector("wbr").remove(),t.insertAdjacentElement("beforebegin",w),Jy(w),!0}e.insertNode(document.createElement("wbr"));const u=t.outerHTML;if(e.toString()!==""){const w=ue(e.startContainer,"data-type","inline-math");if(w){const S=_t(w);return S&&(e=getSelection().getRangeAt(0),e.setEnd(S,S.textContent.startsWith(p.ZWSP)?1:0),e.collapse(!1)),(s=w.querySelector("wbr"))==null||s.remove(),!0}e.extractContents(),e.insertNode(document.createElement("wbr"))}o.lastChild&&e.setEndAfter(o.lastChild);const g=t.getAttribute("data-node-id"),f=document.createElement("div");t.getAttribute("data-type")==="NodeHeading"&&t.getAttribute("fold")==="1"?f.innerHTML=Hh(t,!0):f.appendChild(Fs(!1,!1));const h=f.querySelector('[contenteditable="true"]');h.appendChild(e.extractContents());const m=h.querySelector("wbr");m&&m.parentElement.tagName==="SPAN"&&m.parentElement.innerHTML==="<wbr>"&&(m.parentElement.outerHTML="<wbr>");const b=h.innerHTML.trimStart(),y=h.textContent.trimStart();if((b.startsWith("```")||b.startsWith("\xB7\xB7\xB7")||b.startsWith("~~~")||b.indexOf("\n```")>-1&&y.indexOf("\n```")>-1||b.indexOf(`
~~~`)>-1&&y.indexOf(`
~~~`)>-1||b.indexOf(`
\xB7\xB7\xB7`)>-1&&y.indexOf(`
\xB7\xB7\xB7`)>-1)&&!(b.indexOf(`
`)===-1&&b.replace(/|~/g,"`").replace(/^`{3,}/g,"").indexOf("`")>-1)){let w=h.innerHTML.replace(/\n(~||`){3,}/g,"\n```").trim().replace(/^(~||`){3,}/g,"```");w.endsWith("\n```")||(w+="\n```"),h.innerHTML=w}f.innerHTML=n.lute.SpinBlockDOM(f.innerHTML);const _=document.createElement("div");_.innerHTML=n.lute.SpinBlockDOM(o.parentElement.outerHTML);const v=[],U=[];let ee=t;const Z=[];Array.from(_.children).forEach(w=>{w.dataset.nodeId===g?(t.before(w),t.remove(),v.push({action:"update",data:w.outerHTML,id:g}),U.push({action:"update",data:u,id:g})):(v.push({action:"insert",data:w.outerHTML,id:w.dataset.nodeId,nextID:g}),ee.insertAdjacentElement("afterend",w),U.push({action:"delete",id:w.dataset.nodeId})),w.dataset.type==="NodeBlockQueryEmbed"?$n(n,w):Ei(w),ee=w,Z.push(w)}),Array.from(f.children).forEach(w=>{const S=w.getAttribute("data-node-id");v.push({action:"insert",data:w.outerHTML,id:S,previousID:ee.getAttribute("data-node-id")}),U.push({action:"delete",id:S}),ee.insertAdjacentElement("afterend",w),w.classList.contains("code-block")?ra(w):w.dataset.type==="NodeBlockQueryEmbed"?$n(n,w):Ei(ee.nextElementSibling),ee=w,Z.push(w)});const k=ee.parentElement;return et(n,v,U),k.classList.contains("sb")&&k.getAttribute("data-sb-layout")==="col"&&Qs({protyle:n,selectsElement:Z,type:"BlocksMergeSuperBlock",level:"row"}),cn(ee,e),kn(n),!0},_M=(t,e,n)=>{var a,i;const s=e.parentElement,r=Ee(e);if(["",`
`].includes(r.textContent)&&e.previousElementSibling.classList.contains("protyle-action")&&!e.querySelector("img")){if((a=s.nextElementSibling)!=null&&a.classList.contains("protyle-attr"))return Uh(t,[e.parentElement],n),!0;if(!s.parentElement.classList.contains("protyle-wysiwyg"))return BM(t,e,n),!0}const o=ya(r,t.wysiwyg.element,n);if(n.toString()===""&&o.start===0&&!zt(n.startContainer)){if(s.parentElement.classList.contains("protyle-wysiwyg"))return!0;const h=document.createElement("wbr");n.insertNode(h);const m=s.parentElement.outerHTML;h.remove();let b=$d(s,-1,!0);if(e.previousElementSibling.classList.contains("protyle-action"))Ee(e).textContent===""?s.insertAdjacentElement("afterend",b):s.insertAdjacentElement("beforebegin",b);else{if(Ee(e).textContent!=="")return!1;e.remove(),b=$d(s,-1,!0),s.insertAdjacentElement("afterend",b)}return s.getAttribute("data-subtype")==="o"&&xa(s.parentElement),Ht(t,s.parentElement.getAttribute("data-node-id"),s.parentElement.outerHTML,m),cn(b,n),kn(t),Jy(b),!0}const l=s.querySelector(".list");let c;if(l&&s.getAttribute("fold")!=="1"&&e.nextElementSibling===l){if(o.end>=r.textContent.length-(r.textContent.endsWith(p.ZWSP)?1:0)){n.insertNode(document.createElement("wbr"));const h=s.outerHTML;e.querySelector("wbr").remove(),c=$d(l.firstElementChild,-1,!0),l.firstElementChild.before(c),l.getAttribute("data-subtype")==="o"&&xa(l),Ht(t,s.getAttribute("data-node-id"),s.outerHTML,h),cn(s,n),kn(t)}else{n.insertNode(document.createElement("wbr"));const h=s.outerHTML,m=s.parentElement.outerHTML;n.toString()!==""&&(n.extractContents(),n.insertNode(document.createElement("wbr"))),n.setEndAfter(r.lastChild),c=$d(s,0,!1);const b=Ee(c);b.appendChild(n.extractContents());const y=b.querySelector("wbr");y&&y.parentElement.tagName==="SPAN"&&y.parentElement.innerHTML==="<wbr>"&&(y.parentElement.outerHTML="<wbr>");let _=l.nextElementSibling;for(c.lastElementChild.before(l);!_.classList.contains("protyle-attr");)_=_.nextElementSibling,c.lastElementChild.before(_.previousElementSibling);s.insertAdjacentElement("afterend",c),s.getAttribute("data-subtype")==="o"&&xa(s.parentElement),s.parentElement.classList.contains("protyle-wysiwyg")?et(t,[{action:"update",data:s.outerHTML,id:s.getAttribute("data-node-id")},{action:"insert",id:c.getAttribute("data-node-id"),data:c.outerHTML,previousID:s.getAttribute("data-node-id")}],[{action:"delete",id:c.getAttribute("data-node-id")},{action:"update",data:h,id:s.getAttribute("data-node-id")}]):Ht(t,s.parentElement.getAttribute("data-node-id"),s.parentElement.outerHTML,m),cn(c,n),kn(t)}return Jy(c),!0}if((n.toString()===""||n.toString()===p.ZWSP)&&n.startContainer.nodeType===3&&n.startOffset===0){let h=n.startContainer;for(;h;)if(h.textContent===p.ZWSP){n.setStart(h,1),n.collapse(!1);break}else h=h.nextSibling}n.insertNode(document.createElement("wbr"));const d=s.outerHTML,u=s.parentElement.outerHTML;if(n.toString()!==""){const h=ue(n.startContainer,"data-type","inline-math");if(h){const m=_t(h);return m&&(n=getSelection().getRangeAt(0),n.setEnd(m,m.textContent.startsWith(p.ZWSP)?1:0),n.collapse(!1)),(i=h.querySelector("wbr"))==null||i.remove(),!0}n.extractContents(),n.insertNode(document.createElement("wbr"))}r.lastChild&&n.setEndAfter(r.lastChild),c=$d(s,0,!1);const g=Ee(c);g.appendChild(n.extractContents());const f=g.querySelector("wbr");return f&&f.parentElement.tagName==="SPAN"&&f.parentElement.innerHTML==="<wbr>"&&(f.parentElement.outerHTML="<wbr>"),g.parentElement.outerHTML=t.lute.SpinBlockDOM(g.parentElement.outerHTML),s.insertAdjacentElement("afterend",c),$n(t,c),Ei(c),zn(c),r.parentElement.outerHTML=t.lute.SpinBlockDOM(r.parentElement.outerHTML),$n(t,s),Ei(s),zn(s),s.getAttribute("data-subtype")==="o"&&xa(s.parentElement),s.parentElement.classList.contains("protyle-wysiwyg")?et(t,[{action:"update",id:s.getAttribute("data-node-id"),data:s.outerHTML},{action:"insert",id:c.getAttribute("data-node-id"),data:c.outerHTML,previousID:s.getAttribute("data-node-id")}],[{action:"delete",id:c.getAttribute("data-node-id")},{action:"update",id:s.getAttribute("data-node-id"),data:d}]):Ht(t,s.parentElement.getAttribute("data-node-id"),s.parentElement.outerHTML,u),cn(c,n),kn(t),Jy(c),!0},Jy=t=>{const e=Ee(t).childNodes;for(let n=0;n<e.length;n++)e[n].nodeType===3&&e[n].textContent.length===0&&(e[n].remove(),n--)},wM=(t,e,n)=>{let a=t.startContainer;const i=_t(a);if(e.getAttribute("data-type")==="NodeAttributeView")return!0;if(i&&i.nodeType!==3&&ya(t.startContainer,n.wysiwyg.element,t).end===t.endContainer.textContent.length&&(i.classList.contains("img")||i.getAttribute("data-type")==="inline-math")){i.insertAdjacentHTML("beforebegin","<wbr>");const r=e.outerHTML;i.previousElementSibling.remove();const o=document.createTextNode(`
`);return a.after(document.createTextNode(p.ZWSP)),a.after(o),t.selectNode(o),t.collapse(!1),Ht(n,e.getAttribute("data-node-id"),e.outerHTML,r),!0}if(a.nodeType===3&&(a=a.parentElement),a&&n.toolbar.getCurrentType(t).length>0&&ya(a,a,t).end===a.textContent.length)return cS(t,e,n,a),!0;if(yn()||x()){a=t.startContainer;const s=_t(a);return s&&s.textContent.trim()!==""?(document.execCommand("insertHTML",!1,`
`),!0):(cS(t,e,n,a),!0)}return!1},cS=(t,e,n,a)=>{const i=document.createElement("wbr");a.nodeType===3?t.insertNode(i):a.insertAdjacentElement("afterend",i);const s=e.outerHTML;i.remove();let r;_t(a)||(r=document.createTextNode(`
`),a.after(r));const o=document.createTextNode(`
`);a.after(o),r?t.setStart(r,0):t.setStart(o,1),t.collapse(!0),Pt(t),Ht(n,e.getAttribute("data-node-id"),e.outerHTML,s)};let dS,Oh=!1;const Wn=(t,e,n,a="false")=>{let i;return e&&e.startsWith("icon")?i=`<svg class="keyboard__slash-icon"><use xlink:href="#${e}"></use></svg>`:i=e,`<button class="keyboard__slash-item" data-focus="${a}" data-value="${encodeURIComponent(t)}">
    ${i}
    <span class="keyboard__slash-text">${n}</span>
</button>`},uS=(t,e)=>{let n="";["","var(--b3-font-color1)","var(--b3-font-color2)","var(--b3-font-color3)","var(--b3-font-color4)","var(--b3-font-color5)","var(--b3-font-color6)","var(--b3-font-color7)","var(--b3-font-color8)","var(--b3-font-color9)","var(--b3-font-color10)","var(--b3-font-color11)","var(--b3-font-color12)","var(--b3-font-color13)"].forEach((u,g)=>{n+=`<button class="keyboard__slash-item" data-type="color">
    <span class="keyboard__slash-icon" ${u?`style="color:${u}"`:""}>A</span>
    <span class="keyboard__slash-text">${window.siyuan.languages.colorFont} ${u?g+1:window.siyuan.languages.default}</span>
</button>`});let a="";["","var(--b3-font-background1)","var(--b3-font-background2)","var(--b3-font-background3)","var(--b3-font-background4)","var(--b3-font-background5)","var(--b3-font-background6)","var(--b3-font-background7)","var(--b3-font-background8)","var(--b3-font-background9)","var(--b3-font-background10)","var(--b3-font-background11)","var(--b3-font-background12)","var(--b3-font-background13)"].forEach((u,g)=>{a+=`<button class="keyboard__slash-item" data-type="backgroundColor">
    <span class="keyboard__slash-icon" ${u?`style="background-color:${u}"`:""}>A</span>
    <span class="keyboard__slash-text">${window.siyuan.languages.colorPrimary} ${u?g+1:window.siyuan.languages.default}</span>
</button>`});const i=lS(t);let s=!1;i==null||i.find(u=>{if(u.classList.contains("li"))return s=!0,!0});let r="";const o=window.siyuan.storage[p.LOCAL_FONTSTYLES];o.length>0&&(r=`<div data-id="lastUsed" class="keyboard__slash-title">
    ${window.siyuan.languages.lastUsed}
</div>
<div data-id="lastUsedWrap" class="keyboard__slash-block">`,o.forEach(u=>{const g=u.split(p.ZWSP);switch(g[0]){case"color":r+=`<button class="keyboard__slash-item" data-type="${g[0]}">
    <span class="keyboard__slash-icon" ${g[1]?`style="color:${g[1]}"`:""} >A</span>
    <span class="keyboard__slash-text">${window.siyuan.languages.colorFont} ${g[1]?parseInt(g[1].replace("var(--b3-font-color",""))+1:window.siyuan.languages.default}</span>
</button>`;break;case"backgroundColor":r+=`<button class="keyboard__slash-item" data-type="${g[0]}">
    <span class="keyboard__slash-icon" ${g[1]?`style="background-color:${g[1]}"`:""}>A</span>
    <span class="keyboard__slash-text">${window.siyuan.languages.colorPrimary} ${g[1]?parseInt(g[1].replace("var(--b3-font-background",""))+1:window.siyuan.languages.default}</span>
</button>`;break;case"style2":r+=`<button class="keyboard__slash-item" data-type="${g[0]}">
    <span class="keyboard__slash-text" style="-webkit-text-stroke: 0.2px var(--b3-theme-on-background);-webkit-text-fill-color : transparent;">${window.siyuan.languages.hollow}</span>
</button>`;break;case"style4":r+=`<button class="keyboard__slash-item" data-type="${g[0]}">
    <span class="keyboard__slash-text" style="text-shadow: 1px 1px var(--b3-theme-surface-lighter), 2px 2px var(--b3-theme-surface-lighter), 3px 3px var(--b3-theme-surface-lighter), 4px 4px var(--b3-theme-surface-lighter)">${window.siyuan.languages.shadow}</span>
</button>`;break;case"fontSize":s||(r+=`<button class="keyboard__slash-item" data-type="${g[0]}">
    <span class="keyboard__slash-text">${g[1]}</span>
</button>`);break;case"style1":g[1]?r+=`<button class="keyboard__slash-item" data-type="${g[0]}">
    <span class="keyboard__slash-icon" style="background-color:${g[1]};color:${g[2]}">A</span>
    <span class="keyboard__slash-text">${window.siyuan.languages[g[2].replace("var(--b3-card-","").replace("-color)","")+"Style"]}</span>
</button>`:r+=`<button class="keyboard__slash-item" data-type="${g[0]}">
    <span class="keyboard__slash-icon">A</span>
    <span class="keyboard__slash-text">${window.siyuan.languages.color} ${window.siyuan.languages.default}</span>
</button>`;break;case"clear":r+=`<button class="keyboard__slash-item" data-type="${g[0]}">
    <span class="keyboard__slash-text">${window.siyuan.languages.clearFontStyle}</span>
</button>`;break}}),r+="</div>");let l,c="16px";i&&i.length>0?l=i[0]:(l=t.toolbar.range.cloneContents().querySelector('[data-type~="text"]'),l||(l=ue(t.toolbar.range.startContainer,"data-type","text"))),l&&(c=l.style.fontSize||"16px");const d=e.querySelector(".keyboard__util");d.innerHTML=`${r}
<div data-id="color" class="keyboard__slash-title">${window.siyuan.languages.color}</div>
<div data-id="colorWrap" class="keyboard__slash-block">
    <button class="keyboard__slash-item" data-type="style1">
        <span class="keyboard__slash-icon">A</span>
        <span class="keyboard__slash-text">${window.siyuan.languages.color} ${window.siyuan.languages.default}</span>
    </button>
    <button class="keyboard__slash-item" data-type="style1">
        <span class="keyboard__slash-icon" style="color: var(--b3-card-error-color);background-color: var(--b3-card-error-background);">A</span>
        <span class="keyboard__slash-text">${window.siyuan.languages.errorStyle}</span>
    </button>
    <button class="keyboard__slash-item" data-type="style1">
        <span class="keyboard__slash-icon" style="color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);">A</span>
        <span class="keyboard__slash-text">${window.siyuan.languages.warningStyle}</span>
    </button>
    <button class="keyboard__slash-item" data-type="style1">
        <span class="keyboard__slash-icon" style="color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);">A</span>
        <span class="keyboard__slash-text">${window.siyuan.languages.infoStyle}</span>
    </button>
    <button class="keyboard__slash-item" data-type="style1">
        <span class="keyboard__slash-icon" style="color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);">A</span>
        <span class="keyboard__slash-text">${window.siyuan.languages.successStyle}</span>
    </button>
</div>
<div data-id="colorFont" class="keyboard__slash-title">${window.siyuan.languages.colorFont}</div>
<div data-id="colorFontWrap" class="keyboard__slash-block">
    ${n}
</div>
<div data-id="colorPrimary" class="keyboard__slash-title">${window.siyuan.languages.colorPrimary}</div>
<div data-id="colorPrimaryWrap" class="keyboard__slash-block">
    ${a}
</div>
<div data-id="fontStyle" class="keyboard__slash-title">${window.siyuan.languages.fontStyle}</div>
<div data-id="fontStyleWrap" class="keyboard__slash-block">
    <button class="keyboard__slash-item" data-type="style2">
        <span class="keyboard__slash-text" style="-webkit-text-stroke: 0.2px var(--b3-theme-on-background);-webkit-text-fill-color : transparent;">${window.siyuan.languages.hollow}</span>
    </button>
    <button class="keyboard__slash-item" data-type="style4">
        <span class="keyboard__slash-text" style="text-shadow: 1px 1px var(--b3-theme-surface-lighter), 2px 2px var(--b3-theme-surface-lighter), 3px 3px var(--b3-theme-surface-lighter), 4px 4px var(--b3-theme-surface-lighter)">${window.siyuan.languages.shadow}</span>
    </button>
    <button class="keyboard__slash-item" data-type="clear">
        <svg class="keyboard__slash-icon"><use xlink:href="#iconTrashcan"></use></svg>
        <span class="keyboard__slash-text">${window.siyuan.languages.clearFontStyle}</span>
    </button>
</div>
<div data-id="fontSize" class="keyboard__slash-title${s?" fn__none":""}">${window.siyuan.languages.fontSize}</div>
<div data-id="fontSizeWrap" class="keyboard__slash-block${s?" fn__none":""}">
    <select class="b3-select fn__block" style="width: calc(50% - 8px);margin: 4px 0 8px 0;">
        <option ${c==="12px"?"selected":""} value="12px">12px</option>
        <option ${c==="13px"?"selected":""} value="13px">13px</option>
        <option ${c==="14px"?"selected":""} value="14px">14px</option>
        <option ${c==="15px"?"selected":""} value="15px">15px</option>
        <option ${c==="16px"?"selected":""} value="16px">16px</option>
        <option ${c==="19px"?"selected":""} value="19px">19px</option>
        <option ${c==="22px"?"selected":""} value="22px">22px</option>
        <option ${c==="24px"?"selected":""} value="24px">24px</option>
        <option ${c==="29px"?"selected":""} value="29px">29px</option>
        <option ${c==="32px"?"selected":""} value="32px">32px</option>
        <option ${c==="40px"?"selected":""} value="40px">40px</option>
        <option ${c==="48px"?"selected":""} value="48px">48px</option>
    </select>
</div>`,d.querySelector("select").addEventListener("change",function(u){fo(t,i,"fontSize",u.target.value)})},vM=(t,e)=>{t.hint.splitChar="/",t.hint.lastIndex=-1;let n="";t.app.plugins.forEach(i=>{i.protyleSlash.forEach(s=>{n+=Wn(`plugin${Constants.ZWSP}${i.name}${Constants.ZWSP}${s.id}`,"",s.html,"true")})}),n&&(n=`<div class="keyboard__slash-title"></div><div class="keyboard__slash-block">${n}</div>`);const a=e.querySelector(".keyboard__util");a.innerHTML=`<div class="keyboard__slash-title"></div>
<div class="keyboard__slash-block">
    ${Wn(Constants.ZWSP,"iconMarkdown",window.siyuan.languages.template)}
    ${Wn(Constants.ZWSP+1,"iconBoth",window.siyuan.languages.widget)}
    ${Wn(Constants.ZWSP+2,"iconImage",window.siyuan.languages.assets)}
    ${Wn("((","iconRef",window.siyuan.languages.ref,"true")}
    ${Wn("{{","iconSQL",window.siyuan.languages.blockEmbed,"true")}
    ${Wn(Constants.ZWSP+5,"iconSparkles",window.siyuan.languages.aiWriting)}
    ${Wn('<div data-type="NodeAttributeView" data-av-type="table"></div>',"iconDatabase",window.siyuan.languages.database,"true")}
    ${Wn(Constants.ZWSP+4,"iconFile",window.siyuan.languages.newSubDocRef)}
</div>
<div class="keyboard__slash-title"></div>
<div class="keyboard__slash-block">
    ${Wn(Constants.ZWSP+3,"iconDownload",window.siyuan.languages.insertAsset+'<input class="b3-form__upload" type="file"'+(t.options.upload.accept?' multiple="'+t.options.upload.accept+'"':"")+"/>","true")}
    ${isInAndroid()?Wn(Constants.ZWSP+3,"iconCamera",window.siyuan.languages.insertPhoto+'<input class="b3-form__upload" capture="user" type="file"'+(t.options.upload.accept?' multiple="'+t.options.upload.accept+'"':"")+"/>","true"):""}
    ${Wn('<iframe sandbox="allow-forms allow-presentation allow-same-origin allow-scripts allow-modals allow-popups" src="" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>',"iconLanguage",window.siyuan.languages.insertIframeURL,"true")}
    ${Wn("![]()","iconImage",window.siyuan.languages.insertImgURL,"true")}
    ${Wn('<video controls="controls" src=""></video>',"iconVideo",window.siyuan.languages.insertVideoURL,"true")}
    ${Wn('<audio controls="controls" src=""></audio>',"iconRecord",window.siyuan.languages.insertAudioURL,"true")}
    ${Wn("emoji","iconEmoji",window.siyuan.languages.emoji,"true")}
</div>
<div class="keyboard__slash-title"></div>
<div class="keyboard__slash-block">
    ${Wn("# "+Lute.Caret,"iconH1",window.siyuan.languages.heading1,"true")}
    ${Wn("## "+Lute.Caret,"iconH2",window.siyuan.languages.heading2,"true")}
    ${Wn("### "+Lute.Caret,"iconH3",window.siyuan.languages.heading3,"true")}
    ${Wn("#### "+Lute.Caret,"iconH4",window.siyuan.languages.heading4,"true")}
    ${Wn("##### "+Lute.Caret,"iconH5",window.siyuan.languages.heading5,"true")}
    ${Wn("###### "+Lute.Caret,"iconH6",window.siyuan.languages.heading6,"true")}
    ${Wn("- "+Lute.Caret,"iconList",window.siyuan.languages.list,"true")}
    ${Wn("1. "+Lute.Caret,"iconOrderedList",window.siyuan.languages["ordered-list"],"true")}
    ${Wn("- [ ] "+Lute.Caret,"iconCheck",window.siyuan.languages.check,"true")}
    ${Wn("> "+Lute.Caret,"iconQuote",window.siyuan.languages.quote,"true")}
    ${Wn("```","iconCode",window.siyuan.languages.code,"true")}
    ${Wn(`| ${Lute.Caret} |  |  |
| --- | --- | --- |
|  |  |  |
|  |  |  |`,"iconTable",window.siyuan.languages.table,"true")}
    ${Wn("---","iconLine",window.siyuan.languages.line,"true")}
    ${Wn("$$","iconMath",window.siyuan.languages.math)}
    ${Wn("<div>","iconHTML5","HTML")}
</div>
<div class="keyboard__slash-title"></div>
<div class="keyboard__slash-block">
    ${Wn("```abc\n```","",window.siyuan.languages.staff,"true")}
    ${Wn("```echarts\n```","",window.siyuan.languages.chart,"true")}
    ${Wn("```flowchart\n```","","Flow Chart","true")}
    ${Wn("```graphviz\n```","","Graph","true")}
    ${Wn("```mermaid\n```","","Mermaid","true")}
    ${Wn("```mindmap\n```","",window.siyuan.languages.mindmap,"true")}
    ${Wn("```plantuml\n```","","UML","true")}
</div>
<div class="keyboard__slash-title"></div>
<div class="keyboard__slash-block">
    ${Wn(`style${Constants.ZWSP}color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);`,'<div style="color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);" class="keyboard__slash-icon">A</div>',window.siyuan.languages.infoStyle,"true")}
    ${Wn(`style${Constants.ZWSP}color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);`,'<div style="color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);" class="keyboard__slash-icon">A</div>',window.siyuan.languages.successStyle,"true")}
    ${Wn(`style${Constants.ZWSP}color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);`,'<div style="color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);" class="keyboard__slash-icon">A</div>',window.siyuan.languages.warningStyle,"true")}
    ${Wn(`style${Constants.ZWSP}color: var(--b3-card-error-color);background-color: var(--b3-card-error-background);`,'<div style="color: var(--b3-card-error-color);background-color: var(--b3-card-error-background);" class="keyboard__slash-icon">A</div>',window.siyuan.languages.errorStyle,"true")}
    ${Wn(`style${Constants.ZWSP}`,'<div class="keyboard__slash-icon">A</div>',window.siyuan.languages.clearFontStyle,"true")}
</div>${n}`,t.hint.bindUploadEvent(t,a)},Nv=t=>{window.siyuan.menus.menu.remove(),Oh=!0;const e=document.getElementById("keyboardToolbar");let n=e.getAttribute("data-keyboardheight");n=(n?parseInt(n)+42:window.outerHeight/2)+"px";const a=Zy();a&&(a.protyle.element.parentElement.style.paddingBottom=n,a.protyle.contentElement.scrollTop=t),setTimeout(()=>{e.style.height=n},p.TIMEOUT_TRANSITION),setTimeout(()=>{Oh=!1},1e3)},Rh=()=>{const t=document.getElementById("keyboardToolbar");t.style.height="";const e=getCurrentEditor();e&&(e.protyle.element.parentElement.style.paddingBottom="42px"),t.querySelector('.keyboard__action[data-type="add"]').classList.remove("protyle-toolbar__item--current"),t.querySelector('.keyboard__action[data-type="text"]').classList.remove("protyle-toolbar__item--current"),t.querySelector('.keyboard__action[data-type="done"] use').setAttribute("xlink:href","#iconKeyboardHide")},xM=()=>{clearTimeout(dS),dS=window.setTimeout(()=>{if(getSelection().rangeCount===0||window.siyuan.config.readonly||document.getElementById("toolbarName").getAttribute("readonly")==="readonly"||window.screen.height-window.innerHeight<160||!document.activeElement||document.activeElement&&!["INPUT","TEXTAREA"].includes(document.activeElement.tagName)&&!document.activeElement.classList.contains("protyle-wysiwyg")&&document.activeElement.getAttribute("contenteditable")!=="true"){Bv();return}if(document.activeElement&&!["INPUT","TEXTAREA"].includes(document.activeElement.tagName)&&(document.getElementById("menu").style.transform==="translateX(0px)"||document.getElementById("model").style.transform==="translateY(0px)")){Bv();return}Oh||Rh(),EM();const t=document.querySelectorAll("#keyboardToolbar .keyboard__dynamic"),e=getSelection().getRangeAt(0);if(!hasClosestByClassName(e.startContainer,"protyle-wysiwyg",!0)){t[0].classList.add("fn__none"),t[1].classList.add("fn__none");return}e.toString()||t[0].querySelector('[data-type="goinline"]').classList.contains("protyle-toolbar__item--current")?(t[0].classList.add("fn__none"),t[1].classList.remove("fn__none")):(t[0].classList.remove("fn__none"),t[1].classList.add("fn__none"));const i=getCurrentEditor().protyle;if(i.toolbar.range=e,!t[0].classList.contains("fn__none")){i.undo.undoStack.length===0?t[0].querySelector('[data-type="undo"]').setAttribute("disabled","disabled"):t[0].querySelector('[data-type="undo"]').removeAttribute("disabled"),i.undo.redoStack.length===0?t[0].querySelector('[data-type="redo"]').setAttribute("disabled","disabled"):t[0].querySelector('[data-type="redo"]').removeAttribute("disabled");const s=hasClosestBlock(e.startContainer);if(s){const r=t[0].querySelector('[data-type="outdent"]');s.parentElement.classList.contains("li")?(r.classList.remove("fn__none"),r.nextElementSibling.classList.remove("fn__none")):(r.classList.add("fn__none"),r.nextElementSibling.classList.add("fn__none"))}}t[1].classList.contains("fn__none")||(t[1].querySelectorAll(".protyle-toolbar__item--current").forEach(r=>{r.classList.remove("protyle-toolbar__item--current")}),i.toolbar.getCurrentType(e).forEach(r=>{if(["search-mark","a","block-ref","virtual-block-ref","text","file-annotation-ref","inline-math","inline-memo","","backslash"].includes(r))return;const o=t[1].querySelector(`[data-type="${r}"]`);o&&o.classList.add("protyle-toolbar__item--current")}))},620)},EM=()=>{Oh||Rh();const t=document.getElementById("keyboardToolbar");if(!t.classList.contains("fn__none"))return;t.classList.remove("fn__none"),t.style.zIndex=(++window.siyuan.zIndex).toString();const e=document.getElementById("model");e.style.transform==="translateY(0px)"&&(e.style.paddingBottom="42px");const n=getSelection().getRangeAt(0),a=getCurrentEditor();a&&a.protyle.wysiwyg.element.contains(n.startContainer)&&(a.protyle.element.parentElement.style.paddingBottom="42px"),getCurrentEditor().protyle.app.plugins.forEach(i=>{i.eventBus.emit("mobile-keyboard-show")}),setTimeout(()=>{const i=hasClosestByClassName(n.startContainer,"protyle-content",!0);if(i){const s=i.getBoundingClientRect().top,r=getSelectionPosition(i).top;if(r<window.innerHeight-42&&r>s)return;i.scroll({top:i.scrollTop+r-window.innerHeight+42+26,left:i.scrollLeft,behavior:"smooth"})}},Constants.TIMEOUT_TRANSITION)},Bv=()=>{if(Oh)return;const t=document.getElementById("keyboardToolbar");if(t.classList.contains("fn__none"))return;t.classList.add("fn__none"),t.style.height="";const e=Zy();e&&(e.protyle.element.parentElement.style.paddingBottom="");const n=document.getElementById("model");n.style.transform==="translateY(0px)"&&(n.style.paddingBottom=""),Zy().protyle.app.plugins.forEach(a=>{a.eventBus.emit("mobile-keyboard-hide")})},Qy=()=>{window.JSAndroid&&window.JSAndroid.hideKeyboard&&window.JSAndroid.hideKeyboard(),Bv(),document.activeElement.blur()},Sz=()=>{let t=!1;document.addEventListener("selectionchange",()=>{t||xM()},!1);const e=document.getElementById("keyboardToolbar");e.innerHTML=`<div class="fn__flex keyboard__bar">
    <div class="fn__flex-1">
        <div class="fn__none keyboard__dynamic">
            <button class="keyboard__action" data-type="outdent"><svg><use xlink:href="#iconOutdent"></use></svg></button>
            <button class="keyboard__action" data-type="indent"><svg><use xlink:href="#iconIndent"></use></svg></button>
            <button class="keyboard__action" data-type="add"><svg><use xlink:href="#iconAdd"></use></svg></button>
            <button class="keyboard__action" data-type="block"><svg><use xlink:href="#iconParagraph"></use></svg></button>
            <button class="keyboard__action" data-type="goinline"><svg class="keyboard__svg--big"><use xlink:href="#iconBIU"></use></svg></button>
            <button class="keyboard__action" data-type="softLine"><svg><use xlink:href="#iconSoftWrap"></use></svg></button>
            <span class="keyboard__split"></span>
            <button class="keyboard__action" data-type="undo"><svg><use xlink:href="#iconUndo"></use></svg></button>
            <button class="keyboard__action" data-type="redo"><svg><use xlink:href="#iconRedo"></use></svg></button>
            <span class="keyboard__split"></span>
            <button class="keyboard__action" data-type="moveup"><svg><use xlink:href="#iconUp"></use></svg></button>
            <button class="keyboard__action" data-type="movedown"><svg><use xlink:href="#iconDown"></use></svg></button>
        </div>
        <div class="fn__none keyboard__dynamic">
            <button class="keyboard__action" data-type="goback"><svg><use xlink:href="#iconBack"></use></svg></button>
            <button class="keyboard__action" data-type="block-ref"><svg><use xlink:href="#iconRef"></use></svg></button>
            <button class="keyboard__action" data-type="a"><svg><use xlink:href="#iconLink"></use></svg></button>
            <button class="keyboard__action" data-type="text"><svg><use xlink:href="#iconFont"></use></svg></button>
            <button class="keyboard__action" data-type="strong"><svg><use xlink:href="#iconBold"></use></svg></button>
            <button class="keyboard__action" data-type="em"><svg><use xlink:href="#iconItalic"></use></svg></button>
            <button class="keyboard__action" data-type="u"><svg><use xlink:href="#iconUnderline"></use></svg></button>
            <button class="keyboard__action" data-type="s"><svg><use xlink:href="#iconStrike"></use></svg></button>
            <button class="keyboard__action" data-type="mark"><svg><use xlink:href="#iconMark"></use></svg></button>
            <button class="keyboard__action" data-type="sup"><svg><use xlink:href="#iconSup"></use></svg></button>
            <button class="keyboard__action" data-type="sub"><svg><use xlink:href="#iconSub"></use></svg></button>
            <button class="keyboard__action" data-type="clear"><svg><use xlink:href="#iconClear"></use></svg></button>
            <button class="keyboard__action" data-type="code"><svg><use xlink:href="#iconInlineCode"></use></svg></button>
            <button class="keyboard__action" data-type="kbd"<use xlink:href="#iconKeymap"></use></svg></button>
            <button class="keyboard__action" data-type="tag"><svg><use xlink:href="#iconTags"></use></svg></button>
            <button class="keyboard__action" data-type="inline-math"><svg><use xlink:href="#iconMath"></use></svg></button>
            <button class="keyboard__action" data-type="inline-memo"><svg><use xlink:href="#iconM"></use></svg></button>
            <button class="keyboard__action" data-type="goback"><svg><use xlink:href="#iconCloseRound"></use></svg></button>
        </div>
    </div>
    <span class="keyboard__split"></span>
    <button class="keyboard__action" data-type="done"><svg style="width: 36px"><use xlink:href="#iconKeyboardHide"></use></svg></button>
</div>
<div class="keyboard__util"></div>`;let n=0,a=0,i=!1;e.addEventListener("touchstart",s=>{n=s.touches[0].clientY,a=s.touches[0].clientX,i=!1}),e.addEventListener("touchmove",s=>{(Math.abs(s.touches[0].clientY-n)>10||Math.abs(s.touches[0].clientX-a)>10)&&(i=!0)}),e.addEventListener(isInAndroid()||isInHarmony()?"touchend":"click",s=>{var r;if(i)return;const o=(r=getCurrentEditor())==null?void 0:r.protyle,l=s.target,c=hasClosestByClassName(s.target,"keyboard__slash-item");if(c&&!c.getAttribute("data-type")){const h=decodeURIComponent(c.getAttribute("data-value"));if(h===Constants.ZWSP+3)return;o.hint.fill(h,o,!1),s.preventDefault(),s.stopPropagation(),c.getAttribute("data-focus")==="true"&&focusByRange(o.toolbar.range);return}const d=hasClosestByTag(l,"BUTTON");if(!d||d.getAttribute("disabled"))return;const u=d.getAttribute("data-type");if(["clear","style2","style4","color","backgroundColor","fontSize","style1"].includes(u)){const h=getFontNodeElements(o),m=d.firstElementChild;u==="style1"?fontEvent(o,h,u,m.style.backgroundColor+Constants.ZWSP+m.style.color):u==="fontSize"?fontEvent(o,h,u,m.textContent.trim()):u==="backgroundColor"?fontEvent(o,h,u,m.style.backgroundColor):u==="color"?fontEvent(o,h,u,m.style.color):fontEvent(o,h,u)}if(s.preventDefault(),s.stopPropagation(),getSelection().rangeCount===0)return;const g=getSelection().getRangeAt(0);if(u==="done"){e.clientHeight>100?(Rh(),focusByRange(g)):Qy();return}if(window.siyuan.config.readonly||!o||o.disabled)return;if(u==="undo"){o.undo.undo(o);return}else if(u==="redo"){o.undo.redo(o);return}if(getSelection().rangeCount===0)return;const f=hasClosestBlock(g.startContainer);if(f){if(u==="goback"){e.querySelector('.keyboard__action[data-type="goinline"]').classList.remove("protyle-toolbar__item--current");const h=document.querySelectorAll("#keyboardToolbar .keyboard__dynamic");h[0].classList.remove("fn__none"),h[1].classList.add("fn__none"),focusByRange(g),t=!0,setTimeout(()=>{t=!1},1e3);return}else if(u==="goinline"){d.classList.add("protyle-toolbar__item--current");const h=document.querySelectorAll("#keyboardToolbar .keyboard__dynamic");h[1].classList.remove("fn__none"),h[0].classList.add("fn__none"),focusByRange(g);return}else if(["a","block-ref","inline-math","inline-memo"].includes(u)){hasClosestByAttribute(g.startContainer,"data-type","NodeCodeBlock")||(hideElements(["util"],o),o.toolbar.element.querySelector(`[data-type="${u}"]`).dispatchEvent(new CustomEvent("click")));return}else if(d.classList.contains("keyboard__action")&&["strong","em","s","code","mark","tag","u","sup","clear","sub","kbd"].includes(u)){hasClosestByAttribute(g.startContainer,"data-type","NodeCodeBlock")||o.toolbar.setInlineMark(o,u,"toolbar");return}else if(u==="text"){if(d.classList.contains("protyle-toolbar__item--current"))Rh(),focusByRange(g);else{d.classList.add("protyle-toolbar__item--current"),e.querySelector('.keyboard__action[data-type="done"] use').setAttribute("xlink:href","#iconCloseRound");const h=o.contentElement.scrollTop;uS(o,e),Nv(h),window.JSAndroid&&window.JSAndroid.hideKeyboard&&window.JSAndroid.hideKeyboard()}return}else if(u==="moveup"){moveToUp(o,f,g),focusByRange(g);return}else if(u==="movedown"){moveToDown(o,f,g),focusByRange(g);return}else if(u==="softLine"){g.extractContents(),softEnter(g,f,o),focusByRange(g);return}else if(u==="add"){if(d.classList.contains("protyle-toolbar__item--current"))Rh(),focusByRange(g);else{d.classList.add("protyle-toolbar__item--current"),e.querySelector('.keyboard__action[data-type="done"] use').setAttribute("xlink:href","#iconCloseRound");const h=o.contentElement.scrollTop;vM(o,e),Nv(h),window.JSAndroid&&window.JSAndroid.hideKeyboard&&window.JSAndroid.hideKeyboard()}return}else if(u==="block"){o.gutter.renderMenu(o,f),window.siyuan.menus.menu.fullscreen(),Qy();return}else if(u==="outdent"){listOutdent(o,[f.parentElement],g),focusByRange(g);return}else if(u==="indent"){listIndent(o,[f.parentElement],g),focusByRange(g);return}}})},fS=()=>{document.getElementById("menu").style.transform="",document.getElementById("sidebar").style.transform="",document.getElementById("model").style.transform="";const t=document.querySelector(".side-mask");t.classList.add("fn__none"),t.style.opacity="",window.siyuan.menus.menu.remove()},kM=()=>{Qy(),document.getElementById("model").style.transform=""},$v=null,SM=t=>{var e;const n=getCurrentEditor().protyle;if((e=n.observerLoad)==null||e.disconnect(),window.siyuan.storage[Constants.LOCAL_DOCINFO]={id:t.id},setStorageVal(Constants.LOCAL_DOCINFO,window.siyuan.storage[Constants.LOCAL_DOCINFO]),hideElements(["toolbar","hint","util"],n),n.contentElement.classList.contains("fn__none")&&setEditMode(n,"wysiwyg"),n.notebookId=t.data.notebookId,n.path=t.data.path,t.data.startId===n.wysiwyg.element.firstElementChild.getAttribute("data-node-id")&&t.data.endId===n.wysiwyg.element.lastElementChild.getAttribute("data-node-id")){n.contentElement.scrollTo({top:t.scrollTop,behavior:"smooth"});return}t.id!==n.block.rootID&&fetchPost("/api/block/getDocInfo",{id:t.id},i=>{setTitle(i.data.name),n.title.setTitle(i.data.name),n.background.render(i.data.ial,n.block.rootID),n.wysiwyg.renderCustom(i.data.ial)});const a=n.breadcrumb.element.parentElement.querySelector('[data-type="exit-focus"]');if(t.zoomId){t.zoomId!==n.block.id?fetchPost("/api/block/checkBlockExist",{id:t.id},i=>{i.data&&zoomOut({protyle:n,id:t.id,isPushBack:!1,callback:()=>{n.contentElement.scrollTop=t.scrollTop}})}):n.contentElement.scrollTop=t.scrollTop,a.classList.remove("fn__none");return}fetchPost("/api/filetree/getDoc",{id:t.id,startID:t.data.startId,endID:t.data.endId},i=>{n.block.parentID=i.data.parentID,n.block.parent2ID=i.data.parent2ID,n.block.rootID=i.data.rootID,n.block.showAll=!1,n.block.mode=i.data.mode,n.block.blockCount=i.data.blockCount,n.block.id=i.data.id,n.block.action=t.callback,n.wysiwyg.element.setAttribute("data-doc-type",i.data.type),n.wysiwyg.element.innerHTML=i.data.content,processRender(n.wysiwyg.element),highlightRender(n.wysiwyg.element),avRender(n.wysiwyg.element,n),blockRender(n,n.wysiwyg.element,t.scrollTop),i.data.isSyncing?disabledForeverProtyle(n):setReadonlyByConfig(n,!0),n.contentElement.scrollTop=t.scrollTop,setTimeout(()=>{n.contentElement.scrollTop=t.scrollTop},Constants.TIMEOUT_LOAD),n.app.plugins.forEach(s=>{s.eventBus.emit("switch-protyle",{protyle:n}),s.eventBus.emit("loaded-protyle-static",{protyle:n})}),a.classList.add("fn__none")})},Ov=()=>{const t=Zy().protyle;t.wysiwyg.element.firstElementChild&&window.siyuan.backStack.push({id:t.block.showAll?t.block.id:t.block.rootID,data:{startId:t.wysiwyg.element.firstElementChild.getAttribute("data-node-id"),endId:t.wysiwyg.element.lastElementChild.getAttribute("data-node-id"),notebookId:t.notebookId,path:t.path},scrollTop:t.contentElement.scrollTop,callback:t.block.action,zoomId:t.block.showAll?t.block.id:void 0})},Az=()=>{const t=getCurrentEditor();if(window.siyuan.menus.menu.element.classList.contains("b3-menu--fullscreen")&&!window.siyuan.menus.menu.element.classList.contains("fn__none")){window.siyuan.menus.menu.element.dispatchEvent(new CustomEvent("click",{detail:"back"}));return}else if(document.getElementById("model").style.transform==="translateY(0px)"){const n=document.getElementById("searchAssetsPanel");!n||n.classList.contains("fn__none")?document.getElementById("model").style.transform="":n.classList.add("fn__none");return}else if(window.siyuan.viewer&&!window.siyuan.viewer.destroyed){window.siyuan.viewer.destroy();return}else if(document.getElementById("menu").style.transform==="translateX(0px)"||document.getElementById("sidebar").style.transform==="translateX(0px)"){closePanel();return}else if(t&&!t.protyle.toolbar.subElement.classList.contains("fn__none")){hideElements(["util"],t.protyle),closePanel();return}else if(window.siyuan.dialogs.length!==0){hideElements(["dialog"]),closePanel();return}if((window.JSAndroid||window.JSHarmony)&&window.siyuan.backStack.length<1){document.querySelector('#message [data-id="exitTip"]')?window.JSAndroid?window.JSAndroid.returnDesktop():window.JSHarmony&&window.JSHarmony.returnDesktop():showMessage(window.siyuan.languages.returnDesktop,3e3,"info","exitTip");return}if(window.siyuan.backStack.length<1)return;if($v.length===0&&t){const n=t.protyle;$v.push({id:n.block.showAll?n.block.id:n.block.rootID,data:{startId:n.wysiwyg.element.firstElementChild.getAttribute("data-node-id"),endId:n.wysiwyg.element.lastElementChild.getAttribute("data-node-id"),notebookId:n.notebookId,path:n.path},scrollTop:n.contentElement.scrollTop,callback:n.block.action,zoomId:n.block.showAll?n.block.id:void 0})}const e=window.siyuan.backStack.pop();$v.push(e),SM(e)};var AM=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const Af=(t,e,n)=>{if(!t){e.innerHTML="";return}ae("/api/template/render",{id:n,path:t,preview:!0},a=>{e.innerHTML=`<div class="protyle-wysiwyg" style="padding: 8px">${a.data.content.replace(/contenteditable="true"/g,"")}</div>`})},pS=(t,e,n=!0)=>{if(!t.getAttribute("data-type")||!e.getAttribute("data-type"))return!1;t.setAttribute("data-type",t.getAttribute("data-type").replace("search-mark","").trim()),e.setAttribute("data-type",e.getAttribute("data-type").replace("search-mark","").trim());const a=t.attributes;let i=!0;for(let s=0;s<a.length;s++)e.getAttribute(a[s].name)!==a[s].value&&(i=!1);return i&&(n?t.innerHTML=t.innerHTML+e.innerHTML:t.innerHTML=e.innerHTML+t.innerHTML,e.remove()),i},hS=t=>{let e=t.previousSibling;for(;e&&e.nodeType!==3&&pS(t,e,!1);)e=t.previousSibling;let n=t.nextSibling;for(;n&&n.nodeType!==3&&pS(t,n);)n=t.nextSibling;(t.getAttribute("data-type")||"").includes("search-mark")&&t.setAttribute("data-type",t.getAttribute("data-type").replace("search-mark","").trim())},Rv=(t,e,n)=>{const a=t.getAttribute("data-type").split(" ");if(a.length===1){const i=t.parentElement;t.outerHTML=t.innerHTML.replace(p.ZWSP,"")+"<wbr>",n&&cn(i,n)}else a.find((i,s)=>{if(e===i)return a.splice(s,1),!0}),t.setAttribute("data-type",a.join(" ")),e==="a"?t.removeAttribute("data-href"):e==="file-annotation-ref"?t.removeAttribute("data-id"):e==="block-ref"&&(t.removeAttribute("data-id"),t.removeAttribute("data-subtype")),n&&(n.selectNodeContents(t),n.collapse(!1),Pt(n))},e_=t=>{const e=[{name:"block-ref",hotkey:window.siyuan.config.keymap.editor.insert.ref.custom,lang:"ref",icon:"iconRef",tipPosition:"ne"},{name:"a",hotkey:window.siyuan.config.keymap.editor.insert.link.custom,lang:"link",icon:"iconLink",tipPosition:"n"},{name:"strong",lang:"bold",hotkey:window.siyuan.config.keymap.editor.insert.bold.custom,icon:"iconBold",tipPosition:"n"},{name:"em",lang:"italic",hotkey:window.siyuan.config.keymap.editor.insert.italic.custom,icon:"iconItalic",tipPosition:"n"},{name:"u",lang:"underline",hotkey:window.siyuan.config.keymap.editor.insert.underline.custom,icon:"iconUnderline",tipPosition:"n"},{name:"s",lang:"strike",hotkey:window.siyuan.config.keymap.editor.insert.strike.custom,icon:"iconStrike",tipPosition:"n"},{name:"mark",lang:"mark",hotkey:window.siyuan.config.keymap.editor.insert.mark.custom,icon:"iconMark",tipPosition:"n"},{name:"sup",lang:"sup",hotkey:window.siyuan.config.keymap.editor.insert.sup.custom,icon:"iconSup",tipPosition:"n"},{name:"sub",lang:"sub",hotkey:window.siyuan.config.keymap.editor.insert.sub.custom,icon:"iconSub",tipPosition:"n"},{name:"kbd",lang:"kbd",hotkey:window.siyuan.config.keymap.editor.insert.kbd.custom,icon:"iconKeymap",tipPosition:"n"},{name:"tag",lang:"tag",hotkey:window.siyuan.config.keymap.editor.insert.tag.custom,icon:"iconTags",tipPosition:"n"},{name:"code",lang:"inline-code",hotkey:window.siyuan.config.keymap.editor.insert["inline-code"].custom,icon:"iconInlineCode",tipPosition:"n"},{name:"inline-math",lang:"inline-math",hotkey:window.siyuan.config.keymap.editor.insert["inline-math"].custom,icon:"iconMath",tipPosition:"n"},{name:"inline-memo",lang:"memo",hotkey:window.siyuan.config.keymap.editor.insert.memo.custom,icon:"iconM",tipPosition:"n"},{name:"text",lang:"appearance",hotkey:window.siyuan.config.keymap.editor.insert.appearance.custom,icon:"iconFont",tipPosition:"n"},{name:"clear",lang:"clearInline",hotkey:window.siyuan.config.keymap.editor.insert.clearInline.custom,icon:"iconClear",tipPosition:"n"},{name:"|"}],n=[];return t.forEach(a=>{let i=a;e.find(s=>{if(typeof a=="string"&&s.name===a)return i=s,!0;if(typeof a=="object"&&s.name===a.name)return i=Object.assign({},s,a),!0}),n.push(i)}),n},Ja=(t,e)=>AM(void 0,null,function*(){let n="";for(let a=0;a<t.length;a++){const i=t[a];if(t.length>1&&(n+="- "),e==="ref"){const s=yield wn("/api/block/getRefText",{id:i});n+=`((${i} '${s.data}'))`}else if(e==="blockEmbed")n+=`{{select * from blocks where id='${i}'}}`;else if(e==="protocol")n+=`siyuan://blocks/${i}`;else if(e==="protocolMd"){const s=yield wn("/api/block/getRefText",{id:i});n+=`[${s.data}](siyuan://blocks/${i})`}else if(e==="hPath"){const s=yield wn("/api/filetree/getHPathByID",{id:i});n+=s.data}else e==="id"&&(n+=i);t.length>1&&a!==t.length-1&&(n+=`
`)}ut(n)});var TM=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const gS=(t,e,n)=>{if(Qe(window.siyuan.config.keymap.editor.general.netImg2LocalAsset.custom,e))return Iy(t,"Img"),e.preventDefault(),e.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.general.netAssets2LocalAssets.custom,e))return Iy(t,"Assets"),e.preventDefault(),e.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.general.optimizeTypography.custom,e))return ae("/api/format/autoSpace",{id:t.block.rootID}),e.preventDefault(),e.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.general.copyHPath.custom,e))return ae("/api/filetree/getHPathByID",{id:t.block.rootID},i=>{ut(i.data)}),e.preventDefault(),e.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.general.copyProtocolInMd.custom,e)){if(n){const i=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));i.length===0&&i.push(n),Ja(i.map(s=>s.getAttribute("data-node-id")),"protocolMd")}else Ja([t.block.rootID],"protocolMd");return e.preventDefault(),e.stopPropagation(),!0}if(Qe(window.siyuan.config.keymap.editor.general.copyID.custom,e)){if(n){const i=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));i.length===0&&i.push(n),Ja(i.map(s=>s.getAttribute("data-node-id")),"id")}else Ja([t.block.rootID],"id");return e.preventDefault(),e.stopPropagation(),!0}if(Qe(window.siyuan.config.keymap.editor.general.copyProtocol.custom,e)){if(n){const i=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));i.length===0&&i.push(n),Ja(i.map(s=>s.getAttribute("data-node-id")),"protocol")}else Ja([t.block.rootID],"protocol");return e.preventDefault(),e.stopPropagation(),!0}if(Qe(window.siyuan.config.keymap.editor.general.copyBlockEmbed.custom,e)){if(n){const i=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));i.length===0&&i.push(n),Ja(i.map(s=>s.getAttribute("data-node-id")),"blockEmbed")}else Ja([t.block.rootID],"blockEmbed");return e.preventDefault(),e.stopPropagation(),!0}let a=!1;if(t.app.plugins.find(i=>{if(i.commands.find(s=>{if(s.editorCallback&&Qe(s.customHotkey,e))return a=!0,s.editorCallback(t),!0}),a)return!0}),a)return!0},mS=t=>{const e=t.protyle.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(e.length>0)t.event.stopPropagation(),t.event.preventDefault();else{const i=A(t.range.startContainer,"TD")||A(t.range.startContainer,"TH")||Ee(t.nodeElement)||t.nodeElement,s=ya(i,t.editorElement,t.range).start,r=i.innerText,o=Qe(window.siyuan.config.keymap.editor.general.expandUp.custom,t.event);if(!(!Jt()&&o)){if(s>0){r.substr(0,s).indexOf(`
`)===-1&&t.range.getBoundingClientRect().top-i.getBoundingClientRect().top-parseInt(getComputedStyle(i).paddingTop)<14&&(uu(i,t.range),t.event.preventDefault());return}}}t.range.collapse(!0),Ut(["toolbar"],t.protyle),e.length===0?t.nodeElement.classList.add("protyle-wysiwyg--select"):t.cb(e);const n=[];t.protyle.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select").forEach(a=>{n.push(a.getAttribute("data-node-id"))}),ss(n,t.protyle.block.rootID),t.event.stopPropagation(),t.event.preventDefault()},bS=t=>{const e=t.protyle.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(e.length>0)t.event.stopPropagation(),t.event.preventDefault();else{const a=A(t.range.startContainer,"TD")||A(t.range.startContainer,"TH"),i=a||Ee(t.nodeElement)||t.nodeElement,s=ya(i,t.editorElement,t.range).end,r=i.innerText,o=Qe(window.siyuan.config.keymap.editor.general.expandDown.custom,t.event);if(!(!Jt()&&o)){if(s<r.length){!Fe(t.nodeElement)&&r.trimRight().substr(s).indexOf(`
`)===-1&&i.getBoundingClientRect().bottom-t.range.getBoundingClientRect().bottom-parseInt(getComputedStyle(i).paddingBottom)<14?(qa(i,t.range,!1),t.nodeElement.classList.contains("code-block")&&o&&t.event.preventDefault()):a&&(qa(a,t.range,!1),t.event.preventDefault());return}}}t.range.collapse(!1),Ut(["toolbar"],t.protyle),e.length===0?t.nodeElement.classList.add("protyle-wysiwyg--select"):t.cb(e);const n=[];t.protyle.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select").forEach(a=>{n.push(a.getAttribute("data-node-id"))}),ss(n,t.protyle.block.rootID),t.event.stopPropagation(),t.event.preventDefault()},t_=t=>{let e,n;return t.forEach(a=>{a.getAttribute("select-start")&&(e=a),a.getAttribute("select-end")&&(n=a)}),e||(e=t[0],e.setAttribute("select-start","true")),n||(n=t[t.length-1],n.setAttribute("select-end","true")),{startElement:e,endElement:n}},n_=(t,e)=>TM(void 0,null,function*(){var n;let a;const i=[],s=[];let r,o=t[t.length-1],l=!0;o.classList.contains("li")&&(o.getAttribute("data-subtype")==="o"&&(r=parseInt(o.getAttribute("data-marker"),10)),t.find(u=>{if(!u.classList.contains("li")||o.getAttribute("data-subtype")!==u.getAttribute("data-subtype"))return l=!1,!0}),l||(o=me(o,"list")||o));let c="";const d=[];for(let u=t.length-1;u>=0;--u){const g=t[u];g.classList.remove("protyle-wysiwyg--select");let f=g.cloneNode(!0);const h=Lute.NewNodeID();if(g.getAttribute("data-type")!=="NodeBlockQueryEmbed"&&g.querySelector('[data-type="NodeHeading"][fold="1"]')){const m=yield wn("/api/block/getBlockDOM",{id:g.getAttribute("data-node-id")}),b=document.createElement("template");b.innerHTML=m.data.dom,f=b.content.firstElementChild}if(g.getAttribute("data-type")==="NodeListItem"&&!l)if(c||(c=`<div class="protyle-attr" contenteditable="false">${p.ZWSP}</div></div>`),c=vd(g)+c,u===0||t[u-1].getAttribute("data-type")!=="NodeListItem"||t[u-1].getAttribute("data-subtype")!==g.getAttribute("data-subtype")){const m=document.createElement("template");m.innerHTML=`<div data-subtype="${g.getAttribute("data-subtype")}" data-node-id="${Lute.NewNodeID()}" data-type="NodeList" class="list">${c}`,f=m.content.firstElementChild,c=""}else continue;if(u===t.length-1&&(a=f),f.setAttribute("data-node-id",h),f.removeAttribute(p.CUSTOM_RIFF_DECKS),f.classList.remove("protyle-wysiwyg--hl"),f.setAttribute("updated",h.split("-")[0]),f.removeAttribute("refcount"),(n=f.lastElementChild.querySelector(".protyle-attr--refcount"))==null||n.remove(),f.querySelectorAll("[data-node-id]").forEach(m=>{var b;const y=Lute.NewNodeID();m.setAttribute("data-node-id",y),m.removeAttribute(p.CUSTOM_RIFF_DECKS),m.classList.remove("protyle-wysiwyg--hl"),m.setAttribute("updated",y.split("-")[0]),m.removeAttribute("refcount"),(b=m.lastElementChild.querySelector(".protyle-attr--refcount"))==null||b.remove()}),typeof r=="number"){const m=r+u+1;f.setAttribute("data-marker",m+"."),f.querySelector(".protyle-action--order").textContent=m+"."}if(o.after(Ji(f)),i.push({action:"insert",data:f.outerHTML,id:h,previousID:o.getAttribute("data-node-id")}),s.push({action:"delete",id:h}),g.getAttribute("data-type")==="NodeHeading"&&g.getAttribute("fold")==="1"){d.push({oldId:g.getAttribute("data-node-id"),newId:h});const m=yield wn("/api/block/getHeadingChildrenDOM",{id:g.getAttribute("data-node-id")}),b=document.createElement("template");b.innerHTML=m.data,Array.from(b.content.children).reverse().forEach((y,_)=>{if(_===b.content.children.length-1)return;y.querySelectorAll("[data-node-id]").forEach(U=>{U.setAttribute("data-node-id",Lute.NewNodeID()),U.removeAttribute(p.CUSTOM_RIFF_DECKS),U.removeAttribute("refcount")});const v=Lute.NewNodeID();y.setAttribute("data-node-id",v),y.removeAttribute(p.CUSTOM_RIFF_DECKS),y.removeAttribute("refcount"),i.push({context:{ignoreProcess:"true"},action:"insert",data:y.outerHTML,id:v,previousID:h}),s.push({action:"delete",id:v})})}}if(e.wysiwyg.element.querySelectorAll("[parent-heading]").forEach(u=>{u.remove()}),typeof r=="number"){let u=a.nextElementSibling;for(r=r+t.length;u&&u.getAttribute("data-subtype")==="o";){r++;const g=u.getAttribute("data-node-id");s.push({action:"update",id:g,data:u.outerHTML}),u.setAttribute("data-marker",r+"."),u.querySelector(".protyle-action--order").textContent=r+".",i.push({action:"update",data:u.outerHTML,id:g}),u=u.nextElementSibling}}et(e,i,s),qt(a),kn(e)}),Uv=t=>{t.wysiwyg.element.firstElementChild.getAttribute("data-node-index")==="0"||t.wysiwyg.element.firstElementChild.getAttribute("data-eof")==="1"||t.options.backlinkData?(qt(t.wysiwyg.element.firstElementChild),t.contentElement.scrollTop=0,t.scroll.lastScrollTop=1):ae("/api/filetree/getDoc",{id:t.block.rootID,mode:0,size:window.siyuan.config.editor.dynamicLoadBlocks},e=>{_a({data:e,protyle:t,action:[p.CB_GET_FOCUS]})})},yS=t=>{!t.scroll.element.classList.contains("fn__none")&&t.wysiwyg.element.lastElementChild.getAttribute("data-eof")!=="2"?ae("/api/filetree/getDoc",{id:t.block.rootID,mode:4,size:window.siyuan.config.editor.dynamicLoadBlocks},e=>{_a({data:e,protyle:t,action:[p.CB_GET_FOCUS],afterCB(){qt(t.wysiwyg.element.lastElementChild,void 0,!1)}})}):(t.contentElement.scrollTop=t.contentElement.scrollHeight,t.scroll.lastScrollTop=t.contentElement.scrollTop,qt(t.wysiwyg.element.lastElementChild,void 0,!1))},_S=(t,e,n,a,i)=>{e.setAttribute("updated",at().format("YYYYMMDDHHmmss")),n.forEach(s=>{s.style.minWidth="calc(100% - 0.1em)"}),Ht(t,a,e.outerHTML,i)},wS=(t,e,n,a,i)=>{e.setAttribute("updated",at().format("YYYYMMDDHHmmss")),n.forEach(s=>{s.removeAttribute("style")}),Ht(t,a,e.outerHTML,i)},Nr=(t,e)=>t?`<span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt(t)}</span>`:e?`<span class="b3-list-item__meta">${e}</span>`:"",Hv=(t,e)=>{const n=[{filter:[window.siyuan.languages.template,"template","\u6A21\u677F","moban","muban","mb"],id:"template",value:p.ZWSP,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconMarkdown"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.template}</span></div>`},{filter:[window.siyuan.languages.widget,"widget","\u6302\u4EF6","guajian","gj"],id:"widget",value:p.ZWSP+1,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconBoth"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.widget}</span></div>`},{filter:[window.siyuan.languages.assets,"assets","\u8D44\u6E90","ziyuan","zy"],id:"assets",value:p.ZWSP+2,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconImage"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.assets}</span></div>`},{filter:[window.siyuan.languages.ref,"block reference","\u5757\u5F15\u7528","kuaiyinyong","kyy"],id:"ref",value:"((",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconRef"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.ref}</span><span class="b3-list-item__meta">((</span></div>`},{filter:[window.siyuan.languages.blockEmbed,"embed block","\u5D4C\u5165\u5757","qianrukuai","qrk"],id:"blockEmbed",value:"{{",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconSQL"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.blockEmbed}</span><span class="b3-list-item__meta">{{</span></div>`},{filter:[window.siyuan.languages.aiWriting,"ai writing","ai\u7F16\u5199","aibianxie","aibx","\u4EBA\u5DE5\u667A\u80FD","rengongzhineng","rgzn"],id:"aiWriting",value:p.ZWSP+5,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconSparkles"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.aiWriting}</span>${Nr(window.siyuan.config.keymap.editor.general.aiWriting.custom,"")}</div>`},{filter:[window.siyuan.languages.database,"database","db","\u6570\u636E\u5E93","shujuku","sjk","\u89C6\u56FE","view"],id:"database",value:'<div data-type="NodeAttributeView" data-av-type="table"></div>',html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconDatabase"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.database}</span></div>`},{filter:[window.siyuan.languages.newFileRef,"create new doc with reference","\u65B0\u5EFA\u6587\u6863\u5E76\u5F15\u7528","xinjianwendangbingyinyong","xjwdbyy"],id:"newFileRef",value:p.ZWSP+4,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconFile"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.newFileRef}</span></div>`},{filter:[window.siyuan.languages.newSubDocRef,"create sub doc with reference","\u65B0\u5EFA\u5B50\u6587\u6863\u5E76\u5F15\u7528","xinjianziwendangbingyinyong","xjzwdbyy"],id:"newSubDocRef",value:p.ZWSP+6,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconFile"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.newSubDocRef}</span></div>`},{value:"",id:"separator_1",html:"separator"},{filter:[window.siyuan.languages.heading1,"heading1","h1","\u4E00\u7EA7\u6807\u9898","yijibiaoti","yjbt"],id:"heading1",value:"# "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconH1"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.heading1}</span>${Nr(window.siyuan.config.keymap.editor.heading.heading1.custom,"# ")}</div>`},{filter:[window.siyuan.languages.heading2,"heading2","h2","\u4E8C\u7EA7\u6807\u9898","erjibiaoti","ejbt"],id:"heading2",value:"## "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconH2"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.heading2}</span>${Nr(window.siyuan.config.keymap.editor.heading.heading2.custom,"## ")}</div>`},{filter:[window.siyuan.languages.heading3,"heading3","h3","\u4E09\u7EA7\u6807\u9898","sanjibiaoti","sjbt"],id:"heading3",value:"### "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconH3"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.heading3}</span>${Nr(window.siyuan.config.keymap.editor.heading.heading3.custom,"### ")}</div>`},{filter:[window.siyuan.languages.heading4,"heading4","h4","\u56DB\u7EA7\u6807\u9898","sijibiaoti","sjbt"],id:"heading4",value:"#### "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconH4"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.heading4}</span>${Nr(window.siyuan.config.keymap.editor.heading.heading4.custom,"#### ")}</div>`},{filter:[window.siyuan.languages.heading5,"heading5","h5","\u4E94\u7EA7\u6807\u9898","wujibiaoti","wjbt"],id:"heading5",value:"##### "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconH5"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.heading5}</span>${Nr(window.siyuan.config.keymap.editor.heading.heading5.custom,"##### ")}</div>`},{filter:[window.siyuan.languages.heading6,"heading6","h6","\u516D\u7EA7\u6807\u9898","liujibiaoti","ljbt"],id:"heading6",value:"###### "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconH6"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.heading6}</span>${Nr(window.siyuan.config.keymap.editor.heading.heading6.custom,"###### ")}</div>`},{filter:[window.siyuan.languages.list,"unordered list","\u65E0\u5E8F\u5217\u8868","wuxvliebiao","wuxuliebiao","wxlb"],id:"list",value:"- "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconList"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.list}</span>${Nr(window.siyuan.config.keymap.editor.insert.list.custom,"- ")}</div>`},{filter:[window.siyuan.languages["ordered-list"],"order list","ordered list","\u6709\u5E8F\u5217\u8868","youxvliebiao","youxuliebiao","yxlb"],id:"orderedList",value:"1. "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconOrderedList"></use></svg><span class="b3-list-item__text">${window.siyuan.languages["ordered-list"]}</span>${Nr(window.siyuan.config.keymap.editor.insert["ordered-list"].custom,"1. ")}</div>`},{filter:[window.siyuan.languages.check,"task list","todo list","\u4EFB\u52A1\u5217\u8868","renwuliebiao","rwlb"],id:"check",value:"- [ ] "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconCheck"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.check}</span>${Nr(window.siyuan.config.keymap.editor.insert.check.custom,"[]")}</div>`},{filter:[window.siyuan.languages.quote,"blockquote","bq","\u5F15\u8FF0","yinshu","ys"],id:"quote",value:"> "+Lute.Caret,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconQuote"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.quote}</span>${Nr(window.siyuan.config.keymap.editor.insert.quote.custom,">")}</div>`},{filter:[window.siyuan.languages.code,"code block","\u4EE3\u7801\u5757","daimakuai","dmk"],id:"code",value:"```",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconCode"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.code}</span>${Nr(window.siyuan.config.keymap.editor.insert.code.custom,"```"+window.siyuan.languages.enterKey)}</div>`},{filter:[window.siyuan.languages.table,"table","\u8868\u683C","biaoge","bg"],id:"table",value:`| ${Lute.Caret} |  |  |
| --- | --- | --- |
|  |  |  |
|  |  |  |`,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconTable"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.table}</span><span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt(window.siyuan.config.keymap.editor.insert.table.custom)}</span></div>`},{filter:[window.siyuan.languages.line,"thematic break","divider","\u5206\u9694\u7EBF","\u5206\u5272\u7EBF","fengexian","fgx"],id:"line",value:"---",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconLine"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.line}</span><span class="b3-list-item__meta">---</span></div>`},{filter:[window.siyuan.languages.math,"formulas block","math block","\u6570\u5B66\u516C\u5F0F\u5757","shuxuegongshikuai","sxgsk"],id:"math",value:"$$",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconMath"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.math}</span><span class="b3-list-item__meta">$$</span></div>`},{filter:["html"],id:"html",value:"<div>",html:'<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconHTML5"></use></svg><span class="b3-list-item__text">HTML</span></div>'},{value:"",id:"separator_2",html:"separator"},{filter:[window.siyuan.languages.emoji,"emoji","\u8868\u60C5","biaoqing","bq"],id:"emoji",value:"emoji",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconEmoji"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.emoji}</span><span class="b3-list-item__meta">:</span></div>`},{filter:[window.siyuan.languages.link,"link","a","\u94FE\u63A5","lianjie","lj"],id:"link",value:"a",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconLink"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.link}</span><span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt(window.siyuan.config.keymap.editor.insert.link.custom)}</span></div>`},{filter:[window.siyuan.languages.bold,"bold","strong","\u7C97\u4F53","cuti","ct","\u52A0\u7C97","jiacu","jc"],id:"bold",value:"strong",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconBold"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.bold}</span><span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt(window.siyuan.config.keymap.editor.insert.bold.custom)}</span></div>`},{filter:[window.siyuan.languages.italic,"italic","em","\u659C\u4F53","xieti","xt"],id:"italic",value:"em",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconItalic"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.italic}</span><span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt(window.siyuan.config.keymap.editor.insert.italic.custom)}</span></div>`},{filter:[window.siyuan.languages.underline,"underline","\u4E0B\u5212\u7EBF","xiahuaxian","xhx"],id:"underline",value:"u",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconUnderline"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.underline}</span><span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt(window.siyuan.config.keymap.editor.insert.underline.custom)}</span></div>`},{filter:[window.siyuan.languages.strike,"strike","delete","\u5220\u9664\u7EBF","shanchuxian","scx"],id:"strike",value:"s",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconStrike"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.strike}</span><span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt(window.siyuan.config.keymap.editor.insert.strike.custom)}</span></div>`},{filter:[window.siyuan.languages.mark,"mark","\u6807\u8BB0","biaoji","bj","\u9AD8\u4EAE","gaoliang","gl"],id:"mark",value:"mark",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconMark"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.mark}</span><span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt(window.siyuan.config.keymap.editor.insert.mark.custom)}</span></div>`},{filter:[window.siyuan.languages.sup,"superscript","\u4E0A\u6807","shangbiao","sb"],id:"sup",value:"sup",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconSup"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.sup}</span><span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt(window.siyuan.config.keymap.editor.insert.sup.custom)}</span></div>`},{filter:[window.siyuan.languages.sub,"subscript","\u4E0B\u6807","xiaobiao","xb"],id:"sub",value:"sub",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconSub"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.sub}</span><span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt(window.siyuan.config.keymap.editor.insert.sub.custom)}</span></div>`},{filter:[window.siyuan.languages["inline-code"],"inline code","\u884C\u7EA7\u4EE3\u7801","hangjidaima","hjdm"],id:"inlineCode",value:"code",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconInlineCode"></use></svg><span class="b3-list-item__text">${window.siyuan.languages["inline-code"]}</span><span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt(window.siyuan.config.keymap.editor.insert["inline-code"].custom)}</span></div>`},{filter:[window.siyuan.languages.kbd,"kbd","\u952E\u76D8","jianpan","jp"],id:"kbd",value:"kbd",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconKeymap"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.kbd}</span><span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt(window.siyuan.config.keymap.editor.insert.kbd.custom)}</span></div>`},{filter:[window.siyuan.languages.tag,"tags","\u6807\u7B7E","biaoqian","bq"],id:"tag",value:"tag",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconTags"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.tag}</span><span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt(window.siyuan.config.keymap.editor.insert.tag.custom)}</span></div>`},{filter:[window.siyuan.languages["inline-math"],"inline formulas","inline math","\u884C\u7EA7\u516C\u5F0F","hangjigongshi","hjgs","\u884C\u7EA7\u6570\u5B66\u516C\u5F0F","hangjishuxvegongshi","hangjishuxuegongshi","hjsxgs"],id:"inlineMath",value:"inline-math",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconMath"></use></svg><span class="b3-list-item__text">${window.siyuan.languages["inline-math"]}</span><span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt(window.siyuan.config.keymap.editor.insert["inline-math"].custom)}</span></div>`},{value:"",id:"separator_3",html:"separator"},{filter:[window.siyuan.languages.insertAsset,"insert image or file","upload","\u63D2\u5165\u56FE\u7247\u6216\u6587\u4EF6","charutupianhuowenjian","crtphwj","\u4E0A\u4F20","sc"],id:"insertAsset",value:p.ZWSP+3,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconDownload"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.insertAsset}</span>
<input class="b3-form__upload" type="file" ${e.options.upload.accept?'multiple="'+e.options.upload.accept+'"':""}></div>`},{filter:[window.siyuan.languages.insertIframeURL,"insert iframe link","\u63D2\u5165 iframe \u94FE\u63A5","charuiframelianjie","criframelj"],id:"insertIframeURL",value:'<iframe sandbox="allow-forms allow-presentation allow-same-origin allow-scripts allow-modals allow-popups" src="" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>',html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconLanguage"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.insertIframeURL}</span></div>`},{filter:[window.siyuan.languages.insertImgURL,"insert image link","image","img","\u63D2\u5165\u56FE\u7247\u94FE\u63A5","charutupianlianjie","crtplj"],id:"insertImgURL",value:"![]()",html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconImage"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.insertImgURL}</span></div>`},{filter:[window.siyuan.languages.insertVideoURL,"insert video link","\u63D2\u5165\u89C6\u9891\u94FE\u63A5","charushipinlianjie","crsplj"],id:"insertVideoURL",value:'<video controls="controls" src=""></video>',html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconVideo"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.insertVideoURL}</span></div>`},{filter:[window.siyuan.languages.insertAudioURL,"insert audio link","\u63D2\u5165\u97F3\u9891\u94FE\u63A5","charuyinpinlianjie","cryplj"],id:"insertAudioURL",value:'<audio controls="controls" src=""></audio>',html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconRecord"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.insertAudioURL}</span></div>`},{value:"",id:"separator_4",html:"separator"},{filter:[window.siyuan.languages.staff,"staff","\u4E94\u7EBF\u8C31","wuxianpu","wxp"],id:"staff",value:"```abc\n```",html:`<div class="b3-list-item__first"><span class="b3-list-item__text">ABC</span><span class="b3-list-item__meta">${window.siyuan.languages.staff}</span></div>`},{filter:[window.siyuan.languages.chart,"chart","\u56FE\u8868","tubiao","tb"],id:"chart",value:"```echarts\n```",html:`<div class="b3-list-item__first"><span class="b3-list-item__text">Chart</span><span class="b3-list-item__meta">${window.siyuan.languages.chart}</span></div>`},{filter:["flowchart","flow chart","\u6D41\u7A0B\u56FE","liuchengtu","lct"],id:"flowChart",value:"```flowchart\n```",html:'<div class="b3-list-item__first"><span class="b3-list-item__text">FlowChart</span><span class="b3-list-item__meta">Flow Chart</span></div>'},{filter:["graphviz","\u72B6\u6001\u56FE","zhuangtaitu","ztt"],id:"graph",value:"```graphviz\n```",html:'<div class="b3-list-item__first"><span class="b3-list-item__text">Graphviz</span><span class="b3-list-item__meta">Graph</span></div>'},{filter:["mermaid","diagram","\u56FE\u8868","tubiao","tb"],id:"mermaid",value:"```mermaid\n```",html:'<div class="b3-list-item__first"><span class="b3-list-item__text">Mermaid</span><span class="b3-list-item__meta">Mermaid</span></div>'},{filter:[window.siyuan.languages.mindmap,"mindmap","\u8111\u56FE","naotu","nt"],id:"mindmap",value:"```mindmap\n```",html:`<div class="b3-list-item__first"><span class="b3-list-item__text">Mind map</span><span class="b3-list-item__meta">${window.siyuan.languages.mindmap}</span></div>`},{filter:["plantuml","\u5EFA\u6A21\u8BED\u8A00","jianmoyuyan","jmyy"],id:"UML",value:"```plantuml\n```",html:'<div class="b3-list-item__first"><span class="b3-list-item__text">PlantUML</span><span class="b3-list-item__meta">UML</span></div>'},{value:"",id:"separator_5",html:"separator"},{filter:[window.siyuan.languages.infoStyle,"info style","\u4FE1\u606F\u6837\u5F0F","xinxiyangshi","xxys"],id:"infoStyle",value:`style${p.ZWSP}color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);`,html:`<div class="b3-list-item__first"><div style="color: var(--b3-card-info-color);background-color: var(--b3-card-info-background);" class="color__square color__square--list">A</div><span class="b3-list-item__text">${window.siyuan.languages.infoStyle}</span></div>`},{filter:[window.siyuan.languages.successStyle,"success style","\u6210\u529F\u6837\u5F0F","chenggongyangshi","cgys"],id:"successStyle",value:`style${p.ZWSP}color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);`,html:`<div class="b3-list-item__first"><div style="color: var(--b3-card-success-color);background-color: var(--b3-card-success-background);" class="color__square color__square--list">A</div><span class="b3-list-item__text">${window.siyuan.languages.successStyle}</span></div>`},{filter:[window.siyuan.languages.warningStyle,"warning style","\u8B66\u544A\u6837\u5F0F","jinggaoyangshi","jgys"],id:"warningStyle",value:`style${p.ZWSP}color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);`,html:`<div class="b3-list-item__first"><div style="color: var(--b3-card-warning-color);background-color: var(--b3-card-warning-background);" class="color__square color__square--list">A</div><span class="b3-list-item__text">${window.siyuan.languages.warningStyle}</span></div>`},{filter:[window.siyuan.languages.errorStyle,"error style","\u9519\u8BEF\u6837\u5F0F","cuowuyangshi","cwys"],id:"errorStyle",value:`style${p.ZWSP}color: var(--b3-card-error-color);background-color: var(--b3-card-error-background);`,html:`<div class="b3-list-item__first"><div style="color: var(--b3-card-error-color);background-color: var(--b3-card-error-background);" class="color__square color__square--list">A</div><span class="b3-list-item__text">${window.siyuan.languages.errorStyle}</span></div>`},{filter:[window.siyuan.languages.clearFontStyle,"clear style","\u6E05\u9664\u6837\u5F0F","qingchuyangshi","qcys"],id:"clearFontStyle",value:`style${p.ZWSP}`,html:`<div class="b3-list-item__first"><div class="color__square color__square--list">A</div><span class="b3-list-item__text">${window.siyuan.languages.clearFontStyle}</span></div>`},{value:"",id:"separator_6",html:"separator"}];let a=!1;return e.app.plugins.forEach(i=>{i.protyleSlash.forEach(s=>{n.push({filter:s.filter,id:s.id,value:`plugin${p.ZWSP}${i.name}${p.ZWSP}${s.id}`,html:s.html}),a=!0})}),a||n.pop(),t===""?n:n.filter(i=>i.filter?!!i.filter.find(r=>{if(r.toLowerCase().indexOf(t.toLowerCase())>-1)return!0}):!1)},DM=(t,e)=>(e.hint.genLoading(e),ae("/api/search/searchTag",{k:t},n=>{const a=[];let i=!1;n.data.tags.forEach(s=>{const r=s.replace(/<mark>/g,"").replace(/<\/mark>/g,"");a.push({value:`<span data-type="tag">${r}</span>`,html:`<div class="b3-list-item__text">${s}</div>`}),r===n.data.k&&(i=!0)}),n.data.k&&!i&&(a.splice(0,0,{value:`<span data-type="tag">${n.data.k}</span>`,html:`<div class="b3-list-item__text">${window.siyuan.languages.newTag} <mark>${he(n.data.k)}</mark></div>`}),a.length>1&&(a[1].focus=!0)),e.hint.genHTML(a,e,!0,"hint")}),[]),qv=t=>{let e;t.type==="NodeDocument"&&t.ial.icon?(e=Yt(t.ial.icon,"b3-list-item__graphic popover__block",!0),e=e.replace('popover__block"',`popover__block" data-id="${t.id}"`)):e=`<svg class="b3-list-item__graphic popover__block" data-id="${t.id}"><use xlink:href="#${Qi(t.type)}"></use></svg>`;let n="";t.name&&(n+=`<span class="fn__flex"><svg class="b3-list-item__hinticon"><use xlink:href="#iconN"></use></svg><span>${t.name}</span></span><span class="fn__space"></span>`),t.alias&&(n+=`<span class="fn__flex"><svg class="b3-list-item__hinticon"><use xlink:href="#iconA"></use></svg><span>${t.alias}</span></span><span class="fn__space"></span>`),t.memo&&(n+=`<span class="fn__flex"><svg class="b3-list-item__hinticon"><use xlink:href="#iconM"></use></svg><span>${t.memo}</span></span>`),n&&(n=`<div class="fn__flex b3-list-item__meta b3-list-item__showall">${n}</div>`);let a="";return t.refCount&&(a=`<span class="popover__block counter b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.ref}">${t.refCount}</span>`),`${n}<div class="b3-list-item__first" data-node-id="${t.id}">
    ${e}
    <span class="b3-list-item__text">${t.content}</span>${a}
</div>
<div class="b3-list-item__meta b3-list-item__showall">${t.hPath}</div>`},ic=(t,e,n)=>{const a=oe(hn(e.wysiwyg.element).startContainer);return e.hint.genLoading(e),ae("/api/search/searchRefBlock",{k:t,id:a?a.getAttribute("data-node-id"):e.block.parentID,beforeLen:Math.floor((Math.max(e.element.clientWidth/2,320)-58)/28.8),rootID:n==="av"?"":e.block.rootID,isDatabase:n==="av",isSquareBrackets:["[[","\u3010\u3010"].includes(e.hint.splitChar)},i=>{const s=[];if(i.data.newDoc){const r=Lute.UnEscapeHTMLStr(Wi(i.data.k));s.push({value:`((newFile "${r}"${p.ZWSP}'${r}${Lute.Caret}'))`,html:`<div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconFile"></use></svg>
<span class="b3-list-item__text">${window.siyuan.languages.newFile} <mark>${i.data.k}</mark></span></div>`})}i.data.blocks.forEach(r=>{let o=`<span data-type="block-ref" data-id="${r.id}" data-subtype="d">${r.name||r.refText.replace(new RegExp(p.ZWSP,"g"),"")}</span>`;if(n==="search")o=`<span data-type="block-ref" data-id="${r.id}" data-subtype="s">${t}${p.ZWSP}${r.name||r.refText.replace(new RegExp(p.ZWSP,"g"),"")}</span>`;else if(n==="av"){let l=r.name||r.refText.replace(new RegExp(p.ZWSP,"g"),"");a&&(l=r.ial["custom-sy-av-s-text-"+a.getAttribute("data-av-id")]||l),o=`<span data-type="block-ref" data-id="${r.id}" data-subtype="s">${l}</span>`}s.push({value:o,html:qv(r)})}),n==="search"&&(e.hint.splitChar="((",e.hint.lastIndex=-1),s.length===0?s.push({value:"",html:window.siyuan.languages.emptyContent}):i.data.newDoc&&s.length>1&&(s[1].focus=!0),e.hint.genHTML(s,e,!0,n)}),[]},Tf=(t,e)=>{if(t.endsWith("}}")||t.endsWith("\u300D\u300D"))return[];e.hint.genLoading(e);const n=oe(hn(e.wysiwyg.element).startContainer);return ae("/api/search/searchRefBlock",{k:t,isDatabase:!1,beforeLen:Math.floor((Math.max(e.element.clientWidth/2,320)-58)/28.8),id:n?n.getAttribute("data-node-id"):e.block.parentID,rootID:e.block.rootID},a=>{const i=[];a.data.blocks.forEach(s=>{i.push({value:`{{select * from blocks where id='${s.id}'}}`,html:qv(s)})}),i.length===0&&i.push({value:"",html:window.siyuan.languages.emptyContent}),e.hint.genHTML(i,e,!0,"hint")}),[]},vS=(t,e,n)=>{ae("/api/template/render",{id:e.block.parentID,path:t},a=>{Pt(e.toolbar.range);const i=Ee(n);i&&i.textContent.trim()===""?Aa(a.data.content,e,!0):Aa(a.data.content,e),e.wysiwyg.element.querySelectorAll('[status="temp"]').forEach(s=>{s.remove()}),$n(e,e.wysiwyg.element),zn(e.wysiwyg.element),ra(e.wysiwyg.element),Ua(e.wysiwyg.element,e),Ut(["util"],e)})},xS=(t,e)=>{Pt(e.toolbar.range),Aa(e.lute.SpinBlockDOM(`<iframe src="/widgets/${t}/" data-subtype="widget" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>`),e,!0),Ut(["util"],e)},ES=(t,e)=>{Pt(e.toolbar.range);const n=_n().extname(t).toLowerCase(),a=t.startsWith("assets/")?pd(t):t;Aa(aS(n,t,a,t.startsWith("assets/")?a+n:t),e),Ut(["util"],e)},Wv=(t,e,n)=>{if(t==="/")return;const a=ha(t,!0,!0);if(n.block.rootID===a)return;const i=[];let s;const r=e[0].parentElement;let o;if(e.forEach((l,c)=>{c===e.length-1&&l.parentElement&&(s=It(l),o=s.nextElementSibling||s.previousElementSibling,s===l&&(s=void 0)),i.push({action:"append",id:l.getAttribute("data-node-id"),parentID:a}),l.remove()}),s)i.push({action:"delete",id:s.getAttribute("data-node-id")}),s.remove();else if(r.classList.contains("list")&&r.getAttribute("data-subtype")==="o"&&r.childElementCount>1)xa(r,1),Array.from(r.children).forEach(l=>{l.classList.contains("protyle-attr")||i.push({action:"update",id:l.getAttribute("data-node-id"),data:l.outerHTML})});else if(n.block.showAll&&r.classList.contains("protyle-wysiwyg")&&r.childElementCount===0)setTimeout(()=>{hi({protyle:n,id:n.block.parent2ID,focusId:n.block.parent2ID})},p.TIMEOUT_INPUT*2+100);else if(r.classList.contains("protyle-wysiwyg")&&r.innerHTML===""&&!N(r,"block__edit",!0)&&n.block.id===n.block.rootID){const l=Lute.NewNodeID(),c=Fs(!1,!1,l);i.splice(0,0,{action:"insert",id:l,data:c.outerHTML,parentID:n.block.parentID}),r.innerHTML=c.outerHTML,qt(c)}else o&&qt(o);et(n,i)},Fd=t=>{t.style.minWidth?t.style.width="":t.removeAttribute("style")};var kS=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const Vv=(t,e,n,a=[])=>{ae("/api/search/searchAsset",{k:e,exts:a},i=>{let s="";i.data.forEach((c,d)=>{s+=`<div data-value="${c.path}" class="b3-list-item${d===0?" b3-list-item--focus":""}"><div class="b3-list-item__text">${c.hName}</div></div>`});const r=t.querySelector(".b3-list"),o=t.querySelector("#preview"),l=t.querySelector("input");r.innerHTML=s||`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`,i.data.length>0?o.innerHTML=Cd(i.data[0].path):o.innerHTML=window.siyuan.languages.emptyContent,window.siyuan.menus.menu.popup(n),e||l.select()})},zv=(t,e,n,a)=>{const i=new ta(p.MENU_BACKGROUND_ASSET);i.isOpen||i.addItem({iconHTML:"",type:"readonly",label:`<div class="fn__flex" style="max-height: ${x()?"80":"50"}vh">
<div class="fn__flex-column" style="${x()?"width:100%":"min-width: 260px;max-width:420px"}">
    <div class="fn__flex" style="margin: 0 8px 4px 8px">
        <input class="b3-text-field fn__flex-1"/>
        <span class="fn__space"></span>
        <span data-type="previous" class="block__icon block__icon--show"><svg><use xlink:href="#iconLeft"></use></svg></span>
        <span class="fn__space"></span>
        <span data-type="next" class="block__icon block__icon--show"><svg><use xlink:href="#iconRight"></use></svg></span>
    </div>
    <div class="b3-list fn__flex-1 b3-list--background" style="position: relative"><img style="margin: 0 auto;display: block;width: 64px;height: 64px" src="/stage/loading-pure.svg"></div>
</div>
<div id="preview" style="width: 360px;display: ${x()||window.outerWidth<window.outerWidth/2+260?"none":"flex"};padding: 8px;overflow: auto;justify-content: center;align-items: center;word-break: break-all;"></div>
</div>`,bind(s){s.style.maxWidth="none";const r=s.querySelector(".b3-list"),o=s.querySelector("#preview");r.addEventListener("mouseover",c=>{const d=c.target,u=N(d,"b3-list-item");u&&(o.innerHTML=Cd(u.getAttribute("data-value")))});const l=s.querySelector("input");l.addEventListener("keydown",c=>{if(c.isComposing)return;const d=s.querySelector(".b3-list--empty");if(!d){const u=pi(r,c);u&&(o.innerHTML=Cd(u.getAttribute("data-value")),c.stopPropagation())}if(c.key==="Enter"){if(d)n||(window.siyuan.menus.menu.remove(),Pt(t.toolbar.range));else{const u=s.querySelector(".b3-list-item--focus");n?n(u.getAttribute("data-value"),u.textContent):(ES(u.getAttribute("data-value"),t),window.siyuan.menus.menu.remove())}c.preventDefault(),c.stopPropagation()}else c.key==="Escape"&&(n||Pt(t.toolbar.range))}),l.addEventListener("input",c=>{c.isComposing||(c.stopPropagation(),Vv(s,l.value,e,a))}),l.addEventListener("compositionend",c=>{c.stopPropagation(),Vv(s,l.value,e,a)}),s.lastElementChild.addEventListener("click",c=>{const d=c.target;if(ue(d,"data-type","previous")){l.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"})),c.stopPropagation();return}if(ue(d,"data-type","next")){l.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"})),c.stopPropagation();return}const f=N(d,"b3-list-item");if(f){c.stopPropagation();const h=f.getAttribute("data-value");n?n(h,f.textContent):(ES(h,t),window.siyuan.menus.menu.remove())}}),Vv(s,"",e,a)}})},Yv=(t,e)=>{var n;const a=oe(e);if(!a)return;Ut(["util","toolbar","hint"],t);const i=a.getAttribute("data-node-id");let s=a.outerHTML;window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_INLINE_FILE_ANNOTATION_REF);let r;window.siyuan.menus.menu.append(new xe({id:"idAndAnchor",iconHTML:"",type:"readonly",label:`<div>ID</div><textarea spellcheck="false" rows="1" style="margin:4px 0;width: ${x()?"100%":"360px"}" class="b3-text-field" readonly>${e.getAttribute("data-id")||""}</textarea><div class="fn__hr"></div><div>${window.siyuan.languages.anchor}</div><textarea rows="1" style="margin:4px 0;width: ${x()?"100%":"360px"}" class="b3-text-field"></textarea>`,bind(c){c.style.maxWidth="none",r=c.querySelectorAll(".b3-text-field")[1],r.value=e.textContent;const d=()=>{r.value?e.innerHTML=Lute.EscapeHTMLStr(r.value):e.innerHTML="*"};r.addEventListener("input",u=>{u.isComposing||(d(),u.stopPropagation())}),r.addEventListener("compositionend",u=>{u.isComposing||(d(),u.stopPropagation())}),r.addEventListener("keydown",u=>{if(!u.isComposing){if(u.key==="Enter"&&!u.isComposing)window.siyuan.menus.menu.remove();else if(uo(u))return}})}}).element),window.siyuan.menus.menu.append(new xe({type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"turnInto",label:window.siyuan.languages.turnInto,icon:"iconRefresh",submenu:[{id:"text",iconHTML:"",label:window.siyuan.languages.text,click(){a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Rv(e,"file-annotation-ref",t.toolbar.range),Ht(t,i,a.outerHTML,s),s=a.outerHTML}},{id:"text*",iconHTML:"",label:window.siyuan.languages.text+" *",click(){e.insertAdjacentHTML("beforebegin",e.innerHTML+" "),e.textContent="*",a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,i,a.outerHTML,s),s=a.outerHTML}}]}).element),window.siyuan.menus.menu.append(new xe({id:"remove",icon:"iconTrashcan",label:window.siyuan.languages.remove,click(){e.insertAdjacentHTML("afterend","<wbr>"),e.remove(),a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,i,a.outerHTML,s),cn(a,t.toolbar.range),s=a.outerHTML}}).element),(n=t==null?void 0:t.app)!=null&&n.plugins&&Is({plugins:t.app.plugins,type:"open-menu-fileannotationref",detail:{protyle:t,element:e},separatorPosition:"top"});const o=e.getBoundingClientRect();window.siyuan.menus.menu.popup({x:o.left,y:o.top+26,h:26});const l=me(t.element,"block__popover",!0);window.siyuan.menus.menu.element.setAttribute("data-from",l?l.dataset.level+"popover":"app"),r.select(),window.siyuan.menus.menu.removeCB=()=>{a.outerHTML!==s&&(a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,i,a.outerHTML,s));const c=getSelection().rangeCount===0?void 0:getSelection().getRangeAt(0);c&&!t.element.contains(c.startContainer)&&(t.toolbar.range.selectNodeContents(e),t.toolbar.range.collapse(!1),Pt(t.toolbar.range))}},Gv=(t,e)=>{var n;const a=oe(e);if(!a)return;Ut(["util","toolbar","hint"],t);const i=e.getAttribute("data-id"),s=a.getAttribute("data-node-id");let r=a.outerHTML;if(window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_INLINE_REF),t.disabled||(window.siyuan.menus.menu.append(new xe({id:"anchor",iconHTML:"",type:"readonly",label:`<input style="margin: 4px 0" class="b3-text-field fn__block" placeholder="${window.siyuan.languages.anchor}">`,bind(c){const d=c.querySelector("input");d.value=e.getAttribute("data-subtype")==="d"?"":e.textContent,d.addEventListener("input",()=>{d.value?e.innerHTML=Lute.EscapeHTMLStr(d.value).trim()||i:ae("/api/block/getRefText",{id:i},u=>{e.innerHTML=u.data}),e.setAttribute("data-subtype",d.value?"s":"d")}),d.addEventListener("keydown",u=>{if(!u.isComposing){if(u.key==="Enter"&&!u.isComposing)window.siyuan.menus.menu.remove();else if(uo(u))return}})}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_1",type:"separator"}).element)),window.siyuan.menus.menu.append(new xe({id:"openBy",label:window.siyuan.languages.openBy,icon:"iconOpen",accelerator:window.siyuan.config.keymap.editor.general.openBy.custom+"/"+window.siyuan.languages.click,click(){na(i,(c,d,u)=>{u||d.push(p.CB_GET_HL),dn({app:t.app,id:i,action:d,zoomIn:c})})}}).element),window.siyuan.menus.menu.append(new xe({id:"refTab",label:window.siyuan.languages.refTab,icon:"iconEyeoff",accelerator:window.siyuan.config.keymap.editor.general.refTab.custom+"/"+Mt("\u2318"+window.siyuan.languages.click),click(){na(i,c=>{dn({app:t.app,id:i,action:c?[p.CB_GET_HL,p.CB_GET_ALL]:[p.CB_GET_HL,p.CB_GET_CONTEXT,p.CB_GET_ROOTSCROLL],keepCursor:!0,zoomIn:c})})}}).element),window.siyuan.menus.menu.append(new xe({id:"insertRight",label:window.siyuan.languages.insertRight,icon:"iconLayoutRight",accelerator:window.siyuan.config.keymap.editor.general.insertRight.custom+"/"+Mt("\u2325"+window.siyuan.languages.click),click(){na(i,(c,d,u)=>{u||d.push(p.CB_GET_HL),dn({app:t.app,id:i,position:"right",action:d,zoomIn:c})})}}).element),window.siyuan.menus.menu.append(new xe({id:"insertBottom",label:window.siyuan.languages.insertBottom,icon:"iconLayoutBottom",accelerator:window.siyuan.config.keymap.editor.general.insertBottom.custom+(window.siyuan.config.keymap.editor.general.insertBottom.custom?"/":"")+Mt("\u21E7"+window.siyuan.languages.click),click(){na(i,(c,d,u)=>{u||d.push(p.CB_GET_HL),dn({app:t.app,id:i,position:"bottom",action:d,zoomIn:c})})}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_2",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"backlinks",icon:"iconLink",label:window.siyuan.languages.backlinks,accelerator:window.siyuan.config.keymap.editor.general.backlinks.custom,click:()=>{Jh({app:t.app,blockId:i})}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_3",type:"separator"}).element),!t.disabled){let c=[];e.getAttribute("data-subtype")==="s"?c.push({id:"turnToDynamic",iconHTML:"",label:window.siyuan.languages.turnToDynamic,click(){e.setAttribute("data-subtype","d"),ae("/api/block/getRefText",{id:i},d=>{e.innerHTML=d.data,a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,s,a.outerHTML,r),r=a.outerHTML}),Pt(t.toolbar.range)}}):c.push({id:"turnToStatic",iconHTML:"",label:window.siyuan.languages.turnToStatic,click(){e.setAttribute("data-subtype","s"),a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,s,a.outerHTML,r),Pt(t.toolbar.range),r=a.outerHTML}}),c=c.concat([{id:"text",iconHTML:"",label:window.siyuan.languages.text,click(){a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Rv(e,"block-ref",t.toolbar.range),Ht(t,s,a.outerHTML,r),r=a.outerHTML}},{id:"*",iconHTML:"",label:"*",click(){e.setAttribute("data-subtype","s"),e.textContent="*",a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,s,a.outerHTML,r),Pt(t.toolbar.range),r=a.outerHTML}},{id:"text*",iconHTML:"",label:window.siyuan.languages.text+" *",click(){e.insertAdjacentHTML("beforebegin",e.innerHTML+" "),e.setAttribute("data-subtype","s"),e.textContent="*",a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,s,a.outerHTML,r),Pt(t.toolbar.range),r=a.outerHTML}},{id:"link",label:window.siyuan.languages.link,iconHTML:"",click(){e.outerHTML=`<span data-type="a" data-href="siyuan://blocks/${e.getAttribute("data-id")}">${e.innerHTML}</span><wbr>`,a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,s,a.outerHTML,r),cn(a,t.toolbar.range),r=a.outerHTML}}]),e.parentElement.textContent.trim()===e.textContent.trim()&&e.parentElement.tagName==="DIV"&&c.push({id:"blockEmbed",iconHTML:"",label:window.siyuan.languages.blockEmbed,click(){const d=`<div data-content="select * from blocks where id='${i}'" data-node-id="${s}" data-type="NodeBlockQueryEmbed" class="render-node" updated="${at().format("YYYYMMDDHHmmss")}">${a.querySelector(".protyle-attr").outerHTML}</div>`;a.outerHTML=d,Ht(t,s,d,r),$n(t,t.wysiwyg.element),r=a.outerHTML}}),c.push({id:"defBlock",iconHTML:"",label:window.siyuan.languages.defBlock,click(){ae("/api/block/swapBlockRef",{refID:s,defID:i,includeChildren:!1})}}),c.push({id:"defBlockChildren",iconHTML:"",label:window.siyuan.languages.defBlockChildren,click(){ae("/api/block/swapBlockRef",{refID:s,defID:i,includeChildren:!0})}}),window.siyuan.menus.menu.append(new xe({id:"turnInto",label:window.siyuan.languages.turnInto,icon:"iconRefresh",submenu:c}).element)}window.siyuan.menus.menu.append(new xe({id:"copy",label:window.siyuan.languages.copy,icon:"iconCopy",click(){ut(t.lute.BlockDOM2StdMd(e.outerHTML).trim())}}).element),t.disabled||(window.siyuan.menus.menu.append(new xe({id:"cut",label:window.siyuan.languages.cut,icon:"iconCut",click(){ut(t.lute.BlockDOM2StdMd(e.outerHTML)),e.insertAdjacentHTML("afterend","<wbr>"),e.remove(),a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,s,a.outerHTML,r),cn(a,t.toolbar.range),r=a.outerHTML}}).element),window.siyuan.menus.menu.append(new xe({id:"remove",label:window.siyuan.languages.remove,icon:"iconTrashcan",click(){e.insertAdjacentHTML("afterend","<wbr>"),e.remove(),a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,s,a.outerHTML,r),cn(a,t.toolbar.range),r=a.outerHTML}}).element)),(n=t==null?void 0:t.app)!=null&&n.plugins&&Is({plugins:t.app.plugins,type:"open-menu-blockref",detail:{protyle:t,element:e},separatorPosition:"top"});const o=e.getBoundingClientRect();window.siyuan.menus.menu.popup({x:o.left,y:o.top+26,h:26});const l=me(t.element,"block__popover",!0);window.siyuan.menus.menu.data=e,window.siyuan.menus.menu.element.setAttribute("data-from",l?l.dataset.level+"popover":"app"),t.disabled||(window.siyuan.menus.menu.element.querySelector("input").select(),window.siyuan.menus.menu.removeCB=()=>{a.outerHTML!==r&&(a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,s,a.outerHTML,r));const c=getSelection().rangeCount===0?void 0:getSelection().getRangeAt(0);c&&!t.element.contains(c.startContainer)&&(t.toolbar.range.selectNodeContents(e),t.toolbar.range.collapse(!1),Pt(t.toolbar.range))})},CM=(t,e)=>{var n,a,i;const s=hn(e);window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_INLINE_CONTEXT);const r=e.outerHTML,o=e.getAttribute("data-node-id");if(s.toString()!==""||(a=(n=s.cloneContents().childNodes[0])==null?void 0:n.classList)!=null&&a.contains("emoji")){if(window.siyuan.menus.menu.append(new xe({id:"copy",icon:"iconCopy",accelerator:"\u2318C",label:window.siyuan.languages.copy,click(){Pt(hn(e)),document.execCommand("copy")}}).element),window.siyuan.menus.menu.append(new xe({id:"copyPlainText",label:window.siyuan.languages.copyPlainText,accelerator:window.siyuan.config.keymap.editor.general.copyPlainText.custom,click(){Pt(hn(e)),kt(getSelection().getRangeAt(0).toString())}}).element),t.disabled)return;window.siyuan.menus.menu.append(new xe({id:"cut",icon:"iconCut",accelerator:"\u2318X",label:window.siyuan.languages.cut,click(){Pt(hn(e)),document.execCommand("cut")}}).element),window.siyuan.menus.menu.append(new xe({id:"delete",icon:"iconTrashcan",accelerator:"\u232B",label:window.siyuan.languages.delete,click(){const l=hn(e);l.insertNode(document.createElement("wbr")),l.extractContents(),cn(e,l),Pt(l),Ht(t,o,e.outerHTML,r)}}).element)}else{const l=A(s.startContainer,"SPAN");if(l){const c=t.toolbar.getCurrentType(s);if(c.includes("code")||c.includes("kbd")){if(window.siyuan.menus.menu.append(new xe({id:"copy",label:window.siyuan.languages.copy,icon:"iconCopy",click(){ut(t.lute.BlockDOM2StdMd(l.outerHTML))}}).element),window.siyuan.menus.menu.append(new xe({id:"copyPlainText",label:window.siyuan.languages.copyPlainText,click(){kt(l.textContent)}}).element),!t.disabled){const d=e.getAttribute("data-node-id");window.siyuan.menus.menu.append(new xe({id:"cut",icon:"iconCut",label:window.siyuan.languages.cut,click(){ut(t.lute.BlockDOM2StdMd(l.outerHTML)),l.insertAdjacentHTML("afterend","<wbr>"),l.remove(),e.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,d,e.outerHTML,r),cn(e,t.toolbar.range)}}).element),window.siyuan.menus.menu.append(new xe({id:"remove",icon:"iconTrashcan",label:window.siyuan.languages.remove,click(){l.insertAdjacentHTML("afterend","<wbr>"),l.remove(),e.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,d,e.outerHTML,r),cn(e,t.toolbar.range)}}).element)}window.siyuan.menus.menu.append(new xe({type:"separator"}).element)}}}if(!t.disabled){let l;window.siyuan.menus.menu.append(new xe({id:"paste",label:window.siyuan.languages.paste,icon:"iconPaste",accelerator:"\u2318V",click(){return kS(this,null,function*(){if(Pt(hn(e)),document.queryCommandSupported("paste"))document.execCommand("paste");else try{const c=yield nt();_f(t,Object.assign(c,{target:e}))}catch(c){console.log(c)}})}}).element),window.siyuan.menus.menu.append(new xe({id:"pasteAsPlainText",label:window.siyuan.languages.pasteAsPlainText,accelerator:"\u21E7\u2318V",click(){Pt(hn(e)),gv(t)}}).element),window.siyuan.menus.menu.append(new xe({id:"pasteEscaped",label:window.siyuan.languages.pasteEscaped,click(){Pt(hn(e)),h2(t,e)}}).element)}if(window.siyuan.menus.menu.append(new xe({id:"selectAll",label:window.siyuan.languages.selectAll,icon:"iconSelect",accelerator:"\u2318A",click(){mw(t,e,s)}}).element),e.classList.contains("table")&&!t.disabled){const l=A(s.startContainer,"TD")||A(s.startContainer,"TH");if(l){const c=SS(t,e,l,s);c.insertMenus.length>0&&(window.siyuan.menus.menu.append(new xe({id:"separator_1",type:"separator"}).element),c.insertMenus.forEach(d=>{window.siyuan.menus.menu.append(new xe(d).element)})),c.removeMenus.length>0&&(window.siyuan.menus.menu.append(new xe({id:"separator_2",type:"separator"}).element),c.removeMenus.forEach(d=>{window.siyuan.menus.menu.append(new xe(d).element)})),window.siyuan.menus.menu.append(new xe({id:"separator_3",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"more",type:"submenu",icon:"iconMore",label:window.siyuan.languages.more,submenu:c.otherMenus.concat(c.other2Menus)}).element)}}(i=t==null?void 0:t.app)!=null&&i.plugins&&Is({plugins:t.app.plugins,type:"open-menu-content",detail:{protyle:t,range:s,element:e},separatorPosition:"top"})},jv=(t,e)=>{if(t.block.showAll)hi({protyle:t,id:t.block.parent2ID,focusId:e});else{const n=t.path.split("/");n.length>2&&dn({app:t.app,id:n[n.length-2],action:[p.CB_GET_FOCUS,p.CB_GET_SCROLL]})}},hi=t=>{var e,n;if(t.protyle.options.backlinkData)return;typeof t.isPushBack=="undefined"&&(t.isPushBack=!0),typeof t.reload=="undefined"&&(t.reload=!1);const a=N(t.protyle.element,"block__popover",!0);if(a){const s=a.querySelector('[data-type="pin"]');s&&a.getAttribute("data-pin")!=="true"&&(s.setAttribute("aria-label",window.siyuan.languages.unpin),s.querySelector("use").setAttribute("xlink:href","#iconUnpin"),a.setAttribute("data-pin","true"))}const i=(e=t.protyle.breadcrumb)==null?void 0:e.element.querySelector(".protyle-breadcrumb__item--active");if(!t.reload&&i&&i.getAttribute("data-node-id")===t.id){if(t.id===t.protyle.block.rootID)return;const s=t.protyle.wysiwyg.element.querySelector(`[data-node-id="${t.focusId||t.id}"]`);if(s){qt(s),s.scrollIntoView();return}}(n=window.siyuan.mobile)!=null&&n.editor&&(window.siyuan.storage[p.LOCAL_DOCINFO]={id:t.id},Gt(p.LOCAL_DOCINFO,window.siyuan.storage[p.LOCAL_DOCINFO]),t.isPushBack&&Ov()),ae("/api/filetree/getDoc",{id:t.id,size:t.id===t.protyle.block.rootID?window.siyuan.config.editor.dynamicLoadBlocks:p.SIZE_GET_MAX},s=>kS(void 0,null,function*(){if(t.isPushBack?_a({data:s,protyle:t.protyle,action:t.id===t.protyle.block.rootID?[p.CB_GET_FOCUS,p.CB_GET_HTML]:[p.CB_GET_ALL,p.CB_GET_FOCUS,p.CB_GET_HTML],afterCB:t.callback}):_a({data:s,protyle:t.protyle,action:t.id===t.protyle.block.rootID?[p.CB_GET_FOCUS,p.CB_GET_HTML,p.CB_GET_UNUNDO]:[p.CB_GET_ALL,p.CB_GET_FOCUS,p.CB_GET_UNUNDO,p.CB_GET_HTML],afterCB:t.callback}),t.focusId){let r=t.protyle.wysiwyg.element.querySelector(`[data-node-id="${t.focusId}"]`);if(!r){const o=yield wn("/api/block/getUnfoldedParentID",{id:t.focusId});t.focusId=o.data.parentID,r=t.protyle.wysiwyg.element.querySelector(`[data-node-id="${o.data.parentID}"]`)}if(r){let o=r;for(;o.getBoundingClientRect().height===0;)o=o.parentElement;o.classList.contains("protyle-wysiwyg")?o=r.previousElementSibling||r.nextElementSibling:o=Le(o),qt(o);const l=new ResizeObserver(()=>{kn(t.protyle,r,"start")});l.observe(t.protyle.wysiwyg.element),setTimeout(()=>{l.disconnect()},1e3*3)}else if(t.focusId){if(t.id===t.protyle.block.rootID){ae("/api/filetree/getDoc",{id:t.focusId,mode:3,size:window.siyuan.config.editor.dynamicLoadBlocks},o=>{_a({data:o,protyle:t.protyle,action:t.isPushBack?[p.CB_GET_FOCUS]:[p.CB_GET_FOCUS,p.CB_GET_UNUNDO]})});return}}else{ae("/api/filetree/getDoc",{id:t.protyle.block.rootID,size:window.siyuan.config.editor.dynamicLoadBlocks},o=>{_a({data:o,protyle:t.protyle,action:t.isPushBack?[p.CB_GET_FOCUS]:[p.CB_GET_FOCUS,p.CB_GET_UNUNDO]})});return}}else t.id!==t.protyle.block.rootID&&(t.protyle.wysiwyg.element.classList.add("protyle-wysiwyg--animate"),setTimeout(()=>{t.protyle.wysiwyg.element.classList.remove("protyle-wysiwyg--animate")},365));if(t.protyle.model){const r=Cn();r.outline.forEach(o=>{o.blockId===t.protyle.block.rootID&&o.setCurrent(t.protyle.wysiwyg.element.querySelector(`[data-node-id="${t.focusId||t.id}"]`))}),TE(r,t.protyle)}}))},Kv=(t,e,n,a)=>{var i;window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_INLINE_IMG);const s=oe(n);if(!s)return;Ut(["util","toolbar","hint"],t);const r=s.getAttribute("data-node-id"),o=n.querySelector("img"),l=n.querySelector(".protyle-action__title span"),c=s.outerHTML;let d=o.getAttribute("src");if(d||(d=""),t.disabled||(window.siyuan.menus.menu.append(new xe({id:"imageUrlAndTitleAndTooltipText",iconHTML:"",type:"readonly",label:`<div class="fn__flex">
    <span class="fn__flex-center">${window.siyuan.languages.imageURL}</span>
    <span class="fn__space"></span>
    <span data-action="copy" class="block__icon block__icon--show b3-tooltips b3-tooltips__e fn__flex-center" aria-label="${window.siyuan.languages.copy}">
        <svg><use xlink:href="#iconCopy"></use></svg>
    </span>   
</div><textarea spellcheck="false" style="margin:4px 0;width: ${x()?"100%":"360px"}" rows="1" class="b3-text-field">${d}</textarea><div class="fn__hr"></div><div class="fn__flex">
    <span class="fn__flex-center">${window.siyuan.languages.title}</span>
    <span class="fn__space"></span>
    <span data-action="copy" class="block__icon block__icon--show b3-tooltips b3-tooltips__e fn__flex-center" aria-label="${window.siyuan.languages.copy}">
        <svg><use xlink:href="#iconCopy"></use></svg>
    </span>   
</div><textarea style="margin:4px 0;width: ${x()?"100%":"360px"}" rows="1" class="b3-text-field"></textarea><div class="fn__hr"></div><div class="fn__flex">
    <span class="fn__flex-center">${window.siyuan.languages.tooltipText}</span>
    <span class="fn__space"></span>
    <span data-action="copy" class="block__icon block__icon--show b3-tooltips b3-tooltips__e fn__flex-center" aria-label="${window.siyuan.languages.copy}">
        <svg><use xlink:href="#iconCopy"></use></svg>
    </span>   
</div><textarea style="margin:4px 0;width: ${x()?"100%":"360px"}" rows="1" class="b3-text-field"></textarea>`,bind(h){h.style.maxWidth="none";const m=h.querySelectorAll("textarea");m[0].addEventListener("input",b=>{const y=b.target.value.replace(/\n|\r\n|\r|\u2028|\u2029/g,"").trim();if(o.setAttribute("src",y),o.setAttribute("data-src",y),y.startsWith("assets/")){const _=n.querySelector(".img__net");_&&_.remove()}else window.siyuan.config.editor.displayNetImgMark&&n.querySelector(".protyle-action__drag").insertAdjacentHTML("afterend",'<span class="img__net"><svg><use xlink:href="#iconLanguage"></use></svg></span>')}),m[1].value=l.innerText,m[1].addEventListener("input",b=>{const y=b.target.value;o.setAttribute("title",y),l.innerText=y,Ei(l)}),m[2].value=o.getAttribute("alt")||"",h.addEventListener("click",b=>{let y=b.target;for(;y;){if(y.dataset.action==="copy"){ut(y.parentElement.nextElementSibling.value),Q(window.siyuan.languages.copied);break}y=y.parentElement}})}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_1",type:"separator"}).element)),window.siyuan.menus.menu.append(new xe({id:"copy",label:window.siyuan.languages.copy,accelerator:"\u2318C",icon:"iconCopy",click(){let h=t.lute.BlockDOM2StdMd(n.outerHTML);h=h.replace(/%20/g," "),ut(h)}}).element),t.disabled&&window.siyuan.menus.menu.append(new xe({id:"copyImageURL",label:window.siyuan.languages.copy+" "+window.siyuan.languages.imageURL,icon:"iconLink",click(){ut(o.getAttribute("src"))}}).element),window.siyuan.menus.menu.append(new xe({id:"copyAsPNG",label:window.siyuan.languages.copyAsPNG,accelerator:window.siyuan.config.keymap.editor.general.copyBlockRef.custom,icon:"iconImage",click(){wd(o.getAttribute("src"))}}).element),!t.disabled){window.siyuan.menus.menu.append(new xe({id:"cut",icon:"iconCut",accelerator:"\u2318X",label:window.siyuan.languages.cut,click(){let y=t.lute.BlockDOM2StdMd(n.outerHTML);y=y.replace(/%20/g," "),ut(y),n.outerHTML="<wbr>",s.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,r,s.outerHTML,c),cn(t.wysiwyg.element,e)}}).element),window.siyuan.menus.menu.append(new xe({id:"delete",icon:"iconTrashcan",accelerator:"\u232B",label:window.siyuan.languages.delete,click:function(){n.outerHTML="<wbr>",s.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,r,s.outerHTML,c),cn(t.wysiwyg.element,e)}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_2",type:"separator"}).element);const h=o.getAttribute("data-src");h.startsWith("assets/")&&window.siyuan.menus.menu.append(new xe({id:"rename",label:window.siyuan.languages.rename,icon:"iconEdit",click(){Ed(h)}}).element),window.siyuan.menus.menu.append(new xe({id:"alignCenter",icon:"iconAlignCenter",label:window.siyuan.languages.alignCenter,accelerator:window.siyuan.config.keymap.editor.general.alignCenter.custom,click(){_S(t,s,[n],r,c)}}).element),window.siyuan.menus.menu.append(new xe({id:"alignLeft",icon:"iconAlignLeft",label:window.siyuan.languages.alignLeft,accelerator:window.siyuan.config.keymap.editor.general.alignLeft.custom,click(){wS(t,s,[n],r,c)}}).element);let m;window.siyuan.menus.menu.append(new xe({id:"width",label:window.siyuan.languages.width,submenu:[{id:"widthInput",iconHTML:"",type:"readonly",label:`<div class="fn__flex"><input class="b3-text-field fn__flex-1" style="margin: 4px 8px 4px 0" value="${o.parentElement.style.width.endsWith("px")?parseInt(o.parentElement.style.width):""}" type="number" placeholder="${window.siyuan.languages.width}"><span class="fn__flex-center">px</span></div>`,bind(y){const _=y.querySelector("input");_.addEventListener("input",()=>{m.value="0",m.parentElement.setAttribute("aria-label",_.value?_.value+"px":window.siyuan.languages.default),Fd(n),o.parentElement.style.width=_.value?_.value+"px":"",o.style.height=""}),_.addEventListener("blur",()=>{_.value!==o.parentElement.style.width.replace("px","")&&(s.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,r,s.outerHTML,c),window.siyuan.menus.menu.remove(),qt(s))})}},Pd("25%",o,t,r,s,c),Pd("33%",o,t,r,s,c),Pd("50%",o,t,r,s,c),Pd("67%",o,t,r,s,c),Pd("75%",o,t,r,s,c),Pd("100%",o,t,r,s,c),{id:"separator_1",type:"separator"},{id:"widthDrag",iconHTML:"",type:"readonly",label:`<div style="margin: 4px 0;" aria-label="${o.parentElement.style.width?o.parentElement.style.width.replace("vw","%").replace("calc(","").replace(" - 8px)",""):window.siyuan.languages.default}" class="b3-tooltips b3-tooltips__n"><input style="box-sizing: border-box" value="${o.parentElement.style.width.indexOf("%")>-1||o.parentElement.style.width.endsWith("vw")?parseInt(o.parentElement.style.width.replace("calc(","")):0}" class="b3-slider fn__block" max="100" min="1" step="1" type="range"></div>`,bind(y){m=y.querySelector("input"),m.addEventListener("input",()=>{Fd(n),o.parentElement.style.width=`calc(${m.value}% - 8px)`,o.style.height="",m.parentElement.setAttribute("aria-label",`${m.value}%`)}),m.addEventListener("change",()=>{s.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,r,s.outerHTML,c),window.siyuan.menus.menu.remove(),qt(s)})}},{id:"separator_2",type:"separator"},Pd(window.siyuan.languages.default,o,t,r,s,c)]}).element);let b;window.siyuan.menus.menu.append(new xe({id:"height",label:window.siyuan.languages.height,submenu:[{id:"heightInput",iconHTML:"",type:"readonly",label:`<div class="fn__flex"><input class="b3-text-field fn__flex-1" value="${o.style.height.endsWith("px")?parseInt(o.style.height):""}" type="number" style="margin: 4px 8px 4px 0" placeholder="${window.siyuan.languages.height}"><span class="fn__flex-center">px</span></div>`,bind(y){const _=y.querySelector("input");_.addEventListener("input",()=>{b.value="0",b.parentElement.setAttribute("aria-label",_.value?_.value+"px":window.siyuan.languages.default),o.style.height=_.value?_.value+"px":"",Fd(n),o.parentElement.style.width=""}),_.addEventListener("blur",()=>{_.value!==o.style.height.replace("px","")&&(s.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,r,s.outerHTML,c),window.siyuan.menus.menu.remove(),qt(s))})}},Nd("25%",o,t,r,s,c),Nd("33%",o,t,r,s,c),Nd("50%",o,t,r,s,c),Nd("67%",o,t,r,s,c),Nd("75%",o,t,r,s,c),Nd("100%",o,t,r,s,c),{id:"separator_1",type:"separator"},{id:"heightDrag",iconHTML:"",type:"readonly",label:`<div style="margin: 4px 0;" aria-label="${o.style.height?o.style.height.replace("vh","%"):window.siyuan.languages.default}" class="b3-tooltips b3-tooltips__n"><input style="box-sizing: border-box" value="${o.style.height.endsWith("vh")?parseInt(o.style.height):0}" class="b3-slider fn__block" max="100" min="1" step="1" type="range"></div>`,bind(y){b=y.querySelector("input"),b.addEventListener("input",()=>{Fd(n),o.parentElement.style.width="",o.style.height=b.value+"vh",b.parentElement.setAttribute("aria-label",`${b.value}%`)}),b.addEventListener("change",()=>{s.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,r,s.outerHTML,c),window.siyuan.menus.menu.remove(),qt(s)})}},{id:"separator_2",type:"separator"},Nd(window.siyuan.languages.default,o,t,r,s,c)]}).element)}const u=o.getAttribute("src");u&&(window.siyuan.menus.menu.append(new xe({id:"separator_3",type:"separator"}).element),Wh(t.app,u,!1,!1));const g=o.getAttribute("data-src");g&&g.startsWith("assets/")&&window.siyuan.menus.menu.append(new xe(_d(g)).element),(i=t==null?void 0:t.app)!=null&&i.plugins&&Is({plugins:t.app.plugins,type:"open-menu-image",detail:{protyle:t,element:n},separatorPosition:"top"}),window.siyuan.menus.menu.popup({x:a.clientX,y:a.clientY});const f=me(t.element,"block__popover",!0);if(window.siyuan.menus.menu.element.setAttribute("data-from",f?f.dataset.level+"popover":"app"),!t.disabled){const h=window.siyuan.menus.menu.element.querySelectorAll("textarea");h[0].value?h[1].select():h[0].select(),window.siyuan.menus.menu.removeCB=()=>{o.setAttribute("alt",h[2].value.replace(/\n|\r\n|\r|\u2028|\u2029/g,"")),s.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,r,s.outerHTML,c)}}},Df=(t,e,n=!1)=>{var a;window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_INLINE_A);const i=oe(e);if(!i)return;Pa(),Ut(["util","toolbar","hint"],t);const s=i.getAttribute("data-node-id");let r=i.outerHTML;const o=e.getAttribute("data-href");let l;t.disabled||(window.siyuan.menus.menu.append(new xe({id:"linkAndAnchorAndTitle",iconHTML:"",type:"readonly",label:`<div class="fn__flex">
    <span class="fn__flex-center">${window.siyuan.languages.link}</span>
    <span class="fn__space"></span>
    <span data-action="copy" class="block__icon block__icon--show b3-tooltips b3-tooltips__e fn__flex-center" aria-label="${window.siyuan.languages.copy}">
        <svg><use xlink:href="#iconCopy"></use></svg>
    </span>   
</div><textarea spellcheck="false" rows="1" 
style="margin:4px 0;width: ${x()?"100%":"360px"}" class="b3-text-field"></textarea><div class="fn__hr"></div><div class="fn__flex">
    <span class="fn__flex-center">${window.siyuan.languages.anchor}</span>
    <span class="fn__space"></span>
    <span data-action="copy" class="block__icon block__icon--show b3-tooltips b3-tooltips__e fn__flex-center" aria-label="${window.siyuan.languages.copy}">
        <svg><use xlink:href="#iconCopy"></use></svg>
    </span>   
</div><textarea style="width: ${x()?"100%":"360px"};margin: 4px 0;" rows="1" class="b3-text-field"></textarea><div class="fn__hr"></div><div class="fn__flex">
    <span class="fn__flex-center">${window.siyuan.languages.title}</span>
    <span class="fn__space"></span>
    <span data-action="copy" class="block__icon block__icon--show b3-tooltips b3-tooltips__e fn__flex-center" aria-label="${window.siyuan.languages.copy}">
        <svg><use xlink:href="#iconCopy"></use></svg>
    </span>   
</div><textarea style="width: ${x()?"100%":"360px"};margin: 4px 0;" rows="1" class="b3-text-field"></textarea>`,bind(u){u.style.maxWidth="none",l=u.querySelectorAll("textarea"),l[0].value=Lute.UnEscapeHTMLStr(o)||"",l[0].addEventListener("keydown",f=>{if((f.key==="Enter"||f.key==="Escape")&&!f.isComposing)f.preventDefault(),f.stopPropagation(),window.siyuan.menus.menu.remove();else if(f.key==="Tab"&&!f.isComposing)f.preventDefault(),f.stopPropagation(),l[1].focus();else if(uo(f))return});let g=e.textContent.replace(p.ZWSP,"");!g&&o&&(g=decodeURIComponent(o.replace("https://","").replace("http://","")),g.length>p.SIZE_LINK_TEXT_MAX&&(g=g.substring(0,p.SIZE_LINK_TEXT_MAX)+"..."),e.innerHTML=Lute.EscapeHTMLStr(g)),l[1].value=g,l[1].addEventListener("compositionend",()=>{e.innerHTML=Lute.EscapeHTMLStr(l[1].value.replace(/\n|\r\n|\r|\u2028|\u2029/g,"").trim()||"*")}),l[1].addEventListener("input",f=>{f.isComposing||(e.innerHTML=Lute.EscapeHTMLStr(l[1].value.replace(/\n|\r\n|\r|\u2028|\u2029/g,"").trim())||"*")}),l[1].addEventListener("keydown",f=>{if((f.key==="Enter"||f.key==="Escape")&&!f.isComposing)f.preventDefault(),f.stopPropagation(),window.siyuan.menus.menu.remove();else if(f.key==="Tab"&&!f.isComposing)f.preventDefault(),f.stopPropagation(),f.shiftKey?l[0].focus():l[2].focus();else if(uo(f))return}),l[2].value=Lute.UnEscapeHTMLStr(e.getAttribute("data-title")||""),l[2].addEventListener("keydown",f=>{if((f.key==="Enter"||f.key==="Escape")&&!f.isComposing)f.preventDefault(),f.stopPropagation(),window.siyuan.menus.menu.remove();else if(f.key==="Tab"&&f.shiftKey&&!f.isComposing)f.preventDefault(),f.stopPropagation(),l[1].focus();else if(uo(f))return}),u.addEventListener("click",f=>{let h=f.target;for(;h;){if(h.dataset.action==="copy"){ut(h.parentElement.nextElementSibling.value),Q(window.siyuan.languages.copied);break}h=h.parentElement}})}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_1",type:"separator"}).element)),window.siyuan.menus.menu.append(new xe({id:"copy",label:window.siyuan.languages.copy,icon:"iconCopy",click(){const u=document.createRange();u.selectNode(e),Pt(u),document.execCommand("copy")}}).element),t.disabled&&window.siyuan.menus.menu.append(new xe({id:"copyAHref",label:window.siyuan.languages.copyAHref,icon:"iconLink",click(){ut(o)}}).element),t.disabled||(window.siyuan.menus.menu.append(new xe({id:"cut",icon:"iconCut",label:window.siyuan.languages.cut,click(){const u=document.createRange();u.selectNode(e),Pt(u),document.execCommand("cut")}}).element),window.siyuan.menus.menu.append(new xe({id:"remove",icon:"iconTrashcan",label:window.siyuan.languages.remove,click(){e.insertAdjacentHTML("afterend","<wbr>"),e.remove(),i.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,s,i.outerHTML,r),cn(i,t.toolbar.range),r=i.outerHTML}}).element),o!=null&&o.startsWith("assets/")&&window.siyuan.menus.menu.append(new xe({id:"rename",label:window.siyuan.languages.rename,icon:"iconEdit",click(){Ed(o)}}).element),o!=null&&o.startsWith("siyuan://blocks/")&&window.siyuan.menus.menu.append(new xe({id:"turnIntoRef",label:`${window.siyuan.languages.turnInto} <b>${window.siyuan.languages.ref}</b>`,icon:"iconRef",click(){e.setAttribute("data-subtype","s");const u=e.getAttribute("data-type").split(" ");u.push("block-ref"),u.splice(u.indexOf("a"),1),e.setAttribute("data-type",u.join(" ")),e.setAttribute("data-id",l[0].value.replace("siyuan://blocks/","")),l[0].value="",l[2].value="",e.removeAttribute("data-href"),e.removeAttribute("data-title"),i.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,s,i.outerHTML,r),t.toolbar.range.selectNode(e),t.toolbar.range.collapse(!1),Pt(t.toolbar.range),r=i.outerHTML}}).element),window.siyuan.menus.menu.append(new xe({id:"turnIntoText",label:`${window.siyuan.languages.turnInto} <b>${window.siyuan.languages.text}</b>`,icon:"iconRefresh",click(){l[0].value="",l[2].value="",i.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Rv(e,"a",t.toolbar.range),Ht(t,s,i.outerHTML,r),r=i.outerHTML}}).element)),o&&(window.siyuan.menus.menu.append(new xe({id:"separator_2",type:"separator"}).element),Wh(t.app,o,!1,!0),o!=null&&o.startsWith("assets/")&&window.siyuan.menus.menu.append(new xe(_d(o)).element)),!t.disabled&&((a=t==null?void 0:t.app)!=null&&a.plugins)&&Is({plugins:t.app.plugins,type:"open-menu-link",detail:{protyle:t,element:e},separatorPosition:"top"});const c=e.getBoundingClientRect();window.siyuan.menus.menu.popup({x:c.left,y:c.top+26,h:26});const d=me(t.element,"block__popover",!0);window.siyuan.menus.menu.element.setAttribute("data-from",d?d.dataset.level+"popover":"app"),!t.disabled&&(n||t.lute.GetLinkDest(o)||o!=null&&o.startsWith("assets/")?l[1].select():l[0].select(),window.siyuan.menus.menu.removeCB=()=>{l[2].value?e.setAttribute("data-title",Lute.EscapeHTMLStr(l[2].value.replace(/\n|\r\n|\r|\u2028|\u2029/g,""))):e.removeAttribute("data-title"),e.getAttribute("data-type").indexOf("a")>-1?e.setAttribute("data-href",Lute.EscapeHTMLStr(l[0].value.replace(/\n|\r\n|\r|\u2028|\u2029/g,""))):e.removeAttribute("data-href"),!l[1].value&&(l[0].value||l[2].value)&&(e.textContent="*");const u=getSelection().rangeCount===0?void 0:getSelection().getRangeAt(0);u&&!t.element.contains(u.startContainer)&&(t.toolbar.range.selectNodeContents(e),t.toolbar.range.collapse(!1),Pt(t.toolbar.range)),!l[1].value&&!l[0].value&&!l[2].value&&e.remove(),r!==i.outerHTML&&(i.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,s,i.outerHTML,r))})},Xv=(t,e)=>{var n;window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_INLINE_TAG);const a=oe(e);if(!a)return;Ut(["util","toolbar","hint"],t);const i=a.getAttribute("data-node-id");let s=a.outerHTML;window.siyuan.menus.menu.append(new xe({id:"tag",iconHTML:"",type:"readonly",label:`<input class="b3-text-field fn__block" style="margin: 4px 0" placeholder="${window.siyuan.languages.tag}">`,bind(l){const c=l.querySelector("input");c.value=e.textContent.replace(p.ZWSP,""),c.addEventListener("change",()=>{Ht(t,i,a.outerHTML,s),s=a.outerHTML}),c.addEventListener("compositionend",()=>{e.innerHTML=p.ZWSP+Lute.EscapeHTMLStr(c.value||"")}),c.addEventListener("input",d=>{d.isComposing||(e.innerHTML=p.ZWSP+Lute.EscapeHTMLStr(c.value||""))}),c.addEventListener("keydown",d=>{if((d.key==="Enter"||d.key==="Escape")&&!d.isComposing){if(d.preventDefault(),d.stopPropagation(),c.value)t.toolbar.range.selectNodeContents(e),t.toolbar.range.collapse(!1),Pt(t.toolbar.range);else{const u=a.outerHTML;e.insertAdjacentHTML("afterend","<wbr>"),e.remove(),a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,i,a.outerHTML,u),cn(a,t.toolbar.range)}window.siyuan.menus.menu.remove()}else if(uo(d))return})}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_1",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"search",label:window.siyuan.languages.search,accelerator:window.siyuan.languages.click,icon:"iconSearch",click(){Ro(t.app,`#${e.textContent}#`,!1,{method:0})}}).element),window.siyuan.menus.menu.append(new xe({id:"rename",label:window.siyuan.languages.rename,icon:"iconEdit",click(){yd(e.textContent.replace(p.ZWSP,""))}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_2",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"turnIntoText",label:`${window.siyuan.languages.turnInto} <b>${window.siyuan.languages.text}</b>`,icon:"iconRefresh",click(){t.toolbar.range.setStart(e.firstChild,0),t.toolbar.range.setEnd(e.lastChild,e.lastChild.textContent.length),t.toolbar.setInlineMark(t,"tag","range")}}).element),window.siyuan.menus.menu.append(new xe({id:"copy",label:window.siyuan.languages.copy,icon:"iconCopy",click(){const l=document.createRange();l.selectNode(e),Pt(l),document.execCommand("copy")}}).element),window.siyuan.menus.menu.append(new xe({id:"cut",label:window.siyuan.languages.cut,icon:"iconCut",click(){const l=document.createRange();l.selectNode(e),Pt(l),document.execCommand("cut")}}).element),window.siyuan.menus.menu.append(new xe({id:"remove",icon:"iconTrashcan",label:window.siyuan.languages.remove,click(){const l=a.outerHTML;e.insertAdjacentHTML("afterend","<wbr>"),e.remove(),a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,i,a.outerHTML,l),cn(a,t.toolbar.range)}}).element),(n=t==null?void 0:t.app)!=null&&n.plugins&&Is({plugins:t.app.plugins,type:"open-menu-tag",detail:{protyle:t,element:e},separatorPosition:"top"});const r=e.getBoundingClientRect();window.siyuan.menus.menu.popup({x:r.left,y:r.top+26,h:26});const o=me(t.element,"block__popover",!0);window.siyuan.menus.menu.element.setAttribute("data-from",o?o.dataset.level+"popover":"app"),window.siyuan.menus.menu.element.querySelector("input").select()},a_=(t,e)=>{window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_INLINE_MATH);const n=oe(e);if(!n)return;const a=n.getAttribute("data-node-id"),i=n.outerHTML;window.siyuan.menus.menu.append(new xe({id:"copy",label:window.siyuan.languages.copy,icon:"iconCopy",click(){const r=document.createRange();r.selectNode(e),Pt(r),document.execCommand("copy")}}).element),t.disabled||(window.siyuan.menus.menu.append(new xe({id:"cut",icon:"iconCut",label:window.siyuan.languages.cut,click(){const r=document.createRange();r.selectNode(e),Pt(r),document.execCommand("cut")}}).element),window.siyuan.menus.menu.append(new xe({id:"remove",icon:"iconTrashcan",label:window.siyuan.languages.remove,click(){e.insertAdjacentHTML("afterend","<wbr>"),e.remove(),n.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,a,n.outerHTML,i),cn(n,t.toolbar.range)}}).element));const s=e.getBoundingClientRect();window.siyuan.menus.menu.popup({x:s.left,y:s.top+26,h:26})},Pd=(t,e,n,a,i,s)=>({id:t===window.siyuan.languages.default?"default":"width_"+t,iconHTML:"",label:t,click(){i.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Fd(e.parentElement.parentElement),e.parentElement.style.width=t===window.siyuan.languages.default?"":`calc(${t} - 8px)`,e.style.height="",Ht(n,a,i.outerHTML,s),qt(i)}}),Nd=(t,e,n,a,i,s)=>({id:t===window.siyuan.languages.default?"default":"width_"+t,iconHTML:"",label:t,click(){i.setAttribute("updated",at().format("YYYYMMDDHHmmss")),e.style.height=t===window.siyuan.languages.default?"":parseInt(t)+"vh",Fd(e.parentElement.parentElement),e.parentElement.style.width="",Ht(n,a,i.outerHTML,s),qt(i)}}),LM=(t,e)=>{const n=e.getAttribute("data-node-id"),a=e.querySelector("iframe");let i=e.outerHTML;const s=[{id:"asset",iconHTML:"",type:"readonly",label:`<textarea spellcheck="false" rows="1" class="b3-text-field fn__block" placeholder="${window.siyuan.languages.link}" style="margin: 4px 0">${a.getAttribute("src")||""}</textarea>`,bind(o){o.style.maxWidth="none",o.querySelector("textarea").addEventListener("change",l=>{const c=l.target.value.replace(/\n|\r\n|\r|\u2028|\u2029/g,"").trim(),d=c.match(/(?:www\.|\/\/)bilibili\.com\/video\/(\w+)/);if(c.indexOf("bilibili.com")>-1&&(c.indexOf("bvid=")>-1||d&&d[1])){const u={bvid:O("bvid",c)||d&&d[1],page:"1",high_quality:"1",as_wide:"1",allowfullscreen:"true",autoplay:"0"};new URL(c.startsWith("http")?c:"https:"+c).search.split("&").forEach((h,m)=>{if(!h)return;m===0&&(h=h.substr(1));const b=h.split("=");u[b[0]]=b[1]});let g="https://player.bilibili.com/player.html?";const f=Object.keys(u);f.forEach((h,m)=>{g+=`${h}=${u[h]}`,m<f.length-1&&(g+="&")}),a.setAttribute("src",g),a.setAttribute("sandbox","allow-top-navigation-by-user-activation allow-same-origin allow-forms allow-scripts allow-popups"),a.style.height||(a.style.height="360px"),a.style.width||(a.style.width="640px")}else a.setAttribute("src",c);Ht(t,n,e.outerHTML,i),i=e.outerHTML,l.stopPropagation()})}}],r=a.getAttribute("src");return r?(s.push({type:"separator"}),s.concat(Wh(t.app,r,!0,!1))):s},IM=(t,e,n)=>{const a=e.getAttribute("data-node-id"),i=e.querySelector(n==="NodeVideo"?"video":"audio");let s=e.outerHTML;const r=[{id:"asset",iconHTML:"",type:"readonly",label:`<textarea spellcheck="false" rows="1" style="margin: 4px 0" class="b3-text-field fn__block" placeholder="${window.siyuan.languages.link}">${i.getAttribute("src")}</textarea>`,bind(l){l.style.maxWidth="none",l.querySelector("textarea").addEventListener("change",c=>{i.setAttribute("src",c.target.value.replace(/\n|\r\n|\r|\u2028|\u2029/g,"").trim()),Ht(t,a,e.outerHTML,s),s=e.outerHTML,c.stopPropagation()})}}],o=i.getAttribute("src");return o&&o.startsWith("assets/")&&(r.push({type:"separator"}),r.push({id:"rename",label:window.siyuan.languages.rename,icon:"iconEdit",click(){Ed(o)}})),o&&r.push({id:"openBy",label:window.siyuan.languages.openBy,icon:"iconOpen",submenu:Wh(t.app,o,!0,!1)}),o&&o.startsWith("assets/")&&r.push(_d(o)),r},SS=(t,e,n,a)=>{var i;const s=[],r=cs(n);(n.rowSpan>1||n.colSpan>1)&&s.push({id:"cancelMerged",label:window.siyuan.languages.cancelMerged,click:()=>{const j=e.outerHTML;let re=n.rowSpan,Te=n.parentElement;const Be=n.colSpan;for(;re>0&&Te;){let Ie=Te.children[r],Ce=Be;for(;Ce>0&&Ie;)Ie.classList.remove("fn__none"),Ie.colSpan=1,Ie.rowSpan=1,Ie=Ie.nextElementSibling,Ce--;Te=Te.nextElementSibling,re--}if(n.rowSpan=1,n.colSpan=1,n.tagName==="TH"){let Ie;if(Array.from(e.querySelectorAll("thead tr")).find(Ce=>{if(Ie=Ce,Array.from(Ce.children).forEach(Je=>{(Je.rowSpan!==1||Je.classList.contains("fn__none"))&&(Ie=void 0)}),Ie)return!0}),Ie){const Ce=e.querySelector("tbody"),Je=e.querySelector("thead");for(;Ie!==Je.lastElementChild;)Ce.insertAdjacentElement("afterbegin",Je.lastElementChild)}}Pt(a),Ht(t,e.getAttribute("data-node-id"),e.outerHTML,j)}});const o=e.querySelectorAll("col")[r];(o.style.width||o.style.minWidth!=="60px")&&s.push({id:"useDefaultWidth",label:window.siyuan.languages.useDefaultWidth,click:()=>{const j=e.outerHTML;o.style.width="",o.style.minWidth="60px",Ht(t,e.getAttribute("data-node-id"),e.outerHTML,j)}});const l=e.getAttribute("custom-pinthead");s.push({id:l?"unpinTableHead":"pinTableHead",icon:l?"iconUnpin":"iconPin",label:l?window.siyuan.languages.unpinTableHead:window.siyuan.languages.pinTableHead,click:()=>{const j=e.outerHTML;l?e.removeAttribute("custom-pinthead"):e.setAttribute("custom-pinthead","true"),Ht(t,e.getAttribute("data-node-id"),e.outerHTML,j)}}),s.push({id:"separator_1",type:"separator"}),s.push({id:"alignLeft",icon:"iconAlignLeft",accelerator:window.siyuan.config.keymap.editor.general.alignLeft.custom,label:window.siyuan.languages.alignLeft,click:()=>{se(t,[n],e,"left",a)}}),s.push({id:"alignCenter",icon:"iconAlignCenter",label:window.siyuan.languages.alignCenter,accelerator:window.siyuan.config.keymap.editor.general.alignCenter.custom,click:()=>{se(t,[n],e,"center",a)}}),s.push({id:"alignRight",icon:"iconAlignRight",label:window.siyuan.languages.alignRight,accelerator:window.siyuan.config.keymap.editor.general.alignRight.custom,click:()=>{se(t,[n],e,"right",a)}}),s.push({id:"useDefaultAlign",icon:"",label:window.siyuan.languages.useDefaultAlign,click:()=>{se(t,[n],e,"",a)}});const c=[];c.push(...s),c.push({type:"separator"});const d=e.querySelector("table"),u=n.parentElement.querySelector(".fn__none");let g=!1,f=!1;Array.from(n.parentElement.children).forEach(j=>{j.colSpan>1&&(g=!0),j.rowSpan>1&&(f=!0)});let h=!1,m=!1,b=!1,y=n.parentElement.previousElementSibling;!y&&n.parentElement.parentElement.tagName==="TBODY"&&(y=d.querySelector("thead").lastElementChild),y&&(h=y.querySelector(".fn__none"),Array.from(y.children).forEach(j=>{j.colSpan>1&&(m=!0),j.rowSpan>1&&(b=!0)}));let _=!1,v=!1,U=!1,ee=n.parentElement.nextElementSibling;!ee&&n.parentElement.parentElement.tagName==="THEAD"&&(ee=(i=d.querySelector("tbody"))==null?void 0:i.firstElementChild),ee&&(_=ee.querySelector(".fn__none"),Array.from(ee.children).forEach(j=>{j.colSpan>1&&(v=!0),j.rowSpan>1&&(U=!0)}));let Z=!0;Array.from(d.rows).find(j=>{const re=j.cells[r];if(re.classList.contains("fn__none")||re.colSpan>1||re.rowSpan>1)return Z=!1,!0});let k=!0;Array.from(d.rows).find(j=>{const re=j.cells[r+1];if(re&&(re.classList.contains("fn__none")||re.colSpan>1||re.rowSpan>1))return k=!1,!0});let w=!0;Array.from(d.rows).find(j=>{const re=j.cells[r-1];if(re&&(re.classList.contains("fn__none")||re.colSpan>1||re.rowSpan>1))return w=!1,!0});const S=[];S.push({id:"insertRowAbove",icon:"iconBefore",label:window.siyuan.languages.insertRowAbove,accelerator:window.siyuan.config.keymap.editor.table.insertRowAbove.custom,click:()=>{Ue(t,a,n,e)}}),(!_||_&&!U&&v)&&S.push({id:"insertRowBelow",icon:"iconAfter",label:window.siyuan.languages.insertRowBelow,accelerator:window.siyuan.config.keymap.editor.table.insertRowBelow.custom,click:()=>{be(t,a,n,e)}}),(Z||w)&&S.push({id:"insertColumnLeft",icon:"iconInsertLeft",label:window.siyuan.languages.insertColumnLeft,accelerator:window.siyuan.config.keymap.editor.table.insertColumnLeft.custom,click:()=>{Ke(t,e,n,"beforebegin",a)}}),(Z||k)&&S.push({id:"insertColumnRight",icon:"iconInsertRight",label:window.siyuan.languages.insertColumnRight,accelerator:window.siyuan.config.keymap.editor.table.insertColumnRight.custom,click:()=>{Ke(t,e,n,"afterend",a)}}),c.push(...S);const B=[];((!u||u&&!f&&g)&&(!h||h&&!b&&m)||(!u||u&&!f&&g)&&(!_||_&&!U&&v)||Z&&w||Z&&k)&&B.push({id:"separator_2",type:"separator"}),(!u||u&&!f&&g)&&(!h||h&&!b&&m)&&B.push({id:"moveToUp",icon:"iconUp",label:window.siyuan.languages.moveToUp,accelerator:window.siyuan.config.keymap.editor.table.moveToUp.custom,click:()=>{Nt(t,a,n,e)}}),(!u||u&&!f&&g)&&(!_||_&&!U&&v)&&B.push({id:"moveToDown",icon:"iconDown",label:window.siyuan.languages.moveToDown,accelerator:window.siyuan.config.keymap.editor.table.moveToDown.custom,click:()=>{tn(t,a,n,e)}}),Z&&w&&B.push({id:"moveToLeft",icon:"iconLeft",label:window.siyuan.languages.moveToLeft,accelerator:window.siyuan.config.keymap.editor.table.moveToLeft.custom,click:()=>{Un(t,a,n,e)}}),Z&&k&&B.push({id:"moveToRight",icon:"iconRight",label:window.siyuan.languages.moveToRight,accelerator:window.siyuan.config.keymap.editor.table.moveToRight.custom,click:()=>{Fn(t,a,n,e)}}),c.push(...B),(n.parentElement.parentElement.tagName!=="THEAD"&&(!u&&!f||u&&!f&&g)||Z)&&c.push({type:"separator"});const H=[];return n.parentElement.parentElement.tagName!=="THEAD"&&(!u&&!f||u&&!f&&g)&&H.push({id:"deleteRow",icon:"iconDeleteRow",label:window.siyuan.languages["delete-row"],accelerator:window.siyuan.config.keymap.editor.table["delete-row"].custom,click:()=>{dt(t,a,n,e)}}),Z&&H.push({id:"deleteColumn",icon:"iconDeleteColumn",label:window.siyuan.languages["delete-column"],accelerator:window.siyuan.config.keymap.editor.table["delete-column"].custom,click:()=>{rt(t,a,e,n)}}),c.push(...H),{menus:c,removeMenus:H,insertMenus:S,otherMenus:s,other2Menus:B}},MM=(t,e)=>{Array.from(e.wysiwyg.element.querySelectorAll(`[data-node-id="${t.id}"]`)).find(n=>{if(!ge(n)){const a=La(e,n,!0,!1,!0,!0);return a.doOperations[0].context={focusId:t.currentNodeID},et(e,a.doOperations,a.undoOperations),!0}})},La=(t,e,n,a,i=!0,s=!1)=>{if(e.getAttribute("data-type")==="NodeListItem"&&e.childElementCount<4)return{fold:-1};if(e.getAttribute("data-type")==="NodeThematicBreak")return{fold:-1};const r=e.getAttribute("fold")==="1";if(r){if(typeof n=="boolean"&&!n)return{fold:-1};e.removeAttribute("fold"),e.querySelectorAll(".protyle-linenumber__rows").forEach(d=>{Rf(d.parentElement)})}else{if(typeof n=="boolean"&&n)return{fold:-1};if(e.setAttribute("fold","1"),getSelection().rangeCount>0){const d=getSelection().getRangeAt(0),u=oe(d.startContainer);u&&u.getBoundingClientRect().width===0&&qt(e,void 0,!1)}si(["img","av"],e),kn(t,e)}const o=e.getAttribute("data-node-id"),l=[],c=[];return e.getAttribute("data-type")==="NodeHeading"?r?(i&&e.insertAdjacentHTML("beforeend",'<div spin="1" style="text-align: center"><img width="24px" height="24px" src="/stage/loading-pure.svg"></div>'),l.push({action:"unfoldHeading",id:o,data:a?"remove":void 0}),c.push({action:"foldHeading",id:o})):(l.push({action:"foldHeading",id:o}),c.push({action:"unfoldHeading",id:o}),Q2(e)):(l.push({action:"setAttrs",id:o,data:JSON.stringify({fold:r?"":"1"})}),c.push({action:"setAttrs",id:o,data:JSON.stringify({fold:r?"1":""})})),s||et(t,l,c),es(t),{fold:r?0:1,undoOperations:c,doOperations:l}};class yl extends Wa{constructor(e){super({app:e.app,id:e.tab.id,callback(){this.type==="local"&&ae("/api/block/checkBlockExist",{id:this.blockId},i=>{i.data||this.parent.parent.removeTab(this.parent.id)})},msgCallback(i){if(i&&this.type==="local")switch(i.cmd){case"rename":this.rootId===i.data.id&&this.parent.updateTitle(i.data.title);break;case"unmount":this.notebookId===i.data.box&&this.type==="local"&&this.parent.parent.removeTab(this.parent.id);break;case"removeDoc":i.data.ids.includes(this.rootId)&&this.type==="local"&&this.parent.parent.removeTab(this.parent.id);break}}}),this.editors=[],this.status={},this.blockId=e.blockId,this.rootId=e.rootId,this.type=e.type,this.element=e.tab.panelElement,this.element.classList.add("fn__flex-column","file-tree","sy__backlink");const n=window.siyuan.config.editor.backlinkSort,a=window.siyuan.config.editor.backmentionSort;this.element.innerHTML=`<div class="block__icons">
    <div class="block__logo">
        <svg class="block__logoicon"><use xlink:href="#iconLink"></use></svg>${window.siyuan.languages.backlinks}
    </div>
    <span class="counter listCount" style="margin-left: 0"></span>
    <span class="fn__flex-1"></span>
    <span class="fn__space"></span>
    <input class="b3-text-field search__label fn__none fn__size200" placeholder="${window.siyuan.languages.filterKeywordEnter}" />
    <span data-type="search" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.filter}"><svg><use xlink:href='#iconFilter'></use></svg></span>
    <span class="fn__space"></span>
    <span data-type="refresh" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.refresh}"><svg><use xlink:href='#iconRefresh'></use></svg></span>
    <span class="fn__space"></span>
    <span data-type="sort" data-sort="${n}" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.sort}"><svg><use xlink:href='#iconSort'></use></svg></span>
    <span class="fn__space"></span>
    <span data-type="expand" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.expand}${un(window.siyuan.config.keymap.editor.general.expand.custom)}">
        <svg><use xlink:href="#iconExpand"></use></svg>
    </span>
    <span class="fn__space"></span>
    <span data-type="collapse" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.collapse}${un(window.siyuan.config.keymap.editor.general.collapse.custom)}">
        <svg><use xlink:href="#iconContract"></use></svg>
    </span>
    <span class="${this.type==="local"?"fn__none ":""}fn__space"></span>
    <span data-type="min" class="${this.type==="local"?"fn__none ":""}block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.min}${un(window.siyuan.config.keymap.general.closeTab.custom)}"><svg><use xlink:href='#iconMin'></use></svg></span>
</div>
<div class="backlinkList fn__flex-1"></div>
<div class="block__icons">
    <div class="block__logo">
        <svg class="block__logoicon"><use xlink:href="#iconLink"></use></svg>${window.siyuan.languages.mentions}
    </div>
    <span class="counter listMCount" style="margin-left: 0;"></span>
    <span class="fn__flex-1"></span>
    <span class="fn__space"></span>
    <input class="b3-text-field search__label fn__none fn__size200" placeholder="${window.siyuan.languages.filterKeywordEnter}" />
    <span data-type="search" class="block__icon b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.filter}"><svg><use xlink:href='#iconFilter'></use></svg></span>
    <span class="fn__space"></span>
    <span data-type="mSort" data-sort="${a}" class="block__icon b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.sort}"><svg><use xlink:href='#iconSort'></use></svg></span>
    <span class="fn__space"></span>
    <span data-type="mExpand" class="block__icon b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.expand}">
        <svg><use xlink:href="#iconExpand"></use></svg>
    </span>
    <span class="fn__space"></span>
    <span data-type="mCollapse" class="block__icon b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.collapse}">
        <svg><use xlink:href="#iconContract"></use></svg>
    </span>
    <span class="fn__space"></span>
    <span data-type="layout" class="block__icon b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.down}">
        <svg><use xlink:href="#iconDown"></use></svg>
    </span>
</div>
<div class="backlinkMList fn__flex-1"></div>`,this.inputsElement=this.element.querySelectorAll("input"),this.inputsElement.forEach(i=>{i.addEventListener("blur",s=>{const r=s.target;r.classList.add("fn__none");const o=r.nextElementSibling;r.value?(o.classList.add("block__icon--active"),o.setAttribute("aria-label",window.siyuan.languages.filter+" "+r.value)):(o.classList.remove("block__icon--active"),o.setAttribute("aria-label",window.siyuan.languages.filter))}),i.addEventListener("keydown",s=>{!s.isComposing&&s.key==="Enter"&&this.searchBacklinks()})}),this.tree=new Po({element:this.element.querySelector(".backlinkList"),data:null,click:i=>{var s;this.toggleItem(i,!1),this.setFocus(),(s=this.mTree.element.querySelector(".b3-list-item--focus"))==null||s.classList.remove("b3-list-item--focus")},ctrlClick:i=>{var s;dn({app:e.app,id:i.getAttribute("data-node-id"),action:[p.CB_GET_CONTEXT]}),(s=this.mTree.element.querySelector(".b3-list-item--focus"))==null||s.classList.remove("b3-list-item--focus")},altClick(i){var s;dn({app:e.app,id:i.getAttribute("data-node-id"),position:"right",action:[p.CB_GET_FOCUS,p.CB_GET_CONTEXT]}),(s=this.mTree.element.querySelector(".b3-list-item--focus"))==null||s.classList.remove("b3-list-item--focus")},shiftClick(i){var s;dn({app:e.app,id:i.getAttribute("data-node-id"),position:"bottom",action:[p.CB_GET_FOCUS,p.CB_GET_CONTEXT]}),(s=this.mTree.element.querySelector(".b3-list-item--focus"))==null||s.classList.remove("b3-list-item--focus")},toggleClick:i=>{var s;this.toggleItem(i,!1),this.setFocus(),(s=this.mTree.element.querySelector(".b3-list-item--focus"))==null||s.classList.remove("b3-list-item--focus")}}),this.mTree=new Po({element:this.element.querySelector(".backlinkMList"),data:null,click:i=>{var s;this.toggleItem(i,!0),this.setFocus(),(s=this.tree.element.querySelector(".b3-list-item--focus"))==null||s.classList.remove("b3-list-item--focus")},ctrlClick(i){var s;dn({app:e.app,id:i.getAttribute("data-node-id"),action:[p.CB_GET_CONTEXT]}),(s=this.tree.element.querySelector(".b3-list-item--focus"))==null||s.classList.remove("b3-list-item--focus")},altClick(i){var s;dn({app:e.app,id:i.getAttribute("data-node-id"),position:"right",action:[p.CB_GET_FOCUS,p.CB_GET_CONTEXT]}),(s=this.tree.element.querySelector(".b3-list-item--focus"))==null||s.classList.remove("b3-list-item--focus")},shiftClick(i){var s;dn({app:e.app,id:i.getAttribute("data-node-id"),position:"bottom",action:[p.CB_GET_FOCUS,p.CB_GET_CONTEXT]}),(s=this.tree.element.querySelector(".b3-list-item--focus"))==null||s.classList.remove("b3-list-item--focus")},toggleClick:i=>{var s;this.toggleItem(i,!0),this.setFocus(),(s=this.tree.element.querySelector(".b3-list-item--focus"))==null||s.classList.remove("b3-list-item--focus")},blockExtHTML:`<span class="b3-list-item__action b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.more}"><svg><use xlink:href="#iconMore"></use></svg></span>`}),this.tree.element.addEventListener("scroll",()=>{this.tree.element.querySelectorAll(".protyle-gutters").forEach(i=>{i.classList.add("fn__none"),i.innerHTML=""}),this.tree.element.querySelectorAll(".protyle-wysiwyg--hl").forEach(i=>{i.classList.remove("protyle-wysiwyg--hl")})}),this.mTree.element.addEventListener("scroll",()=>{this.mTree.element.querySelectorAll(".protyle-gutters").forEach(i=>{i.classList.add("fn__none"),i.innerHTML=""}),this.mTree.element.querySelectorAll(".protyle-wysiwyg--hl").forEach(i=>{i.classList.remove("protyle-wysiwyg--hl")})}),this.element.querySelector('[data-type="collapse"]').addEventListener("click",()=>{this.tree.element.querySelectorAll(".protyle").forEach(i=>{i.classList.add("fn__none")}),this.tree.element.querySelectorAll(".b3-list-item__arrow").forEach(i=>{i.classList.remove("b3-list-item__arrow--open")})}),this.element.querySelector('[data-type="expand"]').addEventListener("click",()=>{Array.from(this.tree.element.firstElementChild.children).forEach(i=>{i.tagName==="LI"&&!i.querySelector(".b3-list-item__arrow--open")&&this.toggleItem(i,!1)})}),this.element.addEventListener("click",i=>{this.setFocus();let s=i.target;for(;s&&!s.isEqualNode(this.element);){if(s.classList.contains("block__icon")&&s.parentElement.parentElement===this.element){const r=s.getAttribute("data-type");switch(r){case"refresh":this.refresh();break;case"mExpand":Array.from(this.mTree.element.firstElementChild.children).forEach(o=>{o.tagName==="LI"&&!o.querySelector(".b3-list-item__arrow--open")&&this.toggleItem(o,!0)});break;case"mCollapse":this.mTree.element.querySelectorAll(".protyle").forEach(o=>{o.classList.add("fn__none")}),this.mTree.element.querySelectorAll(".b3-list-item__arrow").forEach(o=>{o.classList.remove("b3-list-item__arrow--open")});break;case"min":Vn("backlink").toggleModel("backlink",!1,!0);break;case"search":s.previousElementSibling.classList.remove("fn__none"),s.previousElementSibling.select();break;case"sort":case"mSort":this.showSortMenu(r,s.getAttribute("data-sort")),window.siyuan.menus.menu.popup({x:i.clientX,y:i.clientY}),i.stopPropagation();break;case"layout":this.mTree.element.style.flex?this.mTree.element.style.height==="0px"?(this.tree.element.classList.remove("fn__none"),this.mTree.element.removeAttribute("style"),s.setAttribute("aria-label",window.siyuan.languages.up),s.querySelector("use").setAttribute("xlink:href","#iconUp")):(this.tree.element.classList.remove("fn__none"),this.mTree.element.removeAttribute("style"),s.setAttribute("aria-label",window.siyuan.languages.down),s.querySelector("use").setAttribute("xlink:href","#iconDown")):s.getAttribute("aria-label")===window.siyuan.languages.down?(this.tree.element.classList.remove("fn__none"),this.mTree.element.setAttribute("style","flex:none;height:0px"),s.setAttribute("aria-label",window.siyuan.languages.up),s.querySelector("use").setAttribute("xlink:href","#iconUp")):(this.tree.element.classList.add("fn__none"),this.mTree.element.setAttribute("style",`flex:none;height:${this.element.clientHeight-this.tree.element.previousElementSibling.clientHeight*2}px`),s.setAttribute("aria-label",window.siyuan.languages.down),s.querySelector("use").setAttribute("xlink:href","#iconDown")),this.tree.element.dispatchEvent(new CustomEvent("scroll")),this.mTree.element.dispatchEvent(new CustomEvent("scroll"));break}}s=s.parentElement}}),this.searchBacklinks(!0)}setFocus(){this.type==="local"?ca(this.element.parentElement.parentElement):ca(this.element)}showSortMenu(e,n){const a=i=>{(e==="sort"?this.tree:this.mTree).element.previousElementSibling.querySelector(`[data-type="${e}"]`).setAttribute("data-sort",i);const s=parseInt(i);e==="sort"?window.siyuan.config.editor.backlinkSort=s:window.siyuan.config.editor.backmentionSort=s,ae("/api/setting/setEditor",window.siyuan.config.editor),this.searchBacklinks()};window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(new xe({icon:n==="0"?"iconSelect":void 0,label:window.siyuan.languages.fileNameASC,click:()=>{a("0")}}).element),window.siyuan.menus.menu.append(new xe({icon:n==="1"?"iconSelect":void 0,label:window.siyuan.languages.fileNameDESC,click:()=>{a("1")}}).element),window.siyuan.menus.menu.append(new xe({icon:n==="4"?"iconSelect":void 0,label:window.siyuan.languages.fileNameNatASC,click:()=>{a("4")}}).element),window.siyuan.menus.menu.append(new xe({icon:n==="5"?"iconSelect":void 0,label:window.siyuan.languages.fileNameNatDESC,click:()=>{a("5")}}).element),window.siyuan.menus.menu.append(new xe({type:"separator"}).element),window.siyuan.menus.menu.append(new xe({icon:n==="9"?"iconSelect":void 0,label:window.siyuan.languages.createdASC,click:()=>{a("9")}}).element),window.siyuan.menus.menu.append(new xe({icon:n==="10"?"iconSelect":void 0,label:window.siyuan.languages.createdDESC,click:()=>{a("10")}}).element),window.siyuan.menus.menu.append(new xe({icon:n==="2"?"iconSelect":void 0,label:window.siyuan.languages.modifiedASC,click:()=>{a("2")}}).element),window.siyuan.menus.menu.append(new xe({icon:n==="3"?"iconSelect":void 0,label:window.siyuan.languages.modifiedDESC,click:()=>{a("3")}}).element)}toggleItem(e,n){var a;const i=(a=e.firstElementChild)==null?void 0:a.firstElementChild;if(!i||i.getAttribute("disabled"))return;i.setAttribute("disabled","disabled");const s=e.getAttribute("data-node-id");if(i.classList.contains("b3-list-item__arrow--open"))i.classList.remove("b3-list-item__arrow--open"),this.editors.find((r,o)=>{if(r.protyle.block.rootID===s&&e.nextElementSibling&&r.protyle.element===e.nextElementSibling)return r.destroy(),this.editors.splice(o,1),e.nextElementSibling.remove(),!0}),i.removeAttribute("disabled");else{const r=n?this.inputsElement[1].value:this.inputsElement[0].value;ae(n?"/api/ref/getBackmentionDoc":"/api/ref/getBacklinkDoc",{defID:this.blockId,refTreeID:s,highlight:!Gs(),keyword:r},o=>{i.removeAttribute("disabled"),i.classList.add("b3-list-item__arrow--open");const l=document.createElement("div");l.style.minHeight="auto",l.setAttribute("data-defid",this.blockId),l.setAttribute("data-ismention",n?"true":"false"),e.after(l);const c=new ar(this.app,l,{blockId:s,click:{preventInsetEmptyBlock:!0},backlinkData:n?o.data.backmentions:o.data.backlinks,render:{background:!1,gutter:!0,scroll:!1,breadcrumb:!1}});c.protyle.notebookId=e.getAttribute("data-notebook-id"),Ah(c.protyle,o.data.keywords),this.editors.push(c)})}}refresh(){const e=this.element.querySelector('.block__icon[data-type="refresh"] svg');!this.blockId||e.classList.contains("fn__rotate")||(e.classList.add("fn__rotate"),ae("/api/ref/refreshBacklink",{id:this.blockId},()=>{e.classList.remove("fn__rotate"),this.searchBacklinks()}))}searchBacklinks(e=!1){const n=this.element.querySelector('.block__icon[data-type="refresh"] svg');n.classList.contains("fn__rotate")||(n.classList.add("fn__rotate"),ae("/api/ref/getBacklink2",{sort:parseInt(this.tree.element.previousElementSibling.querySelector('[data-type="sort"]').getAttribute("data-sort")).toString(),mSort:parseInt(this.mTree.element.previousElementSibling.querySelector('[data-type="mSort"]').getAttribute("data-sort")).toString(),k:this.inputsElement[0].value,mk:this.inputsElement[1].value,id:this.blockId},a=>{e||this.saveStatus(),this.render(a.data)}))}saveStatus(){this.status[this.blockId]={sort:parseInt(this.tree.element.previousElementSibling.querySelector('[data-type="sort"]').getAttribute("data-sort")),mSort:parseInt(this.mTree.element.previousElementSibling.querySelector('[data-type="mSort"]').getAttribute("data-sort")),scrollTop:this.tree.element.scrollTop,mScrollTop:this.mTree.element.scrollTop,backlinkOpenIds:[],backlinkMOpenIds:[],backlinkMStatus:3},this.tree.element.querySelectorAll(".b3-list-item__arrow--open").forEach(e=>{this.status[this.blockId].backlinkOpenIds.push(e.parentElement.parentElement.getAttribute("data-node-id"))}),this.mTree.element.querySelectorAll(".b3-list-item__arrow--open").forEach(e=>{this.status[this.blockId].backlinkMOpenIds.push(e.parentElement.parentElement.getAttribute("data-node-id"))}),this.mTree.element.style.flex?this.mTree.element.style.height==="0px"?this.status[this.blockId].backlinkMStatus=3:this.status[this.blockId].backlinkMStatus=0:this.mTree.element.previousElementSibling.querySelector('[data-type="layout"]').getAttribute("aria-label")===window.siyuan.languages.down?this.status[this.blockId].backlinkMStatus=1:this.status[this.blockId].backlinkMStatus=2}render(e){e||(e={box:"",backlinks:[],backmentions:[],linkRefsCount:0,mentionsCount:0,k:"",mk:""}),this.editors.forEach(s=>{s.destroy()}),this.editors=[],this.element.querySelector('.block__icon[data-type="refresh"] svg').classList.remove("fn__rotate"),this.notebookId=e.box,this.inputsElement[0].value=e.k,this.inputsElement[1].value=e.mk,this.tree.updateData(e.backlinks),this.mTree.updateData(e.backmentions);const n=this.element.querySelector(".listCount");e.linkRefsCount===0?n.classList.add("fn__none"):(n.classList.remove("fn__none"),n.textContent=e.linkRefsCount.toString());const a=this.element.querySelector(".listMCount");e.mentionsCount===0?a.classList.add("fn__none"):(a.classList.remove("fn__none"),a.textContent=e.mentionsCount.toString()),this.status[this.blockId]||(this.status[this.blockId]={sort:window.siyuan.config.editor.backlinkSort,mSort:window.siyuan.config.editor.backmentionSort,scrollTop:0,mScrollTop:0,backlinkOpenIds:[],backlinkMOpenIds:[],backlinkMStatus:3},e.mentionsCount===0||window.siyuan.config.editor.backmentionExpandCount===-1?this.status[this.blockId].backlinkMStatus=3:(Array.from({length:window.siyuan.config.editor.backmentionExpandCount}).forEach((s,r)=>{e.backmentions[r]&&this.status[this.blockId].backlinkMOpenIds.push(e.backmentions[r].id)}),e.mentionsCount===0?this.status[this.blockId].backlinkMStatus=3:e.linkRefsCount===0?this.status[this.blockId].backlinkMStatus=0:this.status[this.blockId].backlinkMStatus=1),e.linkRefsCount>0&&Array.from({length:window.siyuan.config.editor.backlinkExpandCount}).forEach((s,r)=>{e.backlinks[r]&&this.status[this.blockId].backlinkOpenIds.push(e.backlinks[r].id)})),this.status[this.blockId].backlinkOpenIds.forEach(s=>{const r=this.tree.element.querySelector(`.b3-list-item[data-node-id="${s}"]`);r&&this.toggleItem(r,!1)}),this.status[this.blockId].backlinkMOpenIds.forEach(s=>{const r=this.mTree.element.querySelector(`.b3-list-item[data-node-id="${s}"]`);r&&this.toggleItem(r,!0)});const i=this.mTree.element.previousElementSibling.querySelector('[data-type="layout"]');this.status[this.blockId].backlinkMStatus===2||this.status[this.blockId].backlinkMStatus===1?(this.tree.element.classList.remove("fn__none"),this.mTree.element.removeAttribute("style"),this.status[this.blockId].backlinkMStatus===1?(i.setAttribute("aria-label",window.siyuan.languages.down),i.querySelector("use").setAttribute("xlink:href","#iconDown")):(i.setAttribute("aria-label",window.siyuan.languages.up),i.querySelector("use").setAttribute("xlink:href","#iconUp"))):this.status[this.blockId].backlinkMStatus===3?(this.tree.element.classList.remove("fn__none"),this.mTree.element.setAttribute("style","flex:none;height:0px"),i.setAttribute("aria-label",window.siyuan.languages.up),i.querySelector("use").setAttribute("xlink:href","#iconUp")):(this.tree.element.classList.add("fn__none"),this.mTree.element.setAttribute("style",`flex:none;height:${this.element.clientHeight-this.tree.element.previousElementSibling.clientHeight*2}px`),i.setAttribute("aria-label",window.siyuan.languages.down),i.querySelector("use").setAttribute("xlink:href","#iconDown")),this.tree.element.previousElementSibling.querySelector('[data-type="sort"]').setAttribute("data-sort",this.status[this.blockId].sort.toString()),this.mTree.element.previousElementSibling.querySelector('[data-type="mSort"]').setAttribute("data-sort",this.status[this.blockId].mSort.toString()),setTimeout(()=>{this.tree.element.scrollTop=this.status[this.blockId].scrollTop,this.mTree.element.scrollTop=this.status[this.blockId].mScrollTop},p.TIMEOUT_LOAD)}}var FM=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const gr=(t,e,n,a)=>FM(void 0,null,function*(){var i,s,r,o,l,c,d,u,g,f,h;(i=t.observerLoad)==null||i.disconnect(),es(t);const m=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));if((m==null?void 0:m.length)>0){const H=[],j=[];let re,Te=!1;a==="Backspace"?(re=m[0].previousElementSibling,re||(Te=!0,re=m[m.length-1].nextElementSibling)):(re=m[m.length-1].nextElementSibling,Te=!0,re||(Te=!1,re=m[0].previousElementSibling));let Be,Ie;Ut(["select"],t);const Ce={};for(let Je=0;Je<m.length;Je++){const ze=m[Je],Ze=It(ze);Ie=Ze.parentElement;const ht=Ze.getAttribute("data-node-id");if(H.push({action:"delete",id:ht}),a==="Backspace"?(re=ke(Ze),re||(Te=!0,re=Fe(Ze))):(re=Fe(Ze),Te=!0,re||(Te=!1,re=ke(Ze))),!re&&!t.options.backlinkData&&(re=Ze.parentElement||t.wysiwyg.element.firstElementChild,Te=!1),Ze.getAttribute("data-type")==="NodeHeading"&&Ze.getAttribute("fold")==="1"){const De=yield wn("/api/block/getHeadingDeleteTransaction",{id:Ze.getAttribute("data-node-id")});H.push(...De.data.doOperations.slice(1));const tt=Ze.previousElementSibling?Ze.previousElementSibling.getAttribute("data-node-id"):"";De.data.undoOperations.forEach((Ve,He)=>{Ve.previousID=tt,He>0&&(Ve.context={ignoreProcess:"true"})}),j.push(...De.data.undoOperations),Ze.firstElementChild.removeAttribute("contenteditable"),Ze.remove()}else{let De=Ze.outerHTML;(Ze.classList.contains("render-node")||Ze.querySelector("div.render-node"))&&(De=t.lute.SpinBlockDOM(Ze.outerHTML));let tt=Ze.previousElementSibling?Ze.previousElementSibling.getAttribute("data-node-id"):"";if(Ze.previousElementSibling&&Ze.previousElementSibling.getAttribute("data-type")==="NodeHeading"&&Ze.previousElementSibling.getAttribute("fold")==="1"&&(((s=Ze.nextElementSibling)==null?void 0:s.getAttribute("data-type"))!=="NodeHeading"||((r=Ze.nextElementSibling)==null?void 0:r.getAttribute("data-type"))==="NodeHeading"&&((o=Ze.nextElementSibling)==null?void 0:o.getAttribute("data-subtype"))<Ze.getAttribute("data-subtype"))){const Ve=Ze.previousElementSibling.getAttribute("data-node-id");if(!Ce[Ve]){const He=yield wn("/api/block/getHeadingDeleteTransaction",{id:Ve});Ce[Ve]={element:Ze.previousElementSibling,previousID:He.data.doOperations[He.data.doOperations.length-1].id}}tt=Ce[Ve].previousID}j.push({action:"insert",data:De,id:ht,previousID:tt,parentID:Ze.parentElement.getAttribute("data-node-id")||t.block.parentID}),Ze.getAttribute("data-subtype")==="o"&&Ze.classList.contains("li")?Be=Ze.parentElement:Be=void 0,Ze.remove()}}if(Object.keys(Ce).forEach(Je=>{const ze=La(t,Ce[Je].element,!0,!1,!1,!0);H.push(...ze.doOperations),j.splice(0,0,...ze.undoOperations)}),re)if(t.block.showAll&&re.classList.contains("protyle-wysiwyg")&&t.wysiwyg.element.childElementCount===0)setTimeout(()=>{hi({protyle:t,id:t.block.parent2ID,focusId:t.block.parent2ID})},p.TIMEOUT_INPUT*2+100);else{if(re.classList.contains("protyle-wysiwyg")&&t.wysiwyg.element.childElementCount===0){const Je=Lute.NewNodeID(),ze=Fs(!1,!0,Je);re.insertAdjacentElement("afterbegin",ze),H.push({action:"insert",data:ze.outerHTML,id:Je,parentID:re.getAttribute("data-node-id")||t.block.parentID}),j.push({action:"delete",id:Je}),re=void 0,cn(ze,n)}a!=="Backspace"&&Te?qt(re):qt(re,void 0,!1),kn(t,re),Be&&(j.push({action:"update",id:Be.getAttribute("data-node-id"),data:Be.outerHTML}),xa(Be,1),H.push({action:"update",id:Be.getAttribute("data-node-id"),data:Be.outerHTML}))}if(H.length>0)if(Ie&&Ie.getAttribute("data-type")==="NodeSuperBlock"&&Ie.childElementCount===2){const Je=yield Uo(t,Ie,n);et(t,H.concat(Je.doOperations),Je.undoOperations.concat(j.reverse()))}else et(t,H,j.reverse());if(Ut(["util"],t),!re){const Je=N(t.element,"sy__backlink",!0);if(Je){const ze=mi(Je.getAttribute("data-id"),window.siyuan.layout.layout);if(ze instanceof Sa&&ze.model instanceof yl){const Ze=ze.model.editors;Ze.find((ht,De)=>{if(ht.protyle.element===t.element)return ht.destroy(),Ze.splice(De,1),ht.protyle.element.previousElementSibling.remove(),ht.protyle.element.remove(),!0})}}}return}const b=e.getAttribute("data-type");if(b==="NodeCodeBlock"&&Ee(e).textContent.trim()===""){e.classList.add("protyle-wysiwyg--select"),gr(t,e,n,a);return}if(!e.previousElementSibling&&e.parentElement.getAttribute("data-type")==="NodeBlockquote"){a!=="Delete"&&n.insertNode(document.createElement("wbr"));const H=e.parentElement;H.insertAdjacentElement("beforebegin",e),H.childElementCount===1?(et(t,[{action:"move",id:e.getAttribute("data-node-id"),previousID:(l=e.previousElementSibling)==null?void 0:l.getAttribute("data-node-id"),parentID:H.parentElement.getAttribute("data-node-id")||t.block.parentID},{action:"delete",id:H.getAttribute("data-node-id")}],[{action:"insert",id:H.getAttribute("data-node-id"),data:H.outerHTML,previousID:(c=e.previousElementSibling)==null?void 0:c.getAttribute("data-node-id"),parentID:H.parentElement.getAttribute("data-node-id")||t.block.parentID},{action:"move",id:e.getAttribute("data-node-id"),parentID:H.getAttribute("data-node-id")}]),H.remove()):et(t,[{action:"move",id:e.getAttribute("data-node-id"),previousID:(d=e.previousElementSibling)==null?void 0:d.getAttribute("data-node-id"),parentID:H.parentElement.getAttribute("data-node-id")||t.block.parentID}],[{action:"move",id:e.getAttribute("data-node-id"),parentID:H.getAttribute("data-node-id")}]),a==="Delete"?Bd(e,n,!0):cn(e,n);return}if(e.parentElement.classList.contains("li")&&e.getAttribute("data-type")!=="NodeHeading"&&e.previousElementSibling.classList.contains("protyle-action")){PM(t,e,n,a==="Delete");return}const y=ke(e);if(["NodeCodeBlock","NodeTable","NodeAttributeView"].includes(b)){if(y)if(y.classList.contains("p")&&Ee(y).textContent===""){const H=ke(y);et(t,[{action:"delete",id:y.getAttribute("data-node-id")}],[{action:"insert",data:y.outerHTML,id:y.getAttribute("data-node-id"),parentID:y.parentElement.getAttribute("data-node-id")||t.block.parentID,previousID:H&&(!y.previousElementSibling||!y.previousElementSibling.classList.contains("protyle-action"))?H.getAttribute("data-node-id"):void 0}]),y.remove()}else qt(y,void 0,!1);return}if(b==="NodeHeading"){e.previousElementSibling&&e.previousElementSibling.getAttribute("data-type")==="NodeHeading"&&e.previousElementSibling.getAttribute("fold")==="1"&&La(t,e.previousElementSibling,!0,!1,!1),e.getAttribute("data-type")==="NodeHeading"&&e.getAttribute("fold")==="1"&&La(t,e,!0,!1,!1),mr({protyle:t,selectsElement:[e],type:"Blocks2Ps",range:Bd(e,n,a==="Delete")});return}if(e.previousElementSibling&&e.previousElementSibling.classList.contains("protyle-breadcrumb__bar"))return;if(!y){if(t.wysiwyg.element.childElementCount>1&&Ee(e).textContent===""){qt(t.wysiwyg.element.firstElementChild.nextElementSibling);const H=It(e);et(t,[{action:"delete",id:H.getAttribute("data-node-id")}],[{action:"insert",data:H.outerHTML,id:H.getAttribute("data-node-id"),parentID:t.block.parentID}]),H.remove()}return}const _=e.parentElement,v=Ee(e),U=Ye(y);if(n.toString()===""&&x()&&U&&U.classList.contains("hr")&&ya(v).start===0){et(t,[{action:"delete",id:U.getAttribute("data-node-id")}],[{action:"insert",data:U.outerHTML,id:U.getAttribute("data-node-id"),previousID:(u=U.previousElementSibling)==null?void 0:u.getAttribute("data-node-id"),parentID:U.parentElement.getAttribute("data-node-id")}]),U.remove();return}const ee=U&&(U.classList.contains("table")||U.classList.contains("render-node")||U.classList.contains("iframe")||U.classList.contains("hr")||U.classList.contains("av")||U.classList.contains("code-block")),Z=U.getAttribute("data-node-id");if(ee){if(U.classList.contains("code-block")){if(v.textContent.trim()===""){const H=e.getAttribute("data-node-id"),j=[{action:"delete",id:H}],re=[{action:"insert",data:e.outerHTML,id:H,previousID:(g=e.previousElementSibling)==null?void 0:g.getAttribute("data-node-id"),parentID:e.parentElement.getAttribute("data-node-id")}];if(e.remove(),_.getAttribute("data-type")==="NodeSuperBlock"&&_.childElementCount===2){const Te=yield Uo(t,_);et(t,j.concat(Te.doOperations),Te.undoOperations.concat(re))}else et(t,j,re);qt(t.wysiwyg.element.querySelector(`[data-node-id="${Z}"]`),void 0,!1)}else qt(U,void 0,!1);return}if(v.textContent!==""||e.classList.contains("av")){qt(U,void 0,!1);return}}const k=$t(e),w=k.getAttribute("data-node-id");n.insertNode(document.createElement("wbr"));const S=[{action:"update",data:U.outerHTML,id:Z},{action:"insert",data:k.outerHTML,id:w,previousID:(f=e.previousElementSibling)==null?void 0:f.getAttribute("data-node-id"),parentID:_.getAttribute("data-node-id")}],B=[{action:"delete",id:w}];if(ee)k.remove(),qt(U,void 0,!1),S.splice(0,1);else{const H=Ee(U);if(v&&(v.textContent!==""||v.querySelector(".emoji"))&&(n.setEndAfter(v.lastChild),(((h=H==null?void 0:H.lastElementChild)==null?void 0:h.getAttribute("data-type"))||"").indexOf("inline-math")>-1)){const Ie=_t(H==null?void 0:H.lastElementChild);Ie&&Ie.textContent===`
`&&Ie.remove()}if(H){let Ie=H.lastChild;Ie&&Ie.nodeType===3&&(Ie.textContent||(Ie=zt(Ie)),Ie&&Ie.nodeType===3&&Ie.textContent.endsWith(`
`)&&(Ie.textContent=Ie.textContent.slice(0,-1)))}const j=t.contentElement.scrollTop,re=n.extractContents();n.selectNodeContents(H),n.collapse(!1),n.insertNode(re);const Te=H.innerHTML.trimStart(),Be=H.textContent.trimStart();if((Te.startsWith("```")||Te.startsWith("\xB7\xB7\xB7")||Te.startsWith("~~~")||Te.indexOf("\n```")>-1&&Be.indexOf("\n```")>-1||Te.indexOf(`
~~~`)>-1&&Be.indexOf(`
~~~`)>-1||Te.indexOf(`
\xB7\xB7\xB7`)>-1&&Be.indexOf(`
\xB7\xB7\xB7`)>-1)&&!(Te.indexOf(`
`)===-1&&Te.replace(/|~/g,"`").replace(/^`{3,}/g,"").indexOf("`")>-1)){let Ie=H.innerHTML.replace(/\n(~||`){3,}/g,"\n```").trim().replace(/^(~||`){3,}/g,"```");Ie.endsWith("\n```")||(Ie+="\n```"),H.innerHTML=Ie}U.outerHTML=t.lute.SpinBlockDOM(U.outerHTML),Ei(ke(k)),k.remove(),t.contentElement.scrollTop=j,t.scroll.lastScrollTop=j-1,B.push({action:"update",data:U.outerHTML,id:Z})}if(_.getAttribute("data-type")==="NodeSuperBlock"&&_.childElementCount===2){const H=yield Uo(t,_);et(t,B.concat(H.doOperations),H.undoOperations.concat(S))}else et(t,B,S);cn(t.wysiwyg.element,n)}),Bd=(t,e,n)=>{if(n){const a=ke(t);if(a){const i=Ee(Ye(a));if(i)return qa(i,e,!1)}}},Zv=(t,e,n,a)=>{const i=e.outerHTML,s=zt(t);s&&s.textContent.endsWith(p.ZWSP)&&(s.textContent=s.textContent.substring(0,s.textContent.length-1));const r=_t(t);r&&r.textContent.startsWith(p.ZWSP)&&(r.textContent=r.textContent.replace(p.ZWSP,"")),t.insertAdjacentHTML("afterend","<wbr>"),t.remove(),Ht(a,e.getAttribute("data-node-id"),e.outerHTML,i),cn(e,n);const o=Ee(e);o.innerHTML.trim()===""&&(o.innerHTML="")},PM=(t,e,n,a=!1)=>{var i;if(!e.parentElement.previousElementSibling&&e.parentElement.nextElementSibling&&e.parentElement.nextElementSibling.classList.contains("protyle-attr")){Uh(t,[e.parentElement],n,a,e);return}if(!e.parentElement.previousElementSibling&&e.parentElement.parentElement.parentElement.classList.contains("list")){n.insertNode(document.createElement("wbr"));const g=e.parentElement.parentElement,f=g.outerHTML,h=e.parentElement.parentElement.previousElementSibling.lastElementChild,m=h.parentElement.outerHTML;e.parentElement.firstElementChild.remove(),e.parentElement.lastElementChild.remove(),h.insertAdjacentHTML("beforebegin",e.parentElement.innerHTML),e.parentElement.remove(),g.getAttribute("data-subtype")==="o"&&xa(g),et(t,[{action:"update",id:g.getAttribute("data-node-id"),data:g.outerHTML},{action:"update",data:h.parentElement.outerHTML,id:h.parentElement.getAttribute("data-node-id")}],[{action:"update",data:m,id:h.parentElement.getAttribute("data-node-id")},{action:"update",data:f,id:g.getAttribute("data-node-id")}]),cn(h.parentElement,n);return}if(!e.parentElement.previousElementSibling){if(e.parentElement.parentElement.classList.contains("protyle-wysiwyg"))return;Bd(e,n,a),n.insertNode(document.createElement("wbr"));const g=e.parentElement.parentElement,f=g.outerHTML;e.parentElement.firstElementChild.remove(),e.parentElement.lastElementChild.remove();const h=document.createElement("div");h.innerHTML=e.parentElement.innerHTML;const m=[],b=[];if(Array.from(h.children).forEach((y,_)=>{var v;m.push({action:"insert",id:y.getAttribute("data-node-id"),data:y.outerHTML,previousID:_===0?(v=g.previousElementSibling)==null?void 0:v.getAttribute("data-node-id"):m[_-1].id,parentID:g.parentElement.getAttribute("data-node-id")||t.block.parentID}),b.push({action:"delete",id:y.getAttribute("data-node-id")})}),g.insertAdjacentHTML("beforebegin",e.parentElement.innerHTML),e.parentElement.remove(),g.getAttribute("data-subtype")==="o"&&xa(g,parseInt(g.firstElementChild.getAttribute("data-marker"))-1),m.splice(0,0,{action:"update",id:g.getAttribute("data-node-id"),data:g.outerHTML}),b.push({action:"update",data:f,id:g.getAttribute("data-node-id")}),et(t,m,b),g.parentElement.classList.contains("sb")&&g.parentElement.getAttribute("data-sb-layout")==="col"){const y=[];let _=g;for(;_&&(y.push(_),b[0].id!==_.getAttribute("data-node-id"));)_=_.previousElementSibling;Qs({protyle:t,selectsElement:y.reverse(),type:"BlocksMergeSuperBlock",level:"row"})}cn(t.wysiwyg.element,n);return}const s=e.parentElement;if(s.previousElementSibling&&s.previousElementSibling.classList.contains("protyle-breadcrumb__bar"))return;const r=s.getAttribute("data-node-id"),o=s.parentElement;Bd(e,n,a),n.insertNode(document.createElement("wbr"));const l=o.outerHTML,c=[],d=[{action:"insert",id:r,data:"",previousID:s.previousElementSibling.getAttribute("data-node-id")}],u=s.previousElementSibling.lastElementChild;if(s.previousElementSibling.getAttribute("fold")==="1")if(Ee(e).textContent.trim()===""&&e.nextElementSibling.classList.contains("protyle-attr"))c.push({action:"delete",id:r}),d[0].data=s.outerHTML,qa(Ee(s.previousElementSibling),n),n.collapse(!0),s.remove();else{qa(Ee(s.previousElementSibling),n),n.collapse(!0),Pt(n),(i=e.querySelector("wbr"))==null||i.remove();return}else{let g=u.previousElementSibling.getAttribute("data-node-id");Array.from(e.parentElement.children).forEach((f,h)=>{if(f.classList.contains("protyle-action")||f.classList.contains("protyle-attr"))return;const m=f.getAttribute("data-node-id");c.push({action:"move",id:m,previousID:g}),d.push({action:"move",id:m,previousID:h===1?void 0:g,parentID:r}),g=m,u.before(f)}),c.push({action:"delete",id:r}),d[0].data=s.outerHTML,s.remove()}o.classList.contains("protyle-wysiwyg")?et(t,c,d):(o.getAttribute("data-subtype")==="o"&&xa(o),Ht(t,o.getAttribute("data-node-id"),o.outerHTML,l)),cn(u.parentElement,n)},xa=(t,e)=>{if(t.getAttribute("data-subtype")!=="o")return;let n;Array.from(t.children).forEach((a,i)=>{a.classList.contains("li")&&(i===0?e?(n=e,a.setAttribute("data-marker",n+"."),a.querySelector(".protyle-action--order").textContent=n+"."):n=parseInt(a.getAttribute("data-marker")):a.classList.contains("li")&&(n++,a.setAttribute("data-marker",n+"."),a.querySelector(".protyle-action--order").textContent=n+"."))})},$d=(t,e=0,n=!1)=>{const a=document.createElement("template"),i=t.getAttribute("data-subtype");if(i==="o"){const s=parseInt(t.getAttribute("data-marker"))+e;a.innerHTML=`<div data-marker="${s+1}." data-subtype="${i}" data-node-id="${Lute.NewNodeID()}" data-type="NodeListItem" class="li"><div contenteditable="false" class="protyle-action protyle-action--order" draggable="true">${s+1}.</div>${i_(!1,n)}<div class="protyle-attr" contenteditable="false"></div></div>`}else i==="t"?a.innerHTML=`<div data-marker="*" data-subtype="${i}" data-node-id="${Lute.NewNodeID()}" data-type="NodeListItem" class="li"><div class="protyle-action protyle-action--task" draggable="true"><svg><use xlink:href="#iconUncheck"></use></svg></div>${i_(!1,n)}<div class="protyle-attr" contenteditable="false"></div></div>`:a.innerHTML=`<div data-marker="*" data-subtype="${i}" data-node-id="${Lute.NewNodeID()}" data-type="NodeListItem" class="li"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div>${i_(!1,n)}<div class="protyle-attr" contenteditable="false"></div></div>`;return a.content.firstElementChild},NM=(t,e,n)=>{var a;const i=N(e,"li");if(!i)return;const s=(a=i.querySelector(".list"))==null?void 0:a.lastElementChild.previousElementSibling;if(!s)return;const r=$d(s,0,!0),o=r.getAttribute("data-node-id");s.after(r),s.parentElement.getAttribute("fold")==="1"&&La(t,s.parentElement,!0),i.getAttribute("fold")==="1"&&La(t,i,!0),et(t,[{action:"insert",id:o,data:r.outerHTML,previousID:s.getAttribute("data-node-id")}],[{action:"delete",id:o}]),cn(r,n)},Jv=(t,e,n)=>{if(e.forEach(s=>{s.removeAttribute("select-start"),s.removeAttribute("select-end")}),!e[0].classList.contains("li"))if(e[0].parentElement.childElementCount===e.length+2)e=[e[0].parentElement];else return;const a=e[0].previousElementSibling;if(!a)return;n.collapse(!1),n.insertNode(document.createElement("wbr"));const i=a.parentElement.outerHTML;if(a.lastElementChild.previousElementSibling.getAttribute("data-type")==="NodeList"){const s=a.lastElementChild.previousElementSibling.outerHTML,r=[],o=[],l=a.lastElementChild.previousElementSibling.getAttribute("data-subtype");let c=a.lastElementChild.previousElementSibling.lastElementChild.previousElementSibling.getAttribute("data-node-id");e.forEach((d,u)=>{r.push({action:"move",id:d.getAttribute("data-node-id"),previousID:c}),o.push({action:"move",id:d.getAttribute("data-node-id"),previousID:u===0?a.getAttribute("data-node-id"):c}),c=d.getAttribute("data-node-id"),d.setAttribute("data-subtype",l);const g=d.querySelector(".protyle-action");l==="o"?(g.classList.add("protyle-action--order"),g.classList.remove("protyle-action--task"),a.lastElementChild.previousElementSibling.lastElementChild.before(d)):l==="t"?(d.setAttribute("data-marker","*"),g.innerHTML=`<svg><use xlink:href="#icon${d.classList.contains("protyle-task--done")?"Check":"Uncheck"}"></use></svg>`,g.classList.remove("protyle-action--order"),g.classList.add("protyle-action--task"),a.lastElementChild.previousElementSibling.lastElementChild.before(d)):(d.setAttribute("data-marker","*"),g.innerHTML='<svg><use xlink:href="#iconDot"></use></svg>',g.classList.remove("protyle-action--order","protyle-action--task"),a.lastElementChild.previousElementSibling.lastElementChild.before(d))}),l==="o"?(xa(a.lastElementChild.previousElementSibling),xa(a.parentElement)):a.getAttribute("data-subtype")==="o"&&xa(a.parentElement),a.parentElement.classList.contains("protyle-wysiwyg")&&(r.push({action:"update",data:a.lastElementChild.previousElementSibling.outerHTML,id:a.lastElementChild.previousElementSibling.getAttribute("data-node-id")}),o.push({action:"update",data:s,id:a.lastElementChild.previousElementSibling.getAttribute("data-node-id")}),et(t,r,o))}else{const s=a.outerHTML,r=e[0].getAttribute("data-subtype"),o=document.createElement("div"),l=Lute.NewNodeID();o.setAttribute("data-node-id",l),o.setAttribute("data-type","NodeList"),o.setAttribute("class","list"),o.setAttribute("data-subtype",r),o.innerHTML='<div class="protyle-attr" contenteditable="false"></div>';const c=[{action:"insert",data:o.outerHTML,id:l,previousID:a.lastElementChild.previousElementSibling.getAttribute("data-node-id")}];a.lastElementChild.before(o);const d=[];let u;e.forEach((g,f)=>{c.push({action:"move",id:g.getAttribute("data-node-id"),parentID:l,previousID:u}),d.push({action:"move",id:g.getAttribute("data-node-id"),previousID:f===0?a.getAttribute("data-node-id"):u}),u=g.getAttribute("data-node-id"),o.lastElementChild.before(g)}),d.push({action:"delete",id:l}),r==="o"&&(xa(o,1),xa(a.parentElement)),a.parentElement.classList.contains("protyle-wysiwyg")&&(c.push({action:"update",data:a.outerHTML,id:a.getAttribute("data-node-id")}),d.push({action:"update",data:s,id:a.getAttribute("data-node-id")}),et(t,c,d))}a.parentElement.classList.contains("protyle-wysiwyg")||Ht(t,a.parentElement.getAttribute("data-node-id"),a.parentElement.outerHTML,i),cn(a,n)},BM=(t,e,n)=>{var a,i;const s=e.parentElement;if(!s.previousElementSibling){gr(t,e,n,"Backspace");return}const r=s.getAttribute("data-node-id"),o=[],l=[];n.insertNode(document.createElement("wbr"));const c=Lute.NewNodeID();let d="",u=0;Array.from(s.parentElement.children).forEach(f=>{!u&&f===s?u=1:u&&!f.classList.contains("protyle-attr")&&(l.push({id:f.getAttribute("data-node-id"),action:"move",previousID:r}),o.push({id:f.getAttribute("data-node-id"),action:"delete"}),f.getAttribute("data-subtype")==="o"&&(l.push({id:f.getAttribute("data-node-id"),action:"update",data:f.outerHTML}),f.setAttribute("data-marker",u+"."),f.firstElementChild.innerHTML=u+"."),d+=f.outerHTML,f.remove(),u++)}),l.reverse(),d=`<div data-subtype="${s.getAttribute("data-subtype")}" data-node-id="${c}" data-type="NodeList" class="list" updated="${at().format("YYYYMMDDHHmmss")}">${d}<div class="protyle-attr" contenteditable="false">${p.ZWSP}</div></div>`,s.parentElement.insertAdjacentHTML("afterend",d),o.push({id:c,action:"insert",previousID:s.parentElement.getAttribute("data-node-id"),data:d}),l.push({id:c,action:"delete"}),Array.from(s.children).reverse().forEach(f=>{!f.classList.contains("protyle-action")&&!f.classList.contains("protyle-attr")&&(o.push({id:f.getAttribute("data-node-id"),action:"move",previousID:s.parentElement.getAttribute("data-node-id")}),l.push({id:f.getAttribute("data-node-id"),action:"move",parentID:r}),s.parentElement.after(f))});const g=s.parentElement.getAttribute("data-node-id");s.parentElement.childElementCount===2?(l.splice(0,0,{id:g,action:"insert",data:s.parentElement.outerHTML,previousID:(a=s.parentElement.previousElementSibling)==null?void 0:a.getAttribute("data-node-id"),parentID:s.parentElement.parentElement.getAttribute("data-node-id")||t.block.rootID}),s.parentElement.remove(),o.push({id:g,action:"delete"})):(l.splice(0,0,{id:r,action:"insert",data:s.outerHTML,previousID:(i=s.previousElementSibling)==null?void 0:i.getAttribute("data-node-id"),parentID:g}),s.remove(),o.push({id:r,action:"delete"})),et(t,o,l),cn(t.wysiwyg.element,n)},Uh=(t,e,n,a=!1,i)=>{var s,r,o,l,c,d,u,g;if(e.forEach(w=>{w.removeAttribute("select-start"),w.removeAttribute("select-end")}),!e[0].classList.contains("li"))if(e[0].parentElement.childElementCount===e.length+2)e=[e[0].parentElement];else return;const f=e[0].parentElement,h=f.getAttribute("data-node-id");if(!h)return;const m=f.parentElement,b=m.parentElement;if((s=f.previousElementSibling)!=null&&s.classList.contains("protyle-action")&&!b.getAttribute("data-node-id"))return;if(m.classList.contains("protyle-wysiwyg")||m.classList.contains("sb")||m.classList.contains("bq")){const w=[],S=[];n.collapse(!1),Bd(i,n,a),n.insertNode(document.createElement("wbr"));let B;!e[0].previousElementSibling&&f.getAttribute("data-subtype")==="o"&&(B=parseInt(e[0].getAttribute("data-marker")));let H=h,j=f,re=e[e.length-1].nextElementSibling,Te=e[e.length-1].lastElementChild.previousElementSibling;if(e.forEach(Ie=>{Array.from(Ie.children).forEach((Ce,Je)=>{const ze=Ce.getAttribute("data-node-id");ze&&(w.push({action:"move",id:ze,previousID:H,parentID:m.getAttribute("data-node-id")||t.block.parentID}),S.push({action:"move",id:ze,previousID:Je===1?void 0:H,parentID:Ie.getAttribute("data-node-id"),data:Ce.contains(n.startContainer)?"focus":""}),H=ze,j.after(Ce),j=Ce)})}),!window.siyuan.config.editor.listLogicalOutdent&&!re.classList.contains("protyle-attr")){let Ie;Te.getAttribute("data-subtype")!==re.getAttribute("data-subtype")&&(Ie=Lute.NewNodeID(),Te=document.createElement("div"),Te.classList.add("list"),Te.setAttribute("data-subtype",re.getAttribute("data-subtype")),Te.setAttribute("data-node-id",Ie),Te.setAttribute("data-type","NodeList"),Te.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Te.innerHTML=`<div class="protyle-attr" contenteditable="false">${p.ZWSP}</div>`,j.after(Te),w.push({action:"insert",id:Ie,data:Te.outerHTML,previousID:j.getAttribute("data-node-id")}));let Ce;for(;re&&!re.classList.contains("protyle-attr");){w.push({action:"move",id:re.getAttribute("data-node-id"),previousID:Ce||((r=Te.lastElementChild.previousElementSibling)==null?void 0:r.getAttribute("data-node-id")),parentID:Te.getAttribute("data-node-id")}),S.push({action:"move",id:re.getAttribute("data-node-id"),parentID:Te.getAttribute("data-node-id"),previousID:Ce||((o=re.previousElementSibling)==null?void 0:o.getAttribute("data-node-id"))}),Ce=re.getAttribute("data-node-id");const Je=re;re=re.nextElementSibling,Te.lastElementChild.before(Je)}Te.getAttribute("data-subtype")==="o"&&(Array.from(Te.children).forEach(Je=>{const ze=Je.getAttribute("data-node-id");ze&&S.push({action:"update",id:ze,data:Je.outerHTML})}),xa(Te,1),Array.from(Te.children).forEach(Je=>{const ze=Je.getAttribute("data-node-id");ze&&w.push({action:"update",id:ze,data:Je.outerHTML})})),Ie&&S.push({action:"delete",id:Ie})}const Be=f.outerHTML;e.forEach(Ie=>{Ie.remove()}),f.childElementCount===1?(w.push({action:"delete",id:h}),h===t.block.id&&(t.block.id=t.block.parentID),S.splice(0,0,{action:"insert",data:Be,id:h,previousID:(l=f.previousElementSibling)==null?void 0:l.getAttribute("data-node-id"),parentID:m.getAttribute("data-node-id")||t.block.parentID}),f.remove()):(f.getAttribute("data-subtype")==="o"&&xa(f,B),w.push({action:"update",id:h,data:f.outerHTML}),S.splice(0,0,{action:"update",id:h,data:Be})),et(t,w,S),f.childElementCount!==1&&m.classList.contains("sb")&&m.getAttribute("data-sb-layout")==="col"&&Qs({protyle:t,selectsElement:[f,f.nextElementSibling],type:"BlocksMergeSuperBlock",level:"row"}),cn(m,n);return}if(f.childElementCount===2&&m.childElementCount===3){n.collapse(!1),Bd(i,n,a),n.insertNode(document.createElement("wbr"));const w=m.outerHTML;e[0].firstElementChild.remove(),e[0].lastElementChild.remove(),f.outerHTML=e[0].innerHTML,Ht(t,m.getAttribute("data-node-id"),m.outerHTML,w),cn(m,n);return}n.collapse(!1),Bd(i,n,a),n.insertNode(document.createElement("wbr"));const y=[],_=[],v=(c=e[0].previousElementSibling)==null?void 0:c.getAttribute("data-node-id");let U;!e[0].previousElementSibling&&f.getAttribute("data-subtype")==="o"&&(U=parseInt(e[0].getAttribute("data-marker")));const ee=m.parentElement.outerHTML;let Z=e[e.length-1].nextElementSibling,k=e[e.length-1].lastElementChild.previousElementSibling;if(e.reverse().forEach(w=>{const S=w.getAttribute("data-node-id");y.push({action:"move",id:S,previousID:m.getAttribute("data-node-id")}),_.push({action:"move",id:S,previousID:v,parentID:f.getAttribute("data-node-id")}),m.after(w),(w.getAttribute("data-subtype")==="o"||w.getAttribute("data-subtype")==="t")&&m.getAttribute("data-subtype")==="u"?(_.push({action:"update",id:S,data:w.outerHTML}),w.querySelector(".protyle-action").outerHTML='<div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div>',w.setAttribute("data-subtype","u"),w.setAttribute("data-marker","*"),w.classList.remove("protyle-task--done"),y.push({action:"update",id:S,data:w.outerHTML})):(w.getAttribute("data-subtype")==="u"||w.getAttribute("data-subtype")==="t")&&m.getAttribute("data-subtype")==="o"?(_.push({action:"update",id:S,data:w.outerHTML}),w.querySelector(".protyle-action").outerHTML='<div contenteditable="false" draggable="true" class="protyle-action protyle-action--order">1.</div>',w.setAttribute("data-subtype","o"),w.setAttribute("data-marker","1."),y.push({action:"update",id:S,data:w.outerHTML})):(w.getAttribute("data-subtype")==="u"||w.getAttribute("data-subtype")==="o")&&m.getAttribute("data-subtype")==="t"&&(_.push({action:"update",id:S,data:w.outerHTML}),w.querySelector(".protyle-action").outerHTML='<div class="protyle-action protyle-action--task" draggable="true"><svg><use xlink:href="#iconUncheck"></use></svg></div>',w.setAttribute("data-subtype","t"),w.setAttribute("data-marker","*"),y.push({action:"update",id:S,data:w.outerHTML}))}),!window.siyuan.config.editor.listLogicalOutdent&&!Z.classList.contains("protyle-attr")){let w;k.classList.contains("list")||(w=Lute.NewNodeID(),k=document.createElement("div"),k.classList.add("list"),k.setAttribute("data-subtype",Z.getAttribute("data-subtype")),k.setAttribute("data-node-id",w),k.setAttribute("data-type","NodeList"),k.setAttribute("updated",at().format("YYYYMMDDHHmmss")),k.innerHTML=`<div class="protyle-attr" contenteditable="false">${p.ZWSP}</div>`,y.push({action:"insert",id:w,data:k.outerHTML,previousID:e[0].lastElementChild.previousElementSibling.getAttribute("data-node-id")}),e[0].lastElementChild.before(k));let S;for(;Z&&!Z.classList.contains("protyle-attr");){const B=Z.getAttribute("data-node-id");Z.getAttribute("data-subtype")!==k.getAttribute("data-subtype")&&(_.push({action:"update",id:B,data:Z.outerHTML}),Z.querySelector(".protyle-action").outerHTML=k.querySelector(".protyle-action").outerHTML,Z.setAttribute("data-subtype",k.getAttribute("data-subtype")),Z.setAttribute("data-marker",k.getAttribute("data-marker")),y.push({action:"update",id:B,data:Z.outerHTML})),y.push({action:"move",id:B,previousID:S||((d=k.lastElementChild.previousElementSibling)==null?void 0:d.getAttribute("data-node-id")),parentID:k.getAttribute("data-node-id")}),_.push({action:"move",id:B,previousID:S||((u=k.parentElement)==null?void 0:u.getAttribute("data-node-id"))}),S=B;const H=Z;Z=Z.nextElementSibling,k.lastElementChild.before(H)}k.getAttribute("data-subtype")==="o"&&(Array.from(k.children).forEach(B=>{const H=B.getAttribute("data-node-id");H&&_.push({action:"update",id:H,data:B.outerHTML})}),xa(k,1),Array.from(k.children).forEach(B=>{const H=B.getAttribute("data-node-id");H&&y.push({action:"update",id:H,data:B.outerHTML})})),w&&_.push({action:"delete",id:w})}if(!window.siyuan.config.editor.listLogicalOutdent&&f.nextElementSibling){Z=f.nextElementSibling;let w;for(;Z&&!Z.classList.contains("protyle-attr");){const S=Z.getAttribute("data-node-id");y.push({action:"move",id:S,previousID:w||k.getAttribute("data-node-id")}),_.push({action:"move",id:S,previousID:w||f.getAttribute("data-node-id")}),w=S;const B=Z;Z=Z.nextElementSibling,k.after(B),k=B}}f.childElementCount===1&&m.childElementCount===3?(y.push({action:"delete",id:m.getAttribute("data-node-id")}),_.splice(0,0,{action:"insert",id:m.getAttribute("data-node-id"),data:m.outerHTML,previousID:(g=m.previousElementSibling)==null?void 0:g.getAttribute("data-node-id"),parentID:m.parentElement.getAttribute("data-node-id")}),m.remove()):f.childElementCount===1?(y.push({action:"delete",id:f.getAttribute("data-node-id")}),_.splice(0,0,{action:"insert",id:f.getAttribute("data-node-id"),data:f.outerHTML,previousID:f.previousElementSibling.getAttribute("data-node-id")}),f.remove()):f.getAttribute("data-subtype")==="o"&&(_.splice(0,0,{action:"update",data:f.outerHTML,id:f.getAttribute("data-node-id")}),xa(f,U),y.push({action:"update",data:f.outerHTML,id:f.getAttribute("data-node-id")})),b.classList.contains("protyle-wysiwyg")?et(t,y,_):(m&&m.getAttribute("data-subtype")==="o"&&xa(b),Ht(t,b.getAttribute("data-node-id"),b.outerHTML,ee)),cn(b,n)};var $M=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const Uo=(t,e,n)=>$M(void 0,null,function*(){var a;const i=[],s=[];let r=e.previousElementSibling?e.previousElementSibling.getAttribute("data-node-id"):void 0;e.classList.remove("protyle-wysiwyg--select"),e.removeAttribute("select-start"),e.removeAttribute("select-end");const o=e.getAttribute("data-node-id"),l=e.cloneNode();l.innerHTML=e.lastElementChild.outerHTML;let c=(a=e.parentElement)==null?void 0:a.getAttribute("data-node-id");if(!r&&!c)if(t.block.showAll||t.options.backlinkData){const d=yield wn("/api/block/getBlockSiblingID",{id:o});r=d.data.previous,c=d.data.parent}else c=t.block.rootID;return s.push({action:"insert",id:o,data:l.outerHTML,previousID:r,parentID:c}),Array.from(e.children).forEach((d,u)=>{if(u===e.childElementCount-1){i.push({action:"delete",id:o}),n&&Ee(e).insertAdjacentHTML("afterbegin","<wbr>"),e.lastElementChild.remove(),e.replaceWith(...e.children),n&&cn(t.wysiwyg.element,n);return}i.push({action:"move",id:d.getAttribute("data-node-id"),previousID:r,parentID:c}),s.push({action:"move",id:d.getAttribute("data-node-id"),previousID:d.previousElementSibling?d.previousElementSibling.getAttribute("data-node-id"):void 0,parentID:o}),r=d.getAttribute("data-node-id")}),Ei(t.wysiwyg.element),i.forEach(d=>{const u=t.wysiwyg.element.querySelector(`[data-node-id="${d.id}"]`);u&&u.getAttribute("data-type")==="NodeBlockQueryEmbed"&&(u.removeAttribute("data-render"),$n(t,u))}),{doOperations:i,undoOperations:s,previousId:r}}),AS=(t,e,n)=>{const a=document.createElement("div");return a.setAttribute("data-node-id",e||Lute.NewNodeID()),a.setAttribute("data-type","NodeSuperBlock"),a.setAttribute("class","sb"),a.setAttribute("data-sb-layout",t),a.innerHTML=n||`<div class="protyle-attr" contenteditable="false">${p.ZWSP}</div>`,a},Cf=(t,e,n)=>{ae("/api/block/getBlockSiblingID",{id:e.getAttribute("data-node-id")},a=>{const i=a.data[n];i&&dn({app:t.app,id:i,action:i!==t.block.rootID&&t.block.showAll?[p.CB_GET_ALL,p.CB_GET_FOCUS]:[p.CB_GET_FOCUS]})})},Ms=(t,e,n)=>{var a;const i=hn(t.wysiwyg.element);let s;if(n)s=t.wysiwyg.element.querySelector(`[data-node-id="${n}"]`);else{const d=t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");d.length>0?(e==="beforebegin"?s=d[0]:s=d[d.length-1],Ut(["select"],t)):(s=oe(i.startContainer),s=It(s),s.classList.contains("list")?s=N(i.startContainer,"li"):s.classList.contains("bq")&&(s=oe(i.startContainer)))}if(!s)return;(a=t.observerLoad)==null||a.disconnect();let r=Fs(!1,!0),o=1;s.getAttribute("data-type")==="NodeListItem"?(r=$d(s,0,!0),o=parseInt(s.parentElement.firstElementChild.getAttribute("data-marker"))):e==="beforebegin"&&s.previousElementSibling&&s.previousElementSibling.getAttribute("data-type")==="NodeHeading"&&s.previousElementSibling.getAttribute("fold")==="1"?r=Hh(s.previousElementSibling,!1,!0):e==="afterend"&&s&&s.getAttribute("data-type")==="NodeHeading"&&s.getAttribute("fold")==="1"&&(r=Hh(s,!1,!0));const l=s.parentElement.outerHTML,c=r.getAttribute("data-node-id");if(s.insertAdjacentElement(e,r),s.getAttribute("data-type")==="NodeListItem"&&s.getAttribute("data-subtype")==="o"&&!r.parentElement.classList.contains("protyle-wysiwyg"))xa(r.parentElement,o),Ht(t,r.parentElement.getAttribute("data-node-id"),r.parentElement.outerHTML,l);else{let d;e==="beforebegin"?d=[{action:"insert",data:r.outerHTML,id:c,nextID:s.getAttribute("data-node-id")}]:d=[{action:"insert",data:r.outerHTML,id:c,previousID:s.getAttribute("data-node-id")}],et(t,d,[{action:"delete",id:c}])}s.parentElement.classList.contains("sb")&&s.parentElement.getAttribute("data-sb-layout")==="col"&&Qs({protyle:t,selectsElement:e==="afterend"?[s,s.nextElementSibling]:[s.previousElementSibling,s],type:"BlocksMergeSuperBlock",level:"row"}),cn(t.wysiwyg.element,i),kn(t)},i_=(t=!0,e=!0,n)=>{let a="";return t&&(a=p.ZWSP),e&&(a+="<wbr>"),n&&(a+=n),`<div data-node-id="${Lute.NewNodeID()}" data-type="NodeParagraph" class="p"><div contenteditable="true" spellcheck="${window.siyuan.config.editor.spellcheck}">${a}</div><div contenteditable="false" class="protyle-attr">${p.ZWSP}</div></div>`},Fs=(t=!0,e=!0,n)=>{const a=document.createElement("div");return a.setAttribute("data-node-id",n||Lute.NewNodeID()),a.setAttribute("data-type","NodeParagraph"),a.classList.add("p"),a.innerHTML=`<div contenteditable="true" spellcheck="${window.siyuan.config.editor.spellcheck}">${t?p.ZWSP:""}${e?"<wbr>":""}</div><div class="protyle-attr" contenteditable="false">${p.ZWSP}</div>`,a},Hh=(t,e=!1,n=!1)=>{const a=`<div data-subtype="${t.getAttribute("data-subtype")}" data-node-id="${Lute.NewNodeID()}" data-type="NodeHeading" class="${t.className}"><div contenteditable="true" spellcheck="false">${n?"<wbr>":""}</div><div class="protyle-attr" contenteditable="false">${p.ZWSP}</div></div>`;if(e)return a;{const i=document.createElement("template");return i.innerHTML=a,i.content.firstElementChild}},OM=t=>{let e=t;switch(t){case"NodeIFrame":e="IFrame";break;case"NodeAttributeView":e=window.siyuan.languages.database;break;case"NodeThematicBreak":e=window.siyuan.languages.line;break;case"NodeWidget":e=window.siyuan.languages.widget;break;case"NodeVideo":e=window.siyuan.languages.video;break;case"NodeAudio":e=window.siyuan.languages.audio;break;case"NodeBlockQueryEmbed":e=window.siyuan.languages.blockEmbed;break}return e},RM=(t,e,n,a,i)=>{var s;if(e!=="NodeCodeBlock"&&!((s=n.previousElementSibling)!=null&&s.classList.contains("protyle-action--task"))&&(["[ ]","[x]","[X]","\u3010 \u3011","\u3010x\u3011","\u3010X\u3011"].includes(a.innerHTML.substring(0,3))||["[]","\u3010\u3011"].includes(a.innerHTML.substring(0,2)))){const r=a.innerHTML.indexOf("\u3011")+1;let o=a.innerHTML.indexOf("]")+1;o===0?o=r:o>0&&r>0&&(o=Math.min(o,r)),a.removeAttribute("placeholder");const l=a.innerHTML.substring(1,2).toLowerCase()==="x";if(n.parentElement.classList.contains("li")&&n.parentElement.childElementCount===3){if(!n.parentElement.parentElement.classList.contains("protyle-wysiwyg")&&n.parentElement.parentElement.childElementCount===2){const c=n.parentElement.parentElement,d=c.outerHTML;return c.setAttribute("data-subtype","t"),c.setAttribute("updated",at().format("YYYYMMDDHHmmss")),n.parentElement.setAttribute("data-subtype","t"),l&&n.parentElement.classList.add("protyle-task--done"),n.previousElementSibling.outerHTML=`<div class="protyle-action protyle-action--task" draggable="true"><svg><use xlink:href="#icon${l?"C":"Unc"}heck"></use></svg></div>`,a.innerHTML=a.innerHTML.substring(o),Ht(t,c.getAttribute("data-node-id"),c.outerHTML,d),cn(t.wysiwyg.element,i),!0}return!1}else{const c=n.getAttribute("data-node-id"),d=Lute.NewNodeID(),u=Lute.NewNodeID(),g=Lute.NewNodeID(),f=n.outerHTML;return a.innerHTML=a.innerHTML.substring(o),et(t,[{action:"update",id:c,data:n.outerHTML},{action:"insert",id:d,data:`<div data-subtype="t" data-node-id="${d}" updated="${d.split("-")[0]}" data-type="NodeList" class="list"><div data-marker="*" data-subtype="t" data-node-id="${g}" data-type="NodeListItem" class="li${l?" protyle-task--done":""}" updated="${g.split("-")[0]}"><div class="protyle-action protyle-action--task" draggable="true"><svg><use xlink:href="#icon${l?"C":"Unc"}heck"></use></svg></div><div data-node-id="${u}" data-type="NodeParagraph" class="p"><div contenteditable="true" spellcheck="${window.siyuan.config.editor.spellcheck}"></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div>`,previousID:c},{action:"move",id:c,previousID:u},{action:"delete",id:u}],[{action:"move",id:c,previousID:d},{action:"delete",id:d},{action:"update",id:c,data:f}]),n.outerHTML=`<div data-subtype="t" data-node-id="${d}" data-type="NodeList" class="list" updated="${d.split("-")[0]}"><div data-marker="*" data-subtype="t" data-node-id="${g}" data-type="NodeListItem" class="li${l?" protyle-task--done":""}" updated="${g.split("-")[0]}"><div class="protyle-action protyle-action--task" draggable="true"><svg><use xlink:href="#icon${l?"C":"Unc"}heck"></use></svg></div>${n.outerHTML}<div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div>`,cn(t.wysiwyg.element,i),!0}}return!1},UM=(t,e,n,a,i)=>{if(e==="NodeHeading"&&["* ","- "].includes(a.innerHTML.substring(0,2))&&n.parentElement.getAttribute("data-type")!=="NodeListItem"){const s=n.getAttribute("data-node-id"),r=Lute.NewNodeID(),o=Lute.NewNodeID(),l=Lute.NewNodeID(),c=n.outerHTML,d=a.innerHTML.substring(0,1);return a.innerHTML=a.innerHTML.substring(2),et(t,[{action:"update",id:s,data:n.outerHTML},{action:"insert",id:r,data:`<div data-subtype="u" data-node-id="${r}" data-type="NodeList" class="list" updated="${r.split("-")[0]}"><div data-marker="${d}" data-subtype="u" data-node-id="${l}" data-type="NodeListItem" class="li" updated="${l.split("-")[0]}"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="${o}" data-type="NodeParagraph" class="p"><div contenteditable="true" spellcheck="${window.siyuan.config.editor.spellcheck}"></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div>`,previousID:s},{action:"move",id:s,previousID:o},{action:"delete",id:o}],[{action:"update",id:s,data:c},{action:"move",id:s,previousID:r},{action:"delete",id:r}]),n.outerHTML=`<div data-subtype="u" data-node-id="${r}" data-type="NodeList" class="list" updated="${r.split("-")[0]}"><div data-marker="${d}" data-subtype="u" data-node-id="${l}" data-type="NodeListItem" class="li" updated="${l.split("-")[0]}"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div>${n.outerHTML}<div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div>`,cn(t.wysiwyg.element,i),!0}return!1};var HM=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const s_=(t,e,n,a=!0,i)=>HM(void 0,null,function*(){var s,r,o,l,c,d;if(!e.parentElement)return;if(e.classList.contains("av")){const Z=N(n.startContainer,"av__cursor");Z?Z.textContent=p.ZWSP:ox(t,e);return}const u=Ee(e),g=e.getAttribute("data-type");if(!u){g==="NodeThematicBreak"?e.innerHTML="<div><wbr></div>":g==="NodeBlockQueryEmbed"?e.lastElementChild.previousElementSibling.innerHTML="<wbr>"+p.ZWSP:g==="NodeMathBlock"||g==="NodeHTMLBlock"?(e.firstElementChild.firstChild.nodeType===3&&e.firstElementChild.firstChild.remove(),e.lastElementChild.previousElementSibling.lastElementChild.innerHTML="<wbr>"+p.ZWSP):g==="NodeIFrame"||g==="NodeWidget"?e.innerHTML="<wbr>"+e.firstElementChild.outerHTML+e.lastElementChild.outerHTML:g==="NodeVideo"?e.firstElementChild.innerHTML="<wbr>"+p.ZWSP+e.firstElementChild.firstElementChild.outerHTML+e.firstElementChild.lastElementChild.outerHTML:g==="NodeAudio"?e.firstElementChild.innerHTML=e.firstElementChild.firstElementChild.outerHTML+"<wbr>"+p.ZWSP:g==="NodeCodeBlock"&&(n.startContainer.textContent=p.ZWSP),cn(e,n);return}e.setAttribute("updated",at().format("YYYYMMDDHHmmss"));const f=document.createElement("wbr");if(n.insertNode(f),i){const Z=_t(f);if(i.inputType==="deleteContentForward"&&Z&&Z.nodeType===1&&!Z.textContent.startsWith(p.ZWSP)){const k=(Z.getAttribute("data-type")||"").split(" ");(k.includes("code")||k.includes("kbd")||k.includes("tag"))&&Z.insertAdjacentElement("afterbegin",f)}if((i.inputType==="deleteContentBackward"||i.inputType==="deleteContentForward")&&Z&&Z.nodeType===1&&Z.tagName==="BR"){const k=_t(Z);k&&k.nodeType===1&&((s=k.getAttribute("data-type"))==null?void 0:s.indexOf("inline-math"))>-1&&Z.remove(),i.inputType==="deleteContentBackward"&&((r=Z.previousSibling.previousSibling)!=null&&r.textContent.endsWith(`
`))&&(Z.outerHTML=`
`)}}const h=e.getAttribute("data-node-id");if(g!=="NodeCodeBlock"&&g!=="NodeHeading"&&(u.innerHTML.endsWith(`
<wbr>`)||u.innerHTML.endsWith(`
<wbr>
`))){Ht(t,h,e.outerHTML,t.wysiwyg.lastHTMLs[h]||e.outerHTML.replace(`
<wbr>`,"<wbr>")),f.remove();return}if(RM(t,g,e,u,n)||UM(t,g,e,u,n))return;const m=e.querySelector("br");m&&m.parentElement.tagName!=="TD"&&m.parentElement.tagName!=="TH"&&(m.parentElement.textContent.trim()===""||((l=(o=m.previousSibling)==null?void 0:o.previousSibling)==null?void 0:l.textContent)===`
`)&&m.remove(),g!=="NodeHeading"&&(u.innerHTML.startsWith("\u300B<wbr>")||u.innerHTML.startsWith(p.ZWSP+"\u300B<wbr>")||u.innerHTML.indexOf(`
\u300B<wbr>`)>-1)&&(u.innerHTML=u.innerHTML.replace("\u300B<wbr>","><wbr>"));const b=u.innerHTML.trimStart(),y=u.textContent.trimStart();if(!((b.startsWith("````")||b.startsWith("\xB7\xB7\xB7\xB7")||b.startsWith("~~~~"))&&b.indexOf(`
`)===-1)){if((b.startsWith("```")||b.startsWith("\xB7\xB7\xB7")||b.startsWith("~~~"))&&b.indexOf(`
`)===-1&&b.replace(/|~/g,"`").replace(/^`{3,}/g,"").indexOf("`")===-1){Ht(t,h,e.outerHTML,t.wysiwyg.lastHTMLs[h]),f.remove();return}}g==="NodeParagraph"&&(u.innerHTML.startsWith("\xA5\xA5<wbr>")||u.innerHTML.startsWith("\uFFE5\uFFE5<wbr>")||b.indexOf(`
\xA5\xA5<wbr>`)>-1||b.indexOf(`
\uFFE5\uFFE5<wbr>`)>-1)&&(u.innerHTML=u.innerHTML.replace("\xA5\xA5<wbr>","$$$$<wbr>").replace("\uFFE5\uFFE5<wbr>","$$$$<wbr>"));const _=ue(n.startContainer,"data-type","block-ref");_&&_.getAttribute("data-subtype")==="d"&&(yield wn("/api/block/getRefText",{id:_.getAttribute("data-id")})).data!==_.innerHTML.replace("<wbr>","")&&_.setAttribute("data-subtype","s");let v=e.outerHTML,U=!1;if(["---","___","***"].includes(u.textContent)&&g!=="NodeCodeBlock"){v=`<div data-node-id="${h}" data-type="NodeThematicBreak" class="hr"><div></div></div>`;const Z=e.nextElementSibling;Z&&Z.getAttribute("data-node-id")?pt(Z)?U=!0:qt(Z):v+=i_(!1,!0)}else{if(g!=="NodeCodeBlock"&&(b.startsWith("```")||b.startsWith("~~~")||b.startsWith("\xB7\xB7\xB7")||b.indexOf("\n```")>-1&&y.indexOf("\n```")>-1||b.indexOf(`
~~~`)>-1&&y.indexOf(`
~~~`)>-1||b.indexOf(`
\xB7\xB7\xB7`)>-1&&y.indexOf(`
\xB7\xB7\xB7`)>-1)&&!(b.indexOf(`
`)===-1&&b.replace(/|~/g,"`").replace(/^`{3,}/g,"").indexOf("`")>-1)){let Z=u.innerHTML.trim().replace(/^(~||`){3,}/g,"```").replace(/\n(~||`){3,}/g,"\n```").trim();Z.endsWith("\n```")||(Z=Z.replace("<wbr>","")+"<wbr>\n```"),u.innerHTML=Z,v=e.outerHTML}v=t.lute.SpinBlockDOM(v)}Ut(["util"],t,!0),g==="NodeTable"&&e.querySelector(".table__select").removeAttribute("style");const ee=document.createElement("template");if(ee.innerHTML=v,a&&(((c=Ee(ee.content.firstElementChild))==null?void 0:c.innerHTML)!==Ee(e).innerHTML||ee.content.childElementCount===1&&((d=Ee(ee.content.firstElementChild))==null?void 0:d.innerHTML)==="<wbr>")&&!(ee.content.childElementCount===1&&ee.content.firstElementChild.classList.contains("code-block")&&g==="NodeCodeBlock")){e.getAttribute("data-type")==="NodeHeading"&&e.getAttribute("fold")==="1"&&ee.content.firstElementChild.getAttribute("data-subtype")!==e.dataset.subtype&&(La(t,e,void 0,void 0,!1),v=v.replace(' fold="1"',""),t.wysiwyg.lastHTMLs[h]=e.outerHTML);let Z;e.classList.contains("table")&&(Z=e.firstElementChild.scrollLeft),/<span data-type="backslash">.+<\/span><wbr>/.test(v)?e.outerHTML=v:e.outerHTML=v.replace("</span><wbr>","</span>"+p.ZWSP+"<wbr>"),t.wysiwyg.element.querySelectorAll(`[data-node-id="${h}"]`).forEach(k=>{ge(k)||(e=k)}),v.split('<span data-type="inline-math" data-subtype="math"').length>1&&Array.from(e.querySelectorAll('[data-type="inline-math"]')).find(k=>{if(k.dataset.content.indexOf("<wbr>")>-1)return k.setAttribute("data-content",k.dataset.content.replace("<wbr>","")),t.toolbar.showRender(t,k),!0}),v="",Array.from(ee.content.children).forEach((k,w)=>{const S=k.getAttribute("data-node-id");let B;S===h?B=e:B=t.wysiwyg.element.querySelector(`[data-node-id="${S}"]`);const H=B.getAttribute("data-type");if(H==="NodeCodeBlock"){const j=B.querySelector(".protyle-action__language");j?(window.siyuan.storage[p.LOCAL_CODELANG]&&j.textContent===""&&(j.textContent=window.siyuan.storage[p.LOCAL_CODELANG]),ra(B)):ee.content.childElementCount===1&&t.toolbar.showRender(t,B)}else if(["NodeMathBlock","NodeHTMLBlock"].includes(H))H==="NodeMathBlock"&&Ei(B),t.toolbar.showRender(t,B);else if(H==="NodeBlockQueryEmbed")$n(t,B),B.getAttribute("data-content")||t.toolbar.showRender(t,B),Ut(["hint"],t);else if(H==="NodeThematicBreak"&&U)qt(e);else if(B.querySelectorAll('[data-type~="block-ref"][data-subtype="d"]').forEach(j=>{j.textContent===""&&ae("/api/block/getRefText",{id:j.getAttribute("data-id")},re=>{j.innerHTML=re.data})}),Ei(B),w===ee.content.childElementCount-1){const j=e.querySelector("wbr");if(j&&j.parentElement.tagName==="SPAN"&&j.parentElement.innerHTML==="<wbr>"){const re=j.parentElement.getAttribute("data-type")||"";(re.includes("sup")||re.includes("u")||re.includes("sub"))&&j.insertAdjacentText("beforebegin",p.ZWSP)}cn(t.wysiwyg.element,n),t.hint.render(t),Z>0&&(e.firstElementChild.scrollLeft=Z)}v+=B.outerHTML})}else e.getAttribute("data-type")==="NodeCodeBlock"?(u.parentElement.removeAttribute("data-render"),ra(e)):(cn(t.wysiwyg.element,n),t.hint.render(t));Ut(["gutter"],t),qM(v,t,h)}),qM=(t,e,n)=>{const a=document.createElement("template");a.innerHTML=t;const i=[],s=[];Array.from(a.content.children).forEach((r,o)=>{var l;r.getAttribute("spellcheck")==="false"&&r.getAttribute("contenteditable")==="false"&&r.setAttribute("contenteditable","true");const c=r.getAttribute("data-node-id");if(c===n)i.push({id:n,data:r.outerHTML,action:"update"}),s.push({id:n,data:e.wysiwyg.lastHTMLs[n],action:"update"}),e.wysiwyg.lastHTMLs[n]=r.outerHTML;else{let d;o===0&&(d=e.wysiwyg.element.querySelector(`[data-node-id="${c}"]`)),i.push({action:"insert",data:r.outerHTML,id:c,previousID:o===0?(l=d==null?void 0:d.previousElementSibling)==null?void 0:l.getAttribute("data-node-id"):r.previousElementSibling.getAttribute("data-node-id"),parentID:(d==null?void 0:d.parentElement.getAttribute("data-node-id"))||e.block.parentID}),s.push({id:c,action:"delete"})}}),et(e,i,s)};var WM=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const VM=(t,e,n,a)=>{const i=document.createElement("template");i.innerHTML=e;let s=[];if(e.endsWith("]")&&e.startsWith("["))try{s=JSON.parse(e)}catch(o){console.warn("insert cell: JSON.parse error")}else i.content.querySelector("table")&&i.content.querySelectorAll("tr").forEach(o=>{s.push([]),Array.from(o.children).forEach(l=>{s[s.length-1].push(l.textContent)})});const r=a.dataset.avId;ae("/api/av/getAttributeViewKeysByAvID",{avID:r},o=>WM(void 0,null,function*(){var l,c;const d=o.data,u=Array.from(a.querySelectorAll(".av__cell--active, .av__cell--select"))||[];if(s&&Array.isArray(s)&&s.length>0){u.length===0&&a.querySelectorAll(".av__row--select:not(.av__row--header)").forEach(ee=>{ee.querySelectorAll(".av__cell").forEach(Z=>{u.push(Z)})}),u.length===0&&u.push(a.querySelector(".av__row:not(.av__row--header) .av__cell"));const b=[],y=[],_=a.dataset.nodeId;let v;const U=u[0].getAttribute("data-col-id");for(let ee=0;ee<s.length&&(v?v=v.nextElementSibling:v=N(u[0].parentElement,"av__row"),!!v.classList.contains("av__row"));ee++){let Z;for(let k=0;k<s[ee].length;k++){const w=s[ee][k];if(Z?Z.nextElementSibling?Z=Z.nextElementSibling:Z.parentElement.classList.contains("av__colsticky")&&(Z=Z.parentElement.nextElementSibling):Z=v.querySelector(`.av__cell[data-col-id="${U}"]`),!Z.classList.contains("av__cell"))break;const S=yield fs(n,a,w,[Z],d,e,!0);S.doOperations.length>0&&(b.push(...S.doOperations),y.push(...S.undoOperations))}}b.length>0&&(b.push({action:"doUpdateUpdated",id:_,data:at().format("YYYYMMDDHHmmss")}),y.push({action:"doUpdateUpdated",id:_,data:a.getAttribute("updated")}),et(n,b,y));return}const g=Ee(i.content.firstElementChild);if(g&&g.childNodes.length===1&&((l=g.firstElementChild)==null?void 0:l.getAttribute("data-type"))==="block-ref"){const b=a.querySelector(".av__cell--select");if(b){const y=g.firstElementChild.getAttribute("data-id"),_=Pr(b,a.getAttribute("data-av-type"));et(n,[{action:"replaceAttrViewBlock",avID:r,previousID:_,nextID:y,isDetached:!1}],[{action:"replaceAttrViewBlock",avID:r,previousID:y,nextID:_,isDetached:b.dataset.detached==="true"}]),us(b,{type:"block",isDetached:!1,block:{content:g.firstElementChild.textContent,id:y}});return}}const f=n.lute.BlockDOM2Content(e),h=a.querySelectorAll(".av__row--select"),m=[];if(f.split(`
`).forEach(b=>{m.push(b.split("	"))}),h.length>0&&m.length===1&&m[0].length===1){fs(n,a,f,void 0,d,e);return}if(h.length>0&&h.forEach(b=>{b.querySelectorAll(".av__cell").forEach(y=>{u.push(y)})}),u.length>0){if(m.length===1&&m[0].length===1)fs(n,a,f,u,d,e);else{let b;const y=[],_=[],v=u[0].getAttribute("data-col-id");for(let U=0;U<m.length&&(b?b=b.nextElementSibling:b=N(u[0].parentElement,"av__row"),!!b.classList.contains("av__row"));U++){let ee;for(let Z=0;Z<m[U].length&&(ee?ee.nextElementSibling?ee=ee.nextElementSibling:ee.parentElement.classList.contains("av__colsticky")&&(ee=ee.parentElement.nextElementSibling):ee=b.querySelector(`.av__cell[data-col-id="${v}"]`),!!ee.classList.contains("av__cell"));Z++){const k=m[U][Z],w=yield fs(n,a,k,[ee],d,e,!0);w.doOperations.length>0&&(y.push(...w.doOperations),_.push(...w.undoOperations))}}if(y.length>0){const U=a.getAttribute("data-node-id");y.push({action:"doUpdateUpdated",id:U,data:at().format("YYYYMMDDHHmmss")}),_.push({action:"doUpdateUpdated",id:U,data:a.getAttribute("updated")}),et(n,y,_)}}(c=document.querySelector(".av__panel"))==null||c.remove()}else if(N(t.startContainer,"av__title")){const b=document.createTextNode(f);t.insertNode(b),t.setEnd(b,f.length),t.collapse(!1),Pt(t),ox(n,a)}}))},zM=(t,e,n,a)=>{const i=document.createElement("template");i.innerHTML=e;const s=i.content.querySelectorAll("th, td");if(s.length===0)return!1;const r=a.firstElementChild.scrollLeft,o=a.querySelector("table").scrollTop,l=a.querySelector(".table__select");let c=0;const d=[];a.querySelectorAll("th, td").forEach(g=>{!g.classList.contains("fn__none")&&s.length>c&&Ra({tableSelectElement:l,scrollLeft:r,scrollTop:o,item:g})&&(d.push(g),c++)}),l.removeAttribute("style");const u=a.outerHTML;return a.setAttribute("updated",at().format("YYYYMMDDHHmmss")),d.forEach((g,f)=>{g.innerHTML=s[f].innerHTML,f===d.length-1&&qa(g,t,!1)}),t.collapse(!1),Ht(n,a.getAttribute("data-node-id"),a.outerHTML,u),!0},Aa=(t,e,n=!1,a=!1,i=!1)=>{var s,r,o,l;if(t==="")return;const c=a?e.toolbar.range:hn(e.wysiwyg.element);FE(c);let d;ue(c.startContainer,"data-type","NodeTable")&&!n&&(A(c.startContainer,"TABLE")?d=e.lute.BlockDOM2InlineBlockDOM(t):n=!0);let u=oe(c.startContainer);if(u||(e.toolbar.range?u=oe(e.toolbar.range.startContainer):u=e.wysiwyg.element.firstElementChild),!u)return;if(u.classList.contains("av")){c.deleteContents(),VM(c,t,e,u);return}if(u.classList.contains("table")&&u.querySelector(".table__select").clientWidth>0&&zM(c,t,e,u))return;let g=u.getAttribute("data-node-id");c.insertNode(document.createElement("wbr"));let f=u.outerHTML;const h=u.getAttribute("data-type"),m=h==="NodeCodeBlock",b=Ee(u);if(!n&&(m||e.toolbar.getCurrentType(c).includes("code"))){c.deleteContents();let H=!1;m&&b.textContent===""&&(H=!0),c.insertNode(document.createTextNode(t.replace(/\r\n|\r|\u2028|\u2029/g,`
`))),c.collapse(!1),c.insertNode(document.createElement("wbr")),H&&(c.collapse(!1),c.insertNode(document.createTextNode(`
`))),m?((s=u.querySelector('[data-render="true"]'))==null||s.removeAttribute("data-render"),ra(u)):cn(u,c),u.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(e,g,u.outerHTML,f),setTimeout(()=>{kn(e,void 0,"nearest","smooth")},p.TIMEOUT_LOAD);return}const y=[],_=[];if(c.toString()!==""){const H=ue(c.commonAncestorContainer,"data-type","inline-math");H?H.remove():c.startContainer.nodeType===3&&((r=c.startContainer.parentElement.getAttribute("data-type"))==null?void 0:r.indexOf("block-ref"))>-1?(c.deleteContents(),c.startContainer.nodeType!==3&&c.startContainer.textContent===""&&c.startContainer.remove()):c.deleteContents(),c.insertNode(document.createElement("wbr")),y.push({action:"update",id:g,data:f}),_.push({action:"update",id:g,data:u.outerHTML})}const v=document.createElement("template");/^\s*&gt;|\*|-|\+|\d*.|\[ \]|[x]/.test(t)&&b.textContent.replace(p.ZWSP,"")!==""&&(d=t);let U=d||t;U=U.replace(/;;;lt;;;/g,"&lt;").replace(/;;;gt;;;/g,"&gt;"),v.innerHTML=U;let ee=!1;if((b.textContent.replace(p.ZWSP,"")!==""||h==="NodeHeading")&&v.content.childElementCount===1&&v.content.firstChild.nodeType!==3&&v.content.firstElementChild.getAttribute("data-type")==="NodeHeading"&&(n=!1,ee=!0),!n&&(v.content.firstChild.nodeType===3||ee||v.content.firstChild.nodeType!==3&&(v.content.firstElementChild.classList.contains("p")&&v.content.childElementCount===1||v.content.firstElementChild.tagName!=="DIV"))){v.content.firstChild.nodeType!==3&&v.content.firstElementChild.classList.contains("p")&&(v.innerHTML=v.content.firstElementChild.firstElementChild.innerHTML.trim());const H=c.startContainer.nodeType===3?c.startContainer.parentElement:c.startContainer;if(H.tagName==="SPAN"&&H===(c.endContainer.nodeType===3?c.endContainer.parentElement:c.endContainer)&&v.content.querySelector("span, img")){const j=document.createElement("span"),re=H.attributes;for(let Te=0;Te<re.length;Te++)j.setAttribute(re[Te].name,re[Te].value);c.setEnd(H.lastChild,H.lastChild.textContent.length),j.append(c.extractContents()),H.after(j),c.setStartBefore(j),c.collapse(!0)}c.insertNode(v.content.cloneNode(!0)),c.collapse(!1),(o=u.querySelector("wbr"))==null||o.remove(),e.wysiwyg.lastHTMLs[g]=f,s_(e,u,c);return}const Z=N(u,"li");if(((l=v.content.children[0])==null?void 0:l.getAttribute("data-type"))==="NodeListItem")if(Z)u=Z,g=u.getAttribute("data-node-id"),f=u.outerHTML;else{const j=v.content.children[0].getAttribute("data-subtype");v.innerHTML=`<div${j==="o"?' data-marker="1."':""} data-subtype="${j}" data-node-id="${Lute.NewNodeID()}" data-type="NodeList" class="list">${t}<div class="protyle-attr" contenteditable="false">${p.ZWSP}</div></div>`}let k,w=!1;!c.toString()&&i&&ya(u,e.wysiwyg.element,c).start===0&&b.textContent!==""&&(w=!0),(v.content.firstChild.nodeType===3||v.content.firstChild.nodeType===1&&v.content.firstElementChild.tagName!=="DIV")&&(v.innerHTML=e.lute.SpinBlockDOM(v.innerHTML)),(w?Array.from(v.content.children):Array.from(v.content.children).reverse()).find(H=>{let j=H.getAttribute("data-node-id");const re=H.getAttribute("parent-heading");if(j===g)_.push({action:"update",data:H.outerHTML,id:j}),y.push({action:"update",id:j,data:f});else{if(H.classList.contains("li")&&!u.parentElement.classList.contains("list")){j=Lute.NewNodeID();const Te=document.createElement("div");Te.setAttribute("data-subtype",H.getAttribute("data-subtype")),Te.setAttribute("data-node-id",j),Te.setAttribute("data-type","NodeList"),Te.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Te.classList.add("list"),Te.append(H),H=Te}H.removeAttribute("parent-heading"),_.push({action:"insert",data:H.outerHTML,id:j,context:{ignoreProcess:re?"true":"false"},nextID:w?g:void 0,previousID:w?void 0:g}),y.push({action:"delete",id:j})}if(!re){const Te=[];H.classList.contains("render-node")&&H.getAttribute("data-type")==="NodeCodeBlock"?Te.push(H):Te.push(...H.querySelectorAll('.render-node[data-type="NodeCodeBlock"]')),Te.forEach(Be=>{var Ie;(Ie=Be.querySelector(".protyle-icons"))==null||Ie.remove();const Ce=Be.querySelector('[spin="1"]');Ce&&(Ce.innerHTML=""),Be.removeAttribute("data-render")}),Ji(H),w?u.before(H):u.after(H)}k||(k=H)}),b&&b.textContent===""&&u.classList.contains("p")&&(_.find((H,j)=>{if(H.id===g)return _.splice(j,1),!0}),_.push({action:"delete",id:g}),y.find((H,j)=>{if(H.id===g&&H.action==="update")return y.splice(j,1),!0}),y.push({action:"insert",data:f,id:g,previousID:u.previousElementSibling?u.previousElementSibling.getAttribute("data-node-id"):"",parentID:u.parentElement.getAttribute("data-node-id")||e.block.parentID}),u.remove()),k&&qt(k,void 0,!1);const S=e.wysiwyg.element.querySelector("wbr");S&&S.remove();let B;u.getAttribute("data-type")==="NodeHeading"&&u.getAttribute("fold")==="1"&&(B=La(e,u,!0,!1,!1,!0),_.reverse(),B.doOperations[0].context={focusId:k==null?void 0:k.getAttribute("data-node-id")},_.push(...B.doOperations),y.push(...B.undoOperations)),et(e,_,y),e.wysiwyg.element.querySelectorAll("[parent-heading]").forEach(H=>{H.remove()})},TS=t=>{var e,n;if(t){Ut(["util"],t),Gs()&&(t.highlight.markHL.clear(),t.highlight.mark.clear(),t.highlight.ranges=[],t.highlight.rangeIndex=0),(e=t.observer)==null||e.disconnect(),(n=t.observerLoad)==null||n.disconnect(),t.element.classList.remove("protyle"),t.element.removeAttribute("style"),t.wysiwyg&&(t.wysiwyg.lastHTMLs={}),t.undo&&t.undo.clear();try{t.ws.send("closews",{})}catch(a){setTimeout(()=>{t.ws.send("closews",{})},10240)}t.app.plugins.forEach(a=>{a.eventBus.emit("destroy-protyle",{protyle:t})})}};class YM{constructor(){this.isUploading=!1,this.element=document.createElement("div"),this.element.className="protyle-upload"}}const GM=(t,e)=>{const n=[];let a="",i="";for(let r=e.length,o=0;o<r;o++){const l=e[o];let c=!0;l.name||(a+=`<li>${window.siyuan.languages.nameEmpty}</li>`,c=!1),l.size>t.options.upload.max&&(a+=`<li>${l.name} ${window.siyuan.languages.over} ${t.options.upload.max/1024/1024}M</li>`,c=!1);const d=l.name.lastIndexOf("."),u=d===-1?"":l.name.substr(d),g=d===-1?l.name:t.options.upload.filename(l.name.substr(0,d))+u;t.options.upload.accept&&(t.options.upload.accept.split(",").some(h=>{const m=h.trim();if(m.indexOf(".")===0){if(u.toLowerCase()===m.toLowerCase())return!0}else if(l.type.split("/")[0]===m.split("/")[0])return!0;return!1})||(a+=`<li>${l.name} ${window.siyuan.languages.fileTypeError}</li>`,c=!1)),c&&(n.push(l),i+=`<li>${g} ${window.siyuan.languages.uploading}</li>`)}let s;return(a!==""||i!=="")&&(s=Q(`<ul>${a}${i}</ul>`,-1)),{files:n,msgId:s}},DS=(t,e)=>{var n,a,i;const s=JSON.parse(t);let r="";s.code===1&&(r=`${s.msg}`),s.data.errFiles&&s.data.errFiles.length>0&&(r=`<ul><li>${r}</li>`,s.data.errFiles.forEach(h=>{const m=h.lastIndexOf("."),b=m===-1?h:e.options.upload.filename(h.substr(0,m))+h.substr(m);r+=`<li>${b} ${window.siyuan.languages.uploadError}</li>`}),r+="</ul>"),r&&Q(r);let o=!0;const l=hn(e.wysiwyg.element);l.toString()===""&&l.startContainer.nodeType===3&&e.toolbar.getCurrentType(l).length>0&&(l.setEndAfter(l.startContainer.parentElement),l.collapse(!1));const c=Object.keys(s.data.succMap),d=oe(l.startContainer);if(d)if(d.classList.contains("table"))o=!1;else{const h=Ee(d);h&&d.classList.contains("p")&&(h.textContent!==""||c.length<2)&&(o=!1)}let u="";c.sort((h,m)=>h.localeCompare(m,void 0,{numeric:!0}));const g=[];let f=!1;if(c.forEach((h,m)=>{const b=s.data.succMap[h],y=_n().extname(h).toLowerCase(),_=e.options.upload.filename(h),v=_.substring(0,_.length-y.length);f=p.SIYUAN_ASSETS_IMAGE.includes(y),g.push({type:p.SIYUAN_ASSETS_IMAGE.includes(y)?"image":"file",content:b,name:v}),u+=aS(y,b,v,_),!p.SIYUAN_ASSETS_AUDIO.includes(y)&&!p.SIYUAN_ASSETS_VIDEO.includes(y)&&c.length-1!==m&&(d&&d.classList.contains("table")?u+="<br>":o?u+=`

`:u+=`
`)}),document.querySelector(".av__panel")){const h=[document.querySelector('.custom-attr__avvalue[data-type="mAsset"][data-active="true"]')];if(h[0]||(h.splice(0,1),e.wysiwyg.element.querySelectorAll(".av__cell--active").forEach(m=>{Ns(m)==="mAsset"&&h.push(m)}),h.length===0&&((a=(n=document.querySelector(".av__panel .b3-menu__items"))==null?void 0:n.getAttribute("data-ids"))==null||a.split(",").forEach(m=>{const b=e.wysiwyg.element.querySelector(`.av__gallery-fields [data-dtype="mAsset"][data-id="${m}"]`);b&&h.push(b)}))),h.length>0){const m=oe(h[0]);if(m){fs(e,m,g,h),(i=document.querySelector(".av__panel"))==null||i.remove();return}}else return}else if(d&&d.classList.contains("av")){const h=[];if(d.querySelectorAll(".av__row--select:not(.av__row--header)").forEach(m=>{m.querySelectorAll(".av__cell").forEach(b=>{Ns(b)==="mAsset"&&h.push(b)})}),h.length===0&&e.wysiwyg.element.querySelectorAll(".av__cell--active").forEach(m=>{Ns(m)==="mAsset"&&h.push(m)}),h.length>0){fs(e,d,g,h);return}else return}Aa(u,e,o),setTimeout(()=>{kn(e,void 0,"nearest","smooth")},f?0:p.TIMEOUT_LOAD)},Qv=(t,e,n)=>{const a=Q(window.siyuan.languages.uploading,0);ae("/api/asset/insertLocalAssets",{assetPaths:t,isUpload:n,id:e.block.rootID},i=>{ot(a);let s="";Object.keys(i.data.succMap).forEach(r=>{i.data.succMap[r].startsWith("file:")&&(s+=r+", ")}),s&&Q(window.siyuan.languages.dndFolderTip.replace("${x}",`<b>${s.substring(0,s.length-2)}</b>`)),DS(JSON.stringify(i),e)})},_l=(t,e,n,a)=>{if(!t){const d=new FormData;for(let g=0,f=e.length;g<f;g++)d.append("file[]",e[g]);const u=new XMLHttpRequest;u.open("POST",p.UPLOAD_ADDRESS),u.onreadystatechange=()=>{u.readyState===XMLHttpRequest.DONE&&(u.status===200?a(u.responseText):u.status===0?Q(window.siyuan.languages.fileTypeError):Q(u.responseText),n&&(n.value=""))},u.send(d);return}let i=[];for(let d=0;d<e.length;d++){let u=e[d];u instanceof DataTransferItem&&(u=u.getAsFile()),u.size===0&&u.type===""&&u.name.indexOf(".")===-1?Qv([u.path],t,!1):i.push(u)}if(t.options.upload.handler){const d=t.options.upload.handler(i);if(typeof d=="string"){Q(d);return}return}if(!t.options.upload.url||!t.upload){n&&(n.value=""),Q("please config: options.upload.url");return}if(t.options.upload.file&&(i=t.options.upload.file(i)),t.options.upload.validate){const d=t.options.upload.validate(i);if(typeof d=="string"){Q(d);return}}const s=t.wysiwyg.element,r=GM(t,i);if(r.files.length===0){n&&(n.value="");return}const o=new FormData,l=t.options.upload.extraData;for(const d of Object.keys(l))o.append(d,l[d]);for(let d=0,u=r.files.length;d<u;d++)o.append(t.options.upload.fieldName,r.files[d]);o.append("id",t.block.rootID);const c=new XMLHttpRequest;c.open("POST",t.options.upload.url),t.options.upload.token&&c.setRequestHeader("X-Upload-Token",t.options.upload.token),t.options.upload.withCredentials&&(c.withCredentials=!0),t.upload.isUploading=!0,c.onreadystatechange=()=>{if(c.readyState===XMLHttpRequest.DONE){if(t.upload.isUploading=!1,!document.body.contains(t.element)){TS(t);return}if(c.status===200)if(ot(r.msgId),t.options.upload.success)t.options.upload.success(s,c.responseText);else if(a)a(c.responseText);else{let d=c.responseText;t.options.upload.format&&(d=t.options.upload.format(e,c.responseText)),DS(d,t)}else c.status===0?Q(window.siyuan.languages.fileTypeError):t.options.upload.error?t.options.upload.error(c.responseText):Q(c.responseText);n&&(n.value=""),t.upload.element.style.display="none"}},c.upload.onprogress=d=>{if(!d.lengthComputable)return;const u=d.loaded/d.total*100;t.upload.element.style.display="block";const g=t.upload.element;g.style.width=u+"%"},c.send(o)},CS=[".pdf",...p.SIYUAN_ASSETS_DOCUMENT,".md",".markdown",".txt"],jM=t=>{if(!Mo(t))return!1;const e=_n().extname(t).toLowerCase().split("?")[0];return CS.includes(e)},Lf=(t,e,n,a=!1,i=!1)=>{let s=Lute.UnEscapeHTMLStr(e),r;if(Mo(s)&&!s.startsWith("file://")&&s.indexOf(".pdf")>-1){const o=s.split("/");o.length===3&&o[0]==="assets"&&o[1].endsWith(".pdf")&&/\d{14}-\w{7}/.test(o[2])?(s=`assets/${o[1]}`,r=o[2]):(r=parseInt(O("page",s)),s=s.split("?page")[0])}if(Mo(s)){const o=_n().extname(s).toLowerCase().split("?")[0],l=p.SIYUAN_ASSETS_EXTS.includes(o),c=CS.includes(o);if(c&&!i)return;l||c?n&&n.altKey?kc(t.app,s,r):(n&&n.shiftKey,kc(t.app,s,r,"right")):$e(s)}else s&&(0>s.indexOf(":")&&(s=`https://${s}`),$e(s))},r_=(t,e)=>{va(`${p.PROTYLE_CDN}/js/viewerjs/viewer.js?v=1.11.7`,"protyleViewerScript").then(()=>{const n=document.createElement("ul");let a="",i=-1;t.forEach((s,r)=>{s&&(a+=`<li><img src="${s}"></li>`,e&&i===-1&&(e.endsWith(encodeURI(s))||e.endsWith(s))&&(i=r))}),n.innerHTML=a,window.siyuan.viewer=new Viewer(n,{initialViewIndex:e?i:0,title:[1,(s,r)=>{let o=s.alt;return o||(o=s.src.substring(s.src.lastIndexOf("/")+1)),o=o.substring(0,o.lastIndexOf(".")).replace(/-\d{14}-\w{7}$/,""),`${o} [${r.naturalWidth} \xD7 ${r.naturalHeight}]`}],button:!1,transition:!1,hidden:function(){window.siyuan.viewer.destroy()},toolbar:{zoomIn:!0,zoomOut:!0,oneToOne:!0,reset:!0,prev:!0,play:!0,next:!0,rotateLeft:!0,rotateRight:!0,flipHorizontal:!0,flipVertical:!0,close:function(){window.siyuan.viewer.destroy()}}}),window.siyuan.viewer.show()})},LS=(t,e)=>{ae("/api/asset/getDocImageAssets",{id:e},n=>{r_(n.data,t)})},ex=(t,e,n,a)=>{ae("/api/av/getCurrentAttrViewImages",{id:e,viewID:n,query:a},i=>{r_(i.data,t)})},qh=t=>t.startsWith("assets/")&&(t.endsWith(".png")||t.endsWith(".jpg")||t.endsWith(".jpeg"))?t+"?style=thumb":t,tx=t=>t.startsWith("assets/")&&(t.endsWith(".png?style=thumb")||t.endsWith(".jpg?style=thumb")||t.endsWith(".jpeg?style=thumb"))?t.replace("?style=thumb",""):t,IS=t=>{t.menuElement.querySelector("input").addEventListener("change",e=>{e.target.files.length!==0&&_l(t.protyle,e.target.files,e.target,n=>{const a=JSON.parse(n),i=[];Object.keys(a.data.succMap).forEach(s=>{i.push({name:s,content:a.data.succMap[s],type:p.SIYUAN_ASSETS_IMAGE.includes(_n().extname(a.data.succMap[s]).toLowerCase())?"image":"file"})}),Od({protyle:t.protyle,cellElements:t.cellElements,addValue:i,blockElement:t.blockElement})})})},MS=t=>{let e="";qo("mAsset",t[0]).mAsset.forEach((a,i)=>{let s;a.type==="image"?s=`<span data-type="openAssetItem" class="fn__flex-1 ariaLabel" aria-label="${a.content}">
    <img style="max-height: 180px;max-width: 360px;border-radius: var(--b3-border-radius);margin: 4px 0;" src="${qh(a.content)}"/>
</span>`:s=`<span data-type="openAssetItem" class="fn__ellipsis b3-menu__label ariaLabel" aria-label="${ft(a.content)}" style="max-width: 360px">${a.name||a.content}</span>`,e+=`<button class="b3-menu__item" draggable="true" data-index="${i}" data-name="${ft(a.name)}" data-type="${a.type}" data-content="${ft(a.content)}">
<svg class="b3-menu__icon fn__grab"><use xlink:href="#iconDrag"></use></svg>
${s}
<svg class="b3-menu__action" data-type="editAssetItem"><use xlink:href="#iconEdit"></use></svg>
</button>`});const n=[];return t.forEach(a=>{n.push(a.dataset.id)}),`<div class="b3-menu__items" data-ids="${n}">
    ${e}
    <button data-type="addAssetExist" class="b3-menu__item b3-menu__item--current">
        <svg class="b3-menu__icon"><use xlink:href="#iconImage"></use></svg>
        <span class="b3-menu__label">${window.siyuan.languages.assets}</span>
    </button>
    <button class="b3-menu__item">
        <svg class="b3-menu__icon"><use xlink:href="#iconDownload"></use></svg>
        <span class="b3-menu__label">${window.siyuan.languages.insertAsset}</span> 
        <input multiple class="b3-form__upload" type="file">
    </button>
    <button data-type="addAssetLink" class="b3-menu__item">
        <svg class="b3-menu__icon"><use xlink:href="#iconLink"></use></svg>
        <span class="b3-menu__label">${window.siyuan.languages.link}</span>
    </button>
</div>`},Od=t=>{const e=t.blockElement.getAttribute("data-av-type"),n=$s(t.cellElements[0],e),a=[],i=[];let s;t.cellElements.forEach((o,l)=>{var c,d;const u=Pr(o,e);t.blockElement.contains(o)||(e==="table"?o=t.cellElements[l]=t.blockElement.querySelector(`.av__row[data-id="${u}"] .av__cell[data-col-id="${o.dataset.colId}"]`)||t.blockElement.querySelector(`.fn__flex-1[data-col-id="${o.dataset.colId}"]`):o=t.cellElements[l]=t.blockElement.querySelector(`.av__gallery-item[data-id="${u}"] .av__cell[data-field-id="${o.dataset.fieldId}"]`));const g=qo(Ns(o)||o.dataset.type,o),f=JSON.parse(JSON.stringify(g));l===0?(typeof t.removeIndex=="number"?g.mAsset.splice(t.removeIndex,1):((c=t.addValue)==null?void 0:c.length)>0?g.mAsset=g.mAsset.concat(t.addValue):t.updateValue?g.mAsset.find((m,b)=>{if(b===t.updateValue.index)return m.content=t.updateValue.value.content,m.type=t.updateValue.value.type,m.name=t.updateValue.value.name,!0}):((d=t.replaceValue)==null?void 0:d.length)>0&&(g.mAsset=t.replaceValue),s=g.mAsset):g.mAsset=s;const h=t.blockElement.getAttribute("data-av-id");a.push({action:"updateAttrViewCell",id:g.id,keyID:n,rowID:u,avID:h,data:g}),i.push({action:"updateAttrViewCell",id:g.id,keyID:n,rowID:u,avID:h,data:f}),o.classList.contains("custom-attr__avvalue")?o.innerHTML=wl(g):us(o,g)}),a.push({action:"doUpdateUpdated",id:t.blockElement.getAttribute("data-node-id"),data:at().format("YYYYMMDDHHmmss")}),et(t.protyle,a,i);const r=document.querySelector(".av__panel > .b3-menu");if(r){r.innerHTML=MS(t.cellElements),IS({protyle:t.protyle,menuElement:r,cellElements:t.cellElements,blockElement:t.blockElement});const o=(t.cellElements[0].classList.contains("custom-attr__avvalue")?t.cellElements[0]:t.protyle.wysiwyg.element.querySelector(`.av__cell[data-id="${t.cellElements[0].dataset.id}"]`)).getBoundingClientRect();setTimeout(()=>{gn(r,o.left,o.bottom,o.height)},p.TIMEOUT_LOAD)}},o_=t=>{const e=tx(t.content),n=t.type,a=new ta(p.MENU_AV_ASSET_EDIT,()=>{!r[1]&&r[0].value===e||r[1]&&r[0].value===e&&r[1].value===t.name||Od({protyle:t.protyle,cellElements:t.cellElements,blockElement:t.blockElement,updateValue:{index:t.index,value:{content:r[0].value,name:r[1]?r[1].value:"",type:n}}})});if(a.isOpen)return;n==="file"?(a.addItem({id:"linkAndTitle",iconHTML:"",type:"readonly",label:`<div class="fn__flex">
    <span class="fn__flex-center">${window.siyuan.languages.link}</span>
    <span class="fn__space"></span>
    <span data-action="copy" class="block__icon block__icon--show b3-tooltips b3-tooltips__e fn__flex-center" aria-label="${window.siyuan.languages.copy}">
        <svg><use xlink:href="#iconCopy"></use></svg>
    </span>   
</div>
<textarea rows="1" style="margin:4px 0;width: ${x()?"200":"360"}px;resize: vertical;" class="b3-text-field"></textarea>
<div class="fn__hr"></div>
<div class="fn__flex">
    <span class="fn__flex-center">${window.siyuan.languages.title}</span>
    <span class="fn__space"></span>
    <span data-action="copy" class="block__icon block__icon--show b3-tooltips b3-tooltips__e fn__flex-center" aria-label="${window.siyuan.languages.copy}">
        <svg><use xlink:href="#iconCopy"></use></svg>
    </span>   
</div>
<textarea style="width: ${x()?"200":"360"}px;margin: 4px 0;resize: vertical;" rows="1" class="b3-text-field"></textarea>`,bind(o){o.addEventListener("click",l=>{let c=l.target;for(;c;){if(c.dataset.action==="copy"){ut(c.parentElement.nextElementSibling.value),Q(window.siyuan.languages.copied);break}c=c.parentElement}})}}),a.addSeparator({id:"separator_1"}),a.addItem({id:"copy",label:window.siyuan.languages.copy,icon:"iconCopy",click(){ut(`[${r[1].value||r[0].value}](${r[0].value})`)}})):(a.addItem({id:"link",iconHTML:"",type:"readonly",label:`<div class="fn__flex">
    <span class="fn__flex-center">${window.siyuan.languages.link}</span>
    <span class="fn__space"></span>
    <span data-action="copy" class="block__icon block__icon--show b3-tooltips b3-tooltips__e fn__flex-center" aria-label="${window.siyuan.languages.copy}">
        <svg><use xlink:href="#iconCopy"></use></svg>
    </span>   
</div>
<textarea rows="1" style="margin:4px 0;width: ${x()?"200":"360"}px;resize: vertical;" class="b3-text-field"></textarea>`,bind(o){o.addEventListener("click",l=>{let c=l.target;for(;c;){if(c.dataset.action==="copy"){ut(c.parentElement.nextElementSibling.value),Q(window.siyuan.languages.copied);break}c=c.parentElement}})}}),a.addSeparator({id:"separator_1"}),a.addItem({id:"copy",label:window.siyuan.languages.copy,icon:"iconCopy",click(){ut(`![](${e.replace(/%20/g," ")})`)}}),a.addItem({id:"copyAsPNG",label:window.siyuan.languages.copyAsPNG,icon:"iconImage",click(){wd(e)}})),a.addItem({id:"delete",icon:"iconTrashcan",label:window.siyuan.languages.delete,click(){Od({protyle:t.protyle,cellElements:t.cellElements,blockElement:t.blockElement,removeIndex:t.index})}}),e!=null&&e.startsWith("assets/")&&a.addItem({id:"rename",label:window.siyuan.languages.rename,icon:"iconEdit",click(){var o;Ed(e),(o=document.querySelector(".av__panel"))==null||o.remove()}});const i=Wh(t.protyle?t.protyle.app:window.siyuan.ws.app,e,!0,!1);(n!=="file"||i.length>0)&&a.addSeparator({id:"separator_2"}),n!=="file"&&a.addItem({id:"cardPreview",icon:"iconPreview",label:window.siyuan.languages.cardPreview,click(){var o;ex(e,t.blockElement.getAttribute("data-av-id"),t.blockElement.getAttribute(p.CUSTOM_SY_AV_VIEW),((o=t.blockElement.querySelector('[data-type="av-search"]'))==null?void 0:o.value.trim())||"")}}),i.length>0&&window.siyuan.menus.menu.append(new xe({id:"openBy",label:window.siyuan.languages.openBy,icon:"iconOpen",submenu:i}).element),e!=null&&e.startsWith("assets/")&&window.siyuan.menus.menu.append(new xe(_d(e)).element);const s=t.rect;a.open({x:s.right,y:s.top,w:s.width,h:s.height});const r=a.element.querySelectorAll("textarea");r[0].value=e,r[0].focus(),r[0].select(),r.length>1&&(r[1].value=t.name)},KM=(t,e,n,a)=>{const i=new ta(p.MENU_AV_ASSET_EDIT,()=>{const r=i.element.querySelectorAll("textarea");!r[0].value&&!r[1].value||Od({protyle:t,cellElements:e,blockElement:a,addValue:[{type:"file",name:r[1].value,content:r[0].value}]})});if(i.isOpen)return;i.addItem({iconHTML:"",type:"readonly",label:`${window.siyuan.languages.link}
<textarea rows="1" style="margin:4px 0;width: ${x()?"200":"360"}px;resize: vertical;" class="b3-text-field"></textarea>
<div class="fn__hr"></div>
${window.siyuan.languages.title}
<textarea style="width: ${x()?"200":"360"}px;margin: 4px 0;resize: vertical;" rows="1" class="b3-text-field"></textarea>`});const s=n.getBoundingClientRect();i.open({x:s.right,y:s.bottom,w:n.parentElement.clientWidth+8,h:s.height}),i.element.querySelector("textarea").focus()},FS=(t,e,n)=>{const a=Q(window.siyuan.languages.uploading,0);ae("/api/asset/insertLocalAssets",{assetPaths:t,isUpload:!0,id:e.block.rootID},i=>{const s=oe(n);if(s){ot(a);const r=[];Object.keys(i.data.succMap).forEach(o=>{const l=_n().extname(o).toLowerCase(),c=o.substring(0,o.length-l.length);p.SIYUAN_ASSETS_IMAGE.includes(l)?r.push({type:"image",name:c,content:i.data.succMap[o]}):r.push({type:"file",name:c,content:i.data.succMap[o]})}),Od({protyle:e,blockElement:s,cellElements:[n],addValue:r})}})},XM=t=>{var e,n;let a="";const i=t[t.type];switch(t.type){case"block":t!=null&&t.isDetached?a=`<span>${((e=t.block)==null?void 0:e.content)||window.siyuan.languages.untitled}</span>`:a=`<span data-type="block-ref" data-id="${t.block.id}" data-subtype="s" class="av__celltext--ref">${((n=t.block)==null?void 0:n.content)||window.siyuan.languages.untitled}</span>`;break;case"text":a=t.text.content;break;case"number":a=t.number.formattedContent||t.number.content.toString();break;case"date":case"updated":case"created":i.formattedContent?a=i.formattedContent:(i&&i.isNotEmpty&&(a=at(i.content).format(i.isNotTime?"YYYY-MM-DD":"YYYY-MM-DD HH:mm")),i&&i.hasEndDate&&i.isNotEmpty&&i.isNotEmpty2&&(a=`<svg class="av__cellicon"><use xlink:href="#iconForward"></use></svg>${at(i.content2).format(i.isNotTime?"YYYY-MM-DD":"YYYY-MM-DD HH:mm")}`)),a&&(a=`<span class="av__celltext">${a}</span>`);break;case"url":a=t.url.content?`<a class="fn__a" href="${t.url.content}" target="_blank">${t.url.content}</a>`:"";break;case"phone":a=t.phone.content?`<a class="fn__a" href="tel:${t.phone.content}" target="_blank">${t.phone.content}</a>`:"";break;case"email":a=t.email.content?`<a class="fn__a" href="mailto:${t.email.content}" target="_blank">${t.email.content}</a>`:"";break}return a},wl=t=>{var e,n,a,i,s,r,o,l;let c="";switch(t.type){case"block":c=`<input data-id="${t.block.id}" value="${ft(t.block.content)}" type="text" class="b3-text-field b3-text-field--text fn__flex-1" placeholder="${window.siyuan.languages.empty}">`;break;case"text":c=`<textarea style="resize: vertical" rows="${(((e=t.text)==null?void 0:e.content)||"").split(`
`).length}" class="b3-text-field b3-text-field--text fn__flex-1" placeholder="${window.siyuan.languages.empty}">${((n=t.text)==null?void 0:n.content)||""}</textarea>`;break;case"number":c=`<input value="${t.number.isNotEmpty?t.number.content:""}" type="number" class="b3-text-field b3-text-field--text fn__flex-1" placeholder="${window.siyuan.languages.empty}">
<span class="fn__space"></span><span class="fn__flex-center ft__on-surface b3-tooltips__w b3-tooltips" aria-label="${window.siyuan.languages.format}">${t.number.formattedContent}</span><span class="fn__space"></span>`;break;case"mSelect":case"select":(a=t.mSelect)==null||a.forEach((d,u)=>{t.type==="select"&&u>0||(c+=`<span class="b3-chip b3-chip--middle" style="background-color:var(--b3-font-background${d.color});color:var(--b3-font-color${d.color})">${he(d.content)}</span>`)});break;case"mAsset":(i=t.mAsset)==null||i.forEach(d=>{d.type==="image"?c+=`<img loading="lazy" class="av__cellassetimg ariaLabel" aria-label="${d.content}" src="${qh(d.content)}">`:c+=`<span class="b3-chip b3-chip--middle av__celltext--url ariaLabel" aria-label="${ft(d.content)}" data-name="${ft(d.name)}" data-url="${ft(d.content)}">${d.name||d.content}</span>`});break;case"date":c=`<span class="av__celltext" data-value='${JSON.stringify(t[t.type])}' placeholder="${window.siyuan.languages.empty}">`,t[t.type]&&t[t.type].isNotEmpty&&(c+=at(t[t.type].content).format(t[t.type].isNotTime?"YYYY-MM-DD":"YYYY-MM-DD HH:mm")),t[t.type]&&t[t.type].hasEndDate&&t[t.type].isNotEmpty&&t[t.type].isNotEmpty2&&(c+=`<svg class="av__cellicon"><use xlink:href="#iconForward"></use></svg>${at(t[t.type].content2).format(t[t.type].isNotTime?"YYYY-MM-DD":"YYYY-MM-DD HH:mm")}`),c+="</span>";break;case"created":case"updated":t[t.type].isNotEmpty&&(c=`<span data-content="${t[t.type].content}">${at(t[t.type].content).format("YYYY-MM-DD HH:mm")}</span>`);break;case"url":c=`<input value="${t.url.content}" class="b3-text-field b3-text-field--text fn__flex-1" placeholder="${window.siyuan.languages.empty}">
<span class="fn__space"></span>
<a ${t.url.content?`href="${t.url.content}"`:""} target="_blank" aria-label="${window.siyuan.languages.openBy}" class="block__icon block__icon--show fn__flex-center b3-tooltips__w b3-tooltips"><svg><use xlink:href="#iconLink"></use></svg></a>`;break;case"phone":c=`<input value="${t.phone.content}" class="b3-text-field b3-text-field--text fn__flex-1" placeholder="${window.siyuan.languages.empty}">
<span class="fn__space"></span>
<a ${t.phone.content?`href="tel:${t.phone.content}"`:""} target="_blank" aria-label="${window.siyuan.languages.openBy}" class="block__icon block__icon--show fn__flex-center b3-tooltips__w b3-tooltips"><svg><use xlink:href="#iconPhone"></use></svg></a>`;break;case"checkbox":c=`<svg class="av__checkbox"><use xlink:href="#icon${t.checkbox.checked?"Check":"Uncheck"}"></use></svg>`;break;case"template":c=`<div class="fn__flex-1" placeholder="${window.siyuan.languages.empty}">${t.template.content}</div>`;break;case"email":c=`<input value="${t.email.content}" class="b3-text-field b3-text-field--text fn__flex-1" placeholder="${window.siyuan.languages.empty}">
<span class="fn__space"></span>
<a ${t.email.content?`href="mailto:${t.email.content}"`:""} target="_blank" aria-label="${window.siyuan.languages.openBy}" class="block__icon block__icon--show fn__flex-center b3-tooltips__w b3-tooltips"><svg><use xlink:href="#iconEmail"></use></svg></a>`;break;case"relation":(r=(s=t==null?void 0:t.relation)==null?void 0:s.contents)==null||r.forEach((d,u)=>{if(d&&d.block){const g=t.relation.blockIDs[u];d!=null&&d.isDetached?c+=`<span data-row-id="${g}" class="av__cell--relation"><span>\u2796<span class="fn__space--5"></span></span><span class="av__celltext">${Lute.EscapeHTMLStr(d.block.content||window.siyuan.languages.untitled)}</span></span>`:c+=`<span data-row-id="${g}" class="av__cell--relation" data-block-id="${d.block.id}"><span class="b3-menu__avemoji" data-unicode="${d.block.icon||""}">${Yt(d.block.icon||window.siyuan.storage[p.LOCAL_IMAGES].file)}</span><span data-type="block-ref" data-id="${d.block.id}" data-subtype="s" class="av__celltext av__celltext--ref">${Lute.EscapeHTMLStr(d.block.content||window.siyuan.languages.untitled)}</span></span>`}}),c&&c.endsWith(", ")&&(c=c.substring(0,c.length-2));break;case"rollup":(l=(o=t==null?void 0:t.rollup)==null?void 0:o.contents)==null||l.forEach(d=>{const u=["template","select","mSelect","mAsset","checkbox","relation"].includes(d.type)?wl(d):XM(d);u&&(c+=u.replace("fn__flex-1","")+",&nbsp;")}),c&&c.endsWith(",&nbsp;")&&(c=c.substring(0,c.length-7));break}return c},nx=(t,e,n,a)=>{ae("/api/av/getAttributeViewKeys",{id:e},i=>{let s="";if(i.data.forEach(r=>{var o;let l=`<div class="custom-attr__avheader">
    <div class="block__logo popover__block" style="max-width:calc(100% - 40px)" data-id='${JSON.stringify(r.blockIDs)}'>
        <svg class="block__logoicon"><use xlink:href="#iconDatabase"></use></svg>
        <span class="fn__ellipsis">${r.avName||window.siyuan.languages.database}</span>
    </div>
    <div class="fn__flex-1"></div>
    <span data-type="remove" data-row-id="${r.keyValues&&r.keyValues[0].values[0].blockID}" class="block__icon block__icon--warning block__icon--show b3-tooltips__w b3-tooltips" aria-label="${window.siyuan.languages.removeAV}"><svg><use xlink:href="#iconTrashcan"></use></svg></span>
</div>`;(o=r.keyValues)==null||o.forEach(c=>{var d;l+=`<div class="block__icons av__row" data-id="${e}" data-col-id="${c.key.id}">
    <div class="block__icon" draggable="true"><svg><use xlink:href="#iconDrag"></use></svg></div>
    <div class="block__logo ariaLabel fn__pointer" data-type="editCol" data-position="parentW" aria-label="${Ot(c.key.name)}<div class='ft__on-surface'>${Ot(c.key.desc)}</div>">
        ${c.key.icon?Yt(c.key.icon,"block__logoicon",!0):`<svg class="block__logoicon"><use xlink:href="#${za(c.key.type)}"></use></svg>`}
        <span>${he(c.key.name)}</span>
    </div>
    <div data-av-id="${r.avID}" data-col-id="${c.values[0].keyID}" data-row-id="${c.values[0].blockID}" data-id="${c.values[0].id}" data-type="${c.values[0].type}" 
data-options="${(d=c.key)!=null&&d.options?ft(JSON.stringify(c.key.options)):"[]"}" 
${["text","number","date","url","phone","template","email"].includes(c.values[0].type)?"":`placeholder="${window.siyuan.languages.empty}"`}  
class="fn__flex-1 fn__flex${["url","text","number","email","phone","block"].includes(c.values[0].type)?"":" custom-attr__avvalue"}${["created","updated"].includes(c.values[0].type)?" custom-attr__avvalue--readonly":""}">${wl(c.values[0])}</div>
</div>`}),l+=`<div class="fn__hr"></div>
<button data-type="addColumn" class="b3-button b3-button--cancel"><svg><use xlink:href="#iconAdd"></use></svg>${window.siyuan.languages.newCol}</button>
<div class="fn__hr--b"></div><div class="fn__hr--b"></div>`,s+=`<div data-av-id="${r.avID}" data-av-type="table" data-node-id="${e}" data-type="NodeAttributeView">${l}</div>`,t.innerHTML&&(t.querySelector(`[data-node-id="${e}"][data-av-id="${r.avID}"]`).innerHTML=l)}),t.innerHTML===""){let r;t.addEventListener("dragstart",l=>{const c=l.target;window.siyuan.dragElement=c.parentElement,window.siyuan.dragElement.style.opacity=".38",r=oe(window.siyuan.dragElement);const d=document.createElement("div");d.className="block__icons",d.innerHTML=c.nextElementSibling.outerHTML,d.setAttribute("style","width: 160px;position:fixed;opacity:.1;"),document.body.append(d),l.dataTransfer.setDragImage(d,0,0),setTimeout(()=>{d.remove()})}),t.addEventListener("drop",l=>{var c,d;if(o=0,n.disabled){l.preventDefault(),l.stopPropagation();return}const u=t.querySelector(".dragover__bottom, .dragover__top");if(u&&r){const g=u.classList.contains("dragover__bottom"),f=g?u.dataset.colId:(c=u.previousElementSibling)==null?void 0:c.getAttribute("data-col-id"),h=(d=window.siyuan.dragElement.previousElementSibling)==null?void 0:d.getAttribute("data-col-id");f!==h&&f!==window.siyuan.dragElement.dataset.colId&&(et(n,[{action:"sortAttrViewKey",avID:r.dataset.avId,previousID:f,id:window.siyuan.dragElement.dataset.colId}],[{action:"sortAttrViewKey",avID:r.dataset.avId,previousID:h,id:e}]),g?u.after(window.siyuan.dragElement):u.before(window.siyuan.dragElement)),u.classList.remove("dragover__bottom","dragover__top")}else if(!window.siyuan.dragElement&&l.dataTransfer.types[0]==="Files"){const g=t.querySelector(".custom-attr__avvalue--active");if(g&&l.dataTransfer.types[0]==="Files"&&!W()){const f=[];for(let h=0;h<l.dataTransfer.files.length;h++)f.push(webUtils.getPathForFile(l.dataTransfer.files[h]));FS(f,n,g)}}window.siyuan.dragElement&&(window.siyuan.dragElement.style.opacity="",window.siyuan.dragElement=void 0)}),t.addEventListener("dragover",l=>{const c=l.target;let d;if(l.dataTransfer.types.includes("Files")){t.querySelectorAll(".custom-attr__avvalue--active").forEach(f=>{f.classList.remove("custom-attr__avvalue--active")}),d=N(c,"custom-attr__avvalue"),d&&d.getAttribute("data-type")==="mAsset"&&(d.classList.add("custom-attr__avvalue--active"),l.preventDefault());return}if(d=N(c,"av__row"),d||(d=N(document.elementFromPoint(l.clientX,l.clientY-1),"av__row")),!d||d===window.siyuan.dragElement||!r)return;const u=oe(d);if(!u||u!==r)return;l.preventDefault();const g=d.getBoundingClientRect();t.querySelectorAll(".dragover__bottom, .dragover__top").forEach(f=>{f.classList.remove("dragover__bottom","dragover__top")}),l.clientY>g.top+g.height/2?d.classList.add("dragover__bottom"):d.classList.add("dragover__top")});let o=0;t.addEventListener("dragleave",()=>{o--,o===0&&t.querySelectorAll(".dragover__bottom, .dragover__top").forEach(l=>{l.classList.remove("dragover__bottom","dragover__top")})}),t.addEventListener("dragenter",l=>{l.preventDefault(),o++}),t.addEventListener("dragend",()=>{window.siyuan.dragElement&&(window.siyuan.dragElement.style.opacity="",window.siyuan.dragElement=void 0)}),t.addEventListener("paste",l=>{var c;const d=l.clipboardData.files;if(document.querySelector(".av__panel .b3-form__upload"))if(d&&d.length>0)_l(n,d);else{const u=l.clipboardData.getData("text/plain"),g=l.target,f=oe(g),h=ue(g,"data-type","mAsset");f&&h&&u&&(fs(n,f,u,[h],void 0,n.lute.Md2BlockDOM(u)),(c=document.querySelector(".av__panel"))==null||c.remove())}}),t.addEventListener("click",l=>{const c=ue(l.target,"data-type","remove");if(c){const d=oe(c);d&&(et(n,[{action:"removeAttrViewBlock",srcIDs:[c.dataset.rowId],avID:d.dataset.avId},{action:"doUpdateUpdated",id:c.dataset.rowId,data:at().format("YYYYMMDDHHmmss")}]),d.remove(),t.innerHTML||window.siyuan.dialogs.find(u=>{if(u.element.getAttribute("data-key")===p.DIALOG_ATTR)return u.destroy(),!0})),l.stopPropagation();return}PS(n,t,l)}),t.addEventListener("contextmenu",l=>{PS(n,t,l)}),t.innerHTML=s}t.querySelectorAll(".b3-text-field--text").forEach(r=>{r.addEventListener("change",()=>{let o;const l=r.parentElement.dataset.type;if(["url","text","email","phone"].includes(l)){if(o={[l]:{content:r.value}},l!=="text"){const c=r.parentElement.querySelector("a");r.value?c.setAttribute("href",(l==="url"?"":l==="email"?"mailto:":"tel:")+r.value):c.removeAttribute("href")}}else l==="number"?r.value==="undefined"||!r.value?o={number:{content:null,isNotEmpty:!1}}:o={number:{content:parseFloat(r.value)||0,isNotEmpty:!0}}:l==="block"&&(o={block:{content:r.value,id:r.dataset.id},isDetached:!1});ae("/api/av/setAttributeViewBlockAttr",{avID:r.parentElement.dataset.avId,keyID:r.parentElement.dataset.colId,itemID:r.parentElement.dataset.rowId,value:o},c=>{l==="number"?r.parentElement.querySelector(".fn__flex-center").textContent=c.data.value.number.formattedContent:l==="block"&&!r.value&&(r.value=c.data.value.block.content)})})}),a&&a(t)})},PS=(t,e,n)=>{let a=n.target;const i=oe(a);if(i)for(;a&&e!==a;){const s=a.getAttribute("data-type");if(a.classList.contains("b3-menu__avemoji")){const r=a.getBoundingClientRect();return Va(a.nextElementSibling.getAttribute("data-id"),"doc",{x:r.left,y:r.bottom,h:r.height,w:r.width},o=>{a.innerHTML=Yt(o||window.siyuan.storage[p.LOCAL_IMAGES].file)},a.querySelector("img")),n.preventDefault(),n.stopPropagation(),!0}else if(a.classList.contains("av__celltext--url")||a.classList.contains("av__cellassetimg")){if(n.type==="contextmenu"||!a.dataset.url&&a.tagName!=="IMG"){let r=0;Array.from(a.parentElement.children).find((o,l)=>{if(o===a)return r=l,!0}),o_({protyle:t,cellElements:[a.parentElement],blockElement:oe(a),content:a.tagName==="IMG"?a.getAttribute("src"):a.getAttribute("data-url"),type:a.tagName==="IMG"?"image":"file",name:a.tagName==="IMG"?"":a.getAttribute("data-name"),index:r,rect:a.getBoundingClientRect()})}else a.tagName==="IMG"?r_([a.getAttribute("src")]):Lf(t,a.dataset.url,n,n.ctrlKey||n.metaKey);n.stopPropagation(),n.preventDefault();break}else if(s==="date"){Bs(t,[a],"date"),n.stopPropagation(),n.preventDefault();break}else if(s==="select"||s==="mSelect"){Bs(t,[a],a.getAttribute("data-type")),n.stopPropagation(),n.preventDefault();break}else if(s==="mAsset"){e.querySelectorAll('.custom-attr__avvalue[data-type="mAsset"]').forEach(r=>{r.removeAttribute("data-active")}),a.setAttribute("data-active","true"),a.focus(),Bs(t,[a],"mAsset"),n.stopPropagation(),n.preventDefault();break}else if(s==="checkbox"){Bs(t,[a],"checkbox"),n.stopPropagation(),n.preventDefault();break}else if(s==="relation"){Bs(t,[a],"relation"),n.stopPropagation(),n.preventDefault();break}else if(s==="template"){Bs(t,[a],"template"),n.stopPropagation(),n.preventDefault();break}else if(s==="rollup"){Bs(t,[a],"rollup"),n.stopPropagation(),n.preventDefault();break}else if(s==="addColumn"){const r=i.querySelectorAll(".av__row"),o=Kh(t,i,r[r.length-1].getAttribute("data-col-id")),l=a.getBoundingClientRect();o.open({x:l.left,y:l.bottom,h:l.height}),n.stopPropagation(),n.preventDefault();break}else if(s==="editCol"){Vi({protyle:t,blockElement:i,type:"edit",colId:a.parentElement.dataset.colId}),n.stopPropagation(),n.preventDefault();break}a=a.parentElement}},NS=t=>!!t.getAttribute("data-av-id");var ax=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const BS=(t,e)=>{t.addEventListener("change",()=>{ae("/api/attr/setBlockAttrs",{id:e,attrs:{[t.dataset.name]:t.value}})})},ZM=t=>{const e=t.getAttribute("data-node-id"),n=hn(t),a=t.getAttribute(p.CUSTOM_REMINDER_WECHAT);let i="";a&&(i=at(a).format("YYYY-MM-DD HH:mm"));const s=new fe({width:x()?"92vw":"50vw",title:window.siyuan.languages.wechatReminder,content:`<div class="b3-dialog__content custom-attr">
    <div class="fn__flex">
        <span class="ft__on-surface fn__flex-center" style="text-align: right;white-space: nowrap;width: 100px">${window.siyuan.languages.notifyTime}</span>
        <div class="fn__space"></div>
        <input class="b3-text-field fn__flex-1" type="datetime-local" max="9999-12-31 23:59" value="${i}">
    </div>
    <div class="b3-label__text" style="text-align: center">${window.siyuan.languages.wechatTip}</div>
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.remove}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,destroyCallback(){Pt(n)}});s.element.setAttribute("data-key",p.DIALOG_WECHATREMINDER);const r=s.element.querySelectorAll(".b3-button");r[0].addEventListener("click",()=>{s.destroy()}),r[1].addEventListener("click",()=>{r[1].getAttribute("disabled")||(r[1].setAttribute("disabled","disabled"),ae("/api/block/setBlockReminder",{id:e,timed:"0"},()=>{t.removeAttribute(p.CUSTOM_REMINDER_WECHAT),s.destroy()}))}),r[2].addEventListener("click",()=>{const o=s.element.querySelector("input").value;if(o){if(new Date(o)<=new Date){Q(window.siyuan.languages.reminderTip);return}if(r[2].getAttribute("disabled"))return;r[2].setAttribute("disabled","disabled");const l=at(o).format("YYYYMMDDHHmmss");ae("/api/block/setBlockReminder",{id:e,timed:l},()=>{t.setAttribute(p.CUSTOM_REMINDER_WECHAT,l),s.destroy()})}else Q(window.siyuan.languages.notEmpty)})},JM=t=>{ae("/api/block/getDocInfo",{id:t.block.rootID},e=>{const n=e.data.ial[p.CUSTOM_REMINDER_WECHAT];let a="";n&&(a=at(n).format("YYYY-MM-DD HH:mm"));const i=new fe({width:x()?"92vw":"50vw",title:window.siyuan.languages.wechatReminder,content:`<div class="b3-dialog__content custom-attr">
    <div class="fn__flex">
        <span class="ft__on-surface fn__flex-center" style="text-align: right;white-space: nowrap;width: 100px">${window.siyuan.languages.notifyTime}</span>
        <div class="fn__space"></div>
        <input class="b3-text-field fn__flex-1" type="datetime-local" max="9999-12-31 23:59" value="${a}">
    </div>
    <div class="b3-label__text" style="text-align: center">${window.siyuan.languages.wechatTip}</div>
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.remove}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`});i.element.setAttribute("data-key",p.DIALOG_WECHATREMINDER);const s=i.element.querySelectorAll(".b3-button");s[0].addEventListener("click",()=>{i.destroy()}),s[1].addEventListener("click",()=>{ae("/api/block/setBlockReminder",{id:t.block.rootID,timed:"0"},()=>{i.destroy()})}),s[2].addEventListener("click",()=>{const r=i.element.querySelector("input").value;if(r){if(new Date(r)<=new Date){Q(window.siyuan.languages.reminderTip);return}ae("/api/block/setBlockReminder",{id:t.block.rootID,timed:at(r).format("YYYYMMDDHHmmss")},()=>{i.destroy()})}else Q(window.siyuan.languages.notEmpty)})})},Zs=(t,e="bookmark",n)=>{let a="",i="",s=!1;const r=getSelection().rangeCount>0?getSelection().getRangeAt(0):null;let o;n||(Es().find(c=>{if(t.id===c.protyle.block.rootID)return n=c.protyle,!0}),n||(o=new ar(window.siyuan.ws.app,document.createElement("div"),{blockId:t.id}))),Object.keys(t).forEach(c=>{p.CUSTOM_RIFF_DECKS===c||c.startsWith("custom-sy-")||(c===p.CUSTOM_REMINDER_WECHAT?i=`<label class="b3-label b3-label--noborder">
    ${window.siyuan.languages.wechatReminder}
    <div class="fn__hr"></div>
    <input class="b3-text-field fn__block" type="datetime-local" max="9999-12-31 23:59" readonly data-name="${c}" value="${at(t[c]).format("YYYY-MM-DD HH:mm")}">
</label>`:c.indexOf("custom-av")>-1?s=!0:c.indexOf("custom")>-1&&(a+=`<label class="b3-label b3-label--noborder">
     <div class="fn__flex">
        <span class="fn__flex-1">${c.replace("custom-","")}</span>
        <span data-action="remove" class="block__icon block__icon--show"><svg><use xlink:href="#iconMin"></use></svg></span>
    </div>
    <div class="fn__hr"></div>
    <textarea style="resize: vertical;" spellcheck="false" class="b3-text-field fn__block" rows="1" data-name="${c}">${t[c]}</textarea>
</label>`))});const l=new fe({width:x()?"92vw":"50vw",containerClassName:"b3-dialog__container--theme",height:"80vh",content:`<div class="fn__flex-column">
    <div class="layout-tab-bar fn__flex" style="flex-shrink:0;border-radius: var(--b3-border-radius-b) var(--b3-border-radius-b) 0 0">
        <div class="item item--full item--focus" data-type="attr">
            <span class="fn__flex-1"></span>
            <span class="item__text">${window.siyuan.languages.builtIn}</span>
            <span class="fn__flex-1"></span>
        </div>
        <div class="item item--full${s?"":" fn__none"}" data-type="NodeAttributeView">
            <span class="fn__flex-1"></span>
            <span class="item__text">${window.siyuan.languages.database}</span>
            <span class="fn__flex-1"></span>
        </div>
        <div class="item item--full" data-type="custom">
            <span class="fn__flex-1"></span>
            <span class="item__text">${window.siyuan.languages.custom}</span>
            <span class="fn__flex-1"></span>
        </div>
    </div>
    <div class="fn__flex-1">
        <div class="custom-attr" data-type="attr">
            <label class="b3-label b3-label--noborder">
                <div class="fn__flex">
                    <span class="fn__flex-1">${window.siyuan.languages.bookmark}</span>
                    <span data-action="bookmark" class="block__icon block__icon--show"><svg><use xlink:href="#iconDown"></use></svg></span>
                </div>
                <div class="fn__hr"></div>
                <input spellcheck="${window.siyuan.config.editor.spellcheck}" class="b3-text-field fn__block" placeholder="${window.siyuan.languages.attrBookmarkTip}" data-name="bookmark">
            </label>
            <label class="b3-label b3-label--noborder">
                ${window.siyuan.languages.name}
                <div class="fn__hr"></div>
                <input spellcheck="${window.siyuan.config.editor.spellcheck}" class="b3-text-field fn__block" placeholder="${window.siyuan.languages.attrNameTip}" data-name="name">
            </label>
            <label class="b3-label b3-label--noborder">
                ${window.siyuan.languages.alias}
                <div class="fn__hr"></div>
                <input spellcheck="${window.siyuan.config.editor.spellcheck}" class="b3-text-field fn__block" placeholder="${window.siyuan.languages.attrAliasTip}" data-name="alias">
            </label>
            <label class="b3-label b3-label--noborder">
                ${window.siyuan.languages.memo}
                <div class="fn__hr"></div>
                <textarea style="resize: vertical" spellcheck="${window.siyuan.config.editor.spellcheck}" class="b3-text-field fn__block" placeholder="${window.siyuan.languages.attrMemoTip}" rows="2" data-name="memo">${t.memo||""}</textarea>
            </label>
            ${i}
        </div>
        <div data-type="NodeAttributeView" class="fn__none custom-attr"></div>
        <div data-type="custom" class="fn__none custom-attr">
           ${a}
           <div class="b3-label">
               <button data-action="addCustom" class="b3-button b3-button--cancel">
                   <svg><use xlink:href="#iconAdd"></use></svg>${window.siyuan.languages.addAttr}
               </button>
           </div>
        </div>
    </div>
</div>`,destroyCallback(){Pt(r),n?Ut(["select"],n):o.destroy()}});l.element.setAttribute("data-key",p.DIALOG_ATTR),l.element.querySelector('.b3-text-field[data-name="bookmark"]').value=t.bookmark||"",l.element.querySelector('.b3-text-field[data-name="name"]').value=t.name||"",l.element.querySelector('.b3-text-field[data-name="alias"]').value=t.alias||"",l.element.addEventListener("click",c=>{let d=c.target;for(typeof c.detail=="string"&&(d=l.element.querySelector(`.item--full[data-type="${c.detail}"]`));d!==l.element;){const u=d.dataset.action;if(d.classList.contains("item--full"))d.parentElement.querySelector(".item--focus").classList.remove("item--focus"),d.classList.add("item--focus"),l.element.querySelectorAll(".custom-attr").forEach(g=>{g.dataset.type===d.dataset.type?(g.dataset.type==="NodeAttributeView"&&g.innerHTML===""&&nx(g,t.id,n||o.protyle),g.classList.remove("fn__none")):g.classList.add("fn__none")});else if(u==="remove"){ae("/api/attr/setBlockAttrs",{id:t.id,attrs:{["custom-"+d.previousElementSibling.textContent]:""}}),d.parentElement.parentElement.remove(),c.stopPropagation(),c.preventDefault();break}else if(u==="bookmark"){ae("/api/attr/getBookmarkLabels",{},g=>{window.siyuan.menus.menu.remove(),g.data.length===0?window.siyuan.menus.menu.append(new xe({id:"emptyContent",iconHTML:"",label:window.siyuan.languages.emptyContent,type:"readonly"}).element):g.data.forEach(f=>{window.siyuan.menus.menu.append(new xe({label:f,click(){const h=d.parentElement.parentElement.querySelector("input");h.value=f,h.dispatchEvent(new CustomEvent("change"))}}).element)}),window.siyuan.menus.menu.element.classList.add("b3-menu--list"),window.siyuan.menus.menu.popup({x:c.clientX,y:c.clientY+16,w:16})}),c.stopPropagation(),c.preventDefault();break}else if(u==="addCustom"){const g=new fe({title:window.siyuan.languages.attrName,content:`<div class="b3-dialog__content"><input spellcheck="false" class="b3-text-field fn__block" value=""></div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"});g.element.setAttribute("data-key",p.DIALOG_SETCUSTOMATTR);const f=g.element.querySelector("input"),h=g.element.querySelectorAll(".b3-button");g.bindInput(f,()=>{h[1].click()}),f.focus(),f.select(),h[0].addEventListener("click",()=>{g.destroy()}),h[1].addEventListener("click",()=>{if(!F(f.value))return Q(window.siyuan.languages.attrName+" <b>"+he(f.value)+"</b> "+window.siyuan.languages.invalid),!1;d.parentElement.insertAdjacentHTML("beforebegin",`<div class="b3-label b3-label--noborder">
    <div class="fn__flex">
        <span class="fn__flex-1">${f.value}</span>
        <span data-action="remove" class="block__icon block__icon--show"><svg><use xlink:href="#iconMin"></use></svg></span>
    </div>
    <div class="fn__hr"></div>
    <textarea style="resize: vertical" spellcheck="false" data-name="custom-${f.value}" class="b3-text-field fn__block" rows="1" placeholder="${window.siyuan.languages.attrValue1}"></textarea>
</div>`);const m=d.parentElement.previousElementSibling.querySelector(".b3-text-field");m.focus(),BS(m,t.id),g.destroy()}),c.stopPropagation(),c.preventDefault();break}d=d.parentElement}}),l.element.querySelectorAll(".b3-text-field").forEach(c=>{e!=="av"&&e!=="custom"&&e===c.getAttribute("data-name")&&c.focus(),BS(c,t.id)}),e==="av"?l.element.dispatchEvent(new CustomEvent("click",{detail:"NodeAttributeView"})):e==="custom"&&l.element.dispatchEvent(new CustomEvent("click",{detail:"custom"}))},Ho=(t,e="bookmark",n)=>{if(t.getAttribute("data-type")==="NodeThematicBreak")return;const a=t.getAttribute("data-node-id");ae("/api/attr/getBlockAttrs",{id:a},i=>{Zs(i.data,e,n)})},sc=(t,e=!0,n,a)=>{const i=[{id:"copyBlockRef",iconHTML:"",accelerator:e?window.siyuan.config.keymap.editor.general.copyBlockRef.custom:void 0,label:window.siyuan.languages.copyBlockRef,click:()=>{Ja(t,"ref"),n&&qt(n)}},{id:"copyBlockEmbed",iconHTML:"",label:window.siyuan.languages.copyBlockEmbed,accelerator:e?window.siyuan.config.keymap.editor.general.copyBlockEmbed.custom:void 0,click:()=>{Ja(t,"blockEmbed"),n&&qt(n)}},{id:"copyProtocol",iconHTML:"",label:window.siyuan.languages.copyProtocol,accelerator:e?window.siyuan.config.keymap.editor.general.copyProtocol.custom:void 0,click:()=>{Ja(t,"protocol"),n&&qt(n)}},{id:"copyProtocolInMd",iconHTML:"",label:window.siyuan.languages.copyProtocolInMd,accelerator:e?window.siyuan.config.keymap.editor.general.copyProtocolInMd.custom:void 0,click:()=>{Ja(t,"protocolMd"),n&&qt(n)}},{id:"copyHPath",iconHTML:"",label:window.siyuan.languages.copyHPath,accelerator:e?window.siyuan.config.keymap.editor.general.copyHPath.custom:void 0,click:()=>{Ja(t,"hPath"),n&&qt(n)}},{id:"copyID",iconHTML:"",label:window.siyuan.languages.copyID,accelerator:e?window.siyuan.config.keymap.editor.general.copyID.custom:void 0,click:()=>{Ja(t,"id"),n&&qt(n)}}];return a&&i.push({id:"copyMarkdown",iconHTML:"",label:window.siyuan.languages.copyMarkdown,accelerator:void 0,click:()=>ax(void 0,null,function*(){const r=(yield wn("/api/export/exportMdContent",{id:a,refMode:3,embedMode:1,yfm:!1,fillCSSVar:!1,adjustHeadingLevel:!1})).data.content;ut(r),n&&qt(n)})}),i},$S=t=>{if(!window.siyuan.isPublish)return new xe({id:"export",label:window.siyuan.languages.export,type:"submenu",icon:"iconUpload",submenu:[{id:"exportTemplate",label:window.siyuan.languages.template,iconClass:"ft__error",icon:"iconMarkdown",click:()=>ax(void 0,null,function*(){const e=yield wn("/api/block/getRefText",{id:t}),n=new fe({title:window.siyuan.languages.fileName,content:`<div class="b3-dialog__content"><input class="b3-text-field fn__block" value=""></div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"});n.element.setAttribute("data-key",p.DIALOG_EXPORTTEMPLATE);const a=n.element.querySelector("input"),i=n.element.querySelectorAll(".b3-button");n.bindInput(a,()=>{i[1].click()});let s=Wi(e.data);const r=32;s.length>r&&(s=s.substring(0,r)),a.value=s,a.focus(),a.select(),i[0].addEventListener("click",()=>{n.destroy()}),i[1].addEventListener("click",()=>{a.value.trim()===""?a.value=window.siyuan.languages.untitled:a.value=Wi(a.value),s.length>r&&(s=s.substring(0,r)),ae("/api/template/docSaveAsTemplate",{id:t,name:a.value,overwrite:!1},o=>{if(o.code===1){Sn(window.siyuan.languages.export,window.siyuan.languages.exportTplTip,()=>{ae("/api/template/docSaveAsTemplate",{id:t,name:a.value,overwrite:!0},l=>{l.code===0&&Q(window.siyuan.languages.exportTplSucc)})});return}Q(window.siyuan.languages.exportTplSucc)}),n.destroy()})})},{id:"exportSiYuanZip",label:"SiYuan .sy.zip",icon:"iconSiYuan",click:()=>{const e=Q(window.siyuan.languages.exporting,-1);ae("/api/export/exportSY",{id:t},n=>{ot(e),$e(n.data.zip)})}},{id:"exportMarkdown",label:"Markdown .zip",icon:"iconMarkdown",click:()=>{const e=Q(window.siyuan.languages.exporting,-1);ae("/api/export/exportMd",{id:t},n=>{ot(e),$e(n.data.zip)})}},{id:"exportImage",label:window.siyuan.languages.image,icon:"iconImage",click:()=>{vh(t)}},{id:"exportPDF",label:window.siyuan.languages.print,icon:"iconPDF",ignore:!St()&&!Qt(),click:()=>{const e=Q(window.siyuan.languages.exporting),n=window.siyuan.storage[p.LOCAL_EXPORTPDF];ae("/api/export/exportPreviewHTML",{id:t,keepFold:n.keepFold,merge:n.mergeSubdocs},a=>ax(void 0,null,function*(){const i=window.location.protocol+"//"+window.location.host+"/",s=yield yh(a,void 0,i,{type:"pdf",id:t});St()?window.JSAndroid.print(s):Qt()&&window.JSHarmony.print(s),setTimeout(()=>{ot(e)},3e3)}))}},{id:"exportHTML_SiYuan",label:"HTML (SiYuan)",iconClass:"ft__error",icon:"iconHTML5",click:()=>{Bo({type:"html",id:t})}},{id:"exportHTML_Markdown",label:"HTML (Markdown)",icon:"iconHTML5",click:()=>{Bo({type:"htmlmd",id:t})}}]}).element},Wh=(t,e,n,a)=>{const i=[];if(Mo(e)?p.SIYUAN_ASSETS_EXTS.includes(_n().extname(e).split("?")[0])&&(!e.endsWith(".pdf")||e.endsWith(".pdf")&&!e.startsWith("file://"))?(i.push({id:"insertRight",icon:"iconLayoutRight",label:window.siyuan.languages.insertRight,accelerator:a?window.siyuan.languages.click:"",click(){kc(t,e.trim(),parseInt(O("page",e)),"right")}}),i.push({id:"openBy",label:window.siyuan.languages.openBy,icon:"iconOpen",accelerator:a?"\u2325"+window.siyuan.languages.click:"",click(){kc(t,e.trim(),parseInt(O("page",e)))}})):i.push({id:St()||Qt()?"useDefault":"useBrowserView",label:St()||Qt()?window.siyuan.languages.useDefault:window.siyuan.languages.useBrowserView,accelerator:a?window.siyuan.languages.click:"",click:()=>{$e(e)}}):e&&(0>e.indexOf(":")&&(e=`https://${e}`),i.push({id:St()||Qt()?"useDefault":"useBrowserView",label:St()||Qt()?window.siyuan.languages.useDefault:window.siyuan.languages.useBrowserView,accelerator:a?window.siyuan.languages.click:"",click:()=>{$e(e)}})),n)return i;window.siyuan.menus.menu.append(new xe({id:"openBy",label:window.siyuan.languages.openBy,icon:"iconOpen",submenu:i}).element)},OS=t=>new xe({id:"rename",accelerator:window.siyuan.config.keymap.editor.general.rename.custom,icon:"iconEdit",label:window.siyuan.languages.rename,click:()=>{bf(t)}}).element,ix=t=>new xe({id:"move",label:window.siyuan.languages.move,icon:"iconMove",accelerator:window.siyuan.config.keymap.general.move.custom,click(){ur((e,n)=>{lf(t,n[0],e[0])},t)}}).element;var QM=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const Qa=t=>{t.menu.addItem({iconHTML:"",label:sx(t.operator,!!t.data),click(){if(!t.data)et(t.protyle,[{action:"setAttrViewColCalc",avID:t.avId,id:t.colId,data:{operator:t.operator},blockID:t.blockID}],[{action:"setAttrViewColCalc",avID:t.avId,id:t.colId,data:{operator:t.oldOperator},blockID:t.blockID}]);else{t.target.querySelector(".b3-menu__accelerator").textContent=sx(t.operator,!0);const e=ma(t.data).find(n=>{if(n.id===t.colId)return n.rollup||(n.rollup={}),!0});e.rollup.calc={operator:t.operator},et(t.protyle,[{action:"updateAttrViewColRollup",id:t.colId,avID:t.avId,parentID:e.rollup.relationKeyID,keyID:e.rollup.keyID,data:{calc:e.rollup.calc}}],[{action:"updateAttrViewColRollup",id:t.colId,avID:t.avId,parentID:e.rollup.relationKeyID,keyID:e.rollup.keyID,data:{calc:{operator:t.oldOperator}}}])}}})},RS=(t,e,n,a)=>QM(void 0,null,function*(){let i,s,r,o,l,c;if(n)o=n.data.id,s=e.dataset.colType,l=e.dataset.calc,r=n.colId,c=n.blockID;else{const f=oe(e);if(!f||(i=N(e,"av__row--footer"),!i))return;i.classList.add("av__row--show"),s=e.dataset.dtype,r=e.dataset.colId,o=f.dataset.avId,l=e.dataset.operator,c=f.dataset.nodeId}if(s==="lineNumber")return;const d=new ta(p.MENU_AV_CALC,()=>{i&&i.classList.remove("av__row--show")});if(d.isOpen)return;Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"",data:n==null?void 0:n.data,blockID:c,target:e}),n!=null&&n.data&&s!=="checkbox"&&Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Unique values",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Count all",data:n==null?void 0:n.data,blockID:c,target:e}),s!=="checkbox"?(Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Count empty",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Count not empty",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Count values",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Count unique values",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Percent empty",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Percent not empty",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Percent unique values",data:n==null?void 0:n.data,blockID:c,target:e})):(Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Checked",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Unchecked",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Percent checked",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Percent unchecked",data:n==null?void 0:n.data,blockID:c,target:e}));let u=!1;if(s==="rollup"){let f,h,m=n==null?void 0:n.data;if(m||(m=(yield wn("api/av/renderAttributeView",{id:o})).data),ma(m).find(b=>{var y,_;if(b.id===r)return f=(y=b.rollup)==null?void 0:y.relationKeyID,h=(_=b.rollup)==null?void 0:_.keyID,!0}),f&&h){let b;ma(m).find(y=>{var _;if(y.id===f)return b=(_=y.relation)==null?void 0:_.avID,!0}),b&&(yield wn("api/av/getAttributeView",{id:b})).data.av.keyValues.find(_=>{if(_.key.id===h)return u=_.key.type==="number",!0})}}["number","template"].includes(s)||u?(Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Sum",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Average",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Median",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Min",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Max",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Range",data:n==null?void 0:n.data,blockID:c,target:e})):["date","created","updated"].includes(s)&&(Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Earliest",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Latest",data:n==null?void 0:n.data,blockID:c,target:e}),Qa({menu:d,protyle:t,colId:r,avId:o,oldOperator:l,operator:"Range",data:n==null?void 0:n.data,blockID:c,target:e}));const g=e.getBoundingClientRect();d.open({x:Math.max(a||0,g.left),y:g.bottom,h:g.height})}),eF=t=>{if(!t.calc||!t.calc.result)return"";let e=t.calc.result.number;(t.calc.operator==="Earliest"||t.calc.operator==="Latest"||t.calc.operator==="Range"&&["date","created","updated"].includes(t.type))&&(e=t.calc.result[t.type]);let n="";switch(t.calc.operator){case"Count all":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcResultCountAll}</small>`;break;case"Count values":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcResultCountValues}</small>`;break;case"Count unique values":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcResultCountUniqueValues}</small>`;break;case"Count empty":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcResultCountEmpty}</small>`;break;case"Count not empty":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcResultCountNotEmpty}</small>`;break;case"Percent empty":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcResultPercentEmpty}</small>`;break;case"Percent not empty":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcResultPercentNotEmpty}</small>`;break;case"Percent unique values":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcResultPercentUniqueValues}</small>`;break;case"Sum":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcResultSum}</small>`;break;case"Average":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcResultAverage}</small>`;break;case"Median":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcResultMedian}</small>`;break;case"Min":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcResultMin}</small>`;break;case"Max":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcResultMax}</small>`;break;case"Range":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcResultRange}</small>`;break;case"Earliest":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcOperatorEarliest}</small>`;break;case"Latest":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.calcOperatorLatest}</small>`;break;case"Checked":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.checked}</small>`;break;case"Unchecked":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.unchecked}</small>`;break;case"Percent checked":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.percentChecked}</small>`;break;case"Percent unchecked":n=`<span>${e.formattedContent}</span><small>${window.siyuan.languages.percentUnchecked}</small>`;break}return n},sx=(t,e)=>{switch(t){case void 0:case"":return e?window.siyuan.languages.original:window.siyuan.languages.calcOperatorNone;case"Unique values":return window.siyuan.languages.uniqueValues;case"Count all":return window.siyuan.languages.calcOperatorCountAll;case"Count values":return window.siyuan.languages.calcOperatorCountValues;case"Count unique values":return window.siyuan.languages.calcOperatorCountUniqueValues;case"Count empty":return window.siyuan.languages.calcOperatorCountEmpty;case"Count not empty":return window.siyuan.languages.calcOperatorCountNotEmpty;case"Percent empty":return window.siyuan.languages.calcOperatorPercentEmpty;case"Percent not empty":return window.siyuan.languages.calcOperatorPercentNotEmpty;case"Percent unique values":return window.siyuan.languages.calcOperatorPercentUniqueValues;case"Checked":return window.siyuan.languages.checked;case"Unchecked":return window.siyuan.languages.unchecked;case"Percent checked":return window.siyuan.languages.percentChecked;case"Percent unchecked":return window.siyuan.languages.percentUnchecked;case"Sum":return window.siyuan.languages.calcOperatorSum;case"Average":return window.siyuan.languages.calcOperatorAverage;case"Median":return window.siyuan.languages.calcOperatorMedian;case"Min":return window.siyuan.languages.calcOperatorMin;case"Max":return window.siyuan.languages.calcOperatorMax;case"Range":return window.siyuan.languages.calcOperatorRange;case"Earliest":return window.siyuan.languages.calcOperatorEarliest;case"Latest":return window.siyuan.languages.calcOperatorLatest;default:return""}},tF=t=>{const e=t.nodeElement.getAttribute("data-av-id"),n=t.nodeElement.getAttribute("data-node-id"),a=t.target.querySelector(".b3-menu__accelerator"),i=new ta;i.addItem({iconHTML:"",checked:t.view.coverFrom===0,label:window.siyuan.languages.calcOperatorNone,click(){et(t.protyle,[{action:"setAttrViewCoverFrom",avID:e,blockID:n,data:0}],[{action:"setAttrViewCoverFrom",avID:e,blockID:n,data:t.view.coverFrom}]),t.view.coverFrom=0,a.textContent=window.siyuan.languages.calcOperatorNone}}),i.addItem({iconHTML:"",checked:t.view.coverFrom===3,label:window.siyuan.languages.contentBlock,click(){et(t.protyle,[{action:"setAttrViewCoverFrom",avID:e,blockID:n,data:3}],[{action:"setAttrViewCoverFrom",avID:e,blockID:n,data:t.view.coverFrom}]),t.view.coverFrom=3,a.textContent=window.siyuan.languages.contentBlock}}),i.addItem({iconHTML:"",checked:t.view.coverFrom===1,label:window.siyuan.languages.contentImage,click(){et(t.protyle,[{action:"setAttrViewCoverFrom",avID:e,blockID:n,data:1}],[{action:"setAttrViewCoverFrom",avID:e,blockID:n,data:t.view.coverFrom}]),t.view.coverFrom=1,a.textContent=window.siyuan.languages.contentImage}});let s=!1;t.view.fields.forEach(o=>{o.type==="mAsset"&&(s||(i.addSeparator(),s=!0),i.addItem({iconHTML:o.icon?Yt(o.icon,"b3-menu__icon",!0):`<svg class="b3-menu__icon"><use xlink:href="#${za(o.type)}"></use></svg>`,checked:t.view.coverFrom===2&&t.view.coverFromAssetKeyID===o.id,label:o.name,click(){et(t.protyle,[{action:"setAttrViewCoverFrom",avID:e,blockID:n,data:2},{action:"setAttrViewCoverFromAssetKeyID",avID:e,blockID:n,keyID:o.id}],[{action:"setAttrViewCoverFrom",avID:e,blockID:n,data:t.view.coverFrom},{action:"setAttrViewCoverFromAssetKeyID",avID:e,blockID:n,keyID:t.view.coverFromAssetKeyID}]),t.view.coverFrom=2,t.view.coverFromAssetKeyID=o.id,a.textContent=o.name}}))});const r=t.target.getBoundingClientRect();i.open({x:r.left,y:r.bottom})},nF=t=>{const e=new ta,n=t.nodeElement.getAttribute("data-av-id"),a=t.nodeElement.getAttribute("data-node-id"),i=t.nodeElement.getAttribute(p.CUSTOM_SY_AV_VIEW),s=t.target.querySelector(".b3-menu__accelerator");e.addItem({iconHTML:"",checked:t.view.cardSize===0,label:window.siyuan.languages.small,click(){et(t.protyle,[{action:"setAttrViewCardSize",avID:n,blockID:a,data:0,viewID:i}],[{action:"setAttrViewCardSize",avID:n,blockID:a,data:t.view.cardSize,viewID:i}]),t.view.cardSize=0,s.textContent=window.siyuan.languages.small}}),e.addItem({iconHTML:"",checked:t.view.cardSize===1,label:window.siyuan.languages.medium,click(){et(t.protyle,[{action:"setAttrViewCardSize",avID:n,blockID:a,data:1,viewID:i}],[{action:"setAttrViewCardSize",avID:n,blockID:a,data:t.view.cardSize,viewID:i}]),t.view.cardSize=1,s.textContent=window.siyuan.languages.medium}}),e.addItem({iconHTML:"",checked:t.view.cardSize===2,label:window.siyuan.languages.large,click(){et(t.protyle,[{action:"setAttrViewCardSize",avID:n,blockID:a,data:2,viewID:i}],[{action:"setAttrViewCardSize",avID:n,blockID:a,data:t.view.cardSize,viewID:i}]),t.view.cardSize=2,s.textContent=window.siyuan.languages.large}});const r=t.target.getBoundingClientRect();e.open({x:r.left,y:r.bottom})},rx=t=>{switch(t){case 0:return"16:9";case 1:return"9:16";case 2:return"4:3";case 3:return"3:4";case 4:return"3:2";case 5:return"2:3";case 6:return"1:1"}return"16:9"},aF=t=>{const e=new ta,n=t.nodeElement.getAttribute("data-av-id"),a=t.nodeElement.getAttribute("data-node-id"),i=t.nodeElement.getAttribute(p.CUSTOM_SY_AV_VIEW),s=t.target.querySelector(".b3-menu__accelerator");[0,1,2,3,4,5,6].forEach(o=>{e.addItem({iconHTML:"",checked:t.view.cardAspectRatio===o,label:rx(o),click(){et(t.protyle,[{action:"setAttrViewCardAspectRatio",avID:n,blockID:a,data:o,viewID:i}],[{action:"setAttrViewCardAspectRatio",avID:n,blockID:a,data:t.view.cardAspectRatio,viewID:i}]),t.view.cardAspectRatio=o,s.textContent=rx(o)}})});const r=t.target.getBoundingClientRect();e.open({x:r.left,y:r.bottom})},US=t=>{const e=N(t.target,"av__gallery-item");e&&Vh(t.protyle,e,t.position)},iF=t=>{const e=N(t,"av__gallery-item");if(e){const n=e.querySelector(".av__gallery-fields");n&&(t.setAttribute("aria-label",window.siyuan.languages[n.classList.contains("av__gallery-fields--edit")?"displayEmptyFields":"hideEmptyFields"]),n.classList.toggle("av__gallery-fields--edit"))}};var sF=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const rF=(t,e)=>{var n,a,i,s,r;if(je(e))return!1;const o=oe(e.target);if(!o)return!1;const l=o.getAttribute("data-av-type");let c=e.target;for(;c&&!c.isEqualNode(o);){const d=c.getAttribute("data-type");if(d==="av-header-add"&&!t.disabled){const u=Kh(t,o),g=c.getBoundingClientRect();return u.open({x:g.left,y:g.bottom,h:g.height}),e.preventDefault(),e.stopPropagation(),!0}else{if(d==="av-header-more"&&!t.disabled)return Vi({protyle:t,blockElement:o,type:"properties"}),e.preventDefault(),e.stopPropagation(),!0;if(d==="av-add-more"&&!t.disabled)return nc({blockElement:o,protyle:t,count:1,previousID:"",groupID:((n=o.querySelector(".av__body"))==null?void 0:n.getAttribute("data-group-id"))||""}),e.preventDefault(),e.stopPropagation(),!0;if(d==="av-more"&&!t.disabled)return Vi({protyle:t,blockElement:o,type:"config"}),e.preventDefault(),e.stopPropagation(),!0;if(d==="av-switcher"&&!t.disabled)return Vi({protyle:t,blockElement:o,type:"switcher"}),e.preventDefault(),e.stopPropagation(),!0;if(d==="av-sort"&&!t.disabled)return Vi({protyle:t,blockElement:o,type:"sorts"}),e.preventDefault(),e.stopPropagation(),!0;if(d==="av-filter"&&!t.disabled)return Vi({protyle:t,blockElement:o,type:"filters"}),e.preventDefault(),e.stopPropagation(),!0;if(d==="av-add"&&!t.disabled)return T2(t,o),e.preventDefault(),e.stopPropagation(),!0;if(d==="block-more"&&!t.disabled)return window.siyuan.menus.menu.remove(),t.toolbar.range=document.createRange(),t.toolbar.range.selectNodeContents(c),Pt(t.toolbar.range),l==="table"&&(c.parentElement.classList.add("av__cell--select"),Js(c.parentElement)),ic(c.previousElementSibling.textContent.trim(),t,"av"),e.preventDefault(),e.stopPropagation(),!0;if(d==="set-page-size"&&!t.disabled)return I2({target:c,protyle:t,avID:o.getAttribute("data-av-id"),nodeElement:o}),e.preventDefault(),e.stopPropagation(),!0;if(d==="av-add-bottom"&&!t.disabled){const u=N(c,"av__body");return nc({blockElement:o,protyle:t,count:1,previousID:u&&((i=(a=u.querySelector(".av__row--util"))==null?void 0:a.previousElementSibling)==null?void 0:i.getAttribute("data-id"))||((s=c.previousElementSibling)==null?void 0:s.getAttribute("data-id"))||void 0,groupID:u?u.getAttribute("data-group-id"):""}),e.preventDefault(),e.stopPropagation(),!0}else if(d==="av-add-top"&&!t.disabled){const u=N(c,"av__group-title");return nc({blockElement:o,protyle:t,count:1,previousID:"",groupID:u?u.nextElementSibling.getAttribute("data-group-id"):""}),e.preventDefault(),e.stopPropagation(),!0}else{if(c.classList.contains("av__cell--header")&&!t.disabled)return iA(t,o,c),e.preventDefault(),e.stopPropagation(),!0;if(c.classList.contains("av__cell")&&!t.disabled){if(!N(c,"av__row--header")){if(c.querySelector(".av__pulse"))return;const u=Ns(c);if(l==="table"){const g=N(c,"av__scroll");if(!g)return;const f=N(c,"av__row");if(!f)return;u==="updated"||u==="created"||u==="lineNumber"?lo(f.querySelector(".av__firstcol"),"toggle"):(g.querySelectorAll(".av__row--select").forEach(h=>{h.querySelector(".av__firstcol use").setAttribute("xlink:href","#iconUncheck"),h.classList.remove("av__row--select")}),ec(f),Bs(t,[c]))}else N(c,"av__gallery-item")&&u!=="updated"&&u!=="created"&&u!=="lineNumber"&&Bs(t,[c])}return e.preventDefault(),e.stopPropagation(),!0}else{if(c.classList.contains("av__calc")&&!t.disabled)return RS(t,c,void 0,e.clientX-64),e.preventDefault(),e.stopPropagation(),!0;if(c.classList.contains("b3-menu__avemoji")&&!t.disabled){const u=c.getBoundingClientRect();return Va(c.nextElementSibling.getAttribute("data-id"),"doc",{x:u.left,y:u.bottom,h:u.height,w:u.width},g=>{c.innerHTML=Yt(g||window.siyuan.storage[p.LOCAL_IMAGES].file)},c.querySelector("img")),e.preventDefault(),e.stopPropagation(),!0}else{if(d==="av-gallery-edit"&&!t.disabled)return iF(c),e.preventDefault(),e.stopPropagation(),!0;if(d==="av-gallery-more"&&!t.disabled){const u=c.getBoundingClientRect();return US({target:c,protyle:t,position:{x:u.left,y:u.bottom}}),e.preventDefault(),e.stopPropagation(),!0}else if(d==="av-group-fold"){if(c.getAttribute("data-folding")!=="true"){c.setAttribute("data-folding","true");const u=c.firstElementChild.classList.contains("av__group-arrow--open");et(t,[{action:"foldAttrViewGroup",avID:o.dataset.avId,blockID:o.dataset.nodeId,id:c.dataset.id,data:u}],[{action:"foldAttrViewGroup",avID:o.dataset.avId,blockID:o.dataset.nodeId,id:c.dataset.id,data:!u}]),u?(c.firstElementChild.classList.remove("av__group-arrow--open"),c.parentElement.nextElementSibling.classList.add("fn__none")):(c.firstElementChild.classList.add("av__group-arrow--open"),c.parentElement.nextElementSibling.classList.remove("fn__none"))}return e.preventDefault(),e.stopPropagation(),!0}else if(d==="av-load-more"){o.querySelectorAll(".av__row--footer").forEach(g=>{g.style.transform=""}),o.removeAttribute("data-render");const u=N(c,"av__body");return u.dataset.pageSize=(parseInt(u.dataset.pageSize)+parseInt(u.querySelector('[data-type="set-page-size"]').getAttribute("data-size"))).toString(),Ua(o,t),e.preventDefault(),e.stopPropagation(),!0}else{if(c.classList.contains("av__firstcol"))return window.siyuan.menus.menu.remove(),lo(c,"toggle"),e.preventDefault(),e.stopPropagation(),!0;if(c.classList.contains("item")&&c.parentElement.classList.contains("layout-tab-bar"))return c.classList.contains("item--focus")?Fh({protyle:t,blockElement:o,element:c}):et(t,[{action:"setAttrViewBlockView",blockID:o.getAttribute("data-node-id"),id:c.dataset.id,avID:o.getAttribute("data-av-id")}],[{action:"setAttrViewBlockView",blockID:o.getAttribute("data-node-id"),id:c.parentElement.querySelector(".item--focus").getAttribute("data-id"),avID:o.getAttribute("data-av-id")}]),e.preventDefault(),e.stopPropagation(),!0;if(c.classList.contains("av__cellassetimg"))return ex(tx(c.getAttribute("src")),o.getAttribute("data-av-id"),o.getAttribute(p.CUSTOM_SY_AV_VIEW),((r=o.querySelector('[data-type="av-search"]'))==null?void 0:r.value.trim())||""),e.preventDefault(),e.stopPropagation(),!0;if(c.classList.contains("av__row")&&e.shiftKey&&!c.classList.contains("av__row--header"))return lo(c.querySelector(".av__firstcol"),"toggle"),e.preventDefault(),e.stopPropagation(),!0;if(d==="copy")return ut(Rd(N(c,"av__cell"))),Q(window.siyuan.languages.copied),e.preventDefault(),e.stopPropagation(),!0;if(d==="av-search-icon"){const u=o.querySelector('input[data-type="av-search"]');u.style.width="128px",u.style.paddingLeft="",u.style.paddingRight="";const g=N(u,"av__views");return g&&g.classList.add("av__views--show"),setTimeout(()=>{u.focus()},p.TIMEOUT_TRANSITION),e.preventDefault(),e.stopPropagation(),!0}}}}}}c=c.parentElement}return!1},Vh=(t,e,n)=>{var a;if(Ut(["hint"],t),e.classList.contains("av__row--header"))return!1;const i=oe(e);if(!i)return!1;const s=i.getAttribute("data-av-type");s==="table"?(e.classList.contains("av__row--select")||si(["row"],i),si(["cell"],i),e.classList.add("av__row--select"),e.querySelector(".av__firstcol use").setAttribute("xlink:href","#iconCheck"),ec(e)):(e.classList.contains("av__gallery-item--select")||si(["galleryItem"],i),e.classList.add("av__gallery-item--select"));const r=new ta,o=i.querySelectorAll(".av__row--select:not(.av__row--header), .av__gallery-item--select"),l=o[0].querySelector('.av__cell[data-dtype="block"]'),c=Array.from(o).map(g=>g.querySelector('[data-dtype="block"] .av__celltext').getAttribute("data-id"));if(o.length===1&&l.getAttribute("data-detached")!=="true"){const g=c[0],f=mh(t.app,[g],void 0,void 0,!0);f.push({id:"separator_3",type:"separator"}),f.push({id:"attr",icon:"iconAttr",label:window.siyuan.languages.attr,click:()=>{ae("/api/attr/getBlockAttrs",{id:g},h=>{Zs(h.data,"av",t)})}}),r.addItem({id:"openBy",label:window.siyuan.languages.openBy,icon:"iconOpen",submenu:f})}let d=!1;o.forEach(g=>{g.querySelector('.av__cell[data-dtype="block"]').getAttribute("data-detached")!=="true"&&(d=!0)});const u=[{id:"copyKeyContent",iconHTML:"",label:window.siyuan.languages.copyKeyContent,click(){let g="";o.forEach((f,h)=>{o.length>1&&(g+="- "),g+=f.querySelector('.av__cell[data-dtype="block"] .av__celltext').textContent.trim(),c.length>1&&h!==c.length-1&&(g+=`
`)}),ut(g)}}];if(d&&u.splice(1,0,{id:"copyBlockRef",iconHTML:"",label:window.siyuan.languages.copyBlockRef,click:()=>{let g="";for(let f=0;f<c.length;f++){const h=c[f];let m="";const b=o[f].querySelector(".av__cell[data-dtype='block']");b.getAttribute("data-detached")==="true"?m=b.querySelector(".av__celltext").textContent:m=`((${h} '${b.querySelector(".av__celltext").textContent.replace(/[\n]+/g," ")}'))`,c.length>1&&(g+="- "),g+=m,c.length>1&&f!==c.length-1&&(g+=`
`)}ut(g)}},{id:"copyBlockEmbed",iconHTML:"",label:window.siyuan.languages.copyBlockEmbed,click:()=>{let g="";c.forEach((f,h)=>{c.length>1&&(g+="- ");const m=o[h].querySelector(".av__cell[data-dtype='block']");m.getAttribute("data-detached")==="true"?g+=m.querySelector(".av__celltext").textContent:g+=`{{select * from blocks where id='${f}'}}`,c.length>1&&h!==c.length-1&&(g+=`
`)}),ut(g)}},{id:"copyProtocol",iconHTML:"",label:window.siyuan.languages.copyProtocol,click:()=>{let g="";c.forEach((f,h)=>{c.length>1&&(g+="- ");const m=o[h].querySelector(".av__cell[data-dtype='block']");m.getAttribute("data-detached")==="true"?g+=m.querySelector(".av__celltext").textContent:g+=`siyuan://blocks/${f}`,c.length>1&&h!==c.length-1&&(g+=`
`)}),ut(g)}},{id:"copyProtocolInMd",iconHTML:"",label:window.siyuan.languages.copyProtocolInMd,click:()=>{let g="";for(let f=0;f<c.length;f++){const h=c[f];let m="";const b=o[f].querySelector(".av__cell[data-dtype='block']");b.getAttribute("data-detached")==="true"?m=b.querySelector(".av__celltext").textContent:m=`[${b.querySelector(".av__celltext").textContent.replace(/[\n]+/g," ")}](siyuan://blocks/${h})`,c.length>1&&(g+="- "),g+=m,c.length>1&&f!==c.length-1&&(g+=`
`)}ut(g)}},{id:"copyHPath",iconHTML:"",label:window.siyuan.languages.copyHPath,click:()=>sF(void 0,null,function*(){let g="";for(let f=0;f<c.length;f++){const h=c[f];let m="";const b=o[f].querySelector(".av__cell[data-dtype='block']");b.getAttribute("data-detached")==="true"?m=b.querySelector(".av__celltext").textContent:m=(yield wn("/api/filetree/getHPathByID",{id:h})).data,c.length>1&&(g+="- "),g+=m,c.length>1&&f!==c.length-1&&(g+=`
`)}ut(g)})},{id:"copyID",iconHTML:"",label:window.siyuan.languages.copyID,click:()=>{let g="";c.forEach((f,h)=>{c.length>1&&(g+="- ");const m=o[h].querySelector(".av__cell[data-dtype='block']");m.getAttribute("data-detached")==="true"?g+=m.querySelector(".av__celltext").textContent:g+=f,c.length>1&&h!==c.length-1&&(g+=`
`)}),ut(g)}}),r.addItem({id:"copy",label:window.siyuan.languages.copy,icon:"iconCopy",type:"submenu",submenu:u}),!t.disabled){r.addItem({id:"addToDatabase",label:window.siyuan.languages.addToDatabase,icon:"iconDatabase",click(){Ph(i.getAttribute("data-av-id"),o[0],f=>{const h=[],m=[];o.forEach(_=>{const v=_.getAttribute("data-id"),U=qo("block",_.querySelector('.av__cell[data-dtype="block"]'));h.push({itemID:Lute.NewNodeID(),content:U.block.content,id:U.block.id||"",isDetached:U.isDetached}),m.push(v)});const b=f.dataset.avId,y=f.dataset.viewId;et(t,[{action:"insertAttrViewBlock",ignoreDefaultFill:!y,viewID:y,avID:b,srcs:h,context:{ignoreTip:"true"},blockID:f.dataset.blockId,groupID:e.parentElement.getAttribute("data-group-id")},{action:"doUpdateUpdated",id:f.dataset.blockId,data:at().format("YYYYMMDDHHmmss")}],[{action:"removeAttrViewBlock",srcIDs:m,avID:b}])})}}),o.length===1&&(l.getAttribute("data-detached")!=="true"&&r.addSeparator({id:"separator_1"}),r.addItem({id:s==="table"?"insertRowBefore":"insertItemBefore",icon:"iconBefore",label:`<div class="fn__flex" style="align-items: center;">
${window.siyuan.languages[s==="table"?"insertRowBefore":"insertItemBefore"].replace("${x}",`<span class="fn__space"></span><input style="width:64px" type="number" step="1" min="1" value="1" placeholder="${window.siyuan.languages.enterKey}" class="b3-text-field"><span class="fn__space"></span>`)}
</div>`,bind(f){const h=f.querySelector("input");f.addEventListener("click",()=>{var m;document.activeElement!==h&&(nc({blockElement:i,protyle:t,count:parseInt(h.value),previousID:(m=o[0].previousElementSibling)==null?void 0:m.getAttribute("data-id"),groupID:o[0].parentElement.getAttribute("data-group-id")}),r.close())}),h.addEventListener("keydown",m=>{var b;!m.isComposing&&m.key==="Enter"&&(nc({blockElement:i,protyle:t,count:parseInt(h.value),previousID:(b=o[0].previousElementSibling)==null?void 0:b.getAttribute("data-id"),groupID:o[0].parentElement.getAttribute("data-group-id")}),r.close())})}}),r.addItem({id:s==="table"?"insertRowAfter":"insertItemAfter",icon:"iconAfter",label:`<div class="fn__flex" style="align-items: center;">
${window.siyuan.languages[s==="table"?"insertRowAfter":"insertItemAfter"].replace("${x}",`<span class="fn__space"></span><input style="width:64px" type="number" step="1" min="1" placeholder="${window.siyuan.languages.enterKey}" class="b3-text-field" value="1"><span class="fn__space"></span>`)}
</div>`,bind(f){const h=f.querySelector("input");f.addEventListener("click",()=>{document.activeElement!==h&&(nc({blockElement:i,protyle:t,count:parseInt(h.value),previousID:o[0].getAttribute("data-id"),groupID:o[0].parentElement.getAttribute("data-group-id")}),r.close())}),h.addEventListener("keydown",m=>{!m.isComposing&&m.key==="Enter"&&(nc({blockElement:i,protyle:t,count:parseInt(h.value),previousID:o[0].getAttribute("data-id"),groupID:o[0].parentElement.getAttribute("data-group-id")}),r.close())})}}),r.addSeparator({id:"separator_2"}),l.getAttribute("data-detached")!=="true"&&r.addItem({id:"unbindBlock",label:window.siyuan.languages.unbindBlock,icon:"iconLinkOff",click(){fs(t,i,{content:l.querySelector(".av__celltext").textContent},[l])}})),r.addItem({id:"delete",icon:"iconTrashcan",label:window.siyuan.languages.delete,click(){M2(i,t)}});const g=[];s==="table"?e.parentElement.querySelectorAll(".av__row--header .av__cell").forEach(f=>{const h=Array.from(i.querySelectorAll(`.av__row--select:not(.av__row--header) .av__cell[data-col-id="${f.dataset.colId}"]`)),m=f.getAttribute("data-dtype");if(!["updated","created"].includes(m)){const b=f.dataset.icon;g.push({iconHTML:b?Yt(b,"b3-menu__icon",!0):`<svg class="b3-menu__icon"><use xlink:href="#${za(m)}"></use></svg>`,label:he(f.querySelector(".av__celltext").textContent.trim()),click(){Bs(t,h)}})}}):e.querySelectorAll(".av__cell").forEach(f=>{const h=Array.from(i.querySelectorAll(`.av__gallery-item--select .av__cell[data-field-id="${f.dataset.fieldId}"]`)),m=f.getAttribute("data-dtype");if(!["updated","created"].includes(m)){const b=f.parentElement.querySelector(".av__gallery-tip, .av__gallery-name").firstElementChild.cloneNode(!0);b.classList.add("b3-menu__icon"),g.push({iconHTML:b.outerHTML,label:he(f.getAttribute("aria-label").split('<div class="ft__on-surface">')[0]),click(){e.querySelector(".av__gallery-fields").classList.add("av__gallery-fields--edit"),e.querySelector('[data-type="av-gallery-edit"]').setAttribute("aria-label",window.siyuan.languages.hideEmptyFields),Bs(t,h)}})}}),r.addItem({id:"fields",icon:"iconAttr",label:window.siyuan.languages.fields,type:"submenu",submenu:g})}return(a=t==null?void 0:t.app)!=null&&a.plugins&&Is({plugins:t.app.plugins,type:"open-menu-av",detail:{protyle:t,element:i,selectRowElements:o},separatorPosition:"top"}),r.open(n),!0},ox=(t,e)=>{const n=e.getAttribute("data-av-id"),a=e.getAttribute("data-node-id"),i=e.querySelector(".av__title");i.textContent===""&&i.querySelectorAll("br").forEach(o=>{o.remove()});const s=i.textContent.trim();if(s===i.dataset.title.trim())return;if(s.length>p.SIZE_TITLE)return Q(window.siyuan.languages._kernel[106]),!1;const r=at().format("YYYYMMDDHHmmss");et(t,[{action:"setAttrViewName",id:n,data:s},{action:"doUpdateUpdated",id:a,data:r}],[{action:"setAttrViewName",id:n,data:i.dataset.title},{action:"doUpdateUpdated",id:a,data:e.getAttribute("updated")}]),e.setAttribute("updated",r),i.dataset.title=s,Array.from(t.wysiwyg.element.querySelectorAll(`.av[data-av-id="${n}"]`)).forEach(o=>{if(e===o)return;const l=o.querySelector(".av__title");l&&(l.textContent=s,l.dataset.title=s)})},us=(t,e,n)=>{var a;if(t)if(n)kF(t,n);else{const i=t.querySelector(".av__drag-fill"),s=oe(t);if(!s)return;const r=s.getAttribute("data-av-type"),o=t.querySelector(".b3-menu__avemoji");["gallery","kanban"].includes(r)?(e.type==="checkbox"&&(e.checkbox={checked:((a=e.checkbox)==null?void 0:a.checked)||!1,content:t.getAttribute("aria-label").split('<div class="ft__on-surface">')[0]}),t.innerHTML=ho(e,0,o?!o.classList.contains("fn__none"):!1,r),t.parentElement.setAttribute("data-empty",dx(e).toString())):t.innerHTML=ho(e,0,o?!o.classList.contains("fn__none"):!1),i&&Js(t),u_(t,e)}},HS=(t,e)=>{t.querySelectorAll(`.av__cell[data-col-id="${e}"]`).forEach(n=>{n.remove()})},qS=(t,e)=>{ae("/api/av/duplicateAttributeViewBlock",{avID:e.getAttribute("data-av-id")},n=>{e.classList.remove("protyle-wysiwyg--select");const a=document.createElement("template");a.innerHTML=t.lute.SpinBlockDOM(`<div data-node-id="${n.data.blockID}" data-av-id="${n.data.avID}" data-type="NodeAttributeView" data-av-type="table"></div>`);const i=a.content.firstElementChild;e.after(i),Ua(i,t,()=>{qt(i),kn(t)}),et(t,[{action:"insert",data:i.outerHTML,id:n.data.blockID,previousID:e.dataset.nodeId}],[{action:"delete",id:n.data.blockID}])})};let Ps;const lx=(t,e,n=[])=>{var a;let i="",s=!1;if(n.length===0&&document.querySelectorAll(".av__panel .b3-chips .b3-chip").forEach(r=>{n.push(r.dataset.content)}),e){const r=((a=document.querySelector(".av__panel .b3-menu__item--current"))==null?void 0:a.getAttribute("data-name"))||"";e.forEach(o=>{if(!t||t.toLowerCase().indexOf(o.name.toLowerCase())>-1||o.name.toLowerCase().indexOf(t.toLowerCase())>-1){const l=o.desc?`${Ot(o.name)}<div class='ft__on-surface'>${Ot(o.desc||"")}</div>`:"";i+=`<button data-type="addColOptionOrCell" class="b3-menu__item${r===o.name?" b3-menu__item--current":""}" data-name="${ft(o.name)}" data-desc="${ft(o.desc||"")}" draggable="true" data-color="${o.color}">
    <svg class="b3-menu__icon fn__grab"><use xlink:href="#iconDrag"></use></svg>
    <div class="fn__flex-1 ariaLabel" data-position="parentW" aria-label="${l}">
        <span class="b3-chip" style="background-color:var(--b3-font-background${o.color});color:var(--b3-font-color${o.color})">
            <span class="fn__ellipsis">${he(o.name)}</span>
        </span>
    </div>
    <svg class="b3-menu__action" data-type="setColOption"><use xlink:href="#iconEdit"></use></svg>
    ${n.includes(o.name)?'<svg class="b3-menu__checked"><use xlink:href="#iconSelect"></use></svg></span>':""}
</button>`}t===o.name&&(s=!0)})}if(!s&&t){i=i.replace('class="b3-menu__item b3-menu__item--current"','class="b3-menu__item"');const r=((e==null?void 0:e.length)||0)%14+1;i=`<button data-type="addColOptionOrCell" class="b3-menu__item b3-menu__item--current" data-name="${t}" data-color="${r}">
<svg class="b3-menu__icon"><use xlink:href="#iconAdd"></use></svg>
<div class="fn__flex-1">
    <span class="b3-chip" style="background-color:var(--b3-font-background${r});color:var(--b3-font-color${r})">
        <span class="fn__ellipsis">${he(t)}</span>
    </span>
</div>
<span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${window.siyuan.languages.enterKey}</span>
</button>${i}`}else i.indexOf("b3-menu__item--current")===-1&&(i=i.replace('class="b3-menu__item"','class="b3-menu__item b3-menu__item--current"'));return i},l_=(t,e,n,a)=>{if(!n)return;const i=a.getAttribute("data-av-type"),s=$s(e[0],i),r=[],o=[];let l;const c=a.getAttribute("data-av-id");e.forEach((d,u)=>{var g;const f=Pr(d,i);if(!f)return;a.contains(d)||(i==="table"?d=e[u]=a.querySelector(`.av__row[data-id="${f}"] .av__cell[data-col-id="${d.dataset.colId}"]`)||a.querySelector(`.fn__flex-1[data-col-id="${d.dataset.colId}"]`):d=e[u]=a.querySelector(`.av__gallery-item[data-id="${f}"] .av__cell[data-field-id="${d.dataset.fieldId}"]`));const h=Ps[u],m=JSON.parse(JSON.stringify(h));u===0?((g=h.mSelect)==null||g.find((b,y)=>{if(b.content===n.dataset.content)return h.mSelect.splice(y,1),!0}),l=h.mSelect):h.mSelect=l,r.push({action:"updateAttrViewCell",id:h.id,keyID:s,rowID:f,avID:c,data:h}),o.push({action:"updateAttrViewCell",id:h.id,keyID:s,rowID:f,avID:c,data:m}),d.classList.contains("custom-attr__avvalue")?d.innerHTML=wl(h):us(d,h)}),r.push({action:"doUpdateUpdated",id:a.getAttribute("data-node-id"),data:at().format("YYYYMMDDHHmmss")}),et(t,r,o),Array.from(document.querySelectorAll(".av__panel .b3-menu__item")).find(d=>{var u;if(d.dataset.name===n.dataset.content)return(u=d.querySelector(".b3-menu__checked"))==null||u.remove(),!0}),n.remove()},oF=(t,e,n,a,i,s)=>{const r=N(n,"b3-menu");if(!r)return;const o=a.getAttribute("data-node-id"),l=a.getAttribute("data-av-type"),c=s&&s[0]?$s(s[0],l):r.querySelector(".b3-menu__item").getAttribute("data-col-id");let d=n.parentElement.dataset.name,u=n.parentElement.dataset.desc,g=n.parentElement.dataset.color;const f=ma(e),h=new ta(p.MENU_AV_COL_OPTION,()=>{if(d===y.value&&u===_.value||!y.value)return;et(t,[{action:"updateAttrViewColOption",id:c,avID:e.id,data:{newColor:g,oldName:d,newName:y.value,newDesc:_.value}},{action:"doUpdateUpdated",id:o,data:at().format("YYYYMMDDHHmmss")}],[{action:"updateAttrViewColOption",id:c,avID:e.id,data:{newColor:g,oldName:y.value,newName:d,newDesc:u}}]),f.find(Z=>{if(Z.id===c)return Z.options.find(w=>{if(w.name===y.value&&w.desc===_.value)return!0})||Z.options.find(w=>{if(w.name===d)return w.name=y.value,w.desc=_.value,!0}),!0});const v=r.querySelector(".b3-menu__items").scrollTop,U=r.querySelector(".b3-chips"),ee=U?U.clientHeight:0;s?(s.forEach((Z,k)=>{const w=Pr(Z,l);l==="table"||i?Z=s[k]=a.querySelector(`.av__row[data-id="${w}"] .av__cell[data-col-id="${Z.dataset.colId}"]`)||a.querySelector(`.fn__flex-1[data-col-id="${Z.dataset.colId}"]`):Z=s[k]=a.querySelector(`.av__gallery-item[data-id="${w}"] .av__cell[data-field-id="${Z.dataset.fieldId}"]`),Ps[k].mSelect.find(S=>{if(S.content===d)return S.content=y.value,!0}),Z.classList.contains("custom-attr__avvalue")?Z.innerHTML=wl(Ps[k]):us(Z,Ps[k])}),r.innerHTML=Mf(f,s,!1,a),If(t,e,r,s,a)):(r.innerHTML=go({protyle:t,data:e,colId:c,isCustomAttr:i}),mo({protyle:t,data:e,menuElement:r,isCustomAttr:i,blockID:o})),U&&(r.querySelector(".b3-menu__items").scrollTop=v+(r.querySelector(".b3-chips").clientHeight-ee))});if(h.isOpen)return;h.addItem({iconHTML:"",type:"empty",label:`<div class="fn__hr"></div>
<div class="b3-form__icona fn__block">
    <input class="b3-text-field b3-form__icona-input" type="text" size="16">
    <svg data-position="north" class="b3-form__icona-icon ariaLabel" aria-label="${u?Ot(u):window.siyuan.languages.addDesc}"><use xlink:href="#iconInfo"></use></svg>
</div>
<div class="fn__none">
    <div class="fn__hr"></div>
    <textarea rows="1" placeholder="${window.siyuan.languages.addDesc}" class="b3-text-field fn__block" type="text" data-value="${ft(u)}">${u}</textarea>
</div>
<div class="fn__hr--small"></div>`,bind(v){const U=v.querySelector("input");U.addEventListener("keydown",Z=>{Z.isComposing||Z.key==="Enter"&&h.close()}),U.value=d;const ee=v.querySelector("textarea");U.nextElementSibling.addEventListener("click",()=>{const Z=ee.parentElement;Z.classList.toggle("fn__none"),Z.classList.contains("fn__none")||ee.focus()}),ee.addEventListener("keydown",Z=>{Z.isComposing||Z.key==="Enter"&&h.close()}),ee.addEventListener("input",()=>{U.nextElementSibling.setAttribute("aria-label",ee.value?he(ee.value):window.siyuan.languages.addDesc)})}}),h.addItem({id:"delete",label:window.siyuan.languages.delete,icon:"iconTrashcan",click(){Sn(window.siyuan.languages.deleteOpConfirm,window.siyuan.languages.confirmDelete,()=>{let v=[];f.find(w=>{if(w.id===c)return v=w.options,!0});const U=n.parentElement.dataset.name;et(t,[{action:"removeAttrViewColOption",id:c,avID:e.id,data:U},{action:"doUpdateUpdated",id:o,data:at().format("YYYYMMDDHHmmss")}],[{action:"updateAttrViewColOptions",id:c,avID:e.id,data:v}]),v.find((w,S)=>{if(w.name===U)return v.splice(S,1),!0});const ee=r.querySelector(".b3-menu__items").scrollTop,Z=r.querySelector(".b3-chips"),k=Z?Z.clientHeight:0;s?(s.forEach((w,S)=>{const B=Pr(w,l);l==="table"||i?w=s[S]=a.querySelector(`.av__row[data-id="${B}"] .av__cell[data-col-id="${w.dataset.colId}"]`)||a.querySelector(`.fn__flex-1[data-col-id="${w.dataset.colId}"]`):w=s[S]=a.querySelector(`.av__gallery-item[data-id="${B}"] .av__cell[data-field-id="${w.dataset.fieldId}"]`),Ps[S].mSelect.find((H,j)=>{if(H.content===U)return Ps[S].mSelect.splice(j,1),!0}),w.classList.contains("custom-attr__avvalue")?w.innerHTML=wl(Ps[S]):us(w,Ps[S])}),r.innerHTML=Mf(f,s,!1,a),If(t,e,r,s,a)):(r.innerHTML=go({protyle:t,data:e,colId:c,isCustomAttr:i}),mo({protyle:t,data:e,menuElement:r,isCustomAttr:i,blockID:o})),Z&&(r.querySelector(".b3-menu__items").scrollTop=ee+(r.querySelector(".b3-chips").clientHeight-k))},void 0,!0)}}),h.addSeparator();let m='<div class="fn__flex fn__flex-wrap" style="width: 238px">';Array.from(Array(14).keys()).forEach(v=>{m+=`<button data-color="${v+1}" class="color__square${parseInt(g)===v+1?" color__square--current":""}" style="color: var(--b3-font-color${v+1});background-color: var(--b3-font-background${v+1});">A</button>`}),h.addItem({type:"empty",iconHTML:"",label:m+"</div>",bind(v){v.addEventListener("click",U=>{var ee;const Z=U.target;if(Z.classList.contains("color__square")&&!Z.classList.contains("color__square--current")){(ee=v.querySelector(".color__square--current"))==null||ee.classList.remove("color__square--current"),Z.classList.add("color__square--current");const k=Z.getAttribute("data-color");et(t,[{action:"updateAttrViewColOption",id:c,avID:e.id,data:{oldName:d,newName:y.value,oldColor:g,newColor:k,newDesc:_.value}},{action:"doUpdateUpdated",id:o,data:at().format("YYYYMMDDHHmmss")}],[{action:"updateAttrViewColOption",id:c,avID:e.id,data:{oldName:y.value,newName:d,oldColor:k,newColor:g,newDesc:_.value}}]),f.find(S=>{if(S.id===c)return S.options.find(B=>{if(B.name===d)return B.name=y.value,B.color=k,!0}),!0});const w=r.querySelector(".b3-menu__items").scrollTop;s?(s.forEach((S,B)=>{const H=Pr(S,l);l==="table"?S=s[B]=a.querySelector(`.av__row[data-id="${H}"] .av__cell[data-col-id="${S.dataset.colId}"]`)||a.querySelector(`.fn__flex-1[data-col-id="${S.dataset.colId}"]`):S=s[B]=a.querySelector(`.av__gallery-item[data-id="${H}"] .av__cell[data-field-id="${S.dataset.fieldId}"]`),Ps[B].mSelect.find(j=>{if(j.content===d)return j.content=y.value,j.color=k,!0}),S.classList.contains("custom-attr__avvalue")?S.innerHTML=wl(Ps[B]):us(S,Ps[B])}),r.innerHTML=Mf(f,s,!1,a),If(t,e,r,s,a)):(r.innerHTML=go({protyle:t,data:e,colId:c,isCustomAttr:i}),mo({protyle:t,data:e,menuElement:r,isCustomAttr:i,blockID:o})),r.querySelector(".b3-menu__items").scrollTop=w,d=y.value,u=_.value,g=k}})}});const b=n.getBoundingClientRect();h.open({x:b.right,y:b.bottom,w:b.width,h:b.height});const y=window.siyuan.menus.menu.element.querySelector("input");y.select();const _=window.siyuan.menus.menu.element.querySelector("textarea")},If=(t,e,n,a,i)=>{const s=n.querySelector("input"),r=$s(a[0],i.getAttribute("data-av-type"));let o;ma(e).find(c=>{if(c.id===r){o=c;return}}),o.options||(o.options=[]);const l=n.lastElementChild.lastElementChild;s.addEventListener("input",c=>{c.isComposing||(l.innerHTML=lx(s.value,o.options))}),s.addEventListener("compositionend",()=>{l.innerHTML=lx(s.value,o.options)}),s.addEventListener("keydown",c=>{if(c.isComposing)return;let d=pi(l,c,"b3-menu__item--current",l.firstElementChild);c.key==="Enter"?(d||(d=n.querySelector(".b3-menu__item--current")),d.querySelector(".b3-menu__checked")?l_(t,a,n.querySelector(`.b3-chips .b3-chip[data-content="${ft(d.dataset.name)}"]`),i):WS(t,e,a,d,n,i)):c.key==="Backspace"&&s.value===""&&l_(t,a,s.previousElementSibling,i)})},WS=(t,e,n,a,i,s)=>{let r=!1;if(Array.from(i.querySelectorAll(".b3-chips .b3-chip")).find(h=>{if(h.dataset.content===a.dataset.name)return r=!0,!0}),r){i.querySelector("input").focus();return}oe(n[0])||n.forEach((h,m)=>{const b=Pr(h,e.viewType);e.viewType==="table"||NS(h)?n[m]=s.querySelector(`.av__row[data-id="${b}"] .av__cell[data-col-id="${h.dataset.colId}"]`)||s.querySelector(`.fn__flex-1[data-col-id="${h.dataset.colId}"]`):n[m]=s.querySelector(`.av__gallery-item[data-id="${b}"] .av__cell[data-field-id="${h.dataset.fieldId}"]`)});const l=$s(n[0],s.getAttribute("data-av-type"));let c;const d=ma(e);d.find(h=>{if(h.id===l){c=h,c.options||(c.options=[]);return}});const u=[],g=[];let f;if(n.forEach((h,m)=>{const b=Pr(h,e.viewType);if(!b)return;const y=Ps[m],_=JSON.parse(JSON.stringify(y));if(m===0){if(c.type==="mSelect"){let v=!1;y.mSelect.find(U=>{if(U.content===a.dataset.name)return v=!0,!0}),v||y.mSelect.push({color:a.dataset.color,content:a.dataset.name})}else y.mSelect=[{color:a.dataset.color,content:a.dataset.name}];f=y.mSelect}else y.mSelect=f;u.push({action:"updateAttrViewCell",id:y.id,keyID:l,rowID:b,avID:e.id,data:y}),g.push({action:"updateAttrViewCell",id:y.id,keyID:l,rowID:b,avID:e.id,data:_}),h.classList.contains("custom-attr__avvalue")?h.innerHTML=wl(y):us(h,y)}),a.querySelector(".b3-menu__accelerator")?(c.options.push({color:a.dataset.color,name:a.dataset.name}),u.splice(0,0,{action:"updateAttrViewColOptions",id:l,avID:e.id,data:c.options}),u.push({action:"doUpdateUpdated",id:s.getAttribute("data-node-id"),data:at().format("YYYYMMDDHHmmss")}),et(t,u,[{action:"removeAttrViewColOption",id:l,avID:e.id,data:a.dataset.name}])):(u.push({action:"doUpdateUpdated",id:s.getAttribute("data-node-id"),data:at().format("YYYYMMDDHHmmss")}),et(t,u,g)),c.type==="select")s.setAttribute("data-rendering","true"),i.parentElement.dispatchEvent(new CustomEvent("click",{detail:"close"}));else{const h=i.querySelector(".b3-menu__items").scrollTop,m=i.querySelector(".b3-chips").clientHeight;i.innerHTML=Mf(d,n,!1,s),If(t,e,i,n,s),i.querySelector("input").focus(),i.querySelector(".b3-menu__items").scrollTop=h+(i.querySelector(".b3-chips").clientHeight-m)}},Mf=(t,e,n=!1,a)=>{var i;if(n){Ps=[];const c=e[0].classList.contains("custom-attr__avvalue");e.forEach(d=>{Ps.push(qo(c?d.dataset.type:Ns(d),d))})}const s=$s(e[0],a.getAttribute("data-av-type")),r=t.find(c=>{if(c.id===s)return c});let o="";const l=[];return(i=Ps[0].mSelect)==null||i.forEach(c=>{l.push(c.content),o+=`<div class="b3-chip b3-chip--middle" data-content="${ft(c.content)}" style="white-space: nowrap;max-width:100%;background-color:var(--b3-font-background${c.color});color:var(--b3-font-color${c.color})"><span class="fn__ellipsis">${he(c.content)}</span><svg class="b3-chip__close" data-type="removeCellOption"><use xlink:href="#iconCloseRound"></use></svg></div>`}),`<div class="b3-menu__items">
<div class="b3-chips" style="max-width: 50vw">
    ${o}
    <input>
</div>
<div>${lx("",r.options,l)}</div>
</div>`},lF=(t,e,n)=>{const a=[],i=[];return e.mSelect.forEach(s=>{var r;if(t.options||(t.options=[]),!t.options.find(l=>{if(l.name===s.content)return s.color=l.color,!0})){const l=((((r=t.options)==null?void 0:r.length)||0)%14+1).toString();t.options.push({name:s.content,color:l}),s.color=l,a.push({action:"updateAttrViewColOptions",id:t.id,avID:n,data:t.options}),i.push({action:"removeAttrViewColOption",id:t.id,avID:n,data:s.content})}}),{doOperations:a,undoOperations:i}},cF=t=>{const e=new ta(p.MENU_AV_ADD_SORT),n=ma(t.data);n.forEach(a=>{let i=!1;a.type==="lineNumber"?i=!0:t.data.view.sorts.find(s=>{if(s.column===a.id)return i=!0,!0}),i||e.addItem({label:a.name,iconHTML:a.icon?Yt(a.icon,"b3-menu__icon",!0):`<svg class="b3-menu__icon"><use xlink:href="#${za(a.type)}"></use></svg>`,click:()=>{const s=Object.assign([],t.data.view.sorts);t.data.view.sorts.push({column:a.id,order:"ASC"}),et(t.protyle,[{action:"setAttrViewSorts",avID:t.data.id,data:t.data.view.sorts,blockID:t.blockID}],[{action:"setAttrViewSorts",avID:t.data.id,data:s,blockID:t.blockID}]),t.menuElement.innerHTML=Pf(n,t.data.view.sorts),Ff(t.protyle,t.menuElement,t.data,t.blockID),gn(t.menuElement,t.tabRect.right-t.menuElement.clientWidth,t.tabRect.bottom,t.tabRect.height)}})}),e.open({x:t.rect.left,y:t.rect.bottom,h:t.rect.height})},Ff=(t,e,n,a)=>{e.querySelectorAll("select").forEach(i=>{i.addEventListener("change",()=>{const s=i.parentElement.getAttribute("data-id"),r=JSON.parse(JSON.stringify(n.view.sorts));i.previousElementSibling.classList.contains("b3-menu__icon")?n.view.sorts.find(o=>{if(o.column===s)return o.column=i.value,i.parentElement.setAttribute("data-id",i.value),!0}):n.view.sorts.find(o=>o.column===s).order=i.value,et(t,[{action:"setAttrViewSorts",avID:n.id,data:n.view.sorts,blockID:a}],[{action:"setAttrViewSorts",avID:n.id,data:r,blockID:a}])})})},Pf=(t,e)=>{let n="";const a=i=>{let s="";return t.forEach(r=>{s+=`<option value="${r.id}" ${r.id===i?"selected":""}>${r.icon&&Yt(r.icon)}${r.name}</option>`}),s};return e.forEach(i=>{n+=`<button draggable="true" class="b3-menu__item" data-id="${i.column}">
    <svg class="b3-menu__icon fn__grab"><use xlink:href="#iconDrag"></use></svg>
    <select class="b3-select fn__flex-1" style="margin: 4px 0">
        ${a(i.column)}
    </select>
    <span class="fn__space"></span>
    <select class="b3-select" style="margin: 4px 0">
        <option value="ASC" ${i.order==="ASC"?"selected":""}>${window.siyuan.languages.asc}</option>
        <option value="DESC" ${i.order==="DESC"?"selected":""}>${window.siyuan.languages.desc}</option>
    </select>
    <svg class="b3-menu__action" data-type="removeSort"><use xlink:href="#iconTrashcan"></use></svg>
</button>`}),`<div class="b3-menu__items">
<button class="b3-menu__item" data-type="nobg">
    <span class="block__icon" style="padding: 8px;margin-left: -4px;" data-type="go-config">
        <svg><use xlink:href="#iconLeft"></use></svg>
    </span>
    <span class="b3-menu__label ft__center">${window.siyuan.languages.sort}</span>
</button>
<button class="b3-menu__separator"></button>
${n}
<button class="b3-menu__item${e.length===t.length?" fn__none":""}" data-type="addSort">
    <svg class="b3-menu__icon"><use xlink:href="#iconAdd"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.addSort}</span>
</button>
<button class="b3-menu__item b3-menu__item--warning${n?"":" fn__none"}" data-type="removeSorts">
    <svg class="b3-menu__icon"><use xlink:href="#iconTrashcan"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.removeSorts}</span>
</button>
</div>`},dF=t=>{const e=qo("date",t[0]).date,n=e.isNotTime;let a="";const i=new Date().getTime();if(e.isNotEmpty){a=at(e.content).format(n?"YYYY-MM-DD":"YYYY-MM-DD HH:mm");const r=a.split("-")[0];r.length!==4&&(a=new Array(4-r.length).fill(0).join("")+a)}else a=at(i).format(n?"YYYY-MM-DD":"YYYY-MM-DD HH:mm");let s="";if(e.isNotEmpty2){s=at(e.content2).format(n?"YYYY-MM-DD":"YYYY-MM-DD HH:mm");const r=s.split("-")[0];r.length!==4&&(s=new Array(4-r.length).fill(0).join("")+s)}else e.hasEndDate&&(s=at(i).format(n?"YYYY-MM-DD":"YYYY-MM-DD HH:mm"));return`<div class="b3-menu__items">
<div>
    <input type="${n?"date":"datetime-local"}" max="${n?"9999-12-31":"9999-12-31 23:59"}" value="${a}" data-value="${at(e.content||i).format("YYYY-MM-DD HH:mm")}" class="b3-text-field fn__size200" style="margin-top: 4px;"><br>
    <input type="${n?"date":"datetime-local"}" max="${n?"9999-12-31":"9999-12-31 23:59"}" value="${s}" data-value="${e.isNotEmpty2?at(e.content2).format("YYYY-MM-DD HH:mm"):""}" style="margin-top: 8px;margin-bottom: 4px" class="b3-text-field fn__size200${e.hasEndDate?"":" fn__none"}">
    <button class="b3-menu__separator"></button>
    <label class="b3-menu__item">
        <span class="fn__flex-center">${window.siyuan.languages.endDate}</span>
        <span class="fn__space fn__flex-1"></span>
        <input type="checkbox" class="b3-switch b3-switch--menu"${e.hasEndDate?" checked":""}>
    </label>
    <label class="b3-menu__item">
        <span class="fn__flex-center">${window.siyuan.languages.includeTime}</span>
        <span class="fn__space fn__flex-1"></span>
        <input type="checkbox" class="b3-switch b3-switch--menu"${n?"":" checked"}>
    </label>
    <button class="b3-menu__separator"></button>
    <button class="b3-menu__item" data-type="clearDate">
        <svg class="b3-menu__icon"><use xlink:href="#iconTrashcan"></use></svg>
        <span class="b3-menu__label">${window.siyuan.languages.clear}</span>
    </button>
</div>
</div>`},uF=t=>{const e=t.menuElement.querySelectorAll("input");return e.forEach(n=>{n.addEventListener("keydown",a=>{var i;a.isComposing||a.key==="Enter"&&(fs(t.protyle,t.blockElement,{content:c_(e[0].dataset.value)||0,isNotEmpty:e[0].value!=="",content2:c_(e[1].dataset.value)||0,isNotEmpty2:e[1].value!=="",hasEndDate:e[2].checked,isNotTime:!e[3].checked},t.cellElements),(i=document.querySelector(".av__panel"))==null||i.dispatchEvent(new CustomEvent("click",{detail:"close"})))})}),e[0].addEventListener("change",()=>{e[0].dataset.value=e[0].value.length>10?e[0].value:e[0].value+" 00:00"}),e[1].addEventListener("change",()=>{e[1].dataset.value=e[1].value.length>10?e[1].value:e[1].value+" 00:00"}),e[2].addEventListener("change",()=>{if(e[2].checked){if(!e[1].dataset.value){const n=new Date().getTime();e[1].dataset.value=at(n).format("YYYY-MM-DD HH:mm"),e[1].value=at(n).format(e[3].checked?"YYYY-MM-DD HH:mm":"YYYY-MM-DD")}e[1].classList.remove("fn__none")}else e[1].classList.add("fn__none")}),e[3].addEventListener("change",()=>{e[0].value="",e[1].value="",e[3].checked?(e[0].setAttribute("type","datetime-local"),e[1].setAttribute("type","datetime-local"),e[0].setAttribute("max","9999-12-31 23:59"),e[1].setAttribute("max","9999-12-31 23:59"),e[0].value=e[0].dataset.value,e[1].value=e[1].dataset.value):(e[0].setAttribute("type","date"),e[1].setAttribute("type","date"),e[0].setAttribute("max","9999-12-31"),e[1].setAttribute("max","9999-12-31"),e[0].value=e[0].dataset.value.substring(0,10),e[1].value=e[1].dataset.value.substring(0,10))}),()=>{fs(t.protyle,t.blockElement,{content:c_(e[0].dataset.value)||0,isNotEmpty:e[0].value!=="",content2:c_(e[1].dataset.value)||0,isNotEmpty2:e[1].value!=="",hasEndDate:e[2].checked,isNotTime:!e[3].checked},t.cellElements)}},c_=t=>{const e=t.split("-")[0],n=new Date(t);return(e.startsWith("00")||e.startsWith("000")||e.length<3)&&n.setFullYear(parseInt(e)),n.getTime()},Si=t=>{t.menu.addItem({iconHTML:"",label:VS(t.format),click(){et(t.protyle,[{action:"updateAttrViewColNumberFormat",id:t.colId,avID:t.avID,format:t.format,type:"number"}],[{action:"updateAttrViewColNumberFormat",id:t.colId,avID:t.avID,format:t.oldFormat,type:"number"}]),t.avPanelElement.remove()}})},fF=t=>{const e=new ta(p.MENU_AV_COL_FORMAT_NUMBER);Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"commas",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"percent",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"USD",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"CNY",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"EUR",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"GBP",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"JPY",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"RUB",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"INR",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"KRW",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"CAD",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"CHF",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"THB",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"AUD",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"HKD",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"TWD",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"MOP",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"SGD",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement}),Si({menu:e,protyle:t.protyle,colId:t.colId,avID:t.avID,format:"NZD",oldFormat:t.oldFormat,avPanelElement:t.avPanelElement});const n=t.element.getBoundingClientRect();e.open({x:n.left,y:n.bottom,h:n.height,w:n.width,isLeft:!0})},VS=t=>t===""?window.siyuan.languages.numberFormatNone:t==="commas"?window.siyuan.languages.numberFormatCommas:t==="percent"?window.siyuan.languages.numberFormatPercent:window.siyuan.languages["numberFormat"+t],zS=(t,e)=>{var n,a;if(e.classList.contains("b3-list--empty"))return;t.target.querySelector(".b3-menu__accelerator").textContent=e.querySelector(".b3-list-item__text").textContent;const i=ma(t.data).find(r=>{if(r.id===t.colId)return r.rollup||(r.rollup={}),!0});if(t.isRelation){if(e.dataset.colId===((n=i.rollup)==null?void 0:n.relationKeyID))return;i.rollup={relationKeyID:e.dataset.colId};const r=t.target.nextElementSibling;r.querySelector(".b3-menu__accelerator").textContent="",r.setAttribute("data-av-id",e.dataset.targetAvId);const o=r.nextElementSibling;o.removeAttribute("data-col-type"),o.removeAttribute("data-calc"),o.querySelector(".b3-menu__accelerator").textContent=window.siyuan.languages.original}else{if(e.dataset.colId===((a=i.rollup)==null?void 0:a.keyID))return;i.rollup.keyID=e.dataset.colId,delete i.rollup.calc;const r=t.target.nextElementSibling;r.removeAttribute("data-calc"),r.setAttribute("data-col-type",e.dataset.colType),r.querySelector(".b3-menu__accelerator").textContent=window.siyuan.languages.original}const s=JSON.parse(JSON.stringify(i.rollup));et(t.protyle,[{action:"updateAttrViewColRollup",id:t.colId,avID:t.data.id,parentID:i.rollup.relationKeyID,keyID:i.rollup.keyID,data:{calc:i.rollup.calc}}],[{action:"updateAttrViewColRollup",id:t.colId,avID:t.data.id,parentID:s.relationKeyID,keyID:s.keyID,data:{calc:s.calc}}])},YS=(t,e,n,a,i)=>{if(!a&&!n){Q(window.siyuan.languages.selectRelation);return}ae(a?"/api/av/searchAttributeViewRelationKey":"/api/av/searchAttributeViewRollupDestKeys",{avID:n,keyword:e},s=>{let r="";s.data.keys.forEach((o,l)=>{r+=`<div class="b3-list-item b3-list-item--narrow${l===0?" b3-list-item--focus":""}" data-col-id="${o.id}" ${a?`data-target-av-id="${o.relation.avID}"`:`data-col-type="${o.type}"`}>
        ${o.icon?Yt(o.icon,"b3-list-item__graphic",!0):`<svg class="b3-list-item__graphic"><use xlink:href="#${za(o.type)}"></use></svg>`}
        <span class="b3-list-item__text">${he(o.name||window.siyuan.languages.title)}</span>
</div>`}),t.innerHTML=r||`<div class="b3-list--empty">${window.siyuan.languages.emptyContent}</div>`,i&&i()})},GS=t=>{window.siyuan.menus.menu.remove();const e=new ta;e.addItem({iconHTML:"",type:"empty",label:`<div class="fn__flex-column b3-menu__filter">
    <input class="b3-text-field fn__flex-shrink" placeholder="${window.siyuan.languages[t.isRelation?"searchRelation":"searchRollupProperty"]}"/>
    <div class="fn__hr"></div>
    <div class="b3-list fn__flex-1 b3-list--background">
        <img style="margin: 0 auto;display: block;width: 64px;height: 64px" src="/stage/loading-pure.svg">
    </div>
</div>`,bind(n){const a=n.querySelector(".b3-list"),i=n.querySelector("input");i.addEventListener("keydown",s=>{if(s.isComposing)return;pi(a,s)&&s.stopPropagation(),s.key==="Enter"&&(s.preventDefault(),s.stopPropagation(),zS(t,a.querySelector(".b3-list-item--focus")),window.siyuan.menus.menu.remove())}),i.addEventListener("input",s=>{s.stopPropagation(),YS(a,i.value,t.isRelation?t.data.id:t.target.dataset.avId,t.isRelation)}),n.lastElementChild.addEventListener("click",s=>{const r=N(s.target,"b3-list-item");r&&(s.stopPropagation(),zS(t,r),window.siyuan.menus.menu.remove())}),YS(a,"",t.isRelation?t.data.id:t.target.dataset.avId,t.isRelation,()=>{const s=t.target.getBoundingClientRect();e.open({x:s.left,y:s.bottom,h:s.height}),n.querySelector("input").focus()})}}),e.element.querySelector(".b3-menu__items").setAttribute("style","overflow: initial")},jS=t=>{var e,n;let a;return t.colData?a=t.colData:ma(t.data).find(i=>{if(i.id===$s(t.cellElements[0],t.data.viewType))return a=i,!0}),`<button class="b3-menu__item b3-menu__item--current" data-type="goSearchRollupCol" data-old-value='${JSON.stringify(a.rollup||{})}'>
    <span class="b3-menu__label">${window.siyuan.languages.relation}</span>
    <span class="b3-menu__accelerator"></span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>
<button class="b3-menu__item" data-type="goSearchRollupTarget">
    <span class="b3-menu__label">${window.siyuan.languages.rollupProperty}</span>
    <span class="b3-menu__accelerator"></span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>
<button class="b3-menu__item" data-type="goSearchRollupCalc">
    <span class="b3-menu__label">${window.siyuan.languages.rollupCalc}</span>
    <span class="b3-menu__accelerator">${sx((n=(e=a.rollup)==null?void 0:e.calc)==null?void 0:n.operator,!0)}</span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>`},KS=t=>{const e=t.menuElement.querySelector('[data-type="goSearchRollupCol"]');if(e){const n=JSON.parse(e.dataset.oldValue),a=t.menuElement.querySelector('[data-type="goSearchRollupTarget"]');let i="";n.relationKeyID&&ma(t.data).find(s=>{if(s.id===n.relationKeyID)return e.querySelector(".b3-menu__accelerator").textContent=s.name,i=s.relation.avID,a.dataset.avId=i,!0}),n.keyID&&i&&ae("/api/av/getAttributeView",{id:i},s=>{s.data.av.keyValues.find(r=>{if(r.key.id===n.keyID){a.querySelector(".b3-menu__accelerator").textContent=r.key.name;const o=t.menuElement.querySelector('[data-type="goSearchRollupCalc"]');return o.dataset.colType=r.key.type,n.calc&&(o.dataset.calc=n.calc.operator),!0}})})}};var pF=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const XS=t=>{var e;let n="";const a=t.view;if(["gallery","kanban"].includes(t.viewType)){let i="";a.coverFrom===0?i=window.siyuan.languages.calcOperatorNone:a.coverFrom===1?i=window.siyuan.languages.contentImage:a.coverFrom===3?i=window.siyuan.languages.contentBlock:a.fields.find(s=>{if(s.type==="mAsset"&&s.id===a.coverFromAssetKeyID)return i=s.name,!0}),n=`<button class="b3-menu__item" data-type="set-gallery-cover">
    <span class="fn__flex-center">${window.siyuan.languages.cardPreview1}</span>
    <span class="fn__flex-1"></span>
    <span class="b3-menu__accelerator">${i}</span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>
<button class="b3-menu__item" data-type="set-gallery-ratio">
    <span class="fn__flex-center">${window.siyuan.languages.cardAspectRatio}</span>
    <span class="fn__flex-1"></span>
    <span class="b3-menu__accelerator">${rx(a.cardAspectRatio)}</span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>
<button class="b3-menu__item" data-type="set-gallery-size">
    <span class="fn__flex-center">${window.siyuan.languages.cardSize}</span>
    <span class="fn__flex-1"></span>
    <span class="b3-menu__accelerator">${a.cardSize===0?window.siyuan.languages.small:a.cardSize===1?window.siyuan.languages.medium:window.siyuan.languages.large}</span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>
<label class="b3-menu__item">
    <span class="fn__flex-center">${window.siyuan.languages.fitImage}</span>
    <span class="fn__space fn__flex-1"></span>
    <input data-type="toggle-gallery-fit" type="checkbox" class="b3-switch b3-switch--menu" ${a.fitImage?"checked":""}>
</label>
<label class="b3-menu__item">
    <span class="fn__flex-center">${window.siyuan.languages.displayFieldName}</span>
    <span class="fn__space fn__flex-1"></span>
    <input data-type="toggle-gallery-name" type="checkbox" class="b3-switch b3-switch--menu" ${a.displayFieldName?"checked":""}>
</label>`}return n=`<div class="b3-menu__items">
    <button class="b3-menu__item" data-type="nobg">
        <span class="block__icon" style="padding: 8px;margin-left: -4px;" data-type="go-config">
            <svg><use xlink:href="#iconLeft"></use></svg>
        </span>
        <span class="b3-menu__label ft__center">${window.siyuan.languages.layout}</span>
    </button>
    <button class="b3-menu__separator"></button>
    <button class="b3-menu__item" data-type="nobg">
        <div class="av__layout">
            <div data-type="set-layout" data-view-type="table" class="av__layout-item${t.viewType==="table"?" av__layout-item--select":""}">
                <svg><use xlink:href="#iconTable"></use></svg>
                <div class="fn__hr"></div>
                <div>${window.siyuan.languages.table}</div>
            </div>
            <div data-type="set-layout" data-view-type="kanban" class="av__layout-item${t.viewType==="kanban"?" av__layout-item--select":""}">
                <svg><use xlink:href="#iconBoard"></use></svg>
                <div class="fn__hr"></div>
                <div>${window.siyuan.languages.kanban}</div>
            </div>
            <div data-type="set-layout" data-view-type="gallery" class="av__layout-item${t.viewType==="gallery"?" av__layout-item--select":""}">
                <svg><use xlink:href="#iconGallery"></use></svg>
                <div class="fn__hr"></div>
                <div>${window.siyuan.languages.gallery}</div>
            </div>
        </div>
    </button>
    <label class="b3-menu__item">
        <span class="fn__flex-center">${window.siyuan.languages.showTitle}</span>
        <span class="fn__space fn__flex-1"></span>
        <input data-type="toggle-view-title" type="checkbox" class="b3-switch b3-switch--menu" ${a.hideAttrViewName?"":"checked"}>
    </label>
    ${n}
    <label class="b3-menu__item">
        <span class="fn__flex-center">${window.siyuan.languages.showAllEntriesIcons}</span>
        <span class="fn__space fn__flex-1"></span>
        <input data-type="toggle-entries-icons" type="checkbox" class="b3-switch b3-switch--menu" ${a.showIcon?"checked":""}>
    </label>
    <label class="b3-menu__item">
        <span class="fn__flex-center">${window.siyuan.languages.wrapAllFields}</span>
        <span class="fn__space fn__flex-1"></span>
        <input data-type="toggle-entries-wrap" type="checkbox" class="b3-switch b3-switch--menu" ${a.wrapField?"checked":""}>
    </label>`,t.viewType==="kanban"&&["select","mSelect"].includes((e=t.view.groups[0].groupValue)==null?void 0:e.type)&&(n+=`<label class="b3-menu__item">
    <span class="fn__flex-center">${window.siyuan.languages.useBackground}</span>
    <span class="fn__space fn__flex-1"></span>
    <input data-type="toggle-kanban-bg" type="checkbox" class="b3-switch b3-switch--menu" ${a.fillColBackgroundColor?"checked":""}>
</label>`),n+`<button class="b3-menu__item" data-type="set-page-size" data-size="${a.pageSize}">
        <span class="fn__flex-center">${window.siyuan.languages.entryNum}</span>
        <span class="fn__flex-1"></span>
        <span class="b3-menu__accelerator">${a.pageSize===p.SIZE_DATABASE_MAZ_SIZE?window.siyuan.languages.all:a.pageSize}</span>
        <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
    </button>
</div>`},ZS=t=>{const e=t.blockElement.getAttribute("data-av-id"),n=t.blockElement.getAttribute("data-node-id"),a=t.blockElement.getAttribute(p.CUSTOM_SY_AV_VIEW),i=t.menuElement.querySelector('.b3-switch[data-type="toggle-view-title"]');i.addEventListener("change",()=>{const d=i.checked;et(t.protyle,[{action:"hideAttrViewName",avID:e,blockID:n,data:!d,viewID:a}],[{action:"hideAttrViewName",avID:e,blockID:n,data:d,viewID:a}]),t.data.view.hideAttrViewName=!d});const s=t.menuElement.querySelector('.b3-switch[data-type="toggle-entries-icons"]');s.addEventListener("change",()=>{const d=s.checked;et(t.protyle,[{action:"setAttrViewShowIcon",avID:e,blockID:n,data:d,viewID:a}],[{action:"setAttrViewShowIcon",avID:e,blockID:n,data:!d,viewID:a}]),t.data.view.showIcon=d});const r=t.menuElement.querySelector('.b3-switch[data-type="toggle-entries-wrap"]');if(r.addEventListener("change",()=>{const d=r.checked;et(t.protyle,[{action:"setAttrViewWrapField",avID:e,blockID:n,data:d,viewID:a}],[{action:"setAttrViewWrapField",avID:e,blockID:n,data:!d,viewID:a}]),ma(t.data).forEach(u=>{u.wrap=d}),t.data.view.wrapField=d}),t.data.viewType==="table")return;const o=t.menuElement.querySelector('.b3-switch[data-type="toggle-gallery-fit"]');o.addEventListener("change",()=>{const d=o.checked;et(t.protyle,[{action:"setAttrViewFitImage",avID:e,blockID:n,data:d,viewID:a}],[{action:"setAttrViewFitImage",avID:e,blockID:n,data:!d,viewID:a}]),t.data.view.fitImage=d});const l=t.menuElement.querySelector('.b3-switch[data-type="toggle-gallery-name"]');if(l.addEventListener("change",()=>{const d=l.checked;et(t.protyle,[{action:"setAttrViewDisplayFieldName",avID:e,blockID:n,data:d}],[{action:"setAttrViewDisplayFieldName",avID:e,blockID:n,data:!d}]),t.data.view.displayFieldName=d}),t.data.viewType==="gallery")return;const c=t.menuElement.querySelector('.b3-switch[data-type="toggle-kanban-bg"]');c.addEventListener("change",()=>{const d=c.checked;et(t.protyle,[{action:"setAttrViewFillColBackgroundColor",avID:e,blockID:n,data:d,viewID:a}],[{action:"setAttrViewFillColBackgroundColor",avID:e,blockID:n,data:!d,viewID:a}]),t.data.view.fillColBackgroundColor=d})},hF=t=>pF(void 0,null,function*(){if(t.target.classList.contains("av__layout-item--select")||t.target.dataset.load==="true")return;t.target.dataset.load="true",t.target.parentElement.querySelector(".av__layout-item--select").classList.remove("av__layout-item--select"),t.target.classList.add("av__layout-item--select");const e=yield wn("/api/av/changeAttrViewLayout",{blockID:t.nodeElement.getAttribute("data-node-id"),avID:t.nodeElement.getAttribute("data-av-id"),layoutType:t.target.getAttribute("data-view-type")}),n=document.querySelector(".av__panel").lastElementChild;return n.innerHTML=XS(e.data),ZS({protyle:t.protyle,data:e.data,menuElement:n,blockElement:t.nodeElement}),t.target.removeAttribute("data-load"),e.data});var zh=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const d_=t=>{const e={};let n;return t.querySelectorAll(".av__body").forEach(a=>{const i=a.dataset.groupId,s=parseInt(a.dataset.pageSize);i?e[i]={pageSize:s}:n||(n=s)}),{groupPageSize:e,unGroupPageSize:n}},gF=t=>zh(void 0,null,function*(){const e=t.blockElement.getAttribute("data-node-id"),n=ma(t.data).find(r=>r.id===t.fieldId),a=n?{field:t.fieldId,method:n.type==="number"?1:["date","updated","created"].includes(n.type)?2:0,order:0,range:n.type==="number"?{numStart:0,numEnd:1e3,numStep:100}:null,hideEmpty:!0}:{field:null,method:null,order:null,range:null,hideEmpty:null},i=yield wn("/api/av/setAttrViewGroup",{blockID:e,avID:t.blockElement.getAttribute("data-av-id"),group:a});t.data.view=i.data.view,t.menuElement.innerHTML=Nf(ma(t.data),t.data.view),Gh({protyle:t.protyle,menuElement:t.menuElement,blockElement:t.blockElement,data:t.data});const s=t.blockElement.querySelector(".av__views").getBoundingClientRect();gn(t.menuElement,s.right-t.menuElement.clientWidth,s.bottom,s.height)}),JS=(t,e,n)=>{const a='<svg class="b3-menu__checked"><use xlink:href="#iconSelect"></use></svg>';let i=n==="kanban"?"":`<button class="b3-menu__item" data-type="setGroupMethod">
    <div class="b3-menu__label">${window.siyuan.languages.calcOperatorNone}</div>
    ${!e||!e.field?a:""}
</button>`;return t.forEach(s=>{["rollup","mAsset","lineNumber"].includes(s.type)||(i+=`<button class="b3-menu__item" data-id="${s.id}" data-type="setGroupMethod">
    <div class="b3-menu__label fn__flex">
        ${s.icon?Yt(s.icon,"b3-menu__icon",!0):`<svg class="b3-menu__icon"><use xlink:href="#${za(s.type)}"></use></svg>`}
        ${he(s.name)||"&nbsp;"}
    </div>
    ${(e==null?void 0:e.field)===s.id?a:""}
</button>`)}),`<div class="b3-menu__items">
<button class="b3-menu__item" data-type="nobg">
    <span class="block__icon" style="padding: 8px;margin-left: -4px;" data-type="${!e||!e.field?"go-config":"goGroups"}">
        <svg><use xlink:href="#iconLeft"></use></svg>
    </span>
    <span class="b3-menu__label ft__center">${window.siyuan.languages.groupMethod}</span>
</button>
<button class="b3-menu__separator"></button>
${i}
</div>`},Yh=(t,e)=>{if(e==="sort")switch(t){case 0:return window.siyuan.languages.asc;case 1:return window.siyuan.languages.desc;case 2:return window.siyuan.languages.customSort;case 3:return window.siyuan.languages.sortBySelectOption;default:return""}else if(e==="date")switch(t){case 2:return window.siyuan.languages.groupMethodDateRelative;case 3:return window.siyuan.languages.groupMethodDateDay;case 4:return window.siyuan.languages.groupMethodDateWeek;case 5:return window.siyuan.languages.groupMethodDateMonth;case 6:return window.siyuan.languages.groupMethodDateYear;default:return""}},mF=t=>{var e,n,a;return`<div class="b3-menu__items">
    <button class="b3-menu__item" data-type="nobg">
        <span class="block__icon" style="padding: 8px;margin-left: -4px;" data-type="goGroups">
            <svg><use xlink:href="#iconLeft"></use></svg>
        </span>
        <span class="b3-menu__label ft__center">${window.siyuan.languages.numberFormatNone}</span>
    </button>
    <button class="b3-menu__separator"></button>
    <div class="b3-menu__item" data-type="nobg">
        <div class="fn__block">
            <div class="b3-menu__labels">${window.siyuan.languages.groupRange}</div>
            <div class="fn__flex">
                <input data-type="avGroupRange" class="b3-text-field fn__flex-1" value="${((e=t==null?void 0:t.range)==null?void 0:e.numStart)||0}">
                <span class="fn__space"></span>-<span class="fn__space"></span>
                <input class="b3-text-field fn__flex-1" value="${((n=t==null?void 0:t.range)==null?void 0:n.numEnd)||1e3}">            
            </div>
            <div class="fn__hr"></div>
            <div class="b3-menu__labels">${window.siyuan.languages.groupStep}</div>
            <input class="b3-text-field fn__block" value="${((a=t==null?void 0:t.range)==null?void 0:a.numStep)||100}">
            <div class="fn__hr--small"></div>
        </div>
    </div>
</div>`},bF=t=>()=>zh(void 0,null,function*(){if(!t.menuElement.querySelector('[data-type="avGroupRange"]'))return;const e=t.blockElement.getAttribute("data-node-id"),n=t.menuElement.querySelectorAll("input"),a={numStart:n[0].value?parseFloat(n[0].value):t.data.view.group.range.numStart,numEnd:n[1].value?parseFloat(n[1].value):t.data.view.group.range.numEnd,numStep:n[2].value?parseFloat(n[2].value):t.data.view.group.range.numStep};if(G(t.data.view.group.range,a))return;Object.assign(t.data.view.group.range,a);const i=yield wn("/api/av/setAttrViewGroup",{blockID:e,avID:t.blockElement.getAttribute("data-av-id"),group:t.data.view.group});t.data.view=i.data.view}),Nf=(t,e)=>{var n;let a="",i;if(e.group&&e.group.field){let s="";if(i=t.find(r=>r.id===e.group.field),((n=e.groups)==null?void 0:n.length)>0){const r=["created","date","created","updated"].includes(i.type);let o=0;e.groups.forEach(l=>{var c,d,u;l.groupHidden===0&&o++;let g=`<div class="b3-menu__label fn__flex-1 fn__ellipsis">${l.name||""}</div>`;((d=(c=l.groupValue)==null?void 0:c.mSelect)==null?void 0:d.length)>0?g=`<div class="fn__flex-1">
        <span class="b3-chip" style="background-color:var(--b3-font-background${l.groupValue.mSelect[0].color});color:var(--b3-font-color${l.groupValue.mSelect[0].color})">
            <span class="fn__ellipsis">${he(l.groupValue.mSelect[0].content)}</span>
        </span>
    </div>`:((u=l.groupValue)==null?void 0:u.type)=="checkbox"&&(g=`<div class="b3-menu__label fn__flex">
<svg class="b3-menu__icon"><use xlink:href="#icon${l.groupValue.checkbox.checked?"Check":"Uncheck"}"></use></svg> ${i.name||""}
</div>`),s+=`<button class="b3-menu__item${l.groupHidden===0?"":" b3-menu__item--hidden"}" draggable="${r?"false":"true"}" data-id="${l.id}">
    ${r?"":'<svg class="b3-menu__icon fn__grab"><use xlink:href="#iconDrag"></use></svg>'}
    ${g}
    <svg class="b3-menu__action b3-menu__action--show" data-type="hideGroup" data-id="${l.id}"><use xlink:href="#iconEye${l.groupHidden===0?"":"off"}"></use></svg>
</button>`}),s=`<button class="b3-menu__separator"></button>
<button class="b3-menu__item" data-type="nobg">
    <span class="b3-menu__label"></span>
    <span class="block__icon" data-type="hideGroups">
        ${window.siyuan.languages[o===0?"showAll":"hideAll"]}
        <span class="fn__space"></span>
        <svg><use xlink:href="#iconEye${o===0?"":"off"}"></use></svg>
    </span>
</button>`+s}a=`<button class="b3-menu__item${["date","updated","created"].includes(i.type)?"":" fn__none"}" data-type="goGroupsDate">
    <span class="b3-menu__label">${window.siyuan.languages.date}</span>
    <span class="b3-menu__accelerator">${Yh(e.group.method,"date")}</span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>
<button class="b3-menu__item${i.type==="number"?"":" fn__none"}" data-type="getGroupsNumber">
    <span class="b3-menu__label">${window.siyuan.languages.numberFormatNone}</span>
    <span class="b3-menu__accelerator">${e.group.range&&typeof e.group.range.numStart=="number"?`${e.group.range.numStart} - ${e.group.range.numEnd}`:""}</span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>
<button class="b3-menu__item${["checkbox","rollup","mAsset"].includes(i.type)?" fn__none":""}" data-type="goGroupsSort">
    <span class="b3-menu__label">${window.siyuan.languages.sort}</span>
    <span class="b3-menu__accelerator">${Yh(e.group.order,"sort")}</span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>
<label class="b3-menu__item">
    <span class="fn__flex-center">${window.siyuan.languages.hideEmptyGroup}</span>
    <span class="fn__space fn__flex-1"></span>
    <input type="checkbox" class="b3-switch b3-switch--menu"${e.group.hideEmpty?" checked":""}>
</label>
${s}
<button class="b3-menu__separator"></button>
<button class="b3-menu__item b3-menu__item--warning" data-type="removeGroups">
    <svg class="b3-menu__icon"><use xlink:href="#iconTrashcan"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.removeGroup}</span>
</button>`}return`<div class="b3-menu__items">
<button class="b3-menu__item" data-type="nobg">
    <span class="block__icon" style="padding: 8px;margin-left: -4px;" data-type="go-config">
        <svg><use xlink:href="#iconLeft"></use></svg>
    </span>
    <span class="b3-menu__label ft__center">${window.siyuan.languages.group}</span>
</button>
<button class="b3-menu__separator"></button>
<button class="b3-menu__item" data-type="goGroupsMethod">
    <span class="b3-menu__label">${window.siyuan.languages.groupMethod}</span>
    <span class="b3-menu__accelerator">${i?i.name:""}</span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>
${a}
</div>`},Gh=t=>{const e=t.menuElement.querySelector("input");if(!e)return;const n=t.blockElement.getAttribute("data-node-id");e.addEventListener("change",()=>zh(void 0,null,function*(){t.data.view.group.hideEmpty=e.checked;const a=yield wn("/api/av/setAttrViewGroup",{blockID:n,avID:t.blockElement.getAttribute("data-av-id"),group:t.data.view.group});t.data.view=a.data.view,t.menuElement.innerHTML=Nf(ma(t.data),t.data.view),Gh({protyle:t.protyle,menuElement:t.menuElement,blockElement:t.blockElement,data:t.data});const i=t.blockElement.querySelector(".av__views").getBoundingClientRect();gn(t.menuElement,i.right-t.menuElement.clientWidth,i.bottom,i.height)}))},yF=t=>{const e=new ta(p.MENU_AV_GROUP_DATE);if(e.isOpen)return;const n=t.blockElement.getAttribute("data-node-id");[2,3,4,5,6].forEach(i=>{const s=Yh(i,"date");e.addItem({iconHTML:"",checked:t.data.view.group.method===i,label:s,click(){return zh(this,null,function*(){t.data.view.group.method=i,t.target.querySelector(".b3-menu__accelerator").textContent=s;const r=yield wn("/api/av/setAttrViewGroup",{blockID:n,avID:t.blockElement.getAttribute("data-av-id"),group:t.data.view.group});t.data.view=r.data.view,t.menuElement.innerHTML=Nf(ma(t.data),t.data.view),Gh({protyle:t.protyle,menuElement:t.menuElement,blockElement:t.blockElement,data:t.data});const o=t.blockElement.querySelector(".av__views").getBoundingClientRect();gn(t.menuElement,o.right-t.menuElement.clientWidth,o.bottom,o.height)})}})});const a=t.target.getBoundingClientRect();e.open({isLeft:!0,x:a.right,y:a.bottom})},_F=t=>{const e=new ta(p.MENU_AV_GROUP_SORT);if(e.isOpen)return;const n=t.blockElement.getAttribute("data-node-id"),a=ma(t.data).find(s=>s.id===t.data.view.group.field);(["created","date","created","updated"].includes(a.type)?[0,1]:["mSelect","select"].includes(a.type)?[3,2,0,1]:[2,0,1]).forEach(s=>{const r=Yh(s,"sort");e.addItem({iconHTML:"",checked:t.data.view.group.order===s,label:r,click(){return zh(this,null,function*(){t.target.querySelector(".b3-menu__accelerator").textContent=r,t.data.view.group.order=s;const o=yield wn("/api/av/setAttrViewGroup",{blockID:n,avID:t.blockElement.getAttribute("data-av-id"),group:t.data.view.group});t.data.view=o.data.view,t.menuElement.innerHTML=Nf(ma(t.data),t.data.view),Gh({protyle:t.protyle,menuElement:t.menuElement,blockElement:t.blockElement,data:t.data});const l=t.blockElement.querySelector(".av__views").getBoundingClientRect();gn(t.menuElement,l.right-t.menuElement.clientWidth,l.bottom,l.height)})}})});const i=t.target.getBoundingClientRect();e.open({isLeft:!0,x:i.right,y:i.bottom})};var wF=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const Vi=t=>{var e;let n=document.querySelector(".av__panel");if(n){n.remove();return}const a=t.blockElement.getAttribute("data-av-id"),i=d_(t.blockElement);ae("/api/av/renderAttributeView",{id:a,query:((e=t.blockElement.querySelector('[data-type="av-search"]'))==null?void 0:e.value.trim())||"",pageSize:i.unGroupPageSize,groupPaging:i.groupPageSize,viewID:t.blockElement.getAttribute(p.CUSTOM_SY_AV_VIEW)},s=>{var r;if(n=document.querySelector(".av__panel"),n){n.remove();return}window.siyuan.menus.menu.remove();const o=t.blockElement.getAttribute("data-node-id"),l=!t.blockElement.classList.contains("av");let c=s.data,d,u=ma(c);if(t.type==="config")d=S2(c);else if(t.type==="properties")d=rc(u);else if(t.type==="sorts")d=Pf(u,c.view.sorts);else if(t.type==="switcher")d=O5(c.views,c.viewID);else if(t.type==="filters")d=oc(c);else if(t.type==="select")d=Mf(u,t.cellElements,!0,t.blockElement);else if(t.type==="asset")d=MS(t.cellElements);else if(t.type==="edit")t.editData&&(typeof t.editData.colData.wrap=="undefined"&&(t.editData.colData.wrap=c.view.wrapField),t.editData.previousID?u.find((y,_)=>{if(y.id===t.editData.previousID)return u.splice(_+1,0,t.editData.colData),!0}):c.viewType==="table"?u.splice(0,0,t.editData.colData):u.push(t.editData.colData)),d=go({protyle:t.protyle,data:c,colId:t.colId,isCustomAttr:l});else if(t.type==="date")d=dF(t.cellElements);else if(t.type==="rollup")d=`<div class="b3-menu__items">${jS({data:c,cellElements:t.cellElements})}</div>`;else if(t.type==="relation"&&(d=q5(c,t.cellElements),!d)){Vi({protyle:t.protyle,blockElement:t.blockElement,type:"edit",colId:$s(t.cellElements[0],c.viewType)});return}document.body.insertAdjacentHTML("beforeend",`<div class="av__panel" style="z-index: ${++window.siyuan.zIndex};">
    <div class="b3-dialog__scrim" data-type="close"></div>
    <div class="b3-menu" ${["select","date","asset","relation","rollup"].includes(t.type)?`style="min-width: 200px;${x()?"max-width: 90vw;":"max-width: 50vw;"}"`:""}>${d}</div>
</div>`),n=document.querySelector(".av__panel");let g;const f=n.lastElementChild;let h=(r=t.blockElement.querySelector(`.av__views, .av__row[data-col-id="${t.colId}"] > .block__logo`))==null?void 0:r.getBoundingClientRect();if(["select","date","asset","relation","rollup"].includes(t.type)){let y=t.cellElements[t.cellElements.length-1];if(!t.blockElement.contains(y)){const v=Pr(y,c.viewType);c.viewType==="table"?y=t.blockElement.querySelector(`.av__row[data-id="${v}"] .av__cell[data-col-id="${y.dataset.colId}"]`):y=t.blockElement.querySelector(`.av__gallery-item[data-id="${v}"] .av__cell[data-field-id="${y.dataset.fieldId}"]`)}const _=(y||t.cellElements[t.cellElements.length-1]).getBoundingClientRect();if(t.type==="select"?If(t.protyle,c,f,t.cellElements,t.blockElement):t.type==="date"?g=uF({protyle:t.protyle,data:c,menuElement:f,cellElements:t.cellElements,blockElement:t.blockElement}):t.type==="asset"?(IS({protyle:t.protyle,menuElement:f,cellElements:t.cellElements,blockElement:t.blockElement}),setTimeout(()=>{gn(f,_.left,_.bottom,_.height)},p.TIMEOUT_LOAD)):t.type==="relation"?H5({menuElement:f,cellElements:t.cellElements,protyle:t.protyle,blockElement:t.blockElement}):t.type==="rollup"&&KS({protyle:t.protyle,data:c,menuElement:f}),["select","date","relation","rollup"].includes(t.type)){const v=f.querySelector("input");v&&(v.select(),v.focus()),gn(f,_.left,_.bottom,_.height)}}else gn(f,h.right-f.clientWidth,h.bottom,h.height),t.type==="sorts"?Ff(t.protyle,f,c,o):t.type==="edit"?mo({protyle:t.protyle,data:c,menuElement:f,isCustomAttr:l,blockID:o}):t.type==="config"?k2({protyle:t.protyle,data:c,menuElement:f,blockElement:t.blockElement}):t.type==="switcher"&&$5({protyle:t.protyle,menuElement:f,blockElement:t.blockElement});t.cb&&t.cb(n),n.addEventListener("dragstart",y=>{window.siyuan.dragElement=y.target,window.siyuan.dragElement.style.opacity=".38"}),n.addEventListener("drop",y=>{var _,v,U,ee,Z,k;if(b=0,!window.siyuan.dragElement){y.preventDefault(),y.stopPropagation();return}window.siyuan.dragElement.style.opacity="";const w=window.siyuan.dragElement;if(window.siyuan.dragElement=void 0,t.protyle&&t.protyle.disabled){y.preventDefault(),y.stopPropagation();return}if(!t.protyle&&window.siyuan.config.readonly){y.preventDefault(),y.stopPropagation();return}const S=n.querySelector(".dragover__bottom, .dragover__top");if(!S)return;const B=S.classList.contains("dragover__top"),H=w.dataset.id,j=S.dataset.id;if(S.querySelector('[data-type="removeSort"]')){const re=c.view.sorts,Te=Object.assign([],re);let Be;re.find((Ie,Ce)=>{if(Ie.column===H)return Be=re.splice(Ce,1)[0],!0}),re.find((Ie,Ce)=>{if(Ie.column===j)return B?re.splice(Ce,0,Be):re.splice(Ce+1,0,Be),!0}),et(t.protyle,[{action:"setAttrViewSorts",avID:a,data:re,blockID:o}],[{action:"setAttrViewSorts",avID:a,data:Te,blockID:o}]),f.innerHTML=Pf(u,c.view.sorts),Ff(t.protyle,f,c,o);return}if(S.querySelector('[data-type="removeFilter"]')){const re=c.view.filters,Te=Object.assign([],re);let Be;re.find((Ie,Ce)=>{if(Ie.column===H)return Be=re.splice(Ce,1)[0],!0}),re.find((Ie,Ce)=>{if(Ie.column===j)return B?re.splice(Ce,0,Be):re.splice(Ce+1,0,Be),!0}),et(t.protyle,[{action:"setAttrViewFilters",avID:a,data:re,blockID:o}],[{action:"setAttrViewFilters",avID:a,data:Te,blockID:o}]),f.innerHTML=oc(c);return}if(S.querySelector('[data-type="av-view-edit"]')){et(t.protyle,[{action:"sortAttrViewView",avID:a,blockID:o,id:H,previousID:B?(_=S.previousElementSibling)==null?void 0:_.getAttribute("data-id"):S.getAttribute("data-id")}],[{action:"sortAttrViewView",avID:a,blockID:o,id:H,previousID:(v=w.previousElementSibling)==null?void 0:v.getAttribute("data-id")}]),B?(S.before(w),S.classList.remove("dragover__top")):(S.after(w),S.classList.remove("dragover__bottom"));return}if(S.querySelector('[data-type="editAssetItem"]')){B?S.before(w):S.after(w);const re=[];Array.from(S.parentElement.children).forEach(Te=>{["image","file"].includes(Te.dataset.type)&&re.push({content:Te.dataset.content,name:Te.dataset.name,type:Te.dataset.type})}),Od({protyle:t.protyle,cellElements:t.cellElements,replaceValue:re,blockElement:t.blockElement});return}if(S.querySelector('[data-type="setColOption"]')){const re=t.cellElements?$s(t.cellElements[0],c.viewType):f.querySelector(".b3-menu__item").getAttribute("data-col-id"),Te=u.find(Je=>Je.id===re).options,Be=Object.assign([],Te);let Ie;Te.find((Je,ze)=>{if(Je.name===w.dataset.name)return Ie=Te.splice(ze,1)[0],!0}),Te.find((Je,ze)=>{if(Je.name===S.dataset.name)return B?Te.splice(ze,0,Ie):Te.splice(ze+1,0,Ie),!0}),et(t.protyle,[{action:"updateAttrViewColOptions",id:re,avID:a,data:Te}],[{action:"updateAttrViewColOptions",id:re,avID:a,data:Be}]);const Ce=f.querySelector(".b3-menu__items").scrollTop;t.cellElements?(f.innerHTML=Mf(u,t.cellElements,!1,t.blockElement),If(t.protyle,c,f,t.cellElements,t.blockElement)):(f.innerHTML=go({protyle:t.protyle,data:c,colId:re,isCustomAttr:l}),mo({protyle:t.protyle,data:c,menuElement:f,isCustomAttr:l,blockID:o})),f.querySelector(".b3-menu__items").scrollTop=Ce;return}if(S.getAttribute("data-type")==="setRelationCell"){B?S.before(w):S.after(w),S.classList.remove("dragover__bottom","dragover__top");const re=[],Te=[];S.parentElement.querySelectorAll(".fn__grab").forEach(Be=>{const Ie=Be.nextElementSibling;re.push(Ie.parentElement.dataset.rowId),Te.push({isDetached:!Ie.style.color,type:"block",block:{content:Ie.textContent,id:Ie.dataset.id}})}),fs(t.protyle,t.blockElement,{blockIDs:re,contents:Te},t.cellElements);return}if(S.getAttribute("data-type")==="editCol"){const re=(B?(U=S.previousElementSibling)==null?void 0:U.getAttribute("data-id"):S.getAttribute("data-id"))||"",Te=((ee=w.previousElementSibling)==null?void 0:ee.getAttribute("data-id"))||"";if(re!==Te&&re!==H){et(t.protyle,[{action:"sortAttrViewCol",avID:a,previousID:re,id:H,blockID:o}],[{action:"sortAttrViewCol",avID:a,previousID:Te,id:H,blockID:o}]);let Be;u.find((Ie,Ce)=>{if(Ie.id===H)return Be=u.splice(Ce,1)[0],!0}),u.find((Ie,Ce)=>{if(Ie.id===j)return B?u.splice(Ce,0,Be):u.splice(Ce+1,0,Be),!0})}f.innerHTML=rc(u);return}if(S.querySelector('[data-type="hideGroup"]')){const re=(B?(Z=S.previousElementSibling)==null?void 0:Z.getAttribute("data-id"):S.getAttribute("data-id"))||"",Te=((k=w.previousElementSibling)==null?void 0:k.getAttribute("data-id"))||"";re!==Te&&re!==H&&(et(t.protyle,[{action:"sortAttrViewGroup",avID:a,blockID:o,previousID:re,id:H}],[{action:"sortAttrViewGroup",avID:a,blockID:o,previousID:Te,id:H}]),f.querySelector('[data-type="goGroupsSort"] .b3-menu__accelerator').textContent=Yh(2,"sort"),c.view.group.order=2,c.view.groups.find((Be,Ie)=>{if(Be.id===H){const Ce=c.view.groups.splice(Ie,1)[0];return c.view.groups.find((Je,ze)=>{if(Je.id===j)return B?c.view.groups.splice(ze,0,Ce):c.view.groups.splice(ze+1,0,Ce),!0}),!0}}),B?S.before(w):S.after(w)),S.classList.remove("dragover__top","dragover__bottom");return}});let m;n.addEventListener("dragover",y=>{if(y.dataTransfer.types.includes("Files")){y.preventDefault();return}const _=y.target;let v=ue(_,"draggable","true");if(v||(v=ue(document.elementFromPoint(y.clientX,y.clientY-1),"draggable","true")),!(!v||v===window.siyuan.dragElement)){if(y.preventDefault(),m&&v===m){const U=v.getBoundingClientRect();n.querySelectorAll(".dragover__bottom, .dragover__top").forEach(ee=>{ee.classList.remove("dragover__bottom","dragover__top")}),y.clientY>U.top+U.height/2?v.classList.add("dragover__bottom"):v.classList.add("dragover__top");return}m=v}});let b=0;n.addEventListener("dragleave",()=>{b--,b===0&&n.querySelectorAll(".dragover__bottom, .dragover__top").forEach(y=>{y.classList.remove("dragover__bottom","dragover__top")})}),n.addEventListener("dragenter",y=>{y.preventDefault(),b++}),n.addEventListener("dragend",()=>{window.siyuan.dragElement&&(window.siyuan.dragElement.style.opacity="",window.siyuan.dragElement=void 0)}),n.addEventListener("mousedown",y=>{y.button===1&&!N(y.target,"b3-menu")&&document.querySelector(".av__panel").dispatchEvent(new CustomEvent("click",{detail:"close"}))}),n.addEventListener("click",y=>wF(void 0,null,function*(){var _,v,U,ee,Z,k;let w,S=y.target;for(typeof y.detail=="string"?w=y.detail:typeof y.detail=="object"&&(w=y.detail.type,S=y.detail.target);S&&S!==n||w;){if(w=(S==null?void 0:S.dataset.type)||w,w==="close"){t.protyle.toolbar.subElement.classList.contains("fn__none")?window.siyuan.menus.menu.element.classList.contains("fn__none")&&(g==null||g(),n.remove(),setTimeout(()=>{qt(t.blockElement)},p.TIMEOUT_TRANSITION)):Ut(["util"],t.protyle),window.siyuan.menus.menu.remove(),y.preventDefault(),y.stopPropagation();break}else if(w==="go-config"){f.innerHTML=S2(c),gn(f,h.right-f.clientWidth,h.bottom,h.height),k2({protyle:t.protyle,data:c,menuElement:f,blockElement:t.blockElement}),window.siyuan.menus.menu.remove(),y.preventDefault(),y.stopPropagation();break}else if(w==="go-properties"){h=t.blockElement.querySelector(".av__views").getBoundingClientRect(),f.innerHTML=rc(u),gn(f,h.right-f.clientWidth,h.bottom,h.height),window.siyuan.menus.menu.remove(),y.preventDefault(),y.stopPropagation();break}else if(w==="go-layout"){f.innerHTML=XS(c),gn(f,h.right-f.clientWidth,h.bottom,h.height),ZS({protyle:t.protyle,data:c,menuElement:f,blockElement:t.blockElement}),window.siyuan.menus.menu.remove(),y.preventDefault(),y.stopPropagation();break}else if(w==="goSorts"){f.innerHTML=Pf(u,c.view.sorts),Ff(t.protyle,f,c,o),gn(f,h.right-f.clientWidth,h.bottom,h.height),window.siyuan.menus.menu.remove(),y.preventDefault(),y.stopPropagation();break}else if(w==="removeSorts"){et(t.protyle,[{action:"setAttrViewSorts",avID:a,data:[],blockID:o}],[{action:"setAttrViewSorts",avID:a,data:c.view.sorts,blockID:o}]),c.view.sorts=[],f.innerHTML=Pf(u,c.view.sorts),Ff(t.protyle,f,c,o),gn(f,h.right-f.clientWidth,h.bottom,h.height),y.preventDefault(),y.stopPropagation();break}else if(w==="addSort"){cF({data:c,rect:S.getBoundingClientRect(),menuElement:f,tabRect:h,avId:a,protyle:t.protyle,blockID:o}),y.preventDefault(),y.stopPropagation();break}else if(w==="removeSort"){const B=Object.assign([],c.view.sorts);c.view.sorts.find((H,j)=>{if(H.column===S.parentElement.dataset.id)return c.view.sorts.splice(j,1),!0}),et(t.protyle,[{action:"setAttrViewSorts",avID:a,data:c.view.sorts,blockID:o}],[{action:"setAttrViewSorts",avID:a,data:B,blockID:o}]),f.innerHTML=Pf(u,c.view.sorts),Ff(t.protyle,f,c,o),gn(f,h.right-f.clientWidth,h.bottom,h.height),y.preventDefault(),y.stopPropagation();break}else if(w==="goFilters"){f.innerHTML=oc(c),gn(f,h.right-f.clientWidth,h.bottom,h.height),window.siyuan.menus.menu.remove(),y.preventDefault(),y.stopPropagation();break}else if(w==="removeFilters"){et(t.protyle,[{action:"setAttrViewFilters",avID:a,data:[],blockID:o}],[{action:"setAttrViewFilters",avID:a,data:c.view.filters,blockID:o}]),c.view.filters=[],f.innerHTML=oc(c),gn(f,h.right-f.clientWidth,h.bottom,h.height),window.siyuan.menus.menu.remove(),y.preventDefault(),y.stopPropagation();break}else if(w==="addFilter"){TF({data:c,rect:S.getBoundingClientRect(),menuElement:f,tabRect:h,avId:a,protyle:t.protyle,blockElement:t.blockElement}),y.preventDefault(),y.stopPropagation();break}else if(w==="removeFilter"){window.siyuan.menus.menu.remove();const B=Object.assign([],c.view.filters);c.view.filters.find((H,j)=>{if(H.column===S.parentElement.dataset.id&&H.value.type===S.parentElement.dataset.filterType)return c.view.filters.splice(j,1),!0}),et(t.protyle,[{action:"setAttrViewFilters",avID:a,data:c.view.filters,blockID:o}],[{action:"setAttrViewFilters",avID:a,data:B,blockID:o}]),f.innerHTML=oc(c),gn(f,h.right-f.clientWidth,h.bottom,h.height),y.preventDefault(),y.stopPropagation();break}else if(w==="setFilter"){c.view.filters.find(B=>{if(B.column===S.parentElement.parentElement.dataset.id&&B.value.type===S.parentElement.parentElement.dataset.filterType)return ux({empty:!1,filter:B,protyle:t.protyle,data:c,target:S,blockElement:t.blockElement}),!0}),y.preventDefault(),y.stopPropagation();break}else if(w==="numberFormat"){fF({avPanelElement:n,element:S,protyle:t.protyle,oldFormat:S.dataset.format,colId:f.querySelector(".b3-menu__item").getAttribute("data-col-id"),avID:a}),y.preventDefault(),y.stopPropagation();break}else if(w==="newCol"){n.remove(),Kh(t.protyle,t.blockElement).open({x:h.right,y:h.bottom,h:h.height,isLeft:!0}),y.preventDefault(),y.stopPropagation();break}else if(w==="update-view-icon"){const B=S.getBoundingClientRect();Va("","av",{x:B.left,y:B.bottom+4,h:B.height,w:B.width},H=>{et(t.protyle,[{action:"setAttrViewViewIcon",avID:a,id:c.viewID,data:H}],[{action:"setAttrViewViewIcon",id:c.viewID,avID:a,data:S.dataset.icon}]),S.innerHTML=H?Yt(H):'<svg style="width: 14px;height: 14px;"><use xlink:href="#iconTable"></use></svg>',S.dataset.icon=H},S.querySelector("img")),y.preventDefault(),y.stopPropagation();break}else if(w==="set-page-size"){I2({target:S,protyle:t.protyle,avID:a,nodeElement:t.blockElement}),y.preventDefault(),y.stopPropagation();break}else if(w==="duplicate-view"){const B=Lute.NewNodeID();et(t.protyle,[{action:"duplicateAttrViewView",avID:a,previousID:c.viewID,id:B,blockID:o}],[{action:"removeAttrViewView",avID:a,id:B,blockID:o}]),n.remove(),y.preventDefault(),y.stopPropagation();break}else if(w==="delete-view"){et(t.protyle,[{action:"removeAttrViewView",avID:a,id:c.viewID,blockID:o}]),n.remove(),y.preventDefault(),y.stopPropagation();break}else if(w==="update-icon"){const B=S.getBoundingClientRect();Va("","av",{x:B.left,y:B.bottom+4,h:B.height,w:B.width},H=>{const j=f.querySelector(".b3-menu__item").getAttribute("data-col-id");if(et(t.protyle,[{action:"setAttrViewColIcon",id:j,avID:a,data:H}],[{action:"setAttrViewColIcon",id:j,avID:a,data:S.dataset.icon}]),S.innerHTML=H?Yt(H):`<svg style="height: 14px;width: 14px"><use xlink:href="#${za(S.dataset.colType)}"></use></svg>`,l){const re=t.blockElement.querySelector(`.av__row[data-col-id="${j}"] .block__logoicon`);re.outerHTML=H?Yt(H,"block__logoicon",!0):`<svg class="block__logoicon"><use xlink:href="#${za(re.nextElementSibling.getAttribute("data-type"))}"></use></svg>`}else us(t.blockElement.querySelector(`.av__row--header .av__cell[data-col-id="${j}"]`),void 0,{icon:H});S.dataset.icon=H},S.querySelector("img")),y.preventDefault(),y.stopPropagation();break}else if(w==="showAllCol"){const B=[],H=[];u.forEach(j=>{j.hidden&&(B.push({action:"setAttrViewColHidden",id:j.id,avID:a,data:!1,blockID:o}),H.push({action:"setAttrViewColHidden",id:j.id,avID:a,data:!0,blockID:o}),j.hidden=!1)}),B.length>0&&(et(t.protyle,B,H),f.innerHTML=rc(u),gn(f,h.right-f.clientWidth,h.bottom,h.height)),y.preventDefault(),y.stopPropagation();break}else if(w==="hideAllCol"){const B=[],H=[];u.forEach(j=>{!j.hidden&&j.type!=="block"&&(B.push({action:"setAttrViewColHidden",id:j.id,avID:a,data:!0,blockID:o}),H.push({action:"setAttrViewColHidden",id:j.id,avID:a,data:!1,blockID:o}),j.hidden=!0)}),B.length>0&&(et(t.protyle,B,H),f.innerHTML=rc(u),gn(f,h.right-f.clientWidth,h.bottom,h.height)),y.preventDefault(),y.stopPropagation();break}else if(w==="editCol"){f.innerHTML=go({protyle:t.protyle,data:c,colId:S.dataset.id,isCustomAttr:l}),mo({protyle:t.protyle,data:c,menuElement:f,isCustomAttr:l,blockID:o}),gn(f,h.right-f.clientWidth,h.bottom,h.height),y.preventDefault(),y.stopPropagation();break}else if(w==="updateColType"){const B=t.colId||f.querySelector(".b3-menu__item").getAttribute("data-col-id");if(S.dataset.newType!==S.dataset.oldType){const j=n.querySelector('.b3-text-field[data-type="name"]').value;let re=j;if(u.find(Te=>{if(Te.id===B)return Te.type=S.dataset.newType,Wo(S.dataset.oldType)===j&&(re=Wo(S.dataset.newType),Te.name=re),!0}),et(t.protyle,[{action:"updateAttrViewCol",id:B,avID:a,name:re,type:S.dataset.newType}],[{action:"updateAttrViewCol",id:B,avID:a,name:j,type:S.dataset.oldType}]),S.dataset.newType==="lineNumber"){if(c.view.sorts.find(Ie=>Ie.column===B)){const Ie=Object.assign([],c.view.sorts),Ce=c.view.sorts.filter(Je=>Je.column!==B);et(t.protyle,[{action:"setAttrViewSorts",avID:c.id,data:Ce,blockID:o}],[{action:"setAttrViewSorts",avID:c.id,data:Ie,blockID:o}])}if(c.view.filters.find(Ie=>Ie.column===B)){const Ie=JSON.parse(JSON.stringify(c.view.filters)),Ce=c.view.filters.filter(Je=>Je.column!==B);et(t.protyle,[{action:"setAttrViewFilters",avID:c.id,data:Ce,blockID:o}],[{action:"setAttrViewFilters",avID:c.id,data:Ie,blockID:o}])}}}f.innerHTML=go({protyle:t.protyle,data:c,colId:B,isCustomAttr:l}),mo({protyle:t.protyle,data:c,menuElement:f,isCustomAttr:l,blockID:o}),gn(f,h.right-f.clientWidth,h.bottom,h.height),y.preventDefault(),y.stopPropagation();break}else if(w==="goUpdateColType"){const B=N(S,"b3-menu");B&&(B.firstElementChild.classList.add("fn__none"),B.lastElementChild.classList.remove("fn__none")),gn(f,h.right-f.clientWidth,h.bottom,h.height),y.preventDefault(),y.stopPropagation();break}else if(w==="goSearchAV"){Ph(a,S,void 0,!1),y.preventDefault(),y.stopPropagation();break}else if(w==="goSearchRollupCol"){GS({target:S,data:c,isRelation:!0,protyle:t.protyle,colId:t.colId||f.querySelector(".b3-menu__item").getAttribute("data-col-id")}),y.preventDefault(),y.stopPropagation();break}else if(w==="goSearchRollupTarget"){GS({target:S,data:c,isRelation:!1,protyle:t.protyle,colId:t.colId||f.querySelector(".b3-menu__item").getAttribute("data-col-id")}),y.preventDefault(),y.stopPropagation();break}else if(w==="goSearchRollupCalc"){RS(t.protyle,S,{data:c,colId:t.colId||f.querySelector(".b3-menu__item").getAttribute("data-col-id"),blockID:o}),y.preventDefault(),y.stopPropagation();break}else if(w==="updateRelation"){U5({protyle:t.protyle,avElement:n,avID:a,colsData:u,blockElement:t.blockElement}),y.preventDefault(),y.stopPropagation();break}else if(w==="goEditCol"){const B=N(S,"b3-menu");B&&(B.firstElementChild.classList.remove("fn__none"),B.lastElementChild.classList.add("fn__none")),gn(f,h.right-f.clientWidth,h.bottom,h.height),y.preventDefault(),y.stopPropagation();break}else if(w==="hideCol"){const B=f.querySelector('[data-type="go-properties"]'),H=B?f.querySelector(".b3-menu__item").getAttribute("data-col-id"):S.parentElement.getAttribute("data-id");et(t.protyle,[{action:"setAttrViewColHidden",id:H,avID:a,data:!0,blockID:o}],[{action:"setAttrViewColHidden",id:H,avID:a,data:!1,blockID:o}]),u.find(j=>j.id===H).hidden=!0,B?(f.innerHTML=go({protyle:t.protyle,data:c,colId:H,isCustomAttr:l}),mo({protyle:t.protyle,data:c,menuElement:f,isCustomAttr:l,blockID:o})):f.innerHTML=rc(u),gn(f,h.right-f.clientWidth,h.bottom,h.height),y.preventDefault(),y.stopPropagation();break}else if(w==="showCol"){const B=f.querySelector('[data-type="go-properties"]'),H=B?f.querySelector(".b3-menu__item").getAttribute("data-col-id"):S.parentElement.getAttribute("data-id");et(t.protyle,[{action:"setAttrViewColHidden",id:H,avID:a,data:!1,blockID:o}],[{action:"setAttrViewColHidden",id:H,avID:a,data:!0,blockID:o}]),u.find(j=>j.id===H).hidden=!1,B?(f.innerHTML=go({protyle:t.protyle,data:c,colId:H,isCustomAttr:l}),mo({protyle:t.protyle,data:c,menuElement:f,isCustomAttr:l,blockID:o})):f.innerHTML=rc(u),gn(f,h.right-f.clientWidth,h.bottom,h.height),y.preventDefault(),y.stopPropagation();break}else if(w==="duplicateCol"){aA({blockElement:t.blockElement,protyle:t.protyle,colId:f.querySelector(".b3-menu__item").getAttribute("data-col-id"),data:c,viewID:c.viewID}),y.preventDefault(),y.stopPropagation();break}else if(w==="removeCol"){l||(h=t.blockElement.querySelector(".av__views").getBoundingClientRect());const B=f.querySelector(".b3-menu__item").getAttribute("data-col-id"),H=u.find(re=>{if(re.id===B)return!0}),j=H.type==="relation"&&((_=H.relation)==null?void 0:_.isTwoWay);if(l||j){const re=new fe({title:j?window.siyuan.languages.removeColConfirm:window.siyuan.languages.deleteOpConfirm,content:`<div class="b3-dialog__content">
    ${j?window.siyuan.languages.confirmRemoveRelationField.replace("${x}",f.querySelector("input").value||window.siyuan.languages._kernel[272]).replace("${y}",f.querySelector('.b3-menu__item[data-type="goSearchAV"] .b3-menu__accelerator').textContent).replace("${z}",f.querySelector('input[data-type="colName"]').value||window.siyuan.languages._kernel[272]):window.siyuan.languages.removeCol.replace("${x}",f.querySelector("input").value||window.siyuan.languages._kernel[272])}
    <div class="fn__hr--b"></div>
    <button class="fn__block b3-button b3-button--remove" data-action="delete">${j?window.siyuan.languages.removeBothRelationField:window.siyuan.languages.delete}</button>
    <div class="fn__hr"></div>
    <button class="fn__block b3-button b3-button--remove${j?"":" fn__none"}" data-action="keep-relation">${window.siyuan.languages.removeButKeepRelationField}</button>
    <div class="fn__hr"></div>
    <button class="fn__block b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button>
</div>`,width:"520px"});re.element.addEventListener("click",Te=>{let Be=Te.target;const Ie=typeof Te.detail=="string";for(;Be&&Be!==re.element||Ie;){const Ce=Be.getAttribute("data-action");if(Ce==="delete"||Ie&&Te.detail==="Enter"){px({protyle:t.protyle,fields:u,avID:a,blockID:o,menuElement:f,isCustomAttr:l,blockElement:t.blockElement,avPanelElement:n,tabRect:h,isTwoWay:!0}),re.destroy();break}else if(Ce==="keep-relation"){px({protyle:t.protyle,fields:u,avID:a,blockID:o,menuElement:f,isCustomAttr:l,blockElement:t.blockElement,avPanelElement:n,tabRect:h,isTwoWay:!1}),re.destroy();break}else if(Be.classList.contains("b3-button--cancel")||Ie&&Te.detail==="Escape"){re.destroy();break}Be=Be.parentElement}}),re.element.setAttribute("data-key",p.DIALOG_CONFIRM)}else px({protyle:t.protyle,fields:u,avID:a,blockID:o,menuElement:f,isCustomAttr:l,blockElement:t.blockElement,avPanelElement:n,tabRect:h,isTwoWay:!1});y.preventDefault(),y.stopPropagation();break}else if(w==="setColOption"){oF(t.protyle,c,S,t.blockElement,l,t.cellElements),y.preventDefault(),y.stopPropagation();break}else if(w==="setRelationCell"){(v=f.querySelector(".b3-menu__item--current"))==null||v.classList.remove("b3-menu__item--current"),S.classList.add("b3-menu__item--current"),N2(t.protyle,t.blockElement,S,t.cellElements),y.preventDefault(),y.stopPropagation();break}else if(w==="addColOptionOrCell"){(U=f.querySelector(".b3-menu__item--current"))==null||U.classList.remove("b3-menu__item--current"),S.classList.add("b3-menu__item--current"),S.querySelector(".b3-menu__checked")?l_(t.protyle,t.cellElements,f.querySelector(`.b3-chips .b3-chip[data-content="${ft(S.dataset.name)}"]`),t.blockElement):WS(t.protyle,c,t.cellElements,S,f,t.blockElement),window.siyuan.menus.menu.remove(),y.preventDefault(),y.stopPropagation();break}else if(w==="removeCellOption"){l_(t.protyle,t.cellElements,S.parentElement,t.blockElement),y.preventDefault(),y.stopPropagation();break}else if(w==="addAssetLink"){KM(t.protyle,t.cellElements,S,t.blockElement),y.preventDefault(),y.stopPropagation();break}else if(w==="addAssetExist"){const B=S.getBoundingClientRect();zv(t.protyle,{x:B.right,y:B.bottom,w:S.parentElement.clientWidth+8,h:B.height},(H,j)=>{let re;p.SIYUAN_ASSETS_IMAGE.includes(_n().extname(H).toLowerCase())?re={type:"image",content:H,name:""}:re={type:"file",content:H,name:j},Od({protyle:t.protyle,cellElements:t.cellElements,addValue:[re],blockElement:t.blockElement}),window.siyuan.menus.menu.remove()}),y.preventDefault(),y.stopPropagation();break}else if(w==="openAssetItem"){const B=S.parentElement.dataset.content,H=_n().extname(B);Mo(B)&&[".pdf"].concat(p.SIYUAN_ASSETS_AUDIO).concat(p.SIYUAN_ASSETS_VIDEO).includes(H)&&(H!==".pdf"||H===".pdf"&&!B.startsWith("file://"))?kc(t.protyle.app,B.trim(),parseInt(O("page",B)),"right"):p.SIYUAN_ASSETS_IMAGE.includes(H)?ex(B,a,t.blockElement.getAttribute(p.CUSTOM_SY_AV_VIEW),((ee=t.blockElement.querySelector('[data-type="av-search"]'))==null?void 0:ee.value.trim())||""):window.open(B),y.preventDefault(),y.stopPropagation();break}else if(w==="editAssetItem"){o_({protyle:t.protyle,cellElements:t.cellElements,blockElement:t.blockElement,content:S.parentElement.dataset.content,type:S.parentElement.dataset.type,name:S.parentElement.dataset.name,index:parseInt(S.parentElement.dataset.index),rect:S.parentElement.getBoundingClientRect()}),y.preventDefault(),y.stopPropagation();break}else if(w==="clearDate"){const B=u.find(H=>{if(H.id===$s(t.cellElements[0],c.viewType))return!0});fs(t.protyle,t.blockElement,{isNotEmpty2:!1,isNotEmpty:!1,content:null,content2:null,hasEndDate:!1,isNotTime:B.date?!B.date.fillSpecificTime:!0},t.cellElements),n.remove(),y.preventDefault(),y.stopPropagation();break}else if(w==="av-add"){window.siyuan.menus.menu.remove(),T2(t.protyle,t.blockElement),n.remove(),y.preventDefault(),y.stopPropagation();break}else if(w==="av-view-switch"){S.parentElement.classList.contains("b3-menu__item--current")||((Z=n.querySelector(".b3-menu__item--current"))==null||Z.classList.remove("b3-menu__item--current"),S.parentElement.classList.add("b3-menu__item--current"),et(t.protyle,[{action:"setAttrViewBlockView",blockID:o,id:S.parentElement.dataset.id,avID:a}],[{action:"setAttrViewBlockView",blockID:o,id:t.blockElement.querySelector(".av__views .item--focus").getAttribute("data-id"),avID:a}])),y.preventDefault(),y.stopPropagation();break}else if(w==="av-view-edit"){S.parentElement.classList.contains("b3-menu__item--current")?Fh({protyle:t.protyle,blockElement:t.blockElement,element:S.parentElement}):((k=n.querySelector(".b3-menu__item--current"))==null||k.classList.remove("b3-menu__item--current"),S.parentElement.classList.add("b3-menu__item--current"),et(t.protyle,[{action:"setAttrViewBlockView",blockID:o,id:S.parentElement.dataset.id,avID:a}],[{action:"setAttrViewBlockView",blockID:o,id:t.blockElement.querySelector(".av__views .item--focus").getAttribute("data-id"),avID:a}]),window.siyuan.menus.menu.remove(),Fh({protyle:t.protyle,blockElement:t.blockElement,element:S.parentElement})),y.preventDefault(),y.stopPropagation();break}else if(w==="set-gallery-cover"){tF({target:S,protyle:t.protyle,nodeElement:t.blockElement,view:c.view}),y.preventDefault(),y.stopPropagation();break}else if(w==="set-gallery-size"){nF({target:S,protyle:t.protyle,nodeElement:t.blockElement,view:c.view}),y.preventDefault(),y.stopPropagation();break}else if(w==="set-gallery-ratio"){aF({target:S,protyle:t.protyle,nodeElement:t.blockElement,view:c.view}),y.preventDefault(),y.stopPropagation();break}else if(w==="set-layout"){c=yield hF({target:S,protyle:t.protyle,nodeElement:t.blockElement,data:c}),u=ma(c),y.preventDefault(),y.stopPropagation();break}else if(w==="goGroupsDate"){yF({target:S,menuElement:f,protyle:t.protyle,blockElement:t.blockElement,data:c}),u=ma(c),y.stopPropagation(),y.preventDefault();break}else if(w==="goGroupsSort"){_F({target:S,menuElement:f,protyle:t.protyle,blockElement:t.blockElement,data:c}),u=ma(c),y.stopPropagation(),y.preventDefault();break}else if(w==="setGroupMethod"){gF({protyle:t.protyle,fieldId:S.getAttribute("data-id"),data:c,menuElement:f,blockElement:t.blockElement}),y.preventDefault(),y.stopPropagation();break}else if(w==="goGroups"){f.querySelector('[data-type="avGroupRange"]')&&g&&(yield g()),g=void 0,c.view.group&&c.view.group.field||S.classList.contains("block__icon")?(f.innerHTML=Nf(u,c.view),Gh({protyle:t.protyle,menuElement:f,blockElement:t.blockElement,data:c})):f.innerHTML=JS(u,c.view.group,c.viewType),gn(f,h.right-f.clientWidth,h.bottom,h.height),y.preventDefault(),y.stopPropagation();break}else if(w==="goGroupsMethod"){window.siyuan.menus.menu.remove(),f.innerHTML=JS(u,c.view.group,c.viewType),gn(f,h.right-f.clientWidth,h.bottom,h.height),y.preventDefault(),y.stopPropagation();break}else if(w==="getGroupsNumber"){window.siyuan.menus.menu.remove(),f.innerHTML=mF(c.view.group),gn(f,h.right-f.clientWidth,h.bottom,h.height),g=bF({protyle:t.protyle,data:c,menuElement:f,blockElement:t.blockElement}),y.preventDefault(),y.stopPropagation();break}else if(w==="hideGroup"){window.siyuan.menus.menu.remove();const B=S.firstElementChild,H=B.getAttribute("xlink:href")!=="#iconEye";B.setAttribute("xlink:href",H?"#iconEye":"#iconEyeoff");let j,re=0;c.view.groups.forEach(Te=>{Te.id===S.dataset.id&&(j=Te.groupHidden,Te.groupHidden=H?0:2),Te.groupHidden===0&&re++}),S.parentElement.classList[H?"remove":"add"]("b3-menu__item--hidden"),f.querySelector('[data-type="hideGroups"]').innerHTML=`${window.siyuan.languages[re===0?"showAll":"hideAll"]}
<span class="fn__space"></span>
<svg><use xlink:href="#iconEye${re===0?"":"off"}"></use></svg>`,et(t.protyle,[{action:"hideAttrViewGroup",avID:c.id,blockID:o,id:S.dataset.id,data:H?0:2}],[{action:"hideAttrViewGroup",avID:c.id,blockID:o,id:S.dataset.id,data:j}]),y.preventDefault(),y.stopPropagation();break}else if(w==="hideGroups"){window.siyuan.menus.menu.remove();const B=S.querySelector("use").getAttribute("xlink:href")==="#iconEyeoff";S.innerHTML=`${window.siyuan.languages[B?"showAll":"hideAll"]}
<span class="fn__space"></span>
<svg><use xlink:href="#iconEye${B?"":"off"}"></use></svg>`,c.view.groups.forEach(H=>{var j;H.groupHidden=B?2:0;const re=S.parentElement.parentElement.querySelector(`.b3-menu__item[data-id="${H.id}"]`);re.classList[B?"add":"remove"]("b3-menu__item--hidden"),(j=re.querySelector(".b3-menu__action use"))==null||j.setAttribute("xlink:href",`#iconEye${B?"off":""}`)}),et(t.protyle,[{action:"hideAttrViewAllGroups",avID:c.id,blockID:o,data:B}],[{action:"hideAttrViewAllGroups",avID:c.id,blockID:o,data:!B}]),y.preventDefault(),y.stopPropagation();break}else if(w==="removeGroups"){window.siyuan.menus.menu.remove(),et(t.protyle,[{action:"removeAttrViewGroup",avID:c.id,blockID:o}],[{action:"setAttrViewGroup",avID:c.id,blockID:o,data:c.view.group}]),c.view.group=null,delete c.view.groups,f.innerHTML=Nf(u,c.view),gn(f,h.right-f.clientWidth,h.bottom,h.height),y.preventDefault(),y.stopPropagation();break}if(!S||!S.parentElement)break;S=S.parentElement}}))})},rc=t=>{let e="",n="";return t.forEach(a=>{a.hidden?n+=`<button class="b3-menu__item" data-type="editCol" draggable="true" data-id="${a.id}">
    <svg class="b3-menu__icon fn__grab"><use xlink:href="#iconDrag"></use></svg>
    <div class="b3-menu__label fn__flex">
        ${a.icon?Yt(a.icon,"b3-menu__icon",!0):`<svg class="b3-menu__icon"><use xlink:href="#${za(a.type)}"></use></svg>`}
        ${he(a.name)||"&nbsp;"}
    </div>
    <svg class="b3-menu__action" data-type="showCol"><use xlink:href="#iconEye"></use></svg>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>`:e+=`<button class="b3-menu__item" data-type="editCol" draggable="true" data-id="${a.id}">
    <svg class="b3-menu__icon fn__grab"><use xlink:href="#iconDrag"></use></svg>
    <div class="b3-menu__label fn__flex">
        ${a.icon?Yt(a.icon,"b3-menu__icon",!0):`<svg class="b3-menu__icon"><use xlink:href="#${za(a.type)}"></use></svg>`}
        ${he(a.name)||"&nbsp;"}
    </div>
    <svg class="b3-menu__action${a.type==="block"?" fn__none":""}" data-type="hideCol"><use xlink:href="#iconEyeoff"></use></svg>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>`}),n&&(n=`<button class="b3-menu__separator"></button>
<button class="b3-menu__item" data-type="nobg">
    <span class="b3-menu__label">
        ${window.siyuan.languages.hideCol} 
    </span>
    <span class="block__icon" data-type="showAllCol">
        ${window.siyuan.languages.showAll}
        <span class="fn__space"></span>
        <svg><use xlink:href="#iconEye"></use></svg>
    </span>
</button>
${n}`),`<div class="b3-menu__items">
<button class="b3-menu__item" data-type="nobg">
    <span class="block__icon" style="padding: 8px;margin-left: -4px;" data-type="go-config">
        <svg><use xlink:href="#iconLeft"></use></svg>
    </span>
    <span class="b3-menu__label ft__center">${window.siyuan.languages.fields}</span>
</button>
<button class="b3-menu__separator"></button>
<button class="b3-menu__item" data-type="nobg">
    <span class="b3-menu__label">
        ${window.siyuan.languages.showCol} 
    </span>
    <span class="block__icon" data-type="hideAllCol">
        ${window.siyuan.languages.hideAll}
        <span class="fn__space"></span>
        <svg><use xlink:href="#iconEyeoff"></use></svg>
    </span>
</button>
${e}
${n}
<button class="b3-menu__separator"></button>
<button class="b3-menu__item" data-type="newCol">
    <svg class="b3-menu__icon"><use xlink:href="#iconAdd"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.new}</span>
</button>
</div>`};var vF=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const QS=t=>{let e=t,n="";try{const a=new URL(t);a.protocol.startsWith("http")&&(e=a.host,n=a.href.replace(a.origin,""),n.length>12&&(n=n.substring(0,4)+"..."+n.substring(n.length-6)))}catch(a){e=Lute.EscapeHTMLStr(t)}return`<span class="av__celltext av__celltext--url" data-type="url" data-href="${ft(t)}"><span>${e}</span><span class="ft__on-surface">${n}</span></span>`},Rd=t=>{if(!t)return"";let e="";const n=t.querySelectorAll(".b3-chip, .av__celltext--ref, .av__celltext");return n.length>0?(n.forEach(a=>{a.querySelector(".av__cellicon")?e+=`${a.firstChild.textContent} \u2192 ${a.lastChild.textContent}, `:a.getAttribute("data-type")==="url"?e=a.getAttribute("data-href")+", ":a.getAttribute("data-type")!=="block-more"&&(e+=a.textContent+", ")}),e=e.substring(0,e.length-2)):e=t.textContent,e},qo=(t,e)=>{var n;const a={type:t,id:e.dataset.id};if(t==="number"){const i=e.querySelector(".av__celltext").getAttribute("data-content");a.number={content:parseFloat(i)||0,isNotEmpty:!!i}}else if(["text","block","url","phone","email","template"].includes(t)){const i=e.querySelector(".av__celltext");if(a[t]={content:t==="url"?i.dataset.href:i.textContent},t==="block"&&i.dataset.id&&(a.block.id=i.dataset.id,(n=i.previousElementSibling)!=null&&n.classList.contains("b3-menu__avemoji"))){const s=i.previousElementSibling.getAttribute("data-unicode");s&&(a.block.icon=s)}}else if(t==="mSelect"||t==="select"){const i=[];e.querySelectorAll(".b3-chip").forEach(s=>{i.push({content:s.textContent.trim(),color:s.style.color.replace("var(--b3-font-color","").replace(")","")})}),a.mSelect=i}else if(["date","created","updated"].includes(t))a[t]=JSON.parse(e.querySelector(".av__celltext").getAttribute("data-value"));else if(t==="checkbox")a.checkbox={checked:e.querySelector("use").getAttribute("xlink:href")==="#iconCheck"};else if(t==="relation"){const i=[],s=[];Array.from(e.querySelectorAll(".av__cell--relation")).forEach(r=>{const o=r.querySelector(".av__celltext");i.push(r.dataset.rowId),s.push({isDetached:!o.classList.contains("av__celltext--ref"),block:{content:o.textContent,id:o.dataset.id},type:"block"})}),a.relation={blockIDs:i,contents:s}}else if(t==="mAsset"){const i=[];Array.from(e.children).forEach(s=>{if(!s.classList.contains("av__celltext--url")&&!s.classList.contains("av__cellassetimg"))return;const r=s.classList.contains("av__cellassetimg");i.push({type:r?"image":"file",content:r?tx(s.getAttribute("src")):s.getAttribute("data-url"),name:r?"":s.getAttribute("data-name")})}),a.mAsset=i}return t==="block"&&(a.isDetached=e.dataset.detached==="true"),a},Bf=t=>{if(["number","text","block","url","phone","email","template","mAsset"].includes(t.type))return t[t.type].content;if(["mSelect","select"].includes(t.type))return t.mSelect[0].content;if(t.type==="rollup")return Bf(t.relation.contents[0]);if(t.type==="checkbox")return t.checkbox.checked?"true":"false";if(t.type==="relation")return Bf(t.relation.contents[0]);if(["date","created","updated"].includes(t.type))return at(t[t.type].content).format("YYYY-MM-DD HH:mm");if(t.type==="lineNumber")return""},xF=(t,e)=>{if(t===e.type)return e;const n={type:t};if(t==="number")["date","created","updated"].includes(t)?n.number={content:e[e.type].content,isNotEmpty:e[e.type].isNotEmpty}:n.number={content:parseFloat(Bf(e))||0,isNotEmpty:!0};else if(["text","block","url","phone","email","template"].includes(t))n[t]={content:Bf(e).toString()};else if(t==="mSelect"||t==="select")n.mSelect=[{content:Bf(e).toString(),color:"1"}],n.mSelect[0].content||(n.mSelect=[]);else if(t==="rollup")n.rollup={contents:[e]};else if(t==="checkbox")n.checkbox={checked:!0};else if(t==="relation")e.type==="block"?n.relation={blockIDs:[e.blockID],contents:[e]}:n.relation={blockIDs:[],contents:[]};else if(t==="mAsset"){const a=Bf(e).toString();n.mAsset=[{type:p.SIYUAN_ASSETS_IMAGE.includes(_n().extname(a).toLowerCase())?"image":"file",content:a,name:""}]}else if(["date","created","updated"].includes(t))["date","created","updated"].includes(e.type)?n[t]=JSON.parse(JSON.stringify(e[e.type])):n[t]={content:null,isNotEmpty:!1,content2:null,isNotEmpty2:!1,hasEndDate:!1,isNotTime:!0};else if(t==="lineNumber")return{type:"lineNumber"};return n},po=(t,e)=>{let n={type:t,[t==="select"?"mSelect":t]:e};if(typeof e=="string"&&e){if(t==="number")n={type:t,number:{content:parseFloat(e)||0,isNotEmpty:!0}};else if(["text","block","url","phone","email","template"].includes(t))n={type:t,[t]:{content:e}};else if(t==="mSelect"||t==="select")n={type:t,mSelect:[{content:e,color:"1"}]};else if(t==="checkbox")n={type:t,checkbox:{checked:!0}};else if(t==="date"){let a=e.split("\u2192");a.length!==2&&(a=e.split("-"),a.length!==2&&(a=e.split("~")));const i=at(a[0]),s=at(a[1]||"");isNaN(i.valueOf())?n={type:t,date:{content:null,isNotEmpty:!1,content2:null,isNotEmpty2:!1,formattedContent:"",hasEndDate:!1,isNotTime:!0}}:n={type:t,date:{content:i.valueOf(),isNotEmpty:!0,content2:s.valueOf()||0,isNotEmpty2:!isNaN(s.valueOf()),hasEndDate:!isNaN(s.valueOf()),isNotTime:i.hour()===0&&a[0].split(":").length===1,formattedContent:""}}}else if(t==="relation")n={type:t,relation:{blockIDs:[e],contents:[]}};else if(t==="mAsset"){const a=_n().extname(e).toLowerCase();n={type:t,mAsset:[{type:p.SIYUAN_ASSETS_IMAGE.includes(a)?"image":"file",content:e,name:""}]}}}else(typeof e=="undefined"||!e)&&(t==="number"?n={type:t,number:{content:0,isNotEmpty:!1}}:["text","block","url","phone","email","template"].includes(t)?n={type:t,[t]:{content:""}}:t==="mSelect"||t==="select"||t==="mAsset"?n={type:t,[t==="select"?"mSelect":t]:[]}:["date","created","updated"].includes(t)?n={type:t,[t]:{content:null,isNotEmpty:!1,content2:null,isNotEmpty2:!1,hasEndDate:!1,isNotTime:!0}}:t==="checkbox"?n={type:t,checkbox:{checked:!1}}:t==="relation"?n={type:t,relation:{blockIDs:[],contents:[]}}:t==="rollup"&&(n={type:t,rollup:{contents:[]}}));return t==="block"&&(typeof e=="object"&&e&&e.id?n.isDetached=!1:n.isDetached=!0),n},vl=(t,e,n=!0)=>{const a=e.getBoundingClientRect();if(!n){const r=t.querySelector(".av__scroll"),o=N(e,"av__row");if(r&&o){const l=o.querySelector(".av__colsticky");if(!l.contains(e)){const c=l.getBoundingClientRect().right,d=r.getBoundingClientRect();c>a.left||d.right<a.left?r.scrollLeft=r.scrollLeft+a.left-c:c<a.left&&d.right<a.right&&(a.width+c>d.right?r.scrollLeft=r.scrollLeft+a.left-c:r.scrollLeft=r.scrollLeft+a.right-d.right)}}}if(!t.querySelector(".av__header"))return;const i=N(e,"av__body");if(!i)return;const s=i.querySelector(".av__row--header").getBoundingClientRect();if(s.bottom>a.top){const r=N(t,"protyle-content",!0);r&&(r.scrollTop=r.scrollTop+a.top-s.bottom)}else{const r=i.querySelector(".av__row--footer");if(r!=null&&r.querySelector(".av__calc--ashow")){const o=r.getBoundingClientRect();if(o.top<a.bottom){const l=N(t,"protyle-content",!0);l&&(l.scrollTop=l.scrollTop+a.bottom-o.top)}}else{const o=N(t,"protyle-content",!0);if(o){const l=o.getBoundingClientRect();a.bottom>l.bottom&&(o.scrollTop=o.scrollTop+(a.bottom-l.bottom))}}}},Ns=t=>{if(t.parentElement.classList.contains("av__gallery-field"))return t.getAttribute("data-dtype");const e=N(t,"av__scroll");if(e)return e.querySelector(".av__row--header").querySelector(`[data-col-id="${t.getAttribute("data-col-id")}"]`).getAttribute("data-dtype")},Bs=(t,e,n)=>{var a;if(e.length===0||e.length===1&&!e[0]||(n||(n=Ns(e[0])),n==="updated"||n==="created"||document.querySelector(".av__mask")))return;const i=oe(e[0]);if(!i)return;const s=i.getAttribute("data-av-type");let r=e[0].getBoundingClientRect();const o=N(i,"protyle-content",!0);s==="table"&&vl(i,e[0],!1),r=e[0].getBoundingClientRect();let l="",c=r.height;const d=getComputedStyle(e[0]);let u=`font-family:${d.fontFamily};font-size:${d.fontSize};line-height:${d.lineHeight};padding:${d.padding};position:absolute;top: ${r.top}px;`;if(o){const m=o.getBoundingClientRect();r.bottom>m.bottom&&(c=m.bottom-r.top);const b=Math.min(Math.max(r.width,25),m.width);u=`style='height: ${c}px;width:${b}px;left: ${r.left<m.left||r.left+b>m.right?m.left:r.left}px;${u}'`}else u=`style='height: ${c}px;width:${Math.max(r.width,25)}px;left: ${r.left}px;${u}'`;if(["text","email","phone","block","template"].includes(n))l=`<textarea ${u} spellcheck="false" class="b3-text-field"></textarea>`;else if(n==="url")l=`<textarea ${u} spellcheck="false" class="b3-text-field">${e[0].firstElementChild.getAttribute("data-href")}</textarea>`;else if(n==="number")l=`<input type="number" spellcheck="false" value="${e[0].firstElementChild.getAttribute("data-content")}" ${u} class="b3-text-field">`;else{if(["select","mSelect"].includes(n)){if(i.getAttribute("data-rendering")==="true")return;Vi({protyle:t,blockElement:i,type:"select",cellElements:e})}else n==="mAsset"?(Vi({protyle:t,blockElement:i,type:"asset",cellElements:e}),qt(i)):n==="date"?Vi({protyle:t,blockElement:i,type:"date",cellElements:e}):n==="checkbox"?cx(t,n,i,e):n==="relation"?Vi({protyle:t,blockElement:i,type:"relation",cellElements:e}):n==="rollup"&&Vi({protyle:t,blockElement:i,type:"rollup",cellElements:e,colId:$s(e[0],s)});s==="table"&&!N(e[0],"custom-attr")&&(e[0].classList.add("av__cell--select"),Js(e[0]));return}window.siyuan.menus.menu.remove(),document.body.insertAdjacentHTML("beforeend",`<div class="av__mask" style="z-index: ${++window.siyuan.zIndex}">
    ${l}
</div>`);const g=document.querySelector(".av__mask"),f=g.querySelector(".b3-text-field");f&&(["text","email","phone","block","template"].includes(n)&&(f.value=((a=e[0].querySelector(".av__celltext"))==null?void 0:a.textContent)||""),f.select(),f.focus(),n==="template"&&ae("/api/av/renderAttributeView",{id:i.dataset.avId,viewID:i.getAttribute(p.CUSTOM_SY_AV_VIEW)},m=>{ma(m.data).find(b=>{if(b.id===$s(e[0],s))return f.value=b.template,f.dataset.template=b.template,!0})}),n==="block"&&f.addEventListener("input",m=>{if(p.BLOCK_HINT_KEYS.includes(f.value.substring(0,2))){if(t.toolbar.range=document.createRange(),e[0]&&!i.contains(e[0])){const y=Pr(e[0],s);s==="table"?e[0]=i.querySelector(`.av__row[data-id="${y}"] .av__cell[data-col-id="${e[0].dataset.colId}"]`):e[0]=i.querySelector(`.av__gallery-item[data-id="${y}"] .av__cell[data-field-id="${e[0].dataset.fieldId}"]`)}t.toolbar.range.selectNodeContents(e[0].lastChild),Pt(t.toolbar.range),s==="table"&&(e[0].classList.add("av__cell--select"),Js(e[0]));let b=f.value;D(b)?b=b.substring(2,24):b=b.substring(2),ic(b,t,"av"),g==null||g.remove(),m.preventDefault(),m.stopPropagation()}}),f.addEventListener("keydown",m=>{m.isComposing||uo(m)||(m.key==="Escape"||m.key==="Tab"||m.key==="Enter"&&!m.shiftKey&&ct(m))&&(cx(t,n,i,e),m.key==="Tab"&&t.wysiwyg.element.dispatchEvent(new KeyboardEvent("keydown",{shiftKey:m.shiftKey,ctrlKey:m.ctrlKey,altKey:m.altKey,metaKey:m.metaKey,key:"Tab",keyCode:9})),m.preventDefault(),m.stopPropagation())}));const h=m=>{m.target.classList.contains("av__mask")&&document.activeElement.tagName!=="TEXTAREA"&&document.activeElement.tagName!=="INPUT"&&(cx(t,n,i,e),g==null||g.remove())};g.addEventListener("click",m=>{h(m)}),g.addEventListener("contextmenu",m=>{h(m)}),g.addEventListener("mousedown",m=>{m.button===1&&(m.target.classList.contains("av__mask")&&document.activeElement&&document.activeElement.nodeType===1&&document.activeElement.blur(),h(m))})},cx=(t,e,n,a)=>{const i=n.getAttribute("data-av-type");if(i==="table"){const o=N(a[0],"av__row");if(!o||a.length===1&&a[0].dataset.detached==="true"&&!o.dataset.id)return}const s=document.querySelector(".av__mask"),r=n.getAttribute("data-av-id");if(e==="template"){const o=$s(a[0],i),l=s.querySelector(".b3-text-field");l.value!==l.dataset.template&&!n.getAttribute("data-loading")&&(et(t,[{action:"updateAttrViewColTemplate",id:o,avID:r,data:l.value,type:"template"}],[{action:"updateAttrViewColTemplate",id:o,avID:r,data:l.dataset.template,type:"template"}]),n.setAttribute("data-loading","true"))}else fs(t,n,e==="checkbox"?{checked:a[0].querySelector("use").getAttribute("xlink:href")==="#iconUncheck"}:s.querySelector(".b3-text-field").value,a);i==="table"&&a[0]&&!N(a[0],"custom-attr")&&(a[0].classList.add("av__cell--select"),Js(a[0])),document.querySelector(".b3-dialog")||qt(n),document.querySelectorAll(".av__mask").forEach(o=>{o.remove()})},fs=(t,e,n,a,i,s,r=!1)=>vF(void 0,null,function*(){const o=[],l=[],c=e.dataset.avId,d=e.dataset.nodeId;let u="";const g=[];let f;(a==null?void 0:a.length)>0?f=a:(f=Array.from(e.querySelectorAll(".av__cell--active, .av__cell--select")),f.length===0&&e.querySelectorAll(".av__row--select:not(.av__row--header)").forEach(b=>{b.querySelectorAll(".av__cell").forEach(y=>{f.push(y)})}));const h=N(f[0],"custom-attr"),m=e.getAttribute("data-av-type");for(let b=0;b<f.length;b++){let y=f[b];const _=Pr(y,m);if(!_||(e.contains(y)||(m==="table"?y=f[b]=e.querySelector(`.av__row[data-id="${_}"] .av__cell[data-col-id="${y.dataset.colId}"]`)||e.querySelector(`.fn__flex-1[data-col-id="${y.dataset.colId}"]`):y=f[b]=e.querySelector(`.av__gallery-item[data-id="${_}"] .av__cell[data-field-id="${y.dataset.fieldId}"]`)),!y))break;const v=Ns(y)||y.dataset.type;if(["created","updated","template","rollup"].includes(v))break;const U=y.dataset.id,ee=$s(y,m);u+=Rd(y)+(f[b+1]&&y.nextElementSibling&&y.nextElementSibling===f[b+1]?"	":`

`);const Z=qo(v,y);(b===0||f[b-1]!==y.previousElementSibling)&&g.push([]),g[g.length-1].push(Z);let k=n;if(v==="mAsset"){if(Array.isArray(n))k=Z.mAsset.concat(n);else if(typeof n!="undefined"&&typeof n!="object"){let S=t.lute.GetLinkDest(n),B="",H="";if(!S&&n.startsWith("assets/")&&(S=n,B=pd(n)+_n().extname(n)),s){const j=document.createElement("template");j.innerHTML=s;const re=j.content.querySelector('[data-type~="a"]');if(re)S=re.getAttribute("data-href"),B=re.textContent;else{const Te=j.content.querySelector(".img img");Te&&(H=Te.getAttribute("data-src"))}}if(S||(B=n),!S&&!B&&!H)break;H?k=Z.mAsset.concat({type:"image",content:H,name:""}):k=Z.mAsset.concat({type:"file",content:S,name:B})}}else if(v==="mSelect"||v==="select"){if(typeof n=="string"){const S=[];let B=Z.mSelect.length;[...new Set(n.split(",").map(H=>H.trim().replace(/\n|\r\n|\r|\u2028|\u2029/g,"")))].forEach(H=>{if(!H)return;let j=!1;Z.mSelect.find(re=>{if(re.content===H)return j=!0,!0}),!j&&(B++,S.push({content:H,color:B.toString()}))}),k=Z.mSelect.concat(S)}}else v==="block"&&typeof n=="string"&&Z.block.id&&(k={content:n,id:Z.block.id},Z.block.icon&&(k.icon=Z.block.icon));let w;if(typeof k=="object"&&k.type?w=xF(v,k):w=po(v,k),w.id=U,w.type==="date"&&typeof w.date=="string"||w.type==="relation"&&typeof w.relation=="string")break;if(i&&(v==="select"||v==="mSelect")){const S=lF(i.find(B=>B.id===ee),w,c);o.push(...S.doOperations),l.push(...S.undoOperations)}if(v==="date"){if(!(n&&typeof n=="object"&&typeof n.isNotTime=="boolean")){const S=yield wn("/api/av/getAttributeViewKeysByID",{avID:c,keyIDs:[ee]});S.data[0].date&&(w.date.isNotTime=!S.data[0].date.fillSpecificTime)}w.date.formattedContent=Z.date.formattedContent}if(G(w,Z))break;o.push({action:"updateAttrViewCell",id:U,avID:c,keyID:ee,rowID:_,data:w}),l.push({action:"updateAttrViewCell",id:U,avID:c,keyID:ee,rowID:_,data:Z}),h?y.innerHTML=wl(w):us(y,w)}return r?{doOperations:o,undoOperations:l}:(o.length>0&&(o.push({action:"doUpdateUpdated",id:d,data:at().format("YYYYMMDDHHmmss")}),l.push({action:"doUpdateUpdated",id:d,data:e.getAttribute("updated")}),et(t,o,l)),{text:u.substring(0,u.length-2),json:g})}),u_=(t,e)=>{e.type==="checkbox"?e.checkbox.checked?(t.classList.add("av__cell-check"),t.classList.remove("av__cell-uncheck")):(t.classList.remove("av__cell-check"),t.classList.add("av__cell-uncheck")):e.type==="block"&&(e.isDetached?t.setAttribute("data-detached","true"):(t.querySelector(".av__celltext").setAttribute("data-id",e.block.id),t.removeAttribute("data-detached")))},ho=(t,e=0,n=!0,a="table")=>{var i,s,r,o,l,c,d,u,g,f,h,m,b;let y="";if(t.type==="template")y=`<span class="av__celltext">${t&&t.template.content||""}</span>`;else if(t.type==="text")y=`<span class="av__celltext">${t?Lute.EscapeHTMLStr(t.text.content||""):""}</span>`;else if(["email","phone"].includes(t.type))y=`<span class="av__celltext av__celltext--url" data-type="${t.type}">${t?Lute.EscapeHTMLStr(t[t.type].content||""):""}</span>`;else if(t.type==="url")y=QS(((i=t==null?void 0:t.url)==null?void 0:i.content)||"");else if(t.type==="block")t!=null&&t.isDetached?y=`<span class="av__celltext">${Lute.EscapeHTMLStr(t.block.content||"")}</span><span class="b3-chip b3-chip--info b3-chip--small" data-type="block-more">${window.siyuan.languages.more}</span>`:y=`<span class="b3-menu__avemoji${n?"":" fn__none"}" data-unicode="${t.block.icon||""}">${Yt(t.block.icon||window.siyuan.storage[p.LOCAL_IMAGES].file)}</span><span data-type="block-ref" data-id="${t.block.id}" data-subtype="s" class="av__celltext av__celltext--ref">${Lute.EscapeHTMLStr(t.block.content)}</span><span class="b3-chip b3-chip--info b3-chip--small" data-type="block-more">${window.siyuan.languages.update}</span>`;else if(t.type==="number")y=`<span class="av__celltext" data-content="${t!=null&&t.number.isNotEmpty?t==null?void 0:t.number.content:""}">${(t==null?void 0:t.number.formattedContent)||(t==null?void 0:t.number.content)||""}</span>`;else if(t.type==="mSelect"||t.type==="select")(s=t==null?void 0:t.mSelect)==null||s.forEach((_,v)=>{t.type==="select"&&v>0||(y+=`<span class="b3-chip" style="background-color:var(--b3-font-background${_.color});color:var(--b3-font-color${_.color})">${he(_.content)}</span>`)});else if(t.type==="date"){const _=t?t.date:null;y=`<span class="av__celltext" data-value='${JSON.stringify(_)}'>`,_&&_.isNotEmpty&&(y+=at(_.content).format(_.isNotTime?"YYYY-MM-DD":"YYYY-MM-DD HH:mm")),_&&_.hasEndDate&&_.isNotEmpty&&_.isNotEmpty2&&(y+=`<svg class="av__cellicon"><use xlink:href="#iconForward"></use></svg>${at(_.content2).format(_.isNotTime?"YYYY-MM-DD":"YYYY-MM-DD HH:mm")}`),y+="</span>"}else if(["created","updated"].includes(t.type)){const _=t?t[t.type]:null;y=`<span class="av__celltext" data-value='${JSON.stringify(_)}'>`,_&&_.isNotEmpty&&(y+=_.formattedContent),y+="</span>"}else if(["lineNumber"].includes(t.type))y=`<span class="av__celltext" data-value='${e+1}'>${e+1}</span>`;else if(t.type==="mAsset")(r=t==null?void 0:t.mAsset)==null||r.forEach(_=>{_.type==="image"?y+=`<img loading="lazy" class="av__cellassetimg ariaLabel" aria-label="${_.content}" src="${qh(_.content)}">`:y+=`<span class="b3-chip av__celltext--url ariaLabel" aria-label="${ft(_.content)}" data-name="${ft(_.name)}" data-url="${ft(_.content)}">${_.name||_.content}</span>`});else if(t.type==="checkbox")y+=`<div class="fn__flex"><svg class="av__checkbox"><use xlink:href="#icon${(o=t==null?void 0:t.checkbox)!=null&&o.checked?"Check":"Uncheck"}"></use></svg>`,["gallery","kanban"].includes(a)&&((l=t==null?void 0:t.checkbox)!=null&&l.content)&&(y+=`<span class="fn__space"></span>${(c=t==null?void 0:t.checkbox)==null?void 0:c.content}`),y+="</div>";else if(t.type==="rollup"){let _;(u=(d=t==null?void 0:t.rollup)==null?void 0:d.contents)==null||u.forEach(v=>{const U=["template","select","mSelect","mAsset","relation"].includes(v.type)?ho(v,e,n,a):EF(v,n);U&&(y+=U+(v.type==="checkbox"?"":", ")),_=v.type}),y&&(_==="checkbox"?y=`<div class="fn__flex">${y}</div>`:y.endsWith(", ")&&(y=y.substring(0,y.length-2)))}else t.type==="relation"&&((f=(g=t==null?void 0:t.relation)==null?void 0:g.contents)==null||f.forEach((_,v)=>{if(_&&_.block){const U=t.relation.blockIDs[v];_!=null&&_.isDetached?y+=`<span data-row-id="${U}" class="av__cell--relation"><span class="${n?"":" fn__none"}">\u2796<span class="fn__space--5"></span></span><span class="av__celltext">${Lute.EscapeHTMLStr(_.block.content||window.siyuan.languages.untitled)}</span></span>`:y+=`<span data-row-id="${U}" class="av__cell--relation" data-block-id="${_.block.id}"><span class="b3-menu__avemoji${n?"":" fn__none"}" data-unicode="${_.block.icon||""}">${Yt(_.block.icon||window.siyuan.storage[p.LOCAL_IMAGES].file)}</span><span data-type="block-ref" data-id="${_.block.id}" data-subtype="s" class="av__celltext av__celltext--ref">${Lute.EscapeHTMLStr(_.block.content||window.siyuan.languages.untitled)}</span></span>`}}),y&&y.endsWith(", ")&&(y=y.substring(0,y.length-2)));return(["text","template","url","email","phone","date","created","updated"].includes(t.type)&&((h=t[t.type])!=null&&h.content)||t.type==="lineNumber"||t.type==="number"&&((m=t.number)!=null&&m.isNotEmpty)||t.type==="block"&&((b=t.block)!=null&&b.content))&&(y+=`<span ${t.type!=="number"?"":'style="right:auto;left:5px"'} data-type="copy" class="block__icon"><svg><use xlink:href="#iconCopy"></use></svg></span>`),y},EF=(t,e)=>{var n,a,i,s,r;let o="";if(["text"].includes(t.type))o=t&&t[t.type].content||"";else if(["email","phone"].includes(t.type)){const l=t?t[t.type].content:"";l&&(o=`<span class="av__celltext av__celltext--url" data-type="${t.type}">${l}</span>`)}else if(t.type==="url"){const l=((n=t==null?void 0:t.url)==null?void 0:n.content)||"";l&&(o=QS(l))}else if(t.type==="block")t!=null&&t.isDetached?o=`<span class="av__celltext">${Lute.EscapeHTMLStr(((a=t.block)==null?void 0:a.content)||window.siyuan.languages.untitled)}</span>`:o=`<span class="b3-menu__avemoji${e?"":" fn__none"}" data-unicode="${t.block.icon||""}">${Yt(t.block.icon||window.siyuan.storage[p.LOCAL_IMAGES].file)}</span><span data-type="block-ref" data-id="${(i=t.block)==null?void 0:i.id}" data-subtype="s" class="av__celltext av__celltext--ref">${Lute.EscapeHTMLStr(((s=t.block)==null?void 0:s.content)||window.siyuan.languages.untitled)}</span>`;else if(t.type==="number")o=(t==null?void 0:t.number.formattedContent)||(t==null?void 0:t.number.content.toString())||"";else if(t.type==="checkbox")o+=`<svg class="av__checkbox"><use xlink:href="#icon${(r=t==null?void 0:t.checkbox)!=null&&r.checked?"Check":"Uncheck"}"></use></svg><span class="fn__space"></span>`;else if(["date","updated","created"].includes(t.type)){const l=t?t[t.type]:null;l.formattedContent?o=l.formattedContent:(l&&l.isNotEmpty&&(o=at(l.content).format(l.isNotTime?"YYYY-MM-DD":"YYYY-MM-DD HH:mm")),l&&l.hasEndDate&&l.isNotEmpty&&l.isNotEmpty2&&(o=`<svg class="av__cellicon"><use xlink:href="#iconForward"></use></svg>${at(l.content2).format(l.isNotTime?"YYYY-MM-DD":"YYYY-MM-DD HH:mm")}`)),o&&(o=`<span class="av__celltext">${o}</span>`)}return o},kF=(t,e)=>{var n;if(typeof e.icon!="undefined"&&(t.dataset.icon=e.icon,t.querySelector(".av__cellheadericon").outerHTML=e.icon?Yt(e.icon,"av__cellheadericon",!0):`<svg class="av__cellheadericon"><use xlink:href="#${za(t.dataset.dtype)}"></use></svg>`),typeof e.name!="undefined"&&(t.querySelector(".av__celltext").textContent=e.name),typeof e.pin!="undefined"){const a=t.querySelector(".av__celltext");e.pin?t.querySelector(".av__cellheadericon--pin")||a.insertAdjacentHTML("afterend",'<svg class="av__cellheadericon av__cellheadericon--pin"><use xlink:href="#iconPin"></use></svg>'):(n=t.querySelector(".av__cellheadericon--pin"))==null||n.remove()}},jh=t=>{let e=N(t,"av__row");if(!e)return;let n=-1;for(;e;)e=e.previousElementSibling,n++;let a=-2;for(;t;)t=t.previousElementSibling,t&&t.classList.contains("av__colsticky")&&(t=t.lastElementChild),a++;return{rowIndex:n,celIndex:a}},SF=(t,e,n,a,i)=>{var s;(s=e.querySelector(".av__drag-fill"))==null||s.remove();const r={};e.querySelectorAll(".av__cell--active").forEach(g=>{if(a.includes(g.dataset.id))return;const f=N(g,"av__row");if(!f)return;r[f.dataset.id]||(r[f.dataset.id]=[]);const h=qo(Ns(g),g);h.colId=g.dataset.colId,h.element=g,r[f.dataset.id].push(h)});const o=[],l=[],c=e.dataset.avId,d=Object.keys(n),u=!!i.querySelector(".b3-menu__avemoji");Object.keys(r).forEach((g,f)=>{r[g].forEach((h,m)=>{if(["rollup","template","created","updated"].includes(h.type)||h.type==="block"&&h.element.getAttribute("data-detached")!=="true")return;const b=JSON.parse(JSON.stringify(n[d[f%d.length]][m]));b.id=h.id;const y=h.colId;b.type==="block"&&(b.isDetached=!0,delete b.block.id),o.push({action:"updateAttrViewCell",id:h.id,avID:c,keyID:y,rowID:g,data:b}),h.element.innerHTML=ho(b,0,u),u_(h.element,b),delete h.colId,delete h.element,l.push({action:"updateAttrViewCell",id:h.id,avID:c,keyID:y,rowID:g,data:h})})}),qt(e),o.length>0&&et(t,o,l)},Js=t=>{if(t&&(t.classList.add("av__cell--active"),!t.querySelector(".av__drag-fill"))){const e=t.getAttribute("data-dtype");if(["template","rollup","lineNumber","created","updated"].includes(e))return;t.insertAdjacentHTML("beforeend",`<div aria-label="${window.siyuan.languages.dragFill}" class="av__drag-fill ariaLabel"></div>`)}},dx=t=>{var e,n,a,i,s,r;if(t.type==="checkbox")return!1;if(["text","block","url","phone","email","template"].includes(t.type))return!((e=t[t.type])!=null&&e.content);if(t.type==="number")return t.number?!t.number.isNotEmpty:!0;if(["mSelect","mAsset","select"].includes(t.type))return!(((n=t[t.type==="select"?"mSelect":t.type])==null?void 0:n.length)>0);if(["date","created","updated"].includes(t.type))return!((a=t[t.type])!=null&&a.isNotEmpty)&&!((i=t[t.type])!=null&&i.isNotEmpty2);if(t.type==="relation")return!((s=t.relation)!=null&&s.blockIDs&&t.relation.blockIDs.length>0);if(t.type==="rollup")return!((r=t.rollup)!=null&&r.contents&&t.rollup.contents.length>0)};var AF=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const eA=t=>{if(["select","number","date","created","updated"].includes(t))return"=";if(["checkbox"].includes(t))return"Is false";if(["rollup","relation","mAsset","text","mSelect","url","block","email","phone","template"].includes(t))return"Contains"},tA=(t,e,n)=>{const a=N(t,"b3-menu");if(a){if(["date","updated","created"].includes(n)){const i=a.querySelector('.b3-menu__item div[data-type="filter1"]'),s=i.nextElementSibling;e==="Is between"?(s.classList.remove("fn__none"),i.classList.remove("fn__none")):e==="Is empty"||e==="Is not empty"?(s.classList.add("fn__none"),i.classList.add("fn__none")):(i.classList.remove("fn__none"),s.classList.add("fn__none"));return}a.querySelectorAll("input, .b3-chip").forEach(i=>{const s=N(i,"b3-menu__item");s&&(e!=="Is empty"&&e!=="Is not empty"?s.classList.remove("fn__none"):s.classList.add("fn__none"))})}},nA=t=>{window.siyuan.menus.menu.element.querySelectorAll(".b3-menu__item").forEach(e=>{const n=e.querySelector(".b3-chip.b3-chip--middle");if(n){const a=n.dataset.name.toLowerCase();!t||t.indexOf(a)>-1||a.indexOf(t)>-1?e.classList.remove("fn__none"):e.classList.add("fn__none")}})},ux=t=>AF(void 0,null,function*(){var e,n,a,i,s,r,o,l,c,d,u,g,f,h,m,b,y,_,v,U,ee;let Z=t.target.getBoundingClientRect();Z.height===0&&(Z=t.protyle.wysiwyg.element.querySelector(`[data-col-id="${t.target.dataset.colId}"]`).getBoundingClientRect());const k=t.blockElement.getAttribute("data-node-id");let w;const S=new ta("set-filter-"+t.filter.column,()=>{const Ce=JSON.parse(JSON.stringify(t.data.view.filters));if(!w||!w.value)return;const Je={column:t.filter.column,value:{type:t.filter.value.type},operator:w.value};let ze=!1,Ze;if(re.type==="select"||re.type==="mSelect"){const tt=[];window.siyuan.menus.menu.element.querySelectorAll("svg").forEach(Ve=>{if(Ve.firstElementChild.getAttribute("xlink:href")==="#iconCheck"){const He=Ve.nextElementSibling.firstElementChild;tt.push({color:He.dataset.color,content:He.dataset.name})}}),Ze=po(re.type,tt)}else if(["date","updated","created"].includes(re.type)){const tt=S.element.querySelector('.b3-select[data-type="dateType"]'),Ve=S.element.querySelectorAll('.b3-select[data-type="dataDirection"]');tt.value==="custom"?(Je.relativeDate={count:parseInt(Ve[0].parentElement.querySelector(".b3-text-field").value||"1"),unit:parseInt(Ve[0].parentElement.lastElementChild.value),direction:parseInt(Ve[0].value)},Je.relativeDate2={count:parseInt(Ve[1].parentElement.querySelector(".b3-text-field").value||"1"),unit:parseInt(Ve[1].parentElement.lastElementChild.value),direction:parseInt(Ve[1].value)},Ze={type:re.type}):(Ze=po(re.type,{isNotEmpty2:Ie[2].value!=="",isNotEmpty:Ie[0].value!=="",content:Ie[0].value?new Date(Ie[0].value+" 00:00").getTime():0,content2:Ie[2].value?new Date(Ie[2].value+" 00:00").getTime():0,hasEndDate:Je.operator==="Is between",isNotTime:!0}),Je.relativeDate=null,Je.relativeDate2=null)}else["text","mAsset","url","block","email","phone","template","relation","number"].includes(re.type)?Ze=po(re.type,Ie[0].value):re.type==="checkbox"?Ze=po(re.type,{checked:Je.operator==="Is true"}):Ze=po(re.type,void 0);t.filter.value.type==="rollup"?Je.value={rollup:{contents:[Ze]},type:"rollup"}:Je.value=Ze,["rollup","mAsset"].includes(t.filter.value.type)&&(Je.quantifier=S.element.querySelector('.b3-select[data-type="quantifier"]').value);let ht=!1;if(t.data.view.filters.find((tt,Ve)=>{if(tt.column===t.filter.column&&tt.value.type===t.filter.value.type)return tt.value.type==="checkbox"?(ze=!0,t.data.view.filters[Ve]=Je,!0):G(tt,Je)?(ht=!0,!0):(t.data.view.filters[Ve]=Je,ze=!0,!0)}),!t.empty&&(ht||!ze))return;et(t.protyle,[{action:"setAttrViewFilters",avID:t.data.id,data:t.data.view.filters,blockID:k}],[{action:"setAttrViewFilters",avID:t.data.id,data:Ce,blockID:k}]);const De=N(t.target,"b3-menu");De&&(De.innerHTML=oc(t.data))});if(S.isOpen)return;let B="",H;const j=ma(t.data);j.find(Ce=>{if(Ce.id===t.filter.column)return H=Ce,!0});let re=JSON.parse(JSON.stringify(t.filter.value));if(H.type==="rollup"){if(!H.rollup||!H.rollup.relationKeyID||!H.rollup.keyID){Q(window.siyuan.languages.plsChoose),(e=document.querySelector(".av__panel"))==null||e.remove(),Vi({protyle:t.protyle,blockElement:t.blockElement,type:"edit",colId:H.id});return}if((n=H.rollup.calc)!=null&&n.operator&&!["Range","Unique values"].includes(H.rollup.calc.operator))["Count all","Count empty","Count not empty","Count values","Count unique values","Percent empty","Percent not empty","Percent unique values","Percent checked","Percent unchecked","Sum","Average","Median","Min","Max"].includes(H.rollup.calc.operator)?re.type="number":["Checked","Unchecked"].includes(H.rollup.calc.operator)?re.type="checkbox":["Earliest","Latest"].includes(H.rollup.calc.operator)&&(re.type="date");else{let Ce="";j.find(ze=>{if(ze.id===H.rollup.relationKeyID)return Ce=ze.relation.avID,!0}),(yield wn("/api/av/getAttributeView",{id:Ce})).data.av.keyValues.find(ze=>{if(ze.key.id===H.rollup.keyID)return re.type=ze.key.type,ze.key.type==="select"&&(H.options=ze.key.options),!0})}t.data.view.filters.find(Ce=>{if(Ce.column===H.id&&Ce.value.type==="rollup"){if(!Ce.value.rollup||!Ce.value.rollup.contents||Ce.value.rollup.contents.length===0){const Je=re.type==="select"?"mSelect":re.type;re={[Je]:po(re.type,re.type==="checkbox"?{checked:void 0}:"")[Je],type:re.type}}else re=Ce.value.rollup.contents[0];return!0}})}let Te=!1;switch(re.type==="checkbox"&&(Te=typeof re.checkbox=="undefined"||typeof re.checkbox.checked=="undefined"),re.type){case"checkbox":B=`<option ${t.filter.operator==="Is true"&&!Te?"selected":""} value="Is true">${window.siyuan.languages.checked}</option>
<option ${t.filter.operator==="Is false"&&!Te?"selected":""} value="Is false">${window.siyuan.languages.unchecked}</option>`,Te&&(B=`<option selected></option>${B}`);break;case"block":case"mAsset":case"text":case"url":case"phone":case"email":B=`<option ${t.filter.operator==="="?"selected":""} value="=">${window.siyuan.languages.filterOperatorIs}</option>
<option ${t.filter.operator==="!="?"selected":""} value="!=">${window.siyuan.languages.filterOperatorIsNot}</option>
<option ${t.filter.operator==="Contains"?"selected":""} value="Contains">${window.siyuan.languages.filterOperatorContains}</option>
<option ${t.filter.operator==="Does not contains"?"selected":""} value="Does not contains">${window.siyuan.languages.filterOperatorDoesNotContain}</option>
<option ${t.filter.operator==="Starts with"?"selected":""} value="Starts with">${window.siyuan.languages.filterOperatorStartsWith}</option>
<option ${t.filter.operator==="Ends with"?"selected":""} value="Ends with">${window.siyuan.languages.filterOperatorEndsWith}</option>
<option ${t.filter.operator==="Is empty"?"selected":""} value="Is empty">${window.siyuan.languages.filterOperatorIsEmpty}</option>
<option ${t.filter.operator==="Is not empty"?"selected":""} value="Is not empty">${window.siyuan.languages.filterOperatorIsNotEmpty}</option>`;break;case"template":B=`<option ${t.filter.operator==="="?"selected":""} value="=">${window.siyuan.languages.filterOperatorIs}</option>
<option ${t.filter.operator==="!="?"selected":""} value="!=">${window.siyuan.languages.filterOperatorIsNot}</option>
<option ${t.filter.operator==="Contains"?"selected":""} value="Contains">${window.siyuan.languages.filterOperatorContains}</option>
<option ${t.filter.operator==="Does not contains"?"selected":""} value="Does not contains">${window.siyuan.languages.filterOperatorDoesNotContain}</option>
<option ${t.filter.operator==="Starts with"?"selected":""} value="Starts with">${window.siyuan.languages.filterOperatorStartsWith}</option>
<option ${t.filter.operator==="Ends with"?"selected":""} value="Ends with">${window.siyuan.languages.filterOperatorEndsWith}</option>
<option ${t.filter.operator==="Is empty"?"selected":""} value="Is empty">${window.siyuan.languages.filterOperatorIsEmpty}</option>
<option ${t.filter.operator==="Is not empty"?"selected":""} value="Is not empty">${window.siyuan.languages.filterOperatorIsNotEmpty}</option>
<option ${t.filter.operator===">"?"selected":""} value=">">&gt;</option>
<option ${t.filter.operator==="<"?"selected":""} value="<">&lt;</option>
<option ${t.filter.operator===">="?"selected":""} value=">=">&GreaterEqual;</option>
<option ${t.filter.operator==="<="?"selected":""} value="<=">&le;</option>`;break;case"date":case"created":case"updated":B=`<option ${t.filter.operator==="="?"selected":""} value="=">${window.siyuan.languages.filterOperatorIs}</option>
<option ${t.filter.operator===">"?"selected":""} value=">">${window.siyuan.languages.filterOperatorIsAfter}</option>
<option ${t.filter.operator==="<"?"selected":""} value="<">${window.siyuan.languages.filterOperatorIsBefore}</option>
<option ${t.filter.operator===">="?"selected":""} value=">=">${window.siyuan.languages.filterOperatorIsOnOrAfter}</option>
<option ${t.filter.operator==="<="?"selected":""} value="<=">${window.siyuan.languages.filterOperatorIsOnOrBefore}</option>
<option ${t.filter.operator==="Is between"?"selected":""} value="Is between">${window.siyuan.languages.filterOperatorIsBetween}</option>
<option ${t.filter.operator==="Is empty"?"selected":""} value="Is empty">${window.siyuan.languages.filterOperatorIsEmpty}</option>
<option ${t.filter.operator==="Is not empty"?"selected":""} value="Is not empty">${window.siyuan.languages.filterOperatorIsNotEmpty}</option>`;break;case"number":B=`<option ${t.filter.operator==="="?"selected":""} value="=">=</option>
<option ${t.filter.operator==="!="?"selected":""} value="!=">!=</option>
<option ${t.filter.operator===">"?"selected":""} value=">">&gt;</option>
<option ${t.filter.operator==="<"?"selected":""} value="<">&lt;</option>
<option ${t.filter.operator===">="?"selected":""} value=">=">&GreaterEqual;</option>
<option ${t.filter.operator==="<="?"selected":""} value="<=">&le;</option>
<option ${t.filter.operator==="Is empty"?"selected":""} value="Is empty">${window.siyuan.languages.filterOperatorIsEmpty}</option>
<option ${t.filter.operator==="Is not empty"?"selected":""} value="Is not empty">${window.siyuan.languages.filterOperatorIsNotEmpty}</option>`;break;case"mSelect":case"relation":B=`<option ${t.filter.operator==="Contains"?"selected":""} value="Contains">${window.siyuan.languages.filterOperatorContains}</option>
<option ${t.filter.operator==="Does not contains"?"selected":""} value="Does not contains">${window.siyuan.languages.filterOperatorDoesNotContain}</option>
<option ${t.filter.operator==="Is empty"?"selected":""} value="Is empty">${window.siyuan.languages.filterOperatorIsEmpty}</option>
<option ${t.filter.operator==="Is not empty"?"selected":""} value="Is not empty">${window.siyuan.languages.filterOperatorIsNotEmpty}</option>`;break;case"select":B=`<option ${t.filter.operator==="="?"selected":""} value="=">${window.siyuan.languages.filterOperatorIs}</option>
<option ${t.filter.operator==="!="?"selected":""} value="!=">${window.siyuan.languages.filterOperatorIsNot}</option>
<option ${t.filter.operator==="Is empty"?"selected":""} value="Is empty">${window.siyuan.languages.filterOperatorIsEmpty}</option>
<option ${t.filter.operator==="Is not empty"?"selected":""} value="Is not empty">${window.siyuan.languages.filterOperatorIsNotEmpty}</option>`;break}if(["rollup","mAsset"].includes(t.filter.value.type)&&S.addItem({iconHTML:"",type:"readonly",label:` <select style="margin: 4px 0" class="b3-select fn__size200" data-type="quantifier">
    <option ${t.filter.quantifier===""||t.filter.quantifier==="Any"?"selected":""} value="Any">${window.siyuan.languages.filterQuantifierAny}</option>
    <option ${t.filter.quantifier==="All"?"selected":""} value="All">${window.siyuan.languages.filterQuantifierAll}</option>
    <option ${t.filter.quantifier==="None"?"selected":""} value="None">${window.siyuan.languages.filterQuantifierNone}</option>
</select>`}),S.addItem({iconHTML:"",type:"readonly",label:`<select style="margin: 4px 0" class="b3-select fn__size200" data-type="operation">${B}</select>`}),re.type==="select"||re.type==="mSelect")((a=H.options)==null?void 0:a.length)>0&&S.addItem({iconHTML:"",type:"readonly",label:`<input class="b3-text-field fn__size200" style="margin: 4px 0" placeholder="${window.siyuan.languages.search}">`,bind(Ce){const Je=Ce.querySelector("input");Je.addEventListener("keydown",ze=>{if(ze.isComposing)return;let Ze=pi(S.element.querySelector(".b3-menu__items"),ze,"b3-menu__item--current",Ce.nextElementSibling);ze.key==="Enter"&&(Ze||(Ze=S.element.querySelector(".b3-menu__item--current")),Ze.dispatchEvent(new CustomEvent("click")))}),Je.addEventListener("input",ze=>{ze.isComposing||nA(Je.value.toLowerCase())}),Je.addEventListener("compositionend",()=>{nA(Je.value.toLowerCase())})}}),(i=H.options)==null||i.forEach(Ce=>{var Je;let ze="iconUncheck";(Je=re==null?void 0:re.mSelect)==null||Je.find(Ze=>{Ze.content===Ce.name&&(ze="iconCheck")}),S.addItem({icon:ze,label:`<span class="b3-chip b3-chip--middle" data-name="${Ce.name}" data-color="${Ce.color}" style="max-width: 178px;margin:3px 0;background-color:var(--b3-font-background${Ce.color});color:var(--b3-font-color${Ce.color})">
    <span class="fn__ellipsis">${Ce.name}</span>
</span>`,bind(Ze){Ze.addEventListener("click",()=>{const ht=Ze.querySelector("use");ht.getAttribute("xlink:href")==="#iconUncheck"?ht.setAttribute("xlink:href","#iconCheck"):ht.setAttribute("xlink:href","#iconUncheck")})}})});else if(["text","url","block","mAsset","email","phone","template"].includes(re.type)){let Ce="";re&&(re.type==="mAsset"?re.mAsset&&(Ce=((s=re.mAsset[0])==null?void 0:s.content)||""):Ce=re[re.type].content||""),S.addItem({iconHTML:"",type:"readonly",label:`<input style="margin: 4px 0" value="${Ce}" class="b3-text-field fn__size200">`})}else if(re.type==="relation"){let Ce="";re&&(Ce=re.relation.blockIDs[0]||""),S.addItem({iconHTML:"",type:"readonly",label:`<input style="margin: 4px 0" value="${Ce}" class="b3-text-field fn__size200"><div style="position:fixed" class="protyle-hint b3-list b3-list--background fn__none"></div>`,bind(Je){const ze=Je.querySelector("input"),Ze=ze.nextElementSibling,ht=()=>{!H.relation||!H.relation.avID||ae("/api/av/getAttributeViewPrimaryKeyValues",{id:H.relation.avID,keyword:ze.value},De=>{let tt="";(De.data.rows.values||[]).forEach((He,bt)=>{tt+=`<div class="b3-list-item${bt===0?" b3-list-item--focus":""}">${He.block.content||window.siyuan.languages.untitled}</div>`}),Ze.innerHTML=tt,tt===""?Ze.classList.add("fn__none"):Ze.classList.remove("fn__none");const Ve=ze.getBoundingClientRect();gn(Ze,Ve.left,Ve.bottom+4,Ve.height+4)})};ze.addEventListener("input",De=>{De.isComposing||ht()}),ze.addEventListener("compositionend",()=>{ht()}),ze.addEventListener("keydown",De=>{De.isComposing||(De.key!=="Enter"&&Ze.innerHTML!==""&&Ze.classList.remove("fn__none"),pi(Ze,De),De.key==="Enter"&&(Ze.classList.contains("fn__none")?S.close():(ze.value=Ze.querySelector(".b3-list-item--focus").textContent.replace(/\n/g," "),Ze.classList.add("fn__none")),De.preventDefault(),De.stopPropagation()))}),Ze.addEventListener("click",De=>{const tt=N(De.target,"b3-list-item");tt&&(ze.value=tt.textContent.replace(/\n/g," "),Ze.classList.add("fn__none"))})}})}else if(re.type==="number")S.addItem({iconHTML:"",type:"readonly",label:`<input style="margin: 4px 0" value="${re!=null&&re.number.isNotEmpty?re.number.content:""}" class="b3-text-field fn__size200">`});else if(["date","updated","created"].includes(re.type)){const Ce=re?re[re.type]:null,Je=!((r=t.filter.relativeDate)!=null&&r.direction),ze=!((o=t.filter.relativeDate2)!=null&&o.direction);S.addItem({iconHTML:"",type:"readonly",label:`<div data-type="filter1">
    <div class="fn__size200">
        <select class="b3-select fn__block" data-type="dateType">
            <option value="time"${t.filter.relativeDate?"":" selected"}>${window.siyuan.languages.includeTime}</option>
            <option value="custom"${t.filter.relativeDate?" selected":""}>${window.siyuan.languages.relativeToToday}</option>
        </select>
    </div>
    <div class="fn__hr"></div>
    <div class="fn__size200 ${t.filter.relativeDate?"fn__none":""}">
        <input value="${Ce&&(Ce.isNotEmpty||re.type!=="date")?at(Ce.content).format("YYYY-MM-DD"):""}" type="date" max="9999-12-31" class="b3-text-field fn__block">
    </div>
    <div class="fn__flex fn__size200 ${t.filter.relativeDate?"":"fn__none"}">
        <select class="b3-select" data-type="dataDirection">
            <option value="-1"${((l=t.filter.relativeDate)==null?void 0:l.direction)===-1?" selected":""}>${window.siyuan.languages.pastDate}</option>
            <option value="1"${((c=t.filter.relativeDate)==null?void 0:c.direction)===1?" selected":""}>${window.siyuan.languages.nextDate}</option>
            <option value="0"${Je?" selected":""}>${window.siyuan.languages.current}</option>
        </select>
        <span class="fn__space"></span>
        <input type="number" min="1" oninput="this.value = Math.max(this.value, 1)" step="1" value="${((d=t.filter.relativeDate)==null?void 0:d.count)||1}" class="b3-text-field fn__flex-1${Je?" fn__none":""}"/>
        <span class="fn__space${Je?" fn__none":""}"></span>
        <select class="b3-select fn__flex-1">
            <option value="0"${((u=t.filter.relativeDate)==null?void 0:u.unit)===0?" selected":""}>${window.siyuan.languages.day}</option>
            <option value="1"${!t.filter.relativeDate||((g=t.filter.relativeDate)==null?void 0:g.unit)===1?" selected":""}>${window.siyuan.languages.week}</option>
            <option value="2"${((f=t.filter.relativeDate)==null?void 0:f.unit)===2?" selected":""}>${window.siyuan.languages.month}</option>
            <option value="3"${((h=t.filter.relativeDate)==null?void 0:h.unit)===3?" selected":""}>${window.siyuan.languages.year}</option>
        </select>
    </div>
    <div class="fn__hr--small"></div>
</div>
<div data-type="filter2 fn__none">
    <div class="fn__hr--small"></div>
    <div class="fn__size200 ${t.filter.relativeDate2?"fn__none":""}">
        <input value="${Ce&&Ce.isNotEmpty2?at(Ce.content2).format("YYYY-MM-DD"):""}" type="date" max="9999-12-31" class="b3-text-field fn__block">
    </div>
    <div class="fn__flex fn__size200 ${t.filter.relativeDate2?"":"fn__none"}">
        <select class="b3-select" data-type="dataDirection">
            <option value="-1"${((m=t.filter.relativeDate2)==null?void 0:m.direction)===-1?" selected":""}>${window.siyuan.languages.pastDate}</option>
            <option value="1"${((b=t.filter.relativeDate2)==null?void 0:b.direction)===1?" selected":""}>${window.siyuan.languages.nextDate}</option>
            <option value="0"${ze?" selected":""}>${window.siyuan.languages.current}</option>
        </select>
        <span class="fn__space"></span>
        <input type="number" min="1" step="1" oninput="this.value = Math.max(this.value, 1)" value="${((y=t.filter.relativeDate2)==null?void 0:y.count)||1}" class="b3-text-field fn__flex-1${ze?" fn__none":""}"/>
        <span class="fn__space${ze?" fn__none":""}"></span>
        <select class="b3-select fn__flex-1">
            <option value="0"${((_=t.filter.relativeDate2)==null?void 0:_.unit)===0?" selected":""}>${window.siyuan.languages.day}</option>
            <option value="1"${!t.filter.relativeDate2||((v=t.filter.relativeDate2)==null?void 0:v.unit)===1?" selected":""}>${window.siyuan.languages.week}</option>
            <option value="2"${((U=t.filter.relativeDate2)==null?void 0:U.unit)===2?" selected":""}>${window.siyuan.languages.month}</option>
            <option value="3"${((ee=t.filter.relativeDate2)==null?void 0:ee.unit)===3?" selected":""}>${window.siyuan.languages.year}</option>
        </select>
    </div>
    <div class="fn__hr--small"></div>
</div>`})}S.addItem({icon:"iconTrashcan",label:window.siyuan.languages.removeFilters,click(){const Ce=Object.assign([],t.data.view.filters);t.data.view.filters.find((ze,Ze)=>{if(ze.column===t.filter.column&&t.filter.value.type===ze.value.type)return t.data.view.filters.splice(Ze,1),!0}),et(t.protyle,[{action:"setAttrViewFilters",avID:t.data.id,data:t.data.view.filters,blockID:k}],[{action:"setAttrViewFilters",avID:t.data.id,data:Ce,blockID:k}]);const Je=N(t.target,"b3-menu");Je&&(Je.innerHTML=oc(t.data))}}),w=S.element.querySelector('.b3-select[data-type="operation"]'),w==null||w.addEventListener("change",()=>{tA(w,w.value,re.type)});const Be=S.element.querySelector('.b3-select[data-type="dateType"]');Be==null||Be.addEventListener("change",()=>{const Ce=S.element.querySelectorAll('[data-type="dataDirection"]'),Je=Ce[0].parentElement,ze=Ce[1].parentElement,Ze=Je.previousElementSibling,ht=ze.previousElementSibling;Be.value==="custom"?(Je.classList.remove("fn__none"),ze.classList.remove("fn__none"),Ze.classList.add("fn__none"),ht.classList.add("fn__none")):(Je.classList.add("fn__none"),ze.classList.add("fn__none"),Ze.classList.remove("fn__none"),ht.classList.remove("fn__none"))}),S.element.querySelectorAll('.b3-select[data-type="dataDirection"]').forEach(Ce=>{Ce.addEventListener("change",()=>{const Je=Ce.nextElementSibling.nextElementSibling;Ce.value==="0"?(Je.classList.add("fn__none"),Je.nextElementSibling.classList.add("fn__none")):(Je.classList.remove("fn__none"),Je.nextElementSibling.classList.remove("fn__none"))})});const Ie=S.element.querySelectorAll(".b3-text-field");["relation","select","mSelect"].includes(re.type)||Ie.forEach(Ce=>{Ce.addEventListener("keydown",Je=>{if(Je.isComposing){Je.preventDefault();return}Je.key==="Enter"&&(S.close(),Je.preventDefault())})}),tA(w,w.value,re.type),S.open({x:Z.left,y:Z.bottom}),Ie.length>0&&Ie[0].select()}),TF=t=>{const e=new ta(p.MENU_AV_ADD_FILTER);ma(t.data).forEach(n=>{let a;t.data.view.filters.find(i=>{if(i.column===n.id&&i.value.type===n.type)return a=i,!0}),!a&&n.type!=="lineNumber"&&e.addItem({label:n.name,iconHTML:n.icon?Yt(n.icon,"b3-menu__icon",!0):`<svg class="b3-menu__icon"><use xlink:href="#${za(n.type)}"></use></svg>`,click:()=>{const i=po(n.type,n.type==="checkbox"?{checked:void 0}:"");a={column:n.id,operator:eA(n.type),value:i},t.data.view.filters.push(a),t.menuElement.innerHTML=oc(t.data),gn(t.menuElement,t.tabRect.right-t.menuElement.clientWidth,t.tabRect.bottom,t.tabRect.height);const s=t.menuElement.querySelector(`[data-id="${n.id}"] .b3-chip`);ux({empty:!0,filter:a,protyle:t.protyle,data:t.data,target:s,blockElement:t.blockElement})}})}),e.open({x:t.rect.left,y:t.rect.bottom,h:t.rect.height})},oc=t=>{let e="";const n=ma(t),a=i=>{let s="";return n.find(r=>{var o,l,c,d,u,g;if(r.id===i.column&&r.type===i.value.type){let f="";["rollup","mAsset"].includes(r.type)&&(i.quantifier===""||i.quantifier==="Any"?f=window.siyuan.languages.filterQuantifierAny+" ":i.quantifier==="All"?f=window.siyuan.languages.filterQuantifierAll+" ":i.quantifier==="None"&&(f=window.siyuan.languages.filterQuantifierNone+" "));const h=r.type==="rollup"?((l=(o=i.value.rollup)==null?void 0:o.contents)==null?void 0:l.length)>0?i.value.rollup.contents[0]:{type:"rollup"}:i.value;if(i.operator==="Is empty")f=": "+f+window.siyuan.languages.filterOperatorIsEmpty;else if(i.operator==="Is not empty")f=": "+f+window.siyuan.languages.filterOperatorIsNotEmpty;else if(i.operator==="Is false")(h.type!=="checkbox"||typeof h.checkbox.checked=="boolean")&&(f=": "+f+window.siyuan.languages.unchecked);else if(i.operator==="Is true")(h.type!=="checkbox"||typeof h.checkbox.checked=="boolean")&&(f=": "+f+window.siyuan.languages.checked);else if(["created","updated","date"].includes(h.type)){let m="",b="";i.relativeDate?(m=`${window.siyuan.languages[["pastDate","current","nextDate"][i.relativeDate.direction+1]]}
 ${i.relativeDate.direction?i.relativeDate.count:""}
 ${window.siyuan.languages[["day","week","month","year"][i.relativeDate.unit]]}`,i.relativeDate2&&(b=`${window.siyuan.languages[["pastDate","current","nextDate"][i.relativeDate2.direction+1]]}
 ${i.relativeDate2.direction?i.relativeDate2.count:""}
 ${window.siyuan.languages[["day","week","month","year"][i.relativeDate2.unit]]}`)):h&&((c=h[h.type])!=null&&c.content&&(m=at(h[h.type].content).format("YYYY-MM-DD")),h&&((d=h[h.type])!=null&&d.content2)&&(b=at(h[h.type].content2).format("YYYY-MM-DD"))),m&&(i.operator==="Is between"&&b?f=` ${f}${window.siyuan.languages.filterOperatorIsBetween} ${m} ${b}`:i.operator==="="?f=`: ${f}${m}`:[">","<"].includes(i.operator)?f=` ${f}${i.operator} ${m}`:i.operator===">="?f=` ${f}\u2265 ${m}`:i.operator==="<="&&(f=` ${f}\u2264 ${m}`))}else if(["mSelect","select"].includes(h.type)){let m="";((u=h.mSelect)==null?void 0:u.length)>0&&(h.mSelect.forEach((b,y)=>{m+=b.content,y!==h.mSelect.length-1&&(m+=", ")}),m&&(i.operator==="Contains"?f=`: ${f}${m}`:i.operator==="Does not contains"?f=` ${f}${window.siyuan.languages.filterOperatorDoesNotContain} ${m}`:i.operator==="="?f=`: ${f}${m}`:i.operator==="!="&&(f=` ${f}${window.siyuan.languages.filterOperatorIsNot} ${m}`))),!m&&["rollup","mAsset"].includes(r.type)&&!["Is empty","Is not empty"].includes(i.operator)&&(f="")}else if(h.type==="number"&&h.number&&h.number.isNotEmpty)["=","!=",">","<"].includes(i.operator)?f=` ${f}${i.operator} ${h.number.content}`:i.operator===">="?f=` ${f}\u2265 ${h.number.content}`:i.operator==="<="&&(f=` ${f}\u2264 ${h.number.content}`);else if(["text","block","url","mAsset","phone","email","relation","template"].includes(h.type)){let m;h[h.type]&&(h.type==="relation"?m=h.relation.blockIDs[0]||"":h.type==="mAsset"?m=((g=h.mAsset[0])==null?void 0:g.content)||"":m=h[h.type].content||"",m&&(["=","Contains"].includes(i.operator)?f=`: ${f}${m}`:i.operator==="Does not contains"?f=` ${f}${window.siyuan.languages.filterOperatorDoesNotContain} ${m}`:i.operator==="!="?f=` ${f}${window.siyuan.languages.filterOperatorIsNot} ${m}`:i.operator==="Starts with"?f=` ${f}${window.siyuan.languages.filterOperatorStartsWith} ${m}`:i.operator==="Ends with"?f=` ${f}${window.siyuan.languages.filterOperatorEndsWith} ${m}`:[">","<"].includes(i.operator)?f=` ${f}${i.operator} ${m}`:i.operator===">="?f=` ${f}\u2265 ${m}`:i.operator==="<="&&(f=` ${f}\u2264 ${m}`))),!m&&["rollup","mAsset"].includes(r.type)&&!["Is empty","Is not empty"].includes(i.operator)&&(f="")}return s+=`<span data-type="setFilter" class="b3-chip${f?" b3-chip--primary":""}">
    ${r.icon?Yt(r.icon,"icon",!0):`<svg class="icon"><use xlink:href="#${za(r.type)}"></use></svg>`}
    <span class="fn__ellipsis">${r.name}${f}</span>
</span>`,!0}}),s};return t.view.filters.forEach(i=>{const s=a(i);s&&(e+=`<button class="b3-menu__item" draggable="true" data-id="${i.column}" data-filter-type="${i.value.type}">
    <svg class="b3-menu__icon fn__grab"><use xlink:href="#iconDrag"></use></svg>
    <div class="fn__flex-1">${s}</div>
    <svg class="b3-menu__action" data-type="removeFilter"><use xlink:href="#iconTrashcan"></use></svg>
</button>`)}),`<div class="b3-menu__items">
<button class="b3-menu__item" data-type="nobg">
    <span class="block__icon" style="padding: 8px;margin-left: -4px;" data-type="go-config">
        <svg><use xlink:href="#iconLeft"></use></svg>
    </span>
    <span class="b3-menu__label ft__center">${window.siyuan.languages.filter}</span>
</button>
<button class="b3-menu__separator"></button>
${e}
<button class="b3-menu__item${t.view.filters.length===n.length?" fn__none":""}" data-type="addFilter">
    <svg class="b3-menu__icon"><use xlink:href="#iconAdd"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.addFilter}</span>
</button>
<button class="b3-menu__item b3-menu__item--warning${e?"":" fn__none"}" data-type="removeFilters">
    <svg class="b3-menu__icon"><use xlink:href="#iconTrashcan"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.removeFilters}</span>
</button>
</div>`};var DF=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const $s=(t,e)=>{if(e==="table"||N(t,"custom-attr"))return t.getAttribute("data-col-id");if(["gallery","kanban"].includes(e))return t.getAttribute("data-field-id")},aA=t=>{let e;const n=ma(t.data);n.find((s,r)=>{if(s.id===t.colId)return e=JSON.parse(JSON.stringify(s)),n.splice(r+1,0,e),!0}),e.name=J(e.name),e.id=Lute.NewNodeID();const a=at().format("YYYYMMDDHHmmss"),i=t.blockElement.getAttribute("data-node-id");et(t.protyle,[{action:"duplicateAttrViewKey",keyID:t.colId,nextID:e.id,avID:t.data.id},{action:"doUpdateUpdated",id:i,data:a}],[{action:"removeAttrViewCol",id:e.id,avID:t.data.id},{action:"doUpdateUpdated",id:i,data:t.blockElement.getAttribute("updated")}]),ts({blockElement:t.blockElement,protyle:t.protyle,type:e.type,name:e.name,icon:e.icon,previousID:t.colId,data:t.data,id:e.id}),t.blockElement.setAttribute("updated",a)},go=t=>{var e,n,a,i,s;let r;ma(t.data).find(l=>{if(l.id===t.colId)return r=l,!0});let o=`<button class="b3-menu__item" data-type="nobg" data-col-id="${t.colId}">
    <span class="block__icon${t.isCustomAttr?" fn__none":""}" style="padding: 8px;margin-left: -4px;" data-type="go-properties">
        <svg><use xlink:href="#iconLeft"></use></svg>
    </span>
    <span class="b3-menu__label ft__center">${window.siyuan.languages.edit}</span>
</button>
<button class="b3-menu__separator" data-id="separator_1"></button>
<button class="b3-menu__item" data-type="nobg">
    <div class="fn__block">
        <div class="fn__flex">
            <span class="b3-menu__avemoji" data-col-type="${r.type}" data-icon="${r.icon}" data-type="update-icon">${r.icon?Yt(r.icon):`<svg style="width: 14px;height: 14px"><use xlink:href="#${za(r.type)}"></use></svg>`}</span>
            <div class="b3-form__icona fn__block">
                <input data-type="name" class="b3-text-field b3-form__icona-input" type="text">
                <svg data-position="north" class="b3-form__icona-icon ariaLabel" aria-label="${r.desc?Ot(r.desc):window.siyuan.languages.addDesc}"><use xlink:href="#iconInfo"></use></svg>
            </div>
        </div>
        <div class="fn__none">
            <div class="fn__hr"></div>
            <textarea placeholder="${window.siyuan.languages.addDesc}" rows="1" data-type="desc" class="b3-text-field fn__block" type="text" data-value="${ft(r.desc)}">${r.desc}</textarea>
        </div>
        <div class="fn__hr--small"></div>
    </div>
</button>
<button class="b3-menu__item" data-type="goUpdateColType" ${r.type==="block"?"disabled":""}>
    <span class="b3-menu__label">${window.siyuan.languages.type}</span>
    <span class="fn__space"></span>
    <svg class="b3-menu__icon"><use xlink:href="#${za(r.type)}"></use></svg>
    <span class="b3-menu__accelerator" style="margin-left: 0">${Wo(r.type)}</span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>`;if(["mSelect","select"].includes(r.type))o+=`<button class="b3-menu__separator" data-id="separator_2"></button>
<button class="b3-menu__item" data-type="nobg">
    <svg class="b3-menu__icon"><use xlink:href="#iconAdd"></use></svg>
    <input data-type="addOption" class="b3-text-field fn__block" type="text" placeholder="${window.siyuan.languages.enterKey} ${window.siyuan.languages.addAttr}" style="margin: 4px 0">
</button>`,r.options||(r.options=[]),r.options.forEach(l=>{const c=l.desc?`${Ot(l.name)}<div class='ft__on-surface'>${Ot(l.desc||"")}</div>`:"";o+=`<button class="b3-menu__item${o?"":" b3-menu__item--current"}" draggable="true" data-name="${ft(l.name)}" data-desc="${ft(l.desc||"")}" data-color="${l.color}">
    <svg class="b3-menu__icon fn__grab"><use xlink:href="#iconDrag"></use></svg>
    <div class="fn__flex-1 ariaLabel" data-position="parentW" aria-label="${c}">
        <span class="b3-chip" style="background-color:var(--b3-font-background${l.color});color:var(--b3-font-color${l.color})">
            <span class="fn__ellipsis">${he(l.name)}</span>
        </span>
    </div>
    <svg class="b3-menu__action" data-type="setColOption"><use xlink:href="#iconEdit"></use></svg>
</button>`});else if(r.type==="number")o+=`<button class="b3-menu__separator" data-id="separator_2"></button>
<button class="b3-menu__item" data-type="numberFormat" data-format="${r.numberFormat}">
    <svg class="b3-menu__icon"><use xlink:href="#iconFormat"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.format}</span>
    <span class="b3-menu__accelerator">${VS(r.numberFormat)}</span>
</button>`;else if(r.type==="template")o+=`<button class="b3-menu__separator" data-id="separator_2"></button>
<button class="b3-menu__item" data-type="nobg">
    <textarea spellcheck="false" rows="${Math.min(r.template.split(`
`).length,8)}" placeholder="${window.siyuan.languages.template}" data-type="updateTemplate" style="margin: 4px 0" rows="1" class="fn__block b3-text-field">${r.template}</textarea>
</button>`;else if(r.type==="relation"){const l=((e=r.relation)==null?void 0:e.avID)===t.data.id;o+=`<button class="b3-menu__separator" data-id="separator_2"></button>
<button class="b3-menu__item" data-type="goSearchAV" data-av-id="${((n=r.relation)==null?void 0:n.avID)||""}" data-old-value='${JSON.stringify(r.relation||{})}'>
    <span class="b3-menu__label">${window.siyuan.languages.relatedTo}</span>
    <span class="b3-menu__accelerator">${l?window.siyuan.languages.thisDatabase:""}</span>
    <svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg>
</button>
<label class="b3-menu__item">
    <span class="fn__flex-center">${window.siyuan.languages.backRelation}</span>
    <svg class="b3-menu__icon b3-menu__icon--small fn__none"><use xlink:href="#iconHelp"></use></svg>
    <span class="fn__space fn__flex-1"></span>
    <input data-type="backRelation" type="checkbox" class="b3-switch b3-switch--menu" ${(a=r.relation)!=null&&a.isTwoWay?"checked":""}>
</label>
<div class="b3-menu__item fn__flex-column fn__none" data-type="nobg">
    <input data-old-value="" data-type="colName" style="margin: 8px 0 4px" class="b3-text-field fn__block" placeholder="${t.data.name} ${r.name}">
</div>
<div class="b3-menu__item fn__flex-column fn__none" data-type="nobg">
    <button style="margin: 4px 0 8px;" class="b3-button fn__block" data-type="updateRelation">${window.siyuan.languages.confirm}</button>
</div>`}else r.type==="rollup"?o+='<button class="b3-menu__separator" data-id="separator_2"></button>'+jS({colData:r}):r.type==="date"?o+=`<button class="b3-menu__separator" data-id="separator_2"></button>
<label class="b3-menu__item">
    <span class="fn__flex-center">${window.siyuan.languages.fillCreated}</span>
    <span class="fn__space fn__flex-1"></span>
    <input data-type="fillCreated" type="checkbox" class="b3-switch b3-switch--menu" ${(i=r.date)!=null&&i.autoFillNow?"checked":""}>
</label>
<label class="b3-menu__item">
    <span class="fn__flex-center">${window.siyuan.languages.fillSpecificTime}</span>
    <span class="fn__space fn__flex-1"></span>
    <input data-type="fillSpecificTime" type="checkbox" class="b3-switch b3-switch--menu" ${(s=r.date)!=null&&s.fillSpecificTime?"checked":""}>
</label>`:["updated","created"].includes(r.type)&&(o+=`<button class="b3-menu__separator" data-id="separator_2"></button>
<label class="b3-menu__item">
    <span class="fn__flex-center">${window.siyuan.languages.includeTime}</span>
    <span class="fn__space fn__flex-1"></span>
    <input data-type="includeTime" type="checkbox" class="b3-switch b3-switch--menu" ${!r[r.type]||r[r.type].includeTime?"checked":""}>
</label>`);return o+=`<button class="b3-menu__separator" data-id="separator_3"></button>
<label class="b3-menu__item">
    <svg class="b3-menu__icon" style=""><use xlink:href="#iconSoftWrap"></use></svg>
    <span class="fn__flex-center">${window.siyuan.languages.wrap}</span>
    <span class="fn__space fn__flex-1"></span>
    <input type="checkbox" data-type="wrap" class="b3-switch b3-switch--menu"${r.wrap?" checked":""}>
</label>`,r.type!=="block"&&(o+=`<button class="b3-menu__item${r.type==="relation"?" fn__none":""}" data-type="duplicateCol">
    <svg class="b3-menu__icon" style=""><use xlink:href="#iconCopy"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.duplicate}</span>
</button>
<button class="b3-menu__item  b3-menu__item--warning" data-type="removeCol">
    <svg class="b3-menu__icon" style=""><use xlink:href="#iconTrashcan"></use></svg>
    <span class="b3-menu__label">${window.siyuan.languages.delete}</span>
</button>`),`<div class="b3-menu__items">
    ${o}
</div>
<div class="b3-menu__items fn__none">
    <button class="b3-menu__item" data-type="nobg" data-col-id="${r.id}">
        <span class="block__icon" style="padding: 8px;margin-left: -4px;" data-type="goEditCol">
            <svg><use xlink:href="#iconLeft"></use></svg>
        </span>
        <span class="b3-menu__label ft__center">${window.siyuan.languages.edit}</span>
    </button>
    <button class="b3-menu__separator"></button>
    ${ps("text",r.type)}
    ${ps("number",r.type)}
    ${ps("select",r.type)}
    ${ps("mSelect",r.type)}
    ${ps("date",r.type)}
    ${ps("mAsset",r.type)}
    ${ps("checkbox",r.type)}
    ${ps("url",r.type)}
    ${ps("email",r.type)}
    ${ps("phone",r.type)}
    ${ps("template",r.type)}
    ${ps("relation",r.type)}
    ${ps("rollup",r.type)}
    ${ps("lineNumber",r.type)}
    ${ps("created",r.type)}
    ${ps("updated",r.type)}
</div>`},mo=t=>{const e=t.data.id,n=t.menuElement.querySelector(".b3-menu__item").getAttribute("data-col-id"),a=ma(t.data).find(f=>f.id===n),i=t.menuElement.querySelector('[data-type="name"]');i.addEventListener("blur",()=>{const f=i.value;f!==a.name&&(et(t.protyle,[{action:"updateAttrViewCol",id:n,avID:e,name:f,type:a.type}],[{action:"updateAttrViewCol",id:n,avID:e,name:a.name,type:a.type}]),a.name=f,us(t.protyle.wysiwyg.element.querySelector(`.av__row--header .av__cell[data-col-id="${n}"]`),void 0,{name:f}))}),i.addEventListener("keydown",f=>{f.isComposing||(f.key==="Escape"?t.menuElement.parentElement.remove():f.key==="Enter"&&(i.dispatchEvent(new CustomEvent("blur")),t.menuElement.parentElement.remove()))}),i.addEventListener("keyup",f=>{if(f.isComposing)return;const h=t.menuElement.querySelector('[data-type="colName"]');h&&h.setAttribute("placeholder",`${t.data.name} ${i.value}`)}),i.select(),i.value=a.name;const s=t.menuElement.querySelector('.b3-text-field[data-type="desc"]');i.nextElementSibling.addEventListener("click",()=>{const f=s.parentElement;f.classList.toggle("fn__none"),f.classList.contains("fn__none")||s.focus()}),s.addEventListener("blur",()=>{const f=s.value;f!==a.desc&&(et(t.protyle,[{action:"setAttrViewColDesc",id:n,avID:e,data:f}],[{action:"setAttrViewColDesc",id:n,avID:e,data:a.desc}]),a.desc=f)}),s.addEventListener("keydown",f=>{f.isComposing||(f.key==="Escape"?t.menuElement.parentElement.remove():f.key==="Enter"&&(s.dispatchEvent(new CustomEvent("blur")),t.menuElement.parentElement.remove()))}),s.addEventListener("input",()=>{i.nextElementSibling.setAttribute("aria-label",s.value?he(s.value):window.siyuan.languages.addDesc)});const r=t.menuElement.querySelector('[data-type="updateTemplate"]');r&&(r.addEventListener("blur",()=>{const f=r.value;f!==a.template&&(et(t.protyle,[{action:"updateAttrViewColTemplate",id:n,avID:e,data:f,type:a.type}],[{action:"updateAttrViewColTemplate",id:n,avID:e,data:a.template,type:a.type}]),a.template=f)}),r.addEventListener("keydown",f=>{f.isComposing||(f.key==="Escape"?t.menuElement.parentElement.remove():f.key==="Enter"&&!f.shiftKey&&(r.dispatchEvent(new CustomEvent("blur")),t.menuElement.parentElement.remove()))}));const o=t.menuElement.querySelector('.b3-switch[data-type="includeTime"]');o&&o.addEventListener("change",()=>{et(t.protyle,[{action:a.type==="updated"?"setAttrViewUpdatedIncludeTime":"setAttrViewCreatedIncludeTime",id:n,avID:e,data:o.checked}],[{action:a.type==="updated"?"setAttrViewUpdatedIncludeTime":"setAttrViewCreatedIncludeTime",id:n,avID:e,data:!o.checked}]),a[a.type]?a[a.type].includeTime=o.checked:a[a.type]={includeTime:o.checked}});const l=t.menuElement.querySelector('.b3-switch[data-type="wrap"]');l&&l.addEventListener("change",()=>{et(t.protyle,[{action:"setAttrViewColWrap",id:n,avID:e,data:l.checked,blockID:t.blockID,viewID:t.data.viewID}],[{action:"setAttrViewColWrap",id:n,avID:e,data:!l.checked,viewID:t.data.viewID,blockID:t.blockID}]),a.wrap=l.checked,t.data.view.wrapField=t.data.view.wrapField&&l.checked});const c=t.menuElement.querySelector('[data-type="addOption"]');c&&c.addEventListener("keydown",f=>{if(!f.isComposing&&(f.key==="Escape"&&t.menuElement.parentElement.remove(),f.key==="Enter")){let h=!1;if(a.options.find(m=>{if(c.value===m.name)return h=!0,!0}),h||!c.value)return;a.options.push({color:((a.options.length||0)%14+1).toString(),name:c.value}),et(t.protyle,[{action:"updateAttrViewColOptions",id:n,avID:e,data:a.options}],[{action:"removeAttrViewColOption",id:n,avID:e,data:c.value}]),t.menuElement.innerHTML=go({protyle:t.protyle,colId:n,data:t.data,isCustomAttr:t.isCustomAttr}),mo({protyle:t.protyle,menuElement:t.menuElement,data:t.data,isCustomAttr:t.isCustomAttr,blockID:t.blockID}),t.menuElement.querySelector('[data-type="addOption"]').focus()}});const d=t.menuElement.querySelector('[data-type="fillCreated"]');d&&d.addEventListener("change",()=>{et(t.protyle,[{avID:e,action:"setAttrViewColDateFillCreated",id:n,data:d.checked}],[{avID:e,action:"setAttrViewColDateFillCreated",id:n,data:!d.checked}])});const u=t.menuElement.querySelector('[data-type="fillSpecificTime"]');u&&u.addEventListener("change",()=>{et(t.protyle,[{avID:e,action:"setAttrViewColDateFillSpecificTime",id:n,data:u.checked}],[{avID:e,action:"setAttrViewColDateFillSpecificTime",id:n,data:!u.checked}])});const g=t.menuElement.querySelector('[data-type="backRelation"]');if(g){g.addEventListener("change",()=>{Nh(t.menuElement,e)});const f=t.menuElement.querySelector('[data-type="goSearchAV"]'),h=JSON.parse(f.getAttribute("data-old-value")),m=t.menuElement.querySelector('[data-type="colName"]');m.addEventListener("input",()=>{Nh(t.menuElement,e)}),h.avID?ae("/api/av/getAttributeView",{id:h.avID},b=>{f.querySelector(".b3-menu__accelerator").textContent=h.avID===e?window.siyuan.languages.thisDatabase:b.data.av.name||window.siyuan.languages._kernel[267],b.data.av.keyValues.find(y=>{if(y.key.id===h.backKeyID)return m.setAttribute("data-old-value",y.key.name||window.siyuan.languages._kernel[272]),m.value=y.key.name||window.siyuan.languages._kernel[272],!0}),Nh(t.menuElement,e)}):Nh(t.menuElement,e)}KS(t)},Wo=t=>{switch(t){case"text":case"number":case"select":case"date":case"phone":case"email":case"template":return window.siyuan.languages[t];case"mSelect":return window.siyuan.languages.multiSelect;case"relation":return window.siyuan.languages.relation;case"rollup":return window.siyuan.languages.rollup;case"updated":return window.siyuan.languages.updatedTime;case"created":return window.siyuan.languages.createdTime;case"url":return window.siyuan.languages.link;case"mAsset":return window.siyuan.languages.assets;case"checkbox":return window.siyuan.languages.checkbox;case"block":return window.siyuan.languages._attrView.key;case"lineNumber":return window.siyuan.languages.lineNumber}},za=t=>{switch(t){case"text":return"iconAlignLeft";case"block":return"iconKey";case"number":return"iconNumber";case"select":return"iconListItem";case"mSelect":return"iconList";case"relation":return"iconOpen";case"rollup":return"iconSearch";case"date":return"iconCalendar";case"updated":case"created":return"iconClock";case"url":return"iconLink";case"mAsset":return"iconImage";case"email":return"iconEmail";case"phone":return"iconPhone";case"template":return"iconMath";case"checkbox":return"iconCheck";case"lineNumber":return"iconOrderedList"}},ts=t=>{if(!t.blockElement)return;const e=t.blockElement.getAttribute("data-node-id");t.blockElement.classList.contains("av")?t.blockElement.querySelectorAll(".av__row").forEach(i=>{let s;t.previousID?s=i.querySelector(`[data-col-id="${t.previousID}"]`):s=i.querySelector(".av__cell").previousElementSibling;let r="";i.classList.contains("av__row--header")?r=`<div class="av__cell av__cell--header" draggable="true" data-icon="${t.icon||""}" data-col-id="${t.id}" data-dtype="${t.type}" data-wrap="false" style="width: 200px;">
    ${t.icon?Yt(t.icon,"av__cellheadericon",!0):`<svg class="av__cellheadericon"><use xlink:href="#${za(t.type)}"></use></svg>`}
    <span class="av__celltext fn__flex-1">${t.name}</span>
    <div class="av__widthdrag"></div>
</div>`:r='<div class="av__cell" style="width: 200px"><span class="av__pulse"></span></div>',s.insertAdjacentHTML("afterend",r)}):t.blockElement.querySelector(".fn__hr").insertAdjacentHTML("beforebegin",`<div class="block__icons av__row" data-id="${e}" data-col-id="${t.id}">
    <div class="block__icon" draggable="true"><svg><use xlink:href="#iconDrag"></use></svg></div>
    <div class="block__logo ariaLabel fn__pointer" data-type="editCol" data-position="parentW" aria-label="${Wo(t.type)}">
        <svg class="block__logoicon"><use xlink:href="#${za(t.type)}"></use></svg>
        <span>${Wo(t.type)}</span>
    </div>
    <div data-col-id="${t.id}" data-block-id="${e}" data-type="${t.type}" data-options="[]" class="fn__flex-1 fn__flex">
        <div class="fn__flex-1"></div>
    </div>
</div>`);const n=document.querySelector(".av__panel .b3-menu");if(n&&t.data&&t.blockElement.classList.contains("av")){n.innerHTML=go({protyle:t.protyle,data:t.data,colId:t.id,isCustomAttr:!1}),mo({protyle:t.protyle,data:t.data,menuElement:n,isCustomAttr:!1,blockID:e});const i=t.blockElement.querySelector(".av__views").getBoundingClientRect();i&&gn(n,i.right-n.clientWidth,i.bottom,i.height);return}let a;t.data&&(a=ma(t.data).find(i=>i.id===t.id)),Vi({protyle:t.protyle,blockElement:t.blockElement,type:"edit",colId:t.id,editData:{previousID:t.previousID,colData:a||CF(t.type,t.id,t.name)}}),window.siyuan.menus.menu.remove()},iA=(t,e,n)=>{const a=n.getAttribute("data-dtype"),i=n.getAttribute("data-col-id"),s=e.getAttribute("data-av-id"),r=e.getAttribute("data-node-id"),o=e.getAttribute(p.CUSTOM_SY_AV_VIEW),l=n.querySelector(".av__celltext").textContent.trim(),c=n.dataset.desc,d=new ta(p.MENU_AV_HEADER_CELL,()=>{const h=d.element.querySelector(".b3-text-field").value;h!==l&&(et(t,[{action:"updateAttrViewCol",id:i,avID:s,name:h,type:a}],[{action:"updateAttrViewCol",id:i,avID:s,name:l,type:a}]),us(e.querySelector(`.av__row--header .av__cell[data-col-id="${i}"]`),void 0,{name:h}));const m=d.element.querySelector("textarea").value;m!==c&&et(t,[{action:"setAttrViewColDesc",id:i,avID:s,data:m}],[{action:"setAttrViewColDesc",id:i,avID:s,data:c}]),qt(e)});d.addItem({iconHTML:"",type:"empty",label:`<div class="fn__hr"></div><div class="fn__flex">
    <div class="fn__space"></div>
    <span class="b3-menu__avemoji">${n.dataset.icon?Yt(n.dataset.icon):`<svg style="height: 14px;width: 14px;"><use xlink:href="#${za(a)}"></use></svg>`}</span>
    <div class="b3-form__icona fn__block">
        <input class="b3-text-field b3-form__icona-input" type="text">
        <svg data-position="north" class="b3-form__icona-icon ariaLabel" aria-label="${c?Ot(c):window.siyuan.languages.addDesc}"><use xlink:href="#iconInfo"></use></svg>
    </div>
    <div class="fn__space"></div>
</div>
<div class="fn__none">
    <div class="fn__hr"></div>
    <div class="fn__flex">
        <span class="fn__space"></span>
        <textarea placeholder="${window.siyuan.languages.addDesc}" rows="1" class="b3-text-field fn__block" type="text" data-value="${ft(c)}">${c}</textarea>
        <span class="fn__space"></span>    
    </div>
</div>
<div class="fn__hr--small"></div>`,bind(h){const m=h.querySelector(".b3-menu__avemoji");m.addEventListener("click",_=>{const v=m.getBoundingClientRect();Va("","av",{x:v.left,y:v.bottom+4,h:v.height,w:v.width},U=>{et(t,[{action:"setAttrViewColIcon",id:i,avID:s,data:U}],[{action:"setAttrViewColIcon",id:i,avID:s,data:n.dataset.icon}]),m.innerHTML=U?Yt(U):`<svg style="height: 14px;width: 14px"><use xlink:href="#${za(a)}"></use></svg>`,us(e.querySelector(`.av__row--header .av__cell[data-col-id="${i}"]`),void 0,{icon:U})},m.querySelector("img")),_.preventDefault(),_.stopPropagation()});const b=h.querySelector("input");b.value=l,b.addEventListener("keydown",_=>{_.isComposing||_.key==="Enter"&&(d.close(),_.preventDefault())});const y=h.querySelector("textarea");b.nextElementSibling.addEventListener("click",()=>{const _=y.parentElement.parentElement;_.classList.toggle("fn__none"),_.classList.contains("fn__none")||y.focus()}),y.addEventListener("keydown",_=>{_.isComposing||_.key==="Enter"&&(d.close(),_.preventDefault())}),y.addEventListener("input",()=>{b.nextElementSibling.setAttribute("aria-label",y.value?he(y.value):window.siyuan.languages.addDesc)})}}),d.addItem({id:"edit",icon:"iconEdit",label:window.siyuan.languages.edit,click(){const h=d.element.querySelector(".b3-text-field").value;Vi({protyle:t,blockElement:e,type:"edit",colId:i,cb(m){const b=m.querySelector('.b3-text-field[data-type="name"]');b.value=h,b.select()}})}}),d.addSeparator({id:"separator_1"}),a!=="lineNumber"&&(d.addItem({id:"filter",icon:"iconFilter",label:window.siyuan.languages.filter,click(){ae("/api/av/renderAttributeView",{id:s},h=>{const m=h.data;let b;m.view.filters.find(_=>{if(_.column===i&&_.value.type===a)return b=_,!0});let y=!1;b||(y=!0,b={column:i,operator:eA(a),value:po(a,"")},m.view.filters.push(b)),ux({empty:y,filter:b,protyle:t,data:m,blockElement:e,target:e.querySelector(`.av__row--header .av__cell[data-col-id="${i}"]`)})})}}),d.addItem({id:"asc",icon:"iconUp",label:window.siyuan.languages.asc,click(){ae("/api/av/renderAttributeView",{id:s},h=>{et(t,[{action:"setAttrViewSorts",avID:h.data.id,data:[{column:i,order:"ASC"}],blockID:r}],[{action:"setAttrViewSorts",avID:h.data.id,data:h.data.view.sorts,blockID:r}])})}}),d.addItem({id:"desc",icon:"iconDown",label:window.siyuan.languages.desc,click(){ae("/api/av/renderAttributeView",{id:s},h=>{et(t,[{action:"setAttrViewSorts",avID:h.data.id,data:[{column:i,order:"DESC"}],blockID:r}],[{action:"setAttrViewSorts",avID:h.data.id,data:h.data.view.sorts,blockID:r}])})}}));const u=n.dataset.pin==="true";if(d.addItem({id:u?"unfreezeCol":"freezeCol",icon:u?"iconUnpin":"iconPin",label:u?window.siyuan.languages.unfreezeCol:window.siyuan.languages.freezeCol,click(){et(t,[{action:"setAttrViewColPin",id:i,avID:s,data:!u,blockID:r}],[{action:"setAttrViewColPin",id:i,avID:s,data:u,blockID:r}]),us(e.querySelector(`.av__row--header .av__cell[data-col-id="${i}"]`),void 0,{pin:!u})}}),a!=="block"&&d.addItem({id:"hide",icon:"iconEyeoff",label:window.siyuan.languages.hide,click(){et(t,[{action:"setAttrViewColHidden",id:i,avID:s,data:!0,blockID:r}],[{action:"setAttrViewColHidden",id:i,avID:s,data:!1,blockID:r}])}}),d.addItem({icon:"iconRefresh",label:window.siyuan.languages.syncColWidth,click(){et(t,[{action:"syncAttrViewTableColWidth",keyID:i,avID:s,id:o}])}}),d.addItem({icon:"iconSoftWrap",label:`<label class="fn__flex fn__pointer"><span>${window.siyuan.languages.wrap}</span><span class="fn__space fn__flex-1"></span>
<input type="checkbox" class="b3-switch b3-switch--menu"${n.dataset.wrap==="true"?" checked":""}></label>`,bind(h){const m=h.querySelector(".b3-switch");m.addEventListener("change",()=>{n.dataset.wrap=m.checked.toString(),et(t,[{action:"setAttrViewColWrap",id:i,avID:s,data:m.checked,blockID:r,viewID:o}],[{action:"setAttrViewColWrap",id:i,avID:s,data:!m.checked,blockID:r,viewID:o}]),d.close()})}}),d.addSeparator({id:"separator_2"}),d.addItem({id:"insertColumnLeft",icon:"iconInsertLeft",label:window.siyuan.languages.insertColumnLeft,click(){var h;const m=Kh(t,e,((h=n.previousElementSibling)==null?void 0:h.getAttribute("data-col-id"))||"");e.contains(n)||(n=e.querySelector(`.av__row--header .av__cell--header[data-col-id="${i}"]`));const b=n.getBoundingClientRect();m.open({x:b.left,y:b.bottom,h:b.height})}}),d.addItem({id:"insertColumnRight",icon:"iconInsertRight",label:window.siyuan.languages.insertColumnRight,click(){const h=Kh(t,e,i);e.contains(n)||(n=e.querySelector(`.av__row--header .av__cell--header[data-col-id="${i}"]`));const m=n.getBoundingClientRect();h.open({x:m.left,y:m.bottom,h:m.height})}}),a!=="block"){let h;a!=="relation"&&d.addItem({id:"duplicate",icon:"iconCopy",label:window.siyuan.languages.duplicate,click(){ae("/api/av/renderAttributeView",{id:s},m=>{aA({blockElement:e,viewID:o,protyle:t,colId:i,data:m.data})})}}),d.addItem({id:"delete",icon:"iconTrashcan",label:window.siyuan.languages.delete,click(){return DF(this,null,function*(){var m;if(a==="relation"){const y=(yield wn("/api/av/getAttributeView",{id:s})).data.av.keyValues.find(_=>_.key.id===i);if((m=y.key.relation)!=null&&m.isTwoWay){const _=yield wn("/api/av/getAttributeView",{id:y.key.relation.avID}),v=new fe({title:window.siyuan.languages.removeColConfirm,content:`<div class="b3-dialog__content">
    ${window.siyuan.languages.confirmRemoveRelationField.replace("${x}",y.key.name||window.siyuan.languages._kernel[272]).replace("${y}",_.data.av.name||window.siyuan.languages._kernel[267]).replace("${z}",_.data.av.keyValues.find(U=>U.key.id===y.key.relation.backKeyID).key.name||window.siyuan.languages._kernel[272])}
    <div class="fn__hr--b"></div>
    <button class="fn__block b3-button b3-button--remove" data-action="delete">${window.siyuan.languages.removeBothRelationField}</button>
    <div class="fn__hr"></div>
    <button class="fn__block b3-button b3-button--remove" data-action="keep-relation">${window.siyuan.languages.removeButKeepRelationField}</button>
    <div class="fn__hr"></div>
    <button class="fn__block b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button>
</div>`,width:"520px"});v.element.addEventListener("click",U=>{let ee=U.target;const Z=typeof U.detail=="string";for(;ee&&ee!==v.element||Z;){const k=ee.getAttribute("data-action");if(k==="delete"||Z&&U.detail==="Enter"){fx({protyle:t,colId:i,avID:s,blockID:r,oldValue:l,type:a,cellElement:n,blockElement:e,removeDest:!0}),v.destroy();break}else if(k==="keep-relation"){fx({protyle:t,colId:i,avID:s,blockID:r,oldValue:l,type:a,cellElement:n,blockElement:e,removeDest:!1}),v.destroy();break}else if(ee.classList.contains("b3-button--cancel")||Z&&U.detail==="Escape"){v.destroy();break}ee=ee.parentElement}}),v.element.querySelector("button").focus(),v.element.setAttribute("data-key",p.DIALOG_CONFIRM);return}}fx({protyle:t,colId:i,avID:s,blockID:r,oldValue:l,type:a,cellElement:n,blockElement:e,removeDest:!1})})}})}const g=n.getBoundingClientRect();d.open({x:g.left,y:g.bottom,h:g.height});const f=window.siyuan.menus.menu.element.querySelector(".b3-text-field");f&&(f.select(),f.focus())},fx=t=>{var e;const n=at().format("YYYYMMDDHHmmss");et(t.protyle,[{action:"removeAttrViewCol",id:t.colId,avID:t.avID,removeDest:t.removeDest},{action:"doUpdateUpdated",id:t.blockID,data:n}],[{action:"addAttrViewCol",name:t.oldValue,avID:t.avID,type:t.type,id:t.colId,previousID:((e=t.cellElement.previousElementSibling)==null?void 0:e.getAttribute("data-col-id"))||""},{action:"doUpdateUpdated",id:t.blockID,data:t.blockElement.getAttribute("updated")}]),HS(t.blockElement,t.colId),t.blockElement.setAttribute("updated",n)},px=t=>{const e=t.menuElement.querySelector(".b3-menu__item").getAttribute("data-col-id");let n="";const a=t.fields.find((s,r)=>{var o;if(s.id===e)return n=(o=t.fields[r-1])==null?void 0:o.id,t.fields.splice(r,1),!0}),i=at().format("YYYYMMDDHHmmss");et(t.protyle,[{action:"removeAttrViewCol",id:e,avID:t.avID,removeDest:t.isTwoWay},{action:"doUpdateUpdated",id:t.blockID,data:i}],[{action:"addAttrViewCol",name:a.name,avID:t.avID,type:a.type,id:e,previousID:n},{action:"doUpdateUpdated",id:t.blockID,data:t.blockElement.getAttribute("updated")}]),HS(t.blockElement,e),t.blockElement.setAttribute("updated",i),t.isCustomAttr?t.avPanelElement.remove():(t.menuElement.innerHTML=rc(t.fields),gn(t.menuElement,t.tabRect.right-t.menuElement.clientWidth,t.tabRect.bottom,t.tabRect.height))},ps=(t,e)=>`<button class="b3-menu__item" data-type="updateColType" data-old-type="${e}" data-new-type="${t}">
    <svg class="b3-menu__icon"><use xlink:href="#${za(t)}"></use></svg>
    <span class="b3-menu__label">${Wo(t)}</span>
    ${t===e?'<svg class="b3-menu__checked"><use xlink:href="#iconSelect"></use></svg></span>':""}
</button>`,Kh=(t,e,n)=>{const a=new ta(p.MENU_AV_HEADER_ADD),i=e.getAttribute("data-av-id");typeof n=="undefined"&&e.getAttribute("data-av-type")==="table"&&(n=Array.from(e.querySelectorAll(".av__row--header .av__cell")).pop().getAttribute("data-col-id"));const s=e.getAttribute("data-node-id");return a.addItem({id:"text",icon:"iconAlignLeft",label:window.siyuan.languages.text,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.text,avID:i,type:"text",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"text",name:window.siyuan.languages.text,id:r,previousID:n}),e.setAttribute("updated",o)}}),a.addItem({id:"number",icon:"iconNumber",label:window.siyuan.languages.number,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.number,avID:i,type:"number",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"number",name:window.siyuan.languages.number,id:r,previousID:n}),e.setAttribute("updated",o)}}),a.addItem({id:"select",icon:"iconListItem",label:window.siyuan.languages.select,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.select,avID:i,type:"select",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"select",name:window.siyuan.languages.select,id:r,previousID:n}),e.setAttribute("updated",o)}}),a.addItem({id:"multiSelect",icon:"iconList",label:window.siyuan.languages.multiSelect,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.multiSelect,avID:i,type:"mSelect",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"mSelect",name:window.siyuan.languages.multiSelect,id:r,previousID:n}),e.setAttribute("updated",o)}}),a.addItem({id:"date",icon:"iconCalendar",label:window.siyuan.languages.date,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.date,avID:i,type:"date",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"date",name:window.siyuan.languages.date,id:r,previousID:n}),e.setAttribute("updated",o)}}),a.addItem({id:"assets",icon:"iconImage",label:window.siyuan.languages.assets,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.assets,avID:i,type:"mAsset",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"mAsset",name:window.siyuan.languages.assets,id:r,previousID:n}),e.setAttribute("updated",o)}}),a.addItem({id:"checkbox",icon:"iconCheck",label:window.siyuan.languages.checkbox,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.checkbox,avID:i,type:"checkbox",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"checkbox",name:window.siyuan.languages.checkbox,id:r,previousID:n}),e.setAttribute("updated",o)}}),a.addItem({id:"link",icon:"iconLink",label:window.siyuan.languages.link,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.link,avID:i,type:"url",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"url",name:window.siyuan.languages.link,id:r,previousID:n}),e.setAttribute("updated",o)}}),a.addItem({id:"email",icon:"iconEmail",label:window.siyuan.languages.email,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.email,avID:i,type:"email",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"email",name:window.siyuan.languages.email,id:r,previousID:n}),e.setAttribute("updated",o)}}),a.addItem({id:"phone",icon:"iconPhone",label:window.siyuan.languages.phone,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.phone,avID:i,type:"phone",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"phone",name:window.siyuan.languages.phone,id:r,previousID:n}),e.setAttribute("updated",o)}}),a.addItem({id:"template",icon:"iconMath",label:window.siyuan.languages.template,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.template,avID:i,type:"template",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"template",name:window.siyuan.languages.template,id:r,previousID:n}),e.setAttribute("updated",o)}}),a.addItem({id:"relation",icon:"iconOpen",label:window.siyuan.languages.relation,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.relation,avID:i,type:"relation",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"relation",name:window.siyuan.languages.relation,id:r,previousID:n}),e.setAttribute("updated",o)}}),a.addItem({id:"rollup",icon:"iconSearch",label:window.siyuan.languages.rollup,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.rollup,avID:i,type:"rollup",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"rollup",name:window.siyuan.languages.rollup,id:r,previousID:n}),e.setAttribute("updated",o)}}),a.addItem({id:"lineNumber",icon:"iconOrderedList",label:window.siyuan.languages.lineNumber,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.lineNumber,avID:i,type:"lineNumber",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"lineNumber",name:window.siyuan.languages.lineNumber,id:r,previousID:n}),e.setAttribute("updated",o)}}),a.addItem({id:"createdTime",icon:"iconClock",label:window.siyuan.languages.createdTime,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.createdTime,avID:i,type:"created",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"created",name:window.siyuan.languages.createdTime,id:r,previousID:n}),e.setAttribute("updated",o)}}),a.addItem({id:"updatedTime",icon:"iconClock",label:window.siyuan.languages.updatedTime,click(){const r=Lute.NewNodeID(),o=at().format("YYYYMMDDHHmmss");et(t,[{action:"addAttrViewCol",name:window.siyuan.languages.updatedTime,avID:i,type:"updated",id:r,previousID:n},{action:"doUpdateUpdated",id:s,data:o}],[{action:"removeAttrViewCol",id:r,avID:i},{action:"doUpdateUpdated",id:s,data:e.getAttribute("updated")}]),ts({blockElement:e,protyle:t,type:"updated",name:window.siyuan.languages.updatedTime,id:r,previousID:n}),e.setAttribute("updated",o)}}),a},CF=(t,e,n)=>({hidden:!1,icon:"",id:e,name:n,desc:"",numberFormat:"",pin:!1,template:"",type:t,width:"",wrap:void 0,calc:null});var LF=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const IF=(t,e)=>{let n="";return["mSelect","select"].includes(t.groupValue.type)?t.groupValue.mSelect.forEach(a=>{n+=`<span class="b3-chip" style="background-color:var(--b3-font-background${a.color});color:var(--b3-font-color${a.color})">${he(a.content)}</span>`}):t.groupValue.type==="checkbox"?n=`<svg style="width:calc(1.625em - 12px);height:calc(1.625em - 12px);margin: 4px 0;float: left;"><use xlink:href="#icon${t.groupValue.checkbox.checked?"Check":"Uncheck"}"></use></svg>`:n=t.name,`<div class="av__group-title">
    <span class="av__group-name fn__ellipsis" style="white-space: nowrap;">${n}</span>
    ${e===0?'<span class="fn__space"></span>':`<span aria-label="${window.siyuan.languages.entryNum}" data-position="north" class="av__group-counter ariaLabel">${e}</span>`}
    <span class="fn__flex-1"></span>
    <span class="av__group-icon av__group-icon--hover ariaLabel" data-type="av-add-top" data-position="north" aria-label="${window.siyuan.languages.newRow}"><svg><use xlink:href="#iconAdd"></use></svg></span>
</div>`},MF=t=>{let e="";return t.cards.forEach((n,a)=>{if(e+=`<div data-id="${n.id}" draggable="true" class="av__gallery-item">`,t.coverFrom!==0){const i="av__gallery-cover av__gallery-cover--"+t.cardAspectRatio;n.coverURL?n.coverURL.startsWith("background")?e+=`<div class="${i}"><img class="av__gallery-img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" style="${n.coverURL}"></div>`:e+=`<div class="${i}"><img loading="lazy" class="av__gallery-img${t.fitImage?" av__gallery-img--fit":""}" src="${qh(n.coverURL)}"></div>`:n.coverContent.trim()&&(e+=`<div class="${i}"><div class="av__gallery-content">${n.coverContent}</div><div></div></div>`)}e+='<div class="av__gallery-fields">',n.values.forEach((i,s)=>{var r,o,l;if(t.fields[s].hidden)return;let c="";i.valueType==="checkbox"&&(c=(o=(r=i.value)==null?void 0:r.checkbox)!=null&&o.checked?" av__cell-check":" av__cell-uncheck");const d=dx(i.value);let u=ft(t.fields[s].name)||Wo(t.fields[s].type);t.fields[s].desc&&(u+=ft(`<div class="ft__on-surface">${t.fields[s].desc}</div>`)),i.valueType==="checkbox"&&!t.displayFieldName&&(i.value.checkbox.content=t.fields[s].name||Wo(t.fields[s].type));const g=`<div class="av__cell${c}${t.displayFieldName?"":" ariaLabel"}" 
data-wrap="${t.fields[s].wrap}" 
aria-label="${u}" 
data-position="5west"
data-id="${i.id}" 
data-field-id="${t.fields[s].id}" 
data-dtype="${i.valueType}" 
${(l=i.value)!=null&&l.isDetached?' data-detached="true"':""} 
style="${i.bgColor?`background-color:${i.bgColor};`:""}
${i.color?`color:${i.color};`:""}">${ho(i.value,a,t.showIcon,"kanban")}</div>`;t.displayFieldName?e+=`<div class="av__gallery-field av__gallery-field--name" data-empty="${d}">
    <div class="av__gallery-name">
        ${t.fields[s].icon?Yt(t.fields[s].icon,void 0,!0):`<svg><use xlink:href="#${za(t.fields[s].type)}"></use></svg>`}${Lute.EscapeHTMLStr(t.fields[s].name)}
        ${t.fields[s].desc?`<svg aria-label="${t.fields[s].desc}" data-position="north" class="ariaLabel"><use xlink:href="#iconInfo"></use></svg>`:""}
    </div>
    ${g}
</div>`:e+=`<div class="av__gallery-field" data-empty="${d}">
    <div class="av__gallery-tip">
        ${t.fields[s].icon?Yt(t.fields[s].icon,void 0,!0):`<svg><use xlink:href="#${za(t.fields[s].type)}"></use></svg>`}${window.siyuan.languages.edit} ${Lute.EscapeHTMLStr(t.fields[s].name)}
    </div>
    ${g}
</div>`}),e+=`</div>
    <div class="av__gallery-actions">
        <span class="protyle-icon protyle-icon--first b3-tooltips b3-tooltips__n" aria-label="${window.siyuan.languages.displayEmptyFields}" data-type="av-gallery-edit"><svg><use xlink:href="#iconEdit"></use></svg></span>
        <span class="protyle-icon protyle-icon--last b3-tooltips b3-tooltips__n" aria-label="${window.siyuan.languages.more}" data-type="av-gallery-more"><svg><use xlink:href="#iconMore"></use></svg></span>
    </div>
</div>`}),e+=`<div class="av__gallery-add" data-type="av-add-bottom"><svg class="svg"><use xlink:href="#iconAdd"></use></svg><span class="fn__space"></span>${window.siyuan.languages.newRow}</div>`,`<div class="av__gallery av__gallery--small">
    ${e}
</div>
<div class="av__gallery-load${t.cardCount>t.cards.length?"":" fn__none"}">
    <button class="b3-button av__button" data-type="av-load-more">
        <svg><use xlink:href="#iconArrowDown"></use></svg>
        <span>${window.siyuan.languages.loadMore}</span>
        <svg data-type="set-page-size" data-size="${t.pageSize}"><use xlink:href="#iconMore"></use></svg>
    </button>
</div>`},hx=t=>LF(void 0,null,function*(){var e,n,a;const i=t.blockElement.querySelector('[data-type="av-search"]'),s=[];t.blockElement.querySelectorAll(".av__gallery-fields--edit").forEach(m=>{s.push({groupId:N(m,"av__body").dataset.groupId||"",fieldId:m.parentElement.getAttribute("data-id")})});const r=[];t.blockElement.querySelectorAll(".av__gallery-item--select").forEach(m=>{const b=m.getAttribute("data-id");b&&r.push({groupId:N(m,"av__body").dataset.groupId||"",fieldId:b})});const o={};t.blockElement.querySelectorAll(".av__body").forEach(m=>{o[m.dataset.groupId||"unGroup"]=m.dataset.pageSize});const l={isSearching:i&&document.activeElement===i,query:(i==null?void 0:i.value)||"",alignSelf:t.blockElement.style.alignSelf,oldOffset:t.protyle.contentElement.scrollTop,editIds:s,selectItemIds:r,pageSizes:o,left:(e=t.blockElement.querySelector(".av__kanban"))==null?void 0:e.scrollLeft};t.blockElement.firstElementChild.innerHTML===""&&(t.blockElement.style.alignSelf="",t.blockElement.firstElementChild.outerHTML=`<div class="av__kanban fn__flex">
    <span style="width: 260px;height: 178px;" class="av__pulse"></span>
    <span style="width: 260px;height: 178px;" class="av__pulse"></span>
    <span style="width: 260px;height: 178px;" class="av__pulse"></span>
</div>`);const c=(n=t.protyle.options.history)==null?void 0:n.created,d=(a=t.protyle.options.history)==null?void 0:a.snapshot;let u=t.data;if(!u){const m=d_(t.blockElement);u=(yield wn(c?"/api/av/renderHistoryAttributeView":d?"/api/av/renderSnapshotAttributeView":"/api/av/renderAttributeView",{id:t.blockElement.getAttribute("data-av-id"),created:c,snapshot:d,pageSize:m.unGroupPageSize,groupPaging:m.groupPageSize,viewID:t.blockElement.getAttribute(p.CUSTOM_SY_AV_VIEW)||"",query:l.query.trim()})).data}if(u.viewType==="table"){t.blockElement.setAttribute("data-av-type","table"),Ua(t.blockElement,t.protyle,t.cb,t.renderAll,u);return}if(u.viewType==="gallery"){t.blockElement.setAttribute("data-av-type",u.viewType),mx({blockElement:t.blockElement,protyle:t.protyle,cb:t.cb,renderAll:t.renderAll,data:u});return}const g=u.view;let f="",h=!1;if(g.groups.forEach(m=>{var b;if(m.groupHidden===0){let y="";m.fillColBackgroundColor&&(["mSelect","select"].includes(m.groupValue.type)&&(h=!0),h&&(m.groupValue.mSelect&&m.groupValue.mSelect.length>0?y=`style="--b3-av-kanban-background: var(--b3-font-background${m.groupValue.mSelect[0].color});"`:y='style="--b3-av-kanban-background: var(--b3-border-color);"')),f+=`<div class="av__kanban-group${m.cardSize===0?" av__kanban-group--small":m.cardSize===2?" av__kanban-group--big":""}"${y}>
    ${IF(m,m.cardCount)}
    <div data-group-id="${m.id}" data-page-size="${m.pageSize}" data-dtype="${m.groupKey.type}" data-content="${Lute.EscapeHTMLStr(((b=m.groupValue.text)==null?void 0:b.content)||"")}" class="av__body">${MF(m)}</div>
</div>`}}),t.renderAll)t.blockElement.firstElementChild.outerHTML=`<div class="av__container fn__block">
    ${Xh(u,l.isSearching||!!l.query,!t.protyle.disabled&&!ue(t.blockElement,"data-type","NodeBlockQueryEmbed"))}
    <div class="av__kanban${h?" av__kanban--bg":""}">
        ${f}
    </div>
    <div class="av__cursor" contenteditable="true">${p.ZWSP}</div>
</div>`;else{const m=t.blockElement.querySelector(".av__kanban");m.innerHTML=f,h?m.classList.add("av__kanban--bg"):m.classList.remove("av__kanban--bg")}gx({resetData:l,renderAll:t.renderAll,data:u,cb:t.cb,protyle:t.protyle,blockElement:t.blockElement}),g.hideAttrViewName&&t.blockElement.querySelector(".av__gallery").classList.add("av__gallery--top")});var FF=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const sA=t=>{let e="";return t.cards.forEach((n,a)=>{if(e+=`<div data-id="${n.id}" draggable="true" class="av__gallery-item">`,t.coverFrom!==0){const i="av__gallery-cover av__gallery-cover--"+t.cardAspectRatio;n.coverURL?n.coverURL.startsWith("background")?e+=`<div class="${i}"><img class="av__gallery-img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" style="${n.coverURL}"></div>`:e+=`<div class="${i}"><img loading="lazy" class="av__gallery-img${t.fitImage?" av__gallery-img--fit":""}" src="${qh(n.coverURL)}"></div>`:n.coverContent?e+=`<div class="${i}"><div class="av__gallery-content">${n.coverContent}</div><div></div></div>`:e+=`<div class="${i}"></div>`}e+='<div class="av__gallery-fields">',n.values.forEach((i,s)=>{var r,o,l;if(t.fields[s].hidden)return;let c="";i.valueType==="checkbox"&&(c=(o=(r=i.value)==null?void 0:r.checkbox)!=null&&o.checked?" av__cell-check":" av__cell-uncheck");const d=dx(i.value);let u=ft(t.fields[s].name)||Wo(t.fields[s].type);t.fields[s].desc&&(u+=ft(`<div class="ft__on-surface">${t.fields[s].desc}</div>`)),i.valueType==="checkbox"&&!t.displayFieldName&&(i.value.checkbox.content=t.fields[s].name||Wo(t.fields[s].type));const g=`<div class="av__cell${c}${t.displayFieldName?"":" ariaLabel"}" 
data-wrap="${t.fields[s].wrap}" 
aria-label="${u}" 
data-position="5west"
data-id="${i.id}" 
data-field-id="${t.fields[s].id}" 
data-dtype="${i.valueType}" 
${(l=i.value)!=null&&l.isDetached?' data-detached="true"':""} 
style="${i.bgColor?`background-color:${i.bgColor};`:""}
${i.color?`color:${i.color};`:""}">${ho(i.value,a,t.showIcon,"gallery")}</div>`;t.displayFieldName?e+=`<div class="av__gallery-field av__gallery-field--name" data-empty="${d}">
    <div class="av__gallery-name">
        ${t.fields[s].icon?Yt(t.fields[s].icon,void 0,!0):`<svg><use xlink:href="#${za(t.fields[s].type)}"></use></svg>`}${Lute.EscapeHTMLStr(t.fields[s].name)}
        ${t.fields[s].desc?`<svg aria-label="${t.fields[s].desc}" data-position="north" class="ariaLabel"><use xlink:href="#iconInfo"></use></svg>`:""}
    </div>
    ${g}
</div>`:e+=`<div class="av__gallery-field" data-empty="${d}">
    <div class="av__gallery-tip">
        ${t.fields[s].icon?Yt(t.fields[s].icon,void 0,!0):`<svg><use xlink:href="#${za(t.fields[s].type)}"></use></svg>`}${window.siyuan.languages.edit} ${Lute.EscapeHTMLStr(t.fields[s].name)}
    </div>
    ${g}
</div>`}),e+=`</div>
    <div class="av__gallery-actions">
        <span class="protyle-icon protyle-icon--first b3-tooltips b3-tooltips__n" aria-label="${window.siyuan.languages.displayEmptyFields}" data-type="av-gallery-edit"><svg><use xlink:href="#iconEdit"></use></svg></span>
        <span class="protyle-icon protyle-icon--last b3-tooltips b3-tooltips__n" aria-label="${window.siyuan.languages.more}" data-type="av-gallery-more"><svg><use xlink:href="#iconMore"></use></svg></span>
    </div>
</div>`}),e+=`<div class="av__gallery-add" data-type="av-add-bottom"><svg class="svg"><use xlink:href="#iconAdd"></use></svg><span class="fn__space"></span>${window.siyuan.languages.newRow}</div>`,`<div class="av__gallery${t.cardSize===0?" av__gallery--small":t.cardSize===2?" av__gallery--big":""}">
    ${e}
</div>
<div class="av__gallery-load${t.cardCount>t.cards.length?"":" fn__none"}">
    <button class="b3-button av__button" data-type="av-load-more">
        <svg><use xlink:href="#iconArrowDown"></use></svg>
        <span>${window.siyuan.languages.loadMore}</span>
        <svg data-type="set-page-size" data-size="${t.pageSize}"><use xlink:href="#iconMore"></use></svg>
    </button>
</div>`},PF=t=>{const e=t.blockElement.querySelector('[data-type="av-search"]'),n=e&&document.activeElement===e,a=(e==null?void 0:e.value)||"";let i="";t.data.view.groups.forEach(s=>{var r;s.groupHidden===0&&(i+=`${oA(s,s.cardCount)}
<div data-group-id="${s.id}" data-page-size="${s.pageSize}" data-dtype="${s.groupKey.type}" data-content="${Lute.EscapeHTMLStr(((r=s.groupValue.text)==null?void 0:r.content)||"")}" class="av__body${s.groupFolded?" fn__none":""}">${sA(s)}</div>`)}),t.renderAll?t.blockElement.firstElementChild.outerHTML=`<div class="av__container fn__block">
    ${Xh(t.data,n||!!a,!t.protyle.disabled&&!ue(t.blockElement,"data-type","NodeBlockQueryEmbed"))}
    <div>
        ${i}
    </div>
    <div class="av__cursor" contenteditable="true">${p.ZWSP}</div>
</div>`:t.blockElement.querySelector(".av__header").nextElementSibling.innerHTML=i,gx(t)},gx=t=>{const e=t.data.view;if((e.coverFrom===1||e.coverFrom===3)&&zn(t.blockElement),typeof t.resetData.oldOffset=="number"&&(t.protyle.contentElement.scrollTop=t.resetData.oldOffset),t.blockElement.getAttribute("data-need-focus")==="true"&&(qt(t.blockElement),t.blockElement.removeAttribute("data-need-focus")),t.blockElement.setAttribute("data-render","true"),t.resetData.alignSelf&&(t.blockElement.style.alignSelf=t.resetData.alignSelf),t.resetData.left&&(t.blockElement.querySelector(".av__kanban").scrollLeft=t.resetData.left),t.resetData.selectItemIds.find(i=>{let s=t.blockElement.querySelector(`.av__body[data-group-id="${i.groupId}"] .av__gallery-item[data-id="${i.fieldId}"]`);s||(s=t.blockElement.querySelector(`.av__gallery-item[data-id="${i.fieldId}"]`)),s&&s.classList.add("av__gallery-item--select")}),t.resetData.editIds.find(i=>{let s=t.blockElement.querySelector(`.av__body[data-group-id="${i.groupId}"] .av__gallery-item[data-id="${i.fieldId}"]`);s||(s=t.blockElement.querySelector(`.av__gallery-item[data-id="${i.fieldId}"]`)),s&&(s.querySelector(".av__gallery-fields").classList.add("av__gallery-fields--edit"),s.querySelector('.protyle-icon[data-type="av-gallery-edit"]').setAttribute("aria-label",window.siyuan.languages.hideEmptyFields))}),Object.keys(t.resetData.pageSizes).forEach(i=>{const s=t.blockElement.querySelector(`.av__body[data-group-id="${i==="unGroup"?"":i}"]`);s&&(s.dataset.pageSize=t.resetData.pageSizes[i])}),getSelection().rangeCount>0){const i=getSelection().getRangeAt(0);if(!N(i.startContainer,"av__title")){const s=oe(i.startContainer);s&&t.blockElement===s&&!t.resetData.isSearching&&qt(t.blockElement)}}if(t.blockElement.querySelector(".layout-tab-bar").scrollLeft=t.blockElement.querySelector(".layout-tab-bar .item--focus").offsetLeft-30,t.cb&&t.cb(t.data),!t.renderAll)return;const n=t.blockElement.querySelector(".av__views"),a=t.blockElement.querySelector('[data-type="av-search"]');a.value=t.resetData.query||"",t.resetData.isSearching&&a.focus(),a.addEventListener("compositionstart",i=>{i.stopPropagation()}),a.addEventListener("keydown",i=>{i.isComposing||uo(i)}),a.addEventListener("input",i=>{i.stopPropagation(),!i.isComposing&&(a.value||document.activeElement===a?n.classList.add("av__views--show"):n.classList.remove("av__views--show"),$f(t.blockElement,t.protyle))}),a.addEventListener("compositionend",()=>{$f(t.blockElement,t.protyle)}),a.addEventListener("blur",i=>{i.isComposing||a.value||(n.classList.remove("av__views--show"),a.style.width="0",a.style.paddingLeft="0",a.style.paddingRight="0")}),Bh({inputElement:a,right:0,width:"1em",height:a.clientHeight,clearCB(){n.classList.remove("av__views--show"),a.style.width="0",a.style.paddingLeft="0",a.style.paddingRight="0",qt(t.blockElement),$f(t.blockElement,t.protyle)}})},mx=t=>FF(void 0,null,function*(){var e,n,a;const i=t.blockElement.querySelector('[data-type="av-search"]'),s=[];t.blockElement.querySelectorAll(".av__gallery-fields--edit").forEach(h=>{s.push({groupId:N(h,"av__body").dataset.groupId||"",fieldId:h.parentElement.getAttribute("data-id")})});const r=[];t.blockElement.querySelectorAll(".av__gallery-item--select").forEach(h=>{const m=h.getAttribute("data-id");m&&r.push({groupId:N(h,"av__body").dataset.groupId||"",fieldId:m})});const o={};t.blockElement.querySelectorAll(".av__body").forEach(h=>{o[h.dataset.groupId||"unGroup"]=h.dataset.pageSize});const l={isSearching:i&&document.activeElement===i,query:(i==null?void 0:i.value)||"",alignSelf:t.blockElement.style.alignSelf,oldOffset:t.protyle.contentElement.scrollTop,editIds:s,selectItemIds:r,pageSizes:o};t.blockElement.firstElementChild.innerHTML===""&&(t.blockElement.style.alignSelf="",t.blockElement.firstElementChild.outerHTML=`<div class="av__gallery">
    <span style="width: 100%;height: 178px;" class="av__pulse"></span>
    <span style="width: 100%;height: 178px;" class="av__pulse"></span>
    <span style="width: 100%;height: 178px;" class="av__pulse"></span>
</div>`);const c=(e=t.protyle.options.history)==null?void 0:e.created,d=(n=t.protyle.options.history)==null?void 0:n.snapshot;let u=t.data;if(!u){const h=d_(t.blockElement);u=(yield wn(c?"/api/av/renderHistoryAttributeView":d?"/api/av/renderSnapshotAttributeView":"/api/av/renderAttributeView",{id:t.blockElement.getAttribute("data-av-id"),created:c,snapshot:d,pageSize:h.unGroupPageSize,groupPaging:h.groupPageSize,viewID:t.blockElement.getAttribute(p.CUSTOM_SY_AV_VIEW)||"",query:l.query.trim()})).data}if(u.viewType==="table"){t.blockElement.setAttribute("data-av-type",u.viewType),Ua(t.blockElement,t.protyle,t.cb,t.renderAll,u);return}if(u.viewType==="kanban"){t.blockElement.setAttribute("data-av-type",u.viewType),hx({blockElement:t.blockElement,protyle:t.protyle,cb:t.cb,renderAll:t.renderAll,data:u});return}const g=u.view;if(((a=g.groups)==null?void 0:a.length)>0){PF({blockElement:t.blockElement,protyle:t.protyle,cb:t.cb,renderAll:t.renderAll,data:u,resetData:l});return}const f=sA(g);if(t.renderAll)t.blockElement.firstElementChild.outerHTML=`<div class="av__container fn__block">
    ${Xh(u,l.isSearching||!!l.query,!t.protyle.disabled&&!ue(t.blockElement,"data-type","NodeBlockQueryEmbed"))}
    <div>
        <div class="av__body" data-group-id="" data-page-size="${g.pageSize}">
            ${f}
        </div>
    </div>
    <div class="av__cursor" contenteditable="true">${p.ZWSP}</div>
</div>`;else{const h=t.blockElement.querySelector(".av__body");h.innerHTML=f,h.dataset.pageSize=g.pageSize.toString()}gx({resetData:l,renderAll:t.renderAll,data:u,cb:t.cb,protyle:t.protyle,blockElement:t.blockElement}),g.hideAttrViewName&&t.blockElement.querySelector(".av__gallery").classList.add("av__gallery--top")});var NF=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const Xh=(t,e,n)=>{let a="",i,s=!1;return ma(t).forEach(r=>{s||t.view.filters.find(o=>{if(o.value.type===r.type&&r.id===o.column)return s=!0,!0})}),t.views.forEach(r=>{a+=`<div draggable="true" data-position="north" data-av-type="${r.type}" data-id="${r.id}" data-page="${r.pageSize}" data-desc="${Ot(r.desc||"")}" class="ariaLabel item${r.id===t.viewID?" item--focus":""}">
    ${r.icon?Yt(r.icon,"item__graphic",!0):`<svg class="item__graphic"><use xlink:href="#${Uy(r.type)}"></use></svg>`}
    <span class="item__text">${he(r.name)}</span>
</div>`,r.id===t.viewID&&(i=r)}),`<div class="av__header">
        <div class="fn__flex av__views${e?" av__views--show":""}">
            <div class="layout-tab-bar fn__flex">
                ${a}
            </div>
            <div class="fn__space"></div>
            <span data-type="av-add" class="block__icon ariaLabel" data-position="8south" aria-label="${window.siyuan.languages.newView}">
                <svg><use xlink:href="#iconAdd"></use></svg>
            </span>
            <div class="fn__flex-1"></div>
            <div class="fn__space"></div>
            <span data-type="av-switcher" aria-label="${window.siyuan.languages.allViews}" data-position="8south" class="ariaLabel block__icon${t.views.length>0?"":" fn__none"}">
                <svg><use xlink:href="#iconDown"></use></svg>
                <span class="fn__space"></span>
                <small>${t.views.length}</small>
            </span>
            <div class="fn__space"></div>
            <span data-type="av-filter" aria-label="${window.siyuan.languages.filter}" data-position="8south" class="ariaLabel block__icon${s?" block__icon--active":""}">
                <svg><use xlink:href="#iconFilter"></use></svg>
            </span>
            <div class="fn__space"></div>
            <span data-type="av-sort" aria-label="${window.siyuan.languages.sort}" data-position="8south" class="ariaLabel block__icon${t.view.sorts.length>0?" block__icon--active":""}">
                <svg><use xlink:href="#iconSort"></use></svg>
            </span>
            <div class="fn__space"></div>
            <button data-type="av-search-icon" aria-label="${window.siyuan.languages.search}" data-position="8south" class="ariaLabel block__icon">
                <svg><use xlink:href="#iconSearch"></use></svg>
            </button>
            <div style="position: relative" class="fn__flex">
                <input style="${e?"width:128px":"width:0;padding-left: 0;padding-right: 0;"}" data-type="av-search" class="b3-text-field b3-text-field--text" placeholder="${window.siyuan.languages.search}">
            </div>
            <div class="fn__space"></div>
            <span data-type="av-more" aria-label="${window.siyuan.languages.config}" data-position="8south" class="ariaLabel block__icon">
                <svg><use xlink:href="#iconSettings"></use></svg>
            </span>
            <div class="fn__space"></div>
            <span data-type="av-add-more" class="block__icon ariaLabel" data-position="8south" aria-label="${window.siyuan.languages.newRow}">
                <svg><use xlink:href="#iconAdd"></use></svg>
            </span>
            <div class="fn__space"></div>
            ${t.isMirror?` <span data-av-id="${t.id}" data-popover-url="/api/av/getMirrorDatabaseBlocks" class="popover__block block__icon block__icon--show ariaLabel" data-position="8south" aria-label="${window.siyuan.languages.mirrorTip}">
    <svg><use xlink:href="#iconSplitLR"></use></svg></span><div class="fn__space"></div>`:""}
        </div>
        <div contenteditable="${n}" spellcheck="${window.siyuan.config.editor.spellcheck.toString()}" class="av__title${i.hideAttrViewName?" fn__none":""}" data-title="${t.name||""}" data-tip="${window.siyuan.languages._kernel[267]}">${t.name||""}</div>
        <div class="av__counter fn__none"></div>
    </div>`},rA=(t,e)=>{let n="",a='<div class="av__row av__row--header"><div class="av__colsticky"><div class="av__firstcol"><svg><use xlink:href="#iconUncheck"></use></svg></div></div>',i=-1,s=-1,r=0;const o=e.clientWidth;t.columns.forEach((c,d)=>{c.hidden||(c.pin&&(i=d),r<o-200&&(r+=parseInt(c.width)||200,s=d))}),o===0&&(s=i),i=Math.min(i,s),i>-1&&(a='<div class="av__row av__row--header"><div class="av__colsticky"><div class="av__firstcol"><svg><use xlink:href="#iconUncheck"></use></svg></div>',n='<div class="av__colsticky">');let l=!1;return t.columns.forEach((c,d)=>{var u;c.hidden||(a+=`<div class="av__cell av__cell--header" data-col-id="${c.id}"  draggable="true" 
data-icon="${c.icon}" data-dtype="${c.type}" data-wrap="${c.wrap}" data-pin="${c.pin}" 
data-desc="${ft(c.desc)}" data-position="north" 
style="width: ${c.width||"200px"};">
    ${c.icon?Yt(c.icon,"av__cellheadericon",!0):`<svg class="av__cellheadericon"><use xlink:href="#${za(c.type)}"></use></svg>`}
    <span class="av__celltext fn__flex-1">${he(c.name)}</span>
    ${c.pin?'<svg class="av__cellheadericon av__cellheadericon--pin"><use xlink:href="#iconPin"></use></svg>':""}
    <div class="av__widthdrag"></div>
</div>`,i===d&&(a+="</div>"),c.type==="lineNumber"?n+=`<div data-col-id="${c.id}" data-dtype="${c.type}" class="av__calc" style="width: ${c.width||"200px"}">&nbsp;</div>`:n+=`<div class="av__calc${c.calc&&c.calc.operator!==""?" av__calc--ashow":""}" data-col-id="${c.id}" data-dtype="${c.type}" data-operator="${((u=c.calc)==null?void 0:u.operator)||""}" 
style="width: ${c.width||"200px"}">${eF(c)||`<svg><use xlink:href="#iconDown"></use></svg><small>${window.siyuan.languages.calc}</small>`}</div>`,c.calc&&c.calc.operator!==""&&(l=!0),i===d&&(n+="</div>"))}),a+=`<div class="block__icons" style="min-height: auto">
    <div class="block__icon block__icon--show" data-type="av-header-more"><svg><use xlink:href="#iconMore"></use></svg></div>
    <div class="fn__space"></div>
    <div class="block__icon block__icon--show ariaLabel" aria-label="${window.siyuan.languages.newCol}" data-type="av-header-add" data-position="4south"><svg><use xlink:href="#iconAdd"></use></svg></div>
</div>
</div>`,t.rows.forEach((c,d)=>{a+=`<div class="av__row" data-id="${c.id}">`,i>-1?a+='<div class="av__colsticky"><div class="av__firstcol"><svg><use xlink:href="#iconUncheck"></use></svg></div>':a+='<div class="av__colsticky"><div class="av__firstcol"><svg><use xlink:href="#iconUncheck"></use></svg></div></div>',c.cells.forEach((u,g)=>{var f,h,m;if(t.columns[g].hidden)return;let b="";u.valueType==="checkbox"&&(b=(h=(f=u.value)==null?void 0:f.checkbox)!=null&&h.checked?" av__cell-check":" av__cell-uncheck"),a+=`<div class="av__cell${b}" data-id="${u.id}" data-col-id="${t.columns[g].id}" 
data-wrap="${t.columns[g].wrap}" 
data-dtype="${t.columns[g].type}" 
${(m=u.value)!=null&&m.isDetached?' data-detached="true"':""} 
style="width: ${t.columns[g].width||"200px"};
${u.valueType==="number"?"text-align: right;":""}
${u.bgColor?`background-color:${u.bgColor};`:""}
${u.color?`color:${u.color};`:""}">${ho(u.value,d,t.showIcon)}</div>`,i===g&&(a+="</div>")}),a+="<div></div></div>"}),`${a}<div class="av__row--util${t.rowCount>t.rows.length?" av__readonly--show":""}">
    <div class="av__colsticky">
        <button class="b3-button av__button" data-type="av-add-bottom">
            <svg><use xlink:href="#iconAdd"></use></svg>
            <span>${window.siyuan.languages.newRow}</span>
        </button>
        <span class="fn__space"></span>
        <button class="b3-button av__button${t.rowCount>t.rows.length?"":" fn__none"}" data-type="av-load-more">
            <svg><use xlink:href="#iconArrowDown"></use></svg>
            <span>${window.siyuan.languages.loadMore}</span>
            <svg data-type="set-page-size" data-size="${t.pageSize}"><use xlink:href="#iconMore"></use></svg>
        </button>
    </div>
</div>
<div class="av__row--footer${l?" av__readonly--show":""}">${n}</div>`},oA=(t,e)=>{let n="";return["mSelect","select"].includes(t.groupValue.type)?t.groupValue.mSelect.forEach(a=>{n+=`<span class="b3-chip" style="background-color:var(--b3-font-background${a.color});color:var(--b3-font-color${a.color})">${he(a.content)}</span>`}):t.groupValue.type==="checkbox"?n=`<svg style="width:calc(1.625em - 12px);height:calc(1.625em - 12px)"><use xlink:href="#icon${t.groupValue.checkbox.checked?"Check":"Uncheck"}"></use></svg>`:n=t.name,`<div class="av__group-title">
    <div class="av__group-icon" data-type="av-group-fold" data-id="${t.id}">
        <svg class="${t.groupFolded?"":"av__group-arrow--open"}"><use xlink:href="#iconRight"></use></svg>
    </div>
    <span class="fn__space"></span>
    <span class="av__group-name">${n}</span>
    ${e===0?'<span class="fn__space"></span>':`<span aria-label="${window.siyuan.languages.entryNum}" data-position="north" class="av__group-counter ariaLabel">${e}</span>`}
    <span class="av__group-icon av__group-icon--hover ariaLabel" data-type="av-add-top" data-position="north" aria-label="${window.siyuan.languages.newRow}"><svg><use xlink:href="#iconAdd"></use></svg></span>
</div>`},BF=t=>{const e=t.blockElement.querySelector('[data-type="av-search"]'),n=e&&document.activeElement===e,a=(e==null?void 0:e.value)||"";let i="";t.data.view.groups.forEach(s=>{var r;s.groupHidden===0&&(i+=`${oA(s,s.rowCount)}
<div data-group-id="${s.id}" data-page-size="${s.pageSize}" data-dtype="${s.groupKey.type}" data-content="${Lute.EscapeHTMLStr(((r=s.groupValue.text)==null?void 0:r.content)||"")}" style="float: left" class="av__body${s.groupFolded?" fn__none":""}">${rA(s,t.blockElement)}</div>`)}),t.renderAll?t.blockElement.firstElementChild.outerHTML=`<div class="av__container">
    ${Xh(t.data,n||!!a,!t.protyle.disabled&&!ue(t.blockElement,"data-type","NodeBlockQueryEmbed"))}
    <div class="av__scroll">
        ${i}
    </div>
    <div class="av__cursor" contenteditable="true">${p.ZWSP}</div>
</div>`:t.blockElement.firstElementChild.querySelector(".av__scroll").innerHTML=i,lA(t)},lA=t=>{var e;t.blockElement.getAttribute("data-need-focus")==="true"&&(qt(t.blockElement),t.blockElement.removeAttribute("data-need-focus")),t.blockElement.setAttribute("data-render","true"),t.blockElement.querySelector(".av__scroll").scrollLeft=t.resetData.left,t.blockElement.style.alignSelf=t.resetData.alignSelf;const n=t.protyle.contentElement.getBoundingClientRect();if(t.resetData.headerTransform){const s=t.blockElement.querySelector(`.av__body[data-group-id="${t.resetData.headerTransform.groupId}"] .av__row--header`);s&&(s.style.transform=t.resetData.headerTransform.transform)}else setTimeout(()=>{tc(t.blockElement,n,"top")},p.TIMEOUT_LOAD);if(t.resetData.footerTransform){const s=t.blockElement.querySelector(`.av__body[data-group-id="${t.resetData.footerTransform.groupId}"] .av__row--footer`);s&&(s.style.transform=t.resetData.footerTransform.transform)}else setTimeout(()=>{tc(t.blockElement,n,"bottom")},p.TIMEOUT_LOAD);if(t.resetData.selectCellId){let s=t.blockElement.querySelector(`.av__body[data-group-id="${t.resetData.selectCellId.groupId}"] .av__row[data-id="${t.resetData.selectCellId.rowId}"] .av__cell[data-col-id="${t.resetData.selectCellId.colId}"]`);s||(s=t.blockElement.querySelector(`.av__row[data-id="${t.resetData.selectCellId.rowId}"] .av__cell[data-col-id="${t.resetData.selectCellId.colId}"]`)),s&&(s.classList.add("av__cell--select"),vl(t.blockElement,s));const r=document.querySelector(".av__mask"),o=document.querySelector(".av__panel");if(r)(e=r.querySelector("textarea, input"))==null||e.focus();else if(!o&&!t.resetData.isSearching&&getSelection().rangeCount>0){const l=getSelection().getRangeAt(0),c=oe(l.startContainer);c&&t.blockElement===c&&qt(t.blockElement)}else o&&!s&&o.remove()}if(t.resetData.selectRowIds.forEach((s,r)=>{let o=t.blockElement.querySelector(`.av__body[data-group-id="${s.groupId}"] .av__row[data-id="${s.rowId}"]`);o||(o=t.blockElement.querySelector(`.av__row[data-id="${s.rowId}"]`)),o&&(o.classList.add("av__row--select"),o.querySelector(".av__firstcol use").setAttribute("xlink:href","#iconCheck")),r===t.resetData.selectRowIds.length-1&&o&&ec(o)}),Object.keys(t.resetData.pageSizes).forEach(s=>{const r=t.blockElement.querySelector(`.av__body[data-group-id="${s==="unGroup"?"":s}"]`);r&&(r.dataset.pageSize=t.resetData.pageSizes[s])}),t.resetData.dragFillId){let s=t.blockElement.querySelector(`.av__body[data-group-id="${t.resetData.dragFillId.groupId}"] .av__row[data-id="${t.resetData.dragFillId.rowId}"] .av__cell[data-col-id="${t.resetData.dragFillId.colId}"]`);s||(s=t.blockElement.querySelector(`.av__row[data-id="${t.resetData.dragFillId.rowId}"] .av__cell[data-col-id="${t.resetData.dragFillId.colId}"]`)),Js(s)}if(t.resetData.activeIds.forEach(s=>{let r=t.blockElement.querySelector(`.av__body[data-group-id="${s.groupId}"] .av__row[data-id="${s.rowId}"] .av__cell[data-col-id="${s.colId}"]`);r||(r=t.blockElement.querySelector(`.av__row[data-id="${s.rowId}"] .av__cell[data-col-id="${s.colId}"]`)),r==null||r.classList.add("av__cell--active")}),getSelection().rangeCount>0){const s=getSelection().getRangeAt(0);if(!N(s.startContainer,"av__title")){const r=oe(s.startContainer);r&&t.blockElement===r&&!t.resetData.isSearching&&qt(t.blockElement)}}if(t.blockElement.querySelector(".layout-tab-bar").scrollLeft=t.blockElement.querySelector(".layout-tab-bar .item--focus").offsetLeft-30,t.cb&&t.cb(t.data),!t.renderAll)return;const a=t.blockElement.querySelector(".av__views"),i=t.blockElement.querySelector('[data-type="av-search"]');i.value=t.resetData.query||"",t.resetData.isSearching&&i.focus(),i.addEventListener("compositionstart",s=>{s.stopPropagation()}),i.addEventListener("keydown",s=>{s.isComposing||uo(s)}),i.addEventListener("input",s=>{s.stopPropagation(),!s.isComposing&&(i.value||document.activeElement===i?a.classList.add("av__views--show"):a.classList.remove("av__views--show"),$f(t.blockElement,t.protyle))}),i.addEventListener("compositionend",()=>{$f(t.blockElement,t.protyle)}),i.addEventListener("blur",s=>{s.isComposing||i.value||(a.classList.remove("av__views--show"),i.style.width="0",i.style.paddingLeft="0",i.style.paddingRight="0")}),Bh({inputElement:i,right:0,width:"1em",height:i.clientHeight,clearCB(){a.classList.remove("av__views--show"),i.style.width="0",i.style.paddingLeft="0",i.style.paddingRight="0",qt(t.blockElement),$f(t.blockElement,t.protyle)}})},Ua=(t,e,n,a=!0,i)=>NF(void 0,null,function*(){var s,r,o,l;let c=[];if(t.getAttribute("data-type")==="NodeAttributeView"?c=[t]:c=Array.from(t.querySelectorAll('[data-type="NodeAttributeView"]')),c.length!==0)for(let d=0;d<c.length;d++){const u=c[d];if(u.removeAttribute("data-rendering"),u.getAttribute("data-render")==="true"||N(u,"av__gallery-content"))continue;if((x()||Xt()||St()||Qt())&&u.classList.add("av--touch"),u.getAttribute("data-av-type")==="gallery"){yield mx({blockElement:u,protyle:e,cb:n,renderAll:a});continue}if(u.getAttribute("data-av-type")==="kanban"){yield hx({blockElement:u,protyle:e,cb:n,renderAll:a});continue}let g;const f=u.querySelector(".av__cell--select");f&&(g={groupId:N(f,"av__body").dataset.groupId||"",rowId:N(f,"av__row").dataset.id,colId:f.getAttribute("data-col-id")});const h=[];u.querySelectorAll(".av__row--select").forEach(re=>{const Te=re.getAttribute("data-id");Te&&h.push({groupId:N(re,"av__body").dataset.groupId||"",rowId:Te})});let m;const b=u.querySelector(".av__drag-fill");b&&(m={groupId:N(b,"av__body").dataset.groupId||"",rowId:N(b,"av__row").dataset.id,colId:b.parentElement.getAttribute("data-col-id")});const y=[];u.querySelectorAll(".av__cell--active").forEach(re=>{y.push({groupId:N(re,"av__body").dataset.groupId||"",rowId:N(re,"av__row").dataset.id,colId:re.getAttribute("data-col-id")})});const _=u.querySelector('[data-type="av-search"]'),v={};u.querySelectorAll(".av__body").forEach(re=>{v[re.dataset.groupId||"unGroup"]=re.dataset.pageSize});const U=u.querySelector('.av__row--header[style^="transform"]'),ee=u.querySelector('.av__row--footer[style^="transform"]'),Z={selectCellId:g,alignSelf:u.style.alignSelf,left:((s=u.querySelector(".av__scroll"))==null?void 0:s.scrollLeft)||0,headerTransform:U?{groupId:U.parentElement.getAttribute("data-group-id"),transform:U.style.transform}:null,footerTransform:ee?{groupId:ee.parentElement.getAttribute("data-group-id"),transform:ee.style.transform}:null,isSearching:_&&document.activeElement===_,selectRowIds:h,dragFillId:m,activeIds:y,query:(_==null?void 0:_.value)||"",pageSizes:v};if(u.firstElementChild.innerHTML===""){u.style.alignSelf="";let re="";[1,2,3].forEach(()=>{re+=`<div class="av__row">
    <div style="width: 24px;flex-shrink: 0"></div>
    <div class="av__cell" style="width: 200px"><span class="av__pulse"></span></div>
    <div class="av__cell" style="width: 200px"><span class="av__pulse"></span></div>
    <div class="av__cell" style="width: 200px"><span class="av__pulse"></span></div>
    <div class="av__cell" style="width: 200px"><span class="av__pulse"></span></div>
</div>`}),u.firstElementChild.innerHTML=re}const k=(r=e.options.history)==null?void 0:r.created,w=(o=e.options.history)==null?void 0:o.snapshot,S=d_(u);let B;if(i?B=i:B=(yield wn(k?"/api/av/renderHistoryAttributeView":w?"/api/av/renderSnapshotAttributeView":"/api/av/renderAttributeView",{id:u.getAttribute("data-av-id"),created:k,snapshot:w,pageSize:S.unGroupPageSize,groupPaging:S.groupPageSize,viewID:u.getAttribute(p.CUSTOM_SY_AV_VIEW)||"",query:Z.query.trim(),blockID:u.getAttribute("data-node-id")})).data,B.viewType==="gallery"){u.setAttribute("data-av-type",B.viewType),yield mx({blockElement:u,protyle:e,cb:n,renderAll:a,data:B});continue}if(B.viewType==="kanban"){u.setAttribute("data-av-type",B.viewType),yield hx({blockElement:u,protyle:e,cb:n,renderAll:a,data:B});continue}const H=B.view;if(((l=H.groups)==null?void 0:l.length)>0){BF({blockElement:u,protyle:e,cb:n,renderAll:a,data:B,resetData:Z});continue}const j=`<div class="av__body" data-group-id="" data-page-size="${H.pageSize}" style="float: left">
    ${rA(H,u)}
</div>`;a?u.firstElementChild.outerHTML=`<div class="av__container">
    ${Xh(B,Z.isSearching||!!Z.query,!e.disabled&&!ue(u,"data-type","NodeBlockQueryEmbed"))}
    <div class="av__scroll">
        ${j}
    </div>
    <div class="av__cursor" contenteditable="true">${p.ZWSP}</div>
</div>`:u.firstElementChild.querySelector(".av__scroll").innerHTML=j,lA({renderAll:a,data:B,cb:n,protyle:e,blockElement:u,resetData:Z}),u.style.margin=""}});let cA;const $f=(t,e)=>{clearTimeout(cA),cA=window.setTimeout(()=>{t.removeAttribute("data-render"),Ua(t,e,void 0,!1)},p.TIMEOUT_INPUT)},dA={},Br=(t,e,n)=>{const a=Array.from(t.wysiwyg.element.querySelectorAll(`.av[data-av-id="${e}"]`));return n?a.filter(i=>uA(i)===n):a},uA=t=>{var e;return t.getAttribute(p.CUSTOM_SY_AV_VIEW)||((e=t.querySelector(".layout-tab-bar .item--focus"))==null?void 0:e.getAttribute("data-id"))||null},$F=(t,e)=>{if(e.action==="setAttrViewName"){Br(t,e.id).forEach(n=>{const a=n.querySelector(".av__title");a&&(a.textContent=e.data,a.dataset.title=e.data)});return}if(e.action==="setAttrViewColWidth"){Br(t,e.avID,e.viewID).forEach(n=>{const a=n.querySelector(`.av__cell[data-col-id="${e.id}"]`);!a||a.style.width===e.data||n.querySelectorAll(".av__row").forEach(i=>{i.querySelector(`[data-col-id="${e.id}"]`).style.width=e.data})});return}if(e.action==="setAttrViewCardSize"){Br(t,e.avID,e.viewID).forEach(n=>{n.getAttribute("data-av-type")==="kanban"?n.querySelectorAll(".av__kanban-group").forEach(a=>{a.classList.remove("av__kanban-group--small","av__kanban-group--big"),e.data===0?a.classList.add("av__kanban-group--small"):e.data===2&&a.classList.add("av__kanban-group--big")}):n.querySelectorAll(".av__gallery").forEach(a=>{a.classList.remove("av__gallery--small","av__gallery--big"),e.data===0?a.classList.add("av__gallery--small"):e.data===2&&a.classList.add("av__gallery--big")})});return}if(e.action==="setAttrViewCardAspectRatio"){Br(t,e.avID,e.viewID).forEach(n=>{n.querySelectorAll(".av__gallery-cover").forEach(a=>{a.className="av__gallery-cover av__gallery-cover--"+e.data})});return}if(e.action==="hideAttrViewName"){Br(t,e.avID,e.viewID).forEach(n=>{const a=n.querySelector(".av__title");if(a&&(e.data?a.classList.add("fn__none"):a.classList.remove("fn__none"),n.getAttribute("data-av-type")==="gallery"&&!n.querySelector(".av__group-title"))){const i=n.querySelector(".av__gallery");e.data?i.classList.add("av__gallery--top"):i.classList.remove("av__gallery--top")}});return}if(e.action==="setAttrViewWrapField"){Br(t,e.avID,e.viewID).forEach(n=>{n.querySelectorAll(".av__cell").forEach(a=>{a.setAttribute("data-wrap",e.data.toString())})});return}if(e.action==="setAttrViewFillColBackgroundColor"){Br(t,e.avID,e.viewID).forEach(n=>{const a=n.querySelector(".av__group-title .b3-chip"),i=n.querySelector(".av__kanban");e.data&&a?i.classList.add("av__kanban--bg"):i.classList.remove("av__kanban--bg"),n.querySelectorAll(".av__kanban-group").forEach(s=>{if(e.data&&a){const r=s.querySelector(".av__group-title .b3-chip");r?s.setAttribute("style",`--b3-av-kanban-background:var(--b3-font-background${r.style.backgroundColor.slice(-2,-1)})`):s.setAttribute("style","--b3-av-kanban-background: var(--b3-border-color)")}else s.removeAttribute("style")})});return}if(e.action==="setAttrViewFitImage"){Br(t,e.avID,e.viewID).forEach(n=>{const a=n.querySelector(".av__gallery-img");e.data?a.classList.add("av__gallery-img--fit"):a.classList.remove("av__gallery-img--fit")});return}if(e.action==="setAttrViewShowIcon"){Br(t,e.avID,e.viewID).forEach(n=>{n.querySelectorAll('.av__cell[data-dtype="block"] .b3-menu__avemoji, .av__cell[data-dtype="relation"] .b3-menu__avemoji').forEach(a=>{e.data?a.classList.remove("fn__none"):a.classList.add("fn__none")})});return}if(e.action==="setAttrViewColWrap"){Br(t,e.avID,e.viewID).forEach(n=>{n.querySelectorAll(`.av__cell[data-col-id="${e.id}"],.av__cell[data-field-id="${e.id}"]`).forEach(a=>{a.setAttribute("data-wrap",e.data.toString())})});return}if(e.action==="foldAttrViewGroup"){Br(t,e.avID).forEach(n=>{const a=n.querySelector(`[data-type="av-group-fold"][data-id="${e.id}"]`);a&&(e.data?(a.firstElementChild.classList.remove("av__group-arrow--open"),a.parentElement.nextElementSibling.classList.add("fn__none")):(a.firstElementChild.classList.add("av__group-arrow--open"),a.parentElement.nextElementSibling.classList.remove("fn__none")),a.removeAttribute("data-folding"))});return}clearTimeout(dA[t.id]),dA[t.id]=window.setTimeout(()=>{const n=e.action==="setAttrViewName"?e.id:e.avID,a=document.querySelector(`.b3-dialog--open[data-key="${p.DIALOG_ATTR}"] .custom-attr > [data-av-id="${n}"]`);a&&(a.removeAttribute("data-rendering"),nx(a.parentElement,a.dataset.nodeId,t)),Br(t,n).forEach(i=>{var s;if(i.removeAttribute("data-render"),e.action==="sortAttrViewRow")si(["cell"],i);else if(e.action==="sortAttrViewCol")i.querySelectorAll(".av__cell--active").forEach(o=>{var l;o.classList.remove("av__cell--active"),(l=o.querySelector(".av__drag-fill"))==null||l.remove()}),Js(i.querySelector(".av__cell--select"));else if(e.action==="setAttrViewBlockView"){const o=i.querySelector(`.av__views > .layout-tab-bar > .item[data-id="${e.id}"]`);o&&i.querySelectorAll(".av__body").forEach(l=>{l.dataset.pageSize=o.dataset.page})}else if(e.action==="addAttrViewView")i.querySelectorAll(".av__body").forEach(o=>{o.dataset.pageSize="50"});else if(e.action==="removeAttrViewView")i.querySelectorAll(".av__body").forEach(o=>{var l;o.dataset.pageSize=(l=i.querySelector(`.av__views > .layout-tab-bar .item[data-id="${uA(i)}"]`))==null?void 0:l.getAttribute("data-page")});else if(e.action==="sortAttrViewView"&&e.data==="unRefresh"){const o=i.querySelector(`.av__views > .layout-tab-bar > .item[data-id="${e.id}"]`);if(o&&!e.previousID&&!o.previousElementSibling)return;if(o&&e.previousID&&((s=o.previousElementSibling)==null?void 0:s.getAttribute("data-id"))===e.previousID)return}const r=i.querySelector('[data-type="ghost"]');Ua(i,t,()=>{var o,l;if(e.action==="insertAttrViewBlock"&&((o=e.context)==null?void 0:o.ignoreTip)!=="true")if((l=e.context)!=null&&l.message)Q(e.context.message);else{const c=e.groupID?`[data-group-id="${e.groupID}"]`:"";if(["gallery","kanban"].includes(i.getAttribute("data-av-type"))&&e.srcs.forEach(d=>{var u,g;const f=(u=i.querySelector(`.av__body${c} .av__gallery-item[data-id="${d.itemID}"]`))==null?void 0:u.querySelector(".av__gallery-fields");f&&((g=f.querySelector('[data-dtype="block"]'))==null?void 0:g.parentElement.getAttribute("data-empty"))==="true"&&f.classList.add("av__gallery-fields--edit")}),e.srcs.length===1){let d=i.querySelector(`.av__body${c} [data-id="${e.srcs[0].itemID}"] .av__cell[data-dtype="block"]`);if(!d){const u=i.querySelectorAll(`.av__body [data-id="${e.srcs[0].itemID}"] .av__cell[data-dtype="block"]`);u.length===1&&(d=u[0])}d&&d.getAttribute("data-detached")==="true"&&d.querySelector(".av__celltext").textContent===""&&d.getBoundingClientRect().height!==0&&r&&Bs(t,[d],"block")}e.srcs.find(d=>{if(!i.querySelector(`.av__body [data-id="${d.itemID}"]`)&&!i.querySelector(`.av__body [data-dtype="block"] .av__celltext--ref[data-id="${d.id}"]`))return Q(window.siyuan.languages.insertRowTip),!0})}else e.action==="addAttrViewView"&&i.getAttribute("data-node-id")===e.blockID&&Vi({protyle:t,blockElement:i,type:"config"});i.removeAttribute("data-loading")})})},["insertAttrViewBlock"].includes(e.action)?2:100)},fA=(t,e)=>{t.block.showAll=!0;let n="";e.forEach((a,i)=>{n+=gA(a.blockPaths,!1,i)+hA(a.dom,a.expand)}),t.wysiwyg.element.innerHTML=n,bx(t.wysiwyg.element),zn(t.wysiwyg.element),ra(t.wysiwyg.element),Ua(t.wysiwyg.element,t),$n(t,t.wysiwyg.element),tg(t),(window.siyuan.config.readonly||window.siyuan.config.editor.readOnly)&&br(t)},pA=(t,e)=>{e.firstElementChild.classList.contains("li")?t?e.querySelectorAll(".li .li").forEach(n=>{n.childElementCount>3&&n.setAttribute("fold","1")}):e.firstElementChild.setAttribute("fold","1"):e.firstElementChild.getAttribute("data-type")==="NodeHeading"&&Array.from(e.children).forEach((n,a)=>{(t&&a>2||!t&&a>1)&&((t&&a===3||!t&&a===2)&&n.insertAdjacentHTML("beforebegin",'<div style="max-width: 100%;justify-content: center;" contenteditable="false" class="protyle-breadcrumb__item"><svg style="transform: rotate(90deg);"><use xlink:href="#iconMore"></use></svg></div>'),n.classList.add("fn__none"))})},hA=(t,e)=>{const n=document.createElement("template");return n.innerHTML=t,pA(e,n.content),n.innerHTML},OF=(t,e)=>{ae("/api/filetree/getDoc",{id:e.getAttribute("data-id"),size:p.SIZE_GET_MAX},n=>{e.parentElement.querySelector(".protyle-breadcrumb__item--active").classList.remove("protyle-breadcrumb__item--active"),e.classList.add("protyle-breadcrumb__item--active");let a=e.parentElement.nextElementSibling;for(;a&&!a.classList.contains("protyle-breadcrumb__bar");){const i=a;a=a.nextElementSibling,i.remove()}e.parentElement.insertAdjacentHTML("afterend",hA(n.data.content,!0)),zn(e.parentElement.parentElement),Ua(e.parentElement.parentElement,t),$n(t,e.parentElement.parentElement),n.data.isSyncing?IA(t):window.siyuan.config.readonly||window.siyuan.config.editor.readOnly?br(t):e.parentElement.parentElement.classList.contains("protyle-wysiwyg__embed")&&e.parentElement.parentElement.querySelectorAll('[contenteditable="true"][spellcheck]').forEach(i=>{i.setAttribute("contenteditable","false")})})},RF=t=>{let e=t.nextElementSibling;for(;e&&!e.classList.contains("protyle-breadcrumb__bar");)e.classList.remove("fn__none"),e=e.nextElementSibling;t.remove()},gA=(t,e,n)=>{if(1>t.length)return`<div contenteditable="false" style="border-top: ${n===0?0:1}px solid var(--b3-border-color);min-height: 0;width: 100%;" class="protyle-breadcrumb__bar"><span></span></div>`;let a="";return t.forEach((i,s)=>{s===0&&!e||(a+=`<span class="protyle-breadcrumb__item${s===t.length-1?" protyle-breadcrumb__item--active":""}" data-id="${i.id}">
    <svg class="popover__block" data-id="${i.id}"><use xlink:href="#${Qi(i.type,i.subType)}"></use></svg>
    ${i.name?`<span class="protyle-breadcrumb__text" title="${i.name}">${i.name}</span>`:""}
</span>`,s!==t.length-1&&(a+='<svg class="protyle-breadcrumb__arrow"><use xlink:href="#iconRight"></use></svg>'))}),`<div contenteditable="false" class="protyle-breadcrumb__bar protyle-breadcrumb__bar--nowrap">${a}</div>`},bx=t=>{t.querySelectorAll(".protyle-breadcrumb__bar").forEach(e=>{e.classList.remove("protyle-breadcrumb__bar--nowrap");const n=Array.from(e.querySelectorAll(".protyle-breadcrumb__text"));if(n.length===0)return;let a=!1;const i=ue(e,"data-type","NodeBlockQueryEmbed");for(;e.scrollHeight>30&&!a&&n.length>1;)n.find((s,r)=>{if(r>(i?0:-1)){if(!s.classList.contains("protyle-breadcrumb__text--ellipsis"))return s.classList.add("protyle-breadcrumb__text--ellipsis"),!0;r===n.length-1&&s.classList.contains("protyle-breadcrumb__text--ellipsis")&&(a=!0)}});e.classList.add("protyle-breadcrumb__bar--nowrap"),e.lastElementChild&&(e.scrollLeft=e.lastElementChild.offsetLeft-e.clientWidth+14)})},$n=(t,e,n)=>{let a=[];e.getAttribute("data-type")==="NodeBlockQueryEmbed"?a=[e]:a=Array.from(e.querySelectorAll('[data-type="NodeBlockQueryEmbed"]')),a.length!==0&&a.forEach(i=>{if(i.getAttribute("data-render")==="true")return;if(i.setAttribute("data-render","true"),Kl(i),i.childElementCount>3){i.style.height=i.clientHeight-4+"px";for(let o=1;o<i.children.length-1;o++)i.children[o].classList.contains("protyle-cursor")||(i.children[o].remove(),o--)}const s=Lute.UnEscapeHTMLStr(i.getAttribute("data-content"));let r=i.getAttribute("breadcrumb");if(r?r=r==="true":r=window.siyuan.config.editor.embedBlockBreadcrumb,s.startsWith("//!js"))try{const o=new Function("fetchSyncPost","item","protyle","top",s)(wn,i,t,n);if(o instanceof Promise)o.then(l=>{if(Array.isArray(l))ae("/api/search/getEmbedBlock",{embedBlockID:i.getAttribute("data-node-id"),includeIDs:l,headingMode:["0","1","2"].includes(i.getAttribute("custom-heading-mode"))?parseInt(i.getAttribute("custom-heading-mode")):window.siyuan.config.editor.headingEmbedMode,breadcrumb:r},c=>{Zh(c.data.blocks||[],t,i,n)});else return}).catch(l=>{Zh([],t,i,n,l)});else if(Array.isArray(o))ae("/api/search/getEmbedBlock",{embedBlockID:i.getAttribute("data-node-id"),includeIDs:o,headingMode:["0","1","2"].includes(i.getAttribute("custom-heading-mode"))?parseInt(i.getAttribute("custom-heading-mode")):window.siyuan.config.editor.headingEmbedMode,breadcrumb:r},l=>{Zh(l.data.blocks||[],t,i,n)});else return}catch(o){Zh([],t,i,n,o)}else ae("/api/search/searchEmbedBlock",{embedBlockID:i.getAttribute("data-node-id"),stmt:s,headingMode:["0","1","2"].includes(i.getAttribute("custom-heading-mode"))?parseInt(i.getAttribute("custom-heading-mode")):window.siyuan.config.editor.headingEmbedMode,excludeIDs:[i.getAttribute("data-node-id"),t.block.rootID],breadcrumb:r},o=>{Zh(o.data.blocks,t,i,n)})})},Zh=(t,e,n,a,i)=>{const s=n.querySelector(".fn__rotate");s&&s.classList.remove("fn__rotate");let r="";t.forEach(c=>{let d="";c.blockPaths.length!==0&&(d=gA(c.blockPaths,!0)),r+=`<div class="protyle-wysiwyg__embed" data-id="${c.block.id}">${d}${c.block.content}</div>`}),t.length>0?(n.firstElementChild.insertAdjacentHTML("afterend",r),bx(n.querySelector(".protyle-wysiwyg__embed"))):n.firstElementChild.insertAdjacentHTML("afterend",`<div class="protyle-wysiwyg__embed ft__smaller ft__secondary b3-form__space--small" contenteditable="false">${i||window.siyuan.languages.refExpired}</div>`),zn(n),ra(n),Ua(n,e),a&&(e.contentElement.scrollTop=a);let o=0,l=n;for(;o<4&&l;)l=ue(l.parentElement,"data-type","NodeBlockQueryEmbed"),o++;o<4&&n.querySelectorAll('[data-type="NodeBlockQueryEmbed"]').forEach(c=>{$n(e,c)}),n.style.height=""};var mA=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),UF=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())}),HF=(t,e,n)=>(e=t[mA("asyncIterator")])?e.call(t):(t=t[mA("iterator")](),e={},n=(a,i)=>(i=t[a])&&(e[a]=s=>new Promise((r,o,l)=>(s=i.call(t,s),l=s.done,Promise.resolve(s.value).then(c=>r({value:c,done:l}),o)))),n("next"),n("return"),e);const bA=(t,e)=>{const n=It(t),a=[];if(n!==t&&(t.remove(),a.push({action:"delete",id:n.getAttribute("data-node-id")})),n.remove(),e.wysiwyg.element.childElementCount===0)if(e.block.rootID===e.block.id){const i=Lute.NewNodeID(),s=Fs(!1,!1,i);a.push({action:"insert",data:s.outerHTML,id:i,parentID:e.block.parentID}),e.wysiwyg.element.innerHTML=s.outerHTML}else hi({protyle:e,id:e.block.rootID,isPushBack:!1,focusId:e.block.id});a.length>0&&et(e,a,[])},yA=()=>{if(window.siyuan.transactions.length===0)return;const t=window.siyuan.transactions[0].protyle,e=window.siyuan.transactions[0].doOperations,n=window.siyuan.transactions[0].undoOperations;window.siyuan.transactions.splice(0,1),ae("/api/transactions",{session:t.id,app:p.SIYUAN_APPID,transactions:[{doOperations:e,undoOperations:n}]},a=>{window.siyuan.transactions.length===0?ss([],t.block.rootID,!0):yA();let i;if(getSelection().rangeCount>0&&(i=getSelection().getRangeAt(0)),a.data[0].doOperations.forEach(s=>{if(s.action==="unfoldHeading"||s.action==="foldHeading"){EA(s,t);return}if(s.action==="update"){t.options.backlinkData&&(Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${s.id}"]`)).forEach(r=>{ge(r)||i&&(r===i.startContainer||r.contains(i.startContainer))||(r.outerHTML=s.data.replace("<wbr>",""))}),zn(t.wysiwyg.element),ra(t.wysiwyg.element),Ua(t.wysiwyg.element,t),$n(t,t.wysiwyg.element)),yx(t,s);return}if(s.action==="delete"||s.action==="append"){t.options.backlinkData&&Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${s.id}"]`)).forEach(r=>{!ge(r)&&!r.contains(i.startContainer)&&r.remove()}),t.wysiwyg.element.querySelectorAll('[data-type="NodeBlockQueryEmbed"]').forEach(r=>{r.querySelector(`[data-node-id="${s.id}"]`)&&(r.removeAttribute("data-render"),$n(t,r))}),Ut(["gutter"],t);return}if(s.action==="move"){if(t.options.backlinkData){const r=[];Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${s.id}"]`)).forEach(l=>{if(!ge(l)){const c=le(l,"data-node-id",null);c&&!c.contains(i.startContainer)&&r.push(l)}});let o=!1;s.previousID&&r.length>0?Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${s.previousID}"]`)).forEach(l=>{!ge(l)&&!l.nextElementSibling.contains(i.startContainer)&&(l.after(Ji(r[0].cloneNode(!0))),o=!0)}):r.length>0&&Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${s.parentID}"]`)).forEach(l=>{var c;!ge(l)&&!Le(l).contains(i.startContainer)&&((c=l.firstElementChild)!=null&&c.classList.contains("protyle-action")?l.firstElementChild.after(Ji(r[0].cloneNode(!0))):l.prepend(Ji(r[0].cloneNode(!0))),o=!0)}),r.forEach(l=>{o?l.remove():!o&&l.parentElement&&bA(l,t)})}t.wysiwyg.element.querySelectorAll('[data-type="NodeBlockQueryEmbed"]').forEach(r=>{r.querySelector(`[data-node-id="${s.id}"],[data-node-id="${s.parentID}"],[data-node-id="${s.previousID}"]`)&&(r.removeAttribute("data-render"),$n(t,r))});return}if(s.action==="insert"){if(t.options.backlinkData){const r=[];s.previousID?Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${s.previousID}"]`)).forEach(o=>{var l;((l=o.nextElementSibling)==null?void 0:l.getAttribute("data-node-id"))!==s.id&&!o.contains(i.startContainer)&&!ue(o,"data-node-id",s.id)&&!ge(o)&&(o.insertAdjacentHTML("afterend",s.data),r.push(o.nextElementSibling))}):Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${s.parentID}"]`)).forEach(o=>{!ge(o)&&!o.contains(i.startContainer)&&(o.firstElementChild&&o.firstElementChild.classList.contains("protyle-action")&&o.firstElementChild.nextElementSibling.getAttribute("data-node-id")!==s.id?(o.firstElementChild.insertAdjacentHTML("afterend",s.data),r.push(o.firstElementChild.nextElementSibling)):o.firstElementChild&&o.firstElementChild.getAttribute("data-node-id")!==s.id&&(o.insertAdjacentHTML("afterbegin",s.data),r.push(o.firstElementChild)))}),t.wysiwyg.element.querySelectorAll('[data-type="NodeHeading"]').forEach(o=>{o.lastElementChild.getAttribute("spin")==="1"&&o.lastElementChild.remove()}),r.forEach(o=>{zn(o),ra(o),Ua(o,t),$n(t,o);const l=o.querySelector("wbr");l&&l.remove()})}t.wysiwyg.element.querySelectorAll("[parent-heading]").forEach(r=>{r.remove()})}}),t.wysiwyg.element.childElementCount===0&&!t.block.showAll){const s=Lute.NewNodeID(),r=Fs(!1,!0,s);t.wysiwyg.element.insertAdjacentElement("afterbegin",r),et(t,[{action:"insert",data:r.outerHTML,id:s,parentID:t.block.parentID}]),cn(r,i)}})},yx=(t,e)=>{let n=!1;const a=(s,r)=>{const o=document.createElement("template");o.innerHTML=t.lute.SpinBlockDOM(r),o.content.querySelectorAll('[contenteditable="true"]').forEach(c=>{c.setAttribute("contenteditable","false")}),o.content.querySelectorAll(".protyle-wysiwyg--select").forEach(c=>{c.classList.remove("protyle-wysiwyg--select")});const l=o.content.querySelector("wbr");l&&l.remove(),s.outerHTML=o.innerHTML,n=!0},i=document.createElement("template");i.innerHTML=e.data,t.wysiwyg.element.querySelectorAll('[data-type="NodeBlockQueryEmbed"]').forEach(s=>{const r=s.querySelectorAll(`[data-node-id="${e.id}"]`);r.length>0?r.forEach(o=>{a(o,e.data)}):s.querySelectorAll(".protyle-wysiwyg__embed").forEach(o=>{const l=i.content.querySelector(`[data-node-id="${o.getAttribute("data-id")}"]`);l&&!ge(l)&&a(o.querySelector("[data-node-id]"),l.outerHTML)})}),n&&(zn(t.wysiwyg.element),ra(t.wysiwyg.element),Ua(t.wysiwyg.element,t))},_A=(t,e,n,a)=>{a&&NE(t[0]),t.forEach(i=>{if(a)i.remove();else{const s=It(i);s&&s.remove()}}),n.wysiwyg.element.querySelectorAll('[data-type="NodeBlockQueryEmbed"]').forEach(i=>{i.querySelector(`[data-node-id="${e}"]`)&&(i.removeAttribute("data-render"),$n(n,i))})},wA=(t,e,n,a)=>{t.forEach(s=>{s.getAttribute("data-subtype")==="echarts"?s.outerHTML=e.lute.SpinBlockDOM(n.data):s.outerHTML=n.data}),Array.from(e.wysiwyg.element.querySelectorAll(`[data-node-id="${n.id}"]`)).find(s=>{if(!ge(s))return t[0]=s,!0});const i=t[0].querySelector("wbr");if(a){const s=hn(t[0]);i?cn(t[0],s):qt(t[0])}else i&&i.remove();zn(t.length===1?t[0]:e.wysiwyg.element),ra(t.length===1?t[0]:e.wysiwyg.element),Ua(t.length===1?t[0]:e.wysiwyg.element,e),$n(e,t.length===1?t[0]:e.wysiwyg.element),yx(e,n)},f_=(t,e,n)=>{var a,i,s,r;const o=[];if(Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`)).forEach(l=>{ge(l)||o.push(l)}),e.action==="setAttrs"){t.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`).forEach(l=>{JSON.parse(e.data).fold==="1"?l.setAttribute("fold","1"):l.removeAttribute("fold")});return}if(e.action==="unfoldHeading"){const l=t.contentElement.scrollTop;t.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`).forEach(c=>{if(c.removeAttribute("fold"),n)return;const d=ge(c);if(d){d.removeAttribute("data-render"),$n(t,d);return}e.retData&&(vA(e.retData,t),c.insertAdjacentHTML("afterend",e.retData)),e.data==="remove"&&c.remove()}),e.retData&&(t.disabled&&br(t),zn(t.wysiwyg.element),ra(t.wysiwyg.element),Ua(t.wysiwyg.element,t),$n(t,t.wysiwyg.element),t.contentElement.scrollTop=l,t.scroll.lastScrollTop=l);return}if(e.action==="foldHeading"){if(t.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`).forEach(l=>{l.setAttribute("fold","1"),e.retData||Q2(l)}),n)return;e.retData&&(e.retData.forEach(l=>{let c;Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${l}"]`)).find(d=>{if(c=ge(d),c)return!0;d.remove()}),c&&(c.removeAttribute("data-render"),$n(t,c))}),t.wysiwyg.element.childElementCount===0&&hi({protyle:t,id:t.block.rootID,isPushBack:!1,focusId:e.id}));return}if(e.action==="delete"){o.length>0||!n?_A(o,e.id,t,n):n&&hi({protyle:t,id:t.block.rootID,isPushBack:!1,focusId:e.id,callback(){Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`)).forEach(l=>{ge(l)||o.push(l)}),_A(o,e.id,t,n)}});return}if(e.action==="update"){if(o.length===0){const l=t.wysiwyg.element.querySelector("[data-node-id]");if(l){const c=l.getAttribute("data-node-id"),d=document.createElement("template");d.innerHTML=e.data;const u=d.content.querySelector(`[data-node-id="${c}"]`);if(u){o.push(l),e.data=u.outerHTML,e.id=c;for(let g=1;g<t.wysiwyg.element.childElementCount;g++)t.wysiwyg.element.childNodes[g].remove(),g--}}}o.length>0?wA(o,t,e,n):n?hi({protyle:t,id:t.block.rootID,isPushBack:!1,focusId:e.id,callback(){Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`)).forEach(l=>{ge(l)||o.push(l)}),wA(o,t,e,n)}}):yx(t,e);return}if(e.action==="updateAttrs"){const l=e.data,c={};let d="",u="",g="",f="",h="";Object.keys(l.new).forEach(b=>{c[b]=l.new[b];const y=Lute.EscapeHTMLStr(l.new[b]);b==="bookmark"?d=`<div class="protyle-attr--bookmark">${y}</div>`:b==="name"?u=`<div class="protyle-attr--name"><svg><use xlink:href="#iconN"></use></svg>${y}</div>`:b==="alias"?g=`<div class="protyle-attr--alias"><svg><use xlink:href="#iconA"></use></svg>${y}</div>`:b==="memo"?f=`<div class="protyle-attr--memo ariaLabel" aria-label="${y}" data-position="north"><svg><use xlink:href="#iconM"></use></svg></div>`:b==="custom-avs"&&l.new["av-names"]&&(h=`<div class="protyle-attr--av"><svg><use xlink:href="#iconDatabase"></use></svg>${l.new["av-names"]}</div>`)});let m=d+u+g+f+h;if(t.block.rootID===e.id){if(t.title){l.new["custom-avs"]&&!l.new["av-names"]&&(m+=((a=t.title.element.querySelector(".protyle-attr--av"))==null?void 0:a.outerHTML)||"");const b=t.title.element.querySelector(".protyle-attr--refcount");b&&(m+=b.outerHTML),l.new[p.CUSTOM_RIFF_DECKS]&&l.new[p.CUSTOM_RIFF_DECKS]!==l.old[p.CUSTOM_RIFF_DECKS]?(t.title.element.style.animation="addCard 450ms linear",t.title.element.setAttribute(p.CUSTOM_RIFF_DECKS,l.new[p.CUSTOM_RIFF_DECKS]),setTimeout(()=>{t.title.element.style.animation=""},450)):l.new[p.CUSTOM_RIFF_DECKS]||t.title.element.removeAttribute(p.CUSTOM_RIFF_DECKS),t.title.element.querySelector(".protyle-attr").innerHTML=m}if(t.wysiwyg.renderCustom(c),l.new[p.CUSTOM_SY_FULLWIDTH]!==l.old[p.CUSTOM_SY_FULLWIDTH]&&Ai(t),l.new[p.CUSTOM_SY_READONLY]!==l.old[p.CUSTOM_SY_READONLY]){let b=l.new[p.CUSTOM_SY_READONLY];b||(b=window.siyuan.config.editor.readOnly?"true":"false"),b==="true"?br(t):eg(t)}(l.new.icon!==l.old.icon||l.new["title-img"]!==l.old["title-img"]||l.new.tags!==l.old.tags&&t.background)&&(t.background.ial.icon=l.new.icon,t.background.ial.tags=l.new.tags,t.background.ial["title-img"]=l.new["title-img"],t.background.render(t.background.ial,t.block.rootID),(i=t.model)==null||i.parent.setDocIcon(l.new.icon));return}t.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`).forEach(b=>{var y;if(b.getAttribute("data-type")==="NodeThematicBreak")return;Object.keys(l.old).forEach(ee=>{b.removeAttribute(ee)}),l.new.style&&l.new[p.CUSTOM_RIFF_DECKS]&&l.new[p.CUSTOM_RIFF_DECKS]!==l.old[p.CUSTOM_RIFF_DECKS]&&(l.new.style+=";animation:addCard 450ms linear"),Object.keys(l.new).forEach(ee=>{ee!=="id"&&(b.setAttribute(ee,l.new[ee]),ee===p.CUSTOM_RIFF_DECKS&&l.new[p.CUSTOM_RIFF_DECKS]!==l.old[p.CUSTOM_RIFF_DECKS]&&(b.style.animation="addCard 450ms linear",setTimeout(()=>{b.parentElement?b.style.animation="":t.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`).forEach(Z=>{Z.style.animation=""})},450)))}),l["data-av-type"]&&b.setAttribute("data-av-type",l["data-av-type"]);const _=b.querySelectorAll(".protyle-attr"),v=_[_.length-1];l.new["custom-avs"]&&!l.new["av-names"]&&(m+=((y=v.querySelector(".protyle-attr--av"))==null?void 0:y.outerHTML)||"");const U=v.querySelector(".protyle-attr--refcount");U&&(m+=U.outerHTML),v.innerHTML=m+p.ZWSP});return}if(e.action==="move"){if(((s=e.context)==null?void 0:s.ignoreProcess)==="true")return;o.length===0&&Cn().editor.forEach(d=>{const u=d.editor.protyle.wysiwyg.element.querySelector(`[data-node-id="${e.id}"]`);u&&o.push(u.cloneNode(!0))}),o.length===0&&window.siyuan.blockPanels.forEach(d=>{const u=d.element.querySelector(`[data-node-id="${e.id}"]`);u&&o.push(u.cloneNode(!0))});let l;if(n&&getSelection().rangeCount>0){l=getSelection().getRangeAt(0);const d=oe(l.startContainer);d&&(Ee(d)?l.insertNode(document.createElement("wbr")):Ee(o[0]).insertAdjacentHTML("afterbegin","<wbr>"))}let c=!1;if(e.previousID&&o.length>0){const d=t.wysiwyg.element.querySelectorAll(`[data-node-id="${e.previousID}"]`);if(d.length===0&&t.options.backlinkData&&n&&getSelection().rangeCount>0){const u=le(l.startContainer,"data-node-id",null);u&&(u.before(Ji(o[0].cloneNode(!0))),c=!0)}else d.forEach(u=>{ge(u)||(u.after(Ji(o[0].cloneNode(!0))),c=!0)})}else if(o.length>0){const d=t.wysiwyg.element.querySelectorAll(`[data-node-id="${e.parentID}"]`);if(!t.options.backlinkData&&e.parentID===t.block.parentID&&!t.block.showAll)t.wysiwyg.element.prepend(Ji(o[0].cloneNode(!0))),c=!0;else if(d.length===0&&t.options.backlinkData&&n&&getSelection().rangeCount>0){const u=le(getSelection().getRangeAt(0).startContainer,"data-node-id",null);u&&(u.before(Ji(o[0].cloneNode(!0))),c=!0)}else d.forEach(u=>{var g;ge(u)||((g=u.firstElementChild)!=null&&g.classList.contains("protyle-action")?u.firstElementChild.after(Ji(o[0].cloneNode(!0))):u.prepend(Ji(o[0].cloneNode(!0))),c=!0)})}o.forEach(d=>{c?d.remove():!c&&d.parentElement&&bA(d,t)}),n&&l&&(e.data==="focus"?(Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`)).find(d=>{if(!ge(d))return qt(d),!0}),document.querySelectorAll("wbr").forEach(d=>{d.remove()})):cn(t.wysiwyg.element,l)),n||t.wysiwyg.element.querySelectorAll('[data-type="NodeBlockQueryEmbed"]').forEach(d=>{d.querySelector(`[data-node-id="${e.id}"],[data-node-id="${e.parentID}"],[data-node-id="${e.previousID}"]`)&&(d.removeAttribute("data-render"),$n(t,d))});return}if(e.action==="insert"){if(((r=e.context)==null?void 0:r.ignoreProcess)==="true")return;const l=[];if(e.previousID){const c=t.wysiwyg.element.querySelectorAll(`[data-node-id="${e.previousID}"]`);if(c.length===0&&n&&t.wysiwyg.element.childElementCount===0)t.wysiwyg.element.innerHTML=e.data;else if(c.length===0&&t.options.backlinkData&&n&&getSelection().rangeCount>0){const d=oe(getSelection().getRangeAt(0).startContainer);d&&(d.insertAdjacentHTML("beforebegin",e.data),l.push(d.previousElementSibling))}else c.forEach(d=>{const u=ge(d);u?(u.removeAttribute("data-render"),$n(t,u)):(d.insertAdjacentHTML("afterend",e.data),l.push(d.nextElementSibling))})}else if(e.nextID)Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${e.nextID}"]`)).forEach(c=>{const d=ge(c);d?(d.removeAttribute("data-render"),$n(t,d)):(c.insertAdjacentHTML("beforebegin",e.data),l.push(c.previousElementSibling))});else{const c=t.wysiwyg.element.querySelectorAll(`[data-node-id="${e.parentID}"]`);if(!t.options.backlinkData&&e.parentID===t.block.parentID&&!t.block.showAll)t.wysiwyg.element.insertAdjacentHTML("afterbegin",e.data),l.push(t.wysiwyg.element.firstElementChild);else if(c.length===0&&t.options.backlinkData&&n&&getSelection().rangeCount>0){const d=oe(getSelection().getRangeAt(0).startContainer);d&&(d.insertAdjacentHTML("beforebegin",e.data),l.push(d.previousElementSibling))}else c.forEach(d=>{var u;ge(d)||((u=d.firstElementChild)!=null&&u.classList.contains("protyle-action")?(d.firstElementChild.insertAdjacentHTML("afterend",e.data),l.push(d.firstElementChild.nextElementSibling)):(d.insertAdjacentHTML("afterbegin",e.data),l.push(d.firstElementChild)))})}if(t.wysiwyg.element.querySelectorAll('[data-type="NodeHeading"]').forEach(c=>{c.lastElementChild.getAttribute("spin")==="1"&&c.lastElementChild.remove()}),l.length===0)return;l.forEach(c=>{zn(c),ra(c),Ua(c,t),$n(t,c);const d=c.querySelector("wbr");if(n){const u=hn(c);d?cn(c,u):qt(c)}else d&&d.remove()}),t.wysiwyg.element.querySelectorAll("[parent-heading]").forEach(c=>{c.remove()});return}if(e.action==="append"){t.options.backlinkData||$o(t,!1);return}if(["addAttrViewCol","updateAttrViewCol","updateAttrViewColOptions","updateAttrViewColOption","updateAttrViewCell","sortAttrViewRow","sortAttrViewCol","setAttrViewColHidden","setAttrViewColWrap","setAttrViewColWidth","removeAttrViewColOption","setAttrViewName","setAttrViewFilters","setAttrViewSorts","setAttrViewColCalc","removeAttrViewCol","updateAttrViewColNumberFormat","removeAttrViewBlock","replaceAttrViewBlock","updateAttrViewColTemplate","setAttrViewColPin","addAttrViewView","setAttrViewColIcon","removeAttrViewView","setAttrViewViewName","setAttrViewViewIcon","duplicateAttrViewView","sortAttrViewView","updateAttrViewColRelation","setAttrViewPageSize","updateAttrViewColRollup","sortAttrViewKey","setAttrViewColDesc","duplicateAttrViewKey","setAttrViewViewDesc","setAttrViewCoverFrom","setAttrViewCoverFromAssetKeyID","setAttrViewBlockView","setAttrViewCardSize","setAttrViewCardAspectRatio","hideAttrViewName","setAttrViewShowIcon","setAttrViewWrapField","setAttrViewGroup","removeAttrViewGroup","hideAttrViewGroup","sortAttrViewGroup","foldAttrViewGroup","hideAttrViewAllGroups","setAttrViewFitImage","setAttrViewDisplayFieldName","insertAttrViewBlock","setAttrViewColDateFillSpecificTime","setAttrViewFillColBackgroundColor","setAttrViewUpdatedIncludeTime","setAttrViewCreatedIncludeTime"].includes(e.action)){n?e.action==="setAttrViewName"&&Array.from(t.wysiwyg.element.querySelectorAll(`.av[data-av-id="${e.id}"]`)).forEach(l=>{const c=l.querySelector(".av__title");c&&(c.textContent=e.data,c.dataset.title=e.data)}):$F(t,e);return}if(e.action==="doUpdateUpdated"){o.forEach(l=>{l.setAttribute("updated",e.data)});return}},Qs=t=>{let e;const n=Lute.NewNodeID();if(t.type==="BlocksMergeSuperBlock")e=AS(t.level,n);else if(t.type==="Blocks2Blockquote")e=document.createElement("div"),e.classList.add("bq"),e.setAttribute("data-node-id",n),e.setAttribute("data-type","NodeBlockquote"),e.innerHTML='<div class="protyle-attr" contenteditable="false"></div>';else if(t.type.endsWith("Ls")){e=document.createElement("div"),e.classList.add("list"),e.setAttribute("data-node-id",n),e.setAttribute("data-type","NodeList"),t.type==="Blocks2ULs"?e.setAttribute("data-subtype","u"):t.type==="Blocks2OLs"?e.setAttribute("data-subtype","o"):e.setAttribute("data-subtype","t");let l="";t.selectsElement.forEach((c,d)=>{t.type==="Blocks2ULs"?l+=`<div data-marker="*" data-subtype="u" data-node-id="${Lute.NewNodeID()}" data-type="NodeListItem" class="li"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div class="protyle-attr" contenteditable="false"></div></div>`:t.type==="Blocks2OLs"?l+=`<div data-marker="${d+1}." data-subtype="o" data-node-id="${Lute.NewNodeID()}" data-type="NodeListItem" class="li"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">${d+1}.</div><div class="protyle-attr" contenteditable="false"></div></div>`:l+=`<div data-marker="*" data-subtype="t" data-node-id="${Lute.NewNodeID()}" data-type="NodeListItem" class="li"><div class="protyle-action protyle-action--task" draggable="true"><svg><use xlink:href="#iconUncheck"></use></svg></div><div class="protyle-attr" contenteditable="false"></div></div>`}),e.innerHTML=l+'<div class="protyle-attr" contenteditable="false"></div>'}const a=t.selectsElement[0].getAttribute("data-node-id"),i=t.selectsElement[0].parentElement.getAttribute("data-node-id")||t.protyle.block.parentID,s=[{action:"insert",id:n,data:e.outerHTML,nextID:a,parentID:i}],r=[];t.selectsElement[0].previousElementSibling?t.selectsElement[0].before(e):t.selectsElement[0].parentElement.prepend(e);let o;t.selectsElement.forEach((l,c)=>{l.classList.remove("protyle-wysiwyg--select"),l.removeAttribute("select-start"),l.removeAttribute("select-end");const d=l.getAttribute("data-node-id");r.push({action:"move",id:d,previousID:o||n,parentID:i}),t.type.endsWith("Ls")?(s.push({action:"move",id:d,parentID:e.children[c].getAttribute("data-node-id")}),e.children[c].firstElementChild.after(l)):(s.push({action:"move",id:d,previousID:o,parentID:n}),e.lastElementChild.before(l)),o=l.getAttribute("data-node-id"),c===t.selectsElement.length-1&&r.push({action:"delete",id:n}),l.getAttribute("data-type")==="NodeBlockQueryEmbed"&&(l.removeAttribute("data-render"),$n(t.protyle,l))}),et(t.protyle,s,r),qt(t.protyle.wysiwyg.element.querySelector(`[data-node-id="${t.selectsElement[0].getAttribute("data-node-id")}"]`)),Ut(["gutter"],t.protyle)},vA=(t,e)=>{const n=document.createElement("template");n.innerHTML=t,Array.from(n.content.children).forEach(a=>{var i;(i=e.wysiwyg.element.querySelector(`:scope > [data-node-id="${a.getAttribute("data-node-id")}"]`))==null||i.remove()})},mr=t=>{var e;(e=t.protyle.observerLoad)==null||e.disconnect();let n=t.selectsElement,a;if(t.nodeElement){a=getSelection().getRangeAt(0),a.insertNode(document.createElement("wbr")),n=Array.from(t.protyle.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select")),n.length===0&&(n=[t.nodeElement]);let l=!1,c=!1;if(n.find((d,u)=>{if(d.classList.contains("li"))return c=!0,!0;if(d.nextElementSibling&&n[u+1]&&d.nextElementSibling===n[u+1])l=!0;else if(u!==n.length-1)return l=!1,!0}),c)return;n.length===1&&t.type==="Blocks2Hs"&&n[0].getAttribute("data-type")==="NodeHeading"&&t.level===parseInt(n[0].getAttribute("data-subtype").substr(1))&&(t.type="Blocks2Ps"),t.isContinue=l}let i="";const s=[],r=[];let o;n.forEach((l,c)=>{var d,u,g,f,h,m,b,y;l.classList.remove("protyle-wysiwyg--select"),l.removeAttribute("select-start"),l.removeAttribute("select-end"),i+=l.outerHTML;const _=l.getAttribute("data-node-id"),v=document.createElement("template");if(t.isContinue)if(r.push({action:"insert",id:_,previousID:((m=s[s.length-1])==null?void 0:m.id)||((b=l.previousElementSibling)==null?void 0:b.getAttribute("data-node-id")),data:l.outerHTML,parentID:((y=l.parentElement)==null?void 0:y.getAttribute("data-node-id"))||t.protyle.block.parentID||t.protyle.block.rootID}),s.push({action:"delete",id:_}),c===n.length-1){const U=t.protyle.lute[t.type](i,t.level);v.innerHTML=U,Array.from(v.content.children).forEach(ee=>{var Z,k,w;const S=ee.getAttribute("data-node-id");s.push({action:"insert",id:S,previousID:((Z=ee.previousElementSibling)==null?void 0:Z.getAttribute("data-node-id"))||((k=l.previousElementSibling)==null?void 0:k.getAttribute("data-node-id")),data:ee.outerHTML,parentID:((w=l.parentElement)==null?void 0:w.getAttribute("data-node-id"))||t.protyle.block.parentID||t.protyle.block.rootID}),r.splice(0,0,{action:"delete",id:S})}),l.outerHTML=U}else l.remove();else{let U=t.protyle.lute[t.type](l.outerHTML,t.level);if(v.innerHTML=U,!v.content.querySelector(`[data-node-id="${_}"]`))r.push({action:"insert",id:_,previousID:o||((d=l.previousElementSibling)==null?void 0:d.getAttribute("data-node-id")),data:l.outerHTML,parentID:((u=l.parentElement)==null?void 0:u.getAttribute("data-node-id"))||t.protyle.block.parentID||t.protyle.block.rootID}),Array.from(v.content.children).forEach(ee=>{var Z,k,w;const S=ee.getAttribute("data-node-id");s.push({action:"insert",id:S,previousID:((Z=ee.previousElementSibling)==null?void 0:Z.getAttribute("data-node-id"))||((k=l.previousElementSibling)==null?void 0:k.getAttribute("data-node-id")),data:ee.outerHTML,parentID:((w=l.parentElement)==null?void 0:w.getAttribute("data-node-id"))||t.protyle.block.parentID||t.protyle.block.rootID}),r.splice(0,0,{action:"delete",id:S})}),s.push({action:"delete",id:_}),l===((g=n[c+1])==null?void 0:g.previousElementSibling)?o=_:o=void 0;else{let ee;l.getAttribute("data-type")==="NodeHeading"&&l.getAttribute("fold")==="1"&&v.content.firstElementChild.getAttribute("data-subtype")!==l.dataset.subtype&&(ee=La(t.protyle,l,void 0,void 0,!1,!0),U=U.replace(' fold="1"',"")),ee&&((f=ee.doOperations)==null?void 0:f.length)>0&&s.push(...ee.doOperations),r.push({action:"update",id:_,data:l.outerHTML}),s.push({action:"update",id:_,data:U}),ee&&((h=ee.undoOperations)==null?void 0:h.length)>0&&r.push(...ee.undoOperations)}l.outerHTML=U}}),et(t.protyle,s,r),zn(t.protyle.wysiwyg.element),ra(t.protyle.wysiwyg.element),Ua(t.protyle.wysiwyg.element,t.protyle),$n(t.protyle,t.protyle.wysiwyg.element),a||t.range?cn(t.protyle.wysiwyg.element,a||t.range):qt(t.protyle.wysiwyg.element.querySelector(`[data-node-id="${n[0].getAttribute("data-node-id")}"]`)),Ut(["gutter"],t.protyle)},Of=t=>UF(void 0,null,function*(){var e,n;if(t.nodeElement.querySelector("wbr")||(e=Ee(t.nodeElement))==null||e.insertAdjacentHTML("afterbegin","<wbr>"),t.type==="CancelList"||t.type==="CancelBlockquote")try{for(var a=HF(t.nodeElement.querySelectorAll('[data-type="NodeHeading"][fold="1"]')),i,s,r;i=!(s=yield a.next()).done;i=!1){const u=s.value,g=u.getAttribute("data-node-id");u.removeAttribute("fold");const f=yield wn("/api/transactions",{session:t.protyle.id,app:p.SIYUAN_APPID,transactions:[{doOperations:[{action:"unfoldHeading",id:g}],undoOperations:[{action:"foldHeading",id:g}]}]});t.protyle.undo.add([{action:"unfoldHeading",id:g}],[{action:"foldHeading",id:g}],t.protyle),u.insertAdjacentHTML("afterend",f.data[0].doOperations[0].retData)}}catch(u){r=[u]}finally{try{i&&(s=a.return)&&(yield s.call(a))}finally{if(r)throw r[0]}}const o=t.nodeElement.outerHTML;let l=(n=t.nodeElement.previousElementSibling)==null?void 0:n.getAttribute("data-node-id");!t.nodeElement.previousElementSibling&&t.protyle.block.showAll&&(l=(yield wn("/api/block/getBlockRelevantIDs",{id:t.id})).data.previousID);const c=t.nodeElement.parentElement.getAttribute("data-node-id")||t.protyle.block.parentID,d=t.protyle.lute[t.type](t.nodeElement.outerHTML,t.level);if(t.nodeElement.outerHTML=d,t.type==="CancelList"||t.type==="CancelBlockquote"){const u=document.createElement("template");u.innerHTML=d;const g=[{action:"delete",id:t.id}],f=[];let h=l;Array.from(u.content.children).forEach(m=>{const b=m.getAttribute("data-node-id");g.push({action:"insert",data:m.outerHTML,id:b,previousID:h,parentID:c}),f.push({action:"delete",id:b}),h=b}),f.push({action:"insert",data:o,id:t.id,previousID:l,parentID:c}),et(t.protyle,g,f)}else Ht(t.protyle,t.id,d,o);cn(t.protyle.wysiwyg.element,hn(t.protyle.wysiwyg.element)),t.protyle.wysiwyg.element.querySelectorAll('[data-type~="block-ref"]').forEach(u=>{u.textContent===""&&ae("/api/block/getRefText",{id:u.getAttribute("data-id")},g=>{u.innerHTML=g.data})}),$n(t.protyle,t.protyle.wysiwyg.element),zn(t.protyle.wysiwyg.element),ra(t.protyle.wysiwyg.element),Ua(t.protyle.wysiwyg.element,t.protyle)});let xA;const et=(t,e,n)=>{if(e.length===0)return;if(!t){ae("/api/transactions",{session:p.SIYUAN_APPID,app:p.SIYUAN_APPID,transactions:[{doOperations:e}]});return}const a=window.siyuan.transactions[window.siyuan.transactions.length-1];let i=!1;const s=new Date().getTime();if(a&&a.doOperations.length===1&&a.doOperations[0].action==="update"&&e.length===1&&e[0].action==="update"&&a.doOperations[0].id===e[0].id&&t.transactionTime-s<p.TIMEOUT_INPUT&&(i=!0),n&&(window.siyuan.config.fileTree.openFilesUseCurrentTab&&t.model&&t.model.headElement.classList.remove("item--unupdate"),t.updated=!0,i?t.undo.replace(e,t):t.undo.add(e,n,t)),e.length===1&&(e[0].action==="unfoldHeading"||e[0].action==="setAttrViewBlockView"||e[0].action==="setAttrs"&&e[0].data.startsWith('{"fold":'))||e.length===2&&e[0].action==="insertAttrViewBlock"){t.transactionTime=s+p.TIMEOUT_INPUT*2,ae("/api/transactions",{session:t.id,app:p.SIYUAN_APPID,transactions:[{doOperations:e,undoOperations:n}]},r=>{r.data[0].doOperations.forEach(o=>{if(o.action==="unfoldHeading"||o.action==="foldHeading")EA(o,t);else if(o.action==="setAttrs"){const l=t.gutter.element.querySelector('[data-type="fold"]');l&&l.removeAttribute("disabled"),t.wysiwyg.element.querySelectorAll('[data-type="NodeBlockQueryEmbed"]').forEach(c=>{c.querySelector(`[data-node-id="${o.id}"]`)&&(c.removeAttribute("data-render"),$n(t,c))})}})});return}window.clearTimeout(xA),i?(window.siyuan.transactions[window.siyuan.transactions.length-1].protyle=t,window.siyuan.transactions[window.siyuan.transactions.length-1].doOperations=e):window.siyuan.transactions.push({protyle:t,doOperations:e,undoOperations:n}),t.transactionTime=s,xA=window.setTimeout(()=>{yA()},p.TIMEOUT_INPUT*2),e.find(r=>{var o;if(r.action==="insert")return(o=t.observerLoad)==null||o.disconnect(),!0})},EA=(t,e)=>{var n;if(t.action==="unfoldHeading"||t.action==="foldHeading"){const a=e.gutter.element.querySelector('[data-type="fold"]');if(a&&a.removeAttribute("disabled"),t.action==="unfoldHeading"){const i=e.contentElement.scrollTop;if(e.wysiwyg.element.querySelectorAll(`[data-node-id="${t.id}"]`).forEach(s=>{const r=ge(s);if(r){r.removeAttribute("data-render"),$n(e,r);return}if(s.lastElementChild.classList.contains("protyle-attr")||s.lastElementChild.remove(),vA(t.retData,e),s.insertAdjacentHTML("afterend",t.retData),t.data==="remove"){const o=getSelection();o.rangeCount>0&&s.contains(o.getRangeAt(0).startContainer)&&qt(s.nextElementSibling,void 0,!0),s.remove()}}),e.disabled&&br(e),zn(e.wysiwyg.element),ra(e.wysiwyg.element),Ua(e.wysiwyg.element,e),$n(e,e.wysiwyg.element),(n=t.context)!=null&&n.focusId){const s=e.wysiwyg.element.querySelector(`[data-node-id="${t.context.focusId}"]`);qt(s),kn(e,s)}else e.contentElement.scrollTop=i,e.scroll.lastScrollTop=i;return}e.wysiwyg.element.querySelectorAll(`[data-node-id="${t.id}"]`).forEach(i=>{const s=ge(i);s&&(s.removeAttribute("data-render"),$n(e,s))}),e.wysiwyg.element.lastElementChild.getAttribute("data-eof")!=="2"&&!e.scroll.element.classList.contains("fn__none")&&e.contentElement.scrollHeight-e.contentElement.scrollTop<e.contentElement.clientHeight*2&&ae("/api/filetree/getDoc",{id:e.wysiwyg.element.lastElementChild.getAttribute("data-node-id"),mode:2,size:window.siyuan.config.editor.dynamicLoadBlocks},i=>{_a({data:i,protyle:e,action:[p.CB_GET_APPEND,p.CB_GET_UNCHANGEID]})});return}},Ht=(t,e,n,a)=>{n!==a&&et(t,[{id:e,data:n,action:"update"}],[{id:e,data:a,action:"update"}])},lc=(t,e,n)=>{const a=[],i=[];t.forEach(s=>{const r=s.getAttribute("data-node-id");s.classList.remove("protyle-wysiwyg--select"),s.removeAttribute("select-start"),s.removeAttribute("select-end"),i.push({action:"update",id:r,data:s.outerHTML}),n(s),a.push({action:"update",id:r,data:s.outerHTML})}),et(e,a,i)},kA=()=>{var t;const e=document.getElementById("dragGhost");if(e){if(e.dataset.ghostType==="dock")e.parentElement.querySelectorAll(".dock__item").forEach(n=>{n.style.opacity=""}),(t=document.querySelector("#dockMoveItem"))==null||t.remove();else{const n=e.parentElement.querySelector(`[data-node-id="${e.getAttribute("data-node-id")}"]`);n&&(n.style.opacity=""),e.parentElement.querySelectorAll(".dragover__top, .dragover__bottom, .dragover, .dragover__current").forEach(a=>{a.classList.remove("dragover__top","dragover__bottom","dragover","dragover__current"),a.style.opacity=""})}e.remove(),document.onmousemove=null,_x()}},zi={},_x=()=>{zi.animationId&&(cancelAnimationFrame(zi.animationId),zi.animationId=null,zi.element=null,zi.space=null,zi.lastTime=null)},SA=t=>{zi.lastTime||(zi.lastTime=t-8),zi.element.scroll({top:zi.element.scrollTop+(t-zi.lastTime)*zi.space/64}),zi.animationId=requestAnimationFrame(SA),zi.lastTime=t},qF=(t,e,n)=>{const a=t.clientY<e.top+p.SIZE_SCROLL_TB;a||t.clientY>e.bottom-p.SIZE_SCROLL_TB?(zi.space=a?t.clientY-e.top-p.SIZE_SCROLL_TB:t.clientY-e.bottom+p.SIZE_SCROLL_TB,zi.animationId||(zi.element=n,zi.animationId=requestAnimationFrame(SA))):_x()};class cc extends Wa{constructor(e){super({app:e.app,id:e.tab.id,callback(){this.type==="local"&&ae("/api/block/checkBlockExist",{id:this.blockId},a=>{a.data||this.parent.parent.removeTab(this.parent.id)})},msgCallback(a){if(a)switch(a.cmd){case"savedoc":this.onTransaction(a);break;case"rename":this.type==="local"&&this.blockId===a.data.id?this.parent.updateTitle(a.data.title):this.updateDocTitle({title:a.data.title,icon:p.ZWSP},-1);break;case"unmount":this.type==="local"&&ae("/api/block/checkBlockExist",{id:this.blockId},i=>{i.data||this.parent.parent.removeTab(this.parent.id)});break;case"removeDoc":a.data.ids.includes(this.blockId)&&this.type==="local"&&this.parent.parent.removeTab(this.parent.id);break}}}),this.preFilterExpandIds=null,this.isPreview=e.isPreview,this.blockId=e.blockId,this.type=e.type,e.tab.panelElement.classList.add("fn__flex-column","file-tree","sy__outline"),e.tab.panelElement.innerHTML=`<div class="block__icons fn__hidescrollbar">
    <div class="block__logo">
        <svg class="block__logoicon"><use xlink:href="#iconAlignCenter"></use></svg>${window.siyuan.languages.outline}
    </div>
    <span class="fn__flex-1 fn__space"></span>
    <input class="b3-text-field search__label fn__none fn__size200" placeholder="${window.siyuan.languages.filterKeywordEnter}" />
    <span data-type="search" class="block__icon ariaLabel" aria-label="${window.siyuan.languages.filter}">
        <svg><use xlink:href='#iconFilter'></use></svg>
    </span>
    <span class="fn__space"></span>
    <span data-type="keepCurrentExpand" class="block__icon ariaLabel${window.siyuan.storage[p.LOCAL_OUTLINE].keepCurrentExpand?" block__icon--active":""}" aria-label="${window.siyuan.languages.outlineKeepCurrentExpand}">
        <svg><use xlink:href="#iconFocus"></use></svg>
    </span>
    <span class="fn__space"></span>
    <span data-type="expandLevel" class="block__icon ariaLabel" aria-label="${window.siyuan.languages.expandLevel}">
        <svg><use xlink:href="#iconList"></use></svg>
    </span>
    <span class="fn__space"></span>
    <span data-type="expand" class="block__icon ariaLabel" aria-label="${window.siyuan.languages.expandAll}${un(window.siyuan.config.keymap.editor.general.expand.custom)}">
        <svg><use xlink:href="#iconExpand"></use></svg>
    </span>
    <span class="fn__space"></span>
    <span data-type="collapse" class="block__icon ariaLabel" aria-label="${window.siyuan.languages.foldAll}${un(window.siyuan.config.keymap.editor.general.collapse.custom)}">
        <svg><use xlink:href="#iconContract"></use></svg>
    </span>
    <span class="${this.type==="local"?"fn__none ":""}fn__space"></span>
    <span data-type="min" class="${this.type==="local"?"fn__none ":""}block__icon ariaLabel" aria-label="${window.siyuan.languages.min}${un(window.siyuan.config.keymap.general.closeTab.custom)}">
        <svg><use xlink:href='#iconMin'></use></svg>
    </span>
</div>
<div class="b3-list-item fn__none"></div>
<div class="fn__flex-1" style="padding: 3px 0 8px"></div>`,this.element=e.tab.panelElement.lastElementChild,this.headerElement=e.tab.panelElement.firstElementChild;const n=this.headerElement.querySelector("input.b3-text-field.search__label");n.addEventListener("blur",()=>{n.classList.add("fn__none");const a=n.nextElementSibling,i=n.value;i?(a.classList.add("block__icon--active"),a.setAttribute("aria-label",window.siyuan.languages.filter+" "+ft(i))):(a.classList.remove("block__icon--active"),a.setAttribute("aria-label",window.siyuan.languages.filter)),n.dataset.value!==i&&this.setFilter()}),n.addEventListener("keydown",a=>{!a.isComposing&&a.key==="Enter"&&(n.dataset.value=n.value,this.setFilter())}),this.tree=new Po({element:this.element,data:null,click:a=>{const i=a.getAttribute("data-node-id");if(this.isPreview){const s=document.getElementById(i);if(s){const r=me(s,"protyle");if(r){const o=mi(r.getAttribute("data-id"));o.parent.switchTab(o.headElement)}s.scrollIntoView()}else dn({app:e.app,id:this.blockId,mode:"preview"})}else na(i,s=>{dn({app:e.app,id:i,action:s?[p.CB_GET_FOCUS,p.CB_GET_ALL,p.CB_GET_HTML,p.CB_GET_OUTLINE]:[p.CB_GET_FOCUS,p.CB_GET_OUTLINE,p.CB_GET_SETID,p.CB_GET_CONTEXT,p.CB_GET_HTML]})})},ctrlClick:(a,i)=>{const s=N(i.target,"b3-list-item__toggle");if(s&&!s.classList.contains("fn__hidden")){this.collapseChildren(a);return}const r=a.getAttribute("data-node-id");dn({app:e.app,id:r,action:[p.CB_GET_FOCUS,p.CB_GET_ALL,p.CB_GET_HTML],zoomIn:!0})},altClick:(a,i)=>{N(i.target,"b3-list-item__toggle")&&this.collapseSameLevel(a)},rightClick:(a,i)=>{this.showContextMenu(a,i)},toggleClick:a=>{if(!a.nextElementSibling)return;const i=a.firstElementChild.firstElementChild;i.classList.contains("b3-list-item__arrow--open")?(i.classList.remove("b3-list-item__arrow--open"),a.nextElementSibling.classList.add("fn__none"),a.nextElementSibling.nextElementSibling&&a.nextElementSibling.nextElementSibling.tagName==="UL"&&a.nextElementSibling.nextElementSibling.classList.add("fn__none")):(i.classList.add("b3-list-item__arrow--open"),a.nextElementSibling.classList.remove("fn__none"),a.nextElementSibling.nextElementSibling&&a.nextElementSibling.nextElementSibling.tagName==="UL"&&a.nextElementSibling.nextElementSibling.classList.remove("fn__none")),this.saveExpendIds()}}),e.tab.panelElement.querySelector('[data-type="collapse"]').addEventListener("click",()=>{this.tree.collapseAll(),this.saveExpendIds()}),e.tab.panelElement.querySelector('[data-type="expand"]').addEventListener("click",()=>{this.tree.expandAll(),this.saveExpendIds()}),e.tab.panelElement.querySelector('[data-type="keepCurrentExpand"]').addEventListener("click",a=>{const i=N(a.target,"block__icon");if(i){if(i.classList.contains("block__icon--active"))i.classList.remove("block__icon--active"),window.siyuan.storage[p.LOCAL_OUTLINE].keepCurrentExpand=!1;else{i.classList.add("block__icon--active"),window.siyuan.storage[p.LOCAL_OUTLINE].keepCurrentExpand=!0;let s;Cn().editor.find(r=>{if(r.editor.protyle.block.rootID===this.blockId){const o=getSelection();if(o.rangeCount>0){const l=oe(o.getRangeAt(0).startContainer);if(l)return s=l,!0}}}),s&&this.setCurrent(s)}Gt(p.LOCAL_OUTLINE,window.siyuan.storage[p.LOCAL_OUTLINE])}}),e.tab.panelElement.addEventListener("click",a=>{let i=a.target;if(i.tagName==="INPUT")return;let s=!0;for(;i&&!i.isEqualNode(e.tab.panelElement);){if(i.classList.contains("block__icon")){switch(i.getAttribute("data-type")){case"min":Vn("outline").toggleModel("outline",!1,!0);break;case"search":n.classList.remove("fn__none"),n.select();break;case"expandLevel":this.showExpandLevelMenu(i),a.preventDefault(),a.stopPropagation();break}break}else if(this.blockId&&(i===this.headerElement.nextElementSibling||i.classList.contains("block__icons"))){dn({app:e.app,id:this.blockId,afterOpen:r=>{r&&(this.isPreview?r.editor.protyle.preview.element.querySelector(".b3-typography").scrollTop=0:Uv(r.editor.protyle))}}),s=!1;break}i=i.parentElement}s&&(this.type==="local"?ca(e.tab.panelElement.parentElement.parentElement):ca(e.tab.panelElement))}),this.bindSort(),ae("/api/outline/getDocOutline",{id:this.blockId,preview:this.isPreview},a=>{var i,s,r,o;this.update(a),this.updateDocTitle((r=(s=(i=e.tab.model)==null?void 0:i.editor.protyle)==null?void 0:s.background)==null?void 0:r.ial,((o=a.data)==null?void 0:o.length)||0)})}bindSort(){this.element.addEventListener("mousedown",e=>{const n=N(e.target,"b3-list-item");if(!n||n.tagName!=="LI"||this.element.getAttribute("data-loading")==="true")return;const a=document;a.ondragstart=()=>!1;let i,s,r;Cn().editor.find(l=>{if(l.editor.protyle.block.rootID===this.blockId)return r=l.editor.protyle,!0});const o=this.element.getBoundingClientRect();a.onmousemove=l=>{if(!r||r.disabled||Math.abs(l.clientY-e.clientY)<3&&Math.abs(l.clientX-e.clientX)<3)return;if(l.preventDefault(),l.stopPropagation(),i||(n.style.opacity="0.38",i=n.cloneNode(!0),this.element.append(i),i.setAttribute("id","dragGhost"),i.firstElementChild.setAttribute("style","padding-left:4px"),i.setAttribute("style",`border-radius: var(--b3-border-radius);background-color: var(--b3-list-hover);position: fixed; top: ${e.clientY}px; left: ${e.clientX}px; z-index:999997;`)),i.style.top=l.clientY+"px",i.style.left=l.clientX+"px",qF(l,o,this.element),!this.element.contains(l.target)){this.element.querySelectorAll(".dragover__top, .dragover__bottom, .dragover, .dragover__current").forEach(u=>{u.classList.remove("dragover__top","dragover__bottom","dragover","dragover__current")});return}if(s=N(l.target,"b3-list-item"),!s||s.tagName!=="LI"||s.style.position==="fixed")return;if(this.element.querySelectorAll(".dragover__top, .dragover__bottom, .dragover, .dragover__current").forEach(u=>{u.classList.remove("dragover__top","dragover__bottom","dragover","dragover__current")}),s===n){s.classList.add("dragover__current");return}const c=s.getBoundingClientRect(),d=c.height*.2;l.clientY>c.bottom-d?s.classList.add("dragover__bottom"):l.clientY<c.top+d?s.classList.add("dragover__top"):s.classList.add("dragover")},a.onmouseup=()=>{var l,c,d,u,g;a.onmousemove=null,a.onmouseup=null,a.ondragstart=null,a.onselectstart=null,a.onselect=null,i==null||i.remove(),n.style.opacity="",_x(),s||(s=this.element.querySelector(".dragover__top, .dragover__bottom, .dragover"));let f=!0;if(s&&r&&(s.classList.contains("dragover__top")||s.classList.contains("dragover__bottom")||s.classList.contains("dragover"))){let h,m;const b=n.previousElementSibling&&n.previousElementSibling.tagName==="UL"?n.previousElementSibling.previousElementSibling.getAttribute("data-node-id"):(l=n.previousElementSibling)==null?void 0:l.getAttribute("data-node-id"),y=(c=n.parentElement.previousElementSibling)==null?void 0:c.getAttribute("data-node-id");if(s.classList.contains("dragover")?(m=s.getAttribute("data-node-id"),s.nextElementSibling&&s.nextElementSibling.tagName==="UL"?s.nextElementSibling.insertAdjacentElement("afterbegin",n):(s.insertAdjacentHTML("afterend",`<ul>${n.outerHTML}</ul>`),n.remove())):s.classList.contains("dragover__top")?(m=(d=s.parentElement.previousElementSibling)==null?void 0:d.getAttribute("data-node-id"),s.previousElementSibling&&s.previousElementSibling.tagName==="UL"?h=s.previousElementSibling.previousElementSibling.getAttribute("data-node-id"):h=(u=s.previousElementSibling)==null?void 0:u.getAttribute("data-node-id"),h===n.dataset.nodeId||m===n.dataset.nodeId?f=!1:s.before(n)):s.classList.contains("dragover__bottom")&&(h=s.getAttribute("data-node-id"),h===((g=n.previousElementSibling)==null?void 0:g.getAttribute("data-node-id"))?f=!1:s.after(n)),f)return this.element.setAttribute("data-loading","true"),et(r,[{action:"moveOutlineHeading",id:n.dataset.nodeId,previousID:h,parentID:m}],[{action:"moveOutlineHeading",id:n.dataset.nodeId,previousID:b,parentID:y}]),r.wysiwyg.element.querySelectorAll('[data-type="NodeHeading"] [contenteditable="true"][spellcheck]').forEach(_=>{_.setAttribute("contenteditable","false")}),!0}this.element.querySelectorAll(".dragover__top, .dragover__bottom, .dragover, .dragover__current").forEach(h=>{h.classList.remove("dragover__top","dragover__bottom","dragover","dragover__current")})}})}updateDocTitle(e,n){var a;const i=this.headerElement.nextElementSibling;if(this.type==="pin"){if(!e&&typeof n=="undefined"){i.classList.add("fn__none");return}if(e){let s=`${Yt(e.icon||window.siyuan.storage[p.LOCAL_IMAGES].file,"b3-list-item__graphic",!0)}`;e.icon===p.ZWSP&&i.firstElementChild&&(s=i.firstElementChild.outerHTML),i.innerHTML=`${s}<span class="b3-list-item__text">${he(e.title)}</span>${((a=i.querySelector(".counter"))==null?void 0:a.outerHTML)||""}`,i.setAttribute("title",e.title),i.classList.remove("fn__none")}if(typeof n=="number"&&n!==-1){const s=i.querySelector(".counter");n>0?s?s.textContent=n.toString():i.insertAdjacentHTML("beforeend",`<span class="counter">${n.toString()}</span>`):s==null||s.remove()}}else i.classList.add("fn__none")}onTransaction(e){if(e.data.rootID!==this.blockId)return;let n=!1;const a=e.data.sources[0];a.doOperations.find(i=>{if(i.action==="update"&&(this.element.querySelector(`.b3-list-item[data-node-id="${i.id}"]`)||i.data.indexOf('data-type="NodeHeading"')>-1))return n=!0,!0;if(i.action==="insert"&&i.data.indexOf('data-type="NodeHeading"')>-1)return n=!0,!0;if(i.action==="delete"||i.action==="move")return n=!0,!0}),!n&&a.undoOperations&&a.undoOperations.find(i=>{var s;if(i.action==="update"&&((s=i.data)==null?void 0:s.indexOf('data-type="NodeHeading"'))>-1)return n=!0,!0}),n&&ae("/api/outline/getDocOutline",{id:this.blockId,preview:this.isPreview},i=>{var s;if(e.data.rootID===this.blockId&&(this.update(i),this.updateDocTitle(null,((s=i.data)==null?void 0:s.length)||0),getSelection().rangeCount>0)){const r=oe(getSelection().getRangeAt(0).startContainer);r&&r.getAttribute("data-type")==="NodeHeading"&&this.setCurrent(r)}})}setCurrent(e){if(e)if(e.getAttribute("data-type")==="NodeHeading")this.setCurrentById(e.getAttribute("data-node-id"));else{let n=ke(e);for(;n&&n.getAttribute("data-type")!=="NodeHeading";)n=ke(n);n?this.setCurrentById(n.getAttribute("data-node-id")):ae("/api/block/getBlockBreadcrumb",{id:e.getAttribute("data-node-id"),excludeTypes:[]},a=>{a.data.reverse().find(i=>{if(i.type==="NodeHeading")return this.setCurrentById(i.id),!0})})}}setCurrentByPreview(e){if(!e)return;let n=e;for(;n&&!n.classList.contains("b3-typography")&&!["H1","H2","H3","H4","H5","H6"].includes(n.tagName);)n=n.previousElementSibling||n.parentElement;n&&n.id&&this.setCurrentById(n.id)}setCurrentById(e){this.element.querySelectorAll(".b3-list-item.b3-list-item--focus").forEach(a=>{a.classList.remove("b3-list-item--focus")});let n=this.element.querySelector(`.b3-list-item[data-node-id="${e}"]`);if(window.siyuan.storage[p.LOCAL_OUTLINE].keepCurrentExpand){let a=n.parentElement;for(;a&&!a.classList.contains("b3-list")&&a.tagName==="UL";)a.classList.remove("fn__none"),a.previousElementSibling.querySelector(".b3-list-item__arrow").classList.add("b3-list-item__arrow--open"),a=a.parentElement;this.saveExpendIds()}else for(;n&&n.clientHeight===0;)n=n.parentElement.previousElementSibling;if(n){n.classList.add("b3-list-item--focus");const a=this.element.getBoundingClientRect();this.element.scrollTop=this.element.scrollTop+(n.getBoundingClientRect().top-(a.top+a.height/2))}}update(e,n){let a=this.element.querySelector(".b3-list-item--focus"),i;a&&(i=a.getAttribute("data-node-id"));const s=this.element.scrollTop;typeof n!="undefined"&&(this.blockId=n),this.tree.updateData(e.data),this.isPreview?(this.tree.element.querySelectorAll(".popover__block").forEach(r=>{r.classList.remove("popover__block")}),this.element.scrollTop=s):this.blockId&&(this.headerElement.querySelector("input.b3-text-field.search__label").value&&this.setFilter(),this.element.scrollTop=s),i&&(a=this.element.querySelector(`[data-node-id="${i}"]`),a&&a.classList.add("b3-list-item--focus")),this.element.removeAttribute("data-loading")}saveExpendIds(){window.siyuan.config.readonly||window.siyuan.isPublish||!this.isPreview&&this.type==="pin"&&ae("/api/storage/setOutlineStorage",{docID:this.blockId,val:{expandIds:this.tree.getExpandIds()}})}setFilter(){this.element.querySelectorAll('li.b3-list-item[style$="display: none;"]').forEach(n=>{n.style.display=""}),this.element.querySelectorAll("ul.fn__none").forEach(n=>{n.previousElementSibling.querySelector(".b3-list-item__toggle").classList.remove("fn__hidden")});const e=this.headerElement.querySelector("input.b3-text-field.search__label").value.toLowerCase();if(e){this.preFilterExpandIds||(this.preFilterExpandIds=this.tree.getExpandIds());const n=a=>{let i=!1,s=!1;return a.querySelectorAll(":scope > li.b3-list-item").forEach(o=>{var l;const c=o.nextElementSibling&&o.nextElementSibling.tagName==="UL"?o.nextElementSibling:void 0;let d={hasMatch:!1,hasChildMatch:!1};c&&(d=n(c));const u=o.querySelector(".b3-list-item__arrow");(((l=o.querySelector(".b3-list-item__text"))==null?void 0:l.textContent)||"").trim().toLowerCase().includes(e)?(o.style.display="",i=!0,c&&(c.classList.remove("fn__none"),d.hasMatch||d.hasChildMatch?(u.classList.add("b3-list-item__arrow--open"),c.classList.remove("fn__none")):(u.classList.remove("b3-list-item__arrow--open"),u.parentElement.classList.add("fn__hidden"),c.classList.add("fn__none")))):d.hasMatch||d.hasChildMatch?(o.style.display="",s=!0,c&&(c.classList.remove("fn__none"),u.classList.add("b3-list-item__arrow--open"))):(o.style.display="none",c&&c.classList.add("fn__none"))}),{hasMatch:i,hasChildMatch:s}};n(this.element.firstElementChild);return}this.tree.setExpandIds(this.preFilterExpandIds),this.preFilterExpandIds=null}getHeadingLevel(e){var n;return parseInt(((n=e.getAttribute("data-subtype"))==null?void 0:n.replace("h",""))||"0")}expandToLevel(e){e>=6?this.tree.expandAll():this.element.querySelectorAll("li.b3-list-item").forEach(n=>{const a=this.getHeadingLevel(n),i=n.querySelector(".b3-list-item__arrow");n.nextElementSibling&&n.nextElementSibling.tagName==="UL"&&i&&(a>0&&a<e?(i.classList.add("b3-list-item__arrow--open"),n.nextElementSibling.classList.remove("fn__none")):a>=e&&(i.classList.remove("b3-list-item__arrow--open"),n.nextElementSibling.classList.add("fn__none")))}),this.saveExpendIds()}showExpandLevelMenu(e){window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_OUTLINE_EXPAND_LEVEL);for(let a=1;a<=6;a++)window.siyuan.menus.menu.append(new xe({id:`heading${a}`,icon:`iconH${a}`,label:window.siyuan.languages[`heading${a}`],click:()=>this.expandToLevel(a)}).element);const n=e.getBoundingClientRect();return window.siyuan.menus.menu.popup({x:n.left,y:n.bottom,h:n.height}),window.siyuan.menus.menu}collapseSameLevel(e,n){this.element.querySelectorAll(`li.b3-list-item[data-subtype="${e.getAttribute("data-subtype")}"]`).forEach(a=>{const i=a.querySelector(".b3-list-item__arrow");if(typeof n=="undefined"&&(n=!e.querySelector(".b3-list-item__arrow").classList.contains("b3-list-item__arrow--open")),n){a.nextElementSibling&&a.nextElementSibling.tagName==="UL"&&(a.nextElementSibling.classList.remove("fn__none"),i.classList.add("b3-list-item__arrow--open"));let s=a.parentElement;for(;s&&!s.classList.contains("b3-list")&&s.tagName==="UL";)s.classList.remove("fn__none"),s.previousElementSibling.querySelector(".b3-list-item__arrow").classList.add("b3-list-item__arrow--open"),s=s.parentElement}else a.nextElementSibling&&a.nextElementSibling.tagName==="UL"&&(a.nextElementSibling.classList.add("fn__none"),i.classList.remove("b3-list-item__arrow--open"))}),this.saveExpendIds()}collapseChildren(e,n){const a=e.nextElementSibling;if(!a||a.tagName!=="UL")return;const i=e.querySelector(".b3-list-item__arrow");typeof n=="undefined"&&(n=!i.classList.contains("b3-list-item__arrow--open")),n?(i.classList.add("b3-list-item__arrow--open"),a.classList.remove("fn__none"),a.querySelectorAll("ul").forEach(s=>{s.previousElementSibling.querySelector(".b3-list-item__arrow").classList.add("b3-list-item__arrow--open"),s.classList.remove("fn__none")})):(i.classList.remove("b3-list-item__arrow--open"),a.classList.add("fn__none")),this.saveExpendIds()}showContextMenu(e,n){if(this.isPreview)return;const a=this.getHeadingLevel(e);window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_OUTLINE_CONTEXT);const i=e.getAttribute("data-node-id");if(!window.siyuan.config.readonly){a>1&&window.siyuan.menus.menu.append(new xe({id:"upgrade",icon:"iconUp",label:window.siyuan.languages.upgrade,click:()=>{const r=this.getProtyleAndBlockElement(e);r&&mr({protyle:r.protyle,selectsElement:[r.blockElement],type:"Blocks2Hs",level:a-1})}}).element),a<6&&window.siyuan.menus.menu.append(new xe({id:"downgrade",icon:"iconDown",label:window.siyuan.languages.downgrade,click:()=>{const r=this.getProtyleAndBlockElement(e);r&&mr({protyle:r.protyle,selectsElement:[r.blockElement],type:"Blocks2Hs",level:a+1})}}).element),na(i,r=>{dn({app:this.app,id:i,action:r?[p.CB_GET_FOCUS,p.CB_GET_ALL,p.CB_GET_HTML,p.CB_GET_OUTLINE]:[p.CB_GET_FOCUS,p.CB_GET_OUTLINE,p.CB_GET_SETID,p.CB_GET_CONTEXT,p.CB_GET_HTML]})}),this.setCurrentById(i);const s=[];a!==1&&s.push(this.genHeadingTransform(i,1)),a!==2&&s.push(this.genHeadingTransform(i,2)),a!==3&&s.push(this.genHeadingTransform(i,3)),a!==4&&s.push(this.genHeadingTransform(i,4)),a!==5&&s.push(this.genHeadingTransform(i,5)),a!==6&&s.push(this.genHeadingTransform(i,6)),s.length>0&&window.siyuan.menus.menu.append(new xe({id:"tWithSubtitle",type:"submenu",icon:"iconRefresh",label:window.siyuan.languages.tWithSubtitle,submenu:s}).element),window.siyuan.menus.menu.append(new xe({id:"separator_1",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"insertSameLevelHeadingBefore",icon:"iconBefore",label:window.siyuan.languages.insertSameLevelHeadingBefore,click:()=>{var r;const o=this.getProtyleAndBlockElement(e),l=Lute.NewNodeID(),c=`<div data-subtype="h${a}" data-node-id="${l}" data-type="NodeHeading" class="h${a}"><div contenteditable="true" spellcheck="false"><wbr></div><div class="protyle-attr" contenteditable="false">${p.ZWSP}</div></div>`;et(o.protyle,[{action:"insert",data:c,id:l,previousID:(r=o.blockElement.previousElementSibling)==null?void 0:r.getAttribute("data-node-id"),parentID:o.blockElement.parentElement.getAttribute("data-node-id")||o.protyle.block.parentID}],[{action:"delete",id:l}]),o.blockElement.insertAdjacentHTML("beforebegin",c),o.blockElement.previousElementSibling.scrollIntoView(),cn(o.blockElement.previousElementSibling,document.createRange())}}).element),window.siyuan.menus.menu.append(new xe({id:"insertSameLevelHeadingAfter",icon:"iconAfter",label:window.siyuan.languages.insertSameLevelHeadingAfter,click:()=>{ae("/api/block/getHeadingDeleteTransaction",{id:i},r=>{const o=this.getProtyleAndBlockElement(e),l=r.data.doOperations[r.data.doOperations.length-1].id,c=Lute.NewNodeID(),d=`<div data-subtype="h${a}" data-node-id="${c}" data-type="NodeHeading" class="h${a}"><div contenteditable="true" spellcheck="false"><wbr></div><div class="protyle-attr" contenteditable="false">${p.ZWSP}</div></div>`;et(o.protyle,[{action:"insert",data:d,id:c,previousID:l}],[{action:"delete",id:c}]);const u=o.protyle.wysiwyg.element.querySelector(`[data-node-id="${l}"]`);u&&(u.insertAdjacentHTML("afterend",d),u.nextElementSibling.scrollIntoView(),cn(u.nextElementSibling,document.createRange()))})}}).element),a<6&&window.siyuan.menus.menu.append(new xe({id:"addChildHeading",icon:"iconAdd",label:window.siyuan.languages.addChildHeading,click:()=>{ae("/api/block/getHeadingDeleteTransaction",{id:i},r=>{let o=r.data.doOperations[r.data.doOperations.length-1].id;r.data.undoOperations.find((g,f)=>{const h=g.data.indexOf(' data-subtype="h');if(h>-1&&h<260&&parseInt(g.data.substring(h+16,h+17))===a+1)return o=r.data.undoOperations[f-1].id,!0});const l=this.getProtyleAndBlockElement(e),c=Lute.NewNodeID(),d=`<div data-subtype="h${a+1}" data-node-id="${c}" data-type="NodeHeading" class="h${a+1}"><div contenteditable="true" spellcheck="false"><wbr></div><div class="protyle-attr" contenteditable="false">${p.ZWSP}</div></div>`;et(l.protyle,[{action:"insert",data:d,id:c,previousID:o}],[{action:"delete",id:c}]);const u=l.protyle.wysiwyg.element.querySelector(`[data-node-id="${o}"]`);u&&(u.insertAdjacentHTML("afterend",d),u.nextElementSibling.scrollIntoView(),cn(u.nextElementSibling,document.createRange()))})}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_2",type:"separator"}).element)}window.siyuan.menus.menu.append(new xe({id:"copyHeadings1",icon:"iconCopy",label:`${window.siyuan.languages.copy} ${window.siyuan.languages.headings1}`,click:()=>{const s=this.getProtyleAndBlockElement(e);ae("/api/block/getHeadingChildrenDOM",{id:i,removeFoldAttr:s.blockElement.getAttribute("fold")!=="1"},r=>{St()?window.JSAndroid.writeHTMLClipboard(s.protyle.lute.BlockDOM2StdMd(r.data).trimEnd(),r.data+p.ZWSP):Qt()?window.JSHarmony.writeHTMLClipboard(s.protyle.lute.BlockDOM2StdMd(r.data).trimEnd(),r.data+p.ZWSP):ut(r.data+p.ZWSP)})}}).element),window.siyuan.config.readonly||(window.siyuan.menus.menu.append(new xe({id:"cutHeadings1",icon:"iconCut",label:`${window.siyuan.languages.cut} ${window.siyuan.languages.headings1}`,click:()=>{const s=this.getProtyleAndBlockElement(e);ae("/api/block/getHeadingChildrenDOM",{id:i,removeFoldAttr:s.blockElement.getAttribute("fold")!=="1"},r=>{St()?window.JSAndroid.writeHTMLClipboard(s.protyle.lute.BlockDOM2StdMd(r.data).trimEnd(),r.data+p.ZWSP):Qt()?window.JSHarmony.writeHTMLClipboard(s.protyle.lute.BlockDOM2StdMd(r.data).trimEnd(),r.data+p.ZWSP):ut(r.data+p.ZWSP),ae("/api/block/getHeadingDeleteTransaction",{id:i},o=>{if(o.data.doOperations.forEach(l=>{s.protyle.wysiwyg.element.querySelectorAll(`[data-node-id="${l.id}"]`).forEach(c=>{c.remove()})}),s.protyle.wysiwyg.element.childElementCount===0){const l=Lute.NewNodeID(),c=Fs(!1,!1,l);s.protyle.wysiwyg.element.insertAdjacentElement("afterbegin",c),o.data.doOperations.push({action:"insert",data:c.outerHTML,id:l,parentID:s.protyle.block.parentID}),o.data.undoOperations.push({action:"delete",id:l}),qt(c)}et(s.protyle,o.data.doOperations,o.data.undoOperations)})})}}).element),window.siyuan.menus.menu.append(new xe({id:"deleteHeadings1",icon:"iconTrashcan",label:`${window.siyuan.languages.delete} ${window.siyuan.languages.headings1}`,click:()=>{const s=this.getProtyleAndBlockElement(e);ae("/api/block/getHeadingDeleteTransaction",{id:i},r=>{if(r.data.doOperations.forEach(o=>{s.protyle.wysiwyg.element.querySelectorAll(`[data-node-id="${o.id}"]`).forEach(l=>{l.remove()})}),s.protyle.wysiwyg.element.childElementCount===0){const o=Lute.NewNodeID(),l=Fs(!1,!1,o);s.protyle.wysiwyg.element.insertAdjacentElement("afterbegin",l),r.data.doOperations.push({action:"insert",data:l.outerHTML,id:o,parentID:s.protyle.block.parentID}),r.data.undoOperations.push({action:"delete",id:o}),qt(l)}et(s.protyle,r.data.doOperations,r.data.undoOperations)})}}).element)),window.siyuan.menus.menu.append(new xe({id:"separator_3",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"expandChildHeading",icon:"iconExpand",label:window.siyuan.languages.expandChildHeading,accelerator:"\u2318"+window.siyuan.languages.clickArrow,click:()=>this.collapseChildren(e,!0)}).element),window.siyuan.menus.menu.append(new xe({id:"foldChildHeading",icon:"iconContract",label:window.siyuan.languages.foldChildHeading,accelerator:"\u2318"+window.siyuan.languages.clickArrow,click:()=>this.collapseChildren(e,!1)}).element),window.siyuan.menus.menu.append(new xe({id:"expandSameLevelHeading",icon:"iconExpand",label:window.siyuan.languages.expandSameLevelHeading,accelerator:"\u2325"+window.siyuan.languages.clickArrow,click:()=>this.collapseSameLevel(e,!0)}).element),window.siyuan.menus.menu.append(new xe({id:"foldSameLevelHeading",icon:"iconContract",label:window.siyuan.languages.foldSameLevelHeading,accelerator:"\u2325"+window.siyuan.languages.clickArrow,click:()=>this.collapseSameLevel(e,!1)}).element),window.siyuan.menus.menu.append(new xe({id:"expandAll",icon:"iconExpand",label:window.siyuan.languages.expandAll,click:()=>{this.tree.expandAll(),this.saveExpendIds()}}).element),window.siyuan.menus.menu.append(new xe({id:"foldAll",icon:"iconContract",label:window.siyuan.languages.foldAll,click:()=>{this.tree.collapseAll(),this.saveExpendIds()}}).element),window.siyuan.menus.menu.popup({x:n.clientX,y:n.clientY})}getProtyleAndBlockElement(e){const n=e.getAttribute("data-node-id");let a,i;if(Cn().editor.find(s=>{if(s.editor.protyle.block.rootID===this.blockId)return a=s.editor.protyle,i=a.wysiwyg.element.querySelector(`[data-node-id="${n}"]`),!0}),!(!a||!i))return{protyle:a,blockElement:i}}genHeadingTransform(e,n){return{id:"heading"+n,iconHTML:"",icon:"iconHeading"+n,label:window.siyuan.languages["heading"+n],click:()=>{let a;Cn().editor.find(i=>{if(i.editor.protyle.block.rootID===this.blockId)return a=i.editor.protyle,!0}),a&&ae("/api/block/getHeadingLevelTransaction",{id:e,level:n},i=>{i.data.doOperations.forEach((s,r)=>{if(a.wysiwyg.element.querySelectorAll(`[data-node-id="${s.id}"]`).forEach(o=>{o.outerHTML=s.data}),a.wysiwyg.element.querySelectorAll(`[data-node-id="${s.id}"]`).forEach(o=>{Ei(o)}),r===0){const o=a.wysiwyg.element.querySelector(`[data-node-id="${s.id}"]`);o&&o.scrollIntoView({behavior:"smooth",block:"center"})}}),et(a,i.data.doOperations,i.data.undoOperations)})}}}}var p_=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const Jh=t=>p_(void 0,null,function*(){if(Cn().backlink.find(s=>{if(s.blockId===t.blockId&&s.type==="local")return s.parent.parent.removeTab(s.parent.id),!0}))return;let n;const a=document.querySelector(".layout__wnd--active");if(a&&(n=mi(a.getAttribute("data-id"))),n||(n=nm(window.siyuan.layout.centerLayout)),t.rootId){if(!t.title){const s=yield wn("api/block/getDocInfo",{id:t.blockId});if(s.code===-1)return;t.title=s.data.name||window.siyuan.languages.untitled}}else{const s=yield wn("api/block/getDocInfo",{id:t.blockId});if(s.code===-1)return;t.rootId=s.data.rootID,t.useBlockId=s.data.rootID!==s.data.id,t.title=s.data.name||window.siyuan.languages.untitled}n.split("lr").addTab(new Sa({icon:"iconLink",title:t.title,callback(s){s.addModel(new yl({app:t.app,type:"local",tab:s,blockId:t.useBlockId?t.blockId:t.rootId,rootId:t.rootId}))}}))}),Tz=t=>p_(void 0,null,function*(){if(getAllModels().graph.find(s=>{if(s.blockId===t.blockId&&s.type==="local")return s.parent.parent.removeTab(s.parent.id),!0}))return;let n;const a=document.querySelector(".layout__wnd--active");if(a&&(n=getInstanceById(a.getAttribute("data-id"))),n||(n=getWndByLayout(window.siyuan.layout.centerLayout)),t.rootId){if(!t.title){const s=yield fetchSyncPost("api/block/getDocInfo",{id:t.blockId});if(s.code===-1)return;t.title=s.data.name||window.siyuan.languages.untitled}}else{const s=yield fetchSyncPost("api/block/getDocInfo",{id:t.blockId});if(s.code===-1)return;t.rootId=s.data.rootID,t.useBlockId=s.data.rootID!==s.data.id,t.title=s.data.name||window.siyuan.languages.untitled}n.split("lr").addTab(new Tab({icon:"iconGraph",title:t.title,callback(s){s.addModel(new Graph({app:t.app,type:"local",tab:s,blockId:t.blockId,rootId:t.rootId}))}}))}),wx=t=>p_(void 0,null,function*(){if(Cn().outline.find(s=>{if(s.blockId===t.rootId&&s.type==="local")return s.parent.parent.removeTab(s.parent.id),!0}))return;let n;const a=document.querySelector(".layout__wnd--active");a&&(n=mi(a.getAttribute("data-id"))),n||(n=nm(window.siyuan.layout.centerLayout));const i=n.split("lr");if(t.title){const s=yield wn("api/block/getDocInfo",{id:t.rootId});t.title=s.data.name||window.siyuan.languages.untitled}i.addTab(new Sa({icon:"iconAlignCenter",title:t.title,callback(s){s.addModel(new cc({app:t.app,type:"local",tab:s,blockId:t.rootId,isPreview:t.isPreview}))}}),!1,!1),i.element.style.width="200px",i.element.classList.remove("fn__flex-1"),ek(i,n),ik(i.parent),Fi()}),vx=()=>{!window.siyuan.layout.leftDock.pin&&window.siyuan.layout.leftDock.layout.element.style.opacity==="1"&&window.siyuan.layout.leftDock.showDock(!0),!window.siyuan.layout.rightDock.pin&&window.siyuan.layout.rightDock.layout.element.style.opacity==="1"&&window.siyuan.layout.rightDock.showDock(!0),!window.siyuan.layout.bottomDock.pin&&window.siyuan.layout.bottomDock.layout.element.style.opacity==="1"&&window.siyuan.layout.bottomDock.showDock(!0)},xx=t=>{const e=t.getAttribute("xlink:href")==="#iconHideDock";e?t.setAttribute("xlink:href","#iconDock"):t.setAttribute("xlink:href","#iconHideDock"),window.siyuan.config.uiLayout.hideDock=e,document.querySelectorAll(".dock").forEach(n=>{e?n.classList.add("fn__none"):n.querySelectorAll(".dock__item").length>1&&n.classList.remove("fn__none")}),Ui(),vx()},Vo=()=>{const t=Cn();t.outline.find(e=>{if(e.type==="pin"){if(e.blockId==="")return;e.isPreview=!1,e.update({data:[],msg:"",code:0},""),e.updateDocTitle()}}),t.graph.forEach(e=>{if(e.type!=="global"){if(e.type==="local"||e.blockId==="")return;e.blockId="",e.graphData=void 0,e.onGraph(!1)}}),t.backlink.forEach(e=>{e.type!=="local"&&e.blockId!==""&&(e.saveStatus(),e.blockId="",e.render(void 0))})},AA=()=>p_(void 0,null,function*(){const t=Vn("file");if(!t)return!1;const e=t.data.file,n=document.querySelector(".layout__wnd--active > .fn__flex > .layout-tab-bar > .item--focus")||document.querySelector("ul.layout-tab-bar > .item--focus");if(n){const a=mi(n.getAttribute("data-id"));a&&a.model instanceof Ma&&(a.model.editor.protyle.wysiwyg.element.blur(),a.model.editor.protyle.title.editElement.blur(),yield e.selectItem(a.model.editor.protyle.notebookId,a.model.editor.protyle.path),e.lastSelectedElement=e.element.querySelector(".b3-list-item--focus"))}t.toggleModel("file",!0)});var WF=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const Ta={element:void 0,genHTML:()=>`<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.appearance4}
        <div class="b3-label__text">${window.siyuan.languages.appearance5}</div>
    </div>
    <span class="fn__space"></span>
    <select class="b3-select fn__flex-center fn__size200" id="mode">
      <option value="0" ${window.siyuan.config.appearance.mode===0&&!window.siyuan.config.appearance.modeOS?"selected":""}>${window.siyuan.languages.themeLight}</option>
      <option value="1" ${window.siyuan.config.appearance.mode===1&&!window.siyuan.config.appearance.modeOS?"selected":""}>${window.siyuan.languages.themeDark}</option>
      <option value="2" ${window.siyuan.config.appearance.modeOS?"selected":""}>${window.siyuan.languages.themeOS}</option>
    </select>
</div>
<div class="b3-label">
    <div class="fn__flex">
        <div class="fn__flex-center fn__flex-1">${window.siyuan.languages.theme}</div>
        <span class="fn__space"></span>
        <button class="b3-button b3-button--outline fn__flex-center fn__size200${W()?" fn__none":""}" id="appearanceOpenTheme">
            <svg><use xlink:href="#iconFolder"></use></svg>
            ${window.siyuan.languages.appearance9}
        </button>
    </div>
    <div class="fn__hr"></div>
    <div class="fn__flex config__item">
        <div class="fn__flex-center fn__flex-1 ft__on-surface">
            ${window.siyuan.languages.theme11}
        </div>
        <span class="fn__space"></span>
        <select class="b3-select fn__flex-center fn__size200" id="themeLight">
          ${qi(window.siyuan.config.appearance.lightThemes,window.siyuan.config.appearance.themeLight)}
        </select>
    </div>
    <div class="fn__hr"></div>
    <div class="fn__flex config__item">
        <div class="fn__flex-center fn__flex-1 ft__on-surface">
            ${window.siyuan.languages.theme12}
        </div>
        <span class="fn__space"></span>
        <select class="b3-select fn__flex-center fn__size200" id="themeDark">
           ${qi(window.siyuan.config.appearance.darkThemes,window.siyuan.config.appearance.themeDark)}
        </select>
    </div>
</div>
<div class="b3-label">
    <div class="fn__flex config__item">
        <div class="fn__flex-center fn__flex-1">
            ${window.siyuan.languages.icon}
        </div>
        <span class="fn__space"></span>
        <button class="b3-button b3-button--outline fn__flex-center fn__size200${W()?" fn__none":""}" id="appearanceOpenIcon">
            <svg><use xlink:href="#iconFolder"></use></svg>
            ${window.siyuan.languages.appearance8}
        </button>
    </div>
    <div class="fn__hr"></div>
    <div class="fn__flex config__item">
        <div class="fn__flex-center fn__flex-1 ft__on-surface">${window.siyuan.languages.theme2}</div>
        <span class="fn__space"></span>
        <select class="b3-select fn__flex-center fn__size200" id="icon">
            ${qi(window.siyuan.config.appearance.icons,window.siyuan.config.appearance.icon)}
        </select>
    </div>
</div>
<div class="b3-label fn__flex">
    <div class="fn__block">
        <div>
            ${window.siyuan.languages.appearance1}
        </div>
        <div class="fn__hr"></div>
        <div class="fn__flex config__item">
            <div class="fn__flex-center fn__flex-1 ft__on-surface">${window.siyuan.languages.appearance2}</div>
            <span class="fn__space"></span>
            <select id="codeBlockThemeLight" class="b3-select fn__size200">
                ${qi(p.SIYUAN_CONFIG_APPEARANCE_LIGHT_CODE,window.siyuan.config.appearance.codeBlockThemeLight)}
            </select>
        </div>
        <div class="fn__hr"></div>
        <div class="fn__flex config__item">
            <div class="fn__flex-center fn__flex-1 ft__on-surface">${window.siyuan.languages.appearance3}</div>
            <span class="fn__space"></span>
            <select id="codeBlockThemeDark" class="b3-select fn__size200">
                ${qi(p.SIYUAN_CONFIG_APPEARANCE_DARK_CODE,window.siyuan.config.appearance.codeBlockThemeDark)}
            </select>
        </div>
    </div>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.language}
        <div class="b3-label__text">${window.siyuan.languages.language1}</div>
    </div>
    <span class="fn__space"></span>
    <select id="lang" class="b3-select fn__flex-center fn__size200">${_y(window.siyuan.config.langs,window.siyuan.config.appearance.lang)}</select>
</div>
<div class="b3-label config__item${W()?" fn__none":" fn__flex"}">
    <div class="fn__flex-1">
        ${window.siyuan.languages.customEmoji}
        <div class="b3-label__text">${window.siyuan.languages.customEmojiTip}</div>
    </div>
    <span class="fn__space"></span>
    <button class="b3-button b3-button--outline fn__flex-center fn__size200" id="appearanceOpenEmoji">
        <svg><use xlink:href="#iconFolder"></use></svg>
        ${window.siyuan.languages.showInFolder}
    </button>
</div>
<div class="b3-label fn__flex config__item">
   <div class="fn__flex-1">
        ${window.siyuan.languages.resetLayout}
        <div class="b3-label__text">${window.siyuan.languages.appearance6}</div>
    </div>
    <span class="fn__space"></span>
    <button class="b3-button b3-button--outline fn__flex-center fn__size200" id="resetLayout">
        <svg><use xlink:href="#iconUndo"></use></svg>${window.siyuan.languages.reset}
    </button>
</div>
<div class="b3-label">
    <div class="fn__flex config__item">
        <div class="fn__flex-1 fn__flex-center">
            ${window.siyuan.languages.codeSnippet}
        </div>
        <span class="fn__space"></span>
        <a class="b3-button b3-button--outline fn__flex-center fn__size200${window.siyuan.config.lang!=="zh_CN"?" fn__none":""}" target="_blank" href="https://ld246.com/tag/code-snippet">
            <svg><use xlink:href="#iconUpload"></use></svg>${window.siyuan.languages.visitCommunityShare}
        </a>
    </div>
    <div class="fn__hr"></div>
    <div class="fn__flex config__item">
        <div class="fn__flex-center fn__flex-1 ft__on-surface">
            ${window.siyuan.languages.codeSnippetTip}
        </div>
        <span class="fn__space"></span>
        <button class="b3-button b3-button--outline fn__flex-center fn__size200" id="codeSnippet">
            <svg><use xlink:href="#iconSettings"></use></svg>${window.siyuan.languages.config}
        </button>
    </div>
</div>
<div class="b3-label">
    ${window.siyuan.languages.appearance16}
    <div class="fn__hr"></div>
    <label class="fn__flex">
        <div class="fn__flex-center fn__flex-1 ft__on-surface">
           ${window.siyuan.languages.appearance17}
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" id="hideStatusBar" type="checkbox"${window.siyuan.config.appearance.hideStatusBar?" checked":""}>
    </label>
    <div class="fn__hr"></div>
    <div class="fn__flex config__item">
        <div class="fn__flex-center fn__flex-1 ft__on-surface">
            ${window.siyuan.languages.appearance18}
        </div>
        <span class="fn__space"></span>
        <button class="b3-button b3-button--outline fn__flex-center fn__size200" id="statusBarSetting">
            <svg><use xlink:href="#iconSettings"></use></svg>${window.siyuan.languages.config}
        </button>
    </div>
</div>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.appearance10}
        <div class="b3-label__text">${window.siyuan.languages.appearance11}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="closeButtonBehavior" type="checkbox"${window.siyuan.config.appearance.closeButtonBehavior===0?"":" checked"}>
</label>`,_send:t=>{const e=Ta.element.querySelector("#themeLight").value,n=Ta.element.querySelector("#themeDark").value,a=parseInt(Ta.element.querySelector("#mode").value),i=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";ae("/api/setting/setAppearance",{icon:Ta.element.querySelector("#icon").value,mode:a===2?i==="light"?0:1:a,modeOS:a===2,codeBlockThemeDark:Ta.element.querySelector("#codeBlockThemeDark").value,codeBlockThemeLight:Ta.element.querySelector("#codeBlockThemeLight").value,themeDark:n,themeLight:e,darkThemes:window.siyuan.config.appearance.darkThemes,lightThemes:window.siyuan.config.appearance.lightThemes,icons:window.siyuan.config.appearance.icons,lang:Ta.element.querySelector("#lang").value,closeButtonBehavior:Ta.element.querySelector("#closeButtonBehavior").checked?1:0,hideStatusBar:Ta.element.querySelector("#hideStatusBar").checked,statusBar:{msgTaskDatabaseIndexCommitDisabled:t?t.msgTaskDatabaseIndexCommitDisabled:window.siyuan.config.appearance.statusBar.msgTaskDatabaseIndexCommitDisabled,msgTaskHistoryDatabaseIndexCommitDisabled:t?t.msgTaskHistoryDatabaseIndexCommitDisabled:window.siyuan.config.appearance.statusBar.msgTaskHistoryDatabaseIndexCommitDisabled,msgTaskAssetDatabaseIndexCommitDisabled:t?t.msgTaskAssetDatabaseIndexCommitDisabled:window.siyuan.config.appearance.statusBar.msgTaskAssetDatabaseIndexCommitDisabled,msgTaskHistoryGenerateFileDisabled:t?t.msgTaskHistoryGenerateFileDisabled:window.siyuan.config.appearance.statusBar.msgTaskHistoryGenerateFileDisabled}},s=>WF(void 0,null,function*(){if((s.data.mode!==window.siyuan.config.appearance.mode||s.data.mode===window.siyuan.config.appearance.mode&&(s.data.mode===0&&window.siyuan.config.appearance.themeLight!==s.data.themeLight||s.data.mode===1&&window.siyuan.config.appearance.themeDark!==s.data.themeDark)||s.data.lang!==window.siyuan.config.appearance.lang)&&Yg(),window.siyuan.config.appearance.themeJS&&(s.data.mode!==window.siyuan.config.appearance.mode||s.data.mode===window.siyuan.config.appearance.mode&&(s.data.mode===0&&window.siyuan.config.appearance.themeLight!==s.data.themeLight||s.data.mode===1&&window.siyuan.config.appearance.themeDark!==s.data.themeDark)))if(window.destroyTheme)try{yield window.destroyTheme(),window.destroyTheme=void 0,document.getElementById("themeScript").remove()}catch(r){console.error("destroyTheme error: "+r)}else{Ss({errorExit:!1,cb(){window.location.reload()}});return}Ta.onSetAppearance(s.data),s.data.hideStatusBar?document.getElementById("status").classList.add("fn__none"):document.getElementById("status").classList.remove("fn__none"),vx()}))},bindEvent:()=>{Ta.element.querySelector("#statusBarSetting").addEventListener("click",()=>{const t=new fe({width:"360px",height:"80vh",title:"\u{1F507} "+window.siyuan.languages.appearance18,content:`<div class="fn__hr"></div>
<div class="b3-label">
    ${window.siyuan.languages.statusBarMsgPushTip}
    <div class="fn__hr"></div>
    <div class="b3-tab-bar b3-list b3-list--background">
        <label class="b3-list-item">
            <div class="fn__flex-1 ft__on-surface">
               ${window.siyuan.languages._taskAction["task.database.index.commit"]}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch fn__flex-center" id="msgTaskDatabaseIndexCommitDisabled" type="checkbox"${window.siyuan.config.appearance.statusBar.msgTaskDatabaseIndexCommitDisabled?"":" checked"}>
        </label>    
        <label class="b3-list-item">
            <div class="fn__flex-1 ft__on-surface">
               ${window.siyuan.languages._taskAction["task.asset.database.index.commit"]}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch fn__flex-center" id="msgTaskAssetDatabaseIndexCommitDisabled" type="checkbox"${window.siyuan.config.appearance.statusBar.msgTaskAssetDatabaseIndexCommitDisabled?"":" checked"}>
        </label>
        <label class="b3-list-item">
            <div class="fn__flex-1 ft__on-surface">
               ${window.siyuan.languages._taskAction["task.history.database.index.commit"]}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch fn__flex-center" id="msgTaskHistoryDatabaseIndexCommitDisabled" type="checkbox"${window.siyuan.config.appearance.statusBar.msgTaskHistoryDatabaseIndexCommitDisabled?"":" checked"}>
        </label>
        <label class="b3-list-item">
            <div class="fn__flex-1 ft__on-surface">
               ${window.siyuan.languages._taskAction["task.history.generateFile"]}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch fn__flex-center" id="msgTaskHistoryGenerateFileDisabled" type="checkbox"${window.siyuan.config.appearance.statusBar.msgTaskHistoryGenerateFileDisabled?"":" checked"}>
        </label>
    </div>
</div>`});t.element.querySelectorAll(".b3-switch").forEach(e=>{e.addEventListener("change",()=>{Ta._send({msgTaskDatabaseIndexCommitDisabled:!t.element.querySelector("#msgTaskDatabaseIndexCommitDisabled").checked,msgTaskAssetDatabaseIndexCommitDisabled:!t.element.querySelector("#msgTaskAssetDatabaseIndexCommitDisabled").checked,msgTaskHistoryDatabaseIndexCommitDisabled:!t.element.querySelector("#msgTaskHistoryDatabaseIndexCommitDisabled").checked,msgTaskHistoryGenerateFileDisabled:!t.element.querySelector("#msgTaskHistoryGenerateFileDisabled").checked})})})}),Ta.element.querySelector("#codeSnippet").addEventListener("click",()=>{Fo()}),Ta.element.querySelector("#resetLayout").addEventListener("click",()=>{Sn("\u26A0\uFE0F "+window.siyuan.languages.reset,window.siyuan.languages.appearance6,()=>{QL()})}),Ta.element.querySelectorAll("select").forEach(t=>{t.addEventListener("change",()=>{Ta._send()})}),Ta.element.querySelectorAll(".b3-switch").forEach(t=>{t.addEventListener("change",()=>{Ta._send()})})},onSetAppearance(t){var e;if(t.lang!==window.siyuan.config.appearance.lang){Ss({cb(){window.location.reload()},errorExit:!1});return}if(window.siyuan.config.appearance=t,Ta.element){const n=Ta.element.querySelector("#mode");n&&(t.modeOS?n.value="2":n.value=t.mode===0?"0":"1");const a=Ta.element.querySelector("#themeLight");a&&(a.innerHTML=qi(window.siyuan.config.appearance.lightThemes,window.siyuan.config.appearance.themeLight));const i=Ta.element.querySelector("#themeDark");i&&(i.innerHTML=qi(window.siyuan.config.appearance.darkThemes,window.siyuan.config.appearance.themeDark));const s=Ta.element.querySelector("#icon");s&&(s.innerHTML=qi(window.siyuan.config.appearance.icons,window.siyuan.config.appearance.icon))}h_(t),(e=document.querySelector("#barMode use"))==null||e.setAttribute("xlink:href",`#icon${window.siyuan.config.appearance.modeOS?"Mode":window.siyuan.config.appearance.mode===0?"Light":"Dark"}`)}};var Ex=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const h_=t=>{var e;const n=document.getElementsByTagName("html")[0];n.setAttribute("lang",window.siyuan.config.appearance.lang),n.setAttribute("data-theme-mode",CA()),n.setAttribute("data-light-theme",window.siyuan.config.appearance.themeLight),n.setAttribute("data-dark-theme",window.siyuan.config.appearance.themeDark);const a=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";window.siyuan.config.appearance.modeOS&&(window.siyuan.config.appearance.mode===1&&a==="light"||window.siyuan.config.appearance.mode===0&&a==="dark")&&(ae("/api/system/setAppearanceMode",{mode:a==="light"?0:1}),window.siyuan.config.appearance.mode=a==="light"?0:1);const i=document.getElementById("themeDefaultStyle"),s=`/appearance/themes/${t.mode===1?"midnight":"daylight"}/theme.css?v=${p.SIYUAN_VERSION}`;if(i){if(!i.getAttribute("href").startsWith(s)){const m=document.createElement("link");new Promise(b=>{m.rel="stylesheet",m.href=s,m.onload=b,i.parentNode.insertBefore(m,i)}).then(()=>{i.remove(),m.id="themeDefaultStyle"})}}else Xl(s,"themeDefaultStyle");const r=document.getElementById("themeStyle");if(t.mode===1&&t.themeDark!=="midnight"||t.mode===0&&t.themeLight!=="daylight"){const m=`/appearance/themes/${t.mode===1?t.themeDark:t.themeLight}/theme.css?v=${t.themeVer}`;r?r.getAttribute("href").startsWith(m)||r.setAttribute("href",m):Xl(m,"themeStyle")}else r&&r.remove();Cn().graph.forEach(m=>{m.searchGraph(!1)});const o=window.siyuan.config.appearance.mode===0?window.siyuan.storage[p.LOCAL_PDFTHEME].light:window.siyuan.storage[p.LOCAL_PDFTHEME].dark;document.querySelectorAll(".pdf__outer").forEach(m=>{const b=m.querySelector("#pdfDark"),y=m.querySelector("#pdfLight");o==="dark"?(m.classList.add("pdf__outer--dark"),y.classList.remove("toggled"),b.classList.add("toggled")):(m.classList.remove("pdf__outer--dark"),y.classList.add("toggled"),b.classList.remove("toggled"))}),!((e=window.webkit)!=null&&e.messageHandlers)&&!window.JSAndroid&&!window.JSHarmony&&"serviceWorker"in window.navigator&&"caches"in window&&"fetch"in window&&navigator.serviceWorker&&document.head.insertAdjacentHTML("afterbegin",`<meta name="theme-color" content="${getComputedStyle(document.body).getPropertyValue("--b3-toolbar-background").trim()}">`),TA();const l=document.getElementById("themeScript"),c=`/appearance/themes/${t.mode===1?t.themeDark:t.themeLight}/theme.js?v=${t.themeVer}`;l?l.getAttribute("src").startsWith(c)||(l.remove(),va(c,"themeScript")):va(c,"themeScript");const d=["ant","material"].includes(t.icon),u=document.getElementById("iconScript"),g=document.getElementById("iconDefaultScript"),f=`/appearance/icons/${d?t.icon:"material"}/icon.js?v=${p.SIYUAN_VERSION}`,h=`/appearance/icons/${t.icon}/icon.js?v=${t.iconVer}`;if(d&&g&&g.getAttribute("src").startsWith(f)||!d&&u&&u.getAttribute("src").startsWith(h)){d&&(u==null||u.remove(),Array.from(document.body.children).forEach(m=>{m.tagName==="svg"&&!m.getAttribute("data-name")&&!["iconsMaterial","iconsAnt"].includes(m.id)&&m.remove()}));return}g&&!g.getAttribute("src").startsWith(f)&&(g.remove(),t.icon==="ant"?document.querySelectorAll("#iconsMaterial").forEach(m=>{m.remove()}):document.querySelectorAll("#iconsAnt").forEach(m=>{m.remove()})),va(f,"iconDefaultScript").then(()=>{u==null||u.remove(),d||va(h,"iconScript").then(()=>{Array.from(document.body.children).forEach((m,b)=>{m.tagName==="svg"&&b!==0&&!m.getAttribute("data-name")&&!["iconsMaterial","iconsAnt"].includes(m.id)&&m.remove()})})})},VF=()=>{const t=document.getElementById("loading");t&&setTimeout(()=>{t.remove()},160),DA(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{const n=e.matches?"dark":"light";DA(n),window.siyuan.config.appearance.modeOS&&(window.siyuan.config.appearance.mode===0&&n==="light"||window.siyuan.config.appearance.mode===1&&n==="dark"||ae("/api/system/setAppearanceMode",{mode:n==="light"?0:1},a=>Ex(void 0,null,function*(){if(window.siyuan.config.appearance.themeJS)if(window.destroyTheme)try{yield window.destroyTheme(),window.destroyTheme=void 0,document.getElementById("themeScript").remove()}catch(i){console.error("destroyTheme error: "+i)}else{Ss({cb(){window.location.reload()},errorExit:!1});return}window.siyuan.config.appearance=a.data.appearance,h_(a.data.appearance)})))})},Qh=(t=!0,e="../../../")=>Ex(void 0,null,function*(){let n;if(Jt()||yn()||bn()?n=`@font-face {
  font-family: "Emojis Additional";
  src: url(${e}appearance/fonts/Noto-COLRv1-2.047/Noto-COLRv1.woff2) format("woff2");
  unicode-range: U+1fae9, U+1fac6, U+1fabe, U+1fadc, U+e50a, U+1fa89, U+1fadf, U+1f1e6-1f1ff, U+1fa8f;
}
@font-face {
  font-family: "Emojis Reset";
  src: local("Apple Color Emoji"),
  local("Segoe UI Emoji"),
  local("Segoe UI Symbol");
  unicode-range: U+21a9, U+21aa, U+2122, U+2194-2199, U+23cf, U+25b6, U+25c0, U+25fb, U+25fc, U+25aa, U+25ab, U+2600-2603,
  U+260e, U+2611, U+261d, U+2639, U+263a, U+2640, U+2642, U+2660, U+2663, U+2665, U+2666, U+2668, U+267b, U+26aa, U+26ab, 
  U+2702, U+2708, U+2934, U+2935, U+1f170, U+1f171, U+1f17e, U+1f17f, U+1f202, U+1f21a, U+1f22f, U+1f232-1f23a, U+1f250, 
  U+1f251, U+1fae4, U+2049, U+203c, U+3030, U+303d, U+24c2, U+26a0, U+26a1, U+26be, U+27a1, U+2b05-2b07, U+3297, U+3299, U+a9, U+ae;
  size-adjust: 115%;
}
@font-face {
  font-family: "Emojis";
  src: local("Apple Color Emoji"),
  local("Segoe UI Emoji"),
  local("Segoe UI Symbol");
  size-adjust: 115%;
}`:(yield Kn())?n=`@font-face {
  font-family: "Emojis Additional";
  src: url(${e}appearance/fonts/Noto-COLRv1-2.047/Noto-COLRv1.woff2) format("woff2");
  unicode-range: U+1fae9, U+1fac6, U+1fabe, U+1fadc, U+e50a, U+1fa89, U+1fadf, U+1f1e6-1f1ff, U+1f3f4, U+e0067, U+e0062,
  U+e0065, U+e006e, U+e007f, U+e0073, U+e0063, U+e0074, U+e0077, U+e006c;
  size-adjust: 85%;
}
@font-face {
  font-family: "Emojis Reset";
  src: local("Segoe UI Emoji"),
  local("Segoe UI Symbol");
  unicode-range: U+263a, U+21a9, U+2642, U+303d, U+2197, U+2198, U+2199, U+2196, U+2195, U+2194, U+2660, U+2665, U+2666, 
  U+2663, U+3030, U+21aa, U+25b6, U+25c0, U+2640, U+203c, U+a9, U+ae, U+2122;
  size-adjust: 85%;
}
@font-face {
  font-family: "Emojis";
  src: local("Segoe UI Emoji"),
  local("Segoe UI Symbol");
  size-adjust: 85%;
}`:n=`@font-face {
  font-family: "Emojis Reset";
  src: url(${e}appearance/fonts/Noto-COLRv1-2.047/Noto-COLRv1.woff2) format("woff2");
  unicode-range: U+1f170-1f171, U+1f17e, U+1f17f, U+1f21a, U+1f22f, U+1f232-1f23a, U+1f250, U+1f251, U+1f32b, U+1f3bc,
  U+1f411, U+1f42d, U+1f42e, U+1f431, U+1f435, U+1f441, U+1f4a8, U+1f4ab, U+1f525, U+1f600-1f60d, U+1f60f-1f623,
  U+1f625-1f62b, U+1f62d-1f63f, U+1F643, U+1F640, U+1f79, U+1f8f, U+1fa79, U+1fae4, U+1fae9, U+1fac6, U+1fabe, U+1fadf,
  U+200d, U+203c, U+2049, U+2122, U+2139, U+2194-2199, U+21a9, U+21aa, U+23cf, U+25aa, U+25ab, U+25b6, U+25c0, U+25fb-25fe,
  U+2611, U+2615, U+2618, U+261d, U+2620, U+2622, U+2623, U+2626, U+262a, U+262e, U+2638-263a, U+2640, U+2642, U+2648-2653,
  U+265f, U+2660, U+2663, U+2665, U+2666, U+267b, U+267e, U+267f, U+2692-2697, U+2699, U+269b, U+269c, U+26a0, U+26a1,
  U+26a7, U+26aa, U+26ab, U+26b0, U+26b1, U+2702, U+2708, U+2709, U+270c, U+270d, U+2712, U+2714, U+2716, U+271d, U+2733,
  U+2734, U+2744, U+2747, U+2763, U+2764, U+2934-2935, U+3030, U+303d, U+3297, U+3299, U+fe0f, U+e50a, U+a9, U+ae;
  size-adjust: 92%;
}
@font-face {
  font-family: "Emojis";
  src: url(${e}appearance/fonts/Noto-COLRv1-2.047/Noto-COLRv1.woff2) format("woff2"),
  local("Segoe UI Emoji"),
  local("Segoe UI Symbol"),
  local("Apple Color Emoji"),
  local("Twemoji Mozilla"),
  local("Noto Color Emoji"),
  local("Android Emoji"),
  local("EmojiSymbols");
  size-adjust: 92%;
}`,n+=`
:root { --b3-font-size-editor: ${window.siyuan.config.editor.fontSize}px }
.b3-typography code:not(.hljs), .protyle-wysiwyg span[data-type~=code] { font-variant-ligatures: ${window.siyuan.config.editor.codeLigatures?"normal":"none"} }${window.siyuan.config.editor.justify?`
.protyle-wysiwyg [data-node-id] { text-align: justify }`:""}`,window.siyuan.config.editor.rtl&&(n+=`
.protyle-title__input,
.protyle-wysiwyg .p,
.protyle-wysiwyg .code-block .hljs,
.protyle-wysiwyg .table,
.protyle-wysiwyg .render-node protyle-html,
.protyle-wysiwyg .render-node > div[spin="1"],
.protyle-wysiwyg [data-type="NodeHeading"] {direction: rtl}
.protyle-wysiwyg [data-node-id].li > .protyle-action {
    right: 0;
    left: auto;
    direction: rtl;
}
.protyle-wysiwyg [data-node-id].li > [data-node-id] {
    margin-right: 34px;
    margin-left: 0;
}
.protyle-wysiwyg [data-node-id].li::before {
    right: 17px;
    left: auto;
}
.b3-typography table:not([style*="text-align: left"]) {
  margin-left: auto;
}`),window.siyuan.config.editor.fontFamily&&(n+=`
.b3-typography:not(.b3-typography--default), .protyle-wysiwyg, .protyle-title {font-family: "Emojis Additional", "Emojis Reset", "${window.siyuan.config.editor.fontFamily}", var(--b3-font-family)}`),"ontouchend"in document&&(n+=`
.b3-menu .b3-menu__action {opacity: 0.68;}`),t){const a=document.getElementById("siyuanStyle");a?a.innerHTML=n:document.querySelector("#pluginsStyle").insertAdjacentHTML("beforebegin",`<style id="siyuanStyle">${n}</style>`)}return n}),TA=(t=p.PROTYLE_CDN)=>{const e=document.getElementById("protyleHljsStyle");let n;window.siyuan.config.appearance.mode===0?(n=window.siyuan.config.appearance.codeBlockThemeLight,p.SIYUAN_CONFIG_APPEARANCE_LIGHT_CODE.includes(n)||(n="default")):(n=window.siyuan.config.appearance.codeBlockThemeDark,p.SIYUAN_CONFIG_APPEARANCE_DARK_CODE.includes(n)||(n="github-dark"));const a=`${t}/js/highlight.js/styles/${n}.min.css?v=11.11.1`;e?e.href.includes(a)||(e.remove(),Xl(a,"protyleHljsStyle")):Xl(a,"protyleHljsStyle")},kx=t=>{let e=t;t===2&&(window.matchMedia("(prefers-color-scheme: dark)").matches?e=1:e=0),ae("/api/setting/setAppearance",Object.assign({},window.siyuan.config.appearance,{mode:e,modeOS:t===2}),n=>Ex(void 0,null,function*(){if((n.data.mode!==window.siyuan.config.appearance.mode||n.data.mode===window.siyuan.config.appearance.mode&&(n.data.mode===0&&window.siyuan.config.appearance.themeLight!==n.data.themeLight||n.data.mode===1&&window.siyuan.config.appearance.themeDark!==n.data.themeDark))&&Yg(),window.siyuan.config.appearance.themeJS&&(n.data.mode!==window.siyuan.config.appearance.mode||n.data.mode===window.siyuan.config.appearance.mode&&(n.data.mode===0&&window.siyuan.config.appearance.themeLight!==n.data.themeLight||n.data.mode===1&&window.siyuan.config.appearance.themeDark!==n.data.themeDark)))if(window.destroyTheme)try{yield window.destroyTheme(),window.destroyTheme=void 0,document.getElementById("themeScript").remove()}catch(a){console.error("destroyTheme error: "+a)}else{Ss({errorExit:!1,cb(){window.location.reload()}});return}Ta.onSetAppearance(n.data)}))},zF=t=>{if(t.startsWith("#"))return t;let e;const n=t.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i),a=(n&&n[4]||"").trim();let i=n?(n[1]|256).toString(16).slice(1)+(n[2]|256).toString(16).slice(1)+(n[3]|256).toString(16).slice(1):t;return a!==""?e=a:e=1,e=(e*255|256).toString(16).slice(1),i=i+e,i},DA=t=>{(Xt()||St()||Qt())&&setTimeout(()=>{const e=zF(getComputedStyle(document.body).getPropertyValue("--b3-theme-background").trim());let n=window.siyuan.config.appearance.mode;window.siyuan.config.appearance.modeOS&&(t==="dark"?n=1:n=0),Xt()?window.webkit.messageHandlers.changeStatusBar.postMessage((e||(n===0?"#fff":"#1e1e1e"))+" "+n):St()?window.JSAndroid.changeStatusBarColor(e,n):Qt()&&window.JSHarmony.changeStatusBarColor(e,n)},500)},CA=()=>{const t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";return window.siyuan.config.appearance.modeOS?t:window.siyuan.config.appearance.mode===0?"light":"dark"},ra=(t,e=p.PROTYLE_CDN,n=1)=>{let a,i=!1;t.classList.contains("code-block")?a=t.querySelectorAll(".hljs"):t.classList.contains("item__readme")?(a=t.querySelectorAll("pre code"),a.forEach(s=>{s.parentElement.setAttribute("linenumber","false")})):t.classList.contains("b3-typography")?(a=t.querySelectorAll(".code-block code"),i=!0):a=t.querySelectorAll(".code-block .hljs"),a.length!==0&&(TA(e),va(`${e}/js/highlight.js/highlight.min.js?v=11.11.1`,"protyleHljsScript").then(()=>{va(`${e}/js/highlight.js/third-languages.js?v=2.0.1`,"protyleHljsThirdScript").then(()=>{a.forEach(s=>{const r=s.parentElement.querySelectorAll(".protyle-icon");if(r.length===2&&(r[0].setAttribute("aria-label",window.siyuan.languages.copy),r[1].setAttribute("aria-label",window.siyuan.languages.more)),s.getAttribute("data-render")==="true")return;const o=s.querySelector("wbr");let l=0;if(o){let m=o.previousSibling;for(;m;){for(l+=m.textContent.length;!m.previousSibling&&m.parentElement.tagName!=="DIV";)m=m.parentElement;m=m.previousSibling}o.remove()}let c;i?c=s.parentElement.getAttribute("data-language"):s.previousElementSibling?c=s.previousElementSibling.firstElementChild.textContent:c=s.className.replace("language-",""),window.hljs.getLanguage(c)||(c="plaintext"),s.classList.add("hljs"),s.setAttribute("data-render","true");const d=s.parentElement.getAttribute("linewrap"),u=s.parentElement.getAttribute("ligatures"),g=s.parentElement.getAttribute("linenumber"),f=s.lastElementChild?s.lastElementChild:s;d==="true"||d!=="false"&&window.siyuan.config.editor.codeLineWrap?(f.style.setProperty("white-space","pre-wrap"),f.style.setProperty("word-break","break-word")):(f.style.setProperty("white-space","pre"),f.style.setProperty("word-break","initial")),u==="true"||u!=="false"&&window.siyuan.config.editor.codeLigatures?f.style.fontVariantLigatures="normal":f.style.fontVariantLigatures="none";const h=f.textContent;s.firstElementChild&&(!i&&(g==="true"||g!=="false"&&window.siyuan.config.editor.codeSyntaxHighlightLineNum)?(s.firstElementChild.className="protyle-linenumber__rows",s.firstElementChild.setAttribute("contenteditable","false"),Rf(s,n),s.style.display=""):(s.firstElementChild.className="fn__none",s.firstElementChild.innerHTML="",f.style.paddingLeft="",s.style.display="block")),f.innerHTML=window.hljs.highlight(h+(h.endsWith(`
`)?"":`
`),{language:c,ignoreIllegals:!0}).value,o&&getSelection().rangeCount>0&&nr(s,l,l)})})}))},Rf=(t,e=1)=>{const n=t.parentElement.getAttribute("lineNumber");if(n==="false"||!window.siyuan.config.editor.codeSyntaxHighlightLineNum&&n!=="true")return;t.parentElement.style.lineHeight=`${((parseInt(t.parentElement.style.fontSize)||window.siyuan.config.editor.fontSize)*1.625*.85).toFixed(0)}px`;const a=t.lastElementChild,i=a.textContent.split(/\r\n|\r|\n|\u2028|\u2029/g);i[i.length-1]===""&&i.length>1&&i.pop(),t.firstElementChild.innerHTML=`<span>${i.length}</span>`,a.style.paddingLeft=`${t.firstElementChild.clientWidth+16}px`;let s="";if(a.style.wordBreak==="break-word"){const r=window.getComputedStyle(a),o=document.createElement("div");o.className="hljs",o.setAttribute("style",`padding-left:${a.style.paddingLeft};
width: ${a.getBoundingClientRect().width/e}px;
white-space:${r.whiteSpace};
word-break:${r.wordBreak};
font-variant-ligatures:${r.fontVariantLigatures};
padding-right:0;max-height: none;box-sizing: border-box;position: absolute;padding-top:0 !important;padding-bottom:0 !important;min-height:auto !important;`),o.setAttribute("contenteditable","true"),t.insertAdjacentElement("afterend",o),i.map(l=>{o.textContent=l.trim()?l:"<br>",s+=`<span style="height:${o.clientHeight}px"></span>`}),o.remove()}else s="<span></span>".repeat(i.length);if(t.firstElementChild.innerHTML=s,t.scrollHeight>t.clientHeight&&getSelection().rangeCount>0){const r=getSelection().getRangeAt(0);if(t.contains(r.startContainer)){const o=document.createElement("br");r.insertNode(o),o.scrollIntoView({block:"nearest"}),o.remove()}}};var Sx=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});let er=[],Uf=!1;const g_=(t,e)=>Sx(void 0,null,function*(){Ut(["gutter","toolbar","hint","util","dialog"],e.protyle);let n;if(!document.contains(e.protyle.element)){if(!(yield wn("/api/block/checkBlockExist",{id:e.protyle.block.rootID})).data)return!1;let i;const s=document.querySelector(".layout__wnd--active");if(s&&(i=mi(s.getAttribute("data-id"))),i||(i=nm(window.siyuan.layout.centerLayout)),i){const r=yield wn("/api/block/getBlockInfo",{id:e.id});if(r.code===3){Q(r.msg);return}const o=new Sa({title:r.data.rootTitle,docIcon:r.data.rootIcon,callback(c){const d=Th(e.protyle,!0);d.rootId=e.protyle.block.rootID,d.focusId=e.id,d.focusStart=e.position.start,d.focusEnd=e.position.end,window.siyuan.storage[p.LOCAL_FILEPOSITION][e.protyle.block.rootID]=d;const u=new Ma({app:t,tab:c,blockId:e.zoomId||e.id||e.protyle.block.rootID,rootId:e.protyle.block.rootID,action:e.zoomId?[p.CB_GET_FOCUS,p.CB_GET_SCROLL,p.CB_GET_ALL,p.CB_GET_UNUNDO]:[p.CB_GET_FOCUS,p.CB_GET_SCROLL,p.CB_GET_UNUNDO]});c.addModel(u)}});if(window.siyuan.config.fileTree.openFilesUseCurrentTab){let c;i.children.forEach(d=>{d.headElement&&d.headElement.classList.contains("item--unupdate")&&!d.headElement.classList.contains("item--pin")&&(c=d)}),i.addTab(o),c&&i.removeTab(c.id)}else i.addTab(o);i.showHeading();const l=o.model.editor.protyle;return e.protyle=l,er.forEach(c=>{!document.contains(c.protyle.element)&&c.protyle.block.rootID===r.data.rootID&&(c.protyle=l)}),window.siyuan.backStack.forEach(c=>{!document.contains(c.protyle.element)&&c.protyle.block.rootID===r.data.rootID&&(c.protyle=l)}),r.data.rootID===e.id?nr(l.title.editElement,e.position.start,e.position.end):(Array.from(l.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`)).find(c=>{if(!ge(c))return n=c,!0}),nr(Ee(n),e.position.start,e.position.end),kn(l)),!0}else return!1}if(e.protyle.block.rootID===e.id)return e.protyle.title.editElement.getBoundingClientRect().height===0&&(e.protyle.model.parent.parent.switchTab(e.protyle.model.parent.headElement),e.protyle.toolbar.range=void 0),nr(e.protyle.title.editElement,e.position.start,e.position.end),!0;if(Array.from(e.protyle.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`)).find(a=>{if(!ge(a))return n=a,!0}),n&&(!e.zoomId||e.zoomId&&e.zoomId===e.protyle.block.id))return n.getBoundingClientRect().height===0&&e.protyle.model.parent.parent.switchTab(e.protyle.model.parent.headElement),nr(Ee(n),e.position.start,e.position.end),kn(e.protyle),Cn().outline.forEach(a=>{a.blockId===e.protyle.block.rootID&&a.setCurrent(n)}),!0;if(e.protyle.element.parentElement)return(yield wn("/api/block/checkBlockExist",{id:e.id})).data?!n&&!e.zoomId&&!e.protyle.scroll.element.classList.contains("fn__none")?(ae("/api/filetree/getDoc",{id:e.id,mode:3,size:window.siyuan.config.editor.dynamicLoadBlocks},i=>{_a({data:i,protyle:e.protyle,afterCB(){Array.from(e.protyle.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`)).find(s=>{if(!ge(s))return n=s,!0}),n&&(Cn().outline.forEach(s=>{s.blockId===e.protyle.block.rootID&&s.setCurrent(n)}),nr(Ee(n),e.position.start,e.position.end),kn(e.protyle))}})}),!0):(hi({protyle:e.protyle,id:e.zoomId||e.protyle.block.rootID,isPushBack:!1,callback:()=>{Array.from(e.protyle.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`)).find(i=>{if(!ge(i))return n=i,!0}),n&&(Cn().outline.forEach(i=>{i.blockId===e.protyle.block.rootID&&i.setCurrent(n)}),nr(Ee(n),e.position.start,e.position.end),kn(e.protyle))}}),!0):(getSelection().rangeCount>0&&Pt(getSelection().getRangeAt(0)),!1)}),m_=t=>Sx(void 0,null,function*(){var e,n;if(window.siyuan.backStack.length===0){er.length>0&&(yield g_(t,er[er.length-1]));return}(e=document.querySelector("#barForward"))==null||e.classList.remove("toolbar__item--disabled"),!Uf&&document.contains(window.siyuan.backStack[window.siyuan.backStack.length-1].protyle.element)&&er.push(window.siyuan.backStack.pop());let a=window.siyuan.backStack.pop();for(;a;)if(yield g_(t,a)){er.push(a);break}else a=window.siyuan.backStack.pop();Uf=!0,window.siyuan.backStack.length===0&&((n=document.querySelector("#barBack"))==null||n.classList.add("toolbar__item--disabled"))}),b_=t=>Sx(void 0,null,function*(){var e,n;if(er.length===0){window.siyuan.backStack.length>0&&(yield g_(t,window.siyuan.backStack[window.siyuan.backStack.length-1]));return}(e=document.querySelector("#barBack"))==null||e.classList.remove("toolbar__item--disabled"),Uf&&window.siyuan.backStack.push(er.pop());let a=er.pop();for(;a;)if(yield g_(t,a)){window.siyuan.backStack.push(a);break}else a=er.pop();Uf=!1,er.length===0&&((n=document.querySelector("#barForward"))==null||n.classList.add("toolbar__item--disabled"))}),Hf=(t,e,n)=>{var a,i;if(!t.model||(!n&&e&&(n=oe(e.startContainer)),!n))return;let s;if(n.classList.contains("protyle-title__input")?s=n:s=Ee(n),s){const r=ya(s,void 0,e),o=n.getAttribute("data-node-id")||t.block.rootID,l=window.siyuan.backStack[window.siyuan.backStack.length-1];l&&l.id===o&&(t.block.showAll&&l.zoomId===t.block.id||!l.zoomId&&!t.block.showAll)?l.position=r:(er.length>0&&(Uf&&window.siyuan.backStack.push(er.pop()),er=[],(a=document.querySelector("#barForward"))==null||a.classList.add("toolbar__item--disabled")),window.siyuan.backStack.push({position:r,id:o,protyle:t,zoomId:t.block.showAll?t.block.id:void 0}),window.siyuan.backStack.length>p.SIZE_UNDO&&window.siyuan.backStack.shift(),Uf=!1),window.siyuan.backStack.length>1&&((i=document.querySelector("#barBack"))==null||i.classList.remove("toolbar__item--disabled"))}},_a=t=>{if(t.action||(t.action=[]),t.protyle.wysiwyg.element.removeAttribute("data-top"),t.data.code===1){t.action.includes(p.CB_GET_APPEND)||(t.protyle.model?t.protyle.model.parent.parent.removeTab(t.protyle.model.parent.id,!1):t.protyle.element.innerHTML=`<div class="ft__smaller ft__secondary b3-form__space--small" contenteditable="false">${window.siyuan.languages.refExpired}</div>`);return}if(t.data.code!==3&&(t.protyle.notebookId=t.data.data.box,t.protyle.path=t.data.data.path,!(t.data.data.eof&&!t.scrollAttr&&(t.action.includes(p.CB_GET_BEFORE)?t.protyle.wysiwyg.element.firstElementChild.setAttribute("data-eof","1"):t.protyle.wysiwyg.element.lastElementChild.setAttribute("data-eof","2"),t.data.data.mode!==4)))){if(Ut(["gutterOnly"],t.protyle),t.protyle.block.parentID=t.data.data.parentID,t.protyle.block.parent2ID=t.data.data.parent2ID,t.protyle.block.rootID=t.data.data.rootID,t.protyle.block.showAll=t.action.includes(p.CB_GET_ALL),t.protyle.block.mode=t.data.data.mode,t.protyle.block.blockCount=t.data.data.blockCount,t.protyle.block.scroll=t.data.data.scroll,t.protyle.block.action=t.action,t.action.includes(p.CB_GET_UNCHANGEID)||(t.protyle.block.id=t.data.data.id,t.protyle.scroll.lastScrollTop=0,t.protyle.contentElement.scrollTop=0,t.protyle.wysiwyg.element.setAttribute("data-doc-type",t.data.data.type)),!(t.protyle.options.render.title&&t.protyle.title.element.getAttribute("data-render")!=="true")){if(t.action.includes(p.CB_GET_APPEND)||t.action.includes(p.CB_GET_BEFORE)||t.action.includes(p.CB_GET_HTML)){t.protyle.options.render.title&&t.protyle.options.render.hideTitleOnZoom&&(t.protyle.block.showAll?t.protyle.title.element.classList.add("fn__none"):t.protyle.title.element.classList.remove("fn__none")),LA({content:t.data.data.content,expand:t.data.data.isBacklinkExpand,action:t.action,scrollAttr:t.scrollAttr,updateReadonly:t.updateReadonly,isSyncing:t.data.data.isSyncing,afterCB:t.afterCB},t.protyle),tg(t.protyle);return}}ae("/api/block/getDocInfo",{id:t.protyle.block.rootID},e=>{t.protyle.options.render.title?t.protyle.title.render(t.protyle,e):(t.protyle.options.render.background&&t.protyle.background.render(e.data.ial,t.protyle.block.rootID),t.protyle.wysiwyg.renderCustom(e.data.ial)),LA({content:t.data.data.content,expand:t.data.data.isBacklinkExpand,action:t.action,scrollAttr:t.scrollAttr,updateReadonly:t.updateReadonly,isSyncing:t.data.data.isSyncing,afterCB:t.afterCB},t.protyle),tg(t.protyle)})}},LA=(t,e)=>{var n;if(e.contentElement.classList.contains("fn__none")&&e.wysiwyg.element.innerHTML!=="")return;const i=new DOMParser().parseFromString(t.content,"text/html");i.querySelectorAll("[data-inline-memo-content]").forEach(o=>{const l=o.getAttribute("data-inline-memo-content");l&&o.setAttribute("data-inline-memo-content",window.DOMPurify.sanitize(l))}),t.content=i.body.innerHTML;const s=e.contentElement.clientHeight*8,r=typeof t.updateReadonly=="undefined"?e.wysiwyg.element.innerHTML==="":t.updateReadonly;if(t.action.includes(p.CB_GET_APPEND)){if(!e.wysiwyg.element.querySelector(".protyle-wysiwyg--select")&&!e.scroll.keepLazyLoad&&e.contentElement.scrollHeight>s){let o=e.wysiwyg.element.firstElementChild;const l=[];for(;e.wysiwyg.element.childElementCount>2&&l&&e.wysiwyg.element.lastElementChild!==o&&e.contentElement.scrollHeight-o.offsetTop>s;){l.push(o);o=o.nextElementSibling}const c=o.getBoundingClientRect().top;l.forEach(d=>{d.remove()}),e.contentElement.scrollTop=e.contentElement.scrollTop+(o.getBoundingClientRect().top-c)-1,e.scroll.lastScrollTop=e.contentElement.scrollTop,Ut(["toolbar"],e)}e.wysiwyg.element.insertAdjacentHTML("beforeend",t.content)}else if(t.action.includes(p.CB_GET_BEFORE)){const o=e.wysiwyg.element.firstElementChild,l=o.getBoundingClientRect().top;if(e.wysiwyg.element.insertAdjacentHTML("afterbegin",t.content),e.contentElement.scrollTop=e.contentElement.scrollTop+(o.getBoundingClientRect().top-l),e.scroll.lastScrollTop=e.contentElement.scrollTop,!e.wysiwyg.element.querySelector(".protyle-wysiwyg--select")&&!e.scroll.keepLazyLoad){const c=[];let d=e.wysiwyg.element.childElementCount,u=e.contentElement.scrollHeight,g=e.wysiwyg.element.lastElementChild;for(;d>2&&u>s&&g.getBoundingClientRect().top>window.innerHeight;)c.push(g),g=g.previousElementSibling,d--,u-=g.clientHeight+8;c.forEach(f=>{f.remove()}),Ut(["toolbar"],e)}}else e.wysiwyg.element.innerHTML=t.content;if(!e.block.showAll&&e.wysiwyg.element.childElementCount===1&&e.wysiwyg.element.firstElementChild.classList.contains("p")){const o=Ee(e.wysiwyg.element.firstElementChild);o&&o.textContent===""&&(o.classList.add("protyle-wysiwyg--empty"),o.setAttribute("placeholder",window.siyuan.languages.emptyPlaceholder))}if(t.action.includes(p.CB_GET_BACKLINK)&&pA(t.expand,e.wysiwyg.element),zn(e.wysiwyg.element),ra(e.wysiwyg.element),Ua(e.wysiwyg.element,e),$n(e,e.wysiwyg.element),!t.action.includes(p.CB_GET_HISTORY)){if(e.options.render.scroll&&e.scroll.update(e),t.action.includes(p.CB_GET_FOCUSFIRST)){const o=e.wysiwyg.element.offsetTop-16;es(e,o,p.TIMEOUT_INPUT),e.contentElement.scrollTop=o}if(t.isSyncing?IA(e):(e.breadcrumb&&(e.breadcrumb.element.nextElementSibling.textContent=""),e.element.removeAttribute("disabled-forever"),t.action.includes(p.CB_GET_OPENNEW)&&window.siyuan.config.editor.readOnly&&!window.siyuan.config.readonly?eg(e):MA(e,r)),YF(e,t.action,t.scrollAttr),t.action.includes(p.CB_GET_SETID)&&(e.block.id=e.block.rootID,e.wysiwyg.element.setAttribute("data-doc-type","NodeDocument")),(n=e.options.defIds)==null||n.forEach(o=>{e.wysiwyg.element.querySelectorAll(`[data-id="${o}"]`).forEach(l=>{l.classList.add("def--mark")})}),e.options.defIds=[],t.action.includes(p.CB_GET_APPEND)||t.action.includes(p.CB_GET_BEFORE)){e.app.plugins.forEach(o=>{o.eventBus.emit("loaded-protyle-dynamic",{protyle:e,position:t.action.includes(p.CB_GET_APPEND)?"afterend":"beforebegin"})});return}e.options.render.breadcrumb&&(e.breadcrumb.toggleExit(!t.action.includes(p.CB_GET_ALL)),e.breadcrumb.render(e)),t.afterCB&&t.afterCB(),t.scrollAttr&&!e.scroll.element.classList.contains("fn__none")&&!e.element.classList.contains("block__edit")&&e.wysiwyg.element.lastElementChild.getAttribute("data-eof")!=="2"&&e.contentElement.scrollHeight>0&&!t.action.includes(p.CB_GET_FOCUSFIRST)&&e.contentElement.scrollHeight<=e.contentElement.clientHeight&&ae("/api/filetree/getDoc",{id:e.wysiwyg.element.lastElementChild.getAttribute("data-node-id"),mode:2,size:window.siyuan.config.editor.dynamicLoadBlocks},o=>{_a({data:o,protyle:e,action:[p.CB_GET_APPEND,p.CB_GET_UNCHANGEID]})}),t.scrollAttr&&!e.scroll.element.classList.contains("fn__none")&&!e.element.classList.contains("fn__none")&&e.scroll.updateIndex(e,t.scrollAttr.startId,o=>{o>1&&e.block.blockCount>1&&e.contentElement.scrollHeight<=e.contentElement.clientHeight&&Q(window.siyuan.languages.scrollGetMore)}),e.app.plugins.forEach(o=>{o.eventBus.emit("loaded-protyle-static",{protyle:e})})}},IA=t=>{br(t),t.breadcrumb&&!x()?t.breadcrumb.element.nextElementSibling.textContent=window.siyuan.languages._kernel[81]:Q(window.siyuan.languages._kernel[81]),t.element.setAttribute("disabled-forever","true")},br=t=>{if(window.siyuan.menus.menu.remove(),Ut(["gutter","toolbar","select","hint","util"],t),t.disabled=!0,t.title&&t.title.editElement&&(t.title.editElement.setAttribute("contenteditable","false"),t.title.editElement.style.userSelect="text"),t.background&&(t.background.element.classList.remove("protyle-background--enable"),t.background.element.classList.remove("protyle-background--mobileshow")),t.wysiwyg.element.querySelectorAll(".protyle-icons--show").forEach(e=>{e.classList.remove("protyle-icons--show")}),t.wysiwyg.element.querySelectorAll(".av__gallery-fields--edit").forEach(e=>{e.classList.remove("av__gallery-fields--edit")}),t.wysiwyg.element.querySelectorAll(".render-node .protyle-action__edit").forEach(e=>{var n;e.classList.add("fn__none"),e.classList.contains("protyle-icon--first")&&((n=e.nextElementSibling)==null||n.classList.add("protyle-icon--first"))}),t.wysiwyg.element.style.userSelect="text",t.wysiwyg.element.setAttribute("contenteditable","false"),t.wysiwyg.element.setAttribute("data-readonly","true"),t.wysiwyg.element.querySelectorAll('[contenteditable="true"][spellcheck]').forEach(e=>{e.setAttribute("contenteditable","false")}),t.wysiwyg.element.querySelectorAll('.protyle-action[draggable="true"]').forEach(e=>{e.setAttribute("draggable","false")}),t.breadcrumb){const e=t.breadcrumb.element.parentElement.querySelector('[data-type="readonly"]');e.querySelector("use").setAttribute("xlink:href","#iconLock"),e.setAttribute("aria-label",window.siyuan.config.editor.readOnly?window.siyuan.languages.tempUnlock:window.siyuan.languages.unlockEdit),e.setAttribute("data-subtype","lock");const n=t.breadcrumb.element.parentElement.querySelector('[data-type="undo"]');n&&!n.classList.contains("fn__none")&&(n.classList.add("fn__none"),t.breadcrumb.element.parentElement.querySelector('[data-type="redo"]').classList.add("fn__none"),t.breadcrumb.element.parentElement.querySelector('[data-type="indent"]').classList.add("fn__none"),t.breadcrumb.element.parentElement.querySelector('[data-type="outdent"]').classList.add("fn__none"))}Pa()},eg=t=>{if(t.element.getAttribute("disabled-forever")==="true")return;t.disabled=!1,x()?document.getElementById("toolbarName").removeAttribute("readonly"):(t.wysiwyg.element.setAttribute("contenteditable","true"),t.wysiwyg.element.style.userSelect=""),t.wysiwyg.element.setAttribute("data-readonly","false"),t.title&&t.title.editElement&&(t.title.editElement.setAttribute("contenteditable","true"),t.title.editElement.style.userSelect=""),t.background&&t.background.element.classList.add("protyle-background--enable"),t.wysiwyg.element.querySelectorAll(".render-node .protyle-action__edit").forEach(n=>{var a;n.classList.remove("fn__none"),n.classList.contains("protyle-icon--first")&&((a=n.nextElementSibling)==null||a.classList.remove("protyle-icon--first"))}),t.wysiwyg.element.querySelectorAll('[contenteditable="false"][spellcheck]').forEach(n=>{N(n,"protyle-wysiwyg__embed")||n.setAttribute("contenteditable","true")}),t.wysiwyg.element.querySelectorAll('.protyle-action[draggable="false"]').forEach(n=>{n.setAttribute("draggable","true")});const e=t.contentElement.getBoundingClientRect();if(t.wysiwyg.element.querySelectorAll(".av").forEach(n=>{n.querySelector(".av__scroll")&&tc(n,e,"all")}),t.breadcrumb){const n=t.breadcrumb.element.parentElement.querySelector('[data-type="readonly"]');n.querySelector("use").setAttribute("xlink:href","#iconUnlock"),n.setAttribute("aria-label",window.siyuan.config.editor.readOnly?window.siyuan.languages.cancelTempUnlock:window.siyuan.languages.lockEdit),n.setAttribute("data-subtype","unlock");const a=t.breadcrumb.element.parentElement.querySelector('[data-type="undo"]');a&&a.classList.contains("fn__none")&&(a.classList.remove("fn__none"),t.breadcrumb.element.parentElement.querySelector('[data-type="redo"]').classList.remove("fn__none"),t.breadcrumb.element.parentElement.querySelector('[data-type="indent"]').classList.remove("fn__none"),t.breadcrumb.element.parentElement.querySelector('[data-type="outdent"]').classList.remove("fn__none"))}Pa()},YF=(t,e,n)=>{var a;let i;if(n&&n.focusId?i=t.wysiwyg.element.querySelector(`[data-node-id="${n.focusId}"]`):Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${t.block.id}"]`)).find(r=>{if(!ue(r,"data-type","block-render",!0))return i=r,!0}),t.block.mode===4?(es(t),i=t.wysiwyg.element.lastElementChild):(!i||e.includes(p.CB_GET_FOCUSFIRST))&&(i=t.wysiwyg.element.firstElementChild),e.includes(p.CB_GET_HL)&&(es(t),io(i)),e.includes(p.CB_GET_FOCUS)||e.includes(p.CB_GET_FOCUSFIRST)){let r;n&&n.focusId?r=nr(i,n.focusStart,n.focusEnd):qt(i,void 0,!e.includes(p.CB_GET_OUTLINE)),e.includes(p.CB_GET_UNUNDO)||Hf(t,r,i)}const s=n&&typeof n.scrollTop=="number";if(s&&(t.contentElement.scrollTop=n.scrollTop),(a=t.observerLoad)==null||a.disconnect(),e.includes(p.CB_GET_FOCUS)||e.includes(p.CB_GET_SCROLL)||e.includes(p.CB_GET_HL)||e.includes(p.CB_GET_FOCUSFIRST))s||kn(t,i);else return;t.observerLoad=new ResizeObserver(()=>{s&&(t.contentElement.scrollTop=n.scrollTop),(e.includes(p.CB_GET_FOCUS)||e.includes(p.CB_GET_HL)||e.includes(p.CB_GET_FOCUSFIRST))&&(s||kn(t,i))}),t.observerLoad.observe(t.wysiwyg.element),t.observer.unobserve(t.wysiwyg.element),setTimeout(()=>{t.observerLoad.disconnect(),t.observer.observe(t.wysiwyg.element)},1e3*3),i===t.wysiwyg.element.firstElementChild&&!s&&t.observerLoad.disconnect()},MA=(t,e)=>{let n=window.siyuan.config.readonly?"true":"false";e?n==="false"&&(n=window.siyuan.config.editor.readOnly?"true":"false",n==="false"&&(n=t.wysiwyg.element.getAttribute(p.CUSTOM_SY_READONLY))):n=t.disabled?"true":"false",n==="true"?br(t):eg(t)};let FA;const GF=(t,e)=>{e.addEventListener("scroll",()=>{const n=e.getBoundingClientRect();if(!t.toolbar.element.classList.contains("fn__none")){const a=t.toolbar.element.getAttribute("data-inity").split(p.ZWSP),i=parseInt(a[0])+(parseInt(a[1])-e.scrollTop);i<n.top-t.toolbar.toolbarHeight||i>n.bottom-t.toolbar.toolbarHeight?t.toolbar.element.style.display="none":(t.toolbar.element.style.top=i+"px",t.toolbar.element.style.display="")}if(t.wysiwyg.element.querySelectorAll(".av").forEach(a=>{a.dataset.render==="true"&&tc(a,n,"all")}),!t.element.classList.contains("block__edit")&&!x()&&t.contentElement.setAttribute("data-scrolltop",e.scrollTop.toString()),window.siyuan.dragElement||Ut(["gutterOnly"],t),t.scroll&&!t.scroll.element.classList.contains("fn__none")&&(clearTimeout(FA),FA=window.setTimeout(()=>{let a=document.elementFromPoint(n.left+n.width/2,n.top+10);a.classList.contains("protyle-wysiwyg")&&(a=document.elementFromPoint(n.left+n.width/2,n.top+20));const i=oe(a);if(!i){if((t.wysiwyg.element.firstElementChild.getAttribute("data-eof")==="1"||t.wysiwyg.element.firstElementChild.getAttribute("data-node-index")==="0")&&(N(a,"protyle-background")||N(a,"protyle-title"))){const s=t.scroll.element.querySelector(".b3-slider");s.value="1",t.scroll.element.setAttribute("aria-label",`Blocks 1/${t.block.blockCount}`)}return}t.scroll.updateIndex(t,i.getAttribute("data-node-id"))},p.TIMEOUT_LOAD)),!(t.wysiwyg.element.getAttribute("data-top")||t.block.showAll||t.scroll&&t.scroll.element.classList.contains("fn__none")||!t.scroll||t.scroll.lastScrollTop===e.scrollTop||t.scroll.lastScrollTop===-1||!t.wysiwyg.element.firstElementChild)){if(t.scroll.lastScrollTop>e.scrollTop){if(e.scrollTop===0)return;e.scrollTop<e.clientHeight&&t.wysiwyg.element.firstElementChild.getAttribute("data-eof")!=="1"&&(t.contentElement.style.width=t.contentElement.offsetWidth+"px",t.contentElement.style.overflow="hidden",t.wysiwyg.element.setAttribute("data-top",e.scrollTop.toString()),ae("/api/filetree/getDoc",{id:t.wysiwyg.element.firstElementChild.getAttribute("data-node-id"),mode:1,size:window.siyuan.config.editor.dynamicLoadBlocks},a=>{t.contentElement.style.overflow="",t.contentElement.style.width="",_a({data:a,protyle:t,action:[p.CB_GET_BEFORE,p.CB_GET_UNCHANGEID]})}))}else if(e.scrollTop>e.scrollHeight-e.clientHeight*1.8&&t.wysiwyg.element.lastElementChild&&t.wysiwyg.element.lastElementChild.getAttribute("data-eof")!=="2"){if(t.scroll.lastScrollTop>768&&e.scrollTop>t.scroll.lastScrollTop*2){e.scrollTop=t.scroll.lastScrollTop;return}t.wysiwyg.element.setAttribute("data-top",e.scrollTop.toString()),ae("/api/filetree/getDoc",{id:t.wysiwyg.element.lastElementChild.getAttribute("data-node-id"),mode:2,size:window.siyuan.config.editor.dynamicLoadBlocks},a=>{_a({data:a,protyle:t,action:[p.CB_GET_APPEND,p.CB_GET_UNCHANGEID]})})}t.scroll.lastScrollTop=Math.max(e.scrollTop,0)}},{capture:!1,passive:!0,once:!1})},jF=t=>{t.contentElement=document.createElement("div"),t.contentElement.className="protyle-content",(t.options.render.background||t.options.render.title)&&(t.contentElement.innerHTML='<div class="protyle-top"></div>',t.options.render.background&&t.contentElement.firstElementChild.appendChild(t.background.element),t.options.render.title&&t.contentElement.firstElementChild.appendChild(t.title.element)),t.contentElement.appendChild(t.wysiwyg.element),t.options.action.includes(p.CB_GET_HISTORY)||GF(t,t.contentElement),t.element.append(t.contentElement),t.element.appendChild(t.preview.element),t.upload&&t.element.appendChild(t.upload.element),t.options.render.scroll&&t.element.appendChild(t.scroll.element.parentElement),t.gutter&&t.element.appendChild(t.gutter.element),t.element.appendChild(t.hint.element),t.selectElement=document.createElement("div"),t.selectElement.className="protyle-select fn__none",t.element.appendChild(t.selectElement),t.element.appendChild(t.toolbar.element),t.element.appendChild(t.toolbar.subElement),os(t.toolbar.subElement,()=>{const s=t.toolbar.subElement.querySelector('.block__icons [data-type="pin"]');s&&(s.querySelector("svg use").setAttribute("xlink:href","#iconUnpin"),s.setAttribute("aria-label",window.siyuan.languages.unpin),t.toolbar.subElement.firstElementChild.setAttribute("data-drag","true"))}),t.element.append(t.highlight.styleElement),Ud(t),Hd(t,t.options.mode),document.execCommand("DefaultParagraphSeparator",!1,"p");let e;const n=K(),a=Jt();t.contentElement.addEventListener("mousewheel",s=>{if(!(!window.siyuan.config.editor.fontSizeScrollZoom||a&&!s.metaKey||!a&&!s.ctrlKey||s.deltaX!==0)){if(s.stopPropagation(),s.deltaY<0)if(window.siyuan.config.editor.fontSize<72)window.siyuan.config.editor.fontSize++;else return;else if(s.deltaY>0)if(window.siyuan.config.editor.fontSize>9)window.siyuan.config.editor.fontSize--;else return;Qh(),clearTimeout(e),Q(`${window.siyuan.languages.fontSize} ${window.siyuan.config.editor.fontSize}px<span class="fn__space"></span>
<button class="b3-button b3-button--white">${window.siyuan.languages.reset} 16px</button>`,void 0,void 0,n),e=window.setTimeout(()=>{var r;ae("/api/setting/setEditor",window.siyuan.config.editor),t.wysiwyg.element.querySelectorAll(".code-block .protyle-linenumber__rows").forEach(o=>{Rf(o.parentElement)}),(r=document.querySelector(`#message [data-id="${n}"] button`))==null||r.addEventListener("click",()=>{window.siyuan.config.editor.fontSize=16,Qh(),ae("/api/setting/setEditor",window.siyuan.config.editor),ot(n),t.wysiwyg.element.querySelectorAll(".code-block .protyle-linenumber__rows").forEach(o=>{Rf(o.parentElement)})})},p.TIMEOUT_LOAD)}},{passive:!0}),t.contentElement.addEventListener("click",s=>{t.disabled||t.contentElement.querySelector(".protyle-wysiwyg--select")||!s.target.classList.contains("protyle-content")&&!s.target.classList.contains("protyle-wysiwyg")||setTimeout(()=>{if(window.getSelection().rangeCount>0){const c=window.getSelection().getRangeAt(0);if(c.toString()!==""&&t.wysiwyg.element.contains(c.startContainer))return}const r=t.wysiwyg.element.lastElementChild,o=r.getBoundingClientRect(),l=document.createRange();if(s.y>o.bottom){const c=Ee(Ye(r));if(!t.options.click.preventInsetEmptyBlock&&(!c||r.getAttribute("data-type")!=="NodeParagraph"&&t.wysiwyg.element.getAttribute("data-doc-type")!=="NodeListItem"||r.getAttribute("data-type")==="NodeParagraph"&&Ee(c).innerHTML!=="")){let d;r.getAttribute("data-type")==="NodeHeading"&&r.getAttribute("fold")==="1"?d=Hh(r):d=Fs(!1,!1),t.wysiwyg.element.insertAdjacentElement("beforeend",d),et(t,[{action:"insert",data:d.outerHTML,id:d.getAttribute("data-node-id"),previousID:d.previousElementSibling.getAttribute("data-node-id"),parentID:t.block.parentID}],[{action:"delete",id:d.getAttribute("data-node-id")}]);const u=Ee(d);l.selectNodeContents(u),l.collapse(!0),Pt(l),t.options.render.breadcrumb&&setTimeout(()=>{t.breadcrumb.render(t)},p.TIMEOUT_TRANSITION)}else c&&(l.selectNodeContents(c),l.collapse(!1),Pt(l));t.toolbar.range=l}})});let i=!1;t.element.addEventListener("mouseover",s=>{const r=N(s.target,"protyle-attr");if(r&&!r.parentElement.classList.contains("protyle-title")){const c=t.wysiwyg.element.querySelector(".protyle-wysiwyg--hl");c&&c.classList.remove("protyle-wysiwyg--hl"),i=!0,r.parentElement.classList.add("protyle-wysiwyg--hl");return}else if(i){const c=t.wysiwyg.element.querySelector(".protyle-wysiwyg--hl");c&&c.classList.remove("protyle-wysiwyg--hl"),i=!1}const o=oe(s.target);if(t.options.render.gutter&&o){if(o&&(o.classList.contains("list")||o.classList.contains("li")))return;const c=ge(o);if(c){t.gutter.render(t,c,t.wysiwyg.element);return}t.gutter.render(t,o,t.wysiwyg.element,s.target);return}const l=A(s.target,"BUTTON");if(l&&l.parentElement.classList.contains("protyle-gutters")){const c=l.getAttribute("data-type");if(c==="fold"||c==="NodeAttributeViewRow"){Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--hl, .av__row--hl")).forEach(d=>{d.classList.remove("protyle-wysiwyg--hl","av__row--hl")});return}Array.from(t.wysiwyg.element.querySelectorAll(`[data-node-id="${l.getAttribute("data-node-id")}"]`)).find(d=>{if(!ge(d)&&t.gutter.isMatchNode(d)){const u=l.dataset.groupId&&l.dataset.groupId!=="undefined"?`.av__body[data-group-id="${l.dataset.groupId}"] `:"",g=d.querySelector(u+`.av__row[data-id="${l.dataset.rowId}"]`);return Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--hl, .av__row--hl")).forEach(f=>{d!==f&&f.classList.remove("protyle-wysiwyg--hl"),g&&g!==f&&g.classList.remove("av__row--hl")}),c==="NodeAttributeViewRowMenu"?g.classList.add("av__row--hl"):d.classList.add("protyle-wysiwyg--hl"),!0}}),s.preventDefault();return}if(t.selectElement.classList.contains("fn__none")){const c=ue(s.target,"data-node-id",null);if(c&&c.parentElement.classList.contains("protyle-breadcrumb__bar")){t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--hl").forEach(u=>{u.classList.remove("protyle-wysiwyg--hl")});const d=t.wysiwyg.element.querySelector(`[data-node-id="${c.getAttribute("data-node-id")}"]`);d&&d.classList.add("protyle-wysiwyg--hl")}}})},Ud=(t,e)=>{t.element.removeAttribute("data-loading"),setTimeout(()=>{t.element.getAttribute("data-loading")!=="finished"&&t.element.insertAdjacentHTML("beforeend",`<div style="background-color: var(--b3-theme-background);flex-direction: column;" class="fn__loading wysiwygLoading">
    <img width="48px" src="/stage/loading-pure.svg">
    <div style="color: var(--b3-theme-on-surface);margin-top: 8px;">${e||""}</div>
</div>`)},p.TIMEOUT_LOAD)},tg=t=>{t.element.setAttribute("data-loading","finished"),t.element.querySelectorAll(".wysiwygLoading").forEach(e=>{e.remove()})},Ax=t=>{if(t.options.action.includes(p.CB_GET_HISTORY))return{width:0,padding:0};const e=PA(t),n=e.left,a=e.right;t.options.backlinkData?t.wysiwyg.element.style.padding=`4px ${a}px 4px ${n}px`:t.wysiwyg.element.style.padding=`${e.top}px ${a}px ${e.bottom}px ${n}px`,t.options.render.background&&t.background.element.querySelector(".protyle-background__ia").setAttribute("style",`margin-left:${n}px;margin-right:${a}px`),t.options.render.title&&(t.title.element.style.margin=`16px ${a}px 0 ${n}px`),t.element.style.setProperty("--b3-width-protyle",t.element.clientWidth+"px"),t.element.style.setProperty("--b3-width-protyle-content",t.contentElement.clientWidth+"px");const i=t.wysiwyg.element.getAttribute("data-realwidth"),s=t.wysiwyg.element.clientWidth-n-a;return t.wysiwyg.element.setAttribute("data-realwidth",s.toString()),t.element.style.setProperty("--b3-width-protyle-wysiwyg",s.toString()+"px"),{width:i?Math.abs(parseFloat(i)-s):0}},PA=t=>{let e=16,n=24,a=16;if(t.options.typewriterMode&&(x()?a=window.innerHeight/5:a=t.element.clientHeight/2),!x()){let i=t.wysiwyg.element.getAttribute(p.CUSTOM_SY_FULLWIDTH);i||(i=window.siyuan.config.editor.fullWidth?"true":"false");let s=(t.element.clientWidth-p.SIZE_EDITOR_WIDTH)/4;i==="false"&&s>48?(s>p.SIZE_EDITOR_WIDTH&&(s=t.element.clientWidth*.382/1.382/2),s=Math.ceil(s),n=s,e=s):t.element.clientWidth>p.SIZE_EDITOR_WIDTH&&(n=48,e=48)}return{left:n,right:e,bottom:a,top:16}},KF=()=>{Cn().editor.forEach(t=>{var e;t.editor&&t.editor.protyle&&t.element.parentElement&&!t.element.classList.contains("fn__none")&&((e=t.editor.protyle.wysiwyg.element.querySelector("[data-resize-top]"))==null||e.removeAttribute("data-resize-top"))})},ng=()=>{Cn().editor.forEach(t=>{var e;if(t.editor&&t.editor.protyle&&t.element.parentElement&&!t.element.classList.contains("fn__none")){(e=t.editor.protyle.wysiwyg.element.querySelector("[data-resize-top]"))==null||e.removeAttribute("data-resize-top");const n=t.editor.protyle.contentElement.getBoundingClientRect();let a=document.elementFromPoint(n.left+n.width/2,n.top);if(N(a,"b3-menu")&&(window.siyuan.menus.menu.remove(),a=document.elementFromPoint(n.left+n.width/2,n.top)),a||(a=document.elementFromPoint(n.left+n.width/2,n.top+17)),!a||(a=oe(a),!a))return;a.setAttribute("data-resize-top",(n.top-a.getBoundingClientRect().top).toString())}})},Ai=t=>{Ut(["gutterOnly"],t);const e=Ax(t),n=4;setTimeout(()=>{if(t.scroll&&t.scroll.element.parentElement.getAttribute("style")&&t.scroll.element.parentElement.setAttribute("style",`--b3-dynamicscroll-width:${Math.min(t.contentElement.clientHeight-49,200)}px`),!t.disabled){const i=t.contentElement.getBoundingClientRect();t.wysiwyg.element.querySelectorAll(".av").forEach(s=>{s.querySelector(".av__scroll")&&tc(s,i,"all")})}(e.width>n||isNaN(e.width))&&typeof window.echarts!="undefined"&&t.wysiwyg.element.querySelectorAll('[data-subtype="echarts"], [data-subtype="mindmap"]').forEach(i=>{const s=window.echarts.getInstanceById(i.firstElementChild.nextElementSibling.getAttribute("_echarts_instance_"));s&&s.resize()}),t.wysiwyg.element.querySelectorAll(".code-block .protyle-linenumber__rows").forEach(i=>{i.nextElementSibling.style.wordBreak==="break-word"&&Rf(i.parentElement)});const a=t.wysiwyg.element.querySelector("[data-resize-top]");a&&(a.scrollIntoView(),t.contentElement.scrollTop+=parseInt(a.getAttribute("data-resize-top")),a.removeAttribute("data-resize-top"))},p.TIMEOUT_TRANSITION+100)},Hd=(t,e)=>{var n,a,i,s;if(e==="preview"){if(!t.preview.element.classList.contains("fn__none"))return;t.preview.element.classList.remove("fn__none"),t.contentElement.classList.add("fn__none"),(n=t.scroll)==null||n.element.classList.add("fn__none"),t.options.render.breadcrumb&&((a=t.breadcrumb)==null||a.element.classList.add("fn__none"),t.breadcrumb.toggleExit(!0)),t.preview.render(t),AE(Cn(),t,!0)}else if(e==="wysiwyg"){if(!t.contentElement.classList.contains("fn__none"))return;t.preview.element.classList.add("fn__none"),t.contentElement.classList.remove("fn__none"),t.options.render.scroll&&((i=t.scroll)==null||i.element.classList.remove("fn__none")),t.options.render.breadcrumb&&((s=t.breadcrumb)==null||s.element.classList.remove("fn__none"),t.breadcrumb.toggleExit(!t.block.showAll)),AE(Cn(),t,!0),Ai(t)}Ut(["gutterOnly","toolbar","select","hint","util"],t),t.app.plugins.forEach(r=>{r.eventBus.emit("switch-protyle-mode",{protyle:t})})},ag="auto",Tx=1,NA=1.1,BA=.1,$A=10,Dx=0,XF=1.25,OA=40,RA=5,aa={INITIAL:0,RUNNING:1,PAUSED:2,FINISHED:3},Oi={UNKNOWN:0,NORMAL:1,CHANGING:2,FULLSCREEN:3},Hn={UNKNOWN:-1,NONE:0,THUMBS:1,OUTLINE:2,ATTACHMENTS:3,LAYERS:4},bo={DISABLE:0,ENABLE:1,ENABLE_PERMISSIONS:2},On={UNKNOWN:-1,VERTICAL:0,HORIZONTAL:1,WRAPPED:2,PAGE:3},Na={UNKNOWN:-1,NONE:0,ODD:1,EVEN:2},Os={SELECT:0,HAND:1,ZOOM:2},ZF=/\bprint\s*\(/;function Cx(t,e,n=!1){let a=t.offsetParent;if(!a){console.error("offsetParent is not set -- cannot scroll");return}let i=t.offsetTop+t.clientTop,s=t.offsetLeft+t.clientLeft;for(;a.clientHeight===a.scrollHeight&&a.clientWidth===a.scrollWidth||n&&(a.classList.contains("markedContent")||getComputedStyle(a).overflow==="hidden");)if(i+=a.offsetTop,s+=a.offsetLeft,a=a.offsetParent,!a)return;e&&(e.top!==void 0&&(i+=e.top),e.left!==void 0&&(s+=e.left,a.scrollLeft=s)),a.scrollTop=i}function UA(t,e,n=void 0){const a=function(r){s||(s=window.requestAnimationFrame(function(){s=null;const l=t.scrollLeft,c=i.lastX;l!==c&&(i.right=l>c),i.lastX=l;const d=t.scrollTop,u=i.lastY;d!==u&&(i.down=d>u),i.lastY=d,e(i),t.dataset.scrolltop=t.scrollTop}))},i={right:!0,down:!0,lastX:t.scrollLeft,lastY:t.scrollTop,_eventHandler:a};let s=null;return t.addEventListener("scroll",a,{useCapture:!0,signal:n}),n==null||n.addEventListener("abort",()=>window.cancelAnimationFrame(s),{once:!0}),i}function ig(t){const e=new Map;for(const[n,a]of new URLSearchParams(t))e.set(n.toLowerCase(),a);return e}const HA=/[\x00-\x1F]/g;function qf(t,e=!1){return HA.test(t)?e?t.replaceAll(HA,n=>n==="\0"?"":" "):t.replaceAll("\0",""):t}function sg(t,e,n=0){let a=n,i=t.length-1;if(i<0||!e(t[i]))return t.length;if(e(t[a]))return a;for(;a<i;){const s=a+i>>1,r=t[s];e(r)?i=s:a=s+1}return a}function qA(t){if(Math.floor(t)===t)return[t,1];const e=1/t,n=8;if(e>n)return[1,n];if(Math.floor(e)===e)return[1,e];const a=t>1?e:t;let i=0,s=1,r=1,o=1;for(;;){const c=i+r,d=s+o;if(d>n)break;a<=c/d?(r=c,o=d):(i=c,s=d)}let l;return a-i/s<r/o-a?l=a===t?[i,s]:[s,i]:l=a===t?[r,o]:[o,r],l}function y_(t,e){return t-t%e}function JF({view:t,userUnit:e,rotate:n}){const[a,i,s,r]=t,o=n%180!==0,l=(s-a)/72*e,c=(r-i)/72*e;return{width:o?c:l,height:o?l:c}}function QF(t,e,n){if(t<2)return t;let a=e[t].div,i=a.offsetTop+a.clientTop;i>=n&&(a=e[t-1].div,i=a.offsetTop+a.clientTop);for(let s=t-2;s>=0&&(a=e[s].div,!(a.offsetTop+a.clientTop+a.clientHeight<=i));--s)t=s;return t}function WA({scrollEl:t,views:e,sortByVisibility:n=!1,horizontal:a=!1,rtl:i=!1}){const s=t.scrollTop,r=s+t.clientHeight,o=t.scrollLeft,l=o+t.clientWidth;function c(_){const v=_.div;return v.offsetTop+v.clientTop+v.clientHeight>s}function d(_){const v=_.div,U=v.offsetLeft+v.clientLeft,ee=U+v.clientWidth;return i?U<l:ee>o}const u=[],g=new Set,f=e.length;let h=sg(e,a?d:c);h>0&&h<f&&!a&&(h=QF(h,e,s));let m=a?l:-1;for(let _=h;_<f;_++){const v=e[_],U=v.div,ee=U.offsetLeft+U.clientLeft,Z=U.offsetTop+U.clientTop,k=U.clientWidth,w=U.clientHeight,S=ee+k,B=Z+w;if(m===-1)B>=r&&(m=B);else if((a?ee:Z)>m)break;if(B<=s||Z>=r||S<=o||ee>=l)continue;const H=Math.max(0,s-Z)+Math.max(0,B-r),j=Math.max(0,o-ee)+Math.max(0,S-l),re=(w-H)/w,Te=(k-j)/k,Be=re*Te*100|0;u.push({id:v.id,x:ee,y:Z,view:v,percent:Be,widthPercent:Te*100|0}),g.add(v.id)}const b=u[0],y=u.at(-1);return n&&u.sort(function(_,v){const U=_.percent-v.percent;return Math.abs(U)>.001?-U:_.id-v.id}),{first:b,last:y,views:u,ids:g}}function VA(t){let e=Math.hypot(t.deltaX,t.deltaY);const n=Math.atan2(t.deltaY,t.deltaX);return-.25*Math.PI<n&&n<.75*Math.PI&&(e=-e),e}function e4(t){const e=t.deltaMode;let n=VA(t);const a=30,i=30;return e===WheelEvent.DOM_DELTA_PIXEL?n/=a*i:e===WheelEvent.DOM_DELTA_LINE&&(n/=i),n}function __(t){return Number.isInteger(t)&&t%90===0}function zA(t){return Number.isInteger(t)&&Object.values(On).includes(t)&&t!==On.UNKNOWN}function YA(t){return Number.isInteger(t)&&Object.values(Na).includes(t)&&t!==Na.UNKNOWN}function Lx(t){return t.width<=t.height}const t4=new Promise(function(t){if(typeof PDFJSDev!="undefined"&&PDFJSDev.test("LIB")&&typeof window=="undefined"){setTimeout(t,20);return}window.requestAnimationFrame(t)}),GA=typeof PDFJSDev!="undefined"&&PDFJSDev.test("LIB")&&typeof document=="undefined"?null:document.documentElement.style;function n4(t,e,n){return Math.min(Math.max(t,e),n)}class a4{constructor(e){Ae(this,Cc,null);Ae(this,mu,null);Ae(this,Lc,0);Ae(this,up,null);Ae(this,bu,!0);it(this,Cc,e.classList),it(this,up,e.style)}get percent(){return ie(this,Lc)}set percent(e){if(it(this,Lc,n4(e,0,100)),isNaN(e)){ie(this,Cc).add("indeterminate");return}ie(this,Cc).remove("indeterminate"),ie(this,up).setProperty("--progressBar-percent",`${ie(this,Lc)}%`)}setWidth(e){if(!e)return;const a=e.parentNode.offsetWidth-e.offsetWidth;a>0&&ie(this,up).setProperty("--progressBar-end-offset",`${a}px`)}setDisableAutoFetch(e=5e3){ie(this,Lc)===100||isNaN(ie(this,Lc))||(ie(this,mu)&&clearTimeout(ie(this,mu)),this.show(),it(this,mu,setTimeout(()=>{it(this,mu,null),this.hide()},e)))}hide(){ie(this,bu)&&(it(this,bu,!1),ie(this,Cc).add("fn__hidden"))}show(){ie(this,bu)||(it(this,bu,!0),ie(this,Cc).remove("fn__hidden"))}}Cc=new WeakMap,mu=new WeakMap,Lc=new WeakMap,up=new WeakMap,bu=new WeakMap;function i4(){let t=document,e=t.activeElement||t.querySelector(":focus");for(;e!=null&&e.shadowRoot;)t=e.shadowRoot,e=t.activeElement||t.querySelector(":focus");return e}function jA(t){let e=On.VERTICAL,n=Na.NONE;switch(t){case"SinglePage":e=On.PAGE;break;case"OneColumn":break;case"TwoPageLeft":e=On.PAGE;case"TwoColumnLeft":n=Na.ODD;break;case"TwoPageRight":e=On.PAGE;case"TwoColumnRight":n=Na.EVEN;break}return{scrollMode:e,spreadMode:n}}function s4(t){switch(t){case"UseNone":return Hn.NONE;case"UseThumbs":return Hn.THUMBS;case"UseOutlines":return Hn.OUTLINE;case"UseAttachments":return Hn.ATTACHMENTS;case"UseOC":return Hn.LAYERS}return Hn.NONE}function yr(t,e,n=null){t.classList.toggle("toggled",e),t.setAttribute("aria-checked",e),n==null||n.classList.toggle("fn__hidden",!e)}function zo(t,e,n=null){t.classList.toggle("toggled",e),t.setAttribute("aria-expanded",e),n==null||n.classList.toggle("fn__hidden",!e)}const w_=typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL")?Math.fround:function(){if(typeof PDFJSDev!="undefined"&&PDFJSDev.test("LIB")&&typeof document=="undefined")return e=>e;const t=document.createElement("div");return t.style.width="round(down, calc(1.6666666666666665 * 792px), 1px)",t.style.width==="calc(1320px)"?Math.fround:e=>e}();if(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC")){var qd=new Map;typeof PDFJSDev!="undefined"&&PDFJSDev.test("LIB")&&typeof navigator=="undefined"&&(globalThis.navigator=Object.create(null));const t=navigator.userAgent||"",e=navigator.platform||"",n=navigator.maxTouchPoints||1,a=/Android/.test(t),i=/\b(iPad|iPhone|iPod)(?=;)/.test(t)||e==="MacIntel"&&n>1;(function(){(i||a)&&qd.set("maxCanvasPixels",5242880)})(),function(){a&&qd.set("useSystemFonts",!1)}()}const Ft={BROWSER:1,VIEWER:2,API:4,WORKER:8,EVENT_DISPATCH:16,PREFERENCE:128},Ix={BOOLEAN:1,NUMBER:2,OBJECT:4,STRING:8,UNDEFINED:16},_r={allowedGlobalEvents:{value:null,kind:Ft.BROWSER},canvasMaxAreaInBytes:{value:-1,kind:Ft.BROWSER+Ft.API},isInAutomation:{value:!1,kind:Ft.BROWSER},localeProperties:{value:typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC")?{lang:navigator.language||"en-US"}:null,kind:Ft.BROWSER},nimbusDataStr:{value:"",kind:Ft.BROWSER},supportsCaretBrowsingMode:{value:!1,kind:Ft.BROWSER},supportsDocumentFonts:{value:!0,kind:Ft.BROWSER},supportsIntegratedFind:{value:!1,kind:Ft.BROWSER},supportsMouseWheelZoomCtrlKey:{value:!0,kind:Ft.BROWSER},supportsMouseWheelZoomMetaKey:{value:!0,kind:Ft.BROWSER},supportsPinchToZoom:{value:!0,kind:Ft.BROWSER},toolbarDensity:{value:0,kind:Ft.BROWSER+Ft.EVENT_DISPATCH},altTextLearnMoreUrl:{value:typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL")?"https://support.mozilla.org/1/firefox/%VERSION%/%OS%/%LOCALE%/pdf-alt-text":"",kind:Ft.VIEWER+Ft.PREFERENCE},annotationEditorMode:{value:0,kind:Ft.VIEWER+Ft.PREFERENCE},annotationMode:{value:2,kind:Ft.VIEWER+Ft.PREFERENCE},cursorToolOnLoad:{value:0,kind:Ft.VIEWER+Ft.PREFERENCE},debuggerSrc:{value:"./debugger.mjs",kind:Ft.VIEWER},defaultZoomDelay:{value:400,kind:Ft.VIEWER+Ft.PREFERENCE},defaultZoomValue:{value:"",kind:Ft.VIEWER+Ft.PREFERENCE},disableHistory:{value:!1,kind:Ft.VIEWER},disablePageLabels:{value:!1,kind:Ft.VIEWER+Ft.PREFERENCE},enableAltText:{value:!1,kind:Ft.VIEWER+Ft.PREFERENCE},enableAltTextModelDownload:{value:!0,kind:Ft.VIEWER+Ft.PREFERENCE+Ft.EVENT_DISPATCH},enableGuessAltText:{value:!0,kind:Ft.VIEWER+Ft.PREFERENCE+Ft.EVENT_DISPATCH},enableHighlightFloatingButton:{value:typeof PDFJSDev=="undefined"||PDFJSDev.test("TESTING"),kind:Ft.VIEWER+Ft.PREFERENCE},enableNewAltTextWhenAddingImage:{value:!0,kind:Ft.VIEWER+Ft.PREFERENCE},enablePermissions:{value:!1,kind:Ft.VIEWER+Ft.PREFERENCE},enablePrintAutoRotate:{value:!0,kind:Ft.VIEWER+Ft.PREFERENCE},enableScripting:{value:typeof PDFJSDev=="undefined"||!PDFJSDev.test("CHROME"),kind:Ft.VIEWER+Ft.PREFERENCE},enableUpdatedAddImage:{value:!1,kind:Ft.VIEWER+Ft.PREFERENCE},externalLinkRel:{value:"noopener noreferrer nofollow",kind:Ft.VIEWER},externalLinkTarget:{value:0,kind:Ft.VIEWER+Ft.PREFERENCE},highlightEditorColors:{value:"yellow=#FFFF98,green=#53FFBC,blue=#80EBFF,pink=#FFCBE6,red=#FF4F5F",kind:Ft.VIEWER+Ft.PREFERENCE},historyUpdateUrl:{value:!1,kind:Ft.VIEWER+Ft.PREFERENCE},ignoreDestinationZoom:{value:!1,kind:Ft.VIEWER+Ft.PREFERENCE},imageResourcesPath:{value:typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL")?"resource://pdf.js/web/images/":"./images/",kind:Ft.VIEWER},maxCanvasPixels:{value:fI(2,25),kind:Ft.VIEWER},forcePageColors:{value:!1,kind:Ft.VIEWER+Ft.PREFERENCE},pageColorsBackground:{value:"Canvas",kind:Ft.VIEWER+Ft.PREFERENCE},pageColorsForeground:{value:"CanvasText",kind:Ft.VIEWER+Ft.PREFERENCE},pdfBugEnabled:{value:typeof PDFJSDev=="undefined"||PDFJSDev.test("TESTING"),kind:Ft.VIEWER+Ft.PREFERENCE},printResolution:{value:150,kind:Ft.VIEWER},sidebarViewOnLoad:{value:-1,kind:Ft.VIEWER+Ft.PREFERENCE},scrollModeOnLoad:{value:-1,kind:Ft.VIEWER+Ft.PREFERENCE},spreadModeOnLoad:{value:-1,kind:Ft.VIEWER+Ft.PREFERENCE},textLayerMode:{value:1,kind:Ft.VIEWER+Ft.PREFERENCE},viewOnLoad:{value:0,kind:Ft.VIEWER+Ft.PREFERENCE},cMapPacked:{value:!0,kind:Ft.API},cMapUrl:{value:typeof PDFJSDev=="undefined"?"../external/bcmaps/":PDFJSDev.test("MOZCENTRAL")?"resource://pdf.js/web/cmaps/":"../web/cmaps/",kind:Ft.API},disableAutoFetch:{value:!1,kind:Ft.API+Ft.PREFERENCE},disableFontFace:{value:!1,kind:Ft.API+Ft.PREFERENCE},disableRange:{value:!1,kind:Ft.API+Ft.PREFERENCE},disableStream:{value:!1,kind:Ft.API+Ft.PREFERENCE},docBaseUrl:{value:typeof PDFJSDev=="undefined"?document.URL.split("#",1)[0]:"",kind:Ft.API},enableHWA:{value:typeof PDFJSDev!="undefined"&&!PDFJSDev.test("MOZCENTRAL"),kind:Ft.API+Ft.VIEWER+Ft.PREFERENCE},enableXfa:{value:!0,kind:Ft.API+Ft.PREFERENCE},fontExtraProperties:{value:!1,kind:Ft.API},isEvalSupported:{value:!0,kind:Ft.API},isOffscreenCanvasSupported:{value:!0,kind:Ft.API},maxImageSize:{value:-1,kind:Ft.API},pdfBug:{value:!1,kind:Ft.API},standardFontDataUrl:{value:typeof PDFJSDev=="undefined"?"../external/standard_fonts/":PDFJSDev.test("MOZCENTRAL")?"resource://pdf.js/web/standard_fonts/":"../web/standard_fonts/",kind:Ft.API},useSystemFonts:{value:(typeof PDFJSDev=="undefined"?window.isGECKOVIEW:PDFJSDev.test("GECKOVIEW"))?!1:void 0,kind:Ft.API,type:Ix.BOOLEAN+Ix.UNDEFINED},verbosity:{value:1,kind:Ft.API},workerPort:{value:null,kind:Ft.WORKER},workerSrc:{value:typeof PDFJSDev=="undefined"?"../src/pdf.worker.js":PDFJSDev.test("MOZCENTRAL")?"resource://pdf.js/build/pdf.worker.mjs":"../build/pdf.worker.mjs",kind:Ft.WORKER}};if((typeof PDFJSDev=="undefined"||!PDFJSDev.test("MOZCENTRAL"))&&(_r.defaultUrl={value:typeof PDFJSDev!="undefined"&&PDFJSDev.test("CHROME")?"":"compressed.tracemonkey-pldi-09.pdf",kind:Ft.VIEWER},_r.sandboxBundleSrc={value:typeof PDFJSDev=="undefined"?"../build/dev-sandbox/pdf.sandbox.mjs":"../build/pdf.sandbox.mjs",kind:Ft.VIEWER},_r.viewerCssTheme={value:typeof PDFJSDev!="undefined"&&PDFJSDev.test("CHROME")?2:0,kind:Ft.VIEWER+Ft.PREFERENCE},_r.enableFakeMLManager={value:!0,kind:Ft.VIEWER}),typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC")?_r.disablePreferences={value:typeof PDFJSDev!="undefined"&&PDFJSDev.test("TESTING"),kind:Ft.VIEWER}:PDFJSDev.test("CHROME")&&(_r.disableTelemetry={value:!1,kind:Ft.VIEWER+Ft.PREFERENCE}),typeof PDFJSDev=="undefined"||PDFJSDev.test("TESTING || LIB"))for(const t in _r){const{value:e,kind:n,type:a}=_r[t];if(n&Ft.PREFERENCE){if(n===Ft.PREFERENCE)throw new Error(`Cannot use only "PREFERENCE" kind: ${t}`);if(n&Ft.BROWSER)throw new Error(`Cannot mix "PREFERENCE" and "BROWSER" kind: ${t}`);if(a!==void 0)throw new Error(`Cannot have \`type\`-field for "PREFERENCE" kind: ${t}`);if(typeof qd=="object"&&qd.has(t))throw new Error(`Should not have compatibility-value for "PREFERENCE" kind: ${t}`);if(typeof e!="boolean"&&typeof e!="string"&&!Number.isInteger(e))throw new Error(`Invalid value for "PREFERENCE" kind: ${t}`)}else if(n&Ft.BROWSER){if(a!==void 0)throw new Error(`Cannot have \`type\`-field for "BROWSER" kind: ${t}`);if(typeof qd=="object"&&qd.has(t))throw new Error(`Should not have compatibility-value for "BROWSER" kind: ${t}`);if(e===void 0)throw new Error(`Invalid value for "BROWSER" kind: ${t}`)}}const tl=class tl{constructor(){if(typeof PDFJSDev=="undefined"||PDFJSDev.test("TESTING"))throw new Error("Cannot initialize AppOptions.")}static get(e){return ie(this,Ic).get(e)}static getAll(e=null,n=!1){const a=Object.create(null);for(const i in _r){const s=_r[i];e&&!(e&s.kind)||(a[i]=n?s.value:ie(this,Ic).get(i))}return a}static set(e,n){this.setAll({[e]:n})}static setAll(e,n=!1){(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&(this._hasInvokedSet||(this._hasInvokedSet=!0));let a;for(const i in e){const s=_r[i],r=e[i];if(!s||!(typeof r==typeof s.value||Ix[(typeof r).toUpperCase()]&s.type))continue;const{kind:o}=s;n&&!(o&Ft.BROWSER||o&Ft.PREFERENCE)||(this.eventBus&&o&Ft.EVENT_DISPATCH&&(a||(a=new Map)).set(i,r),ie(this,Ic).set(i,r))}if(a)for(const[i,s]of a)this.eventBus.dispatch(i.toLowerCase(),{source:this,value:s})}};Ic=new WeakMap,ty(tl,"eventBus"),Ae(tl,Ic,new Map),(()=>{for(const e in _r)ie(tl,Ic).set(e,_r[e].value);if(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC")){for(const[e,n]of qd)ie(tl,Ic).set(e,n);tl._hasInvokedSet=!1,tl._checkDisablePreferences=()=>tl.get("disablePreferences")?!0:(tl._hasInvokedSet&&console.warn('The Preferences may override manually set AppOptions; please use the "disablePreferences"-option to prevent that.'),!1)}})();let en=tl;const r4="noopener noreferrer nofollow",xl={NONE:0,SELF:1,BLANK:2,PARENT:3,TOP:4},Iw=class Iw{constructor({eventBus:e,externalLinkTarget:n=null,externalLinkRel:a=null,ignoreDestinationZoom:i=!1}={}){ty(this,"externalLinkEnabled",!0);this.eventBus=e,this.externalLinkTarget=n,this.externalLinkRel=a,this._ignoreDestinationZoom=i,this.baseUrl=null,this.pdfDocument=null,this.pdfViewer=null,this.pdfHistory=null}setDocument(e,n=null){this.baseUrl=n,this.pdfDocument=e}setViewer(e){this.pdfViewer=e}setHistory(e){this.pdfHistory=e}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return this.pdfDocument?this.pdfViewer.currentPageNumber:1}set page(e){this.pdfDocument&&(this.pdfViewer.currentPageNumber=e)}get rotation(){return this.pdfDocument?this.pdfViewer.pagesRotation:0}set rotation(e){this.pdfDocument&&(this.pdfViewer.pagesRotation=e)}get isInPresentationMode(){return this.pdfDocument?this.pdfViewer.isInPresentationMode:!1}goToDestination(e){return Rt(this,null,function*(){if(!this.pdfDocument)return;let n,a,i;if(typeof e=="string"?(n=e,a=yield this.pdfDocument.getDestination(e)):(n=null,a=yield e),!Array.isArray(a)){console.error(`goToDestination: "${a}" is not a valid destination array, for dest="${e}".`);return}const[s]=a;if(s&&typeof s=="object"){if(i=this.pdfDocument.cachedPageNumber(s),!i)try{i=(yield this.pdfDocument.getPageIndex(s))+1}catch(r){console.error(`goToDestination: "${s}" is not a valid page reference, for dest="${e}".`);return}}else Number.isInteger(s)&&(i=s+1);if(!i||i<1||i>this.pagesCount){console.error(`goToDestination: "${i}" is not a valid page number, for dest="${e}".`);return}this.pdfHistory&&(this.pdfHistory.pushCurrentPosition(),this.pdfHistory.push({namedDest:n,explicitDest:a,pageNumber:i})),this.pdfViewer.scrollPageIntoView({pageNumber:i,destArray:a,ignoreDestinationZoom:this._ignoreDestinationZoom})})}goToPage(e){if(!this.pdfDocument)return;const n=typeof e=="string"&&this.pdfViewer.pageLabelToPageNumber(e)||e|0;if(!(Number.isInteger(n)&&n>0&&n<=this.pagesCount)){console.error(`PDFLinkService.goToPage: "${e}" is not a valid page.`);return}this.pdfHistory&&(this.pdfHistory.pushCurrentPosition(),this.pdfHistory.pushPage(n)),this.pdfViewer.scrollPageIntoView({pageNumber:n})}addLinkAttributes(e,n,a=!1){if(!n||typeof n!="string")throw new Error('A valid "url" parameter must provided.');const i=a?xl.BLANK:this.externalLinkTarget,s=this.externalLinkRel;this.externalLinkEnabled?e.href=e.title=n:(e.href="",e.title=`Disabled: ${n}`,e.onclick=()=>!1);let r="";switch(i){case xl.NONE:break;case xl.SELF:r="_self";break;case xl.BLANK:r="_blank";break;case xl.PARENT:r="_parent";break;case xl.TOP:r="_top";break}e.target=r,e.rel=typeof s=="string"?s:r4}getDestinationHash(e){if(typeof e=="string"){if(e.length>0)return this.getAnchorUrl("#"+escape(e))}else if(Array.isArray(e)){const n=JSON.stringify(e);if(n.length>0)return this.getAnchorUrl("#"+escape(n))}return this.getAnchorUrl("")}getAnchorUrl(e){return this.baseUrl?this.baseUrl+e:e}setHash(e){var i;if(!this.pdfDocument)return;let n,a;if(e.includes("=")){const s=ig(e);if(s.has("search")){const r=s.get("search").replaceAll('"',""),o=s.get("phrase")==="true";this.eventBus.dispatch("findfromurlhash",{source:this,query:o?r:r.match(/\S+/g)})}if(s.has("page")&&(n=s.get("page")|0||1),s.has("zoom")){const r=s.get("zoom").split(","),o=r[0],l=parseFloat(o);o.includes("Fit")?o==="Fit"||o==="FitB"?a=[null,{name:o}]:o==="FitH"||o==="FitBH"||o==="FitV"||o==="FitBV"?a=[null,{name:o},r.length>1?r[1]|0:null]:o==="FitR"?r.length!==5?console.error('PDFLinkService.setHash: Not enough parameters for "FitR".'):a=[null,{name:o},r[1]|0,r[2]|0,r[3]|0,r[4]|0]:console.error(`PDFLinkService.setHash: "${o}" is not a valid zoom value.`):a=[null,{name:"XYZ"},r.length>1?r[1]|0:null,r.length>2?r[2]|0:null,l?l/100:o]}if(a?this.pdfViewer.scrollPageIntoView({pageNumber:n||this.page,destArray:a,allowNegativeOffset:!0}):n&&(this.page=n),s.has("pagemode")&&this.eventBus.dispatch("pagemode",{source:this,mode:s.get("pagemode")}),s.has("nameddest")&&this.goToDestination(s.get("nameddest")),typeof PDFJSDev=="undefined"||!PDFJSDev.test("MOZCENTRAL")||!s.has("filename")||!s.has("filedest"))return;e=s.get("filedest")}a=unescape(e);try{a=JSON.parse(a),Array.isArray(a)||(a=a.toString())}catch(s){}if(typeof a=="string"||Se(i=Iw,Lw,pI).call(i,a)){this.goToDestination(a);return}console.error(`PDFLinkService.setHash: "${unescape(e)}" is not a valid destination.`)}executeNamedAction(e){var n,a;if(this.pdfDocument){switch(e){case"GoBack":(n=this.pdfHistory)==null||n.back();break;case"GoForward":(a=this.pdfHistory)==null||a.forward();break;case"NextPage":this.pdfViewer.nextPage();break;case"PrevPage":this.pdfViewer.previousPage();break;case"LastPage":this.page=this.pagesCount;break;case"FirstPage":this.page=1;break;default:break}this.eventBus.dispatch("namedaction",{source:this,action:e})}}executeSetOCGState(e){return Rt(this,null,function*(){if(!this.pdfDocument)return;const n=this.pdfDocument,a=yield this.pdfViewer.optionalContentConfigPromise;n===this.pdfDocument&&(a.setOCGState(e),this.pdfViewer.optionalContentConfigPromise=Promise.resolve(a))})}};Lw=new WeakSet,pI=function(e){if(!Array.isArray(e)||e.length<2)return!1;const[n,a,...i]=e;if(!(typeof n=="object"&&Number.isInteger(n==null?void 0:n.num)&&Number.isInteger(n==null?void 0:n.gen))&&!Number.isInteger(n)||!(typeof a=="object"&&typeof(a==null?void 0:a.name)=="string"))return!1;const s=i.length;let r=!0;switch(a.name){case"XYZ":if(s<2||s>3)return!1;break;case"Fit":case"FitB":return s===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(s>1)return!1;break;case"FitR":if(s!==4)return!1;r=!1;break;default:return!1}for(const o of i)if(!(typeof o=="number"||r&&o===null))return!1;return!0},Ae(Iw,Lw);let v_=Iw;class Mx extends v_{setDocument(e,n=null){}}var Bt=Tn(2119);const KA={EVENT:"event",TIMEOUT:"timeout"};function XA(a){return Rt(this,arguments,function*({target:t,name:e,delay:n=0}){if(typeof t!="object"||!(e&&typeof e=="string")||!(Number.isInteger(n)&&n>=0))throw new Error("waitOnEventOrTimeout - invalid parameters.");const{promise:i,resolve:s}=Promise.withResolvers(),r=new AbortController;function o(d){r.abort(),clearTimeout(c),s(d)}const l=t instanceof Fx?"_on":"addEventListener";t[l](e,o.bind(null,KA.EVENT),{signal:r.signal});const c=setTimeout(o.bind(null,KA.TIMEOUT),n);return i})}class Fx{constructor(){Ae(this,fp,Object.create(null))}on(e,n,a=null){this._on(e,n,{external:!0,once:a==null?void 0:a.once,signal:a==null?void 0:a.signal})}off(e,n,a=null){this._off(e,n)}dispatch(e,n){const a=ie(this,fp)[e];if(!a||a.length===0)return;let i;for(const{listener:s,external:r,once:o}of a.slice(0)){if(o&&this._off(e,s),r){(i||(i=[])).push(s);continue}s(n)}if(i){for(const s of i)s(n);i=null}}_on(e,n,a=null){var r;let i=null;if((a==null?void 0:a.signal)instanceof AbortSignal){const{signal:o}=a;if(o.aborted){console.error("Cannot use an `aborted` signal.");return}const l=()=>this._off(e,n);i=()=>o.removeEventListener("abort",l),o.addEventListener("abort",l)}((r=ie(this,fp))[e]||(r[e]=[])).push({listener:n,external:(a==null?void 0:a.external)===!0,once:(a==null?void 0:a.once)===!0,rmAbort:i})}_off(e,n,a=null){var s;const i=ie(this,fp)[e];if(i)for(let r=0,o=i.length;r<o;r++){const l=i[r];if(l.listener===n){(s=l.rmAbort)==null||s.call(l),i.splice(r,1);return}}}}fp=new WeakMap;class o4 extends Fx{constructor(n,a,i){super();Ae(this,sm,void 0);Ae(this,rm,void 0);Ae(this,om,void 0);it(this,rm,n),it(this,sm,a),it(this,om,i)}dispatch(n,a){var i;if(typeof PDFJSDev!="undefined"&&!PDFJSDev.test("MOZCENTRAL"))throw new Error("Not implemented: FirefoxEventBus.dispatch");if(super.dispatch(n,a),ie(this,om)){const s=Object.create(null);if(a)for(const o in a){const l=a[o];if(o==="source"){if(l===window||l===document)return;continue}s[o]=l}const r=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:s});document.dispatchEvent(r)}(i=ie(this,rm))!=null&&i.has(n)&&ie(this,sm).dispatchGlobalEvent({eventName:n,detail:a})}}sm=new WeakMap,rm=new WeakMap,om=new WeakMap;class Px{constructor(){if((typeof PDFJSDev=="undefined"||PDFJSDev.test("TESTING"))&&this.constructor===Px)throw new Error("Cannot initialize BaseExternalServices.")}updateFindControlState(e){}updateFindMatchesCount(e){}initPassiveLoading(){}reportTelemetry(e){}createL10n(){return Rt(this,null,function*(){throw new Error("Not implemented: createL10n")})}createScripting(){throw new Error("Not implemented: createScripting")}updateEditorStates(e){throw new Error("Not implemented: updateEditorStates")}dispatchGlobalEvent(e){}}const rk=class rk{constructor(){Ae(this,yu,Object.freeze(typeof PDFJSDev=="undefined"?en.getAll(Ft.PREFERENCE,!0):PDFJSDev.eval("DEFAULT_PREFERENCES")));Ae(this,Nl,null);if((typeof PDFJSDev=="undefined"||PDFJSDev.test("TESTING"))&&this.constructor===rk)throw new Error("Cannot initialize BasePreferences.");typeof PDFJSDev!="undefined"&&PDFJSDev.test("CHROME")&&Object.defineProperty(this,"defaults",{get(){return ie(this,yu)}}),it(this,Nl,this._readFromStorage(ie(this,yu)).then(({browserPrefs:e,prefs:n})=>{(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&en._checkDisablePreferences()||en.setAll(Ys(Ys({},e),n),!0)})),typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL")&&window.addEventListener("updatedPreference",a=>Rt(this,[a],function*({detail:{name:e,value:n}}){yield ie(this,Nl),en.setAll({[e]:n},!0)}))}_writeToStorage(e){return Rt(this,null,function*(){throw new Error("Not implemented: _writeToStorage")})}_readFromStorage(e){return Rt(this,null,function*(){throw new Error("Not implemented: _readFromStorage")})}reset(){return Rt(this,null,function*(){if(typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL"))throw new Error("Please use `about:config` to change preferences.");yield ie(this,Nl),en.setAll(ie(this,yu),!0),yield this._writeToStorage(ie(this,yu))})}set(e,n){return Rt(this,null,function*(){yield ie(this,Nl),en.setAll({[e]:n},!0),yield this._writeToStorage(typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL")?{[e]:en.get(e)}:en.getAll(Ft.PREFERENCE))})}get(e){return Rt(this,null,function*(){if(typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL"))throw new Error("Not implemented: get");return yield ie(this,Nl),en.get(e)})}get initializedPromise(){return ie(this,Nl)}};yu=new WeakMap,Nl=new WeakMap;let Nx=rk;const gp=class gp{constructor({lang:e,isRTL:n},a=null){Ae(this,lm,void 0);Ae(this,pp,new Set);Ae(this,hp,void 0);Ae(this,rr,void 0);var i,s;it(this,hp,Se(i=gp,Mw,hI).call(i,e)),it(this,rr,a),it(this,lm,(n!=null?n:Se(s=gp,Fw,gI).call(s,ie(this,hp)))?"rtl":"ltr")}_setL10n(e){it(this,rr,e),typeof PDFJSDev!="undefined"&&PDFJSDev.test("TESTING")&&(document.l10n=e)}getLanguage(){return ie(this,hp)}getDirection(){return ie(this,lm)}get(e,n=null,a){return Rt(this,null,function*(){var s;return Array.isArray(e)?(e=e.map(o=>({id:o})),(yield ie(this,rr).formatMessages(e)).map(o=>o.value)):((s=(yield ie(this,rr).formatMessages([{id:e,args:n}]))[0])==null?void 0:s.value)||a})}translate(e){return Rt(this,null,function*(){ie(this,pp).add(e);try{ie(this,rr).connectRoot(e),yield ie(this,rr).translateRoots()}catch(n){}})}translateOnce(e){return Rt(this,null,function*(){try{yield ie(this,rr).translateElements([e])}catch(n){console.error(`translateOnce: "${n}".`)}})}destroy(){return Rt(this,null,function*(){for(const e of ie(this,pp))ie(this,rr).disconnectRoot(e);ie(this,pp).clear(),ie(this,rr).pauseObserving()})}pause(){ie(this,rr).pauseObserving()}resume(){ie(this,rr).resumeObserving()}};lm=new WeakMap,pp=new WeakMap,hp=new WeakMap,rr=new WeakMap,Mw=new WeakSet,hI=function(e){return e=(e==null?void 0:e.toLowerCase())||"en-us",{en:"en-us",es:"es-es",fy:"fy-nl",ga:"ga-ie",gu:"gu-in",hi:"hi-in",hy:"hy-am",nb:"nb-no",ne:"ne-np",nn:"nn-no",pa:"pa-in",pt:"pt-pt",sv:"sv-se",zh:"zh-cn"}[e]||e},Fw=new WeakSet,gI=function(e){const n=e.split("-",1)[0];return["ar","he","fa","ps","ur"].includes(n)},Ae(gp,Mw),Ae(gp,Fw);let Bx=gp;const Dz=null;class l4 extends Bx{constructor(e){super({lang:e}),this._setL10n({formatMessages:n=>new Promise(a=>{let i=window.siyuan.languages[n[0].id]||n[0].id;n[0].args&&Object.keys(n[0].args).forEach(s=>{i=i.replace("${"+s+"}",n[0].args[s])}),a([{value:i}])}),connectRoot:()=>{},translateRoots:()=>{},translateElements:()=>{},disconnectRoot:()=>{},pauseObserving:()=>{},resumeObserving:()=>{}})}}function Cz(t){return Rt(this,null,function*(){const e="",n=e.split("#",1)[0];let{info:a,metadata:i,contentDispositionFilename:s,contentLength:r}=yield t.getMetadata();if(!r){const{length:o}=yield t.getDownloadInfo();r=o}return ld(Ys({},a),{baseURL:n,filesize:r,filename:s||getPdfFilenameFromUrl(e),metadata:i==null?void 0:i.getRaw(),authors:i==null?void 0:i.get("dc:creator"),numPages:t.numPages,URL:e})})}class c4{constructor(e){this._ready=new Promise((n,a)=>{})}createSandbox(e){return Rt(this,null,function*(){(yield this._ready).create(e)})}dispatchEventInSandbox(e){return Rt(this,null,function*(){const n=yield this._ready;setTimeout(()=>n.dispatchEvent(e),0)})}destroySandbox(){return Rt(this,null,function*(){(yield this._ready).nukeSandbox()})}}if(typeof PDFJSDev!="undefined"&&!PDFJSDev.test("GENERIC"))throw new Error('Module "pdfjs-web/genericcom" shall not be used outside GENERIC build.');function Lz(t){}class d4 extends Nx{_writeToStorage(e){return Rt(this,null,function*(){localStorage.setItem("pdfjs.preferences",JSON.stringify(e))})}_readFromStorage(e){return Rt(this,null,function*(){return{prefs:JSON.parse(localStorage.getItem("pdfjs.preferences"))}})}}class u4 extends Px{createL10n(){return Rt(this,null,function*(){var e;return new l4((e=en.get("localeProperties"))==null?void 0:e.lang)})}createScripting(){return new c4(en.get("sandboxBundleSrc"))}}class x_{isEnabledFor(e){return Rt(this,null,function*(){return!1})}deleteModel(e){return Rt(this,null,function*(){return null})}isReady(e){return!1}guess(e){}toggleService(e,n){}static getFakeMLManager(e){return new f4(e)}}class f4{constructor({enableGuessAltText:e,enableAltTextModelDownload:n}){ty(this,"eventBus",null);ty(this,"hasProgress",!1);this.enableGuessAltText=e,this.enableAltTextModelDownload=n}setEventBus(e,n){this.eventBus=e}isEnabledFor(e){return Rt(this,null,function*(){return this.enableGuessAltText})}deleteModel(e){return Rt(this,null,function*(){return this.enableAltTextModelDownload=!1,null})}loadModel(e){return Rt(this,null,function*(){})}downloadModel(e){return Rt(this,null,function*(){this.hasProgress=!0;const{promise:n,resolve:a}=Promise.withResolvers(),i=1e8,s=1.5*i,r=5e6;let o=0;const l=setInterval(()=>{if(o+=r,o<=s){this.eventBus.dispatch("loadaiengineprogress",{source:this,detail:{total:i,totalLoaded:o,finished:o+r>=s}});return}clearInterval(l),this.hasProgress=!1,this.enableAltTextModelDownload=!0,a(!0)},900);return n})}isReady(e){return this.enableAltTextModelDownload}guess({request:{data:e}}){return new Promise(n=>{setTimeout(()=>{n(e?{output:"Fake alt text"}:{error:!0})},3e3)})}toggleService(e,n){this.enableGuessAltText=n}}class Iz{constructor({descriptionContainer:e,dialog:n,imagePreview:a,cancelButton:i,disclaimer:s,notNowButton:r,saveButton:o,textarea:l,learnMore:c,errorCloseButton:d,createAutomaticallyButton:u,downloadModel:g,downloadModelDescription:f,title:h},m,b){Ae(this,Bl);Ae(this,vp);Ae(this,xu);Ae(this,Pw);Ae(this,ym);Ae(this,Zr);Ae(this,Nw);Ae(this,_m);Ae(this,Bw);Ae(this,$w);Ae(this,xp);Ae(this,wm);Ae(this,Ow);Ae(this,cm,Se(this,$w,_I).bind(this));Ae(this,dm,void 0);Ae(this,Pi,null);Ae(this,um,void 0);Ae(this,fm,void 0);Ae(this,nl,void 0);Ae(this,pm,void 0);Ae(this,_u,void 0);Ae(this,wu,void 0);Ae(this,mp,void 0);Ae(this,Mc,!1);Ae(this,Cr,void 0);Ae(this,hm,null);Ae(this,gm,null);Ae(this,bp,void 0);Ae(this,yp,void 0);Ae(this,Xr,!1);Ae(this,_p,!1);Ae(this,wp,void 0);Ae(this,mm,void 0);Ae(this,Fc,void 0);Ae(this,Lr,void 0);Ae(this,bm,void 0);Ae(this,bi,void 0);Ae(this,vu,null);it(this,um,i),it(this,dm,u),it(this,fm,e),it(this,nl,n),it(this,pm,s),it(this,mm,r),it(this,bp,a),it(this,Lr,l),it(this,wp,c),it(this,bm,h),it(this,_u,g),it(this,wu,f),it(this,Fc,m),it(this,mp,b),n.addEventListener("close",Se(this,wm,pk).bind(this)),n.addEventListener("contextmenu",y=>{y.target!==ie(this,Lr)&&y.preventDefault()}),i.addEventListener("click",ie(this,cm)),r.addEventListener("click",ie(this,cm)),o.addEventListener("click",Se(this,Ow,wI).bind(this)),d.addEventListener("click",()=>{Se(this,vp,X0).call(this,!1)}),u.addEventListener("click",()=>Rt(this,null,function*(){const y=u.getAttribute("aria-pressed")!=="true";ie(this,Pi)._reportTelemetry({action:"pdfjs.image.alt_text.ai_generation_check",data:{status:y}}),ie(this,bi)&&(ie(this,bi).setPreference("enableGuessAltText",y),yield ie(this,bi).mlManager.toggleService("altText",y)),Se(this,xu,ny).call(this,y,!1)})),l.addEventListener("focus",()=>{it(this,_p,ie(this,Xr)),Se(this,Bl,nf).call(this,!1),Se(this,Zr,fl).call(this)}),l.addEventListener("blur",()=>{l.value||Se(this,Bl,nf).call(this,ie(this,_p)),Se(this,Zr,fl).call(this)}),l.addEventListener("input",()=>{Se(this,Zr,fl).call(this)}),b._on("enableguessalttext",({value:y})=>{Se(this,xu,ny).call(this,y,!1)}),ie(this,Fc).register(n),ie(this,wp).addEventListener("click",()=>{ie(this,Pi)._reportTelemetry({action:"pdfjs.image.alt_text.info",data:{topic:"alt_text"}})})}editAltText(e,n,a){return Rt(this,null,function*(){var f;if(ie(this,Pi)||!n)return;if(a&&n.hasAltTextData()){n.altTextFinish();return}it(this,Mc,a);let{mlManager:i}=e,s=!!i;Se(this,Zr,fl).call(this),i&&!i.isReady("altText")?(s=!1,i.hasProgress?Se(this,Bw,yI).call(this):i=null):ie(this,_u).classList.toggle("hidden",!0);const r=i==null?void 0:i.isEnabledFor("altText");it(this,Pi,n),it(this,bi,e),ie(this,bi).removeEditListeners(),{altText:K0(this,vu)._}=n.altTextData,ie(this,Lr).value=(f=ie(this,vu))!=null?f:"";const o=224,l=180;let c,d,u;i?({canvas:c,width:d,height:u,imageData:K0(this,yp)._}=n.copyCanvas(o,l,!0),s&&Se(this,xu,ny).call(this,yield r,!0)):{canvas:c,width:d,height:u}=n.copyCanvas(o,l,!1),c.setAttribute("role","presentation");const{style:g}=c;g.width=`${d}px`,g.height=`${u}px`,ie(this,bp).append(c),Se(this,Pw,mI).call(this),Se(this,ym,uk).call(this,s),Se(this,vp,X0).call(this,!1);try{yield ie(this,Fc).open(ie(this,nl))}catch(h){throw Se(this,wm,pk).call(this),h}})}destroy(){it(this,bi,null),Se(this,xp,Z0).call(this)}}cm=new WeakMap,dm=new WeakMap,Pi=new WeakMap,um=new WeakMap,fm=new WeakMap,nl=new WeakMap,pm=new WeakMap,_u=new WeakMap,wu=new WeakMap,mp=new WeakMap,Mc=new WeakMap,Cr=new WeakMap,hm=new WeakMap,gm=new WeakMap,bp=new WeakMap,yp=new WeakMap,Xr=new WeakMap,_p=new WeakMap,wp=new WeakMap,mm=new WeakMap,Fc=new WeakMap,Lr=new WeakMap,bm=new WeakMap,bi=new WeakMap,vu=new WeakMap,Bl=new WeakSet,nf=function(e){!ie(this,bi)||ie(this,Xr)===e||(it(this,Xr,e),ie(this,fm).classList.toggle("loading",e))},vp=new WeakSet,X0=function(e){ie(this,bi)&&ie(this,nl).classList.toggle("error",e)},xu=new WeakSet,ny=function(e,n=!1){return Rt(this,null,function*(){if(ie(this,bi))if(ie(this,nl).classList.toggle("aiDisabled",!e),ie(this,dm).setAttribute("aria-pressed",e),e){const{altTextLearnMoreUrl:a}=ie(this,bi).mlManager;a&&(ie(this,wp).href=a),Se(this,Nw,bI).call(this,n)}else Se(this,Bl,nf).call(this,!1),it(this,Xr,!1),Se(this,Zr,fl).call(this)})},Pw=new WeakSet,mI=function(){ie(this,mm).classList.toggle("hidden",!ie(this,Mc)),ie(this,um).classList.toggle("hidden",ie(this,Mc))},ym=new WeakSet,uk=function(e){!ie(this,bi)||ie(this,hm)===e||(it(this,hm,e),ie(this,nl).classList.toggle("noAi",!e),Se(this,Zr,fl).call(this))},Zr=new WeakSet,fl=function(){const e=ie(this,Xr)||ie(this,Cr)&&ie(this,Cr)===ie(this,Lr).value;ie(this,pm).hidden=!e;const n=ie(this,Xr)||!!ie(this,Lr).value;ie(this,gm)!==n&&(it(this,gm,n),ie(this,bm).setAttribute("data-l10n-id",n?"pdfjs-editor-new-alt-text-dialog-edit-label":"pdfjs-editor-new-alt-text-dialog-add-label"))},Nw=new WeakSet,bI=function(e){return Rt(this,null,function*(){if(ie(this,Xr)||ie(this,Lr).value||e&&ie(this,vu)!==null)return;if(it(this,Cr,ie(this,Pi).guessedAltText),ie(this,vu)===null&&ie(this,Cr)){Se(this,_m,fk).call(this,ie(this,Cr));return}Se(this,Bl,nf).call(this,!0),Se(this,Zr,fl).call(this);let n=!1;try{const a=yield ie(this,Pi).mlGuessAltText(ie(this,yp),!1);a&&(it(this,Cr,a),it(this,_p,ie(this,Xr)),ie(this,Xr)&&Se(this,_m,fk).call(this,a))}catch(a){console.error(a),n=!0}Se(this,Bl,nf).call(this,!1),Se(this,Zr,fl).call(this),n&&ie(this,bi)&&Se(this,vp,X0).call(this,!0)})},_m=new WeakSet,fk=function(e){!ie(this,bi)||ie(this,Lr).value||(ie(this,Lr).value=e,Se(this,Zr,fl).call(this))},Bw=new WeakSet,yI=function(){ie(this,_u).classList.toggle("hidden",!1);const e=s=>Rt(this,[s],function*({detail:{finished:n,total:a,totalLoaded:i}}){i=Math.min(.99*a,i);const o=ie(this,wu).ariaValueMax=Math.round(a/1e6),l=ie(this,wu).ariaValueNow=Math.round(i/1e6);if(ie(this,wu).setAttribute("data-l10n-args",JSON.stringify({totalSize:o,downloadedSize:l})),!n||(ie(this,mp)._off("loadaiengineprogress",e),ie(this,_u).classList.toggle("hidden",!0),Se(this,ym,uk).call(this,!0),!ie(this,bi)))return;const{mlManager:c}=ie(this,bi);c.toggleService("altText",!0),Se(this,xu,ny).call(this,yield c.isEnabledFor("altText"),!0)});ie(this,mp)._on("loadaiengineprogress",e)},$w=new WeakSet,_I=function(){ie(this,Pi).altTextData={cancel:!0};const e=ie(this,Lr).value.trim();ie(this,Pi)._reportTelemetry({action:"pdfjs.image.alt_text.dismiss",data:{alt_text_type:e?"present":"empty",flow:ie(this,Mc)?"image_add":"alt_text_edit"}}),ie(this,Pi)._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!0,alt_text_type:"skipped"}}),Se(this,xp,Z0).call(this)},xp=new WeakSet,Z0=function(){ie(this,Fc).active===ie(this,nl)&&ie(this,Fc).close(ie(this,nl))},wm=new WeakSet,pk=function(){var n,a;const e=ie(this,bp).firstChild;e.remove(),e.width=e.height=0,it(this,yp,null),Se(this,Bl,nf).call(this,!1),(n=ie(this,bi))==null||n.addEditListeners(),ie(this,Pi).altTextFinish(),(a=ie(this,bi))==null||a.setSelected(ie(this,Pi)),it(this,Pi,null),it(this,bi,null)},Ow=new WeakSet,wI=function(){const e=ie(this,Lr).value.trim();if(ie(this,Pi).altTextData={altText:e,decorative:!1},ie(this,Pi).altTextData.guessedAltText=ie(this,Cr),ie(this,Cr)&&ie(this,Cr)!==e){const n=new Set(ie(this,Cr).split(/\s+/)),a=new Set(e.split(/\s+/));ie(this,Pi)._reportTelemetry({action:"pdfjs.image.alt_text.user_edit",data:{total_words:n.size,words_removed:n.difference(a).size,words_added:a.difference(n).size}})}ie(this,Pi)._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!0,alt_text_type:e?"present":"empty"}}),ie(this,Pi)._reportTelemetry({action:"pdfjs.image.alt_text.save",data:{alt_text_type:e?"present":"empty",flow:ie(this,Mc)?"image_add":"alt_text_edit"}}),Se(this,xp,Z0).call(this)};class Mz{constructor({dialog:e,createModelButton:n,aiModelSettings:a,learnMore:i,closeButton:s,deleteModelButton:r,downloadModelButton:o,showAltTextDialogButton:l},c,d,u){Ae(this,Au);Ae(this,xm);Ae(this,Em);Ae(this,km);Ae(this,Bc);Ae(this,Rw);Ae(this,Eu,void 0);Ae(this,al,void 0);Ae(this,ku,void 0);Ae(this,Su,void 0);Ae(this,Ep,void 0);Ae(this,Pc,void 0);Ae(this,Nc,void 0);Ae(this,vm,void 0);it(this,Su,e),it(this,Eu,a),it(this,al,n),it(this,ku,o),it(this,vm,l),it(this,Nc,c),it(this,Ep,d),it(this,Pc,u);const{altTextLearnMoreUrl:g}=u;g&&(i.href=g),e.addEventListener("contextmenu",noContextMenu),n.addEventListener("click",f=>Rt(this,null,function*(){const h=Se(this,km,mk).call(this,"enableGuessAltText",f);yield u.toggleService("altText",h),Se(this,Au,ay).call(this,{type:"stamp",action:"pdfjs.image.alt_text.settings_ai_generation_check",data:{status:h}})})),l.addEventListener("click",f=>{const h=Se(this,km,mk).call(this,"enableNewAltTextWhenAddingImage",f);Se(this,Au,ay).call(this,{type:"stamp",action:"pdfjs.image.alt_text.settings_edit_alt_text_check",data:{status:h}})}),r.addEventListener("click",Se(this,Em,gk).bind(this,!0)),o.addEventListener("click",Se(this,xm,hk).bind(this,!0)),s.addEventListener("click",Se(this,Rw,vI).bind(this)),i.addEventListener("click",()=>{Se(this,Au,ay).call(this,{type:"stamp",action:"pdfjs.image.alt_text.info",data:{topic:"ai_generation"}})}),d._on("enablealttextmodeldownload",({value:f})=>{f?Se(this,xm,hk).call(this,!1):Se(this,Em,gk).call(this,!1)}),ie(this,Nc).register(e)}open(a){return Rt(this,arguments,function*({enableGuessAltText:e,enableNewAltTextWhenAddingImage:n}){const{enableAltTextModelDownload:i}=ie(this,Pc);ie(this,al).disabled=!i,ie(this,al).setAttribute("aria-pressed",i&&e),ie(this,vm).setAttribute("aria-pressed",n),ie(this,Eu).classList.toggle("download",!i),yield ie(this,Nc).open(ie(this,Su)),Se(this,Au,ay).call(this,{type:"stamp",action:"pdfjs.image.alt_text.settings_displayed"})})}}Eu=new WeakMap,al=new WeakMap,ku=new WeakMap,Su=new WeakMap,Ep=new WeakMap,Pc=new WeakMap,Nc=new WeakMap,vm=new WeakMap,Au=new WeakSet,ay=function(e){ie(this,Ep).dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})},xm=new WeakSet,hk=function(e=!1){return Rt(this,null,function*(){if(e){ie(this,ku).disabled=!0;const n=ie(this,ku).firstChild;n.setAttribute("data-l10n-id","pdfjs-editor-alt-text-settings-downloading-model-button"),yield ie(this,Pc).downloadModel("altText"),n.setAttribute("data-l10n-id","pdfjs-editor-alt-text-settings-download-model-button"),ie(this,al).disabled=!1,Se(this,Bc,nh).call(this,"enableGuessAltText",!0),ie(this,Pc).toggleService("altText",!0),Se(this,Bc,nh).call(this,"enableAltTextModelDownload",!0),ie(this,ku).disabled=!1}ie(this,Eu).classList.toggle("download",!1),ie(this,al).setAttribute("aria-pressed",!0)})},Em=new WeakSet,gk=function(e=!1){return Rt(this,null,function*(){e&&(yield ie(this,Pc).deleteModel("altText"),Se(this,Bc,nh).call(this,"enableGuessAltText",!1),Se(this,Bc,nh).call(this,"enableAltTextModelDownload",!1)),ie(this,Eu).classList.toggle("download",!0),ie(this,al).disabled=!0,ie(this,al).setAttribute("aria-pressed",!1)})},km=new WeakSet,mk=function(e,{target:n}){const a=n.getAttribute("aria-pressed")!=="true";return Se(this,Bc,nh).call(this,e,a),n.setAttribute("aria-pressed",a),a},Bc=new WeakSet,nh=function(e,n){ie(this,Ep).dispatch("setpreference",{source:this,name:e,value:n})},Rw=new WeakSet,vI=function(){ie(this,Nc).active===ie(this,Su)&&ie(this,Nc).close(ie(this,Su))};class p4{constructor(e,n){Ae(this,Uw);this.eventBus=n,Se(this,Uw,xI).call(this,e)}}Uw=new WeakSet,xI=function({editorFreeTextFontSize:e,editorFreeTextColor:n,editorInkColor:a,editorInkThickness:i,editorInkOpacity:s,editorStampAddImage:r,editorFreeHighlightThickness:o,editorHighlightShowAll:l}){const c=(d,u)=>{this.eventBus.dispatch("switchannotationeditorparams",{source:this,type:Bt.AnnotationEditorParamsType[d],value:u})};e.addEventListener("input",function(){c("FREETEXT_SIZE",this.valueAsNumber)}),n.addEventListener("input",function(){c("FREETEXT_COLOR",this.value)}),a.addEventListener("input",function(){c("INK_COLOR",this.value)}),i.addEventListener("input",function(){c("INK_THICKNESS",this.valueAsNumber)}),s.addEventListener("input",function(){c("INK_OPACITY",this.valueAsNumber)}),r.addEventListener("click",()=>{this.eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{action:"pdfjs.image.add_image_click"}}}),c("CREATE")}),o.addEventListener("input",function(){c("HIGHLIGHT_THICKNESS",this.valueAsNumber)}),l.addEventListener("click",function(){const d=this.getAttribute("aria-pressed")==="true";this.setAttribute("aria-pressed",!d),c("HIGHLIGHT_SHOW_ALL",!d)}),this.eventBus._on("annotationeditorparamschanged",d=>{for(const[u,g]of d.details)switch(u){case Bt.AnnotationEditorParamsType.FREETEXT_SIZE:e.value=g;break;case Bt.AnnotationEditorParamsType.FREETEXT_COLOR:n.value=g;break;case Bt.AnnotationEditorParamsType.INK_COLOR:a.value=g;break;case Bt.AnnotationEditorParamsType.INK_THICKNESS:i.value=g;break;case Bt.AnnotationEditorParamsType.INK_OPACITY:s.value=g;break;case Bt.AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:o.value=g;break;case Bt.AnnotationEditorParamsType.HIGHLIGHT_FREE:o.disabled=!g;break;case Bt.AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL:l.setAttribute("aria-pressed",g);break}})};const E_=.1,Mm=class Mm{constructor(e,n,a,i){Ae(this,Tm);Ae(this,Dm);Ae(this,Hw);Ae(this,Cm);Ae(this,Im);Ae(this,Tu);Ae(this,qw);Ae(this,Sm,void 0);Ae(this,kp,0);Ae(this,Am,void 0);if(it(this,Sm,n),it(this,Am,a),!i)return;it(this,kp,i.getBoundingClientRect().height);const s=new ResizeObserver(r=>{for(const o of r)if(o.target===i){it(this,kp,Math.floor(o.borderBoxSize[0].blockSize));break}});s.observe(i),e.addEventListener("abort",()=>s.disconnect(),{once:!0})}moveCaret(e,n){const a=document.getSelection();if(a.rangeCount===0)return;const{focusNode:i}=a,s=i.nodeType!==Node.ELEMENT_NODE?i.parentElement:i,r=s.closest(".textLayer");if(!r)return;const o=document.createTreeWalker(r,NodeFilter.SHOW_TEXT);o.currentNode=i;const l=s.getBoundingClientRect();let c=null;const d=(e?o.previousSibling:o.nextSibling).bind(o);for(;d();){const h=o.currentNode.parentElement;if(!Se(this,Tm,bk).call(this,l,h.getBoundingClientRect())){c=h;break}}if(!c){const h=Se(this,qw,kI).call(this,r,e);if(!h)return;if(n){const y=(e?o.firstChild():o.lastChild())||i;a.extend(y,e?0:y.length);const _=document.createRange();_.setStart(h,e?h.length:0),_.setEnd(h,e?h.length:0),a.addRange(_);return}const[m]=Se(this,Cm,_k).call(this,a,e),{parentElement:b}=h;Se(this,Tu,iy).call(this,n,a,b,b.getBoundingClientRect(),m);return}const[u,g]=Se(this,Cm,_k).call(this,a,e),f=c.getBoundingClientRect();if(Se(this,Dm,yk).call(this,f,u,g,e)){Se(this,Tu,iy).call(this,n,a,c,f,u);return}for(;d();){const h=o.currentNode.parentElement,m=h.getBoundingClientRect();if(!Se(this,Tm,bk).call(this,f,m))break;if(Se(this,Dm,yk).call(this,m,u,g,e)){Se(this,Tu,iy).call(this,n,a,h,m,u);return}}Se(this,Tu,iy).call(this,n,a,c,f,u)}};Sm=new WeakMap,kp=new WeakMap,Am=new WeakMap,Tm=new WeakSet,bk=function(e,n){const a=e.y,i=e.bottom,s=e.y+e.height/2,r=n.y,o=n.bottom,l=n.y+n.height/2;return a<=l&&l<=i||r<=s&&s<=o},Dm=new WeakSet,yk=function(e,n,a,i){const s=e.y+e.height/2;return(i?a>=s:a<=s)&&e.x-E_<=n&&n<=e.right+E_},Hw=new WeakSet,EI=function(e){return e.top>=ie(this,kp)&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},Cm=new WeakSet,_k=function(e,n){const{focusNode:a,focusOffset:i}=e,s=document.createRange();s.setStart(a,i),s.setEnd(a,i);const r=s.getBoundingClientRect();return[r.x,n?r.top:r.bottom]},Lm=new WeakSet,wk=function(e,n){if((typeof PDFJSDev=="undefined"||!PDFJSDev.test("MOZCENTRAL"))&&!document.caretPositionFromPoint){const{startContainer:a,startOffset:i}=document.caretRangeFromPoint(e,n);return{offsetNode:a,offset:i}}return document.caretPositionFromPoint(e,n)},Im=new WeakSet,vk=function(e,n,a,i,s){var c,d,u,g;if(s||(s=i.getBoundingClientRect()),n<=s.x+E_){a?e.extend(i.firstChild,0):e.setPosition(i.firstChild,0);return}if(s.right-E_<=n){const{lastChild:f}=i;a?e.extend(f,f.length):e.setPosition(f,f.length);return}const r=s.y+s.height/2;let o=Se(c=Mm,Lm,wk).call(c,n,r),l=(d=o.offsetNode)==null?void 0:d.parentElement;if(l&&l!==i){const f=document.elementsFromPoint(n,r),h=[];for(const m of f){if(m===i)break;const{style:b}=m;h.push([m,b.visibility]),b.visibility="hidden"}o=Se(u=Mm,Lm,wk).call(u,n,r),l=(g=o.offsetNode)==null?void 0:g.parentElement;for(const[m,b]of h)m.style.visibility=b}if(l!==i){a?e.extend(i.firstChild,0):e.setPosition(i.firstChild,0);return}a?e.extend(o.offsetNode,o.offset):e.setPosition(o.offsetNode,o.offset)},Tu=new WeakSet,iy=function(e,n,a,i,s){if(Se(this,Hw,EI).call(this,i)){Se(this,Im,vk).call(this,n,s,e,a,i);return}ie(this,Sm).addEventListener("scrollend",Se(this,Im,vk).bind(this,n,s,e,a,null),{once:!0}),a.scrollIntoView()},qw=new WeakSet,kI=function(e,n){for(;;){const a=e.closest(".page"),i=parseInt(a.getAttribute("data-page-number")),s=n?i-1:i+1;if(e=ie(this,Am).querySelector(`.page[data-page-number="${s}"] .textLayer`),!e)return null;const r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),o=n?r.lastChild():r.firstChild();if(o)return o}},Ae(Mm,Lm);let $x=Mm;if(typeof PDFJSDev!="undefined"&&!PDFJSDev.test("CHROME || GENERIC"))throw new Error('Module "pdfjs-web/download_manager" shall not be used outside CHROME and GENERIC builds.');function ZA(t,e){const n=document.createElement("a");if(!n.click)throw new Error('DownloadManager: "a.click()" is not supported.');n.href=t,n.target="_parent","download"in n&&(n.download=e),(document.body||document.documentElement).append(n),n.click(),n.remove()}class h4{constructor(){Ae(this,Sp,new WeakMap)}downloadData(e,n,a){const i=URL.createObjectURL(new Blob([e],{type:a}));ZA(i,n)}openOrDownloadData(e,n,a=null){const i=(0,Bt.isPdfFile)(n),s=i?"application/pdf":"";if((typeof PDFJSDev=="undefined"||!PDFJSDev.test("COMPONENTS"))&&i){let r=ie(this,Sp).get(e);r||(r=URL.createObjectURL(new Blob([e],{type:s})),ie(this,Sp).set(e,r));let o;typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC")?o="?file="+encodeURIComponent(r+"#"+n):PDFJSDev.test("CHROME")&&(o=chrome.runtime.getURL("/content/web/viewer.html")+"?file="+encodeURIComponent(r+"#"+n)),a&&(o+=`#${escape(a)}`);try{return window.open(o),!0}catch(l){console.error(`openOrDownloadData: ${l}`),URL.revokeObjectURL(r),ie(this,Sp).delete(e)}}return this.downloadData(e,n,s),!1}download(e,n,a){let i;if(e)i=URL.createObjectURL(new Blob([e],{type:"application/pdf"}));else{if(!(0,Bt.createValidAbsoluteUrl)(n,"http://example.com")){console.error(`download - not a valid URL: ${n}`);return}i=n+"#pdfjs.action=download"}ZA(i,a)}}Sp=new WeakMap;class g4{constructor(){Ae(this,$c,new WeakMap);Ae(this,Jr,null)}get active(){return ie(this,Jr)}register(e,n=!1){return Rt(this,null,function*(){if(typeof e!="object")throw new Error("Not enough parameters.");if(ie(this,$c).has(e))throw new Error("The overlay is already registered.");ie(this,$c).set(e,{canForceClose:n}),e.addEventListener("cancel",a=>{it(this,Jr,null)})})}open(e){return Rt(this,null,function*(){if(ie(this,$c).has(e)){if(ie(this,Jr)){if(ie(this,Jr)===e)throw new Error("The overlay is already active.");if(ie(this,$c).get(e).canForceClose)yield this.close();else throw new Error("Another overlay is currently active.")}}else throw new Error("The overlay does not exist.");it(this,Jr,e),e.classList.add("dialog--open")})}close(){return Rt(this,arguments,function*(e=ie(this,Jr)){if(ie(this,$c).has(e))if(ie(this,Jr)){if(ie(this,Jr)!==e)throw new Error("Another overlay is currently active.")}else throw new Error("The overlay is currently not active.");else throw new Error("The overlay does not exist.");e.classList.remove("dialog--open"),it(this,Jr,null)})}}$c=new WeakMap,Jr=new WeakMap;class m4{constructor(e,n,a=!1){Ae(this,Pm);Ae(this,Ww);Ae(this,Nm);Ae(this,$l,null);Ae(this,Du,null);Ae(this,Fm,null);this.dialog=e.dialog,this.label=e.label,this.input=e.input,this.submitButton=e.submitButton,this.cancelButton=e.cancelButton,this.overlayManager=n,this._isViewerEmbedded=a,this.submitButton.addEventListener("click",Se(this,Pm,xk).bind(this)),this.cancelButton.addEventListener("click",this.close.bind(this)),this.input.addEventListener("keydown",i=>{i.keyCode===13&&Se(this,Pm,xk).call(this)}),this.overlayManager.register(this.dialog,!0),this.dialog.addEventListener("close",Se(this,Ww,SI).bind(this))}open(){return Rt(this,null,function*(){var n;yield(n=ie(this,$l))==null?void 0:n.promise,it(this,$l,Promise.withResolvers());try{yield this.overlayManager.open(this.dialog)}catch(a){throw ie(this,$l).resolve(),a}const e=ie(this,Fm)===Bt.PasswordResponses.INCORRECT_PASSWORD;(!this._isViewerEmbedded||e)&&this.input.focus(),this.label.textContent=window.siyuan.languages[`password_${e?"invalid":"label"}`]})}close(){return Rt(this,null,function*(){this.overlayManager.active===this.dialog&&this.overlayManager.close(this.dialog)})}setUpdateCallback(e,n){return Rt(this,null,function*(){ie(this,$l)&&(yield ie(this,$l).promise),it(this,Du,e),it(this,Fm,n)})}}$l=new WeakMap,Du=new WeakMap,Fm=new WeakMap,Pm=new WeakSet,xk=function(){const e=this.input.value;(e==null?void 0:e.length)>0&&Se(this,Nm,Ek).call(this,e)},Ww=new WeakSet,SI=function(){Se(this,Nm,Ek).call(this,new Error("PasswordPrompt cancelled.")),ie(this,$l).resolve()},Nm=new WeakSet,Ek=function(e){ie(this,Du)&&(this.close(),this.input.value="",ie(this,Du).call(this,e),it(this,Du,null))};const b4=-100,JA="selected";class rg{constructor(e){if((typeof PDFJSDev=="undefined"||PDFJSDev.test("TESTING"))&&this.constructor===rg)throw new Error("Cannot initialize BaseTreeViewer.");this.container=e.container,this.eventBus=e.eventBus,this._l10n=e.l10n,this.reset()}reset(){this._pdfDocument=null,this._lastToggleIsShow=!0,this._currentTreeItem=null,this.container.textContent="",this.container.classList.remove("treeWithDeepNesting")}_dispatchEvent(e){throw new Error("Not implemented: _dispatchEvent")}_bindLink(e,n){throw new Error("Not implemented: _bindLink")}_normalizeTextContent(e){return qf(e,!0)||"\u2013"}_addToggleButton(e,n=!1){const a=document.createElement("div");a.innerHTML='<svg><use xlink:href="#iconDown"></use></svg>',a.className="treeItemToggler",n&&a.classList.add("treeItemsHidden"),a.onclick=i=>{if(i.stopPropagation(),a.classList.toggle("treeItemsHidden"),i.shiftKey){const s=!a.classList.contains("treeItemsHidden");this._toggleTreeItem(e,s)}},e.prepend(a)}_toggleTreeItem(e,n=!1){this._l10n.pause(),this._lastToggleIsShow=n;for(const a of e.querySelectorAll(".treeItemToggler"))a.classList.toggle("treeItemsHidden",!n);this._l10n.resume()}_toggleAllTreeItems(){this._toggleTreeItem(this.container,!this._lastToggleIsShow)}_finishRendering(e,n,a=!1){a&&(this.container.classList.add("treeWithDeepNesting"),this._lastToggleIsShow=!e.querySelector(".treeItemsHidden")),this._l10n.pause(),this.container.append(e),this._l10n.resume(),this._dispatchEvent(n)}render(e){throw new Error("Not implemented: render")}_updateCurrentTreeItem(e=null){this._currentTreeItem&&(this._currentTreeItem.classList.remove(JA),this._currentTreeItem=null),e&&(e.classList.add(JA),this._currentTreeItem=e)}_scrollToCurrentTreeItem(e){if(!e)return;this._l10n.pause();let n=e.parentNode;for(;n&&n!==this.container;){if(n.classList.contains("treeItem")){const a=n.firstElementChild;a==null||a.classList.remove("treeItemsHidden")}n=n.parentNode}this._l10n.resume(),this._updateCurrentTreeItem(e),this.container.scrollTo(e.offsetLeft,e.offsetTop+b4)}}class y4 extends rg{constructor(n){super(n);Ae(this,Vw);this.downloadManager=n.downloadManager,this.eventBus._on("fileattachmentannotation",Se(this,Vw,AI).bind(this))}reset(n=!1){super.reset(),this._attachments=null,n||(this._renderedCapability=Promise.withResolvers()),this._pendingDispatchEvent=!1}_dispatchEvent(n){return Rt(this,null,function*(){this._renderedCapability.resolve(),!(n===0&&!this._pendingDispatchEvent&&(this._pendingDispatchEvent=!0,yield XA({target:this.eventBus,name:"annotationlayerrendered",delay:1e3}),!this._pendingDispatchEvent))&&(this._pendingDispatchEvent=!1,this.eventBus.dispatch("attachmentsloaded",{source:this,attachmentsCount:n}))})}_bindLink(n,{content:a,description:i,filename:s}){i&&(n.title=i),n.onclick=()=>(this.downloadManager.openOrDownloadData(a,s),!1)}render({attachments:n,keepRenderedCapability:a=!1}){if(this._attachments&&this.reset(a),this._attachments=n||null,!n){this._dispatchEvent(0);return}const i=document.createDocumentFragment();let s=0;for(const r in n){const o=n[r],l=document.createElement("div");l.className="treeItem";const c=document.createElement("a");this._bindLink(c,o),c.textContent=this._normalizeTextContent(o.filename),l.append(c),i.append(l),s++}this._finishRendering(i,s)}}Vw=new WeakSet,AI=function(n){const a=this._renderedCapability.promise;a.then(()=>{if(a!==this._renderedCapability.promise)return;const i=this._attachments||Object.create(null);for(const s in i)if(n.filename===s)return;i[n.filename]=n,this.render({attachments:i,keepRenderedCapability:!0})})};const QA="grab-to-pan-grab";class _4{constructor({element:e}){Ae(this,zw);Ae(this,Yw);Ae(this,Gw);this.element=e,this.document=e.ownerDocument,this.activate=this.activate.bind(this),this.deactivate=this.deactivate.bind(this),this.toggle=this.toggle.bind(this),this._onMouseDown=Se(this,zw,TI).bind(this),this._onMouseMove=Se(this,Yw,DI).bind(this),this._endPan=Se(this,Gw,CI).bind(this);const n=this.overlay=document.createElement("div");n.className="grab-to-pan-grabbing"}activate(){this.active||(this.active=!0,this.element.addEventListener("mousedown",this._onMouseDown,!0),this.element.classList.add(QA))}deactivate(){this.active&&(this.active=!1,this.element.removeEventListener("mousedown",this._onMouseDown,!0),this._endPan(),this.element.classList.remove(QA))}toggle(){this.active?this.deactivate():this.activate()}ignoreTarget(e){return e.matches("a[href], a[href] *, input, textarea, button, button *, select, option")}}zw=new WeakSet,TI=function(e){if(e.button!==0||this.ignoreTarget(e.target))return;if(e.originalTarget)try{e.originalTarget.tagName}catch(a){return}this.scrollLeftStart=this.element.scrollLeft,this.scrollTopStart=this.element.scrollTop,this.clientXStart=e.clientX,this.clientYStart=e.clientY,this.document.addEventListener("mousemove",this._onMouseMove,!0),this.document.addEventListener("mouseup",this._endPan,!0),this.element.addEventListener("scroll",this._endPan,!0),e.preventDefault(),e.stopPropagation();const n=document.activeElement;n&&!n.contains(e.target)&&n.blur()},Yw=new WeakSet,DI=function(e){if(this.element.removeEventListener("scroll",this._endPan,!0),!(e.buttons&1)){this._endPan();return}const n=e.clientX-this.clientXStart,a=e.clientY-this.clientYStart;this.element.scrollTo({top:this.scrollTopStart-a,left:this.scrollLeftStart-n,behavior:"instant"}),this.overlay.parentNode||document.body.append(this.overlay)},Gw=new WeakSet,CI=function(){this.element.removeEventListener("scroll",this._endPan,!0),this.document.removeEventListener("mousemove",this._onMouseMove,!0),this.document.removeEventListener("mouseup",this._endPan,!0),this.overlay.remove()};class w4{constructor({container:e,eventBus:n,cursorToolOnLoad:a=Os.SELECT}){Ae(this,Ap);Ae(this,jw);Ae(this,Oc,Os.SELECT);Ae(this,il,null);this.container=e,this.eventBus=n,Se(this,jw,LI).call(this),Promise.resolve().then(()=>{this.switchTool(a)})}get activeTool(){return ie(this,Oc)}switchTool(e){ie(this,il)===null&&Se(this,Ap,J0).call(this,e)}get _handTool(){return(0,Bt.shadow)(this,"_handTool",new _4({element:this.container}))}}Oc=new WeakMap,il=new WeakMap,Ap=new WeakSet,J0=function(e,n=!1){if(e===ie(this,Oc)){ie(this,il)!==null&&this.eventBus.dispatch("cursortoolchanged",{source:this,tool:e,disabled:n});return}const a=()=>{switch(ie(this,Oc)){case Os.SELECT:break;case Os.HAND:this._handTool.deactivate();break;case Os.ZOOM:}};switch(e){case Os.SELECT:a();break;case Os.HAND:a(),this._handTool.activate();break;case Os.ZOOM:default:console.error(`switchTool: "${e}" is an unsupported value.`);return}it(this,Oc,e),this.eventBus.dispatch("cursortoolchanged",{source:this,tool:e,disabled:n})},jw=new WeakSet,LI=function(){this.eventBus._on("switchcursortool",s=>{s.reset?ie(this,il)!==null&&(e=Bt.AnnotationEditorType.NONE,n=Oi.NORMAL,i()):this.switchTool(s.tool)});let e=Bt.AnnotationEditorType.NONE,n=Oi.NORMAL;const a=()=>{var s;(s=ie(this,il))!=null||it(this,il,ie(this,Oc)),Se(this,Ap,J0).call(this,Os.SELECT,!0)},i=()=>{ie(this,il)!==null&&e===Bt.AnnotationEditorType.NONE&&n===Oi.NORMAL&&(Se(this,Ap,J0).call(this,ie(this,il)),it(this,il,null))};this.eventBus._on("annotationeditormodechanged",({mode:s})=>{e=s,s===Bt.AnnotationEditorType.NONE?i():a()}),this.eventBus._on("presentationmodechanged",({state:s})=>{n=s,s===Oi.NORMAL?i():s===Oi.FULLSCREEN&&a()})};const v4=["en-us","en-lr","my"],x4={"8.5x11":"pdfjs-document-properties-page-size-name-letter","8.5x14":"pdfjs-document-properties-page-size-name-legal"},eT={"297x420":"pdfjs-document-properties-page-size-name-a-three","210x297":"pdfjs-document-properties-page-size-name-a-four"};function Ox(t,e,n){const a=e?t.width:t.height,i=e?t.height:t.width;return n[`${a}x${i}`]}class E4{constructor({dialog:e,fields:n,closeButton:a},i,s,r,o){Ae(this,Bm);Ae(this,Cu);Ae(this,$m);Ae(this,Kw);Ae(this,Om);Ae(this,Xw);Ae(this,Qr,null);this.dialog=e,this.fields=n,this.overlayManager=i,this.l10n=r,this._fileNameLookup=o,Se(this,Bm,kk).call(this),a.addEventListener("click",this.close.bind(this)),this.overlayManager.register(this.dialog),s._on("pagechanging",l=>{this._currentPageNumber=l.pageNumber}),s._on("rotationchanging",l=>{this._pagesRotation=l.pagesRotation})}open(){return Rt(this,null,function*(){yield Promise.all([this.overlayManager.open(this.dialog),this._dataAvailableCapability.promise]);const e=this._currentPageNumber,n=this._pagesRotation;if(ie(this,Qr)&&e===ie(this,Qr)._currentPageNumber&&n===ie(this,Qr)._pagesRotation){Se(this,Cu,sy).call(this);return}const{info:a,contentLength:i}=yield this.pdfDocument.getMetadata(),[s,r,o,l,c,d]=yield Promise.all([this._fileNameLookup(),Se(this,$m,Sk).call(this,i),Se(this,Om,Ak).call(this,a.CreationDate),Se(this,Om,Ak).call(this,a.ModDate),this.pdfDocument.getPage(e).then(f=>Se(this,Kw,II).call(this,JF(f),n)),Se(this,Xw,MI).call(this,a.IsLinearized)]);it(this,Qr,Object.freeze({fileName:s,fileSize:r,title:a.Title,author:a.Author,subject:a.Subject,keywords:a.Keywords,creationDate:o,modificationDate:l,creator:a.Creator,producer:a.Producer,version:a.PDFFormatVersion,pageCount:this.pdfDocument.numPages,pageSize:c,linearized:d,_currentPageNumber:e,_pagesRotation:n})),Se(this,Cu,sy).call(this);const{length:u}=yield this.pdfDocument.getDownloadInfo();if(i===u)return;const g=Object.assign(Object.create(null),ie(this,Qr));g.fileSize=yield Se(this,$m,Sk).call(this,u),it(this,Qr,Object.freeze(g)),Se(this,Cu,sy).call(this)})}close(){return Rt(this,null,function*(){this.overlayManager.close(this.dialog)})}setDocument(e){this.pdfDocument&&(Se(this,Bm,kk).call(this),Se(this,Cu,sy).call(this)),e&&(this.pdfDocument=e,this._dataAvailableCapability.resolve())}}Qr=new WeakMap,Bm=new WeakSet,kk=function(){this.pdfDocument=null,it(this,Qr,null),this._dataAvailableCapability=Promise.withResolvers(),this._currentPageNumber=1,this._pagesRotation=0},Cu=new WeakSet,sy=function(){var e;if(!(ie(this,Qr)&&this.overlayManager.active!==this.dialog))for(const n in this.fields){const a=(e=ie(this,Qr))==null?void 0:e[n];this.fields[n].textContent=a||a===0?a:"-"}},$m=new WeakSet,Sk=function(e=0){return Rt(this,null,function*(){const n=e/1024,a=n/1024;return n?a>=1?`${a.toPrecision(3)} MB ${e} bytes`:`${n.toPrecision(3)} KB ${e} bytes`:void 0})},Kw=new WeakSet,II=function(e,n){return Rt(this,null,function*(){if(!e)return;n%180!==0&&(e={width:e.height,height:e.width});const a=Lx(e),i=v4.includes(this.l10n.getLanguage());let s={width:Math.round(e.width*100)/100,height:Math.round(e.height*100)/100},r={width:Math.round(e.width*25.4*10)/10,height:Math.round(e.height*25.4*10)/10},o=Ox(s,a,x4)||Ox(r,a,eT);if(!o&&!(Number.isInteger(r.width)&&Number.isInteger(r.height))){const f={width:e.width*25.4,height:e.height*25.4},h={width:Math.round(r.width),height:Math.round(r.height)};Math.abs(f.width-h.width)<.1&&Math.abs(f.height-h.height)<.1&&(o=Ox(h,a,eT),o&&(s={width:Math.round(h.width/25.4*100)/100,height:Math.round(h.height/25.4*100)/100},r=h))}const[{width:l,height:c},d,u,g]=yield Promise.all([i?s:r,this.l10n.get(i?"unitInches":"unitMillimeters"),o&&this.l10n.get(o),this.l10n.get(a?"document_properties_page_size_orientation_portrait":"document_properties_page_size_orientation_landscape")]);return u?`${l.toLocaleString()} \xD7 ${c.toLocaleString()} ${d} (${u}, ${g})`:`${l.toLocaleString()} \xD7 ${c.toLocaleString()} ${d} (${g})`})},Om=new WeakSet,Ak=function(e){return Rt(this,null,function*(){const n=Bt.PDFDateString.toDateObject(e);return n?`${n.toLocaleDateString()}, ${n.toLocaleTimeString()}`:void 0})},Xw=new WeakSet,MI=function(e){return this.l10n.get(e?"Yes":"No")};const yo={SPACE:0,ALPHA_LETTER:1,PUNCT:2,HAN_LETTER:3,KATAKANA_LETTER:4,HIRAGANA_LETTER:5,HALFWIDTH_KATAKANA_LETTER:6,THAI_LETTER:7};function k4(t){return t<11904}function S4(t){return(t&65408)===0}function A4(t){return t>=97&&t<=122||t>=65&&t<=90}function T4(t){return t>=48&&t<=57}function D4(t){return t===32||t===9||t===13||t===10}function C4(t){return t>=13312&&t<=40959||t>=63744&&t<=64255}function L4(t){return t>=12448&&t<=12543}function I4(t){return t>=12352&&t<=12447}function M4(t){return t>=65376&&t<=65439}function F4(t){return(t&65408)===3584}function k_(t){return k4(t)?S4(t)?D4(t)?yo.SPACE:A4(t)||T4(t)||t===95?yo.ALPHA_LETTER:yo.PUNCT:F4(t)?yo.THAI_LETTER:t===160?yo.SPACE:yo.ALPHA_LETTER:C4(t)?yo.HAN_LETTER:L4(t)?yo.KATAKANA_LETTER:I4(t)?yo.HIRAGANA_LETTER:M4(t)?yo.HALFWIDTH_KATAKANA_LETTER:yo.ALPHA_LETTER}let Rx;function P4(){if(Rx||(Rx="\xA0\xA8\xAA\xAF\xB2-\xB5\xB8-\xBA\xBC-\xBE\u0132-\u0133\u013F-\u0140\u0149\u017F\u01C4-\u01CC\u01F1-\u01F3\u02B0-\u02B8\u02D8-\u02DD\u02E0-\u02E4\u0374\u037A\u037E\u0384-\u0385\u0387\u03D0-\u03D6\u03F0-\u03F2\u03F4-\u03F5\u03F9\u0587\u0675-\u0678\u0958-\u095F\u09DC-\u09DD\u09DF\u0A33\u0A36\u0A59-\u0A5B\u0A5E\u0B5C-\u0B5D\u0E33\u0EB3\u0EDC-\u0EDD\u0F0C\u0F43\u0F4D\u0F52\u0F57\u0F5C\u0F69\u10FC\u1D2C-\u1D2E\u1D30-\u1D3A\u1D3C-\u1D4D\u1D4F-\u1D6A\u1D78\u1D9B-\u1DBF\u1E9A-\u1E9B\u1F71\u1F73\u1F75\u1F77\u1F79\u1F7B\u1F7D\u1FBB\u1FBD-\u1FC1\u1FC9\u1FCB\u1FCD-\u1FCF\u1FD3\u1FDB\u1FDD-\u1FDF\u1FE3\u1FEB\u1FED-\u1FEF\u1FF9\u1FFB\u1FFD-\u1FFE\u2000-\u200A\u2011\u2017\u2024-\u2026\u202F\u2033-\u2034\u2036-\u2037\u203C\u203E\u2047-\u2049\u2057\u205F\u2070-\u2071\u2074-\u208E\u2090-\u209C\u20A8\u2100-\u2103\u2105-\u2107\u2109-\u2113\u2115-\u2116\u2119-\u211D\u2120-\u2122\u2124\u2126\u2128\u212A-\u212D\u212F-\u2131\u2133-\u2139\u213B-\u2140\u2145-\u2149\u2150-\u217F\u2189\u222C-\u222D\u222F-\u2230\u2329-\u232A\u2460-\u24EA\u2A0C\u2A74-\u2A76\u2ADC\u2C7C-\u2C7D\u2D6F\u2E9F\u2EF3\u2F00-\u2FD5\u3000\u3036\u3038-\u303A\u309B-\u309C\u309F\u30FF\u3131-\u318E\u3192-\u319F\u3200-\u321E\u3220-\u3247\u3250-\u327E\u3280-\u33FF\uA69C-\uA69D\uA770\uA7F2-\uA7F4\uA7F8-\uA7F9\uAB5C-\uAB5F\uAB69\uF900-\uFA0D\uFA10\uFA12\uFA15-\uFA1E\uFA20\uFA22\uFA25-\uFA26\uFA2A-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB36\uFB38-\uFB3C\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFC\uFE10-\uFE19\uFE30-\uFE44\uFE47-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFE70-\uFE72\uFE74\uFE76-\uFEFC\uFF01-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE0-\uFFE6"),typeof PDFJSDev=="undefined"||PDFJSDev.test("TESTING")){const t=[],e=[],n=new RegExp("^\\p{M}$","u");for(let a=0;a<65536;a++){const i=String.fromCharCode(a);if(i.normalize("NFKC")!==i&&!n.test(i)){if(e.length!==2){e[0]=e[1]=a;continue}e[1]+1!==a?(e[0]===e[1]?t.push(String.fromCharCode(e[0])):t.push(`${String.fromCharCode(e[0])}-${String.fromCharCode(e[1])}`),e[0]=e[1]=a):e[1]=a}}if(t.join("")!==Rx)throw new Error("getNormalizeWithNFKC - update the `NormalizeWithNFKC` string.")}return Rx}const $r={FOUND:0,NOT_FOUND:1,WRAPPED:2,PENDING:3},N4=250,B4=-50,$4=-400,tT={"\u2010":"-","\u2018":"'","\u2019":"'","\u201A":"'","\u201B":"'","\u201C":'"',"\u201D":'"',"\u201E":'"',"\u201F":'"',"\xBC":"1/4","\xBD":"1/2","\xBE":"3/4"},nT=new Set([12441,12442,2381,2509,2637,2765,2893,3021,3149,3277,3387,3388,3405,3530,3642,3770,3972,4153,4154,5908,5940,6098,6752,6980,7082,7083,7154,7155,11647,43014,43052,43204,43347,43456,43766,44013,3158,3953,3954,3962,3963,3964,3965,3968,3956]);let aT;const O4=new RegExp("\\p{M}+","gu"),R4=new RegExp("([.*+?^${}()|[\\]\\\\])|(\\p{P})|(\\s+)|(\\p{M})|(\\p{L})","gu"),U4=new RegExp("([^\\p{M}])\\p{M}*$","u"),H4=new RegExp("^\\p{M}*([^\\p{M}])","u"),q4=/[\uAC00-\uD7AF\uFA6C\uFACF-\uFAD1\uFAD5-\uFAD7]+/g,iT=new Map,W4="[\\u1100-\\u1112\\ud7a4-\\ud7af\\ud84a\\ud84c\\ud850\\ud854\\ud857\\ud85f]",sT=new Map;let Ux=null,Hx=null;function qx(t){const e=[];let n;for(;(n=q4.exec(t))!==null;){let{index:f}=n;for(const h of n[0]){let m=iT.get(h);m||(m=h.normalize("NFD").length,iT.set(h,m)),e.push([m,f++])}}let a;if(e.length===0&&Ux)a=Ux;else if(e.length>0&&Hx)a=Hx;else{const f=Object.keys(tT).join(""),h=P4(),_=`([${f}])|([${h}])|((?:\u3099|\u309A)\\n)|(\\p{M}+(?:-\\n)?)|(\\p{Ll}-\\n\\p{Lu})|(\\S-\\n)|((?:\\p{Ideographic}|[\u3040-\u30FF])\\n)|(\\n)`;e.length===0?a=Ux=new RegExp(_+"|(\\u0000)","gum"):a=Hx=new RegExp(_+`|(${W4})`,"gum")}const i=[];for(;(n=O4.exec(t))!==null;)i.push([n[0].length,n.index]);let s=t.normalize("NFD");const r=[[0,0]];let o=0,l=0,c=0,d=0,u=0,g=!1;return s=s.replace(a,(f,h,m,b,y,_,v,U,ee,Z,k)=>{var w,S,B;if(k-=d,h){const H=tT[h],j=H.length;for(let re=1;re<j;re++)r.push([k-c+re,c-re]);return c-=j-1,H}if(m){let H=sT.get(m);H||(H=m.normalize("NFKC"),sT.set(m,H));const j=H.length;for(let re=1;re<j;re++)r.push([k-c+re,c-re]);return c-=j-1,H}if(b)return g=!0,k+u===((w=i[o])==null?void 0:w[1])?++o:(r.push([k-1-c+1,c-1]),c-=1,d+=1),r.push([k-c+1,c]),d+=1,u+=1,b.charAt(0);if(y){const H=y.endsWith(`
`),j=H?y.length-2:y.length;g=!0;let re=j;k+u===((S=i[o])==null?void 0:S[1])&&(re-=i[o][0],++o);for(let Te=1;Te<=re;Te++)r.push([k-1-c+Te,c-Te]);return c-=re,d+=re,H?(k+=j-1,r.push([k-c+1,1+c]),c+=1,d+=1,u+=1,y.slice(0,j)):y}if(_)return r.push([k-c+3,1+c]),c+=1,d+=1,u+=1,_.replace(`
`,"");if(v){const H=v.length-2;return r.push([k-c+H,1+c]),c+=1,d+=1,u+=1,v.slice(0,-2)}if(U){const H=U.length-1;return r.push([k-c+H,c]),d+=1,u+=1,U.slice(0,-1)}if(ee)return r.push([k-c+1,c-1]),c-=1,d+=1,u+=1," ";if(k+u===((B=e[l])==null?void 0:B[1])){const H=e[l][0]-1;++l;for(let j=1;j<=H;j++)r.push([k-(c-j),c-j]);c-=H,d+=H}return Z}),r.push([s.length,c]),[s,r,g]}function V4(t,e,n){if(!t)return[e,n];const a=e,i=e+n-1;let s=sg(t,d=>d[0]>=a);t[s][0]>a&&--s;let r=sg(t,d=>d[0]>=i,s);t[r][0]>i&&--r;const o=a+t[s][1],c=i+t[r][1]+1-o;return[o,c]}class z4{constructor({linkService:e,eventBus:n,updateMatchesCountOnProgress:a=!0}){Ae(this,Zw);Ae(this,Rm);Ae(this,Um);Ae(this,Jw);Ae(this,Qw);Ae(this,Hm);Ae(this,e0);Ae(this,t0);Ae(this,Dp);Ae(this,Iu);Ae(this,Rc);Ae(this,n0);Ae(this,qm);Ae(this,Wm);Ae(this,Cp);Ae(this,a0);Ae(this,Vm);Ae(this,zm);Ae(this,Mu);Ae(this,Xi,null);Ae(this,Tp,!0);Ae(this,Lu,0);this._linkService=e,this._eventBus=n,it(this,Tp,a),this.onIsPageVisible=null,Se(this,Rm,Tk).call(this),n._on("find",Se(this,Zw,FI).bind(this)),n._on("findbarclose",Se(this,a0,RI).bind(this))}get highlightMatches(){return this._highlightMatches}get pageMatches(){return this._pageMatches}get pageMatchesLength(){return this._pageMatchesLength}get selected(){return this._selected}get state(){return ie(this,Xi)}setDocument(e){this._pdfDocument&&Se(this,Rm,Tk).call(this),e&&(this._pdfDocument=e,this._firstPageCapability.resolve())}scrollMatchIntoView({element:e=null,selectedLeft:n=0,pageIndex:a=-1,matchIndex:i=-1}){if(!this._scrollMatches||!e)return;if(i===-1||i!==this._selected.matchIdx)return;if(a===-1||a!==this._selected.pageIdx)return;this._scrollMatches=!1;const s={top:B4,left:n+$4};Cx(e,s,!0)}match(e,n,a){const i=this._hasDiacritics[a];let s=!1;if(typeof e=="string"?[s,e]=Se(this,Hm,Ck).call(this,e,i):e=e.sort().reverse().map(u=>{const[g,f]=Se(this,Hm,Ck).call(this,u,i);return s||(s=g),`(${f})`}).join("|"),!e)return;const{caseSensitive:r,entireWord:o}=ie(this,Xi),l=`g${s?"u":""}${r?"":"i"}`;e=new RegExp(e,l);const c=[];let d;for(;(d=e.exec(n))!==null;)o&&!Se(this,Qw,NI).call(this,n,d.index,d[0].length)||c.push({index:d.index,length:d[0].length});return c}}Xi=new WeakMap,Tp=new WeakMap,Lu=new WeakMap,Zw=new WeakSet,FI=function(e){if(!e)return;const n=this._pdfDocument,{type:a}=e;(ie(this,Xi)===null||Se(this,Jw,PI).call(this,e))&&(this._dirtyMatch=!0),it(this,Xi,e),a!=="highlightallchange"&&Se(this,Mu,oy).call(this,$r.PENDING),this._firstPageCapability.promise.then(()=>{if(!this._pdfDocument||n&&this._pdfDocument!==n)return;Se(this,t0,$I).call(this);const i=!this._highlightMatches,s=!!this._findTimeout;this._findTimeout&&(clearTimeout(this._findTimeout),this._findTimeout=null),a?this._dirtyMatch?Se(this,Rc,ah).call(this):a==="again"?(Se(this,Rc,ah).call(this),i&&ie(this,Xi).highlightAll&&Se(this,Iu,ry).call(this)):a==="highlightallchange"?(s?Se(this,Rc,ah).call(this):this._highlightMatches=!0,Se(this,Iu,ry).call(this)):Se(this,Rc,ah).call(this):this._findTimeout=setTimeout(()=>{Se(this,Rc,ah).call(this),this._findTimeout=null},N4)})},Rm=new WeakSet,Tk=function(){this._highlightMatches=!1,this._scrollMatches=!1,this._pdfDocument=null,this._pageMatches=[],this._pageMatchesLength=[],it(this,Lu,0),it(this,Xi,null),this._selected={pageIdx:-1,matchIdx:-1},this._offset={pageIdx:null,matchIdx:null,wrapped:!1},this._extractTextPromises=[],this._pageContents=[],this._pageDiffs=[],this._hasDiacritics=[],this._matchesCountTotal=0,this._pagesToSearch=null,this._pendingFindMatches=new Set,this._resumePageIdx=null,this._dirtyMatch=!1,clearTimeout(this._findTimeout),this._findTimeout=null,this._firstPageCapability=Promise.withResolvers()},Um=new WeakSet,Dk=function(){const{query:e}=ie(this,Xi);return typeof e=="string"?(e!==this._rawQuery&&(this._rawQuery=e,[this._normalizedQuery]=qx(e)),this._normalizedQuery):(e||[]).filter(n=>!!n).map(n=>qx(n)[0])},Jw=new WeakSet,PI=function(e){var r,o;const n=e.query,a=ie(this,Xi).query,i=typeof n;if(i!==typeof a)return!0;if(i==="string"){if(n!==a)return!0}else if(JSON.stringify(n)!==JSON.stringify(a))return!0;switch(e.type){case"again":const l=this._selected.pageIdx+1,c=this._linkService;return l>=1&&l<=c.pagesCount&&l!==c.page&&!((o=(r=this.onIsPageVisible)==null?void 0:r.call(this,l))==null||o);case"highlightallchange":return!1}return!0},Qw=new WeakSet,NI=function(e,n,a){let i=e.slice(0,n).match(U4);if(i){const s=e.charCodeAt(n),r=i[1].charCodeAt(0);if(k_(s)===k_(r))return!1}if(i=e.slice(n+a).match(H4),i){const s=e.charCodeAt(n+a-1),r=i[1].charCodeAt(0);if(k_(s)===k_(r))return!1}return!0},Hm=new WeakSet,Ck=function(e,n){const{matchDiacritics:a}=ie(this,Xi);let i=!1;e=e.replaceAll(R4,(r,o,l,c,d,u)=>o?`[ ]*\\${o}[ ]*`:l?`[ ]*${l}[ ]*`:c?"[ ]+":a?d||u:d?nT.has(d.charCodeAt(0))?d:"":n?(i=!0,`${u}\\p{M}*`):u);const s="[ ]*";return e.endsWith(s)&&(e=e.slice(0,e.length-s.length)),a&&n&&(aT||(aT=String.fromCharCode(...nT)),i=!0,e=`${e}(?=[${aT}]|[^\\p{M}]|$)`),[i,e]},e0=new WeakSet,BI=function(e){const n=ie(this,Um,Dk);if(n.length===0)return;const a=this._pageContents[e],i=this.match(n,a,e),s=this._pageMatches[e]=[],r=this._pageMatchesLength[e]=[],o=this._pageDiffs[e];i==null||i.forEach(({index:c,length:d})=>{const[u,g]=V4(o,c,d);g&&(s.push(u),r.push(g))}),ie(this,Xi).highlightAll&&Se(this,Dp,Q0).call(this,e),this._resumePageIdx===e&&(this._resumePageIdx=null,Se(this,qm,Lk).call(this));const l=s.length;this._matchesCountTotal+=l,ie(this,Tp)?l>0&&Se(this,zm,Fk).call(this):++K0(this,Lu)._===this._linkService.pagesCount&&Se(this,zm,Fk).call(this)},t0=new WeakSet,$I=function(){if(this._extractTextPromises.length>0)return;let e=Promise.resolve();const n={disableNormalization:!0};for(let a=0,i=this._linkService.pagesCount;a<i;a++){const{promise:s,resolve:r}=Promise.withResolvers();this._extractTextPromises[a]=s,e=e.then(()=>this._pdfDocument.getPage(a+1).then(o=>o.getTextContent(n)).then(o=>{const l=[];for(const c of o.items)l.push(c.str),c.hasEOL&&l.push(`
`);[this._pageContents[a],this._pageDiffs[a],this._hasDiacritics[a]]=qx(l.join("")),r()},o=>{console.error(`Unable to get text content for page ${a+1}`,o),this._pageContents[a]="",this._pageDiffs[a]=null,this._hasDiacritics[a]=!1,r()}))}},Dp=new WeakSet,Q0=function(e){this._scrollMatches&&this._selected.pageIdx===e&&(this._linkService.page=e+1),this._eventBus.dispatch("updatetextlayermatches",{source:this,pageIndex:e})},Iu=new WeakSet,ry=function(){this._eventBus.dispatch("updatetextlayermatches",{source:this,pageIndex:-1})},Rc=new WeakSet,ah=function(){const e=ie(this,Xi).findPrevious,n=this._linkService.page-1,a=this._linkService.pagesCount;if(this._highlightMatches=!0,this._dirtyMatch){this._dirtyMatch=!1,this._selected.pageIdx=this._selected.matchIdx=-1,this._offset.pageIdx=n,this._offset.matchIdx=null,this._offset.wrapped=!1,this._resumePageIdx=null,this._pageMatches.length=0,this._pageMatchesLength.length=0,it(this,Lu,0),this._matchesCountTotal=0,Se(this,Iu,ry).call(this);for(let r=0;r<a;r++)this._pendingFindMatches.has(r)||(this._pendingFindMatches.add(r),this._extractTextPromises[r].then(()=>{this._pendingFindMatches.delete(r),Se(this,e0,BI).call(this,r)}))}if(ie(this,Um,Dk).length===0){Se(this,Mu,oy).call(this,$r.FOUND);return}if(this._resumePageIdx)return;const s=this._offset;if(this._pagesToSearch=a,s.matchIdx!==null){const r=this._pageMatches[s.pageIdx].length;if(!e&&s.matchIdx+1<r||e&&s.matchIdx>0){s.matchIdx=e?s.matchIdx-1:s.matchIdx+1,Se(this,Cp,ev).call(this,!0);return}Se(this,Wm,Ik).call(this,e)}Se(this,qm,Lk).call(this)},n0=new WeakSet,OI=function(e){const n=this._offset,a=e.length,i=ie(this,Xi).findPrevious;return a?(n.matchIdx=i?a-1:0,Se(this,Cp,ev).call(this,!0),!0):(Se(this,Wm,Ik).call(this,i),n.wrapped&&(n.matchIdx=null,this._pagesToSearch<0)?(Se(this,Cp,ev).call(this,!1),!0):!1)},qm=new WeakSet,Lk=function(){this._resumePageIdx!==null&&console.error("There can only be one pending page.");let e=null;do{const n=this._offset.pageIdx;if(e=this._pageMatches[n],!e){this._resumePageIdx=n;break}}while(!Se(this,n0,OI).call(this,e))},Wm=new WeakSet,Ik=function(e){const n=this._offset,a=this._linkService.pagesCount;n.pageIdx=e?n.pageIdx-1:n.pageIdx+1,n.matchIdx=null,this._pagesToSearch--,(n.pageIdx>=a||n.pageIdx<0)&&(n.pageIdx=e?a-1:0,n.wrapped=!0)},Cp=new WeakSet,ev=function(e=!1){let n=$r.NOT_FOUND;const a=this._offset.wrapped;if(this._offset.wrapped=!1,e){const i=this._selected.pageIdx;this._selected.pageIdx=this._offset.pageIdx,this._selected.matchIdx=this._offset.matchIdx,n=a?$r.WRAPPED:$r.FOUND,i!==-1&&i!==this._selected.pageIdx&&Se(this,Dp,Q0).call(this,i)}Se(this,Mu,oy).call(this,n,ie(this,Xi).findPrevious),this._selected.pageIdx!==-1&&(this._scrollMatches=!0,Se(this,Dp,Q0).call(this,this._selected.pageIdx))},a0=new WeakSet,RI=function(e){const n=this._pdfDocument;this._firstPageCapability.promise.then(()=>{!this._pdfDocument||n&&this._pdfDocument!==n||(this._findTimeout&&(clearTimeout(this._findTimeout),this._findTimeout=null),this._resumePageIdx&&(this._resumePageIdx=null,this._dirtyMatch=!0),Se(this,Mu,oy).call(this,$r.FOUND),this._highlightMatches=!1,Se(this,Iu,ry).call(this))})},Vm=new WeakSet,Mk=function(){var s;const{pageIdx:e,matchIdx:n}=this._selected;let a=0,i=this._matchesCountTotal;if(n!==-1){for(let r=0;r<e;r++)a+=((s=this._pageMatches[r])==null?void 0:s.length)||0;a+=n+1}return(a<1||a>i)&&(a=i=0),{current:a,total:i}},zm=new WeakSet,Fk=function(){this._eventBus.dispatch("updatefindmatchescount",{source:this,matchesCount:Se(this,Vm,Mk).call(this)})},Mu=new WeakSet,oy=function(e,n=!1){var a,i,s,r;!ie(this,Tp)&&(ie(this,Lu)!==this._linkService.pagesCount||e===$r.PENDING)||this._eventBus.dispatch("updatefindcontrolstate",{source:this,state:e,previous:n,entireWord:(i=(a=ie(this,Xi))==null?void 0:a.entireWord)!=null?i:null,matchesCount:Se(this,Vm,Mk).call(this),rawQuery:(r=(s=ie(this,Xi))==null?void 0:s.query)!=null?r:null})};const Y4=1e3;class G4{constructor(e,n,a){Ae(this,i0);Ae(this,Ym,void 0);Ae(this,Lp,new ResizeObserver(Se(this,i0,UI).bind(this)));this.opened=!1,this.bar=e.bar,this.toggleButton=e.toggleButton,this.findField=e.findField,this.highlightAll=e.highlightAllCheckbox,this.caseSensitive=e.caseSensitiveCheckbox,this.matchDiacritics=e.matchDiacriticsCheckbox,this.entireWord=e.entireWordCheckbox,this.findMsg=e.findMsg,this.findResultsCount=e.findResultsCount,this.findPreviousButton=e.findPreviousButton,this.findNextButton=e.findNextButton,this.eventBus=a,it(this,Ym,n),this.toggleButton.addEventListener("click",()=>{this.toggle()}),this.findField.addEventListener("input",()=>{this.dispatchEvent("")}),this.bar.addEventListener("keydown",i=>{switch(i.keyCode){case 13:i.target===this.findField&&this.dispatchEvent("again",i.shiftKey);break;case 27:this.close();break}}),this.findPreviousButton.addEventListener("click",()=>{this.dispatchEvent("again",!0)}),this.findNextButton.addEventListener("click",()=>{this.dispatchEvent("again",!1)}),this.highlightAll.addEventListener("click",()=>{this.dispatchEvent("highlightallchange"),this.highlightAll.checked?this.highlightAll.parentElement.classList.remove("b3-button--outline"):this.highlightAll.parentElement.classList.add("b3-button--outline")}),this.caseSensitive.addEventListener("click",()=>{this.dispatchEvent("casesensitivitychange"),this.caseSensitive.checked?this.caseSensitive.parentElement.classList.remove("b3-button--outline"):this.caseSensitive.parentElement.classList.add("b3-button--outline")}),this.entireWord.addEventListener("click",()=>{this.dispatchEvent("entirewordchange"),this.entireWord.checked?this.entireWord.parentElement.classList.remove("b3-button--outline"):this.entireWord.parentElement.classList.add("b3-button--outline")}),this.matchDiacritics.addEventListener("click",()=>{this.dispatchEvent("diacriticmatchingchange"),this.matchDiacritics.checked?this.matchDiacritics.parentElement.classList.remove("b3-button--outline"):this.matchDiacritics.parentElement.classList.add("b3-button--outline")})}reset(){this.updateUIState()}dispatchEvent(e,n=!1){this.eventBus.dispatch("find",{source:this,type:e,query:this.findField.value,caseSensitive:this.caseSensitive.checked,entireWord:this.entireWord.checked,highlightAll:this.highlightAll.checked,findPrevious:n,matchDiacritics:this.matchDiacritics.checked})}updateUIState(e,n,a){const{findField:i,findMsg:s}=this;let r="",o="";switch(e){case $r.FOUND:break;case $r.PENDING:o="pending";break;case $r.NOT_FOUND:r=window.siyuan.languages.find_not_found,o="notFound";break;case $r.WRAPPED:r=window.siyuan.languages.find_not_found[`find_reached_${n?"top":"bottom"}`];break}i.setAttribute("data-status",o),i.setAttribute("aria-invalid",e===$r.NOT_FOUND),s.setAttribute("data-status",o),r?s.textContent=r:(s.removeAttribute("data-l10n-id"),s.textContent=""),this.updateResultsCount(a)}updateResultsCount({current:e=0,total:n=0}={}){const{findResultsCount:a}=this;if(n>0){const i=Y4;a.textContent=n>i?window.siyuan.languages.find_match_count_limit.replace("{{limit}}",i):window.siyuan.languages.find_match_count.replace("{{current}}",e).replace("{{total}}",n)}else a.removeAttribute("data-l10n-id"),a.textContent=""}open(){this.opened||(ie(this,Lp).observe(ie(this,Ym)),ie(this,Lp).observe(this.bar),this.opened=!0,zo(this.toggleButton,!0,this.bar)),this.findField.select(),this.findField.focus()}close(){this.opened&&(ie(this,Lp).disconnect(),this.opened=!1,zo(this.toggleButton,!1,this.bar),this.eventBus.dispatch("findbarclose",{source:this}))}toggle(){this.opened?this.close():this.open()}}Ym=new WeakMap,Lp=new WeakMap,i0=new WeakSet,UI=function(){const{bar:e}=this;e.classList.remove("wrapContainers");const n=e.clientHeight,a=e.firstElementChild.clientHeight;n>a&&e.classList.add("wrapContainers")};const j4=1e3,Wx=50,rT=1e3;function Vx(){return document.location.hash}class K4{constructor({linkService:e,eventBus:n}){Ae(this,Co);Ae(this,Ip);Ae(this,Mp);Ae(this,Hc);Ae(this,Fp);Ae(this,Gm);Ae(this,s0);Ae(this,r0);Ae(this,jm);Ae(this,o0);Ae(this,l0);Ae(this,Uc,null);this.linkService=e,this.eventBus=n,this._initialized=!1,this._fingerprint="",this.reset(),this.eventBus._on("pagesinit",()=>{this._isPagesLoaded=!1,this.eventBus._on("pagesloaded",a=>{this._isPagesLoaded=!!a.pagesCount},{once:!0})})}initialize({fingerprint:e,resetHistory:n=!1,updateUrl:a=!1}){if(!e||typeof e!="string"){console.error('PDFHistory.initialize: The "fingerprint" must be a non-empty string.');return}this._initialized&&this.reset();const i=this._fingerprint!==""&&this._fingerprint!==e;this._fingerprint=e,this._updateUrl=a===!0,this._initialized=!0,Se(this,o0,WI).call(this);const s=window.history.state;if(this._popStateInProgress=!1,this._blockHashChange=0,this._currentHash=Vx(),this._numPositionUpdates=0,this._uid=this._maxUid=0,this._destination=null,this._position=null,!Se(this,Hc,ih).call(this,s,!0)||n){const{hash:o,page:l,rotation:c}=Se(this,Gm,Pk).call(this,!0);if(!o||i||n){Se(this,Co,jl).call(this,null,!0);return}Se(this,Co,jl).call(this,{hash:o,page:l,rotation:c},!0);return}const r=s.destination;Se(this,Fp,av).call(this,r,s.uid,!0),r.rotation!==void 0&&(this._initialRotation=r.rotation),r.dest?(this._initialBookmark=JSON.stringify(r.dest),this._destination.page=null):r.hash?this._initialBookmark=r.hash:r.page&&(this._initialBookmark=`page=${r.page}`)}reset(){this._initialized&&(Se(this,jm,Nk).call(this),this._initialized=!1,Se(this,l0,VI).call(this)),this._updateViewareaTimeout&&(clearTimeout(this._updateViewareaTimeout),this._updateViewareaTimeout=null),this._initialBookmark=null,this._initialRotation=null}push({namedDest:e=null,explicitDest:n,pageNumber:a}){if(!this._initialized)return;if(e&&typeof e!="string"){console.error(`PDFHistory.push: "${e}" is not a valid namedDest parameter.`);return}else if(Array.isArray(n)){if(!Se(this,Mp,nv).call(this,a)&&(a!==null||this._destination)){console.error(`PDFHistory.push: "${a}" is not a valid pageNumber parameter.`);return}}else{console.error(`PDFHistory.push: "${n}" is not a valid explicitDest parameter.`);return}const i=e||JSON.stringify(n);if(!i)return;let s=!1;if(this._destination&&(X4(this._destination.hash,i)||Z4(this._destination.dest,n))){if(this._destination.page)return;s=!0}this._popStateInProgress&&!s||(Se(this,Co,jl).call(this,{dest:n,hash:i,page:a,rotation:this.linkService.rotation},s),this._popStateInProgress||(this._popStateInProgress=!0,Promise.resolve().then(()=>{this._popStateInProgress=!1})))}pushPage(e){var n;if(this._initialized){if(!Se(this,Mp,nv).call(this,e)){console.error(`PDFHistory.pushPage: "${e}" is not a valid page number.`);return}((n=this._destination)==null?void 0:n.page)!==e&&(this._popStateInProgress||(Se(this,Co,jl).call(this,{dest:null,hash:`page=${e}`,page:e,rotation:this.linkService.rotation}),this._popStateInProgress||(this._popStateInProgress=!0,Promise.resolve().then(()=>{this._popStateInProgress=!1}))))}}pushCurrentPosition(){!this._initialized||this._popStateInProgress||Se(this,Ip,tv).call(this)}back(){if(!this._initialized||this._popStateInProgress)return;const e=window.history.state;Se(this,Hc,ih).call(this,e)&&e.uid>0&&window.history.back()}forward(){if(!this._initialized||this._popStateInProgress)return;const e=window.history.state;Se(this,Hc,ih).call(this,e)&&e.uid<this._maxUid&&window.history.forward()}get popStateInProgress(){return this._initialized&&(this._popStateInProgress||this._blockHashChange>0)}get initialBookmark(){return this._initialized?this._initialBookmark:null}get initialRotation(){return this._initialized?this._initialRotation:null}}Uc=new WeakMap,Co=new WeakSet,jl=function(e,n=!1){var r;const a=n||!this._destination,i={fingerprint:this._fingerprint,uid:a?this._uid:this._uid+1,destination:e};typeof PDFJSDev!="undefined"&&PDFJSDev.test("CHROME")&&((r=window.history.state)!=null&&r.chromecomState)&&(i.chromecomState=window.history.state.chromecomState),Se(this,Fp,av).call(this,e,i.uid);let s;if(this._updateUrl&&(e!=null&&e.hash)){const o=document.location.href.split("#",1)[0];o.startsWith("file://")||(s=`${o}#${e.hash}`)}a?window.history.replaceState(i,"",s):window.history.pushState(i,"",s)},Ip=new WeakSet,tv=function(e=!1){if(!this._position)return;let n=this._position;if(e&&(n=Object.assign(Object.create(null),this._position),n.temporary=!0),!this._destination){Se(this,Co,jl).call(this,n);return}if(this._destination.temporary){Se(this,Co,jl).call(this,n,!0);return}if(this._destination.hash===n.hash||!this._destination.page&&(Wx<=0||this._numPositionUpdates<=Wx))return;let a=!1;if(this._destination.page>=n.first&&this._destination.page<=n.page){if(this._destination.dest!==void 0||!this._destination.first)return;a=!0}Se(this,Co,jl).call(this,n,a)},Mp=new WeakSet,nv=function(e){return Number.isInteger(e)&&e>0&&e<=this.linkService.pagesCount},Hc=new WeakSet,ih=function(e,n=!1){if(!e)return!1;if(e.fingerprint!==this._fingerprint)if(n){if(typeof e.fingerprint!="string"||e.fingerprint.length!==this._fingerprint.length)return!1;const[a]=performance.getEntriesByType("navigation");if((a==null?void 0:a.type)!=="reload")return!1}else return!1;return!(!Number.isInteger(e.uid)||e.uid<0||e.destination===null||typeof e.destination!="object")},Fp=new WeakSet,av=function(e,n,a=!1){this._updateViewareaTimeout&&(clearTimeout(this._updateViewareaTimeout),this._updateViewareaTimeout=null),a&&(e!=null&&e.temporary)&&delete e.temporary,this._destination=e,this._uid=n,this._maxUid=Math.max(this._maxUid,n),this._numPositionUpdates=0},Gm=new WeakSet,Pk=function(e=!1){const n=unescape(Vx()).substring(1),a=ig(n),i=a.get("nameddest")||"";let s=a.get("page")|0;return(!Se(this,Mp,nv).call(this,s)||e&&i.length>0)&&(s=null),{hash:n,page:s,rotation:this.linkService.rotation}},s0=new WeakSet,HI=function({location:e}){this._updateViewareaTimeout&&(clearTimeout(this._updateViewareaTimeout),this._updateViewareaTimeout=null),this._position={hash:e.pdfOpenParams.substring(1),page:this.linkService.page,first:e.pageNumber,rotation:e.rotation},!this._popStateInProgress&&(Wx>0&&this._isPagesLoaded&&this._destination&&!this._destination.page&&this._numPositionUpdates++,rT>0&&(this._updateViewareaTimeout=setTimeout(()=>{this._popStateInProgress||Se(this,Ip,tv).call(this,!0),this._updateViewareaTimeout=null},rT)))},r0=new WeakSet,qI=function({state:e}){const n=Vx(),a=this._currentHash!==n;if(this._currentHash=n,typeof PDFJSDev!="undefined"&&PDFJSDev.test("CHROME")&&(e!=null&&e.chromecomState)&&!Se(this,Hc,ih).call(this,e)||!e){this._uid++;const{hash:s,page:r,rotation:o}=Se(this,Gm,Pk).call(this);Se(this,Co,jl).call(this,{hash:s,page:r,rotation:o},!0);return}if(!Se(this,Hc,ih).call(this,e))return;this._popStateInProgress=!0,a&&(this._blockHashChange++,XA({target:window,name:"hashchange",delay:j4}).then(()=>{this._blockHashChange--}));const i=e.destination;Se(this,Fp,av).call(this,i,e.uid,!0),__(i.rotation)&&(this.linkService.rotation=i.rotation),i.dest?this.linkService.goToDestination(i.dest):i.hash?this.linkService.setHash(i.hash):i.page&&(this.linkService.page=i.page),Promise.resolve().then(()=>{this._popStateInProgress=!1})},jm=new WeakSet,Nk=function(){(!this._destination||this._destination.temporary)&&Se(this,Ip,tv).call(this)},o0=new WeakSet,WI=function(){if(ie(this,Uc))return;it(this,Uc,new AbortController);const{signal:e}=ie(this,Uc);this.eventBus._on("updateviewarea",Se(this,s0,HI).bind(this),{signal:e}),window.addEventListener("popstate",Se(this,r0,qI).bind(this),{signal:e}),window.addEventListener("pagehide",Se(this,jm,Nk).bind(this),{signal:e})},l0=new WeakSet,VI=function(){var e;(e=ie(this,Uc))==null||e.abort(),it(this,Uc,null)};function X4(t,e){return typeof t!="string"||typeof e!="string"?!1:t===e||ig(t).get("nameddest")===e}function Z4(t,e){function n(a,i){if(typeof a!=typeof i||Array.isArray(a)||Array.isArray(i))return!1;if(a!==null&&typeof a=="object"&&i!==null){if(Object.keys(a).length!==Object.keys(i).length)return!1;for(const s in a)if(!n(a[s],i[s]))return!1;return!0}return a===i||Number.isNaN(a)&&Number.isNaN(i)}if(!(Array.isArray(t)&&Array.isArray(e))||t.length!==e.length)return!1;for(let a=0,i=t.length;a<i;a++)if(!n(t[a],e[a]))return!1;return!0}class J4 extends rg{constructor(n){super(n);Ae(this,Km);this.eventBus._on("optionalcontentconfigchanged",a=>{Se(this,Km,Bk).call(this,a.promise)}),this.eventBus._on("resetlayers",()=>{Se(this,Km,Bk).call(this)}),this.eventBus._on("togglelayerstree",this._toggleAllTreeItems.bind(this))}reset(){var n;super.reset(),this._optionalContentConfig=null,(n=this._optionalContentVisibility)==null||n.clear(),this._optionalContentVisibility=null}_dispatchEvent(n){this.eventBus.dispatch("layersloaded",{source:this,layersCount:n})}_bindLink(n,{groupId:a,input:i}){const s=()=>{const r=i.checked;this._optionalContentConfig.setVisibility(a,r);const o=this._optionalContentVisibility.get(a);o&&(o.visible=r),this.eventBus.dispatch("optionalcontentconfig",{source:this,promise:Promise.resolve(this._optionalContentConfig)})};n.onclick=r=>r.target===i?(s(),!0):r.target!==n?!0:(i.checked=!i.checked,s(),!1)}_setNestedName(n,{name:a=null}){if(typeof a=="string"){n.textContent=this._normalizeTextContent(a);return}n.textContent=window.siyuan.languages.additionalLayers,n.style.fontStyle="italic",this._l10n.translateOnce(n)}_addToggleButton(n,{name:a=null}){super._addToggleButton(n,a===null)}_toggleAllTreeItems(){this._optionalContentConfig&&super._toggleAllTreeItems()}render({optionalContentConfig:n,pdfDocument:a}){this._optionalContentConfig&&this.reset(),this._optionalContentConfig=n||null,this._pdfDocument=a||null;const i=n==null?void 0:n.getOrder();if(!i){this._dispatchEvent(0);return}this._optionalContentVisibility=new Map;const s=document.createDocumentFragment(),r=[{parent:s,groups:i}];let o=0,l=!1;for(;r.length>0;){const c=r.shift();for(const d of c.groups){const u=document.createElement("div");u.className="treeItem";const g=document.createElement("a");if(u.append(g),typeof d=="object"){l=!0,this._addToggleButton(u,d),this._setNestedName(g,d);const f=document.createElement("div");f.className="treeItems",u.append(f),r.push({parent:f,groups:d.order})}else{const f=n.getGroup(d),h=document.createElement("input");this._bindLink(g,{groupId:d,input:h}),h.type="checkbox",h.checked=f.visible,this._optionalContentVisibility.set(d,{input:h,visible:h.checked});const m=document.createElement("label");m.textContent=this._normalizeTextContent(f.name),m.append(h),g.append(m),o++}c.parent.append(u)}}this._finishRendering(s,o,l)}}Km=new WeakSet,Bk=function(n=null){return Rt(this,null,function*(){if(!this._optionalContentConfig)return;const a=this._pdfDocument,i=yield n||a.getOptionalContentConfig({intent:"display"});if(a===this._pdfDocument){if(n){for(const[s,r]of this._optionalContentVisibility){const o=i.getGroup(s);o&&r.visible!==o.visible&&(r.input.checked=r.visible=!r.visible)}return}this.eventBus.dispatch("optionalcontentconfig",{source:this,promise:Promise.resolve(i)}),this.render({optionalContentConfig:i,pdfDocument:this._pdfDocument})}})};class Q4 extends rg{constructor(e){super(e),this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.eventBus._on("toggleoutlinetree",this._toggleAllTreeItems.bind(this)),this.eventBus._on("currentoutlineitem",this._currentOutlineItem.bind(this)),this.eventBus._on("pagechanging",n=>{this._currentPageNumber=n.pageNumber}),this.eventBus._on("pagesloaded",n=>{var a;this._isPagesLoaded=!!n.pagesCount,(a=this._currentOutlineItemCapability)==null||a.resolve(this._isPagesLoaded)}),this.eventBus._on("sidebarviewchanged",n=>{this._sidebarView=n.view})}reset(){var e;super.reset(),this._outline=null,this._pageNumberToDestHashCapability=null,this._currentPageNumber=1,this._isPagesLoaded=null,(e=this._currentOutlineItemCapability)==null||e.resolve(!1),this._currentOutlineItemCapability=null}_dispatchEvent(e){var n;this._currentOutlineItemCapability=Promise.withResolvers(),e===0||(n=this._pdfDocument)!=null&&n.loadingParams.disableAutoFetch?this._currentOutlineItemCapability.resolve(!1):this._isPagesLoaded!==null&&this._currentOutlineItemCapability.resolve(this._isPagesLoaded),this.eventBus.dispatch("outlineloaded",{source:this,outlineCount:e,currentOutlineItemPromise:this._currentOutlineItemCapability.promise})}_bindLink(e,{url:n,newWindow:a,action:i,attachment:s,dest:r,setOCGState:o}){const{linkService:l}=this;if(n){l.addLinkAttributes(e,n,a);return}if(i){e.href=l.getAnchorUrl(""),e.onclick=()=>(l.executeNamedAction(i),!1);return}if(s){e.href=l.getAnchorUrl(""),e.onclick=()=>(this.downloadManager.openOrDownloadData(s.content,s.filename),!1);return}if(o){e.href=l.getAnchorUrl(""),e.onclick=()=>(l.executeSetOCGState(o),!1);return}e.href=l.getDestinationHash(r),e.onclick=c=>(this._updateCurrentTreeItem(c.target.parentNode),r&&l.goToDestination(r),!1)}_setStyles(e,{bold:n,italic:a}){n&&(e.style.fontWeight="bold"),a&&(e.style.fontStyle="italic")}_addToggleButton(e,{count:n,items:a}){let i=!1;if(n<0){let s=a.length;if(s>0){const r=[...a];for(;r.length>0;){const{count:o,items:l}=r.shift();o>0&&l.length>0&&(s+=l.length,r.push(...l))}}Math.abs(n)===s&&(i=!0)}super._addToggleButton(e,i)}_toggleAllTreeItems(){this._outline&&super._toggleAllTreeItems()}render({outline:e,pdfDocument:n}){if(this._outline&&this.reset(),this._outline=e||null,this._pdfDocument=n||null,!e){this._dispatchEvent(0);return}const a=document.createDocumentFragment(),i=[{parent:a,items:e}];let s=0,r=!1;for(;i.length>0;){const o=i.shift();for(const l of o.items){const c=document.createElement("div");c.className="treeItem";const d=document.createElement("a");if(this._bindLink(d,l),this._setStyles(d,l),d.textContent=this._normalizeTextContent(l.title),c.append(d),l.items.length>0){r=!0,this._addToggleButton(c,l);const u=document.createElement("div");u.className="treeItems",c.append(u),i.push({parent:u,items:l.items})}o.parent.append(c),s++}}this._finishRendering(a,s,r)}_currentOutlineItem(){return Rt(this,null,function*(){if(!this._isPagesLoaded)throw new Error("_currentOutlineItem: All pages have not been loaded.");if(!this._outline||!this._pdfDocument)return;const e=yield this._getPageNumberToDestHash(this._pdfDocument);if(e&&(this._updateCurrentTreeItem(null),this._sidebarView===Hn.OUTLINE))for(let n=this._currentPageNumber;n>0;n--){const a=e.get(n);if(!a)continue;const i=this.container.querySelector(`a[href="${a}"]`);if(i){this._scrollToCurrentTreeItem(i.parentNode);break}}})}_getPageNumberToDestHash(e){return Rt(this,null,function*(){if(this._pageNumberToDestHashCapability)return this._pageNumberToDestHashCapability.promise;this._pageNumberToDestHashCapability=Promise.withResolvers();const n=new Map,a=new Map,i=[{nesting:0,items:this._outline}];for(;i.length>0;){const s=i.shift(),r=s.nesting;for(const{dest:o,items:l}of s.items){let c,d;if(typeof o=="string"){if(c=yield e.getDestination(o),e!==this._pdfDocument)return null}else c=o;if(Array.isArray(c)){const[u]=c;if(u&&typeof u=="object"?d=e.cachedPageNumber(u):Number.isInteger(u)&&(d=u+1),Number.isInteger(d)&&(!n.has(d)||r>a.get(d))){const g=this.linkService.getDestinationHash(o);n.set(d,g),a.set(d,r)}}l.length>0&&i.push({nesting:r+1,items:l})}}return this._pageNumberToDestHashCapability.resolve(n.size>0?n:null),this._pageNumberToDestHashCapability.promise})}}const eP=3e3,oT="pdfPresentationMode",zx="pdfPresentationModeControls",tP=50,nP=.1,lT=50,Yx=Math.PI/6;class aP{constructor({container:e,pdfViewer:n,eventBus:a}){Ae(this,c0);Ae(this,Fu);Ae(this,d0);Ae(this,u0);Ae(this,f0);Ae(this,p0);Ae(this,Xm);Ae(this,h0);Ae(this,Pu);Ae(this,g0);Ae(this,m0);Ae(this,b0);Ae(this,y0);Ae(this,Zm);Ae(this,Pp,Oi.UNKNOWN);Ae(this,As,null);Ae(this,qc,null);Ae(this,Wc,null);this.container=e,this.pdfViewer=n,this.eventBus=a,this.contextMenuOpen=!1,this.mouseScrollTimeStamp=0,this.mouseScrollDelta=0,this.touchSwipeState=null}request(){return Rt(this,null,function*(){const{container:e,pdfViewer:n}=this;if(this.active||!n.pagesCount||!e.requestFullscreen)return!1;Se(this,y0,e5).call(this),Se(this,Fu,ly).call(this,Oi.CHANGING);const a=e.requestFullscreen();it(this,As,{pageNumber:n.currentPageNumber,scaleValue:n.currentScaleValue,scrollMode:n.scrollMode,spreadMode:null,annotationEditorMode:null}),n.spreadMode!==Na.NONE&&!(n.pageViewsReady&&n.hasEqualPageSizes)&&(console.warn("Ignoring Spread modes when entering PresentationMode, since the document may contain varying page sizes."),ie(this,As).spreadMode=n.spreadMode),n.annotationEditorMode!==Bt.AnnotationEditorType.DISABLE&&(ie(this,As).annotationEditorMode=n.annotationEditorMode);try{return yield a,n.focus(),!0}catch(i){Se(this,Zm,Ok).call(this),Se(this,Fu,ly).call(this,Oi.NORMAL)}return!1})}get active(){return ie(this,Pp)===Oi.CHANGING||ie(this,Pp)===Oi.FULLSCREEN}}Pp=new WeakMap,As=new WeakMap,qc=new WeakMap,Wc=new WeakMap,c0=new WeakSet,zI=function(e){if(!this.active)return;e.preventDefault();const n=e4(e),a=Date.now(),i=this.mouseScrollTimeStamp;if(!(a>i&&a-i<tP)&&((this.mouseScrollDelta>0&&n<0||this.mouseScrollDelta<0&&n>0)&&Se(this,Pu,cy).call(this),this.mouseScrollDelta+=n,Math.abs(this.mouseScrollDelta)>=nP)){const s=this.mouseScrollDelta;Se(this,Pu,cy).call(this),(s>0?this.pdfViewer.previousPage():this.pdfViewer.nextPage())&&(this.mouseScrollTimeStamp=a)}},Fu=new WeakSet,ly=function(e){it(this,Pp,e),this.eventBus.dispatch("presentationmodechanged",{source:this,state:e})},d0=new WeakSet,YI=function(){Se(this,Fu,ly).call(this,Oi.FULLSCREEN),this.container.classList.add(oT),setTimeout(()=>{this.pdfViewer.scrollMode=On.PAGE,ie(this,As).spreadMode!==null&&(this.pdfViewer.spreadMode=Na.NONE),this.pdfViewer.currentPageNumber=ie(this,As).pageNumber,this.pdfViewer.currentScaleValue="page-fit",ie(this,As).annotationEditorMode!==null&&(this.pdfViewer.annotationEditorMode={mode:Bt.AnnotationEditorType.NONE})},0),Se(this,m0,JI).call(this),Se(this,Xm,$k).call(this),this.contextMenuOpen=!1,document.getSelection().empty()},u0=new WeakSet,GI=function(){const e=this.pdfViewer.currentPageNumber;this.container.classList.remove(oT),setTimeout(()=>{Se(this,Zm,Ok).call(this),Se(this,Fu,ly).call(this,Oi.NORMAL),this.pdfViewer.scrollMode=ie(this,As).scrollMode,ie(this,As).spreadMode!==null&&(this.pdfViewer.spreadMode=ie(this,As).spreadMode),this.pdfViewer.currentScaleValue=ie(this,As).scaleValue,this.pdfViewer.currentPageNumber=e,ie(this,As).annotationEditorMode!==null&&(this.pdfViewer.annotationEditorMode={mode:ie(this,As).annotationEditorMode}),it(this,As,null)},0),Se(this,b0,QI).call(this),Se(this,h0,XI).call(this),Se(this,Pu,cy).call(this),this.contextMenuOpen=!1},f0=new WeakSet,jI=function(e){var n;if(this.contextMenuOpen){this.contextMenuOpen=!1,e.preventDefault();return}e.button===0&&(e.target.href&&((n=e.target.parentNode)!=null&&n.hasAttribute("data-internal-link"))||(e.preventDefault(),e.shiftKey?this.pdfViewer.previousPage():this.pdfViewer.nextPage()))},p0=new WeakSet,KI=function(){this.contextMenuOpen=!0},Xm=new WeakSet,$k=function(){this.controlsTimeout?clearTimeout(this.controlsTimeout):this.container.classList.add(zx),this.controlsTimeout=setTimeout(()=>{this.container.classList.remove(zx),delete this.controlsTimeout},eP)},h0=new WeakSet,XI=function(){this.controlsTimeout&&(clearTimeout(this.controlsTimeout),this.container.classList.remove(zx),delete this.controlsTimeout)},Pu=new WeakSet,cy=function(){this.mouseScrollTimeStamp=0,this.mouseScrollDelta=0},g0=new WeakSet,ZI=function(e){if(this.active){if(e.touches.length>1){this.touchSwipeState=null;return}switch(e.type){case"touchstart":this.touchSwipeState={startX:e.touches[0].pageX,startY:e.touches[0].pageY,endX:e.touches[0].pageX,endY:e.touches[0].pageY};break;case"touchmove":if(this.touchSwipeState===null)return;this.touchSwipeState.endX=e.touches[0].pageX,this.touchSwipeState.endY=e.touches[0].pageY,e.preventDefault();break;case"touchend":if(this.touchSwipeState===null)return;let n=0;const a=this.touchSwipeState.endX-this.touchSwipeState.startX,i=this.touchSwipeState.endY-this.touchSwipeState.startY,s=Math.abs(Math.atan2(i,a));Math.abs(a)>lT&&(s<=Yx||s>=Math.PI-Yx)?n=a:Math.abs(i)>lT&&Math.abs(s-Math.PI/2)<=Yx&&(n=i),n>0?this.pdfViewer.previousPage():n<0&&this.pdfViewer.nextPage();break}}},m0=new WeakSet,JI=function(){if(ie(this,Wc))return;it(this,Wc,new AbortController);const{signal:e}=ie(this,Wc),n=Se(this,g0,ZI).bind(this);window.addEventListener("mousemove",Se(this,Xm,$k).bind(this),{signal:e}),window.addEventListener("mousedown",Se(this,f0,jI).bind(this),{signal:e}),window.addEventListener("wheel",Se(this,c0,zI).bind(this),{passive:!1,signal:e}),window.addEventListener("keydown",Se(this,Pu,cy).bind(this),{signal:e}),window.addEventListener("contextmenu",Se(this,p0,KI).bind(this),{signal:e}),window.addEventListener("touchstart",n,{signal:e}),window.addEventListener("touchmove",n,{signal:e}),window.addEventListener("touchend",n,{signal:e})},b0=new WeakSet,QI=function(){var e;(e=ie(this,Wc))==null||e.abort(),it(this,Wc,null)},y0=new WeakSet,e5=function(){ie(this,qc)||(it(this,qc,new AbortController),window.addEventListener("fullscreenchange",()=>{document.fullscreenElement?Se(this,d0,YI).call(this):Se(this,u0,GI).call(this)},{signal:ie(this,qc).signal}))},Zm=new WeakSet,Ok=function(){var e;(e=ie(this,qc))==null||e.abort(),it(this,qc,null)};class cT{constructor({pdfPage:e,annotationStorage:n=null,linkService:a,xfaHtml:i=null}){this.pdfPage=e,this.annotationStorage=n,this.linkService=a,this.xfaHtml=i,this.div=null,this._cancelled=!1}render(e,n="display"){return Rt(this,null,function*(){if(n==="print"){const s={viewport:e.clone({dontFlip:!0}),div:this.div,xfaHtml:this.xfaHtml,annotationStorage:this.annotationStorage,linkService:this.linkService,intent:n};return this.div=document.createElement("div"),s.div=this.div,Bt.XfaLayer.render(s)}const a=yield this.pdfPage.getXfa();if(this._cancelled||!a)return{textDivs:[]};const i={viewport:e.clone({dontFlip:!0}),div:this.div,xfaHtml:a,annotationStorage:this.annotationStorage,linkService:this.linkService,intent:n};return this.div?Bt.XfaLayer.update(i):(this.div=document.createElement("div"),i.div=this.div,Bt.XfaLayer.render(i))})}cancel(){this._cancelled=!0}hide(){this.div&&(this.div.hidden=!0)}}function iP(t,e){const n=e.allXfaHtml,a=new Mx,i=Math.round(Bt.PixelsPerInch.PDF_TO_CSS_UNITS*100)/100;for(const s of n.children){const r=document.createElement("div");r.className="xfaPrintedPage",t.append(r);const o=new cT({pdfPage:null,annotationStorage:e.annotationStorage,linkService:a,xfaHtml:s}),l=(0,Bt.getXfaPageViewport)(s,{scale:i});o.render(l,"print"),r.append(o.div)}}let wr=null,_o=null,dc=null,dT={initialized:!1};function sP(t,e,n,a,i,s,r){const o=wr.scratchCanvas,l=i/Bt.PixelsPerInch.PDF;o.width=Math.floor(a.width*l),o.height=Math.floor(a.height*l);const c=o.getContext("2d");return c.save(),c.fillStyle="rgb(255, 255, 255)",c.fillRect(0,0,o.width,o.height),c.restore(),Promise.all([e.getPage(n),r]).then(function([d,u]){const g={canvasContext:c,transform:[l,0,0,l,0,0],viewport:d.getViewport({scale:1,rotation:a.rotation}),intent:"print",annotationMode:Bt.AnnotationMode.ENABLE_STORAGE,optionalContentConfigPromise:s,printAnnotationStorage:u};return d.render(g).promise.catch(h=>{throw h instanceof Bt.RenderingCancelledException||console.error(h),h})})}class rP{constructor({pdfDocument:e,pagesOverview:n,printContainer:a,printResolution:i,printAnnotationStoragePromise:s=null}){this.pdfDocument=e,this.pagesOverview=n,this.printContainer=a,this._printResolution=i||150,this._optionalContentConfigPromise=e.getOptionalContentConfig({intent:"print"}),this._printAnnotationStoragePromise=s||Promise.resolve(),this.currentPage=-1,this.scratchCanvas=document.createElement("canvas")}layout(){this.throwIfInactive();const e=document.querySelector("body");e.setAttribute("data-pdfjsprinting",!0);const{width:n,height:a}=this.pagesOverview[0];this.pagesOverview.every(s=>s.width===n&&s.height===a)||console.warn("Not all pages have the same size. The printed result may be incorrect!"),this.pageStyleSheet=document.createElement("style"),this.pageStyleSheet.textContent=`@page { size: ${n}pt ${a}pt;}`,e.append(this.pageStyleSheet)}destroy(){if(wr!==this)return;this.printContainer.textContent="",document.querySelector("body").removeAttribute("data-pdfjsprinting"),this.pageStyleSheet&&(this.pageStyleSheet.remove(),this.pageStyleSheet=null),this.scratchCanvas.width=this.scratchCanvas.height=0,this.scratchCanvas=null,wr=null,Kx().then(function(){dc.active===_o&&dc.close(_o)})}renderPages(){if(this.pdfDocument.isPureXfa)return iP(this.printContainer,this.pdfDocument),Promise.resolve();const e=this.pagesOverview.length,n=(a,i)=>{if(this.throwIfInactive(),++this.currentPage>=e){fT(e,e),a();return}const s=this.currentPage;fT(s,e),sP(this,this.pdfDocument,s+1,this.pagesOverview[s],this._printResolution,this._optionalContentConfigPromise,this._printAnnotationStoragePromise).then(this.useRenderedPage.bind(this)).then(function(){n(a,i)},i)};return new Promise(n)}useRenderedPage(){this.throwIfInactive();const e=document.createElement("img");this.scratchCanvas.toBlob(r=>{e.src=URL.createObjectURL(r)});const n=document.createElement("div");n.className="printedPage",n.append(e),this.printContainer.append(n);const{promise:a,resolve:i,reject:s}=Promise.withResolvers();return e.onload=i,e.onerror=s,a.catch(()=>{}).then(()=>{URL.revokeObjectURL(e.src)}),a}performPrint(){return this.throwIfInactive(),new Promise(e=>{setTimeout(()=>{if(!this.active){e();return}oP.call(window),setTimeout(e,20)},0)})}get active(){return this===wr}throwIfInactive(){if(!this.active)throw new Error("This print request was cancelled or completed.")}}const oP=window.print;window.print=function(){if(wr){console.warn("Ignored window.print() because of a pending print job.");return}Kx().then(function(){wr&&dc.open(_o)});try{uT("beforeprint")}finally{if(!wr){console.error("Expected print service to be initialized."),Kx().then(function(){dc.active===_o&&dc.close(_o)});return}const t=wr;wr.renderPages().then(function(){return t.performPrint()}).catch(function(){}).then(function(){t.active&&Gx()})}};function uT(t){const e=new CustomEvent(t,{bubbles:!1,cancelable:!1,detail:"custom"});window.dispatchEvent(e)}function Gx(){wr&&(wr.destroy(),uT("afterprint"))}function fT(t,e){if(typeof PDFJSDev=="undefined"&&window.isGECKOVIEW)return;_o||(_o=document.getElementById("printServiceDialog"));const n=Math.round(100*t/e),a=_o.querySelector("progress"),i=_o.querySelector(".relative-progress");a.value=n,i.setAttribute("data-l10n-args",JSON.stringify({progress:n}))}if("onbeforeprint"in window){const t=function(e){e.detail!=="custom"&&e.stopImmediatePropagation()};window.addEventListener("beforeprint",t),window.addEventListener("afterprint",t)}let jx;function Kx(){if(typeof PDFJSDev=="undefined"&&window.isGECKOVIEW)return Promise.reject(new Error("ensureOverlay not implemented in GECKOVIEW development mode."));if(!jx){if(dc=dT.overlayManager,!dc)throw new Error("The overlay manager has not yet been initialized.");_o||(_o=document.getElementById("printServiceDialog")),jx=dc.register(_o,!0),document.getElementById("printCancel").onclick=Gx,_o.addEventListener("close",Gx)}return jx}class pT{static initGlobals(e){dT=e}static get supportsPrinting(){return(0,Bt.shadow)(this,"supportsPrinting",!0)}static createPrintService(e){if(wr)throw new Error("The print service is created and active.");return wr=new rP(e)}}const lP=3e4;class hT{constructor(){this.pdfViewer=null,this.pdfThumbnailViewer=null,this.onIdle=null,this.highestPriorityPage=null,this.idleTimeout=null,this.printing=!1,this.isThumbnailViewEnabled=!1,(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&Object.defineProperty(this,"hasViewer",{value:()=>!!this.pdfViewer})}setViewer(e){this.pdfViewer=e}setThumbnailViewer(e){this.pdfThumbnailViewer=e}isHighestPriority(e){return this.highestPriorityPage===e.renderingId}renderHighestPriority(e){var n;this.idleTimeout&&(clearTimeout(this.idleTimeout),this.idleTimeout=null),!this.pdfViewer.forceRendering(e)&&(this.isThumbnailViewEnabled&&((n=this.pdfThumbnailViewer)!=null&&n.forceRendering())||this.printing||this.onIdle&&(this.idleTimeout=setTimeout(this.onIdle.bind(this),lP)))}getHighestPriority(e,n,a,i=!1){const s=e.views,r=s.length;if(r===0)return null;for(let u=0;u<r;u++){const g=s[u].view;if(!this.isViewFinished(g))return g}const o=e.first.id,l=e.last.id;if(l-o+1>r){const u=e.ids;for(let g=1,f=l-o;g<f;g++){const h=a?o+g:l-g;if(u.has(h))continue;const m=n[h-1];if(!this.isViewFinished(m))return m}}let c=a?l:o-2,d=n[c];return d&&!this.isViewFinished(d)||i&&(c+=a?1:-1,d=n[c],d&&!this.isViewFinished(d))?d:null}isViewFinished(e){return e.renderingState===aa.FINISHED}renderView(e){switch(e.renderingState){case aa.FINISHED:return!1;case aa.PAUSED:this.highestPriorityPage=e.renderingId,e.resume();break;case aa.RUNNING:this.highestPriorityPage=e.renderingId;break;case aa.INITIAL:this.highestPriorityPage=e.renderingId,e.draw().finally(()=>{this.renderHighestPriority()}).catch(n=>{n instanceof Bt.RenderingCancelledException||console.error(`renderView: "${n}"`)});break}return!0}}class cP{constructor({eventBus:e,externalServices:n=null,docProperties:a=null}){Ae(this,_0);Ae(this,Bp);Ae(this,eb);Ae(this,w0);Ae(this,Ou);Ae(this,sl,null);Ae(this,Nu,null);Ae(this,Jm,null);Ae(this,Bu,null);Ae(this,$u,null);Ae(this,Qm,null);Ae(this,Vs,null);Ae(this,Ol,null);Ae(this,Np,!1);Ae(this,Ni,null);Ae(this,eo,null);it(this,$u,e),it(this,Qm,n),it(this,Jm,a),typeof PDFJSDev!="undefined"&&PDFJSDev.test("TESTING")&&Object.defineProperty(this,"sandboxTrip",{value:()=>setTimeout(()=>{var i;return(i=ie(this,Ni))==null?void 0:i.dispatchEventInSandbox({name:"sandboxtripbegin"})},0)})}setViewer(e){it(this,Ol,e)}setDocument(e){return Rt(this,null,function*(){var o;if(ie(this,Vs)&&(yield Se(this,Ou,dy).call(this)),it(this,Vs,e),!e)return;const[n,a,i]=yield Promise.all([e.getFieldObjects(),e.getCalculationOrderIds(),e.getJSActions()]);if(!n&&!i){yield Se(this,Ou,dy).call(this);return}if(e!==ie(this,Vs))return;try{it(this,Ni,Se(this,w0,n5).call(this))}catch(l){console.error(`setDocument: "${l.message}".`),yield Se(this,Ou,dy).call(this);return}const s=ie(this,$u);it(this,Bu,new AbortController);const{signal:r}=ie(this,Bu);s._on("updatefromsandbox",l=>{(l==null?void 0:l.source)===window&&Se(this,_0,t5).call(this,l.detail)},{signal:r}),s._on("dispatcheventinsandbox",l=>{var c;(c=ie(this,Ni))==null||c.dispatchEventInSandbox(l.detail)},{signal:r}),s._on("pagechanging",({pageNumber:l,previous:c})=>{l!==c&&(Se(this,eb,Rk).call(this,c),Se(this,Bp,iv).call(this,l))},{signal:r}),s._on("pagerendered",({pageNumber:l})=>{this._pageOpenPending.has(l)&&l===ie(this,Ol).currentPageNumber&&Se(this,Bp,iv).call(this,l)},{signal:r}),s._on("pagesdestroy",()=>Rt(this,null,function*(){var l,c;yield Se(this,eb,Rk).call(this,ie(this,Ol).currentPageNumber),yield(l=ie(this,Ni))==null?void 0:l.dispatchEventInSandbox({id:"doc",name:"WillClose"}),(c=ie(this,sl))==null||c.resolve()}),{signal:r});try{const l=yield ie(this,Jm).call(this,e);if(e!==ie(this,Vs))return;yield ie(this,Ni).createSandbox({objects:n,calculationOrder:a,appInfo:{platform:navigator.platform,language:navigator.language},docInfo:ld(Ys({},l),{actions:i})}),s.dispatch("sandboxcreated",{source:this})}catch(l){console.error(`setDocument: "${l.message}".`),yield Se(this,Ou,dy).call(this);return}yield(o=ie(this,Ni))==null?void 0:o.dispatchEventInSandbox({id:"doc",name:"Open"}),yield Se(this,Bp,iv).call(this,ie(this,Ol).currentPageNumber,!0),Promise.resolve().then(()=>{e===ie(this,Vs)&&it(this,Np,!0)})})}dispatchWillSave(){return Rt(this,null,function*(){var e;return(e=ie(this,Ni))==null?void 0:e.dispatchEventInSandbox({id:"doc",name:"WillSave"})})}dispatchDidSave(){return Rt(this,null,function*(){var e;return(e=ie(this,Ni))==null?void 0:e.dispatchEventInSandbox({id:"doc",name:"DidSave"})})}dispatchWillPrint(){return Rt(this,null,function*(){var e;if(ie(this,Ni)){yield(e=ie(this,eo))==null?void 0:e.promise,it(this,eo,Promise.withResolvers());try{yield ie(this,Ni).dispatchEventInSandbox({id:"doc",name:"WillPrint"})}catch(n){throw ie(this,eo).resolve(),it(this,eo,null),n}yield ie(this,eo).promise}})}dispatchDidPrint(){return Rt(this,null,function*(){var e;return(e=ie(this,Ni))==null?void 0:e.dispatchEventInSandbox({id:"doc",name:"DidPrint"})})}get destroyPromise(){var e;return((e=ie(this,Nu))==null?void 0:e.promise)||null}get ready(){return ie(this,Np)}get _pageOpenPending(){return(0,Bt.shadow)(this,"_pageOpenPending",new Set)}get _visitedPages(){return(0,Bt.shadow)(this,"_visitedPages",new Map)}}sl=new WeakMap,Nu=new WeakMap,Jm=new WeakMap,Bu=new WeakMap,$u=new WeakMap,Qm=new WeakMap,Vs=new WeakMap,Ol=new WeakMap,Np=new WeakMap,Ni=new WeakMap,eo=new WeakMap,_0=new WeakSet,t5=function(e){return Rt(this,null,function*(){var c,d;const n=ie(this,Ol),a=n.isInPresentationMode||n.isChangingPresentationMode,{id:i,siblings:s,command:r,value:o}=e;if(!i){if(typeof PDFJSDev!="undefined"&&PDFJSDev.test("TESTING")&&r==="sandboxTripEnd"){window.setTimeout(()=>{window.dispatchEvent(new CustomEvent("sandboxtripend"))},0);return}switch(r){case"clear":console.clear();break;case"error":console.error(o);break;case"layout":if(!a){const u=jA(o);n.spreadMode=u.spreadMode}break;case"page-num":n.currentPageNumber=o+1;break;case"print":yield n.pagesPromise,ie(this,$u).dispatch("print",{source:this});break;case"println":console.log(o);break;case"zoom":a||(n.currentScaleValue=o);break;case"SaveAs":ie(this,$u).dispatch("download",{source:this});break;case"FirstPage":n.currentPageNumber=1;break;case"LastPage":n.currentPageNumber=n.pagesCount;break;case"NextPage":n.nextPage();break;case"PrevPage":n.previousPage();break;case"ZoomViewIn":a||n.increaseScale();break;case"ZoomViewOut":a||n.decreaseScale();break;case"WillPrintFinished":(c=ie(this,eo))==null||c.resolve(),it(this,eo,null);break}return}if(a&&e.focus)return;delete e.id,delete e.siblings;const l=s?[i,...s]:[i];for(const u of l){const g=document.querySelector(`[data-element-id="${u}"]`);g?g.dispatchEvent(new CustomEvent("updatefromsandbox",{detail:e})):(d=ie(this,Vs))==null||d.annotationStorage.setValue(u,e)}})},Bp=new WeakSet,iv=function(e,n=!1){return Rt(this,null,function*(){const a=ie(this,Vs),i=this._visitedPages;if(n&&it(this,sl,Promise.withResolvers()),!ie(this,sl))return;const s=ie(this,Ol).getPageView(e-1);if((s==null?void 0:s.renderingState)!==aa.FINISHED){this._pageOpenPending.add(e);return}this._pageOpenPending.delete(e);const r=Rt(this,null,function*(){var l,c;const o=yield i.has(e)?null:(l=s.pdfPage)==null?void 0:l.getJSActions();a===ie(this,Vs)&&(yield(c=ie(this,Ni))==null?void 0:c.dispatchEventInSandbox({id:"page",name:"PageOpen",pageNumber:e,actions:o}))});i.set(e,r)})},eb=new WeakSet,Rk=function(e){return Rt(this,null,function*(){var s;const n=ie(this,Vs),a=this._visitedPages;if(!ie(this,sl)||this._pageOpenPending.has(e))return;const i=a.get(e);i&&(a.set(e,null),yield i,n===ie(this,Vs)&&(yield(s=ie(this,Ni))==null?void 0:s.dispatchEventInSandbox({id:"page",name:"PageClose",pageNumber:e})))})},w0=new WeakSet,n5=function(){if(it(this,Nu,Promise.withResolvers()),ie(this,Ni))throw new Error("#initScripting: Scripting already exists.");return ie(this,Qm).createScripting()},Ou=new WeakSet,dy=function(){return Rt(this,null,function*(){var e,n,a,i;if(!ie(this,Ni)){it(this,Vs,null),(e=ie(this,Nu))==null||e.resolve();return}ie(this,sl)&&(yield Promise.race([ie(this,sl).promise,new Promise(s=>{setTimeout(s,1e3)})]).catch(()=>{}),it(this,sl,null)),it(this,Vs,null);try{yield ie(this,Ni).destroySandbox()}catch(s){}(n=ie(this,eo))==null||n.reject(new Error("Scripting destroyed.")),it(this,eo,null),(a=ie(this,Bu))==null||a.abort(),it(this,Bu,null),this._pageOpenPending.clear(),this._visitedPages.clear(),it(this,Ni,null),it(this,Np,!1),(i=ie(this,Nu))==null||i.resolve()})};const dP="--sidebar-width",gT=200,S_="sidebarResizing",mT="pdfSidebarNotification";class uP{constructor({elements:e,eventBus:n,l10n:a}){Ae(this,zc);Ae(this,v0);Ae(this,ab);Ae(this,x0);Ae(this,$p);Ae(this,E0);Ae(this,ib);Ae(this,tb,!1);Ae(this,Ru,null);Ae(this,nb,null);Ae(this,Vc,null);this.isOpen=!1,this.active=Hn.THUMBS,this.isInitialViewSet=!1,this.isInitialEventDispatched=!1,this.onToggled=null,this.onUpdateThumbnails=null,this.outerContainer=e.outerContainer,this.sidebarContainer=e.sidebarContainer,this.toggleButton=e.toggleButton,this.resizer=e.resizer,this.thumbnailButton=e.thumbnailButton,this.outlineButton=e.outlineButton,this.attachmentsButton=e.attachmentsButton,this.layersButton=e.layersButton,this.thumbnailView=e.thumbnailView,this.outlineView=e.outlineView,this.attachmentsView=e.attachmentsView,this.layersView=e.layersView,this._currentOutlineItemButton=e.currentOutlineItemButton,this.eventBus=n,it(this,tb,!1),Se(this,x0,i5).call(this)}reset(){this.isInitialViewSet=!1,this.isInitialEventDispatched=!1,Se(this,ab,Uk).call(this,!0),this.switchView(Hn.THUMBS),this.outlineButton.disabled=!1,this.attachmentsButton.disabled=!1,this.layersButton.disabled=!1,this._currentOutlineItemButton.disabled=!0}get visibleView(){return this.isOpen?this.active:Hn.NONE}setInitialView(e=Hn.NONE){if(!this.isInitialViewSet){if(this.isInitialViewSet=!0,e===Hn.NONE||e===Hn.UNKNOWN){Se(this,zc,sh).call(this);return}this.switchView(e,!0),this.isInitialEventDispatched||Se(this,zc,sh).call(this)}}switchView(e,n=!1){const a=e!==this.active;let i=!1;switch(e){case Hn.NONE:this.isOpen&&this.close();return;case Hn.THUMBS:this.isOpen&&a&&(i=!0);break;case Hn.OUTLINE:if(this.outlineButton.disabled)return;break;case Hn.ATTACHMENTS:if(this.attachmentsButton.disabled)return;break;case Hn.LAYERS:if(this.layersButton.disabled)return;break;default:console.error(`PDFSidebar.switchView: "${e}" is not a valid view.`);return}if(this.active=e,yr(this.thumbnailButton,e===Hn.THUMBS,this.thumbnailView),yr(this.outlineButton,e===Hn.OUTLINE,this.outlineView),yr(this.attachmentsButton,e===Hn.ATTACHMENTS,this.attachmentsView),yr(this.layersButton,e===Hn.LAYERS,this.layersView),n&&!this.isOpen){this.open();return}i&&(this.onUpdateThumbnails(),this.onToggled()),a&&Se(this,zc,sh).call(this)}open(){this.isOpen||(this.isOpen=!0,zo(this.toggleButton,!0),this.outerContainer.classList.add("sidebarMoving","sidebarOpen"),this.active===Hn.THUMBS&&this.onUpdateThumbnails(),this.onToggled(),Se(this,zc,sh).call(this),Se(this,ab,Uk).call(this))}close(e=null){this.isOpen&&(this.isOpen=!1,zo(this.toggleButton,!1),this.outerContainer.classList.add("sidebarMoving"),this.outerContainer.classList.remove("sidebarOpen"),this.onToggled(),Se(this,zc,sh).call(this),(e==null?void 0:e.detail)>0&&this.toggleButton.blur())}toggle(e=null){this.isOpen?this.close(e):this.open()}get outerContainerWidth(){return ie(this,nb)||it(this,nb,this.outerContainer.clientWidth)}}tb=new WeakMap,Ru=new WeakMap,nb=new WeakMap,Vc=new WeakMap,zc=new WeakSet,sh=function(){this.isInitialViewSet&&(this.isInitialEventDispatched||(this.isInitialEventDispatched=!0)),this.eventBus.dispatch("sidebarviewchanged",{source:this,view:this.visibleView})},v0=new WeakSet,a5=function(){this.toggleButton.title=window.siyuan.languages.toggleSidebarNotification2Title,this.isOpen||this.toggleButton.classList.add(mT)},ab=new WeakSet,Uk=function(e=!1){(this.isOpen||e)&&this.toggleButton.classList.remove(mT),e&&(this.toggleButton.title=window.siyuan.languages.toggleSidebarTitle)},x0=new WeakSet,i5=function(){const{eventBus:e,outerContainer:n}=this;this.sidebarContainer.addEventListener("transitionend",i=>{i.target===this.sidebarContainer&&(n.classList.remove("sidebarMoving"),e.dispatch("resize",{source:this}))}),this.toggleButton.addEventListener("click",i=>{this.toggle(i)}),this.thumbnailButton.addEventListener("click",()=>{this.switchView(Hn.THUMBS)}),this.outlineButton.addEventListener("click",()=>{this.switchView(Hn.OUTLINE)}),this.outlineButton.addEventListener("dblclick",()=>{e.dispatch("toggleoutlinetree",{source:this})}),this.attachmentsButton.addEventListener("click",()=>{this.switchView(Hn.ATTACHMENTS)}),this.layersButton.addEventListener("click",()=>{this.switchView(Hn.LAYERS)}),this.layersButton.addEventListener("dblclick",()=>{e.dispatch("resetlayers",{source:this})}),this._currentOutlineItemButton.addEventListener("click",()=>{e.dispatch("currentoutlineitem",{source:this})});const a=(i,s,r)=>{s.disabled=!i,i?Se(this,v0,a5).call(this):this.active===r&&this.switchView(Hn.THUMBS)};e._on("outlineloaded",i=>{a(i.outlineCount,this.outlineButton,Hn.OUTLINE),i.currentOutlineItemPromise.then(s=>{this.isInitialViewSet&&(this._currentOutlineItemButton.disabled=!s)})}),e._on("attachmentsloaded",i=>{a(i.attachmentsCount,this.attachmentsButton,Hn.ATTACHMENTS)}),e._on("layersloaded",i=>{a(i.layersCount,this.layersButton,Hn.LAYERS)}),e._on("presentationmodechanged",i=>{i.state===Oi.NORMAL&&this.visibleView===Hn.THUMBS&&this.onUpdateThumbnails()}),this.resizer.addEventListener("mousedown",i=>{if(i.button!==0)return;n.classList.add(S_),it(this,Ru,new AbortController);const s={signal:ie(this,Ru).signal};window.addEventListener("mousemove",Se(this,E0,s5).bind(this),s),window.addEventListener("mouseup",Se(this,ib,Hk).bind(this),s),window.addEventListener("blur",Se(this,ib,Hk).bind(this),s)}),e._on("resize",i=>{if(i.source!==window||(it(this,nb,null),!ie(this,Vc)))return;if(!this.isOpen){Se(this,$p,sv).call(this,ie(this,Vc));return}n.classList.add(S_);const s=Se(this,$p,sv).call(this,ie(this,Vc));Promise.resolve().then(()=>{n.classList.remove(S_),s&&e.dispatch("resize",{source:this})})})},$p=new WeakSet,sv=function(e=0){const n=Math.floor(this.outerContainerWidth/2);return e>n&&(e=n),e<gT&&(e=gT),e===ie(this,Vc)?!1:(it(this,Vc,e),GA.setProperty(dP,`${e}px`),!0)},E0=new WeakSet,s5=function(e){let n=e.clientX-this.outerContainer.getBoundingClientRect().left;ie(this,tb)&&(n=this.outerContainerWidth-n),Se(this,$p,sv).call(this,n)},ib=new WeakSet,Hk=function(e){var n;this.outerContainer.classList.remove(S_),this.eventBus.dispatch("resize",{source:this}),(n=ie(this,Ru))==null||n.abort(),it(this,Ru,null)};const bT=2,yT=3,fP=98;class Xx{static getCanvas(e,n){const a=ie(this,Op)||it(this,Op,document.createElement("canvas"));a.width=e,a.height=n;const i=a.getContext("2d",{alpha:!1});return i.save(),i.fillStyle="rgb(255, 255, 255)",i.fillRect(0,0,e,n),i.restore(),[a,a.getContext("2d")]}static destroyCanvas(){const e=ie(this,Op);e&&(e.width=0,e.height=0),it(this,Op,null)}}Op=new WeakMap,Ae(Xx,Op,null);class pP{constructor({container:e,eventBus:n,id:a,defaultViewport:i,optionalContentConfigPromise:s,linkService:r,renderingQueue:o,pageColors:l,enableHWA:c}){Ae(this,sb);Ae(this,rb);Ae(this,ob);Ae(this,lb);Ae(this,k0);Ae(this,Rl);this.id=a,this.renderingId="thumbnail"+a,this.pageLabel=null,this.pdfPage=null,this.rotation=0,this.viewport=i,this.pdfPageRotate=i.rotation,this._optionalContentConfigPromise=s||null,this.pageColors=l||null,this.enableHWA=c||!1,this.eventBus=n,this.linkService=r,this.renderingQueue=o,this.renderTask=null,this.renderingState=aa.INITIAL,this.resume=null;const d=document.createElement("a");d.href=r.getAnchorUrl("#page="+a),d.title=window.siyuan.languages.thumbPageTitle.replace("{{page}}",JSON.parse(ie(this,Rl,af)).page),d.setAttribute("data-l10n-id","pdfjs-thumb-page-title"),d.setAttribute("data-l10n-args",ie(this,Rl,af)),d.onclick=function(){return r.goToPage(a),!1},this.anchor=d;const u=document.createElement("div");u.className="thumbnail",u.setAttribute("data-page-number",this.id),this.div=u,Se(this,sb,qk).call(this);const g=document.createElement("div");g.className="thumbnailImage",this._placeholderImg=g,u.append(g),d.append(u),e.append(d)}setPdfPage(e){this.pdfPage=e,this.pdfPageRotate=e.rotate;const n=(this.rotation+this.pdfPageRotate)%360;this.viewport=e.getViewport({scale:1,rotation:n}),this.reset()}reset(){var e;this.cancelRendering(),this.renderingState=aa.INITIAL,this.div.removeAttribute("data-loaded"),(e=this.image)==null||e.replaceWith(this._placeholderImg),Se(this,sb,qk).call(this),this.image&&(this.image.removeAttribute("src"),delete this.image)}update({rotation:e=null}){typeof e=="number"&&(this.rotation=e);const n=(this.rotation+this.pdfPageRotate)%360;this.viewport=this.viewport.clone({scale:1,rotation:n}),this.reset()}cancelRendering(){this.renderTask&&(this.renderTask.cancel(),this.renderTask=null),this.resume=null}draw(){return Rt(this,null,function*(){if(this.renderingState!==aa.INITIAL){console.error("Must be in new state before drawing");return}const{pdfPage:e}=this;if(!e)throw this.renderingState=aa.FINISHED,new Error("pdfPage is not loaded");this.renderingState=aa.RUNNING;const{ctx:n,canvas:a,transform:i}=Se(this,rb,Wk).call(this,bT),s=this.viewport.clone({scale:bT*this.scale}),r=d=>{if(!this.renderingQueue.isHighestPriority(this)){this.renderingState=aa.PAUSED,this.resume=()=>{this.renderingState=aa.RUNNING,d()};return}d()},o={canvasContext:n,transform:i,viewport:s,optionalContentConfigPromise:this._optionalContentConfigPromise,pageColors:this.pageColors},l=this.renderTask=e.render(o);l.onContinue=r;const c=l.promise.then(()=>Se(this,lb,zk).call(this,l,a),d=>Se(this,lb,zk).call(this,l,a,d));return c.finally(()=>{a.width=0,a.height=0,this.eventBus.dispatch("thumbnailrendered",{source:this,pageNumber:this.id,pdfPage:this.pdfPage})}),c})}setImage(e){if(this.renderingState!==aa.INITIAL)return;const{thumbnailCanvas:n,pdfPage:a,scale:i}=e;n&&(this.pdfPage||this.setPdfPage(a),!(i<this.scale)&&(this.renderingState=aa.FINISHED,Se(this,ob,Vk).call(this,n)))}setPageLabel(e){var n;this.pageLabel=typeof e=="string"?e:null,this.anchor.title=window.siyuan.languages.thumbPageTitle.replace("{{page}}",JSON.parse(ie(this,Rl,af)).page),this.anchor.setAttribute("data-l10n-args",ie(this,Rl,af)),this.renderingState===aa.FINISHED&&((n=this.image)==null||n.setAttribute("data-l10n-args",ie(this,Rl,af)))}}sb=new WeakSet,qk=function(){const{width:e,height:n}=this.viewport,a=e/n;this.canvasWidth=fP,this.canvasHeight=this.canvasWidth/a|0,this.scale=this.canvasWidth/e;const{style:i}=this.div;i.setProperty("--thumbnail-width",`${this.canvasWidth}px`),i.setProperty("--thumbnail-height",`${this.canvasHeight}px`)},rb=new WeakSet,Wk=function(e=1,n=this.enableHWA){const a=document.createElement("canvas"),i=a.getContext("2d",{alpha:!1,willReadFrequently:!n}),s=new Bt.OutputScale;a.width=e*this.canvasWidth*s.sx|0,a.height=e*this.canvasHeight*s.sy|0;const r=s.scaled?[s.sx,0,0,s.sy,0,0]:null;return{ctx:i,canvas:a,transform:r}},ob=new WeakSet,Vk=function(e){if(this.renderingState!==aa.FINISHED)throw new Error("#convertCanvasToImage: Rendering has not finished.");const n=Se(this,k0,r5).call(this,e),a=document.createElement("img");a.className="thumbnailImage",a.setAttribute("data-l10n-id","pdfjs-thumb-page-canvas"),a.setAttribute("data-l10n-args",ie(this,Rl,af)),a.src=n.toDataURL(),this.image=a,this.div.setAttribute("data-loaded",!0),this._placeholderImg.replaceWith(a),n.width=0,n.height=0},lb=new WeakSet,zk=function(e,n,a=null){return Rt(this,null,function*(){if(e===this.renderTask&&(this.renderTask=null),!(a instanceof Bt.RenderingCancelledException)&&(this.renderingState=aa.FINISHED,Se(this,ob,Vk).call(this,n),a))throw a})},k0=new WeakSet,r5=function(e){const{ctx:n,canvas:a}=Se(this,rb,Wk).call(this,1,!0);if(e.width<=2*a.width)return n.drawImage(e,0,0,e.width,e.height,0,0,a.width,a.height),a;let i=a.width<<yT,s=a.height<<yT;const[r,o]=Xx.getCanvas(i,s);for(;i>e.width||s>e.height;)i>>=1,s>>=1;for(o.drawImage(e,0,0,e.width,e.height,0,0,i,s);i>2*a.width;)o.drawImage(r,0,0,i,s,0,0,i>>1,s>>1),i>>=1,s>>=1;return n.drawImage(r,0,0,i,s,0,0,a.width,a.height),a},Rl=new WeakSet,af=function(){var e;return JSON.stringify({page:(e=this.pageLabel)!=null?e:this.id})};const hP=-19,Zx="selected";class gP{constructor({container:e,eventBus:n,linkService:a,renderingQueue:i,pageColors:s,abortSignal:r,enableHWA:o}){Ae(this,S0);Ae(this,cb);Ae(this,db);Ae(this,A0);Ae(this,T0);Ae(this,D0);this.container=e,this.eventBus=n,this.linkService=a,this.renderingQueue=i,this.pageColors=s||null,this.enableHWA=o||!1,this.scroll=UA(this.container,Se(this,S0,o5).bind(this),r),Se(this,db,Gk).call(this)}getThumbnail(e){return this._thumbnails[e]}scrollThumbnailIntoView(e){if(!this.pdfDocument)return;const n=this._thumbnails[e-1];if(!n){console.error('scrollThumbnailIntoView: Invalid "pageNumber" parameter.');return}e!==this._currentPageNumber&&(this._thumbnails[this._currentPageNumber-1].div.classList.remove(Zx),n.div.classList.add(Zx));const{first:a,last:i,views:s}=Se(this,cb,Yk).call(this);if(s.length>0){let r=!1;if(e<=a.id||e>=i.id)r=!0;else for(const{id:o,percent:l}of s)if(o===e){r=l<100;break}r&&Cx(n.div,{top:hP})}this._currentPageNumber=e}get pagesRotation(){return this._pagesRotation}set pagesRotation(e){if(!__(e))throw new Error("Invalid thumbnails rotation angle.");if(!this.pdfDocument||this._pagesRotation===e)return;this._pagesRotation=e;const n={rotation:e};for(const a of this._thumbnails)a.update(n)}cleanup(){for(const e of this._thumbnails)e.renderingState!==aa.FINISHED&&e.reset();Xx.destroyCanvas()}setDocument(e){if(this.pdfDocument&&(Se(this,A0,l5).call(this),Se(this,db,Gk).call(this)),this.pdfDocument=e,!e)return;const n=e.getPage(1),a=e.getOptionalContentConfig({intent:"display"});n.then(i=>{var l;const s=e.numPages,r=i.getViewport({scale:1});for(let c=1;c<=s;++c){const d=new pP({container:this.container,eventBus:this.eventBus,id:c,defaultViewport:r.clone(),optionalContentConfigPromise:a,linkService:this.linkService,renderingQueue:this.renderingQueue,pageColors:this.pageColors,enableHWA:this.enableHWA});this._thumbnails.push(d)}(l=this._thumbnails[0])==null||l.setPdfPage(i),this._thumbnails[this._currentPageNumber-1].div.classList.add(Zx)}).catch(i=>{console.error("Unable to initialize thumbnail viewer",i)})}setPageLabels(e){var n,a;if(this.pdfDocument){e?Array.isArray(e)&&this.pdfDocument.numPages===e.length?this._pageLabels=e:(this._pageLabels=null,console.error("PDFThumbnailViewer_setPageLabels: Invalid page labels.")):this._pageLabels=null;for(let i=0,s=this._thumbnails.length;i<s;i++)this._thumbnails[i].setPageLabel((a=(n=this._pageLabels)==null?void 0:n[i])!=null?a:null)}}forceRendering(){const e=Se(this,cb,Yk).call(this),n=Se(this,D0,d5).call(this,e),a=this.renderingQueue.getHighestPriority(e,this._thumbnails,n);return a?(Se(this,T0,c5).call(this,a).then(()=>{this.renderingQueue.renderView(a)}),!0):!1}}S0=new WeakSet,o5=function(){this.renderingQueue.renderHighestPriority()},cb=new WeakSet,Yk=function(){return WA({scrollEl:this.container,views:this._thumbnails})},db=new WeakSet,Gk=function(){this._thumbnails=[],this._currentPageNumber=1,this._pageLabels=null,this._pagesRotation=0,this.container.textContent=""},A0=new WeakSet,l5=function(){for(const e of this._thumbnails)e.cancelRendering()},T0=new WeakSet,c5=function(e){return Rt(this,null,function*(){if(e.pdfPage)return e.pdfPage;try{const n=yield this.pdfDocument.getPage(e.id);return e.pdfPage||e.setPdfPage(n),n}catch(n){return console.error("Unable to get page for thumb view",n),null}})},D0=new WeakSet,d5=function(e){var n,a;return((n=e.first)==null?void 0:n.id)===1?!0:((a=e.last)==null?void 0:a.id)===this._thumbnails.length?!1:this.scroll.down};class mP{constructor(e){Ae(this,ub,null);Ae(this,fb,null);Ae(this,pb,null);Ae(this,hb,null);Ae(this,gb,null);Ae(this,Rp,void 0);this.pdfPage=e.pdfPage,this.accessibilityManager=e.accessibilityManager,this.l10n=e.l10n,(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&(this.l10n||(this.l10n=new GenericL10n)),this.annotationEditorLayer=null,this.div=null,this._cancelled=!1,it(this,Rp,e.uiManager),it(this,ub,e.annotationLayer||null),it(this,gb,e.textLayer||null),it(this,fb,e.drawLayer||null),it(this,pb,e.onAppend||null),it(this,hb,e.structTreeLayer||null)}render(e,n="display"){return Rt(this,null,function*(){var r;if(n!=="display"||this._cancelled)return;const a=e.clone({dontFlip:!0});if(this.div){this.annotationEditorLayer.update({viewport:a}),this.show();return}const i=this.div=document.createElement("div");i.className="annotationEditorLayer",i.hidden=!0,i.dir=ie(this,Rp).direction,(r=ie(this,pb))==null||r.call(this,i),this.annotationEditorLayer=new Bt.AnnotationEditorLayer({uiManager:ie(this,Rp),div:i,structTreeLayer:ie(this,hb),accessibilityManager:this.accessibilityManager,pageIndex:this.pdfPage.pageNumber-1,l10n:this.l10n,viewport:a,annotationLayer:ie(this,ub),textLayer:ie(this,gb),drawLayer:ie(this,fb)});const s={viewport:a,div:i,annotations:null,intent:n};this.annotationEditorLayer.render(s),this.show()})}cancel(){this._cancelled=!0,this.div&&this.annotationEditorLayer.destroy()}hide(){this.div&&(this.div.hidden=!0)}show(){!this.div||this.annotationEditorLayer.isInvisible||(this.div.hidden=!1)}}ub=new WeakMap,fb=new WeakMap,pb=new WeakMap,hb=new WeakMap,gb=new WeakMap,Rp=new WeakMap;class bP{constructor({pdfPage:e,linkService:n,downloadManager:a,annotationStorage:i=null,imageResourcesPath:s="",renderForms:r=!0,enableScripting:o=!1,hasJSActionsPromise:l=null,fieldObjectsPromise:c=null,annotationCanvasMap:d=null,accessibilityManager:u=null,annotationEditorUIManager:g=null,onAppend:f=null}){Ae(this,bb);Ae(this,mb,null);Ae(this,Yc,null);this.pdfPage=e,this.linkService=n,this.downloadManager=a,this.imageResourcesPath=s,this.renderForms=r,this.annotationStorage=i,this.enableScripting=o,this._hasJSActionsPromise=l||Promise.resolve(!1),this._fieldObjectsPromise=c||Promise.resolve(null),this._annotationCanvasMap=d,this._accessibilityManager=u,this._annotationEditorUIManager=g,it(this,mb,f),this.annotationLayer=null,this.div=null,this._cancelled=!1,this._eventBus=n.eventBus}render(e,n,a="display"){return Rt(this,null,function*(){var l,c;if(this.div){if(this._cancelled||!this.annotationLayer)return;this.annotationLayer.update({viewport:e.clone({dontFlip:!0})});return}const[i,s,r]=yield Promise.all([this.pdfPage.getAnnotations({intent:a}),this._hasJSActionsPromise,this._fieldObjectsPromise]);if(this._cancelled)return;const o=this.div=document.createElement("div");if(o.className="annotationLayer",(l=ie(this,mb))==null||l.call(this,o),i.length===0){this.hide();return}this.annotationLayer=new Bt.AnnotationLayer({div:o,accessibilityManager:this._accessibilityManager,annotationCanvasMap:this._annotationCanvasMap,annotationEditorUIManager:this._annotationEditorUIManager,page:this.pdfPage,viewport:e.clone({dontFlip:!0}),structTreeLayer:(n==null?void 0:n.structTreeLayer)||null}),yield this.annotationLayer.render({annotations:i,imageResourcesPath:this.imageResourcesPath,renderForms:this.renderForms,linkService:this.linkService,downloadManager:this.downloadManager,annotationStorage:this.annotationStorage,enableScripting:this.enableScripting,hasJSActions:s,fieldObjects:r}),this.linkService.isInPresentationMode&&Se(this,bb,jk).call(this,Oi.FULLSCREEN),ie(this,Yc)||(it(this,Yc,new AbortController),(c=this._eventBus)==null||c._on("presentationmodechanged",d=>{Se(this,bb,jk).call(this,d.state)},{signal:ie(this,Yc).signal}))})}cancel(){var e;this._cancelled=!0,(e=ie(this,Yc))==null||e.abort(),it(this,Yc,null)}hide(){this.div&&(this.div.hidden=!0)}hasEditableAnnotations(){var e;return!!((e=this.annotationLayer)!=null&&e.hasEditableAnnotations())}}mb=new WeakMap,Yc=new WeakMap,bb=new WeakSet,jk=function(e){if(!this.div)return;let n=!1;switch(e){case Oi.FULLSCREEN:n=!0;break;case Oi.NORMAL:break;default:return}for(const a of this.div.childNodes)a.hasAttribute("data-internal-link")||(a.inert=n)};class yP{constructor(e){Ae(this,rl,null);this.pageIndex=e.pageIndex}render(e="display"){return Rt(this,null,function*(){e!=="display"||ie(this,rl)||this._cancelled||it(this,rl,new Bt.DrawLayer({pageIndex:this.pageIndex}))})}cancel(){this._cancelled=!0,ie(this,rl)&&(ie(this,rl).destroy(),it(this,rl,null))}setParent(e){var n;(n=ie(this,rl))==null||n.setParent(e)}getDrawLayer(){return ie(this,rl)}}rl=new WeakMap;const _T={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},_P=/^H(\d+)$/;class wP{constructor(e,n){Ae(this,yb);Ae(this,C0);Ae(this,_b);Ae(this,Up,void 0);Ae(this,Lo,null);Ae(this,Hp,void 0);Ae(this,qp,new Map);Ae(this,Wp,void 0);Ae(this,Gc,null);it(this,Up,e.getStructTree()),it(this,Wp,n)}render(){return Rt(this,null,function*(){var i;if(ie(this,Hp))return ie(this,Hp);const{promise:e,resolve:n,reject:a}=Promise.withResolvers();it(this,Hp,e);try{it(this,Lo,Se(this,_b,Xk).call(this,yield ie(this,Up)))}catch(s){a(s)}return it(this,Up,null),(i=ie(this,Lo))==null||i.classList.add("structTree"),n(ie(this,Lo)),e})}getAriaAttributes(e){return Rt(this,null,function*(){return yield this.render(),ie(this,qp).get(e)})}hide(){ie(this,Lo)&&!ie(this,Lo).hidden&&(ie(this,Lo).hidden=!0)}show(){var e;(e=ie(this,Lo))!=null&&e.hidden&&(ie(this,Lo).hidden=!1)}addElementsToTextLayer(){var e;if(ie(this,Gc)){for(const[n,a]of ie(this,Gc))(e=document.getElementById(n))==null||e.append(a);ie(this,Gc).clear(),it(this,Gc,null)}}}Up=new WeakMap,Lo=new WeakMap,Hp=new WeakMap,qp=new WeakMap,Wp=new WeakMap,Gc=new WeakMap,yb=new WeakSet,Kk=function(e,n){const{alt:a,id:i,lang:s}=e;if(a!==void 0){let r=!1;const o=qf(a);for(const l of e.children)if(l.type==="annotation"){let c=ie(this,qp).get(l.id);c||(c=new Map,ie(this,qp).set(l.id,c)),c.set("aria-label",o),r=!0}r||n.setAttribute("aria-label",o)}i!==void 0&&n.setAttribute("aria-owns",i),s!==void 0&&n.setAttribute("lang",qf(s,!0))},C0=new WeakSet,u5=function(e,n){const{alt:a,bbox:i,children:s}=e,r=s==null?void 0:s[0];if(!ie(this,Wp)||!a||!i||(r==null?void 0:r.type)!=="content")return!1;const{id:o}=r;if(!o)return!1;n.setAttribute("aria-owns",o);const l=document.createElement("span");(ie(this,Gc)||it(this,Gc,new Map)).set(o,l),l.setAttribute("role","img"),l.setAttribute("aria-label",qf(a));const{pageHeight:c,pageX:d,pageY:u}=ie(this,Wp),g="calc(var(--scale-factor)*",{style:f}=l;return f.width=`${g}${i[2]-i[0]}px)`,f.height=`${g}${i[3]-i[1]}px)`,f.left=`${g}${i[0]-d}px)`,f.top=`${g}${c-i[3]+u}px)`,!0},_b=new WeakSet,Xk=function(e){if(!e)return null;const n=document.createElement("span");if("role"in e){const{role:a}=e,i=a.match(_P);if(i?(n.setAttribute("role","heading"),n.setAttribute("aria-level",i[1])):_T[a]&&n.setAttribute("role",_T[a]),a==="Figure"&&Se(this,C0,u5).call(this,e,n))return n}if(Se(this,yb,Kk).call(this,e,n),e.children)if(e.children.length===1&&"id"in e.children[0])Se(this,yb,Kk).call(this,e.children[0],n);else for(const a of e.children)n.append(Se(this,_b,Xk).call(this,a));return n};const zp=class zp{constructor(){Ae(this,wb);Ae(this,Ul,!1);Ae(this,to,null);Ae(this,Hl,new Map);Ae(this,jc,new Map)}setTextMapping(e){it(this,to,e)}enable(){if(ie(this,Ul))throw new Error("TextAccessibilityManager is already enabled.");if(!ie(this,to))throw new Error("Text divs and strings have not been set.");if(it(this,Ul,!0),it(this,to,ie(this,to).slice()),ie(this,to).sort(Se(zp,Vp,rv)),ie(this,Hl).size>0){const e=ie(this,to);for(const[n,a]of ie(this,Hl)){if(!document.getElementById(n)){ie(this,Hl).delete(n);continue}Se(this,wb,Zk).call(this,n,e[a])}}for(const[e,n]of ie(this,jc))this.addPointerInTextLayer(e,n);ie(this,jc).clear()}disable(){ie(this,Ul)&&(ie(this,jc).clear(),it(this,to,null),it(this,Ul,!1))}removePointerInTextLayer(e){if(!ie(this,Ul)){ie(this,jc).delete(e);return}const n=ie(this,to);if(!n||n.length===0)return;const{id:a}=e,i=ie(this,Hl).get(a);if(i===void 0)return;const s=n[i];ie(this,Hl).delete(a);let r=s.getAttribute("aria-owns");r!=null&&r.includes(a)&&(r=r.split(" ").filter(o=>o!==a).join(" "),r?s.setAttribute("aria-owns",r):(s.removeAttribute("aria-owns"),s.setAttribute("role","presentation")))}addPointerInTextLayer(e,n){const{id:a}=e;if(!a)return null;if(!ie(this,Ul))return ie(this,jc).set(e,n),null;n&&this.removePointerInTextLayer(e);const i=ie(this,to);if(!i||i.length===0)return null;const s=sg(i,c=>{var d;return Se(d=zp,Vp,rv).call(d,e,c)<0}),r=Math.max(0,s-1),o=i[r];Se(this,wb,Zk).call(this,a,o),ie(this,Hl).set(a,r);const l=o.parentNode;return l!=null&&l.classList.contains("markedContent")?l.id:null}moveElementInDOM(e,n,a,i){const s=this.addPointerInTextLayer(a,i);if(!e.hasChildNodes())return e.append(n),s;const r=Array.from(e.childNodes).filter(c=>c!==n);if(r.length===0)return s;const o=a||n,l=sg(r,c=>{var d;return Se(d=zp,Vp,rv).call(d,o,c)<0});return l===0?r[0].before(n):r[l-1].after(n),s}};Ul=new WeakMap,to=new WeakMap,Hl=new WeakMap,jc=new WeakMap,Vp=new WeakSet,rv=function(e,n){const a=e.getBoundingClientRect(),i=n.getBoundingClientRect();if(a.width===0&&a.height===0)return 1;if(i.width===0&&i.height===0)return-1;const s=a.y,r=a.y+a.height,o=a.y+a.height/2,l=i.y,c=i.y+i.height,d=i.y+i.height/2;if(o<=l&&d>=r)return-1;if(d<=s&&o>=c)return 1;const u=a.x+a.width/2,g=i.x+i.width/2;return u-g},wb=new WeakSet,Zk=function(e,n){const a=n.getAttribute("aria-owns");a!=null&&a.includes(e)||n.setAttribute("aria-owns",a?`${a} ${e}`:e),n.removeAttribute("role")},Ae(zp,Vp);let Jx=zp;class vP{constructor({findController:e,eventBus:n,pageIndex:a}){Ae(this,Kc,null);this.findController=e,this.matches=[],this.eventBus=n,this.pageIdx=a,this.textDivs=null,this.textContentItemsStr=null,this.enabled=!1}setTextMapping(e,n){this.textDivs=e,this.textContentItemsStr=n}enable(){if(!this.textDivs||!this.textContentItemsStr)throw new Error("Text divs and strings have not been set.");if(this.enabled)throw new Error("TextHighlighter is already enabled.");this.enabled=!0,ie(this,Kc)||(it(this,Kc,new AbortController),this.eventBus._on("updatetextlayermatches",e=>{(e.pageIndex===this.pageIdx||e.pageIndex===-1)&&this._updateMatches()},{signal:ie(this,Kc).signal})),this._updateMatches()}disable(){var e;this.enabled&&(this.enabled=!1,(e=ie(this,Kc))==null||e.abort(),it(this,Kc,null),this._updateMatches(!0))}_convertMatches(e,n){if(!e)return[];const{textContentItemsStr:a}=this;let i=0,s=0;const r=a.length-1,o=[];for(let l=0,c=e.length;l<c;l++){let d=e[l];for(;i!==r&&d>=s+a[i].length;)s+=a[i].length,i++;i===a.length&&console.error("Could not find a matching mapping");const u={begin:{divIdx:i,offset:d-s}};for(d+=n[l];i!==r&&d>s+a[i].length;)s+=a[i].length,i++;u.end={divIdx:i,offset:d-s},o.push(u)}return o}_renderMatches(e){if(e.length===0)return;const{findController:n,pageIdx:a}=this,{textContentItemsStr:i,textDivs:s}=this,r=a===n.selected.pageIdx,o=n.selected.matchIdx,l=n.state.highlightAll;let c=null;const d={divIdx:-1,offset:void 0};function u(y,_){const v=y.divIdx;return s[v].textContent="",g(v,0,y.offset,_)}function g(y,_,v,U){let ee=s[y];if(ee.nodeType===Node.TEXT_NODE){const w=document.createElement("span");ee.before(w),w.append(ee),s[y]=w,ee=w}const Z=i[y].substring(_,v),k=document.createTextNode(Z);if(U){const w=document.createElement("span");return w.className=`${U} appended`,w.append(k),ee.append(w),U.includes("selected")?w.offsetLeft:0}return ee.append(k),0}let f=o,h=f+1;if(l)f=0,h=e.length;else if(!r)return;let m=-1,b=-1;for(let y=f;y<h;y++){const _=e[y],v=_.begin;if(v.divIdx===m&&v.offset===b)continue;m=v.divIdx,b=v.offset;const U=_.end,ee=r&&y===o,Z=ee?" selected":"";let k=0;if(!c||v.divIdx!==c.divIdx?(c!==null&&g(c.divIdx,c.offset,d.offset),u(v)):g(c.divIdx,c.offset,v.offset),v.divIdx===U.divIdx)k=g(v.divIdx,v.offset,U.offset,"highlight"+Z);else{k=g(v.divIdx,v.offset,d.offset,"highlight begin"+Z);for(let w=v.divIdx+1,S=U.divIdx;w<S;w++)s[w].className="highlight middle"+Z;u(U,"highlight end"+Z)}c=U,ee&&n.scrollMatchIntoView({element:s[v.divIdx],selectedLeft:k,pageIndex:a,matchIndex:o})}c&&g(c.divIdx,c.offset,d.offset)}_updateMatches(e=!1){if(!this.enabled&&!e)return;const{findController:n,matches:a,pageIdx:i}=this,{textContentItemsStr:s,textDivs:r}=this;let o=-1;for(const d of a){const u=Math.max(o,d.begin.divIdx);for(let g=u,f=d.end.divIdx;g<=f;g++){const h=r[g];h.textContent=s[g],h.className=""}o=d.end.divIdx+1}if(!(n!=null&&n.highlightMatches)||e)return;const l=n.pageMatches[i]||null,c=n.pageMatchesLength[i]||null;this.matches=this._convertMatches(l,c),this._renderMatches(this.matches)}}Kc=new WeakMap;var wT=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const xP=(t,e)=>{Wd(e);const n=e.appConfig,a=n.toolbar.rectAnno;a.addEventListener("click",()=>{a.classList.contains("toggled")?(a.classList.remove("toggled"),n.mainContainer.classList.remove("rect-to-annotation")):(e.pdfCursorTools.switchTool(0),a.classList.add("toggled"),n.mainContainer.classList.add("rect-to-annotation"),getSelection().rangeCount>0&&getSelection().getRangeAt(0).collapse(!0),uc(t))});const i=n.mainContainer.lastElementChild;return n.mainContainer.addEventListener("mousedown",s=>{if(s.button===2||!a.classList.contains("toggled"))return;let r=e.pdfViewer._getVisiblePages().first.view.canvas.getBoundingClientRect();s.clientX>r.right&&(r=e.pdfViewer._getVisiblePages().last.view.canvas.getBoundingClientRect());const o=n.mainContainer.getBoundingClientRect(),l=r.left,c=r.right,d=o.bottom;let u=s.clientX;s.clientX>c?u=c:s.clientX<l&&(u=l);const g=o.top,f=s.clientY,h=document;h.onmousemove=m=>{i.classList.remove("fn__none");let b=0,y=0,_=0,v=0;m.clientX<u?(m.clientX<l?y=l:y=m.clientX,_=u-y):m.clientX>c?(y=u,_=c-y):(y=u,_=m.clientX-u),m.clientY>f?m.clientY>d?(b=f,v=d-f):(b=f,v=m.clientY-f):(m.clientY<g?b=g:b=m.clientY,v=f-b),i.setAttribute("style",`top:${b}px;height:${v}px;left:${y}px;width:${_}px;background-color:${m.altKey?"var(--b3-pdf-background1)":""}`)},h.onmouseup=()=>{h.onmousemove=null,h.onmouseup=null,h.ondragstart=null,h.onselectstart=null,h.onselect=null,a.classList.remove("toggled"),n.mainContainer.classList.remove("rect-to-annotation");const m=kP(e,window.siyuan.storage[p.LOCAL_PDFTHEME].annoColor||"var(--b3-pdf-background1)",i,i.style.backgroundColor?"text":"border");i.classList.add("fn__none"),m?m.forEach((b,y)=>{const _=A_(b,e);y===0&&(Ka=_,T_(`${e.appConfig.file.replace(location.origin,"").substr(1)}/${Ka.getAttribute("data-node-id")}`,e.appConfig.file.replace(location.origin,"").substr(8).replace(/-\d{14}-\w{7}.pdf$/,""),e))}):Ka=null}}),t.addEventListener("click",s=>{let r=!1,o=s.target;if(typeof s.detail=="string"){window.siyuan.storage[p.LOCAL_PDFTHEME].annoColor=s.detail==="0"?window.siyuan.storage[p.LOCAL_PDFTHEME].annoColor||"var(--b3-pdf-background1)":`var(--b3-pdf-background${s.detail})`,Gt(p.LOCAL_PDFTHEME,window.siyuan.storage[p.LOCAL_PDFTHEME]);const l=ET(e,window.siyuan.storage[p.LOCAL_PDFTHEME].annoColor);l&&l.forEach((c,d)=>{const u=A_(c,e);d===0&&(Ka=u,T_(`${e.appConfig.file.replace(location.origin,"").substr(1)}/${Ka.getAttribute("data-node-id")}`,e.appConfig.file.replace(location.origin,"").substr(8).replace(/-\d{14}-\w{7}.pdf$/,""),e))}),uc(t);return}for(;o&&!o.classList.contains("pdf__outer");){const l=o.getAttribute("data-type");if(o.classList.contains("color__square")){const c=o.style.backgroundColor;if(window.siyuan.storage[p.LOCAL_PDFTHEME].annoColor=c,Gt(p.LOCAL_PDFTHEME,window.siyuan.storage[p.LOCAL_PDFTHEME]),Ka){const d=Wd(e),u=d[Ka.getAttribute("data-node-id")];u.color=c,t.querySelectorAll(`.pdf__rect[data-node-id="${Ka.getAttribute("data-node-id")}"]`).forEach(g=>{Array.from(g.children).forEach(f=>{f.style.border="2px solid "+c,u.type==="text"?f.style.backgroundColor=c:f.style.backgroundColor="transparent"})}),ae("/api/asset/setFileAnnotation",{path:e.appConfig.file.replace(location.origin,"").substr(1)+".sya",data:JSON.stringify(d)})}else{const d=ET(e,c);d&&d.forEach((u,g)=>{const f=A_(u,e);g===0&&(Ka=f,T_(`${e.appConfig.file.replace(location.origin,"").substr(1)}/${Ka.getAttribute("data-node-id")}`,e.appConfig.file.replace(location.origin,"").substr(8).replace(/-\d{14}-\w{7}.pdf$/,""),e))})}uc(t),r=!0,s.preventDefault(),s.stopPropagation();break}else if(o.classList.contains("pdf__rect")){vT(t,void 0,o),s.preventDefault(),s.stopPropagation(),r=!0;break}else if(l==="remove"){const c=e.appConfig.file.replace(location.origin,"").substr(1),d=Wd(e),u=Ka.getAttribute("data-node-id");delete d[u],t.querySelectorAll(`[data-node-id="${u}"]`).forEach(g=>{g.remove()}),ae("/api/asset/setFileAnnotation",{path:c+".sya",data:JSON.stringify(d)}),uc(t),s.preventDefault(),s.stopPropagation(),r=!0;break}else if(l==="copy"){uc(t),T_(`${e.appConfig.file.replace(location.origin,"").substr(1)}/${Ka.getAttribute("data-node-id")}`,e.appConfig.file.replace(location.origin,"").substr(8).replace(/-\d{14}-\w{7}.pdf$/,""),e),s.preventDefault(),s.stopPropagation(),r=!0;break}else if(l==="relate"){EP(e),uc(t),s.preventDefault(),s.stopPropagation(),r=!0;break}else if(l==="toggle"){const c=Wd(e),d=c[Ka.getAttribute("data-node-id")];d.type==="border"?d.type="text":d.type="border",t.querySelectorAll(`.pdf__rect[data-node-id="${Ka.getAttribute("data-node-id")}"]`).forEach(u=>{Array.from(u.children).forEach(g=>{d.type==="text"?g.style.backgroundColor=g.style.border.replace("2px solid ",""):g.style.backgroundColor=""})}),ae("/api/asset/setFileAnnotation",{path:e.appConfig.file.replace(location.origin,"").substr(1)+".sya",data:JSON.stringify(c)}),s.preventDefault(),s.stopPropagation(),r=!0,uc(t);break}o=o.parentElement}r||setTimeout(()=>{let l=!1;const c=window.getSelection();if(c.rangeCount>0){const d=c.getRangeAt(0);d.toString()!==""&&N(d.commonAncestorContainer,"pdfViewer")&&(vT(t,d),l=!0)}l||uc(t)})}),e},Qx=t=>{if(!t)return`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`;let e="";return t.forEach(n=>{e+=`<li data-id="${n}" class="popover__block b3-list-item b3-list-item--narrow b3-list-item--hide-action">
    <span class="b3-list-item__text">${n}</span>
    <span data-type="clear" class="b3-tooltips b3-tooltips__w b3-list-item__action" aria-label="${window.siyuan.languages.delete}">
        <svg><use xlink:href="#iconTrashcan"></use></svg>
    </span>
</li>`}),e},EP=t=>{const e=Wd(t),n=e[Ka.getAttribute("data-node-id")];n.ids||(n.ids=[]);const a=new fe({title:window.siyuan.languages.relation,content:`<div class="b3-dialog__content">
    <div class="fn__flex">
        <input class="b3-text-field fn__flex-1" placeholder="${window.siyuan.languages.fileAnnoRefPlaceholder}">
        <div class="fn__space"></div>
        <button class="b3-button b3-button--text" data-type="add">${window.siyuan.languages.addAttr}</button>
    </div>
    <div class="fn__hr"></div>
    <ul class="b3-list b3-list--background">${Qx(n.ids)}</ul>
</div>`,width:"520px"}),i=()=>{/\d{14}-\w{7}/.test(r.value)?(n.ids.includes(r.value)||(n.ids.push(r.value),s(t,e),Ka.dataset.relations=n.ids,a.element.querySelector(".b3-list").innerHTML=Qx(n.ids)),r.value=""):Q("ID "+window.siyuan.languages.invalid)},s=(o,l)=>{ae("/api/asset/setFileAnnotation",{path:o.appConfig.file.replace(location.origin,"").substr(1)+".sya",data:JSON.stringify(l)})},r=a.element.querySelector(".b3-text-field");r.focus(),r.addEventListener("keydown",o=>{o.isComposing||o.key==="Enter"&&i()}),a.element.addEventListener("click",o=>{let l=o.target;for(;l&&!l.classList.contains("b3-dialog__content");){const c=l.getAttribute("data-type");if(c==="add"){i(),o.preventDefault(),o.stopPropagation();break}else c==="clear"&&(n.ids.splice(n.ids.indexOf(l.parentElement.textContent.trim()),1),s(t,e),Ka.dataset.relations=n.ids,a.element.querySelector(".b3-list").innerHTML=Qx(n.ids));l=l.parentElement}})},uc=t=>{t.querySelector(".pdf__util").classList.add("fn__none")};let Ka;const vT=(t,e,n)=>{n&&(n.setAttribute("prevent-popover","true"),setTimeout(()=>{n.removeAttribute("prevent-popover")},620));const a=t.querySelector(".pdf__util");if(a.classList.remove("fn__none"),e){a.classList.add("pdf__util--hide");const s=e.getClientRects(),r=s[s.length-1];gn(a,r.left,r.bottom),Ka=null;return}Ka=n,a.classList.remove("pdf__util--hide");const i=n.firstElementChild.getBoundingClientRect();gn(a,i.left,i.top+i.height+4)},xT=(t,e)=>{const n=t.querySelectorAll('span[role="presentation"]');let a=e?0:n.length-1;for(;n[a]&&!n[a].textContent;)e?a++:a--;return n[a]},ET=(t,e)=>{const n=window.getSelection().getRangeAt(0),a=N(n.startContainer,"page");if(!a)return;const i=parseInt(a.getAttribute("data-page-number"))-1,s=N(n.endContainer,"page");if(!s)return;const r=parseInt(s.getAttribute("data-page-number"))-1,o=n.cloneContents();Array.from(o.children).forEach(_=>{if(_.tagName==="BR"&&_.previousElementSibling&&_.nextElementSibling){const v=_.previousElementSibling.textContent,U=_.nextElementSibling.textContent;/^[A-Za-z]$/.test(v.substring(v.length-2,v.length-1))&&/^[A-Za-z]$/.test(U.substring(0,1))&&(v.endsWith("-")?_.previousElementSibling.textContent=v.substring(0,v.length-1):_.insertAdjacentText("afterend"," "))}});const l=Lute.EscapeHTMLStr(o.textContent.replace(/[\x00]|\n/g,"")),c=t.pdfViewer.getPageView(i),d=c.canvas.getClientRects()[0],u=c.viewport,g=n.cloneRange();i!==r&&n.setEndAfter(xT(c.textLayer.div,!1));const f=[];kT(n).forEach(function(_){f.push(u.convertToPdfPoint(_.left-d.x,_.top-d.y).concat(u.convertToPdfPoint(_.right-d.x,_.bottom-d.y)))});const h=[];if(i!==r){Pt(g);const _=t.pdfViewer.getPageView(r),v=_.canvas.getClientRects()[0],U=_.viewport;g.setStart(xT(_.textLayer.div,!0),0),kT(g).forEach(function(ee){h.push(U.convertToPdfPoint(ee.left-v.x,ee.top-v.y).concat(U.convertToPdfPoint(ee.right-v.x,ee.bottom-v.y)))})}const m=Lute.NewNodeID(),b=[],y=[];if(f.length>0&&(b.push({index:i,positions:f}),y.push({index:i,coords:f,id:m,color:e,content:l,type:"text",mode:"text"})),h.length>0&&(b.push({index:r,positions:h}),y.push({index:r,coords:h,id:m,color:e,content:l,type:"text",mode:"text"})),b.length!==0)return TT(t,m,{pages:b,content:l,color:e,type:"text",mode:"text"}),y},kP=(t,e,n,a)=>{const i=n.getBoundingClientRect(),s=N(document.elementFromPoint(i.left,i.top-1),"page");if(!s)return;const r=parseInt(s.getAttribute("data-page-number"))-1,o=t.pdfViewer.getPageView(r),l=o.canvas.getClientRects()[0],c=o.viewport,d=c.convertToPdfPoint(i.left-l.x,i.top-l.y).concat(c.convertToPdfPoint(i.right-l.x,i.bottom-l.y)),u=[{index:o.id-1,positions:[d]}],g=Lute.NewNodeID(),f=`${t.appConfig.file.replace(location.origin,"").substr(8).replace(/-\d{14}-\w{7}.pdf$/,"")}-P${o.id}-${g}`,h=[{index:o.id-1,coords:[d],id:g,color:e,content:f,type:a,mode:"rect"}];let m=document.elementFromPoint(i.right,i.bottom+1);if(m=N(m,"page"),m){const b=parseInt(m.getAttribute("data-page-number"))-1;if(b!==r){const y=t.pdfViewer.getPageView(b),_=y.canvas.getClientRects()[0],v=y.viewport,U=v.convertToPdfPoint(i.left-_.x,i.top-_.y).concat(v.convertToPdfPoint(i.right-_.x,i.bottom-_.y));u.push({index:y.id-1,positions:[U]}),h.push({index:y.id-1,coords:[U],id:g,color:e,content:f,type:a,mode:"rect"})}}return TT(t,g,{pages:u,content:f,color:e,type:a,mode:"rect"}),h},kT=t=>{const e=t.getClientRects(),n=[];let a;return Array.from(e).forEach(i=>{i.height===0||i.width===0||(typeof a=="undefined"||Math.abs(a-i.top)>4?(n.push({left:i.left,top:i.top,right:i.right,bottom:i.bottom}),a=i.top):n[n.length-1].right=i.right)}),n},e1=t=>{let e;return Cn().asset.find(n=>{if(n.pdfObject&&t&&n.element&&typeof n.element.contains!="undefined"&&n.element.contains(t))return e=n.pdfObject,!0}),e},ST=t=>{const e=e1(t);if(!e)return;const n=parseInt(t.parentElement.getAttribute("data-page-number"))-1,a=Wd(e);Object.keys(a).find(i=>{const s=a[i],r=s.pages.find(o=>{if(o.index===n)return!0});r&&A_({index:n,coords:r.positions,id:i,color:s.color,content:s.content,type:s.type,mode:s.mode||"",ids:s.ids},e,e.annoId===i)})},A_=(t,e,n)=>{const a=t.index,i=e.pdfViewer.getPageView(a),s=i.textLayer.div;if(!s.lastElementChild)return;const r=i.viewport.clone({rotation:0});let o=s.querySelector(".pdf__rects");o||(s.insertAdjacentHTML("beforeend","<div class='pdf__rects'></div>"),o=s.querySelector(".pdf__rects"));let l=`<div class="pdf__rect popover__block" data-node-id="${t.id}" data-relations="${t.ids||""}" data-mode="${t.mode}">`;return t.coords.forEach(c=>{const d=r.convertToViewportRectangle(c),u=Math.abs(d[0]-d[2]);if(u<=0)return;let g=`border: 2px solid ${t.color};background-color: ${t.color};`;t.type==="border"&&(g=`border: 2px solid ${t.color};`),l+=`<div style="${g}
left:${Math.min(d[0],d[2])}px;
top:${Math.min(d[1],d[3])}px;
width:${u}px;
height: ${Math.abs(d[1]-d[3])}px"></div>`}),o.insertAdjacentHTML("beforeend",l+"</div>"),o.lastElementChild.setAttribute("data-content",t.content),n&&AT(o,t.id),o.lastElementChild},AT=(t,e)=>{t.querySelectorAll(`.pdf__rect[data-node-id="${e}"]`).forEach(n=>{if(n&&n.firstElementChild){const a=ue(n,"id","viewerContainer");if(a){const i=n.firstElementChild.getBoundingClientRect(),s=a.getBoundingClientRect();i.top<s.top?a.scrollTop=a.scrollTop-(s.top-i.top)-(s.height-i.height)/2:i.bottom>s.bottom&&(a.scrollTop=a.scrollTop+(i.bottom-s.bottom)+(s.height-i.height)/2)}n.classList.add("pdf__rect--hl"),setTimeout(()=>{n.classList.remove("pdf__rect--hl")},1500)}})},T_=(t,e,n)=>{const a=Ka.getAttribute("data-mode"),i=Ka.getAttribute("data-content");setTimeout(()=>{a==="rect"||a===""&&Ka.childElementCount===1&&i.startsWith(e)?AP(n).then(s=>{fetch(s).then(r=>r.blob()).then(r=>{const o=new FormData,l=i+".png";o.append("file[]",r,l),o.append("skipIfDuplicated","true"),ae(p.UPLOAD_ADDRESS,o,c=>{ut(`<<${t} "${i}">>
![](${c.data.succMap[l]})`)})})}):ut(`<<${t} "${i}">>`)},p.TIMEOUT_DBLCLICK)},SP=(t,e)=>wT(void 0,null,function*(){const n=yield t.pdfDocument.getPage(e),a=n.getViewport({scale:1.5*t.pdfViewer.currentScale*window.pdfjsLib.PixelsPerInch.PDF_TO_CSS_UNITS}),i=document.createElement("canvas");return i.width=Math.floor(a.width),i.height=Math.floor(a.height),yield n.render({canvasContext:i.getContext("2d"),viewport:a}).promise,i});function AP(t){return wT(this,null,function*(){const e=N(Ka,"page");if(!e)return;const n=yield SP(t,parseInt(e.getAttribute("data-page-number"))),a=Ka.firstElementChild.style,i=1.5,s=n.getContext("2d").getImageData(i*parseFloat(a.left),i*parseFloat(a.top),i*parseFloat(a.width),i*parseFloat(a.height)),r=document.createElement("canvas");return r.width=s.width,r.height=s.height,r.getContext("2d").putImageData(s,0,0),r.toDataURL()})}const TT=(t,e,n)=>{const a=Wd(t);a[e]=n,ae("/api/asset/setFileAnnotation",{path:t.appConfig.file.replace(location.origin,"").substr(1)+".sya",data:JSON.stringify(a)})},Wd=t=>{if(t.appConfig.config)return t.appConfig.config;const e=t.appConfig.file.replace(location.origin,"").substr(1)+".sya";ae("/api/asset/getFileAnnotation",{path:e},n=>{let a={};n.code!==1&&(a=JSON.parse(n.data.data)),t.appConfig.config=a})},ql=class ql{constructor({pdfPage:e,highlighter:n=null,accessibilityManager:a=null,enablePermissions:i=!1,onAppend:s=null}){Ae(this,L0);Ae(this,vb,!1);Ae(this,xb,null);Ae(this,Uu,!1);Ae(this,ol,null);this.pdfPage=e,this.highlighter=n,this.accessibilityManager=a,it(this,vb,i===!0),it(this,xb,s),this.div=document.createElement("div"),this.div.tabIndex=0,this.div.className="textLayer"}render(e,n=null){return Rt(this,null,function*(){var r,o,l,c,d,u;if(ie(this,Uu)&&ie(this,ol)){ie(this,ol).update({viewport:e,onBefore:this.hide.bind(this)}),this.show(),(r=this.div.querySelector(".pdf__rects"))==null||r.remove(),ST(this.div);return}this.cancel(),it(this,ol,new Bt.TextLayer({textContentSource:this.pdfPage.streamTextContent(n||{includeMarkedContent:!0,disableNormalization:!0}),container:this.div,viewport:e}));const{textDivs:a,textContentItemsStr:i}=ie(this,ol);(o=this.highlighter)==null||o.setTextMapping(a,i),(l=this.accessibilityManager)==null||l.setTextMapping(a),yield ie(this,ol).render(),it(this,Uu,!0);const s=document.createElement("div");s.className="endOfContent",this.div.append(s),Se(this,L0,f5).call(this,s),(c=ie(this,xb))==null||c.call(this,this.div),(d=this.highlighter)==null||d.enable(),ST(this.div),(u=this.accessibilityManager)==null||u.enable()})}hide(){var e;!this.div.hidden&&ie(this,Uu)&&((e=this.highlighter)==null||e.disable(),this.div.hidden=!0)}show(){var e;this.div.hidden&&ie(this,Uu)&&(this.div.hidden=!1,(e=this.highlighter)==null||e.enable())}cancel(){var e,n,a,i;(e=ie(this,ol))==null||e.cancel(),it(this,ol,null),(n=this.highlighter)==null||n.disable(),(a=this.accessibilityManager)==null||a.disable(),Se(i=ql,I0,p5).call(i,this.div)}};vb=new WeakMap,xb=new WeakMap,Uu=new WeakMap,ol=new WeakMap,or=new WeakMap,Xc=new WeakMap,L0=new WeakSet,f5=function(e){var a;const{div:n}=this;n.addEventListener("mousedown",()=>{n.classList.add("selecting")}),n.addEventListener("copy",i=>{if(!ie(this,vb)){const s=document.getSelection();i.clipboardData.setData("text/plain",qf((0,Bt.normalizeUnicode)(s.toString())))}i.preventDefault(),i.stopPropagation()}),ie(ql,or).set(n,e),Se(a=ql,M0,h5).call(a)},I0=new WeakSet,p5=function(e){var n;ie(this,or).delete(e),ie(this,or).size===0&&((n=ie(this,Xc))==null||n.abort(),it(this,Xc,null))},M0=new WeakSet,h5=function(){if(ie(this,Xc))return;it(this,Xc,new AbortController);const{signal:e}=ie(this,Xc),n=(r,o)=>{(typeof PDFJSDev=="undefined"||!PDFJSDev.test("MOZCENTRAL"))&&(o.append(r),r.style.width="",r.style.height=""),o.classList.remove("selecting")};let a=!1;if(document.addEventListener("pointerdown",()=>{a=!0},{signal:e}),document.addEventListener("pointerup",()=>{a=!1,ie(this,or).forEach(n)},{signal:e}),window.addEventListener("blur",()=>{a=!1,ie(this,or).forEach(n)},{signal:e}),document.addEventListener("keyup",()=>{a||ie(this,or).forEach(n)},{signal:e}),typeof PDFJSDev=="undefined"||!PDFJSDev.test("MOZCENTRAL"))var i,s;document.addEventListener("selectionchange",()=>{const r=document.getSelection();if(r.rangeCount===0){ie(this,or).forEach(n);return}const o=new Set;for(let f=0;f<r.rangeCount;f++){const h=r.getRangeAt(f);for(const m of ie(this,or).keys())!o.has(m)&&h.intersectsNode(m)&&o.add(m)}for(const[f,h]of ie(this,or))o.has(f)?f.classList.add("selecting"):n(h,f);if(typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL")||(typeof PDFJSDev=="undefined"||!PDFJSDev.test("CHROME"))&&(i!=null||(i=getComputedStyle(ie(this,or).values().next().value).getPropertyValue("-moz-user-select")==="none"),i))return;const l=r.getRangeAt(0),c=s&&(l.compareBoundaryPoints(Range.END_TO_END,s)===0||l.compareBoundaryPoints(Range.START_TO_END,s)===0);let d=c?l.startContainer:l.endContainer;d.nodeType===Node.TEXT_NODE&&(d=d.parentNode);const u=d.parentElement.closest(".textLayer"),g=ie(this,or).get(u);g&&(g.style.width=u.style.width,g.style.height=u.style.height,d.parentElement.insertBefore(g,c?d:d.nextSibling)),s=l.cloneRange()},{signal:e})},Ae(ql,I0),Ae(ql,M0),Ae(ql,or,new Map),Ae(ql,Xc,null);let t1=ql;const TP=typeof PDFJSDev=="undefined"||!PDFJSDev.test("COMPONENTS")?null:{annotationEditorUIManager:null,annotationStorage:null,downloadManager:null,enableScripting:!1,fieldObjectsPromise:null,findController:null,hasJSActionsPromise:null,get linkService(){return new Mx}},DP=new Map([["canvasWrapper",0],["textLayer",1],["annotationLayer",2],["annotationEditorLayer",3],["xfaLayer",3]]);class CP{constructor(e){Ae(this,ed);Ae(this,jp);Ae(this,zu);Ae(this,Db);Ae(this,Cb);Ae(this,Lb);Ae(this,Ib);Ae(this,Mb);Ae(this,F0);Ae(this,P0);Ae(this,Fb);Ae(this,Hu,Bt.AnnotationMode.ENABLE_FORMS);Ae(this,Eb,!1);Ae(this,qu,!1);Ae(this,kb,!1);Ae(this,Zc,null);Ae(this,Jc,null);Ae(this,Sb,null);Ae(this,Ab,1);Ae(this,Tb,1);Ae(this,Wu,null);Ae(this,Yp,aa.INITIAL);Ae(this,Gp,bo.ENABLE);Ae(this,Wl,{directDrawing:!0,initialOptionalContent:!0,regularAnnotations:!0});Ae(this,Vu,new WeakMap);Ae(this,Qc,[null,null,null,null]);var s,r,o,l,c;const n=e.container,a=e.defaultViewport;this.id=e.id,this.renderingId="page"+this.id,it(this,Zc,e.layerProperties||TP),this.pdfPage=null,this.pageLabel=null,this.rotation=0,this.scale=e.scale||Tx,this.viewport=a,this.pdfPageRotate=a.rotation,this._optionalContentConfigPromise=e.optionalContentConfigPromise||null,it(this,Gp,(s=e.textLayerMode)!=null?s:bo.ENABLE),it(this,Hu,(r=e.annotationMode)!=null?r:Bt.AnnotationMode.ENABLE_FORMS),this.imageResourcesPath=e.imageResourcesPath||"",this.maxCanvasPixels=(o=e.maxCanvasPixels)!=null?o:en.get("maxCanvasPixels"),this.pageColors=e.pageColors||null,it(this,Eb,e.enableHWA||!1),this.eventBus=e.eventBus,this.renderingQueue=e.renderingQueue,this.l10n=e.l10n,(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&(this.l10n||(this.l10n=new GenericL10n)),this.renderTask=null,this.resume=null,(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&(this._isStandalone=!((l=this.renderingQueue)!=null&&l.hasViewer()),this._container=n),this._annotationCanvasMap=null,this.annotationLayer=null,this.annotationEditorLayer=null,this.textLayer=null,this.zoomLayer=null,this.xfaLayer=null,this.structTreeLayer=null,this.drawLayer=null;const i=document.createElement("div");if(i.className="page",i.setAttribute("data-page-number",this.id),i.setAttribute("role","region"),i.setAttribute("aria-label",window.siyuan.languages.thumbPageTitle.replace("{{page}}",this.id)),this.div=i,Se(this,jp,ov).call(this),n==null||n.append(i),(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&this._isStandalone){n==null||n.style.setProperty("--scale-factor",this.scale*Bt.PixelsPerInch.PDF_TO_CSS_UNITS),(c=this.pageColors)!=null&&c.background&&(n==null||n.style.setProperty("--page-bg-color",this.pageColors.background));const{optionalContentConfigPromise:d}=e;d&&d.then(u=>{d===this._optionalContentConfigPromise&&(ie(this,Wl).initialOptionalContent=u.hasInitialVisibility)}),e.l10n||this.l10n.translate(this.div)}}get renderingState(){return ie(this,Yp)}set renderingState(e){if(e!==ie(this,Yp))switch(it(this,Yp,e),ie(this,Jc)&&(clearTimeout(ie(this,Jc)),it(this,Jc,null)),e){case aa.PAUSED:this.div.classList.remove("loading");break;case aa.RUNNING:this.div.classList.add("loadingIcon"),it(this,Jc,setTimeout(()=>{this.div.classList.add("loading"),it(this,Jc,null)},0));break;case aa.INITIAL:case aa.FINISHED:this.div.classList.remove("loadingIcon","loading");break}}setPdfPage(e){var a,i,s,r;(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&this._isStandalone&&(((a=this.pageColors)==null?void 0:a.foreground)==="CanvasText"||((i=this.pageColors)==null?void 0:i.background)==="Canvas")&&((s=this._container)==null||s.style.setProperty("--hcm-highlight-filter",e.filterFactory.addHighlightHCMFilter("highlight","CanvasText","Canvas","HighlightText","Highlight")),(r=this._container)==null||r.style.setProperty("--hcm-highlight-selected-filter",e.filterFactory.addHighlightHCMFilter("highlight_selected","CanvasText","Canvas","HighlightText","Highlight"))),this.pdfPage=e,this.pdfPageRotate=e.rotate;const n=(this.rotation+this.pdfPageRotate)%360;this.viewport=e.getViewport({scale:this.scale*Bt.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:n}),Se(this,jp,ov).call(this),this.reset()}destroy(){var e;this.reset(),(e=this.pdfPage)==null||e.cleanup()}hasEditableAnnotations(){var e;return!!((e=this.annotationLayer)!=null&&e.hasEditableAnnotations())}get _textHighlighter(){return(0,Bt.shadow)(this,"_textHighlighter",new vP({pageIndex:this.id-1,eventBus:this.eventBus,findController:ie(this,Zc).findController}))}_resetZoomLayer(e=!1){if(!this.zoomLayer)return;const n=this.zoomLayer.firstChild;ie(this,Vu).delete(n),n.width=0,n.height=0,e&&this.zoomLayer.remove(),this.zoomLayer=null}reset({keepZoomLayer:e=!1,keepAnnotationLayer:n=!1,keepAnnotationEditorLayer:a=!1,keepXfaLayer:i=!1,keepTextLayer:s=!1}={}){var f,h,m,b,y;this.cancelRendering({keepAnnotationLayer:n,keepAnnotationEditorLayer:a,keepXfaLayer:i,keepTextLayer:s}),this.renderingState=aa.INITIAL;const r=this.div,o=r.childNodes,l=e&&this.zoomLayer||null,c=n&&((f=this.annotationLayer)==null?void 0:f.div)||null,d=a&&((h=this.annotationEditorLayer)==null?void 0:h.div)||null,u=i&&((m=this.xfaLayer)==null?void 0:m.div)||null,g=s&&((b=this.textLayer)==null?void 0:b.div)||null;for(let _=o.length-1;_>=0;_--){const v=o[_];switch(v){case l:case c:case d:case u:case g:continue}v.remove();const U=ie(this,Qc).indexOf(v);U>=0&&(ie(this,Qc)[U]=null)}r.removeAttribute("data-loaded"),c&&this.annotationLayer.hide(),d&&this.annotationEditorLayer.hide(),u&&this.xfaLayer.hide(),g&&this.textLayer.hide(),(y=this.structTreeLayer)==null||y.hide(),l||(this.canvas&&(ie(this,Vu).delete(this.canvas),this.canvas.width=0,this.canvas.height=0,delete this.canvas),this._resetZoomLayer())}toggleEditingMode(e){this.hasEditableAnnotations()&&(it(this,kb,e),this.reset({keepZoomLayer:!0,keepAnnotationLayer:!0,keepAnnotationEditorLayer:!0,keepXfaLayer:!0,keepTextLayer:!0}))}update({scale:e=0,rotation:n=null,optionalContentConfigPromise:a=null,drawingDelay:i=-1}){var r;this.scale=e||this.scale,typeof n=="number"&&(this.rotation=n),a instanceof Promise&&(this._optionalContentConfigPromise=a,a.then(o=>{a===this._optionalContentConfigPromise&&(ie(this,Wl).initialOptionalContent=o.hasInitialVisibility)})),ie(this,Wl).directDrawing=!0;const s=(this.rotation+this.pdfPageRotate)%360;if(this.viewport=this.viewport.clone({scale:this.scale*Bt.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:s}),Se(this,jp,ov).call(this),(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&this._isStandalone&&((r=this._container)==null||r.style.setProperty("--scale-factor",this.viewport.scale)),this.canvas){let o=!1;if(ie(this,qu)){if((typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&this.maxCanvasPixels===0)o=!0;else if(this.maxCanvasPixels>0){const{width:c,height:d}=this.viewport,{sx:u,sy:g}=this.outputScale;o=(Math.floor(c)*u|0)*(Math.floor(d)*g|0)>this.maxCanvasPixels}}const l=i>=0&&i<1e3;if(l||o){if(l&&!o&&this.renderingState!==aa.FINISHED&&(this.cancelRendering({keepZoomLayer:!0,keepAnnotationLayer:!0,keepAnnotationEditorLayer:!0,keepXfaLayer:!0,keepTextLayer:!0,cancelExtraDelay:i}),this.renderingState=aa.FINISHED,ie(this,Wl).directDrawing=!1),this.cssTransform({target:this.canvas,redrawAnnotationLayer:!0,redrawAnnotationEditorLayer:!0,redrawXfaLayer:!0,redrawTextLayer:!l,hideTextLayer:l}),l)return;this.eventBus.dispatch("pagerendered",{source:this,pageNumber:this.id,cssTransform:!0,timestamp:performance.now(),error:ie(this,Wu)});return}!this.zoomLayer&&!this.canvas.hidden&&(this.zoomLayer=this.canvas.parentNode,this.zoomLayer.style.position="absolute")}this.zoomLayer&&this.cssTransform({target:this.zoomLayer.firstChild}),this.reset({keepZoomLayer:!0,keepAnnotationLayer:!0,keepAnnotationEditorLayer:!0,keepXfaLayer:!0,keepTextLayer:!0})}cancelRendering({keepAnnotationLayer:e=!1,keepAnnotationEditorLayer:n=!1,keepXfaLayer:a=!1,keepTextLayer:i=!1,cancelExtraDelay:s=0}={}){var r;this.renderTask&&(this.renderTask.cancel(s),this.renderTask=null),this.resume=null,this.textLayer&&(!i||!this.textLayer.div)&&(this.textLayer.cancel(),this.textLayer=null),this.annotationLayer&&(!e||!this.annotationLayer.div)&&(this.annotationLayer.cancel(),this.annotationLayer=null,this._annotationCanvasMap=null),this.structTreeLayer&&!this.textLayer&&(this.structTreeLayer=null),this.annotationEditorLayer&&(!n||!this.annotationEditorLayer.div)&&(this.drawLayer&&(this.drawLayer.cancel(),this.drawLayer=null),this.annotationEditorLayer.cancel(),this.annotationEditorLayer=null),this.xfaLayer&&(!a||!this.xfaLayer.div)&&(this.xfaLayer.cancel(),this.xfaLayer=null,(r=this._textHighlighter)==null||r.disable())}cssTransform({target:e,redrawAnnotationLayer:n=!1,redrawAnnotationEditorLayer:a=!1,redrawXfaLayer:i=!1,redrawTextLayer:s=!1,hideTextLayer:r=!1}){var l;if((typeof PDFJSDev=="undefined"||PDFJSDev.test("TESTING"))&&!(e instanceof HTMLCanvasElement))throw new Error("Expected `target` to be a canvas.");if(!e.hasAttribute("zooming")){e.setAttribute("zooming",!0);const{style:c}=e;c.width=c.height=""}const o=ie(this,Vu).get(e);if(this.viewport!==o){const c=this.viewport.rotation-o.rotation,d=Math.abs(c);let u=1,g=1;if(d===90||d===270){const{width:f,height:h}=this.viewport;u=h/f,g=f/h}e.style.transform=`rotate(${c}deg) scale(${u}, ${g})`}n&&this.annotationLayer&&Se(this,Db,Jk).call(this),a&&this.annotationEditorLayer&&(this.drawLayer&&Se(this,Lb,e2).call(this),Se(this,Cb,Qk).call(this)),i&&this.xfaLayer&&Se(this,Ib,t2).call(this),this.textLayer&&(r?(this.textLayer.hide(),(l=this.structTreeLayer)==null||l.hide()):s&&Se(this,Mb,n2).call(this))}get width(){return this.viewport.width}get height(){return this.viewport.height}getPagePoint(e,n){return this.viewport.convertToPdfPoint(e,n)}draw(){return Rt(this,null,function*(){this.renderingState!==aa.INITIAL&&(console.error("Must be in new state before drawing"),this.reset());const{div:e,l10n:n,pageColors:a,pdfPage:i,viewport:s}=this;if(!i)throw this.renderingState=aa.FINISHED,new Error("pdfPage is not loaded");this.renderingState=aa.RUNNING;const r=document.createElement("div");if(r.classList.add("canvasWrapper"),Se(this,ed,rh).call(this,r,"canvasWrapper"),!this.textLayer&&ie(this,Gp)!==bo.DISABLE&&!i.isPureXfa&&(this._accessibilityManager||(this._accessibilityManager=new Jx),this.textLayer=new t1({pdfPage:i,highlighter:this._textHighlighter,accessibilityManager:this._accessibilityManager,enablePermissions:ie(this,Gp)===bo.ENABLE_PERMISSIONS,onAppend:S=>{this.l10n.pause(),Se(this,ed,rh).call(this,S,"textLayer"),this.l10n.resume()}})),!this.annotationLayer&&ie(this,Hu)!==Bt.AnnotationMode.DISABLE){const{annotationStorage:S,annotationEditorUIManager:B,downloadManager:H,enableScripting:j,fieldObjectsPromise:re,hasJSActionsPromise:Te,linkService:Be}=ie(this,Zc);this._annotationCanvasMap||(this._annotationCanvasMap=new Map),this.annotationLayer=new bP({pdfPage:i,annotationStorage:S,imageResourcesPath:this.imageResourcesPath,renderForms:ie(this,Hu)===Bt.AnnotationMode.ENABLE_FORMS,linkService:Be,downloadManager:H,enableScripting:j,hasJSActionsPromise:Te,fieldObjectsPromise:re,annotationCanvasMap:this._annotationCanvasMap,accessibilityManager:this._accessibilityManager,annotationEditorUIManager:B,onAppend:Ie=>{Se(this,ed,rh).call(this,Ie,"annotationLayer")}})}const o=S=>{if(g==null||g(!1),this.renderingQueue&&!this.renderingQueue.isHighestPriority(this)){this.renderingState=aa.PAUSED,this.resume=()=>{this.renderingState=aa.RUNNING,S()};return}S()},{width:l,height:c}=s,d=document.createElement("canvas");d.setAttribute("role","presentation"),d.hidden=!0;const u=!!(a!=null&&a.background&&(a!=null&&a.foreground));let g=S=>{(!u||S)&&(d.hidden=!1,g=null)};r.append(d),this.canvas=d;const f=d.getContext("2d",{alpha:!1,willReadFrequently:!ie(this,Eb)}),h=this.outputScale=new Bt.OutputScale;if((typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&this.maxCanvasPixels===0){const S=1/this.scale;h.sx*=S,h.sy*=S,it(this,qu,!0)}else if(this.maxCanvasPixels>0){const S=l*c,B=Math.sqrt(this.maxCanvasPixels/S);h.sx>B||h.sy>B?(h.sx=B,h.sy=B,it(this,qu,!0)):it(this,qu,!1)}const m=qA(h.sx),b=qA(h.sy),y=d.width=y_(w_(l*h.sx),m[0]),_=d.height=y_(w_(c*h.sy),b[0]),v=y_(w_(l),m[1]),U=y_(w_(c),b[1]);h.sx=y/v,h.sy=_/U,ie(this,Ab)!==m[1]&&(e.style.setProperty("--scale-round-x",`${m[1]}px`),it(this,Ab,m[1])),ie(this,Tb)!==b[1]&&(e.style.setProperty("--scale-round-y",`${b[1]}px`),it(this,Tb,b[1])),ie(this,Vu).set(d,s);const ee=h.scaled?[h.sx,0,0,h.sy,0,0]:null,Z={canvasContext:f,transform:ee,viewport:s,annotationMode:ie(this,Hu),optionalContentConfigPromise:this._optionalContentConfigPromise,annotationCanvasMap:this._annotationCanvasMap,pageColors:a,isEditing:ie(this,kb)},k=this.renderTask=i.render(Z);k.onContinue=o;const w=k.promise.then(()=>Rt(this,null,function*(){var B;g==null||g(!0),yield Se(this,Fb,a2).call(this,k),this.structTreeLayer||(this.structTreeLayer=new wP(i,s.rawDims)),Se(this,Mb,n2).call(this),this.annotationLayer&&(yield Se(this,Db,Jk).call(this));const{annotationEditorUIManager:S}=ie(this,Zc);S&&(this.drawLayer||(this.drawLayer=new yP({pageIndex:this.id})),yield Se(this,Lb,e2).call(this),this.drawLayer.setParent(r),this.annotationEditorLayer||(this.annotationEditorLayer=new mP({uiManager:S,pdfPage:i,l10n:n,structTreeLayer:this.structTreeLayer,accessibilityManager:this._accessibilityManager,annotationLayer:(B=this.annotationLayer)==null?void 0:B.annotationLayer,textLayer:this.textLayer,drawLayer:this.drawLayer.getDrawLayer(),onAppend:H=>{Se(this,ed,rh).call(this,H,"annotationEditorLayer")}})),Se(this,Cb,Qk).call(this))}),S=>(S instanceof Bt.RenderingCancelledException||g==null||g(!0),Se(this,Fb,a2).call(this,k,S)));if(i.isPureXfa){if(!this.xfaLayer){const{annotationStorage:S,linkService:B}=ie(this,Zc);this.xfaLayer=new cT({pdfPage:i,annotationStorage:S,linkService:B})}Se(this,Ib,t2).call(this)}return e.setAttribute("data-loaded",!0),this.eventBus.dispatch("pagerender",{source:this,pageNumber:this.id}),w})}setPageLabel(e){var n;this.pageLabel=typeof e=="string"?e:null,this.div.setAttribute("data-l10n-args",JSON.stringify({page:(n=this.pageLabel)!=null?n:this.id})),this.pageLabel!==null?this.div.setAttribute("data-page-label",this.pageLabel):this.div.removeAttribute("data-page-label")}get thumbnailCanvas(){const{directDrawing:e,initialOptionalContent:n,regularAnnotations:a}=ie(this,Wl);return e&&n&&a?this.canvas:null}}Hu=new WeakMap,Eb=new WeakMap,qu=new WeakMap,kb=new WeakMap,Zc=new WeakMap,Jc=new WeakMap,Sb=new WeakMap,Ab=new WeakMap,Tb=new WeakMap,Wu=new WeakMap,Yp=new WeakMap,Gp=new WeakMap,Wl=new WeakMap,Vu=new WeakMap,Qc=new WeakMap,ed=new WeakSet,rh=function(e,n){const a=DP.get(n),i=ie(this,Qc)[a];if(ie(this,Qc)[a]=e,i){i.replaceWith(e);return}for(let s=a-1;s>=0;s--){const r=ie(this,Qc)[s];if(r){r.after(e);return}}this.div.prepend(e)},jp=new WeakSet,ov=function(){const{viewport:e}=this;if(this.pdfPage){if(ie(this,Sb)===e.rotation)return;it(this,Sb,e.rotation)}(0,Bt.setLayerDimensions)(this.div,e,!0,!1)},zu=new WeakSet,uy=function(e,n){this.eventBus.dispatch(e,{source:this,pageNumber:this.id,error:n})},Db=new WeakSet,Jk=function(){return Rt(this,null,function*(){let e=null;try{yield this.annotationLayer.render(this.viewport,{structTreeLayer:this.structTreeLayer},"display")}catch(n){console.error(`#renderAnnotationLayer: "${n}".`),e=n}finally{Se(this,zu,uy).call(this,"annotationlayerrendered",e)}})},Cb=new WeakSet,Qk=function(){return Rt(this,null,function*(){let e=null;try{yield this.annotationEditorLayer.render(this.viewport,"display")}catch(n){console.error(`#renderAnnotationEditorLayer: "${n}".`),e=n}finally{Se(this,zu,uy).call(this,"annotationeditorlayerrendered",e)}})},Lb=new WeakSet,e2=function(){return Rt(this,null,function*(){try{yield this.drawLayer.render("display")}catch(e){console.error(`#renderDrawLayer: "${e}".`)}})},Ib=new WeakSet,t2=function(){return Rt(this,null,function*(){var n;let e=null;try{const a=yield this.xfaLayer.render(this.viewport,"display");a!=null&&a.textDivs&&this._textHighlighter&&Se(this,P0,m5).call(this,a.textDivs)}catch(a){console.error(`#renderXfaLayer: "${a}".`),e=a}finally{(n=this.xfaLayer)!=null&&n.div&&(this.l10n.pause(),Se(this,ed,rh).call(this,this.xfaLayer.div,"xfaLayer"),this.l10n.resume()),Se(this,zu,uy).call(this,"xfalayerrendered",e)}})},Mb=new WeakSet,n2=function(){return Rt(this,null,function*(){if(!this.textLayer)return;let e=null;yield this.textLayer.render(this.viewport),Se(this,zu,uy).call(this,"textlayerrendered",e),Se(this,F0,g5).call(this)})},F0=new WeakSet,g5=function(){return Rt(this,null,function*(){var n,a,i;if(!this.textLayer)return;const e=yield(n=this.structTreeLayer)==null?void 0:n.render();e&&(this.l10n.pause(),(a=this.structTreeLayer)==null||a.addElementsToTextLayer(),this.canvas&&e.parentNode!==this.canvas&&this.canvas.append(e),this.l10n.resume()),(i=this.structTreeLayer)==null||i.show()})},P0=new WeakSet,m5=function(e){return Rt(this,null,function*(){const n=yield this.pdfPage.getTextContent(),a=[];for(const i of n.items)a.push(i.str);this._textHighlighter.setTextMapping(e,a),this._textHighlighter.enable()})},Fb=new WeakSet,a2=function(e,n=null){return Rt(this,null,function*(){if(e===this.renderTask&&(this.renderTask=null),n instanceof Bt.RenderingCancelledException){it(this,Wu,null);return}if(it(this,Wu,n),this.renderingState=aa.FINISHED,this._resetZoomLayer(!0),ie(this,Wl).regularAnnotations=!e.separateAnnots,this.eventBus.dispatch("pagerendered",{source:this,pageNumber:this.id,cssTransform:!1,timestamp:performance.now(),error:ie(this,Wu)}),n)throw n})};const DT=10,og={FORCE_SCROLL_MODE_PAGE:1e4,FORCE_LAZY_PAGE_INIT:5e3,PAUSE_EAGER_PAGE_INIT:250};function CT(t){return Object.values(Bt.AnnotationEditorType).includes(t)&&t!==Bt.AnnotationEditorType.DISABLE}class LP{constructor(e){Ae(this,Pb);Ae(this,Vl,new Set);Ae(this,Yu,0);it(this,Yu,e)}push(e){const n=ie(this,Vl);n.has(e)&&n.delete(e),n.add(e),n.size>ie(this,Yu)&&Se(this,Pb,i2).call(this)}resize(e,n=null){it(this,Yu,e);const a=ie(this,Vl);if(n){const i=a.size;let s=1;for(const r of a)if(n.has(r.id)&&(a.delete(r),a.add(r)),++s>i)break}for(;a.size>ie(this,Yu);)Se(this,Pb,i2).call(this)}has(e){return ie(this,Vl).has(e)}[Symbol.iterator](){return ie(this,Vl).keys()}}Vl=new WeakMap,Yu=new WeakMap,Pb=new WeakSet,i2=function(){const e=ie(this,Vl).keys().next().value;e==null||e.destroy(),ie(this,Vl).delete(e)};class IP{constructor(e){Ae(this,N0);Ae(this,B0);Ae(this,$0);Ae(this,Ju);Ae(this,Qp);Ae(this,O0);Ae(this,Vb);Ae(this,R0);Ae(this,cl);Ae(this,zb);Ae(this,U0);Ae(this,H0);Ae(this,q0);Ae(this,Yb);Ae(this,W0);Ae(this,eh);Ae(this,td,null);Ae(this,Nb,null);Ae(this,Bb,null);Ae(this,ll,Bt.AnnotationEditorType.NONE);Ae(this,Ir,null);Ae(this,Gu,Bt.AnnotationMode.ENABLE_FORMS);Ae(this,$b,null);Ae(this,Ob,!1);Ae(this,Rb,!1);Ae(this,Ub,!1);Ae(this,Hb,!1);Ae(this,qb,!1);Ae(this,nd,null);Ae(this,ju,null);Ae(this,Ku,null);Ae(this,Xu,null);Ae(this,Kp,!1);Ae(this,ad,null);Ae(this,Xp,!1);Ae(this,Wb,0);Ae(this,Zp,new ResizeObserver(Se(this,W0,S5).bind(this)));Ae(this,Zu,null);Ae(this,id,null);Ae(this,Jp,bo.ENABLE);var a,i,s,r,o;if(this.container=e.container,this.viewer=e.viewer||e.container.firstElementChild,typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC")){if(((a=this.container)==null?void 0:a.tagName)!=="DIV"||((i=this.viewer)==null?void 0:i.tagName)!=="DIV")throw new Error("Invalid `container` and/or `viewer` option.");if(this.container.offsetParent&&getComputedStyle(this.container).position!=="absolute")throw new Error("The `container` must be absolutely positioned.")}ie(this,Zp).observe(this.container),this.eventBus=e.eventBus,this.linkService=e.linkService||new Mx,this.downloadManager=e.downloadManager||null,this.findController=e.findController||null,it(this,Nb,e.altTextManager||null),this.findController&&(this.findController.onIsPageVisible=l=>this._getVisiblePages().ids.has(l)),this._scriptingManager=e.scriptingManager||null,it(this,Jp,(s=e.textLayerMode)!=null?s:bo.ENABLE),it(this,Gu,(r=e.annotationMode)!=null?r:Bt.AnnotationMode.ENABLE_FORMS),it(this,ll,(o=e.annotationEditorMode)!=null?o:Bt.AnnotationEditorType.NONE),it(this,Bb,e.annotationEditorHighlightColors||null),it(this,Rb,e.enableHighlightFloatingButton===!0),it(this,Hb,e.enableUpdatedAddImage===!0),it(this,qb,e.enableNewAltTextWhenAddingImage===!0),this.imageResourcesPath=e.imageResourcesPath||"",this.enablePrintAutoRotate=e.enablePrintAutoRotate||!1,(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&(this.removePageBorders=e.removePageBorders||!1),this.maxCanvasPixels=e.maxCanvasPixels,this.l10n=e.l10n,(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&(this.l10n||(this.l10n=new GenericL10n)),it(this,Ub,e.enablePermissions||!1),this.pageColors=e.pageColors||null,it(this,ju,e.mlManager||null),it(this,Ob,e.enableHWA||!1),this.defaultRenderingQueue=!e.renderingQueue,(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&this.defaultRenderingQueue?(this.renderingQueue=new hT,this.renderingQueue.setViewer(this)):this.renderingQueue=e.renderingQueue;const{abortSignal:n}=e;n==null||n.addEventListener("abort",()=>{ie(this,Zp).disconnect(),it(this,Zp,null)},{once:!0}),this.scroll=UA(this.container,this._scrollUpdate.bind(this),n),this.presentationModeState=Oi.UNKNOWN,this._resetView(),(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&this.removePageBorders&&this.viewer.classList.add("removePageBorders"),Se(this,Yb,o2).call(this),this.eventBus._on("thumbnailrendered",({pageNumber:l,pdfPage:c})=>{const d=this._pages[l-1];ie(this,td).has(d)||c==null||c.cleanup()}),(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&!e.l10n&&this.l10n.translate(this.container)}get pagesCount(){return this._pages.length}getPageView(e){return this._pages[e]}getCachedPageViews(){return new Set(ie(this,td))}get pageViewsReady(){return this._pages.every(e=>e==null?void 0:e.pdfPage)}get renderForms(){return ie(this,Gu)===Bt.AnnotationMode.ENABLE_FORMS}get enableScripting(){return!!this._scriptingManager}get currentPageNumber(){return this._currentPageNumber}set currentPageNumber(e){if(!Number.isInteger(e))throw new Error("Invalid page number.");this.pdfDocument&&(this._setCurrentPageNumber(e,!0)||console.error(`currentPageNumber: "${e}" is not a valid page.`))}_setCurrentPageNumber(e,n=!1){var i,s;if(this._currentPageNumber===e)return n&&Se(this,zb,r2).call(this),!0;if(!(0<e&&e<=this.pagesCount))return!1;const a=this._currentPageNumber;return this._currentPageNumber=e,this.eventBus.dispatch("pagechanging",{source:this,pageNumber:e,pageLabel:(s=(i=this._pageLabels)==null?void 0:i[e-1])!=null?s:null,previous:a}),n&&Se(this,zb,r2).call(this),!0}get currentPageLabel(){var e,n;return(n=(e=this._pageLabels)==null?void 0:e[this._currentPageNumber-1])!=null?n:null}set currentPageLabel(e){if(!this.pdfDocument)return;let n=e|0;if(this._pageLabels){const a=this._pageLabels.indexOf(e);a>=0&&(n=a+1)}this._setCurrentPageNumber(n,!0)||console.error(`currentPageLabel: "${e}" is not a valid page.`)}get currentScale(){return this._currentScale!==Dx?this._currentScale:Tx}set currentScale(e){if(isNaN(e))throw new Error("Invalid numeric scale.");this.pdfDocument&&Se(this,cl,cd).call(this,e,{noScroll:!1})}get currentScaleValue(){return this._currentScaleValue}set currentScaleValue(e){this.pdfDocument&&Se(this,cl,cd).call(this,e,{noScroll:!1})}get pagesRotation(){return this._pagesRotation}set pagesRotation(e){if(!__(e))throw new Error("Invalid pages rotation angle.");if(!this.pdfDocument||(e%=360,e<0&&(e+=360),this._pagesRotation===e))return;this._pagesRotation=e;const n=this._currentPageNumber;this.refresh(!0,{rotation:e}),this._currentScaleValue&&Se(this,cl,cd).call(this,this._currentScaleValue,{noScroll:!0}),this.eventBus.dispatch("rotationchanging",{source:this,pagesRotation:e,pageNumber:n}),this.defaultRenderingQueue&&this.update()}get firstPagePromise(){return this.pdfDocument?this._firstPageCapability.promise:null}get onePageRendered(){return this.pdfDocument?this._onePageRenderedCapability.promise:null}get pagesPromise(){return this.pdfDocument?this._pagesCapability.promise:null}get _layerProperties(){const e=this;return(0,Bt.shadow)(this,"_layerProperties",{get annotationEditorUIManager(){return ie(e,Ir)},get annotationStorage(){var n;return(n=e.pdfDocument)==null?void 0:n.annotationStorage},get downloadManager(){return e.downloadManager},get enableScripting(){return!!e._scriptingManager},get fieldObjectsPromise(){var n;return(n=e.pdfDocument)==null?void 0:n.getFieldObjects()},get findController(){return e.findController},get hasJSActionsPromise(){var n;return(n=e.pdfDocument)==null?void 0:n.hasJSActions()},get linkService(){return e.linkService}})}getAllText(){return Rt(this,null,function*(){const e=[],n=[];for(let a=1,i=this.pdfDocument.numPages;a<=i;++a){if(ie(this,Xp))return null;n.length=0;const s=yield this.pdfDocument.getPage(a),{items:r}=yield s.getTextContent();for(const o of r)o.str&&n.push(o.str),o.hasEOL&&n.push(`
`);e.push(qf(n.join("")))}return e.join(`
`)})}setDocument(e){var g,f,h;if(this.pdfDocument&&(this.eventBus.dispatch("pagesdestroy",{source:this}),this._cancelRendering(),this._resetView(),(g=this.findController)==null||g.setDocument(null),(f=this._scriptingManager)==null||f.setDocument(null),(h=ie(this,Ir))==null||h.destroy(),it(this,Ir,null)),this.pdfDocument=e,!e)return;const n=e.numPages,a=e.getPage(1),i=e.getOptionalContentConfig({intent:"display"}),s=ie(this,Ub)?e.getPermissions():Promise.resolve(),{eventBus:r,pageColors:o,viewer:l}=this;it(this,nd,new AbortController);const{signal:c}=ie(this,nd);if(n>og.FORCE_SCROLL_MODE_PAGE){console.warn("Forcing PAGE-scrolling for performance reasons, given the length of the document.");const m=this._scrollMode=On.PAGE;r.dispatch("scrollmodechanged",{source:this,mode:m})}this._pagesCapability.promise.then(()=>{r.dispatch("pagesloaded",{source:this,pagesCount:n})},()=>{});const d=m=>{const b=this._pages[m.pageNumber-1];b&&ie(this,td).push(b)};r._on("pagerender",d,{signal:c});const u=m=>{m.cssTransform||(this._onePageRenderedCapability.resolve({timestamp:m.timestamp}),r._off("pagerendered",u))};r._on("pagerendered",u,{signal:c}),Promise.all([a,s]).then(([m,b])=>{var k,w;if(e!==this.pdfDocument)return;this._firstPageCapability.resolve(m),this._optionalContentConfigPromise=i;const{annotationEditorMode:y,annotationMode:_,textLayerMode:v}=Se(this,N0,b5).call(this,b);if(v!==bo.DISABLE){const S=it(this,ad,document.createElement("div"));S.id="hiddenCopyElement",l.before(S)}if((typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL")||typeof AbortSignal.any=="function")&&y!==Bt.AnnotationEditorType.DISABLE){const S=y;e.isPureXfa?console.warn("Warning: XFA-editing is not implemented."):CT(S)?(it(this,Ir,new Bt.AnnotationEditorUIManager(this.container,l,ie(this,Nb),r,e,o,ie(this,Bb),ie(this,Rb),ie(this,Hb),ie(this,qb),ie(this,ju))),r.dispatch("annotationeditoruimanager",{source:this,uiManager:ie(this,Ir)}),S!==Bt.AnnotationEditorType.NONE&&(S===Bt.AnnotationEditorType.STAMP&&((k=ie(this,ju))==null||k.loadModel("altText")),ie(this,Ir).updateMode(S))):console.error(`Invalid AnnotationEditor mode: ${S}`)}const U=this._scrollMode===On.PAGE?null:l,ee=this.currentScale,Z=m.getViewport({scale:ee*Bt.PixelsPerInch.PDF_TO_CSS_UNITS});l.style.setProperty("--scale-factor",Z.scale),o!=null&&o.background&&l.style.setProperty("--page-bg-color",o.background),((o==null?void 0:o.foreground)==="CanvasText"||(o==null?void 0:o.background)==="Canvas")&&(l.style.setProperty("--hcm-highlight-filter",e.filterFactory.addHighlightHCMFilter("highlight","CanvasText","Canvas","HighlightText","Highlight")),l.style.setProperty("--hcm-highlight-selected-filter",e.filterFactory.addHighlightHCMFilter("highlight_selected","CanvasText","Canvas","HighlightText","ButtonText")));for(let S=1;S<=n;++S){const B=new CP({container:U,eventBus:r,id:S,scale:ee,defaultViewport:Z.clone(),optionalContentConfigPromise:i,renderingQueue:this.renderingQueue,textLayerMode:v,annotationMode:_,imageResourcesPath:this.imageResourcesPath,maxCanvasPixels:this.maxCanvasPixels,pageColors:o,l10n:this.l10n,layerProperties:this._layerProperties,enableHWA:ie(this,Ob)});this._pages.push(B)}(w=this._pages[0])==null||w.setPdfPage(m),this._scrollMode===On.PAGE?Se(this,Ju,fy).call(this):this._spreadMode!==Na.NONE&&this._updateSpreadMode(),Se(this,B0,y5).call(this,c).then(()=>Rt(this,null,function*(){var B,H;if(e!==this.pdfDocument)return;if((B=this.findController)==null||B.setDocument(e),(H=this._scriptingManager)==null||H.setDocument(e),ie(this,ad)&&document.addEventListener("copy",Se(this,$0,_5).bind(this,v),{signal:c}),ie(this,Ir)&&r.dispatch("annotationeditormodechanged",{source:this,mode:ie(this,ll)}),e.loadingParams.disableAutoFetch||n>og.FORCE_LAZY_PAGE_INIT){this._pagesCapability.resolve();return}let S=n-1;if(S<=0){this._pagesCapability.resolve();return}for(let j=2;j<=n;++j){const re=e.getPage(j).then(Te=>{const Be=this._pages[j-1];Be.pdfPage||Be.setPdfPage(Te),--S===0&&this._pagesCapability.resolve()},Te=>{console.error(`Unable to get page ${j} to initialize viewer`,Te),--S===0&&this._pagesCapability.resolve()});j%og.PAUSE_EAGER_PAGE_INIT===0&&(yield re)}})),r.dispatch("pagesinit",{source:this}),e.getMetadata().then(({info:S})=>{e===this.pdfDocument&&S.Language&&(l.lang=S.Language)}),this.defaultRenderingQueue&&this.update()}).catch(m=>{console.error("Unable to initialize viewer",m),this._pagesCapability.reject(m)})}setPageLabels(e){var n,a;if(this.pdfDocument){e?Array.isArray(e)&&this.pdfDocument.numPages===e.length?this._pageLabels=e:(this._pageLabels=null,console.error("setPageLabels: Invalid page labels.")):this._pageLabels=null;for(let i=0,s=this._pages.length;i<s;i++)this._pages[i].setPageLabel((a=(n=this._pageLabels)==null?void 0:n[i])!=null?a:null)}}_resetView(){var e,n;this._pages=[],this._currentPageNumber=1,this._currentScale=Dx,this._currentScaleValue=null,this._pageLabels=null,it(this,td,new LP(DT)),this._location=null,this._pagesRotation=0,this._optionalContentConfigPromise=null,this._firstPageCapability=Promise.withResolvers(),this._onePageRenderedCapability=Promise.withResolvers(),this._pagesCapability=Promise.withResolvers(),this._scrollMode=On.VERTICAL,this._previousScrollMode=On.UNKNOWN,this._spreadMode=Na.NONE,it(this,Zu,{previousPageNumber:1,scrollDown:!0,pages:[]}),(e=ie(this,nd))==null||e.abort(),it(this,nd,null),this.viewer.textContent="",this._updateScrollMode(),this.viewer.removeAttribute("lang"),(n=ie(this,ad))==null||n.remove(),it(this,ad,null),Se(this,eh,cv).call(this)}_scrollUpdate(){this.pagesCount!==0&&this.update()}pageLabelToPageNumber(e){if(!this._pageLabels)return null;const n=this._pageLabels.indexOf(e);return n<0?null:n+1}scrollPageIntoView({pageNumber:e,destArray:n=null,allowNegativeOffset:a=!1,ignoreDestinationZoom:i=!1}){if(!this.pdfDocument)return;const s=Number.isInteger(e)&&this._pages[e-1];if(!s){console.error(`scrollPageIntoView: "${e}" is not a valid pageNumber parameter.`);return}if(this.isInPresentationMode||!n){this._setCurrentPageNumber(e,!0);return}let r=0,o=0,l=0,c=0,d,u;const g=s.rotation%180!==0,f=(g?s.height:s.width)/s.scale/Bt.PixelsPerInch.PDF_TO_CSS_UNITS,h=(g?s.width:s.height)/s.scale/Bt.PixelsPerInch.PDF_TO_CSS_UNITS;let m=0;switch(n[1].name){case"XYZ":r=n[2],o=n[3],m=n[4],r=r!==null?r:0,o=o!==null?o:h;break;case"Fit":case"FitB":m="page-fit";break;case"FitH":case"FitBH":o=n[2],m="page-width",o===null&&this._location?(r=this._location.left,o=this._location.top):(typeof o!="number"||o<0)&&(o=h);break;case"FitV":case"FitBV":r=n[2],l=f,c=h,m="page-height";break;case"FitR":r=n[2],o=n[3],l=n[4]-r,c=n[5]-o;let v=OA,U=RA;(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&this.removePageBorders&&(v=U=0),d=(this.container.clientWidth-v)/l/Bt.PixelsPerInch.PDF_TO_CSS_UNITS,u=(this.container.clientHeight-U)/c/Bt.PixelsPerInch.PDF_TO_CSS_UNITS,m=Math.min(Math.abs(d),Math.abs(u));break;default:console.error(`scrollPageIntoView: "${n[1].name}" is not a valid destination type.`);return}if(i||(m&&m!==this._currentScale?this.currentScaleValue=m:this._currentScale===Dx&&(this.currentScaleValue=ag)),m==="page-fit"&&!n[4]){Se(this,Qp,lv).call(this,s);return}const b=[s.viewport.convertToViewportPoint(r,o),s.viewport.convertToViewportPoint(r+l,o+c)];let y=Math.min(b[0][0],b[1][0]),_=Math.min(b[0][1],b[1][1]);a||(y=Math.max(y,0),_=Math.max(_,0)),Se(this,Qp,lv).call(this,s,{left:y,top:_})}_updateLocation(e){const n=this._currentScale,a=this._currentScaleValue,i=parseFloat(a)===n?Math.round(n*1e4)/100:a,s=e.id,r=this._pages[s-1],o=this.container,l=r.getPagePoint(o.scrollLeft-e.x,o.scrollTop-e.y),c=Math.round(l[0]),d=Math.round(l[1]);let u=`#page=${s}`;this.isInPresentationMode||(u+=`&zoom=${i},${c},${d}`),this._location={pageNumber:s,scale:i,top:d,left:c,rotation:this._pagesRotation,pdfOpenParams:u}}update(){const e=this._getVisiblePages(),n=e.views,a=n.length;if(a===0)return;const i=Math.max(DT,2*a+1);ie(this,td).resize(i,e.ids),this.renderingQueue.renderHighestPriority(e);const s=this._spreadMode===Na.NONE&&(this._scrollMode===On.PAGE||this._scrollMode===On.VERTICAL),r=this._currentPageNumber;let o=!1;for(const l of n){if(l.percent<100)break;if(l.id===r&&s){o=!0;break}}this._setCurrentPageNumber(o?r:n[0].id),this._updateLocation(e.first),this.eventBus.dispatch("updateviewarea",{source:this,location:this._location})}containsElement(e){return this.container.contains(e)}focus(){this.container.focus(),this.container.parentElement.querySelector("#sidebarToggleButton").focus()}get _isContainerRtl(){return getComputedStyle(this.container).direction==="rtl"}get isInPresentationMode(){return this.presentationModeState===Oi.FULLSCREEN}get isChangingPresentationMode(){return this.presentationModeState===Oi.CHANGING}get isHorizontalScrollbarEnabled(){return this.isInPresentationMode?!1:this.container.scrollWidth>this.container.clientWidth}get isVerticalScrollbarEnabled(){return this.isInPresentationMode?!1:this.container.scrollHeight>this.container.clientHeight}_getVisiblePages(){const e=this._scrollMode===On.PAGE?ie(this,Zu).pages:this._pages,n=this._scrollMode===On.HORIZONTAL,a=n&&this._isContainerRtl;return WA({scrollEl:this.container,views:e,sortByVisibility:!0,horizontal:n,rtl:a})}cleanup(){for(const e of this._pages)e.renderingState!==aa.FINISHED&&e.reset()}_cancelRendering(){for(const e of this._pages)e.cancelRendering()}forceRendering(e){const n=e||this._getVisiblePages(),a=Se(this,q0,k5).call(this,n),i=this._spreadMode!==Na.NONE&&this._scrollMode!==On.HORIZONTAL,s=this.renderingQueue.getHighestPriority(n,this._pages,a,i);return s?(Se(this,H0,E5).call(this,s).then(()=>{this.renderingQueue.renderView(s)}),!0):!1}get hasEqualPageSizes(){const e=this._pages[0];for(let n=1,a=this._pages.length;n<a;++n){const i=this._pages[n];if(i.width!==e.width||i.height!==e.height)return!1}return!0}getPagesOverview(){let e;return this._pages.map(n=>{const a=n.pdfPage.getViewport({scale:1}),i=Lx(a);if(e===void 0)e=i;else if(this.enablePrintAutoRotate&&i!==e)return{width:a.height,height:a.width,rotation:(a.rotation-90)%360};return{width:a.width,height:a.height,rotation:a.rotation}})}get optionalContentConfigPromise(){return this.pdfDocument?this._optionalContentConfigPromise?this._optionalContentConfigPromise:(console.error("optionalContentConfigPromise: Not initialized yet."),this.pdfDocument.getOptionalContentConfig({intent:"display"})):Promise.resolve(null)}set optionalContentConfigPromise(e){if(!(e instanceof Promise))throw new Error(`Invalid optionalContentConfigPromise: ${e}`);this.pdfDocument&&this._optionalContentConfigPromise&&(this._optionalContentConfigPromise=e,this.refresh(!1,{optionalContentConfigPromise:e}),this.eventBus.dispatch("optionalcontentconfigchanged",{source:this,promise:e}))}get scrollMode(){return this._scrollMode}set scrollMode(e){if(!(typeof PDFJSDev=="undefined"?window.isGECKOVIEW:PDFJSDev.test("GECKOVIEW"))&&this._scrollMode!==e){if(!zA(e))throw new Error(`Invalid scroll mode: ${e}`);this.pagesCount>og.FORCE_SCROLL_MODE_PAGE||(this._previousScrollMode=this._scrollMode,this._scrollMode=e,this.eventBus.dispatch("scrollmodechanged",{source:this,mode:e}),this._updateScrollMode(this._currentPageNumber))}}_updateScrollMode(e=null){const n=this._scrollMode,a=this.viewer;a.classList.toggle("scrollHorizontal",n===On.HORIZONTAL),a.classList.toggle("scrollWrapped",n===On.WRAPPED),!(!this.pdfDocument||!e)&&(n===On.PAGE?Se(this,Ju,fy).call(this):this._previousScrollMode===On.PAGE&&this._updateSpreadMode(),this._currentScaleValue&&isNaN(this._currentScaleValue)&&Se(this,cl,cd).call(this,this._currentScaleValue,{noScroll:!0}),this._setCurrentPageNumber(e,!0),this.update())}get spreadMode(){return this._spreadMode}set spreadMode(e){if(!(typeof PDFJSDev=="undefined"?window.isGECKOVIEW:PDFJSDev.test("GECKOVIEW"))&&this._spreadMode!==e){if(!YA(e))throw new Error(`Invalid spread mode: ${e}`);this._spreadMode=e,this.eventBus.dispatch("spreadmodechanged",{source:this,mode:e}),this._updateSpreadMode(this._currentPageNumber)}}_updateSpreadMode(e=null){if(!this.pdfDocument)return;const n=this.viewer,a=this._pages;if(this._scrollMode===On.PAGE)Se(this,Ju,fy).call(this);else if(n.textContent="",this._spreadMode===Na.NONE)for(const i of this._pages)n.append(i.div);else{const i=this._spreadMode-1;let s=null;for(let r=0,o=a.length;r<o;++r)s===null?(s=document.createElement("div"),s.className="spread",n.append(s)):r%2===i&&(s=s.cloneNode(!1),n.append(s)),s.append(a[r].div)}e&&(this._currentScaleValue&&isNaN(this._currentScaleValue)&&Se(this,cl,cd).call(this,this._currentScaleValue,{noScroll:!0}),this._setCurrentPageNumber(e,!0),this.update())}_getPageAdvance(e,n=!1){switch(this._scrollMode){case On.WRAPPED:{const{views:a}=this._getVisiblePages(),i=new Map;for(const{id:s,y:r,percent:o,widthPercent:l}of a){if(o===0||l<100)continue;let c=i.get(r);c||i.set(r,c||(c=[])),c.push(s)}for(const s of i.values()){const r=s.indexOf(e);if(r===-1)continue;const o=s.length;if(o===1)break;if(n)for(let l=r-1,c=0;l>=c;l--){const d=s[l],u=s[l+1]-1;if(d<u)return e-u}else for(let l=r+1,c=o;l<c;l++){const d=s[l],u=s[l-1]+1;if(d>u)return u-e}if(n){const l=s[0];if(l<e)return e-l+1}else{const l=s[o-1];if(l>e)return l-e+1}break}break}case On.HORIZONTAL:break;case On.PAGE:case On.VERTICAL:{if(this._spreadMode===Na.NONE)break;const a=this._spreadMode-1;if(n&&e%2!==a)break;if(!n&&e%2===a)break;const{views:i}=this._getVisiblePages(),s=n?e-1:e+1;for(const{id:r,percent:o,widthPercent:l}of i)if(r===s){if(o>0&&l===100)return 2;break}break}}return 1}nextPage(){const e=this._currentPageNumber,n=this.pagesCount;if(e>=n)return!1;const a=this._getPageAdvance(e,!1)||1;return this.currentPageNumber=Math.min(e+a,n),!0}previousPage(){const e=this._currentPageNumber;if(e<=1)return!1;const n=this._getPageAdvance(e,!0)||1;return this.currentPageNumber=Math.max(e-n,1),!0}updateScale({drawingDelay:e,scaleFactor:n=null,steps:a=null,origin:i}){if(a===null&&n===null)throw new Error("Invalid updateScale options: either `steps` or `scaleFactor` must be provided.");if(!this.pdfDocument)return;let s=this._currentScale;if(n>0&&n!==1)s=Math.round(s*n*100)/100;else if(a){const r=a>0?NA:1/NA,o=a>0?Math.ceil:Math.floor;a=Math.abs(a);do s=o((s*r).toFixed(2)*10)/10;while(--a>0)}s=Math.max(BA,Math.min($A,s)),Se(this,cl,cd).call(this,s,{noScroll:!1,drawingDelay:e,origin:i})}increaseScale(e={}){var n;this.updateScale(ld(Ys({},e),{steps:(n=e.steps)!=null?n:1}))}decreaseScale(e={}){var n;this.updateScale(ld(Ys({},e),{steps:-((n=e.steps)!=null?n:1)}))}get containerTopLeft(){return ie(this,$b)||it(this,$b,[this.container.offsetTop,this.container.offsetLeft])}get annotationEditorMode(){return ie(this,Ir)?ie(this,ll):Bt.AnnotationEditorType.DISABLE}set annotationEditorMode({mode:e,editId:n=null,isFromKeyboard:a=!1}){var r;if(!ie(this,Ir))throw new Error("The AnnotationEditor is not enabled.");if(ie(this,ll)===e)return;if(!CT(e))throw new Error(`Invalid AnnotationEditor mode: ${e}`);if(!this.pdfDocument)return;e===Bt.AnnotationEditorType.STAMP&&((r=ie(this,ju))==null||r.loadModel("altText"));const{eventBus:i}=this,s=()=>{Se(this,eh,cv).call(this),it(this,ll,e),ie(this,Ir).updateMode(e,n,a),i.dispatch("annotationeditormodechanged",{source:this,mode:e})};if(e===Bt.AnnotationEditorType.NONE||ie(this,ll)===Bt.AnnotationEditorType.NONE){const o=e!==Bt.AnnotationEditorType.NONE;o||this.pdfDocument.annotationStorage.resetModifiedIds();for(const c of this._pages)c.toggleEditingMode(o);const l=Se(this,U0,x5).call(this);if(o&&l){Se(this,eh,cv).call(this),it(this,Ku,new AbortController);const c=AbortSignal.any([ie(this,nd).signal,ie(this,Ku).signal]);i._on("pagerendered",({pageNumber:d})=>{l.delete(d),l.size===0&&it(this,Xu,setTimeout(s,0))},{signal:c});return}}s()}refresh(e=!1,n=Object.create(null)){if(this.pdfDocument){for(const a of this._pages)a.update(n);ie(this,id)!==null&&(clearTimeout(ie(this,id)),it(this,id,null)),e||this.update()}}}td=new WeakMap,Nb=new WeakMap,Bb=new WeakMap,ll=new WeakMap,Ir=new WeakMap,Gu=new WeakMap,$b=new WeakMap,Ob=new WeakMap,Rb=new WeakMap,Ub=new WeakMap,Hb=new WeakMap,qb=new WeakMap,nd=new WeakMap,ju=new WeakMap,Ku=new WeakMap,Xu=new WeakMap,Kp=new WeakMap,ad=new WeakMap,Xp=new WeakMap,Wb=new WeakMap,Zp=new WeakMap,Zu=new WeakMap,id=new WeakMap,Jp=new WeakMap,N0=new WeakSet,b5=function(e){const n={annotationEditorMode:ie(this,ll),annotationMode:ie(this,Gu),textLayerMode:ie(this,Jp)};return e&&(!e.includes(Bt.PermissionFlag.COPY)&&ie(this,Jp)===bo.ENABLE&&(n.textLayerMode=bo.ENABLE_PERMISSIONS),e.includes(Bt.PermissionFlag.MODIFY_CONTENTS)||(n.annotationEditorMode=Bt.AnnotationEditorType.DISABLE),!e.includes(Bt.PermissionFlag.MODIFY_ANNOTATIONS)&&!e.includes(Bt.PermissionFlag.FILL_INTERACTIVE_FORMS)&&ie(this,Gu)===Bt.AnnotationMode.ENABLE_FORMS&&(n.annotationMode=Bt.AnnotationMode.ENABLE)),n},B0=new WeakSet,y5=function(e){return Rt(this,null,function*(){if(document.visibilityState==="hidden"||!this.container.offsetParent||this._getVisiblePages().views.length===0)return;const n=Promise.withResolvers(),a=new AbortController;document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&n.resolve()},{signal:typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL")||typeof AbortSignal.any=="function"?AbortSignal.any([e,a.signal]):e}),yield Promise.race([this._onePageRenderedCapability.promise,n.promise]),a.abort()})},$0=new WeakSet,_5=function(e,n){const a=document.getSelection(),{focusNode:i,anchorNode:s}=a;if(s&&i&&a.containsNode(ie(this,ad))){if(ie(this,Kp)||e===bo.ENABLE_PERMISSIONS){n.preventDefault(),n.stopPropagation();return}it(this,Kp,!0);const{classList:r}=this.viewer;r.add("copyAll");const o=new AbortController;window.addEventListener("keydown",l=>it(this,Xp,l.key==="Escape"),{signal:o.signal}),this.getAllText().then(l=>Rt(this,null,function*(){l!==null&&(yield navigator.clipboard.writeText(l))})).catch(l=>{console.warn(`Something goes wrong when extracting the text: ${l.message}`)}).finally(()=>{it(this,Kp,!1),it(this,Xp,!1),o.abort(),r.remove("copyAll")}),n.preventDefault(),n.stopPropagation()}},Ju=new WeakSet,fy=function(){if(this._scrollMode!==On.PAGE)throw new Error("#ensurePageViewVisible: Invalid scrollMode value.");const e=this._currentPageNumber,n=ie(this,Zu),a=this.viewer;if(a.textContent="",n.pages.length=0,this._spreadMode===Na.NONE&&!this.isInPresentationMode){const i=this._pages[e-1];a.append(i.div),n.pages.push(i)}else{const i=new Set,s=this._spreadMode-1;s===-1?i.add(e-1):e%2!==s?(i.add(e-1),i.add(e)):(i.add(e-2),i.add(e-1));const r=document.createElement("div");if(r.className="spread",this.isInPresentationMode){const o=document.createElement("div");o.className="dummyPage",r.append(o)}for(const o of i){const l=this._pages[o];l&&(r.append(l.div),n.pages.push(l))}a.append(r)}n.scrollDown=e>=n.previousPageNumber,n.previousPageNumber=e},Qp=new WeakSet,lv=function(e,n=null){const{div:a,id:i}=e;if(this._currentPageNumber!==i&&this._setCurrentPageNumber(i),this._scrollMode===On.PAGE&&(Se(this,Ju,fy).call(this),this.update()),!n&&!this.isInPresentationMode){const s=a.offsetLeft+a.clientLeft,r=s+a.clientWidth,{scrollLeft:o,clientWidth:l}=this.container;(this._scrollMode===On.HORIZONTAL||s<o||r>o+l)&&(n={left:0,top:0})}Cx(a,n),!this._currentScaleValue&&this._location&&(this._location=null)},O0=new WeakSet,w5=function(e){return e===this._currentScale||Math.abs(e-this._currentScale)<1e-15},Vb=new WeakSet,s2=function(e,n,{noScroll:a=!1,preset:i=!1,drawingDelay:s=-1,origin:r=null}){if(this._currentScaleValue=n.toString(),Se(this,O0,w5).call(this,e)){i&&this.eventBus.dispatch("scalechanging",{source:this,scale:e,presetValue:n});return}this.viewer.style.setProperty("--scale-factor",e*Bt.PixelsPerInch.PDF_TO_CSS_UNITS);const o=s>=0&&s<1e3;this.refresh(!0,{scale:e,drawingDelay:o?s:-1}),o&&it(this,id,setTimeout(()=>{it(this,id,null),this.refresh()},s));const l=this._currentScale;if(this._currentScale=e,!a){let c=this._currentPageNumber,d;if(this._location&&!(this.isInPresentationMode||this.isChangingPresentationMode)&&(c=this._location.pageNumber,d=[null,{name:"XYZ"},this._location.left,this._location.top,null]),this.scrollPageIntoView({pageNumber:c,destArray:d,allowNegativeOffset:!0}),Array.isArray(r)){const u=e/l-1,[g,f]=this.containerTopLeft;this.container.scrollLeft+=(r[0]-f)*u,this.container.scrollTop+=(r[1]-g)*u}}this.eventBus.dispatch("scalechanging",{source:this,scale:e,presetValue:i?n:void 0}),this.defaultRenderingQueue&&this.update()},R0=new WeakSet,v5=function(){return this._spreadMode!==Na.NONE&&this._scrollMode!==On.HORIZONTAL?2:1},cl=new WeakSet,cd=function(e,n){let a=parseFloat(e);if(a>0)n.preset=!1,Se(this,Vb,s2).call(this,a,e,n);else{const i=this._pages[this._currentPageNumber-1];if(!i)return;let s=OA,r=RA;this.isInPresentationMode?(s=r=4,this._spreadMode!==Na.NONE&&(s*=2)):(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&this.removePageBorders?s=r=0:this._scrollMode===On.HORIZONTAL&&([s,r]=[r,s]);const o=(this.container.clientWidth-s)/i.width*i.scale/ie(this,R0,v5),l=(this.container.clientHeight-r)/i.height*i.scale;switch(e){case"page-actual":a=1;break;case"page-width":a=o;break;case"page-height":a=l;break;case"page-fit":a=Math.min(o,l);break;case"auto":const c=Lx(i)?o:Math.min(l,o);a=Math.min(XF,c);break;default:console.error(`#setScale: "${e}" is an unknown zoom value.`);return}n.preset=!0,Se(this,Vb,s2).call(this,a,e,n)}},zb=new WeakSet,r2=function(){const e=this._pages[this._currentPageNumber-1];this.isInPresentationMode&&Se(this,cl,cd).call(this,this._currentScaleValue,{noScroll:!0}),Se(this,Qp,lv).call(this,e)},U0=new WeakSet,x5=function(){const e=this._getVisiblePages(),n=[],{ids:a,views:i}=e;for(const s of i){const{view:r}=s;if(!r.hasEditableAnnotations()){a.delete(r.id);continue}n.push(s)}return n.length===0?null:(this.renderingQueue.renderHighestPriority({first:n[0],last:n.at(-1),views:n,ids:a}),a)},H0=new WeakSet,E5=function(e){return Rt(this,null,function*(){if(e.pdfPage)return e.pdfPage;try{const n=yield this.pdfDocument.getPage(e.id);return e.pdfPage||e.setPdfPage(n),n}catch(n){return console.error("Unable to get page for page view",n),null}})},q0=new WeakSet,k5=function(e){var n,a;if(((n=e.first)==null?void 0:n.id)===1)return!0;if(((a=e.last)==null?void 0:a.id)===this.pagesCount)return!1;switch(this._scrollMode){case On.PAGE:return ie(this,Zu).scrollDown;case On.HORIZONTAL:return this.scroll.right}return this.scroll.down},Yb=new WeakSet,o2=function(e=this.container.clientHeight){e!==ie(this,Wb)&&(it(this,Wb,e),GA.setProperty("--viewer-container-height",`${e}px`))},W0=new WeakSet,S5=function(e){for(const n of e)if(n.target===this.container){Se(this,Yb,o2).call(this,Math.floor(n.borderBoxSize[0].blockSize)),it(this,$b,null);break}},eh=new WeakSet,cv=function(){var e;(e=ie(this,Ku))==null||e.abort(),it(this,Ku,null),ie(this,Xu)!==null&&(clearTimeout(ie(this,Xu)),it(this,Xu,null))};class MP{constructor(e,n){Ae(this,th);Ae(this,V0);Ae(this,z0);Ae(this,Gb);Ae(this,jb);Ae(this,Io,void 0);it(this,Io,e);const a=[{element:e.presentationModeButton,eventName:"presentationmode",close:!0},{element:e.printButton,eventName:"print",close:!0},{element:e.downloadButton,eventName:"download",close:!0},{element:e.viewBookmarkButton,eventName:null,close:!0},{element:e.firstPageButton,eventName:"firstpage",close:!0},{element:e.lastPageButton,eventName:"lastpage",close:!0},{element:e.pageRotateCwButton,eventName:"rotatecw",close:!1},{element:e.pageRotateCcwButton,eventName:"rotateccw",close:!1},{element:e.cursorSelectToolButton,eventName:"switchcursortool",eventDetails:{tool:Os.SELECT},close:!0},{element:e.cursorHandToolButton,eventName:"switchcursortool",eventDetails:{tool:Os.HAND},close:!0},{element:e.scrollPageButton,eventName:"switchscrollmode",eventDetails:{mode:On.PAGE},close:!0},{element:e.scrollVerticalButton,eventName:"switchscrollmode",eventDetails:{mode:On.VERTICAL},close:!0},{element:e.scrollHorizontalButton,eventName:"switchscrollmode",eventDetails:{mode:On.HORIZONTAL},close:!0},{element:e.scrollWrappedButton,eventName:"switchscrollmode",eventDetails:{mode:On.WRAPPED},close:!0},{element:e.spreadNoneButton,eventName:"switchspreadmode",eventDetails:{mode:Na.NONE},close:!0},{element:e.spreadOddButton,eventName:"switchspreadmode",eventDetails:{mode:Na.ODD},close:!0},{element:e.spreadEvenButton,eventName:"switchspreadmode",eventDetails:{mode:Na.EVEN},close:!0},{element:e.imageAltTextSettingsButton,eventName:"imagealttextsettings",close:!0},{element:e.documentPropertiesButton,eventName:"documentproperties",close:!0}];(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&a.push({element:e.openFileButton,eventName:"openfile",close:!0}),this.eventBus=n,this.opened=!1,Se(this,V0,A5).call(this,a),this.reset()}get isOpen(){return this.opened}setPageNumber(e){this.pageNumber=e,Se(this,th,dv).call(this)}setPagesCount(e){this.pagesCount=e,Se(this,th,dv).call(this)}reset(){this.pageNumber=0,this.pagesCount=0,Se(this,th,dv).call(this),this.eventBus.dispatch("switchcursortool",{source:this,reset:!0}),Se(this,Gb,l2).call(this,{mode:On.VERTICAL}),Se(this,jb,c2).call(this,{mode:Na.NONE})}open(){if(this.opened)return;this.opened=!0;const{toggleButton:e,toolbar:n}=ie(this,Io);zo(e,!0,n)}close(){if(!this.opened)return;this.opened=!1;const{toggleButton:e,toolbar:n}=ie(this,Io);zo(e,!1,n)}toggle(){this.opened?this.close():this.open()}}Io=new WeakMap,th=new WeakSet,dv=function(){const{firstPageButton:e,lastPageButton:n,pageRotateCwButton:a,pageRotateCcwButton:i}=ie(this,Io);e.disabled=this.pageNumber<=1,n.disabled=this.pageNumber>=this.pagesCount,a.disabled=this.pagesCount===0,i.disabled=this.pagesCount===0},V0=new WeakSet,A5=function(e){const{eventBus:n}=this,{toggleButton:a}=ie(this,Io);a.addEventListener("click",this.toggle.bind(this));for(const{element:i,eventName:s,close:r,eventDetails:o}of e)i.addEventListener("click",l=>{s!==null&&n.dispatch(s,Ys({source:this},o)),r&&this.close(),n.dispatch("reporttelemetry",{source:this,details:{type:"buttons",data:{id:i.id}}})});n._on("cursortoolchanged",Se(this,z0,T5).bind(this)),n._on("scrollmodechanged",Se(this,Gb,l2).bind(this)),n._on("spreadmodechanged",Se(this,jb,c2).bind(this))},z0=new WeakSet,T5=function({tool:e,disabled:n}){const{cursorSelectToolButton:a,cursorHandToolButton:i}=ie(this,Io);yr(a,e===Os.SELECT),yr(i,e===Os.HAND),a.disabled=n,i.disabled=n},Gb=new WeakSet,l2=function({mode:e}){const{scrollPageButton:n,scrollVerticalButton:a,scrollHorizontalButton:i,scrollWrappedButton:s,spreadNoneButton:r,spreadOddButton:o,spreadEvenButton:l}=ie(this,Io);yr(n,e===On.PAGE),yr(a,e===On.VERTICAL),yr(i,e===On.HORIZONTAL),yr(s,e===On.WRAPPED);const c=this.pagesCount>og.FORCE_SCROLL_MODE_PAGE;n.disabled=c,a.disabled=c,i.disabled=c,s.disabled=c;const d=e===On.HORIZONTAL;r.disabled=d,o.disabled=d,l.disabled=d},jb=new WeakSet,c2=function({mode:e}){const{spreadNoneButton:n,spreadOddButton:a,spreadEvenButton:i}=ie(this,Io);yr(n,e===Na.NONE),yr(a,e===Na.ODD),yr(i,e===Na.EVEN)};class LT{constructor(e,n,a=0){Ae(this,Kb);Ae(this,Y0);Ae(this,G0);Ae(this,Xb);Ae(this,Qu);Ae(this,sd,void 0);it(this,sd,e),this.eventBus=n;const i=[{element:e.previous,eventName:"previouspage"},{element:e.next,eventName:"nextpage"},{element:e.zoomIn,eventName:"zoomin"},{element:e.zoomOut,eventName:"zoomout"},{element:e.print,eventName:"print"},{element:e.download,eventName:"download"},{element:e.editorFreeTextButton,eventName:"switchannotationeditormode",eventDetails:{get mode(){const{classList:s}=e.editorFreeTextButton;return s.contains("toggled")?Bt.AnnotationEditorType.NONE:Bt.AnnotationEditorType.FREETEXT}}},{element:e.editorHighlightButton,eventName:"switchannotationeditormode",eventDetails:{get mode(){const{classList:s}=e.editorHighlightButton;return s.contains("toggled")?Bt.AnnotationEditorType.NONE:Bt.AnnotationEditorType.HIGHLIGHT}}},{element:e.editorInkButton,eventName:"switchannotationeditormode",eventDetails:{get mode(){const{classList:s}=e.editorInkButton;return s.contains("toggled")?Bt.AnnotationEditorType.NONE:Bt.AnnotationEditorType.INK}}},{element:e.editorStampButton,eventName:"switchannotationeditormode",eventDetails:{get mode(){const{classList:s}=e.editorStampButton;return s.contains("toggled")?Bt.AnnotationEditorType.NONE:Bt.AnnotationEditorType.STAMP}},telemetry:{type:"editing",data:{action:"pdfjs.image.icon_click"}}}];Se(this,G0,C5).call(this,i),Se(this,Kb,d2).call(this,{value:a}),this.reset()}setPageNumber(e,n){this.pageNumber=e,this.pageLabel=n,Se(this,Qu,py).call(this,!1)}setPagesCount(e,n){this.pagesCount=e,this.hasPageLabels=n,Se(this,Qu,py).call(this,!0)}setPageScale(e,n){this.pageScaleValue=(e||n).toString(),this.pageScale=n,Se(this,Qu,py).call(this,!1)}reset(){this.pageNumber=0,this.pageLabel=null,this.hasPageLabels=!1,this.pagesCount=0,this.pageScaleValue=ag,this.pageScale=Tx,Se(this,Qu,py).call(this,!0),this.updateLoadingIndicatorState(),Se(this,Xb,u2).call(this,{mode:Bt.AnnotationEditorType.DISABLE})}updateLoadingIndicatorState(e=!1){const{pageNumber:n}=ie(this,sd);n.classList.toggle("loading",e)}}sd=new WeakMap,Kb=new WeakSet,d2=function({value:e}){let n="normal";switch(e){case 1:n="compact";break;case 2:n="touch";break}document.documentElement.setAttribute("data-toolbar-density",n)},Y0=new WeakSet,D5=function(e,n){const a=new Bt.ColorPicker({uiManager:e});e.setMainHighlightColorPicker(a),n.append(a.renderMainDropdown())},G0=new WeakSet,C5=function(e){const{eventBus:n}=this,{editorHighlightColorPicker:a,editorHighlightButton:i,pageNumber:s,scaleSelect:r}=ie(this,sd),o=this;for(const{element:l,eventName:c,eventDetails:d,telemetry:u}of e)l.addEventListener("click",g=>{c!==null&&n.dispatch(c,ld(Ys({source:this},d),{isFromKeyboard:g.detail===0})),u&&n.dispatch("reporttelemetry",{source:this,details:u})});s.addEventListener("click",function(){this.select()}),s.addEventListener("change",function(){n.dispatch("pagenumberchanged",{source:o,value:this.value})}),r.addEventListener("change",function(){this.value!=="custom"&&n.dispatch("scalechanged",{source:o,value:this.value})}),r.addEventListener("click",function({target:l}){this.value===o.pageScaleValue&&l.tagName.toUpperCase()==="OPTION"&&this.blur()}),r.oncontextmenu=Bt.noContextMenu,n._on("annotationeditormodechanged",Se(this,Xb,u2).bind(this)),n._on("showannotationeditorui",({mode:l})=>{switch(l){case Bt.AnnotationEditorType.HIGHLIGHT:i.click();break}}),n._on("toolbardensity",Se(this,Kb,d2).bind(this)),a&&n._on("annotationeditoruimanager",({uiManager:l})=>{Se(this,Y0,D5).call(this,l,a)},{once:!0})},Xb=new WeakSet,u2=function({mode:e}){const{editorFreeTextButton:n,editorFreeTextParamsToolbar:a,editorHighlightButton:i,editorHighlightParamsToolbar:s,editorInkButton:r,editorInkParamsToolbar:o,editorStampButton:l,editorStampParamsToolbar:c}=ie(this,sd);zo(n,e===Bt.AnnotationEditorType.FREETEXT,a),zo(i,e===Bt.AnnotationEditorType.HIGHLIGHT,s),zo(r,e===Bt.AnnotationEditorType.INK,o),zo(l,e===Bt.AnnotationEditorType.STAMP,c);const d=e===Bt.AnnotationEditorType.DISABLE;n.disabled=d,i.disabled=d,r.disabled=d,l.disabled=d},Qu=new WeakSet,py=function(e=!1){const{pageNumber:n,pagesCount:a,pageScaleValue:i,pageScale:s}=this,r=ie(this,sd);e&&(this.hasPageLabels?(r.pageNumber.type="text",r.numPages.setAttribute("data-l10n-id","pdfjs-page-of-pages")):(r.pageNumber.type="number",r.numPages.textContent="/ "+a),r.pageNumber.max=a),this.hasPageLabels?(r.pageNumber.value=this.pageLabel,r.numPages.textContent=`(${n} / ${a})`):r.pageNumber.value=n,r.previous.disabled=n<=1,r.next.disabled=n>=a,r.zoomOut.disabled=s<=BA,r.zoomIn.disabled=s>=$A;let o=!1;for(const l of r.scaleSelect.options){if(l.value!==i){l.selected=!1;continue}l.selected=!0,o=!0}o||(r.customScaleOption.selected=!0,r.customScaleOption.textContent=`${Math.round(s*1e4)/100}%`)};const FP=20;class PP{constructor(e,n=FP){this.fingerprint=e,this.cacheSize=n,this._initializedPromise=this._readFromStorage().then(a=>{const i=JSON.parse(a||"{}");let s=-1;if(!Array.isArray(i.files))i.files=[];else{for(;i.files.length>=this.cacheSize;)i.files.shift();for(let r=0,o=i.files.length;r<o;r++)if(i.files[r].fingerprint===this.fingerprint){s=r;break}}s===-1&&(s=i.files.push({fingerprint:this.fingerprint})-1),this.file=i.files[s],this.database=i})}_writeToStorage(){return Rt(this,null,function*(){const e=JSON.stringify(this.database);if(typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL")){sessionStorage.setItem("pdfjs.history",e);return}window.siyuan.storage["pdfjs.history"]=e,Gt("pdfjs.history",e)})}_readFromStorage(){return Rt(this,null,function*(){return typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL")?sessionStorage.getItem("pdfjs.history"):window.siyuan.storage["pdfjs.history"]})}set(e,n){return Rt(this,null,function*(){return yield this._initializedPromise,this.file[e]=n,this._writeToStorage()})}setMultiple(e){return Rt(this,null,function*(){yield this._initializedPromise;for(const n in e)this.file[n]=e[n];return this._writeToStorage()})}get(e,n){return Rt(this,null,function*(){yield this._initializedPromise;const a=this.file[e];return a!==void 0?a:n})}getMultiple(e){return Rt(this,null,function*(){yield this._initializedPromise;const n=Object.create(null);for(const a in e){const i=this.file[a];n[a]=i!==void 0?i:e[a]}return n})}}const NP=1e4,n1={UNKNOWN:-1,PREVIOUS:0,INITIAL:1};class IT{constructor(e){this.pdfId=e,this.initialBookmark=document.location.hash.substring(1),this._initializedCapability=ld(Ys({},Promise.withResolvers()),{settled:!1}),this.appConfig=null,this.pdfDocument=null,this.pdfLoadingTask=null,this.printService=null,this.pdfViewer=null,this.pdfThumbnailViewer=null,this.pdfRenderingQueue=null,this.pdfPresentationMode=null,this.pdfDocumentProperties=null,this.pdfLinkService=null,this.pdfHistory=null,this.pdfSidebar=null,this.pdfOutlineViewer=null,this.pdfAttachmentViewer=null,this.pdfLayerViewer=null,this.pdfCursorTools=null,this.pdfScriptingManager=null,this.store=null,this.downloadManager=null,this.overlayManager=null,this.preferences=new d4,this.toolbar=null,this.secondaryToolbar=null,this.eventBus=null,this.l10n=null,this.annotationEditorParams=null,this.imageAltTextSettings=null,this.isInitialViewSet=!1,this.isViewerEmbedded=!0,this.url="",this.baseUrl="",this.mlManager=null,this._downloadUrl="",this._eventBusAbortController=null,this._windowAbortController=null,this._globalAbortController=new AbortController,this.documentInfo=null,this.metadata=null,this._contentDispositionFilename=null,this._contentLength=null,this._saveInProgress=!1,this._wheelUnusedTicks=0,this._wheelUnusedFactor=1,this._touchUnusedTicks=0,this._touchUnusedFactor=1,this._PDFBug=null,this._hasAnnotationEditors=!1,this._title=document.title,this._printAnnotationStoragePromise=null,this._touchInfo=null,this._isCtrlKeyDown=!1,this._caretBrowsing=null,this._isScrolling=!1}initialize(e){return Rt(this,null,function*(){var n;this.appConfig=e;try{yield this.preferences.initializedPromise}catch(a){console.error(`initialize: "${a.message}".`)}if(en.get("pdfBugEnabled")&&(yield this._parseHashParams()),typeof PDFJSDev=="undefined"||!PDFJSDev.test("MOZCENTRAL")){let a;switch(en.get("viewerCssTheme")){case 1:a="is-light";break;case 2:a="is-dark";break}a&&document.documentElement.classList.add(a),(typeof PDFJSDev=="undefined"||PDFJSDev.test("TESTING"))&&en.get("enableFakeMLManager")&&(this.mlManager=((n=x_.getFakeMLManager)==null?void 0:n.call(x_,{enableGuessAltText:en.get("enableGuessAltText"),enableAltTextModelDownload:en.get("enableAltTextModelDownload")}))||null)}else en.get("enableAltText")&&(this.mlManager=new x_({enableGuessAltText:en.get("enableGuessAltText"),enableAltTextModelDownload:en.get("enableAltTextModelDownload"),altTextLearnMoreUrl:en.get("altTextLearnMoreUrl")}));this.l10n=yield this.externalServices.createL10n(),document.getElementsByTagName("html")[0].dir=this.l10n.getDirection(),(typeof PDFJSDev=="undefined"||!PDFJSDev.test("MOZCENTRAL"))&&this.l10n.translate(e.appContainer||document.documentElement),this.isViewerEmbedded&&en.get("externalLinkTarget")===xl.NONE&&en.set("externalLinkTarget",xl.TOP),yield this._initializeViewerComponents(),this.bindEvents(),this.bindWindowEvents(),this._initializedCapability.settled=!0,this._initializedCapability.resolve()})}_parseHashParams(){return Rt(this,null,function*(){var o;const e=document.location.hash.substring(1);if(!e)return;const{mainContainer:n,viewerContainer:a}=this.appConfig,i=ig(e),s=()=>Rt(this,null,function*(){this._PDFBug});if(i.get("disableworker")==="true")try{(o=Bt.GlobalWorkerOptions).workerSrc||(o.workerSrc=en.get("workerSrc")),typeof PDFJSDev=="undefined"?globalThis.pdfjsWorker=yield Tn(2843)(`${p.PROTYLE_CDN}/js/pdf/pdf.worker.mjs`):yield __non_webpack_import__(Bt.PDFWorker.workerSrc)}catch(l){console.error(`_parseHashParams: "${l.message}".`)}if(i.has("textlayer"))switch(i.get("textlayer")){case"off":en.set("textLayerMode",bo.DISABLE);break;case"visible":case"shadow":case"hover":a.classList.add(`textLayer-${i.get("textlayer")}`);try{yield s(),this._PDFBug.loadCSS()}catch(l){console.error(`_parseHashParams: "${l.message}".`)}break}if(i.has("pdfbug")){en.setAll({pdfBug:!0,fontExtraProperties:!0});const l=i.get("pdfbug").split(",");try{yield s(),this._PDFBug.init(n,l)}catch(c){console.error(`_parseHashParams: "${c.message}".`)}}(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&i.has("locale")&&en.set("localeProperties",{lang:i.get("locale")});const r={disableAutoFetch:l=>l==="true",disableFontFace:l=>l==="true",disableHistory:l=>l==="true",disableRange:l=>l==="true",disableStream:l=>l==="true",verbosity:l=>l|0};typeof PDFJSDev!="undefined"&&PDFJSDev.test("TESTING")&&Object.assign(r,{enableAltText:l=>l==="true",enableFakeMLManager:l=>l==="true",enableGuessAltText:l=>l==="true",enableUpdatedAddImage:l=>l==="true",highlightEditorColors:l=>l,maxCanvasPixels:l=>parseInt(l),spreadModeOnLoad:l=>parseInt(l),supportsCaretBrowsingMode:l=>l==="true"});for(const l in r){const c=r[l],d=l.toLowerCase();i.has(d)&&en.set(l,c(i.get(d)))}})}_initializeViewerComponents(){return Rt(this,null,function*(){var y,_,v,U,ee,Z,k,w,S,B,H;const{appConfig:e,externalServices:n,l10n:a}=this,i=typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL")?new o4(en.get("allowedGlobalEvents"),n,en.get("isInAutomation")):new Fx;this.eventBus=en.eventBus=i,(y=this.mlManager)==null||y.setEventBus(i,this._globalAbortController.signal),this.overlayManager=new g4;const s=new hT;s.onIdle=this._cleanup.bind(this),this.pdfRenderingQueue=s;const r=new v_({eventBus:i,externalLinkTarget:en.get("externalLinkTarget"),externalLinkRel:en.get("externalLinkRel"),ignoreDestinationZoom:en.get("ignoreDestinationZoom")});this.pdfLinkService=r;const o=this.downloadManager=new h4,l=new z4({linkService:r,eventBus:i,updateMatchesCountOnProgress:typeof PDFJSDev=="undefined"?!window.isGECKOVIEW:!PDFJSDev.test("GECKOVIEW")});this.findController=l;const c=new cP({eventBus:i,externalServices:n,docProperties:this._scriptingDocProperties.bind(this)});this.pdfScriptingManager=c;const d=e.mainContainer,u=e.viewerContainer,g=en.get("annotationEditorMode"),f=en.get("forcePageColors")||window.matchMedia("(forced-colors: active)").matches?{background:en.get("pageColorsBackground"),foreground:en.get("pageColorsForeground")}:null;let h;const m=en.get("enableHWA"),b=new IP({container:d,viewer:u,eventBus:i,renderingQueue:s,linkService:r,downloadManager:o,altTextManager:h,findController:l,scriptingManager:en.get("enableScripting")&&c,l10n:a,textLayerMode:en.get("textLayerMode"),annotationMode:en.get("annotationMode"),annotationEditorMode:g,annotationEditorHighlightColors:en.get("highlightEditorColors"),enableHighlightFloatingButton:en.get("enableHighlightFloatingButton"),enableUpdatedAddImage:en.get("enableUpdatedAddImage"),enableNewAltTextWhenAddingImage:en.get("enableNewAltTextWhenAddingImage"),imageResourcesPath:en.get("imageResourcesPath"),enablePrintAutoRotate:en.get("enablePrintAutoRotate"),maxCanvasPixels:en.get("maxCanvasPixels"),enablePermissions:en.get("enablePermissions"),pageColors:f,mlManager:this.mlManager,abortSignal:this._globalAbortController.signal,enableHWA:m});if(this.pdfViewer=b,s.setViewer(b),r.setViewer(b),c.setViewer(b),(_=e.sidebar)!=null&&_.thumbnailView&&(this.pdfThumbnailViewer=new gP({container:e.sidebar.thumbnailView,eventBus:i,renderingQueue:s,linkService:r,pageColors:f,abortSignal:this._globalAbortController.signal,enableHWA:m}),s.setThumbnailViewer(this.pdfThumbnailViewer)),!this.isViewerEmbedded&&!en.get("disableHistory")&&(this.pdfHistory=new K4({linkService:r,eventBus:i}),r.setHistory(this.pdfHistory)),!this.supportsIntegratedFind&&e.findBar&&(this.findBar=new G4(e.findBar,e.principalContainer,i)),e.annotationEditorParams)if((typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL")||typeof AbortSignal.any=="function")&&g!==Bt.AnnotationEditorType.DISABLE)this.annotationEditorParams=new p4(e.annotationEditorParams,i);else for(const j of["editorModeButtons","editorModeSeparator"])(v=document.getElementById(j))==null||v.classList.add("hidden");if(this.mlManager&&((U=e.secondaryToolbar)!=null&&U.imageAltTextSettingsButton),e.documentProperties&&(this.pdfDocumentProperties=new E4(e.documentProperties,this.overlayManager,i,a,()=>this._docFilename)),(ee=e.secondaryToolbar)!=null&&ee.cursorHandToolButton&&(this.pdfCursorTools=new w4({container:d,eventBus:i,cursorToolOnLoad:en.get("cursorToolOnLoad")})),e.toolbar)if(typeof PDFJSDev=="undefined"?window.isGECKOVIEW:PDFJSDev.test("GECKOVIEW")){const j=JSON.parse(en.get("nimbusDataStr")||"null");this.toolbar=new LT(e.toolbar,i,j)}else this.toolbar=new LT(e.toolbar,i,en.get("toolbarDensity"));e.secondaryToolbar&&(en.get("enableAltText")&&((Z=e.secondaryToolbar.imageAltTextSettingsButton)==null||Z.classList.remove("hidden"),(k=e.secondaryToolbar.imageAltTextSettingsSeparator)==null||k.classList.remove("hidden")),this.secondaryToolbar=new MP(e.secondaryToolbar,i)),this.supportsFullscreen&&((w=e.secondaryToolbar)!=null&&w.presentationModeButton)&&(this.pdfPresentationMode=new aP({container:d,pdfViewer:b,eventBus:i})),e.passwordOverlay&&(this.passwordPrompt=new m4(e.passwordOverlay,this.overlayManager,this.isViewerEmbedded)),(S=e.sidebar)!=null&&S.outlineView&&(this.pdfOutlineViewer=new Q4({container:e.sidebar.outlineView,eventBus:i,l10n:a,linkService:r,downloadManager:o})),(B=e.sidebar)!=null&&B.attachmentsView&&(this.pdfAttachmentViewer=new y4({container:e.sidebar.attachmentsView,eventBus:i,l10n:a,downloadManager:o})),(H=e.sidebar)!=null&&H.layersView&&(this.pdfLayerViewer=new J4({container:e.sidebar.layersView,eventBus:i,l10n:a})),e.sidebar&&(this.pdfSidebar=new uP({elements:e.sidebar,eventBus:i,l10n:a}),this.pdfSidebar.onToggled=this.forceRendering.bind(this),this.pdfSidebar.onUpdateThumbnails=()=>{var j;for(const re of b.getCachedPageViews())re.renderingState===aa.FINISHED&&((j=this.pdfThumbnailViewer.getThumbnail(re.id-1))==null||j.setImage(re));this.pdfThumbnailViewer.scrollThumbnailIntoView(b.currentPageNumber)})})}run(e){return Rt(this,null,function*(){var s,r,o,l,c,d,u;yield this.initialize(e);const{appConfig:n,eventBus:a}=this;let i;if(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC")){const g=document.location.search.substring(1);i=(s=ig(g).get("file"))!=null?s:en.get("defaultUrl"),BP(i)}else PDFJSDev.test("MOZCENTRAL")?i=window.location.href:PDFJSDev.test("CHROME")&&(i=en.get("defaultUrl"));if(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC")){const g=this._openFileInput=document.createElement("input");g.id="fileInput",g.hidden=!0,g.type="file",g.value=null,document.body.append(g),g.addEventListener("change",function(f){const{files:h}=f.target;!h||h.length===0||a.dispatch("fileinputchange",{source:this,fileInput:f.target})}),n.mainContainer.addEventListener("dragover",function(f){for(const h of f.dataTransfer.items)if(h.type==="application/pdf"){f.dataTransfer.dropEffect=f.dataTransfer.effectAllowed==="copy"?"copy":"move",f.preventDefault(),f.stopPropagation();return}}),n.mainContainer.addEventListener("drop",function(f){var h;((h=f.dataTransfer.files)==null?void 0:h[0].type)==="application/pdf"&&(f.preventDefault(),f.stopPropagation(),a.dispatch("fileinputchange",{source:this,fileInput:f.dataTransfer}))})}if(en.get("supportsDocumentFonts")||(en.set("disableFontFace",!0),this.l10n.get("pdfjs-web-fonts-disabled").then(g=>{console.warn(g)})),this.supportsPrinting||((o=(r=n.toolbar)==null?void 0:r.print)==null||o.classList.add("hidden"),(l=n.secondaryToolbar)==null||l.printButton.classList.add("hidden")),this.supportsFullscreen||(c=n.secondaryToolbar)==null||c.presentationModeButton.classList.add("hidden"),this.supportsIntegratedFind&&((u=(d=n.findBar)==null?void 0:d.toggleButton)==null||u.classList.add("hidden")),typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))i?this.open({url:i}):this._hideViewBookmark();else if(PDFJSDev.test("MOZCENTRAL || CHROME"))this.setTitleUsingUrl(i,i),this.externalServices.initPassiveLoading();else throw new Error("Not implemented: run")})}get externalServices(){return(0,Bt.shadow)(this,"externalServices",new u4)}get initialized(){return this._initializedCapability.settled}get initializedPromise(){return this._initializedCapability.promise}updateZoom(e,n,a){this.pdfViewer.isInPresentationMode||this.pdfViewer.updateScale({drawingDelay:en.get("defaultZoomDelay"),steps:e,scaleFactor:n,origin:a})}zoomIn(){this.updateZoom(1)}zoomOut(){this.updateZoom(-1)}zoomReset(){this.pdfViewer.isInPresentationMode||(this.pdfViewer.currentScaleValue=ag)}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return this.pdfViewer.currentPageNumber}set page(e){this.pdfViewer.currentPageNumber=e}get supportsPrinting(){return pT.supportsPrinting}get supportsFullscreen(){return(0,Bt.shadow)(this,"supportsFullscreen",document.fullscreenEnabled)}get supportsPinchToZoom(){return(0,Bt.shadow)(this,"supportsPinchToZoom",en.get("supportsPinchToZoom"))}get supportsIntegratedFind(){return(0,Bt.shadow)(this,"supportsIntegratedFind",en.get("supportsIntegratedFind"))}get loadingBar(){const e=this.appConfig.appContainer.querySelector("#loadingBar"),n=e?new a4(e):null;return(0,Bt.shadow)(this,"loadingBar",n)}get supportsMouseWheelZoomCtrlKey(){return(0,Bt.shadow)(this,"supportsMouseWheelZoomCtrlKey",en.get("supportsMouseWheelZoomCtrlKey"))}get supportsMouseWheelZoomMetaKey(){return(0,Bt.shadow)(this,"supportsMouseWheelZoomMetaKey",en.get("supportsMouseWheelZoomMetaKey"))}get supportsCaretBrowsingMode(){return en.get("supportsCaretBrowsingMode")}moveCaret(e,n){var a;this._caretBrowsing||(this._caretBrowsing=new $x(this._globalAbortController.signal,this.appConfig.mainContainer,this.appConfig.viewerContainer,(a=this.appConfig.toolbar)==null?void 0:a.container)),this._caretBrowsing.moveCaret(e,n)}setTitleUsingUrl(e="",n=null){this.url=e,this.baseUrl=e.split("#",1)[0],n&&(this._downloadUrl=n===e?this.baseUrl:n.split("#",1)[0]),(0,Bt.isDataScheme)(e)?this._hideViewBookmark():typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL || CHROME")&&en.set("docBaseUrl",this.baseUrl);let a=(0,Bt.getPdfFilenameFromUrl)(e,"");if(!a)try{a=decodeURIComponent((0,Bt.getFilenameFromUrl)(e))}catch(i){}this.setTitle(a||e)}setTitle(e=this._title){if(this._title=e,this.isViewerEmbedded)return;const n=this._hasAnnotationEditors&&!this.pdfRenderingQueue.printing;document.title=`${n?"* ":""}${e}`}get _docFilename(){return this._contentDispositionFilename||(0,Bt.getPdfFilenameFromUrl)(this.url)}_hideViewBookmark(){var n;const{secondaryToolbar:e}=this.appConfig;e==null||e.viewBookmarkButton.classList.add("fn__hidden"),e!=null&&e.presentationModeButton.classList.contains("fn__hidden")&&((n=document.getElementById("viewBookmarkSeparator"))==null||n.classList.add("fn__hidden"))}close(){return Rt(this,null,function*(){var n,a,i,s,r,o,l,c,d,u,g,f;if(this._unblockDocumentLoadEvent(),this._hideViewBookmark(),!this.pdfLoadingTask)return;if((typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC && !TESTING"))&&((n=this.pdfDocument)==null?void 0:n.annotationStorage.size)>0&&this._annotationStorageModified)try{yield this.save()}catch(h){}const e=[];e.push(this.pdfLoadingTask.destroy()),this.pdfLoadingTask=null,this.pdfDocument&&(this.pdfDocument=null,(a=this.pdfThumbnailViewer)==null||a.setDocument(null),this.pdfViewer.setDocument(null),this.pdfLinkService.setDocument(null),(i=this.pdfDocumentProperties)==null||i.setDocument(null)),this.pdfLinkService.externalLinkEnabled=!0,this.store=null,this.isInitialViewSet=!1,this.url="",this.baseUrl="",this._downloadUrl="",this.documentInfo=null,this.metadata=null,this._contentDispositionFilename=null,this._contentLength=null,this._saveInProgress=!1,this._hasAnnotationEditors=!1,e.push(this.pdfScriptingManager.destroyPromise,this.passwordPrompt.close()),this.setTitle(),(s=this.pdfSidebar)==null||s.reset(),(r=this.pdfOutlineViewer)==null||r.reset(),(o=this.pdfAttachmentViewer)==null||o.reset(),(l=this.pdfLayerViewer)==null||l.reset(),(c=this.pdfHistory)==null||c.reset(),(d=this.findBar)==null||d.reset(),(u=this.toolbar)==null||u.reset(),(g=this.secondaryToolbar)==null||g.reset(),(f=this._PDFBug)==null||f.cleanup(),yield Promise.all(e)})}open(e){return Rt(this,null,function*(){this.pdfLoadingTask&&(yield this.close());const n=en.getAll(Ft.WORKER);Object.assign(Bt.GlobalWorkerOptions,n),typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL")?e.data&&(0,Bt.isPdfFile)(e.filename)&&(this._contentDispositionFilename=e.filename):e.url&&this.setTitleUsingUrl(e.originalUrl||e.url,e.url);const a=en.getAll(Ft.API),i=(0,Bt.getDocument)(Ys(Ys({},a),e));return this.pdfLoadingTask=i,i.onPassword=(s,r)=>{this.isViewerEmbedded&&this._unblockDocumentLoadEvent(),this.pdfLinkService.externalLinkEnabled=!1,this.passwordPrompt.setUpdateCallback(s,r),this.passwordPrompt.open()},i.onProgress=({loaded:s,total:r})=>{this.progress(s/r)},i.promise.then(s=>{this.load(s)},s=>{if(i!==this.pdfLoadingTask)return;let r="loadingError";return s instanceof Bt.InvalidPDFException?r="invalidFileError":s instanceof Bt.MissingPDFException?r="missingFileError":s instanceof Bt.UnexpectedResponseException&&(r="unexpectedResponseError"),this._documentError(window.siyuan.languages[r],{message:s.message}).then(()=>{throw s})})})}download(){return Rt(this,null,function*(){let e;try{e=yield this.pdfDocument.getData()}catch(n){}this.downloadManager.download(e,this._downloadUrl,this._docFilename)})}save(){return Rt(this,null,function*(){var e;if(!this._saveInProgress){this._saveInProgress=!0,yield this.pdfScriptingManager.dispatchWillSave();try{const n=yield this.pdfDocument.saveDocument();this.downloadManager.download(n,this._downloadUrl,this._docFilename)}catch(n){console.error(`Error when saving the document: ${n.message}`),yield this.download()}finally{yield this.pdfScriptingManager.dispatchDidSave(),this._saveInProgress=!1}this._hasAnnotationEditors&&this.externalServices.reportTelemetry({type:"editing",data:{type:"save",stats:(e=this.pdfDocument)==null?void 0:e.annotationStorage.editorStats}})}})}downloadOrSave(){return Rt(this,null,function*(){var n;const{classList:e}=this.appConfig.appContainer;e.add("wait"),yield((n=this.pdfDocument)==null?void 0:n.annotationStorage.size)>0?this.save():this.download(),e.remove("wait")})}_documentError(e,n=null){return Rt(this,null,function*(){var i;this._unblockDocumentLoadEvent();const a=yield this._otherError(e||"pdfjs-loading-error",n);this.eventBus.dispatch("documenterror",{source:this,message:a,reason:(i=n==null?void 0:n.message)!=null?i:null})})}_otherError(e,n=null){return Rt(this,null,function*(){const a=window.siyuan.languages[e]||e,i=[`PDF.js v${Bt.version||"?"} (build: ${Bt.build||"?"})`];return n&&(i.push(`Message: ${n.message}`),n.stack?i.push(`Stack: ${n.stack}`):(n.filename&&i.push(`File: ${n.filename}`),n.lineNumber&&i.push(`Line: ${n.lineNumber}`))),console.error(`${a}

${i.join(`
`)}`),a})}progress(e){var a,i;const n=Math.round(e*100);!this.loadingBar||n<=this.loadingBar.percent||(this.loadingBar.percent=n,((i=(a=this.pdfDocument)==null?void 0:a.loadingParams.disableAutoFetch)!=null?i:en.get("disableAutoFetch"))&&this.loadingBar.setDisableAutoFetch())}load(e){var d,u,g,f;this.pdfDocument=e,e.getDownloadInfo().then(({length:h})=>{var m;this._contentLength=h,(m=this.loadingBar)==null||m.hide(),r.then(()=>{this.eventBus.dispatch("documentloaded",{source:this})})});const n=e.getPageLayout().catch(()=>{}),a=e.getPageMode().catch(()=>{}),i=e.getOpenAction().catch(()=>{});if((d=this.toolbar)==null||d.setPagesCount(e.numPages,!1),(u=this.secondaryToolbar)==null||u.setPagesCount(e.numPages),typeof PDFJSDev!="undefined"&&PDFJSDev.test("CHROME")){const h=location.href.split("#",1)[0];this.pdfLinkService.setDocument(e,(0,Bt.isDataScheme)(h)?null:h)}else this.pdfLinkService.setDocument(e);(g=this.pdfDocumentProperties)==null||g.setDocument(e);const s=this.pdfViewer;s.setDocument(e);const{firstPagePromise:r,onePageRendered:o,pagesPromise:l}=s;(f=this.pdfThumbnailViewer)==null||f.setDocument(e);const c=(this.store=new PP(e.fingerprints[0])).getMultiple({page:null,zoom:ag,scrollLeft:"0",scrollTop:"0",rotation:null,sidebarView:Hn.UNKNOWN,scrollMode:On.UNKNOWN,spreadMode:Na.UNKNOWN}).catch(()=>{});r.then(h=>{var m;(m=this.loadingBar)==null||m.setWidth(this.appConfig.viewerContainer),this._initializeAnnotationStorageCallbacks(e),Promise.all([t4,c,n,a,i]).then(ee=>Rt(this,[ee],function*([b,y,_,v,U]){const Z=en.get("viewOnLoad");this._initializePdfHistory({fingerprint:e.fingerprints[0],viewOnLoad:Z,initialDest:U==null?void 0:U.dest});const k=this.initialBookmark,w=en.get("defaultZoomValue");let S=w?`zoom=${w}`:null,B=null,H=en.get("sidebarViewOnLoad"),j=en.get("scrollModeOnLoad"),re=en.get("spreadModeOnLoad");y.page=this.pdfId||y.page,y!=null&&y.page&&Z!==n1.INITIAL&&(S=`page=${y.page}&zoom=${w||y.zoom},${y.scrollLeft}${this.pdfId?"":","+y.scrollTop}`,B=parseInt(y.rotation,10),H===Hn.UNKNOWN&&(H=y.sidebarView|0),j===On.UNKNOWN&&(j=y.scrollMode|0),re===Na.UNKNOWN&&(re=y.spreadMode|0)),S.indexOf("page=")===-1&&this.pdfId&&(S+=`&page=${this.pdfId}`),v&&H===Hn.UNKNOWN&&(H=s4(v)),_&&j===On.UNKNOWN&&re===Na.UNKNOWN&&(re=jA(_).spreadMode),this.setInitialView(S,{rotation:B,sidebarView:H,scrollMode:j,spreadMode:re}),this.eventBus.dispatch("documentinit",{source:this}),this.isViewerEmbedded||s.focus(),yield Promise.race([l,new Promise(Te=>{setTimeout(Te,NP)})]),!(!k&&!S)&&(s.hasEqualPageSizes||(this.initialBookmark=k,s.currentScaleValue=s.currentScaleValue,this.setInitialView(S)))})).catch(()=>{this.setInitialView()}).then(function(){s.update();const b=N(s.container,"fn__flex-1");b&&b.removeAttribute("data-loading")})}),l.then(()=>{this._unblockDocumentLoadEvent(),this._initializeAutoPrint(e,i)},h=>{this._documentError("pdfjs-loading-error",{message:h.message})}),o.then(h=>{this.externalServices.reportTelemetry({type:"pageInfo",timestamp:h.timestamp}),this.pdfOutlineViewer&&e.getOutline().then(m=>{e===this.pdfDocument&&this.pdfOutlineViewer.render({outline:m,pdfDocument:e})}),this.pdfAttachmentViewer&&e.getAttachments().then(m=>{e===this.pdfDocument&&this.pdfAttachmentViewer.render({attachments:m})}),this.pdfLayerViewer&&s.optionalContentConfigPromise.then(m=>{e===this.pdfDocument&&this.pdfLayerViewer.render({optionalContentConfig:m,pdfDocument:e})})}),this._initializePageLabels(e),this._initializeMetadata(e)}_scriptingDocProperties(e){return Rt(this,null,function*(){var n,a;return!this.documentInfo&&(yield new Promise(i=>{this.eventBus._on("metadataloaded",i,{once:!0})}),e!==this.pdfDocument)||!this._contentLength&&(yield new Promise(i=>{this.eventBus._on("documentloaded",i,{once:!0})}),e!==this.pdfDocument)?null:ld(Ys({},this.documentInfo),{baseURL:this.baseUrl,filesize:this._contentLength,filename:this._docFilename,metadata:(n=this.metadata)==null?void 0:n.getRaw(),authors:(a=this.metadata)==null?void 0:a.get("dc:creator"),numPages:this.pagesCount,URL:this.url})})}_initializeAutoPrint(e,n){return Rt(this,null,function*(){const[a,i]=yield Promise.all([n,this.pdfViewer.enableScripting?null:e.getJSActions()]);if(e!==this.pdfDocument)return;let s=(a==null?void 0:a.action)==="Print";if(i){console.warn("Warning: JavaScript support is not enabled");for(const r in i){if(s)break;switch(r){case"WillClose":case"WillSave":case"DidSave":case"WillPrint":case"DidPrint":continue}s=i[r].some(o=>ZF.test(o))}}s&&this.triggerPrinting()})}_initializeMetadata(e){return Rt(this,null,function*(){var l,c;const{info:n,metadata:a,contentDispositionFilename:i,contentLength:s}=yield e.getMetadata();if(e!==this.pdfDocument)return;this.documentInfo=n,this.metadata=a,(l=this._contentDispositionFilename)!=null||(this._contentDispositionFilename=i),(c=this._contentLength)!=null||(this._contentLength=s);let r=n.Title;const o=a==null?void 0:a.get("dc:title");o&&o!=="Untitled"&&!/[\uFFF0-\uFFFF]/g.test(o)&&(r=o),r?this.setTitle(`${r} - ${this._contentDispositionFilename||this._title}`):this._contentDispositionFilename&&this.setTitle(this._contentDispositionFilename),n.IsXFAPresent&&!n.IsAcroFormPresent&&!e.isPureXfa?e.loadingParams.enableXfa?console.warn("Warning: XFA Foreground documents are not supported"):console.warn("Warning: XFA support is not enabled"):(n.IsAcroFormPresent||n.IsXFAPresent)&&!this.pdfViewer.renderForms&&console.warn("Warning: Interactive form support is not enabled"),n.IsSignaturesPresent&&console.warn("Warning: Digital signatures validation is not supported"),this.eventBus.dispatch("metadataloaded",{source:this})})}_initializePageLabels(e){return Rt(this,null,function*(){if(typeof PDFJSDev=="undefined"?window.isGECKOVIEW:PDFJSDev.test("GECKOVIEW"))return;const n=yield e.getPageLabels();if(e!==this.pdfDocument||!n||en.get("disablePageLabels"))return;const a=n.length;let i=0,s=0;for(let c=0;c<a;c++){const d=n[c];if(d===(c+1).toString())i++;else if(d==="")s++;else break}if(i>=a||s>=a)return;const{pdfViewer:r,pdfThumbnailViewer:o,toolbar:l}=this;r.setPageLabels(n),o==null||o.setPageLabels(n),l==null||l.setPagesCount(a,!0),l==null||l.setPageNumber(r.currentPageNumber,r.currentPageLabel)})}_initializePdfHistory({fingerprint:e,viewOnLoad:n,initialDest:a=null}){this.pdfHistory&&(this.pdfHistory.initialize({fingerprint:e,resetHistory:n===n1.INITIAL,updateUrl:en.get("historyUpdateUrl")}),this.pdfHistory.initialBookmark&&(this.initialBookmark=this.pdfHistory.initialBookmark,this.initialRotation=this.pdfHistory.initialRotation),a&&!this.initialBookmark&&n===n1.UNKNOWN&&(this.initialBookmark=JSON.stringify(a),this.pdfHistory.push({explicitDest:a,pageNumber:null})))}_initializeAnnotationStorageCallbacks(e){if(e!==this.pdfDocument)return;const{annotationStorage:n}=e;n.onSetModified=()=>{(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&(this._annotationStorageModified=!0)},n.onResetModified=()=>{(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&delete this._annotationStorageModified},n.onAnnotationEditor=a=>{this._hasAnnotationEditors=!!a,this.setTitle()}}setInitialView(e,{rotation:n,sidebarView:a,scrollMode:i,spreadMode:s}={}){var l,c,d;const r=u=>{__(u)&&(this.pdfViewer.pagesRotation=u)},o=(u,g)=>{zA(u)&&(this.pdfViewer.scrollMode=u),YA(g)&&(this.pdfViewer.spreadMode=g)};this.isInitialViewSet=!0,(l=this.pdfSidebar)==null||l.setInitialView(a),o(i,s),this.initialBookmark?(r(this.initialRotation),delete this.initialRotation,this.pdfLinkService.setHash(this.initialBookmark),this.initialBookmark=null):e&&(r(n),this.pdfLinkService.setHash(e)),(c=this.toolbar)==null||c.setPageNumber(this.pdfViewer.currentPageNumber,this.pdfViewer.currentPageLabel),(d=this.secondaryToolbar)==null||d.setPageNumber(this.pdfViewer.currentPageNumber),this.pdfViewer.currentScaleValue||(this.pdfViewer.currentScaleValue=ag)}_cleanup(){var e;this.pdfDocument&&(this.pdfViewer.cleanup(),(e=this.pdfThumbnailViewer)==null||e.cleanup(),this.pdfDocument.cleanup(en.get("fontExtraProperties")))}forceRendering(){var e;this.pdfRenderingQueue.printing=!!this.printService,this.pdfRenderingQueue.isThumbnailViewEnabled=((e=this.pdfSidebar)==null?void 0:e.visibleView)===Hn.THUMBS,this.pdfRenderingQueue.renderHighestPriority()}beforePrint(){var e;if(this._printAnnotationStoragePromise=this.pdfScriptingManager.dispatchWillPrint().catch(()=>{}).then(()=>{var n;return(n=this.pdfDocument)==null?void 0:n.annotationStorage.print}),!this.printService){if(!this.supportsPrinting){this._otherError(window.siyuan.languages.printingNotSupported);return}if(!this.pdfViewer.pageViewsReady){this.l10n.get("pdfjs-printing-not-ready").then(n=>{window.alert(n)});return}this.printService=pT.createPrintService({pdfDocument:this.pdfDocument,pagesOverview:this.pdfViewer.getPagesOverview(),printContainer:this.appConfig.printContainer,printResolution:en.get("printResolution"),printAnnotationStoragePromise:this._printAnnotationStoragePromise}),this.forceRendering(),this.setTitle(),this.printService.layout(),this._hasAnnotationEditors&&this.externalServices.reportTelemetry({type:"editing",data:{type:"print",stats:(e=this.pdfDocument)==null?void 0:e.annotationStorage.editorStats}})}}afterPrint(){var e;this._printAnnotationStoragePromise&&(this._printAnnotationStoragePromise.then(()=>{this.pdfScriptingManager.dispatchDidPrint()}),this._printAnnotationStoragePromise=null),this.printService&&(this.printService.destroy(),this.printService=null,(e=this.pdfDocument)==null||e.annotationStorage.resetModified()),this.forceRendering(),this.setTitle()}rotatePages(e){this.pdfViewer.pagesRotation+=e}requestPresentationMode(){var e;(e=this.pdfPresentationMode)==null||e.request()}triggerPrinting(){this.supportsPrinting&&window.print()}bindEvents(){if(this._eventBusAbortController)return;this._eventBusAbortController=new AbortController;const{eventBus:e,externalServices:n,pdfDocumentProperties:a,pdfViewer:i,preferences:s,_eventBusAbortController:{signal:r}}=this;e._on("resize",zP.bind(this),{signal:r}),e._on("hashchange",YP.bind(this),{signal:r}),e._on("beforeprint",this.beforePrint.bind(this),{signal:r}),e._on("afterprint",this.afterPrint.bind(this),{signal:r}),e._on("pagerender",RP.bind(this),{signal:r}),e._on("pagerendered",UP.bind(this),{signal:r}),e._on("updateviewarea",VP.bind(this),{signal:r}),e._on("pagechanging",QP.bind(this),{signal:r}),e._on("scalechanging",ZP.bind(this),{signal:r}),e._on("rotationchanging",JP.bind(this),{signal:r}),e._on("sidebarviewchanged",WP.bind(this),{signal:r}),e._on("pagemode",HP.bind(this),{signal:r}),e._on("namedaction",qP.bind(this),{signal:r}),e._on("presentationmodechanged",o=>i.presentationModeState=o.state,{signal:r}),e._on("presentationmode",this.requestPresentationMode.bind(this),{signal:r}),e._on("switchannotationeditormode",o=>i.annotationEditorMode=o,{signal:r}),e._on("print",this.triggerPrinting.bind(this),{signal:r}),e._on("download",this.downloadOrSave.bind(this),{signal:r}),e._on("firstpage",()=>this.page=1,{signal:r}),e._on("lastpage",()=>this.page=this.pagesCount,{signal:r}),e._on("nextpage",()=>i.nextPage(),{signal:r}),e._on("previouspage",()=>i.previousPage(),{signal:r}),e._on("zoomin",this.zoomIn.bind(this),{signal:r}),e._on("zoomout",this.zoomOut.bind(this),{signal:r}),e._on("zoomreset",this.zoomReset.bind(this),{signal:r}),e._on("pagenumberchanged",a1.bind(this),{signal:r}),e._on("scalechanged",o=>i.currentScaleValue=o.value,{signal:r}),e._on("rotatecw",this.rotatePages.bind(this,90),{signal:r}),e._on("rotateccw",this.rotatePages.bind(this,-90),{signal:r}),e._on("optionalcontentconfig",o=>i.optionalContentConfigPromise=o.promise,{signal:r}),e._on("switchscrollmode",o=>i.scrollMode=o.mode,{signal:r}),e._on("scrollmodechanged",MT.bind(this,"scrollMode"),{signal:r}),e._on("switchspreadmode",o=>i.spreadMode=o.mode,{signal:r}),e._on("spreadmodechanged",MT.bind(this,"spreadMode"),{signal:r}),e._on("imagealttextsettings",GP.bind(this),{signal:r}),e._on("documentproperties",()=>a==null?void 0:a.open(),{signal:r}),e._on("findfromurlhash",jP.bind(this),{signal:r}),e._on("updatefindmatchescount",KP.bind(this),{signal:r}),e._on("updatefindcontrolstate",XP.bind(this),{signal:r}),(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&(e._on("fileinputchange",$P.bind(this),{signal:r}),e._on("openfile",OP.bind(this),{signal:r})),typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL")&&(e._on("annotationeditorstateschanged",o=>n.updateEditorStates(o),{signal:r}),e._on("reporttelemetry",o=>n.reportTelemetry(o.details),{signal:r})),(typeof PDFJSDev=="undefined"||PDFJSDev.test("TESTING || MOZCENTRAL"))&&e._on("setpreference",o=>s.set(o.name,o.value),{signal:r})}bindWindowEvents(){if(this._windowAbortController)return;this._windowAbortController=new AbortController;const{eventBus:e,appConfig:{mainContainer:n},pdfViewer:a,_windowAbortController:{signal:i}}=this;function s(c=null){c&&a.refresh(),window.matchMedia(`(resolution: ${window.devicePixelRatio||1}dppx)`).addEventListener("change",s,{once:!0,signal:i})}s();const r=N(n,"pdf__outer");if(r.addEventListener("wheel",e6.bind(this),{passive:!1,signal:i}),r.addEventListener("touchstart",t6.bind(this),{passive:!1,signal:i}),r.addEventListener("touchmove",n6.bind(this),{passive:!1,signal:i}),r.addEventListener("touchend",a6.bind(this),{passive:!1,signal:i}),r.addEventListener("click",i6.bind(this),{signal:i}),window.removeEventListener("keydown",PT,{signal:i}),window.addEventListener("keydown",PT,{signal:i}),window.removeEventListener("keyup",FT,{signal:i}),window.addEventListener("keyup",FT,{signal:i}),(typeof PDFJSDev=="undefined"||!PDFJSDev.test("MOZCENTRAL"))&&!("onscrollend"in document.documentElement))return;(typeof PDFJSDev=="undefined"||!PDFJSDev.test("MOZCENTRAL"))&&({scrollTop:this._lastScrollTop,scrollLeft:this._lastScrollLeft}=n);const o=()=>{(typeof PDFJSDev=="undefined"||!PDFJSDev.test("MOZCENTRAL"))&&({scrollTop:this._lastScrollTop,scrollLeft:this._lastScrollLeft}=n),this._isScrolling=!1,n.addEventListener("scroll",l,{passive:!0,signal:i}),n.removeEventListener("scrollend",o),n.removeEventListener("blur",o)},l=()=>{this._isCtrlKeyDown||(typeof PDFJSDev=="undefined"||!PDFJSDev.test("MOZCENTRAL"))&&this._lastScrollTop===n.scrollTop&&this._lastScrollLeft===n.scrollLeft||(n.removeEventListener("scroll",l,{passive:!0}),this._isScrolling=!0,n.addEventListener("scrollend",o,{signal:i}),n.addEventListener("blur",o,{signal:i}))};n.addEventListener("scroll",l,{passive:!0,signal:i})}unbindEvents(){var e;(e=this._eventBusAbortController)==null||e.abort(),this._eventBusAbortController=null}unbindWindowEvents(){var e;(e=this._windowAbortController)==null||e.abort(),this._windowAbortController=null}testingClose(){return Rt(this,null,function*(){var e,n,a;this.unbindEvents(),this.unbindWindowEvents(),(e=this._globalAbortController)==null||e.abort(),this._globalAbortController=null,(n=this.findBar)==null||n.close(),yield Promise.all([(a=this.l10n)==null?void 0:a.destroy(),this.close()])})}_accumulateTicks(e,n){(this[n]>0&&e<0||this[n]<0&&e>0)&&(this[n]=0),this[n]+=e;const a=Math.trunc(this[n]);return this[n]-=a,a}_accumulateFactor(e,n,a){if(n===1)return 1;(this[a]>1&&n<1||this[a]<1&&n>1)&&(this[a]=1);const i=Math.floor(e*n*this[a]*100)/(100*e);return this[a]=n/i,i}_unblockDocumentLoadEvent(){var e;(e=document.blockUnblockOnload)==null||e.call(document,!1),this._unblockDocumentLoadEvent=()=>{}}get scriptingReady(){return this.pdfScriptingManager.ready}}if(typeof PDFJSDev=="undefined"||PDFJSDev.test("MOZCENTRAL"),typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC")){const t=["null","http://mozilla.github.io","https://mozilla.github.io"];var BP=function(e){if(e)try{const n=new URL(window.location.href).origin||"null";if(t.includes(n))return;if(new URL(e,window.location.href).origin!==n)throw new Error("file origin does not match viewer's")}catch(n){throw console.log(window.siyuan.languages.loadingError,n.message),n}},$P=function(e){var a;if((a=this.pdfViewer)!=null&&a.isInPresentationMode)return;const n=e.fileInput.files[0];this.open({url:URL.createObjectURL(n),originalUrl:n.name})},OP=function(e){var n;(n=this._openFileInput)==null||n.click()}}function RP({pageNumber:t}){var e;t===this.page&&((e=this.toolbar)==null||e.updateLoadingIndicatorState(!0))}function UP({pageNumber:t,error:e}){var n,a,i;if(t===this.page&&((n=this.toolbar)==null||n.updateLoadingIndicatorState(!1)),((a=this.pdfSidebar)==null?void 0:a.visibleView)===Hn.THUMBS){const s=this.pdfViewer.getPageView(t-1),r=(i=this.pdfThumbnailViewer)==null?void 0:i.getThumbnail(t-1);s&&(r==null||r.setImage(s))}e&&this._otherError("pdfjs-rendering-error",e)}function HP({mode:t}){var n;let e;switch(t){case"thumbs":e=Hn.THUMBS;break;case"bookmarks":case"outline":e=Hn.OUTLINE;break;case"attachments":e=Hn.ATTACHMENTS;break;case"layers":e=Hn.LAYERS;break;case"none":e=Hn.NONE;break;default:console.error('Invalid "pagemode" hash parameter: '+t);return}(n=this.pdfSidebar)==null||n.switchView(e,!0)}function qP(t){var e,n;switch(t.action){case"GoToPage":(e=this.appConfig.toolbar)==null||e.pageNumber.select();break;case"Find":this.supportsIntegratedFind||(n=this.findBar)==null||n.toggle();break;case"Print":this.triggerPrinting();break;case"SaveAs":this.downloadOrSave();break}}function WP({view:t}){var e;this.pdfRenderingQueue.isThumbnailViewEnabled=t===Hn.THUMBS,this.isInitialViewSet&&((e=this.store)==null||e.set("sidebarView",t).catch(()=>{}))}function VP({location:t}){var e;this.isInitialViewSet&&((e=this.store)==null||e.setMultiple({page:t.pageNumber,zoom:t.scale,scrollLeft:t.left,scrollTop:t.top,rotation:t.rotation}).catch(()=>{})),this.appConfig.secondaryToolbar&&(this.appConfig.secondaryToolbar.viewBookmarkButton.href=this.pdfLinkService.getAnchorUrl(t.pdfOpenParams))}function MT(t,e){var n;this.isInitialViewSet&&!this.pdfViewer.isInPresentationMode&&((n=this.store)==null||n.set(t,e.mode).catch(()=>{}))}function zP(){const{pdfDocument:t,pdfViewer:e,pdfRenderingQueue:n}=this;if(n.printing&&window.matchMedia("print").matches||!t)return;const a=e.currentScaleValue;(a==="auto"||a==="page-fit"||a==="page-width")&&(e.currentScaleValue=a),e.update()}function YP(t){var n;const e=t.hash;e&&(this.isInitialViewSet?(n=this.pdfHistory)!=null&&n.popStateInProgress||this.pdfLinkService.setHash(e):this.initialBookmark=e)}function a1(t){var a;let e=this;t.pdfInstance&&(e=t.pdfInstance);const{pdfViewer:n}=e;t.value!==""&&e.pdfLinkService.goToPage(t.value),t.id&&AT(e.pdfViewer.container,t.id),t.value!==n.currentPageNumber.toString()&&t.value!==n.currentPageLabel&&((a=e.toolbar)==null||a.setPageNumber(n.currentPageNumber,n.currentPageLabel))}function GP(){var t;(t=this.imageAltTextSettings)==null||t.open({enableGuessAltText:en.get("enableGuessAltText"),enableNewAltTextWhenAddingImage:en.get("enableNewAltTextWhenAddingImage")})}function jP(t){this.eventBus.dispatch("find",{source:t.source,type:"",query:t.query,caseSensitive:!1,entireWord:!1,highlightAll:!0,findPrevious:!1,matchDiacritics:!0})}function KP({matchesCount:t}){var e;this.supportsIntegratedFind?this.externalServices.updateFindMatchesCount(t):(e=this.findBar)==null||e.updateResultsCount(t)}function XP({state:t,previous:e,entireWord:n,matchesCount:a,rawQuery:i}){var s;this.supportsIntegratedFind?this.externalServices.updateFindControlState({result:t,findPrevious:e,entireWord:n,matchesCount:a,rawQuery:i}):(s=this.findBar)==null||s.updateUIState(t,e,a)}function ZP(t){var e;(e=this.toolbar)==null||e.setPageScale(t.presetValue,t.scale),this.pdfViewer.update()}function JP(t){this.pdfThumbnailViewer&&(this.pdfThumbnailViewer.pagesRotation=t.pagesRotation),this.forceRendering(),this.pdfViewer.currentPageNumber=t.pageNumber}function QP({pageNumber:t,pageLabel:e}){var a,i,s,r,o;(a=this.toolbar)==null||a.setPageNumber(t,e),(i=this.secondaryToolbar)==null||i.setPageNumber(t),((s=this.pdfSidebar)==null?void 0:s.visibleView)===Hn.THUMBS&&((r=this.pdfThumbnailViewer)==null||r.scrollThumbnailIntoView(t));const n=this.pdfViewer.getPageView(t-1);(o=this.toolbar)==null||o.updateLoadingIndicatorState((n==null?void 0:n.renderingState)===aa.RUNNING)}function e6(t){const{pdfViewer:e,supportsMouseWheelZoomCtrlKey:n,supportsMouseWheelZoomMetaKey:a,supportsPinchToZoom:i}=this;if(e.isInPresentationMode)return;const s=t.deltaMode;let r=Math.exp(-t.deltaY/100);const o=typeof PDFJSDev!="undefined"&&PDFJSDev.test("MOZCENTRAL")&&Bt.FeatureTest.platform.isMac,l=t.ctrlKey&&!this._isCtrlKeyDown&&s===WheelEvent.DOM_DELTA_PIXEL&&t.deltaX===0&&(Math.abs(r-1)<.05||o)&&t.deltaZ===0,c=[t.clientX,t.clientY];if(l||t.ctrlKey&&n||t.metaKey&&a){if(t.preventDefault(),this._isScrolling||document.visibilityState==="hidden"||this.overlayManager.active)return;if(l&&i)r=this._accumulateFactor(e.currentScale,r,"_wheelUnusedFactor"),this.updateZoom(null,r,c);else{const d=VA(t);let u=0;s===WheelEvent.DOM_DELTA_LINE||s===WheelEvent.DOM_DELTA_PAGE?u=Math.abs(d)>=1?Math.sign(d):this._accumulateTicks(d,"_wheelUnusedTicks"):u=this._accumulateTicks(d/30,"_wheelUnusedTicks"),this.updateZoom(u,null,c)}}}function t6(t){if(this.pdfViewer.isInPresentationMode||t.touches.length<2)return;if(t.preventDefault(),t.touches.length!==2||this.overlayManager.active){this._touchInfo=null;return}let[e,n]=t.touches;e.identifier>n.identifier&&([e,n]=[n,e]),this._touchInfo={touch0X:e.pageX,touch0Y:e.pageY,touch1X:n.pageX,touch1Y:n.pageY}}function n6(t){if(!this._touchInfo||t.touches.length!==2)return;const{pdfViewer:e,_touchInfo:n,supportsPinchToZoom:a}=this;let[i,s]=t.touches;i.identifier>s.identifier&&([i,s]=[s,i]);const{pageX:r,pageY:o}=i,{pageX:l,pageY:c}=s,{touch0X:d,touch0Y:u,touch1X:g,touch1Y:f}=n;if(Math.abs(d-r)<=1&&Math.abs(u-o)<=1&&Math.abs(g-l)<=1&&Math.abs(f-c)<=1)return;if(n.touch0X=r,n.touch0Y=o,n.touch1X=l,n.touch1Y=c,d===r&&u===o){const y=g-r,_=f-o,v=l-r,U=c-o,ee=y*U-_*v;if(Math.abs(ee)>.02*Math.hypot(y,_)*Math.hypot(v,U))return}else if(g===l&&f===c){const y=d-l,_=u-c,v=r-l,U=o-c,ee=y*U-_*v;if(Math.abs(ee)>.02*Math.hypot(y,_)*Math.hypot(v,U))return}else{const y=r-d,_=l-g,v=o-u,U=c-f;if(y*_+v*U>=0)return}t.preventDefault();const h=[(r+l)/2,(o+c)/2],m=Math.hypot(r-l,o-c)||1,b=Math.hypot(d-g,u-f)||1;if(a){const y=this._accumulateFactor(e.currentScale,m/b,"_touchUnusedFactor");this.updateZoom(null,y,h)}else{const _=this._accumulateTicks((m-b)/30,"_touchUnusedTicks");this.updateZoom(_,null,h)}}function a6(t){this._touchInfo&&(t.preventDefault(),this._touchInfo=null,this._touchUnusedTicks=0,this._touchUnusedFactor=1)}function i6(t){var n,a,i;if(["SELECT","TEXTAREA","INPUT"].includes(t.target.tagName)||this.pdfViewer.focus(),!((n=this.secondaryToolbar)!=null&&n.isOpen))return;const e=this.appConfig;(this.pdfViewer.containsElement(t.target)||(a=e.toolbar)!=null&&a.container.contains(t.target)&&!((i=e.secondaryToolbar)!=null&&i.toggleButton.contains(t.target)))&&this.secondaryToolbar.close()}function FT(t){const e=e1(t.target);e&&(["SELECT","TEXTAREA","INPUT"].includes(t.target.tagName)||e.pdfViewer.focus(),t.key==="Control"&&(e._isCtrlKeyDown=!1),([92,91,68].includes(t.keyCode)||t.ctrlKey||t.altKey)&&e.appConfig.toolbar.rectAnno.classList.contains("toggled")&&e.appConfig.toolbar.rectAnno.dispatchEvent(new MouseEvent("click")))}function PT(t){var d,u,g,f,h,m;const e=e1(t.target);if(!e||(e._isCtrlKeyDown=t.key==="Control",e.overlayManager.active))return;const{eventBus:n,pdfViewer:a}=e,i=a.isInPresentationMode;let s=!1,r=!1;const o=(t.ctrlKey?1:0)|(t.altKey?2:0)|(t.shiftKey?4:0)|(t.metaKey?8:0);if(o===0&&[38,40].includes(t.keyCode)){document.activeElement&&document.activeElement.blur(),setTimeout(()=>{a.focus()});return}if(!t.repeat&&(o===8||o===1||o===2)&&t.keyCode===68&&!e.appConfig.toolbar.rectAnno.classList.contains("toggled")){e.appConfig.toolbar.rectAnno.dispatchEvent(new MouseEvent("click")),t.preventDefault();return}if(!t.repeat&&o!==1&&o!==2&&o!==4&&o!==8&&[48,49,50,51,52,53,54,55].includes(t.keyCode)&&getSelection().rangeCount>0&&!e.appConfig.toolbar.rectAnno.classList.contains("toggled")){const b=getSelection().getRangeAt(0);if(b.toString()!==""&&N(b.commonAncestorContainer,"pdfViewer")){e.appConfig.appContainer.dispatchEvent(new CustomEvent("click",{detail:(t.keyCode-48).toString()})),t.preventDefault();return}}if(o===1||o===8||o===5||o===12)switch(t.keyCode){case 70:!e.supportsIntegratedFind&&!t.shiftKey&&((d=e.findBar)==null||d.open(),s=!0);break;case 71:if(!e.supportsIntegratedFind){const{state:b}=e.findController;if(b){const y={source:window,type:"again",findPrevious:o===5||o===12};n.dispatch("find",Ys(Ys({},b),y))}s=!0}break;case 61:case 107:case 187:case 171:e.zoomIn(),s=!0;break;case 173:case 109:case 189:e.zoomOut(),s=!0;break;case 48:case 96:i||(setTimeout(()=>{e.zoomReset()}),s=!1);break;case 38:(i||e.page>1)&&(e.page=1,s=!0,r=!0);break;case 40:(i||e.page<e.pagesCount)&&(e.page=e.pagesCount,s=!0,r=!0);break}if((typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC || CHROME"))&&(o===1||o===8))switch(t.keyCode){case 83:n.dispatch("download",{source:window}),s=!0;break;case 79:(typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC"))&&(n.dispatch("openfile",{source:window}),s=!0);break}if(o===3||o===10)switch(t.keyCode){case 80:e.requestPresentationMode(),s=!0,e.externalServices.reportTelemetry({type:"buttons",data:{id:"presentationModeKeyboard"}});break;case 71:e.appConfig.toolbar&&(e.appConfig.toolbar.pageNumber.select(),s=!0);break}if(s){r&&!i&&a.focus(),t.preventDefault();return}const l=i4(),c=l==null?void 0:l.tagName.toUpperCase();if(!((c==="INPUT"||c==="TEXTAREA"||c==="SELECT"||c==="BUTTON"&&(t.keyCode===13||t.keyCode===32)||l!=null&&l.isContentEditable)&&t.keyCode!==27)){if(o===0){let b=0,y=!1;switch(t.keyCode){case 38:if(e.supportsCaretBrowsingMode){e.moveCaret(!0,!1),s=!0;break}case 33:a.isVerticalScrollbarEnabled&&(y=!0),b=-1;break;case 8:i||(y=!0),b=-1;break;case 37:if(e.supportsCaretBrowsingMode)return;a.isHorizontalScrollbarEnabled&&(y=!0);case 75:case 80:b=-1;break;case 27:(u=e.secondaryToolbar)!=null&&u.isOpen&&(e.secondaryToolbar.close(),s=!0),!e.supportsIntegratedFind&&((g=e.findBar)!=null&&g.opened)&&(e.findBar.close(),s=!0);break;case 40:if(e.supportsCaretBrowsingMode){e.moveCaret(!1,!1),s=!0;break}case 34:a.isVerticalScrollbarEnabled&&(y=!0),b=1;break;case 13:case 32:i||(y=!0),b=1;break;case 39:if(e.supportsCaretBrowsingMode)return;a.isHorizontalScrollbarEnabled&&(y=!0);case 74:case 78:b=1;break;case 36:(i||e.page>1)&&(e.page=1,s=!0,r=!0);break;case 35:(i||e.page<e.pagesCount)&&(e.page=e.pagesCount,s=!0,r=!0);break;case 83:(f=e.pdfCursorTools)==null||f.switchTool(Os.SELECT);break;case 72:(h=e.pdfCursorTools)==null||h.switchTool(Os.HAND);break;case 82:e.rotatePages(90);break;case 115:(m=e.pdfSidebar)==null||m.toggle();break}b!==0&&(!y||a.currentScaleValue==="page-fit")&&(b>0?a.nextPage():a.previousPage(),s=!0)}if(o===4)switch(t.keyCode){case 13:case 32:if(!i&&a.currentScaleValue!=="page-fit")break;a.previousPage(),s=!0;break;case 38:e.moveCaret(!0,!0),s=!0;break;case 40:e.moveCaret(!1,!0),s=!0;break;case 82:e.rotatePages(-90);break}!s&&!i&&(t.keyCode>=33&&t.keyCode<=40||t.keyCode===32&&c!=="BUTTON")&&(r=!0),r&&!a.containsElement(l)&&a.focus(),s&&t.preventDefault()}}function Fz(t){return t.preventDefault(),t.returnValue="",!1}const Pz=typeof PDFJSDev!="undefined"?PDFJSDev.eval("BUNDLE_VERSION"):void 0,Nz=typeof PDFJSDev!="undefined"?PDFJSDev.eval("BUNDLE_BUILD"):void 0,Bz=typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC")?{LinkTarget:xl,RenderingStates:aa,ScrollMode:On,SpreadMode:Na}:null;function s6(t){return{appContainer:t,principalContainer:t.querySelector("#mainContainer"),mainContainer:t.querySelector("#viewerContainer"),viewerContainer:t.querySelector("#viewer"),toolbar:{rectAnno:t.querySelector("#rectAnno"),container:t.querySelector("#toolbarContainer"),numPages:t.querySelector("#numPages"),pageNumber:t.querySelector("#pageNumber"),scaleSelect:t.querySelector("#scaleSelect"),customScaleOption:t.querySelector("#customScaleOption"),previous:t.querySelector("#previous"),next:t.querySelector("#next"),zoomIn:t.querySelector("#zoomInButton"),zoomOut:t.querySelector("#zoomOutButton"),print:t.querySelector("#printButton"),editorFreeTextButton:t.querySelector("#editorFreeTextButton"),editorFreeTextParamsToolbar:t.querySelector("#editorFreeTextParamsToolbar"),editorHighlightButton:t.querySelector("#editorHighlightButton"),editorHighlightParamsToolbar:t.querySelector("#editorHighlightParamsToolbar"),editorHighlightColorPicker:t.querySelector("#editorHighlightColorPicker"),editorInkButton:t.querySelector("#editorInkButton"),editorInkParamsToolbar:t.querySelector("#editorInkParamsToolbar"),editorStampButton:t.querySelector("#editorStampButton"),editorStampParamsToolbar:t.querySelector("#editorStampParamsToolbar"),download:t.querySelector("#downloadButton")},secondaryToolbar:{toolbar:t.querySelector("#secondaryToolbar"),toggleButton:t.querySelector("#secondaryToolbarToggleButton"),presentationModeButton:t.querySelector("#presentationMode"),openFileButton:typeof PDFJSDev=="undefined"||PDFJSDev.test("GENERIC")?t.querySelector("#secondaryOpenFile"):null,printButton:t.querySelector("#secondaryPrint"),downloadButton:t.querySelector("#secondaryDownload"),viewBookmarkButton:t.querySelector("#viewBookmark"),firstPageButton:t.querySelector("#firstPage"),lastPageButton:t.querySelector("#lastPage"),pageRotateCwButton:t.querySelector("#pageRotateCw"),pageRotateCcwButton:t.querySelector("#pageRotateCcw"),cursorSelectToolButton:t.querySelector("#cursorSelectTool"),cursorHandToolButton:t.querySelector("#cursorHandTool"),scrollPageButton:t.querySelector("#scrollPage"),scrollVerticalButton:t.querySelector("#scrollVertical"),scrollHorizontalButton:t.querySelector("#scrollHorizontal"),scrollWrappedButton:t.querySelector("#scrollWrapped"),spreadNoneButton:t.querySelector("#spreadNone"),spreadOddButton:t.querySelector("#spreadOdd"),spreadEvenButton:t.querySelector("#spreadEven"),imageAltTextSettingsButton:t.querySelector("#imageAltTextSettings"),imageAltTextSettingsSeparator:t.querySelector("#imageAltTextSettingsSeparator"),documentPropertiesButton:t.querySelector("#documentProperties")},sidebar:{outerContainer:t.querySelector("#outerContainer"),sidebarContainer:t.querySelector("#sidebarContainer"),toggleButton:t.querySelector("#sidebarToggleButton"),resizer:t.querySelector("#sidebarResizer"),thumbnailButton:t.querySelector("#viewThumbnail"),outlineButton:t.querySelector("#viewOutline"),attachmentsButton:t.querySelector("#viewAttachments"),layersButton:t.querySelector("#viewLayers"),thumbnailView:t.querySelector("#thumbnailView"),outlineView:t.querySelector("#outlineView"),attachmentsView:t.querySelector("#attachmentsView"),layersView:t.querySelector("#layersView"),currentOutlineItemButton:t.querySelector("#currentOutlineItem")},findBar:{bar:t.querySelector("#findbar"),toggleButton:t.querySelector("#viewFindButton"),findField:t.querySelector("#findInput"),highlightAllCheckbox:t.querySelector("#findHighlightAll"),caseSensitiveCheckbox:t.querySelector("#findMatchCase"),matchDiacriticsCheckbox:t.querySelector("#findMatchDiacritics"),entireWordCheckbox:t.querySelector("#findEntireWord"),findMsg:t.querySelector("#findMsg"),findResultsCount:t.querySelector("#findResultsCount"),findPreviousButton:t.querySelector("#findPreviousButton"),findNextButton:t.querySelector("#findNextButton")},passwordOverlay:{dialog:t.querySelector("#passwordDialog"),label:t.querySelector("#passwordText"),input:t.querySelector("#password"),submitButton:t.querySelector("#passwordSubmit"),cancelButton:t.querySelector("#passwordCancel")},documentProperties:{dialog:t.querySelector("#documentPropertiesDialog"),closeButton:t.querySelector("#documentPropertiesClose"),fields:{fileName:t.querySelector("#fileNameField"),fileSize:t.querySelector("#fileSizeField"),title:t.querySelector("#titleField"),author:t.querySelector("#authorField"),subject:t.querySelector("#subjectField"),keywords:t.querySelector("#keywordsField"),creationDate:t.querySelector("#creationDateField"),modificationDate:t.querySelector("#modificationDateField"),creator:t.querySelector("#creatorField"),producer:t.querySelector("#producerField"),version:t.querySelector("#versionField"),pageCount:t.querySelector("#pageCountField"),pageSize:t.querySelector("#pageSizeField"),linearized:t.querySelector("#linearizedField")}},altTextDialog:{dialog:t.querySelector("#altTextDialog"),optionDescription:t.querySelector("#descriptionButton"),optionDecorative:t.querySelector("#decorativeButton"),textarea:t.querySelector("#descriptionTextarea"),cancelButton:t.querySelector("#altTextCancel"),saveButton:t.querySelector("#altTextSave")},newAltTextDialog:{dialog:t.querySelector("#newAltTextDialog"),title:t.querySelector("#newAltTextTitle"),descriptionContainer:t.querySelector("#newAltTextDescriptionContainer"),textarea:t.querySelector("#newAltTextDescriptionTextarea"),disclaimer:t.querySelector("#newAltTextDisclaimer"),learnMore:t.querySelector("#newAltTextLearnMore"),imagePreview:t.querySelector("#newAltTextImagePreview"),createAutomatically:t.querySelector("#newAltTextCreateAutomatically"),createAutomaticallyButton:t.querySelector("#newAltTextCreateAutomaticallyButton"),downloadModel:t.querySelector("#newAltTextDownloadModel"),downloadModelDescription:t.querySelector("#newAltTextDownloadModelDescription"),error:t.querySelector("#newAltTextError"),errorCloseButton:t.querySelector("#newAltTextCloseButton"),cancelButton:t.querySelector("#newAltTextCancel"),notNowButton:t.querySelector("#newAltTextNotNow"),saveButton:t.querySelector("#newAltTextSave")},altTextSettingsDialog:{dialog:t.querySelector("#altTextSettingsDialog"),createModelButton:t.querySelector("#createModelButton"),aiModelSettings:t.querySelector("#aiModelSettings"),learnMore:t.querySelector("#altTextSettingsLearnMore"),deleteModelButton:t.querySelector("#deleteModelButton"),downloadModelButton:t.querySelector("#downloadModelButton"),showAltTextDialogButton:t.querySelector("#showAltTextDialogButton"),altTextSettingsCloseButton:t.querySelector("#altTextSettingsCloseButton"),closeButton:t.querySelector("#altTextSettingsCloseButton")},annotationEditorParams:{editorFreeTextFontSize:t.querySelector("#editorFreeTextFontSize"),editorFreeTextColor:t.querySelector("#editorFreeTextColor"),editorInkColor:t.querySelector("#editorInkColor"),editorInkThickness:t.querySelector("#editorInkThickness"),editorInkOpacity:t.querySelector("#editorInkOpacity"),editorStampAddImage:t.querySelector("#editorStampAddImage"),editorFreeHighlightThickness:t.querySelector("#editorFreeHighlightThickness"),editorHighlightShowAll:t.querySelector("#editorHighlightShowAll")},printContainer:t.querySelector("#printContainer")}}function NT(t,e,n,a){en.set("workerSrc",`${p.PROTYLE_CDN}/js/pdf/pdf.worker.min.mjs?v=4.7.85`),en.set("defaultUrl",t),en.set("cMapUrl","cmaps/"),en.set("standardFontDataUrl","standard_fonts/"),en.set("annotationEditorMode",Bt.AnnotationEditorType.DISABLE);const i=new IT(n);i.annoId=a;const s=s6(e);if(s.file=t,typeof PDFJSDev!="undefined"&&PDFJSDev.test("GENERIC")){const r=new CustomEvent("webviewerloaded",{bubbles:!0,cancelable:!0,detail:{source:window}});try{parent.document.dispatchEvent(r)}catch(o){console.error(`webviewerloaded: ${o}`),document.dispatchEvent(r)}}return i.run(s),xP(e,i),i}(rI=document.blockUnblockOnload)==null||rI.call(document,!0);class El extends Wa{constructor(e){if(super({app:e.app,id:e.tab.id}),window.siyuan.config.fileTree.openFilesUseCurrentTab&&e.tab.headElement.classList.add("item--unupdate"),this.element=e.tab.panelElement,this.path=e.path,this.pdfId=e.page,this.element.addEventListener("click",n=>{Vo(),ca(this.element.parentElement.parentElement),this.app.plugins.forEach(a=>{a.eventBus.emit("click-pdf",{event:n})})}),typeof this.pdfId=="string"){this.getPdfId(()=>{this.render()});return}else typeof this.pdfId=="number"&&(this.pdfPage=this.pdfId);this.render()}getPdfId(e){ae("/api/asset/getFileAnnotation",{path:this.path+".sya"},n=>{if(n.code!==1){const a=JSON.parse(n.data.data);a[this.pdfId]?this.pdfPage=a[this.pdfId].page?a[this.pdfId].page+1:a[this.pdfId].pages[0].index+1:this.pdfPage=void 0}e()})}goToPage(e){if(!(typeof e=="undefined"||e===null)){if(this.pdfId=e,typeof e=="string"){this.getPdfId(()=>{this.pdfPage&&a1({value:this.pdfPage,pdfInstance:this.pdfObject,id:this.pdfId})});return}typeof e=="number"&&!isNaN(e)&&a1({value:this.pdfId,pdfInstance:this.pdfObject})}}render(){const e=this.path.substr(this.path.lastIndexOf(".")).toLowerCase().split("?")[0];if(p.SIYUAN_ASSETS_IMAGE.includes(e))this.element.innerHTML=`<div class="asset"><img src="${this.path.startsWith("file")?this.path:document.getElementById("baseURL").getAttribute("href")+"/"+this.path}"></div>`;else if(p.SIYUAN_ASSETS_AUDIO.includes(e))this.element.innerHTML=`<div class="asset"><audio controls="controls" src="${this.path.startsWith("file")?this.path:document.getElementById("baseURL").getAttribute("href")+"/"+this.path}"></audio></div>`;else if(p.SIYUAN_ASSETS_VIDEO.includes(e))this.element.innerHTML=`<div class="asset"><video controls="controls" src="${this.path.startsWith("file")?this.path:document.getElementById("baseURL").getAttribute("href")+"/"+this.path}"></video></div>`;else if(e===".pdf"){this.element.innerHTML=`<div class="pdf__outer" id="outerContainer">
      <div id="sidebarContainer">
        <div id="toolbarSidebar">
          <div id="toolbarSidebarLeft">
              <button id="viewThumbnail" class="toolbarButton toggled b3-tooltips b3-tooltips__ne" aria-label="${window.siyuan.languages.thumbsTitle}">
                <svg><use xlink:href="#iconImage"></use></svg>
              </button>
              <button id="viewOutline" class="toolbarButton b3-tooltips b3-tooltips__ne" aria-label="${window.siyuan.languages.outline}">
                 <svg><use xlink:href="#iconAlignCenter"></use></svg>
              </button>
              <button id="viewAttachments" class="toolbarButton fn__none" data-l10n-id="attachments">
                 <span data-l10n-id="attachments_label">Attachments</span>
              </button>
              <button id="viewLayers" class="toolbarButton fn__none" data-l10n-id="layers">
                 <span data-l10n-id="layers_label">Layers</span>
              </button>
          </div>
          <div class="fn__flex-1"></div>
          <div id="toolbarSidebarRight">
            <div id="outlineOptionsContainer" class="fn__hidden">
              <button id="currentOutlineItem" class="toolbarButton b3-tooltips b3-tooltips__nw" disabled="disabled" aria-label="${window.siyuan.languages.focusOutline}">
                <svg><use xlink:href="#iconFocus"></use></svg>
              </button>
            </div>
          </div>
        </div>
        <div id="sidebarContent">
          <div id="thumbnailView">
          </div>
          <div id="outlineView" class="fn__hidden">
          </div>
          <div id="attachmentsView" class="fn__hidden">
          </div>
          <div id="layersView" class="fn__hidden">
          </div>
        </div>
        <div id="sidebarResizer"></div>
      </div>
      <div id="mainContainer">
        <div class="findbar b3-menu fn__hidden doorHanger" id="findbar">
            <input id="findInput" class="toolbarField b3-text-field" placeholder="${window.siyuan.languages.search}">
            <div class="fn__space"></div>
            <button id="findPreviousButton" class="toolbarButton findPrevious b3-tooltips b3-tooltips__n" aria-label="${window.siyuan.languages.previous}">
                <svg><use xlink:href="#iconUp"></use></svg>
            </button>
            <button id="findNextButton" class="toolbarButton findNext b3-tooltips b3-tooltips__n" aria-label="${window.siyuan.languages.next}">
                <svg><use xlink:href="#iconDown"></use></svg>
            </button>
            <label class="b3-button b3-button--outline b3-button--small">
                <input type="checkbox" id="findHighlightAll" class="toolbarField">
                ${window.siyuan.languages.findHighlight}
            </label>
            <div class="fn__space"></div>
            <label class="b3-button b3-button--outline b3-button--small">
                <input type="checkbox" id="findMatchCase" class="toolbarField">
                ${window.siyuan.languages.searchCaseSensitive}
            </label>
            <div class="fn__space"></div>
            <label class="b3-button b3-button--outline b3-button--small">
                <input type="checkbox" id="findMatchDiacritics" class="toolbarField">
                ${window.siyuan.languages.matchDiacritics}
            </label>
            <div class="fn__space"></div>
            <label class="b3-button b3-button--outline b3-button--small">
                <input type="checkbox" id="findEntireWord" class="toolbarField">
                ${window.siyuan.languages.findEntireWord}
            </label>
            <div class="fn__space"></div>
            <span id="findResultsCount" class="b3-button b3-button--small b3-button--cancel"></span>
            <span id="findMsg" class="b3-button b3-button--small b3-button--cancel"></span>
        </div>  <!-- findbar -->
        <div id="secondaryToolbar" class="secondaryToolbar fn__hidden doorHangerRight b3-menu">
          <div id="secondaryToolbarButtonContainer" class="b3-menu__items">
            <button id="pdfLight" class="secondaryToolbarButton b3-menu__item toggled">
              <svg class="b3-menu__icon"><use xlink:href="#iconLight"></use></svg> 
              <span class="b3-menu__label">${window.siyuan.languages.themeLight}</span>
            </button>
            <button id="pdfDark" class="secondaryToolbarButton b3-menu__item">
              <svg class="b3-menu__icon"><use xlink:href="#iconDark"></use></svg> 
              <span class="b3-menu__label">${window.siyuan.languages.themeDark}</span>
            </button>
            <div class="horizontalToolbarSeparator b3-menu__separator"></div>
            <button id="previous" class="secondaryToolbarButton b3-menu__item pageUp">
              <svg class="b3-menu__icon"><use xlink:href="#iconUp"></use></svg> 
              <span class="b3-menu__label">${window.siyuan.languages.previousLabel}</span>
              <span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt("P")}/${Mt("K")}</span>
            </button>
            <button id="next" class="secondaryToolbarButton b3-menu__item pageDown">
              <svg class="b3-menu__icon"><use xlink:href="#iconDown"></use></svg> 
              <span class="b3-menu__label">${window.siyuan.languages.nextLabel}</span>
              <span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt("J")}/${Mt("N")}</span>
            </button>
            <button id="firstPage" class="secondaryToolbarButton b3-menu__item firstPage">
              <svg class="b3-menu__icon"><use xlink:href="#iconBack"></use></svg> 
              <span class="b3-menu__label">${window.siyuan.languages.firstPage}</span>
              <span class="b3-menu__accelerator b3-menu__accelerator--hotkey">Home</span>
            </button>
            <button id="lastPage" class="secondaryToolbarButton b3-menu__item lastPage">
              <svg class="b3-menu__icon"><use xlink:href="#iconForward"></use></svg> 
              <span class="b3-menu__label">${window.siyuan.languages.lastPage}</span>
              <span class="b3-menu__accelerator b3-menu__accelerator--hotkey">End</span>
            </button>
            <div class="horizontalToolbarSeparator b3-menu__separator"></div>
            <button id="zoomOutButton" class="secondaryToolbarButton b3-menu__item zoomOut">
               <svg class="b3-menu__icon"><use xlink:href="#iconLine"></use></svg> 
               <span class="b3-menu__label">${window.siyuan.languages.zoomOut}</span>
               <span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt("\u2318-")}</span>
            </button>
            <button id="zoomInButton" class="secondaryToolbarButton b3-menu__item zoomIn">
               <svg class="b3-menu__icon"><use xlink:href="#iconAdd"></use></svg> 
               <span class="b3-menu__label">${window.siyuan.languages.zoomIn}</span>
               <span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt("\u2318=")}</span>
            </button>
            <button id="pageRotateCw" class="secondaryToolbarButton b3-menu__item rotateCw">
               <svg class="b3-menu__icon"><use xlink:href="#iconRedo"></use></svg> 
               <span class="b3-menu__label">${window.siyuan.languages.rotateCw}</span>
               <span class="b3-menu__accelerator b3-menu__accelerator--hotkey">R</span>
            </button>
            <button id="pageRotateCcw" class="secondaryToolbarButton b3-menu__item rotateCcw">
               <svg class="b3-menu__icon"><use xlink:href="#iconUndo"></use></svg> 
               <span class="b3-menu__label">${window.siyuan.languages.rotateCcw}</span>
               <span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt("\u21E7R")}</span>
            </button>

            <div class="horizontalToolbarSeparator b3-menu__separator"></div>

            <button id="cursorSelectTool" class="secondaryToolbarButton b3-menu__item selectTool toggled">
               <svg class="b3-menu__icon"><use xlink:href="#iconSelectText"></use></svg> 
               <span class="b3-menu__label">${window.siyuan.languages.cursorText}</span>
               <span class="b3-menu__accelerator b3-menu__accelerator--hotkey">S</span>
            </button>
            <button id="cursorHandTool" class="secondaryToolbarButton b3-menu__item handTool">
              <svg class="b3-menu__icon"><use xlink:href="#iconHand"></use></svg> 
              <span class="b3-menu__label">${window.siyuan.languages.cursorHand}</span>
              <span class="b3-menu__accelerator b3-menu__accelerator--hotkey">H</span>
            </button>
            <div class="horizontalToolbarSeparator b3-menu__separator"></div>
            <button id="scrollVertical" class="secondaryToolbarButton b3-menu__item scrollModeButtons scrollVertical toggled">
             <svg class="b3-menu__icon"><use xlink:href="#iconScrollVert"></use></svg> 
              <span class="b3-menu__label">${window.siyuan.languages.scrollVertical}</span>
            </button>
            <button id="scrollHorizontal" class="secondaryToolbarButton b3-menu__item scrollModeButtons scrollHorizontal">
              <svg class="b3-menu__icon"><use xlink:href="#iconScrollHoriz"></use></svg> 
              <span class="b3-menu__label">${window.siyuan.languages.scrollHorizontal}</span>
            </button>
            <button id="scrollWrapped" class="secondaryToolbarButton b3-menu__item scrollModeButtons scrollWrapped">
             <svg class="b3-menu__icon"><use xlink:href="#iconScrollWrapped"></use></svg> 
              <span class="b3-menu__label">${window.siyuan.languages.scrollWrapped}</span>
            </button>

            <div class="horizontalToolbarSeparator b3-menu__separator scrollModeButtons"></div>

            <button id="spreadNone" class="secondaryToolbarButton b3-menu__item spreadModeButtons spreadNone toggled">
              <svg class="b3-menu__icon"><use xlink:href="#iconFile"></use></svg> 
              <span class="b3-menu__label">${window.siyuan.languages.spreadNone}</span>
            </button>
            <button id="spreadOdd" class="secondaryToolbarButton b3-menu__item spreadModeButtons spreadOdd">
              <svg class="b3-menu__icon"><use xlink:href="#iconSpreadOdd"></use></svg> 
              <span class="b3-menu__label">${window.siyuan.languages.spreadOdd}</span>
            </button>
            <button id="spreadEven" class="secondaryToolbarButton b3-menu__item spreadModeButtons spreadEven">
              <svg class="b3-menu__icon"><use xlink:href="#iconSpreadEven"></use></svg> 
              <span class="b3-menu__label">${window.siyuan.languages.spreadEven}</span>
            </button>
            <button id="presentationMode" class="secondaryToolbarButton b3-menu__item presentationMode">
              <svg class="b3-menu__icon"><use xlink:href="#iconPlay"></use></svg>
              <span class="b3-menu__label">${window.siyuan.languages.presentationMode}</span>
              <span class="b3-menu__accelerator b3-menu__accelerator--hotkey">${Mt("\u2325\u2318P")}</span>
            </button>
            <div class="horizontalToolbarSeparator b3-menu__separator spreadModeButtons"></div>
            <button id="documentProperties" class="secondaryToolbarButton b3-menu__item documentProperties">
              <svg class="b3-menu__icon"><use xlink:href="#iconInfo"></use></svg> 
              <span class="b3-menu__label">${window.siyuan.languages.attr}</span>
            </button>
          </div>
        </div>  <!-- secondaryToolbar -->

        <div class="pdf__toolbar">
          <div id="toolbarContainer">
            <div id="toolbarViewer">
                <button id="sidebarToggleButton" class="toolbarButton b3-tooltips b3-tooltips__se" aria-expanded="false" aria-controls="sidebarContainer" aria-label="${window.siyuan.languages.toggleSidebarNotification2Title} ${Mt("F4")}">
                    <svg><use xlink:href="#iconLayoutRight"></use></svg>
                </button>
                <button id="viewFindButton" class="toolbarButton b3-tooltips b3-tooltips__se" aria-expanded="false" aria-controls="findbar" aria-label="${window.siyuan.languages.search} ${Mt("\u2318F")}">
                  <svg><use xlink:href="#iconSearch"></use></svg>
                </button>
                <button id="rectAnno" class="toolbarButton b3-tooltips b3-tooltips__se" aria-expanded="false" aria-controls="findbar" aria-label="${window.siyuan.languages.rectAnnotation} ${Mt("\u2318D")}/${Mt("\u2325D")}">
                  <svg><use xlink:href="#iconLeftTop"></use></svg>
                </button>
                <input type="number" id="pageNumber" class="toolbarField pageNumber b3-text-field" value="1" size="4" min="1" autocomplete="off">
                <span id="numPages"></span>
                <div class="fn__flex-1"></div>
                <span id="scaleSelectContainer" class="dropdownToolbarButton">
                  <select id="scaleSelect" class="b3-select">
                    <option id="pageAutoOption" value="auto" selected="selected">${window.siyuan.languages.pageScaleAuto}</option>
                    <option id="pageActualOption" value="page-actual">${window.siyuan.languages.pageScaleActual}</option>
                    <option id="pageFitOption" value="page-fit">${window.siyuan.languages.pageScaleFit}</option>
                    <option id="pageWidthOption" value="page-width">${window.siyuan.languages.pageScaleWidth}</option>
                    <option id="customScaleOption" value="custom" disabled="disabled" hidden="true"></option>
                    <option value="0.5">50%</option>
                    <option value="0.75">75%</option>
                    <option value="1">100%</option>
                    <option value="1.25">125%</option>
                    <option value="1.5">150%</option>
                    <option value="2">200%</option>
                    <option value="3">300%</option>
                    <option value="4">400%</option>
                  </select>
                </span>
                <span id="scrollPage" class="fn__none"></span>
                <span id="printButton" class="fn__none"></span>
                <span id="secondaryPrint" class="fn__none"></span>
                <span id="viewBookmark" class="fn__none"></span>
                <span id="secondaryViewBookmark" class="fn__none"></span>
                <button id="secondaryToolbarToggleButton" class="toolbarButton b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.more}" aria-expanded="false" aria-controls="secondaryToolbar">
                  <svg><use xlink:href="#iconMore"></use></svg>
                </button>
            </div>
            <div id="loadingBar">
              <div class="progress">
                <div class="glimmer">
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="viewerContainer">
          <div id="viewer" class="pdfViewer"></div>
          <div class="pdf__resize fn__none"></div>
        </div>
        <div id="errorWrapper" hidden='true'>
          <div id="errorMessageLeft">
            <span id="errorMessage"></span>
            <button id="errorShowMore" data-l10n-id="error_more_info">
              More Information
            </button>
            <button id="errorShowLess" data-l10n-id="error_less_info" hidden='true'>
              Less Information
            </button>
          </div>
          <div id="errorMessageRight">
            <button id="errorClose" data-l10n-id="error_close">
              Close
            </button>
          </div>
          <div class="clearBoth"></div>
          <textarea id="errorMoreInfo" hidden='true' readonly="readonly"></textarea>
        </div>
      </div>
      <div id="dialogContainer">
        <div class="dialog" id="passwordDialog">
            <div class="row">
              <p id="passwordText" data-l10n-id="password_label">Enter the password to open this PDF file:</p>
            </div>
            <div class="row">
              <input type="password" id="password" class="toolbarField">
            </div>
            <div class="buttonRow">
              <button id="passwordCancel" class="overlayButton"><span data-l10n-id="password_cancel">Cancel</span></button>
              <button id="passwordSubmit" class="overlayButton"><span data-l10n-id="password_ok">OK</span></button>
            </div>
        </div>
        <div class="dialog" id="documentPropertiesDialog">
            <div class="row">
              <span>${window.siyuan.languages.fileName}</span> <p id="fileNameField">-</p>
            </div>
            <div class="row">
              <span>${window.siyuan.languages.fileSize}</span> <p id="fileSizeField">-</p>
            </div>
            <div class="separator"></div>
            <div class="row">
              <span>${window.siyuan.languages.title1}</span> <p id="titleField">-</p>
            </div>
            <div class="row">
              <span>${window.siyuan.languages.author}</span> <p id="authorField">-</p>
            </div>
            <div class="row">
              <span>${window.siyuan.languages.subject}</span> <p id="subjectField">-</p>
            </div>
            <div class="row">
              <span>${window.siyuan.languages.keywords}</span> <p id="keywordsField">-</p>
            </div>
            <div class="row">
              <span>${window.siyuan.languages.creationDate}</span> <p id="creationDateField">-</p>
            </div>
            <div class="row">
              <span>${window.siyuan.languages.modificationDate}</span> <p id="modificationDateField">-</p>
            </div>
            <div class="row">
              <span>${window.siyuan.languages.creator}</span> <p id="creatorField">-</p>
            </div>
            <div class="separator"></div>
            <div class="row">
              <span>PDF ${window.siyuan.languages.producer}</span> <p id="producerField">-</p>
            </div>
            <div class="row">
              <span>PDF ${window.siyuan.languages.version}</span> <p id="versionField">-</p>
            </div>
            <div class="row">
              <span>${window.siyuan.languages.pageCount}</span> <p id="pageCountField">-</p>
            </div>
            <div class="row">
              <span>${window.siyuan.languages.pageSize}</span> <p id="pageSizeField">-</p>
            </div>
            <div class="separator"></div>
            <div class="row">
              <span>${window.siyuan.languages.linearized}</span> <p id="linearizedField">-</p>
            </div>
            <div class="buttonRow">
              <button id="documentPropertiesClose" class="b3-button"><span>${window.siyuan.languages.close}</span></button>
            </div>
        </div>
        <div class="dialog" id="printServiceOverlay">
            <div class="row">
              <span data-l10n-id="print_progress_message">Preparing document for printing\u2026</span>
            </div>
            <div class="row">
              <progress value="0" max="100"></progress>
              <span data-l10n-id="print_progress_percent" data-l10n-args='{ "progress": 0 }' class="relative-progress">0%</span>
            </div>
            <div class="buttonRow">
              <button id="printCancel" class="overlayButton"><span data-l10n-id="print_progress_close">Cancel</span></button>
            </div>
        </div>
      </div>
      <div class="pdf__util b3-menu fn__none pdf__util--hide">
        <div class="fn__flex" style="padding: 0 4px">
            <button class="color__square" style="background-color:var(--b3-pdf-background1)"></button>
            <button class="color__square" style="background-color:var(--b3-pdf-background2)"></button>
            <button class="color__square" style="background-color:var(--b3-pdf-background3)"></button>
            <button class="color__square" style="background-color:var(--b3-pdf-background4)"></button>
            <button class="color__square" style="background-color:var(--b3-pdf-background5)"></button>
            <button class="color__square" style="background-color:var(--b3-pdf-background6)"></button>
            <button class="color__square" style="background-color:var(--b3-pdf-background7)"></button>
        </div>
        <div class="b3-menu__separator pdf__util__hide" style="margin-top: 8px"></div>
        <button class="b3-menu__item pdf__util__hide" data-type="toggle">
            <svg class="b3-menu__icon"><use xlink:href="#iconFilesRoot"></use></svg>
            <span class="b3-menu__label">${window.siyuan.languages.showHideBg}</span>
        </button>
        <button class="b3-menu__item pdf__util__hide" data-type="copy">
            <svg class="b3-menu__icon"><use xlink:href="#iconRef"></use></svg>
            <span class="b3-menu__label">${window.siyuan.languages.copyAnnotation}</span>
        </button>
        <button class="b3-menu__item pdf__util__hide" data-type="relate">
            <svg class="b3-menu__icon"><use xlink:href="#iconParagraph"></use></svg>
            <span class="b3-menu__label">${window.siyuan.languages.relation}</span>
        </button>
        <button class="b3-menu__item pdf__util__hide" data-type="remove">
            <svg class="b3-menu__icon"><use xlink:href="#iconTrashcan"></use></svg>
            <span class="b3-menu__label">${window.siyuan.languages.remove}</span>
        </button>
      </div>
      <div class="fn__none">
        <input id="editorFreeTextFontSize">
        <input id="editorFreeTextColor">
        <input id="editorInkColor">
        <input id="editorInkThickness">
        <input id="editorInkOpacity">
        <input id="editorStampAddImage">
        <input id="editorFreeHighlightThickness">
        <input id="editorHighlightShowAll">
        <input id="downloadButton">
        <input id="secondaryDownload">
        <input id="editorFreeTextButton">
        <input id="openFile">
        <input id="editorInkButton">
        <input id="editorStampButton">
        <input id="editorHighlightButton">
        <input id="imageAltTextSettings">
        <input id="secondaryOpenFile">
      </div>
    </div> <!-- outerContainer -->
    <div id="printContainer"></div>`;const n=window.siyuan.storage[p.LOCAL_PDFTHEME],a=window.siyuan.config.appearance.mode===0?n.light:n.dark,i=this.element.querySelector("#pdfDark"),s=this.element.querySelector("#pdfLight");a==="dark"?(this.element.firstElementChild.classList.add("pdf__outer--dark"),s.classList.remove("toggled"),i.classList.add("toggled")):(s.classList.add("toggled"),i.classList.remove("toggled")),s.addEventListener("click",()=>{window.siyuan.config.appearance.mode===0?n.light="light":n.dark="light",this.element.firstElementChild.classList.remove("pdf__outer--dark"),s.classList.add("toggled"),i.classList.remove("toggled"),Gt(p.LOCAL_PDFTHEME,window.siyuan.storage[p.LOCAL_PDFTHEME])}),i.addEventListener("click",()=>{window.siyuan.config.appearance.mode===0?n.light="dark":n.dark="dark",this.element.firstElementChild.classList.add("pdf__outer--dark"),s.classList.remove("toggled"),i.classList.add("toggled"),Gt(p.LOCAL_PDFTHEME,window.siyuan.storage[p.LOCAL_PDFTHEME])}),setTimeout(()=>{if(this.element.clientWidth===0){const r=new MutationObserver(()=>{this.pdfObject=NT(this.path.startsWith("file")?this.path:document.getElementById("baseURL").getAttribute("href")+"/"+this.path,this.element,this.pdfPage,this.pdfId),this.element.setAttribute("data-loading","true"),r.disconnect()});r.observe(this.element,{attributeFilter:["class"]})}else this.pdfObject=NT(this.path.startsWith("file")?this.path:document.getElementById("baseURL").getAttribute("href")+"/"+this.path,this.element,this.pdfPage,this.pdfId),this.element.setAttribute("data-loading","true")},p.TIMEOUT_LOAD)}}}var r6=Tn(5818),o6=Tn(9001),l6=Tn.n(o6);/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var lg={};lg.version="0.18.5";var vr=1200,Vd=1252,c6=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],i1={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},D_=function(t){c6.indexOf(t)!=-1&&(Vd=i1[0]=t)};function d6(){D_(1252)}var Or=function(t){vr=t,D_(t)};function C_(){Or(1200),d6()}function L_(t){for(var e=[],n=0,a=t.length;n<a;++n)e[n]=t.charCodeAt(n);return e}function u6(t){for(var e=[],n=0;n<t.length>>1;++n)e[n]=String.fromCharCode(t.charCodeAt(2*n)+(t.charCodeAt(2*n+1)<<8));return e.join("")}function BT(t){for(var e=[],n=0;n<t.length>>1;++n)e[n]=String.fromCharCode(t.charCodeAt(2*n+1)+(t.charCodeAt(2*n)<<8));return e.join("")}var Wf=function(t){var e=t.charCodeAt(0),n=t.charCodeAt(1);return e==255&&n==254?u6(t.slice(2)):e==254&&n==255?BT(t.slice(2)):e==65279?t.slice(1):t},cg=function(e){return String.fromCharCode(e)},s1=function(e){return String.fromCharCode(e)},pa;function $z(t){pa=t,Or=function(e){vr=e,D_(e)},Wf=function(e){return e.charCodeAt(0)===255&&e.charCodeAt(1)===254?pa.utils.decode(1200,L_(e.slice(2))):e},cg=function(n){return vr===1200?String.fromCharCode(n):pa.utils.decode(vr,[n&255,n>>8])[0]},s1=function(n){return pa.utils.decode(Vd,[n])[0]},N3()}var ri=null,dg=!0,fc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function ug(t){for(var e="",n=0,a=0,i=0,s=0,r=0,o=0,l=0,c=0;c<t.length;)n=t.charCodeAt(c++),s=n>>2,a=t.charCodeAt(c++),r=(n&3)<<4|a>>4,i=t.charCodeAt(c++),o=(a&15)<<2|i>>6,l=i&63,isNaN(a)?o=l=64:isNaN(i)&&(l=64),e+=fc.charAt(s)+fc.charAt(r)+fc.charAt(o)+fc.charAt(l);return e}function xr(t){var e="",n=0,a=0,i=0,s=0,r=0,o=0,l=0;t=t.replace(/[^\w\+\/\=]/g,"");for(var c=0;c<t.length;)s=fc.indexOf(t.charAt(c++)),r=fc.indexOf(t.charAt(c++)),n=s<<2|r>>4,e+=String.fromCharCode(n),o=fc.indexOf(t.charAt(c++)),a=(r&15)<<4|o>>2,o!==64&&(e+=String.fromCharCode(a)),l=fc.indexOf(t.charAt(c++)),i=(o&3)<<6|l,l!==64&&(e+=String.fromCharCode(i));return e}var Jn=function(){return typeof Buffer!="undefined"&&typeof process!="undefined"&&typeof process.versions!="undefined"&&!!process.versions.node}(),kl=function(){if(typeof Buffer!="undefined"){var t=!Buffer.from;if(!t)try{Buffer.from("foo","utf8")}catch(e){t=!0}return t?function(e,n){return n?new Buffer(e,n):new Buffer(e)}:Buffer.from.bind(Buffer)}return function(){}}();function pc(t){return Jn?Buffer.alloc?Buffer.alloc(t):new Buffer(t):typeof Uint8Array!="undefined"?new Uint8Array(t):new Array(t)}function $T(t){return Jn?Buffer.allocUnsafe?Buffer.allocUnsafe(t):new Buffer(t):typeof Uint8Array!="undefined"?new Uint8Array(t):new Array(t)}var Er=function(e){return Jn?kl(e,"binary"):e.split("").map(function(n){return n.charCodeAt(0)&255})};function fg(t){if(typeof ArrayBuffer=="undefined")return Er(t);for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),a=0;a!=t.length;++a)n[a]=t.charCodeAt(a)&255;return e}function hc(t){if(Array.isArray(t))return t.map(function(a){return String.fromCharCode(a)}).join("");for(var e=[],n=0;n<t.length;++n)e[n]=String.fromCharCode(t[n]);return e.join("")}function f6(t){if(typeof Uint8Array=="undefined")throw new Error("Unsupported");return new Uint8Array(t)}function r1(t){if(typeof ArrayBuffer=="undefined")throw new Error("Unsupported");if(t instanceof ArrayBuffer)return r1(new Uint8Array(t));for(var e=new Array(t.length),n=0;n<t.length;++n)e[n]=t[n];return e}var Yi=Jn?function(t){return Buffer.concat(t.map(function(e){return Buffer.isBuffer(e)?e:kl(e)}))}:function(t){if(typeof Uint8Array!="undefined"){var e=0,n=0;for(e=0;e<t.length;++e)n+=t[e].length;var a=new Uint8Array(n),i=0;for(e=0,n=0;e<t.length;n+=i,++e)if(i=t[e].length,t[e]instanceof Uint8Array)a.set(t[e],n);else{if(typeof t[e]=="string")throw"wtf";a.set(new Uint8Array(t[e]),n)}return a}return[].concat.apply([],t.map(function(s){return Array.isArray(s)?s:[].slice.call(s)}))};function p6(t){for(var e=[],n=0,a=t.length+250,i=pc(t.length+255),s=0;s<t.length;++s){var r=t.charCodeAt(s);if(r<128)i[n++]=r;else if(r<2048)i[n++]=192|r>>6&31,i[n++]=128|r&63;else if(r>=55296&&r<57344){r=(r&1023)+64;var o=t.charCodeAt(++s)&1023;i[n++]=240|r>>8&7,i[n++]=128|r>>2&63,i[n++]=128|o>>6&15|(r&3)<<4,i[n++]=128|o&63}else i[n++]=224|r>>12&15,i[n++]=128|r>>6&63,i[n++]=128|r&63;n>a&&(e.push(i.slice(0,n)),n=0,i=pc(65535),a=65530)}return e.push(i.slice(0,n)),Yi(e)}var hs=/\u0000/g,pg=/[\u0001-\u0006]/g;function Vf(t){for(var e="",n=t.length-1;n>=0;)e+=t.charAt(n--);return e}function wo(t,e){var n=""+t;return n.length>=e?n:li("0",e-n.length)+n}function o1(t,e){var n=""+t;return n.length>=e?n:li(" ",e-n.length)+n}function I_(t,e){var n=""+t;return n.length>=e?n:n+li(" ",e-n.length)}function h6(t,e){var n=""+Math.round(t);return n.length>=e?n:li("0",e-n.length)+n}function g6(t,e){var n=""+t;return n.length>=e?n:li("0",e-n.length)+n}var OT=Math.pow(2,32);function zf(t,e){if(t>OT||t<-OT)return h6(t,e);var n=Math.round(t);return g6(n,e)}function M_(t,e){return e=e||0,t.length>=7+e&&(t.charCodeAt(e)|32)===103&&(t.charCodeAt(e+1)|32)===101&&(t.charCodeAt(e+2)|32)===110&&(t.charCodeAt(e+3)|32)===101&&(t.charCodeAt(e+4)|32)===114&&(t.charCodeAt(e+5)|32)===97&&(t.charCodeAt(e+6)|32)===108}var RT=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],l1=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function m6(t){return t||(t={}),t[0]="General",t[1]="0",t[2]="0.00",t[3]="#,##0",t[4]="#,##0.00",t[9]="0%",t[10]="0.00%",t[11]="0.00E+00",t[12]="# ?/?",t[13]="# ??/??",t[14]="m/d/yy",t[15]="d-mmm-yy",t[16]="d-mmm",t[17]="mmm-yy",t[18]="h:mm AM/PM",t[19]="h:mm:ss AM/PM",t[20]="h:mm",t[21]="h:mm:ss",t[22]="m/d/yy h:mm",t[37]="#,##0 ;(#,##0)",t[38]="#,##0 ;[Red](#,##0)",t[39]="#,##0.00;(#,##0.00)",t[40]="#,##0.00;[Red](#,##0.00)",t[45]="mm:ss",t[46]="[h]:mm:ss",t[47]="mmss.0",t[48]="##0.0E+0",t[49]="@",t[56]='"\u4E0A\u5348/\u4E0B\u5348 "hh"\u6642"mm"\u5206"ss"\u79D2 "',t}var Dn={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"\u4E0A\u5348/\u4E0B\u5348 "hh"\u6642"mm"\u5206"ss"\u79D2 "'},UT={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},b6={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function F_(t,e,n){for(var a=t<0?-1:1,i=t*a,s=0,r=1,o=0,l=1,c=0,d=0,u=Math.floor(i);c<e&&(u=Math.floor(i),o=u*r+s,d=u*c+l,!(i-u<5e-8));)i=1/(i-u),s=r,r=o,l=c,c=d;if(d>e&&(c>e?(d=l,o=s):(d=c,o=r)),!n)return[0,a*o,d];var g=Math.floor(a*o/d);return[g,a*o-g*d,d]}function gc(t,e,n){if(t>2958465||t<0)return null;var a=t|0,i=Math.floor(86400*(t-a)),s=0,r=[],o={D:a,T:i,u:86400*(t-a)-i,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(o.u)<1e-6&&(o.u=0),e&&e.date1904&&(a+=1462),o.u>.9999&&(o.u=0,++i==86400&&(o.T=i=0,++a,++o.D)),a===60)r=n?[1317,10,29]:[1900,2,29],s=3;else if(a===0)r=n?[1317,8,29]:[1900,1,0],s=6;else{a>60&&--a;var l=new Date(1900,0,1);l.setDate(l.getDate()+a-1),r=[l.getFullYear(),l.getMonth()+1,l.getDate()],s=l.getDay(),a<60&&(s=(s+6)%7),n&&(s=E6(l,r))}return o.y=r[0],o.m=r[1],o.d=r[2],o.S=i%60,i=Math.floor(i/60),o.M=i%60,i=Math.floor(i/60),o.H=i,o.q=s,o}var HT=new Date(1899,11,31,0,0,0),y6=HT.getTime(),_6=new Date(1900,2,1,0,0,0);function qT(t,e){var n=t.getTime();return e?n-=1461*24*60*60*1e3:t>=_6&&(n+=24*60*60*1e3),(n-(y6+(t.getTimezoneOffset()-HT.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function c1(t){return t.indexOf(".")==-1?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function w6(t){return t.indexOf("E")==-1?t:t.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function v6(t){var e=t<0?12:11,n=c1(t.toFixed(12));return n.length<=e||(n=t.toPrecision(10),n.length<=e)?n:t.toExponential(5)}function x6(t){var e=c1(t.toFixed(11));return e.length>(t<0?12:11)||e==="0"||e==="-0"?t.toPrecision(6):e}function hg(t){var e=Math.floor(Math.log(Math.abs(t))*Math.LOG10E),n;return e>=-4&&e<=-1?n=t.toPrecision(10+e):Math.abs(e)<=9?n=v6(t):e===10?n=t.toFixed(10).substr(0,12):n=x6(t),c1(w6(n.toUpperCase()))}function zd(t,e){switch(typeof t){case"string":return t;case"boolean":return t?"TRUE":"FALSE";case"number":return(t|0)===t?t.toString(10):hg(t);case"undefined":return"";case"object":if(t==null)return"";if(t instanceof Date)return kr(14,qT(t,e&&e.date1904),e)}throw new Error("unsupported value in General format: "+t)}function E6(t,e){e[0]-=581;var n=t.getDay();return t<60&&(n=(n+6)%7),n}function k6(t,e,n,a){var i="",s=0,r=0,o=n.y,l,c=0;switch(t){case 98:o=n.y+543;case 121:switch(e.length){case 1:case 2:l=o%100,c=2;break;default:l=o%1e4,c=4;break}break;case 109:switch(e.length){case 1:case 2:l=n.m,c=e.length;break;case 3:return l1[n.m-1][1];case 5:return l1[n.m-1][0];default:return l1[n.m-1][2]}break;case 100:switch(e.length){case 1:case 2:l=n.d,c=e.length;break;case 3:return RT[n.q][0];default:return RT[n.q][1]}break;case 104:switch(e.length){case 1:case 2:l=1+(n.H+11)%12,c=e.length;break;default:throw"bad hour format: "+e}break;case 72:switch(e.length){case 1:case 2:l=n.H,c=e.length;break;default:throw"bad hour format: "+e}break;case 77:switch(e.length){case 1:case 2:l=n.M,c=e.length;break;default:throw"bad minute format: "+e}break;case 115:if(e!="s"&&e!="ss"&&e!=".0"&&e!=".00"&&e!=".000")throw"bad second format: "+e;return n.u===0&&(e=="s"||e=="ss")?wo(n.S,e.length):(a>=2?r=a===3?1e3:100:r=a===1?10:1,s=Math.round(r*(n.S+n.u)),s>=60*r&&(s=0),e==="s"?s===0?"0":""+s/r:(i=wo(s,2+a),e==="ss"?i.substr(0,2):"."+i.substr(2,e.length-1)));case 90:switch(e){case"[h]":case"[hh]":l=n.D*24+n.H;break;case"[m]":case"[mm]":l=(n.D*24+n.H)*60+n.M;break;case"[s]":case"[ss]":l=((n.D*24+n.H)*60+n.M)*60+Math.round(n.S+n.u);break;default:throw"bad abstime format: "+e}c=e.length===3?1:2;break;case 101:l=o,c=1;break}var d=c>0?wo(l,c):"";return d}function mc(t){var e=3;if(t.length<=e)return t;for(var n=t.length%e,a=t.substr(0,n);n!=t.length;n+=e)a+=(a.length>0?",":"")+t.substr(n,e);return a}var WT=/%/g;function S6(t,e,n){var a=e.replace(WT,""),i=e.length-a.length;return Sl(t,a,n*Math.pow(10,2*i))+li("%",i)}function A6(t,e,n){for(var a=e.length-1;e.charCodeAt(a-1)===44;)--a;return Sl(t,e.substr(0,a),n/Math.pow(10,3*(e.length-a)))}function VT(t,e){var n,a=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(e==0)return"0.0E+0";if(e<0)return"-"+VT(t,-e);var i=t.indexOf(".");i===-1&&(i=t.indexOf("E"));var s=Math.floor(Math.log(e)*Math.LOG10E)%i;if(s<0&&(s+=i),n=(e/Math.pow(10,s)).toPrecision(a+1+(i+s)%i),n.indexOf("e")===-1){var r=Math.floor(Math.log(e)*Math.LOG10E);for(n.indexOf(".")===-1?n=n.charAt(0)+"."+n.substr(1)+"E+"+(r-n.length+s):n+="E+"+(r-s);n.substr(0,2)==="0.";)n=n.charAt(0)+n.substr(2,i)+"."+n.substr(2+i),n=n.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");n=n.replace(/\+-/,"-")}n=n.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(o,l,c,d){return l+c+d.substr(0,(i+s)%i)+"."+d.substr(s)+"E"})}else n=e.toExponential(a);return t.match(/E\+00$/)&&n.match(/e[+-]\d$/)&&(n=n.substr(0,n.length-1)+"0"+n.charAt(n.length-1)),t.match(/E\-/)&&n.match(/e\+/)&&(n=n.replace(/e\+/,"e")),n.replace("e","E")}var zT=/# (\?+)( ?)\/( ?)(\d+)/;function T6(t,e,n){var a=parseInt(t[4],10),i=Math.round(e*a),s=Math.floor(i/a),r=i-s*a,o=a;return n+(s===0?"":""+s)+" "+(r===0?li(" ",t[1].length+1+t[4].length):o1(r,t[1].length)+t[2]+"/"+t[3]+wo(o,t[4].length))}function D6(t,e,n){return n+(e===0?"":""+e)+li(" ",t[1].length+2+t[4].length)}var YT=/^#*0*\.([0#]+)/,GT=/\).*[0#]/,jT=/\(###\) ###\\?-####/;function Rs(t){for(var e="",n,a=0;a!=t.length;++a)switch(n=t.charCodeAt(a)){case 35:break;case 63:e+=" ";break;case 48:e+="0";break;default:e+=String.fromCharCode(n)}return e}function KT(t,e){var n=Math.pow(10,e);return""+Math.round(t*n)/n}function XT(t,e){var n=t-Math.floor(t),a=Math.pow(10,e);return e<(""+Math.round(n*a)).length?0:Math.round(n*a)}function C6(t,e){return e<(""+Math.round((t-Math.floor(t))*Math.pow(10,e))).length?1:0}function L6(t){return t<2147483647&&t>-2147483648?""+(t>=0?t|0:t-1|0):""+Math.floor(t)}function Rr(t,e,n){if(t.charCodeAt(0)===40&&!e.match(GT)){var a=e.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return n>=0?Rr("n",a,n):"("+Rr("n",a,-n)+")"}if(e.charCodeAt(e.length-1)===44)return A6(t,e,n);if(e.indexOf("%")!==-1)return S6(t,e,n);if(e.indexOf("E")!==-1)return VT(e,n);if(e.charCodeAt(0)===36)return"$"+Rr(t,e.substr(e.charAt(1)==" "?2:1),n);var i,s,r,o,l=Math.abs(n),c=n<0?"-":"";if(e.match(/^00+$/))return c+zf(l,e.length);if(e.match(/^[#?]+$/))return i=zf(n,0),i==="0"&&(i=""),i.length>e.length?i:Rs(e.substr(0,e.length-i.length))+i;if(s=e.match(zT))return T6(s,l,c);if(e.match(/^#+0+$/))return c+zf(l,e.length-e.indexOf("0"));if(s=e.match(YT))return i=KT(n,s[1].length).replace(/^([^\.]+)$/,"$1."+Rs(s[1])).replace(/\.$/,"."+Rs(s[1])).replace(/\.(\d*)$/,function(h,m){return"."+m+li("0",Rs(s[1]).length-m.length)}),e.indexOf("0.")!==-1?i:i.replace(/^0\./,".");if(e=e.replace(/^#+([0.])/,"$1"),s=e.match(/^(0*)\.(#*)$/))return c+KT(l,s[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,s[1].length?"0.":".");if(s=e.match(/^#{1,3},##0(\.?)$/))return c+mc(zf(l,0));if(s=e.match(/^#,##0\.([#0]*0)$/))return n<0?"-"+Rr(t,e,-n):mc(""+(Math.floor(n)+C6(n,s[1].length)))+"."+wo(XT(n,s[1].length),s[1].length);if(s=e.match(/^#,#*,#0/))return Rr(t,e.replace(/^#,#*,/,""),n);if(s=e.match(/^([0#]+)(\\?-([0#]+))+$/))return i=Vf(Rr(t,e.replace(/[\\-]/g,""),n)),r=0,Vf(Vf(e.replace(/\\/g,"")).replace(/[0#]/g,function(h){return r<i.length?i.charAt(r++):h==="0"?"0":""}));if(e.match(jT))return i=Rr(t,"##########",n),"("+i.substr(0,3)+") "+i.substr(3,3)+"-"+i.substr(6);var d="";if(s=e.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return r=Math.min(s[4].length,7),o=F_(l,Math.pow(10,r)-1,!1),i=""+c,d=Sl("n",s[1],o[1]),d.charAt(d.length-1)==" "&&(d=d.substr(0,d.length-1)+"0"),i+=d+s[2]+"/"+s[3],d=I_(o[2],r),d.length<s[4].length&&(d=Rs(s[4].substr(s[4].length-d.length))+d),i+=d,i;if(s=e.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return r=Math.min(Math.max(s[1].length,s[4].length),7),o=F_(l,Math.pow(10,r)-1,!0),c+(o[0]||(o[1]?"":"0"))+" "+(o[1]?o1(o[1],r)+s[2]+"/"+s[3]+I_(o[2],r):li(" ",2*r+1+s[2].length+s[3].length));if(s=e.match(/^[#0?]+$/))return i=zf(n,0),e.length<=i.length?i:Rs(e.substr(0,e.length-i.length))+i;if(s=e.match(/^([#0?]+)\.([#0]+)$/)){i=""+n.toFixed(Math.min(s[2].length,10)).replace(/([^0])0+$/,"$1"),r=i.indexOf(".");var u=e.indexOf(".")-r,g=e.length-i.length-u;return Rs(e.substr(0,u)+i+e.substr(e.length-g))}if(s=e.match(/^00,000\.([#0]*0)$/))return r=XT(n,s[1].length),n<0?"-"+Rr(t,e,-n):mc(L6(n)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(h){return"00,"+(h.length<3?wo(0,3-h.length):"")+h})+"."+wo(r,s[1].length);switch(e){case"###,##0.00":return Rr(t,"#,##0.00",n);case"###,###":case"##,###":case"#,###":var f=mc(zf(l,0));return f!=="0"?c+f:"";case"###,###.00":return Rr(t,"###,##0.00",n).replace(/^0\./,".");case"#,###.00":return Rr(t,"#,##0.00",n).replace(/^0\./,".");default:}throw new Error("unsupported format |"+e+"|")}function I6(t,e,n){for(var a=e.length-1;e.charCodeAt(a-1)===44;)--a;return Sl(t,e.substr(0,a),n/Math.pow(10,3*(e.length-a)))}function M6(t,e,n){var a=e.replace(WT,""),i=e.length-a.length;return Sl(t,a,n*Math.pow(10,2*i))+li("%",i)}function ZT(t,e){var n,a=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(e==0)return"0.0E+0";if(e<0)return"-"+ZT(t,-e);var i=t.indexOf(".");i===-1&&(i=t.indexOf("E"));var s=Math.floor(Math.log(e)*Math.LOG10E)%i;if(s<0&&(s+=i),n=(e/Math.pow(10,s)).toPrecision(a+1+(i+s)%i),!n.match(/[Ee]/)){var r=Math.floor(Math.log(e)*Math.LOG10E);n.indexOf(".")===-1?n=n.charAt(0)+"."+n.substr(1)+"E+"+(r-n.length+s):n+="E+"+(r-s),n=n.replace(/\+-/,"-")}n=n.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(o,l,c,d){return l+c+d.substr(0,(i+s)%i)+"."+d.substr(s)+"E"})}else n=e.toExponential(a);return t.match(/E\+00$/)&&n.match(/e[+-]\d$/)&&(n=n.substr(0,n.length-1)+"0"+n.charAt(n.length-1)),t.match(/E\-/)&&n.match(/e\+/)&&(n=n.replace(/e\+/,"e")),n.replace("e","E")}function Yo(t,e,n){if(t.charCodeAt(0)===40&&!e.match(GT)){var a=e.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return n>=0?Yo("n",a,n):"("+Yo("n",a,-n)+")"}if(e.charCodeAt(e.length-1)===44)return I6(t,e,n);if(e.indexOf("%")!==-1)return M6(t,e,n);if(e.indexOf("E")!==-1)return ZT(e,n);if(e.charCodeAt(0)===36)return"$"+Yo(t,e.substr(e.charAt(1)==" "?2:1),n);var i,s,r,o,l=Math.abs(n),c=n<0?"-":"";if(e.match(/^00+$/))return c+wo(l,e.length);if(e.match(/^[#?]+$/))return i=""+n,n===0&&(i=""),i.length>e.length?i:Rs(e.substr(0,e.length-i.length))+i;if(s=e.match(zT))return D6(s,l,c);if(e.match(/^#+0+$/))return c+wo(l,e.length-e.indexOf("0"));if(s=e.match(YT))return i=(""+n).replace(/^([^\.]+)$/,"$1."+Rs(s[1])).replace(/\.$/,"."+Rs(s[1])),i=i.replace(/\.(\d*)$/,function(h,m){return"."+m+li("0",Rs(s[1]).length-m.length)}),e.indexOf("0.")!==-1?i:i.replace(/^0\./,".");if(e=e.replace(/^#+([0.])/,"$1"),s=e.match(/^(0*)\.(#*)$/))return c+(""+l).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,s[1].length?"0.":".");if(s=e.match(/^#{1,3},##0(\.?)$/))return c+mc(""+l);if(s=e.match(/^#,##0\.([#0]*0)$/))return n<0?"-"+Yo(t,e,-n):mc(""+n)+"."+li("0",s[1].length);if(s=e.match(/^#,#*,#0/))return Yo(t,e.replace(/^#,#*,/,""),n);if(s=e.match(/^([0#]+)(\\?-([0#]+))+$/))return i=Vf(Yo(t,e.replace(/[\\-]/g,""),n)),r=0,Vf(Vf(e.replace(/\\/g,"")).replace(/[0#]/g,function(h){return r<i.length?i.charAt(r++):h==="0"?"0":""}));if(e.match(jT))return i=Yo(t,"##########",n),"("+i.substr(0,3)+") "+i.substr(3,3)+"-"+i.substr(6);var d="";if(s=e.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return r=Math.min(s[4].length,7),o=F_(l,Math.pow(10,r)-1,!1),i=""+c,d=Sl("n",s[1],o[1]),d.charAt(d.length-1)==" "&&(d=d.substr(0,d.length-1)+"0"),i+=d+s[2]+"/"+s[3],d=I_(o[2],r),d.length<s[4].length&&(d=Rs(s[4].substr(s[4].length-d.length))+d),i+=d,i;if(s=e.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return r=Math.min(Math.max(s[1].length,s[4].length),7),o=F_(l,Math.pow(10,r)-1,!0),c+(o[0]||(o[1]?"":"0"))+" "+(o[1]?o1(o[1],r)+s[2]+"/"+s[3]+I_(o[2],r):li(" ",2*r+1+s[2].length+s[3].length));if(s=e.match(/^[#0?]+$/))return i=""+n,e.length<=i.length?i:Rs(e.substr(0,e.length-i.length))+i;if(s=e.match(/^([#0]+)\.([#0]+)$/)){i=""+n.toFixed(Math.min(s[2].length,10)).replace(/([^0])0+$/,"$1"),r=i.indexOf(".");var u=e.indexOf(".")-r,g=e.length-i.length-u;return Rs(e.substr(0,u)+i+e.substr(e.length-g))}if(s=e.match(/^00,000\.([#0]*0)$/))return n<0?"-"+Yo(t,e,-n):mc(""+n).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(h){return"00,"+(h.length<3?wo(0,3-h.length):"")+h})+"."+wo(0,s[1].length);switch(e){case"###,###":case"##,###":case"#,###":var f=mc(""+l);return f!=="0"?c+f:"";default:if(e.match(/\.[0#?]*$/))return Yo(t,e.slice(0,e.lastIndexOf(".")),n)+Rs(e.slice(e.lastIndexOf(".")))}throw new Error("unsupported format |"+e+"|")}function Sl(t,e,n){return(n|0)===n?Yo(t,e,n):Rr(t,e,n)}function F6(t){for(var e=[],n=!1,a=0,i=0;a<t.length;++a)switch(t.charCodeAt(a)){case 34:n=!n;break;case 95:case 42:case 92:++a;break;case 59:e[e.length]=t.substr(i,a-i),i=a+1}if(e[e.length]=t.substr(i),n===!0)throw new Error("Format |"+t+"| unterminated string ");return e}var JT=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function Yd(t){for(var e=0,n="",a="";e<t.length;)switch(n=t.charAt(e)){case"G":M_(t,e)&&(e+=6),e++;break;case'"':for(;t.charCodeAt(++e)!==34&&e<t.length;);++e;break;case"\\":e+=2;break;case"_":e+=2;break;case"@":++e;break;case"B":case"b":if(t.charAt(e+1)==="1"||t.charAt(e+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"\u4E0A":if(t.substr(e,3).toUpperCase()==="A/P"||t.substr(e,5).toUpperCase()==="AM/PM"||t.substr(e,5).toUpperCase()==="\u4E0A\u5348/\u4E0B\u5348")return!0;++e;break;case"[":for(a=n;t.charAt(e++)!=="]"&&e<t.length;)a+=t.charAt(e);if(a.match(JT))return!0;break;case".":case"0":case"#":for(;e<t.length&&("0#?.,E+-%".indexOf(n=t.charAt(++e))>-1||n=="\\"&&t.charAt(e+1)=="-"&&"0#".indexOf(t.charAt(e+2))>-1););break;case"?":for(;t.charAt(++e)===n;);break;case"*":++e,(t.charAt(e)==" "||t.charAt(e)=="*")&&++e;break;case"(":case")":++e;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;e<t.length&&"0123456789".indexOf(t.charAt(++e))>-1;);break;case" ":++e;break;default:++e;break}return!1}function P6(t,e,n,a){for(var i=[],s="",r=0,o="",l="t",c,d,u,g="H";r<t.length;)switch(o=t.charAt(r)){case"G":if(!M_(t,r))throw new Error("unrecognized character "+o+" in "+t);i[i.length]={t:"G",v:"General"},r+=7;break;case'"':for(s="";(u=t.charCodeAt(++r))!==34&&r<t.length;)s+=String.fromCharCode(u);i[i.length]={t:"t",v:s},++r;break;case"\\":var f=t.charAt(++r),h=f==="("||f===")"?f:"t";i[i.length]={t:h,v:f},++r;break;case"_":i[i.length]={t:"t",v:" "},r+=2;break;case"@":i[i.length]={t:"T",v:e},++r;break;case"B":case"b":if(t.charAt(r+1)==="1"||t.charAt(r+1)==="2"){if(c==null&&(c=gc(e,n,t.charAt(r+1)==="2"),c==null))return"";i[i.length]={t:"X",v:t.substr(r,2)},l=o,r+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":o=o.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(e<0||c==null&&(c=gc(e,n),c==null))return"";for(s=o;++r<t.length&&t.charAt(r).toLowerCase()===o;)s+=o;o==="m"&&l.toLowerCase()==="h"&&(o="M"),o==="h"&&(o=g),i[i.length]={t:o,v:s},l=o;break;case"A":case"a":case"\u4E0A":var m={t:o,v:o};if(c==null&&(c=gc(e,n)),t.substr(r,3).toUpperCase()==="A/P"?(c!=null&&(m.v=c.H>=12?"P":"A"),m.t="T",g="h",r+=3):t.substr(r,5).toUpperCase()==="AM/PM"?(c!=null&&(m.v=c.H>=12?"PM":"AM"),m.t="T",r+=5,g="h"):t.substr(r,5).toUpperCase()==="\u4E0A\u5348/\u4E0B\u5348"?(c!=null&&(m.v=c.H>=12?"\u4E0B\u5348":"\u4E0A\u5348"),m.t="T",r+=5,g="h"):(m.t="t",++r),c==null&&m.t==="T")return"";i[i.length]=m,l=o;break;case"[":for(s=o;t.charAt(r++)!=="]"&&r<t.length;)s+=t.charAt(r);if(s.slice(-1)!=="]")throw'unterminated "[" block: |'+s+"|";if(s.match(JT)){if(c==null&&(c=gc(e,n),c==null))return"";i[i.length]={t:"Z",v:s.toLowerCase()},l=s.charAt(1)}else s.indexOf("$")>-1&&(s=(s.match(/\$([^-\[\]]*)/)||[])[1]||"$",Yd(t)||(i[i.length]={t:"t",v:s}));break;case".":if(c!=null){for(s=o;++r<t.length&&(o=t.charAt(r))==="0";)s+=o;i[i.length]={t:"s",v:s};break}case"0":case"#":for(s=o;++r<t.length&&"0#?.,E+-%".indexOf(o=t.charAt(r))>-1;)s+=o;i[i.length]={t:"n",v:s};break;case"?":for(s=o;t.charAt(++r)===o;)s+=o;i[i.length]={t:o,v:s},l=o;break;case"*":++r,(t.charAt(r)==" "||t.charAt(r)=="*")&&++r;break;case"(":case")":i[i.length]={t:a===1?"t":o,v:o},++r;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(s=o;r<t.length&&"0123456789".indexOf(t.charAt(++r))>-1;)s+=t.charAt(r);i[i.length]={t:"D",v:s};break;case" ":i[i.length]={t:o,v:o},++r;break;case"$":i[i.length]={t:"t",v:"$"},++r;break;default:if(",$-+/():!^&'~{}<>=\u20ACacfijklopqrtuvwxzP".indexOf(o)===-1)throw new Error("unrecognized character "+o+" in "+t);i[i.length]={t:"t",v:o},++r;break}var b=0,y=0,_;for(r=i.length-1,l="t";r>=0;--r)switch(i[r].t){case"h":case"H":i[r].t=g,l="h",b<1&&(b=1);break;case"s":(_=i[r].v.match(/\.0+$/))&&(y=Math.max(y,_[0].length-1)),b<3&&(b=3);case"d":case"y":case"M":case"e":l=i[r].t;break;case"m":l==="s"&&(i[r].t="M",b<2&&(b=2));break;case"X":break;case"Z":b<1&&i[r].v.match(/[Hh]/)&&(b=1),b<2&&i[r].v.match(/[Mm]/)&&(b=2),b<3&&i[r].v.match(/[Ss]/)&&(b=3)}switch(b){case 0:break;case 1:c.u>=.5&&(c.u=0,++c.S),c.S>=60&&(c.S=0,++c.M),c.M>=60&&(c.M=0,++c.H);break;case 2:c.u>=.5&&(c.u=0,++c.S),c.S>=60&&(c.S=0,++c.M);break}var v="",U;for(r=0;r<i.length;++r)switch(i[r].t){case"t":case"T":case" ":case"D":break;case"X":i[r].v="",i[r].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":i[r].v=k6(i[r].t.charCodeAt(0),i[r].v,c,y),i[r].t="t";break;case"n":case"?":for(U=r+1;i[U]!=null&&((o=i[U].t)==="?"||o==="D"||(o===" "||o==="t")&&i[U+1]!=null&&(i[U+1].t==="?"||i[U+1].t==="t"&&i[U+1].v==="/")||i[r].t==="("&&(o===" "||o==="n"||o===")")||o==="t"&&(i[U].v==="/"||i[U].v===" "&&i[U+1]!=null&&i[U+1].t=="?"));)i[r].v+=i[U].v,i[U]={v:"",t:";"},++U;v+=i[r].v,r=U-1;break;case"G":i[r].t="t",i[r].v=zd(e,n);break}var ee="",Z,k;if(v.length>0){v.charCodeAt(0)==40?(Z=e<0&&v.charCodeAt(0)===45?-e:e,k=Sl("n",v,Z)):(Z=e<0&&a>1?-e:e,k=Sl("n",v,Z),Z<0&&i[0]&&i[0].t=="t"&&(k=k.substr(1),i[0].v="-"+i[0].v)),U=k.length-1;var w=i.length;for(r=0;r<i.length;++r)if(i[r]!=null&&i[r].t!="t"&&i[r].v.indexOf(".")>-1){w=r;break}var S=i.length;if(w===i.length&&k.indexOf("E")===-1){for(r=i.length-1;r>=0;--r)i[r]==null||"n?".indexOf(i[r].t)===-1||(U>=i[r].v.length-1?(U-=i[r].v.length,i[r].v=k.substr(U+1,i[r].v.length)):U<0?i[r].v="":(i[r].v=k.substr(0,U+1),U=-1),i[r].t="t",S=r);U>=0&&S<i.length&&(i[S].v=k.substr(0,U+1)+i[S].v)}else if(w!==i.length&&k.indexOf("E")===-1){for(U=k.indexOf(".")-1,r=w;r>=0;--r)if(!(i[r]==null||"n?".indexOf(i[r].t)===-1)){for(d=i[r].v.indexOf(".")>-1&&r===w?i[r].v.indexOf(".")-1:i[r].v.length-1,ee=i[r].v.substr(d+1);d>=0;--d)U>=0&&(i[r].v.charAt(d)==="0"||i[r].v.charAt(d)==="#")&&(ee=k.charAt(U--)+ee);i[r].v=ee,i[r].t="t",S=r}for(U>=0&&S<i.length&&(i[S].v=k.substr(0,U+1)+i[S].v),U=k.indexOf(".")+1,r=w;r<i.length;++r)if(!(i[r]==null||"n?(".indexOf(i[r].t)===-1&&r!==w)){for(d=i[r].v.indexOf(".")>-1&&r===w?i[r].v.indexOf(".")+1:0,ee=i[r].v.substr(0,d);d<i[r].v.length;++d)U<k.length&&(ee+=k.charAt(U++));i[r].v=ee,i[r].t="t",S=r}}}for(r=0;r<i.length;++r)i[r]!=null&&"n?".indexOf(i[r].t)>-1&&(Z=a>1&&e<0&&r>0&&i[r-1].v==="-"?-e:e,i[r].v=Sl(i[r].t,i[r].v,Z),i[r].t="t");var B="";for(r=0;r!==i.length;++r)i[r]!=null&&(B+=i[r].v);return B}var QT=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function e3(t,e){if(e==null)return!1;var n=parseFloat(e[2]);switch(e[1]){case"=":if(t==n)return!0;break;case">":if(t>n)return!0;break;case"<":if(t<n)return!0;break;case"<>":if(t!=n)return!0;break;case">=":if(t>=n)return!0;break;case"<=":if(t<=n)return!0;break}return!1}function N6(t,e){var n=F6(t),a=n.length,i=n[a-1].indexOf("@");if(a<4&&i>-1&&--a,n.length>4)throw new Error("cannot find right format for |"+n.join("|")+"|");if(typeof e!="number")return[4,n.length===4||i>-1?n[n.length-1]:"@"];switch(n.length){case 1:n=i>-1?["General","General","General",n[0]]:[n[0],n[0],n[0],"@"];break;case 2:n=i>-1?[n[0],n[0],n[0],n[1]]:[n[0],n[1],n[0],"@"];break;case 3:n=i>-1?[n[0],n[1],n[0],n[2]]:[n[0],n[1],n[2],"@"];break;case 4:break}var s=e>0?n[0]:e<0?n[1]:n[2];if(n[0].indexOf("[")===-1&&n[1].indexOf("[")===-1)return[a,s];if(n[0].match(/\[[=<>]/)!=null||n[1].match(/\[[=<>]/)!=null){var r=n[0].match(QT),o=n[1].match(QT);return e3(e,r)?[a,n[0]]:e3(e,o)?[a,n[1]]:[a,n[r!=null&&o!=null?2:1]]}return[a,s]}function kr(t,e,n){n==null&&(n={});var a="";switch(typeof t){case"string":t=="m/d/yy"&&n.dateNF?a=n.dateNF:a=t;break;case"number":t==14&&n.dateNF?a=n.dateNF:a=(n.table!=null?n.table:Dn)[t],a==null&&(a=n.table&&n.table[UT[t]]||Dn[UT[t]]),a==null&&(a=b6[t]||"General");break}if(M_(a,0))return zd(e,n);e instanceof Date&&(e=qT(e,n.date1904));var i=N6(a,e);if(M_(i[1]))return zd(e,n);if(e===!0)e="TRUE";else if(e===!1)e="FALSE";else if(e===""||e==null)return"";return P6(i[1],e,n,i[0])}function Go(t,e){if(typeof e!="number"){e=+e||-1;for(var n=0;n<392;++n){if(Dn[n]==null){e<0&&(e=n);continue}if(Dn[n]==t){e=n;break}}e<0&&(e=391)}return Dn[e]=t,e}function gg(t){for(var e=0;e!=392;++e)t[e]!==void 0&&Go(t[e],e)}function Yf(){Dn=m6()}var B6={format:kr,load:Go,_table:Dn,load_table:gg,parse_date_code:gc,is_date:Yd,get_table:function(){return B6._table=Dn}},$6={5:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',23:"General",24:"General",25:"General",26:"General",27:"m/d/yy",28:"m/d/yy",29:"m/d/yy",30:"m/d/yy",31:"m/d/yy",32:"h:mm:ss",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yy",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* (#,##0);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',50:"m/d/yy",51:"m/d/yy",52:"m/d/yy",53:"m/d/yy",54:"m/d/yy",55:"m/d/yy",56:"m/d/yy",57:"m/d/yy",58:"m/d/yy",59:"0",60:"0.00",61:"#,##0",62:"#,##0.00",63:'"$"#,##0_);\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',67:"0%",68:"0.00%",69:"# ?/?",70:"# ??/??",71:"m/d/yy",72:"m/d/yy",73:"d-mmm-yy",74:"d-mmm",75:"mmm-yy",76:"h:mm",77:"h:mm:ss",78:"m/d/yy h:mm",79:"mm:ss",80:"[h]:mm:ss",81:"mmss.0"},t3=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function O6(t){var e=typeof t=="number"?Dn[t]:t;return e=e.replace(t3,"(\\d+)"),new RegExp("^"+e+"$")}function R6(t,e,n){var a=-1,i=-1,s=-1,r=-1,o=-1,l=-1;(e.match(t3)||[]).forEach(function(u,g){var f=parseInt(n[g+1],10);switch(u.toLowerCase().charAt(0)){case"y":a=f;break;case"d":s=f;break;case"h":r=f;break;case"s":l=f;break;case"m":r>=0?o=f:i=f;break}}),l>=0&&o==-1&&i>=0&&(o=i,i=-1);var c=(""+(a>=0?a:new Date().getFullYear())).slice(-4)+"-"+("00"+(i>=1?i:1)).slice(-2)+"-"+("00"+(s>=1?s:1)).slice(-2);c.length==7&&(c="0"+c),c.length==8&&(c="20"+c);var d=("00"+(r>=0?r:0)).slice(-2)+":"+("00"+(o>=0?o:0)).slice(-2)+":"+("00"+(l>=0?l:0)).slice(-2);return r==-1&&o==-1&&l==-1?c:a==-1&&i==-1&&s==-1?d:c+"T"+d}var U6=function(){var t={};t.version="1.2.0";function e(){for(var k=0,w=new Array(256),S=0;S!=256;++S)k=S,k=k&1?-306674912^k>>>1:k>>>1,k=k&1?-306674912^k>>>1:k>>>1,k=k&1?-306674912^k>>>1:k>>>1,k=k&1?-306674912^k>>>1:k>>>1,k=k&1?-306674912^k>>>1:k>>>1,k=k&1?-306674912^k>>>1:k>>>1,k=k&1?-306674912^k>>>1:k>>>1,k=k&1?-306674912^k>>>1:k>>>1,w[S]=k;return typeof Int32Array!="undefined"?new Int32Array(w):w}var n=e();function a(k){var w=0,S=0,B=0,H=typeof Int32Array!="undefined"?new Int32Array(4096):new Array(4096);for(B=0;B!=256;++B)H[B]=k[B];for(B=0;B!=256;++B)for(S=k[B],w=256+B;w<4096;w+=256)S=H[w]=S>>>8^k[S&255];var j=[];for(B=1;B!=16;++B)j[B-1]=typeof Int32Array!="undefined"?H.subarray(B*256,B*256+256):H.slice(B*256,B*256+256);return j}var i=a(n),s=i[0],r=i[1],o=i[2],l=i[3],c=i[4],d=i[5],u=i[6],g=i[7],f=i[8],h=i[9],m=i[10],b=i[11],y=i[12],_=i[13],v=i[14];function U(k,w){for(var S=w^-1,B=0,H=k.length;B<H;)S=S>>>8^n[(S^k.charCodeAt(B++))&255];return~S}function ee(k,w){for(var S=w^-1,B=k.length-15,H=0;H<B;)S=v[k[H++]^S&255]^_[k[H++]^S>>8&255]^y[k[H++]^S>>16&255]^b[k[H++]^S>>>24]^m[k[H++]]^h[k[H++]]^f[k[H++]]^g[k[H++]]^u[k[H++]]^d[k[H++]]^c[k[H++]]^l[k[H++]]^o[k[H++]]^r[k[H++]]^s[k[H++]]^n[k[H++]];for(B+=15;H<B;)S=S>>>8^n[(S^k[H++])&255];return~S}function Z(k,w){for(var S=w^-1,B=0,H=k.length,j=0,re=0;B<H;)j=k.charCodeAt(B++),j<128?S=S>>>8^n[(S^j)&255]:j<2048?(S=S>>>8^n[(S^(192|j>>6&31))&255],S=S>>>8^n[(S^(128|j&63))&255]):j>=55296&&j<57344?(j=(j&1023)+64,re=k.charCodeAt(B++)&1023,S=S>>>8^n[(S^(240|j>>8&7))&255],S=S>>>8^n[(S^(128|j>>2&63))&255],S=S>>>8^n[(S^(128|re>>6&15|(j&3)<<4))&255],S=S>>>8^n[(S^(128|re&63))&255]):(S=S>>>8^n[(S^(224|j>>12&15))&255],S=S>>>8^n[(S^(128|j>>6&63))&255],S=S>>>8^n[(S^(128|j&63))&255]);return~S}return t.table=n,t.bstr=U,t.buf=ee,t.str=Z,t}(),An=function(){var e={};e.version="1.2.1";function n(we,Re){for(var Me=we.split("/"),Pe=Re.split("/"),qe=0,We=0,wt=Math.min(Me.length,Pe.length);qe<wt;++qe){if(We=Me[qe].length-Pe[qe].length)return We;if(Me[qe]!=Pe[qe])return Me[qe]<Pe[qe]?-1:1}return Me.length-Pe.length}function a(we){if(we.charAt(we.length-1)=="/")return we.slice(0,-1).indexOf("/")===-1?we:a(we.slice(0,-1));var Re=we.lastIndexOf("/");return Re===-1?we:we.slice(0,Re+1)}function i(we){if(we.charAt(we.length-1)=="/")return i(we.slice(0,-1));var Re=we.lastIndexOf("/");return Re===-1?we:we.slice(Re+1)}function s(we,Re){typeof Re=="string"&&(Re=new Date(Re));var Me=Re.getHours();Me=Me<<6|Re.getMinutes(),Me=Me<<5|Re.getSeconds()>>>1,we.write_shift(2,Me);var Pe=Re.getFullYear()-1980;Pe=Pe<<4|Re.getMonth()+1,Pe=Pe<<5|Re.getDate(),we.write_shift(2,Pe)}function r(we){var Re=we.read_shift(2)&65535,Me=we.read_shift(2)&65535,Pe=new Date,qe=Me&31;Me>>>=5;var We=Me&15;Me>>>=4,Pe.setMilliseconds(0),Pe.setFullYear(Me+1980),Pe.setMonth(We-1),Pe.setDate(qe);var wt=Re&31;Re>>>=5;var Lt=Re&63;return Re>>>=6,Pe.setHours(Re),Pe.setMinutes(Lt),Pe.setSeconds(wt<<1),Pe}function o(we){as(we,0);for(var Re={},Me=0;we.l<=we.length-4;){var Pe=we.read_shift(2),qe=we.read_shift(2),We=we.l+qe,wt={};switch(Pe){case 21589:Me=we.read_shift(1),Me&1&&(wt.mtime=we.read_shift(4)),qe>5&&(Me&2&&(wt.atime=we.read_shift(4)),Me&4&&(wt.ctime=we.read_shift(4))),wt.mtime&&(wt.mt=new Date(wt.mtime*1e3));break}we.l=We,Re[Pe]=wt}return Re}var l;function c(){return l||(l={})}function d(we,Re){if(we[0]==80&&we[1]==75)return dI(we,Re);if((we[0]|32)==109&&(we[1]|32)==105)return dz(we,Re);if(we.length<512)throw new Error("CFB file size "+we.length+" < 512");var Me=3,Pe=512,qe=0,We=0,wt=0,Lt=0,xt=0,vt=[],Et=we.slice(0,512);as(Et,0);var Zt=u(Et);switch(Me=Zt[0],Me){case 3:Pe=512;break;case 4:Pe=4096;break;case 0:if(Zt[1]==0)return dI(we,Re);default:throw new Error("Major Version: Expected 3 or 4 saw "+Me)}Pe!==512&&(Et=we.slice(0,Pe),as(Et,28));var sn=we.slice(0,Pe);g(Et,Me);var xn=Et.read_shift(4,"i");if(Me===3&&xn!==0)throw new Error("# Directory Sectors: Expected 0 saw "+xn);Et.l+=4,wt=Et.read_shift(4,"i"),Et.l+=4,Et.chk("00100000","Mini Stream Cutoff Size: "),Lt=Et.read_shift(4,"i"),qe=Et.read_shift(4,"i"),xt=Et.read_shift(4,"i"),We=Et.read_shift(4,"i");for(var rn=-1,ln=0;ln<109&&(rn=Et.read_shift(4,"i"),!(rn<0));++ln)vt[ln]=rn;var qn=f(we,Pe);b(xt,We,qn,Pe,vt);var ja=_(qn,wt,vt,Pe);ja[wt].name="!Directory",qe>0&&Lt!==re&&(ja[Lt].name="!MiniFAT"),ja[vt[0]].name="!FAT",ja.fat_addrs=vt,ja.ssz=Pe;var lr={},Bi=[],Fr=[],Qb=[];v(wt,ja,qn,Bi,qe,lr,Fr,Lt),h(Fr,Qb,Bi),Bi.shift();var ey={FileIndex:Fr,FullPaths:Qb};return Re&&Re.raw&&(ey.raw={header:sn,sectors:qn}),ey}function u(we){if(we[we.l]==80&&we[we.l+1]==75)return[0,0];we.chk(Te,"Header Signature: "),we.l+=16;var Re=we.read_shift(2,"u");return[we.read_shift(2,"u"),Re]}function g(we,Re){var Me=9;switch(we.l+=2,Me=we.read_shift(2)){case 9:if(Re!=3)throw new Error("Sector Shift: Expected 9 saw "+Me);break;case 12:if(Re!=4)throw new Error("Sector Shift: Expected 12 saw "+Me);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+Me)}we.chk("0600","Mini Sector Shift: "),we.chk("000000000000","Reserved: ")}function f(we,Re){for(var Me=Math.ceil(we.length/Re)-1,Pe=[],qe=1;qe<Me;++qe)Pe[qe-1]=we.slice(qe*Re,(qe+1)*Re);return Pe[Me-1]=we.slice(Me*Re),Pe}function h(we,Re,Me){for(var Pe=0,qe=0,We=0,wt=0,Lt=0,xt=Me.length,vt=[],Et=[];Pe<xt;++Pe)vt[Pe]=Et[Pe]=Pe,Re[Pe]=Me[Pe];for(;Lt<Et.length;++Lt)Pe=Et[Lt],qe=we[Pe].L,We=we[Pe].R,wt=we[Pe].C,vt[Pe]===Pe&&(qe!==-1&&vt[qe]!==qe&&(vt[Pe]=vt[qe]),We!==-1&&vt[We]!==We&&(vt[Pe]=vt[We])),wt!==-1&&(vt[wt]=Pe),qe!==-1&&Pe!=vt[Pe]&&(vt[qe]=vt[Pe],Et.lastIndexOf(qe)<Lt&&Et.push(qe)),We!==-1&&Pe!=vt[Pe]&&(vt[We]=vt[Pe],Et.lastIndexOf(We)<Lt&&Et.push(We));for(Pe=1;Pe<xt;++Pe)vt[Pe]===Pe&&(We!==-1&&vt[We]!==We?vt[Pe]=vt[We]:qe!==-1&&vt[qe]!==qe&&(vt[Pe]=vt[qe]));for(Pe=1;Pe<xt;++Pe)if(we[Pe].type!==0){if(Lt=Pe,Lt!=vt[Lt])do Lt=vt[Lt],Re[Pe]=Re[Lt]+"/"+Re[Pe];while(Lt!==0&&vt[Lt]!==-1&&Lt!=vt[Lt]);vt[Pe]=-1}for(Re[0]+="/",Pe=1;Pe<xt;++Pe)we[Pe].type!==2&&(Re[Pe]+="/")}function m(we,Re,Me){for(var Pe=we.start,qe=we.size,We=[],wt=Pe;Me&&qe>0&&wt>=0;)We.push(Re.slice(wt*j,wt*j+j)),qe-=j,wt=jd(Me,wt*4);return We.length===0?Dt(0):Yi(We).slice(0,we.size)}function b(we,Re,Me,Pe,qe){var We=re;if(we===re){if(Re!==0)throw new Error("DIFAT chain shorter than expected")}else if(we!==-1){var wt=Me[we],Lt=(Pe>>>2)-1;if(!wt)return;for(var xt=0;xt<Lt&&(We=jd(wt,xt*4))!==re;++xt)qe.push(We);b(jd(wt,Pe-4),Re-1,Me,Pe,qe)}}function y(we,Re,Me,Pe,qe){var We=[],wt=[];qe||(qe=[]);var Lt=Pe-1,xt=0,vt=0;for(xt=Re;xt>=0;){qe[xt]=!0,We[We.length]=xt,wt.push(we[xt]);var Et=Me[Math.floor(xt*4/Pe)];if(vt=xt*4&Lt,Pe<4+vt)throw new Error("FAT boundary crossed: "+xt+" 4 "+Pe);if(!we[Et])break;xt=jd(we[Et],vt)}return{nodes:We,data:k3([wt])}}function _(we,Re,Me,Pe){var qe=we.length,We=[],wt=[],Lt=[],xt=[],vt=Pe-1,Et=0,Zt=0,sn=0,xn=0;for(Et=0;Et<qe;++Et)if(Lt=[],sn=Et+Re,sn>=qe&&(sn-=qe),!wt[sn]){xt=[];var rn=[];for(Zt=sn;Zt>=0;){rn[Zt]=!0,wt[Zt]=!0,Lt[Lt.length]=Zt,xt.push(we[Zt]);var ln=Me[Math.floor(Zt*4/Pe)];if(xn=Zt*4&vt,Pe<4+xn)throw new Error("FAT boundary crossed: "+Zt+" 4 "+Pe);if(!we[ln]||(Zt=jd(we[ln],xn),rn[Zt]))break}We[sn]={nodes:Lt,data:k3([xt])}}return We}function v(we,Re,Me,Pe,qe,We,wt,Lt){for(var xt=0,vt=Pe.length?2:0,Et=Re[we].data,Zt=0,sn=0,xn;Zt<Et.length;Zt+=128){var rn=Et.slice(Zt,Zt+128);as(rn,64),sn=rn.read_shift(2),xn=R_(rn,0,sn-vt),Pe.push(xn);var ln={name:xn,type:rn.read_shift(1),color:rn.read_shift(1),L:rn.read_shift(4,"i"),R:rn.read_shift(4,"i"),C:rn.read_shift(4,"i"),clsid:rn.read_shift(16),state:rn.read_shift(4,"i"),start:0,size:0},qn=rn.read_shift(2)+rn.read_shift(2)+rn.read_shift(2)+rn.read_shift(2);qn!==0&&(ln.ct=U(rn,rn.l-8));var ja=rn.read_shift(2)+rn.read_shift(2)+rn.read_shift(2)+rn.read_shift(2);ja!==0&&(ln.mt=U(rn,rn.l-8)),ln.start=rn.read_shift(4,"i"),ln.size=rn.read_shift(4,"i"),ln.size<0&&ln.start<0&&(ln.size=ln.type=0,ln.start=re,ln.name=""),ln.type===5?(xt=ln.start,qe>0&&xt!==re&&(Re[xt].name="!StreamData")):ln.size>=4096?(ln.storage="fat",Re[ln.start]===void 0&&(Re[ln.start]=y(Me,ln.start,Re.fat_addrs,Re.ssz)),Re[ln.start].name=ln.name,ln.content=Re[ln.start].data.slice(0,ln.size)):(ln.storage="minifat",ln.size<0?ln.size=0:xt!==re&&ln.start!==re&&Re[xt]&&(ln.content=m(ln,Re[xt].data,(Re[Lt]||{}).data))),ln.content&&as(ln.content,0),We[xn]=ln,wt.push(ln)}}function U(we,Re){return new Date((Gi(we,Re+4)/1e7*Math.pow(2,32)+Gi(we,Re)/1e7-11644473600)*1e3)}function ee(we,Re){return c(),d(l.readFileSync(we),Re)}function Z(we,Re){var Me=Re&&Re.type;switch(Me||Jn&&Buffer.isBuffer(we)&&(Me="buffer"),Me||"base64"){case"file":return ee(we,Re);case"base64":return d(Er(xr(we)),Re);case"binary":return d(Er(we),Re)}return d(we,Re)}function k(we,Re){var Me=Re||{},Pe=Me.root||"Root Entry";if(we.FullPaths||(we.FullPaths=[]),we.FileIndex||(we.FileIndex=[]),we.FullPaths.length!==we.FileIndex.length)throw new Error("inconsistent CFB structure");we.FullPaths.length===0&&(we.FullPaths[0]=Pe+"/",we.FileIndex[0]={name:Pe,type:5}),Me.CLSID&&(we.FileIndex[0].clsid=Me.CLSID),w(we)}function w(we){var Re="Sh33tJ5";if(!An.find(we,"/"+Re)){var Me=Dt(4);Me[0]=55,Me[1]=Me[3]=50,Me[2]=54,we.FileIndex.push({name:Re,type:2,content:Me,size:4,L:69,R:69,C:69}),we.FullPaths.push(we.FullPaths[0]+Re),S(we)}}function S(we,Re){k(we);for(var Me=!1,Pe=!1,qe=we.FullPaths.length-1;qe>=0;--qe){var We=we.FileIndex[qe];switch(We.type){case 0:Pe?Me=!0:(we.FileIndex.pop(),we.FullPaths.pop());break;case 1:case 2:case 5:Pe=!0,isNaN(We.R*We.L*We.C)&&(Me=!0),We.R>-1&&We.L>-1&&We.R==We.L&&(Me=!0);break;default:Me=!0;break}}if(!(!Me&&!Re)){var wt=new Date(1987,1,19),Lt=0,xt=Object.create?Object.create(null):{},vt=[];for(qe=0;qe<we.FullPaths.length;++qe)xt[we.FullPaths[qe]]=!0,we.FileIndex[qe].type!==0&&vt.push([we.FullPaths[qe],we.FileIndex[qe]]);for(qe=0;qe<vt.length;++qe){var Et=a(vt[qe][0]);Pe=xt[Et],Pe||(vt.push([Et,{name:i(Et).replace("/",""),type:1,clsid:Ie,ct:wt,mt:wt,content:null}]),xt[Et]=!0)}for(vt.sort(function(xn,rn){return n(xn[0],rn[0])}),we.FullPaths=[],we.FileIndex=[],qe=0;qe<vt.length;++qe)we.FullPaths[qe]=vt[qe][0],we.FileIndex[qe]=vt[qe][1];for(qe=0;qe<vt.length;++qe){var Zt=we.FileIndex[qe],sn=we.FullPaths[qe];if(Zt.name=i(sn).replace("/",""),Zt.L=Zt.R=Zt.C=-(Zt.color=1),Zt.size=Zt.content?Zt.content.length:0,Zt.start=0,Zt.clsid=Zt.clsid||Ie,qe===0)Zt.C=vt.length>1?1:-1,Zt.size=0,Zt.type=5;else if(sn.slice(-1)=="/"){for(Lt=qe+1;Lt<vt.length&&a(we.FullPaths[Lt])!=sn;++Lt);for(Zt.C=Lt>=vt.length?-1:Lt,Lt=qe+1;Lt<vt.length&&a(we.FullPaths[Lt])!=a(sn);++Lt);Zt.R=Lt>=vt.length?-1:Lt,Zt.type=1}else a(we.FullPaths[qe+1]||"")==a(sn)&&(Zt.R=qe+1),Zt.type=2}}}function B(we,Re){var Me=Re||{};if(Me.fileType=="mad")return uz(we,Me);switch(S(we),Me.fileType){case"zip":return iz(we,Me)}var Pe=function(xn){for(var rn=0,ln=0,qn=0;qn<xn.FileIndex.length;++qn){var ja=xn.FileIndex[qn];if(ja.content){var lr=ja.content.length;lr>0&&(lr<4096?rn+=lr+63>>6:ln+=lr+511>>9)}}for(var Bi=xn.FullPaths.length+3>>2,Fr=rn+7>>3,Qb=rn+127>>7,ey=Fr+ln+Bi+Qb,tf=ey+127>>7,lk=tf<=109?0:Math.ceil((tf-109)/127);ey+tf+lk+127>>7>tf;)lk=++tf<=109?0:Math.ceil((tf-109)/127);var Gl=[1,lk,tf,Qb,Bi,ln,rn,0];return xn.FileIndex[0].size=rn<<6,Gl[7]=(xn.FileIndex[0].start=Gl[0]+Gl[1]+Gl[2]+Gl[3]+Gl[4]+Gl[5])+(Gl[6]+7>>3),Gl}(we),qe=Dt(Pe[7]<<9),We=0,wt=0;{for(We=0;We<8;++We)qe.write_shift(1,Be[We]);for(We=0;We<8;++We)qe.write_shift(2,0);for(qe.write_shift(2,62),qe.write_shift(2,3),qe.write_shift(2,65534),qe.write_shift(2,9),qe.write_shift(2,6),We=0;We<3;++We)qe.write_shift(2,0);for(qe.write_shift(4,0),qe.write_shift(4,Pe[2]),qe.write_shift(4,Pe[0]+Pe[1]+Pe[2]+Pe[3]-1),qe.write_shift(4,0),qe.write_shift(4,4096),qe.write_shift(4,Pe[3]?Pe[0]+Pe[1]+Pe[2]-1:re),qe.write_shift(4,Pe[3]),qe.write_shift(-4,Pe[1]?Pe[0]-1:re),qe.write_shift(4,Pe[1]),We=0;We<109;++We)qe.write_shift(-4,We<Pe[2]?Pe[1]+We:-1)}if(Pe[1])for(wt=0;wt<Pe[1];++wt){for(;We<236+wt*127;++We)qe.write_shift(-4,We<Pe[2]?Pe[1]+We:-1);qe.write_shift(-4,wt===Pe[1]-1?re:wt+1)}var Lt=function(xn){for(wt+=xn;We<wt-1;++We)qe.write_shift(-4,We+1);xn&&(++We,qe.write_shift(-4,re))};for(wt=We=0,wt+=Pe[1];We<wt;++We)qe.write_shift(-4,Ce.DIFSECT);for(wt+=Pe[2];We<wt;++We)qe.write_shift(-4,Ce.FATSECT);Lt(Pe[3]),Lt(Pe[4]);for(var xt=0,vt=0,Et=we.FileIndex[0];xt<we.FileIndex.length;++xt)Et=we.FileIndex[xt],Et.content&&(vt=Et.content.length,!(vt<4096)&&(Et.start=wt,Lt(vt+511>>9)));for(Lt(Pe[6]+7>>3);qe.l&511;)qe.write_shift(-4,Ce.ENDOFCHAIN);for(wt=We=0,xt=0;xt<we.FileIndex.length;++xt)Et=we.FileIndex[xt],Et.content&&(vt=Et.content.length,!(!vt||vt>=4096)&&(Et.start=wt,Lt(vt+63>>6)));for(;qe.l&511;)qe.write_shift(-4,Ce.ENDOFCHAIN);for(We=0;We<Pe[4]<<2;++We){var Zt=we.FullPaths[We];if(!Zt||Zt.length===0){for(xt=0;xt<17;++xt)qe.write_shift(4,0);for(xt=0;xt<3;++xt)qe.write_shift(4,-1);for(xt=0;xt<12;++xt)qe.write_shift(4,0);continue}Et=we.FileIndex[We],We===0&&(Et.start=Et.size?Et.start-1:re);var sn=We===0&&Me.root||Et.name;if(vt=2*(sn.length+1),qe.write_shift(64,sn,"utf16le"),qe.write_shift(2,vt),qe.write_shift(1,Et.type),qe.write_shift(1,Et.color),qe.write_shift(-4,Et.L),qe.write_shift(-4,Et.R),qe.write_shift(-4,Et.C),Et.clsid)qe.write_shift(16,Et.clsid,"hex");else for(xt=0;xt<4;++xt)qe.write_shift(4,0);qe.write_shift(4,Et.state||0),qe.write_shift(4,0),qe.write_shift(4,0),qe.write_shift(4,0),qe.write_shift(4,0),qe.write_shift(4,Et.start),qe.write_shift(4,Et.size),qe.write_shift(4,0)}for(We=1;We<we.FileIndex.length;++We)if(Et=we.FileIndex[We],Et.size>=4096)if(qe.l=Et.start+1<<9,Jn&&Buffer.isBuffer(Et.content))Et.content.copy(qe,qe.l,0,Et.size),qe.l+=Et.size+511&-512;else{for(xt=0;xt<Et.size;++xt)qe.write_shift(1,Et.content[xt]);for(;xt&511;++xt)qe.write_shift(1,0)}for(We=1;We<we.FileIndex.length;++We)if(Et=we.FileIndex[We],Et.size>0&&Et.size<4096)if(Jn&&Buffer.isBuffer(Et.content))Et.content.copy(qe,qe.l,0,Et.size),qe.l+=Et.size+63&-64;else{for(xt=0;xt<Et.size;++xt)qe.write_shift(1,Et.content[xt]);for(;xt&63;++xt)qe.write_shift(1,0)}if(Jn)qe.l=qe.length;else for(;qe.l<qe.length;)qe.write_shift(1,0);return qe}function H(we,Re){var Me=we.FullPaths.map(function(xt){return xt.toUpperCase()}),Pe=Me.map(function(xt){var vt=xt.split("/");return vt[vt.length-(xt.slice(-1)=="/"?2:1)]}),qe=!1;Re.charCodeAt(0)===47?(qe=!0,Re=Me[0].slice(0,-1)+Re):qe=Re.indexOf("/")!==-1;var We=Re.toUpperCase(),wt=qe===!0?Me.indexOf(We):Pe.indexOf(We);if(wt!==-1)return we.FileIndex[wt];var Lt=!We.match(pg);for(We=We.replace(hs,""),Lt&&(We=We.replace(pg,"!")),wt=0;wt<Me.length;++wt)if((Lt?Me[wt].replace(pg,"!"):Me[wt]).replace(hs,"")==We||(Lt?Pe[wt].replace(pg,"!"):Pe[wt]).replace(hs,"")==We)return we.FileIndex[wt];return null}var j=64,re=-2,Te="d0cf11e0a1b11ae1",Be=[208,207,17,224,161,177,26,225],Ie="00000000000000000000000000000000",Ce={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:re,FREESECT:-1,HEADER_SIGNATURE:Te,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:Ie,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function Je(we,Re,Me){c();var Pe=B(we,Me);l.writeFileSync(Re,Pe)}function ze(we){for(var Re=new Array(we.length),Me=0;Me<we.length;++Me)Re[Me]=String.fromCharCode(we[Me]);return Re.join("")}function Ze(we,Re){var Me=B(we,Re);switch(Re&&Re.type||"buffer"){case"file":return c(),l.writeFileSync(Re.filename,Me),Me;case"binary":return typeof Me=="string"?Me:ze(Me);case"base64":return ug(typeof Me=="string"?Me:ze(Me));case"buffer":if(Jn)return Buffer.isBuffer(Me)?Me:kl(Me);case"array":return typeof Me=="string"?Er(Me):Me}return Me}var ht;function De(we){try{var Re=we.InflateRaw,Me=new Re;if(Me._processChunk(new Uint8Array([3,0]),Me._finishFlushFlag),Me.bytesRead)ht=we;else throw new Error("zlib does not expose bytesRead")}catch(Pe){console.error("cannot use native zlib: "+(Pe.message||Pe))}}function tt(we,Re){if(!ht)return lI(we,Re);var Me=ht.InflateRaw,Pe=new Me,qe=Pe._processChunk(we.slice(we.l),Pe._finishFlushFlag);return we.l+=Pe.bytesRead,qe}function Ve(we){return ht?ht.deflateRawSync(we):ea(we)}var He=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],bt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],Kt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function Vt(we){var Re=(we<<1|we<<11)&139536|(we<<5|we<<15)&558144;return(Re>>16|Re>>8|Re)&255}for(var At=typeof Uint8Array!="undefined",Ct=At?new Uint8Array(256):[],Ln=0;Ln<256;++Ln)Ct[Ln]=Vt(Ln);function Oe(we,Re){var Me=Ct[we&255];return Re<=8?Me>>>8-Re:(Me=Me<<8|Ct[we>>8&255],Re<=16?Me>>>16-Re:(Me=Me<<8|Ct[we>>16&255],Me>>>24-Re))}function Xn(we,Re){var Me=Re&7,Pe=Re>>>3;return(we[Pe]|(Me<=6?0:we[Pe+1]<<8))>>>Me&3}function Rn(we,Re){var Me=Re&7,Pe=Re>>>3;return(we[Pe]|(Me<=5?0:we[Pe+1]<<8))>>>Me&7}function Da(we,Re){var Me=Re&7,Pe=Re>>>3;return(we[Pe]|(Me<=4?0:we[Pe+1]<<8))>>>Me&15}function sa(we,Re){var Me=Re&7,Pe=Re>>>3;return(we[Pe]|(Me<=3?0:we[Pe+1]<<8))>>>Me&31}function fn(we,Re){var Me=Re&7,Pe=Re>>>3;return(we[Pe]|(Me<=1?0:we[Pe+1]<<8))>>>Me&127}function yi(we,Re,Me){var Pe=Re&7,qe=Re>>>3,We=(1<<Me)-1,wt=we[qe]>>>Pe;return Me<8-Pe||(wt|=we[qe+1]<<8-Pe,Me<16-Pe)||(wt|=we[qe+2]<<16-Pe,Me<24-Pe)||(wt|=we[qe+3]<<24-Pe),wt&We}function no(we,Re,Me){var Pe=Re&7,qe=Re>>>3;return Pe<=5?we[qe]|=(Me&7)<<Pe:(we[qe]|=Me<<Pe&255,we[qe+1]=(Me&7)>>8-Pe),Re+3}function dl(we,Re,Me){var Pe=Re&7,qe=Re>>>3;return Me=(Me&1)<<Pe,we[qe]|=Me,Re+1}function zl(we,Re,Me){var Pe=Re&7,qe=Re>>>3;return Me<<=Pe,we[qe]|=Me&255,Me>>>=8,we[qe+1]=Me,Re+8}function Zb(we,Re,Me){var Pe=Re&7,qe=Re>>>3;return Me<<=Pe,we[qe]|=Me&255,Me>>>=8,we[qe+1]=Me&255,we[qe+2]=Me>>>8,Re+16}function rd(we,Re){var Me=we.length,Pe=2*Me>Re?2*Me:Re+5,qe=0;if(Me>=Re)return we;if(Jn){var We=$T(Pe);if(we.copy)we.copy(We);else for(;qe<we.length;++qe)We[qe]=we[qe];return We}else if(At){var wt=new Uint8Array(Pe);if(wt.set)wt.set(we);else for(;qe<Me;++qe)wt[qe]=we[qe];return wt}return we.length=Pe,we}function Mr(we){for(var Re=new Array(we),Me=0;Me<we;++Me)Re[Me]=0;return Re}function Yl(we,Re,Me){var Pe=1,qe=0,We=0,wt=0,Lt=0,xt=we.length,vt=At?new Uint16Array(32):Mr(32);for(We=0;We<32;++We)vt[We]=0;for(We=xt;We<Me;++We)we[We]=0;xt=we.length;var Et=At?new Uint16Array(xt):Mr(xt);for(We=0;We<xt;++We)vt[qe=we[We]]++,Pe<qe&&(Pe=qe),Et[We]=0;for(vt[0]=0,We=1;We<=Pe;++We)vt[We+16]=Lt=Lt+vt[We-1]<<1;for(We=0;We<xt;++We)Lt=we[We],Lt!=0&&(Et[We]=vt[Lt+16]++);var Zt=0;for(We=0;We<xt;++We)if(Zt=we[We],Zt!=0)for(Lt=Oe(Et[We],Pe)>>Pe-Zt,wt=(1<<Pe+4-Zt)-1;wt>=0;--wt)Re[Lt|wt<<Zt]=Zt&15|We<<4;return Pe}var od=At?new Uint16Array(512):Mr(512),Jb=At?new Uint16Array(32):Mr(32);if(!At){for(var zs=0;zs<512;++zs)od[zs]=0;for(zs=0;zs<32;++zs)Jb[zs]=0}(function(){for(var we=[],Re=0;Re<32;Re++)we.push(5);Yl(we,Jb,32);var Me=[];for(Re=0;Re<=143;Re++)Me.push(8);for(;Re<=255;Re++)Me.push(9);for(;Re<=279;Re++)Me.push(7);for(;Re<=287;Re++)Me.push(8);Yl(Me,od,288)})();var ul=function(){for(var Re=At?new Uint8Array(32768):[],Me=0,Pe=0;Me<Kt.length-1;++Me)for(;Pe<Kt[Me+1];++Pe)Re[Pe]=Me;for(;Pe<32768;++Pe)Re[Pe]=29;var qe=At?new Uint8Array(259):[];for(Me=0,Pe=0;Me<bt.length-1;++Me)for(;Pe<bt[Me+1];++Pe)qe[Pe]=Me;function We(Lt,xt){for(var vt=0;vt<Lt.length;){var Et=Math.min(65535,Lt.length-vt),Zt=vt+Et==Lt.length;for(xt.write_shift(1,+Zt),xt.write_shift(2,Et),xt.write_shift(2,~Et&65535);Et-- >0;)xt[xt.l++]=Lt[vt++]}return xt.l}function wt(Lt,xt){for(var vt=0,Et=0,Zt=At?new Uint16Array(32768):[];Et<Lt.length;){var sn=Math.min(65535,Lt.length-Et);if(sn<10){for(vt=no(xt,vt,+(Et+sn==Lt.length)),vt&7&&(vt+=8-(vt&7)),xt.l=vt/8|0,xt.write_shift(2,sn),xt.write_shift(2,~sn&65535);sn-- >0;)xt[xt.l++]=Lt[Et++];vt=xt.l*8;continue}vt=no(xt,vt,+(Et+sn==Lt.length)+2);for(var xn=0;sn-- >0;){var rn=Lt[Et];xn=(xn<<5^rn)&32767;var ln=-1,qn=0;if((ln=Zt[xn])&&(ln|=Et&-32768,ln>Et&&(ln-=32768),ln<Et))for(;Lt[ln+qn]==Lt[Et+qn]&&qn<250;)++qn;if(qn>2){rn=qe[qn],rn<=22?vt=zl(xt,vt,Ct[rn+1]>>1)-1:(zl(xt,vt,3),vt+=5,zl(xt,vt,Ct[rn-23]>>5),vt+=3);var ja=rn<8?0:rn-4>>2;ja>0&&(Zb(xt,vt,qn-bt[rn]),vt+=ja),rn=Re[Et-ln],vt=zl(xt,vt,Ct[rn]>>3),vt-=3;var lr=rn<4?0:rn-2>>1;lr>0&&(Zb(xt,vt,Et-ln-Kt[rn]),vt+=lr);for(var Bi=0;Bi<qn;++Bi)Zt[xn]=Et&32767,xn=(xn<<5^Lt[Et])&32767,++Et;sn-=qn-1}else rn<=143?rn=rn+48:vt=dl(xt,vt,1),vt=zl(xt,vt,Ct[rn]),Zt[xn]=Et&32767,++Et}vt=zl(xt,vt,0)-1}return xt.l=(vt+7)/8|0,xt.l}return function(xt,vt){return xt.length<8?We(xt,vt):wt(xt,vt)}}();function ea(we){var Re=Dt(50+Math.floor(we.length*1.1)),Me=ul(we,Re);return Re.slice(0,Me)}var _i=At?new Uint16Array(32768):Mr(32768),ao=At?new Uint16Array(32768):Mr(32768),Hi=At?new Uint16Array(128):Mr(128),ef=1,oI=1;function tz(we,Re){var Me=sa(we,Re)+257;Re+=5;var Pe=sa(we,Re)+1;Re+=5;var qe=Da(we,Re)+4;Re+=4;for(var We=0,wt=At?new Uint8Array(19):Mr(19),Lt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],xt=1,vt=At?new Uint8Array(8):Mr(8),Et=At?new Uint8Array(8):Mr(8),Zt=wt.length,sn=0;sn<qe;++sn)wt[He[sn]]=We=Rn(we,Re),xt<We&&(xt=We),vt[We]++,Re+=3;var xn=0;for(vt[0]=0,sn=1;sn<=xt;++sn)Et[sn]=xn=xn+vt[sn-1]<<1;for(sn=0;sn<Zt;++sn)(xn=wt[sn])!=0&&(Lt[sn]=Et[xn]++);var rn=0;for(sn=0;sn<Zt;++sn)if(rn=wt[sn],rn!=0){xn=Ct[Lt[sn]]>>8-rn;for(var ln=(1<<7-rn)-1;ln>=0;--ln)Hi[xn|ln<<rn]=rn&7|sn<<3}var qn=[];for(xt=1;qn.length<Me+Pe;)switch(xn=Hi[fn(we,Re)],Re+=xn&7,xn>>>=3){case 16:for(We=3+Xn(we,Re),Re+=2,xn=qn[qn.length-1];We-- >0;)qn.push(xn);break;case 17:for(We=3+Rn(we,Re),Re+=3;We-- >0;)qn.push(0);break;case 18:for(We=11+fn(we,Re),Re+=7;We-- >0;)qn.push(0);break;default:qn.push(xn),xt<xn&&(xt=xn);break}var ja=qn.slice(0,Me),lr=qn.slice(Me);for(sn=Me;sn<286;++sn)ja[sn]=0;for(sn=Pe;sn<30;++sn)lr[sn]=0;return ef=Yl(ja,_i,286),oI=Yl(lr,ao,30),Re}function nz(we,Re){if(we[0]==3&&!(we[1]&3))return[pc(Re),2];for(var Me=0,Pe=0,qe=$T(Re||1<<18),We=0,wt=qe.length>>>0,Lt=0,xt=0;!(Pe&1);){if(Pe=Rn(we,Me),Me+=3,Pe>>>1)Pe>>1==1?(Lt=9,xt=5):(Me=tz(we,Me),Lt=ef,xt=oI);else{Me&7&&(Me+=8-(Me&7));var vt=we[Me>>>3]|we[(Me>>>3)+1]<<8;if(Me+=32,vt>0)for(!Re&&wt<We+vt&&(qe=rd(qe,We+vt),wt=qe.length);vt-- >0;)qe[We++]=we[Me>>>3],Me+=8;continue}for(;;){!Re&&wt<We+32767&&(qe=rd(qe,We+32767),wt=qe.length);var Et=yi(we,Me,Lt),Zt=Pe>>>1==1?od[Et]:_i[Et];if(Me+=Zt&15,Zt>>>=4,!(Zt>>>8&255))qe[We++]=Zt;else{if(Zt==256)break;Zt-=257;var sn=Zt<8?0:Zt-4>>2;sn>5&&(sn=0);var xn=We+bt[Zt];sn>0&&(xn+=yi(we,Me,sn),Me+=sn),Et=yi(we,Me,xt),Zt=Pe>>>1==1?Jb[Et]:ao[Et],Me+=Zt&15,Zt>>>=4;var rn=Zt<4?0:Zt-2>>1,ln=Kt[Zt];for(rn>0&&(ln+=yi(we,Me,rn),Me+=rn),!Re&&wt<xn&&(qe=rd(qe,xn+100),wt=qe.length);We<xn;)qe[We]=qe[We-ln],++We}}}return Re?[qe,Me+7>>>3]:[qe.slice(0,We),Me+7>>>3]}function lI(we,Re){var Me=we.slice(we.l||0),Pe=nz(Me,Re);return we.l+=Pe[1],Pe[0]}function cI(we,Re){if(we)typeof console!="undefined"&&console.error(Re);else throw new Error(Re)}function dI(we,Re){var Me=we;as(Me,0);var Pe=[],qe=[],We={FileIndex:Pe,FullPaths:qe};k(We,{root:Re.root});for(var wt=Me.length-4;(Me[wt]!=80||Me[wt+1]!=75||Me[wt+2]!=5||Me[wt+3]!=6)&&wt>=0;)--wt;Me.l=wt+4,Me.l+=4;var Lt=Me.read_shift(2);Me.l+=6;var xt=Me.read_shift(4);for(Me.l=xt,wt=0;wt<Lt;++wt){Me.l+=20;var vt=Me.read_shift(4),Et=Me.read_shift(4),Zt=Me.read_shift(2),sn=Me.read_shift(2),xn=Me.read_shift(2);Me.l+=8;var rn=Me.read_shift(4),ln=o(Me.slice(Me.l+Zt,Me.l+Zt+sn));Me.l+=Zt+sn+xn;var qn=Me.l;Me.l=rn+4,az(Me,vt,Et,We,ln),Me.l=qn}return We}function az(we,Re,Me,Pe,qe){we.l+=2;var We=we.read_shift(2),wt=we.read_shift(2),Lt=r(we);if(We&8257)throw new Error("Unsupported ZIP encryption");for(var xt=we.read_shift(4),vt=we.read_shift(4),Et=we.read_shift(4),Zt=we.read_shift(2),sn=we.read_shift(2),xn="",rn=0;rn<Zt;++rn)xn+=String.fromCharCode(we[we.l++]);if(sn){var ln=o(we.slice(we.l,we.l+sn));(ln[21589]||{}).mt&&(Lt=ln[21589].mt),((qe||{})[21589]||{}).mt&&(Lt=qe[21589].mt)}we.l+=sn;var qn=we.slice(we.l,we.l+vt);switch(wt){case 8:qn=tt(we,Et);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+wt)}var ja=!1;We&8&&(xt=we.read_shift(4),xt==134695760&&(xt=we.read_shift(4),ja=!0),vt=we.read_shift(4),Et=we.read_shift(4)),vt!=Re&&cI(ja,"Bad compressed size: "+Re+" != "+vt),Et!=Me&&cI(ja,"Bad uncompressed size: "+Me+" != "+Et),ok(Pe,xn,qn,{unsafe:!0,mt:Lt})}function iz(we,Re){var Me=Re||{},Pe=[],qe=[],We=Dt(1),wt=Me.compression?8:0,Lt=0,xt=!1;xt&&(Lt|=8);var vt=0,Et=0,Zt=0,sn=0,xn=we.FullPaths[0],rn=xn,ln=we.FileIndex[0],qn=[],ja=0;for(vt=1;vt<we.FullPaths.length;++vt)if(rn=we.FullPaths[vt].slice(xn.length),ln=we.FileIndex[vt],!(!ln.size||!ln.content||rn=="Sh33tJ5")){var lr=Zt,Bi=Dt(rn.length);for(Et=0;Et<rn.length;++Et)Bi.write_shift(1,rn.charCodeAt(Et)&127);Bi=Bi.slice(0,Bi.l),qn[sn]=U6.buf(ln.content,0);var Fr=ln.content;wt==8&&(Fr=Ve(Fr)),We=Dt(30),We.write_shift(4,67324752),We.write_shift(2,20),We.write_shift(2,Lt),We.write_shift(2,wt),ln.mt?s(We,ln.mt):We.write_shift(4,0),We.write_shift(-4,Lt&8?0:qn[sn]),We.write_shift(4,Lt&8?0:Fr.length),We.write_shift(4,Lt&8?0:ln.content.length),We.write_shift(2,Bi.length),We.write_shift(2,0),Zt+=We.length,Pe.push(We),Zt+=Bi.length,Pe.push(Bi),Zt+=Fr.length,Pe.push(Fr),Lt&8&&(We=Dt(12),We.write_shift(-4,qn[sn]),We.write_shift(4,Fr.length),We.write_shift(4,ln.content.length),Zt+=We.l,Pe.push(We)),We=Dt(46),We.write_shift(4,33639248),We.write_shift(2,0),We.write_shift(2,20),We.write_shift(2,Lt),We.write_shift(2,wt),We.write_shift(4,0),We.write_shift(-4,qn[sn]),We.write_shift(4,Fr.length),We.write_shift(4,ln.content.length),We.write_shift(2,Bi.length),We.write_shift(2,0),We.write_shift(2,0),We.write_shift(2,0),We.write_shift(2,0),We.write_shift(4,0),We.write_shift(4,lr),ja+=We.l,qe.push(We),ja+=Bi.length,qe.push(Bi),++sn}return We=Dt(22),We.write_shift(4,101010256),We.write_shift(2,0),We.write_shift(2,0),We.write_shift(2,sn),We.write_shift(2,sn),We.write_shift(4,ja),We.write_shift(4,Zt),We.write_shift(2,0),Yi([Yi(Pe),Yi(qe),We])}var j0={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function sz(we,Re){if(we.ctype)return we.ctype;var Me=we.name||"",Pe=Me.match(/\.([^\.]+)$/);return Pe&&j0[Pe[1]]||Re&&(Pe=(Me=Re).match(/[\.\\]([^\.\\])+$/),Pe&&j0[Pe[1]])?j0[Pe[1]]:"application/octet-stream"}function rz(we){for(var Re=ug(we),Me=[],Pe=0;Pe<Re.length;Pe+=76)Me.push(Re.slice(Pe,Pe+76));return Me.join(`\r
`)+`\r
`}function oz(we){var Re=we.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(vt){var Et=vt.charCodeAt(0).toString(16).toUpperCase();return"="+(Et.length==1?"0"+Et:Et)});Re=Re.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),Re.charAt(0)==`
`&&(Re="=0D"+Re.slice(1)),Re=Re.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var Me=[],Pe=Re.split(`\r
`),qe=0;qe<Pe.length;++qe){var We=Pe[qe];if(We.length==0){Me.push("");continue}for(var wt=0;wt<We.length;){var Lt=76,xt=We.slice(wt,wt+Lt);xt.charAt(Lt-1)=="="?Lt--:xt.charAt(Lt-2)=="="?Lt-=2:xt.charAt(Lt-3)=="="&&(Lt-=3),xt=We.slice(wt,wt+Lt),wt+=Lt,wt<We.length&&(xt+="="),Me.push(xt)}}return Me.join(`\r
`)}function lz(we){for(var Re=[],Me=0;Me<we.length;++Me){for(var Pe=we[Me];Me<=we.length&&Pe.charAt(Pe.length-1)=="=";)Pe=Pe.slice(0,Pe.length-1)+we[++Me];Re.push(Pe)}for(var qe=0;qe<Re.length;++qe)Re[qe]=Re[qe].replace(/[=][0-9A-Fa-f]{2}/g,function(We){return String.fromCharCode(parseInt(We.slice(1),16))});return Er(Re.join(`\r
`))}function cz(we,Re,Me){for(var Pe="",qe="",We="",wt,Lt=0;Lt<10;++Lt){var xt=Re[Lt];if(!xt||xt.match(/^\s*$/))break;var vt=xt.match(/^(.*?):\s*([^\s].*)$/);if(vt)switch(vt[1].toLowerCase()){case"content-location":Pe=vt[2].trim();break;case"content-type":We=vt[2].trim();break;case"content-transfer-encoding":qe=vt[2].trim();break}}switch(++Lt,qe.toLowerCase()){case"base64":wt=Er(xr(Re.slice(Lt).join("")));break;case"quoted-printable":wt=lz(Re.slice(Lt));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+qe)}var Et=ok(we,Pe.slice(Me.length),wt,{unsafe:!0});We&&(Et.ctype=We)}function dz(we,Re){if(ze(we.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var Me=Re&&Re.root||"",Pe=(Jn&&Buffer.isBuffer(we)?we.toString("binary"):ze(we)).split(`\r
`),qe=0,We="";for(qe=0;qe<Pe.length;++qe)if(We=Pe[qe],!!/^Content-Location:/i.test(We)&&(We=We.slice(We.indexOf("file")),Me||(Me=We.slice(0,We.lastIndexOf("/")+1)),We.slice(0,Me.length)!=Me))for(;Me.length>0&&(Me=Me.slice(0,Me.length-1),Me=Me.slice(0,Me.lastIndexOf("/")+1),We.slice(0,Me.length)!=Me););var wt=(Pe[1]||"").match(/boundary="(.*?)"/);if(!wt)throw new Error("MAD cannot find boundary");var Lt="--"+(wt[1]||""),xt=[],vt=[],Et={FileIndex:xt,FullPaths:vt};k(Et);var Zt,sn=0;for(qe=0;qe<Pe.length;++qe){var xn=Pe[qe];xn!==Lt&&xn!==Lt+"--"||(sn++&&cz(Et,Pe.slice(Zt,qe),Me),Zt=qe)}return Et}function uz(we,Re){var Me=Re||{},Pe=Me.boundary||"SheetJS";Pe="------="+Pe;for(var qe=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+Pe.slice(2)+'"',"","",""],We=we.FullPaths[0],wt=We,Lt=we.FileIndex[0],xt=1;xt<we.FullPaths.length;++xt)if(wt=we.FullPaths[xt].slice(We.length),Lt=we.FileIndex[xt],!(!Lt.size||!Lt.content||wt=="Sh33tJ5")){wt=wt.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(qn){return"_x"+qn.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(qn){return"_u"+qn.charCodeAt(0).toString(16)+"_"});for(var vt=Lt.content,Et=Jn&&Buffer.isBuffer(vt)?vt.toString("binary"):ze(vt),Zt=0,sn=Math.min(1024,Et.length),xn=0,rn=0;rn<=sn;++rn)(xn=Et.charCodeAt(rn))>=32&&xn<128&&++Zt;var ln=Zt>=sn*4/5;qe.push(Pe),qe.push("Content-Location: "+(Me.root||"file:///C:/SheetJS/")+wt),qe.push("Content-Transfer-Encoding: "+(ln?"quoted-printable":"base64")),qe.push("Content-Type: "+sz(Lt,wt)),qe.push(""),qe.push(ln?oz(Et):rz(Et))}return qe.push(Pe+`--\r
`),qe.join(`\r
`)}function fz(we){var Re={};return k(Re,we),Re}function ok(we,Re,Me,Pe){var qe=Pe&&Pe.unsafe;qe||k(we);var We=!qe&&An.find(we,Re);if(!We){var wt=we.FullPaths[0];Re.slice(0,wt.length)==wt?wt=Re:(wt.slice(-1)!="/"&&(wt+="/"),wt=(wt+Re).replace("//","/")),We={name:i(Re),type:2},we.FileIndex.push(We),we.FullPaths.push(wt),qe||An.utils.cfb_gc(we)}return We.content=Me,We.size=Me?Me.length:0,Pe&&(Pe.CLSID&&(We.clsid=Pe.CLSID),Pe.mt&&(We.mt=Pe.mt),Pe.ct&&(We.ct=Pe.ct)),We}function pz(we,Re){k(we);var Me=An.find(we,Re);if(Me){for(var Pe=0;Pe<we.FileIndex.length;++Pe)if(we.FileIndex[Pe]==Me)return we.FileIndex.splice(Pe,1),we.FullPaths.splice(Pe,1),!0}return!1}function hz(we,Re,Me){k(we);var Pe=An.find(we,Re);if(Pe){for(var qe=0;qe<we.FileIndex.length;++qe)if(we.FileIndex[qe]==Pe)return we.FileIndex[qe].name=i(Me),we.FullPaths[qe]=Me,!0}return!1}function gz(we){S(we,!0)}return e.find=H,e.read=Z,e.parse=d,e.write=Ze,e.writeFile=Je,e.utils={cfb_new:fz,cfb_add:ok,cfb_del:pz,cfb_mov:hz,cfb_gc:gz,ReadShift:wg,CheckField:B3,prep_blob:as,bconcat:Yi,use_zlib:De,_deflateRaw:ea,_inflateRaw:lI,consts:Ce},e}();let bc;function Oz(t){bc=t}function H6(t){return typeof t=="string"?fg(t):Array.isArray(t)?f6(t):t}function mg(t,e,n){if(typeof bc!="undefined"&&bc.writeFileSync)return n?bc.writeFileSync(t,e,n):bc.writeFileSync(t,e);if(typeof Deno!="undefined"){if(n&&typeof e=="string")switch(n){case"utf8":e=new TextEncoder(n).encode(e);break;case"binary":e=fg(e);break;default:throw new Error("Unsupported encoding "+n)}return Deno.writeFileSync(t,e)}var a=n=="utf8"?Ko(e):e;if(typeof IE_SaveFile!="undefined")return IE_SaveFile(a,t);if(typeof Blob!="undefined"){var i=new Blob([H6(a)],{type:"application/octet-stream"});if(typeof navigator!="undefined"&&navigator.msSaveBlob)return navigator.msSaveBlob(i,t);if(typeof saveAs!="undefined")return saveAs(i,t);if(typeof URL!="undefined"&&typeof document!="undefined"&&document.createElement&&URL.createObjectURL){var s=URL.createObjectURL(i);if(typeof chrome=="object"&&typeof(chrome.downloads||{}).download=="function")return URL.revokeObjectURL&&typeof setTimeout!="undefined"&&setTimeout(function(){URL.revokeObjectURL(s)},6e4),chrome.downloads.download({url:s,filename:t,saveAs:!0});var r=document.createElement("a");if(r.download!=null)return r.download=t,r.href=s,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL&&typeof setTimeout!="undefined"&&setTimeout(function(){URL.revokeObjectURL(s)},6e4),s}}if(typeof $!="undefined"&&typeof File!="undefined"&&typeof Folder!="undefined")try{var o=File(t);return o.open("w"),o.encoding="binary",Array.isArray(e)&&(e=hc(e)),o.write(e),o.close(),e}catch(l){if(!l.message||!l.message.match(/onstruct/))throw l}throw new Error("cannot save file "+t)}function q6(t){if(typeof bc!="undefined")return bc.readFileSync(t);if(typeof Deno!="undefined")return Deno.readFileSync(t);if(typeof $!="undefined"&&typeof File!="undefined"&&typeof Folder!="undefined")try{var e=File(t);e.open("r"),e.encoding="binary";var n=e.read();return e.close(),n}catch(a){if(!a.message||!a.message.match(/onstruct/))throw a}throw new Error("Cannot access file "+t)}function oi(t){for(var e=Object.keys(t),n=[],a=0;a<e.length;++a)Object.prototype.hasOwnProperty.call(t,e[a])&&n.push(e[a]);return n}function n3(t,e){for(var n=[],a=oi(t),i=0;i!==a.length;++i)n[t[a[i]][e]]==null&&(n[t[a[i]][e]]=a[i]);return n}function P_(t){for(var e=[],n=oi(t),a=0;a!==n.length;++a)e[t[n[a]]]=n[a];return e}function N_(t){for(var e=[],n=oi(t),a=0;a!==n.length;++a)e[t[n[a]]]=parseInt(n[a],10);return e}function W6(t){for(var e=[],n=oi(t),a=0;a!==n.length;++a)e[t[n[a]]]==null&&(e[t[n[a]]]=[]),e[t[n[a]]].push(n[a]);return e}var B_=new Date(1899,11,30,0,0,0);function Ri(t,e){var n=t.getTime();e&&(n-=1462*24*60*60*1e3);var a=B_.getTime()+(t.getTimezoneOffset()-B_.getTimezoneOffset())*6e4;return(n-a)/(24*60*60*1e3)}var a3=new Date,V6=B_.getTime()+(a3.getTimezoneOffset()-B_.getTimezoneOffset())*6e4,i3=a3.getTimezoneOffset();function $_(t){var e=new Date;return e.setTime(t*24*60*60*1e3+V6),e.getTimezoneOffset()!==i3&&e.setTime(e.getTime()+(e.getTimezoneOffset()-i3)*6e4),e}function z6(t){var e=0,n=0,a=!1,i=t.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!i)throw new Error("|"+t+"| is not an ISO8601 Duration");for(var s=1;s!=i.length;++s)if(i[s]){switch(n=1,s>3&&(a=!0),i[s].slice(i[s].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+i[s].slice(i[s].length-1));case"D":n*=24;case"H":n*=60;case"M":if(a)n*=60;else throw new Error("Unsupported ISO Duration Field: M");case"S":break}e+=n*parseInt(i[s],10)}return e}var s3=new Date("2017-02-19T19:06:09.000Z"),r3=isNaN(s3.getFullYear())?new Date("2/19/17"):s3,Y6=r3.getFullYear()==2017;function ei(t,e){var n=new Date(t);if(Y6)return e>0?n.setTime(n.getTime()+n.getTimezoneOffset()*60*1e3):e<0&&n.setTime(n.getTime()-n.getTimezoneOffset()*60*1e3),n;if(t instanceof Date)return t;if(r3.getFullYear()==1917&&!isNaN(n.getFullYear())){var a=n.getFullYear();return t.indexOf(""+a)>-1||n.setFullYear(n.getFullYear()+100),n}var i=t.match(/\d+/g)||["2017","2","19","0","0","0"],s=new Date(+i[0],+i[1]-1,+i[2],+i[3]||0,+i[4]||0,+i[5]||0);return t.indexOf("Z")>-1&&(s=new Date(s.getTime()-s.getTimezoneOffset()*60*1e3)),s}function Gd(t,e){if(Jn&&Buffer.isBuffer(t)){if(e){if(t[0]==255&&t[1]==254)return Ko(t.slice(2).toString("utf16le"));if(t[1]==254&&t[2]==255)return Ko(BT(t.slice(2).toString("binary")))}return t.toString("binary")}if(typeof TextDecoder!="undefined")try{if(e){if(t[0]==255&&t[1]==254)return Ko(new TextDecoder("utf-16le").decode(t.slice(2)));if(t[0]==254&&t[1]==255)return Ko(new TextDecoder("utf-16be").decode(t.slice(2)))}var n={"\u20AC":"\x80","\u201A":"\x82",\u0192:"\x83","\u201E":"\x84","\u2026":"\x85","\u2020":"\x86","\u2021":"\x87","\u02C6":"\x88","\u2030":"\x89",\u0160:"\x8A","\u2039":"\x8B",\u0152:"\x8C",\u017D:"\x8E","\u2018":"\x91","\u2019":"\x92","\u201C":"\x93","\u201D":"\x94","\u2022":"\x95","\u2013":"\x96","\u2014":"\x97","\u02DC":"\x98","\u2122":"\x99",\u0161:"\x9A","\u203A":"\x9B",\u0153:"\x9C",\u017E:"\x9E",\u0178:"\x9F"};return Array.isArray(t)&&(t=new Uint8Array(t)),new TextDecoder("latin1").decode(t).replace(/[]/g,function(s){return n[s]||s})}catch(s){}for(var a=[],i=0;i!=t.length;++i)a.push(String.fromCharCode(t[i]));return a.join("")}function Ba(t){if(typeof JSON!="undefined"&&!Array.isArray(t))return JSON.parse(JSON.stringify(t));if(typeof t!="object"||t==null)return t;if(t instanceof Date)return new Date(t.getTime());var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=Ba(t[n]));return e}function li(t,e){for(var n="";n.length<e;)n+=t;return n}function vo(t){var e=Number(t);if(!isNaN(e))return isFinite(e)?e:NaN;if(!/\d/.test(t))return e;var n=1,a=t.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return n*=100,""});return!isNaN(e=Number(a))||(a=a.replace(/[(](.*)[)]/,function(i,s){return n=-n,s}),!isNaN(e=Number(a)))?e/n:e}var G6=["january","february","march","april","may","june","july","august","september","october","november","december"];function Gf(t){var e=new Date(t),n=new Date(NaN),a=e.getYear(),i=e.getMonth(),s=e.getDate();if(isNaN(s))return n;var r=t.toLowerCase();if(r.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(r=r.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),r.length>3&&G6.indexOf(r)==-1)return n}else if(r.match(/[a-z]/))return n;return a<0||a>8099?n:(i>0||s>1)&&a!=101?e:t.match(/[^-0-9:,\/\\]/)?n:e}var j6=function(){var t="abacaba".split(/(:?b)/i).length==5;return function(n,a,i){if(t||typeof a=="string")return n.split(a);for(var s=n.split(a),r=[s[0]],o=1;o<s.length;++o)r.push(i),r.push(s[o]);return r}}();function o3(t){return t?t.content&&t.type?Gd(t.content,!0):t.data?Wf(t.data):t.asNodeBuffer&&Jn?Wf(t.asNodeBuffer().toString("binary")):t.asBinary?Wf(t.asBinary()):t._data&&t._data.getContent?Wf(Gd(Array.prototype.slice.call(t._data.getContent(),0))):null:null}function l3(t){if(!t)return null;if(t.data)return L_(t.data);if(t.asNodeBuffer&&Jn)return t.asNodeBuffer();if(t._data&&t._data.getContent){var e=t._data.getContent();return typeof e=="string"?L_(e):Array.prototype.slice.call(e)}return t.content&&t.type?t.content:null}function K6(t){return t&&t.name.slice(-4)===".bin"?l3(t):o3(t)}function Ur(t,e){for(var n=t.FullPaths||oi(t.files),a=e.toLowerCase().replace(/[\/]/g,"\\"),i=a.replace(/\\/g,"/"),s=0;s<n.length;++s){var r=n[s].replace(/^Root Entry[\/]/,"").toLowerCase();if(a==r||i==r)return t.files?t.files[n[s]]:t.FileIndex[s]}return null}function d1(t,e){var n=Ur(t,e);if(n==null)throw new Error("Cannot find file "+e+" in zip");return n}function Ti(t,e,n){if(!n)return K6(d1(t,e));if(!e)return null;try{return Ti(t,e)}catch(a){return null}}function Sr(t,e,n){if(!n)return o3(d1(t,e));if(!e)return null;try{return Sr(t,e)}catch(a){return null}}function c3(t,e,n){if(!n)return l3(d1(t,e));if(!e)return null;try{return c3(t,e)}catch(a){return null}}function d3(t){for(var e=t.FullPaths||oi(t.files),n=[],a=0;a<e.length;++a)e[a].slice(-1)!="/"&&n.push(e[a].replace(/^Root Entry[\/]/,""));return n.sort()}function jn(t,e,n){if(t.FullPaths){if(typeof n=="string"){var a;return Jn?a=kl(n):a=p6(n),An.utils.cfb_add(t,e,a)}An.utils.cfb_add(t,e,n)}else t.file(e,n)}function u1(){return An.utils.cfb_new()}function u3(t,e){switch(e.type){case"base64":return An.read(t,{type:"base64"});case"binary":return An.read(t,{type:"binary"});case"buffer":case"array":return An.read(t,{type:"buffer"})}throw new Error("Unrecognized type "+e.type)}function bg(t,e){if(t.charAt(0)=="/")return t.slice(1);var n=e.split("/");e.slice(-1)!="/"&&n.pop();for(var a=t.split("/");a.length!==0;){var i=a.shift();i===".."?n.pop():i!=="."&&n.push(i)}return n.join("/")}var Di=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,X6=/([^"\s?>\/]+)\s*=\s*((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g,f3=/<[\/\?]?[a-zA-Z0-9:_-]+(?:\s+[^"\s?>\/]+\s*=\s*(?:"[^"]*"|'[^']*'|[^'">\s=]+))*\s*[\/\?]?>/mg,Z6=/<[^>]*>/g,gs=Di.match(f3)?f3:Z6,J6=/<\w*:/,Q6=/<(\/?)\w+:/;function Pn(t,e,n){for(var a={},i=0,s=0;i!==t.length&&!((s=t.charCodeAt(i))===32||s===10||s===13);++i);if(e||(a[0]=t.slice(0,i)),i===t.length)return a;var r=t.match(X6),o=0,l="",c=0,d="",u="",g=1;if(r)for(c=0;c!=r.length;++c){for(u=r[c],s=0;s!=u.length&&u.charCodeAt(s)!==61;++s);for(d=u.slice(0,s).trim();u.charCodeAt(s+1)==32;)++s;for(g=(i=u.charCodeAt(s+1))==34||i==39?1:0,l=u.slice(s+1+g,u.length-g),o=0;o!=d.length&&d.charCodeAt(o)!==58;++o);if(o===d.length)d.indexOf("_")>0&&(d=d.slice(0,d.indexOf("_"))),a[d]=l,n||(a[d.toLowerCase()]=l);else{var f=(o===5&&d.slice(0,5)==="xmlns"?"xmlns":"")+d.slice(o+1);if(a[f]&&d.slice(o-3,o)=="ext")continue;a[f]=l,n||(a[f.toLowerCase()]=l)}}return a}function jo(t){return t.replace(Q6,"<$1")}var p3={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},f1=P_(p3),ga=function(){var t=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/ig,e=/_x([\da-fA-F]{4})_/ig;return function n(a){var i=a+"",s=i.indexOf("<![CDATA[");if(s==-1)return i.replace(t,function(o,l){return p3[o]||String.fromCharCode(parseInt(l,o.indexOf("x")>-1?16:10))||o}).replace(e,function(o,l){return String.fromCharCode(parseInt(l,16))});var r=i.indexOf("]]>");return n(i.slice(0,s))+i.slice(s+9,r)+n(i.slice(r+3))}}(),p1=/[&<>'"]/g,e8=/[\u0000-\u0008\u000b-\u001f]/g;function Ha(t){var e=t+"";return e.replace(p1,function(n){return f1[n]}).replace(e8,function(n){return"_x"+("000"+n.charCodeAt(0).toString(16)).slice(-4)+"_"})}function h3(t){return Ha(t).replace(/ /g,"_x0020_")}var g3=/[\u0000-\u001f]/g;function h1(t){var e=t+"";return e.replace(p1,function(n){return f1[n]}).replace(/\n/g,"<br/>").replace(g3,function(n){return"&#x"+("000"+n.charCodeAt(0).toString(16)).slice(-4)+";"})}function t8(t){var e=t+"";return e.replace(p1,function(n){return f1[n]}).replace(g3,function(n){return"&#x"+n.charCodeAt(0).toString(16).toUpperCase()+";"})}var m3=function(){var t=/&#(\d+);/g;function e(n,a){return String.fromCharCode(parseInt(a,10))}return function(a){return a.replace(t,e)}}();function n8(t){return t.replace(/(\r\n|[\r\n])/g,"&#10;")}function Ya(t){switch(t){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function g1(t){for(var e="",n=0,a=0,i=0,s=0,r=0,o=0;n<t.length;){if(a=t.charCodeAt(n++),a<128){e+=String.fromCharCode(a);continue}if(i=t.charCodeAt(n++),a>191&&a<224){r=(a&31)<<6,r|=i&63,e+=String.fromCharCode(r);continue}if(s=t.charCodeAt(n++),a<240){e+=String.fromCharCode((a&15)<<12|(i&63)<<6|s&63);continue}r=t.charCodeAt(n++),o=((a&7)<<18|(i&63)<<12|(s&63)<<6|r&63)-65536,e+=String.fromCharCode(55296+(o>>>10&1023)),e+=String.fromCharCode(56320+(o&1023))}return e}function b3(t){var e=pc(2*t.length),n,a,i=1,s=0,r=0,o;for(a=0;a<t.length;a+=i)i=1,(o=t.charCodeAt(a))<128?n=o:o<224?(n=(o&31)*64+(t.charCodeAt(a+1)&63),i=2):o<240?(n=(o&15)*4096+(t.charCodeAt(a+1)&63)*64+(t.charCodeAt(a+2)&63),i=3):(i=4,n=(o&7)*262144+(t.charCodeAt(a+1)&63)*4096+(t.charCodeAt(a+2)&63)*64+(t.charCodeAt(a+3)&63),n-=65536,r=55296+(n>>>10&1023),n=56320+(n&1023)),r!==0&&(e[s++]=r&255,e[s++]=r>>>8,r=0),e[s++]=n%256,e[s++]=n>>>8;return e.slice(0,s).toString("ucs2")}function y3(t){return kl(t,"binary").toString("utf8")}var O_="foo bar baz\xE2\x98\x83\xF0\x9F\x8D\xA3",Ia=Jn&&(y3(O_)==g1(O_)&&y3||b3(O_)==g1(O_)&&b3)||g1,Ko=Jn?function(t){return kl(t,"utf8").toString("binary")}:function(t){for(var e=[],n=0,a=0,i=0;n<t.length;)switch(a=t.charCodeAt(n++),!0){case a<128:e.push(String.fromCharCode(a));break;case a<2048:e.push(String.fromCharCode(192+(a>>6))),e.push(String.fromCharCode(128+(a&63)));break;case(a>=55296&&a<57344):a-=55296,i=t.charCodeAt(n++)-56320+(a<<10),e.push(String.fromCharCode(240+(i>>18&7))),e.push(String.fromCharCode(144+(i>>12&63))),e.push(String.fromCharCode(128+(i>>6&63))),e.push(String.fromCharCode(128+(i&63)));break;default:e.push(String.fromCharCode(224+(a>>12))),e.push(String.fromCharCode(128+(a>>6&63))),e.push(String.fromCharCode(128+(a&63)))}return e.join("")},yg=function(){var t={};return function(n,a){var i=n+"|"+(a||"");return t[i]?t[i]:t[i]=new RegExp("<(?:\\w+:)?"+n+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+n+">",a||"")}}(),_3=function(){var t=[["nbsp"," "],["middot","\xB7"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(e){return[new RegExp("&"+e[0]+";","ig"),e[1]]});return function(n){for(var a=n.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),i=0;i<t.length;++i)a=a.replace(t[i][0],t[i][1]);return a}}(),a8=function(){var t={};return function(n){return t[n]!==void 0?t[n]:t[n]=new RegExp("<(?:vt:)?"+n+">([\\s\\S]*?)</(?:vt:)?"+n+">","g")}}(),i8=/<\/?(?:vt:)?variant>/g,s8=/<(?:vt:)([^>]*)>([\s\S]*)</;function w3(t,e){var n=Pn(t),a=t.match(a8(n.baseType))||[],i=[];if(a.length!=n.size){if(e.WTF)throw new Error("unexpected vector length "+a.length+" != "+n.size);return i}return a.forEach(function(s){var r=s.replace(i8,"").match(s8);r&&i.push({v:Ia(r[2]),t:r[1]})}),i}var v3=/(^\s|\s$|\n)/;function ns(t,e){return"<"+t+(e.match(v3)?' xml:space="preserve"':"")+">"+e+"</"+t+">"}function x3(t){return oi(t).map(function(e){return" "+e+'="'+t[e]+'"'}).join("")}function nn(t,e,n){return"<"+t+(n!=null?x3(n):"")+(e!=null?(e.match(v3)?' xml:space="preserve"':"")+">"+e+"</"+t:"/")+">"}function m1(t,e){try{return t.toISOString().replace(/\.\d*/,"")}catch(n){if(e)throw n}return""}function r8(t,e){switch(typeof t){case"string":var n=nn("vt:lpwstr",Ha(t));return e&&(n=n.replace(/&quot;/g,"_x0022_")),n;case"number":return nn((t|0)==t?"vt:i4":"vt:r8",Ha(String(t)));case"boolean":return nn("vt:bool",t?"true":"false")}if(t instanceof Date)return nn("vt:filetime",m1(t));throw new Error("Unable to serialize "+t)}function b1(t){if(Jn&&Buffer.isBuffer(t))return t.toString("utf8");if(typeof t=="string")return t;if(typeof Uint8Array!="undefined"&&t instanceof Uint8Array)return Ia(hc(r1(t)));throw new Error("Bad input format: expected Buffer or string")}var _g=/<(\/?)([^\s?><!\/:]*:|)([^\s?<>:\/]+)(?:[\s?:\/][^>]*)?>/mg,Ci={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",mx:"http://schemas.microsoft.com/office/mac/excel/2008/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",sjs:"http://schemas.openxmlformats.org/package/2006/sheetjs/core-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},yc=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],Ar={o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel",ss:"urn:schemas-microsoft-com:office:spreadsheet",dt:"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",mv:"http://macVmlSchemaUri",v:"urn:schemas-microsoft-com:vml",html:"http://www.w3.org/TR/REC-html40"};function o8(t,e){for(var n=1-2*(t[e+7]>>>7),a=((t[e+7]&127)<<4)+(t[e+6]>>>4&15),i=t[e+6]&15,s=5;s>=0;--s)i=i*256+t[e+s];return a==2047?i==0?n*(1/0):NaN:(a==0?a=-1022:(a-=1023,i+=Math.pow(2,52)),n*Math.pow(2,a-52)*i)}function l8(t,e,n){var a=(e<0||1/e==-1/0?1:0)<<7,i=0,s=0,r=a?-e:e;isFinite(r)?r==0?i=s=0:(i=Math.floor(Math.log(r)/Math.LN2),s=r*Math.pow(2,52-i),i<=-1023&&(!isFinite(s)||s<Math.pow(2,52))?i=-1022:(s-=Math.pow(2,52),i+=1023)):(i=2047,s=isNaN(e)?26985:0);for(var o=0;o<=5;++o,s/=256)t[n+o]=s&255;t[n+6]=(i&15)<<4|s&15,t[n+7]=i>>4|a}var E3=function(t){for(var e=[],n=10240,a=0;a<t[0].length;++a)if(t[0][a])for(var i=0,s=t[0][a].length;i<s;i+=n)e.push.apply(e,t[0][a].slice(i,i+n));return e},k3=Jn?function(t){return t[0].length>0&&Buffer.isBuffer(t[0][0])?Buffer.concat(t[0].map(function(e){return Buffer.isBuffer(e)?e:kl(e)})):E3(t)}:E3,S3=function(t,e,n){for(var a=[],i=e;i<n;i+=2)a.push(String.fromCharCode(Al(t,i)));return a.join("").replace(hs,"")},R_=Jn?function(t,e,n){return Buffer.isBuffer(t)?t.toString("utf16le",e,n).replace(hs,""):S3(t,e,n)}:S3,A3=function(t,e,n){for(var a=[],i=e;i<e+n;++i)a.push(("0"+t[i].toString(16)).slice(-2));return a.join("")},T3=Jn?function(t,e,n){return Buffer.isBuffer(t)?t.toString("hex",e,e+n):A3(t,e,n)}:A3,D3=function(t,e,n){for(var a=[],i=e;i<n;i++)a.push(String.fromCharCode(Kf(t,i)));return a.join("")},jf=Jn?function(e,n,a){return Buffer.isBuffer(e)?e.toString("utf8",n,a):D3(e,n,a)}:D3,C3=function(t,e){var n=Gi(t,e);return n>0?jf(t,e+4,e+4+n-1):""},y1=C3,L3=function(t,e){var n=Gi(t,e);return n>0?jf(t,e+4,e+4+n-1):""},_1=L3,I3=function(t,e){var n=2*Gi(t,e);return n>0?jf(t,e+4,e+4+n-1):""},w1=I3,M3=function(e,n){var a=Gi(e,n);return a>0?R_(e,n+4,n+4+a):""},v1=M3,F3=function(t,e){var n=Gi(t,e);return n>0?jf(t,e+4,e+4+n):""},x1=F3,P3=function(t,e){return o8(t,e)},U_=P3,E1=function(e){return Array.isArray(e)||typeof Uint8Array!="undefined"&&e instanceof Uint8Array};Jn&&(y1=function(e,n){if(!Buffer.isBuffer(e))return C3(e,n);var a=e.readUInt32LE(n);return a>0?e.toString("utf8",n+4,n+4+a-1):""},_1=function(e,n){if(!Buffer.isBuffer(e))return L3(e,n);var a=e.readUInt32LE(n);return a>0?e.toString("utf8",n+4,n+4+a-1):""},w1=function(e,n){if(!Buffer.isBuffer(e))return I3(e,n);var a=2*e.readUInt32LE(n);return e.toString("utf16le",n+4,n+4+a-1)},v1=function(e,n){if(!Buffer.isBuffer(e))return M3(e,n);var a=e.readUInt32LE(n);return e.toString("utf16le",n+4,n+4+a)},x1=function(e,n){if(!Buffer.isBuffer(e))return F3(e,n);var a=e.readUInt32LE(n);return e.toString("utf8",n+4,n+4+a)},U_=function(e,n){return Buffer.isBuffer(e)?e.readDoubleLE(n):P3(e,n)},E1=function(e){return Buffer.isBuffer(e)||Array.isArray(e)||typeof Uint8Array!="undefined"&&e instanceof Uint8Array});function N3(){R_=function(t,e,n){return pa.utils.decode(1200,t.slice(e,n)).replace(hs,"")},jf=function(t,e,n){return pa.utils.decode(65001,t.slice(e,n))},y1=function(t,e){var n=Gi(t,e);return n>0?pa.utils.decode(Vd,t.slice(e+4,e+4+n-1)):""},_1=function(t,e){var n=Gi(t,e);return n>0?pa.utils.decode(vr,t.slice(e+4,e+4+n-1)):""},w1=function(t,e){var n=2*Gi(t,e);return n>0?pa.utils.decode(1200,t.slice(e+4,e+4+n-1)):""},v1=function(t,e){var n=Gi(t,e);return n>0?pa.utils.decode(1200,t.slice(e+4,e+4+n)):""},x1=function(t,e){var n=Gi(t,e);return n>0?pa.utils.decode(65001,t.slice(e+4,e+4+n)):""}}typeof pa!="undefined"&&N3();var Kf=function(t,e){return t[e]},Al=function(t,e){return t[e+1]*256+t[e]},c8=function(t,e){var n=t[e+1]*256+t[e];return n<32768?n:(65535-n+1)*-1},Gi=function(t,e){return t[e+3]*(1<<24)+(t[e+2]<<16)+(t[e+1]<<8)+t[e]},jd=function(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]},d8=function(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]};function wg(t,e){var n="",a,i,s=[],r,o,l,c;switch(e){case"dbcs":if(c=this.l,Jn&&Buffer.isBuffer(this))n=this.slice(this.l,this.l+2*t).toString("utf16le");else for(l=0;l<t;++l)n+=String.fromCharCode(Al(this,c)),c+=2;t*=2;break;case"utf8":n=jf(this,this.l,this.l+t);break;case"utf16le":t*=2,n=R_(this,this.l,this.l+t);break;case"wstr":if(typeof pa!="undefined")n=pa.utils.decode(vr,this.slice(this.l,this.l+2*t));else return wg.call(this,t,"dbcs");t=2*t;break;case"lpstr-ansi":n=y1(this,this.l),t=4+Gi(this,this.l);break;case"lpstr-cp":n=_1(this,this.l),t=4+Gi(this,this.l);break;case"lpwstr":n=w1(this,this.l),t=4+2*Gi(this,this.l);break;case"lpp4":t=4+Gi(this,this.l),n=v1(this,this.l),t&2&&(t+=2);break;case"8lpp4":t=4+Gi(this,this.l),n=x1(this,this.l),t&3&&(t+=4-(t&3));break;case"cstr":for(t=0,n="";(r=Kf(this,this.l+t++))!==0;)s.push(cg(r));n=s.join("");break;case"_wstr":for(t=0,n="";(r=Al(this,this.l+t))!==0;)s.push(cg(r)),t+=2;t+=2,n=s.join("");break;case"dbcs-cont":for(n="",c=this.l,l=0;l<t;++l){if(this.lens&&this.lens.indexOf(c)!==-1)return r=Kf(this,c),this.l=c+1,o=wg.call(this,t-l,r?"dbcs-cont":"sbcs-cont"),s.join("")+o;s.push(cg(Al(this,c))),c+=2}n=s.join(""),t*=2;break;case"cpstr":if(typeof pa!="undefined"){n=pa.utils.decode(vr,this.slice(this.l,this.l+t));break}case"sbcs-cont":for(n="",c=this.l,l=0;l!=t;++l){if(this.lens&&this.lens.indexOf(c)!==-1)return r=Kf(this,c),this.l=c+1,o=wg.call(this,t-l,r?"dbcs-cont":"sbcs-cont"),s.join("")+o;s.push(cg(Kf(this,c))),c+=1}n=s.join("");break;default:switch(t){case 1:return a=Kf(this,this.l),this.l++,a;case 2:return a=(e==="i"?c8:Al)(this,this.l),this.l+=2,a;case 4:case-4:return e==="i"||!(this[this.l+3]&128)?(a=(t>0?jd:d8)(this,this.l),this.l+=4,a):(i=Gi(this,this.l),this.l+=4,i);case 8:case-8:if(e==="f")return t==8?i=U_(this,this.l):i=U_([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,i;t=8;case 16:n=T3(this,this.l,t);break}}return this.l+=t,n}var u8=function(t,e,n){t[n]=e&255,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24&255},f8=function(t,e,n){t[n]=e&255,t[n+1]=e>>8&255,t[n+2]=e>>16&255,t[n+3]=e>>24&255},p8=function(t,e,n){t[n]=e&255,t[n+1]=e>>>8&255};function h8(t,e,n){var a=0,i=0;if(n==="dbcs"){for(i=0;i!=e.length;++i)p8(this,e.charCodeAt(i),this.l+2*i);a=2*e.length}else if(n==="sbcs"){if(typeof pa!="undefined"&&Vd==874)for(i=0;i!=e.length;++i){var s=pa.utils.encode(Vd,e.charAt(i));this[this.l+i]=s[0]}else for(e=e.replace(/[^\x00-\x7F]/g,"_"),i=0;i!=e.length;++i)this[this.l+i]=e.charCodeAt(i)&255;a=e.length}else if(n==="hex"){for(;i<t;++i)this[this.l++]=parseInt(e.slice(2*i,2*i+2),16)||0;return this}else if(n==="utf16le"){var r=Math.min(this.l+t,this.length);for(i=0;i<Math.min(e.length,t);++i){var o=e.charCodeAt(i);this[this.l++]=o&255,this[this.l++]=o>>8}for(;this.l<r;)this[this.l++]=0;return this}else switch(t){case 1:a=1,this[this.l]=e&255;break;case 2:a=2,this[this.l]=e&255,e>>>=8,this[this.l+1]=e&255;break;case 3:a=3,this[this.l]=e&255,e>>>=8,this[this.l+1]=e&255,e>>>=8,this[this.l+2]=e&255;break;case 4:a=4,u8(this,e,this.l);break;case 8:if(a=8,n==="f"){l8(this,e,this.l);break}case 16:break;case-4:a=4,f8(this,e,this.l);break}return this.l+=a,this}function B3(t,e){var n=T3(this,this.l,t.length>>1);if(n!==t)throw new Error(e+"Expected "+t+" saw "+n);this.l+=t.length>>1}function as(t,e){t.l=e,t.read_shift=wg,t.chk=B3,t.write_shift=h8}function ms(t,e){t.l+=e}function Dt(t){var e=pc(t);return as(e,0),e}function Tl(t,e,n){if(t){var a,i,s;as(t,t.l||0);for(var r=t.length,o=0,l=0;t.l<r;){o=t.read_shift(1),o&128&&(o=(o&127)+((t.read_shift(1)&127)<<7));var c=Rg[o]||Rg[65535];for(a=t.read_shift(1),s=a&127,i=1;i<4&&a&128;++i)s+=((a=t.read_shift(1))&127)<<7*i;l=t.l+s;var d=c.f&&c.f(t,s,n);if(t.l=l,e(d,c,o))return}}}function Us(){var t=[],e=Jn?256:2048,n=function(c){var d=Dt(c);return as(d,0),d},a=n(e),i=function(){a&&(a.length>a.l&&(a=a.slice(0,a.l),a.l=a.length),a.length>0&&t.push(a),a=null)},s=function(c){return a&&c<a.length-a.l?a:(i(),a=n(Math.max(c+1,e)))},r=function(){return i(),Yi(t)},o=function(c){i(),a=c,a.l==null&&(a.l=a.length),s(e)};return{next:s,push:o,end:r,_bufs:t}}function Wt(t,e,n,a){var i=+e,s;if(!isNaN(i)){a||(a=Rg[i].p||(n||[]).length||0),s=1+(i>=128?1:0)+1,a>=128&&++s,a>=16384&&++s,a>=2097152&&++s;var r=t.next(s);i<=127?r.write_shift(1,i):(r.write_shift(1,(i&127)+128),r.write_shift(1,i>>7));for(var o=0;o!=4;++o)if(a>=128)r.write_shift(1,(a&127)+128),a>>=7;else{r.write_shift(1,a);break}a>0&&E1(n)&&t.push(n)}}function vg(t,e,n){var a=Ba(t);if(e.s?(a.cRel&&(a.c+=e.s.c),a.rRel&&(a.r+=e.s.r)):(a.cRel&&(a.c+=e.c),a.rRel&&(a.r+=e.r)),!n||n.biff<12){for(;a.c>=256;)a.c-=256;for(;a.r>=65536;)a.r-=65536}return a}function $3(t,e,n){var a=Ba(t);return a.s=vg(a.s,e.s,n),a.e=vg(a.e,e.s,n),a}function xg(t,e){if(t.cRel&&t.c<0)for(t=Ba(t);t.c<0;)t.c+=e>8?16384:256;if(t.rRel&&t.r<0)for(t=Ba(t);t.r<0;)t.r+=e>8?1048576:e>5?65536:16384;var n=Nn(t);return!t.cRel&&t.cRel!=null&&(n=b8(n)),!t.rRel&&t.rRel!=null&&(n=g8(n)),n}function k1(t,e){return t.s.r==0&&!t.s.rRel&&t.e.r==(e.biff>=12?1048575:e.biff>=8?65536:16384)&&!t.e.rRel?(t.s.cRel?"":"$")+Ga(t.s.c)+":"+(t.e.cRel?"":"$")+Ga(t.e.c):t.s.c==0&&!t.s.cRel&&t.e.c==(e.biff>=12?16383:255)&&!t.e.cRel?(t.s.rRel?"":"$")+ci(t.s.r)+":"+(t.e.rRel?"":"$")+ci(t.e.r):xg(t.s,e.biff)+":"+xg(t.e,e.biff)}function S1(t){return parseInt(m8(t),10)-1}function ci(t){return""+(t+1)}function g8(t){return t.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function m8(t){return t.replace(/\$(\d+)$/,"$1")}function A1(t){for(var e=y8(t),n=0,a=0;a!==e.length;++a)n=26*n+e.charCodeAt(a)-64;return n-1}function Ga(t){if(t<0)throw new Error("invalid column "+t);var e="";for(++t;t;t=Math.floor((t-1)/26))e=String.fromCharCode((t-1)%26+65)+e;return e}function b8(t){return t.replace(/^([A-Z])/,"$$$1")}function y8(t){return t.replace(/^\$([A-Z])/,"$1")}function _8(t){return t.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function ti(t){for(var e=0,n=0,a=0;a<t.length;++a){var i=t.charCodeAt(a);i>=48&&i<=57?e=10*e+(i-48):i>=65&&i<=90&&(n=26*n+(i-64))}return{c:n-1,r:e-1}}function Nn(t){for(var e=t.c+1,n="";e;e=(e-1)/26|0)n=String.fromCharCode((e-1)%26+65)+n;return n+(t.r+1)}function Tr(t){var e=t.indexOf(":");return e==-1?{s:ti(t),e:ti(t)}:{s:ti(t.slice(0,e)),e:ti(t.slice(e+1))}}function Yn(t,e){return typeof e=="undefined"||typeof e=="number"?Yn(t.s,t.e):(typeof t!="string"&&(t=Nn(t)),typeof e!="string"&&(e=Nn(e)),t==e?t:t+":"+e)}function oa(t){var e={s:{c:0,r:0},e:{c:0,r:0}},n=0,a=0,i=0,s=t.length;for(n=0;a<s&&!((i=t.charCodeAt(a)-64)<1||i>26);++a)n=26*n+i;for(e.s.c=--n,n=0;a<s&&!((i=t.charCodeAt(a)-48)<0||i>9);++a)n=10*n+i;if(e.s.r=--n,a===s||i!=10)return e.e.c=e.s.c,e.e.r=e.s.r,e;for(++a,n=0;a!=s&&!((i=t.charCodeAt(a)-64)<1||i>26);++a)n=26*n+i;for(e.e.c=--n,n=0;a!=s&&!((i=t.charCodeAt(a)-48)<0||i>9);++a)n=10*n+i;return e.e.r=--n,e}function O3(t,e){var n=t.t=="d"&&e instanceof Date;if(t.z!=null)try{return t.w=kr(t.z,n?Ri(e):e)}catch(a){}try{return t.w=kr((t.XF||{}).numFmtId||(n?14:0),n?Ri(e):e)}catch(a){return""+e}}function Xo(t,e,n){return t==null||t.t==null||t.t=="z"?"":t.w!==void 0?t.w:(t.t=="d"&&!t.z&&n&&n.dateNF&&(t.z=n.dateNF),t.t=="e"?Dl[t.v]||t.v:e==null?O3(t,t.v):O3(t,e))}function _c(t,e){var n=e&&e.sheet?e.sheet:"Sheet1",a={};return a[n]=t,{SheetNames:[n],Sheets:a}}function R3(t,e,n){var a=n||{},i=t?Array.isArray(t):a.dense;ri!=null&&i==null&&(i=ri);var s=t||(i?[]:{}),r=0,o=0;if(s&&a.origin!=null){if(typeof a.origin=="number")r=a.origin;else{var l=typeof a.origin=="string"?ti(a.origin):a.origin;r=l.r,o=l.c}s["!ref"]||(s["!ref"]="A1:A1")}var c={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(s["!ref"]){var d=oa(s["!ref"]);c.s.c=d.s.c,c.s.r=d.s.r,c.e.c=Math.max(c.e.c,d.e.c),c.e.r=Math.max(c.e.r,d.e.r),r==-1&&(c.e.r=r=d.e.r+1)}for(var u=0;u!=e.length;++u)if(e[u]){if(!Array.isArray(e[u]))throw new Error("aoa_to_sheet expects an array of arrays");for(var g=0;g!=e[u].length;++g)if(typeof e[u][g]!="undefined"){var f={v:e[u][g]},h=r+u,m=o+g;if(c.s.r>h&&(c.s.r=h),c.s.c>m&&(c.s.c=m),c.e.r<h&&(c.e.r=h),c.e.c<m&&(c.e.c=m),e[u][g]&&typeof e[u][g]=="object"&&!Array.isArray(e[u][g])&&!(e[u][g]instanceof Date))f=e[u][g];else if(Array.isArray(f.v)&&(f.f=e[u][g][1],f.v=f.v[0]),f.v===null)if(f.f)f.t="n";else if(a.nullError)f.t="e",f.v=0;else if(a.sheetStubs)f.t="z";else continue;else typeof f.v=="number"?f.t="n":typeof f.v=="boolean"?f.t="b":f.v instanceof Date?(f.z=a.dateNF||Dn[14],a.cellDates?(f.t="d",f.w=kr(f.z,Ri(f.v))):(f.t="n",f.v=Ri(f.v),f.w=kr(f.z,f.v))):f.t="s";if(i)s[h]||(s[h]=[]),s[h][m]&&s[h][m].z&&(f.z=s[h][m].z),s[h][m]=f;else{var b=Nn({c:m,r:h});s[b]&&s[b].z&&(f.z=s[b].z),s[b]=f}}}return c.s.c<1e7&&(s["!ref"]=Yn(c)),s}function Xf(t,e){return R3(null,t,e)}function w8(t){return t.read_shift(4,"i")}function xo(t,e){return e||(e=Dt(4)),e.write_shift(4,t),e}function bs(t){var e=t.read_shift(4);return e===0?"":t.read_shift(e,"dbcs")}function is(t,e){var n=!1;return e==null&&(n=!0,e=Dt(4+2*t.length)),e.write_shift(4,t.length),t.length>0&&e.write_shift(0,t,"dbcs"),n?e.slice(0,e.l):e}function v8(t){return{ich:t.read_shift(2),ifnt:t.read_shift(2)}}function x8(t,e){return e||(e=Dt(4)),e.write_shift(2,t.ich||0),e.write_shift(2,t.ifnt||0),e}function T1(t,e){var n=t.l,a=t.read_shift(1),i=bs(t),s=[],r={t:i,h:i};if(a&1){for(var o=t.read_shift(4),l=0;l!=o;++l)s.push(v8(t));r.r=s}else r.r=[{ich:0,ifnt:0}];return t.l=n+e,r}function Rz(t,e){var n=!1;return e==null&&(n=!0,e=Dt(15+4*t.t.length)),e.write_shift(1,0),is(t.t,e),n?e.slice(0,e.l):e}var E8=T1;function k8(t,e){var n=!1;return e==null&&(n=!0,e=Dt(23+4*t.t.length)),e.write_shift(1,1),is(t.t,e),e.write_shift(4,1),x8({ich:0,ifnt:0},e),n?e.slice(0,e.l):e}function Hr(t){var e=t.read_shift(4),n=t.read_shift(2);return n+=t.read_shift(1)<<16,t.l++,{c:e,iStyleRef:n}}function Kd(t,e){return e==null&&(e=Dt(8)),e.write_shift(-4,t.c),e.write_shift(3,t.iStyleRef||t.s),e.write_shift(1,0),e}function Xd(t){var e=t.read_shift(2);return e+=t.read_shift(1)<<16,t.l++,{c:-1,iStyleRef:e}}function Zd(t,e){return e==null&&(e=Dt(4)),e.write_shift(3,t.iStyleRef||t.s),e.write_shift(1,0),e}var S8=bs,U3=null;function D1(t){var e=t.read_shift(4);return e===0||e===4294967295?"":t.read_shift(e,"dbcs")}function C1(t,e){var n=!1;return e==null&&(n=!0,e=Dt(127)),e.write_shift(4,t.length>0?t.length:4294967295),t.length>0&&e.write_shift(0,t,"dbcs"),n?e.slice(0,e.l):e}var A8=bs,L1=D1,I1=null;function M1(t){var e=t.slice(t.l,t.l+4),n=e[0]&1,a=e[0]&2;t.l+=4;var i=a===0?U_([0,0,0,0,e[0]&252,e[1],e[2],e[3]],0):jd(e,0)>>2;return n?i/100:i}function H3(t,e){e==null&&(e=Dt(4));var n=0,a=0,i=t*100;if(t==(t|0)&&t>=-(1<<29)&&t<1<<29?a=1:i==(i|0)&&i>=-(1<<29)&&i<1<<29&&(a=1,n=1),a)e.write_shift(-4,((n?i:t)<<2)+(n+2));else throw new Error("unsupported RkNumber "+t)}function q3(t){var e={s:{},e:{}};return e.s.r=t.read_shift(4),e.e.r=t.read_shift(4),e.s.c=t.read_shift(4),e.e.c=t.read_shift(4),e}function Uz(t,e){return e||(e=Dt(16)),e.write_shift(4,t.s.r),e.write_shift(4,t.e.r),e.write_shift(4,t.s.c),e.write_shift(4,t.e.c),e}var Jd=q3,H_=null;function ys(t){if(t.length-t.l<8)throw"XLS Xnum Buffer underflow";return t.read_shift(8,"f")}function Qd(t,e){return(e||Dt(8)).write_shift(8,t,"f")}function T8(t){var e={},n=t.read_shift(1),a=n>>>1,i=t.read_shift(1),s=t.read_shift(2,"i"),r=t.read_shift(1),o=t.read_shift(1),l=t.read_shift(1);switch(t.l++,a){case 0:e.auto=1;break;case 1:e.index=i;var c=eu[i];c&&(e.rgb=Tg(c));break;case 2:e.rgb=Tg([r,o,l]);break;case 3:e.theme=i;break}return s!=0&&(e.tint=s>0?s/32767:s/32768),e}function q_(t,e){if(e||(e=Dt(8)),!t||t.auto)return e.write_shift(4,0),e.write_shift(4,0),e;t.index!=null?(e.write_shift(1,2),e.write_shift(1,t.index)):t.theme!=null?(e.write_shift(1,6),e.write_shift(1,t.theme)):(e.write_shift(1,5),e.write_shift(1,0));var n=t.tint||0;if(n>0?n*=32767:n<0&&(n*=32768),e.write_shift(2,n),!t.rgb||t.theme!=null)e.write_shift(2,0),e.write_shift(1,0),e.write_shift(1,0);else{var a=t.rgb||"FFFFFF";typeof a=="number"&&(a=("000000"+a.toString(16)).slice(-6)),e.write_shift(1,parseInt(a.slice(0,2),16)),e.write_shift(1,parseInt(a.slice(2,4),16)),e.write_shift(1,parseInt(a.slice(4,6),16)),e.write_shift(1,255)}return e}function D8(t){var e=t.read_shift(1);t.l++;var n={fBold:e&1,fItalic:e&2,fUnderline:e&4,fStrikeout:e&8,fOutline:e&16,fShadow:e&32,fCondense:e&64,fExtend:e&128};return n}function C8(t,e){e||(e=Dt(2));var n=(t.italic?2:0)|(t.strike?8:0)|(t.outline?16:0)|(t.shadow?32:0)|(t.condense?64:0)|(t.extend?128:0);return e.write_shift(1,n),e.write_shift(1,0),e}function W3(t,e){var n={2:"BITMAP",3:"METAFILEPICT",8:"DIB",14:"ENHMETAFILE"},a=t.read_shift(4);switch(a){case 0:return"";case 4294967295:case 4294967294:return n[t.read_shift(4)]||""}if(a>400)throw new Error("Unsupported Clipboard: "+a.toString(16));return t.l-=4,t.read_shift(0,e==1?"lpstr":"lpwstr")}function L8(t){return W3(t,1)}function I8(t){return W3(t,2)}var F1=2,tr=3,W_=11,V3=12,V_=19,Hz=30,z_=64,M8=65,F8=71,qz=4096,P8=4108,N8=4126,ji=80,z3=81,B8=[ji,z3],P1={1:{n:"CodePage",t:F1},2:{n:"Category",t:ji},3:{n:"PresentationFormat",t:ji},4:{n:"ByteCount",t:tr},5:{n:"LineCount",t:tr},6:{n:"ParagraphCount",t:tr},7:{n:"SlideCount",t:tr},8:{n:"NoteCount",t:tr},9:{n:"HiddenCount",t:tr},10:{n:"MultimediaClipCount",t:tr},11:{n:"ScaleCrop",t:W_},12:{n:"HeadingPairs",t:P8},13:{n:"TitlesOfParts",t:N8},14:{n:"Manager",t:ji},15:{n:"Company",t:ji},16:{n:"LinksUpToDate",t:W_},17:{n:"CharacterCount",t:tr},19:{n:"SharedDoc",t:W_},22:{n:"HyperlinksChanged",t:W_},23:{n:"AppVersion",t:tr,p:"version"},24:{n:"DigSig",t:M8},26:{n:"ContentType",t:ji},27:{n:"ContentStatus",t:ji},28:{n:"Language",t:ji},29:{n:"Version",t:ji},255:{},2147483648:{n:"Locale",t:V_},2147483651:{n:"Behavior",t:V_},1919054434:{}},N1={1:{n:"CodePage",t:F1},2:{n:"Title",t:ji},3:{n:"Subject",t:ji},4:{n:"Author",t:ji},5:{n:"Keywords",t:ji},6:{n:"Comments",t:ji},7:{n:"Template",t:ji},8:{n:"LastAuthor",t:ji},9:{n:"RevNumber",t:ji},10:{n:"EditTime",t:z_},11:{n:"LastPrinted",t:z_},12:{n:"CreatedDate",t:z_},13:{n:"ModifiedDate",t:z_},14:{n:"PageCount",t:tr},15:{n:"WordCount",t:tr},16:{n:"CharCount",t:tr},17:{n:"Thumbnail",t:F8},18:{n:"Application",t:ji},19:{n:"DocSecurity",t:tr},255:{},2147483648:{n:"Locale",t:V_},2147483651:{n:"Behavior",t:V_},1919054434:{}},Y3={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},$8=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function O8(t){return t.map(function(e){return[e>>16&255,e>>8&255,e&255]})}var R8=O8([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),eu=Ba(R8),Dl={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},G3={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},B1={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},Y_={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function $1(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function U8(t){var e=$1();if(!t||!t.match)return e;var n={};if((t.match(gs)||[]).forEach(function(a){var i=Pn(a);switch(i[0].replace(J6,"<")){case"<?xml":break;case"<Types":e.xmlns=i["xmlns"+(i[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":n[i.Extension]=i.ContentType;break;case"<Override":e[B1[i.ContentType]]!==void 0&&e[B1[i.ContentType]].push(i.PartName);break}}),e.xmlns!==Ci.CT)throw new Error("Unknown Namespace: "+e.xmlns);return e.calcchain=e.calcchains.length>0?e.calcchains[0]:"",e.sst=e.strs.length>0?e.strs[0]:"",e.style=e.styles.length>0?e.styles[0]:"",e.defaults=n,delete e.calcchains,e}function j3(t,e){var n=W6(B1),a=[],i;a[a.length]=Di,a[a.length]=nn("Types",null,{xmlns:Ci.CT,"xmlns:xsd":Ci.xsd,"xmlns:xsi":Ci.xsi}),a=a.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(l){return nn("Default",null,{Extension:l[0],ContentType:l[1]})}));var s=function(l){t[l]&&t[l].length>0&&(i=t[l][0],a[a.length]=nn("Override",null,{PartName:(i[0]=="/"?"":"/")+i,ContentType:Y_[l][e.bookType]||Y_[l].xlsx}))},r=function(l){(t[l]||[]).forEach(function(c){a[a.length]=nn("Override",null,{PartName:(c[0]=="/"?"":"/")+c,ContentType:Y_[l][e.bookType]||Y_[l].xlsx})})},o=function(l){(t[l]||[]).forEach(function(c){a[a.length]=nn("Override",null,{PartName:(c[0]=="/"?"":"/")+c,ContentType:n[l][0]})})};return s("workbooks"),r("sheets"),r("charts"),o("themes"),["strs","styles"].forEach(s),["coreprops","extprops","custprops"].forEach(o),o("vba"),o("comments"),o("threadedcomments"),o("drawings"),r("metadata"),o("people"),a.length>2&&(a[a.length]="</Types>",a[1]=a[1].replace("/>",">")),a.join("")}var Gn={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function Eg(t){var e=t.lastIndexOf("/");return t.slice(0,e+1)+"_rels/"+t.slice(e+1)+".rels"}function kg(t,e){var n={"!id":{}};if(!t)return n;e.charAt(0)!=="/"&&(e="/"+e);var a={};return(t.match(gs)||[]).forEach(function(i){var s=Pn(i);if(s[0]==="<Relationship"){var r={};r.Type=s.Type,r.Target=s.Target,r.Id=s.Id,s.TargetMode&&(r.TargetMode=s.TargetMode);var o=s.TargetMode==="External"?s.Target:bg(s.Target,e);n[o]=r,a[s.Id]=r}}),n["!id"]=a,n}function Zf(t){var e=[Di,nn("Relationships",null,{xmlns:Ci.RELS})];return oi(t["!id"]).forEach(function(n){e[e.length]=nn("Relationship",null,t["!id"][n])}),e.length>2&&(e[e.length]="</Relationships>",e[1]=e[1].replace("/>",">")),e.join("")}function Ea(t,e,n,a,i,s){if(i||(i={}),t["!id"]||(t["!id"]={}),t["!idx"]||(t["!idx"]=1),e<0)for(e=t["!idx"];t["!id"]["rId"+e];++e);if(t["!idx"]=e+1,i.Id="rId"+e,i.Type=a,i.Target=n,s?i.TargetMode=s:[Gn.HLINK,Gn.XPATH,Gn.XMISS].indexOf(i.Type)>-1&&(i.TargetMode="External"),t["!id"][i.Id])throw new Error("Cannot rewrite rId "+e);return t["!id"][i.Id]=i,t[("/"+i.Target).replace("//","/")]=i,e}var H8="application/vnd.oasis.opendocument.spreadsheet";function q8(t,e){for(var n=b1(t),a,i;a=_g.exec(n);)switch(a[3]){case"manifest":break;case"file-entry":if(i=Pn(a[0],!1),i.path=="/"&&i.type!==H8)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(e&&e.WTF)throw a}}function W8(t){var e=[Di];e.push(`<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">
`),e.push(`  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>
`);for(var n=0;n<t.length;++n)e.push('  <manifest:file-entry manifest:full-path="'+t[n][0]+'" manifest:media-type="'+t[n][1]+`"/>
`);return e.push("</manifest:manifest>"),e.join("")}function K3(t,e,n){return['  <rdf:Description rdf:about="'+t+`">
`,'    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(n||"odf")+"#"+e+`"/>
`,`  </rdf:Description>
`].join("")}function V8(t,e){return['  <rdf:Description rdf:about="'+t+`">
`,'    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+e+`"/>
`,`  </rdf:Description>
`].join("")}function z8(t){var e=[Di];e.push(`<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
`);for(var n=0;n!=t.length;++n)e.push(K3(t[n][0],t[n][1])),e.push(V8("",t[n][0]));return e.push(K3("","Document","pkg")),e.push("</rdf:RDF>"),e.join("")}function Y8(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+lg.version+"</meta:generator></office:meta></office:document-meta>"}var qr=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]],G8=function(){for(var t=new Array(qr.length),e=0;e<qr.length;++e){var n=qr[e],a="(?:"+n[0].slice(0,n[0].indexOf(":"))+":)"+n[0].slice(n[0].indexOf(":")+1);t[e]=new RegExp("<"+a+"[^>]*>([\\s\\S]*?)</"+a+">")}return t}();function X3(t){var e={};t=Ia(t);for(var n=0;n<qr.length;++n){var a=qr[n],i=t.match(G8[n]);i!=null&&i.length>0&&(e[a[1]]=ga(i[1])),a[2]==="date"&&e[a[1]]&&(e[a[1]]=ei(e[a[1]]))}return e}function O1(t,e,n,a,i){i[t]!=null||e==null||e===""||(i[t]=e,e=Ha(e),a[a.length]=n?nn(t,e,n):ns(t,e))}function Z3(t,e){var n=e||{},a=[Di,nn("cp:coreProperties",null,{"xmlns:cp":Ci.CORE_PROPS,"xmlns:dc":Ci.dc,"xmlns:dcterms":Ci.dcterms,"xmlns:dcmitype":Ci.dcmitype,"xmlns:xsi":Ci.xsi})],i={};if(!t&&!n.Props)return a.join("");t&&(t.CreatedDate!=null&&O1("dcterms:created",typeof t.CreatedDate=="string"?t.CreatedDate:m1(t.CreatedDate,n.WTF),{"xsi:type":"dcterms:W3CDTF"},a,i),t.ModifiedDate!=null&&O1("dcterms:modified",typeof t.ModifiedDate=="string"?t.ModifiedDate:m1(t.ModifiedDate,n.WTF),{"xsi:type":"dcterms:W3CDTF"},a,i));for(var s=0;s!=qr.length;++s){var r=qr[s],o=n.Props&&n.Props[r[1]]!=null?n.Props[r[1]]:t?t[r[1]]:null;o===!0?o="1":o===!1?o="0":typeof o=="number"&&(o=String(o)),o!=null&&O1(r[0],o,null,a,i)}return a.length>2&&(a[a.length]="</cp:coreProperties>",a[1]=a[1].replace("/>",">")),a.join("")}var tu=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],J3=null;function Q3(t,e,n,a){var i=[];if(typeof t=="string")i=w3(t,a);else for(var s=0;s<t.length;++s)i=i.concat(t[s].map(function(d){return{v:d}}));var r=typeof e=="string"?w3(e,a).map(function(d){return d.v}):e,o=0,l=0;if(r.length>0)for(var c=0;c!==i.length;c+=2){switch(l=+i[c+1].v,i[c].v){case"Worksheets":case"\u5DE5\u4F5C\u8868":case"\u041B\u0438\u0441\u0442\u044B":case"\u0623\u0648\u0631\u0627\u0642 \u0627\u0644\u0639\u0645\u0644":case"\u30EF\u30FC\u30AF\u30B7\u30FC\u30C8":case"\u05D2\u05DC\u05D9\u05D5\u05E0\u05D5\u05EA \u05E2\u05D1\u05D5\u05D3\u05D4":case"Arbeitsbl\xE4tter":case"\xC7al\u0131\u015Fma Sayfalar\u0131":case"Feuilles de calcul":case"Fogli di lavoro":case"Folhas de c\xE1lculo":case"Planilhas":case"Regneark":case"Hojas de c\xE1lculo":case"Werkbladen":n.Worksheets=l,n.SheetNames=r.slice(o,o+l);break;case"Named Ranges":case"Rangos con nombre":case"\u540D\u524D\u4ED8\u304D\u4E00\u89A7":case"Benannte Bereiche":case"Navngivne omr\xE5der":n.NamedRanges=l,n.DefinedNames=r.slice(o,o+l);break;case"Charts":case"Diagramme":n.Chartsheets=l,n.ChartNames=r.slice(o,o+l);break}o+=l}}function j8(t,e,n){var a={};return e||(e={}),t=Ia(t),tu.forEach(function(i){var s=(t.match(yg(i[0]))||[])[1];switch(i[2]){case"string":s&&(e[i[1]]=ga(s));break;case"bool":e[i[1]]=s==="true";break;case"raw":var r=t.match(new RegExp("<"+i[0]+"[^>]*>([\\s\\S]*?)</"+i[0]+">"));r&&r.length>0&&(a[i[1]]=r[1]);break}}),a.HeadingPairs&&a.TitlesOfParts&&Q3(a.HeadingPairs,a.TitlesOfParts,e,n),e}function eD(t){var e=[],n=nn;return t||(t={}),t.Application="SheetJS",e[e.length]=Di,e[e.length]=nn("Properties",null,{xmlns:Ci.EXT_PROPS,"xmlns:vt":Ci.vt}),tu.forEach(function(a){if(t[a[1]]!==void 0){var i;switch(a[2]){case"string":i=Ha(String(t[a[1]]));break;case"bool":i=t[a[1]]?"true":"false";break}i!==void 0&&(e[e.length]=n(a[0],i))}}),e[e.length]=n("HeadingPairs",n("vt:vector",n("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+n("vt:variant",n("vt:i4",String(t.Worksheets))),{size:2,baseType:"variant"})),e[e.length]=n("TitlesOfParts",n("vt:vector",t.SheetNames.map(function(a){return"<vt:lpstr>"+Ha(a)+"</vt:lpstr>"}).join(""),{size:t.Worksheets,baseType:"lpstr"})),e.length>2&&(e[e.length]="</Properties>",e[1]=e[1].replace("/>",">")),e.join("")}var K8=/<[^>]+>[^<]*/g;function X8(t,e){var n={},a="",i=t.match(K8);if(i)for(var s=0;s!=i.length;++s){var r=i[s],o=Pn(r);switch(o[0]){case"<?xml":break;case"<Properties":break;case"<property":a=ga(o.name);break;case"</property>":a=null;break;default:if(r.indexOf("<vt:")===0){var l=r.split(">"),c=l[0].slice(4),d=l[1];switch(c){case"lpstr":case"bstr":case"lpwstr":n[a]=ga(d);break;case"bool":n[a]=Ya(d);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":n[a]=parseInt(d,10);break;case"r4":case"r8":case"decimal":n[a]=parseFloat(d);break;case"filetime":case"date":n[a]=ei(d);break;case"cy":case"error":n[a]=ga(d);break;default:if(c.slice(-1)=="/")break;e.WTF&&typeof console!="undefined"&&console.warn("Unexpected",r,c,l)}}else if(r.slice(0,2)!=="</"){if(e.WTF)throw new Error(r)}}}return n}function tD(t){var e=[Di,nn("Properties",null,{xmlns:Ci.CUST_PROPS,"xmlns:vt":Ci.vt})];if(!t)return e.join("");var n=1;return oi(t).forEach(function(i){++n,e[e.length]=nn("property",r8(t[i],!0),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:n,name:Ha(i)})}),e.length>2&&(e[e.length]="</Properties>",e[1]=e[1].replace("/>",">")),e.join("")}var R1={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"},U1;function Z8(t,e,n){U1||(U1=P_(R1)),e=U1[e]||e,t[e]=n}function J8(t,e){var n=[];return oi(R1).map(function(a){for(var i=0;i<qr.length;++i)if(qr[i][1]==a)return qr[i];for(i=0;i<tu.length;++i)if(tu[i][1]==a)return tu[i];throw a}).forEach(function(a){if(t[a[1]]!=null){var i=e&&e.Props&&e.Props[a[1]]!=null?e.Props[a[1]]:t[a[1]];switch(a[2]){case"date":i=new Date(i).toISOString().replace(/\.\d*Z/,"Z");break}typeof i=="number"?i=String(i):i===!0||i===!1?i=i?"1":"0":i instanceof Date&&(i=new Date(i).toISOString().replace(/\.\d*Z/,"")),n.push(ns(R1[a[1]]||a[1],i))}}),nn("DocumentProperties",n.join(""),{xmlns:Ar.o})}function Q8(t,e){var n=["Worksheets","SheetNames"],a="CustomDocumentProperties",i=[];return t&&oi(t).forEach(function(s){if(Object.prototype.hasOwnProperty.call(t,s)){for(var r=0;r<qr.length;++r)if(s==qr[r][1])return;for(r=0;r<tu.length;++r)if(s==tu[r][1])return;for(r=0;r<n.length;++r)if(s==n[r])return;var o=t[s],l="string";typeof o=="number"?(l="float",o=String(o)):o===!0||o===!1?(l="boolean",o=o?"1":"0"):o=String(o),i.push(nn(h3(s),o,{"dt:dt":l}))}}),e&&oi(e).forEach(function(s){if(Object.prototype.hasOwnProperty.call(e,s)&&!(t&&Object.prototype.hasOwnProperty.call(t,s))){var r=e[s],o="string";typeof r=="number"?(o="float",r=String(r)):r===!0||r===!1?(o="boolean",r=r?"1":"0"):r instanceof Date?(o="dateTime.tz",r=r.toISOString()):r=String(r),i.push(nn(h3(s),r,{"dt:dt":o}))}}),"<"+a+' xmlns="'+Ar.o+'">'+i.join("")+"</"+a+">"}function H1(t){var e=t.read_shift(4),n=t.read_shift(4);return new Date((n/1e7*Math.pow(2,32)+e/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function eN(t){var e=typeof t=="string"?new Date(Date.parse(t)):t,n=e.getTime()/1e3+11644473600,a=n%Math.pow(2,32),i=(n-a)/Math.pow(2,32);a*=1e7,i*=1e7;var s=a/Math.pow(2,32)|0;s>0&&(a=a%Math.pow(2,32),i+=s);var r=Dt(8);return r.write_shift(4,a),r.write_shift(4,i),r}function nD(t,e,n){var a=t.l,i=t.read_shift(0,"lpstr-cp");if(n)for(;t.l-a&3;)++t.l;return i}function aD(t,e,n){var a=t.read_shift(0,"lpwstr");return n&&(t.l+=4-(a.length+1&3)&3),a}function iD(t,e,n){return e===31?aD(t):nD(t,e,n)}function q1(t,e,n){return iD(t,e,n===!1?0:4)}function tN(t,e){if(!e)throw new Error("VtUnalignedString must have positive length");return iD(t,e,0)}function nN(t){for(var e=t.read_shift(4),n=[],a=0;a!=e;++a){var i=t.l;n[a]=t.read_shift(0,"lpwstr").replace(hs,""),t.l-i&2&&(t.l+=2)}return n}function aN(t){for(var e=t.read_shift(4),n=[],a=0;a!=e;++a)n[a]=t.read_shift(0,"lpstr-cp").replace(hs,"");return n}function iN(t){var e=t.l,n=G_(t,z3);t[t.l]==0&&t[t.l+1]==0&&t.l-e&2&&(t.l+=2);var a=G_(t,tr);return[n,a]}function sN(t){for(var e=t.read_shift(4),n=[],a=0;a<e/2;++a)n.push(iN(t));return n}function sD(t,e){for(var n=t.read_shift(4),a={},i=0;i!=n;++i){var s=t.read_shift(4),r=t.read_shift(4);a[s]=t.read_shift(r,e===1200?"utf16le":"utf8").replace(hs,"").replace(pg,"!"),e===1200&&r%2&&(t.l+=2)}return t.l&3&&(t.l=t.l>>3<<2),a}function rD(t){var e=t.read_shift(4),n=t.slice(t.l,t.l+e);return t.l+=e,(e&3)>0&&(t.l+=4-(e&3)&3),n}function rN(t){var e={};return e.Size=t.read_shift(4),t.l+=e.Size+3-(e.Size-1)%4,e}function G_(t,e,n){var a=t.read_shift(2),i,s=n||{};if(t.l+=2,e!==V3&&a!==e&&B8.indexOf(e)===-1&&!((e&65534)==4126&&(a&65534)==4126))throw new Error("Expected type "+e+" saw "+a);switch(e===V3?a:e){case 2:return i=t.read_shift(2,"i"),s.raw||(t.l+=2),i;case 3:return i=t.read_shift(4,"i"),i;case 11:return t.read_shift(4)!==0;case 19:return i=t.read_shift(4),i;case 30:return nD(t,a,4).replace(hs,"");case 31:return aD(t);case 64:return H1(t);case 65:return rD(t);case 71:return rN(t);case 80:return q1(t,a,!s.raw).replace(hs,"");case 81:return tN(t,a).replace(hs,"");case 4108:return sN(t);case 4126:case 4127:return a==4127?nN(t):aN(t);default:throw new Error("TypedPropertyValue unrecognized type "+e+" "+a)}}function oD(t,e){var n=Dt(4),a=Dt(4);switch(n.write_shift(4,t==80?31:t),t){case 3:a.write_shift(-4,e);break;case 5:a=Dt(8),a.write_shift(8,e,"f");break;case 11:a.write_shift(4,e?1:0);break;case 64:a=eN(e);break;case 31:case 80:for(a=Dt(4+2*(e.length+1)+(e.length%2?0:2)),a.write_shift(4,e.length+1),a.write_shift(0,e,"dbcs");a.l!=a.length;)a.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+t+" "+e)}return Yi([n,a])}function lD(t,e){var n=t.l,a=t.read_shift(4),i=t.read_shift(4),s=[],r=0,o=0,l=-1,c={};for(r=0;r!=i;++r){var d=t.read_shift(4),u=t.read_shift(4);s[r]=[d,u+n]}s.sort(function(_,v){return _[1]-v[1]});var g={};for(r=0;r!=i;++r){if(t.l!==s[r][1]){var f=!0;if(r>0&&e)switch(e[s[r-1][0]].t){case 2:t.l+2===s[r][1]&&(t.l+=2,f=!1);break;case 80:t.l<=s[r][1]&&(t.l=s[r][1],f=!1);break;case 4108:t.l<=s[r][1]&&(t.l=s[r][1],f=!1);break}if((!e||r==0)&&t.l<=s[r][1]&&(f=!1,t.l=s[r][1]),f)throw new Error("Read Error: Expected address "+s[r][1]+" at "+t.l+" :"+r)}if(e){var h=e[s[r][0]];if(g[h.n]=G_(t,h.t,{raw:!0}),h.p==="version"&&(g[h.n]=String(g[h.n]>>16)+"."+("0000"+String(g[h.n]&65535)).slice(-4)),h.n=="CodePage")switch(g[h.n]){case 0:g[h.n]=1252;case 874:case 932:case 936:case 949:case 950:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 1e4:case 1200:case 1201:case 1252:case 65e3:case-536:case 65001:case-535:Or(o=g[h.n]>>>0&65535);break;default:throw new Error("Unsupported CodePage: "+g[h.n])}}else if(s[r][0]===1){if(o=g.CodePage=G_(t,F1),Or(o),l!==-1){var m=t.l;t.l=s[l][1],c=sD(t,o),t.l=m}}else if(s[r][0]===0){if(o===0){l=r,t.l=s[r+1][1];continue}c=sD(t,o)}else{var b=c[s[r][0]],y;switch(t[t.l]){case 65:t.l+=4,y=rD(t);break;case 30:t.l+=4,y=q1(t,t[t.l-4]).replace(/\u0000+$/,"");break;case 31:t.l+=4,y=q1(t,t[t.l-4]).replace(/\u0000+$/,"");break;case 3:t.l+=4,y=t.read_shift(4,"i");break;case 19:t.l+=4,y=t.read_shift(4);break;case 5:t.l+=4,y=t.read_shift(8,"f");break;case 11:t.l+=4,y=gi(t,4);break;case 64:t.l+=4,y=ei(H1(t));break;default:throw new Error("unparsed value: "+t[t.l])}g[b]=y}}return t.l=n+a,g}var cD=null;function oN(t){switch(typeof t){case"boolean":return 11;case"number":return(t|0)==t?3:5;case"string":return 31;case"object":if(t instanceof Date)return 64;break}return-1}function dD(t,e,n){var a=Dt(8),i=[],s=[],r=8,o=0,l=Dt(8),c=Dt(8);if(l.write_shift(4,2),l.write_shift(4,1200),c.write_shift(4,1),s.push(l),i.push(c),r+=8+l.length,!e){c=Dt(8),c.write_shift(4,0),i.unshift(c);var d=[Dt(4)];for(d[0].write_shift(4,t.length),o=0;o<t.length;++o){var u=t[o][0];for(l=Dt(8+2*(u.length+1)+(u.length%2?0:2)),l.write_shift(4,o+2),l.write_shift(4,u.length+1),l.write_shift(0,u,"dbcs");l.l!=l.length;)l.write_shift(1,0);d.push(l)}l=Yi(d),s.unshift(l),r+=8+l.length}for(o=0;o<t.length;++o)if(!(e&&!e[t[o][0]])&&!(cD.indexOf(t[o][0])>-1||J3.indexOf(t[o][0])>-1)&&t[o][1]!=null){var g=t[o][1],f=0;if(e){f=+e[t[o][0]];var h=n[f];if(h.p=="version"&&typeof g=="string"){var m=g.split(".");g=(+m[0]<<16)+(+m[1]||0)}l=oD(h.t,g)}else{var b=oN(g);b==-1&&(b=31,g=String(g)),l=oD(b,g)}s.push(l),c=Dt(8),c.write_shift(4,e?f:2+o),i.push(c),r+=8+l.length}var y=8*(s.length+1);for(o=0;o<s.length;++o)i[o].write_shift(4,y),y+=s[o].length;return a.write_shift(4,r),a.write_shift(4,s.length),Yi([a].concat(i).concat(s))}function uD(t,e,n){var a=t.content;if(!a)return{};as(a,0);var i,s,r,o,l=0;a.chk("feff","Byte Order: "),a.read_shift(2);var c=a.read_shift(4),d=a.read_shift(16);if(d!==An.utils.consts.HEADER_CLSID&&d!==n)throw new Error("Bad PropertySet CLSID "+d);if(i=a.read_shift(4),i!==1&&i!==2)throw new Error("Unrecognized #Sets: "+i);if(s=a.read_shift(16),o=a.read_shift(4),i===1&&o!==a.l)throw new Error("Length mismatch: "+o+" !== "+a.l);i===2&&(r=a.read_shift(16),l=a.read_shift(4));var u=lD(a,e),g={SystemIdentifier:c};for(var f in u)g[f]=u[f];if(g.FMTID=s,i===1)return g;if(l-a.l==2&&(a.l+=2),a.l!==l)throw new Error("Length mismatch 2: "+a.l+" !== "+l);var h;try{h=lD(a,null)}catch(m){}for(f in h)g[f]=h[f];return g.FMTID=[s,r],g}function fD(t,e,n,a,i,s){var r=Dt(i?68:48),o=[r];r.write_shift(2,65534),r.write_shift(2,0),r.write_shift(4,842412599),r.write_shift(16,An.utils.consts.HEADER_CLSID,"hex"),r.write_shift(4,i?2:1),r.write_shift(16,e,"hex"),r.write_shift(4,i?68:48);var l=dD(t,n,a);if(o.push(l),i){var c=dD(i,null,null);r.write_shift(16,s,"hex"),r.write_shift(4,68+l.length),o.push(c)}return Yi(o)}function wc(t,e){return t.read_shift(e),null}function lN(t,e){e||(e=Dt(t));for(var n=0;n<t;++n)e.write_shift(1,0);return e}function cN(t,e,n){for(var a=[],i=t.l+e;t.l<i;)a.push(n(t,i-t.l));if(i!==t.l)throw new Error("Slurp error");return a}function gi(t,e){return t.read_shift(e)===1}function Hs(t,e){return e||(e=Dt(2)),e.write_shift(2,+!!t),e}function Li(t){return t.read_shift(2,"u")}function Wr(t,e){return e||(e=Dt(2)),e.write_shift(2,t),e}function pD(t,e){return cN(t,e,Li)}function dN(t){var e=t.read_shift(1),n=t.read_shift(1);return n===1?e:e===1}function hD(t,e,n){return n||(n=Dt(2)),n.write_shift(1,e=="e"?+t:+!!t),n.write_shift(1,e=="e"?1:0),n}function Sg(t,e,n){var a=t.read_shift(n&&n.biff>=12?2:1),i="sbcs-cont",s=vr;if(n&&n.biff>=8&&(vr=1200),!n||n.biff==8){var r=t.read_shift(1);r&&(i="dbcs-cont")}else n.biff==12&&(i="wstr");n.biff>=2&&n.biff<=5&&(i="cpstr");var o=a?t.read_shift(a,i):"";return vr=s,o}function uN(t){var e=vr;vr=1200;var n=t.read_shift(2),a=t.read_shift(1),i=a&4,s=a&8,r=1+(a&1),o=0,l,c={};s&&(o=t.read_shift(2)),i&&(l=t.read_shift(4));var d=r==2?"dbcs-cont":"sbcs-cont",u=n===0?"":t.read_shift(n,d);return s&&(t.l+=4*o),i&&(t.l+=l),c.t=u,s||(c.raw="<t>"+c.t+"</t>",c.r=c.t),vr=e,c}function fN(t){var e=t.t||"",n=1,a=Dt(3+(n>1?2:0));a.write_shift(2,e.length),a.write_shift(1,(n>1?8:0)|1),n>1&&a.write_shift(2,n);var i=Dt(2*e.length);i.write_shift(2*e.length,e,"utf16le");var s=[a,i];return Yi(s)}function nu(t,e,n){var a;if(n){if(n.biff>=2&&n.biff<=5)return t.read_shift(e,"cpstr");if(n.biff>=12)return t.read_shift(e,"dbcs-cont")}var i=t.read_shift(1);return i===0?a=t.read_shift(e,"sbcs-cont"):a=t.read_shift(e,"dbcs-cont"),a}function Ag(t,e,n){var a=t.read_shift(n&&n.biff==2?1:2);return a===0?(t.l++,""):nu(t,a,n)}function au(t,e,n){if(n.biff>5)return Ag(t,e,n);var a=t.read_shift(1);return a===0?(t.l++,""):t.read_shift(a,n.biff<=4||!t.lens?"cpstr":"sbcs-cont")}function gD(t,e,n){return n||(n=Dt(3+2*t.length)),n.write_shift(2,t.length),n.write_shift(1,1),n.write_shift(31,t,"utf16le"),n}function pN(t){var e=t.read_shift(1);t.l++;var n=t.read_shift(2);return t.l+=2,[e,n]}function hN(t){var e=t.read_shift(4),n=t.l,a=!1;e>24&&(t.l+=e-24,t.read_shift(16)==="795881f43b1d7f48af2c825dc4852763"&&(a=!0),t.l=n);var i=t.read_shift((a?e-24:e)>>1,"utf16le").replace(hs,"");return a&&(t.l+=24),i}function gN(t){for(var e=t.read_shift(2),n="";e-- >0;)n+="../";var a=t.read_shift(0,"lpstr-ansi");if(t.l+=2,t.read_shift(2)!=57005)throw new Error("Bad FileMoniker");var i=t.read_shift(4);if(i===0)return n+a.replace(/\\/g,"/");var s=t.read_shift(4);if(t.read_shift(2)!=3)throw new Error("Bad FileMoniker");var r=t.read_shift(s>>1,"utf16le").replace(hs,"");return n+r}function mN(t,e){var n=t.read_shift(16);switch(e-=16,n){case"e0c9ea79f9bace118c8200aa004ba90b":return hN(t,e);case"0303000000000000c000000000000046":return gN(t,e);default:throw new Error("Unsupported Moniker "+n)}}function j_(t){var e=t.read_shift(4),n=e>0?t.read_shift(e,"utf16le").replace(hs,""):"";return n}function mD(t,e){e||(e=Dt(6+t.length*2)),e.write_shift(4,1+t.length);for(var n=0;n<t.length;++n)e.write_shift(2,t.charCodeAt(n));return e.write_shift(2,0),e}function bN(t,e){var n=t.l+e,a=t.read_shift(4);if(a!==2)throw new Error("Unrecognized streamVersion: "+a);var i=t.read_shift(2);t.l+=2;var s,r,o,l,c="",d,u;i&16&&(s=j_(t,n-t.l)),i&128&&(r=j_(t,n-t.l)),(i&257)===257&&(o=j_(t,n-t.l)),(i&257)===1&&(l=mN(t,n-t.l)),i&8&&(c=j_(t,n-t.l)),i&32&&(d=t.read_shift(16)),i&64&&(u=H1(t)),t.l=n;var g=r||o||l||"";g&&c&&(g+="#"+c),g||(g="#"+c),i&2&&g.charAt(0)=="/"&&g.charAt(1)!="/"&&(g="file://"+g);var f={Target:g};return d&&(f.guid=d),u&&(f.time=u),s&&(f.Tooltip=s),f}function yN(t){var e=Dt(512),n=0,a=t.Target;a.slice(0,7)=="file://"&&(a=a.slice(7));var i=a.indexOf("#"),s=i>-1?31:23;switch(a.charAt(0)){case"#":s=28;break;case".":s&=-3;break}e.write_shift(4,2),e.write_shift(4,s);var r=[8,6815827,6619237,4849780,83];for(n=0;n<r.length;++n)e.write_shift(4,r[n]);if(s==28)a=a.slice(1),mD(a,e);else if(s&2){for(r="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),n=0;n<r.length;++n)e.write_shift(1,parseInt(r[n],16));var o=i>-1?a.slice(0,i):a;for(e.write_shift(4,2*(o.length+1)),n=0;n<o.length;++n)e.write_shift(2,o.charCodeAt(n));e.write_shift(2,0),s&8&&mD(i>-1?a.slice(i+1):"",e)}else{for(r="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),n=0;n<r.length;++n)e.write_shift(1,parseInt(r[n],16));for(var l=0;a.slice(l*3,l*3+3)=="../"||a.slice(l*3,l*3+3)=="..\\";)++l;for(e.write_shift(2,l),e.write_shift(4,a.length-3*l+1),n=0;n<a.length-3*l;++n)e.write_shift(1,a.charCodeAt(n+3*l)&255);for(e.write_shift(1,0),e.write_shift(2,65535),e.write_shift(2,57005),n=0;n<6;++n)e.write_shift(4,0)}return e.slice(0,e.l)}function bD(t){var e=t.read_shift(1),n=t.read_shift(1),a=t.read_shift(1),i=t.read_shift(1);return[e,n,a,i]}function yD(t,e){var n=bD(t,e);return n[3]=0,n}function Zo(t){var e=t.read_shift(2),n=t.read_shift(2),a=t.read_shift(2);return{r:e,c:n,ixfe:a}}function iu(t,e,n,a){return a||(a=Dt(6)),a.write_shift(2,t),a.write_shift(2,e),a.write_shift(2,n||0),a}function _N(t){var e=t.read_shift(2),n=t.read_shift(2);return t.l+=8,{type:e,flags:n}}function wN(t,e,n){return e===0?"":au(t,e,n)}function vN(t,e,n){var a=n.biff>8?4:2,i=t.read_shift(a),s=t.read_shift(a,"i"),r=t.read_shift(a,"i");return[i,s,r]}function _D(t){var e=t.read_shift(2),n=M1(t);return[e,n]}function xN(t,e,n){t.l+=4,e-=4;var a=t.l+e,i=Sg(t,e,n),s=t.read_shift(2);if(a-=t.l,s!==a)throw new Error("Malformed AddinUdf: padding = "+a+" != "+s);return t.l+=s,i}function K_(t){var e=t.read_shift(2),n=t.read_shift(2),a=t.read_shift(2),i=t.read_shift(2);return{s:{c:a,r:e},e:{c:i,r:n}}}function wD(t,e){return e||(e=Dt(8)),e.write_shift(2,t.s.r),e.write_shift(2,t.e.r),e.write_shift(2,t.s.c),e.write_shift(2,t.e.c),e}function vD(t){var e=t.read_shift(2),n=t.read_shift(2),a=t.read_shift(1),i=t.read_shift(1);return{s:{c:a,r:e},e:{c:i,r:n}}}var EN=vD;function xD(t){t.l+=4;var e=t.read_shift(2),n=t.read_shift(2),a=t.read_shift(2);return t.l+=12,[n,e,a]}function kN(t){var e={};return t.l+=4,t.l+=16,e.fSharedNote=t.read_shift(2),t.l+=4,e}function SN(t){var e={};return t.l+=4,t.cf=t.read_shift(2),e}function _s(t){t.l+=2,t.l+=t.read_shift(2)}var AN={0:_s,4:_s,5:_s,6:_s,7:SN,8:_s,9:_s,10:_s,11:_s,12:_s,13:kN,14:_s,15:_s,16:_s,17:_s,18:_s,19:_s,20:_s,21:xD};function TN(t,e){for(var n=t.l+e,a=[];t.l<n;){var i=t.read_shift(2);t.l-=2;try{a.push(AN[i](t,n-t.l))}catch(s){return t.l=n,a}}return t.l!=n&&(t.l=n),a}function X_(t,e){var n={BIFFVer:0,dt:0};switch(n.BIFFVer=t.read_shift(2),e-=2,e>=2&&(n.dt=t.read_shift(2),t.l-=2),n.BIFFVer){case 1536:case 1280:case 1024:case 768:case 512:case 2:case 7:break;default:if(e>6)throw new Error("Unexpected BIFF Ver "+n.BIFFVer)}return t.read_shift(e),n}function W1(t,e,n){var a=1536,i=16;switch(n.bookType){case"biff8":break;case"biff5":a=1280,i=8;break;case"biff4":a=4,i=6;break;case"biff3":a=3,i=6;break;case"biff2":a=2,i=4;break;case"xla":break;default:throw new Error("unsupported BIFF version")}var s=Dt(i);return s.write_shift(2,a),s.write_shift(2,e),i>4&&s.write_shift(2,29282),i>6&&s.write_shift(2,1997),i>8&&(s.write_shift(2,49161),s.write_shift(2,1),s.write_shift(2,1798),s.write_shift(2,0)),s}function DN(t,e){return e===0||t.read_shift(2),1200}function CN(t,e,n){if(n.enc)return t.l+=e,"";var a=t.l,i=au(t,0,n);return t.read_shift(e+a-t.l),i}function LN(t,e){var n=!e||e.biff==8,a=Dt(n?112:54);for(a.write_shift(e.biff==8?2:1,7),n&&a.write_shift(1,0),a.write_shift(4,859007059),a.write_shift(4,5458548|(n?0:536870912));a.l<a.length;)a.write_shift(1,n?0:32);return a}function IN(t,e,n){var a=n&&n.biff==8||e==2?t.read_shift(2):(t.l+=e,0);return{fDialog:a&16,fBelow:a&64,fRight:a&128}}function MN(t,e,n){var a=t.read_shift(4),i=t.read_shift(1)&3,s=t.read_shift(1);switch(s){case 0:s="Worksheet";break;case 1:s="Macrosheet";break;case 2:s="Chartsheet";break;case 6:s="VBAModule";break}var r=Sg(t,0,n);return r.length===0&&(r="Sheet1"),{pos:a,hs:i,dt:s,name:r}}function FN(t,e){var n=!e||e.biff>=8?2:1,a=Dt(8+n*t.name.length);a.write_shift(4,t.pos),a.write_shift(1,t.hs||0),a.write_shift(1,t.dt),a.write_shift(1,t.name.length),e.biff>=8&&a.write_shift(1,1),a.write_shift(n*t.name.length,t.name,e.biff<8?"sbcs":"utf16le");var i=a.slice(0,a.l);return i.l=a.l,i}function PN(t,e){for(var n=t.l+e,a=t.read_shift(4),i=t.read_shift(4),s=[],r=0;r!=i&&t.l<n;++r)s.push(uN(t));return s.Count=a,s.Unique=i,s}function NN(t,e){var n=Dt(8);n.write_shift(4,t.Count),n.write_shift(4,t.Unique);for(var a=[],i=0;i<t.length;++i)a[i]=fN(t[i],e);var s=Yi([n].concat(a));return s.parts=[n.length].concat(a.map(function(r){return r.length})),s}function BN(t,e){var n={};return n.dsst=t.read_shift(2),t.l+=e-2,n}function $N(t){var e={};e.r=t.read_shift(2),e.c=t.read_shift(2),e.cnt=t.read_shift(2)-e.c;var n=t.read_shift(2);t.l+=4;var a=t.read_shift(1);return t.l+=3,a&7&&(e.level=a&7),a&32&&(e.hidden=!0),a&64&&(e.hpt=n/20),e}function ON(t){var e=_N(t);if(e.type!=2211)throw new Error("Invalid Future Record "+e.type);var n=t.read_shift(4);return n!==0}function RN(t){return t.read_shift(2),t.read_shift(4)}function ED(t,e,n){var a=0;n&&n.biff==2||(a=t.read_shift(2));var i=t.read_shift(2);n&&n.biff==2&&(a=1-(i>>15),i&=32767);var s={Unsynced:a&1,DyZero:(a&2)>>1,ExAsc:(a&4)>>2,ExDsc:(a&8)>>3};return[s,i]}function UN(t){var e=t.read_shift(2),n=t.read_shift(2),a=t.read_shift(2),i=t.read_shift(2),s=t.read_shift(2),r=t.read_shift(2),o=t.read_shift(2),l=t.read_shift(2),c=t.read_shift(2);return{Pos:[e,n],Dim:[a,i],Flags:s,CurTab:r,FirstTab:o,Selected:l,TabRatio:c}}function HN(){var t=Dt(18);return t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,29280),t.write_shift(2,17600),t.write_shift(2,56),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,1),t.write_shift(2,500),t}function qN(t,e,n){if(n&&n.biff>=2&&n.biff<5)return{};var a=t.read_shift(2);return{RTL:a&64}}function WN(t){var e=Dt(18),n=1718;return t&&t.RTL&&(n|=64),e.write_shift(2,n),e.write_shift(4,0),e.write_shift(4,64),e.write_shift(4,0),e.write_shift(4,0),e}function VN(){}function zN(t,e,n){var a={dyHeight:t.read_shift(2),fl:t.read_shift(2)};switch(n&&n.biff||8){case 2:break;case 3:case 4:t.l+=2;break;default:t.l+=10;break}return a.name=Sg(t,0,n),a}function YN(t,e){var n=t.name||"Arial",a=e&&e.biff==5,i=a?15+n.length:16+2*n.length,s=Dt(i);return s.write_shift(2,(t.sz||12)*20),s.write_shift(4,0),s.write_shift(2,400),s.write_shift(4,0),s.write_shift(2,0),s.write_shift(1,n.length),a||s.write_shift(1,1),s.write_shift((a?1:2)*n.length,n,a?"sbcs":"utf16le"),s}function GN(t){var e=Zo(t);return e.isst=t.read_shift(4),e}function jN(t,e,n,a){var i=Dt(10);return iu(t,e,a,i),i.write_shift(4,n),i}function KN(t,e,n){n.biffguess&&n.biff==2&&(n.biff=5);var a=t.l+e,i=Zo(t,6);n.biff==2&&t.l++;var s=Ag(t,a-t.l,n);return i.val=s,i}function XN(t,e,n,a,i){var s=!i||i.biff==8,r=Dt(8+ +s+(1+s)*n.length);return iu(t,e,a,r),r.write_shift(2,n.length),s&&r.write_shift(1,1),r.write_shift((1+s)*n.length,n,s?"utf16le":"sbcs"),r}function ZN(t,e,n){var a=t.read_shift(2),i=au(t,0,n);return[a,i]}function JN(t,e,n,a){var i=n&&n.biff==5;a||(a=Dt(i?3+e.length:5+2*e.length)),a.write_shift(2,t),a.write_shift(i?1:2,e.length),i||a.write_shift(1,1),a.write_shift((i?1:2)*e.length,e,i?"sbcs":"utf16le");var s=a.length>a.l?a.slice(0,a.l):a;return s.l==null&&(s.l=s.length),s}var QN=au;function kD(t,e,n){var a=t.l+e,i=n.biff==8||!n.biff?4:2,s=t.read_shift(i),r=t.read_shift(i),o=t.read_shift(2),l=t.read_shift(2);return t.l=a,{s:{r:s,c:o},e:{r,c:l}}}function eB(t,e){var n=e.biff==8||!e.biff?4:2,a=Dt(2*n+6);return a.write_shift(n,t.s.r),a.write_shift(n,t.e.r+1),a.write_shift(2,t.s.c),a.write_shift(2,t.e.c+1),a.write_shift(2,0),a}function tB(t){var e=t.read_shift(2),n=t.read_shift(2),a=_D(t);return{r:e,c:n,ixfe:a[0],rknum:a[1]}}function nB(t,e){for(var n=t.l+e-2,a=t.read_shift(2),i=t.read_shift(2),s=[];t.l<n;)s.push(_D(t));if(t.l!==n)throw new Error("MulRK read error");var r=t.read_shift(2);if(s.length!=r-i+1)throw new Error("MulRK length mismatch");return{r:a,c:i,C:r,rkrec:s}}function aB(t,e){for(var n=t.l+e-2,a=t.read_shift(2),i=t.read_shift(2),s=[];t.l<n;)s.push(t.read_shift(2));if(t.l!==n)throw new Error("MulBlank read error");var r=t.read_shift(2);if(s.length!=r-i+1)throw new Error("MulBlank length mismatch");return{r:a,c:i,C:r,ixfe:s}}function iB(t,e,n,a){var i={},s=t.read_shift(4),r=t.read_shift(4),o=t.read_shift(4),l=t.read_shift(2);return i.patternType=$8[o>>26],a.cellStyles&&(i.alc=s&7,i.fWrap=s>>3&1,i.alcV=s>>4&7,i.fJustLast=s>>7&1,i.trot=s>>8&255,i.cIndent=s>>16&15,i.fShrinkToFit=s>>20&1,i.iReadOrder=s>>22&2,i.fAtrNum=s>>26&1,i.fAtrFnt=s>>27&1,i.fAtrAlc=s>>28&1,i.fAtrBdr=s>>29&1,i.fAtrPat=s>>30&1,i.fAtrProt=s>>31&1,i.dgLeft=r&15,i.dgRight=r>>4&15,i.dgTop=r>>8&15,i.dgBottom=r>>12&15,i.icvLeft=r>>16&127,i.icvRight=r>>23&127,i.grbitDiag=r>>30&3,i.icvTop=o&127,i.icvBottom=o>>7&127,i.icvDiag=o>>14&127,i.dgDiag=o>>21&15,i.icvFore=l&127,i.icvBack=l>>7&127,i.fsxButton=l>>14&1),i}function sB(t,e,n){var a={};return a.ifnt=t.read_shift(2),a.numFmtId=t.read_shift(2),a.flags=t.read_shift(2),a.fStyle=a.flags>>2&1,e-=6,a.data=iB(t,e,a.fStyle,n),a}function SD(t,e,n,a){var i=n&&n.biff==5;a||(a=Dt(i?16:20)),a.write_shift(2,0),t.style?(a.write_shift(2,t.numFmtId||0),a.write_shift(2,65524)):(a.write_shift(2,t.numFmtId||0),a.write_shift(2,e<<4));var s=0;return t.numFmtId>0&&i&&(s|=1024),a.write_shift(4,s),a.write_shift(4,0),i||a.write_shift(4,0),a.write_shift(2,0),a}function rB(t){t.l+=4;var e=[t.read_shift(2),t.read_shift(2)];if(e[0]!==0&&e[0]--,e[1]!==0&&e[1]--,e[0]>7||e[1]>7)throw new Error("Bad Gutters: "+e.join("|"));return e}function oB(t){var e=Dt(8);return e.write_shift(4,0),e.write_shift(2,t[0]?t[0]+1:0),e.write_shift(2,t[1]?t[1]+1:0),e}function AD(t,e,n){var a=Zo(t,6);(n.biff==2||e==9)&&++t.l;var i=dN(t,2);return a.val=i,a.t=i===!0||i===!1?"b":"e",a}function lB(t,e,n,a,i,s){var r=Dt(8);return iu(t,e,a,r),hD(n,s,r),r}function cB(t,e,n){n.biffguess&&n.biff==2&&(n.biff=5);var a=Zo(t,6),i=ys(t,8);return a.val=i,a}function dB(t,e,n,a){var i=Dt(14);return iu(t,e,a,i),Qd(n,i),i}var TD=wN;function uB(t,e,n){var a=t.l+e,i=t.read_shift(2),s=t.read_shift(2);if(n.sbcch=s,s==1025||s==14849)return[s,i];if(s<1||s>255)throw new Error("Unexpected SupBook type: "+s);for(var r=nu(t,s),o=[];a>t.l;)o.push(Ag(t));return[s,i,r,o]}function DD(t,e,n){var a=t.read_shift(2),i,s={fBuiltIn:a&1,fWantAdvise:a>>>1&1,fWantPict:a>>>2&1,fOle:a>>>3&1,fOleLink:a>>>4&1,cf:a>>>5&1023,fIcon:a>>>15&1};return n.sbcch===14849&&(i=xN(t,e-2,n)),s.body=i||t.read_shift(e-2),typeof i=="string"&&(s.Name=i),s}var fB=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function CD(t,e,n){var a=t.l+e,i=t.read_shift(2),s=t.read_shift(1),r=t.read_shift(1),o=t.read_shift(n&&n.biff==2?1:2),l=0;(!n||n.biff>=5)&&(n.biff!=5&&(t.l+=2),l=t.read_shift(2),n.biff==5&&(t.l+=2),t.l+=4);var c=nu(t,r,n);i&32&&(c=fB[c.charCodeAt(0)]);var d=a-t.l;n&&n.biff==2&&--d;var u=a==t.l||o===0||!(d>0)?[]:TU(t,d,n,o);return{chKey:s,Name:c,itab:l,rgce:u}}function LD(t,e,n){if(n.biff<8)return pB(t,e,n);for(var a=[],i=t.l+e,s=t.read_shift(n.biff>8?4:2);s--!==0;)a.push(vN(t,n.biff>8?12:6,n));if(t.l!=i)throw new Error("Bad ExternSheet: "+t.l+" != "+i);return a}function pB(t,e,n){t[t.l+1]==3&&t[t.l]++;var a=Sg(t,e,n);return a.charCodeAt(0)==3?a.slice(1):a}function hB(t,e,n){if(n.biff<8){t.l+=e;return}var a=t.read_shift(2),i=t.read_shift(2),s=nu(t,a,n),r=nu(t,i,n);return[s,r]}function gB(t,e,n){var a=vD(t,6);t.l++;var i=t.read_shift(1);return e-=8,[DU(t,e,n),i,a]}function ID(t,e,n){var a=EN(t,6);switch(n.biff){case 2:t.l++,e-=7;break;case 3:case 4:t.l+=2,e-=8;break;default:t.l+=6,e-=12}return[a,SU(t,e,n,a)]}function mB(t){var e=t.read_shift(4)!==0,n=t.read_shift(4)!==0,a=t.read_shift(4);return[e,n,a]}function bB(t,e,n){if(!(n.biff<8)){var a=t.read_shift(2),i=t.read_shift(2),s=t.read_shift(2),r=t.read_shift(2),o=au(t,0,n);return n.biff<8&&t.read_shift(1),[{r:a,c:i},o,r,s]}}function yB(t,e,n){return bB(t,e,n)}function _B(t,e){for(var n=[],a=t.read_shift(2);a--;)n.push(K_(t,e));return n}function wB(t){var e=Dt(2+t.length*8);e.write_shift(2,t.length);for(var n=0;n<t.length;++n)wD(t[n],e);return e}function vB(t,e,n){if(n&&n.biff<8)return EB(t,e,n);var a=xD(t,22),i=TN(t,e-22,a[1]);return{cmo:a,ft:i}}var xB={8:function(t,e){var n=t.l+e;t.l+=10;var a=t.read_shift(2);t.l+=4,t.l+=2,t.l+=2,t.l+=2,t.l+=4;var i=t.read_shift(1);return t.l+=i,t.l=n,{fmt:a}}};function EB(t,e,n){t.l+=4;var a=t.read_shift(2),i=t.read_shift(2),s=t.read_shift(2);t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=2,t.l+=6,e-=36;var r=[];return r.push((xB[a]||ms)(t,e,n)),{cmo:[i,a,s],ft:r}}function kB(t,e,n){var a=t.l,i="";try{t.l+=4;var s=(n.lastobj||{cmo:[0,0]}).cmo[1],r;[0,5,7,11,12,14].indexOf(s)==-1?t.l+=6:r=pN(t,6,n);var o=t.read_shift(2);t.read_shift(2),Li(t,2);var l=t.read_shift(2);t.l+=l;for(var c=1;c<t.lens.length-1;++c){if(t.l-a!=t.lens[c])throw new Error("TxO: bad continue record");var d=t[t.l],u=nu(t,t.lens[c+1]-t.lens[c]-1);if(i+=u,i.length>=(d?o:2*o))break}if(i.length!==o&&i.length!==o*2)throw new Error("cchText: "+o+" != "+i.length);return t.l=a+e,{t:i}}catch(g){return t.l=a+e,{t:i}}}function SB(t,e){var n=K_(t,8);t.l+=16;var a=bN(t,e-24);return[n,a]}function AB(t){var e=Dt(24),n=ti(t[0]);e.write_shift(2,n.r),e.write_shift(2,n.r),e.write_shift(2,n.c),e.write_shift(2,n.c);for(var a="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),i=0;i<16;++i)e.write_shift(1,parseInt(a[i],16));return Yi([e,yN(t[1])])}function TB(t,e){t.read_shift(2);var n=K_(t,8),a=t.read_shift((e-10)/2,"dbcs-cont");return a=a.replace(hs,""),[n,a]}function DB(t){var e=t[1].Tooltip,n=Dt(10+2*(e.length+1));n.write_shift(2,2048);var a=ti(t[0]);n.write_shift(2,a.r),n.write_shift(2,a.r),n.write_shift(2,a.c),n.write_shift(2,a.c);for(var i=0;i<e.length;++i)n.write_shift(2,e.charCodeAt(i));return n.write_shift(2,0),n}function CB(t){var e=[0,0],n;return n=t.read_shift(2),e[0]=Y3[n]||n,n=t.read_shift(2),e[1]=Y3[n]||n,e}function LB(t){return t||(t=Dt(4)),t.write_shift(2,1),t.write_shift(2,1),t}function IB(t){for(var e=t.read_shift(2),n=[];e-- >0;)n.push(yD(t,8));return n}function MB(t){for(var e=t.read_shift(2),n=[];e-- >0;)n.push(yD(t,8));return n}function FB(t){t.l+=2;var e={cxfs:0,crc:0};return e.cxfs=t.read_shift(2),e.crc=t.read_shift(4),e}function MD(t,e,n){if(!n.cellStyles)return ms(t,e);var a=n&&n.biff>=12?4:2,i=t.read_shift(a),s=t.read_shift(a),r=t.read_shift(a),o=t.read_shift(a),l=t.read_shift(2);a==2&&(t.l+=2);var c={s:i,e:s,w:r,ixfe:o,flags:l};return(n.biff>=5||!n.biff)&&(c.level=l>>8&7),c}function PB(t,e){var n=Dt(12);n.write_shift(2,e),n.write_shift(2,e),n.write_shift(2,t.width*256),n.write_shift(2,0);var a=0;return t.hidden&&(a|=1),n.write_shift(1,a),a=t.level||0,n.write_shift(1,a),n.write_shift(2,0),n}function NB(t,e){var n={};return e<32||(t.l+=16,n.header=ys(t,8),n.footer=ys(t,8),t.l+=2),n}function BB(t,e,n){var a={area:!1};if(n.biff!=5)return t.l+=e,a;var i=t.read_shift(1);return t.l+=3,i&16&&(a.area=!0),a}function $B(t){for(var e=Dt(2*t),n=0;n<t;++n)e.write_shift(2,n+1);return e}var OB=Zo,RB=pD,UB=Ag;function HB(t){var e=t.read_shift(2),n=t.read_shift(2),a=t.read_shift(4),i={fmt:e,env:n,len:a,data:t.slice(t.l,t.l+a)};return t.l+=a,i}function qB(t,e,n){n.biffguess&&n.biff==5&&(n.biff=2);var a=Zo(t,6);++t.l;var i=au(t,e-7,n);return a.t="str",a.val=i,a}function WB(t){var e=Zo(t,6);++t.l;var n=ys(t,8);return e.t="n",e.val=n,e}function VB(t,e,n){var a=Dt(15);return Ug(a,t,e),a.write_shift(8,n,"f"),a}function zB(t){var e=Zo(t,6);++t.l;var n=t.read_shift(2);return e.t="n",e.val=n,e}function YB(t,e,n){var a=Dt(9);return Ug(a,t,e),a.write_shift(2,n),a}function GB(t){var e=t.read_shift(1);return e===0?(t.l++,""):t.read_shift(e,"sbcs-cont")}function jB(t,e){t.l+=6,t.l+=2,t.l+=1,t.l+=3,t.l+=1,t.l+=e-13}function KB(t,e,n){var a=t.l+e,i=Zo(t,6),s=t.read_shift(2),r=nu(t,s,n);return t.l=a,i.t="str",i.val=r,i}var XB=[2,3,48,49,131,139,140,245],V1=function(){var t={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},e=P_({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function n(o,l){var c=[],d=pc(1);switch(l.type){case"base64":d=Er(xr(o));break;case"binary":d=Er(o);break;case"buffer":case"array":d=o;break}as(d,0);var u=d.read_shift(1),g=!!(u&136),f=!1,h=!1;switch(u){case 2:break;case 3:break;case 48:f=!0,g=!0;break;case 49:f=!0,g=!0;break;case 131:break;case 139:break;case 140:h=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+u.toString(16))}var m=0,b=521;u==2&&(m=d.read_shift(2)),d.l+=3,u!=2&&(m=d.read_shift(4)),m>1048576&&(m=1e6),u!=2&&(b=d.read_shift(2));var y=d.read_shift(2),_=l.codepage||1252;u!=2&&(d.l+=16,d.read_shift(1),d[d.l]!==0&&(_=t[d[d.l]]),d.l+=1,d.l+=2),h&&(d.l+=36);for(var v=[],U={},ee=Math.min(d.length,u==2?521:b-10-(f?264:0)),Z=h?32:11;d.l<ee&&d[d.l]!=13;)switch(U={},U.name=pa.utils.decode(_,d.slice(d.l,d.l+Z)).replace(/[\u0000\r\n].*$/g,""),d.l+=Z,U.type=String.fromCharCode(d.read_shift(1)),u!=2&&!h&&(U.offset=d.read_shift(4)),U.len=d.read_shift(1),u==2&&(U.offset=d.read_shift(2)),U.dec=d.read_shift(1),U.name.length&&v.push(U),u!=2&&(d.l+=h?13:14),U.type){case"B":(!f||U.len!=8)&&l.WTF&&console.log("Skipping "+U.name+":"+U.type);break;case"G":case"P":l.WTF&&console.log("Skipping "+U.name+":"+U.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+U.type)}if(d[d.l]!==13&&(d.l=b-1),d.read_shift(1)!==13)throw new Error("DBF Terminator not found "+d.l+" "+d[d.l]);d.l=b;var k=0,w=0;for(c[0]=[],w=0;w!=v.length;++w)c[0][w]=v[w].name;for(;m-- >0;){if(d[d.l]===42){d.l+=y;continue}for(++d.l,c[++k]=[],w=0,w=0;w!=v.length;++w){var S=d.slice(d.l,d.l+v[w].len);d.l+=v[w].len,as(S,0);var B=pa.utils.decode(_,S);switch(v[w].type){case"C":B.trim().length&&(c[k][w]=B.replace(/\s+$/,""));break;case"D":B.length===8?c[k][w]=new Date(+B.slice(0,4),+B.slice(4,6)-1,+B.slice(6,8)):c[k][w]=B;break;case"F":c[k][w]=parseFloat(B.trim());break;case"+":case"I":c[k][w]=h?S.read_shift(-4,"i")^2147483648:S.read_shift(4,"i");break;case"L":switch(B.trim().toUpperCase()){case"Y":case"T":c[k][w]=!0;break;case"N":case"F":c[k][w]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+B+"|")}break;case"M":if(!g)throw new Error("DBF Unexpected MEMO for type "+u.toString(16));c[k][w]="##MEMO##"+(h?parseInt(B.trim(),10):S.read_shift(4));break;case"N":B=B.replace(/\u0000/g,"").trim(),B&&B!="."&&(c[k][w]=+B||0);break;case"@":c[k][w]=new Date(S.read_shift(-8,"f")-621356832e5);break;case"T":c[k][w]=new Date((S.read_shift(4)-2440588)*864e5+S.read_shift(4));break;case"Y":c[k][w]=S.read_shift(4,"i")/1e4+S.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":c[k][w]=-S.read_shift(-8,"f");break;case"B":if(f&&v[w].len==8){c[k][w]=S.read_shift(8,"f");break}case"G":case"P":S.l+=v[w].len;break;case"0":if(v[w].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+v[w].type)}}}if(u!=2&&d.l<d.length&&d[d.l++]!=26)throw new Error("DBF EOF Marker missing "+(d.l-1)+" of "+d.length+" "+d[d.l-1].toString(16));return l&&l.sheetRows&&(c=c.slice(0,l.sheetRows)),l.DBF=v,c}function a(o,l){var c=l||{};c.dateNF||(c.dateNF="yyyymmdd");var d=Xf(n(o,c),c);return d["!cols"]=c.DBF.map(function(u){return{wch:u.len,DBF:u}}),delete c.DBF,d}function i(o,l){try{return _c(a(o,l),l)}catch(c){if(l&&l.WTF)throw c}return{SheetNames:[],Sheets:{}}}var s={B:8,C:250,L:1,D:8,"?":0,"":0};function r(o,l){var c=l||{};if(+c.codepage>=0&&Or(+c.codepage),c.type=="string")throw new Error("Cannot write DBF to JS string");var d=Us(),u=ow(o,{header:1,raw:!0,cellDates:!0}),g=u[0],f=u.slice(1),h=o["!cols"]||[],m=0,b=0,y=0,_=1;for(m=0;m<g.length;++m){if(((h[m]||{}).DBF||{}).name){g[m]=h[m].DBF.name,++y;continue}if(g[m]!=null){if(++y,typeof g[m]=="number"&&(g[m]=g[m].toString(10)),typeof g[m]!="string")throw new Error("DBF Invalid column name "+g[m]+" |"+typeof g[m]+"|");if(g.indexOf(g[m])!==m){for(b=0;b<1024;++b)if(g.indexOf(g[m]+"_"+b)==-1){g[m]+="_"+b;break}}}}var v=oa(o["!ref"]),U=[],ee=[],Z=[];for(m=0;m<=v.e.c-v.s.c;++m){var k="",w="",S=0,B=[];for(b=0;b<f.length;++b)f[b][m]!=null&&B.push(f[b][m]);if(B.length==0||g[m]==null){U[m]="?";continue}for(b=0;b<B.length;++b){switch(typeof B[b]){case"number":w="B";break;case"string":w="C";break;case"boolean":w="L";break;case"object":w=B[b]instanceof Date?"D":"C";break;default:w="C"}S=Math.max(S,String(B[b]).length),k=k&&k!=w?"C":w}S>250&&(S=250),w=((h[m]||{}).DBF||{}).type,w=="C"&&h[m].DBF.len>S&&(S=h[m].DBF.len),k=="B"&&w=="N"&&(k="N",Z[m]=h[m].DBF.dec,S=h[m].DBF.len),ee[m]=k=="C"||w=="N"?S:s[k]||0,_+=ee[m],U[m]=k}var H=d.next(32);for(H.write_shift(4,318902576),H.write_shift(4,f.length),H.write_shift(2,296+32*y),H.write_shift(2,_),m=0;m<4;++m)H.write_shift(4,0);for(H.write_shift(4,0|(+e[Vd]||3)<<8),m=0,b=0;m<g.length;++m)if(g[m]!=null){var j=d.next(32),re=(g[m].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);j.write_shift(1,re,"sbcs"),j.write_shift(1,U[m]=="?"?"C":U[m],"sbcs"),j.write_shift(4,b),j.write_shift(1,ee[m]||s[U[m]]||0),j.write_shift(1,Z[m]||0),j.write_shift(1,2),j.write_shift(4,0),j.write_shift(1,0),j.write_shift(4,0),j.write_shift(4,0),b+=ee[m]||s[U[m]]||0}var Te=d.next(264);for(Te.write_shift(4,13),m=0;m<65;++m)Te.write_shift(4,0);for(m=0;m<f.length;++m){var Be=d.next(_);for(Be.write_shift(1,0),b=0;b<g.length;++b)if(g[b]!=null)switch(U[b]){case"L":Be.write_shift(1,f[m][b]==null?63:f[m][b]?84:70);break;case"B":Be.write_shift(8,f[m][b]||0,"f");break;case"N":var Ie="0";for(typeof f[m][b]=="number"&&(Ie=f[m][b].toFixed(Z[b]||0)),y=0;y<ee[b]-Ie.length;++y)Be.write_shift(1,32);Be.write_shift(1,Ie,"sbcs");break;case"D":f[m][b]?(Be.write_shift(4,("0000"+f[m][b].getFullYear()).slice(-4),"sbcs"),Be.write_shift(2,("00"+(f[m][b].getMonth()+1)).slice(-2),"sbcs"),Be.write_shift(2,("00"+f[m][b].getDate()).slice(-2),"sbcs")):Be.write_shift(8,"00000000","sbcs");break;case"C":var Ce=String(f[m][b]!=null?f[m][b]:"").slice(0,ee[b]);for(Be.write_shift(1,Ce,"sbcs"),y=0;y<ee[b]-Ce.length;++y)Be.write_shift(1,32);break}}return d.next(1).write_shift(1,26),d.end()}return{to_workbook:i,to_sheet:a,from_sheet:r}}(),FD=function(){var t={AA:"\xC0",BA:"\xC1",CA:"\xC2",DA:195,HA:"\xC4",JA:197,AE:"\xC8",BE:"\xC9",CE:"\xCA",HE:"\xCB",AI:"\xCC",BI:"\xCD",CI:"\xCE",HI:"\xCF",AO:"\xD2",BO:"\xD3",CO:"\xD4",DO:213,HO:"\xD6",AU:"\xD9",BU:"\xDA",CU:"\xDB",HU:"\xDC",Aa:"\xE0",Ba:"\xE1",Ca:"\xE2",Da:227,Ha:"\xE4",Ja:229,Ae:"\xE8",Be:"\xE9",Ce:"\xEA",He:"\xEB",Ai:"\xEC",Bi:"\xED",Ci:"\xEE",Hi:"\xEF",Ao:"\xF2",Bo:"\xF3",Co:"\xF4",Do:245,Ho:"\xF6",Au:"\xF9",Bu:"\xFA",Cu:"\xFB",Hu:"\xFC",KC:"\xC7",Kc:"\xE7",q:"\xE6",z:"\u0153",a:"\xC6",j:"\u0152",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},e=new RegExp("\x1BN("+oi(t).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),n=function(g,f){var h=t[f];return typeof h=="number"?s1(h):h},a=function(g,f,h){var m=f.charCodeAt(0)-32<<4|h.charCodeAt(0)-48;return m==59?g:s1(m)};t["|"]=254;function i(g,f){switch(f.type){case"base64":return s(xr(g),f);case"binary":return s(g,f);case"buffer":return s(Jn&&Buffer.isBuffer(g)?g.toString("binary"):hc(g),f);case"array":return s(Gd(g),f)}throw new Error("Unrecognized type "+f.type)}function s(g,f){var h=g.split(/[\n\r]+/),m=-1,b=-1,y=0,_=0,v=[],U=[],ee=null,Z={},k=[],w=[],S=[],B=0,H;for(+f.codepage>=0&&Or(+f.codepage);y!==h.length;++y){B=0;var j=h[y].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,a).replace(e,n),re=j.replace(/;;/g,"\0").split(";").map(function(He){return He.replace(/\u0000/g,";")}),Te=re[0],Be;if(j.length>0)switch(Te){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":re[1].charAt(0)=="P"&&U.push(j.slice(3).replace(/;;/g,";"));break;case"C":var Ie=!1,Ce=!1,Je=!1,ze=!1,Ze=-1,ht=-1;for(_=1;_<re.length;++_)switch(re[_].charAt(0)){case"A":break;case"X":b=parseInt(re[_].slice(1))-1,Ce=!0;break;case"Y":for(m=parseInt(re[_].slice(1))-1,Ce||(b=0),H=v.length;H<=m;++H)v[H]=[];break;case"K":Be=re[_].slice(1),Be.charAt(0)==='"'?Be=Be.slice(1,Be.length-1):Be==="TRUE"?Be=!0:Be==="FALSE"?Be=!1:isNaN(vo(Be))?isNaN(Gf(Be).getDate())||(Be=ei(Be)):(Be=vo(Be),ee!==null&&Yd(ee)&&(Be=$_(Be))),typeof pa!="undefined"&&typeof Be=="string"&&(f||{}).type!="string"&&(f||{}).codepage&&(Be=pa.utils.decode(f.codepage,Be)),Ie=!0;break;case"E":ze=!0;var De=tp(re[_].slice(1),{r:m,c:b});v[m][b]=[v[m][b],De];break;case"S":Je=!0,v[m][b]=[v[m][b],"S5S"];break;case"G":break;case"R":Ze=parseInt(re[_].slice(1))-1;break;case"C":ht=parseInt(re[_].slice(1))-1;break;default:if(f&&f.WTF)throw new Error("SYLK bad record "+j)}if(Ie&&(v[m][b]&&v[m][b].length==2?v[m][b][0]=Be:v[m][b]=Be,ee=null),Je){if(ze)throw new Error("SYLK shared formula cannot have own formula");var tt=Ze>-1&&v[Ze][ht];if(!tt||!tt[1])throw new Error("SYLK shared formula cannot find base");v[m][b][1]=QD(tt[1],{r:m-Ze,c:b-ht})}break;case"F":var Ve=0;for(_=1;_<re.length;++_)switch(re[_].charAt(0)){case"X":b=parseInt(re[_].slice(1))-1,++Ve;break;case"Y":for(m=parseInt(re[_].slice(1))-1,H=v.length;H<=m;++H)v[H]=[];break;case"M":B=parseInt(re[_].slice(1))/20;break;case"F":break;case"G":break;case"P":ee=U[parseInt(re[_].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(S=re[_].slice(1).split(" "),H=parseInt(S[0],10);H<=parseInt(S[1],10);++H)B=parseInt(S[2],10),w[H-1]=B===0?{hidden:!0}:{wch:B},ru(w[H-1]);break;case"C":b=parseInt(re[_].slice(1))-1,w[b]||(w[b]={});break;case"R":m=parseInt(re[_].slice(1))-1,k[m]||(k[m]={}),B>0?(k[m].hpt=B,k[m].hpx=Qf(B)):B===0&&(k[m].hidden=!0);break;default:if(f&&f.WTF)throw new Error("SYLK bad record "+j)}Ve<1&&(ee=null);break;default:if(f&&f.WTF)throw new Error("SYLK bad record "+j)}}return k.length>0&&(Z["!rows"]=k),w.length>0&&(Z["!cols"]=w),f&&f.sheetRows&&(v=v.slice(0,f.sheetRows)),[v,Z]}function r(g,f){var h=i(g,f),m=h[0],b=h[1],y=Xf(m,f);return oi(b).forEach(function(_){y[_]=b[_]}),y}function o(g,f){return _c(r(g,f),f)}function l(g,f,h,m){var b="C;Y"+(h+1)+";X"+(m+1)+";K";switch(g.t){case"n":b+=g.v||0,g.f&&!g.F&&(b+=";E"+J1(g.f,{r:h,c:m}));break;case"b":b+=g.v?"TRUE":"FALSE";break;case"e":b+=g.w||g.v;break;case"d":b+='"'+(g.w||g.v)+'"';break;case"s":b+='"'+g.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return b}function c(g,f){f.forEach(function(h,m){var b="F;W"+(m+1)+" "+(m+1)+" ";h.hidden?b+="0":(typeof h.width=="number"&&!h.wpx&&(h.wpx=Dg(h.width)),typeof h.wpx=="number"&&!h.wch&&(h.wch=Cg(h.wpx)),typeof h.wch=="number"&&(b+=Math.round(h.wch))),b.charAt(b.length-1)!=" "&&g.push(b)})}function d(g,f){f.forEach(function(h,m){var b="F;";h.hidden?b+="M0;":h.hpt?b+="M"+20*h.hpt+";":h.hpx&&(b+="M"+20*Lg(h.hpx)+";"),b.length>2&&g.push(b+"R"+(m+1))})}function u(g,f){var h=["ID;PWXL;N;E"],m=[],b=oa(g["!ref"]),y,_=Array.isArray(g),v=`\r
`;h.push("P;PGeneral"),h.push("F;P0;DG0G8;M255"),g["!cols"]&&c(h,g["!cols"]),g["!rows"]&&d(h,g["!rows"]),h.push("B;Y"+(b.e.r-b.s.r+1)+";X"+(b.e.c-b.s.c+1)+";D"+[b.s.c,b.s.r,b.e.c,b.e.r].join(" "));for(var U=b.s.r;U<=b.e.r;++U)for(var ee=b.s.c;ee<=b.e.c;++ee){var Z=Nn({r:U,c:ee});y=_?(g[U]||[])[ee]:g[Z],!(!y||y.v==null&&(!y.f||y.F))&&m.push(l(y,g,U,ee,f))}return h.join(v)+v+m.join(v)+v+"E"+v}return{to_workbook:o,to_sheet:r,from_sheet:u}}(),PD=function(){function t(s,r){switch(r.type){case"base64":return e(xr(s),r);case"binary":return e(s,r);case"buffer":return e(Jn&&Buffer.isBuffer(s)?s.toString("binary"):hc(s),r);case"array":return e(Gd(s),r)}throw new Error("Unrecognized type "+r.type)}function e(s,r){for(var o=s.split(`
`),l=-1,c=-1,d=0,u=[];d!==o.length;++d){if(o[d].trim()==="BOT"){u[++l]=[],c=0;continue}if(!(l<0)){var g=o[d].trim().split(","),f=g[0],h=g[1];++d;for(var m=o[d]||"";(m.match(/["]/g)||[]).length&1&&d<o.length-1;)m+=`
`+o[++d];switch(m=m.trim(),+f){case-1:if(m==="BOT"){u[++l]=[],c=0;continue}else if(m!=="EOD")throw new Error("Unrecognized DIF special command "+m);break;case 0:m==="TRUE"?u[l][c]=!0:m==="FALSE"?u[l][c]=!1:isNaN(vo(h))?isNaN(Gf(h).getDate())?u[l][c]=h:u[l][c]=ei(h):u[l][c]=vo(h),++c;break;case 1:m=m.slice(1,m.length-1),m=m.replace(/""/g,'"'),dg&&m&&m.match(/^=".*"$/)&&(m=m.slice(2,-1)),u[l][c++]=m!==""?m:null;break}if(m==="EOD")break}}return r&&r.sheetRows&&(u=u.slice(0,r.sheetRows)),u}function n(s,r){return Xf(t(s,r),r)}function a(s,r){return _c(n(s,r),r)}var i=function(){var s=function(l,c,d,u,g){l.push(c),l.push(d+","+u),l.push('"'+g.replace(/"/g,'""')+'"')},r=function(l,c,d,u){l.push(c+","+d),l.push(c==1?'"'+u.replace(/"/g,'""')+'"':u)};return function(l){var c=[],d=oa(l["!ref"]),u,g=Array.isArray(l);s(c,"TABLE",0,1,"sheetjs"),s(c,"VECTORS",0,d.e.r-d.s.r+1,""),s(c,"TUPLES",0,d.e.c-d.s.c+1,""),s(c,"DATA",0,0,"");for(var f=d.s.r;f<=d.e.r;++f){r(c,-1,0,"BOT");for(var h=d.s.c;h<=d.e.c;++h){var m=Nn({r:f,c:h});if(u=g?(l[f]||[])[h]:l[m],!u){r(c,1,0,"");continue}switch(u.t){case"n":var b=dg?u.w:u.v;!b&&u.v!=null&&(b=u.v),b==null?dg&&u.f&&!u.F?r(c,1,0,"="+u.f):r(c,1,0,""):r(c,0,b,"V");break;case"b":r(c,0,u.v?1:0,u.v?"TRUE":"FALSE");break;case"s":r(c,1,0,!dg||isNaN(u.v)?u.v:'="'+u.v+'"');break;case"d":u.w||(u.w=kr(u.z||Dn[14],Ri(ei(u.v)))),dg?r(c,0,u.w,"V"):r(c,1,0,u.w);break;default:r(c,1,0,"")}}}r(c,-1,0,"EOD");var y=`\r
`,_=c.join(y);return _}}();return{to_workbook:a,to_sheet:n,from_sheet:i}}(),ND=function(){function t(u){return u.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function e(u){return u.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function n(u,g){for(var f=u.split(`
`),h=-1,m=-1,b=0,y=[];b!==f.length;++b){var _=f[b].trim().split(":");if(_[0]==="cell"){var v=ti(_[1]);if(y.length<=v.r)for(h=y.length;h<=v.r;++h)y[h]||(y[h]=[]);switch(h=v.r,m=v.c,_[2]){case"t":y[h][m]=t(_[3]);break;case"v":y[h][m]=+_[3];break;case"vtf":var U=_[_.length-1];case"vtc":switch(_[3]){case"nl":y[h][m]=!!+_[4];break;default:y[h][m]=+_[4];break}_[2]=="vtf"&&(y[h][m]=[y[h][m],U])}}}return g&&g.sheetRows&&(y=y.slice(0,g.sheetRows)),y}function a(u,g){return Xf(n(u,g),g)}function i(u,g){return _c(a(u,g),g)}var s=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),r=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,o=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),l="--SocialCalcSpreadsheetControlSave--";function c(u){if(!u||!u["!ref"])return"";for(var g=[],f=[],h,m="",b=Tr(u["!ref"]),y=Array.isArray(u),_=b.s.r;_<=b.e.r;++_)for(var v=b.s.c;v<=b.e.c;++v)if(m=Nn({r:_,c:v}),h=y?(u[_]||[])[v]:u[m],!(!h||h.v==null||h.t==="z")){switch(f=["cell",m,"t"],h.t){case"s":case"str":f.push(e(h.v));break;case"n":h.f?(f[2]="vtf",f[3]="n",f[4]=h.v,f[5]=e(h.f)):(f[2]="v",f[3]=h.v);break;case"b":f[2]="vt"+(h.f?"f":"c"),f[3]="nl",f[4]=h.v?"1":"0",f[5]=e(h.f||(h.v?"TRUE":"FALSE"));break;case"d":var U=Ri(ei(h.v));f[2]="vtc",f[3]="nd",f[4]=""+U,f[5]=h.w||kr(h.z||Dn[14],U);break;case"e":continue}g.push(f.join(":"))}return g.push("sheet:c:"+(b.e.c-b.s.c+1)+":r:"+(b.e.r-b.s.r+1)+":tvf:1"),g.push("valueformat:1:text-wiki"),g.join(`
`)}function d(u){return[s,r,o,r,c(u),l].join(`
`)}return{to_workbook:i,to_sheet:a,from_sheet:d}}(),Jf=function(){function t(d,u,g,f,h){h.raw?u[g][f]=d:d===""||(d==="TRUE"?u[g][f]=!0:d==="FALSE"?u[g][f]=!1:isNaN(vo(d))?isNaN(Gf(d).getDate())?u[g][f]=d:u[g][f]=ei(d):u[g][f]=vo(d))}function e(d,u){var g=u||{},f=[];if(!d||d.length===0)return f;for(var h=d.split(/[\r\n]/),m=h.length-1;m>=0&&h[m].length===0;)--m;for(var b=10,y=0,_=0;_<=m;++_)y=h[_].indexOf(" "),y==-1?y=h[_].length:y++,b=Math.max(b,y);for(_=0;_<=m;++_){f[_]=[];var v=0;for(t(h[_].slice(0,b).trim(),f,_,v,g),v=1;v<=(h[_].length-b)/10+1;++v)t(h[_].slice(b+(v-1)*10,b+v*10).trim(),f,_,v,g)}return g.sheetRows&&(f=f.slice(0,g.sheetRows)),f}var n={44:",",9:"	",59:";",124:"|"},a={44:3,9:2,59:1,124:0};function i(d){for(var u={},g=!1,f=0,h=0;f<d.length;++f)(h=d.charCodeAt(f))==34?g=!g:!g&&h in n&&(u[h]=(u[h]||0)+1);h=[];for(f in u)Object.prototype.hasOwnProperty.call(u,f)&&h.push([u[f],f]);if(!h.length){u=a;for(f in u)Object.prototype.hasOwnProperty.call(u,f)&&h.push([u[f],f])}return h.sort(function(m,b){return m[0]-b[0]||a[m[1]]-a[b[1]]}),n[h.pop()[1]]||44}function s(d,u){var g=u||{},f="";ri!=null&&g.dense==null&&(g.dense=ri);var h=g.dense?[]:{},m={s:{c:0,r:0},e:{c:0,r:0}};d.slice(0,4)=="sep="?d.charCodeAt(5)==13&&d.charCodeAt(6)==10?(f=d.charAt(4),d=d.slice(7)):d.charCodeAt(5)==13||d.charCodeAt(5)==10?(f=d.charAt(4),d=d.slice(6)):f=i(d.slice(0,1024)):g&&g.FS?f=g.FS:f=i(d.slice(0,1024));var b=0,y=0,_=0,v=0,U=0,ee=f.charCodeAt(0),Z=!1,k=0,w=d.charCodeAt(0);d=d.replace(/\r\n/mg,`
`);var S=g.dateNF!=null?O6(g.dateNF):null;function B(){var H=d.slice(v,U),j={};if(H.charAt(0)=='"'&&H.charAt(H.length-1)=='"'&&(H=H.slice(1,-1).replace(/""/g,'"')),H.length===0)j.t="z";else if(g.raw)j.t="s",j.v=H;else if(H.trim().length===0)j.t="s",j.v=H;else if(H.charCodeAt(0)==61)H.charCodeAt(1)==34&&H.charCodeAt(H.length-1)==34?(j.t="s",j.v=H.slice(2,-1).replace(/""/g,'"')):uR(H)?(j.t="n",j.f=H.slice(1)):(j.t="s",j.v=H);else if(H=="TRUE")j.t="b",j.v=!0;else if(H=="FALSE")j.t="b",j.v=!1;else if(!isNaN(_=vo(H)))j.t="n",g.cellText!==!1&&(j.w=H),j.v=_;else if(!isNaN(Gf(H).getDate())||S&&H.match(S)){j.z=g.dateNF||Dn[14];var re=0;S&&H.match(S)&&(H=R6(H,g.dateNF,H.match(S)||[]),re=1),g.cellDates?(j.t="d",j.v=ei(H,re)):(j.t="n",j.v=Ri(ei(H,re))),g.cellText!==!1&&(j.w=kr(j.z,j.v instanceof Date?Ri(j.v):j.v)),g.cellNF||delete j.z}else j.t="s",j.v=H;if(j.t=="z"||(g.dense?(h[b]||(h[b]=[]),h[b][y]=j):h[Nn({c:y,r:b})]=j),v=U+1,w=d.charCodeAt(v),m.e.c<y&&(m.e.c=y),m.e.r<b&&(m.e.r=b),k==ee)++y;else if(y=0,++b,g.sheetRows&&g.sheetRows<=b)return!0}e:for(;U<d.length;++U)switch(k=d.charCodeAt(U)){case 34:w===34&&(Z=!Z);break;case ee:case 10:case 13:if(!Z&&B())break e;break;default:break}return U-v>0&&B(),h["!ref"]=Yn(m),h}function r(d,u){return!(u&&u.PRN)||u.FS||d.slice(0,4)=="sep="||d.indexOf("	")>=0||d.indexOf(",")>=0||d.indexOf(";")>=0?s(d,u):Xf(e(d,u),u)}function o(d,u){var g="",f=u.type=="string"?[0,0,0,0]:gE(d,u);switch(u.type){case"base64":g=xr(d);break;case"binary":g=d;break;case"buffer":u.codepage==65001?g=d.toString("utf8"):u.codepage&&typeof pa!="undefined"?g=pa.utils.decode(u.codepage,d):g=Jn&&Buffer.isBuffer(d)?d.toString("binary"):hc(d);break;case"array":g=Gd(d);break;case"string":g=d;break;default:throw new Error("Unrecognized type "+u.type)}return f[0]==239&&f[1]==187&&f[2]==191?g=Ia(g.slice(3)):u.type!="string"&&u.type!="buffer"&&u.codepage==65001?g=Ia(g):u.type=="binary"&&typeof pa!="undefined"&&u.codepage&&(g=pa.utils.decode(u.codepage,pa.utils.encode(28591,g))),g.slice(0,19)=="socialcalc:version:"?ND.to_sheet(u.type=="string"?g:Ia(g),u):r(g,u)}function l(d,u){return _c(o(d,u),u)}function c(d){for(var u=[],g=oa(d["!ref"]),f,h=Array.isArray(d),m=g.s.r;m<=g.e.r;++m){for(var b=[],y=g.s.c;y<=g.e.c;++y){var _=Nn({r:m,c:y});if(f=h?(d[m]||[])[y]:d[_],!f||f.v==null){b.push("          ");continue}for(var v=(f.w||(Xo(f),f.w)||"").slice(0,10);v.length<10;)v+=" ";b.push(v+(y===0?" ":""))}u.push(b.join(""))}return u.join(`
`)}return{to_workbook:l,to_sheet:o,from_sheet:c}}();function ZB(t,e){var n=e||{},a=!!n.WTF;n.WTF=!0;try{var i=FD.to_workbook(t,n);return n.WTF=a,i}catch(s){if(n.WTF=a,!s.message.match(/SYLK bad record ID/)&&a)throw s;return Jf.to_workbook(t,e)}}var su=function(){function t(De,tt,Ve){if(De){as(De,De.l||0);for(var He=Ve.Enum||Ze;De.l<De.length;){var bt=De.read_shift(2),Kt=He[bt]||He[65535],Vt=De.read_shift(2),At=De.l+Vt,Ct=Kt.f&&Kt.f(De,Vt,Ve);if(De.l=At,tt(Ct,Kt,bt))return}}}function e(De,tt){switch(tt.type){case"base64":return n(Er(xr(De)),tt);case"binary":return n(Er(De),tt);case"buffer":case"array":return n(De,tt)}throw"Unsupported type "+tt.type}function n(De,tt){if(!De)return De;var Ve=tt||{};ri!=null&&Ve.dense==null&&(Ve.dense=ri);var He=Ve.dense?[]:{},bt="Sheet1",Kt="",Vt=0,At={},Ct=[],Ln=[],Oe={s:{r:0,c:0},e:{r:0,c:0}},Xn=Ve.sheetRows||0;if(De[2]==0&&(De[3]==8||De[3]==9)&&De.length>=16&&De[14]==5&&De[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(De[2]==2)Ve.Enum=Ze,t(De,function(fn,yi,no){switch(no){case 0:Ve.vers=fn,fn>=4096&&(Ve.qpro=!0);break;case 6:Oe=fn;break;case 204:fn&&(Kt=fn);break;case 222:Kt=fn;break;case 15:case 51:Ve.qpro||(fn[1].v=fn[1].v.slice(1));case 13:case 14:case 16:no==14&&(fn[2]&112)==112&&(fn[2]&15)>1&&(fn[2]&15)<15&&(fn[1].z=Ve.dateNF||Dn[14],Ve.cellDates&&(fn[1].t="d",fn[1].v=$_(fn[1].v))),Ve.qpro&&fn[3]>Vt&&(He["!ref"]=Yn(Oe),At[bt]=He,Ct.push(bt),He=Ve.dense?[]:{},Oe={s:{r:0,c:0},e:{r:0,c:0}},Vt=fn[3],bt=Kt||"Sheet"+(Vt+1),Kt="");var dl=Ve.dense?(He[fn[0].r]||[])[fn[0].c]:He[Nn(fn[0])];if(dl){dl.t=fn[1].t,dl.v=fn[1].v,fn[1].z!=null&&(dl.z=fn[1].z),fn[1].f!=null&&(dl.f=fn[1].f);break}Ve.dense?(He[fn[0].r]||(He[fn[0].r]=[]),He[fn[0].r][fn[0].c]=fn[1]):He[Nn(fn[0])]=fn[1];break;default:}},Ve);else if(De[2]==26||De[2]==14)Ve.Enum=ht,De[2]==14&&(Ve.qpro=!0,De.l=0),t(De,function(fn,yi,no){switch(no){case 204:bt=fn;break;case 22:fn[1].v=fn[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(fn[3]>Vt&&(He["!ref"]=Yn(Oe),At[bt]=He,Ct.push(bt),He=Ve.dense?[]:{},Oe={s:{r:0,c:0},e:{r:0,c:0}},Vt=fn[3],bt="Sheet"+(Vt+1)),Xn>0&&fn[0].r>=Xn)break;Ve.dense?(He[fn[0].r]||(He[fn[0].r]=[]),He[fn[0].r][fn[0].c]=fn[1]):He[Nn(fn[0])]=fn[1],Oe.e.c<fn[0].c&&(Oe.e.c=fn[0].c),Oe.e.r<fn[0].r&&(Oe.e.r=fn[0].r);break;case 27:fn[14e3]&&(Ln[fn[14e3][0]]=fn[14e3][1]);break;case 1537:Ln[fn[0]]=fn[1],fn[0]==Vt&&(bt=fn[1]);break;default:break}},Ve);else throw new Error("Unrecognized LOTUS BOF "+De[2]);if(He["!ref"]=Yn(Oe),At[Kt||bt]=He,Ct.push(Kt||bt),!Ln.length)return{SheetNames:Ct,Sheets:At};for(var Rn={},Da=[],sa=0;sa<Ln.length;++sa)At[Ct[sa]]?(Da.push(Ln[sa]||Ct[sa]),Rn[Ln[sa]]=At[Ln[sa]]||At[Ct[sa]]):(Da.push(Ln[sa]),Rn[Ln[sa]]={"!ref":"A1"});return{SheetNames:Da,Sheets:Rn}}function a(De,tt){var Ve=tt||{};if(+Ve.codepage>=0&&Or(+Ve.codepage),Ve.type=="string")throw new Error("Cannot write WK1 to JS string");var He=Us(),bt=oa(De["!ref"]),Kt=Array.isArray(De),Vt=[];an(He,0,s(1030)),an(He,6,l(bt));for(var At=Math.min(bt.e.r,8191),Ct=bt.s.r;Ct<=At;++Ct)for(var Ln=ci(Ct),Oe=bt.s.c;Oe<=bt.e.c;++Oe){Ct===bt.s.r&&(Vt[Oe]=Ga(Oe));var Xn=Vt[Oe]+Ln,Rn=Kt?(De[Ct]||[])[Oe]:De[Xn];if(!(!Rn||Rn.t=="z"))if(Rn.t=="n")(Rn.v|0)==Rn.v&&Rn.v>=-32768&&Rn.v<=32767?an(He,13,f(Ct,Oe,Rn.v)):an(He,14,m(Ct,Oe,Rn.v));else{var Da=Xo(Rn);an(He,15,u(Ct,Oe,Da.slice(0,239)))}}return an(He,1),He.end()}function i(De,tt){var Ve=tt||{};if(+Ve.codepage>=0&&Or(+Ve.codepage),Ve.type=="string")throw new Error("Cannot write WK3 to JS string");var He=Us();an(He,0,r(De));for(var bt=0,Kt=0;bt<De.SheetNames.length;++bt)(De.Sheets[De.SheetNames[bt]]||{})["!ref"]&&an(He,27,ze(De.SheetNames[bt],Kt++));var Vt=0;for(bt=0;bt<De.SheetNames.length;++bt){var At=De.Sheets[De.SheetNames[bt]];if(!(!At||!At["!ref"])){for(var Ct=oa(At["!ref"]),Ln=Array.isArray(At),Oe=[],Xn=Math.min(Ct.e.r,8191),Rn=Ct.s.r;Rn<=Xn;++Rn)for(var Da=ci(Rn),sa=Ct.s.c;sa<=Ct.e.c;++sa){Rn===Ct.s.r&&(Oe[sa]=Ga(sa));var fn=Oe[sa]+Da,yi=Ln?(At[Rn]||[])[sa]:At[fn];if(!(!yi||yi.t=="z"))if(yi.t=="n")an(He,23,B(Rn,sa,Vt,yi.v));else{var no=Xo(yi);an(He,22,k(Rn,sa,Vt,no.slice(0,239)))}}++Vt}}return an(He,1),He.end()}function s(De){var tt=Dt(2);return tt.write_shift(2,De),tt}function r(De){var tt=Dt(26);tt.write_shift(2,4096),tt.write_shift(2,4),tt.write_shift(4,0);for(var Ve=0,He=0,bt=0,Kt=0;Kt<De.SheetNames.length;++Kt){var Vt=De.SheetNames[Kt],At=De.Sheets[Vt];if(!(!At||!At["!ref"])){++bt;var Ct=Tr(At["!ref"]);Ve<Ct.e.r&&(Ve=Ct.e.r),He<Ct.e.c&&(He=Ct.e.c)}}return Ve>8191&&(Ve=8191),tt.write_shift(2,Ve),tt.write_shift(1,bt),tt.write_shift(1,He),tt.write_shift(2,0),tt.write_shift(2,0),tt.write_shift(1,1),tt.write_shift(1,2),tt.write_shift(4,0),tt.write_shift(4,0),tt}function o(De,tt,Ve){var He={s:{c:0,r:0},e:{c:0,r:0}};return tt==8&&Ve.qpro?(He.s.c=De.read_shift(1),De.l++,He.s.r=De.read_shift(2),He.e.c=De.read_shift(1),De.l++,He.e.r=De.read_shift(2),He):(He.s.c=De.read_shift(2),He.s.r=De.read_shift(2),tt==12&&Ve.qpro&&(De.l+=2),He.e.c=De.read_shift(2),He.e.r=De.read_shift(2),tt==12&&Ve.qpro&&(De.l+=2),He.s.c==65535&&(He.s.c=He.e.c=He.s.r=He.e.r=0),He)}function l(De){var tt=Dt(8);return tt.write_shift(2,De.s.c),tt.write_shift(2,De.s.r),tt.write_shift(2,De.e.c),tt.write_shift(2,De.e.r),tt}function c(De,tt,Ve){var He=[{c:0,r:0},{t:"n",v:0},0,0];return Ve.qpro&&Ve.vers!=20768?(He[0].c=De.read_shift(1),He[3]=De.read_shift(1),He[0].r=De.read_shift(2),De.l+=2):(He[2]=De.read_shift(1),He[0].c=De.read_shift(2),He[0].r=De.read_shift(2)),He}function d(De,tt,Ve){var He=De.l+tt,bt=c(De,tt,Ve);if(bt[1].t="s",Ve.vers==20768){De.l++;var Kt=De.read_shift(1);return bt[1].v=De.read_shift(Kt,"utf8"),bt}return Ve.qpro&&De.l++,bt[1].v=De.read_shift(He-De.l,"cstr"),bt}function u(De,tt,Ve){var He=Dt(7+Ve.length);He.write_shift(1,255),He.write_shift(2,tt),He.write_shift(2,De),He.write_shift(1,39);for(var bt=0;bt<He.length;++bt){var Kt=Ve.charCodeAt(bt);He.write_shift(1,Kt>=128?95:Kt)}return He.write_shift(1,0),He}function g(De,tt,Ve){var He=c(De,tt,Ve);return He[1].v=De.read_shift(2,"i"),He}function f(De,tt,Ve){var He=Dt(7);return He.write_shift(1,255),He.write_shift(2,tt),He.write_shift(2,De),He.write_shift(2,Ve,"i"),He}function h(De,tt,Ve){var He=c(De,tt,Ve);return He[1].v=De.read_shift(8,"f"),He}function m(De,tt,Ve){var He=Dt(13);return He.write_shift(1,255),He.write_shift(2,tt),He.write_shift(2,De),He.write_shift(8,Ve,"f"),He}function b(De,tt,Ve){var He=De.l+tt,bt=c(De,tt,Ve);if(bt[1].v=De.read_shift(8,"f"),Ve.qpro)De.l=He;else{var Kt=De.read_shift(2);U(De.slice(De.l,De.l+Kt),bt),De.l+=Kt}return bt}function y(De,tt,Ve){var He=tt&32768;return tt&=-32769,tt=(He?De:0)+(tt>=8192?tt-16384:tt),(He?"":"$")+(Ve?Ga(tt):ci(tt))}var _={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},v=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function U(De,tt){as(De,0);for(var Ve=[],He=0,bt="",Kt="",Vt="",At="";De.l<De.length;){var Ct=De[De.l++];switch(Ct){case 0:Ve.push(De.read_shift(8,"f"));break;case 1:Kt=y(tt[0].c,De.read_shift(2),!0),bt=y(tt[0].r,De.read_shift(2),!1),Ve.push(Kt+bt);break;case 2:{var Ln=y(tt[0].c,De.read_shift(2),!0),Oe=y(tt[0].r,De.read_shift(2),!1);Kt=y(tt[0].c,De.read_shift(2),!0),bt=y(tt[0].r,De.read_shift(2),!1),Ve.push(Ln+Oe+":"+Kt+bt)}break;case 3:if(De.l<De.length){console.error("WK1 premature formula end");return}break;case 4:Ve.push("("+Ve.pop()+")");break;case 5:Ve.push(De.read_shift(2));break;case 6:{for(var Xn="";Ct=De[De.l++];)Xn+=String.fromCharCode(Ct);Ve.push('"'+Xn.replace(/"/g,'""')+'"')}break;case 8:Ve.push("-"+Ve.pop());break;case 23:Ve.push("+"+Ve.pop());break;case 22:Ve.push("NOT("+Ve.pop()+")");break;case 20:case 21:At=Ve.pop(),Vt=Ve.pop(),Ve.push(["AND","OR"][Ct-20]+"("+Vt+","+At+")");break;default:if(Ct<32&&v[Ct])At=Ve.pop(),Vt=Ve.pop(),Ve.push(Vt+v[Ct]+At);else if(_[Ct]){if(He=_[Ct][1],He==69&&(He=De[De.l++]),He>Ve.length){console.error("WK1 bad formula parse 0x"+Ct.toString(16)+":|"+Ve.join("|")+"|");return}var Rn=Ve.slice(-He);Ve.length-=He,Ve.push(_[Ct][0]+"("+Rn.join(",")+")")}else return Ct<=7?console.error("WK1 invalid opcode "+Ct.toString(16)):Ct<=24?console.error("WK1 unsupported op "+Ct.toString(16)):Ct<=30?console.error("WK1 invalid opcode "+Ct.toString(16)):Ct<=115?console.error("WK1 unsupported function opcode "+Ct.toString(16)):console.error("WK1 unrecognized opcode "+Ct.toString(16))}}Ve.length==1?tt[1].f=""+Ve[0]:console.error("WK1 bad formula parse |"+Ve.join("|")+"|")}function ee(De){var tt=[{c:0,r:0},{t:"n",v:0},0];return tt[0].r=De.read_shift(2),tt[3]=De[De.l++],tt[0].c=De[De.l++],tt}function Z(De,tt){var Ve=ee(De,tt);return Ve[1].t="s",Ve[1].v=De.read_shift(tt-4,"cstr"),Ve}function k(De,tt,Ve,He){var bt=Dt(6+He.length);bt.write_shift(2,De),bt.write_shift(1,Ve),bt.write_shift(1,tt),bt.write_shift(1,39);for(var Kt=0;Kt<He.length;++Kt){var Vt=He.charCodeAt(Kt);bt.write_shift(1,Vt>=128?95:Vt)}return bt.write_shift(1,0),bt}function w(De,tt){var Ve=ee(De,tt);Ve[1].v=De.read_shift(2);var He=Ve[1].v>>1;if(Ve[1].v&1)switch(He&7){case 0:He=(He>>3)*5e3;break;case 1:He=(He>>3)*500;break;case 2:He=(He>>3)/20;break;case 3:He=(He>>3)/200;break;case 4:He=(He>>3)/2e3;break;case 5:He=(He>>3)/2e4;break;case 6:He=(He>>3)/16;break;case 7:He=(He>>3)/64;break}return Ve[1].v=He,Ve}function S(De,tt){var Ve=ee(De,tt),He=De.read_shift(4),bt=De.read_shift(4),Kt=De.read_shift(2);if(Kt==65535)return He===0&&bt===3221225472?(Ve[1].t="e",Ve[1].v=15):He===0&&bt===3489660928?(Ve[1].t="e",Ve[1].v=42):Ve[1].v=0,Ve;var Vt=Kt&32768;return Kt=(Kt&32767)-16446,Ve[1].v=(1-Vt*2)*(bt*Math.pow(2,Kt+32)+He*Math.pow(2,Kt)),Ve}function B(De,tt,Ve,He){var bt=Dt(14);if(bt.write_shift(2,De),bt.write_shift(1,Ve),bt.write_shift(1,tt),He==0)return bt.write_shift(4,0),bt.write_shift(4,0),bt.write_shift(2,65535),bt;var Kt=0,Vt=0,At=0,Ct=0;return He<0&&(Kt=1,He=-He),Vt=Math.log2(He)|0,He/=Math.pow(2,Vt-31),Ct=He>>>0,Ct&2147483648||(He/=2,++Vt,Ct=He>>>0),He-=Ct,Ct|=2147483648,Ct>>>=0,He*=Math.pow(2,32),At=He>>>0,bt.write_shift(4,At),bt.write_shift(4,Ct),Vt+=16383+(Kt?32768:0),bt.write_shift(2,Vt),bt}function H(De,tt){var Ve=S(De,14);return De.l+=tt-14,Ve}function j(De,tt){var Ve=ee(De,tt),He=De.read_shift(4);return Ve[1].v=He>>6,Ve}function re(De,tt){var Ve=ee(De,tt),He=De.read_shift(8,"f");return Ve[1].v=He,Ve}function Te(De,tt){var Ve=re(De,14);return De.l+=tt-10,Ve}function Be(De,tt){return De[De.l+tt-1]==0?De.read_shift(tt,"cstr"):""}function Ie(De,tt){var Ve=De[De.l++];Ve>tt-1&&(Ve=tt-1);for(var He="";He.length<Ve;)He+=String.fromCharCode(De[De.l++]);return He}function Ce(De,tt,Ve){if(!(!Ve.qpro||tt<21)){var He=De.read_shift(1);De.l+=17,De.l+=1,De.l+=2;var bt=De.read_shift(tt-21,"cstr");return[He,bt]}}function Je(De,tt){for(var Ve={},He=De.l+tt;De.l<He;){var bt=De.read_shift(2);if(bt==14e3){for(Ve[bt]=[0,""],Ve[bt][0]=De.read_shift(2);De[De.l];)Ve[bt][1]+=String.fromCharCode(De[De.l]),De.l++;De.l++}}return Ve}function ze(De,tt){var Ve=Dt(5+De.length);Ve.write_shift(2,14e3),Ve.write_shift(2,tt);for(var He=0;He<De.length;++He){var bt=De.charCodeAt(He);Ve[Ve.l++]=bt>127?95:bt}return Ve[Ve.l++]=0,Ve}var Ze={0:{n:"BOF",f:Li},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:o},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:g},14:{n:"NUMBER",f:h},15:{n:"LABEL",f:d},16:{n:"FORMULA",f:b},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:d},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:Be},222:{n:"SHEETNAMELP",f:Ie},65535:{n:""}},ht={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:Z},23:{n:"NUMBER17",f:S},24:{n:"NUMBER18",f:w},25:{n:"FORMULA19",f:H},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:Je},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:j},38:{n:"??"},39:{n:"NUMBER27",f:re},40:{n:"FORMULA28",f:Te},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:Be},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:Ce},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:a,book_to_wk3:i,to_workbook:e}}();function JB(t){var e={},n=t.match(gs),a=0,i=!1;if(n)for(;a!=n.length;++a){var s=Pn(n[a]);switch(s[0].replace(/\w*:/g,"")){case"<condense":break;case"<extend":break;case"<shadow":if(!s.val)break;case"<shadow>":case"<shadow/>":e.shadow=1;break;case"</shadow>":break;case"<charset":if(s.val=="1")break;e.cp=i1[parseInt(s.val,10)];break;case"<outline":if(!s.val)break;case"<outline>":case"<outline/>":e.outline=1;break;case"</outline>":break;case"<rFont":e.name=s.val;break;case"<sz":e.sz=s.val;break;case"<strike":if(!s.val)break;case"<strike>":case"<strike/>":e.strike=1;break;case"</strike>":break;case"<u":if(!s.val)break;switch(s.val){case"double":e.uval="double";break;case"singleAccounting":e.uval="single-accounting";break;case"doubleAccounting":e.uval="double-accounting";break}case"<u>":case"<u/>":e.u=1;break;case"</u>":break;case"<b":if(s.val=="0")break;case"<b>":case"<b/>":e.b=1;break;case"</b>":break;case"<i":if(s.val=="0")break;case"<i>":case"<i/>":e.i=1;break;case"</i>":break;case"<color":s.rgb&&(e.color=s.rgb.slice(2,8));break;case"<color>":case"<color/>":case"</color>":break;case"<family":e.family=s.val;break;case"<family>":case"<family/>":case"</family>":break;case"<vertAlign":e.valign=s.val;break;case"<vertAlign>":case"<vertAlign/>":case"</vertAlign>":break;case"<scheme":break;case"<scheme>":case"<scheme/>":case"</scheme>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;default:if(s[0].charCodeAt(1)!==47&&!i)throw new Error("Unrecognized rich format "+s[0])}}return e}var QB=function(){var t=yg("t"),e=yg("rPr");function n(s){var r=s.match(t);if(!r)return{t:"s",v:""};var o={t:"s",v:ga(r[1])},l=s.match(e);return l&&(o.s=JB(l[1])),o}var a=/<(?:\w+:)?r>/g,i=/<\/(?:\w+:)?r>/;return function(r){return r.replace(a,"").split(i).map(n).filter(function(o){return o.v})}}(),e$=function(){var e=/(\r\n|\n)/g;function n(i,s,r){var o=[];i.u&&o.push("text-decoration: underline;"),i.uval&&o.push("text-underline-style:"+i.uval+";"),i.sz&&o.push("font-size:"+i.sz+"pt;"),i.outline&&o.push("text-effect: outline;"),i.shadow&&o.push("text-shadow: auto;"),s.push('<span style="'+o.join("")+'">'),i.b&&(s.push("<b>"),r.push("</b>")),i.i&&(s.push("<i>"),r.push("</i>")),i.strike&&(s.push("<s>"),r.push("</s>"));var l=i.valign||"";return l=="superscript"||l=="super"?l="sup":l=="subscript"&&(l="sub"),l!=""&&(s.push("<"+l+">"),r.push("</"+l+">")),r.push("</span>"),i}function a(i){var s=[[],i.v,[]];return i.v?(i.s&&n(i.s,s[0],s[2]),s[0].join("")+s[1].replace(e,"<br/>")+s[2].join("")):""}return function(s){return s.map(a).join("")}}(),t$=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,n$=/<(?:\w+:)?r>/,a$=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function z1(t,e){var n=e?e.cellHTML:!0,a={};return t?(t.match(/^\s*<(?:\w+:)?t[^>]*>/)?(a.t=ga(Ia(t.slice(t.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]||"")),a.r=Ia(t),n&&(a.h=h1(a.t))):t.match(n$)&&(a.r=Ia(t),a.t=ga(Ia((t.replace(a$,"").match(t$)||[]).join("").replace(gs,""))),n&&(a.h=e$(QB(a.r)))),a):{t:""}}var i$=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/,s$=/<(?:\w+:)?(?:si|sstItem)>/g,r$=/<\/(?:\w+:)?(?:si|sstItem)>/;function o$(t,e){var n=[],a="";if(!t)return n;var i=t.match(i$);if(i){a=i[2].replace(s$,"").split(r$);for(var s=0;s!=a.length;++s){var r=z1(a[s].trim(),e);r!=null&&(n[n.length]=r)}i=Pn(i[1]),n.Count=i.count,n.Unique=i.uniqueCount}return n}var l$=/^\s|\s$|[\t\n\r]/;function BD(t,e){if(!e.bookSST)return"";var n=[Di];n[n.length]=nn("sst",null,{xmlns:yc[0],count:t.Count,uniqueCount:t.Unique});for(var a=0;a!=t.length;++a)if(t[a]!=null){var i=t[a],s="<si>";i.r?s+=i.r:(s+="<t",i.t||(i.t=""),i.t.match(l$)&&(s+=' xml:space="preserve"'),s+=">"+Ha(i.t)+"</t>"),s+="</si>",n[n.length]=s}return n.length>2&&(n[n.length]="</sst>",n[1]=n[1].replace("/>",">")),n.join("")}function c$(t){return[t.read_shift(4),t.read_shift(4)]}function d$(t,e){var n=[],a=!1;return Tl(t,function(s,r,o){switch(o){case 159:n.Count=s[0],n.Unique=s[1];break;case 19:n.push(s);break;case 160:return!0;case 35:a=!0;break;case 36:a=!1;break;default:if(r.T,!a||e.WTF)throw new Error("Unexpected record 0x"+o.toString(16))}}),n}function u$(t,e){return e||(e=Dt(8)),e.write_shift(4,t.Count),e.write_shift(4,t.Unique),e}var f$=null;function p$(t){var e=Us();Wt(e,159,u$(t));for(var n=0;n<t.length;++n)Wt(e,19,f$(t[n]));return Wt(e,160),e.end()}function $D(t){if(typeof pa!="undefined")return pa.utils.encode(Vd,t);for(var e=[],n=t.split(""),a=0;a<n.length;++a)e[a]=n[a].charCodeAt(0);return e}function Cl(t,e){var n={};return n.Major=t.read_shift(2),n.Minor=t.read_shift(2),e>=4&&(t.l+=e-4),n}function h$(t){var e={};return e.id=t.read_shift(0,"lpp4"),e.R=Cl(t,4),e.U=Cl(t,4),e.W=Cl(t,4),e}function g$(t){for(var e=t.read_shift(4),n=t.l+e-4,a={},i=t.read_shift(4),s=[];i-- >0;)s.push({t:t.read_shift(4),v:t.read_shift(0,"lpp4")});if(a.name=t.read_shift(0,"lpp4"),a.comps=s,t.l!=n)throw new Error("Bad DataSpaceMapEntry: "+t.l+" != "+n);return a}function m$(t){var e=[];t.l+=4;for(var n=t.read_shift(4);n-- >0;)e.push(g$(t));return e}function b$(t){var e=[];t.l+=4;for(var n=t.read_shift(4);n-- >0;)e.push(t.read_shift(0,"lpp4"));return e}function y$(t){var e={};return t.read_shift(4),t.l+=4,e.id=t.read_shift(0,"lpp4"),e.name=t.read_shift(0,"lpp4"),e.R=Cl(t,4),e.U=Cl(t,4),e.W=Cl(t,4),e}function _$(t){var e=y$(t);if(e.ename=t.read_shift(0,"8lpp4"),e.blksz=t.read_shift(4),e.cmode=t.read_shift(4),t.read_shift(4)!=4)throw new Error("Bad !Primary record");return e}function OD(t,e){var n=t.l+e,a={};a.Flags=t.read_shift(4)&63,t.l+=4,a.AlgID=t.read_shift(4);var i=!1;switch(a.AlgID){case 26126:case 26127:case 26128:i=a.Flags==36;break;case 26625:i=a.Flags==4;break;case 0:i=a.Flags==16||a.Flags==4||a.Flags==36;break;default:throw"Unrecognized encryption algorithm: "+a.AlgID}if(!i)throw new Error("Encryption Flags/AlgID mismatch");return a.AlgIDHash=t.read_shift(4),a.KeySize=t.read_shift(4),a.ProviderType=t.read_shift(4),t.l+=8,a.CSPName=t.read_shift(n-t.l>>1,"utf16le"),t.l=n,a}function RD(t,e){var n={},a=t.l+e;return t.l+=4,n.Salt=t.slice(t.l,t.l+16),t.l+=16,n.Verifier=t.slice(t.l,t.l+16),t.l+=16,t.read_shift(4),n.VerifierHash=t.slice(t.l,a),t.l=a,n}function w$(t){var e=Cl(t);switch(e.Minor){case 2:return[e.Minor,v$(t,e)];case 3:return[e.Minor,x$(t,e)];case 4:return[e.Minor,E$(t,e)]}throw new Error("ECMA-376 Encrypted file unrecognized Version: "+e.Minor)}function v$(t){var e=t.read_shift(4);if((e&63)!=36)throw new Error("EncryptionInfo mismatch");var n=t.read_shift(4),a=OD(t,n),i=RD(t,t.length-t.l);return{t:"Std",h:a,v:i}}function x$(){throw new Error("File is password-protected: ECMA-376 Extensible")}function E$(t){var e=["saltSize","blockSize","keyBits","hashSize","cipherAlgorithm","cipherChaining","hashAlgorithm","saltValue"];t.l+=4;var n=t.read_shift(t.length-t.l,"utf8"),a={};return n.replace(gs,function(s){var r=Pn(s);switch(jo(r[0])){case"<?xml":break;case"<encryption":case"</encryption>":break;case"<keyData":e.forEach(function(o){a[o]=r[o]});break;case"<dataIntegrity":a.encryptedHmacKey=r.encryptedHmacKey,a.encryptedHmacValue=r.encryptedHmacValue;break;case"<keyEncryptors>":case"<keyEncryptors":a.encs=[];break;case"</keyEncryptors>":break;case"<keyEncryptor":a.uri=r.uri;break;case"</keyEncryptor>":break;case"<encryptedKey":a.encs.push(r);break;default:throw r[0]}}),a}function k$(t,e){var n={},a=n.EncryptionVersionInfo=Cl(t,4);if(e-=4,a.Minor!=2)throw new Error("unrecognized minor version code: "+a.Minor);if(a.Major>4||a.Major<2)throw new Error("unrecognized major version code: "+a.Major);n.Flags=t.read_shift(4),e-=4;var i=t.read_shift(4);return e-=4,n.EncryptionHeader=OD(t,i),e-=i,n.EncryptionVerifier=RD(t,e),n}function S$(t){var e={},n=e.EncryptionVersionInfo=Cl(t,4);if(n.Major!=1||n.Minor!=1)throw"unrecognized version code "+n.Major+" : "+n.Minor;return e.Salt=t.read_shift(16),e.EncryptedVerifier=t.read_shift(16),e.EncryptedVerifierHash=t.read_shift(16),e}function Y1(t){var e=0,n,a=$D(t),i=a.length+1,s,r,o,l,c;for(n=pc(i),n[0]=a.length,s=1;s!=i;++s)n[s]=a[s-1];for(s=i-1;s>=0;--s)r=n[s],o=e&16384?1:0,l=e<<1&32767,c=o|l,e=c^r;return e^52811}var UD=function(){var t=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],e=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],n=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],a=function(r){return(r/2|r*128)&255},i=function(r,o){return a(r^o)},s=function(r){for(var o=e[r.length-1],l=104,c=r.length-1;c>=0;--c)for(var d=r[c],u=0;u!=7;++u)d&64&&(o^=n[l]),d*=2,--l;return o};return function(r){for(var o=$D(r),l=s(o),c=o.length,d=pc(16),u=0;u!=16;++u)d[u]=0;var g,f,h;for((c&1)===1&&(g=l>>8,d[c]=i(t[0],g),--c,g=l&255,f=o[o.length-1],d[c]=i(f,g));c>0;)--c,g=l>>8,d[c]=i(o[c],g),--c,g=l&255,d[c]=i(o[c],g);for(c=15,h=15-o.length;h>0;)g=l>>8,d[c]=i(t[h],g),--c,--h,g=l&255,d[c]=i(o[c],g),--c,--h;return d}}(),A$=function(t,e,n,a,i){i||(i=e),a||(a=UD(t));var s,r;for(s=0;s!=e.length;++s)r=e[s],r^=a[n],r=(r>>5|r<<3)&255,i[s]=r,++n;return[i,n,a]},T$=function(t){var e=0,n=UD(t);return function(a){var i=A$("",a,e,n);return e=i[1],i[0]}};function D$(t,e,n,a){var i={key:Li(t),verificationBytes:Li(t)};return n.password&&(i.verifier=Y1(n.password)),a.valid=i.verificationBytes===i.verifier,a.valid&&(a.insitu=T$(n.password)),i}function C$(t,e,n){var a=n||{};return a.Info=t.read_shift(2),t.l-=2,a.Info===1?a.Data=S$(t,e):a.Data=k$(t,e),a}function L$(t,e,n){var a={Type:n.biff>=8?t.read_shift(2):0};return a.Type?C$(t,e-2,a):D$(t,n.biff>=8?e:e-2,n,a),a}var HD=function(){function t(i,s){switch(s.type){case"base64":return e(xr(i),s);case"binary":return e(i,s);case"buffer":return e(Jn&&Buffer.isBuffer(i)?i.toString("binary"):hc(i),s);case"array":return e(Gd(i),s)}throw new Error("Unrecognized type "+s.type)}function e(i,s){var r=s||{},o=r.dense?[]:{},l=i.match(/\\trowd.*?\\row\b/g);if(!l.length)throw new Error("RTF missing table");var c={s:{c:0,r:0},e:{c:0,r:l.length-1}};return l.forEach(function(d,u){Array.isArray(o)&&(o[u]=[]);for(var g=/\\\w+\b/g,f=0,h,m=-1;h=g.exec(d);){switch(h[0]){case"\\cell":var b=d.slice(f,g.lastIndex-h[0].length);if(b[0]==" "&&(b=b.slice(1)),++m,b.length){var y={v:b,t:"s"};Array.isArray(o)?o[u][m]=y:o[Nn({r:u,c:m})]=y}break}f=g.lastIndex}m>c.e.c&&(c.e.c=m)}),o["!ref"]=Yn(c),o}function n(i,s){return _c(t(i,s),s)}function a(i){for(var s=["{\\rtf1\\ansi"],r=oa(i["!ref"]),o,l=Array.isArray(i),c=r.s.r;c<=r.e.r;++c){s.push("\\trowd\\trautofit1");for(var d=r.s.c;d<=r.e.c;++d)s.push("\\cellx"+(d+1));for(s.push("\\pard\\intbl"),d=r.s.c;d<=r.e.c;++d){var u=Nn({r:c,c:d});o=l?(i[c]||[])[d]:i[u],!(!o||o.v==null&&(!o.f||o.F))&&(s.push(" "+(o.w||(Xo(o),o.w))),s.push("\\cell"))}s.push("\\pard\\intbl\\row")}return s.join("")+"}"}return{to_workbook:n,to_sheet:t,from_sheet:a}}();function I$(t){var e=t.slice(t[0]==="#"?1:0).slice(0,6);return[parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16)]}function Tg(t){for(var e=0,n=1;e!=3;++e)n=n*256+(t[e]>255?255:t[e]<0?0:t[e]);return n.toString(16).toUpperCase().slice(1)}function M$(t){var e=t[0]/255,n=t[1]/255,a=t[2]/255,i=Math.max(e,n,a),s=Math.min(e,n,a),r=i-s;if(r===0)return[0,0,e];var o=0,l=0,c=i+s;switch(l=r/(c>1?2-c:c),i){case e:o=((n-a)/r+6)%6;break;case n:o=(a-e)/r+2;break;case a:o=(e-n)/r+4;break}return[o/6,l,c/2]}function F$(t){var e=t[0],n=t[1],a=t[2],i=n*2*(a<.5?a:1-a),s=a-i/2,r=[s,s,s],o=6*e,l;if(n!==0)switch(o|0){case 0:case 6:l=i*o,r[0]+=i,r[1]+=l;break;case 1:l=i*(2-o),r[0]+=l,r[1]+=i;break;case 2:l=i*(o-2),r[1]+=i,r[2]+=l;break;case 3:l=i*(4-o),r[1]+=l,r[2]+=i;break;case 4:l=i*(o-4),r[2]+=i,r[0]+=l;break;case 5:l=i*(6-o),r[2]+=l,r[0]+=i;break}for(var c=0;c!=3;++c)r[c]=Math.round(r[c]*255);return r}function Z_(t,e){if(e===0)return t;var n=M$(I$(t));return e<0?n[2]=n[2]*(1+e):n[2]=1-(1-n[2])*(1-e),Tg(F$(n))}var qD=6,P$=15,N$=1,ws=qD;function Dg(t){return Math.floor((t+Math.round(128/ws)/256)*ws)}function Cg(t){return Math.floor((t-5)/ws*100+.5)/100}function J_(t){return Math.round((t*ws+5)/ws*256)/256}function G1(t){return J_(Cg(Dg(t)))}function j1(t){var e=Math.abs(t-G1(t)),n=ws;if(e>.005)for(ws=N$;ws<P$;++ws)Math.abs(t-G1(t))<=e&&(e=Math.abs(t-G1(t)),n=ws);ws=n}function ru(t){t.width?(t.wpx=Dg(t.width),t.wch=Cg(t.wpx),t.MDW=ws):t.wpx?(t.wch=Cg(t.wpx),t.width=J_(t.wch),t.MDW=ws):typeof t.wch=="number"&&(t.width=J_(t.wch),t.wpx=Dg(t.width),t.MDW=ws),t.customWidth&&delete t.customWidth}var B$=96,WD=B$;function Lg(t){return t*96/WD}function Qf(t){return t*WD/96}var $$={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function O$(t,e,n,a){e.Borders=[];var i={},s=!1;(t[0].match(gs)||[]).forEach(function(r){var o=Pn(r);switch(jo(o[0])){case"<borders":case"<borders>":case"</borders>":break;case"<border":case"<border>":case"<border/>":i={},o.diagonalUp&&(i.diagonalUp=Ya(o.diagonalUp)),o.diagonalDown&&(i.diagonalDown=Ya(o.diagonalDown)),e.Borders.push(i);break;case"</border>":break;case"<left/>":break;case"<left":case"<left>":break;case"</left>":break;case"<right/>":break;case"<right":case"<right>":break;case"</right>":break;case"<top/>":break;case"<top":case"<top>":break;case"</top>":break;case"<bottom/>":break;case"<bottom":case"<bottom>":break;case"</bottom>":break;case"<diagonal":case"<diagonal>":case"<diagonal/>":break;case"</diagonal>":break;case"<horizontal":case"<horizontal>":case"<horizontal/>":break;case"</horizontal>":break;case"<vertical":case"<vertical>":case"<vertical/>":break;case"</vertical>":break;case"<start":case"<start>":case"<start/>":break;case"</start>":break;case"<end":case"<end>":case"<end/>":break;case"</end>":break;case"<color":case"<color>":break;case"<color/>":case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(a&&a.WTF&&!s)throw new Error("unrecognized "+o[0]+" in borders")}})}function R$(t,e,n,a){e.Fills=[];var i={},s=!1;(t[0].match(gs)||[]).forEach(function(r){var o=Pn(r);switch(jo(o[0])){case"<fills":case"<fills>":case"</fills>":break;case"<fill>":case"<fill":case"<fill/>":i={},e.Fills.push(i);break;case"</fill>":break;case"<gradientFill>":break;case"<gradientFill":case"</gradientFill>":e.Fills.push(i),i={};break;case"<patternFill":case"<patternFill>":o.patternType&&(i.patternType=o.patternType);break;case"<patternFill/>":case"</patternFill>":break;case"<bgColor":i.bgColor||(i.bgColor={}),o.indexed&&(i.bgColor.indexed=parseInt(o.indexed,10)),o.theme&&(i.bgColor.theme=parseInt(o.theme,10)),o.tint&&(i.bgColor.tint=parseFloat(o.tint)),o.rgb&&(i.bgColor.rgb=o.rgb.slice(-6));break;case"<bgColor/>":case"</bgColor>":break;case"<fgColor":i.fgColor||(i.fgColor={}),o.theme&&(i.fgColor.theme=parseInt(o.theme,10)),o.tint&&(i.fgColor.tint=parseFloat(o.tint)),o.rgb!=null&&(i.fgColor.rgb=o.rgb.slice(-6));break;case"<fgColor/>":case"</fgColor>":break;case"<stop":case"<stop/>":break;case"</stop>":break;case"<color":case"<color/>":break;case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(a&&a.WTF&&!s)throw new Error("unrecognized "+o[0]+" in fills")}})}function U$(t,e,n,a){e.Fonts=[];var i={},s=!1;(t[0].match(gs)||[]).forEach(function(r){var o=Pn(r);switch(jo(o[0])){case"<fonts":case"<fonts>":case"</fonts>":break;case"<font":case"<font>":break;case"</font>":case"<font/>":e.Fonts.push(i),i={};break;case"<name":o.val&&(i.name=Ia(o.val));break;case"<name/>":case"</name>":break;case"<b":i.bold=o.val?Ya(o.val):1;break;case"<b/>":i.bold=1;break;case"<i":i.italic=o.val?Ya(o.val):1;break;case"<i/>":i.italic=1;break;case"<u":switch(o.val){case"none":i.underline=0;break;case"single":i.underline=1;break;case"double":i.underline=2;break;case"singleAccounting":i.underline=33;break;case"doubleAccounting":i.underline=34;break}break;case"<u/>":i.underline=1;break;case"<strike":i.strike=o.val?Ya(o.val):1;break;case"<strike/>":i.strike=1;break;case"<outline":i.outline=o.val?Ya(o.val):1;break;case"<outline/>":i.outline=1;break;case"<shadow":i.shadow=o.val?Ya(o.val):1;break;case"<shadow/>":i.shadow=1;break;case"<condense":i.condense=o.val?Ya(o.val):1;break;case"<condense/>":i.condense=1;break;case"<extend":i.extend=o.val?Ya(o.val):1;break;case"<extend/>":i.extend=1;break;case"<sz":o.val&&(i.sz=+o.val);break;case"<sz/>":case"</sz>":break;case"<vertAlign":o.val&&(i.vertAlign=o.val);break;case"<vertAlign/>":case"</vertAlign>":break;case"<family":o.val&&(i.family=parseInt(o.val,10));break;case"<family/>":case"</family>":break;case"<scheme":o.val&&(i.scheme=o.val);break;case"<scheme/>":case"</scheme>":break;case"<charset":if(o.val=="1")break;o.codepage=i1[parseInt(o.val,10)];break;case"<color":if(i.color||(i.color={}),o.auto&&(i.color.auto=Ya(o.auto)),o.rgb)i.color.rgb=o.rgb.slice(-6);else if(o.indexed){i.color.index=parseInt(o.indexed,10);var l=eu[i.color.index];i.color.index==81&&(l=eu[1]),l||(l=eu[1]),i.color.rgb=l[0].toString(16)+l[1].toString(16)+l[2].toString(16)}else o.theme&&(i.color.theme=parseInt(o.theme,10),o.tint&&(i.color.tint=parseFloat(o.tint)),o.theme&&n.themeElements&&n.themeElements.clrScheme&&(i.color.rgb=Z_(n.themeElements.clrScheme[i.color.theme].rgb,i.color.tint||0)));break;case"<color/>":case"</color>":break;case"<AlternateContent":s=!0;break;case"</AlternateContent>":s=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(a&&a.WTF&&!s)throw new Error("unrecognized "+o[0]+" in fonts")}})}function H$(t,e,n){e.NumberFmt=[];for(var a=oi(Dn),i=0;i<a.length;++i)e.NumberFmt[a[i]]=Dn[a[i]];var s=t[0].match(gs);if(s)for(i=0;i<s.length;++i){var r=Pn(s[i]);switch(jo(r[0])){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":break;case"<numFmt":{var o=ga(Ia(r.formatCode)),l=parseInt(r.numFmtId,10);if(e.NumberFmt[l]=o,l>0){if(l>392){for(l=392;l>60&&e.NumberFmt[l]!=null;--l);e.NumberFmt[l]=o}Go(o,l)}}break;case"</numFmt>":break;default:if(n.WTF)throw new Error("unrecognized "+r[0]+" in numFmts")}}}function q$(t){var e=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(n){for(var a=n[0];a<=n[1];++a)t[a]!=null&&(e[e.length]=nn("numFmt",null,{numFmtId:a,formatCode:Ha(t[a])}))}),e.length===1?"":(e[e.length]="</numFmts>",e[0]=nn("numFmts",null,{count:e.length-2}).replace("/>",">"),e.join(""))}var Q_=["numFmtId","fillId","fontId","borderId","xfId"],ew=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function W$(t,e,n){e.CellXf=[];var a,i=!1;(t[0].match(gs)||[]).forEach(function(s){var r=Pn(s),o=0;switch(jo(r[0])){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":break;case"<xf":case"<xf/>":for(a=r,delete a[0],o=0;o<Q_.length;++o)a[Q_[o]]&&(a[Q_[o]]=parseInt(a[Q_[o]],10));for(o=0;o<ew.length;++o)a[ew[o]]&&(a[ew[o]]=Ya(a[ew[o]]));if(e.NumberFmt&&a.numFmtId>392){for(o=392;o>60;--o)if(e.NumberFmt[a.numFmtId]==e.NumberFmt[o]){a.numFmtId=o;break}}e.CellXf.push(a);break;case"</xf>":break;case"<alignment":case"<alignment/>":var l={};r.vertical&&(l.vertical=r.vertical),r.horizontal&&(l.horizontal=r.horizontal),r.textRotation!=null&&(l.textRotation=r.textRotation),r.indent&&(l.indent=r.indent),r.wrapText&&(l.wrapText=Ya(r.wrapText)),a.alignment=l;break;case"</alignment>":break;case"<protection":break;case"</protection>":case"<protection/>":break;case"<AlternateContent":i=!0;break;case"</AlternateContent>":i=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;default:if(n&&n.WTF&&!i)throw new Error("unrecognized "+r[0]+" in cellXfs")}})}function V$(t){var e=[];return e[e.length]=nn("cellXfs",null),t.forEach(function(n){e[e.length]=nn("xf",null,n)}),e[e.length]="</cellXfs>",e.length===2?"":(e[0]=nn("cellXfs",null,{count:e.length-2}).replace("/>",">"),e.join(""))}var z$=function(){var e=/<(?:\w+:)?numFmts([^>]*)>[\S\s]*?<\/(?:\w+:)?numFmts>/,n=/<(?:\w+:)?cellXfs([^>]*)>[\S\s]*?<\/(?:\w+:)?cellXfs>/,a=/<(?:\w+:)?fills([^>]*)>[\S\s]*?<\/(?:\w+:)?fills>/,i=/<(?:\w+:)?fonts([^>]*)>[\S\s]*?<\/(?:\w+:)?fonts>/,s=/<(?:\w+:)?borders([^>]*)>[\S\s]*?<\/(?:\w+:)?borders>/;return function(o,l,c){var d={};if(!o)return d;o=o.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");var u;return(u=o.match(e))&&H$(u,d,c),(u=o.match(i))&&U$(u,d,l,c),(u=o.match(a))&&R$(u,d,l,c),(u=o.match(s))&&O$(u,d,l,c),(u=o.match(n))&&W$(u,d,c),d}}();function VD(t,e){var n=[Di,nn("styleSheet",null,{xmlns:yc[0],"xmlns:vt":Ci.vt})],a;return t.SSF&&(a=q$(t.SSF))!=null&&(n[n.length]=a),n[n.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',n[n.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',n[n.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',n[n.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(a=V$(e.cellXfs))&&(n[n.length]=a),n[n.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',n[n.length]='<dxfs count="0"/>',n[n.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',n.length>2&&(n[n.length]="</styleSheet>",n[1]=n[1].replace("/>",">")),n.join("")}function Y$(t,e){var n=t.read_shift(2),a=bs(t,e-2);return[n,a]}function G$(t,e,n){n||(n=Dt(6+4*e.length)),n.write_shift(2,t),is(e,n);var a=n.length>n.l?n.slice(0,n.l):n;return n.l==null&&(n.l=n.length),a}function j$(t,e,n){var a={};a.sz=t.read_shift(2)/20;var i=D8(t,2,n);i.fItalic&&(a.italic=1),i.fCondense&&(a.condense=1),i.fExtend&&(a.extend=1),i.fShadow&&(a.shadow=1),i.fOutline&&(a.outline=1),i.fStrikeout&&(a.strike=1);var s=t.read_shift(2);switch(s===700&&(a.bold=1),t.read_shift(2)){case 1:a.vertAlign="superscript";break;case 2:a.vertAlign="subscript";break}var r=t.read_shift(1);r!=0&&(a.underline=r);var o=t.read_shift(1);o>0&&(a.family=o);var l=t.read_shift(1);switch(l>0&&(a.charset=l),t.l++,a.color=T8(t,8),t.read_shift(1)){case 1:a.scheme="major";break;case 2:a.scheme="minor";break}return a.name=bs(t,e-21),a}function K$(t,e){e||(e=Dt(25+4*32)),e.write_shift(2,t.sz*20),C8(t,e),e.write_shift(2,t.bold?700:400);var n=0;t.vertAlign=="superscript"?n=1:t.vertAlign=="subscript"&&(n=2),e.write_shift(2,n),e.write_shift(1,t.underline||0),e.write_shift(1,t.family||0),e.write_shift(1,t.charset||0),e.write_shift(1,0),q_(t.color,e);var a=0;return t.scheme=="major"&&(a=1),t.scheme=="minor"&&(a=2),e.write_shift(1,a),is(t.name,e),e.length>e.l?e.slice(0,e.l):e}var X$=null,K1,Z$=ms;function zD(t,e){e||(e=Dt(4*3+8*7+16*1)),K1||(K1=P_(X$));var n=K1[t.patternType];n==null&&(n=40),e.write_shift(4,n);var a=0;if(n!=40)for(q_({auto:1},e),q_({auto:1},e);a<12;++a)e.write_shift(4,0);else{for(;a<4;++a)e.write_shift(4,0);for(;a<12;++a)e.write_shift(4,0)}return e.length>e.l?e.slice(0,e.l):e}function J$(t,e){var n=t.l+e,a=t.read_shift(2),i=t.read_shift(2);return t.l=n,{ixfe:a,numFmtId:i}}function YD(t,e,n){n||(n=Dt(16)),n.write_shift(2,e||0),n.write_shift(2,t.numFmtId||0),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(1,0),n.write_shift(1,0);var a=0;return n.write_shift(1,a),n.write_shift(1,0),n.write_shift(1,0),n.write_shift(1,0),n}function Ig(t,e){return e||(e=Dt(10)),e.write_shift(1,0),e.write_shift(1,0),e.write_shift(4,0),e.write_shift(4,0),e}var Q$=ms;function eO(t,e){return e||(e=Dt(51)),e.write_shift(1,0),Ig(null,e),Ig(null,e),Ig(null,e),Ig(null,e),Ig(null,e),e.length>e.l?e.slice(0,e.l):e}function tO(t,e){return e||(e=Dt(12+4*10)),e.write_shift(4,t.xfId),e.write_shift(2,1),e.write_shift(1,+t.builtinId),e.write_shift(1,0),C1(t.name||"",e),e.length>e.l?e.slice(0,e.l):e}function nO(t,e,n){var a=Dt(2052);return a.write_shift(4,t),C1(e,a),C1(n,a),a.length>a.l?a.slice(0,a.l):a}function aO(t,e,n){var a={};a.NumberFmt=[];for(var i in Dn)a.NumberFmt[i]=Dn[i];a.CellXf=[],a.Fonts=[];var s=[],r=!1;return Tl(t,function(l,c,d){switch(d){case 44:a.NumberFmt[l[0]]=l[1],Go(l[1],l[0]);break;case 43:a.Fonts.push(l),l.color.theme!=null&&e&&e.themeElements&&e.themeElements.clrScheme&&(l.color.rgb=Z_(e.themeElements.clrScheme[l.color.theme].rgb,l.color.tint||0));break;case 1025:break;case 45:break;case 46:break;case 47:s[s.length-1]==617&&a.CellXf.push(l);break;case 48:case 507:case 572:case 475:break;case 1171:case 2102:case 1130:case 512:case 2095:case 3072:break;case 35:r=!0;break;case 36:r=!1;break;case 37:s.push(d),r=!0;break;case 38:s.pop(),r=!1;break;default:if(c.T>0)s.push(d);else if(c.T<0)s.pop();else if(!r||n.WTF&&s[s.length-1]!=37)throw new Error("Unexpected record 0x"+d.toString(16))}}),a}function iO(t,e){if(e){var n=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(a){for(var i=a[0];i<=a[1];++i)e[i]!=null&&++n}),n!=0&&(Wt(t,615,xo(n)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(a){for(var i=a[0];i<=a[1];++i)e[i]!=null&&Wt(t,44,G$(i,e[i]))}),Wt(t,616))}}function sO(t){var e=1;e!=0&&(Wt(t,611,xo(e)),Wt(t,43,K$({sz:12,color:{theme:1},name:"Calibri",family:2,scheme:"minor"})),Wt(t,612))}function rO(t){var e=2;e!=0&&(Wt(t,603,xo(e)),Wt(t,45,zD({patternType:"none"})),Wt(t,45,zD({patternType:"gray125"})),Wt(t,604))}function oO(t){var e=1;e!=0&&(Wt(t,613,xo(e)),Wt(t,46,eO({})),Wt(t,614))}function lO(t){var e=1;Wt(t,626,xo(e)),Wt(t,47,YD({numFmtId:0,fontId:0,fillId:0,borderId:0},65535)),Wt(t,627)}function cO(t,e){Wt(t,617,xo(e.length)),e.forEach(function(n){Wt(t,47,YD(n,0))}),Wt(t,618)}function dO(t){var e=1;Wt(t,619,xo(e)),Wt(t,48,tO({xfId:0,builtinId:0,name:"Normal"})),Wt(t,620)}function uO(t){var e=0;Wt(t,505,xo(e)),Wt(t,506)}function fO(t){var e=0;Wt(t,508,nO(e,"TableStyleMedium9","PivotStyleMedium4")),Wt(t,509)}function Wz(){}function pO(t,e){var n=Us();return Wt(n,278),iO(n,t.SSF),sO(n,t),rO(n,t),oO(n,t),lO(n,t),cO(n,e.cellXfs),dO(n,t),uO(n,t),fO(n,t),Wt(n,279),n.end()}var hO=["</a:lt1>","</a:dk1>","</a:lt2>","</a:dk2>","</a:accent1>","</a:accent2>","</a:accent3>","</a:accent4>","</a:accent5>","</a:accent6>","</a:hlink>","</a:folHlink>"];function gO(t,e,n){e.themeElements.clrScheme=[];var a={};(t[0].match(gs)||[]).forEach(function(i){var s=Pn(i);switch(s[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":a.rgb=s.val;break;case"<a:sysClr":a.rgb=s.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:lt1>":case"</a:lt1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":s[0].charAt(1)==="/"?(e.themeElements.clrScheme[hO.indexOf(s[0])]=a,a={}):a.name=s[0].slice(3,s[0].length-1);break;default:if(n&&n.WTF)throw new Error("Unrecognized "+s[0]+" in clrScheme")}})}function mO(){}function bO(){}var yO=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/,_O=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/,wO=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function vO(t,e,n){e.themeElements={};var a;[["clrScheme",yO,gO],["fontScheme",_O,mO],["fmtScheme",wO,bO]].forEach(function(i){if(!(a=t.match(i[1])))throw new Error(i[0]+" not found in themeElements");i[2](a,e,n)})}var xO=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function GD(t,e){(!t||t.length===0)&&(t=X1());var n,a={};if(!(n=t.match(xO)))throw new Error("themeElements not found in theme");return vO(n[0],a,e),a.raw=t,a}function X1(t,e){if(e&&e.themeXLSX)return e.themeXLSX;if(t&&typeof t.raw=="string")return t.raw;var n=[Di];return n[n.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',n[n.length]="<a:themeElements>",n[n.length]='<a:clrScheme name="Office">',n[n.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',n[n.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',n[n.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',n[n.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',n[n.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',n[n.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',n[n.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',n[n.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',n[n.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',n[n.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',n[n.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',n[n.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',n[n.length]="</a:clrScheme>",n[n.length]='<a:fontScheme name="Office">',n[n.length]="<a:majorFont>",n[n.length]='<a:latin typeface="Cambria"/>',n[n.length]='<a:ea typeface=""/>',n[n.length]='<a:cs typeface=""/>',n[n.length]='<a:font script="Jpan" typeface="\uFF2D\uFF33 \uFF30\u30B4\u30B7\u30C3\u30AF"/>',n[n.length]='<a:font script="Hang" typeface="\uB9D1\uC740 \uACE0\uB515"/>',n[n.length]='<a:font script="Hans" typeface="\u5B8B\u4F53"/>',n[n.length]='<a:font script="Hant" typeface="\u65B0\u7D30\u660E\u9AD4"/>',n[n.length]='<a:font script="Arab" typeface="Times New Roman"/>',n[n.length]='<a:font script="Hebr" typeface="Times New Roman"/>',n[n.length]='<a:font script="Thai" typeface="Tahoma"/>',n[n.length]='<a:font script="Ethi" typeface="Nyala"/>',n[n.length]='<a:font script="Beng" typeface="Vrinda"/>',n[n.length]='<a:font script="Gujr" typeface="Shruti"/>',n[n.length]='<a:font script="Khmr" typeface="MoolBoran"/>',n[n.length]='<a:font script="Knda" typeface="Tunga"/>',n[n.length]='<a:font script="Guru" typeface="Raavi"/>',n[n.length]='<a:font script="Cans" typeface="Euphemia"/>',n[n.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',n[n.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',n[n.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',n[n.length]='<a:font script="Thaa" typeface="MV Boli"/>',n[n.length]='<a:font script="Deva" typeface="Mangal"/>',n[n.length]='<a:font script="Telu" typeface="Gautami"/>',n[n.length]='<a:font script="Taml" typeface="Latha"/>',n[n.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',n[n.length]='<a:font script="Orya" typeface="Kalinga"/>',n[n.length]='<a:font script="Mlym" typeface="Kartika"/>',n[n.length]='<a:font script="Laoo" typeface="DokChampa"/>',n[n.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',n[n.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',n[n.length]='<a:font script="Viet" typeface="Times New Roman"/>',n[n.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',n[n.length]='<a:font script="Geor" typeface="Sylfaen"/>',n[n.length]="</a:majorFont>",n[n.length]="<a:minorFont>",n[n.length]='<a:latin typeface="Calibri"/>',n[n.length]='<a:ea typeface=""/>',n[n.length]='<a:cs typeface=""/>',n[n.length]='<a:font script="Jpan" typeface="\uFF2D\uFF33 \uFF30\u30B4\u30B7\u30C3\u30AF"/>',n[n.length]='<a:font script="Hang" typeface="\uB9D1\uC740 \uACE0\uB515"/>',n[n.length]='<a:font script="Hans" typeface="\u5B8B\u4F53"/>',n[n.length]='<a:font script="Hant" typeface="\u65B0\u7D30\u660E\u9AD4"/>',n[n.length]='<a:font script="Arab" typeface="Arial"/>',n[n.length]='<a:font script="Hebr" typeface="Arial"/>',n[n.length]='<a:font script="Thai" typeface="Tahoma"/>',n[n.length]='<a:font script="Ethi" typeface="Nyala"/>',n[n.length]='<a:font script="Beng" typeface="Vrinda"/>',n[n.length]='<a:font script="Gujr" typeface="Shruti"/>',n[n.length]='<a:font script="Khmr" typeface="DaunPenh"/>',n[n.length]='<a:font script="Knda" typeface="Tunga"/>',n[n.length]='<a:font script="Guru" typeface="Raavi"/>',n[n.length]='<a:font script="Cans" typeface="Euphemia"/>',n[n.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',n[n.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',n[n.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',n[n.length]='<a:font script="Thaa" typeface="MV Boli"/>',n[n.length]='<a:font script="Deva" typeface="Mangal"/>',n[n.length]='<a:font script="Telu" typeface="Gautami"/>',n[n.length]='<a:font script="Taml" typeface="Latha"/>',n[n.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',n[n.length]='<a:font script="Orya" typeface="Kalinga"/>',n[n.length]='<a:font script="Mlym" typeface="Kartika"/>',n[n.length]='<a:font script="Laoo" typeface="DokChampa"/>',n[n.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',n[n.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',n[n.length]='<a:font script="Viet" typeface="Arial"/>',n[n.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',n[n.length]='<a:font script="Geor" typeface="Sylfaen"/>',n[n.length]="</a:minorFont>",n[n.length]="</a:fontScheme>",n[n.length]='<a:fmtScheme name="Office">',n[n.length]="<a:fillStyleLst>",n[n.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:lin ang="16200000" scaled="1"/>',n[n.length]="</a:gradFill>",n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:lin ang="16200000" scaled="0"/>',n[n.length]="</a:gradFill>",n[n.length]="</a:fillStyleLst>",n[n.length]="<a:lnStyleLst>",n[n.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',n[n.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',n[n.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',n[n.length]="</a:lnStyleLst>",n[n.length]="<a:effectStyleLst>",n[n.length]="<a:effectStyle>",n[n.length]="<a:effectLst>",n[n.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',n[n.length]="</a:effectLst>",n[n.length]="</a:effectStyle>",n[n.length]="<a:effectStyle>",n[n.length]="<a:effectLst>",n[n.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',n[n.length]="</a:effectLst>",n[n.length]="</a:effectStyle>",n[n.length]="<a:effectStyle>",n[n.length]="<a:effectLst>",n[n.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',n[n.length]="</a:effectLst>",n[n.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',n[n.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',n[n.length]="</a:effectStyle>",n[n.length]="</a:effectStyleLst>",n[n.length]="<a:bgFillStyleLst>",n[n.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',n[n.length]="</a:gradFill>",n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',n[n.length]="</a:gradFill>",n[n.length]="</a:bgFillStyleLst>",n[n.length]="</a:fmtScheme>",n[n.length]="</a:themeElements>",n[n.length]="<a:objectDefaults>",n[n.length]="<a:spDef>",n[n.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',n[n.length]="</a:spDef>",n[n.length]="<a:lnDef>",n[n.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',n[n.length]="</a:lnDef>",n[n.length]="</a:objectDefaults>",n[n.length]="<a:extraClrSchemeLst/>",n[n.length]="</a:theme>",n.join("")}function EO(t,e,n){var a=t.l+e,i=t.read_shift(4);if(i!==124226){if(!n.cellStyles){t.l=a;return}var s=t.slice(t.l);t.l=a;var r;try{r=u3(s,{type:"array"})}catch(l){return}var o=Sr(r,"theme/theme/theme1.xml",!0);if(o)return GD(o,n)}}function kO(t){return t.read_shift(4)}function SO(t){var e={};switch(e.xclrType=t.read_shift(2),e.nTintShade=t.read_shift(2),e.xclrType){case 0:t.l+=4;break;case 1:e.xclrValue=AO(t,4);break;case 2:e.xclrValue=bD(t,4);break;case 3:e.xclrValue=kO(t,4);break;case 4:t.l+=4;break}return t.l+=8,e}function AO(t,e){return ms(t,e)}function TO(t,e){return ms(t,e)}function DO(t){var e=t.read_shift(2),n=t.read_shift(2)-4,a=[e];switch(e){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:a[1]=SO(t,n);break;case 6:a[1]=TO(t,n);break;case 14:case 15:a[1]=t.read_shift(n===1?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+e+" "+n)}return a}function CO(t,e){var n=t.l+e;t.l+=2;var a=t.read_shift(2);t.l+=2;for(var i=t.read_shift(2),s=[];i-- >0;)s.push(DO(t,n-t.l));return{ixfe:a,ext:s}}function LO(t,e){e.forEach(function(n){switch(n[0]){case 4:break;case 5:break;case 6:break;case 7:break;case 8:break;case 9:break;case 10:break;case 11:break;case 13:break;case 14:break;case 15:break}})}function IO(t,e){return{flags:t.read_shift(4),version:t.read_shift(4),name:bs(t,e-8)}}function MO(t){var e=Dt(12+2*t.name.length);return e.write_shift(4,t.flags),e.write_shift(4,t.version),is(t.name,e),e.slice(0,e.l)}function FO(t){for(var e=[],n=t.read_shift(4);n-- >0;)e.push([t.read_shift(4),t.read_shift(4)]);return e}function PO(t){var e=Dt(4+8*t.length);e.write_shift(4,t.length);for(var n=0;n<t.length;++n)e.write_shift(4,t[n][0]),e.write_shift(4,t[n][1]);return e}function NO(t,e){var n=Dt(8+2*e.length);return n.write_shift(4,t),is(e,n),n.slice(0,n.l)}function BO(t){return t.l+=4,t.read_shift(4)!=0}function $O(t,e){var n=Dt(8);return n.write_shift(4,t),n.write_shift(4,e?1:0),n}function OO(t,e,n){var a={Types:[],Cell:[],Value:[]},i=n||{},s=[],r=!1,o=2;return Tl(t,function(l,c,d){switch(d){case 335:a.Types.push({name:l.name});break;case 51:l.forEach(function(u){o==1?a.Cell.push({type:a.Types[u[0]-1].name,index:u[1]}):o==0&&a.Value.push({type:a.Types[u[0]-1].name,index:u[1]})});break;case 337:o=l?1:0;break;case 338:o=2;break;case 35:s.push(d),r=!0;break;case 36:s.pop(),r=!1;break;default:if(!c.T){if(!r||i.WTF&&s[s.length-1]!=35)throw new Error("Unexpected record 0x"+d.toString(16))}}}),a}function RO(){var t=Us();return Wt(t,332),Wt(t,334,xo(1)),Wt(t,335,MO({name:"XLDAPR",version:12e4,flags:3496657072})),Wt(t,336),Wt(t,339,NO(1,"XLDAPR")),Wt(t,52),Wt(t,35,xo(514)),Wt(t,4096,xo(0)),Wt(t,4097,Wr(1)),Wt(t,36),Wt(t,53),Wt(t,340),Wt(t,337,$O(1,!0)),Wt(t,51,PO([[1,0]])),Wt(t,338),Wt(t,333),t.end()}function UO(t,e,n){var a={Types:[],Cell:[],Value:[]};if(!t)return a;var i=!1,s=2,r;return t.replace(gs,function(o){var l=Pn(o);switch(jo(l[0])){case"<?xml":break;case"<metadata":case"</metadata>":break;case"<metadataTypes":case"</metadataTypes>":break;case"<metadataType":a.Types.push({name:l.name});break;case"</metadataType>":break;case"<futureMetadata":for(var c=0;c<a.Types.length;++c)a.Types[c].name==l.name&&(r=a.Types[c]);break;case"</futureMetadata>":break;case"<bk>":break;case"</bk>":break;case"<rc":s==1?a.Cell.push({type:a.Types[l.t-1].name,index:+l.v}):s==0&&a.Value.push({type:a.Types[l.t-1].name,index:+l.v});break;case"</rc>":break;case"<cellMetadata":s=1;break;case"</cellMetadata>":s=2;break;case"<valueMetadata":s=0;break;case"</valueMetadata>":s=2;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;case"<rvb":if(!r)break;r.offsets||(r.offsets=[]),r.offsets.push(+l.i);break;default:if(!i&&n.WTF)throw new Error("unrecognized "+l[0]+" in metadata")}return o}),a}function jD(){var t=[Di];return t.push(`<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">
  <metadataTypes count="1">
    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>
  </metadataTypes>
  <futureMetadata name="XLDAPR" count="1">
    <bk>
      <extLst>
        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">
          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>
        </ext>
      </extLst>
    </bk>
  </futureMetadata>
  <cellMetadata count="1">
    <bk>
      <rc t="1" v="0"/>
    </bk>
  </cellMetadata>
</metadata>`),t.join("")}function HO(t){var e=[];if(!t)return e;var n=1;return(t.match(gs)||[]).forEach(function(a){var i=Pn(a);switch(i[0]){case"<?xml":break;case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete i[0],i.i?n=i.i:i.i=n,e.push(i);break}}),e}function qO(t){var e={};e.i=t.read_shift(4);var n={};n.r=t.read_shift(4),n.c=t.read_shift(4),e.r=Nn(n);var a=t.read_shift(1);return a&2&&(e.l="1"),a&8&&(e.a="1"),e}function WO(t,e,n){var a=[],i=!1;return Tl(t,function(r,o,l){switch(l){case 63:a.push(r);break;default:if(!o.T){if(!i||n.WTF)throw new Error("Unexpected record 0x"+l.toString(16))}}}),a}function Vz(){}function VO(t,e,n,a){if(!t)return t;var i=a||{},s=!1,r=!1;Tl(t,function(l,c,d){if(!r)switch(d){case 359:case 363:case 364:case 366:case 367:case 368:case 369:case 370:case 371:case 472:case 577:case 578:case 579:case 580:case 581:case 582:case 583:case 584:case 585:case 586:case 587:break;case 35:s=!0;break;case 36:s=!1;break;default:if(!c.T){if(!s||i.WTF)throw new Error("Unexpected record 0x"+d.toString(16))}}},i)}function zO(t,e){if(!t)return"??";var n=(t.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return e["!id"][n].Target}var ep=1024;function KD(t,e){for(var n=[21600,21600],a=["m0,0l0",n[1],n[0],n[1],n[0],"0xe"].join(","),i=[nn("xml",null,{"xmlns:v":Ar.v,"xmlns:o":Ar.o,"xmlns:x":Ar.x,"xmlns:mv":Ar.mv}).replace(/\/>/,">"),nn("o:shapelayout",nn("o:idmap",null,{"v:ext":"edit",data:t}),{"v:ext":"edit"}),nn("v:shapetype",[nn("v:stroke",null,{joinstyle:"miter"}),nn("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:n.join(","),path:a})];ep<t*1e3;)ep+=1e3;return e.forEach(function(s){var r=ti(s[0]),o={color2:"#BEFF82",type:"gradient"};o.type=="gradient"&&(o.angle="-180");var l=o.type=="gradient"?nn("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,c=nn("v:fill",l,o),d={on:"t",obscured:"t"};++ep,i=i.concat(["<v:shape"+x3({id:"_x0000_s"+ep,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(s[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",c,nn("v:shadow",null,d),nn("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",ns("x:Anchor",[r.c+1,0,r.r+1,0,r.c+3,20,r.r+5,20].join(",")),ns("x:AutoFill","False"),ns("x:Row",String(r.r)),ns("x:Column",String(r.c)),s[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),i.push("</xml>"),i.join("")}function XD(t,e,n,a){var i=Array.isArray(t),s;e.forEach(function(r){var o=ti(r.ref);if(i?(t[o.r]||(t[o.r]=[]),s=t[o.r][o.c]):s=t[r.ref],!s){s={t:"z"},i?t[o.r][o.c]=s:t[r.ref]=s;var l=oa(t["!ref"]||"BDWGO1000001:A1");l.s.r>o.r&&(l.s.r=o.r),l.e.r<o.r&&(l.e.r=o.r),l.s.c>o.c&&(l.s.c=o.c),l.e.c<o.c&&(l.e.c=o.c);var c=Yn(l);c!==t["!ref"]&&(t["!ref"]=c)}s.c||(s.c=[]);var d={a:r.author,t:r.t,r:r.r,T:n};r.h&&(d.h=r.h);for(var u=s.c.length-1;u>=0;--u){if(!n&&s.c[u].T)return;n&&!s.c[u].T&&s.c.splice(u,1)}if(n&&a){for(u=0;u<a.length;++u)if(d.a==a[u].id){d.a=a[u].name||d.a;break}}s.c.push(d)})}function YO(t,e){if(t.match(/<(?:\w+:)?comments *\/>/))return[];var n=[],a=[],i=t.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);i&&i[1]&&i[1].split(/<\/\w*:?author>/).forEach(function(r){if(!(r===""||r.trim()==="")){var o=r.match(/<(?:\w+:)?author[^>]*>(.*)/);o&&n.push(o[1])}});var s=t.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);return s&&s[1]&&s[1].split(/<\/\w*:?comment>/).forEach(function(r){if(!(r===""||r.trim()==="")){var o=r.match(/<(?:\w+:)?comment[^>]*>/);if(o){var l=Pn(o[0]),c={author:l.authorId&&n[l.authorId]||"sheetjsghost",ref:l.ref,guid:l.guid},d=ti(l.ref);if(!(e.sheetRows&&e.sheetRows<=d.r)){var u=r.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/),g=!!u&&!!u[1]&&z1(u[1])||{r:"",t:"",h:""};c.r=g.r,g.r=="<t></t>"&&(g.t=g.h=""),c.t=(g.t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),e.cellHTML&&(c.h=g.h),a.push(c)}}}}),a}function ZD(t){var e=[Di,nn("comments",null,{xmlns:yc[0]})],n=[];return e.push("<authors>"),t.forEach(function(a){a[1].forEach(function(i){var s=Ha(i.a);n.indexOf(s)==-1&&(n.push(s),e.push("<author>"+s+"</author>")),i.T&&i.ID&&n.indexOf("tc="+i.ID)==-1&&(n.push("tc="+i.ID),e.push("<author>tc="+i.ID+"</author>"))})}),n.length==0&&(n.push("SheetJ5"),e.push("<author>SheetJ5</author>")),e.push("</authors>"),e.push("<commentList>"),t.forEach(function(a){var i=0,s=[];if(a[1][0]&&a[1][0].T&&a[1][0].ID?i=n.indexOf("tc="+a[1][0].ID):a[1].forEach(function(l){l.a&&(i=n.indexOf(Ha(l.a))),s.push(l.t||"")}),e.push('<comment ref="'+a[0]+'" authorId="'+i+'"><text>'),s.length<=1)e.push(ns("t",Ha(s[0]||"")));else{for(var r=`Comment:
    `+s[0]+`
`,o=1;o<s.length;++o)r+=`Reply:
    `+s[o]+`
`;e.push(ns("t",Ha(r)))}e.push("</text></comment>")}),e.push("</commentList>"),e.length>2&&(e[e.length]="</comments>",e[1]=e[1].replace("/>",">")),e.join("")}function GO(t,e){var n=[],a=!1,i={},s=0;return t.replace(gs,function(o,l){var c=Pn(o);switch(jo(c[0])){case"<?xml":break;case"<ThreadedComments":break;case"</ThreadedComments>":break;case"<threadedComment":i={author:c.personId,guid:c.id,ref:c.ref,T:1};break;case"</threadedComment>":i.t!=null&&n.push(i);break;case"<text>":case"<text":s=l+o.length;break;case"</text>":i.t=t.slice(s,l).replace(/\r\n/g,`
`).replace(/\r/g,`
`);break;case"<mentions":case"<mentions>":a=!0;break;case"</mentions>":a=!1;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":a=!0;break;case"</ext>":a=!1;break;default:if(!a&&e.WTF)throw new Error("unrecognized "+c[0]+" in threaded comments")}return o}),n}function jO(t,e,n){var a=[Di,nn("ThreadedComments",null,{xmlns:Ci.TCMNT}).replace(/[\/]>/,">")];return t.forEach(function(i){var s="";(i[1]||[]).forEach(function(r,o){if(!r.T){delete r.ID;return}r.a&&e.indexOf(r.a)==-1&&e.push(r.a);var l={ref:i[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+n.tcid++).slice(-12)+"}"};o==0?s=l.id:l.parentId=s,r.ID=l.id,r.a&&(l.personId="{54EE7950-7262-4200-6969-"+("000000000000"+e.indexOf(r.a)).slice(-12)+"}"),a.push(nn("threadedComment",ns("text",r.t||""),l))})}),a.push("</ThreadedComments>"),a.join("")}function KO(t,e){var n=[],a=!1;return t.replace(gs,function(s){var r=Pn(s);switch(jo(r[0])){case"<?xml":break;case"<personList":break;case"</personList>":break;case"<person":n.push({name:r.displayname,id:r.id});break;case"</person>":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":a=!0;break;case"</ext>":a=!1;break;default:if(!a&&e.WTF)throw new Error("unrecognized "+r[0]+" in threaded comments")}return s}),n}function XO(t){var e=[Di,nn("personList",null,{xmlns:Ci.TCMNT,"xmlns:x":yc[0]}).replace(/[\/]>/,">")];return t.forEach(function(n,a){e.push(nn("person",null,{displayName:n,id:"{54EE7950-7262-4200-6969-"+("000000000000"+a).slice(-12)+"}",userId:n,providerId:"None"}))}),e.push("</personList>"),e.join("")}function ZO(t){var e={};e.iauthor=t.read_shift(4);var n=Jd(t,16);return e.rfx=n.s,e.ref=Nn(n.s),t.l+=16,e}function JO(t,e){return e==null&&(e=Dt(36)),e.write_shift(4,t[1].iauthor),H_(t[0],e),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(4,0),e.write_shift(4,0),e}var QO=bs;function eR(t){return is(t.slice(0,54))}function tR(t,e){var n=[],a=[],i={},s=!1;return Tl(t,function(o,l,c){switch(c){case 632:a.push(o);break;case 635:i=o;break;case 637:i.t=o.t,i.h=o.h,i.r=o.r;break;case 636:if(i.author=a[i.iauthor],delete i.iauthor,e.sheetRows&&i.rfx&&e.sheetRows<=i.rfx.r)break;i.t||(i.t=""),delete i.rfx,n.push(i);break;case 3072:break;case 35:s=!0;break;case 36:s=!1;break;case 37:break;case 38:break;default:if(!l.T){if(!s||e.WTF)throw new Error("Unexpected record 0x"+c.toString(16))}}}),n}function nR(t){var e=Us(),n=[];return Wt(e,628),Wt(e,630),t.forEach(function(a){a[1].forEach(function(i){n.indexOf(i.a)>-1||(n.push(i.a.slice(0,54)),Wt(e,632,eR(i.a)))})}),Wt(e,631),Wt(e,633),t.forEach(function(a){a[1].forEach(function(i){i.iauthor=n.indexOf(i.a);var s={s:ti(a[0]),e:ti(a[0])};Wt(e,635,JO([s,i])),i.t&&i.t.length>0&&Wt(e,637,k8(i)),Wt(e,636),delete i.iauthor})}),Wt(e,634),Wt(e,629),e.end()}var aR="application/vnd.ms-office.vbaProject";function iR(t){var e=An.utils.cfb_new({root:"R"});return t.FullPaths.forEach(function(n,a){if(!(n.slice(-1)==="/"||!n.match(/_VBA_PROJECT_CUR/))){var i=n.replace(/^[^\/]*/,"R").replace(/\/_VBA_PROJECT_CUR\u0000*/,"");An.utils.cfb_add(e,i,t.FileIndex[a].content)}}),An.write(e)}function sR(t,e){e.FullPaths.forEach(function(n,a){if(a!=0){var i=n.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");i.slice(-1)!=="/"&&An.utils.cfb_add(t,i,e.FileIndex[a].content)}})}var JD=null;function rR(){return{"!type":"dialog"}}function oR(){return{"!type":"dialog"}}function lR(){return{"!type":"macro"}}function cR(){return{"!type":"macro"}}var tp=function(){var t=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,e={r:0,c:0};function n(a,i,s,r){var o=!1,l=!1;s.length==0?l=!0:s.charAt(0)=="["&&(l=!0,s=s.slice(1,-1)),r.length==0?o=!0:r.charAt(0)=="["&&(o=!0,r=r.slice(1,-1));var c=s.length>0?parseInt(s,10)|0:0,d=r.length>0?parseInt(r,10)|0:0;return o?d+=e.c:--d,l?c+=e.r:--c,i+(o?"":"$")+Ga(d)+(l?"":"$")+ci(c)}return function(i,s){return e=s,i.replace(t,n)}}(),Z1=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,J1=function(){return function(e,n){return e.replace(Z1,function(a,i,s,r,o,l){var c=A1(r)-(s?0:n.c),d=S1(l)-(o?0:n.r),u=d==0?"":o?d+1:"["+d+"]",g=c==0?"":s?c+1:"["+c+"]";return i+"R"+u+"C"+g})}}();function QD(t,e){return t.replace(Z1,function(n,a,i,s,r,o){return a+(i=="$"?i+s:Ga(A1(s)+e.c))+(r=="$"?r+o:ci(S1(o)+e.r))})}function dR(t,e,n){var a=Tr(e),i=a.s,s=ti(n),r={r:s.r-i.r,c:s.c-i.c};return QD(t,r)}function uR(t){return t.length!=1}function eC(t){return t.replace(/_xlfn\./g,"")}function Ii(t){t.l+=1}function vc(t,e){var n=t.read_shift(e==1?1:2);return[n&16383,n>>14&1,n>>15&1]}function tC(t,e,n){var a=2;if(n){if(n.biff>=2&&n.biff<=5)return nC(t,e,n);n.biff==12&&(a=4)}var i=t.read_shift(a),s=t.read_shift(a),r=vc(t,2),o=vc(t,2);return{s:{r:i,c:r[0],cRel:r[1],rRel:r[2]},e:{r:s,c:o[0],cRel:o[1],rRel:o[2]}}}function nC(t){var e=vc(t,2),n=vc(t,2),a=t.read_shift(1),i=t.read_shift(1);return{s:{r:e[0],c:a,cRel:e[1],rRel:e[2]},e:{r:n[0],c:i,cRel:n[1],rRel:n[2]}}}function fR(t,e,n){if(n.biff<8)return nC(t,e,n);var a=t.read_shift(n.biff==12?4:2),i=t.read_shift(n.biff==12?4:2),s=vc(t,2),r=vc(t,2);return{s:{r:a,c:s[0],cRel:s[1],rRel:s[2]},e:{r:i,c:r[0],cRel:r[1],rRel:r[2]}}}function aC(t,e,n){if(n&&n.biff>=2&&n.biff<=5)return pR(t,e,n);var a=t.read_shift(n&&n.biff==12?4:2),i=vc(t,2);return{r:a,c:i[0],cRel:i[1],rRel:i[2]}}function pR(t){var e=vc(t,2),n=t.read_shift(1);return{r:e[0],c:n,cRel:e[1],rRel:e[2]}}function hR(t){var e=t.read_shift(2),n=t.read_shift(2);return{r:e,c:n&255,fQuoted:!!(n&16384),cRel:n>>15,rRel:n>>15}}function gR(t,e,n){var a=n&&n.biff?n.biff:8;if(a>=2&&a<=5)return mR(t,e,n);var i=t.read_shift(a>=12?4:2),s=t.read_shift(2),r=(s&16384)>>14,o=(s&32768)>>15;if(s&=16383,o==1)for(;i>524287;)i-=1048576;if(r==1)for(;s>8191;)s=s-16384;return{r:i,c:s,cRel:r,rRel:o}}function mR(t){var e=t.read_shift(2),n=t.read_shift(1),a=(e&32768)>>15,i=(e&16384)>>14;return e&=16383,a==1&&e>=8192&&(e=e-16384),i==1&&n>=128&&(n=n-256),{r:e,c:n,cRel:i,rRel:a}}function bR(t,e,n){var a=(t[t.l++]&96)>>5,i=tC(t,n.biff>=2&&n.biff<=5?6:8,n);return[a,i]}function yR(t,e,n){var a=(t[t.l++]&96)>>5,i=t.read_shift(2,"i"),s=8;if(n)switch(n.biff){case 5:t.l+=12,s=6;break;case 12:s=12;break}var r=tC(t,s,n);return[a,i,r]}function _R(t,e,n){var a=(t[t.l++]&96)>>5;return t.l+=n&&n.biff>8?12:n.biff<8?6:8,[a]}function wR(t,e,n){var a=(t[t.l++]&96)>>5,i=t.read_shift(2),s=8;if(n)switch(n.biff){case 5:t.l+=12,s=6;break;case 12:s=12;break}return t.l+=s,[a,i]}function vR(t,e,n){var a=(t[t.l++]&96)>>5,i=fR(t,e-1,n);return[a,i]}function xR(t,e,n){var a=(t[t.l++]&96)>>5;return t.l+=n.biff==2?6:n.biff==12?14:7,[a]}function iC(t){var e=t[t.l+1]&1,n=1;return t.l+=4,[e,n]}function ER(t,e,n){t.l+=2;for(var a=t.read_shift(n&&n.biff==2?1:2),i=[],s=0;s<=a;++s)i.push(t.read_shift(n&&n.biff==2?1:2));return i}function kR(t,e,n){var a=t[t.l+1]&255?1:0;return t.l+=2,[a,t.read_shift(n&&n.biff==2?1:2)]}function SR(t,e,n){var a=t[t.l+1]&255?1:0;return t.l+=2,[a,t.read_shift(n&&n.biff==2?1:2)]}function AR(t){var e=t[t.l+1]&255?1:0;return t.l+=2,[e,t.read_shift(2)]}function TR(t,e,n){var a=t[t.l+1]&255?1:0;return t.l+=n&&n.biff==2?3:4,[a]}function sC(t){var e=t.read_shift(1),n=t.read_shift(1);return[e,n]}function DR(t){return t.read_shift(2),sC(t,2)}function CR(t){return t.read_shift(2),sC(t,2)}function LR(t,e,n){var a=(t[t.l]&96)>>5;t.l+=1;var i=aC(t,0,n);return[a,i]}function IR(t,e,n){var a=(t[t.l]&96)>>5;t.l+=1;var i=gR(t,0,n);return[a,i]}function MR(t,e,n){var a=(t[t.l]&96)>>5;t.l+=1;var i=t.read_shift(2);n&&n.biff==5&&(t.l+=12);var s=aC(t,0,n);return[a,i,s]}function FR(t,e,n){var a=(t[t.l]&96)>>5;t.l+=1;var i=t.read_shift(n&&n.biff<=3?1:2);return[BU[i],dC[i],a]}function PR(t,e,n){var a=t[t.l++],i=t.read_shift(1),s=n&&n.biff<=3?[a==88?-1:0,t.read_shift(1)]:NR(t);return[i,(s[0]===0?dC:NU)[s[1]]]}function NR(t){return[t[t.l+1]>>7,t.read_shift(2)&32767]}function BR(t,e,n){t.l+=n&&n.biff==2?3:4}function $R(t,e,n){if(t.l++,n&&n.biff==12)return[t.read_shift(4,"i"),0];var a=t.read_shift(2),i=t.read_shift(n&&n.biff==2?1:2);return[a,i]}function OR(t){return t.l++,Dl[t.read_shift(1)]}function RR(t){return t.l++,t.read_shift(2)}function UR(t){return t.l++,t.read_shift(1)!==0}function HR(t){return t.l++,ys(t,8)}function qR(t,e,n){return t.l++,Sg(t,e-1,n)}function WR(t,e){var n=[t.read_shift(1)];if(e==12)switch(n[0]){case 2:n[0]=4;break;case 4:n[0]=16;break;case 0:n[0]=1;break;case 1:n[0]=2;break}switch(n[0]){case 4:n[1]=gi(t,1)?"TRUE":"FALSE",e!=12&&(t.l+=7);break;case 37:case 16:n[1]=Dl[t[t.l]],t.l+=e==12?4:8;break;case 0:t.l+=8;break;case 1:n[1]=ys(t,8);break;case 2:n[1]=au(t,0,{biff:e>0&&e<8?2:e});break;default:throw new Error("Bad SerAr: "+n[0])}return n}function VR(t,e,n){for(var a=t.read_shift(n.biff==12?4:2),i=[],s=0;s!=a;++s)i.push((n.biff==12?Jd:K_)(t,8));return i}function zR(t,e,n){var a=0,i=0;n.biff==12?(a=t.read_shift(4),i=t.read_shift(4)):(i=1+t.read_shift(1),a=1+t.read_shift(2)),n.biff>=2&&n.biff<8&&(--a,--i==0&&(i=256));for(var s=0,r=[];s!=a&&(r[s]=[]);++s)for(var o=0;o!=i;++o)r[s][o]=WR(t,n.biff);return r}function YR(t,e,n){var a=t.read_shift(1)>>>5&3,i=!n||n.biff>=8?4:2,s=t.read_shift(i);switch(n.biff){case 2:t.l+=5;break;case 3:case 4:t.l+=8;break;case 5:t.l+=12;break}return[a,0,s]}function GR(t,e,n){if(n.biff==5)return jR(t,e,n);var a=t.read_shift(1)>>>5&3,i=t.read_shift(2),s=t.read_shift(4);return[a,i,s]}function jR(t){var e=t.read_shift(1)>>>5&3,n=t.read_shift(2,"i");t.l+=8;var a=t.read_shift(2);return t.l+=12,[e,n,a]}function KR(t,e,n){var a=t.read_shift(1)>>>5&3;t.l+=n&&n.biff==2?3:4;var i=t.read_shift(n&&n.biff==2?1:2);return[a,i]}function XR(t,e,n){var a=t.read_shift(1)>>>5&3,i=t.read_shift(n&&n.biff==2?1:2);return[a,i]}function ZR(t,e,n){var a=t.read_shift(1)>>>5&3;return t.l+=4,n.biff<8&&t.l--,n.biff==12&&(t.l+=2),[a]}function JR(t,e,n){var a=(t[t.l++]&96)>>5,i=t.read_shift(2),s=4;if(n)switch(n.biff){case 5:s=15;break;case 12:s=6;break}return t.l+=s,[a,i]}var QR=ms,eU=ms,tU=ms;function Mg(t,e,n){return t.l+=2,[hR(t,4,n)]}function Q1(t){return t.l+=6,[]}var nU=Mg,aU=Q1,iU=Q1,sU=Mg;function rC(t){return t.l+=2,[Li(t),t.read_shift(2)&1]}var rU=Mg,oU=rC,lU=Q1,cU=Mg,dU=Mg,uU=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function fU(t){t.l+=2;var e=t.read_shift(2),n=t.read_shift(2),a=t.read_shift(4),i=t.read_shift(2),s=t.read_shift(2),r=uU[n>>2&31];return{ixti:e,coltype:n&3,rt:r,idx:a,c:i,C:s}}function pU(t){return t.l+=2,[t.read_shift(4)]}function hU(t,e,n){return t.l+=5,t.l+=2,t.l+=n.biff==2?1:4,["PTGSHEET"]}function gU(t,e,n){return t.l+=n.biff==2?4:5,["PTGENDSHEET"]}function mU(t){var e=t.read_shift(1)>>>5&3,n=t.read_shift(2);return[e,n]}function bU(t){var e=t.read_shift(1)>>>5&3,n=t.read_shift(2);return[e,n]}function yU(t){return t.l+=4,[0,0]}var oC={1:{n:"PtgExp",f:$R},2:{n:"PtgTbl",f:tU},3:{n:"PtgAdd",f:Ii},4:{n:"PtgSub",f:Ii},5:{n:"PtgMul",f:Ii},6:{n:"PtgDiv",f:Ii},7:{n:"PtgPower",f:Ii},8:{n:"PtgConcat",f:Ii},9:{n:"PtgLt",f:Ii},10:{n:"PtgLe",f:Ii},11:{n:"PtgEq",f:Ii},12:{n:"PtgGe",f:Ii},13:{n:"PtgGt",f:Ii},14:{n:"PtgNe",f:Ii},15:{n:"PtgIsect",f:Ii},16:{n:"PtgUnion",f:Ii},17:{n:"PtgRange",f:Ii},18:{n:"PtgUplus",f:Ii},19:{n:"PtgUminus",f:Ii},20:{n:"PtgPercent",f:Ii},21:{n:"PtgParen",f:Ii},22:{n:"PtgMissArg",f:Ii},23:{n:"PtgStr",f:qR},26:{n:"PtgSheet",f:hU},27:{n:"PtgEndSheet",f:gU},28:{n:"PtgErr",f:OR},29:{n:"PtgBool",f:UR},30:{n:"PtgInt",f:RR},31:{n:"PtgNum",f:HR},32:{n:"PtgArray",f:xR},33:{n:"PtgFunc",f:FR},34:{n:"PtgFuncVar",f:PR},35:{n:"PtgName",f:YR},36:{n:"PtgRef",f:LR},37:{n:"PtgArea",f:bR},38:{n:"PtgMemArea",f:KR},39:{n:"PtgMemErr",f:QR},40:{n:"PtgMemNoMem",f:eU},41:{n:"PtgMemFunc",f:XR},42:{n:"PtgRefErr",f:ZR},43:{n:"PtgAreaErr",f:_R},44:{n:"PtgRefN",f:IR},45:{n:"PtgAreaN",f:vR},46:{n:"PtgMemAreaN",f:mU},47:{n:"PtgMemNoMemN",f:bU},57:{n:"PtgNameX",f:GR},58:{n:"PtgRef3d",f:MR},59:{n:"PtgArea3d",f:yR},60:{n:"PtgRefErr3d",f:JR},61:{n:"PtgAreaErr3d",f:wR},255:{}},_U={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},wU={1:{n:"PtgElfLel",f:rC},2:{n:"PtgElfRw",f:cU},3:{n:"PtgElfCol",f:nU},6:{n:"PtgElfRwV",f:dU},7:{n:"PtgElfColV",f:sU},10:{n:"PtgElfRadical",f:rU},11:{n:"PtgElfRadicalS",f:lU},13:{n:"PtgElfColS",f:aU},15:{n:"PtgElfColSV",f:iU},16:{n:"PtgElfRadicalLel",f:oU},25:{n:"PtgList",f:fU},29:{n:"PtgSxName",f:pU},255:{}},vU={0:{n:"PtgAttrNoop",f:yU},1:{n:"PtgAttrSemi",f:TR},2:{n:"PtgAttrIf",f:SR},4:{n:"PtgAttrChoose",f:ER},8:{n:"PtgAttrGoto",f:kR},16:{n:"PtgAttrSum",f:BR},32:{n:"PtgAttrBaxcel",f:iC},33:{n:"PtgAttrBaxcel",f:iC},64:{n:"PtgAttrSpace",f:DR},65:{n:"PtgAttrSpaceSemi",f:CR},128:{n:"PtgAttrIfError",f:AR},255:{}};function Fg(t,e,n,a){if(a.biff<8)return ms(t,e);for(var i=t.l+e,s=[],r=0;r!==n.length;++r)switch(n[r][0]){case"PtgArray":n[r][1]=zR(t,0,a),s.push(n[r][1]);break;case"PtgMemArea":n[r][2]=VR(t,n[r][1],a),s.push(n[r][2]);break;case"PtgExp":a&&a.biff==12&&(n[r][1][1]=t.read_shift(4),s.push(n[r][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+n[r][0];default:break}return e=i-t.l,e!==0&&s.push(ms(t,e)),s}function Pg(t,e,n){for(var a=t.l+e,i,s,r=[];a!=t.l;)e=a-t.l,s=t[t.l],i=oC[s]||oC[_U[s]],(s===24||s===25)&&(i=(s===24?wU:vU)[t[t.l+1]]),!i||!i.f?ms(t,e):r.push([i.n,i.f(t,e,n)]);return r}function xU(t){for(var e=[],n=0;n<t.length;++n){for(var a=t[n],i=[],s=0;s<a.length;++s){var r=a[s];if(r)switch(r[0]){case 2:i.push('"'+r[1].replace(/"/g,'""')+'"');break;default:i.push(r[1])}else i.push("")}e.push(i.join(","))}return e.join(";")}var EU={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function kU(t,e){if(!t&&!(e&&e.biff<=5&&e.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(t)?"'"+t+"'":t}function lC(t,e,n){if(!t)return"SH33TJSERR0";if(n.biff>8&&(!t.XTI||!t.XTI[e]))return t.SheetNames[e];if(!t.XTI)return"SH33TJSERR6";var a=t.XTI[e];if(n.biff<8)return e>1e4&&(e-=65536),e<0&&(e=-e),e==0?"":t.XTI[e-1];if(!a)return"SH33TJSERR1";var i="";if(n.biff>8)switch(t[a[0]][0]){case 357:return i=a[1]==-1?"#REF":t.SheetNames[a[1]],a[1]==a[2]?i:i+":"+t.SheetNames[a[2]];case 358:return n.SID!=null?t.SheetNames[n.SID]:"SH33TJSSAME"+t[a[0]][0];case 355:default:return"SH33TJSSRC"+t[a[0]][0]}switch(t[a[0]][0][0]){case 1025:return i=a[1]==-1?"#REF":t.SheetNames[a[1]]||"SH33TJSERR3",a[1]==a[2]?i:i+":"+t.SheetNames[a[2]];case 14849:return t[a[0]].slice(1).map(function(s){return s.Name}).join(";;");default:return t[a[0]][0][3]?(i=a[1]==-1?"#REF":t[a[0]][0][3][a[1]]||"SH33TJSERR4",a[1]==a[2]?i:i+":"+t[a[0]][0][3][a[2]]):"SH33TJSERR2"}}function cC(t,e,n){var a=lC(t,e,n);return a=="#REF"?a:kU(a,n)}function vs(t,e,n,a,i){var s=i&&i.biff||8,r={s:{c:0,r:0},e:{c:0,r:0}},o=[],l,c,d,u=0,g=0,f,h="";if(!t[0]||!t[0][0])return"";for(var m=-1,b="",y=0,_=t[0].length;y<_;++y){var v=t[0][y];switch(v[0]){case"PtgUminus":o.push("-"+o.pop());break;case"PtgUplus":o.push("+"+o.pop());break;case"PtgPercent":o.push(o.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(l=o.pop(),c=o.pop(),m>=0){switch(t[0][m][1][0]){case 0:b=li(" ",t[0][m][1][1]);break;case 1:b=li("\r",t[0][m][1][1]);break;default:if(b="",i.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][m][1][0])}c=c+b,m=-1}o.push(c+EU[v[0]]+l);break;case"PtgIsect":l=o.pop(),c=o.pop(),o.push(c+" "+l);break;case"PtgUnion":l=o.pop(),c=o.pop(),o.push(c+","+l);break;case"PtgRange":l=o.pop(),c=o.pop(),o.push(c+":"+l);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":d=vg(v[1][1],r,i),o.push(xg(d,s));break;case"PtgRefN":d=n?vg(v[1][1],n,i):v[1][1],o.push(xg(d,s));break;case"PtgRef3d":u=v[1][1],d=vg(v[1][2],r,i),h=cC(a,u,i);var U=h;o.push(h+"!"+xg(d,s));break;case"PtgFunc":case"PtgFuncVar":var ee=v[1][0],Z=v[1][1];ee||(ee=0),ee&=127;var k=ee==0?[]:o.slice(-ee);o.length-=ee,Z==="User"&&(Z=k.shift()),o.push(Z+"("+k.join(",")+")");break;case"PtgBool":o.push(v[1]?"TRUE":"FALSE");break;case"PtgInt":o.push(v[1]);break;case"PtgNum":o.push(String(v[1]));break;case"PtgStr":o.push('"'+v[1].replace(/"/g,'""')+'"');break;case"PtgErr":o.push(v[1]);break;case"PtgAreaN":f=$3(v[1][1],n?{s:n}:r,i),o.push(k1(f,i));break;case"PtgArea":f=$3(v[1][1],r,i),o.push(k1(f,i));break;case"PtgArea3d":u=v[1][1],f=v[1][2],h=cC(a,u,i),o.push(h+"!"+k1(f,i));break;case"PtgAttrSum":o.push("SUM("+o.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":g=v[1][2];var w=(a.names||[])[g-1]||(a[0]||[])[g],S=w?w.Name:"SH33TJSNAME"+String(g);S&&S.slice(0,6)=="_xlfn."&&!i.xlfn&&(S=S.slice(6)),o.push(S);break;case"PtgNameX":var B=v[1][1];g=v[1][2];var H;if(i.biff<=5)B<0&&(B=-B),a[B]&&(H=a[B][g]);else{var j="";if(((a[B]||[])[0]||[])[0]==14849||(((a[B]||[])[0]||[])[0]==1025?a[B][g]&&a[B][g].itab>0&&(j=a.SheetNames[a[B][g].itab-1]+"!"):j=a.SheetNames[g-1]+"!"),a[B]&&a[B][g])j+=a[B][g].Name;else if(a[0]&&a[0][g])j+=a[0][g].Name;else{var re=(lC(a,B,i)||"").split(";;");re[g-1]?j=re[g-1]:j+="SH33TJSERRX"}o.push(j);break}H||(H={Name:"SH33TJSERRY"}),o.push(H.Name);break;case"PtgParen":var Te="(",Be=")";if(m>=0){switch(b="",t[0][m][1][0]){case 2:Te=li(" ",t[0][m][1][1])+Te;break;case 3:Te=li("\r",t[0][m][1][1])+Te;break;case 4:Be=li(" ",t[0][m][1][1])+Be;break;case 5:Be=li("\r",t[0][m][1][1])+Be;break;default:if(i.WTF)throw new Error("Unexpected PtgAttrSpaceType "+t[0][m][1][0])}m=-1}o.push(Te+o.pop()+Be);break;case"PtgRefErr":o.push("#REF!");break;case"PtgRefErr3d":o.push("#REF!");break;case"PtgExp":d={c:v[1][1],r:v[1][0]};var Ie={c:n.c,r:n.r};if(a.sharedf[Nn(d)]){var Ce=a.sharedf[Nn(d)];o.push(vs(Ce,r,Ie,a,i))}else{var Je=!1;for(l=0;l!=a.arrayf.length;++l)if(c=a.arrayf[l],!(d.c<c[0].s.c||d.c>c[0].e.c)&&!(d.r<c[0].s.r||d.r>c[0].e.r)){o.push(vs(c[1],r,Ie,a,i)),Je=!0;break}Je||o.push(v[1])}break;case"PtgArray":o.push("{"+xU(v[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":m=y;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":o.push("");break;case"PtgAreaErr":o.push("#REF!");break;case"PtgAreaErr3d":o.push("#REF!");break;case"PtgList":o.push("Table"+v[1].idx+"[#"+v[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(v));default:throw new Error("Unrecognized Formula Token: "+String(v))}var ze=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(i.biff!=3&&m>=0&&ze.indexOf(t[0][y][0])==-1){v=t[0][m];var Ze=!0;switch(v[1][0]){case 4:Ze=!1;case 0:b=li(" ",v[1][1]);break;case 5:Ze=!1;case 1:b=li("\r",v[1][1]);break;default:if(b="",i.WTF)throw new Error("Unexpected PtgAttrSpaceType "+v[1][0])}o.push((Ze?b:"")+o.pop()+(Ze?"":b)),m=-1}}if(o.length>1&&i.WTF)throw new Error("bad formula stack");return o[0]}function SU(t,e,n){var a=t.l+e,i=n.biff==2?1:2,s,r=t.read_shift(i);if(r==65535)return[[],ms(t,e-2)];var o=Pg(t,r,n);return e!==r+i&&(s=Fg(t,e-r-i,o,n)),t.l=a,[o,s]}function AU(t,e,n){var a=t.l+e,i=n.biff==2?1:2,s,r=t.read_shift(i);if(r==65535)return[[],ms(t,e-2)];var o=Pg(t,r,n);return e!==r+i&&(s=Fg(t,e-r-i,o,n)),t.l=a,[o,s]}function TU(t,e,n,a){var i=t.l+e,s=Pg(t,a,n),r;return i!==t.l&&(r=Fg(t,i-t.l,s,n)),[s,r]}function DU(t,e,n){var a=t.l+e,i,s=t.read_shift(2),r=Pg(t,s,n);return s==65535?[[],ms(t,e-2)]:(e!==s+2&&(i=Fg(t,a-s-2,r,n)),[r,i])}function CU(t){var e;if(Al(t,t.l+6)!==65535)return[ys(t),"n"];switch(t[t.l]){case 0:return t.l+=8,["String","s"];case 1:return e=t[t.l+2]===1,t.l+=8,[e,"b"];case 2:return e=t[t.l+2],t.l+=8,[e,"e"];case 3:return t.l+=8,["","s"]}return[]}function LU(t){if(t==null){var e=Dt(8);return e.write_shift(1,3),e.write_shift(1,0),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,65535),e}else if(typeof t=="number")return Qd(t);return Qd(0)}function eE(t,e,n){var a=t.l+e,i=Zo(t,6);n.biff==2&&++t.l;var s=CU(t,8),r=t.read_shift(1);n.biff!=2&&(t.read_shift(1),n.biff>=5&&t.read_shift(4));var o=AU(t,a-t.l,n);return{cell:i,val:s[0],formula:o,shared:r>>3&1,tt:s[1]}}function IU(t,e,n,a,i){var s=iu(e,n,i),r=LU(t.v),o=Dt(6),l=33;o.write_shift(2,l),o.write_shift(4,0);for(var c=Dt(t.bf.length),d=0;d<t.bf.length;++d)c[d]=t.bf[d];var u=Yi([s,r,o,c]);return u}function tw(t,e,n){var a=t.read_shift(4),i=Pg(t,a,n),s=t.read_shift(4),r=s>0?Fg(t,s,i,n):null;return[i,r]}var MU=tw,nw=tw,FU=tw,PU=tw,NU={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},dC={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},BU={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function uC(t){return t.slice(0,3)=="of:"&&(t=t.slice(3)),t.charCodeAt(0)==61&&(t=t.slice(1),t.charCodeAt(0)==61&&(t=t.slice(1))),t=t.replace(/COM\.MICROSOFT\./g,""),t=t.replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,function(e,n){return n.replace(/\./g,"")}),t=t.replace(/\[.(#[A-Z]*[?!])\]/g,"$1"),t.replace(/[;~]/g,",").replace(/\|/g,";")}function zz(t){var e="of:="+t.replace(Z1,"$1[.$2$3$4$5]").replace(/\]:\[/g,":");return e.replace(/;/g,"|").replace(/,/g,";")}function tE(t){var e=t.split(":"),n=e[0].split(".")[0];return[n,e[0].split(".")[1]+(e.length>1?":"+(e[1].split(".")[1]||e[1].split(".")[0]):"")]}function Yz(t){return t.replace(/\./,"!")}var Ng={},np={},Bg=typeof Map!="undefined";function nE(t,e,n){var a=0,i=t.length;if(n){if(Bg?n.has(e):Object.prototype.hasOwnProperty.call(n,e)){for(var s=Bg?n.get(e):n[e];a<s.length;++a)if(t[s[a]].t===e)return t.Count++,s[a]}}else for(;a<i;++a)if(t[a].t===e)return t.Count++,a;return t[i]={t:e},t.Count++,t.Unique++,n&&(Bg?(n.has(e)||n.set(e,[]),n.get(e).push(i)):(Object.prototype.hasOwnProperty.call(n,e)||(n[e]=[]),n[e].push(i))),i}function aw(t,e){var n={min:t+1,max:t+1},a=-1;return e.MDW&&(ws=e.MDW),e.width!=null?n.customWidth=1:e.wpx!=null?a=Cg(e.wpx):e.wch!=null&&(a=e.wch),a>-1?(n.width=J_(a),n.customWidth=1):e.width!=null&&(n.width=e.width),e.hidden&&(n.hidden=!0),e.level!=null&&(n.outlineLevel=n.level=e.level),n}function ou(t,e){if(t){var n=[.7,.7,.75,.75,.3,.3];e=="xlml"&&(n=[1,1,1,1,.5,.5]),t.left==null&&(t.left=n[0]),t.right==null&&(t.right=n[1]),t.top==null&&(t.top=n[2]),t.bottom==null&&(t.bottom=n[3]),t.header==null&&(t.header=n[4]),t.footer==null&&(t.footer=n[5])}}function xc(t,e,n){var a=n.revssf[e.z!=null?e.z:"General"],i=60,s=t.length;if(a==null&&n.ssf){for(;i<392;++i)if(n.ssf[i]==null){Go(e.z,i),n.ssf[i]=e.z,n.revssf[e.z]=a=i;break}}for(i=0;i!=s;++i)if(t[i].numFmtId===a)return i;return t[s]={numFmtId:a,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},s}function fC(t,e,n,a,i,s){try{a.cellNF&&(t.z=Dn[e])}catch(o){if(a.WTF)throw o}if(!(t.t==="z"&&!a.cellStyles)){if(t.t==="d"&&typeof t.v=="string"&&(t.v=ei(t.v)),(!a||a.cellText!==!1)&&t.t!=="z")try{if(Dn[e]==null&&Go($6[e]||"General",e),t.t==="e")t.w=t.w||Dl[t.v];else if(e===0)if(t.t==="n")(t.v|0)===t.v?t.w=t.v.toString(10):t.w=hg(t.v);else if(t.t==="d"){var r=Ri(t.v);(r|0)===r?t.w=r.toString(10):t.w=hg(r)}else{if(t.v===void 0)return"";t.w=zd(t.v,np)}else t.t==="d"?t.w=kr(e,Ri(t.v),np):t.w=kr(e,t.v,np)}catch(o){if(a.WTF)throw o}if(a.cellStyles&&n!=null)try{t.s=s.Fills[n],t.s.fgColor&&t.s.fgColor.theme&&!t.s.fgColor.rgb&&(t.s.fgColor.rgb=Z_(i.themeElements.clrScheme[t.s.fgColor.theme].rgb,t.s.fgColor.tint||0),a.WTF&&(t.s.fgColor.raw_rgb=i.themeElements.clrScheme[t.s.fgColor.theme].rgb)),t.s.bgColor&&t.s.bgColor.theme&&(t.s.bgColor.rgb=Z_(i.themeElements.clrScheme[t.s.bgColor.theme].rgb,t.s.bgColor.tint||0),a.WTF&&(t.s.bgColor.raw_rgb=i.themeElements.clrScheme[t.s.bgColor.theme].rgb))}catch(o){if(a.WTF&&s.Fills)throw o}}}function $U(t,e,n){if(t&&t["!ref"]){var a=oa(t["!ref"]);if(a.e.c<a.s.c||a.e.r<a.s.r)throw new Error("Bad range ("+n+"): "+t["!ref"])}}function OU(t,e){var n=oa(e);n.s.r<=n.e.r&&n.s.c<=n.e.c&&n.s.r>=0&&n.s.c>=0&&(t["!ref"]=Yn(n))}var RU=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g,UU=/<(?:\w+:)?sheetData[^>]*>([\s\S]*)<\/(?:\w+:)?sheetData>/,HU=/<(?:\w:)?hyperlink [^>]*>/mg,qU=/"(\w*:\w*)"/,WU=/<(?:\w:)?col\b[^>]*[\/]?>/g,VU=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g,zU=/<(?:\w:)?pageMargins[^>]*\/>/g,pC=/<(?:\w:)?sheetPr\b(?:[^>a-z][^>]*)?\/>/,YU=/<(?:\w:)?sheetPr[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetPr)>/,GU=/<(?:\w:)?sheetViews[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetViews)>/;function jU(t,e,n,a,i,s,r){if(!t)return t;a||(a={"!id":{}}),ri!=null&&e.dense==null&&(e.dense=ri);var o=e.dense?[]:{},l={s:{r:2e6,c:2e6},e:{r:0,c:0}},c="",d="",u=t.match(UU);u?(c=t.slice(0,u.index),d=t.slice(u.index+u[0].length)):c=d=t;var g=c.match(pC);g?aE(g[0],o,i,n):(g=c.match(YU))&&XU(g[0],g[1]||"",o,i,n,r,s);var f=(c.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(f>0){var h=c.slice(f,f+50).match(qU);h&&OU(o,h[1])}var m=c.match(GU);m&&m[1]&&cH(m[1],i);var b=[];if(e.cellStyles){var y=c.match(WU);y&&iH(b,y)}u&&fH(u[1],o,e,l,s,r);var _=d.match(VU);_&&(o["!autofilter"]=rH(_[0]));var v=[],U=d.match(RU);if(U)for(f=0;f!=U.length;++f)v[f]=oa(U[f].slice(U[f].indexOf('"')+1));var ee=d.match(HU);ee&&tH(o,ee,a);var Z=d.match(zU);if(Z&&(o["!margins"]=nH(Pn(Z[0]))),!o["!ref"]&&l.e.c>=l.s.c&&l.e.r>=l.s.r&&(o["!ref"]=Yn(l)),e.sheetRows>0&&o["!ref"]){var k=oa(o["!ref"]);e.sheetRows<=+k.e.r&&(k.e.r=e.sheetRows-1,k.e.r>l.e.r&&(k.e.r=l.e.r),k.e.r<k.s.r&&(k.s.r=k.e.r),k.e.c>l.e.c&&(k.e.c=l.e.c),k.e.c<k.s.c&&(k.s.c=k.e.c),o["!fullref"]=o["!ref"],o["!ref"]=Yn(k))}return b.length>0&&(o["!cols"]=b),v.length>0&&(o["!merges"]=v),o}function KU(t){if(t.length===0)return"";for(var e='<mergeCells count="'+t.length+'">',n=0;n!=t.length;++n)e+='<mergeCell ref="'+Yn(t[n])+'"/>';return e+"</mergeCells>"}function aE(t,e,n,a){var i=Pn(t);n.Sheets[a]||(n.Sheets[a]={}),i.codeName&&(n.Sheets[a].CodeName=ga(Ia(i.codeName)))}function XU(t,e,n,a,i){aE(t.slice(0,t.indexOf(">")),n,a,i)}function ZU(t,e,n,a,i){var s=!1,r={},o=null;if(a.bookType!=="xlsx"&&e.vbaraw){var l=e.SheetNames[n];try{e.Workbook&&(l=e.Workbook.Sheets[n].CodeName||l)}catch(d){}s=!0,r.codeName=Ko(Ha(l))}if(t&&t["!outline"]){var c={summaryBelow:1,summaryRight:1};t["!outline"].above&&(c.summaryBelow=0),t["!outline"].left&&(c.summaryRight=0),o=(o||"")+nn("outlinePr",null,c)}!s&&!o||(i[i.length]=nn("sheetPr",o,r))}var JU=null,QU=null;function eH(t){var e={sheet:1};return JU.forEach(function(n){t[n]!=null&&t[n]&&(e[n]="1")}),QU.forEach(function(n){t[n]!=null&&!t[n]&&(e[n]="0")}),t.password&&(e.password=Y1(t.password).toString(16).toUpperCase()),nn("sheetProtection",null,e)}function tH(t,e,n){for(var a=Array.isArray(t),i=0;i!=e.length;++i){var s=Pn(Ia(e[i]),!0);if(!s.ref)return;var r=((n||{})["!id"]||[])[s.id];r?(s.Target=r.Target,s.location&&(s.Target+="#"+ga(s.location))):(s.Target="#"+ga(s.location),r={Target:s.Target,TargetMode:"Internal"}),s.Rel=r,s.tooltip&&(s.Tooltip=s.tooltip,delete s.tooltip);for(var o=oa(s.ref),l=o.s.r;l<=o.e.r;++l)for(var c=o.s.c;c<=o.e.c;++c){var d=Nn({c,r:l});a?(t[l]||(t[l]=[]),t[l][c]||(t[l][c]={t:"z",v:void 0}),t[l][c].l=s):(t[d]||(t[d]={t:"z",v:void 0}),t[d].l=s)}}}function nH(t){var e={};return["left","right","top","bottom","header","footer"].forEach(function(n){t[n]&&(e[n]=parseFloat(t[n]))}),e}function aH(t){return ou(t),nn("pageMargins",null,t)}function iH(t,e){for(var n=!1,a=0;a!=e.length;++a){var i=Pn(e[a],!0);i.hidden&&(i.hidden=Ya(i.hidden));var s=parseInt(i.min,10)-1,r=parseInt(i.max,10)-1;for(i.outlineLevel&&(i.level=+i.outlineLevel||0),delete i.min,delete i.max,i.width=+i.width,!n&&i.width&&(n=!0,j1(i.width)),ru(i);s<=r;)t[s++]=Ba(i)}}function sH(t,e){for(var n=["<cols>"],a,i=0;i!=e.length;++i)(a=e[i])&&(n[n.length]=nn("col",null,aw(i,a)));return n[n.length]="</cols>",n.join("")}function rH(t){var e={ref:(t.match(/ref="([^"]*)"/)||[])[1]};return e}function oH(t,e,n,a){var i=typeof t.ref=="string"?t.ref:Yn(t.ref);n.Workbook||(n.Workbook={Sheets:[]}),n.Workbook.Names||(n.Workbook.Names=[]);var s=n.Workbook.Names,r=Tr(i);r.s.r==r.e.r&&(r.e.r=Tr(e["!ref"]).e.r,i=Yn(r));for(var o=0;o<s.length;++o){var l=s[o];if(l.Name=="_xlnm._FilterDatabase"&&l.Sheet==a){l.Ref="'"+n.SheetNames[a]+"'!"+i;break}}return o==s.length&&s.push({Name:"_xlnm._FilterDatabase",Sheet:a,Ref:"'"+n.SheetNames[a]+"'!"+i}),nn("autoFilter",null,{ref:i})}var lH=/<(?:\w:)?sheetView(?:[^>a-z][^>]*)?\/?>/;function cH(t,e){e.Views||(e.Views=[{}]),(t.match(lH)||[]).forEach(function(n,a){var i=Pn(n);e.Views[a]||(e.Views[a]={}),+i.zoomScale&&(e.Views[a].zoom=+i.zoomScale),Ya(i.rightToLeft)&&(e.Views[a].RTL=!0)})}function dH(t,e,n,a){var i={workbookViewId:"0"};return(((a||{}).Workbook||{}).Views||[])[0]&&(i.rightToLeft=a.Workbook.Views[0].RTL?"1":"0"),nn("sheetViews",nn("sheetView",null,i),{})}function uH(t,e,n,a){if(t.c&&n["!comments"].push([e,t.c]),t.v===void 0&&typeof t.f!="string"||t.t==="z"&&!t.f)return"";var i="",s=t.t,r=t.v;if(t.t!=="z")switch(t.t){case"b":i=t.v?"1":"0";break;case"n":i=""+t.v;break;case"e":i=Dl[t.v];break;case"d":a&&a.cellDates?i=ei(t.v,-1).toISOString():(t=Ba(t),t.t="n",i=""+(t.v=Ri(ei(t.v)))),typeof t.z=="undefined"&&(t.z=Dn[14]);break;default:i=t.v;break}var o=ns("v",Ha(i)),l={r:e},c=xc(a.cellXfs,t,a);switch(c!==0&&(l.s=c),t.t){case"n":break;case"d":l.t="d";break;case"b":l.t="b";break;case"e":l.t="e";break;case"z":break;default:if(t.v==null){delete t.t;break}if(t.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(a&&a.bookSST){o=ns("v",""+nE(a.Strings,t.v,a.revStrings)),l.t="s";break}l.t="str";break}if(t.t!=s&&(t.t=s,t.v=r),typeof t.f=="string"&&t.f){var d=t.F&&t.F.slice(0,e.length)==e?{t:"array",ref:t.F}:null;o=nn("f",Ha(t.f),d)+(t.v!=null?o:"")}return t.l&&n["!links"].push([e,t.l]),t.D&&(l.cm=1),nn("c",o,l)}var fH=function(){var t=/<(?:\w+:)?c[ \/>]/,e=/<\/(?:\w+:)?row>/,n=/r=["']([^"']*)["']/,a=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/,i=/ref=["']([^"']*)["']/,s=yg("v"),r=yg("f");return function(l,c,d,u,g,f){for(var h=0,m="",b=[],y=[],_=0,v=0,U=0,ee="",Z,k,w=0,S=0,B,H,j=0,re=0,Te=Array.isArray(f.CellXf),Be,Ie=[],Ce=[],Je=Array.isArray(c),ze=[],Ze={},ht=!1,De=!!d.sheetStubs,tt=l.split(e),Ve=0,He=tt.length;Ve!=He;++Ve){m=tt[Ve].trim();var bt=m.length;if(bt!==0){var Kt=0;e:for(h=0;h<bt;++h)switch(m[h]){case">":if(m[h-1]!="/"){++h;break e}if(d&&d.cellStyles){if(k=Pn(m.slice(Kt,h),!0),w=k.r!=null?parseInt(k.r,10):w+1,S=-1,d.sheetRows&&d.sheetRows<w)continue;Ze={},ht=!1,k.ht&&(ht=!0,Ze.hpt=parseFloat(k.ht),Ze.hpx=Qf(Ze.hpt)),k.hidden=="1"&&(ht=!0,Ze.hidden=!0),k.outlineLevel!=null&&(ht=!0,Ze.level=+k.outlineLevel),ht&&(ze[w-1]=Ze)}break;case"<":Kt=h;break}if(Kt>=h)break;if(k=Pn(m.slice(Kt,h),!0),w=k.r!=null?parseInt(k.r,10):w+1,S=-1,!(d.sheetRows&&d.sheetRows<w)){u.s.r>w-1&&(u.s.r=w-1),u.e.r<w-1&&(u.e.r=w-1),d&&d.cellStyles&&(Ze={},ht=!1,k.ht&&(ht=!0,Ze.hpt=parseFloat(k.ht),Ze.hpx=Qf(Ze.hpt)),k.hidden=="1"&&(ht=!0,Ze.hidden=!0),k.outlineLevel!=null&&(ht=!0,Ze.level=+k.outlineLevel),ht&&(ze[w-1]=Ze)),b=m.slice(h).split(t);for(var Vt=0;Vt!=b.length&&b[Vt].trim().charAt(0)=="<";++Vt);for(b=b.slice(Vt),h=0;h!=b.length;++h)if(m=b[h].trim(),m.length!==0){if(y=m.match(n),_=h,v=0,U=0,m="<c "+(m.slice(0,1)=="<"?">":"")+m,y!=null&&y.length===2){for(_=0,ee=y[1],v=0;v!=ee.length&&!((U=ee.charCodeAt(v)-64)<1||U>26);++v)_=26*_+U;--_,S=_}else++S;for(v=0;v!=m.length&&m.charCodeAt(v)!==62;++v);if(++v,k=Pn(m.slice(0,v),!0),k.r||(k.r=Nn({r:w-1,c:S})),ee=m.slice(v),Z={t:""},(y=ee.match(s))!=null&&y[1]!==""&&(Z.v=ga(y[1])),d.cellFormula){if((y=ee.match(r))!=null&&y[1]!==""){if(Z.f=ga(Ia(y[1])).replace(/\r\n/g,`
`),d.xlfn||(Z.f=eC(Z.f)),y[0].indexOf('t="array"')>-1)Z.F=(ee.match(i)||[])[1],Z.F.indexOf(":")>-1&&Ie.push([oa(Z.F),Z.F]);else if(y[0].indexOf('t="shared"')>-1){H=Pn(y[0]);var At=ga(Ia(y[1]));d.xlfn||(At=eC(At)),Ce[parseInt(H.si,10)]=[H,At,k.r]}}else(y=ee.match(/<f[^>]*\/>/))&&(H=Pn(y[0]),Ce[H.si]&&(Z.f=dR(Ce[H.si][1],Ce[H.si][2],k.r)));var Ct=ti(k.r);for(v=0;v<Ie.length;++v)Ct.r>=Ie[v][0].s.r&&Ct.r<=Ie[v][0].e.r&&Ct.c>=Ie[v][0].s.c&&Ct.c<=Ie[v][0].e.c&&(Z.F=Ie[v][1])}if(k.t==null&&Z.v===void 0)if(Z.f||Z.F)Z.v=0,Z.t="n";else if(De)Z.t="z";else continue;else Z.t=k.t||"n";switch(u.s.c>S&&(u.s.c=S),u.e.c<S&&(u.e.c=S),Z.t){case"n":if(Z.v==""||Z.v==null){if(!De)continue;Z.t="z"}else Z.v=parseFloat(Z.v);break;case"s":if(typeof Z.v=="undefined"){if(!De)continue;Z.t="z"}else B=Ng[parseInt(Z.v,10)],Z.v=B.t,Z.r=B.r,d.cellHTML&&(Z.h=B.h);break;case"str":Z.t="s",Z.v=Z.v!=null?Ia(Z.v):"",d.cellHTML&&(Z.h=h1(Z.v));break;case"inlineStr":y=ee.match(a),Z.t="s",y!=null&&(B=z1(y[1]))?(Z.v=B.t,d.cellHTML&&(Z.h=B.h)):Z.v="";break;case"b":Z.v=Ya(Z.v);break;case"d":d.cellDates?Z.v=ei(Z.v,1):(Z.v=Ri(ei(Z.v,1)),Z.t="n");break;case"e":(!d||d.cellText!==!1)&&(Z.w=Z.v),Z.v=G3[Z.v];break}if(j=re=0,Be=null,Te&&k.s!==void 0&&(Be=f.CellXf[k.s],Be!=null&&(Be.numFmtId!=null&&(j=Be.numFmtId),d.cellStyles&&Be.fillId!=null&&(re=Be.fillId))),fC(Z,j,re,d,g,f),d.cellDates&&Te&&Z.t=="n"&&Yd(Dn[j])&&(Z.t="d",Z.v=$_(Z.v)),k.cm&&d.xlmeta){var Ln=(d.xlmeta.Cell||[])[+k.cm-1];Ln&&Ln.type=="XLDAPR"&&(Z.D=!0)}if(Je){var Oe=ti(k.r);c[Oe.r]||(c[Oe.r]=[]),c[Oe.r][Oe.c]=Z}else c[k.r]=Z}}}}ze.length>0&&(c["!rows"]=ze)}}();function pH(t,e,n,a){var i=[],s=[],r=oa(t["!ref"]),o="",l,c="",d=[],u=0,g=0,f=t["!rows"],h=Array.isArray(t),m={r:c},b,y=-1;for(g=r.s.c;g<=r.e.c;++g)d[g]=Ga(g);for(u=r.s.r;u<=r.e.r;++u){for(s=[],c=ci(u),g=r.s.c;g<=r.e.c;++g){l=d[g]+c;var _=h?(t[u]||[])[g]:t[l];_!==void 0&&(o=uH(_,l,t,e,n,a))!=null&&s.push(o)}(s.length>0||f&&f[u])&&(m={r:c},f&&f[u]&&(b=f[u],b.hidden&&(m.hidden=1),y=-1,b.hpx?y=Lg(b.hpx):b.hpt&&(y=b.hpt),y>-1&&(m.ht=y,m.customHeight=1),b.level&&(m.outlineLevel=b.level)),i[i.length]=nn("row",s.join(""),m))}if(f)for(;u<f.length;++u)f&&f[u]&&(m={r:u+1},b=f[u],b.hidden&&(m.hidden=1),y=-1,b.hpx?y=Lg(b.hpx):b.hpt&&(y=b.hpt),y>-1&&(m.ht=y,m.customHeight=1),b.level&&(m.outlineLevel=b.level),i[i.length]=nn("row","",m));return i.join("")}function hC(t,e,n,a){var i=[Di,nn("worksheet",null,{xmlns:yc[0],"xmlns:r":Ci.r})],s=n.SheetNames[t],r=0,o="",l=n.Sheets[s];l==null&&(l={});var c=l["!ref"]||"A1",d=oa(c);if(d.e.c>16383||d.e.r>1048575){if(e.WTF)throw new Error("Range "+c+" exceeds format limit A1:XFD1048576");d.e.c=Math.min(d.e.c,16383),d.e.r=Math.min(d.e.c,1048575),c=Yn(d)}a||(a={}),l["!comments"]=[];var u=[];ZU(l,n,t,e,i),i[i.length]=nn("dimension",null,{ref:c}),i[i.length]=dH(l,e,t,n),e.sheetFormat&&(i[i.length]=nn("sheetFormatPr",null,{defaultRowHeight:e.sheetFormat.defaultRowHeight||"16",baseColWidth:e.sheetFormat.baseColWidth||"10",outlineLevelRow:e.sheetFormat.outlineLevelRow||"7"})),l["!cols"]!=null&&l["!cols"].length>0&&(i[i.length]=sH(l,l["!cols"])),i[r=i.length]="<sheetData/>",l["!links"]=[],l["!ref"]!=null&&(o=pH(l,e,t,n,a),o.length>0&&(i[i.length]=o)),i.length>r+1&&(i[i.length]="</sheetData>",i[r]=i[r].replace("/>",">")),l["!protect"]&&(i[i.length]=eH(l["!protect"])),l["!autofilter"]!=null&&(i[i.length]=oH(l["!autofilter"],l,n,t)),l["!merges"]!=null&&l["!merges"].length>0&&(i[i.length]=KU(l["!merges"]));var g=-1,f,h=-1;return l["!links"].length>0&&(i[i.length]="<hyperlinks>",l["!links"].forEach(function(m){m[1].Target&&(f={ref:m[0]},m[1].Target.charAt(0)!="#"&&(h=Ea(a,-1,Ha(m[1].Target).replace(/#.*$/,""),Gn.HLINK),f["r:id"]="rId"+h),(g=m[1].Target.indexOf("#"))>-1&&(f.location=Ha(m[1].Target.slice(g+1))),m[1].Tooltip&&(f.tooltip=Ha(m[1].Tooltip)),i[i.length]=nn("hyperlink",null,f))}),i[i.length]="</hyperlinks>"),delete l["!links"],l["!margins"]!=null&&(i[i.length]=aH(l["!margins"])),(!e||e.ignoreEC||e.ignoreEC==null)&&(i[i.length]=ns("ignoredErrors",nn("ignoredError",null,{numberStoredAsText:1,sqref:c}))),u.length>0&&(h=Ea(a,-1,"../drawings/drawing"+(t+1)+".xml",Gn.DRAW),i[i.length]=nn("drawing",null,{"r:id":"rId"+h}),l["!drawing"]=u),l["!comments"].length>0&&(h=Ea(a,-1,"../drawings/vmlDrawing"+(t+1)+".vml",Gn.VML),i[i.length]=nn("legacyDrawing",null,{"r:id":"rId"+h}),l["!legacy"]=h),i.length>1&&(i[i.length]="</worksheet>",i[1]=i[1].replace("/>",">")),i.join("")}function hH(t,e){var n={},a=t.l+e;n.r=t.read_shift(4),t.l+=4;var i=t.read_shift(2);t.l+=1;var s=t.read_shift(1);return t.l=a,s&7&&(n.level=s&7),s&16&&(n.hidden=!0),s&32&&(n.hpt=i/20),n}function gH(t,e,n){var a=Dt(145),i=(n["!rows"]||[])[t]||{};a.write_shift(4,t),a.write_shift(4,0);var s=320;i.hpx?s=Lg(i.hpx)*20:i.hpt&&(s=i.hpt*20),a.write_shift(2,s),a.write_shift(1,0);var r=0;i.level&&(r|=i.level),i.hidden&&(r|=16),(i.hpx||i.hpt)&&(r|=32),a.write_shift(1,r),a.write_shift(1,0);var o=0,l=a.l;a.l+=4;for(var c={r:t,c:0},d=0;d<16;++d)if(!(e.s.c>d+1<<10||e.e.c<d<<10)){for(var u=-1,g=-1,f=d<<10;f<d+1<<10;++f){c.c=f;var h=Array.isArray(n)?(n[c.r]||[])[c.c]:n[Nn(c)];h&&(u<0&&(u=f),g=f)}u<0||(++o,a.write_shift(4,u),a.write_shift(4,g))}var m=a.l;return a.l=l,a.write_shift(4,o),a.l=m,a.length>a.l?a.slice(0,a.l):a}function mH(t,e,n,a){var i=gH(a,n,e);(i.length>17||(e["!rows"]||[])[a])&&Wt(t,0,i)}var bH=Jd,yH=null;function _H(){}function wH(t,e){var n={},a=t[t.l];return++t.l,n.above=!(a&64),n.left=!(a&128),t.l+=18,n.name=S8(t,e-19),n}function vH(t,e,n){n==null&&(n=Dt(84+4*t.length));var a=192;e&&(e.above&&(a&=-65),e.left&&(a&=-129)),n.write_shift(1,a);for(var i=1;i<3;++i)n.write_shift(1,0);return q_({auto:1},n),n.write_shift(-4,-1),n.write_shift(-4,-1),U3(t,n),n.slice(0,n.l)}function xH(t){var e=Hr(t);return[e]}function EH(t,e,n){return n==null&&(n=Dt(8)),Kd(e,n)}function kH(t){var e=Xd(t);return[e]}function SH(t,e,n){return n==null&&(n=Dt(4)),Zd(e,n)}function AH(t){var e=Hr(t),n=t.read_shift(1);return[e,n,"b"]}function TH(t,e,n){return n==null&&(n=Dt(9)),Kd(e,n),n.write_shift(1,t.v?1:0),n}function DH(t){var e=Xd(t),n=t.read_shift(1);return[e,n,"b"]}function CH(t,e,n){return n==null&&(n=Dt(5)),Zd(e,n),n.write_shift(1,t.v?1:0),n}function LH(t){var e=Hr(t),n=t.read_shift(1);return[e,n,"e"]}function IH(t,e,n){return n==null&&(n=Dt(9)),Kd(e,n),n.write_shift(1,t.v),n}function MH(t){var e=Xd(t),n=t.read_shift(1);return[e,n,"e"]}function FH(t,e,n){return n==null&&(n=Dt(8)),Zd(e,n),n.write_shift(1,t.v),n.write_shift(2,0),n.write_shift(1,0),n}function PH(t){var e=Hr(t),n=t.read_shift(4);return[e,n,"s"]}function NH(t,e,n){return n==null&&(n=Dt(12)),Kd(e,n),n.write_shift(4,e.v),n}function BH(t){var e=Xd(t),n=t.read_shift(4);return[e,n,"s"]}function $H(t,e,n){return n==null&&(n=Dt(8)),Zd(e,n),n.write_shift(4,e.v),n}function OH(t){var e=Hr(t),n=ys(t);return[e,n,"n"]}function RH(t,e,n){return n==null&&(n=Dt(16)),Kd(e,n),Qd(t.v,n),n}function gC(t){var e=Xd(t),n=ys(t);return[e,n,"n"]}function UH(t,e,n){return n==null&&(n=Dt(12)),Zd(e,n),Qd(t.v,n),n}function HH(t){var e=Hr(t),n=M1(t);return[e,n,"n"]}function qH(t,e,n){return n==null&&(n=Dt(12)),Kd(e,n),H3(t.v,n),n}function WH(t){var e=Xd(t),n=M1(t);return[e,n,"n"]}function VH(t,e,n){return n==null&&(n=Dt(8)),Zd(e,n),H3(t.v,n),n}function zH(t){var e=Hr(t),n=T1(t);return[e,n,"is"]}function YH(t){var e=Hr(t),n=bs(t);return[e,n,"str"]}function GH(t,e,n){return n==null&&(n=Dt(12+4*t.v.length)),Kd(e,n),is(t.v,n),n.length>n.l?n.slice(0,n.l):n}function jH(t){var e=Xd(t),n=bs(t);return[e,n,"str"]}function KH(t,e,n){return n==null&&(n=Dt(8+4*t.v.length)),Zd(e,n),is(t.v,n),n.length>n.l?n.slice(0,n.l):n}function XH(t,e,n){var a=t.l+e,i=Hr(t);i.r=n["!row"];var s=t.read_shift(1),r=[i,s,"b"];if(n.cellFormula){t.l+=2;var o=nw(t,a-t.l,n);r[3]=vs(o,null,i,n.supbooks,n)}else t.l=a;return r}function ZH(t,e,n){var a=t.l+e,i=Hr(t);i.r=n["!row"];var s=t.read_shift(1),r=[i,s,"e"];if(n.cellFormula){t.l+=2;var o=nw(t,a-t.l,n);r[3]=vs(o,null,i,n.supbooks,n)}else t.l=a;return r}function JH(t,e,n){var a=t.l+e,i=Hr(t);i.r=n["!row"];var s=ys(t),r=[i,s,"n"];if(n.cellFormula){t.l+=2;var o=nw(t,a-t.l,n);r[3]=vs(o,null,i,n.supbooks,n)}else t.l=a;return r}function QH(t,e,n){var a=t.l+e,i=Hr(t);i.r=n["!row"];var s=bs(t),r=[i,s,"str"];if(n.cellFormula){t.l+=2;var o=nw(t,a-t.l,n);r[3]=vs(o,null,i,n.supbooks,n)}else t.l=a;return r}var e9=Jd,t9=null;function n9(t,e){return e==null&&(e=Dt(4)),e.write_shift(4,t),e}function a9(t,e){var n=t.l+e,a=Jd(t,16),i=D1(t),s=bs(t),r=bs(t),o=bs(t);t.l=n;var l={rfx:a,relId:i,loc:s,display:o};return r&&(l.Tooltip=r),l}function i9(t,e){var n=Dt(50+4*(t[1].Target.length+(t[1].Tooltip||"").length));H_({s:ti(t[0]),e:ti(t[0])},n),I1("rId"+e,n);var a=t[1].Target.indexOf("#"),i=a==-1?"":t[1].Target.slice(a+1);return is(i||"",n),is(t[1].Tooltip||"",n),is("",n),n.slice(0,n.l)}function s9(){}function r9(t,e,n){var a=t.l+e,i=q3(t,16),s=t.read_shift(1),r=[i];if(r[2]=s,n.cellFormula){var o=MU(t,a-t.l,n);r[1]=o}else t.l=a;return r}function o9(t,e,n){var a=t.l+e,i=Jd(t,16),s=[i];if(n.cellFormula){var r=PU(t,a-t.l,n);s[1]=r,t.l=a}else t.l=a;return s}function l9(t,e,n){n==null&&(n=Dt(18));var a=aw(t,e);n.write_shift(-4,t),n.write_shift(-4,t),n.write_shift(4,(a.width||10)*256),n.write_shift(4,0);var i=0;return e.hidden&&(i|=1),typeof a.width=="number"&&(i|=2),e.level&&(i|=e.level<<8),n.write_shift(2,i),n}var mC=["left","right","top","bottom","header","footer"];function c9(t){var e={};return mC.forEach(function(n){e[n]=ys(t,8)}),e}function d9(t,e){return e==null&&(e=Dt(6*8)),ou(t),mC.forEach(function(n){Qd(t[n],e)}),e}function u9(t){var e=t.read_shift(2);return t.l+=28,{RTL:e&32}}function f9(t,e,n){n==null&&(n=Dt(30));var a=924;return(((e||{}).Views||[])[0]||{}).RTL&&(a|=32),n.write_shift(2,a),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(1,0),n.write_shift(1,0),n.write_shift(2,0),n.write_shift(2,100),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(4,0),n}function p9(t){var e=Dt(24);return e.write_shift(4,4),e.write_shift(4,1),H_(t,e),e}function h9(t,e){return e==null&&(e=Dt(16*4+2)),e.write_shift(2,t.password?Y1(t.password):0),e.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(n){n[1]?e.write_shift(4,t[n[0]]!=null&&!t[n[0]]?1:0):e.write_shift(4,t[n[0]]!=null&&t[n[0]]?0:1)}),e}function g9(){}function m9(){}function b9(t,e,n,a,i,s,r){if(!t)return t;var o=e||{};a||(a={"!id":{}}),ri!=null&&o.dense==null&&(o.dense=ri);var l=o.dense?[]:{},c,d={s:{r:2e6,c:2e6},e:{r:0,c:0}},u=[],g=!1,f=!1,h,m,b,y,_,v,U,ee,Z,k=[];o.biff=12,o["!row"]=0;var w=0,S=!1,B=[],H={},j=o.supbooks||i.supbooks||[[]];if(j.sharedf=H,j.arrayf=B,j.SheetNames=i.SheetNames||i.Sheets.map(function(Ze){return Ze.name}),!o.supbooks&&(o.supbooks=j,i.Names))for(var re=0;re<i.Names.length;++re)j[0][re+1]=i.Names[re];var Te=[],Be=[],Ie=!1;Rg[16]={n:"BrtShortReal",f:gC};var Ce,Je;if(Tl(t,function(ht,De,tt){if(!f)switch(tt){case 148:c=ht;break;case 0:h=ht,o.sheetRows&&o.sheetRows<=h.r&&(f=!0),ee=ci(y=h.r),o["!row"]=h.r,(ht.hidden||ht.hpt||ht.level!=null)&&(ht.hpt&&(ht.hpx=Qf(ht.hpt)),Be[ht.r]=ht);break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 18:case 62:switch(m={t:ht[2]},ht[2]){case"n":m.v=ht[1];break;case"s":U=Ng[ht[1]],m.v=U.t,m.r=U.r;break;case"b":m.v=!!ht[1];break;case"e":m.v=ht[1],o.cellText!==!1&&(m.w=Dl[m.v]);break;case"str":m.t="s",m.v=ht[1];break;case"is":m.t="s",m.v=ht[1].t;break}if((b=r.CellXf[ht[0].iStyleRef])&&fC(m,b.numFmtId,null,o,s,r),_=ht[0].c==-1?_+1:ht[0].c,o.dense?(l[y]||(l[y]=[]),l[y][_]=m):l[Ga(_)+ee]=m,o.cellFormula){for(S=!1,w=0;w<B.length;++w){var Ve=B[w];h.r>=Ve[0].s.r&&h.r<=Ve[0].e.r&&_>=Ve[0].s.c&&_<=Ve[0].e.c&&(m.F=Yn(Ve[0]),S=!0)}!S&&ht.length>3&&(m.f=ht[3])}if(d.s.r>h.r&&(d.s.r=h.r),d.s.c>_&&(d.s.c=_),d.e.r<h.r&&(d.e.r=h.r),d.e.c<_&&(d.e.c=_),o.cellDates&&b&&m.t=="n"&&Yd(Dn[b.numFmtId])){var He=gc(m.v);He&&(m.t="d",m.v=new Date(He.y,He.m-1,He.d,He.H,He.M,He.S,He.u))}Ce&&(Ce.type=="XLDAPR"&&(m.D=!0),Ce=void 0),Je&&(Je=void 0);break;case 1:case 12:if(!o.sheetStubs||g)break;m={t:"z",v:void 0},_=ht[0].c==-1?_+1:ht[0].c,o.dense?(l[y]||(l[y]=[]),l[y][_]=m):l[Ga(_)+ee]=m,d.s.r>h.r&&(d.s.r=h.r),d.s.c>_&&(d.s.c=_),d.e.r<h.r&&(d.e.r=h.r),d.e.c<_&&(d.e.c=_),Ce&&(Ce.type=="XLDAPR"&&(m.D=!0),Ce=void 0),Je&&(Je=void 0);break;case 176:k.push(ht);break;case 49:Ce=((o.xlmeta||{}).Cell||[])[ht-1];break;case 494:var bt=a["!id"][ht.relId];for(bt?(ht.Target=bt.Target,ht.loc&&(ht.Target+="#"+ht.loc),ht.Rel=bt):ht.relId==""&&(ht.Target="#"+ht.loc),y=ht.rfx.s.r;y<=ht.rfx.e.r;++y)for(_=ht.rfx.s.c;_<=ht.rfx.e.c;++_)o.dense?(l[y]||(l[y]=[]),l[y][_]||(l[y][_]={t:"z",v:void 0}),l[y][_].l=ht):(v=Nn({c:_,r:y}),l[v]||(l[v]={t:"z",v:void 0}),l[v].l=ht);break;case 426:if(!o.cellFormula)break;B.push(ht),Z=o.dense?l[y][_]:l[Ga(_)+ee],Z.f=vs(ht[1],d,{r:h.r,c:_},j,o),Z.F=Yn(ht[0]);break;case 427:if(!o.cellFormula)break;H[Nn(ht[0].s)]=ht[1],Z=o.dense?l[y][_]:l[Ga(_)+ee],Z.f=vs(ht[1],d,{r:h.r,c:_},j,o);break;case 60:if(!o.cellStyles)break;for(;ht.e>=ht.s;)Te[ht.e--]={width:ht.w/256,hidden:!!(ht.flags&1),level:ht.level},Ie||(Ie=!0,j1(ht.w/256)),ru(Te[ht.e+1]);break;case 161:l["!autofilter"]={ref:Yn(ht)};break;case 476:l["!margins"]=ht;break;case 147:i.Sheets[n]||(i.Sheets[n]={}),ht.name&&(i.Sheets[n].CodeName=ht.name),(ht.above||ht.left)&&(l["!outline"]={above:ht.above,left:ht.left});break;case 137:i.Views||(i.Views=[{}]),i.Views[0]||(i.Views[0]={}),ht.RTL&&(i.Views[0].RTL=!0);break;case 485:break;case 64:case 1053:break;case 151:break;case 152:case 175:case 644:case 625:case 562:case 396:case 1112:case 1146:case 471:case 1050:case 649:case 1105:case 589:case 607:case 564:case 1055:case 168:case 174:case 1180:case 499:case 507:case 550:case 171:case 167:case 1177:case 169:case 1181:case 551:case 552:case 661:case 639:case 478:case 537:case 477:case 536:case 1103:case 680:case 1104:case 1024:case 663:case 535:case 678:case 504:case 1043:case 428:case 170:case 3072:case 50:case 2070:case 1045:break;case 35:g=!0;break;case 36:g=!1;break;case 37:u.push(tt),g=!0;break;case 38:u.pop(),g=!1;break;default:if(!De.T){if(!g||o.WTF)throw new Error("Unexpected record 0x"+tt.toString(16))}}},o),delete o.supbooks,delete o["!row"],!l["!ref"]&&(d.s.r<2e6||c&&(c.e.r>0||c.e.c>0||c.s.r>0||c.s.c>0))&&(l["!ref"]=Yn(c||d)),o.sheetRows&&l["!ref"]){var ze=oa(l["!ref"]);o.sheetRows<=+ze.e.r&&(ze.e.r=o.sheetRows-1,ze.e.r>d.e.r&&(ze.e.r=d.e.r),ze.e.r<ze.s.r&&(ze.s.r=ze.e.r),ze.e.c>d.e.c&&(ze.e.c=d.e.c),ze.e.c<ze.s.c&&(ze.s.c=ze.e.c),l["!fullref"]=l["!ref"],l["!ref"]=Yn(ze))}return k.length>0&&(l["!merges"]=k),Te.length>0&&(l["!cols"]=Te),Be.length>0&&(l["!rows"]=Be),l}function y9(t,e,n,a,i,s,r){if(e.v===void 0)return!1;var o="";switch(e.t){case"b":o=e.v?"1":"0";break;case"d":e=Ba(e),e.z=e.z||Dn[14],e.v=Ri(ei(e.v)),e.t="n";break;case"n":case"e":o=""+e.v;break;default:o=e.v;break}var l={r:n,c:a};switch(l.s=xc(i.cellXfs,e,i),e.l&&s["!links"].push([Nn(l),e.l]),e.c&&s["!comments"].push([Nn(l),e.c]),e.t){case"s":case"str":return i.bookSST?(o=nE(i.Strings,e.v,i.revStrings),l.t="s",l.v=o,r?Wt(t,18,$H(e,l)):Wt(t,7,NH(e,l))):(l.t="str",r?Wt(t,17,KH(e,l)):Wt(t,6,GH(e,l))),!0;case"n":return e.v==(e.v|0)&&e.v>-1e3&&e.v<1e3?r?Wt(t,13,VH(e,l)):Wt(t,2,qH(e,l)):r?Wt(t,16,UH(e,l)):Wt(t,5,RH(e,l)),!0;case"b":return l.t="b",r?Wt(t,15,CH(e,l)):Wt(t,4,TH(e,l)),!0;case"e":return l.t="e",r?Wt(t,14,FH(e,l)):Wt(t,3,IH(e,l)),!0}return r?Wt(t,12,SH(e,l)):Wt(t,1,EH(e,l)),!0}function _9(t,e,n,a){var i=oa(e["!ref"]||"A1"),s,r="",o=[];Wt(t,145);var l=Array.isArray(e),c=i.e.r;e["!rows"]&&(c=Math.max(i.e.r,e["!rows"].length-1));for(var d=i.s.r;d<=c;++d){r=ci(d),mH(t,e,i,d);var u=!1;if(d<=i.e.r)for(var g=i.s.c;g<=i.e.c;++g){d===i.s.r&&(o[g]=Ga(g)),s=o[g]+r;var f=l?(e[d]||[])[g]:e[s];if(!f){u=!1;continue}u=y9(t,f,d,g,a,e,u)}}Wt(t,146)}function w9(t,e){!e||!e["!merges"]||(Wt(t,177,n9(e["!merges"].length)),e["!merges"].forEach(function(n){Wt(t,176,t9(n))}),Wt(t,178))}function v9(t,e){!e||!e["!cols"]||(Wt(t,390),e["!cols"].forEach(function(n,a){n&&Wt(t,60,l9(a,n))}),Wt(t,391))}function x9(t,e){!e||!e["!ref"]||(Wt(t,648),Wt(t,649,p9(oa(e["!ref"]))),Wt(t,650))}function E9(t,e,n){e["!links"].forEach(function(a){if(a[1].Target){var i=Ea(n,-1,a[1].Target.replace(/#.*$/,""),Gn.HLINK);Wt(t,494,i9(a,i))}}),delete e["!links"]}function k9(t,e,n,a){if(e["!comments"].length>0){var i=Ea(a,-1,"../drawings/vmlDrawing"+(n+1)+".vml",Gn.VML);Wt(t,551,I1("rId"+i)),e["!legacy"]=i}}function S9(t,e,n,a){if(e["!autofilter"]){var i=e["!autofilter"],s=typeof i.ref=="string"?i.ref:Yn(i.ref);n.Workbook||(n.Workbook={Sheets:[]}),n.Workbook.Names||(n.Workbook.Names=[]);var r=n.Workbook.Names,o=Tr(s);o.s.r==o.e.r&&(o.e.r=Tr(e["!ref"]).e.r,s=Yn(o));for(var l=0;l<r.length;++l){var c=r[l];if(c.Name=="_xlnm._FilterDatabase"&&c.Sheet==a){c.Ref="'"+n.SheetNames[a]+"'!"+s;break}}l==r.length&&r.push({Name:"_xlnm._FilterDatabase",Sheet:a,Ref:"'"+n.SheetNames[a]+"'!"+s}),Wt(t,161,H_(oa(s))),Wt(t,162)}}function A9(t,e,n){Wt(t,133),Wt(t,137,f9(e,n)),Wt(t,138),Wt(t,134)}function Gz(){}function T9(t,e){e["!protect"]&&Wt(t,535,h9(e["!protect"]))}function D9(t,e,n,a){var i=Us(),s=n.SheetNames[t],r=n.Sheets[s]||{},o=s;try{n&&n.Workbook&&(o=n.Workbook.Sheets[t].CodeName||o)}catch(c){}var l=oa(r["!ref"]||"A1");if(l.e.c>16383||l.e.r>1048575){if(e.WTF)throw new Error("Range "+(r["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");l.e.c=Math.min(l.e.c,16383),l.e.r=Math.min(l.e.c,1048575)}return r["!links"]=[],r["!comments"]=[],Wt(i,129),(n.vbaraw||r["!outline"])&&Wt(i,147,vH(o,r["!outline"])),Wt(i,148,yH(l)),A9(i,r,n.Workbook),v9(i,r,t,e,n),_9(i,r,t,e,n),T9(i,r),S9(i,r,n,t),w9(i,r),E9(i,r,a),r["!margins"]&&Wt(i,476,d9(r["!margins"])),(!e||e.ignoreEC||e.ignoreEC==null)&&x9(i,r),k9(i,r,t,a),Wt(i,130),i.end()}function C9(t){var e=[],n=t.match(/^<c:numCache>/),a;(t.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/mg)||[]).forEach(function(s){var r=s.match(/<c:pt idx="(\d*?)"><c:v>(.*)<\/c:v><\/c:pt>/);r&&(e[+r[1]]=n?+r[2]:r[2])});var i=ga((t.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return(t.match(/<c:f>(.*?)<\/c:f>/mg)||[]).forEach(function(s){a=s.replace(/<.*?>/g,"")}),[e,i,a]}function L9(t,e,n,a,i,s){var r=s||{"!type":"chart"};if(!t)return s;var o=0,l=0,c="A",d={s:{r:2e6,c:2e6},e:{r:0,c:0}};return(t.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach(function(u){var g=C9(u);d.s.r=d.s.c=0,d.e.c=o,c=Ga(o),g[0].forEach(function(f,h){r[c+ci(h)]={t:"n",v:f,z:g[1]},l=h}),d.e.r<l&&(d.e.r=l),++o}),o>0&&(r["!ref"]=Yn(d)),r}function I9(t,e,n,a,i){if(!t)return t;a||(a={"!id":{}});var s={"!type":"chart","!drawel":null,"!rel":""},r,o=t.match(pC);return o&&aE(o[0],s,i,n),(r=t.match(/drawing r:id="(.*?)"/))&&(s["!rel"]=r[1]),a["!id"][s["!rel"]]&&(s["!drawel"]=a["!id"][s["!rel"]]),s}function M9(t,e,n,a){var i=[Di,nn("chartsheet",null,{xmlns:yc[0],"xmlns:r":Ci.r})];return i[i.length]=nn("drawing",null,{"r:id":"rId1"}),Ea(a,-1,"../drawings/drawing"+(t+1)+".xml",Gn.DRAW),i.length>2&&(i[i.length]="</chartsheet>",i[1]=i[1].replace("/>",">")),i.join("")}function F9(t,e){t.l+=10;var n=bs(t,e-10);return{name:n}}function P9(t,e,n,a,i){if(!t)return t;a||(a={"!id":{}});var s={"!type":"chart","!drawel":null,"!rel":""},r=[],o=!1;return Tl(t,function(c,d,u){switch(u){case 550:s["!rel"]=c;break;case 651:i.Sheets[n]||(i.Sheets[n]={}),c.name&&(i.Sheets[n].CodeName=c.name);break;case 562:case 652:case 669:case 679:case 551:case 552:case 476:case 3072:break;case 35:o=!0;break;case 36:o=!1;break;case 37:r.push(u);break;case 38:r.pop();break;default:if(d.T>0)r.push(u);else if(d.T<0)r.pop();else if(!o||e.WTF)throw new Error("Unexpected record 0x"+u.toString(16))}},e),a["!id"][s["!rel"]]&&(s["!drawel"]=a["!id"][s["!rel"]]),s}function N9(){var t=Us();return Wt(t,129),Wt(t,130),t.end()}var iE=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],B9=[["activeTab",0,"int"],["autoFilterDateGrouping",!0,"bool"],["firstSheet",0,"int"],["minimized",!1,"bool"],["showHorizontalScroll",!0,"bool"],["showSheetTabs",!0,"bool"],["showVerticalScroll",!0,"bool"],["tabRatio",600,"int"],["visibility","visible"]],$9=[],O9=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function bC(t,e){for(var n=0;n!=t.length;++n)for(var a=t[n],i=0;i!=e.length;++i){var s=e[i];if(a[s[0]]==null)a[s[0]]=s[1];else switch(s[2]){case"bool":typeof a[s[0]]=="string"&&(a[s[0]]=Ya(a[s[0]]));break;case"int":typeof a[s[0]]=="string"&&(a[s[0]]=parseInt(a[s[0]],10));break}}}function yC(t,e){for(var n=0;n!=e.length;++n){var a=e[n];if(t[a[0]]==null)t[a[0]]=a[1];else switch(a[2]){case"bool":typeof t[a[0]]=="string"&&(t[a[0]]=Ya(t[a[0]]));break;case"int":typeof t[a[0]]=="string"&&(t[a[0]]=parseInt(t[a[0]],10));break}}}function _C(t){yC(t.WBProps,iE),yC(t.CalcPr,O9),bC(t.WBView,B9),bC(t.Sheets,$9),np.date1904=Ya(t.WBProps.date1904)}function R9(t){return!t.Workbook||!t.Workbook.WBProps?"false":Ya(t.Workbook.WBProps.date1904)?"true":"false"}var U9="][*?/\\".split("");function wC(t,e){if(t.length>31){if(e)return!1;throw new Error("Sheet names cannot exceed 31 chars")}var n=!0;return U9.forEach(function(a){if(t.indexOf(a)!=-1){if(!e)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");n=!1}}),n}function H9(t,e,n){t.forEach(function(a,i){wC(a);for(var s=0;s<i;++s)if(a==t[s])throw new Error("Duplicate Sheet Name: "+a);if(n){var r=e&&e[i]&&e[i].CodeName||a;if(r.charCodeAt(0)==95&&r.length>22)throw new Error("Bad Code Name: Worksheet"+r)}})}function vC(t){if(!t||!t.SheetNames||!t.Sheets)throw new Error("Invalid Workbook");if(!t.SheetNames.length)throw new Error("Workbook is empty");var e=t.Workbook&&t.Workbook.Sheets||[];H9(t.SheetNames,e,!!t.vbaraw);for(var n=0;n<t.SheetNames.length;++n)$U(t.Sheets[t.SheetNames[n]],t.SheetNames[n],n)}var q9=/<\w+:workbook/;function W9(t,e){if(!t)throw new Error("Could not find file");var n={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""},a=!1,i="xmlns",s={},r=0;if(t.replace(gs,function(l,c){var d=Pn(l);switch(jo(d[0])){case"<?xml":break;case"<workbook":l.match(q9)&&(i="xmlns"+l.match(/<(\w+):/)[1]),n.xmlns=d[i];break;case"</workbook>":break;case"<fileVersion":delete d[0],n.AppVersion=d;break;case"<fileVersion/>":case"</fileVersion>":break;case"<fileSharing":break;case"<fileSharing/>":break;case"<workbookPr":case"<workbookPr/>":iE.forEach(function(u){if(d[u[0]]!=null)switch(u[2]){case"bool":n.WBProps[u[0]]=Ya(d[u[0]]);break;case"int":n.WBProps[u[0]]=parseInt(d[u[0]],10);break;default:n.WBProps[u[0]]=d[u[0]]}}),d.codeName&&(n.WBProps.CodeName=Ia(d.codeName));break;case"</workbookPr>":break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews":case"<bookViews>":case"</bookViews>":break;case"<workbookView":case"<workbookView/>":delete d[0],n.WBView.push(d);break;case"</workbookView>":break;case"<sheets":case"<sheets>":case"</sheets>":break;case"<sheet":switch(d.state){case"hidden":d.Hidden=1;break;case"veryHidden":d.Hidden=2;break;default:d.Hidden=0}delete d.state,d.name=ga(Ia(d.name)),delete d[0],n.Sheets.push(d);break;case"</sheet>":break;case"<functionGroups":case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":case"<definedNames":a=!0;break;case"</definedNames>":a=!1;break;case"<definedName":s={},s.Name=Ia(d.name),d.comment&&(s.Comment=d.comment),d.localSheetId&&(s.Sheet=+d.localSheetId),Ya(d.hidden||"0")&&(s.Hidden=!0),r=c+l.length;break;case"</definedName>":s.Ref=ga(Ia(t.slice(r,c))),n.Names.push(s);break;case"<definedName/>":break;case"<calcPr":delete d[0],n.CalcPr=d;break;case"<calcPr/>":delete d[0],n.CalcPr=d;break;case"</calcPr>":break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":a=!0;break;case"</ext>":a=!1;break;case"<ArchID":break;case"<AlternateContent":case"<AlternateContent>":a=!0;break;case"</AlternateContent>":a=!1;break;case"<revisionPtr":break;default:if(!a&&e.WTF)throw new Error("unrecognized "+d[0]+" in workbook")}return l}),yc.indexOf(n.xmlns)===-1)throw new Error("Unknown Namespace: "+n.xmlns);return _C(n),n}function xC(t){var e=[Di];e[e.length]=nn("workbook",null,{xmlns:yc[0],"xmlns:r":Ci.r});var n=t.Workbook&&(t.Workbook.Names||[]).length>0,a={codeName:"ThisWorkbook"};t.Workbook&&t.Workbook.WBProps&&(iE.forEach(function(o){t.Workbook.WBProps[o[0]]!=null&&t.Workbook.WBProps[o[0]]!=o[1]&&(a[o[0]]=t.Workbook.WBProps[o[0]])}),t.Workbook.WBProps.CodeName&&(a.codeName=t.Workbook.WBProps.CodeName,delete a.CodeName)),e[e.length]=nn("workbookPr",null,a);var i=t.Workbook&&t.Workbook.Sheets||[],s=0;if(i&&i[0]&&i[0].Hidden){for(e[e.length]="<bookViews>",s=0;s!=t.SheetNames.length&&!(!i[s]||!i[s].Hidden);++s);s==t.SheetNames.length&&(s=0),e[e.length]='<workbookView firstSheet="'+s+'" activeTab="'+s+'"/>',e[e.length]="</bookViews>"}for(e[e.length]="<sheets>",s=0;s!=t.SheetNames.length;++s){var r={name:Ha(t.SheetNames[s].slice(0,31))};if(r.sheetId=""+(s+1),r["r:id"]="rId"+(s+1),i[s])switch(i[s].Hidden){case 1:r.state="hidden";break;case 2:r.state="veryHidden";break}e[e.length]=nn("sheet",null,r)}return e[e.length]="</sheets>",n&&(e[e.length]="<definedNames>",t.Workbook&&t.Workbook.Names&&t.Workbook.Names.forEach(function(o){var l={name:o.Name};o.Comment&&(l.comment=o.Comment),o.Sheet!=null&&(l.localSheetId=""+o.Sheet),o.Hidden&&(l.hidden="1"),o.Ref&&(e[e.length]=nn("definedName",Ha(o.Ref),l))}),e[e.length]="</definedNames>"),e.length>2&&(e[e.length]="</workbook>",e[1]=e[1].replace("/>",">")),e.join("")}function V9(t,e){var n={};return n.Hidden=t.read_shift(4),n.iTabID=t.read_shift(4),n.strRelID=L1(t,e-8),n.name=bs(t),n}function z9(t,e){return e||(e=Dt(127)),e.write_shift(4,t.Hidden),e.write_shift(4,t.iTabID),I1(t.strRelID,e),is(t.name.slice(0,31),e),e.length>e.l?e.slice(0,e.l):e}function Y9(t,e){var n={},a=t.read_shift(4);n.defaultThemeVersion=t.read_shift(4);var i=e>8?bs(t):"";return i.length>0&&(n.CodeName=i),n.autoCompressPictures=!!(a&65536),n.backupFile=!!(a&64),n.checkCompatibility=!!(a&4096),n.date1904=!!(a&1),n.filterPrivacy=!!(a&8),n.hidePivotFieldList=!!(a&1024),n.promptedSolutions=!!(a&16),n.publishItems=!!(a&2048),n.refreshAllConnections=!!(a&262144),n.saveExternalLinkValues=!!(a&128),n.showBorderUnselectedTables=!!(a&4),n.showInkAnnotation=!!(a&32),n.showObjects=["all","placeholders","none"][a>>13&3],n.showPivotChartFilter=!!(a&32768),n.updateLinks=["userSet","never","always"][a>>8&3],n}function G9(t,e){e||(e=Dt(72));var n=0;return t&&t.filterPrivacy&&(n|=8),e.write_shift(4,n),e.write_shift(4,0),U3(t&&t.CodeName||"ThisWorkbook",e),e.slice(0,e.l)}function j9(t,e){var n={};return t.read_shift(4),n.ArchID=t.read_shift(4),t.l+=e-8,n}function K9(t,e,n){var a=t.l+e;t.l+=4,t.l+=1;var i=t.read_shift(4),s=A8(t),r=FU(t,0,n),o=D1(t);t.l=a;var l={Name:s,Ptg:r};return i<268435455&&(l.Sheet=i),o&&(l.Comment=o),l}function X9(t,e){var n={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},a=[],i=!1;e||(e={}),e.biff=12;var s=[],r=[[]];return r.SheetNames=[],r.XTI=[],Rg[16]={n:"BrtFRTArchID$",f:j9},Tl(t,function(l,c,d){switch(d){case 156:r.SheetNames.push(l.name),n.Sheets.push(l);break;case 153:n.WBProps=l;break;case 39:l.Sheet!=null&&(e.SID=l.Sheet),l.Ref=vs(l.Ptg,null,null,r,e),delete e.SID,delete l.Ptg,s.push(l);break;case 1036:break;case 357:case 358:case 355:case 667:r[0].length?r.push([d,l]):r[0]=[d,l],r[r.length-1].XTI=[];break;case 362:r.length===0&&(r[0]=[],r[0].XTI=[]),r[r.length-1].XTI=r[r.length-1].XTI.concat(l),r.XTI=r.XTI.concat(l);break;case 361:break;case 2071:case 158:case 143:case 664:case 353:break;case 3072:case 3073:case 534:case 677:case 157:case 610:case 2050:case 155:case 548:case 676:case 128:case 665:case 2128:case 2125:case 549:case 2053:case 596:case 2076:case 2075:case 2082:case 397:case 154:case 1117:case 553:case 2091:break;case 35:a.push(d),i=!0;break;case 36:a.pop(),i=!1;break;case 37:a.push(d),i=!0;break;case 38:a.pop(),i=!1;break;case 16:break;default:if(!c.T){if(!i||e.WTF&&a[a.length-1]!=37&&a[a.length-1]!=35)throw new Error("Unexpected record 0x"+d.toString(16))}}},e),_C(n),n.Names=s,n.supbooks=r,n}function Z9(t,e){Wt(t,143);for(var n=0;n!=e.SheetNames.length;++n){var a=e.Workbook&&e.Workbook.Sheets&&e.Workbook.Sheets[n]&&e.Workbook.Sheets[n].Hidden||0,i={Hidden:a,iTabID:n+1,strRelID:"rId"+(n+1),name:e.SheetNames[n]};Wt(t,156,z9(i))}Wt(t,144)}function J9(t,e){e||(e=Dt(127));for(var n=0;n!=4;++n)e.write_shift(4,0);return is("SheetJS",e),is(lg.version,e),is(lg.version,e),is("7262",e),e.length>e.l?e.slice(0,e.l):e}function Q9(t,e){e||(e=Dt(29)),e.write_shift(-4,0),e.write_shift(-4,460),e.write_shift(4,28800),e.write_shift(4,17600),e.write_shift(4,500),e.write_shift(4,t),e.write_shift(4,t);var n=120;return e.write_shift(1,n),e.length>e.l?e.slice(0,e.l):e}function e7(t,e){if(!(!e.Workbook||!e.Workbook.Sheets)){for(var n=e.Workbook.Sheets,a=0,i=-1,s=-1;a<n.length;++a)!n[a]||!n[a].Hidden&&i==-1?i=a:n[a].Hidden==1&&s==-1&&(s=a);s>i||(Wt(t,135),Wt(t,158,Q9(i)),Wt(t,136))}}function t7(t,e){var n=Us();return Wt(n,131),Wt(n,128,J9()),Wt(n,153,G9(t.Workbook&&t.Workbook.WBProps||null)),e7(n,t,e),Z9(n,t,e),Wt(n,132),n.end()}function n7(t,e,n){return e.slice(-4)===".bin"?X9(t,n):W9(t,n)}function a7(t,e,n,a,i,s,r,o){return e.slice(-4)===".bin"?b9(t,a,n,i,s,r,o):jU(t,a,n,i,s,r,o)}function i7(t,e,n,a,i,s,r,o){return e.slice(-4)===".bin"?P9(t,a,n,i,s,r,o):I9(t,a,n,i,s,r,o)}function s7(t,e,n,a,i,s,r,o){return e.slice(-4)===".bin"?lR(t,a,n,i,s,r,o):cR(t,a,n,i,s,r,o)}function r7(t,e,n,a,i,s,r,o){return e.slice(-4)===".bin"?rR(t,a,n,i,s,r,o):oR(t,a,n,i,s,r,o)}function o7(t,e,n,a){return e.slice(-4)===".bin"?aO(t,n,a):z$(t,n,a)}function l7(t,e,n){return GD(t,n)}function c7(t,e,n){return e.slice(-4)===".bin"?d$(t,n):o$(t,n)}function d7(t,e,n){return e.slice(-4)===".bin"?tR(t,n):YO(t,n)}function u7(t,e,n){return e.slice(-4)===".bin"?WO(t,e,n):HO(t,e,n)}function f7(t,e,n,a){return n.slice(-4)===".bin"?VO(t,e,n,a):void 0}function p7(t,e,n){return e.slice(-4)===".bin"?OO(t,e,n):UO(t,e,n)}function h7(t,e,n){return(e.slice(-4)===".bin"?t7:xC)(t,n)}function g7(t,e,n,a,i){return(e.slice(-4)===".bin"?D9:hC)(t,n,a,i)}function jz(t,e,n,a,i){return(e.slice(-4)===".bin"?N9:M9)(t,n,a,i)}function m7(t,e,n){return(e.slice(-4)===".bin"?pO:VD)(t,n)}function b7(t,e,n){return(e.slice(-4)===".bin"?p$:BD)(t,n)}function y7(t,e,n){return(e.slice(-4)===".bin"?nR:ZD)(t,n)}function _7(t){return(t.slice(-4)===".bin"?RO:jD)()}var EC=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,kC=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;function Eo(t,e){var n=t.split(/\s+/),a=[];if(e||(a[0]=n[0]),n.length===1)return a;var i=t.match(EC),s,r,o,l;if(i)for(l=0;l!=i.length;++l)s=i[l].match(kC),(r=s[1].indexOf(":"))===-1?a[s[1]]=s[2].slice(1,s[2].length-1):(s[1].slice(0,6)==="xmlns:"?o="xmlns"+s[1].slice(6):o=s[1].slice(r+1),a[o]=s[2].slice(1,s[2].length-1));return a}function w7(t){var e=t.split(/\s+/),n={};if(e.length===1)return n;var a=t.match(EC),i,s,r,o;if(a)for(o=0;o!=a.length;++o)i=a[o].match(kC),(s=i[1].indexOf(":"))===-1?n[i[1]]=i[2].slice(1,i[2].length-1):(i[1].slice(0,6)==="xmlns:"?r="xmlns"+i[1].slice(6):r=i[1].slice(s+1),n[r]=i[2].slice(1,i[2].length-1));return n}var $g;function v7(t,e){var n=$g[t]||ga(t);return n==="General"?zd(e):kr(n,e)}function x7(t,e,n,a){var i=a;switch((n[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":i=Ya(a);break;case"i2":case"int":i=parseInt(a,10);break;case"r4":case"float":i=parseFloat(a);break;case"date":case"dateTime.tz":i=ei(a);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw new Error("bad custprop:"+n[0])}t[ga(e)]=i}function E7(t,e,n){if(t.t!=="z"){if(!n||n.cellText!==!1)try{t.t==="e"?t.w=t.w||Dl[t.v]:e==="General"?t.t==="n"?(t.v|0)===t.v?t.w=t.v.toString(10):t.w=hg(t.v):t.w=zd(t.v):t.w=v7(e||"General",t.v)}catch(s){if(n.WTF)throw s}try{var a=$g[e]||e||"General";if(n.cellNF&&(t.z=a),n.cellDates&&t.t=="n"&&Yd(a)){var i=gc(t.v);i&&(t.t="d",t.v=new Date(i.y,i.m-1,i.d,i.H,i.M,i.S,i.u))}}catch(s){if(n.WTF)throw s}}}function k7(t,e,n){if(n.cellStyles&&e.Interior){var a=e.Interior;a.Pattern&&(a.patternType=$$[a.Pattern]||a.Pattern)}t[e.ID]=e}function S7(t,e,n,a,i,s,r,o,l,c){var d="General",u=a.StyleID,g={};c=c||{};var f=[],h=0;for(u===void 0&&o&&(u=o.StyleID),u===void 0&&r&&(u=r.StyleID);s[u]!==void 0&&(s[u].nf&&(d=s[u].nf),s[u].Interior&&f.push(s[u].Interior),!!s[u].Parent);)u=s[u].Parent;switch(n.Type){case"Boolean":a.t="b",a.v=Ya(t);break;case"String":a.t="s",a.r=m3(ga(t)),a.v=t.indexOf("<")>-1?ga(e||t).replace(/<.*?>/g,""):a.r;break;case"DateTime":t.slice(-1)!="Z"&&(t+="Z"),a.v=(ei(t)-new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3),a.v!==a.v?a.v=ga(t):a.v<60&&(a.v=a.v-1),(!d||d=="General")&&(d="yyyy-mm-dd");case"Number":a.v===void 0&&(a.v=+t),a.t||(a.t="n");break;case"Error":a.t="e",a.v=G3[t],c.cellText!==!1&&(a.w=t);break;default:t==""&&e==""?a.t="z":(a.t="s",a.v=m3(e||t));break}if(E7(a,d,c),c.cellFormula!==!1)if(a.Formula){var m=ga(a.Formula);m.charCodeAt(0)==61&&(m=m.slice(1)),a.f=tp(m,i),delete a.Formula,a.ArrayRange=="RC"?a.F=tp("RC:RC",i):a.ArrayRange&&(a.F=tp(a.ArrayRange,i),l.push([oa(a.F),a.F]))}else for(h=0;h<l.length;++h)i.r>=l[h][0].s.r&&i.r<=l[h][0].e.r&&i.c>=l[h][0].s.c&&i.c<=l[h][0].e.c&&(a.F=l[h][1]);c.cellStyles&&(f.forEach(function(b){!g.patternType&&b.patternType&&(g.patternType=b.patternType)}),a.s=g),a.StyleID!==void 0&&(a.ixfe=a.StyleID)}function A7(t){t.t=t.v||"",t.t=t.t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),t.v=t.w=t.ixfe=void 0}function sE(t,e){var n=e||{};Yf();var a=Wf(b1(t));(n.type=="binary"||n.type=="array"||n.type=="base64")&&(typeof pa!="undefined"?a=pa.utils.decode(65001,L_(a)):a=Ia(a));var i=a.slice(0,1024).toLowerCase(),s=!1;if(i=i.replace(/".*?"/g,""),(i.indexOf(">")&1023)>Math.min(i.indexOf(",")&1023,i.indexOf(";")&1023)){var r=Ba(n);return r.type="string",Jf.to_workbook(a,r)}if(i.indexOf("<?xml")==-1&&["html","table","head","meta","script","style","div"].forEach(function(yi){i.indexOf("<"+yi)>=0&&(s=!0)}),s)return lq(a,n);$g={"General Number":"General","General Date":Dn[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":Dn[15],"Short Date":Dn[14],"Long Time":Dn[19],"Medium Time":Dn[18],"Short Time":Dn[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:Dn[2],Standard:Dn[4],Percent:Dn[10],Scientific:Dn[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var o,l=[],c;ri!=null&&n.dense==null&&(n.dense=ri);var d={},u=[],g=n.dense?[]:{},f="",h={},m={},b=Eo('<Data ss:Type="String">'),y=0,_=0,v=0,U={s:{r:2e6,c:2e6},e:{r:0,c:0}},ee={},Z={},k="",w=0,S=[],B={},H={},j=0,re=[],Te=[],Be={},Ie=[],Ce,Je=!1,ze=[],Ze=[],ht={},De=0,tt=0,Ve={Sheets:[],WBProps:{date1904:!1}},He={};_g.lastIndex=0,a=a.replace(/<!--([\s\S]*?)-->/mg,"");for(var bt="";o=_g.exec(a);)switch(o[3]=(bt=o[3]).toLowerCase()){case"data":if(bt=="data"){if(o[1]==="/"){if((c=l.pop())[0]!==o[3])throw new Error("Bad state: "+c.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&l.push([o[3],!0]);break}if(l[l.length-1][1])break;o[1]==="/"?S7(a.slice(y,o.index),k,b,l[l.length-1][0]=="comment"?Be:h,{c:_,r:v},ee,Ie[_],m,ze,n):(k="",b=Eo(o[0]),y=o.index+o[0].length);break;case"cell":if(o[1]==="/")if(Te.length>0&&(h.c=Te),(!n.sheetRows||n.sheetRows>v)&&h.v!==void 0&&(n.dense?(g[v]||(g[v]=[]),g[v][_]=h):g[Ga(_)+ci(v)]=h),h.HRef&&(h.l={Target:ga(h.HRef)},h.HRefScreenTip&&(h.l.Tooltip=h.HRefScreenTip),delete h.HRef,delete h.HRefScreenTip),(h.MergeAcross||h.MergeDown)&&(De=_+(parseInt(h.MergeAcross,10)|0),tt=v+(parseInt(h.MergeDown,10)|0),S.push({s:{c:_,r:v},e:{c:De,r:tt}})),!n.sheetStubs)h.MergeAcross?_=De+1:++_;else if(h.MergeAcross||h.MergeDown){for(var Kt=_;Kt<=De;++Kt)for(var Vt=v;Vt<=tt;++Vt)(Kt>_||Vt>v)&&(n.dense?(g[Vt]||(g[Vt]=[]),g[Vt][Kt]={t:"z"}):g[Ga(Kt)+ci(Vt)]={t:"z"});_=De+1}else++_;else h=w7(o[0]),h.Index&&(_=+h.Index-1),_<U.s.c&&(U.s.c=_),_>U.e.c&&(U.e.c=_),o[0].slice(-2)==="/>"&&++_,Te=[];break;case"row":o[1]==="/"||o[0].slice(-2)==="/>"?(v<U.s.r&&(U.s.r=v),v>U.e.r&&(U.e.r=v),o[0].slice(-2)==="/>"&&(m=Eo(o[0]),m.Index&&(v=+m.Index-1)),_=0,++v):(m=Eo(o[0]),m.Index&&(v=+m.Index-1),ht={},(m.AutoFitHeight=="0"||m.Height)&&(ht.hpx=parseInt(m.Height,10),ht.hpt=Lg(ht.hpx),Ze[v]=ht),m.Hidden=="1"&&(ht.hidden=!0,Ze[v]=ht));break;case"worksheet":if(o[1]==="/"){if((c=l.pop())[0]!==o[3])throw new Error("Bad state: "+c.join("|"));u.push(f),U.s.r<=U.e.r&&U.s.c<=U.e.c&&(g["!ref"]=Yn(U),n.sheetRows&&n.sheetRows<=U.e.r&&(g["!fullref"]=g["!ref"],U.e.r=n.sheetRows-1,g["!ref"]=Yn(U))),S.length&&(g["!merges"]=S),Ie.length>0&&(g["!cols"]=Ie),Ze.length>0&&(g["!rows"]=Ze),d[f]=g}else U={s:{r:2e6,c:2e6},e:{r:0,c:0}},v=_=0,l.push([o[3],!1]),c=Eo(o[0]),f=ga(c.Name),g=n.dense?[]:{},S=[],ze=[],Ze=[],He={name:f,Hidden:0},Ve.Sheets.push(He);break;case"table":if(o[1]==="/"){if((c=l.pop())[0]!==o[3])throw new Error("Bad state: "+c.join("|"))}else{if(o[0].slice(-2)=="/>")break;l.push([o[3],!1]),Ie=[],Je=!1}break;case"style":o[1]==="/"?k7(ee,Z,n):Z=Eo(o[0]);break;case"numberformat":Z.nf=ga(Eo(o[0]).Format||"General"),$g[Z.nf]&&(Z.nf=$g[Z.nf]);for(var At=0;At!=392&&Dn[At]!=Z.nf;++At);if(At==392){for(At=57;At!=392;++At)if(Dn[At]==null){Go(Z.nf,At);break}}break;case"column":if(l[l.length-1][0]!=="table")break;if(Ce=Eo(o[0]),Ce.Hidden&&(Ce.hidden=!0,delete Ce.Hidden),Ce.Width&&(Ce.wpx=parseInt(Ce.Width,10)),!Je&&Ce.wpx>10){Je=!0,ws=qD;for(var Ct=0;Ct<Ie.length;++Ct)Ie[Ct]&&ru(Ie[Ct])}Je&&ru(Ce),Ie[Ce.Index-1||Ie.length]=Ce;for(var Ln=0;Ln<+Ce.Span;++Ln)Ie[Ie.length]=Ba(Ce);break;case"namedrange":if(o[1]==="/")break;Ve.Names||(Ve.Names=[]);var Oe=Pn(o[0]),Xn={Name:Oe.Name,Ref:tp(Oe.RefersTo.slice(1),{r:0,c:0})};Ve.Sheets.length>0&&(Xn.Sheet=Ve.Sheets.length-1),Ve.Names.push(Xn);break;case"namedcell":break;case"b":break;case"i":break;case"u":break;case"s":break;case"em":break;case"h2":break;case"h3":break;case"sub":break;case"sup":break;case"span":break;case"alignment":break;case"borders":break;case"border":break;case"font":if(o[0].slice(-2)==="/>")break;o[1]==="/"?k+=a.slice(w,o.index):w=o.index+o[0].length;break;case"interior":if(!n.cellStyles)break;Z.Interior=Eo(o[0]);break;case"protection":break;case"author":case"title":case"description":case"created":case"keywords":case"subject":case"category":case"company":case"lastauthor":case"lastsaved":case"lastprinted":case"version":case"revision":case"totaltime":case"hyperlinkbase":case"manager":case"contentstatus":case"identifier":case"language":case"appname":if(o[0].slice(-2)==="/>")break;o[1]==="/"?Z8(B,bt,a.slice(j,o.index)):j=o.index+o[0].length;break;case"paragraphs":break;case"styles":case"workbook":if(o[1]==="/"){if((c=l.pop())[0]!==o[3])throw new Error("Bad state: "+c.join("|"))}else l.push([o[3],!1]);break;case"comment":if(o[1]==="/"){if((c=l.pop())[0]!==o[3])throw new Error("Bad state: "+c.join("|"));A7(Be),Te.push(Be)}else l.push([o[3],!1]),c=Eo(o[0]),Be={a:c.Author};break;case"autofilter":if(o[1]==="/"){if((c=l.pop())[0]!==o[3])throw new Error("Bad state: "+c.join("|"))}else if(o[0].charAt(o[0].length-2)!=="/"){var Rn=Eo(o[0]);g["!autofilter"]={ref:tp(Rn.Range).replace(/\$/g,"")},l.push([o[3],!0])}break;case"name":break;case"datavalidation":if(o[1]==="/"){if((c=l.pop())[0]!==o[3])throw new Error("Bad state: "+c.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&l.push([o[3],!0]);break;case"pixelsperinch":break;case"componentoptions":case"documentproperties":case"customdocumentproperties":case"officedocumentsettings":case"pivottable":case"pivotcache":case"names":case"mapinfo":case"pagebreaks":case"querytable":case"sorting":case"schema":case"conditionalformatting":case"smarttagtype":case"smarttags":case"excelworkbook":case"workbookoptions":case"worksheetoptions":if(o[1]==="/"){if((c=l.pop())[0]!==o[3])throw new Error("Bad state: "+c.join("|"))}else o[0].charAt(o[0].length-2)!=="/"&&l.push([o[3],!0]);break;case"null":break;default:if(l.length==0&&o[3]=="document"||l.length==0&&o[3]=="uof")return UC(a,n);var Da=!0;switch(l[l.length-1][0]){case"officedocumentsettings":switch(o[3]){case"allowpng":break;case"removepersonalinformation":break;case"downloadcomponents":break;case"locationofcomponents":break;case"colors":break;case"color":break;case"index":break;case"rgb":break;case"targetscreensize":break;case"readonlyrecommended":break;default:Da=!1}break;case"componentoptions":switch(o[3]){case"toolbar":break;case"hideofficelogo":break;case"spreadsheetautofit":break;case"label":break;case"caption":break;case"maxheight":break;case"maxwidth":break;case"nextsheetnumber":break;default:Da=!1}break;case"excelworkbook":switch(o[3]){case"date1904":Ve.WBProps.date1904=!0;break;case"windowheight":break;case"windowwidth":break;case"windowtopx":break;case"windowtopy":break;case"tabratio":break;case"protectstructure":break;case"protectwindow":break;case"protectwindows":break;case"activesheet":break;case"displayinknotes":break;case"firstvisiblesheet":break;case"supbook":break;case"sheetname":break;case"sheetindex":break;case"sheetindexfirst":break;case"sheetindexlast":break;case"dll":break;case"acceptlabelsinformulas":break;case"donotsavelinkvalues":break;case"iteration":break;case"maxiterations":break;case"maxchange":break;case"path":break;case"xct":break;case"count":break;case"selectedsheets":break;case"calculation":break;case"uncalced":break;case"startupprompt":break;case"crn":break;case"externname":break;case"formula":break;case"colfirst":break;case"collast":break;case"wantadvise":break;case"boolean":break;case"error":break;case"text":break;case"ole":break;case"noautorecover":break;case"publishobjects":break;case"donotcalculatebeforesave":break;case"number":break;case"refmoder1c1":break;case"embedsavesmarttags":break;default:Da=!1}break;case"workbookoptions":switch(o[3]){case"owcversion":break;case"height":break;case"width":break;default:Da=!1}break;case"worksheetoptions":switch(o[3]){case"visible":if(o[0].slice(-2)!=="/>")if(o[1]==="/")switch(a.slice(j,o.index)){case"SheetHidden":He.Hidden=1;break;case"SheetVeryHidden":He.Hidden=2;break}else j=o.index+o[0].length;break;case"header":g["!margins"]||ou(g["!margins"]={},"xlml"),isNaN(+Pn(o[0]).Margin)||(g["!margins"].header=+Pn(o[0]).Margin);break;case"footer":g["!margins"]||ou(g["!margins"]={},"xlml"),isNaN(+Pn(o[0]).Margin)||(g["!margins"].footer=+Pn(o[0]).Margin);break;case"pagemargins":var sa=Pn(o[0]);g["!margins"]||ou(g["!margins"]={},"xlml"),isNaN(+sa.Top)||(g["!margins"].top=+sa.Top),isNaN(+sa.Left)||(g["!margins"].left=+sa.Left),isNaN(+sa.Right)||(g["!margins"].right=+sa.Right),isNaN(+sa.Bottom)||(g["!margins"].bottom=+sa.Bottom);break;case"displayrighttoleft":Ve.Views||(Ve.Views=[]),Ve.Views[0]||(Ve.Views[0]={}),Ve.Views[0].RTL=!0;break;case"freezepanes":break;case"frozennosplit":break;case"splithorizontal":case"splitvertical":break;case"donotdisplaygridlines":break;case"activerow":break;case"activecol":break;case"toprowbottompane":break;case"leftcolumnrightpane":break;case"unsynced":break;case"print":break;case"printerrors":break;case"panes":break;case"scale":break;case"pane":break;case"number":break;case"layout":break;case"pagesetup":break;case"selected":break;case"protectobjects":break;case"enableselection":break;case"protectscenarios":break;case"validprinterinfo":break;case"horizontalresolution":break;case"verticalresolution":break;case"numberofcopies":break;case"activepane":break;case"toprowvisible":break;case"leftcolumnvisible":break;case"fittopage":break;case"rangeselection":break;case"papersizeindex":break;case"pagelayoutzoom":break;case"pagebreakzoom":break;case"filteron":break;case"fitwidth":break;case"fitheight":break;case"commentslayout":break;case"zoom":break;case"lefttoright":break;case"gridlines":break;case"allowsort":break;case"allowfilter":break;case"allowinsertrows":break;case"allowdeleterows":break;case"allowinsertcols":break;case"allowdeletecols":break;case"allowinserthyperlinks":break;case"allowformatcells":break;case"allowsizecols":break;case"allowsizerows":break;case"nosummaryrowsbelowdetail":g["!outline"]||(g["!outline"]={}),g["!outline"].above=!0;break;case"tabcolorindex":break;case"donotdisplayheadings":break;case"showpagelayoutzoom":break;case"nosummarycolumnsrightdetail":g["!outline"]||(g["!outline"]={}),g["!outline"].left=!0;break;case"blackandwhite":break;case"donotdisplayzeros":break;case"displaypagebreak":break;case"rowcolheadings":break;case"donotdisplayoutline":break;case"noorientation":break;case"allowusepivottables":break;case"zeroheight":break;case"viewablerange":break;case"selection":break;case"protectcontents":break;default:Da=!1}break;case"pivottable":case"pivotcache":switch(o[3]){case"immediateitemsondrop":break;case"showpagemultipleitemlabel":break;case"compactrowindent":break;case"location":break;case"pivotfield":break;case"orientation":break;case"layoutform":break;case"layoutsubtotallocation":break;case"layoutcompactrow":break;case"position":break;case"pivotitem":break;case"datatype":break;case"datafield":break;case"sourcename":break;case"parentfield":break;case"ptlineitems":break;case"ptlineitem":break;case"countofsameitems":break;case"item":break;case"itemtype":break;case"ptsource":break;case"cacheindex":break;case"consolidationreference":break;case"filename":break;case"reference":break;case"nocolumngrand":break;case"norowgrand":break;case"blanklineafteritems":break;case"hidden":break;case"subtotal":break;case"basefield":break;case"mapchilditems":break;case"function":break;case"refreshonfileopen":break;case"printsettitles":break;case"mergelabels":break;case"defaultversion":break;case"refreshname":break;case"refreshdate":break;case"refreshdatecopy":break;case"versionlastrefresh":break;case"versionlastupdate":break;case"versionupdateablemin":break;case"versionrefreshablemin":break;case"calculation":break;default:Da=!1}break;case"pagebreaks":switch(o[3]){case"colbreaks":break;case"colbreak":break;case"rowbreaks":break;case"rowbreak":break;case"colstart":break;case"colend":break;case"rowend":break;default:Da=!1}break;case"autofilter":switch(o[3]){case"autofiltercolumn":break;case"autofiltercondition":break;case"autofilterand":break;case"autofilteror":break;default:Da=!1}break;case"querytable":switch(o[3]){case"id":break;case"autoformatfont":break;case"autoformatpattern":break;case"querysource":break;case"querytype":break;case"enableredirections":break;case"refreshedinxl9":break;case"urlstring":break;case"htmltables":break;case"connection":break;case"commandtext":break;case"refreshinfo":break;case"notitles":break;case"nextid":break;case"columninfo":break;case"overwritecells":break;case"donotpromptforfile":break;case"textwizardsettings":break;case"source":break;case"number":break;case"decimal":break;case"thousandseparator":break;case"trailingminusnumbers":break;case"formatsettings":break;case"fieldtype":break;case"delimiters":break;case"tab":break;case"comma":break;case"autoformatname":break;case"versionlastedit":break;case"versionlastrefresh":break;default:Da=!1}break;case"datavalidation":switch(o[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;case"cellrangelist":break;default:Da=!1}break;case"sorting":case"conditionalformatting":switch(o[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"cellrangelist":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;default:Da=!1}break;case"mapinfo":case"schema":case"data":switch(o[3]){case"map":break;case"entry":break;case"range":break;case"xpath":break;case"field":break;case"xsdtype":break;case"filteron":break;case"aggregate":break;case"elementtype":break;case"attributetype":break;case"schema":case"element":case"complextype":case"datatype":case"all":case"attribute":case"extends":break;case"row":break;default:Da=!1}break;case"smarttags":break;default:Da=!1;break}if(Da||o[3].match(/!\[CDATA/))break;if(!l[l.length-1][1])throw"Unrecognized tag: "+o[3]+"|"+l.join("|");if(l[l.length-1][0]==="customdocumentproperties"){if(o[0].slice(-2)==="/>")break;o[1]==="/"?x7(H,bt,re,a.slice(j,o.index)):(re=o,j=o.index+o[0].length);break}if(n.WTF)throw"Unrecognized tag: "+o[3]+"|"+l.join("|")}var fn={};return!n.bookSheets&&!n.bookProps&&(fn.Sheets=d),fn.SheetNames=u,fn.Workbook=Ve,fn.SSF=Ba(Dn),fn.Props=B,fn.Custprops=H,fn}function rE(t,e){switch(pE(e=e||{}),e.type||"base64"){case"base64":return sE(xr(t),e);case"binary":case"buffer":case"file":return sE(t,e);case"array":return sE(hc(t),e)}}function T7(t,e){var n=[];return t.Props&&n.push(J8(t.Props,e)),t.Custprops&&n.push(Q8(t.Props,t.Custprops,e)),n.join("")}function D7(){return""}function C7(t,e){var n=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return e.cellXfs.forEach(function(a,i){var s=[];s.push(nn("NumberFormat",null,{"ss:Format":Ha(Dn[a.numFmtId])}));var r={"ss:ID":"s"+(21+i)};n.push(nn("Style",s.join(""),r))}),nn("Styles",n.join(""))}function SC(t){return nn("NamedRange",null,{"ss:Name":t.Name,"ss:RefersTo":"="+J1(t.Ref,{r:0,c:0})})}function L7(t){if(!((t||{}).Workbook||{}).Names)return"";for(var e=t.Workbook.Names,n=[],a=0;a<e.length;++a){var i=e[a];i.Sheet==null&&(i.Name.match(/^_xlfn\./)||n.push(SC(i)))}return nn("Names",n.join(""))}function I7(t,e,n,a){if(!t||!((a||{}).Workbook||{}).Names)return"";for(var i=a.Workbook.Names,s=[],r=0;r<i.length;++r){var o=i[r];o.Sheet==n&&(o.Name.match(/^_xlfn\./)||s.push(SC(o)))}return s.join("")}function M7(t,e,n,a){if(!t)return"";var i=[];if(t["!margins"]&&(i.push("<PageSetup>"),t["!margins"].header&&i.push(nn("Header",null,{"x:Margin":t["!margins"].header})),t["!margins"].footer&&i.push(nn("Footer",null,{"x:Margin":t["!margins"].footer})),i.push(nn("PageMargins",null,{"x:Bottom":t["!margins"].bottom||"0.75","x:Left":t["!margins"].left||"0.7","x:Right":t["!margins"].right||"0.7","x:Top":t["!margins"].top||"0.75"})),i.push("</PageSetup>")),a&&a.Workbook&&a.Workbook.Sheets&&a.Workbook.Sheets[n])if(a.Workbook.Sheets[n].Hidden)i.push(nn("Visible",a.Workbook.Sheets[n].Hidden==1?"SheetHidden":"SheetVeryHidden",{}));else{for(var s=0;s<n&&!(a.Workbook.Sheets[s]&&!a.Workbook.Sheets[s].Hidden);++s);s==n&&i.push("<Selected/>")}return((((a||{}).Workbook||{}).Views||[])[0]||{}).RTL&&i.push("<DisplayRightToLeft/>"),t["!protect"]&&(i.push(ns("ProtectContents","True")),t["!protect"].objects&&i.push(ns("ProtectObjects","True")),t["!protect"].scenarios&&i.push(ns("ProtectScenarios","True")),t["!protect"].selectLockedCells!=null&&!t["!protect"].selectLockedCells?i.push(ns("EnableSelection","NoSelection")):t["!protect"].selectUnlockedCells!=null&&!t["!protect"].selectUnlockedCells&&i.push(ns("EnableSelection","UnlockedCells")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(r){t["!protect"][r[0]]&&i.push("<"+r[1]+"/>")})),i.length==0?"":nn("WorksheetOptions",i.join(""),{xmlns:Ar.x})}function F7(t){return t.map(function(e){var n=n8(e.t||""),a=nn("ss:Data",n,{xmlns:"http://www.w3.org/TR/REC-html40"});return nn("Comment",a,{"ss:Author":e.a})}).join("")}function P7(t,e,n,a,i,s,r){if(!t||t.v==null&&t.f==null)return"";var o={};if(t.f&&(o["ss:Formula"]="="+Ha(J1(t.f,r))),t.F&&t.F.slice(0,e.length)==e){var l=ti(t.F.slice(e.length+1));o["ss:ArrayRange"]="RC:R"+(l.r==r.r?"":"["+(l.r-r.r)+"]")+"C"+(l.c==r.c?"":"["+(l.c-r.c)+"]")}if(t.l&&t.l.Target&&(o["ss:HRef"]=Ha(t.l.Target),t.l.Tooltip&&(o["x:HRefScreenTip"]=Ha(t.l.Tooltip))),n["!merges"])for(var c=n["!merges"],d=0;d!=c.length;++d)c[d].s.c!=r.c||c[d].s.r!=r.r||(c[d].e.c>c[d].s.c&&(o["ss:MergeAcross"]=c[d].e.c-c[d].s.c),c[d].e.r>c[d].s.r&&(o["ss:MergeDown"]=c[d].e.r-c[d].s.r));var u="",g="";switch(t.t){case"z":if(!a.sheetStubs)return"";break;case"n":u="Number",g=String(t.v);break;case"b":u="Boolean",g=t.v?"1":"0";break;case"e":u="Error",g=Dl[t.v];break;case"d":u="DateTime",g=new Date(t.v).toISOString(),t.z==null&&(t.z=t.z||Dn[14]);break;case"s":u="String",g=t8(t.v||"");break}var f=xc(a.cellXfs,t,a);o["ss:StyleID"]="s"+(21+f),o["ss:Index"]=r.c+1;var h=t.v!=null?g:"",m=t.t=="z"?"":'<Data ss:Type="'+u+'">'+h+"</Data>";return(t.c||[]).length>0&&(m+=F7(t.c)),nn("Cell",m,o)}function N7(t,e){var n='<Row ss:Index="'+(t+1)+'"';return e&&(e.hpt&&!e.hpx&&(e.hpx=Qf(e.hpt)),e.hpx&&(n+=' ss:AutoFitHeight="0" ss:Height="'+e.hpx+'"'),e.hidden&&(n+=' ss:Hidden="1"')),n+">"}function B7(t,e,n,a){if(!t["!ref"])return"";var i=oa(t["!ref"]),s=t["!merges"]||[],r=0,o=[];t["!cols"]&&t["!cols"].forEach(function(b,y){ru(b);var _=!!b.width,v=aw(y,b),U={"ss:Index":y+1};_&&(U["ss:Width"]=Dg(v.width)),b.hidden&&(U["ss:Hidden"]="1"),o.push(nn("Column",null,U))});for(var l=Array.isArray(t),c=i.s.r;c<=i.e.r;++c){for(var d=[N7(c,(t["!rows"]||[])[c])],u=i.s.c;u<=i.e.c;++u){var g=!1;for(r=0;r!=s.length;++r)if(!(s[r].s.c>u)&&!(s[r].s.r>c)&&!(s[r].e.c<u)&&!(s[r].e.r<c)){(s[r].s.c!=u||s[r].s.r!=c)&&(g=!0);break}if(!g){var f={r:c,c:u},h=Nn(f),m=l?(t[c]||[])[u]:t[h];d.push(P7(m,h,t,e,n,a,f))}}d.push("</Row>"),d.length>2&&o.push(d.join(""))}return o.join("")}function $7(t,e,n){var a=[],i=n.SheetNames[t],s=n.Sheets[i],r=s?I7(s,e,t,n):"";return r.length>0&&a.push("<Names>"+r+"</Names>"),r=s?B7(s,e,t,n):"",r.length>0&&a.push("<Table>"+r+"</Table>"),a.push(M7(s,e,t,n)),a.join("")}function O7(t,e){e||(e={}),t.SSF||(t.SSF=Ba(Dn)),t.SSF&&(Yf(),gg(t.SSF),e.revssf=N_(t.SSF),e.revssf[t.SSF[65535]]=0,e.ssf=t.SSF,e.cellXfs=[],xc(e.cellXfs,{},{revssf:{General:0}}));var n=[];n.push(T7(t,e)),n.push(D7(t,e)),n.push(""),n.push("");for(var a=0;a<t.SheetNames.length;++a)n.push(nn("Worksheet",$7(a,e,t),{"ss:Name":Ha(t.SheetNames[a])}));return n[2]=C7(t,e),n[3]=L7(t,e),Di+nn("Workbook",n.join(""),{xmlns:Ar.ss,"xmlns:o":Ar.o,"xmlns:x":Ar.x,"xmlns:ss":Ar.ss,"xmlns:dt":Ar.dt,"xmlns:html":Ar.html})}function R7(t){var e={},n=t.content;if(n.l=28,e.AnsiUserType=n.read_shift(0,"lpstr-ansi"),e.AnsiClipboardFormat=L8(n),n.length-n.l<=4)return e;var a=n.read_shift(4);if(a==0||a>40||(n.l-=4,e.Reserved1=n.read_shift(0,"lpstr-ansi"),n.length-n.l<=4)||(a=n.read_shift(4),a!==1907505652)||(e.UnicodeClipboardFormat=I8(n),a=n.read_shift(4),a==0||a>40))return e;n.l-=4,e.Reserved2=n.read_shift(0,"lpwstr")}var U7=[60,1084,2066,2165,2175];function H7(t,e,n,a,i){var s=a,r=[],o=n.slice(n.l,n.l+s);if(i&&i.enc&&i.enc.insitu&&o.length>0)switch(t){case 9:case 521:case 1033:case 2057:case 47:case 405:case 225:case 406:case 312:case 404:case 10:break;case 133:break;default:i.enc.insitu(o)}r.push(o),n.l+=s;for(var l=Al(n,n.l),c=oE[l],d=0;c!=null&&U7.indexOf(l)>-1;)s=Al(n,n.l+2),d=n.l+4,l==2066?d+=4:(l==2165||l==2175)&&(d+=12),o=n.slice(d,n.l+4+s),r.push(o),n.l+=4+s,c=oE[l=Al(n,n.l)];var u=Yi(r);as(u,0);var g=0;u.lens=[];for(var f=0;f<r.length;++f)u.lens.push(g),g+=r[f].length;if(u.length<a)throw"XLS Record 0x"+t.toString(16)+" Truncated: "+u.length+" < "+a;return e.f(u,u.length,i)}function Jo(t,e,n){if(t.t!=="z"&&t.XF){var a=0;try{a=t.z||t.XF.numFmtId||0,e.cellNF&&(t.z=Dn[a])}catch(s){if(e.WTF)throw s}if(!e||e.cellText!==!1)try{t.t==="e"?t.w=t.w||Dl[t.v]:a===0||a=="General"?t.t==="n"?(t.v|0)===t.v?t.w=t.v.toString(10):t.w=hg(t.v):t.w=zd(t.v):t.w=kr(a,t.v,{date1904:!!n,dateNF:e&&e.dateNF})}catch(s){if(e.WTF)throw s}if(e.cellDates&&a&&t.t=="n"&&Yd(Dn[a]||String(a))){var i=gc(t.v);i&&(t.t="d",t.v=new Date(i.y,i.m-1,i.d,i.H,i.M,i.S,i.u))}}}function iw(t,e,n){return{v:t,ixfe:e,t:n}}function q7(t,e){var n={opts:{}},a={};ri!=null&&e.dense==null&&(e.dense=ri);var i=e.dense?[]:{},s={},r={},o=null,l=[],c="",d={},u,g="",f,h,m,b,y={},_=[],v,U,ee=[],Z=[],k={Sheets:[],WBProps:{date1904:!1},Views:[{}]},w={},S=function(ea){return ea<8?eu[ea]:ea<64&&Z[ea-8]||eu[ea]},B=function(ea,_i,ao){var Hi=_i.XF.data;if(!(!Hi||!Hi.patternType||!ao||!ao.cellStyles)){_i.s={},_i.s.patternType=Hi.patternType;var ef;(ef=Tg(S(Hi.icvFore)))&&(_i.s.fgColor={rgb:ef}),(ef=Tg(S(Hi.icvBack)))&&(_i.s.bgColor={rgb:ef})}},H=function(ea,_i,ao){if(!(ht>1)&&!(ao.sheetRows&&ea.r>=ao.sheetRows)){if(ao.cellStyles&&_i.XF&&_i.XF.data&&B(ea,_i,ao),delete _i.ixfe,delete _i.XF,u=ea,g=Nn(ea),(!r||!r.s||!r.e)&&(r={s:{r:0,c:0},e:{r:0,c:0}}),ea.r<r.s.r&&(r.s.r=ea.r),ea.c<r.s.c&&(r.s.c=ea.c),ea.r+1>r.e.r&&(r.e.r=ea.r+1),ea.c+1>r.e.c&&(r.e.c=ea.c+1),ao.cellFormula&&_i.f){for(var Hi=0;Hi<_.length;++Hi)if(!(_[Hi][0].s.c>ea.c||_[Hi][0].s.r>ea.r)&&!(_[Hi][0].e.c<ea.c||_[Hi][0].e.r<ea.r)){_i.F=Yn(_[Hi][0]),(_[Hi][0].s.c!=ea.c||_[Hi][0].s.r!=ea.r)&&delete _i.f,_i.f&&(_i.f=""+vs(_[Hi][1],r,ea,ze,j));break}}ao.dense?(i[ea.r]||(i[ea.r]=[]),i[ea.r][ea.c]=_i):i[g]=_i}},j={enc:!1,sbcch:0,snames:[],sharedf:y,arrayf:_,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!e&&!!e.cellStyles,WTF:!!e&&!!e.wtf};e.password&&(j.password=e.password);var re,Te=[],Be=[],Ie=[],Ce=[],Je=!1,ze=[];ze.SheetNames=j.snames,ze.sharedf=j.sharedf,ze.arrayf=j.arrayf,ze.names=[],ze.XTI=[];var Ze=0,ht=0,De=0,tt=[],Ve=[],He;j.codepage=1200,Or(1200);for(var bt=!1;t.l<t.length-1;){var Kt=t.l,Vt=t.read_shift(2);if(Vt===0&&Ze===10)break;var At=t.l===t.length?0:t.read_shift(2),Ct=oE[Vt];if(Ct&&Ct.f){if(e.bookSheets&&Ze===133&&Vt!==133)break;if(Ze=Vt,Ct.r===2||Ct.r==12){var Ln=t.read_shift(2);if(At-=2,!j.enc&&Ln!==Vt&&((Ln&255)<<8|Ln>>8)!==Vt)throw new Error("rt mismatch: "+Ln+"!="+Vt);Ct.r==12&&(t.l+=10,At-=10)}var Oe={};if(Vt===10?Oe=Ct.f(t,At,j):Oe=H7(Vt,Ct,t,At,j),ht==0&&[9,521,1033,2057].indexOf(Ze)===-1)continue;switch(Vt){case 34:n.opts.Date1904=k.WBProps.date1904=Oe;break;case 134:n.opts.WriteProtect=!0;break;case 47:if(j.enc||(t.l=0),j.enc=Oe,!e.password)throw new Error("File is password-protected");if(Oe.valid==null)throw new Error("Encryption scheme unsupported");if(!Oe.valid)throw new Error("Password is incorrect");break;case 92:j.lastuser=Oe;break;case 66:var Xn=Number(Oe);switch(Xn){case 21010:Xn=1200;break;case 32768:Xn=1e4;break;case 32769:Xn=1252;break}Or(j.codepage=Xn),bt=!0;break;case 317:j.rrtabid=Oe;break;case 25:j.winlocked=Oe;break;case 439:n.opts.RefreshAll=Oe;break;case 12:n.opts.CalcCount=Oe;break;case 16:n.opts.CalcDelta=Oe;break;case 17:n.opts.CalcIter=Oe;break;case 13:n.opts.CalcMode=Oe;break;case 14:n.opts.CalcPrecision=Oe;break;case 95:n.opts.CalcSaveRecalc=Oe;break;case 15:j.CalcRefMode=Oe;break;case 2211:n.opts.FullCalc=Oe;break;case 129:Oe.fDialog&&(i["!type"]="dialog"),Oe.fBelow||((i["!outline"]||(i["!outline"]={})).above=!0),Oe.fRight||((i["!outline"]||(i["!outline"]={})).left=!0);break;case 224:ee.push(Oe);break;case 430:ze.push([Oe]),ze[ze.length-1].XTI=[];break;case 35:case 547:ze[ze.length-1].push(Oe);break;case 24:case 536:He={Name:Oe.Name,Ref:vs(Oe.rgce,r,null,ze,j)},Oe.itab>0&&(He.Sheet=Oe.itab-1),ze.names.push(He),ze[0]||(ze[0]=[],ze[0].XTI=[]),ze[ze.length-1].push(Oe),Oe.Name=="_xlnm._FilterDatabase"&&Oe.itab>0&&Oe.rgce&&Oe.rgce[0]&&Oe.rgce[0][0]&&Oe.rgce[0][0][0]=="PtgArea3d"&&(Ve[Oe.itab-1]={ref:Yn(Oe.rgce[0][0][1][2])});break;case 22:j.ExternCount=Oe;break;case 23:ze.length==0&&(ze[0]=[],ze[0].XTI=[]),ze[ze.length-1].XTI=ze[ze.length-1].XTI.concat(Oe),ze.XTI=ze.XTI.concat(Oe);break;case 2196:if(j.biff<8)break;He!=null&&(He.Comment=Oe[1]);break;case 18:i["!protect"]=Oe;break;case 19:Oe!==0&&j.WTF&&console.error("Password verifier: "+Oe);break;case 133:s[Oe.pos]=Oe,j.snames.push(Oe.name);break;case 10:{if(--ht)break;if(r.e){if(r.e.r>0&&r.e.c>0){if(r.e.r--,r.e.c--,i["!ref"]=Yn(r),e.sheetRows&&e.sheetRows<=r.e.r){var Rn=r.e.r;r.e.r=e.sheetRows-1,i["!fullref"]=i["!ref"],i["!ref"]=Yn(r),r.e.r=Rn}r.e.r++,r.e.c++}Te.length>0&&(i["!merges"]=Te),Be.length>0&&(i["!objects"]=Be),Ie.length>0&&(i["!cols"]=Ie),Ce.length>0&&(i["!rows"]=Ce),k.Sheets.push(w)}c===""?d=i:a[c]=i,i=e.dense?[]:{}}break;case 9:case 521:case 1033:case 2057:{if(j.biff===8&&(j.biff={9:2,521:3,1033:4}[Vt]||{512:2,768:3,1024:4,1280:5,1536:8,2:2,7:2}[Oe.BIFFVer]||8),j.biffguess=Oe.BIFFVer==0,Oe.BIFFVer==0&&Oe.dt==4096&&(j.biff=5,bt=!0,Or(j.codepage=28591)),j.biff==8&&Oe.BIFFVer==0&&Oe.dt==16&&(j.biff=2),ht++)break;if(i=e.dense?[]:{},j.biff<8&&!bt&&(bt=!0,Or(j.codepage=e.codepage||1252)),j.biff<5||Oe.BIFFVer==0&&Oe.dt==4096){c===""&&(c="Sheet1"),r={s:{r:0,c:0},e:{r:0,c:0}};var Da={pos:t.l-At,name:c};s[Da.pos]=Da,j.snames.push(c)}else c=(s[Kt]||{name:""}).name;Oe.dt==32&&(i["!type"]="chart"),Oe.dt==64&&(i["!type"]="macro"),Te=[],Be=[],j.arrayf=_=[],Ie=[],Ce=[],Je=!1,w={Hidden:(s[Kt]||{hs:0}).hs,name:c}}break;case 515:case 3:case 2:i["!type"]=="chart"&&(e.dense?(i[Oe.r]||[])[Oe.c]:i[Nn({c:Oe.c,r:Oe.r})])&&++Oe.c,v={ixfe:Oe.ixfe,XF:ee[Oe.ixfe]||{},v:Oe.val,t:"n"},De>0&&(v.z=tt[v.ixfe>>8&63]),Jo(v,e,n.opts.Date1904),H({c:Oe.c,r:Oe.r},v,e);break;case 5:case 517:v={ixfe:Oe.ixfe,XF:ee[Oe.ixfe],v:Oe.val,t:Oe.t},De>0&&(v.z=tt[v.ixfe>>8&63]),Jo(v,e,n.opts.Date1904),H({c:Oe.c,r:Oe.r},v,e);break;case 638:v={ixfe:Oe.ixfe,XF:ee[Oe.ixfe],v:Oe.rknum,t:"n"},De>0&&(v.z=tt[v.ixfe>>8&63]),Jo(v,e,n.opts.Date1904),H({c:Oe.c,r:Oe.r},v,e);break;case 189:for(var sa=Oe.c;sa<=Oe.C;++sa){var fn=Oe.rkrec[sa-Oe.c][0];v={ixfe:fn,XF:ee[fn],v:Oe.rkrec[sa-Oe.c][1],t:"n"},De>0&&(v.z=tt[v.ixfe>>8&63]),Jo(v,e,n.opts.Date1904),H({c:sa,r:Oe.r},v,e)}break;case 6:case 518:case 1030:{if(Oe.val=="String"){o=Oe;break}if(v=iw(Oe.val,Oe.cell.ixfe,Oe.tt),v.XF=ee[v.ixfe],e.cellFormula){var yi=Oe.formula;if(yi&&yi[0]&&yi[0][0]&&yi[0][0][0]=="PtgExp"){var no=yi[0][0][1][0],dl=yi[0][0][1][1],zl=Nn({r:no,c:dl});y[zl]?v.f=""+vs(Oe.formula,r,Oe.cell,ze,j):v.F=((e.dense?(i[no]||[])[dl]:i[zl])||{}).F}else v.f=""+vs(Oe.formula,r,Oe.cell,ze,j)}De>0&&(v.z=tt[v.ixfe>>8&63]),Jo(v,e,n.opts.Date1904),H(Oe.cell,v,e),o=Oe}break;case 7:case 519:if(o)o.val=Oe,v=iw(Oe,o.cell.ixfe,"s"),v.XF=ee[v.ixfe],e.cellFormula&&(v.f=""+vs(o.formula,r,o.cell,ze,j)),De>0&&(v.z=tt[v.ixfe>>8&63]),Jo(v,e,n.opts.Date1904),H(o.cell,v,e),o=null;else throw new Error("String record expects Formula");break;case 33:case 545:{_.push(Oe);var Zb=Nn(Oe[0].s);if(f=e.dense?(i[Oe[0].s.r]||[])[Oe[0].s.c]:i[Zb],e.cellFormula&&f){if(!o||!Zb||!f)break;f.f=""+vs(Oe[1],r,Oe[0],ze,j),f.F=Yn(Oe[0])}}break;case 1212:{if(!e.cellFormula)break;if(g){if(!o)break;y[Nn(o.cell)]=Oe[0],f=e.dense?(i[o.cell.r]||[])[o.cell.c]:i[Nn(o.cell)],(f||{}).f=""+vs(Oe[0],r,u,ze,j)}}break;case 253:v=iw(l[Oe.isst].t,Oe.ixfe,"s"),l[Oe.isst].h&&(v.h=l[Oe.isst].h),v.XF=ee[v.ixfe],De>0&&(v.z=tt[v.ixfe>>8&63]),Jo(v,e,n.opts.Date1904),H({c:Oe.c,r:Oe.r},v,e);break;case 513:e.sheetStubs&&(v={ixfe:Oe.ixfe,XF:ee[Oe.ixfe],t:"z"},De>0&&(v.z=tt[v.ixfe>>8&63]),Jo(v,e,n.opts.Date1904),H({c:Oe.c,r:Oe.r},v,e));break;case 190:if(e.sheetStubs)for(var rd=Oe.c;rd<=Oe.C;++rd){var Mr=Oe.ixfe[rd-Oe.c];v={ixfe:Mr,XF:ee[Mr],t:"z"},De>0&&(v.z=tt[v.ixfe>>8&63]),Jo(v,e,n.opts.Date1904),H({c:rd,r:Oe.r},v,e)}break;case 214:case 516:case 4:v=iw(Oe.val,Oe.ixfe,"s"),v.XF=ee[v.ixfe],De>0&&(v.z=tt[v.ixfe>>8&63]),Jo(v,e,n.opts.Date1904),H({c:Oe.c,r:Oe.r},v,e);break;case 0:case 512:ht===1&&(r=Oe);break;case 252:l=Oe;break;case 1054:if(j.biff==4){tt[De++]=Oe[1];for(var Yl=0;Yl<De+163&&Dn[Yl]!=Oe[1];++Yl);Yl>=163&&Go(Oe[1],De+163)}else Go(Oe[1],Oe[0]);break;case 30:{tt[De++]=Oe;for(var od=0;od<De+163&&Dn[od]!=Oe;++od);od>=163&&Go(Oe,De+163)}break;case 229:Te=Te.concat(Oe);break;case 93:Be[Oe.cmo[0]]=j.lastobj=Oe;break;case 438:j.lastobj.TxO=Oe;break;case 127:j.lastobj.ImData=Oe;break;case 440:for(b=Oe[0].s.r;b<=Oe[0].e.r;++b)for(m=Oe[0].s.c;m<=Oe[0].e.c;++m)f=e.dense?(i[b]||[])[m]:i[Nn({c:m,r:b})],f&&(f.l=Oe[1]);break;case 2048:for(b=Oe[0].s.r;b<=Oe[0].e.r;++b)for(m=Oe[0].s.c;m<=Oe[0].e.c;++m)f=e.dense?(i[b]||[])[m]:i[Nn({c:m,r:b})],f&&f.l&&(f.l.Tooltip=Oe[1]);break;case 28:{if(j.biff<=5&&j.biff>=2)break;f=e.dense?(i[Oe[0].r]||[])[Oe[0].c]:i[Nn(Oe[0])];var Jb=Be[Oe[2]];f||(e.dense?(i[Oe[0].r]||(i[Oe[0].r]=[]),f=i[Oe[0].r][Oe[0].c]={t:"z"}):f=i[Nn(Oe[0])]={t:"z"},r.e.r=Math.max(r.e.r,Oe[0].r),r.s.r=Math.min(r.s.r,Oe[0].r),r.e.c=Math.max(r.e.c,Oe[0].c),r.s.c=Math.min(r.s.c,Oe[0].c)),f.c||(f.c=[]),h={a:Oe[1],t:Jb.TxO.t},f.c.push(h)}break;case 2173:LO(ee[Oe.ixfe],Oe.ext);break;case 125:{if(!j.cellStyles)break;for(;Oe.e>=Oe.s;)Ie[Oe.e--]={width:Oe.w/256,level:Oe.level||0,hidden:!!(Oe.flags&1)},Je||(Je=!0,j1(Oe.w/256)),ru(Ie[Oe.e+1])}break;case 520:{var zs={};Oe.level!=null&&(Ce[Oe.r]=zs,zs.level=Oe.level),Oe.hidden&&(Ce[Oe.r]=zs,zs.hidden=!0),Oe.hpt&&(Ce[Oe.r]=zs,zs.hpt=Oe.hpt,zs.hpx=Qf(Oe.hpt))}break;case 38:case 39:case 40:case 41:i["!margins"]||ou(i["!margins"]={}),i["!margins"][{38:"left",39:"right",40:"top",41:"bottom"}[Vt]]=Oe;break;case 161:i["!margins"]||ou(i["!margins"]={}),i["!margins"].header=Oe.header,i["!margins"].footer=Oe.footer;break;case 574:Oe.RTL&&(k.Views[0].RTL=!0);break;case 146:Z=Oe;break;case 2198:re=Oe;break;case 140:U=Oe;break;case 442:c?w.CodeName=Oe||w.name:k.WBProps.CodeName=Oe||"ThisWorkbook";break}}else Ct||console.error("Missing Info for XLS Record 0x"+Vt.toString(16)),t.l+=At}return n.SheetNames=oi(s).sort(function(ul,ea){return Number(ul)-Number(ea)}).map(function(ul){return s[ul].name}),e.bookSheets||(n.Sheets=a),!n.SheetNames.length&&d["!ref"]?(n.SheetNames.push("Sheet1"),n.Sheets&&(n.Sheets.Sheet1=d)):n.Preamble=d,n.Sheets&&Ve.forEach(function(ul,ea){n.Sheets[n.SheetNames[ea]]["!autofilter"]=ul}),n.Strings=l,n.SSF=Ba(Dn),j.enc&&(n.Encryption=j.enc),re&&(n.Themes=re),n.Metadata={},U!==void 0&&(n.Metadata.Country=U),ze.names.length>0&&(k.Names=ze.names),n.Workbook=k,n}var Og={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function W7(t,e,n){var a=An.find(t,"/!DocumentSummaryInformation");if(a&&a.size>0)try{var i=uD(a,P1,Og.DSI);for(var s in i)e[s]=i[s]}catch(c){if(n.WTF)throw c}var r=An.find(t,"/!SummaryInformation");if(r&&r.size>0)try{var o=uD(r,N1,Og.SI);for(var l in o)e[l]==null&&(e[l]=o[l])}catch(c){if(n.WTF)throw c}e.HeadingPairs&&e.TitlesOfParts&&(Q3(e.HeadingPairs,e.TitlesOfParts,e,n),delete e.HeadingPairs,delete e.TitlesOfParts)}function V7(t,e){var n=[],a=[],i=[],s=0,r,o=n3(P1,"n"),l=n3(N1,"n");if(t.Props)for(r=oi(t.Props),s=0;s<r.length;++s)(Object.prototype.hasOwnProperty.call(o,r[s])?n:Object.prototype.hasOwnProperty.call(l,r[s])?a:i).push([r[s],t.Props[r[s]]]);if(t.Custprops)for(r=oi(t.Custprops),s=0;s<r.length;++s)Object.prototype.hasOwnProperty.call(t.Props||{},r[s])||(Object.prototype.hasOwnProperty.call(o,r[s])?n:Object.prototype.hasOwnProperty.call(l,r[s])?a:i).push([r[s],t.Custprops[r[s]]]);var c=[];for(s=0;s<i.length;++s)cD.indexOf(i[s][0])>-1||J3.indexOf(i[s][0])>-1||i[s][1]!=null&&c.push(i[s]);a.length&&An.utils.cfb_add(e,"/SummaryInformation",fD(a,Og.SI,l,N1)),(n.length||c.length)&&An.utils.cfb_add(e,"/DocumentSummaryInformation",fD(n,Og.DSI,o,P1,c.length?c:null,Og.UDI))}function AC(t,e){e||(e={}),pE(e),C_(),e.codepage&&D_(e.codepage);var n,a;if(t.FullPaths){if(An.find(t,"/encryption"))throw new Error("File is password-protected");n=An.find(t,"!CompObj"),a=An.find(t,"/Workbook")||An.find(t,"/Book")}else{switch(e.type){case"base64":t=Er(xr(t));break;case"binary":t=Er(t);break;case"buffer":break;case"array":Array.isArray(t)||(t=Array.prototype.slice.call(t));break}as(t,0),a={content:t}}var i,s;if(n&&R7(n),e.bookProps&&!e.bookSheets)i={};else{var r=Jn?"buffer":"array";if(a&&a.content)i=q7(a.content,e);else if((s=An.find(t,"PerfectOffice_MAIN"))&&s.content)i=su.to_workbook(s.content,(e.type=r,e));else if((s=An.find(t,"NativeContent_MAIN"))&&s.content)i=su.to_workbook(s.content,(e.type=r,e));else throw(s=An.find(t,"MN0"))&&s.content?new Error("Unsupported Works 4 for Mac file"):new Error("Cannot find Workbook stream");e.bookVBA&&t.FullPaths&&An.find(t,"/_VBA_PROJECT_CUR/VBA/dir")&&(i.vbaraw=iR(t))}var o={};return t.FullPaths&&W7(t,o,e),i.Props=i.Custprops=o,e.bookFiles&&(i.cfb=t),i}function z7(t,e){var n=e||{},a=An.utils.cfb_new({root:"R"}),i="/Workbook";switch(n.bookType||"xls"){case"xls":n.bookType="biff8";case"xla":n.bookType||(n.bookType="xla");case"biff8":i="/Workbook",n.biff=8;break;case"biff5":i="/Book",n.biff=5;break;default:throw new Error("invalid type "+n.bookType+" for XLS CFB")}return An.utils.cfb_add(a,i,TC(t,n)),n.biff==8&&(t.Props||t.Custprops)&&V7(t,a),n.biff==8&&t.vbaraw&&sR(a,An.read(t.vbaraw,{type:typeof t.vbaraw=="string"?"binary":"buffer"})),a}var Rg={0:{f:hH},1:{f:xH},2:{f:HH},3:{f:LH},4:{f:AH},5:{f:OH},6:{f:YH},7:{f:PH},8:{f:QH},9:{f:JH},10:{f:XH},11:{f:ZH},12:{f:kH},13:{f:WH},14:{f:MH},15:{f:DH},16:{f:gC},17:{f:jH},18:{f:BH},19:{f:T1},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:K9},40:{},42:{},43:{f:j$},44:{f:Y$},45:{f:Z$},46:{f:Q$},47:{f:J$},48:{},49:{f:w8},50:{},51:{f:FO},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:MD},62:{f:zH},63:{f:qO},64:{f:g9},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:ms,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:u9},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:wH},148:{f:bH,p:16},151:{f:s9},152:{},153:{f:Y9},154:{},155:{},156:{f:V9},157:{},158:{},159:{T:1,f:c$},160:{T:-1},161:{T:1,f:Jd},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:e9},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:IO},336:{T:-1},337:{f:BO,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:L1},357:{},358:{},359:{},360:{T:1},361:{},362:{f:LD},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:r9},427:{f:o9},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:c9},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:_H},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:a9},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:L1},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:QO},633:{T:1},634:{T:-1},635:{T:1,f:ZO},636:{T:-1},637:{f:E8},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:F9},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:m9},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}},oE={6:{f:eE},10:{f:wc},12:{f:Li},13:{f:Li},14:{f:gi},15:{f:gi},16:{f:ys},17:{f:gi},18:{f:gi},19:{f:Li},20:{f:TD},21:{f:TD},23:{f:LD},24:{f:CD},25:{f:gi},26:{},27:{},28:{f:yB},29:{},34:{f:gi},35:{f:DD},38:{f:ys},39:{f:ys},40:{f:ys},41:{f:ys},42:{f:gi},43:{f:gi},47:{f:L$},49:{f:zN},51:{f:Li},60:{},61:{f:UN},64:{f:gi},65:{f:VN},66:{f:Li},77:{},80:{},81:{},82:{},85:{f:Li},89:{},90:{},91:{},92:{f:CN},93:{f:vB},94:{},95:{f:gi},96:{},97:{},99:{f:gi},125:{f:MD},128:{f:rB},129:{f:IN},130:{f:Li},131:{f:gi},132:{f:gi},133:{f:MN},134:{},140:{f:CB},141:{f:Li},144:{},146:{f:MB},151:{},152:{},153:{},154:{},155:{},156:{f:Li},157:{},158:{},160:{f:RB},161:{f:NB},174:{},175:{},176:{},177:{},178:{},180:{},181:{},182:{},184:{},185:{},189:{f:nB},190:{f:aB},193:{f:wc},197:{},198:{},199:{},200:{},201:{},202:{f:gi},203:{},204:{},205:{},206:{},207:{},208:{},209:{},210:{},211:{},213:{},215:{},216:{},217:{},218:{f:Li},220:{},221:{f:gi},222:{},224:{f:sB},225:{f:DN},226:{f:wc},227:{},229:{f:_B},233:{},235:{},236:{},237:{},239:{},240:{},241:{},242:{},244:{},245:{},246:{},247:{},248:{},249:{},251:{},252:{f:PN},253:{f:GN},255:{f:BN},256:{},259:{},290:{},311:{},312:{},315:{},317:{f:pD},318:{},319:{},320:{},330:{},331:{},333:{},334:{},335:{},336:{},337:{},338:{},339:{},340:{},351:{},352:{f:gi},353:{f:wc},401:{},402:{},403:{},404:{},405:{},406:{},407:{},408:{},425:{},426:{},427:{},428:{},429:{},430:{f:uB},431:{f:gi},432:{},433:{},434:{},437:{},438:{f:kB},439:{f:gi},440:{f:SB},441:{},442:{f:Ag},443:{},444:{f:Li},445:{},446:{},448:{f:wc},449:{f:RN,r:2},450:{f:wc},512:{f:kD},513:{f:OB},515:{f:cB},516:{f:KN},517:{f:AD},519:{f:UB},520:{f:$N},523:{},545:{f:ID},549:{f:ED},566:{},574:{f:qN},638:{f:tB},659:{},1048:{},1054:{f:ZN},1084:{},1212:{f:gB},2048:{f:TB},2049:{},2050:{},2051:{},2052:{},2053:{},2054:{},2055:{},2056:{},2057:{f:X_},2058:{},2059:{},2060:{},2061:{},2062:{},2063:{},2064:{},2066:{},2067:{},2128:{},2129:{},2130:{},2131:{},2132:{},2133:{},2134:{},2135:{},2136:{},2137:{},2138:{},2146:{},2147:{r:12},2148:{},2149:{},2150:{},2151:{f:wc},2152:{},2154:{},2155:{},2156:{},2161:{},2162:{},2164:{},2165:{},2166:{},2167:{},2168:{},2169:{},2170:{},2171:{},2172:{f:FB,r:12},2173:{f:CO,r:12},2174:{},2175:{},2180:{},2181:{},2182:{},2183:{},2184:{},2185:{},2186:{},2187:{},2188:{f:gi,r:12},2189:{},2190:{r:12},2191:{},2192:{},2194:{},2195:{},2196:{f:hB,r:12},2197:{},2198:{f:EO,r:12},2199:{},2200:{},2201:{},2202:{f:mB,r:12},2203:{f:wc},2204:{},2205:{},2206:{},2207:{},2211:{f:ON},2212:{},2213:{},2214:{},2215:{},4097:{},4098:{},4099:{},4102:{},4103:{},4105:{},4106:{},4107:{},4108:{},4109:{},4116:{},4117:{},4118:{},4119:{},4120:{},4121:{},4122:{},4123:{},4124:{},4125:{},4126:{},4127:{},4128:{},4129:{},4130:{},4132:{},4133:{},4134:{f:Li},4135:{},4146:{},4147:{},4148:{},4149:{},4154:{},4156:{},4157:{},4158:{},4159:{},4160:{},4161:{},4163:{},4164:{f:BB},4165:{},4166:{},4168:{},4170:{},4171:{},4174:{},4175:{},4176:{},4177:{},4187:{},4188:{f:IB},4189:{},4191:{},4192:{},4193:{},4194:{},4195:{},4196:{},4197:{},4198:{},4199:{},4200:{},0:{f:kD},1:{},2:{f:zB},3:{f:WB},4:{f:qB},5:{f:AD},7:{f:GB},8:{},9:{f:X_},11:{},22:{f:Li},30:{f:QN},31:{},32:{},33:{f:ID},36:{},37:{f:ED},50:{f:jB},62:{},52:{},67:{},68:{f:Li},69:{},86:{},126:{},127:{f:HB},135:{},136:{},137:{},145:{},148:{},149:{},150:{},169:{},171:{},188:{},191:{},192:{},194:{},195:{},214:{f:KB},223:{},234:{},354:{},421:{},518:{f:eE},521:{f:X_},536:{f:CD},547:{f:DD},561:{},579:{},1030:{f:eE},1033:{f:X_},1091:{},2157:{},2163:{},2177:{},2240:{},2241:{},2242:{},2243:{},2244:{},2245:{},2246:{},2247:{},2248:{},2249:{},2250:{},2251:{},2262:{r:12},29282:{}};function an(t,e,n,a){var i=e;if(!isNaN(i)){var s=a||(n||[]).length||0,r=t.next(4);r.write_shift(2,i),r.write_shift(2,s),s>0&&E1(n)&&t.push(n)}}function Y7(t,e,n,a){var i=a||(n||[]).length||0;if(i<=8224)return an(t,e,n,i);var s=e;if(!isNaN(s)){for(var r=n.parts||[],o=0,l=0,c=0;c+(r[o]||8224)<=8224;)c+=r[o]||8224,o++;var d=t.next(4);for(d.write_shift(2,s),d.write_shift(2,c),t.push(n.slice(l,l+c)),l+=c;l<i;){for(d=t.next(4),d.write_shift(2,60),c=0;c+(r[o]||8224)<=8224;)c+=r[o]||8224,o++;d.write_shift(2,c),t.push(n.slice(l,l+c)),l+=c}}}function Ug(t,e,n){return t||(t=Dt(7)),t.write_shift(2,e),t.write_shift(2,n),t.write_shift(2,0),t.write_shift(1,0),t}function G7(t,e,n,a){var i=Dt(9);return Ug(i,t,e),hD(n,a||"b",i),i}function j7(t,e,n){var a=Dt(8+2*n.length);return Ug(a,t,e),a.write_shift(1,n.length),a.write_shift(n.length,n,"sbcs"),a.l<a.length?a.slice(0,a.l):a}function K7(t,e,n,a){if(e.v!=null)switch(e.t){case"d":case"n":var i=e.t=="d"?Ri(ei(e.v)):e.v;i==(i|0)&&i>=0&&i<65536?an(t,2,YB(n,a,i)):an(t,3,VB(n,a,i));return;case"b":case"e":an(t,5,G7(n,a,e.v,e.t));return;case"s":case"str":an(t,4,j7(n,a,(e.v||"").slice(0,255)));return}an(t,1,Ug(null,n,a))}function X7(t,e,n,a){var i=Array.isArray(e),s=oa(e["!ref"]||"A1"),r,o="",l=[];if(s.e.c>255||s.e.r>16383){if(a.WTF)throw new Error("Range "+(e["!ref"]||"A1")+" exceeds format limit A1:IV16384");s.e.c=Math.min(s.e.c,255),s.e.r=Math.min(s.e.c,16383),r=Yn(s)}for(var c=s.s.r;c<=s.e.r;++c){o=ci(c);for(var d=s.s.c;d<=s.e.c;++d){c===s.s.r&&(l[d]=Ga(d)),r=l[d]+o;var u=i?(e[c]||[])[d]:e[r];u&&K7(t,u,c,d,a)}}}function Z7(t,e){var n=e||{};ri!=null&&n.dense==null&&(n.dense=ri);for(var a=Us(),i=0,s=0;s<t.SheetNames.length;++s)t.SheetNames[s]==n.sheet&&(i=s);if(i==0&&n.sheet&&t.SheetNames[0]!=n.sheet)throw new Error("Sheet not found: "+n.sheet);return an(a,n.biff==4?1033:n.biff==3?521:9,W1(t,16,n)),X7(a,t.Sheets[t.SheetNames[i]],i,n,t),an(a,10),a.end()}function J7(t,e,n){an(t,49,YN({sz:12,color:{theme:1},name:"Arial",family:2,scheme:"minor"},n))}function Q7(t,e,n){e&&[[5,8],[23,26],[41,44],[50,392]].forEach(function(a){for(var i=a[0];i<=a[1];++i)e[i]!=null&&an(t,1054,JN(i,e[i],n))})}function eq(t,e){var n=Dt(19);n.write_shift(4,2151),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(2,3),n.write_shift(1,1),n.write_shift(4,0),an(t,2151,n),n=Dt(39),n.write_shift(4,2152),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(2,3),n.write_shift(1,0),n.write_shift(4,0),n.write_shift(2,1),n.write_shift(4,4),n.write_shift(2,0),wD(oa(e["!ref"]||"A1"),n),n.write_shift(4,4),an(t,2152,n)}function tq(t,e){for(var n=0;n<16;++n)an(t,224,SD({numFmtId:0,style:!0},0,e));e.cellXfs.forEach(function(a){an(t,224,SD(a,0,e))})}function nq(t,e){for(var n=0;n<e["!links"].length;++n){var a=e["!links"][n];an(t,440,AB(a)),a[1].Tooltip&&an(t,2048,DB(a))}delete e["!links"]}function aq(t,e){if(e){var n=0;e.forEach(function(a,i){++n<=256&&a&&an(t,125,PB(aw(i,a),i))})}}function iq(t,e,n,a,i){var s=16+xc(i.cellXfs,e,i);if(e.v==null&&!e.bf){an(t,513,iu(n,a,s));return}if(e.bf)an(t,6,IU(e,n,a,i,s));else switch(e.t){case"d":case"n":var r=e.t=="d"?Ri(ei(e.v)):e.v;an(t,515,dB(n,a,r,s,i));break;case"b":case"e":an(t,517,lB(n,a,e.v,s,i,e.t));break;case"s":case"str":if(i.bookSST){var o=nE(i.Strings,e.v,i.revStrings);an(t,253,jN(n,a,o,s,i))}else an(t,516,XN(n,a,(e.v||"").slice(0,255),s,i));break;default:an(t,513,iu(n,a,s))}}function sq(t,e,n){var a=Us(),i=n.SheetNames[t],s=n.Sheets[i]||{},r=(n||{}).Workbook||{},o=(r.Sheets||[])[t]||{},l=Array.isArray(s),c=e.biff==8,d,u="",g=[],f=oa(s["!ref"]||"A1"),h=c?65536:16384;if(f.e.c>255||f.e.r>=h){if(e.WTF)throw new Error("Range "+(s["!ref"]||"A1")+" exceeds format limit A1:IV16384");f.e.c=Math.min(f.e.c,255),f.e.r=Math.min(f.e.c,h-1)}an(a,2057,W1(n,16,e)),an(a,13,Wr(1)),an(a,12,Wr(100)),an(a,15,Hs(!0)),an(a,17,Hs(!1)),an(a,16,Qd(.001)),an(a,95,Hs(!0)),an(a,42,Hs(!1)),an(a,43,Hs(!1)),an(a,130,Wr(1)),an(a,128,oB([0,0])),an(a,131,Hs(!1)),an(a,132,Hs(!1)),c&&aq(a,s["!cols"]),an(a,512,eB(f,e)),c&&(s["!links"]=[]);for(var m=f.s.r;m<=f.e.r;++m){u=ci(m);for(var b=f.s.c;b<=f.e.c;++b){m===f.s.r&&(g[b]=Ga(b)),d=g[b]+u;var y=l?(s[m]||[])[b]:s[d];y&&(iq(a,y,m,b,e),c&&y.l&&s["!links"].push([d,y.l]))}}var _=o.CodeName||o.name||i;return c&&an(a,574,WN((r.Views||[])[0])),c&&(s["!merges"]||[]).length&&an(a,229,wB(s["!merges"])),c&&nq(a,s),an(a,442,gD(_,e)),c&&eq(a,s),an(a,10),a.end()}function rq(t,e,n){var a=Us(),i=(t||{}).Workbook||{},s=i.Sheets||[],r=i.WBProps||{},o=n.biff==8,l=n.biff==5;if(an(a,2057,W1(t,5,n)),n.bookType=="xla"&&an(a,135),an(a,225,o?Wr(1200):null),an(a,193,lN(2)),l&&an(a,191),l&&an(a,192),an(a,226),an(a,92,LN("SheetJS",n)),an(a,66,Wr(o?1200:1252)),o&&an(a,353,Wr(0)),o&&an(a,448),an(a,317,$B(t.SheetNames.length)),o&&t.vbaraw&&an(a,211),o&&t.vbaraw){var c=r.CodeName||"ThisWorkbook";an(a,442,gD(c,n))}an(a,156,Wr(17)),an(a,25,Hs(!1)),an(a,18,Hs(!1)),an(a,19,Wr(0)),o&&an(a,431,Hs(!1)),o&&an(a,444,Wr(0)),an(a,61,HN(n)),an(a,64,Hs(!1)),an(a,141,Wr(0)),an(a,34,Hs(R9(t)=="true")),an(a,14,Hs(!0)),o&&an(a,439,Hs(!1)),an(a,218,Wr(0)),J7(a,t,n),Q7(a,t.SSF,n),tq(a,n),o&&an(a,352,Hs(!1));var d=a.end(),u=Us();o&&an(u,140,LB()),o&&n.Strings&&Y7(u,252,NN(n.Strings,n)),an(u,10);var g=u.end(),f=Us(),h=0,m=0;for(m=0;m<t.SheetNames.length;++m)h+=(o?12:11)+(o?2:1)*t.SheetNames[m].length;var b=d.length+h+g.length;for(m=0;m<t.SheetNames.length;++m){var y=s[m]||{};an(f,133,FN({pos:b,hs:y.Hidden||0,dt:0,name:t.SheetNames[m]},n)),b+=e[m].length}var _=f.end();if(h!=_.length)throw new Error("BS8 "+h+" != "+_.length);var v=[];return d.length&&v.push(d),_.length&&v.push(_),g.length&&v.push(g),Yi(v)}function oq(t,e){var n=e||{},a=[];t&&!t.SSF&&(t.SSF=Ba(Dn)),t&&t.SSF&&(Yf(),gg(t.SSF),n.revssf=N_(t.SSF),n.revssf[t.SSF[65535]]=0,n.ssf=t.SSF),n.Strings=[],n.Strings.Count=0,n.Strings.Unique=0,hE(n),n.cellXfs=[],xc(n.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={});for(var i=0;i<t.SheetNames.length;++i)a[a.length]=sq(i,n,t);return a.unshift(rq(t,a,n)),Yi(a)}function TC(t,e){for(var n=0;n<=t.SheetNames.length;++n){var a=t.Sheets[t.SheetNames[n]];if(!(!a||!a["!ref"])){var i=Tr(a["!ref"]);i.e.c>255&&typeof console!="undefined"&&console.error&&console.error("Worksheet '"+t.SheetNames[n]+"' extends beyond column IV (255).  Data may be lost.")}}var s=e||{};switch(s.biff||2){case 8:case 5:return oq(t,e);case 4:case 3:case 2:return Z7(t,e)}throw new Error("invalid type "+s.bookType+" for BIFF")}function DC(t,e){var n=e||{};ri!=null&&n.dense==null&&(n.dense=ri);var a=n.dense?[]:{};t=t.replace(/<!--.*?-->/g,"");var i=t.match(/<table/i);if(!i)throw new Error("Invalid HTML: could not find <table>");var s=t.match(/<\/table/i),r=i.index,o=s&&s.index||t.length,l=j6(t.slice(r,o),/(:?<tr[^>]*>)/i,"<tr>"),c=-1,d=0,u=0,g=0,f={s:{r:1e7,c:1e7},e:{r:0,c:0}},h=[];for(r=0;r<l.length;++r){var m=l[r].trim(),b=m.slice(0,3).toLowerCase();if(b=="<tr"){if(++c,n.sheetRows&&n.sheetRows<=c){--c;break}d=0;continue}if(!(b!="<td"&&b!="<th")){var y=m.split(/<\/t[dh]>/i);for(o=0;o<y.length;++o){var _=y[o].trim();if(_.match(/<t[dh]/i)){for(var v=_,U=0;v.charAt(0)=="<"&&(U=v.indexOf(">"))>-1;)v=v.slice(U+1);for(var ee=0;ee<h.length;++ee){var Z=h[ee];Z.s.c==d&&Z.s.r<c&&c<=Z.e.r&&(d=Z.e.c+1,ee=-1)}var k=Pn(_.slice(0,_.indexOf(">")));g=k.colspan?+k.colspan:1,((u=+k.rowspan)>1||g>1)&&h.push({s:{r:c,c:d},e:{r:c+(u||1)-1,c:d+g-1}});var w=k.t||k["data-t"]||"";if(!v.length){d+=g;continue}if(v=_3(v),f.s.r>c&&(f.s.r=c),f.e.r<c&&(f.e.r=c),f.s.c>d&&(f.s.c=d),f.e.c<d&&(f.e.c=d),!v.length){d+=g;continue}var S={t:"s",v};n.raw||!v.trim().length||w=="s"||(v==="TRUE"?S={t:"b",v:!0}:v==="FALSE"?S={t:"b",v:!1}:isNaN(vo(v))?isNaN(Gf(v).getDate())||(S={t:"d",v:ei(v)},n.cellDates||(S={t:"n",v:Ri(S.v)}),S.z=n.dateNF||Dn[14]):S={t:"n",v:vo(v)}),n.dense?(a[c]||(a[c]=[]),a[c][d]=S):a[Nn({r:c,c:d})]=S,d+=g}}}}return a["!ref"]=Yn(f),h.length&&(a["!merges"]=h),a}function CC(t,e,n,a){for(var i=t["!merges"]||[],s=[],r=e.s.c;r<=e.e.c;++r){for(var o=0,l=0,c=0;c<i.length;++c)if(!(i[c].s.r>n||i[c].s.c>r)&&!(i[c].e.r<n||i[c].e.c<r)){if(i[c].s.r<n||i[c].s.c<r){o=-1;break}o=i[c].e.r-i[c].s.r+1,l=i[c].e.c-i[c].s.c+1;break}if(!(o<0)){var d=Nn({r:n,c:r}),u=a.dense?(t[n]||[])[r]:t[d],g=u&&u.v!=null&&(u.h||h1(u.w||(Xo(u),u.w)||""))||"",f={};o>1&&(f.rowspan=o),l>1&&(f.colspan=l),a.editable?g='<span contenteditable="true">'+g+"</span>":u&&(f["data-t"]=u&&u.t||"z",u.v!=null&&(f["data-v"]=u.v),u.z!=null&&(f["data-z"]=u.z),u.l&&(u.l.Target||"#").charAt(0)!="#"&&(g='<a href="'+u.l.Target+'">'+g+"</a>")),f.id=(a.id||"sjs")+"-"+d,s.push(nn("td",g,f))}}var h="<tr>";return h+s.join("")+"</tr>"}var LC='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',IC="</body></html>";function lq(t,e){var n=t.match(/<table[\s\S]*?>[\s\S]*?<\/table>/gi);if(!n||n.length==0)throw new Error("Invalid HTML: could not find <table>");if(n.length==1)return _c(DC(n[0],e),e);var a=wE();return n.forEach(function(i,s){vE(a,DC(i,e),"Sheet"+(s+1))}),a}function MC(t,e,n){var a=[];return a.join("")+"<table"+(n&&n.id?' id="'+n.id+'"':"")+">"}function FC(t,e){var n=e||{},a=n.header!=null?n.header:LC,i=n.footer!=null?n.footer:IC,s=[a],r=Tr(t["!ref"]);n.dense=Array.isArray(t),s.push(MC(t,r,n));for(var o=r.s.r;o<=r.e.r;++o)s.push(CC(t,r,o,n));return s.push("</table>"+i),s.join("")}function PC(t,e,n){var a=n||{};ri!=null&&(a.dense=ri);var i=0,s=0;if(a.origin!=null)if(typeof a.origin=="number")i=a.origin;else{var r=typeof a.origin=="string"?ti(a.origin):a.origin;i=r.r,s=r.c}var o=e.getElementsByTagName("tr"),l=Math.min(a.sheetRows||1e7,o.length),c={s:{r:0,c:0},e:{r:i,c:s}};if(t["!ref"]){var d=Tr(t["!ref"]);c.s.r=Math.min(c.s.r,d.s.r),c.s.c=Math.min(c.s.c,d.s.c),c.e.r=Math.max(c.e.r,d.e.r),c.e.c=Math.max(c.e.c,d.e.c),i==-1&&(c.e.r=i=d.e.r+1)}var u=[],g=0,f=t["!rows"]||(t["!rows"]=[]),h=0,m=0,b=0,y=0,_=0,v=0;for(t["!cols"]||(t["!cols"]=[]);h<o.length&&m<l;++h){var U=o[h];if(BC(U)){if(a.display)continue;f[m]={hidden:!0}}var ee=U.children;for(b=y=0;b<ee.length;++b){var Z=ee[b];if(!(a.display&&BC(Z))){var k=Z.hasAttribute("data-v")?Z.getAttribute("data-v"):Z.hasAttribute("v")?Z.getAttribute("v"):_3(Z.innerHTML),w=Z.getAttribute("data-z")||Z.getAttribute("z");for(g=0;g<u.length;++g){var S=u[g];S.s.c==y+s&&S.s.r<m+i&&m+i<=S.e.r&&(y=S.e.c+1-s,g=-1)}v=+Z.getAttribute("colspan")||1,((_=+Z.getAttribute("rowspan")||1)>1||v>1)&&u.push({s:{r:m+i,c:y+s},e:{r:m+i+(_||1)-1,c:y+s+(v||1)-1}});var B={t:"s",v:k},H=Z.getAttribute("data-t")||Z.getAttribute("t")||"";k!=null&&(k.length==0?B.t=H||"z":a.raw||k.trim().length==0||H=="s"||(k==="TRUE"?B={t:"b",v:!0}:k==="FALSE"?B={t:"b",v:!1}:isNaN(vo(k))?isNaN(Gf(k).getDate())||(B={t:"d",v:ei(k)},a.cellDates||(B={t:"n",v:Ri(B.v)}),B.z=a.dateNF||Dn[14]):B={t:"n",v:vo(k)})),B.z===void 0&&w!=null&&(B.z=w);var j="",re=Z.getElementsByTagName("A");if(re&&re.length)for(var Te=0;Te<re.length&&!(re[Te].hasAttribute("href")&&(j=re[Te].getAttribute("href"),j.charAt(0)!="#"));++Te);j&&j.charAt(0)!="#"&&(B.l={Target:j}),a.dense?(t[m+i]||(t[m+i]=[]),t[m+i][y+s]=B):t[Nn({c:y+s,r:m+i})]=B,c.e.c<y+s&&(c.e.c=y+s),y+=v}}++m}return u.length&&(t["!merges"]=(t["!merges"]||[]).concat(u)),c.e.r=Math.max(c.e.r,m-1+i),t["!ref"]=Yn(c),m>=l&&(t["!fullref"]=Yn((c.e.r=o.length-h+m-1+i,c))),t}function NC(t,e){var n=e||{},a=n.dense?[]:{};return PC(a,t,e)}function cq(t,e){return _c(NC(t,e),e)}function BC(t){var e="",n=dq(t);return n&&(e=n(t).getPropertyValue("display")),e||(e=t.style&&t.style.display),e==="none"}function dq(t){return t.ownerDocument.defaultView&&typeof t.ownerDocument.defaultView.getComputedStyle=="function"?t.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}function uq(t){var e=t.replace(/[\t\r\n]/g," ").trim().replace(/ +/g," ").replace(/<text:s\/>/g," ").replace(/<text:s text:c="(\d+)"\/>/g,function(a,i){return Array(parseInt(i,10)+1).join(" ")}).replace(/<text:tab[^>]*\/>/g,"	").replace(/<text:line-break\/>/g,`
`),n=ga(e.replace(/<[^>]*>/g,""));return[n]}var $C={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"],era:["e","ee"],quarter:["\\Qm",'m\\"th quarter"']};function OC(t,e){var n=e||{};ri!=null&&n.dense==null&&(n.dense=ri);var a=b1(t),i=[],s,r,o={name:""},l="",c=0,d,u,g={},f=[],h=n.dense?[]:{},m,b,y={value:""},_="",v=0,U,ee=[],Z=-1,k=-1,w={s:{r:1e6,c:1e7},e:{r:0,c:0}},S=0,B={},H=[],j={},re=0,Te=0,Be=[],Ie=1,Ce=1,Je=[],ze={Names:[]},Ze={},ht=["",""],De=[],tt={},Ve="",He=0,bt=!1,Kt=!1,Vt=0;for(_g.lastIndex=0,a=a.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");m=_g.exec(a);)switch(m[3]=m[3].replace(/_.*$/,"")){case"table":case"\u5DE5\u4F5C\u8868":m[1]==="/"?(w.e.c>=w.s.c&&w.e.r>=w.s.r?h["!ref"]=Yn(w):h["!ref"]="A1:A1",n.sheetRows>0&&n.sheetRows<=w.e.r&&(h["!fullref"]=h["!ref"],w.e.r=n.sheetRows-1,h["!ref"]=Yn(w)),H.length&&(h["!merges"]=H),Be.length&&(h["!rows"]=Be),d.name=d.\u540D\u79F0||d.name,typeof JSON!="undefined"&&JSON.stringify(d),f.push(d.name),g[d.name]=h,Kt=!1):m[0].charAt(m[0].length-2)!=="/"&&(d=Pn(m[0],!1),Z=k=-1,w.s.r=w.s.c=1e7,w.e.r=w.e.c=0,h=n.dense?[]:{},H=[],Be=[],Kt=!0);break;case"table-row-group":m[1]==="/"?--S:++S;break;case"table-row":case"\u884C":if(m[1]==="/"){Z+=Ie,Ie=1;break}if(u=Pn(m[0],!1),u.\u884C\u53F7?Z=u.\u884C\u53F7-1:Z==-1&&(Z=0),Ie=+u["number-rows-repeated"]||1,Ie<10)for(Vt=0;Vt<Ie;++Vt)S>0&&(Be[Z+Vt]={level:S});k=-1;break;case"covered-table-cell":m[1]!=="/"&&++k,n.sheetStubs&&(n.dense?(h[Z]||(h[Z]=[]),h[Z][k]={t:"z"}):h[Nn({r:Z,c:k})]={t:"z"}),_="",ee=[];break;case"table-cell":case"\u6570\u636E":if(m[0].charAt(m[0].length-2)==="/")++k,y=Pn(m[0],!1),Ce=parseInt(y["number-columns-repeated"]||"1",10),b={t:"z",v:null},y.formula&&n.cellFormula!=!1&&(b.f=uC(ga(y.formula))),(y.\u6570\u636E\u7C7B\u578B||y["value-type"])=="string"&&(b.t="s",b.v=ga(y["string-value"]||""),n.dense?(h[Z]||(h[Z]=[]),h[Z][k]=b):h[Nn({r:Z,c:k})]=b),k+=Ce-1;else if(m[1]!=="/"){++k,_="",v=0,ee=[],Ce=1;var At=Ie?Z+Ie-1:Z;if(k>w.e.c&&(w.e.c=k),k<w.s.c&&(w.s.c=k),Z<w.s.r&&(w.s.r=Z),At>w.e.r&&(w.e.r=At),y=Pn(m[0],!1),De=[],tt={},b={t:y.\u6570\u636E\u7C7B\u578B||y["value-type"],v:null},n.cellFormula)if(y.formula&&(y.formula=ga(y.formula)),y["number-matrix-columns-spanned"]&&y["number-matrix-rows-spanned"]&&(re=parseInt(y["number-matrix-rows-spanned"],10)||0,Te=parseInt(y["number-matrix-columns-spanned"],10)||0,j={s:{r:Z,c:k},e:{r:Z+re-1,c:k+Te-1}},b.F=Yn(j),Je.push([j,b.F])),y.formula)b.f=uC(y.formula);else for(Vt=0;Vt<Je.length;++Vt)Z>=Je[Vt][0].s.r&&Z<=Je[Vt][0].e.r&&k>=Je[Vt][0].s.c&&k<=Je[Vt][0].e.c&&(b.F=Je[Vt][1]);switch((y["number-columns-spanned"]||y["number-rows-spanned"])&&(re=parseInt(y["number-rows-spanned"],10)||0,Te=parseInt(y["number-columns-spanned"],10)||0,j={s:{r:Z,c:k},e:{r:Z+re-1,c:k+Te-1}},H.push(j)),y["number-columns-repeated"]&&(Ce=parseInt(y["number-columns-repeated"],10)),b.t){case"boolean":b.t="b",b.v=Ya(y["boolean-value"]);break;case"float":b.t="n",b.v=parseFloat(y.value);break;case"percentage":b.t="n",b.v=parseFloat(y.value);break;case"currency":b.t="n",b.v=parseFloat(y.value);break;case"date":b.t="d",b.v=ei(y["date-value"]),n.cellDates||(b.t="n",b.v=Ri(b.v)),b.z="m/d/yy";break;case"time":b.t="n",b.v=z6(y["time-value"])/86400,n.cellDates&&(b.t="d",b.v=$_(b.v)),b.z="HH:MM:SS";break;case"number":b.t="n",b.v=parseFloat(y.\u6570\u636E\u6570\u503C);break;default:if(b.t==="string"||b.t==="text"||!b.t)b.t="s",y["string-value"]!=null&&(_=ga(y["string-value"]),ee=[]);else throw new Error("Unsupported value type "+b.t)}}else{if(bt=!1,b.t==="s"&&(b.v=_||"",ee.length&&(b.R=ee),bt=v==0),Ze.Target&&(b.l=Ze),De.length>0&&(b.c=De,De=[]),_&&n.cellText!==!1&&(b.w=_),bt&&(b.t="z",delete b.v),(!bt||n.sheetStubs)&&!(n.sheetRows&&n.sheetRows<=Z))for(var Ct=0;Ct<Ie;++Ct){if(Ce=parseInt(y["number-columns-repeated"]||"1",10),n.dense)for(h[Z+Ct]||(h[Z+Ct]=[]),h[Z+Ct][k]=Ct==0?b:Ba(b);--Ce>0;)h[Z+Ct][k+Ce]=Ba(b);else for(h[Nn({r:Z+Ct,c:k})]=b;--Ce>0;)h[Nn({r:Z+Ct,c:k+Ce})]=Ba(b);w.e.c<=k&&(w.e.c=k)}Ce=parseInt(y["number-columns-repeated"]||"1",10),k+=Ce-1,Ce=0,b={},_="",ee=[]}Ze={};break;case"document":case"document-content":case"\u7535\u5B50\u8868\u683C\u6587\u6863":case"spreadsheet":case"\u4E3B\u4F53":case"scripts":case"styles":case"font-face-decls":case"master-styles":if(m[1]==="/"){if((s=i.pop())[0]!==m[3])throw"Bad state: "+s}else m[0].charAt(m[0].length-2)!=="/"&&i.push([m[3],!0]);break;case"annotation":if(m[1]==="/"){if((s=i.pop())[0]!==m[3])throw"Bad state: "+s;tt.t=_,ee.length&&(tt.R=ee),tt.a=Ve,De.push(tt)}else m[0].charAt(m[0].length-2)!=="/"&&i.push([m[3],!1]);Ve="",He=0,_="",v=0,ee=[];break;case"creator":m[1]==="/"?Ve=a.slice(He,m.index):He=m.index+m[0].length;break;case"meta":case"\u5143\u6570\u636E":case"settings":case"config-item-set":case"config-item-map-indexed":case"config-item-map-entry":case"config-item-map-named":case"shapes":case"frame":case"text-box":case"image":case"data-pilot-tables":case"list-style":case"form":case"dde-links":case"event-listeners":case"chart":if(m[1]==="/"){if((s=i.pop())[0]!==m[3])throw"Bad state: "+s}else m[0].charAt(m[0].length-2)!=="/"&&i.push([m[3],!1]);_="",v=0,ee=[];break;case"scientific-number":break;case"currency-symbol":break;case"currency-style":break;case"number-style":case"percentage-style":case"date-style":case"time-style":if(m[1]==="/"){if(B[o.name]=l,(s=i.pop())[0]!==m[3])throw"Bad state: "+s}else m[0].charAt(m[0].length-2)!=="/"&&(l="",o=Pn(m[0],!1),i.push([m[3],!0]));break;case"script":break;case"libraries":break;case"automatic-styles":break;case"default-style":case"page-layout":break;case"style":break;case"map":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(i[i.length-1][0]){case"time-style":case"date-style":r=Pn(m[0],!1),l+=$C[m[3]][r.style==="long"?1:0];break}break;case"fraction":break;case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(i[i.length-1][0]){case"time-style":case"date-style":r=Pn(m[0],!1),l+=$C[m[3]][r.style==="long"?1:0];break}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(m[0].slice(-2)==="/>")break;if(m[1]==="/")switch(i[i.length-1][0]){case"number-style":case"date-style":case"time-style":l+=a.slice(c,m.index);break}else c=m.index+m[0].length;break;case"named-range":r=Pn(m[0],!1),ht=tE(r["cell-range-address"]);var Ln={Name:r.name,Ref:ht[0]+"!"+ht[1]};Kt&&(Ln.Sheet=f.length),ze.Names.push(Ln);break;case"text-content":break;case"text-properties":break;case"embedded-text":break;case"body":case"\u7535\u5B50\u8868\u683C":break;case"forms":break;case"table-column":break;case"table-header-rows":break;case"table-rows":break;case"table-column-group":break;case"table-header-columns":break;case"table-columns":break;case"null-date":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"label-range":break;case"label-ranges":break;case"named-expression":break;case"sort":break;case"sort-by":break;case"sort-groups":break;case"tab":break;case"line-break":break;case"span":break;case"p":case"\u6587\u672C\u4E32":if(["master-styles"].indexOf(i[i.length-1][0])>-1)break;if(m[1]==="/"&&(!y||!y["string-value"])){var Oe=uq(a.slice(v,m.index),U);_=(_.length>0?_+`
`:"")+Oe[0]}else U=Pn(m[0],!1),v=m.index+m[0].length;break;case"s":break;case"database-range":if(m[1]==="/")break;try{ht=tE(Pn(m[0])["target-range-address"]),g[ht[0]]["!autofilter"]={ref:ht[1]}}catch(Rn){}break;case"date":break;case"object":break;case"title":case"\u6807\u9898":break;case"desc":break;case"binary-data":break;case"table-source":break;case"scenario":break;case"iteration":break;case"content-validations":break;case"content-validation":break;case"help-message":break;case"error-message":break;case"database-ranges":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;case"list-level-style-bullet":break;case"list-level-style-number":break;case"list-level-properties":break;case"sender-firstname":case"sender-lastname":case"sender-initials":case"sender-title":case"sender-position":case"sender-email":case"sender-phone-private":case"sender-fax":case"sender-company":case"sender-phone-work":case"sender-street":case"sender-city":case"sender-postal-code":case"sender-country":case"sender-state-or-province":case"author-name":case"author-initials":case"chapter":case"file-name":case"template-name":case"sheet-name":break;case"event-listener":break;case"initial-creator":case"creation-date":case"print-date":case"generator":case"document-statistic":case"user-defined":case"editing-duration":case"editing-cycles":break;case"config-item":break;case"page-number":break;case"page-count":break;case"time":break;case"cell-range-source":break;case"detective":break;case"operation":break;case"highlighted-range":break;case"data-pilot-table":case"source-cell-range":case"source-service":case"data-pilot-field":case"data-pilot-level":case"data-pilot-subtotals":case"data-pilot-subtotal":case"data-pilot-members":case"data-pilot-member":case"data-pilot-display-info":case"data-pilot-sort-info":case"data-pilot-layout-info":case"data-pilot-field-reference":case"data-pilot-groups":case"data-pilot-group":case"data-pilot-group-member":break;case"rect":break;case"dde-connection-decls":case"dde-connection-decl":case"dde-link":case"dde-source":break;case"properties":break;case"property":break;case"a":if(m[1]!=="/"){if(Ze=Pn(m[0],!1),!Ze.href)break;Ze.Target=ga(Ze.href),delete Ze.href,Ze.Target.charAt(0)=="#"&&Ze.Target.indexOf(".")>-1?(ht=tE(Ze.Target.slice(1)),Ze.Target="#"+ht[0]+"!"+ht[1]):Ze.Target.match(/^\.\.[\\\/]/)&&(Ze.Target=Ze.Target.slice(3))}break;case"table-protection":break;case"data-pilot-grand-total":break;case"office-document-common-attrs":break;default:switch(m[2]){case"dc:":case"calcext:":case"loext:":case"ooo:":case"chartooo:":case"draw:":case"style:":case"chart:":case"form:":case"uof:":case"\u8868:":case"\u5B57:":break;default:if(n.WTF)throw new Error(m)}}var Xn={Sheets:g,SheetNames:f,Workbook:ze};return n.bookSheets&&delete Xn.Sheets,Xn}function RC(t,e){e=e||{},Ur(t,"META-INF/manifest.xml")&&q8(Ti(t,"META-INF/manifest.xml"),e);var n=Sr(t,"content.xml");if(!n)throw new Error("Missing content.xml in ODS / UOF file");var a=OC(Ia(n),e);return Ur(t,"meta.xml")&&(a.Props=X3(Ti(t,"meta.xml"))),a}function UC(t,e){return OC(t,e)}var fq=null,HC=null;function qC(t,e){if(e.bookType=="fods")return HC(t,e);var n=u1(),a="",i=[],s=[];return a="mimetype",jn(n,a,"application/vnd.oasis.opendocument.spreadsheet"),a="content.xml",jn(n,a,HC(t,e)),i.push([a,"text/xml"]),s.push([a,"ContentFile"]),a="styles.xml",jn(n,a,fq(t,e)),i.push([a,"text/xml"]),s.push([a,"StylesFile"]),a="meta.xml",jn(n,a,Di+Y8()),i.push([a,"text/xml"]),s.push([a,"MetadataFile"]),a="manifest.rdf",jn(n,a,z8(s)),i.push([a,"application/rdf+xml"]),a="META-INF/manifest.xml",jn(n,a,W8(i)),n}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function lu(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function lE(t){return typeof TextDecoder!="undefined"?new TextDecoder().decode(t):Ia(hc(t))}function pq(t){return typeof TextEncoder!="undefined"?new TextEncoder().encode(t):Er(Ko(t))}function hq(t,e){e:for(var n=0;n<=t.length-e.length;++n){for(var a=0;a<e.length;++a)if(t[n+a]!=e[a])continue e;return!0}return!1}function Ec(t){var e=t.reduce(function(i,s){return i+s.length},0),n=new Uint8Array(e),a=0;return t.forEach(function(i){n.set(i,a),a+=i.length}),n}function WC(t){return t-=t>>1&1431655765,t=(t&858993459)+(t>>2&858993459),(t+(t>>4)&252645135)*16843009>>>24}function gq(t,e){for(var n=(t[e+15]&127)<<7|t[e+14]>>1,a=t[e+14]&1,i=e+13;i>=e;--i)a=a*256+t[i];return(t[e+15]&128?-a:a)*Math.pow(10,n-6176)}function mq(t,e,n){var a=Math.floor(n==0?0:Math.LOG10E*Math.log(Math.abs(n)))+6176-20,i=n/Math.pow(10,a-6176);t[e+15]|=a>>7,t[e+14]|=(a&127)<<1;for(var s=0;i>=1;++s,i/=256)t[e+s]=i&255;t[e+15]|=n>=0?0:128}function Hg(t,e){var n=e?e[0]:0,a=t[n]&127;e:if(t[n++]>=128&&(a|=(t[n]&127)<<7,t[n++]<128||(a|=(t[n]&127)<<14,t[n++]<128)||(a|=(t[n]&127)<<21,t[n++]<128)||(a+=(t[n]&127)*Math.pow(2,28),++n,t[n++]<128)||(a+=(t[n]&127)*Math.pow(2,35),++n,t[n++]<128)||(a+=(t[n]&127)*Math.pow(2,42),++n,t[n++]<128)))break e;return e&&(e[0]=n),a}function ka(t){var e=new Uint8Array(7);e[0]=t&127;var n=1;e:if(t>127){if(e[n-1]|=128,e[n]=t>>7&127,++n,t<=16383||(e[n-1]|=128,e[n]=t>>14&127,++n,t<=2097151)||(e[n-1]|=128,e[n]=t>>21&127,++n,t<=268435455)||(e[n-1]|=128,e[n]=t/256>>>21&127,++n,t<=34359738367)||(e[n-1]|=128,e[n]=t/65536>>>21&127,++n,t<=4398046511103))break e;e[n-1]|=128,e[n]=t/16777216>>>21&127,++n}return e.slice(0,n)}function di(t){var e=0,n=t[e]&127;e:if(t[e++]>=128){if(n|=(t[e]&127)<<7,t[e++]<128||(n|=(t[e]&127)<<14,t[e++]<128)||(n|=(t[e]&127)<<21,t[e++]<128))break e;n|=(t[e]&127)<<28}return n}function ba(t){for(var e=[],n=[0];n[0]<t.length;){var a=n[0],i=Hg(t,n),s=i&7;i=Math.floor(i/8);var r=0,o;if(i==0)break;switch(s){case 0:{for(var l=n[0];t[n[0]++]>=128;);o=t.slice(l,n[0])}break;case 5:r=4,o=t.slice(n[0],n[0]+r),n[0]+=r;break;case 1:r=8,o=t.slice(n[0],n[0]+r),n[0]+=r;break;case 2:r=Hg(t,n),o=t.slice(n[0],n[0]+r),n[0]+=r;break;case 3:case 4:default:throw new Error("PB Type ".concat(s," for Field ").concat(i," at offset ").concat(a))}var c={data:o,type:s};e[i]==null?e[i]=[c]:e[i].push(c)}return e}function Ki(t){var e=[];return t.forEach(function(n,a){n.forEach(function(i){i.data&&(e.push(ka(a*8+i.type)),i.type==2&&e.push(ka(i.data.length)),e.push(i.data))})}),Ec(e)}function cE(t,e){return(t==null?void 0:t.map(function(n){return e(n.data)}))||[]}function Vr(t){for(var e,n=[],a=[0];a[0]<t.length;){var i=Hg(t,a),s=ba(t.slice(a[0],a[0]+i));a[0]+=i;var r={id:di(s[1][0].data),messages:[]};s[2].forEach(function(o){var l=ba(o.data),c=di(l[3][0].data);r.messages.push({meta:l,data:t.slice(a[0],a[0]+c)}),a[0]+=c}),(e=s[3])!=null&&e[0]&&(r.merge=di(s[3][0].data)>>>0>0),n.push(r)}return n}function ap(t){var e=[];return t.forEach(function(n){var a=[];a[1]=[{data:ka(n.id),type:0}],a[2]=[],n.merge!=null&&(a[3]=[{data:ka(+!!n.merge),type:0}]);var i=[];n.messages.forEach(function(r){i.push(r.data),r.meta[3]=[{type:0,data:ka(r.data.length)}],a[2].push({data:Ki(r.meta),type:2})});var s=Ki(a);e.push(ka(s.length)),e.push(s),i.forEach(function(r){return e.push(r)})}),Ec(e)}function bq(t,e){if(t!=0)throw new Error("Unexpected Snappy chunk type ".concat(t));for(var n=[0],a=Hg(e,n),i=[];n[0]<e.length;){var s=e[n[0]]&3;if(s==0){var r=e[n[0]++]>>2;if(r<60)++r;else{var o=r-59;r=e[n[0]],o>1&&(r|=e[n[0]+1]<<8),o>2&&(r|=e[n[0]+2]<<16),o>3&&(r|=e[n[0]+3]<<24),r>>>=0,r++,n[0]+=o}i.push(e.slice(n[0],n[0]+r)),n[0]+=r;continue}else{var l=0,c=0;if(s==1?(c=(e[n[0]]>>2&7)+4,l=(e[n[0]++]&224)<<3,l|=e[n[0]++]):(c=(e[n[0]++]>>2)+1,s==2?(l=e[n[0]]|e[n[0]+1]<<8,n[0]+=2):(l=(e[n[0]]|e[n[0]+1]<<8|e[n[0]+2]<<16|e[n[0]+3]<<24)>>>0,n[0]+=4)),i=[Ec(i)],l==0)throw new Error("Invalid offset 0");if(l>i[0].length)throw new Error("Invalid offset beyond length");if(c>=l)for(i.push(i[0].slice(-l)),c-=l;c>=i[i.length-1].length;)i.push(i[i.length-1]),c-=i[i.length-1].length;i.push(i[0].slice(-l,-l+c))}}var d=Ec(i);if(d.length!=a)throw new Error("Unexpected length: ".concat(d.length," != ").concat(a));return d}function zr(t){for(var e=[],n=0;n<t.length;){var a=t[n++],i=t[n]|t[n+1]<<8|t[n+2]<<16;n+=3,e.push(bq(a,t.slice(n,n+i))),n+=i}if(n!==t.length)throw new Error("data is not a valid framed stream!");return Ec(e)}function ip(t){for(var e=[],n=0;n<t.length;){var a=Math.min(t.length-n,268435455),i=new Uint8Array(4);e.push(i);var s=ka(a),r=s.length;e.push(s),a<=60?(r++,e.push(new Uint8Array([a-1<<2]))):a<=256?(r+=2,e.push(new Uint8Array([240,a-1&255]))):a<=65536?(r+=3,e.push(new Uint8Array([244,a-1&255,a-1>>8&255]))):a<=16777216?(r+=4,e.push(new Uint8Array([248,a-1&255,a-1>>8&255,a-1>>16&255]))):a<=4294967296&&(r+=5,e.push(new Uint8Array([252,a-1&255,a-1>>8&255,a-1>>16&255,a-1>>>24&255]))),e.push(t.slice(n,n+a)),r+=a,i[0]=0,i[1]=r&255,i[2]=r>>8&255,i[3]=r>>16&255,n+=a}return Ec(e)}function yq(t,e,n,a){var i=lu(t),s=i.getUint32(4,!0),r=(a>1?12:8)+WC(s&(a>1?3470:398))*4,o=-1,l=-1,c=NaN,d=new Date(2001,0,1);s&512&&(o=i.getUint32(r,!0),r+=4),r+=WC(s&(a>1?12288:4096))*4,s&16&&(l=i.getUint32(r,!0),r+=4),s&32&&(c=i.getFloat64(r,!0),r+=8),s&64&&(d.setTime(d.getTime()+i.getFloat64(r,!0)*1e3),r+=8);var u;switch(t[2]){case 0:break;case 2:u={t:"n",v:c};break;case 3:u={t:"s",v:e[l]};break;case 5:u={t:"d",v:d};break;case 6:u={t:"b",v:c>0};break;case 7:u={t:"n",v:c/86400};break;case 8:u={t:"e",v:0};break;case 9:if(o>-1)u={t:"s",v:n[o]};else if(l>-1)u={t:"s",v:e[l]};else if(!isNaN(c))u={t:"n",v:c};else throw new Error("Unsupported cell type ".concat(t.slice(0,4)));break;default:throw new Error("Unsupported cell type ".concat(t.slice(0,4)))}return u}function _q(t,e,n){var a=lu(t),i=a.getUint32(8,!0),s=12,r=-1,o=-1,l=NaN,c=NaN,d=new Date(2001,0,1);i&1&&(l=gq(t,s),s+=16),i&2&&(c=a.getFloat64(s,!0),s+=8),i&4&&(d.setTime(d.getTime()+a.getFloat64(s,!0)*1e3),s+=8),i&8&&(o=a.getUint32(s,!0),s+=4),i&16&&(r=a.getUint32(s,!0),s+=4);var u;switch(t[1]){case 0:break;case 2:u={t:"n",v:l};break;case 3:u={t:"s",v:e[o]};break;case 5:u={t:"d",v:d};break;case 6:u={t:"b",v:c>0};break;case 7:u={t:"n",v:c/86400};break;case 8:u={t:"e",v:0};break;case 9:if(r>-1)u={t:"s",v:n[r]};else throw new Error("Unsupported cell type ".concat(t[1]," : ").concat(i&31," : ").concat(t.slice(0,4)));break;case 10:u={t:"n",v:l};break;default:throw new Error("Unsupported cell type ".concat(t[1]," : ").concat(i&31," : ").concat(t.slice(0,4)))}return u}function dE(t,e){var n=new Uint8Array(32),a=lu(n),i=12,s=0;switch(n[0]=5,t.t){case"n":n[1]=2,mq(n,i,t.v),s|=1,i+=16;break;case"b":n[1]=6,a.setFloat64(i,t.v?1:0,!0),s|=2,i+=8;break;case"s":if(e.indexOf(t.v)==-1)throw new Error("Value ".concat(t.v," missing from SST!"));n[1]=3,a.setUint32(i,e.indexOf(t.v),!0),s|=8,i+=4;break;default:throw"unsupported cell type "+t.t}return a.setUint32(8,s,!0),n.slice(0,i)}function uE(t,e){var n=new Uint8Array(32),a=lu(n),i=12,s=0;switch(n[0]=3,t.t){case"n":n[2]=2,a.setFloat64(i,t.v,!0),s|=32,i+=8;break;case"b":n[2]=6,a.setFloat64(i,t.v?1:0,!0),s|=32,i+=8;break;case"s":if(e.indexOf(t.v)==-1)throw new Error("Value ".concat(t.v," missing from SST!"));n[2]=3,a.setUint32(i,e.indexOf(t.v),!0),s|=16,i+=4;break;default:throw"unsupported cell type "+t.t}return a.setUint32(4,s,!0),n.slice(0,i)}function wq(t,e,n){switch(t[0]){case 0:case 1:case 2:case 3:return yq(t,e,n,t[0]);case 5:return _q(t,e,n);default:throw new Error("Unsupported payload version ".concat(t[0]))}}function xs(t){var e=ba(t);return Hg(e[1][0].data)}function Kz(t){var e=[];return e[1]=[{type:0,data:ka(t)}],Ki(e)}function VC(t,e){var n=ba(e.data),a=di(n[1][0].data),i=n[3],s=[];return(i||[]).forEach(function(r){var o=ba(r.data),l=di(o[1][0].data)>>>0;switch(a){case 1:s[l]=lE(o[3][0].data);break;case 8:{var c=t[xs(o[9][0].data)][0],d=ba(c.data),u=t[xs(d[1][0].data)][0],g=di(u.meta[1][0].data);if(g!=2001)throw new Error("2000 unexpected reference to ".concat(g));var f=ba(u.data);s[l]=f[3].map(function(h){return lE(h.data)}).join("")}break}}),s}function vq(t,e){var n,a,i,s,r,o,l,c,d,u,g,f,h,m,b=ba(t),y=di(b[1][0].data)>>>0,_=di(b[2][0].data)>>>0,v=((a=(n=b[8])==null?void 0:n[0])==null?void 0:a.data)&&di(b[8][0].data)>0||!1,U,ee;if((s=(i=b[7])==null?void 0:i[0])!=null&&s.data&&e!=0)U=(o=(r=b[7])==null?void 0:r[0])==null?void 0:o.data,ee=(c=(l=b[6])==null?void 0:l[0])==null?void 0:c.data;else if((u=(d=b[4])==null?void 0:d[0])!=null&&u.data&&e!=1)U=(f=(g=b[4])==null?void 0:g[0])==null?void 0:f.data,ee=(m=(h=b[3])==null?void 0:h[0])==null?void 0:m.data;else throw"NUMBERS Tile missing ".concat(e," cell storage");for(var Z=v?4:1,k=lu(U),w=[],S=0;S<U.length/2;++S){var B=k.getUint16(S*2,!0);B<65535&&w.push([S,B])}if(w.length!=_)throw"Expected ".concat(_," cells, found ").concat(w.length);var H=[];for(S=0;S<w.length-1;++S)H[w[S][0]]=ee.subarray(w[S][1]*Z,w[S+1][1]*Z);return w.length>=1&&(H[w[w.length-1][0]]=ee.subarray(w[w.length-1][1]*Z)),{R:y,cells:H}}function xq(t,e){var n,a=ba(e.data),i=(n=a==null?void 0:a[7])!=null&&n[0]?di(a[7][0].data)>>>0>0?1:0:-1,s=cE(a[5],function(r){return vq(r,i)});return{nrows:di(a[4][0].data)>>>0,data:s.reduce(function(r,o){return r[o.R]||(r[o.R]=[]),o.cells.forEach(function(l,c){if(r[o.R][c])throw new Error("Duplicate cell r=".concat(o.R," c=").concat(c));r[o.R][c]=l}),r},[])}}function Eq(t,e,n){var a,i=ba(e.data),s={s:{r:0,c:0},e:{r:0,c:0}};if(s.e.r=(di(i[6][0].data)>>>0)-1,s.e.r<0)throw new Error("Invalid row varint ".concat(i[6][0].data));if(s.e.c=(di(i[7][0].data)>>>0)-1,s.e.c<0)throw new Error("Invalid col varint ".concat(i[7][0].data));n["!ref"]=Yn(s);var r=ba(i[4][0].data),o=VC(t,t[xs(r[4][0].data)][0]),l=(a=r[17])!=null&&a[0]?VC(t,t[xs(r[17][0].data)][0]):[],c=ba(r[3][0].data),d=0;c[1].forEach(function(u){var g=ba(u.data),f=t[xs(g[2][0].data)][0],h=di(f.meta[1][0].data);if(h!=6002)throw new Error("6001 unexpected reference to ".concat(h));var m=xq(t,f);m.data.forEach(function(b,y){b.forEach(function(_,v){var U=Nn({r:d+y,c:v}),ee=wq(_,o,l);ee&&(n[U]=ee)})}),d+=m.nrows})}function kq(t,e){var n=ba(e.data),a={"!ref":"A1"},i=t[xs(n[2][0].data)],s=di(i[0].meta[1][0].data);if(s!=6001)throw new Error("6000 unexpected reference to ".concat(s));return Eq(t,i[0],a),a}function Sq(t,e){var n,a=ba(e.data),i={name:(n=a[1])!=null&&n[0]?lE(a[1][0].data):"",sheets:[]},s=cE(a[2],xs);return s.forEach(function(r){t[r].forEach(function(o){var l=di(o.meta[1][0].data);l==6e3&&i.sheets.push(kq(t,o))})}),i}function Aq(t,e){var n=wE(),a=ba(e.data),i=cE(a[1],xs);if(i.forEach(function(s){t[s].forEach(function(r){var o=di(r.meta[1][0].data);if(o==2){var l=Sq(t,r);l.sheets.forEach(function(c,d){vE(n,c,d==0?l.name:l.name+"_"+d,!0)})}})}),n.SheetNames.length==0)throw new Error("Empty NUMBERS file");return n}function fE(t){var e,n,a,i,s={},r=[];if(t.FullPaths.forEach(function(l){if(l.match(/\.iwpv2/))throw new Error("Unsupported password protection")}),t.FileIndex.forEach(function(l){if(l.name.match(/\.iwa$/)){var c;try{c=zr(l.content)}catch(u){return console.log("?? "+l.content.length+" "+(u.message||u))}var d;try{d=Vr(c)}catch(u){return console.log("## "+(u.message||u))}d.forEach(function(u){s[u.id]=u.messages,r.push(u.id)})}}),!r.length)throw new Error("File has no messages");var o=((i=(a=(n=(e=s==null?void 0:s[1])==null?void 0:e[0])==null?void 0:n.meta)==null?void 0:a[1])==null?void 0:i[0].data)&&di(s[1][0].meta[1][0].data)==1&&s[1][0];if(o||r.forEach(function(l){s[l].forEach(function(c){var d=di(c.meta[1][0].data)>>>0;if(d==1)if(!o)o=c;else throw new Error("Document has multiple roots")})}),!o)throw new Error("Cannot find Document root");return Aq(s,o)}function Tq(t,e,n){var a,i,s,r;if(!((a=t[6])!=null&&a[0])||!((i=t[7])!=null&&i[0]))throw"Mutation only works on post-BNC storages!";var o=((r=(s=t[8])==null?void 0:s[0])==null?void 0:r.data)&&di(t[8][0].data)>0||!1;if(o)throw"Math only works with normal offsets";for(var l=0,c=lu(t[7][0].data),d=0,u=[],g=lu(t[4][0].data),f=0,h=[],m=0;m<e.length;++m){if(e[m]==null){c.setUint16(m*2,65535,!0),g.setUint16(m*2,65535);continue}c.setUint16(m*2,d,!0),g.setUint16(m*2,f,!0);var b,y;switch(typeof e[m]){case"string":b=dE({t:"s",v:e[m]},n),y=uE({t:"s",v:e[m]},n);break;case"number":b=dE({t:"n",v:e[m]},n),y=uE({t:"n",v:e[m]},n);break;case"boolean":b=dE({t:"b",v:e[m]},n),y=uE({t:"b",v:e[m]},n);break;default:throw new Error("Unsupported value "+e[m])}u.push(b),d+=b.length,h.push(y),f+=y.length,++l}for(t[2][0].data=ka(l);m<t[7][0].data.length/2;++m)c.setUint16(m*2,65535,!0),g.setUint16(m*2,65535,!0);return t[6][0].data=Ec(u),t[3][0].data=Ec(h),l}function Dq(t,e){if(!e||!e.numbers)throw new Error("Must pass a `numbers` option -- check the README");var n=t.Sheets[t.SheetNames[0]];t.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var a=Tr(n["!ref"]);a.s.r=a.s.c=0;var i=!1;a.e.c>9&&(i=!0,a.e.c=9),a.e.r>49&&(i=!0,a.e.r=49),i&&console.error("The Numbers writer is currently limited to ".concat(Yn(a)));var s=ow(n,{range:a,header:1}),r=["~Sh33tJ5~"];s.forEach(function(Ve){return Ve.forEach(function(He){typeof He=="string"&&r.push(He)})});var o={},l=[],c=An.read(e.numbers,{type:"base64"});c.FileIndex.map(function(Ve,He){return[Ve,c.FullPaths[He]]}).forEach(function(Ve){var He=Ve[0],bt=Ve[1];if(He.type==2&&He.name.match(/\.iwa/)){var Kt=He.content,Vt=zr(Kt),At=Vr(Vt);At.forEach(function(Ct){l.push(Ct.id),o[Ct.id]={deps:[],location:bt,type:di(Ct.messages[0].meta[1][0].data)}})}}),l.sort(function(Ve,He){return Ve-He});var d=l.filter(function(Ve){return Ve>1}).map(function(Ve){return[Ve,ka(Ve)]});c.FileIndex.map(function(Ve,He){return[Ve,c.FullPaths[He]]}).forEach(function(Ve){var He=Ve[0],bt=Ve[1];if(He.name.match(/\.iwa/)){var Kt=Vr(zr(He.content));Kt.forEach(function(Vt){Vt.messages.forEach(function(At){d.forEach(function(Ct){Vt.messages.some(function(Ln){return di(Ln.meta[1][0].data)!=11006&&hq(Ln.data,Ct[1])})&&o[Ct[0]].deps.push(Vt.id)})})})}});function u(){for(var Ve=927262;Ve<2e6;++Ve)if(!o[Ve])return Ve;throw new Error("Too many messages")}for(var g=An.find(c,o[1].location),f=Vr(zr(g.content)),h,m=0;m<f.length;++m){var b=f[m];b.id==1&&(h=b)}var y=xs(ba(h.messages[0].data)[1][0].data);for(g=An.find(c,o[y].location),f=Vr(zr(g.content)),m=0;m<f.length;++m)b=f[m],b.id==y&&(h=b);for(y=xs(ba(h.messages[0].data)[2][0].data),g=An.find(c,o[y].location),f=Vr(zr(g.content)),m=0;m<f.length;++m)b=f[m],b.id==y&&(h=b);for(y=xs(ba(h.messages[0].data)[2][0].data),g=An.find(c,o[y].location),f=Vr(zr(g.content)),m=0;m<f.length;++m)b=f[m],b.id==y&&(h=b);var _=ba(h.messages[0].data);{_[6][0].data=ka(a.e.r+1),_[7][0].data=ka(a.e.c+1);var v=xs(_[46][0].data),U=An.find(c,o[v].location),ee=Vr(zr(U.content));{for(var Z=0;Z<ee.length&&ee[Z].id!=v;++Z);if(ee[Z].id!=v)throw"Bad ColumnRowUIDMapArchive";var k=ba(ee[Z].messages[0].data);k[1]=[],k[2]=[],k[3]=[];for(var w=0;w<=a.e.c;++w){var S=[];S[1]=S[2]=[{type:0,data:ka(w+420690)}],k[1].push({type:2,data:Ki(S)}),k[2].push({type:0,data:ka(w)}),k[3].push({type:0,data:ka(w)})}k[4]=[],k[5]=[],k[6]=[];for(var B=0;B<=a.e.r;++B)S=[],S[1]=S[2]=[{type:0,data:ka(B+726270)}],k[4].push({type:2,data:Ki(S)}),k[5].push({type:0,data:ka(B)}),k[6].push({type:0,data:ka(B)});ee[Z].messages[0].data=Ki(k)}U.content=ip(ap(ee)),U.size=U.content.length,delete _[46];var H=ba(_[4][0].data);{H[7][0].data=ka(a.e.r+1);var j=ba(H[1][0].data),re=xs(j[2][0].data);U=An.find(c,o[re].location),ee=Vr(zr(U.content));{if(ee[0].id!=re)throw"Bad HeaderStorageBucket";var Te=ba(ee[0].messages[0].data);for(B=0;B<s.length;++B){var Be=ba(Te[2][0].data);Be[1][0].data=ka(B),Be[4][0].data=ka(s[B].length),Te[2][B]={type:Te[2][0].type,data:Ki(Be)}}ee[0].messages[0].data=Ki(Te)}U.content=ip(ap(ee)),U.size=U.content.length;var Ie=xs(H[2][0].data);U=An.find(c,o[Ie].location),ee=Vr(zr(U.content));{if(ee[0].id!=Ie)throw"Bad HeaderStorageBucket";for(Te=ba(ee[0].messages[0].data),w=0;w<=a.e.c;++w)Be=ba(Te[2][0].data),Be[1][0].data=ka(w),Be[4][0].data=ka(a.e.r+1),Te[2][w]={type:Te[2][0].type,data:Ki(Be)};ee[0].messages[0].data=Ki(Te)}U.content=ip(ap(ee)),U.size=U.content.length;var Ce=xs(H[4][0].data);(function(){for(var Ve=An.find(c,o[Ce].location),He=Vr(zr(Ve.content)),bt,Kt=0;Kt<He.length;++Kt){var Vt=He[Kt];Vt.id==Ce&&(bt=Vt)}var At=ba(bt.messages[0].data);{At[3]=[];var Ct=[];r.forEach(function(Xn,Rn){Ct[1]=[{type:0,data:ka(Rn)}],Ct[2]=[{type:0,data:ka(1)}],Ct[3]=[{type:2,data:pq(Xn)}],At[3].push({type:2,data:Ki(Ct)})})}bt.messages[0].data=Ki(At);var Ln=ap(He),Oe=ip(Ln);Ve.content=Oe,Ve.size=Ve.content.length})();var Je=ba(H[3][0].data);{var ze=Je[1][0];delete Je[2];var Ze=ba(ze.data);{var ht=xs(Ze[2][0].data);(function(){for(var Ve=An.find(c,o[ht].location),He=Vr(zr(Ve.content)),bt,Kt=0;Kt<He.length;++Kt){var Vt=He[Kt];Vt.id==ht&&(bt=Vt)}var At=ba(bt.messages[0].data);{delete At[6],delete Je[7];var Ct=new Uint8Array(At[5][0].data);At[5]=[];for(var Ln=0,Oe=0;Oe<=a.e.r;++Oe){var Xn=ba(Ct);Ln+=Tq(Xn,s[Oe],r),Xn[1][0].data=ka(Oe),At[5].push({data:Ki(Xn),type:2})}At[1]=[{type:0,data:ka(a.e.c+1)}],At[2]=[{type:0,data:ka(a.e.r+1)}],At[3]=[{type:0,data:ka(Ln)}],At[4]=[{type:0,data:ka(a.e.r+1)}]}bt.messages[0].data=Ki(At);var Rn=ap(He),Da=ip(Rn);Ve.content=Da,Ve.size=Ve.content.length})()}ze.data=Ki(Ze)}H[3][0].data=Ki(Je)}_[4][0].data=Ki(H)}h.messages[0].data=Ki(_);var De=ap(f),tt=ip(De);return g.content=tt,g.size=g.content.length,c}function zC(t){return function(n){for(var a=0;a!=t.length;++a){var i=t[a];n[i[0]]===void 0&&(n[i[0]]=i[1]),i[2]==="n"&&(n[i[0]]=Number(n[i[0]]))}}}function pE(t){zC([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellText",!0],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]])(t)}function hE(t){zC([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(t)}function Cq(t){return Gn.WS.indexOf(t)>-1?"sheet":Gn.CS&&t==Gn.CS?"chart":Gn.DS&&t==Gn.DS?"dialog":Gn.MS&&t==Gn.MS?"macro":t&&t.length?t:"sheet"}function Lq(t,e){if(!t)return 0;try{t=e.map(function(a){return a.id||(a.id=a.strRelID),[a.name,t["!id"][a.id].Target,Cq(t["!id"][a.id].Type)]})}catch(n){return null}return!t||t.length===0?null:t}function Iq(t,e,n,a,i,s,r,o,l,c,d,u){try{s[a]=kg(Sr(t,n,!0),e);var g=Ti(t,e),f;switch(o){case"sheet":f=a7(g,e,i,l,s[a],c,d,u);break;case"chart":if(f=i7(g,e,i,l,s[a],c,d,u),!f||!f["!drawel"])break;var h=bg(f["!drawel"].Target,e),m=Eg(h),b=zO(Sr(t,h,!0),kg(Sr(t,m,!0),h)),y=bg(b,h),_=Eg(y);f=L9(Sr(t,y,!0),y,l,kg(Sr(t,_,!0),y),c,f);break;case"macro":f=s7(g,e,i,l,s[a],c,d,u);break;case"dialog":f=r7(g,e,i,l,s[a],c,d,u);break;default:throw new Error("Unrecognized sheet type "+o)}r[a]=f;var v=[];s&&s[a]&&oi(s[a]).forEach(function(U){var ee="";if(s[a][U].Type==Gn.CMNT){ee=bg(s[a][U].Target,e);var Z=d7(Ti(t,ee,!0),ee,l);if(!Z||!Z.length)return;XD(f,Z,!1)}s[a][U].Type==Gn.TCMNT&&(ee=bg(s[a][U].Target,e),v=v.concat(GO(Ti(t,ee,!0),l)))}),v&&v.length&&XD(f,v,!0,l.people||[])}catch(U){if(l.WTF)throw U}}function Yr(t){return t.charAt(0)=="/"?t.slice(1):t}function Mq(t,e){if(Yf(),e=e||{},pE(e),Ur(t,"META-INF/manifest.xml")||Ur(t,"objectdata.xml"))return RC(t,e);if(Ur(t,"Index/Document.iwa")){if(typeof Uint8Array=="undefined")throw new Error("NUMBERS file parsing requires Uint8Array support");if(typeof fE!="undefined"){if(t.FileIndex)return fE(t);var n=An.utils.cfb_new();return d3(t).forEach(function(Te){jn(n,Te,c3(t,Te))}),fE(n)}throw new Error("Unsupported NUMBERS file")}if(!Ur(t,"[Content_Types].xml"))throw Ur(t,"index.xml.gz")?new Error("Unsupported NUMBERS 08 file"):Ur(t,"index.xml")?new Error("Unsupported NUMBERS 09 file"):new Error("Unsupported ZIP file");var a=d3(t),i=U8(Sr(t,"[Content_Types].xml")),s=!1,r,o;if(i.workbooks.length===0&&(o="xl/workbook.xml",Ti(t,o,!0)&&i.workbooks.push(o)),i.workbooks.length===0){if(o="xl/workbook.bin",!Ti(t,o,!0))throw new Error("Could not find workbook");i.workbooks.push(o),s=!0}i.workbooks[0].slice(-3)=="bin"&&(s=!0);var l={},c={};if(!e.bookSheets&&!e.bookProps){if(Ng=[],i.sst)try{Ng=c7(Ti(t,Yr(i.sst)),i.sst,e)}catch(Te){if(e.WTF)throw Te}e.cellStyles&&i.themes.length&&(l=l7(Sr(t,i.themes[0].replace(/^\//,""),!0)||"",i.themes[0],e)),i.style&&(c=o7(Ti(t,Yr(i.style)),i.style,l,e))}i.links.map(function(Te){try{var Be=kg(Sr(t,Eg(Yr(Te))),Te);return f7(Ti(t,Yr(Te)),Be,Te,e)}catch(Ie){}});var d=n7(Ti(t,Yr(i.workbooks[0])),i.workbooks[0],e),u={},g="";i.coreprops.length&&(g=Ti(t,Yr(i.coreprops[0]),!0),g&&(u=X3(g)),i.extprops.length!==0&&(g=Ti(t,Yr(i.extprops[0]),!0),g&&j8(g,u,e)));var f={};(!e.bookSheets||e.bookProps)&&i.custprops.length!==0&&(g=Sr(t,Yr(i.custprops[0]),!0),g&&(f=X8(g,e)));var h={};if((e.bookSheets||e.bookProps)&&(d.Sheets?r=d.Sheets.map(function(Be){return Be.name}):u.Worksheets&&u.SheetNames.length>0&&(r=u.SheetNames),e.bookProps&&(h.Props=u,h.Custprops=f),e.bookSheets&&typeof r!="undefined"&&(h.SheetNames=r),e.bookSheets?h.SheetNames:e.bookProps))return h;r={};var m={};e.bookDeps&&i.calcchain&&(m=u7(Ti(t,Yr(i.calcchain)),i.calcchain,e));var b=0,y={},_,v;{var U=d.Sheets;u.Worksheets=U.length,u.SheetNames=[];for(var ee=0;ee!=U.length;++ee)u.SheetNames[ee]=U[ee].name}var Z=s?"bin":"xml",k=i.workbooks[0].lastIndexOf("/"),w=(i.workbooks[0].slice(0,k+1)+"_rels/"+i.workbooks[0].slice(k+1)+".rels").replace(/^\//,"");Ur(t,w)||(w="xl/_rels/workbook."+Z+".rels");var S=kg(Sr(t,w,!0),w.replace(/_rels.*/,"s5s"));(i.metadata||[]).length>=1&&(e.xlmeta=p7(Ti(t,Yr(i.metadata[0])),i.metadata[0],e)),(i.people||[]).length>=1&&(e.people=KO(Ti(t,Yr(i.people[0])),e)),S&&(S=Lq(S,d.Sheets));var B=Ti(t,"xl/worksheets/sheet.xml",!0)?1:0;e:for(b=0;b!=u.Worksheets;++b){var H="sheet";if(S&&S[b]?(_="xl/"+S[b][1].replace(/[\/]?xl\//,""),Ur(t,_)||(_=S[b][1]),Ur(t,_)||(_=w.replace(/_rels\/.*$/,"")+S[b][1]),H=S[b][2]):(_="xl/worksheets/sheet"+(b+1-B)+"."+Z,_=_.replace(/sheet0\./,"sheet.")),v=_.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),e&&e.sheets!=null)switch(typeof e.sheets){case"number":if(b!=e.sheets)continue e;break;case"string":if(u.SheetNames[b].toLowerCase()!=e.sheets.toLowerCase())continue e;break;default:if(Array.isArray&&Array.isArray(e.sheets)){for(var j=!1,re=0;re!=e.sheets.length;++re)typeof e.sheets[re]=="number"&&e.sheets[re]==b&&(j=1),typeof e.sheets[re]=="string"&&e.sheets[re].toLowerCase()==u.SheetNames[b].toLowerCase()&&(j=1);if(!j)continue e}}Iq(t,_,v,u.SheetNames[b],b,y,r,H,e,d,l,c)}return h={Directory:i,Workbook:d,Props:u,Custprops:f,Deps:m,Sheets:r,SheetNames:u.SheetNames,Strings:Ng,Styles:c,Themes:l,SSF:Ba(Dn)},e&&e.bookFiles&&(t.files?(h.keys=a,h.files=t.files):(h.keys=[],h.files={},t.FullPaths.forEach(function(Te,Be){Te=Te.replace(/^Root Entry[\/]/,""),h.keys.push(Te),h.files[Te]=t.FileIndex[Be]}))),e&&e.bookVBA&&(i.vba.length>0?h.vbaraw=Ti(t,Yr(i.vba[0]),!0):i.defaults&&i.defaults.bin===aR&&(h.vbaraw=Ti(t,"xl/vbaProject.bin",!0))),h}function Fq(t,e){var n=e||{},a="Workbook",i=An.find(t,a);try{if(a="/!DataSpaces/Version",i=An.find(t,a),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+a);if(h$(i.content),a="/!DataSpaces/DataSpaceMap",i=An.find(t,a),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+a);var s=m$(i.content);if(s.length!==1||s[0].comps.length!==1||s[0].comps[0].t!==0||s[0].name!=="StrongEncryptionDataSpace"||s[0].comps[0].v!=="EncryptedPackage")throw new Error("ECMA-376 Encrypted file bad "+a);if(a="/!DataSpaces/DataSpaceInfo/StrongEncryptionDataSpace",i=An.find(t,a),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+a);var r=b$(i.content);if(r.length!=1||r[0]!="StrongEncryptionTransform")throw new Error("ECMA-376 Encrypted file bad "+a);if(a="/!DataSpaces/TransformInfo/StrongEncryptionTransform/!Primary",i=An.find(t,a),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+a);_$(i.content)}catch(l){}if(a="/EncryptionInfo",i=An.find(t,a),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+a);var o=w$(i.content);if(a="/EncryptedPackage",i=An.find(t,a),!i||!i.content)throw new Error("ECMA-376 Encrypted file missing "+a);if(o[0]==4&&typeof decrypt_agile!="undefined")return decrypt_agile(o[1],i.content,n.password||"",n);if(o[0]==2&&typeof decrypt_std76!="undefined")return decrypt_std76(o[1],i.content,n.password||"",n);throw new Error("File is password-protected")}function Pq(t,e){return e.bookType=="ods"?qC(t,e):e.bookType=="numbers"?Dq(t,e):e.bookType=="xlsb"?Nq(t,e):YC(t,e)}function Nq(t,e){ep=1024,t&&!t.SSF&&(t.SSF=Ba(Dn)),t&&t.SSF&&(Yf(),gg(t.SSF),e.revssf=N_(t.SSF),e.revssf[t.SSF[65535]]=0,e.ssf=t.SSF),e.rels={},e.wbrels={},e.Strings=[],e.Strings.Count=0,e.Strings.Unique=0,Bg?e.revStrings=new Map:(e.revStrings={},e.revStrings.foo=[],delete e.revStrings.foo);var n=e.bookType=="xlsb"?"bin":"xml",a=JD.indexOf(e.bookType)>-1,i=$1();hE(e=e||{});var s=u1(),r="",o=0;if(e.cellXfs=[],xc(e.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={}),r="docProps/core.xml",jn(s,r,Z3(t.Props,e)),i.coreprops.push(r),Ea(e.rels,2,r,Gn.CORE_PROPS),r="docProps/app.xml",!(t.Props&&t.Props.SheetNames))if(!t.Workbook||!t.Workbook.Sheets)t.Props.SheetNames=t.SheetNames;else{for(var l=[],c=0;c<t.SheetNames.length;++c)(t.Workbook.Sheets[c]||{}).Hidden!=2&&l.push(t.SheetNames[c]);t.Props.SheetNames=l}for(t.Props.Worksheets=t.Props.SheetNames.length,jn(s,r,eD(t.Props,e)),i.extprops.push(r),Ea(e.rels,3,r,Gn.EXT_PROPS),t.Custprops!==t.Props&&oi(t.Custprops||{}).length>0&&(r="docProps/custom.xml",jn(s,r,tD(t.Custprops,e)),i.custprops.push(r),Ea(e.rels,4,r,Gn.CUST_PROPS)),o=1;o<=t.SheetNames.length;++o){var d={"!id":{}},u=t.Sheets[t.SheetNames[o-1]],g=(u||{})["!type"]||"sheet";switch(g){case"chart":default:r="xl/worksheets/sheet"+o+"."+n,jn(s,r,g7(o-1,r,e,t,d)),i.sheets.push(r),Ea(e.wbrels,-1,"worksheets/sheet"+o+"."+n,Gn.WS[0])}if(u){var f=u["!comments"],h=!1,m="";f&&f.length>0&&(m="xl/comments"+o+"."+n,jn(s,m,y7(f,m,e)),i.comments.push(m),Ea(d,-1,"../comments"+o+"."+n,Gn.CMNT),h=!0),u["!legacy"]&&h&&jn(s,"xl/drawings/vmlDrawing"+o+".vml",KD(o,u["!comments"])),delete u["!comments"],delete u["!legacy"]}d["!id"].rId1&&jn(s,Eg(r),Zf(d))}return e.Strings!=null&&e.Strings.length>0&&(r="xl/sharedStrings."+n,jn(s,r,b7(e.Strings,r,e)),i.strs.push(r),Ea(e.wbrels,-1,"sharedStrings."+n,Gn.SST)),r="xl/workbook."+n,jn(s,r,h7(t,r,e)),i.workbooks.push(r),Ea(e.rels,1,r,Gn.WB),r="xl/theme/theme1.xml",jn(s,r,X1(t.Themes,e)),i.themes.push(r),Ea(e.wbrels,-1,"theme/theme1.xml",Gn.THEME),r="xl/styles."+n,jn(s,r,m7(t,r,e)),i.styles.push(r),Ea(e.wbrels,-1,"styles."+n,Gn.STY),t.vbaraw&&a&&(r="xl/vbaProject.bin",jn(s,r,t.vbaraw),i.vba.push(r),Ea(e.wbrels,-1,"vbaProject.bin",Gn.VBA)),r="xl/metadata."+n,jn(s,r,_7(r)),i.metadata.push(r),Ea(e.wbrels,-1,"metadata."+n,Gn.XLMETA),jn(s,"[Content_Types].xml",j3(i,e)),jn(s,"_rels/.rels",Zf(e.rels)),jn(s,"xl/_rels/workbook."+n+".rels",Zf(e.wbrels)),delete e.revssf,delete e.ssf,s}function YC(t,e){ep=1024,t&&!t.SSF&&(t.SSF=Ba(Dn)),t&&t.SSF&&(Yf(),gg(t.SSF),e.revssf=N_(t.SSF),e.revssf[t.SSF[65535]]=0,e.ssf=t.SSF),e.rels={},e.wbrels={},e.Strings=[],e.Strings.Count=0,e.Strings.Unique=0,Bg?e.revStrings=new Map:(e.revStrings={},e.revStrings.foo=[],delete e.revStrings.foo);var n="xml",a=JD.indexOf(e.bookType)>-1,i=$1();hE(e=e||{});var s=u1(),r="",o=0;if(e.cellXfs=[],xc(e.cellXfs,{},{revssf:{General:0}}),t.Props||(t.Props={}),r="docProps/core.xml",jn(s,r,Z3(t.Props,e)),i.coreprops.push(r),Ea(e.rels,2,r,Gn.CORE_PROPS),r="docProps/app.xml",!(t.Props&&t.Props.SheetNames))if(!t.Workbook||!t.Workbook.Sheets)t.Props.SheetNames=t.SheetNames;else{for(var l=[],c=0;c<t.SheetNames.length;++c)(t.Workbook.Sheets[c]||{}).Hidden!=2&&l.push(t.SheetNames[c]);t.Props.SheetNames=l}t.Props.Worksheets=t.Props.SheetNames.length,jn(s,r,eD(t.Props,e)),i.extprops.push(r),Ea(e.rels,3,r,Gn.EXT_PROPS),t.Custprops!==t.Props&&oi(t.Custprops||{}).length>0&&(r="docProps/custom.xml",jn(s,r,tD(t.Custprops,e)),i.custprops.push(r),Ea(e.rels,4,r,Gn.CUST_PROPS));var d=["SheetJ5"];for(e.tcid=0,o=1;o<=t.SheetNames.length;++o){var u={"!id":{}},g=t.Sheets[t.SheetNames[o-1]],f=(g||{})["!type"]||"sheet";switch(f){case"chart":default:r="xl/worksheets/sheet"+o+"."+n,jn(s,r,hC(o-1,e,t,u)),i.sheets.push(r),Ea(e.wbrels,-1,"worksheets/sheet"+o+"."+n,Gn.WS[0])}if(g){var h=g["!comments"],m=!1,b="";if(h&&h.length>0){var y=!1;h.forEach(function(_){_[1].forEach(function(v){v.T==!0&&(y=!0)})}),y&&(b="xl/threadedComments/threadedComment"+o+"."+n,jn(s,b,jO(h,d,e)),i.threadedcomments.push(b),Ea(u,-1,"../threadedComments/threadedComment"+o+"."+n,Gn.TCMNT)),b="xl/comments"+o+"."+n,jn(s,b,ZD(h,e)),i.comments.push(b),Ea(u,-1,"../comments"+o+"."+n,Gn.CMNT),m=!0}g["!legacy"]&&m&&jn(s,"xl/drawings/vmlDrawing"+o+".vml",KD(o,g["!comments"])),delete g["!comments"],delete g["!legacy"]}u["!id"].rId1&&jn(s,Eg(r),Zf(u))}return e.Strings!=null&&e.Strings.length>0&&(r="xl/sharedStrings."+n,jn(s,r,BD(e.Strings,e)),i.strs.push(r),Ea(e.wbrels,-1,"sharedStrings."+n,Gn.SST)),r="xl/workbook."+n,jn(s,r,xC(t,e)),i.workbooks.push(r),Ea(e.rels,1,r,Gn.WB),r="xl/theme/theme1.xml",jn(s,r,X1(t.Themes,e)),i.themes.push(r),Ea(e.wbrels,-1,"theme/theme1.xml",Gn.THEME),r="xl/styles."+n,jn(s,r,VD(t,e)),i.styles.push(r),Ea(e.wbrels,-1,"styles."+n,Gn.STY),t.vbaraw&&a&&(r="xl/vbaProject.bin",jn(s,r,t.vbaraw),i.vba.push(r),Ea(e.wbrels,-1,"vbaProject.bin",Gn.VBA)),r="xl/metadata."+n,jn(s,r,jD()),i.metadata.push(r),Ea(e.wbrels,-1,"metadata."+n,Gn.XLMETA),d.length>1&&(r="xl/persons/person.xml",jn(s,r,XO(d,e)),i.people.push(r),Ea(e.wbrels,-1,"persons/person.xml",Gn.PEOPLE)),jn(s,"[Content_Types].xml",j3(i,e)),jn(s,"_rels/.rels",Zf(e.rels)),jn(s,"xl/_rels/workbook."+n+".rels",Zf(e.wbrels)),delete e.revssf,delete e.ssf,s}function gE(t,e){var n="";switch((e||{}).type||"base64"){case"buffer":return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]];case"base64":n=xr(t.slice(0,12));break;case"binary":n=t;break;case"array":return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]];default:throw new Error("Unrecognized type "+(e&&e.type||"undefined"))}return[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3),n.charCodeAt(4),n.charCodeAt(5),n.charCodeAt(6),n.charCodeAt(7)]}function Bq(t,e){return An.find(t,"EncryptedPackage")?Fq(t,e):AC(t,e)}function $q(t,e){var n,a=t,i=e||{};return i.type||(i.type=Jn&&Buffer.isBuffer(t)?"buffer":"base64"),n=u3(a,i),Mq(n,i)}function GC(t,e){var n=0;e:for(;n<t.length;)switch(t.charCodeAt(n)){case 10:case 13:case 32:++n;break;case 60:return rE(t.slice(n),e);default:break e}return Jf.to_workbook(t,e)}function Oq(t,e){var n="",a=gE(t,e);switch(e.type){case"base64":n=xr(t);break;case"binary":n=t;break;case"buffer":n=t.toString("binary");break;case"array":n=Gd(t);break;default:throw new Error("Unrecognized type "+e.type)}return a[0]==239&&a[1]==187&&a[2]==191&&(n=Ia(n)),e.type="binary",GC(n,e)}function Rq(t,e){var n=t;return e.type=="base64"&&(n=xr(n)),n=pa.utils.decode(1200,n.slice(2),"str"),e.type="binary",GC(n,e)}function Uq(t){return t.match(/[^\x00-\x7F]/)?Ko(t):t}function mE(t,e,n,a){return a?(n.type="string",Jf.to_workbook(t,n)):Jf.to_workbook(e,n)}function sw(t,e){C_();var n=e||{};if(typeof ArrayBuffer!="undefined"&&t instanceof ArrayBuffer)return sw(new Uint8Array(t),(n=Ba(n),n.type="array",n));typeof Uint8Array!="undefined"&&t instanceof Uint8Array&&!n.type&&(n.type=typeof Deno!="undefined"?"buffer":"array");var a=t,i=[0,0,0,0],s=!1;if(n.cellStyles&&(n.cellNF=!0,n.sheetStubs=!0),np={},n.dateNF&&(np.dateNF=n.dateNF),n.type||(n.type=Jn&&Buffer.isBuffer(t)?"buffer":"base64"),n.type=="file"&&(n.type=Jn?"buffer":"binary",a=q6(t),typeof Uint8Array!="undefined"&&!Jn&&(n.type="array")),n.type=="string"&&(s=!0,n.type="binary",n.codepage=65001,a=Uq(t)),n.type=="array"&&typeof Uint8Array!="undefined"&&t instanceof Uint8Array&&typeof ArrayBuffer!="undefined"){var r=new ArrayBuffer(3),o=new Uint8Array(r);if(o.foo="bar",!o.foo)return n=Ba(n),n.type="array",sw(r1(a),n)}switch((i=gE(a,n))[0]){case 208:if(i[1]===207&&i[2]===17&&i[3]===224&&i[4]===161&&i[5]===177&&i[6]===26&&i[7]===225)return Bq(An.read(a,n),n);break;case 9:if(i[1]<=8)return AC(a,n);break;case 60:return rE(a,n);case 73:if(i[1]===73&&i[2]===42&&i[3]===0)throw new Error("TIFF Image File is not a spreadsheet");if(i[1]===68)return ZB(a,n);break;case 84:if(i[1]===65&&i[2]===66&&i[3]===76)return PD.to_workbook(a,n);break;case 80:return i[1]===75&&i[2]<9&&i[3]<9?$q(a,n):mE(t,a,n,s);case 239:return i[3]===60?rE(a,n):mE(t,a,n,s);case 255:if(i[1]===254)return Rq(a,n);if(i[1]===0&&i[2]===2&&i[3]===0)return su.to_workbook(a,n);break;case 0:if(i[1]===0&&(i[2]>=2&&i[3]===0||i[2]===0&&(i[3]===8||i[3]===9)))return su.to_workbook(a,n);break;case 3:case 131:case 139:case 140:return V1.to_workbook(a,n);case 123:if(i[1]===92&&i[2]===114&&i[3]===116)return HD.to_workbook(a,n);break;case 10:case 13:case 32:return Oq(a,n);case 137:if(i[1]===80&&i[2]===78&&i[3]===71)throw new Error("PNG Image File is not a spreadsheet");break}return XB.indexOf(i[0])>-1&&i[2]<=12&&i[3]<=31?V1.to_workbook(a,n):mE(t,a,n,s)}function Xz(t,e){var n=e||{};return n.type="file",sw(t,n)}function jC(t,e){switch(e.type){case"base64":case"binary":break;case"buffer":case"array":e.type="";break;case"file":return mg(e.file,An.write(t,{type:Jn?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+e.bookType+"' files");default:throw new Error("Unrecognized type "+e.type)}return An.write(t,e)}function Hq(t,e){var n=Ba(e||{}),a=Pq(t,n);return KC(a,n)}function qq(t,e){var n=Ba(e||{}),a=YC(t,n);return KC(a,n)}function KC(t,e){var n={},a=Jn?"nodebuffer":typeof Uint8Array!="undefined"?"array":"string";if(e.compression&&(n.compression="DEFLATE"),e.password)n.type=a;else switch(e.type){case"base64":n.type="base64";break;case"binary":n.type="string";break;case"string":throw new Error("'string' output type invalid for '"+e.bookType+"' files");case"buffer":case"file":n.type=a;break;default:throw new Error("Unrecognized type "+e.type)}var i=t.FullPaths?An.write(t,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[n.type]||n.type,compression:!!e.compression}):t.generate(n);if(typeof Deno!="undefined"&&typeof i=="string"){if(e.type=="binary"||e.type=="base64")return i;i=new Uint8Array(fg(i))}return e.password&&typeof encrypt_agile!="undefined"?jC(encrypt_agile(i,e.password),e):e.type==="file"?mg(e.file,i):e.type=="string"?Ia(i):i}function Wq(t,e){var n=e||{},a=z7(t,n);return jC(a,n)}function Qo(t,e,n){n||(n="");var a=n+t;switch(e.type){case"base64":return ug(Ko(a));case"binary":return Ko(a);case"string":return t;case"file":return mg(e.file,a,"utf8");case"buffer":return Jn?kl(a,"utf8"):typeof TextEncoder!="undefined"?new TextEncoder().encode(a):Qo(a,{type:"binary"}).split("").map(function(i){return i.charCodeAt(0)})}throw new Error("Unrecognized type "+e.type)}function Vq(t,e){switch(e.type){case"base64":return ug(t);case"binary":return t;case"string":return t;case"file":return mg(e.file,t,"binary");case"buffer":return Jn?kl(t,"binary"):t.split("").map(function(n){return n.charCodeAt(0)})}throw new Error("Unrecognized type "+e.type)}function rw(t,e){switch(e.type){case"string":case"base64":case"binary":for(var n="",a=0;a<t.length;++a)n+=String.fromCharCode(t[a]);return e.type=="base64"?ug(n):e.type=="string"?Ia(n):n;case"file":return mg(e.file,t);case"buffer":return t;default:throw new Error("Unrecognized type "+e.type)}}function XC(t,e){C_(),vC(t);var n=Ba(e||{});if(n.cellStyles&&(n.cellNF=!0,n.sheetStubs=!0),n.type=="array"){n.type="binary";var a=XC(t,n);return n.type="array",fg(a)}return qq(t,n)}function bE(t,e){C_(),vC(t);var n=Ba(e||{});if(n.cellStyles&&(n.cellNF=!0,n.sheetStubs=!0),n.type=="array"){n.type="binary";var a=bE(t,n);return n.type="array",fg(a)}var i=0;if(n.sheet&&(typeof n.sheet=="number"?i=n.sheet:i=t.SheetNames.indexOf(n.sheet),!t.SheetNames[i]))throw new Error("Sheet not found: "+n.sheet+" : "+typeof n.sheet);switch(n.bookType||"xlsb"){case"xml":case"xlml":return Qo(O7(t,n),n);case"slk":case"sylk":return Qo(FD.from_sheet(t.Sheets[t.SheetNames[i]],n),n);case"htm":case"html":return Qo(FC(t.Sheets[t.SheetNames[i]],n),n);case"txt":return Vq(eL(t.Sheets[t.SheetNames[i]],n),n);case"csv":return Qo(_E(t.Sheets[t.SheetNames[i]],n),n,"\uFEFF");case"dif":return Qo(PD.from_sheet(t.Sheets[t.SheetNames[i]],n),n);case"dbf":return rw(V1.from_sheet(t.Sheets[t.SheetNames[i]],n),n);case"prn":return Qo(Jf.from_sheet(t.Sheets[t.SheetNames[i]],n),n);case"rtf":return Qo(HD.from_sheet(t.Sheets[t.SheetNames[i]],n),n);case"eth":return Qo(ND.from_sheet(t.Sheets[t.SheetNames[i]],n),n);case"fods":return Qo(qC(t,n),n);case"wk1":return rw(su.sheet_to_wk1(t.Sheets[t.SheetNames[i]],n),n);case"wk3":return rw(su.book_to_wk3(t,n),n);case"biff2":n.biff||(n.biff=2);case"biff3":n.biff||(n.biff=3);case"biff4":return n.biff||(n.biff=4),rw(TC(t,n),n);case"biff5":n.biff||(n.biff=5);case"biff8":case"xla":case"xls":return n.biff||(n.biff=8),Wq(t,n);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return Hq(t,n);default:throw new Error("Unrecognized bookType |"+n.bookType+"|")}}function yE(t){if(!t.bookType){var e={xls:"biff8",htm:"html",slk:"sylk",socialcalc:"eth",Sh33tJS:"WTF"},n=t.file.slice(t.file.lastIndexOf(".")).toLowerCase();n.match(/^\.[a-z]+$/)&&(t.bookType=n.slice(1)),t.bookType=e[t.bookType]||t.bookType}}function Zz(t,e,n){var a=n||{};return a.type="file",a.file=e,yE(a),bE(t,a)}function Jz(t,e,n){var a=n||{};return a.type="file",a.file=e,yE(a),XC(t,a)}function Qz(t,e,n,a){var i=n||{};i.type="file",i.file=t,yE(i),i.type="buffer";var s=a;return s instanceof Function||(s=n),bc.writeFile(t,bE(e,i),s)}function ZC(t,e,n,a,i,s,r,o){var l=ci(n),c=o.defval,d=o.raw||!Object.prototype.hasOwnProperty.call(o,"raw"),u=!0,g=i===1?[]:{};if(i!==1)if(Object.defineProperty)try{Object.defineProperty(g,"__rowNum__",{value:n,enumerable:!1})}catch(b){g.__rowNum__=n}else g.__rowNum__=n;if(!r||t[n])for(var f=e.s.c;f<=e.e.c;++f){var h=r?t[n][f]:t[a[f]+l];if(h===void 0||h.t===void 0){if(c===void 0)continue;s[f]!=null&&(g[s[f]]=c);continue}var m=h.v;switch(h.t){case"z":if(m==null)break;continue;case"e":m=m==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+h.t)}if(s[f]!=null){if(m==null)if(h.t=="e"&&m===null)g[s[f]]=null;else if(c!==void 0)g[s[f]]=c;else if(d&&m===null)g[s[f]]=null;else continue;else g[s[f]]=d&&(h.t!=="n"||h.t==="n"&&o.rawNumbers!==!1)?m:Xo(h,m,o);m!=null&&(u=!1)}}return{row:g,isempty:u}}function ow(t,e){if(t==null||t["!ref"]==null)return[];var n={t:"n",v:0},a=0,i=1,s=[],r=0,o="",l={s:{r:0,c:0},e:{r:0,c:0}},c=e||{},d=c.range!=null?c.range:t["!ref"];switch(c.header===1?a=1:c.header==="A"?a=2:Array.isArray(c.header)?a=3:c.header==null&&(a=0),typeof d){case"string":l=oa(d);break;case"number":l=oa(t["!ref"]),l.s.r=d;break;default:l=d}a>0&&(i=0);var u=ci(l.s.r),g=[],f=[],h=0,m=0,b=Array.isArray(t),y=l.s.r,_=0,v={};b&&!t[y]&&(t[y]=[]);var U=c.skipHidden&&t["!cols"]||[],ee=c.skipHidden&&t["!rows"]||[];for(_=l.s.c;_<=l.e.c;++_)if(!(U[_]||{}).hidden)switch(g[_]=Ga(_),n=b?t[y][_]:t[g[_]+u],a){case 1:s[_]=_-l.s.c;break;case 2:s[_]=g[_];break;case 3:s[_]=c.header[_-l.s.c];break;default:if(n==null&&(n={w:"__EMPTY",t:"s"}),o=r=Xo(n,null,c),m=v[r]||0,!m)v[r]=1;else{do o=r+"_"+m++;while(v[o]);v[r]=m,v[o]=1}s[_]=o}for(y=l.s.r+i;y<=l.e.r;++y)if(!(ee[y]||{}).hidden){var Z=ZC(t,l,y,g,a,s,b,c);(Z.isempty===!1||(a===1?c.blankrows!==!1:c.blankrows))&&(f[h++]=Z.row)}return f.length=h,f}var JC=/"/g;function QC(t,e,n,a,i,s,r,o){for(var l=!0,c=[],d="",u=ci(n),g=e.s.c;g<=e.e.c;++g)if(a[g]){var f=o.dense?(t[n]||[])[g]:t[a[g]+u];if(f==null)d="";else if(f.v!=null){l=!1,d=""+(o.rawNumbers&&f.t=="n"?f.v:Xo(f,null,o));for(var h=0,m=0;h!==d.length;++h)if((m=d.charCodeAt(h))===i||m===s||m===34||o.forceQuotes){d='"'+d.replace(JC,'""')+'"';break}d=="ID"&&(d='"ID"')}else f.f!=null&&!f.F?(l=!1,d="="+f.f,d.indexOf(",")>=0&&(d='"'+d.replace(JC,'""')+'"')):d="";c.push(d)}return o.blankrows===!1&&l?null:c.join(r)}function _E(t,e){var n=[],a=e==null?{}:e;if(t==null||t["!ref"]==null)return"";var i=oa(t["!ref"]),s=a.FS!==void 0?a.FS:",",r=s.charCodeAt(0),o=a.RS!==void 0?a.RS:`
`,l=o.charCodeAt(0),c=new RegExp((s=="|"?"\\|":s)+"+$"),d="",u=[];a.dense=Array.isArray(t);for(var g=a.skipHidden&&t["!cols"]||[],f=a.skipHidden&&t["!rows"]||[],h=i.s.c;h<=i.e.c;++h)(g[h]||{}).hidden||(u[h]=Ga(h));for(var m=0,b=i.s.r;b<=i.e.r;++b)(f[b]||{}).hidden||(d=QC(t,i,b,u,r,l,s,a),d!=null&&(a.strip&&(d=d.replace(c,"")),(d||a.blankrows!==!1)&&n.push((m++?o:"")+d)));return delete a.dense,n.join("")}function eL(t,e){e||(e={}),e.FS="	",e.RS=`
`;var n=_E(t,e);if(typeof pa=="undefined"||e.type=="string")return n;var a=pa.utils.encode(1200,n,"str");return"\xFF\xFE"+a}function zq(t){var e="",n,a="";if(t==null||t["!ref"]==null)return[];var i=oa(t["!ref"]),s="",r=[],o,l=[],c=Array.isArray(t);for(o=i.s.c;o<=i.e.c;++o)r[o]=Ga(o);for(var d=i.s.r;d<=i.e.r;++d)for(s=ci(d),o=i.s.c;o<=i.e.c;++o)if(e=r[o]+s,n=c?(t[d]||[])[o]:t[e],a="",n!==void 0){if(n.F!=null){if(e=n.F,!n.f)continue;a=n.f,e.indexOf(":")==-1&&(e=e+":"+e)}if(n.f!=null)a=n.f;else{if(n.t=="z")continue;if(n.t=="n"&&n.v!=null)a=""+n.v;else if(n.t=="b")a=n.v?"TRUE":"FALSE";else if(n.w!==void 0)a="'"+n.w;else{if(n.v===void 0)continue;n.t=="s"?a="'"+n.v:a=""+n.v}}l[l.length]=e+"="+a}return l}function tL(t,e,n){var a=n||{},i=+!a.skipHeader,s=t||{},r=0,o=0;if(s&&a.origin!=null)if(typeof a.origin=="number")r=a.origin;else{var l=typeof a.origin=="string"?ti(a.origin):a.origin;r=l.r,o=l.c}var c,d={s:{c:0,r:0},e:{c:o,r:r+e.length-1+i}};if(s["!ref"]){var u=oa(s["!ref"]);d.e.c=Math.max(d.e.c,u.e.c),d.e.r=Math.max(d.e.r,u.e.r),r==-1&&(r=u.e.r+1,d.e.r=r+e.length-1+i)}else r==-1&&(r=0,d.e.r=e.length-1+i);var g=a.header||[],f=0;e.forEach(function(m,b){oi(m).forEach(function(y){(f=g.indexOf(y))==-1&&(g[f=g.length]=y);var _=m[y],v="z",U="",ee=Nn({c:o+f,r:r+b+i});c=qg(s,ee),_&&typeof _=="object"&&!(_ instanceof Date)?s[ee]=_:(typeof _=="number"?v="n":typeof _=="boolean"?v="b":typeof _=="string"?v="s":_ instanceof Date?(v="d",a.cellDates||(v="n",_=Ri(_)),U=a.dateNF||Dn[14]):_===null&&a.nullError&&(v="e",_=0),c?(c.t=v,c.v=_,delete c.w,delete c.R,U&&(c.z=U)):s[ee]=c={t:v,v:_},U&&(c.z=U))})}),d.e.c=Math.max(d.e.c,o+g.length-1);var h=ci(r);if(i)for(f=0;f<g.length;++f)s[Ga(f+o)+h]={t:"s",v:g[f]};return s["!ref"]=Yn(d),s}function Yq(t,e){return tL(null,t,e)}function qg(t,e,n){if(typeof e=="string"){if(Array.isArray(t)){var a=ti(e);return t[a.r]||(t[a.r]=[]),t[a.r][a.c]||(t[a.r][a.c]={t:"z"})}return t[e]||(t[e]={t:"z"})}return typeof e!="number"?qg(t,Nn(e)):qg(t,Nn({r:e,c:n||0}))}function Gq(t,e){if(typeof e=="number"){if(e>=0&&t.SheetNames.length>e)return e;throw new Error("Cannot find sheet # "+e)}else if(typeof e=="string"){var n=t.SheetNames.indexOf(e);if(n>-1)return n;throw new Error("Cannot find sheet name |"+e+"|")}else throw new Error("Cannot find sheet |"+e+"|")}function wE(){return{SheetNames:[],Sheets:{}}}function vE(t,e,n,a){var i=1;if(!n)for(;i<=65535&&t.SheetNames.indexOf(n="Sheet"+i)!=-1;++i,n=void 0);if(!n||t.SheetNames.length>=65535)throw new Error("Too many worksheets");if(a&&t.SheetNames.indexOf(n)>=0){var s=n.match(/(^.*?)(\d+)$/);i=s&&+s[2]||0;var r=s&&s[1]||n;for(++i;i<=65535&&t.SheetNames.indexOf(n=r+i)!=-1;++i);}if(wC(n),t.SheetNames.indexOf(n)>=0)throw new Error("Worksheet with name |"+n+"| already exists!");return t.SheetNames.push(n),t.Sheets[n]=e,n}function jq(t,e,n){t.Workbook||(t.Workbook={}),t.Workbook.Sheets||(t.Workbook.Sheets=[]);var a=Gq(t,e);switch(t.Workbook.Sheets[a]||(t.Workbook.Sheets[a]={}),n){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+n)}t.Workbook.Sheets[a].Hidden=n}function Kq(t,e){return t.z=e,t}function nL(t,e,n){return e?(t.l={Target:e},n&&(t.l.Tooltip=n)):delete t.l,t}function Xq(t,e,n){return nL(t,"#"+e,n)}function Zq(t,e,n){t.c||(t.c=[]),t.c.push({t:e,a:n||"SheetJS"})}function Jq(t,e,n,a){for(var i=typeof e!="string"?e:oa(e),s=typeof e=="string"?e:Yn(e),r=i.s.r;r<=i.e.r;++r)for(var o=i.s.c;o<=i.e.c;++o){var l=qg(t,r,o);l.t="n",l.F=s,delete l.v,r==i.s.r&&o==i.s.c&&(l.f=n,a&&(l.D=!0))}return t}var xE={encode_col:Ga,encode_row:ci,encode_cell:Nn,encode_range:Yn,decode_col:A1,decode_row:S1,split_cell:_8,decode_cell:ti,decode_range:Tr,format_cell:Xo,sheet_add_aoa:R3,sheet_add_json:tL,sheet_add_dom:PC,aoa_to_sheet:Xf,json_to_sheet:Yq,table_to_sheet:NC,table_to_book:cq,sheet_to_csv:_E,sheet_to_txt:eL,sheet_to_json:ow,sheet_to_html:FC,sheet_to_formulae:zq,sheet_to_row_object_array:ow,sheet_get_cell:qg,book_new:wE,book_append_sheet:vE,book_set_sheet_visibility:jq,cell_set_number_format:Kq,cell_set_hyperlink:nL,cell_set_internal_link:Xq,cell_add_comment:Zq,sheet_set_array_formula:Jq,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}},lw;function Qq(t){lw=t}function eW(t,e){var n=lw(),a=e==null?{}:e;if(t==null||t["!ref"]==null)return n.push(null),n;var i=oa(t["!ref"]),s=a.FS!==void 0?a.FS:",",r=s.charCodeAt(0),o=a.RS!==void 0?a.RS:`
`,l=o.charCodeAt(0),c=new RegExp((s=="|"?"\\|":s)+"+$"),d="",u=[];a.dense=Array.isArray(t);for(var g=a.skipHidden&&t["!cols"]||[],f=a.skipHidden&&t["!rows"]||[],h=i.s.c;h<=i.e.c;++h)(g[h]||{}).hidden||(u[h]=Ga(h));var m=i.s.r,b=!1,y=0;return n._read=function(){if(!b)return b=!0,n.push("\uFEFF");for(;m<=i.e.r;)if(++m,!(f[m-1]||{}).hidden&&(d=QC(t,i,m-1,u,r,l,s,a),d!=null&&(a.strip&&(d=d.replace(c,"")),d||a.blankrows!==!1)))return n.push((y++?o:"")+d);return n.push(null)},n}function tW(t,e){var n=lw(),a=e||{},i=a.header!=null?a.header:LC,s=a.footer!=null?a.footer:IC;n.push(i);var r=Tr(t["!ref"]);a.dense=Array.isArray(t),n.push(MC(t,r,a));var o=r.s.r,l=!1;return n._read=function(){if(o>r.e.r)return l||(l=!0,n.push("</table>"+s)),n.push(null);for(;o<=r.e.r;){n.push(CC(t,r,o,a)),++o;break}},n}function nW(t,e){var n=lw({objectMode:!0});if(t==null||t["!ref"]==null)return n.push(null),n;var a={t:"n",v:0},i=0,s=1,r=[],o=0,l="",c={s:{r:0,c:0},e:{r:0,c:0}},d=e||{},u=d.range!=null?d.range:t["!ref"];switch(d.header===1?i=1:d.header==="A"?i=2:Array.isArray(d.header)&&(i=3),typeof u){case"string":c=oa(u);break;case"number":c=oa(t["!ref"]),c.s.r=u;break;default:c=u}i>0&&(s=0);var g=ci(c.s.r),f=[],h=0,m=Array.isArray(t),b=c.s.r,y=0,_={};m&&!t[b]&&(t[b]=[]);var v=d.skipHidden&&t["!cols"]||[],U=d.skipHidden&&t["!rows"]||[];for(y=c.s.c;y<=c.e.c;++y)if(!(v[y]||{}).hidden)switch(f[y]=Ga(y),a=m?t[b][y]:t[f[y]+g],i){case 1:r[y]=y-c.s.c;break;case 2:r[y]=f[y];break;case 3:r[y]=d.header[y-c.s.c];break;default:if(a==null&&(a={w:"__EMPTY",t:"s"}),l=o=Xo(a,null,d),h=_[o]||0,!h)_[o]=1;else{do l=o+"_"+h++;while(_[l]);_[o]=h,_[l]=1}r[y]=l}return b=c.s.r+s,n._read=function(){for(;b<=c.e.r;)if(!(U[b-1]||{}).hidden){var ee=ZC(t,c,b,f,i,r,m,d);if(++b,ee.isempty===!1||(i===1?d.blankrows!==!1:d.blankrows)){n.push(ee.row);return}}return n.push(null)},n}var eY={to_json:nW,to_html:tW,to_csv:eW,set_readable:Qq};const tY=lg.version;var cw=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class aW extends Wa{constructor(e){super({app:e.app,id:e.tab.id}),window.siyuan.config.fileTree.openFilesUseCurrentTab&&e.tab.headElement.classList.add("item--unupdate"),this.element=e.tab.panelElement,this.path=e.path,this.element.addEventListener("click",()=>{Vo(),ca(this.element.parentElement.parentElement)}),this.render()}getPublicFileUrl(){const e=window.location.host;let n=e;(e.includes("localhost")||e.includes("127.0.0.1"))&&(n="156.233.228.53:6806");const a=window.location.protocol;if(this.path.startsWith("http://")||this.path.startsWith("https://"))return this.path;if(this.path.startsWith("file://"))return null;let i=this.path;i.startsWith("assets/")?i="public-assets/"+i.substring(7):i.startsWith("/assets/")&&(i="/public-assets/"+i.substring(8));const s=i.split("/"),o=s.map((c,d)=>d===s.length-1?encodeURIComponent(c):c).join("/"),l=o.startsWith("/")?o:"/"+o;return a+"//"+n+l}getLocalFileUrl(){if(this.path.startsWith("http://")||this.path.startsWith("https://"))return this.path;if(this.path.startsWith("file://"))return this.path;const e=window.location.origin,n=this.path.startsWith("/")?this.path:"/"+this.path;return console.log("[DocumentViewer] path:",this.path,"url:",e+n),e+n}render(){const e=_n().extname(this.path).toLowerCase().split("?")[0],n=this.getLocalFileUrl(),a=[".md",".markdown",".txt",".json",".xml",".css",".js",".ts",".py",".go",".java",".c",".cpp",".h",".sh",".yaml",".yml",".toml",".ini",".conf",".log"],i=[".doc",".docx",".xls",".xlsx",".ppt",".pptx",".odt",".ods",".odp"];a.includes(e)?this.renderTextFile(n,e):i.includes(e)?this.renderOfficeFile(n):this.renderGenericFile(n)}renderTextFile(e,n){return cw(this,null,function*(){const a=this.getFileName();this.element.innerHTML="";const i=document.createElement("div");i.style.cssText="width:100%;height:100%;display:flex;flex-direction:column;background:var(--b3-theme-background)";const s=document.createElement("div");s.style.cssText="padding:8px 16px;background:var(--b3-theme-surface);border-bottom:1px solid var(--b3-border-color);display:flex;align-items:center;gap:8px";const r=document.createElement("span");r.style.cssText="color:var(--b3-theme-on-surface);font-size:13px;font-weight:500",r.textContent=a,s.appendChild(r);const o=document.createElement("div");o.style.flex="1",s.appendChild(o);const l=document.createElement("a");l.href=e,l.download="",l.className="b3-button b3-button--small b3-button--outline",l.style.textDecoration="none",l.textContent="\u4E0B\u8F7D",s.appendChild(l);const c=document.createElement("div");c.style.cssText="flex:1;overflow:auto;padding:16px",c.innerHTML="<div style='text-align:center;padding:40px'><img src='/stage/loading-pure.svg' style='width:48px'></div>",i.appendChild(s),i.appendChild(c),this.element.appendChild(i);try{const d=yield fetch(e);if(!d.ok)throw new Error("HTTP "+d.status);const u=yield d.text();if(n===".md"||n===".markdown"){const g=document.createElement("pre");g.style.cssText="margin:0;padding:16px;background:var(--b3-theme-surface);border-radius:4px;overflow:auto;font-family:var(--b3-font-family-code);font-size:13px;line-height:1.6;white-space:pre-wrap;word-break:break-all";const f=document.createElement("code");f.textContent=u,g.appendChild(f),c.innerHTML="";const h=document.createElement("div");h.style.cssText="max-width:900px;margin:0 auto",h.appendChild(g),c.appendChild(h)}else{const g=document.createElement("pre");g.style.cssText="margin:0;padding:16px;background:var(--b3-theme-surface);border-radius:4px;overflow:auto;font-family:var(--b3-font-family-code);font-size:13px;line-height:1.6;white-space:pre-wrap;word-break:break-all";const f=document.createElement("code");f.textContent=u,g.appendChild(f),c.innerHTML="",c.appendChild(g)}}catch(d){c.innerHTML="<div style='text-align:center;color:var(--b3-theme-error)'>\u52A0\u8F7D\u5931\u8D25: "+d.message+"</div>"}})}renderOfficeFile(e){return cw(this,null,function*(){const n=this.getFileName(),a=_n().extname(this.path).toLowerCase().split("?")[0];this.element.innerHTML="";const i=document.createElement("div");i.style.cssText="width:100%;height:100%;display:flex;flex-direction:column;background:var(--b3-theme-background)";const s=document.createElement("div");s.style.cssText="padding:8px 16px;background:var(--b3-theme-surface);border-bottom:1px solid var(--b3-border-color);display:flex;align-items:center;gap:8px";const r=document.createElement("span");r.style.cssText="color:var(--b3-theme-on-surface);font-size:13px;font-weight:500",r.textContent=n,s.appendChild(r);const o=document.createElement("div");o.style.flex="1",s.appendChild(o);const l=document.createElement("a");l.href=e,l.download="",l.className="b3-button b3-button--small b3-button--outline",l.style.textDecoration="none",l.textContent="\u4E0B\u8F7D",s.appendChild(l);const c=document.createElement("div");if(c.style.cssText="flex:1;overflow:auto;padding:16px",c.innerHTML="<div style='text-align:center;padding:40px'><img src='/stage/loading-pure.svg' style='width:48px'><p style='margin-top:16px;color:var(--b3-theme-on-surface-light)'>\u6B63\u5728\u52A0\u8F7D\u6587\u6863...</p></div>",i.appendChild(s),i.appendChild(c),this.element.appendChild(i),a===".docx")try{const d=yield fetch(e);if(!d.ok)throw new Error("HTTP "+d.status);const u=yield d.arrayBuffer(),g=yield r6.aY({arrayBuffer:u}),f=document.createElement("div");f.style.cssText="max-width:900px;margin:0 auto;background:white;padding:32px;border-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,0.1)",f.innerHTML=g.value;const h=document.createElement("style");h.textContent=`
                    .docx-preview { color: #333; font-family: 'Times New Roman', serif; line-height: 1.6; }
                    .docx-preview h1 { font-size: 24px; margin: 24px 0 16px; }
                    .docx-preview h2 { font-size: 20px; margin: 20px 0 12px; }
                    .docx-preview h3 { font-size: 16px; margin: 16px 0 8px; }
                    .docx-preview p { margin: 8px 0; }
                    .docx-preview table { border-collapse: collapse; width: 100%; margin: 16px 0; }
                    .docx-preview td, .docx-preview th { border: 1px solid #ddd; padding: 8px; }
                    .docx-preview img { max-width: 100%; height: auto; }
                    .docx-preview ul, .docx-preview ol { margin: 8px 0; padding-left: 24px; }
                `,f.classList.add("docx-preview"),c.innerHTML="",c.appendChild(h),c.appendChild(f),g.messages&&g.messages.length>0&&console.log("[DocumentViewer] mammoth warnings:",g.messages)}catch(d){console.error("[DocumentViewer] mammoth error:",d),c.innerHTML=`<div style='text-align:center;padding:40px'>
                    <p style='color:var(--b3-theme-error);margin-bottom:16px'>\u6587\u6863\u9884\u89C8\u5931\u8D25: ${d.message}</p>
                    <a href='${e}' download class='b3-button b3-button--outline' style='text-decoration:none'>\u4E0B\u8F7D\u6587\u4EF6</a>
                </div>`}else a===".pptx"?yield this.renderPptxFile(e,c):a===".xls"||a===".xlsx"?yield this.renderExcelFile(e,c):c.innerHTML=`<div style='text-align:center;padding:40px'>
                <p style='color:var(--b3-theme-on-surface-light);margin-bottom:16px'>\u6B64\u6587\u4EF6\u7C7B\u578B (${a}) \u6682\u4E0D\u652F\u6301\u5728\u7EBF\u9884\u89C8</p>
                <a href='${e}' download class='b3-button b3-button--outline' style='text-decoration:none'>\u4E0B\u8F7D\u6587\u4EF6</a>
            </div>`})}renderPptxFile(e,n){return cw(this,null,function*(){var a,i,s;try{const r=yield fetch(e);if(!r.ok)throw new Error("HTTP "+r.status);const o=yield r.arrayBuffer(),l=yield l6().loadAsync(o),c=[];if(l.forEach(b=>{b.match(/^ppt\/slides\/slide\d+\.xml$/)&&c.push(b)}),c.sort((b,y)=>{var _,v;const U=parseInt(((_=b.match(/slide(\d+)\.xml/))==null?void 0:_[1])||"0"),ee=parseInt(((v=y.match(/slide(\d+)\.xml/))==null?void 0:v[1])||"0");return U-ee}),c.length===0)throw new Error("\u65E0\u6CD5\u89E3\u6790 PPTX \u6587\u4EF6\uFF1A\u672A\u627E\u5230\u5E7B\u706F\u7247");const d=[],u=new Map,g=[];l.forEach((b,y)=>{if(b.startsWith("ppt/media/")){const _=y.async("base64").then(v=>{var U;const ee=((U=b.split(".").pop())==null?void 0:U.toLowerCase())||"png",Z=ee==="jpg"||ee==="jpeg"?"image/jpeg":ee==="png"?"image/png":ee==="gif"?"image/gif":"image/png";u.set(b,`data:${Z};base64,${v}`)});g.push(_)}}),yield Promise.all(g);for(const b of c){const y=yield(a=l.file(b))==null?void 0:a.async("string");if(!y)continue;const _={texts:[],images:[]},v=y.matchAll(/<a:t>([^<]*)<\/a:t>/g);for(const k of v){const w=k[1].trim();w&&_.texts.push(w)}const ee=`ppt/slides/_rels/slide${(i=b.match(/slide(\d+)\.xml/))==null?void 0:i[1]}.xml.rels`,Z=yield(s=l.file(ee))==null?void 0:s.async("string");if(Z){const k=Z.matchAll(/Target="([^"]*media\/[^"]*)"/g);for(const w of k){let S=w[1];S.startsWith("../")&&(S="ppt/"+S.substring(3));const B=u.get(S);B&&_.images.push(B)}}d.push(_)}n.innerHTML="";const f=document.createElement("style");f.textContent=`
                .pptx-container { max-width: 1000px; margin: 0 auto; }
                .pptx-slide { 
                    background: white; 
                    border-radius: 8px; 
                    box-shadow: 0 2px 8px rgba(0,0,0,0.15); 
                    margin-bottom: 24px; 
                    overflow: hidden;
                }
                .pptx-slide-header {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 8px 16px;
                    font-size: 12px;
                    font-weight: 500;
                }
                .pptx-slide-content {
                    padding: 24px;
                    min-height: 200px;
                    aspect-ratio: 16/9;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                }
                .pptx-slide-text {
                    color: #333;
                    font-size: 18px;
                    line-height: 1.6;
                    margin-bottom: 8px;
                }
                .pptx-slide-text:first-child {
                    font-size: 24px;
                    font-weight: 600;
                    color: #1a1a1a;
                    margin-bottom: 16px;
                }
                .pptx-slide-images {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 12px;
                    margin-top: 16px;
                }
                .pptx-slide-images img {
                    max-width: 100%;
                    max-height: 300px;
                    border-radius: 4px;
                    object-fit: contain;
                }
                .pptx-nav {
                    position: sticky;
                    top: 0;
                    background: var(--b3-theme-surface);
                    padding: 12px 16px;
                    margin: -16px -16px 16px -16px;
                    border-bottom: 1px solid var(--b3-border-color);
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    z-index: 10;
                }
                .pptx-nav-info {
                    color: var(--b3-theme-on-surface);
                    font-size: 13px;
                }
            `,n.appendChild(f);const h=document.createElement("div");h.className="pptx-nav",h.innerHTML=`<span class="pptx-nav-info">\u5171 ${d.length} \u5F20\u5E7B\u706F\u7247</span>`,n.appendChild(h);const m=document.createElement("div");m.className="pptx-container",d.forEach((b,y)=>{const _=document.createElement("div");_.className="pptx-slide",_.id=`slide-${y+1}`;const v=document.createElement("div");v.className="pptx-slide-header",v.textContent=`\u5E7B\u706F\u7247 ${y+1}`,_.appendChild(v);const U=document.createElement("div");if(U.className="pptx-slide-content",b.texts.forEach(ee=>{const Z=document.createElement("p");Z.className="pptx-slide-text",Z.textContent=ee,U.appendChild(Z)}),b.images.length>0){const ee=document.createElement("div");ee.className="pptx-slide-images",b.images.forEach(Z=>{const k=document.createElement("img");k.src=Z,k.alt="\u5E7B\u706F\u7247\u56FE\u7247",ee.appendChild(k)}),U.appendChild(ee)}if(b.texts.length===0&&b.images.length===0){const ee=document.createElement("p");ee.style.cssText="color: #999; font-style: italic; text-align: center;",ee.textContent="(\u7A7A\u767D\u5E7B\u706F\u7247)",U.appendChild(ee)}_.appendChild(U),m.appendChild(_)}),n.appendChild(m)}catch(r){console.error("[DocumentViewer] PPTX preview error:",r),n.innerHTML=`<div style='text-align:center;padding:40px'>
                <p style='color:var(--b3-theme-error);margin-bottom:16px'>PPT \u9884\u89C8\u5931\u8D25: ${r.message}</p>
                <a href='${e}' download class='b3-button b3-button--outline' style='text-decoration:none'>\u4E0B\u8F7D\u6587\u4EF6</a>
            </div>`}})}renderExcelFile(e,n){return cw(this,null,function*(){try{const a=yield fetch(e);if(!a.ok)throw new Error("HTTP "+a.status);const i=yield a.arrayBuffer(),s=sw(i,{type:"array"});if(!s.SheetNames||s.SheetNames.length===0)throw new Error("\u65E0\u6CD5\u89E3\u6790 Excel \u6587\u4EF6\uFF1A\u672A\u627E\u5230\u5DE5\u4F5C\u8868");n.innerHTML="";const r=document.createElement("style");r.textContent=`
                .xlsx-container { max-width: 100%; margin: 0 auto; }
                .xlsx-tabs {
                    display: flex;
                    gap: 4px;
                    padding: 8px 0;
                    border-bottom: 1px solid var(--b3-border-color);
                    margin-bottom: 16px;
                    flex-wrap: wrap;
                }
                .xlsx-tab {
                    padding: 6px 16px;
                    background: var(--b3-theme-surface);
                    border: 1px solid var(--b3-border-color);
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 13px;
                    color: var(--b3-theme-on-surface);
                    transition: all 0.2s;
                }
                .xlsx-tab:hover {
                    background: var(--b3-theme-surface-lighter);
                }
                .xlsx-tab.active {
                    background: var(--b3-theme-primary);
                    color: var(--b3-theme-on-primary);
                    border-color: var(--b3-theme-primary);
                }
                .xlsx-sheet {
                    display: none;
                    overflow: auto;
                }
                .xlsx-sheet.active {
                    display: block;
                }
                .xlsx-table {
                    border-collapse: collapse;
                    width: 100%;
                    font-size: 13px;
                    background: white;
                }
                .xlsx-table th, .xlsx-table td {
                    border: 1px solid #ddd;
                    padding: 8px 12px;
                    text-align: left;
                    white-space: nowrap;
                    max-width: 300px;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }
                .xlsx-table th {
                    background: #f5f5f5;
                    font-weight: 600;
                    position: sticky;
                    top: 0;
                    z-index: 1;
                }
                .xlsx-table tr:nth-child(even) {
                    background: #fafafa;
                }
                .xlsx-table tr:hover {
                    background: #f0f7ff;
                }
                .xlsx-row-num {
                    background: #f5f5f5 !important;
                    color: #666;
                    font-weight: 500;
                    text-align: center !important;
                    min-width: 40px;
                }
                .xlsx-info {
                    color: var(--b3-theme-on-surface-light);
                    font-size: 12px;
                    margin-top: 8px;
                }
            `,n.appendChild(r);const o=document.createElement("div");o.className="xlsx-tabs";const l=document.createElement("div");l.className="xlsx-container",s.SheetNames.forEach((c,d)=>{var u;const g=document.createElement("button");g.className="xlsx-tab"+(d===0?" active":""),g.textContent=c,g.onclick=()=>{var H;o.querySelectorAll(".xlsx-tab").forEach(j=>j.classList.remove("active")),g.classList.add("active"),l.querySelectorAll(".xlsx-sheet").forEach(j=>j.classList.remove("active")),(H=l.querySelector(`#sheet-${d}`))==null||H.classList.add("active")},o.appendChild(g);const f=document.createElement("div");f.className="xlsx-sheet"+(d===0?" active":""),f.id=`sheet-${d}`;const h=s.Sheets[c],m=xE.decode_range(h["!ref"]||"A1"),b=m.e.r-m.s.r+1,y=m.e.c-m.s.c+1,_=Math.min(b,1e3),v=Math.min(y,50),U=document.createElement("table");U.className="xlsx-table";const ee=document.createElement("thead"),Z=document.createElement("tr"),k=document.createElement("th");k.className="xlsx-row-num",k.textContent="",Z.appendChild(k);for(let H=0;H<v;H++){const j=document.createElement("th");j.textContent=xE.encode_col(m.s.c+H),Z.appendChild(j)}ee.appendChild(Z),U.appendChild(ee);const w=document.createElement("tbody");for(let H=0;H<_;H++){const j=document.createElement("tr"),re=document.createElement("td");re.className="xlsx-row-num",re.textContent=String(m.s.r+H+1),j.appendChild(re);for(let Te=0;Te<v;Te++){const Be=document.createElement("td"),Ie=xE.encode_cell({r:m.s.r+H,c:m.s.c+Te}),Ce=h[Ie];Ce&&(Ce.t==="n"&&Ce.v!==void 0?(Be.textContent=Ce.w||String(Ce.v),Be.style.textAlign="right"):Ce.t==="d"?Be.textContent=Ce.w||String(Ce.v):Be.textContent=Ce.w||((u=Ce.v)==null?void 0:u.toString())||"",Be.title=Be.textContent),j.appendChild(Be)}w.appendChild(j)}U.appendChild(w),f.appendChild(U);const S=document.createElement("div");S.className="xlsx-info";let B=`\u5171 ${b} \u884C \xD7 ${y} \u5217`;(b>_||y>v)&&(B+=` (\u663E\u793A\u524D ${_} \u884C \xD7 ${v} \u5217)`),S.textContent=B,f.appendChild(S),l.appendChild(f)}),n.appendChild(o),n.appendChild(l)}catch(a){console.error("[DocumentViewer] Excel preview error:",a),n.innerHTML=`<div style='text-align:center;padding:40px'>
                <p style='color:var(--b3-theme-error);margin-bottom:16px'>Excel \u9884\u89C8\u5931\u8D25: ${a.message}</p>
                <a href='${e}' download class='b3-button b3-button--outline' style='text-decoration:none'>\u4E0B\u8F7D\u6587\u4EF6</a>
            </div>`}})}renderGenericFile(e){const n=this.getFileName();this.element.innerHTML="";const a=document.createElement("div");a.style.cssText="width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--b3-theme-background)";const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.style.cssText="width:80px;height:80px;color:var(--b3-theme-on-surface-light)",i.innerHTML="<use xlink:href='#iconFile'></use>",a.appendChild(i);const s=document.createElement("h3");s.style.cssText="margin:24px 0 8px;color:var(--b3-theme-on-background);font-size:18px",s.textContent=n,a.appendChild(s);const r=document.createElement("p");r.style.cssText="margin:0 0 24px;color:var(--b3-theme-on-surface-light);font-size:13px",r.textContent="\u6B64\u6587\u4EF6\u7C7B\u578B\u6682\u4E0D\u652F\u6301\u9884\u89C8",a.appendChild(r);const o=document.createElement("a");o.href=e,o.download="",o.className="b3-button b3-button--outline",o.style.textDecoration="none",o.textContent="\u4E0B\u8F7D\u6587\u4EF6",a.appendChild(o),this.element.appendChild(a)}getFileName(){try{return decodeURIComponent(_n().basename(this.path).split("?")[0])}catch(e){return _n().basename(this.path).split("?")[0]}}}class Ll extends Wa{constructor(e){var n;super({app:e.app,id:e.tab.id}),window.siyuan.config.fileTree.openFilesUseCurrentTab&&((n=e.tab.headElement)==null||n.classList.add("item--unupdate")),this.element=e.tab.panelElement,this.config=e.config,this.editors=X2(e.app,this.config,this.element),this.element.addEventListener("click",()=>{Vo(),ca(this.element.parentElement.parentElement)})}updateSearch(e,n){const a=this.element.querySelector(".b3-text-field");if(e===""){a.select();return}const i=a.value;i!==e&&(n||(i.indexOf(e)>-1?e=i.replace(e+" ","").replace(" "+e,""):i!==""&&(e=i+" "+e)),a.value=e,a.select(),a.dispatchEvent(new CustomEvent("input")))}}class ko extends Wa{constructor(e){var n;super({app:e.app,id:e.tab.id}),this.editors=[],window.siyuan.config.fileTree.openFilesUseCurrentTab&&((n=e.tab.headElement)==null||n.classList.add("item--unupdate")),this.element=e.tab.panelElement,this.tab=e.tab,this.data=e.data,this.type=e.type,this.init=e.init,this.destroy=e.destroy,this.beforeDestroy=e.beforeDestroy,this.resize=e.resize,this.update=e.update,this.init(this)}}var EE=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const kE=t=>{let e;const n=new ko({app:t.app,type:"siyuan-card",tab:t.tab,data:t.data,init(){return EE(this,null,function*(){if(t.data.cardsData){let a=t.data.cardsData;for(let i=0;i<t.app.plugins.length;i++)a=yield t.app.plugins[i].updateCards(t.data.cardsData);this.element.innerHTML=Py({id:this.data.id,cardType:this.data.cardType,cardsData:a,isTab:!0}),e=yield Ny({app:t.app,element:this.element,id:this.data.id,title:this.data.title,cardType:this.data.cardType,cardsData:a,index:t.data.index}),n.editors.push(e),delete t.data.cardsData,delete t.data.index}else ae(this.data.cardType==="all"?"/api/riff/getRiffDueCards":this.data.cardType==="doc"?"/api/riff/getTreeRiffDueCards":"/api/riff/getNotebookRiffDueCards",{rootID:this.data.id,deckID:this.data.id,notebook:this.data.id},a=>EE(this,null,function*(){let i=a.data;for(let s=0;s<t.app.plugins.length;s++)i=yield t.app.plugins[s].updateCards(i);this.element.innerHTML=Py({id:this.data.id,cardType:this.data.cardType,cardsData:i,isTab:!0}),e=yield Ny({app:t.app,element:this.element,id:this.data.id,title:this.data.title,cardType:this.data.cardType,cardsData:i}),n.editors.push(e)}))})},destroy(){e&&e.destroy()},resize(){e&&e.resize()},update(){ae(this.data.cardType==="all"?"/api/riff/getRiffDueCards":this.data.cardType==="doc"?"/api/riff/getTreeRiffDueCards":"/api/riff/getNotebookRiffDueCards",{rootID:this.data.id,deckID:this.data.id,notebook:this.data.id},a=>EE(this,null,function*(){let i=a.data;for(let s=0;s<t.app.plugins.length;s++)i=yield t.app.plugins[s].updateCards(i);n.editors.forEach(s=>{s.destroy()}),this.element.innerHTML=Py({id:this.data.id,cardType:this.data.cardType,cardsData:i,isTab:!0}),e=yield Ny({app:t.app,element:this.element,id:this.data.id,title:this.data.title,cardType:this.data.cardType,cardsData:i}),n.editors.push(e)}))}});return n.element.addEventListener("click",()=>{Vo(),ca(n.element.parentElement.parentElement)}),n};var aL=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const dn=t=>aL(void 0,null,function*(){const e=yield wn("/api/block/getBlockInfo",{id:t.id});if(e.code!==-1){if(e.code===3){Q(e.msg);return}return qs({app:t.app,fileName:e.data.rootTitle,rootIcon:e.data.rootIcon,rootID:e.data.rootID,id:t.id,position:t.position,mode:t.mode,action:t.action,zoomIn:t.zoomIn,keepCursor:t.keepCursor,removeCurrentTab:t.removeCurrentTab,afterOpen:t.afterOpen,openNewTab:t.openNewTab})}}),kc=(t,e,n,a)=>{const i=_n().extname(e).split("?")[0];p.SIYUAN_ASSETS_EXTS.includes(i)&&qs({app:t,assetPath:e,page:n,position:a,removeCurrentTab:!0})},qs=t=>aL(void 0,null,function*(){typeof t.removeCurrentTab=="undefined"&&(t.removeCurrentTab=!0),document.querySelectorAll(".av__panel, .av__mask").forEach(i=>{i.remove()}),document.activeElement instanceof HTMLElement&&document.activeElement.blur();const e=Cn();if(t.assetPath){Vo();const i=e.asset.find(s=>{if(s.path==t.assetPath)return gu(s.parent.parent.element)||(s.parent.parent.switchTab(s.parent.headElement),s.parent.parent.showHeading(),s.goToPage(t.page)),!0});if(i)return t.afterOpen&&t.afterOpen(i),i.parent}else if(t.custom){Vo();const i=e.custom.find(r=>{if(G(r.data,t.custom.data)&&(!t.custom.id||t.custom.id===r.type))return gu(r.parent.parent.element)||(r.parent.parent.switchTab(r.parent.headElement),r.parent.parent.showHeading()),!0});if(i)return t.afterOpen&&t.afterOpen(i),i.parent;const s=SE(t);if(s)return t.afterOpen&&t.afterOpen(s.model),s}else if(t.searchData){Vo();const i=e.search.find(s=>{if(G(s.config,t.searchData))return gu(s.parent.parent.element)||(s.parent.parent.switchTab(s.parent.headElement),s.parent.parent.showHeading()),!0});if(i)return i.parent}else if(!t.position&&!t.openNewTab){let i,s;if(e.editor.find(o=>{if(o.editor.protyle.block.rootID===t.rootID&&(N(o.element,"layout__wnd--active")&&(s=o),(!i||o.headElement.getAttribute("data-activetime")>i.headElement.getAttribute("data-activetime"))&&(i=o)),s)return!0}),s&&(i=s),i)return gu(i.parent.parent.element)||iL(i,t,e),t.afterOpen&&t.afterOpen(i),i.parent;const r=SE(t);if(r)return t.afterOpen&&t.afterOpen(r.model),r}let n;const a=document.querySelector(".layout__wnd--active");if(a&&(n=mi(a.getAttribute("data-id"))),n||(n=nm(window.siyuan.layout.centerLayout)),n){let i;if((t.position==="right"||t.position==="bottom")&&n.children[0].headElement){const s=t.position==="right"?"lr":"tb";let r;if(n.parent.children.length>1&&n.parent instanceof Gr&&n.parent.direction===s&&n.parent.children.find((o,l)=>{if(o.id===n.id){let c=n.parent.children[l+1];for(c||(c=n);c instanceof Gr;)c=c.children[0];return r=c,!0}}),r){if(gu(r.element)){t.afterOpen&&t.afterOpen();return}let o=r.children.find(l=>{if(l.model&&l.model instanceof Ma&&l.model.editor.protyle.block.rootID===t.rootID)return iL(l.model,t,e),!0});o||(o=SE(t),i=o),o||(i=Wg(t),r.addTab(i))}else i=Wg(t),n.split(s).addTab(i);return n.showHeading(),t.afterOpen&&t.afterOpen(i?i.model:void 0),i}if(gu(n.element)){t.afterOpen&&t.afterOpen();return}if(t.keepCursor&&n.children[0].headElement)i=Wg(t),i.headElement.setAttribute("keep-cursor",t.id),n.addTab(i,t.keepCursor);else if(window.siyuan.config.fileTree.openFilesUseCurrentTab){let s;n.children.find(r=>{if(r.headElement&&r.headElement.classList.contains("item--unupdate")&&!r.headElement.classList.contains("item--pin")&&(s=r,r.headElement.classList.contains("item--focus")))return!0}),i=Wg(t),n.addTab(i),s&&t.removeCurrentTab&&n.removeTab(s.id,!1,!1)}else i=Wg(t),n.addTab(i);return n.showHeading(),t.afterOpen&&t.afterOpen(i.model),i}}),SE=t=>So().find(e=>{var n;const a=(n=e.headElement)==null?void 0:n.getAttribute("data-initdata");if(a){const i=JSON.parse(a);if(i.instance==="Editor"&&(i.rootId===t.rootID||i.blockId===t.rootID))return i.blockId=t.id,i.mode=t.mode,t.zoomIn?i.action=[p.CB_GET_ALL,p.CB_GET_FOCUS]:i.action=t.action,e.headElement.setAttribute("data-initdata",JSON.stringify(i)),e.parent.switchTab(e.headElement),!0;if(i.instance==="Custom"&&t.custom&&G(i.customModelData,t.custom.data))return e.parent.switchTab(e.headElement),!0}}),iL=(t,e,n)=>{var a,i,s,r;if(e.keepCursor)return t.parent.headElement.setAttribute("keep-cursor",e.id),!0;if(t.parent.parent.switchTab(t.parent.headElement),t.parent.parent.showHeading(),e.mode!=="preview"&&!t.editor.protyle.preview.element.classList.contains("fn__none"))return!0;if(e.zoomIn)return hi({protyle:t.editor.protyle,id:e.id}),!0;let o;if(Array.from(t.editor.protyle.wysiwyg.element.querySelectorAll(`[data-node-id="${e.id}"]`)).find(l=>{if(!ge(l))return o=l,!0}),(!o||(o==null?void 0:o.clientHeight)===0)&&e.id!==e.rootID)ae("/api/filetree/getDoc",{id:e.id,mode:e.action&&e.action.includes(p.CB_GET_CONTEXT)?3:0,size:window.siyuan.config.editor.dynamicLoadBlocks},l=>{_a({data:l,protyle:t.editor.protyle,action:e.action}),TE(n,t.editor.protyle)});else{if(es(t.editor.protyle),(a=t.editor.protyle.observerLoad)==null||a.disconnect(),(i=e.action)!=null&&i.includes(p.CB_GET_HL))dr(t.editor.protyle,e.id,"start");else if((s=e.action)!=null&&s.includes(p.CB_GET_FOCUS))if(o){const l=qt(o,void 0,!((r=e.action)!=null&&r.includes(p.CB_GET_OUTLINE)));l&&(t.editor.protyle.toolbar.range=l),kn(t.editor.protyle),t.editor.protyle.observerLoad=new ResizeObserver(()=>{document.contains(o)&&kn(t.editor.protyle)}),setTimeout(()=>{t.editor.protyle.observerLoad.disconnect()},1e3*3),t.editor.protyle.observerLoad.observe(t.editor.protyle.wysiwyg.element)}else t.editor.protyle.block.rootID===e.id||t.editor.protyle.toolbar.range&&(o=oe(t.editor.protyle.toolbar.range.startContainer),Pt(t.editor.protyle.toolbar.range),kn(t.editor.protyle));Hf(t.editor.protyle,t.editor.protyle.toolbar.range)}e.mode&&Hd(t.editor.protyle,e.mode)},Wg=t=>{let e;if(t.assetPath){const n=_n().extname(t.assetPath).split("?")[0].toLowerCase();if(p.SIYUAN_ASSETS_EXTS.includes(n)){let a="iconPDF";p.SIYUAN_ASSETS_IMAGE.includes(n)?a="iconImage":p.SIYUAN_ASSETS_AUDIO.includes(n)?a="iconRecord":p.SIYUAN_ASSETS_VIDEO.includes(n)?a="iconVideo":(p.SIYUAN_ASSETS_DOCUMENT.includes(n)||p.SIYUAN_ASSETS_TEXT.includes(n))&&(a="iconFile"),p.SIYUAN_ASSETS_DOCUMENT.includes(n)||p.SIYUAN_ASSETS_TEXT.includes(n)?e=new Sa({icon:a,title:ha(t.assetPath),callback(i){i.addModel(new aW({app:t.app,tab:i,path:t.assetPath})),ca(i.panelElement.parentElement.parentElement)}}):e=new Sa({icon:a,title:ha(t.assetPath),callback(i){i.addModel(new El({app:t.app,tab:i,path:t.assetPath,page:t.page})),ca(i.panelElement.parentElement.parentElement)}})}}else t.custom?e=new Sa({icon:t.custom.icon,title:t.custom.title,callback(n){t.custom.id?t.custom.id==="siyuan-card"?n.addModel(kE({app:t.app,tab:n,data:t.custom.data})):t.app.plugins.find(a=>{if(a.models[t.custom.id])return n.addModel(a.models[t.custom.id]({tab:n,data:t.custom.data})),!0}):(console.warn("0.8.3 \u5C06\u79FB\u9664 custom.fn \u53C2\u6570\uFF0C\u8BF7\u53C2\u7167 https://github.com/siyuan-note/plugin-sample/blob/91a716358941791b4269241f21db25fd22ae5ff5/src/index.ts \u5C06\u5176\u4FEE\u6539\u4E3A custom.id"),n.addModel(t.custom.fn({tab:n,data:t.custom.data}))),ca(n.panelElement.parentElement.parentElement)}}):t.searchData?e=new Sa({icon:"iconSearch",title:window.siyuan.languages.search,callback(n){n.addModel(new Ll({app:t.app,tab:n,config:t.searchData})),ca(n.panelElement.parentElement.parentElement)}}):e=new Sa({title:ha(t.fileName,!0,!0),docIcon:t.rootIcon,callback(n){let a;t.zoomIn?a=new Ma({app:t.app,tab:n,blockId:t.id,rootId:t.rootID,action:[p.CB_GET_ALL,p.CB_GET_FOCUS]}):a=new Ma({app:t.app,tab:n,blockId:t.id,rootId:t.rootID,mode:t.mode,action:t.action}),n.addModel(a)}});return e},sp=t=>{var e;if(t.protyle&&t.protyle.path){if(t.protyle.element.classList.contains("fn__none")||!N(t.protyle.element,"layout__wnd--active")&&document.querySelector(".layout__wnd--active"))return;if(t.resize&&Ai(t.protyle),t.focus&&(t.protyle.toolbar.range?(Pt(t.protyle.toolbar.range),du(t.protyle.toolbar.range,t.protyle.block.rootID),t.pushBackStack&&t.protyle.preview.element.classList.contains("fn__none")&&Hf(t.protyle,t.protyle.toolbar.range)):(qt(t.protyle.wysiwyg.element.firstElementChild),t.pushBackStack&&t.protyle.preview.element.classList.contains("fn__none")&&Hf(t.protyle,void 0,t.protyle.wysiwyg.element.firstElementChild),ss([],t.protyle.block.rootID))),window.siyuan.config.fileTree.alwaysSelectOpenedFile&&t.protyle){const a=(e=Vn("file"))==null?void 0:e.data.file;if(a instanceof js){const i=a.element.querySelector(`li[data-path="${t.protyle.path}"]`);(!i||i&&!i.classList.contains("b3-list-item--focus"))&&a.selectItem(t.protyle.notebookId,t.protyle.path)}}t.protyle.app.plugins.forEach(a=>{a.eventBus.emit("switch-protyle",{protyle:t.protyle})})}const n=Cn();AE(n,t.protyle,t.reload),TE(n,t.protyle)},sL=t=>{const e=document.querySelector(".layout__wnd--active > .fn__flex > .layout-tab-bar > .item--focus");if(e){const n=mi(e.getAttribute("data-id"));if(n instanceof Sa&&n.model instanceof Ma&&(n.model.editor.protyle.block.rootID===t||n.model.editor.protyle.block.parentID===t||n.model.editor.protyle.block.id===t))return!0}return!1},AE=(t,e,n=!1)=>{t.outline.find(a=>{var i;if(n||a.type==="pin"&&(!e||a.blockId!==((i=e.block)==null?void 0:i.rootID)||a.isPreview===e.preview.element.classList.contains("fn__none"))){let s="";if(e&&e.block&&(s=e.block.rootID),s===a.blockId&&!n&&a.isPreview!==e.preview.element.classList.contains("fn__none"))return;ae("/api/outline/getDocOutline",{id:s,preview:!e.preview.element.classList.contains("fn__none")},r=>{var o;if(!(!n&&(!sL(s)||a.blockId===s)&&a.isPreview!==e.preview.element.classList.contains("fn__none")))if(a.isPreview=!e.preview.element.classList.contains("fn__none"),a.update(r,s),e){if(a.updateDocTitle(e.background.ial,((o=r.data)==null?void 0:o.length)||0),getSelection().rangeCount>0){const l=getSelection().getRangeAt(0).startContainer;if(e.wysiwyg.element.contains(l)){const c=ue(l,"data-node-id",null);c&&a.setCurrent(c)}}}else a.updateDocTitle()})}})},TE=(t,e)=>{e&&e.element.classList.contains("fn__none")||e&&!N(e.element,"layout__wnd--active")&&document.querySelector(".layout__wnd--active")||(t.graph.forEach(n=>{var a,i;if(n.type!=="global"&&(!e||n.blockId!==((a=e.block)==null?void 0:a.id))){if(n.type==="local"&&n.rootId!==((i=e==null?void 0:e.block)==null?void 0:i.rootID))return;let s="";if(e&&e.block&&(s=e.block.showAll?e.block.id:e.block.parentID),s===n.blockId)return;n.searchGraph(!0,s)}}),t.backlink.forEach(n=>{var a;if(n.type==="local"&&n.rootId!==((a=e==null?void 0:e.block)==null?void 0:a.rootID))return;let i="";e&&e.block&&(i=e.block.showAll?e.block.id:e.block.parentID),i!==n.blockId&&(n.element.querySelector('.block__icon[data-type="refresh"] svg').classList.add("fn__rotate"),ae("/api/ref/getBacklink2",{sort:n.status[i]?n.status[i].sort.toString():window.siyuan.config.editor.backlinkSort.toString(),mSort:n.status[i]?n.status[i].mSort.toString():window.siyuan.config.editor.backmentionSort.toString(),id:i||"",k:n.inputsElement[0].value,mk:n.inputsElement[1].value},s=>{if(!sL(i)||n.blockId===i){n.element.querySelector('.block__icon[data-type="refresh"] svg').classList.remove("fn__rotate");return}n.saveStatus(),n.blockId=i,n.render(s.data)}))}))},rL=(t,e)=>{};class Vg{constructor(e){this.editors=[],this.id=K(),this.targetElement=e.targetElement,this.refDefs=e.refDefs,this.app=e.app,this.x=e.x,this.y=e.y,this.isBacklink=e.isBacklink,this.originalRefBlockIDs=e.originalRefBlockIDs,this.element=document.createElement("div"),this.element.classList.add("block__popover");const n=N(this.targetElement,"block__popover",!0);let a=1;n?(this.element.setAttribute("data-oid",n.getAttribute("data-oid")),a=parseInt(n.getAttribute("data-level"))+1):this.element.setAttribute("data-oid",this.refDefs[0].refID),this.element.setAttribute("data-level",a.toString());for(let i=0;i<window.siyuan.blockPanels.length;i++){const s=window.siyuan.blockPanels[i];s.element.getAttribute("data-pin")==="false"&&s.targetElement&&parseInt(s.element.getAttribute("data-level"))>=a&&(s.destroy(),i--)}document.body.insertAdjacentElement("beforeend",this.element),this.targetElement&&(this.targetElement.style.cursor="wait"),this.element.setAttribute("data-pin","false"),this.element.addEventListener("dblclick",i=>{const s=i.target,r=N(s,"block__icons");if(r){const o=r.querySelector('[data-type="pin"]');this.element.getAttribute("data-pin")==="true"?(o.setAttribute("aria-label",window.siyuan.languages.pin),o.querySelector("use").setAttribute("xlink:href","#iconPin"),this.element.setAttribute("data-pin","false")):(o.setAttribute("aria-label",window.siyuan.languages.unpin),o.querySelector("use").setAttribute("xlink:href","#iconUnpin"),this.element.setAttribute("data-pin","true")),i.preventDefault(),i.stopPropagation()}}),this.element.addEventListener("click",i=>{this.element&&window.siyuan.blockPanels.length>1&&(this.element.style.zIndex=(++window.siyuan.zIndex).toString());let s=i.target;for(;s&&!s.isEqualNode(this.element);){if(s.classList.contains("block__icon")||s.classList.contains("block__logo")){const r=s.getAttribute("data-type");r==="close"?this.destroy():r==="pin"?this.element.getAttribute("data-pin")==="true"?(s.setAttribute("aria-label",window.siyuan.languages.pin),s.querySelector("use").setAttribute("xlink:href","#iconPin"),this.element.setAttribute("data-pin","false")):(s.setAttribute("aria-label",window.siyuan.languages.unpin),s.querySelector("use").setAttribute("xlink:href","#iconUnpin"),this.element.setAttribute("data-pin","true")):r==="open"||r==="stickTab"&&(na(this.refDefs[0].refID,(o,l)=>{dn({app:e.app,id:this.refDefs[0].refID,action:l,zoomIn:o,openNewTab:!0})}),this.destroy()),i.preventDefault(),i.stopPropagation();break}s=s.parentElement}}),os(this.element,()=>{const i=this.element.firstElementChild.querySelector('[data-type="pin"]');i.setAttribute("aria-label",window.siyuan.languages.unpin),i.querySelector("use").setAttribute("xlink:href","#iconUnpin"),this.element.setAttribute("data-pin","true")}),this.render()}initProtyle(e,n){const a=parseInt(e.getAttribute("data-index"));ae("/api/block/getBlockInfo",{id:this.refDefs[a].refID},i=>{if(i.code===3){Q(i.msg);return}if(!this.targetElement&&typeof this.x=="undefined"&&typeof this.y=="undefined")return;const s=[];i.data.rootID!==this.refDefs[a].refID?s.push(p.CB_GET_ALL):s.push(p.CB_GET_CONTEXT),this.isBacklink&&s.push(p.CB_GET_BACKLINK);const r=new ar(this.app,e,{blockId:this.refDefs[a].refID,defIds:this.refDefs[a].defIDs||[],originalRefBlockIDs:this.isBacklink?this.originalRefBlockIDs:void 0,action:s,render:{scroll:!0,gutter:!0,breadcrumbDocName:!0,title:i.data.rootID===this.refDefs[a].refID},typewriterMode:!1,after:o=>{i.data.rootID!==this.refDefs[a].refID&&o.protyle.breadcrumb.element.parentElement.lastElementChild.classList.remove("fn__none"),n&&n(),(o.protyle.element.nextElementSibling||o.protyle.element.previousElementSibling)&&(o.protyle.element.style.minHeight=Math.min(30+o.protyle.wysiwyg.element.clientHeight,window.innerHeight/3)+"px"),o.protyle.scroll.element.parentElement.setAttribute("style",`--b3-dynamicscroll-width:${Math.min(o.protyle.contentElement.clientHeight-49,200)}px;`)}});this.editors.push(r)})}destroy(){var e,n,a;(e=this.observerResize)==null||e.disconnect(),(n=this.observerLoad)==null||n.disconnect(),window.siyuan.blockPanels.find((r,o)=>{if(r.id===this.id)return window.siyuan.blockPanels.splice(o,1),!0}),this.editors.length>0&&(this.editors.forEach(r=>{Ut(["util"],r.protyle),r.destroy()}),this.editors=[]);const i=parseInt(this.element.dataset.level);this.element.remove(),this.element=void 0,this.targetElement=void 0;const s=parseInt(window.siyuan.menus.menu.element.dataset.from);s&&s>=i&&((a=window.siyuan.menus.menu.element.dataset.from)!=null&&a.includes("popover"))&&window.siyuan.menus.menu.remove()}render(){if(!document.body.contains(this.element)){this.destroy();return}let e="";this.refDefs.length===1&&(e=`<span data-type="stickTab" class="block__icon block__icon--show b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.openInNewTab}${un(window.siyuan.config.keymap.editor.general.openInNewTab.custom)}"><svg><use xlink:href="#iconOpen"></use></svg></span>
<span class="fn__space"></span>`);let n=`<div class="block__icons block__icons--menu">
    <span class="fn__space fn__flex-1 resize__move"></span>${e}
    <span data-type="pin" class="block__icon block__icon--show b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.pin}"><svg><use xlink:href="#iconPin"></use></svg></span>
    <span class="fn__space"></span>
    <span data-type="close" class="block__icon block__icon--show b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.close}${un(window.siyuan.config.keymap.general.closeTab.custom)}"><svg style="width: 12px;margin: 0 1px;"><use xlink:href="#iconClose"></use></svg></span>
</div>
<div class="block__content">`;this.refDefs.length===0?n+=`<div class="ft__smaller ft__smaller ft__secondary b3-form__space--small" contenteditable="false">${window.siyuan.languages.refExpired}</div>`:this.refDefs.forEach((i,s)=>{n+=`<div class="block__edit fn__flex-1 protyle" data-index="${s}"></div>`}),n&&(n+='</div><div class="resize__rd"></div><div class="resize__ld"></div><div class="resize__lt"></div><div class="resize__rt"></div><div class="resize__r"></div><div class="resize__d"></div><div class="resize__t"></div><div class="resize__l"></div>'),this.element.innerHTML=n;let a;this.observerResize=new ResizeObserver(()=>{clearTimeout(a),a=window.setTimeout(()=>{this.editors.forEach(i=>{Ai(i.protyle)})},p.TIMEOUT_TRANSITION)}),this.observerResize.observe(this.element),this.observerLoad=new IntersectionObserver(i=>{i.forEach(s=>{s.isIntersecting&&s.target.innerHTML===""&&this.initProtyle(s.target)})},{threshold:0}),this.element.querySelectorAll(".block__edit").forEach((i,s)=>{s<5?this.initProtyle(i,s===0?()=>{if(!document.contains(this.element))return;let r;if(this.targetElement&&this.targetElement.classList.contains("protyle-wysiwyg__embed")){r=this.targetElement.getBoundingClientRect();let l=r.top;const c=N(this.targetElement,"protyle-content",!0);if(c){const d=c.getBoundingClientRect().top;r.top<d&&(l=d)}this.element.style.height=Math.min(window.innerHeight-p.SIZE_TOOLBAR_HEIGHT,r.height+42)+"px",gn(this.element,r.left,Math.max(l-42,p.SIZE_TOOLBAR_HEIGHT),-42,0)}else this.targetElement?(this.targetElement.classList.contains("pdf__rect")?r=this.targetElement.firstElementChild.getBoundingClientRect():r=this.targetElement.getBoundingClientRect(),window.innerHeight-r.bottom-4>r.top+12&&(this.element.style.maxHeight=Math.floor(window.innerHeight-r.bottom-12)+"px"),gn(this.element,r.left,r.bottom+4,r.height+12,8)):typeof this.x=="number"&&typeof this.y=="number"&&(gn(this.element,this.x,this.y),this.element.style.maxHeight=Math.floor(window.innerHeight-Math.max(this.y,p.SIZE_TOOLBAR_HEIGHT)-12)+"px");const o=this.element.getBoundingClientRect();this.targetElement&&!this.targetElement.classList.contains("protyle-wysiwyg__embed")&&(o.top<r.top?this.element.style.maxHeight=Math.floor(r.top-o.top-8)+"px":this.element.style.maxHeight=Math.floor(window.innerHeight-o.top-8)+"px"),this.element.classList.add("block__popover--open"),this.element.style.zIndex=(++window.siyuan.zIndex).toString()}:void 0):this.observerLoad.observe(i)}),this.targetElement&&(this.targetElement.style.cursor=""),this.element.querySelector(".block__content").addEventListener("scroll",()=>{this.editors.forEach(i=>{Ut(["gutter"],i.protyle)})})}}class Il extends Wa{constructor(e){super({app:e.app,id:e.tab.id,callback(){this.type==="local"&&ae("/api/block/checkBlockExist",{id:this.blockId},a=>{a.data||this.parent.parent.removeTab(this.parent.id)})},msgCallback(a){if(a)switch(a.cmd){case"mount":this.type==="global"&&a.code!==1&&this.searchGraph(!1);break;case"rename":this.graphData&&a.data.box===this.graphData.box&&this.rootId===a.data.id&&(this.searchGraph(!1),this.type==="local"&&this.parent.updateTitle(a.data.title)),this.type==="global"&&this.searchGraph(!1);break;case"unmount":this.type==="local"&&this.graphData&&this.graphData.box===a.data.box&&this.parent.parent.removeTab(this.parent.id);break;case"removeDoc":this.type==="local"&&a.data.ids.includes(this.rootId)&&this.parent.parent.removeTab(this.parent.id);break}}}),this.element=e.tab.panelElement,this.blockId=e.blockId,this.rootId=e.rootId,this.type=e.type,this.element.classList.add("graph","file-tree",this.type==="global"?"sy__globalGraph":"sy__graph");let n;this.type==="global"?n=`
<label>
    <span>${window.siyuan.languages.headings}</span> 
    <input data-type="heading" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.heading?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.list1}</span> 
    <input data-type="list" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.list?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.listItem}</span> 
    <input data-type="listItem" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.listItem?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.quote}</span> 
    <input data-type="blockquote" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.blockquote?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.superBlock}</span> 
    <input data-type="super" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.super?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.table}</span> 
    <input data-type="table" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.table?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.math}</span> 
    <input data-type="math" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.math?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.code}</span> 
    <input data-type="code" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.code?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.paragraph}</span> 
    <input data-type="paragraph" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.paragraph?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.dailyNote}</span>  
    <input data-type="dailyNote" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.dailyNote?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.tag}</span>  
    <input data-type="tag" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.type.tag?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.arrow}</span> 
    <input data-type="arrow" type="checkbox" class="b3-switch"${window.siyuan.config.graph.global.d3.arrow?" checked":""}/>
</label>
<label> 
    <span>${window.siyuan.languages.graphConfig2}</span>  
    <input data-type="minRefs" class="b3-slider b3-tooltips__n b3-tooltips" max="16" min="0" step="1" type="range" value="${window.siyuan.config.graph.global.minRefs}" aria-label="${window.siyuan.config.graph.global.minRefs}" />
</label>
<label>
    <span>${window.siyuan.languages.nodeSize}</span> 
    <input data-type="nodeSize" class="b3-slider b3-tooltips__n b3-tooltips" aria-label="${window.siyuan.config.graph.global.d3.nodeSize}" max="32" min="4" step="2" type="range" value="${window.siyuan.config.graph.global.d3.nodeSize}" />
</label>
<label>
    <span>${window.siyuan.languages.lineWidth}</span> 
    <input data-type="linkWidth" class="b3-tooltips b3-tooltips__n b3-slider" max="32" min="4" step="2" type="range" value="${window.siyuan.config.graph.global.d3.linkWidth}" aria-label="${window.siyuan.config.graph.global.d3.linkWidth}"/>
</label>
<label>
    <span>${window.siyuan.languages.lineOpacity}</span> 
    <input data-type="lineOpacity" class="b3-tooltips b3-tooltips__n b3-slider" max="1" min="0.1" step="0.01" type="range" value="${window.siyuan.config.graph.global.d3.lineOpacity}" aria-label="${window.siyuan.config.graph.global.d3.lineOpacity}"/>
</label>
<label>
    <span>${window.siyuan.languages.centerStrength}</span> 
    <input data-type="centerStrength" class="b3-tooltips b3-tooltips__n b3-slider" max="0.1" min="0.005" step="0.01" type="range" value="${window.siyuan.config.graph.global.d3.centerStrength}" aria-label="${window.siyuan.config.graph.global.d3.centerStrength}"/>
</label>
<label>
    <span>${window.siyuan.languages.collideRadius}</span> 
    <input data-type="collideRadius" class="b3-tooltips b3-tooltips__n b3-slider" max="5000" min="400" step="200" type="range" value="${window.siyuan.config.graph.global.d3.collideRadius}" aria-label="${window.siyuan.config.graph.global.d3.collideRadius}"/>
</label>
<label>
    <span>${window.siyuan.languages.collideStrength}</span> 
    <input data-type="collideStrength" class="b3-tooltips b3-tooltips__n b3-slider" max="1" min="0.01" step="0.01" type="range" value="${window.siyuan.config.graph.global.d3.collideStrength}" aria-label="${window.siyuan.config.graph.global.d3.collideStrength}"/>
</label>
<label>
    <span>${window.siyuan.languages.linkDistance}</span> 
    <input data-type="linkDistance" class="b3-tooltips b3-tooltips__n b3-slider" max="2000" min="100" step="100" type="range" value="${window.siyuan.config.graph.global.d3.linkDistance}" aria-label="${window.siyuan.config.graph.global.d3.linkDistance}"/>
</label>
<div class="fn__hr"></div>
<button class="b3-button b3-button--small fn__block">${window.siyuan.languages.reset}</button>`:n=`
<label>
    <span>${window.siyuan.languages.headings}</span> 
    <input data-type="heading" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.heading?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.list1}</span> 
    <input data-type="list" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.list?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.listItem}</span> 
    <input data-type="listItem" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.listItem?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.quote}</span> 
    <input data-type="blockquote" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.blockquote?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.superBlock}</span> 
    <input data-type="super" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.super?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.table}</span> 
    <input data-type="table" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.table?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.math}</span> 
    <input data-type="math" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.math?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.code}</span> 
    <input data-type="code" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.code?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.paragraph}</span> 
    <input data-type="paragraph" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.paragraph?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.dailyNote}</span>  
    <input data-type="dailyNote" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.dailyNote?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.tag}</span>  
    <input data-type="tag" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.type.tag?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.arrow}</span> 
    <input data-type="arrow" type="checkbox" class="b3-switch"${window.siyuan.config.graph.local.d3.arrow?" checked":""}/>
</label>
<label>
    <span>${window.siyuan.languages.nodeSize}</span> 
    <input data-type="nodeSize" class="b3-slider b3-tooltips__n b3-tooltips" aria-label="${window.siyuan.config.graph.local.d3.nodeSize}" max="32" min="4" step="2" type="range" value="${window.siyuan.config.graph.local.d3.nodeSize}" />
</label>
<label>
    <span>${window.siyuan.languages.lineWidth}</span> 
    <input data-type="linkWidth" class="b3-tooltips b3-tooltips__n b3-slider" max="32" min="4" step="2" type="range" value="${window.siyuan.config.graph.local.d3.linkWidth}" aria-label="${window.siyuan.config.graph.local.d3.linkWidth}"/>
</label>
<label>
    <span>${window.siyuan.languages.lineOpacity}</span> 
    <input data-type="lineOpacity" class="b3-tooltips b3-tooltips__n b3-slider" max="1" min="0.1" step="0.01" type="range" value="${window.siyuan.config.graph.local.d3.lineOpacity}" aria-label="${window.siyuan.config.graph.local.d3.lineOpacity}"/>
</label>
<label>
    <span>${window.siyuan.languages.centerStrength}</span> 
    <input data-type="centerStrength" class="b3-tooltips b3-tooltips__n b3-slider" max="0.1" min="0.005" step="0.01" type="range" value="${window.siyuan.config.graph.local.d3.centerStrength}" aria-label="${window.siyuan.config.graph.local.d3.centerStrength}"/>
</label>
<label>
    <span>${window.siyuan.languages.collideRadius}</span> 
    <input data-type="collideRadius" class="b3-tooltips b3-tooltips__n b3-slider" max="5000" min="400" step="200" type="range" value="${window.siyuan.config.graph.local.d3.collideRadius}" aria-label="${window.siyuan.config.graph.local.d3.collideRadius}"/>
</label>
<label>
    <span>${window.siyuan.languages.collideStrength}</span> 
    <input data-type="collideStrength" class="b3-tooltips b3-tooltips__n b3-slider" max="1" min="0.01" step="0.01" type="range" value="${window.siyuan.config.graph.local.d3.collideStrength}" aria-label="${window.siyuan.config.graph.local.d3.collideStrength}"/>
</label>
<label>
    <span>${window.siyuan.languages.linkDistance}</span> 
    <input data-type="linkDistance" class="b3-tooltips b3-tooltips__n b3-slider" max="2000" min="100" step="100" type="range" value="${window.siyuan.config.graph.local.d3.linkDistance}" aria-label="${window.siyuan.config.graph.local.d3.linkDistance}"/>
</label>
<div class="fn__hr"></div>
<button class="b3-button b3-button--small fn__block">${window.siyuan.languages.reset}</button>`,this.element.innerHTML=`<div class="block__icons"> 
    <div class="block__logo">
        <svg class="block__logoicon"><use xlink:href="#icon${this.type==="global"?"GlobalGraph":"Graph"}"></use></svg>${this.type==="global"?window.siyuan.languages.globalGraph:window.siyuan.languages.graphView}
    </div>
    <span class="fn__flex-1"></span>
    <span class="fn__space"></span>
    <input class="b3-text-field search__label fn__size200 fn__none" placeholder="${window.siyuan.languages.search}" />
    <span data-type="search" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.search}"><svg><use xlink:href='#iconFilter'></use></svg></span>
    <span class="fn__space"></span>
    <span data-type="refresh" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.refresh}"><svg><use xlink:href='#iconRefresh'></use></svg></span>
    <div class="fn__space"></div>
    <div data-type="fullscreen" class="b3-tooltips b3-tooltips__sw block__icon" aria-label="${window.siyuan.languages.fullscreen}">
        <svg><use xlink:href="#iconFullscreen"></use></svg>
    </div>
    <div class="fn__space"></div>
    <div data-type="menu" class="b3-tooltips b3-tooltips__sw block__icon" aria-label="${window.siyuan.languages.more}">
        <svg><use xlink:href="#iconMore"></use></svg>
    </div> 
    <span class="${this.type==="local"?"fn__none ":""}fn__space"></span>
    <span data-type="min"  class="${this.type==="local"?"fn__none ":""}block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.min}${un(window.siyuan.config.keymap.general.closeTab.custom)}"><svg><use xlink:href='#iconMin'></use></svg></span>
</div>
<div class="graph__panel">
    ${n}
</div>
<div class="fn__flex-1 graph__svg"></div>`,this.graphElement=this.element.querySelector(".graph__svg"),this.inputElement=this.element.querySelector("input"),this.panelElement=this.element.querySelector(".graph__panel"),this.element.addEventListener("click",a=>{this.type==="local"?ca(this.element.parentElement.parentElement):ca(this.element);let i=a.target;for(;i&&!i.isEqualNode(this.element);){if(i.classList.contains("b3-button")){this.type==="global"?ae("/api/graph/resetGraph",{},s=>{this.reset(s.data.conf)}):ae("/api/graph/resetLocalGraph",{},s=>{this.reset(s.data.conf)});break}else if(i.classList.contains("block__icon")){const s=i.getAttribute("data-type");if(s==="min")Vn(this.type==="global"?"globalGraph":"graph").toggleModel(this.type==="global"?"globalGraph":"graph",!1,!0);else if(s==="menu")i.classList.contains("ft__primary")?(i.classList.remove("ft__primary"),this.panelElement.style.right=""):(i.classList.add("ft__primary"),this.panelElement.style.right="0");else if(s==="search")i.previousElementSibling.classList.remove("fn__none"),i.previousElementSibling.select();else if(s==="refresh")this.searchGraph(!1,void 0,!0);else if(s==="fullscreen"){kd(this.element,i);const r=this.element.querySelector('.block__icons .block__icon[data-type="min"]');this.element.className.includes("fullscreen")?r.classList.add("fn__none"):r.classList.remove("fn__none")}break}else if(i.classList.contains("graph__svg")){this.element.querySelectorAll(".block__icon.ft__primary").forEach(s=>{s.classList.remove("ft__primary")}),this.panelElement.style.right="";break}i=i.parentElement}}),this.inputElement.addEventListener("compositionend",()=>{this.searchGraph(!1)}),this.inputElement.addEventListener("blur",a=>{a.target.classList.add("fn__none")}),this.inputElement.addEventListener("input",a=>{a.isComposing||this.searchGraph(!1)}),this.element.querySelectorAll(".b3-slider").forEach(a=>{a.addEventListener("input",()=>{a.setAttribute("aria-label",a.value),this.searchGraph(!1)})}),this.element.querySelectorAll(".b3-switch").forEach(a=>{a.addEventListener("change",()=>{this.searchGraph(!1)})}),this.searchGraph(e.type!=="global")}reset(e){this.type==="global"?(window.siyuan.config.graph.global=e,this.panelElement.querySelector("[data-type='minRefs']").setAttribute("aria-label",window.siyuan.config.graph.global.minRefs.toString()),this.panelElement.querySelector("[data-type='minRefs']").value=window.siyuan.config.graph.global.minRefs.toString()):window.siyuan.config.graph.local=e,this.inputElement.value="",this.panelElement.querySelector("[data-type='nodeSize']").setAttribute("aria-label",e.d3.nodeSize.toString()),this.panelElement.querySelector("[data-type='centerStrength']").setAttribute("aria-label",e.d3.centerStrength.toString()),this.panelElement.querySelector("[data-type='collideRadius']").setAttribute("aria-label",e.d3.collideRadius.toString()),this.panelElement.querySelector("[data-type='collideStrength']").setAttribute("aria-label",e.d3.collideStrength.toString()),this.panelElement.querySelector("[data-type='lineOpacity']").setAttribute("aria-label",e.d3.lineOpacity.toString()),this.panelElement.querySelector("[data-type='linkDistance']").setAttribute("aria-label",e.d3.linkDistance.toString()),this.panelElement.querySelector("[data-type='linkWidth']").setAttribute("aria-label",e.d3.linkWidth.toString()),this.panelElement.querySelector("[data-type='nodeSize']").value=e.d3.nodeSize.toString(),this.panelElement.querySelector("[data-type='centerStrength']").value=e.d3.centerStrength.toString(),this.panelElement.querySelector("[data-type='collideRadius']").value=e.d3.collideRadius.toString(),this.panelElement.querySelector("[data-type='collideStrength']").value=e.d3.collideStrength.toString(),this.panelElement.querySelector("[data-type='lineOpacity']").value=e.d3.lineOpacity.toString(),this.panelElement.querySelector("[data-type='linkDistance']").value=e.d3.linkDistance.toString(),this.panelElement.querySelector("[data-type='linkWidth']").value=e.d3.linkWidth.toString(),this.panelElement.querySelector("[data-type='list']").checked=e.type.list,this.panelElement.querySelector("[data-type='listItem']").checked=e.type.listItem,this.panelElement.querySelector("[data-type='math']").checked=e.type.math,this.panelElement.querySelector("[data-type='paragraph']").checked=e.type.paragraph,this.panelElement.querySelector("[data-type='super']").checked=e.type.super,this.panelElement.querySelector("[data-type='table']").checked=e.type.table,this.panelElement.querySelector("[data-type='tag']").checked=e.type.tag,this.panelElement.querySelector("[data-type='dailyNote']").checked=e.dailyNote,this.panelElement.querySelector("[data-type='heading']").checked=e.type.heading,this.panelElement.querySelector("[data-type='arrow']").checked=e.d3.arrow,this.panelElement.querySelector("[data-type='blockquote']").checked=e.type.blockquote,this.panelElement.querySelector("[data-type='code']").checked=e.type.code,this.searchGraph(!1)}searchGraph(e,n,a=!1){const i=this.element.querySelector('.block__icon[data-type="refresh"] svg');if(i.classList.contains("fn__rotate")&&!n)return;i.classList.add("fn__rotate");const s={list:this.panelElement.querySelector("[data-type='list']").checked,listItem:this.panelElement.querySelector("[data-type='listItem']").checked,math:this.panelElement.querySelector("[data-type='math']").checked,paragraph:this.panelElement.querySelector("[data-type='paragraph']").checked,super:this.panelElement.querySelector("[data-type='super']").checked,table:this.panelElement.querySelector("[data-type='table']").checked,tag:this.panelElement.querySelector("[data-type='tag']").checked,heading:this.panelElement.querySelector("[data-type='heading']").checked,blockquote:this.panelElement.querySelector("[data-type='blockquote']").checked,code:this.panelElement.querySelector("[data-type='code']").checked},r={arrow:this.panelElement.querySelector("[data-type='arrow']").checked,nodeSize:parseFloat(this.panelElement.querySelector("[data-type='nodeSize']").value),centerStrength:parseFloat(this.panelElement.querySelector("[data-type='centerStrength']").value),collideRadius:parseFloat(this.panelElement.querySelector("[data-type='collideRadius']").value),collideStrength:parseFloat(this.panelElement.querySelector("[data-type='collideStrength']").value),lineOpacity:parseFloat(this.panelElement.querySelector("[data-type='lineOpacity']").value),linkDistance:parseFloat(this.panelElement.querySelector("[data-type='linkDistance']").value),linkWidth:parseFloat(this.panelElement.querySelector("[data-type='linkWidth']").value)};this.type==="global"?ae("/api/graph/getGraph",{k:this.inputElement.value,conf:{type:s,d3:r,dailyNote:this.panelElement.querySelector("[data-type='dailyNote']").checked,minRefs:parseFloat(this.panelElement.querySelector("[data-type='minRefs']").value)}},o=>{this.graphData=o.data,window.siyuan.config.graph.global=o.data.conf,this.onGraph(!1),i.classList.remove("fn__rotate")}):ae("/api/graph/getLocalGraph",{type:this.type,k:this.inputElement.value,id:n||this.blockId,conf:{type:s,d3:r,dailyNote:this.panelElement.querySelector("[data-type='dailyNote']").checked}},o=>{i.classList.remove("fn__rotate"),n&&(this.blockId=n),!(!a&&this.type==="pin"&&this.blockId&&!Array.from(document.querySelectorAll(".fn__flex > .layout-tab-bar > .item--focus")).find(c=>{const d=mi(c.getAttribute("data-id"));if(d instanceof Sa&&d.model instanceof Ma&&(d.model.editor.protyle.block.rootID===this.blockId||d.model.editor.protyle.block.parentID===this.blockId||d.model.editor.protyle.block.id===this.blockId))return!0}))&&(this.graphData=o.data,window.siyuan.config.graph.local=o.data.conf,this.onGraph(e))})}hlNode(e){this.graphElement.clientHeight===0||!this.network||this.network.findNode(e).length===0||(this.network.focus(e,{animation:{duration:1e3,easingFunction:"easeInOutQuad"}}),this.network.selectNodes([e]))}destroy(){var e;(e=this.network)==null||e.destroy()}onGraph(e){var n;if(this.graphElement.clientHeight===0||((n=this.network)==null||n.destroy(),!this.graphData||!this.graphData.nodes||this.graphData.nodes.length===0))return;const a=getComputedStyle(document.body);this.graphData.nodes.forEach(i=>{switch(i.type){case"NodeDocument":i.color={background:a.getPropertyValue("--b3-graph-doc-point").trim()};break;case"NodeParagraph":i.color={background:a.getPropertyValue("--b3-graph-p-point").trim()};break;case"NodeHeading":i.color={background:a.getPropertyValue("--b3-graph-heading-point").trim()};break;case"NodeMathBlock":i.color={background:a.getPropertyValue("--b3-graph-math-point").trim()};break;case"NodeCodeBlock":i.color={background:a.getPropertyValue("--b3-graph-code-point").trim()};break;case"NodeTable":i.color={background:a.getPropertyValue("--b3-graph-table-point").trim()};break;case"NodeList":i.color={background:a.getPropertyValue("--b3-graph-list-point").trim()};break;case"NodeListItem":i.color={background:a.getPropertyValue("--b3-graph-listitem-point").trim()};break;case"NodeBlockquote":i.color={background:a.getPropertyValue("--b3-graph-bq-point").trim()};break;case"NodeSuperBlock":i.color={background:a.getPropertyValue("--b3-graph-super-point").trim()};break;case"tag":case"textmark tag":i.color={background:a.getPropertyValue("--b3-graph-tag-point").trim()};break;default:i.color={background:a.getPropertyValue("--b3-graph-p-point").trim()};break}}),this.graphData.links.forEach(i=>{i.ref?i.color={color:a.getPropertyValue("--b3-graph-ref-line").trim()}:i.color={color:a.getPropertyValue("--b3-graph-line").trim()}}),va(`${p.PROTYLE_CDN}/js/vis/vis-network.min.js?v=9.1.13`,"protyleVisScript").then(()=>{var i;if((i=this.network)==null||i.destroy(),!this.graphData||!this.graphData.nodes||this.graphData.nodes.length===0)return;const s=window.siyuan.config.graph[this.type==="global"?"global":"local"],r=32<this.graphData.nodes.length?.1:.5;let o=this.graphData.nodes.length;this.graphData.nodes.length>1024&&(o=1024),this.graphData.nodes.length<256&&(o=256);let l=this.graphData.nodes.length;this.graphData.nodes.length>64&&(l=64),this.graphData.nodes.length<16&&(l=8);const c={autoResize:!0,interaction:{hover:!0},nodes:{borderWidth:0,borderWidthSelected:5,shape:"dot",font:{face:a.getPropertyValue("--b3-font-family-graph").trim(),size:32,color:a.getPropertyValue("--b3-theme-on-background").trim()},color:{hover:{border:a.getPropertyValue("--b3-graph-hl-point").trim(),background:a.getPropertyValue("--b3-graph-hl-point").trim()},highlight:{border:a.getPropertyValue("--b3-graph-hl-point").trim(),background:a.getPropertyValue("--b3-graph-hl-point").trim()}}},edges:{width:s.d3.linkWidth,arrowStrikethrough:!1,smooth:!1,color:{opacity:s.d3.lineOpacity,hover:a.getPropertyValue("--b3-graph-hl-line").trim(),highlight:a.getPropertyValue("--b3-graph-hl-line").trim()}},layout:{randomSeed:0,improvedLayout:!1},physics:{enabled:!0,forceAtlas2Based:{theta:.5,gravitationalConstant:-s.d3.collideRadius,centralGravity:s.d3.centerStrength,springConstant:s.d3.collideStrength,springLength:s.d3.linkDistance,damping:.4,avoidOverlap:.5},maxVelocity:o,minVelocity:l,solver:"forceAtlas2Based",stabilization:{enabled:!0,iterations:64,updateInterval:64,onlyDynamicEdges:!1,fit:!0},timestep:r,adaptiveTimestep:!0,wind:{x:0,y:0}}};let d=Math.max(Math.ceil(this.graphData.nodes.length*.1),128),u=Math.max(Math.ceil(this.graphData.links.length*.1),128);const g=new vis.DataSet(this.graphData.nodes.slice(0,d)),f=new vis.DataSet(this.graphData.links.slice(0,u)),h=new vis.Network(this.graphElement,{nodes:g,edges:f},c),m=Math.max(.03,1-.3*Math.floor(this.graphData.nodes.length/128));m!==1&&h.moveTo({position:{x:0,y:0},scale:m,animation:!1});const b=256,y=Math.max(Math.ceil(b/8),32);let _=this.graphData.nodes.length/b/2;_<64&&(_=64),_>256&&(_=256);const v=setInterval(()=>{if(!h.images){clearInterval(U);return}const ee=this.graphData.nodes.slice(d,d+_);if(ee.length===0){clearInterval(v);return}h.body.data.nodes.add(ee),d+=_},y),U=setInterval(()=>{if(!h.images){clearInterval(U);return}const ee=this.graphData.links.slice(u,u+_);if(ee.length===0){clearInterval(U),h.fit({animation:!0});return}h.body.data.edges.add(ee),u+=_},b);this.network=h,h.on("stabilizationIterationsDone",()=>{h.physics.stopSimulation(),e&&this.hlNode(this.blockId)}),h.on("dragEnd",()=>{setTimeout(()=>{h.physics.stopSimulation()},3e3)}),h.on("click",ee=>{if(ee.nodes.length!==1)return;const Z=this.graphData.nodes.find(k=>k.id===ee.nodes[0]);if(Z){if(-1<Z.type.indexOf("tag")){Ro(this.app,`#${Z.id}#`,!window.siyuan.ctrlIsPressed,{method:0});return}window.siyuan.shiftIsPressed?na(Z.id,(k,w)=>{dn({app:this.app,id:Z.id,position:"bottom",action:w,zoomIn:k})}):window.siyuan.altIsPressed?na(Z.id,(k,w)=>{dn({app:this.app,id:Z.id,position:"right",action:w,zoomIn:k})}):window.siyuan.ctrlIsPressed?window.siyuan.blockPanels.push(new Vg({app:this.app,isBacklink:!1,x:ee.event.center.x,y:ee.event.center.y,refDefs:[{refID:Z.id}]})):na(Z.id,(k,w)=>{dn({app:this.app,id:Z.id,action:w,zoomIn:k})})}})})}}const oL=(t,e,n)=>{if(!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_BOOKMARK){window.siyuan.menus.menu.remove();return}window.siyuan.menus.menu.remove();const a=t.getAttribute("data-node-id");!a&&!window.siyuan.config.readonly&&window.siyuan.menus.menu.append(new xe({id:"rename",icon:"iconEdit",label:window.siyuan.languages.rename,click:()=>{const i=t.querySelector(".b3-list-item__text").textContent,s=new fe({title:window.siyuan.languages.rename,content:`<div class="b3-dialog__content"><input class="b3-text-field fn__block"></div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"});s.element.setAttribute("data-key",p.DIALOG_RENAMEBOOKMARK);const r=s.element.querySelectorAll(".b3-button");r[0].addEventListener("click",()=>{s.destroy()});const o=s.element.querySelector("input");s.bindInput(o,()=>{r[1].click()}),o.value=i,o.focus(),o.select(),r[1].addEventListener("click",()=>{ae("/api/bookmark/renameBookmark",{oldBookmark:i,newBookmark:o.value},()=>{s.destroy()})})}}).element),a&&window.siyuan.menus.menu.append(new xe({id:"copy",label:window.siyuan.languages.copy,type:"submenu",icon:"iconCopy",submenu:sc([t.getAttribute("data-node-id")],!1)}).element),window.siyuan.config.readonly||window.siyuan.menus.menu.append(new xe({id:"remove",icon:"iconTrashcan",label:window.siyuan.languages.remove,click:()=>{const i=t.querySelector(".b3-list-item__text").textContent;Sn(window.siyuan.languages.deleteOpConfirm,window.siyuan.languages.removeBookmark.replace("${x}",`<b>${he(i)}</b>`),()=>{a?(ae("/api/attr/setBlockAttrs",{id:a,attrs:{bookmark:""}},()=>{n.update()}),document.querySelectorAll(`.protyle-wysiwyg [data-node-id="${a}"]`).forEach(s=>{s.setAttribute("bookmark","");const r=s.querySelector(".protyle-attr--bookmark");r&&r.remove()})):ae("/api/bookmark/removeBookmark",{bookmark:i})},void 0,!0)}}).element),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_BOOKMARK),window.siyuan.menus.menu.popup({x:e.clientX-11,y:e.clientY+11,h:22,w:12})};class cu extends Wa{constructor(e,n){super({app:e,id:n.id,msgCallback(a){if(a)switch(a.cmd){case"transactions":a.data[0].doOperations.forEach(i=>{let s=!1;((i.action==="update"||i.action==="insert")&&i.data.indexOf('class="protyle-attr--bookmark"')>-1||i.action==="delete")&&(s=!0),s&&ae("/api/bookmark/getBookmark",{},r=>{this.update(r.data)})});break;case"unmount":case"removeDoc":case"mount":(a.cmd!=="mount"||a.code!==1)&&ae("/api/bookmark/getBookmark",{},i=>{this.update(i.data)});break}}}),this.element=n.panelElement,this.element.classList.add("fn__flex-column","file-tree","sy__bookmark"),this.element.innerHTML=`<div class="block__icons">
    <div class="block__logo">
        <svg class="block__logoicon"><use xlink:href="#iconBookmark"></use></svg>${window.siyuan.languages.bookmark}
    </div>
    <span class="fn__flex-1"></span>
    <span class="fn__space"></span>
    <span data-type="refresh" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.refresh}"><svg><use xlink:href='#iconRefresh'></use></svg></span>
    <span class="fn__space"></span>
    <span data-type="expand" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.expand}${un(window.siyuan.config.keymap.editor.general.expand.custom)}">
        <svg><use xlink:href="#iconExpand"></use></svg>
    </span>
    <span class="fn__space"></span>
    <span data-type="collapse" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.collapse}${un(window.siyuan.config.keymap.editor.general.collapse.custom)}">
        <svg><use xlink:href="#iconContract"></use></svg>
    </span>
    <span class="fn__space"></span>
    <span data-type="min" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.min}${un(window.siyuan.config.keymap.general.closeTab.custom)}"><svg><use xlink:href='#iconMin'></use></svg></span>
</div>
<div class="fn__flex-1" style="margin-bottom: 8px"></div>`,this.tree=new Po({element:this.element.lastElementChild,data:null,click:(a,i)=>{if(i){const r=N(i.target,"b3-list-item__action");if(r){oL(r.parentElement,i,this);return}}const s=a.getAttribute("data-node-id");na(s,(r,o)=>{dn({app:e,id:s,action:o,zoomIn:r})})},rightClick:(a,i)=>{oL(a,i,this)},ctrlClick:a=>{const i=a.getAttribute("data-node-id");na(i,s=>{dn({app:e,id:i,keepCursor:!0,action:s?[p.CB_GET_HL,p.CB_GET_ALL]:[p.CB_GET_HL,p.CB_GET_CONTEXT,p.CB_GET_ROOTSCROLL],zoomIn:s})})},altClick:a=>{const i=a.getAttribute("data-node-id");na(i,(s,r)=>{dn({app:e,id:i,position:"bottom",action:r,zoomIn:s})})},shiftClick:a=>{const i=a.getAttribute("data-node-id");na(i,(s,r)=>{dn({app:e,id:i,position:"bottom",action:r,zoomIn:s})})},blockExtHTML:'<span class="b3-list-item__action"><svg><use xlink:href="#iconMore"></use></svg></span>',topExtHTML:'<span class="b3-list-item__action"><svg><use xlink:href="#iconMore"></use></svg></span>'}),this.element.querySelector('[data-type="collapse"]').addEventListener("click",()=>{this.tree.collapseAll()}),this.element.querySelector('[data-type="expand"]').addEventListener("click",()=>{this.tree.expandAll()}),this.element.addEventListener("click",a=>{ca(this.element);let i=a.target;for(;i&&!i.isEqualNode(this.element);){if(i.classList.contains("block__icon"))switch(i.getAttribute("data-type")){case"min":Vn("bookmark").toggleModel("bookmark",!1,!0);break;case"refresh":this.update();break}i=i.parentElement}}),this.update()}update(){const e=this.element.querySelector('.block__icon[data-type="refresh"] svg');e.classList.contains("fn__rotate")||(e.classList.add("fn__rotate"),ae("/api/bookmark/getBookmark",{},n=>{this.openNodes&&(this.openNodes=this.tree.getExpandIds()),this.tree.updateData(n.data),this.openNodes?this.tree.setExpandIds(this.openNodes):this.openNodes=this.tree.getExpandIds(),e.classList.remove("fn__rotate")}))}}const lL=(t,e,n)=>{if(!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_TAG){window.siyuan.menus.menu.remove();return}window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(new xe({icon:"iconEdit",label:window.siyuan.languages.rename,click:()=>{yd(n)}}).element),window.siyuan.menus.menu.append(new xe({icon:"iconTrashcan",label:window.siyuan.languages.remove,click:()=>{Sn(window.siyuan.languages.deleteOpConfirm,`${window.siyuan.languages.confirmDelete} <b>${he(n)}</b>?`,()=>{ae("/api/tag/removeTag",{label:n},()=>{Vn("tag").data.tag.update()})},void 0,!0)}}).element),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_TAG),window.siyuan.menus.menu.popup({x:e.clientX-11,y:e.clientY+11,h:22,w:12})};class Sc extends Wa{constructor(e,n){super({app:e,id:n.id,msgCallback(a){if(a)switch(a.cmd){case"transactions":a.data[0].doOperations.forEach(i=>{let s=!1;((i.action==="update"||i.action==="insert")&&i.data.indexOf('data-type="tag"')>-1||i.action==="delete")&&(s=!0),s&&this.update()});break;case"unmount":case"removeDoc":case"mount":(a.cmd!=="mount"||a.code!==1)&&this.update();break}}}),this.element=n.panelElement,this.element.classList.add("fn__flex-column","file-tree","sy__tag"),this.element.innerHTML=`<div class="block__icons">
    <div class="block__logo">
        <svg class="block__logoicon"><use xlink:href="#iconTags"></use></svg>${window.siyuan.languages.tag}
    </div>
    <span class="fn__flex-1"></span>
    <span class="fn__space"></span>
    <span data-type="refresh" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.refresh}"><svg><use xlink:href='#iconRefresh'></use></svg></span>
    <span class="fn__space"></span>
    <span data-type="sort" class="block__icon b3-tooltips b3-tooltips__sw${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.sort}">
        <svg><use xlink:href="#iconSort"></use></svg>
    </span>
    <span class="fn__space${window.siyuan.config.readonly?" fn__none":""}"></span>
    <span data-type="expand" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.expand}${un(window.siyuan.config.keymap.editor.general.expand.custom)}">
        <svg><use xlink:href="#iconExpand"></use></svg>
    </span>
    <span class="fn__space"></span>
    <span data-type="collapse" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.collapse}${un(window.siyuan.config.keymap.editor.general.collapse.custom)}">
        <svg><use xlink:href="#iconContract"></use></svg>
    </span>
    <span class="fn__space"></span>
    <span data-type="min" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="${window.siyuan.languages.min}${un(window.siyuan.config.keymap.general.closeTab.custom)}"><svg><use xlink:href='#iconMin'></use></svg></span>
</div>
<div class="fn__flex-1" style="margin-bottom: 8px"></div>`,this.tree=new Po({element:this.element.lastElementChild,data:null,click(a,i){const s=a.getAttribute("data-label");if(i){const r=N(i.target,"b3-list-item__action");if(r){lL(r.parentElement,i,s);return}}Ro(e,`#${a.getAttribute("data-label")}#`,!window.siyuan.ctrlIsPressed,{method:0})},rightClick:(a,i)=>{lL(a,i,a.getAttribute("data-label"))},blockExtHTML:window.siyuan.config.readonly?void 0:'<span class="b3-list-item__action"><svg><use xlink:href="#iconMore"></use></svg></span>',topExtHTML:window.siyuan.config.readonly?void 0:'<span class="b3-list-item__action"><svg><use xlink:href="#iconMore"></use></svg></span>'}),this.element.querySelector('[data-type="collapse"]').addEventListener("click",()=>{this.tree.collapseAll()}),this.element.querySelector('[data-type="expand"]').addEventListener("click",()=>{this.tree.expandAll()}),this.element.addEventListener("click",a=>{ca(this.element);let i=a.target;for(;i&&!i.isEqualNode(this.element);){if(i.classList.contains("block__icon"))switch(i.getAttribute("data-type")){case"min":Vn("tag").toggleModel("tag",!1,!0);break;case"sort":window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(new xe({icon:window.siyuan.config.tag.sort===0?"iconSelect":void 0,label:window.siyuan.languages.fileNameASC,click:()=>{window.siyuan.config.tag.sort=0,this.update()}}).element),window.siyuan.menus.menu.append(new xe({icon:window.siyuan.config.tag.sort===1?"iconSelect":void 0,label:window.siyuan.languages.fileNameDESC,click:()=>{window.siyuan.config.tag.sort=1,this.update()}}).element),window.siyuan.menus.menu.append(new xe({icon:window.siyuan.config.tag.sort===4?"iconSelect":void 0,label:window.siyuan.languages.fileNameNatASC,click:()=>{window.siyuan.config.tag.sort=4,this.update()}}).element),window.siyuan.menus.menu.append(new xe({icon:window.siyuan.config.tag.sort===5?"iconSelect":void 0,label:window.siyuan.languages.fileNameNatDESC,click:()=>{window.siyuan.config.tag.sort=5,this.update()}}).element),window.siyuan.menus.menu.append(new xe({icon:window.siyuan.config.tag.sort===7?"iconSelect":void 0,label:window.siyuan.languages.refCountASC,click:()=>{window.siyuan.config.tag.sort=7,this.update()}}).element),window.siyuan.menus.menu.append(new xe({icon:window.siyuan.config.tag.sort===8?"iconSelect":void 0,label:window.siyuan.languages.refCountDESC,click:()=>{window.siyuan.config.tag.sort=8,this.update()}}).element),window.siyuan.menus.menu.popup({x:a.clientX,y:a.clientY}),a.preventDefault(),a.stopPropagation();break;case"refresh":this.update();break}i=i.parentElement}}),this.update(!1)}update(e=!0){const n=this.element.querySelector('.block__icon[data-type="refresh"] svg');n.classList.contains("fn__rotate")||(n.classList.add("fn__rotate"),ae("/api/tag/getTag",{sort:window.siyuan.config.tag.sort,app:p.SIYUAN_APPID,ignoreMaxListHint:e},a=>{this.openNodes&&(this.openNodes=this.tree.getExpandIds()),this.tree.updateData(a.data),this.openNodes?this.tree.setExpandIds(this.openNodes):this.openNodes=this.tree.getExpandIds(),n.classList.remove("fn__rotate")}))}}var iW=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},sW=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},cL=(t,e,n)=>(iW(t,e,"access private method"),n),dw,DE;const rW=class f2{constructor(e,n,a){sW(this,dw),this.children=[],this.removeTabAction=(o,l=!1,c=!0,d=!0)=>{if(xW(),this.children.find((u,g)=>{if(u.id===o){window.siyuan.closedTabs.length>p.SIZE_UNDO&&window.siyuan.closedTabs.pop();const f={};if(el(u,f),window.siyuan.closedTabs.push(f),u.model instanceof ko&&u.model.beforeDestroy&&u.model.beforeDestroy(),u.model instanceof Ma&&(Th(u.model.editor.protyle),ae("/api/storage/updateRecentDocCloseTime",{rootID:u.model.editor.protyle.block.rootID})),this.children.length===1){this.destroyModel(this.children[0].model),this.children=[],["bottom","left","right"].includes(this.parent.type)?u.panelElement.remove():(ng(),this.remove());const h=Cn().editor;h.length===0?Vo():h.forEach(m=>{if(!m.element.classList.contains("fn__none")){ca(m.parent.parent.headersElement.parentElement.parentElement),sp({protyle:m.editor.protyle,focus:!0,pushBackStack:!0,reload:!1,resize:!0});return}});return}if(u.headElement){if(u.headElement.classList.contains("item--focus")){let h;Array.from(u.headElement.parentElement.children).forEach(m=>{m!==u.headElement&&m.style.maxWidth!=="0px"&&(h?m.getAttribute("data-activetime")>h.getAttribute("data-activetime")&&(h=m):h=m)}),h&&!l&&(this.switchTab(h,!0,!0,!1,!1),this.showHeading())}c?(u.headElement.setAttribute("style","max-width: 0px;"),setTimeout(()=>{u.headElement.remove()},200)):u.headElement.remove()}return u.panelElement.remove(),this.destroyModel(u.model),this.children.splice(g,1),Ui(!1),!0}}),window.siyuan.layout.centerLayout&&!nm(window.siyuan.layout.centerLayout)){const g=new f2(this.app);window.siyuan.layout.centerLayout.addWnd(g),g.addTab(CL(this.app),!1,!1),Gg(window.siyuan.languages.siyuanNote)}d&&Fi()},this.id=K(),this.app=e,this.resize=n,this.element=document.createElement("div"),this.element.classList.add("fn__flex-1","fn__flex");let i='<div class="layout-tab-container__drag fn__none"></div>';(a==="left"||a==="right"||a==="bottom")&&(i=""),this.element.innerHTML=`<div data-type="wnd" data-id="${this.id}" class="fn__flex-column fn__flex fn__flex-1">
    <div class="fn__flex fn__none">
        <ul class="fn__flex layout-tab-bar"></ul>
        <ul class="layout-tab-bar layout-tab-bar--readonly fn__flex-1">
            <li class="item item--readonly">
                <span data-type="new" class="block__icon block__icon--show ariaLabel${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.newFile}"><svg><use xlink:href="#iconAdd"></use></svg></span>
                <span class="fn__flex-1"></span>
                <span data-type="more" data-menu="true" class="block__icon block__icon--show ariaLabel" aria-label="${window.siyuan.languages.switchTab}"><svg><use xlink:href="#iconDown"></use></svg></span>
            </li>
        </ul>
    </div>
    <div class="layout-tab-container fn__flex-1">${i}</div>
</div>`,this.headersElement=this.element.querySelector(".layout-tab-bar");const s=this.element.querySelector(".layout-tab-container__drag");if(!s)return;this.headersElement.addEventListener("mousedown",o=>{if(o.button!==1)return;let l=o.target;for(;l&&!l.isEqualNode(this.headersElement);){if(l.tagName==="LI"){this.removeTab(l.getAttribute("data-id")),window.siyuan.menus.menu.remove(),o.stopPropagation(),o.preventDefault();const c=C();if(["desktop","desktop-window"].includes(c)&&window.siyuan.config.system.os==="linux"||c==="browser-desktop"&&navigator.userAgent.indexOf("Linux")!==-1){const d=document.activeElement;window.addEventListener("paste",cL(this,dw,DE),{capture:!0,once:!0}),d instanceof HTMLElement&&d.focus(),setTimeout(()=>{window.removeEventListener("paste",cL(this,dw,DE),{capture:!0})},p.TIMEOUT_INPUT)}break}l=l.parentElement}}),this.headersElement.addEventListener("mousewheel",o=>{this.headersElement.scrollLeft=this.headersElement.scrollLeft+o.deltaY},{passive:!0}),this.headersElement.parentElement.addEventListener("click",o=>{let l=o.target;for(;l&&!l.isEqualNode(this.headersElement);){if(l.classList.contains("block__icon")&&l.getAttribute("data-type")==="new"){ca(this.headersElement.parentElement.parentElement),Oo({app:e,useSavePath:!0});break}else if(l.classList.contains("block__icon")&&l.getAttribute("data-type")==="more"){this.renderTabList(l);break}else if(l.tagName==="LI"&&l.getAttribute("data-id")&&!gu(this.element)){l.classList.contains("item--focus")?this.switchTab(l,!0,!0,!1,!1):this.switchTab(l,!0);break}l=l.parentElement}}),this.headersElement.parentElement.addEventListener("dblclick",o=>{let l=o.target;for(;l&&!l.isEqualNode(this.headersElement);){if(window.siyuan.config.fileTree.openFilesUseCurrentTab&&l.getAttribute("data-type")==="tab-header"){l.classList.remove("item--unupdate");break}l=l.parentElement}}),this.headersElement.parentElement.addEventListener("dragover",function(o){const l=this;if(window.siyuan.currentDragOverTabHeadersElement?window.siyuan.currentDragOverTabHeadersElement!==l&&(window.siyuan.currentDragOverTabHeadersElement.classList.remove("layout-tab-bars--drag"),window.siyuan.currentDragOverTabHeadersElement.querySelectorAll(".layout-tab-bar li[data-clone='true']").forEach(g=>{g.remove()}),window.siyuan.currentDragOverTabHeadersElement=l):window.siyuan.currentDragOverTabHeadersElement=l,o.dataTransfer.types.includes(p.SIYUAN_DROP_FILE)){o.preventDefault(),l.classList.add("layout-tab-bars--drag");return}if(!o.dataTransfer.types.includes(p.SIYUAN_DROP_TAB))return;o.preventDefault();let c=window.siyuan.dragElement,d=!1;if(Array.from(l.firstElementChild.childNodes).find(g=>{var f;if(((f=g.style)==null?void 0:f.opacity)==="0.38")return c=g,d=!0,!0}),!d&&c){if(c.classList.contains("item--pin"))return;c=c.cloneNode(!0),c.setAttribute("data-clone","true"),l.firstElementChild.append(c);return}else!d&&!c&&(c=document.createElement("li"),c.style.opacity="0.38",c.innerHTML='<svg class="svg"><use xlink:href="#iconFile"></use></svg>',c.setAttribute("data-clone","true"),l.firstElementChild.append(c));const u=ue(o.target,"data-type","tab-header");if(!u){c.classList.contains("item--pin")||l.classList.add("layout-tab-bars--drag");return}if(l.classList.remove("layout-tab-bars--drag"),u!==c&&(c.classList.contains("item--pin")&&u.classList.contains("item--pin")||!c.classList.contains("item--pin")&&!u.classList.contains("item--pin"))){const g=u.getClientRects()[0];o.clientX>g.left+g.width/2?u.after(c):u.before(c)}}),this.headersElement.parentElement.addEventListener("drop",function(o){var l;document.querySelectorAll(".layout-tab-bars--drag").forEach(m=>{m.classList.remove("layout-tab-bars--drag")});const c=this;if(o.dataTransfer.types.includes(p.SIYUAN_DROP_FILE)){ca(c.parentElement),o.dataTransfer.getData(p.SIYUAN_DROP_FILE).split(",").forEach(m=>{m&&dn({app:e,id:m,action:[p.CB_GET_FOCUS,p.CB_GET_SCROLL]})}),window.siyuan.dragElement=void 0;return}const d=JSON.parse(o.dataTransfer.getData(p.SIYUAN_DROP_TAB));let u=mi(d.id);const g=mi(c.parentElement.getAttribute("data-id"));if(!u)return;const f=(l=Array.from(c.firstElementChild.childNodes).find(m=>{var b;if(((b=m.style)==null?void 0:b.opacity)==="0.38")return!0}))==null?void 0:l.nextElementSibling;if(!c.contains(u.headElement)){const m=c.querySelector("[data-clone='true']");if(!m)return;m.before(u.headElement),m.remove(),g.moveTab(u,f?f.getAttribute("data-id"):void 0),Ui();return}let h;u.parent.children.find((m,b)=>{if(m.id===u.id)return h=u.parent.children.splice(b,1)[0],!0}),f?u.parent.children.find((m,b)=>{if(m.id===f.getAttribute("data-id"))return u.parent.children.splice(b,0,h),!0}):u.parent.children.push(h),Fi()});let r=0;this.element.addEventListener("dragenter",o=>{if(r++,o.dataTransfer.types.includes(p.SIYUAN_DROP_TAB)){if(N(o.target,"layout-tab-bar"))return;N(o.target,"layout-tab-container",!0)&&(s.classList.remove("fn__none"),this.updateDragElement(o,s.parentElement.getBoundingClientRect(),s))}}),this.element.addEventListener("dragleave",()=>{r--,r===0&&(s.classList.add("fn__none"),s.removeAttribute("style"))}),s.addEventListener("dragover",o=>{document.querySelectorAll(".layout-tab-bars--drag").forEach(l=>{l.classList.remove("layout-tab-bars--drag")}),o.preventDefault(),s.nextElementSibling&&this.updateDragElement(o,s.parentElement.getBoundingClientRect(),s)}),s.addEventListener("dragleave",()=>{s.classList.add("fn__none"),s.removeAttribute("style")}),s.addEventListener("drop",o=>{s.classList.add("fn__none");const l=o.target.parentElement.parentElement,c=mi(l.getAttribute("data-id")),d=JSON.parse(o.dataTransfer.getData(p.SIYUAN_DROP_TAB));let u=mi(d.id);if(!u){s.removeAttribute("style");return}if(s.style.height==="50%"||s.style.width==="50%"){if(s.style.height==="50%"){const g=c.split("tb");g.headersElement.append(u.headElement),g.headersElement.parentElement.classList.remove("fn__none"),g.moveTab(u),s.style.bottom==="50%"&&g.element.previousElementSibling&&c.element.parentElement&&ek(g,c)}else if(s.style.width==="50%"){const g=c.split("lr");g.headersElement.append(u.headElement),g.headersElement.parentElement.classList.remove("fn__none"),g.moveTab(u),s.style.right==="50%"&&g.element.previousElementSibling&&c.element.parentElement&&ek(g,c)}Ui(),s.removeAttribute("style");return}s.removeAttribute("style"),!l.contains(document.querySelector(`[data-id="${d.id}"]`))&&c&&(ng(),c.headersElement.append(u.headElement),c.headersElement.parentElement.classList.remove("fn__none"),c.moveTab(u),Ui())})}isPointWithinLines(e,n,a,i){const s=a.k*e+a.b,r=i.k*e+i.b;return n>=Math.min(s,r)&&n<=Math.max(s,r)}updateDragElement(e,n,a){const i=n.height,s=n.width,r=e.clientX-n.left,o=e.clientY-n.top;r<s/5&&this.isPointWithinLines(r,o,{k:1.5*i/s,b:-.15*i},{k:-1.25*i/s,b:1.05*i})?a.setAttribute("style","height:100%;width:50%;right:50%;bottom:0;left:0;top:0"):r>s*.8&&this.isPointWithinLines(r,o,{k:-1.5*i/s,b:1.35*i},{k:1.25*i/s,b:-.2*i})?a.setAttribute("style","height:100%;width:50%;right:0;bottom:0;left:50%;top:0"):o<i*.15?a.setAttribute("style","height:50%;width:100%;right:0;bottom:50%;left:0;top:0"):o>i*.8?a.setAttribute("style","height:50%;width:100%;right:0;bottom:0;left:0;top:50%"):a.setAttribute("style","height:100%;width:100%;right:0;bottom:0;left:0;top:0")}showHeading(){const e=this.headersElement.querySelector(".item--focus");e&&(e.offsetLeft+e.clientWidth>this.headersElement.scrollLeft+this.headersElement.clientWidth?this.headersElement.scrollLeft=e.offsetLeft+e.clientWidth-this.headersElement.clientWidth:e.offsetLeft<this.headersElement.scrollLeft&&(this.headersElement.scrollLeft=e.offsetLeft))}switchTab(e,n=!1,a=!0,i=!0,s=!0){let r,o=!1;if(this.children.forEach(l=>{var c;e===l.headElement?(l.headElement&&l.headElement.classList.contains("fn__none")||(l.headElement&&(l.headElement.classList.add("item--focus"),l.headElement.getAttribute("data-init-active")==="true"?(l.headElement.removeAttribute("data-init-active"),o=!0):(l.headElement.setAttribute("data-activetime",new Date().getTime().toString()),l.model instanceof Ma&&ae("/api/storage/updateRecentDocViewTime",{rootID:l.model.editor.protyle.block.rootID}))),l.panelElement.classList.remove("fn__none")),r=l):((c=l.headElement)==null||c.classList.remove("item--focus"),l.panelElement.classList.contains("fn__none")||l.panelElement.classList.add("fn__none"))}),o||ca(this.headersElement.parentElement.parentElement,s),r&&r.headElement){const l=r.headElement.getAttribute("data-initdata");if(l){r.addModel(tI(this.app,r,JSON.parse(l))),r.headElement.removeAttribute("data-initdata"),s&&Fi();return}}if(r&&e===r.headElement&&(r.model instanceof Il?r.model.onGraph(!1):r.model instanceof El&&r.model.pdfObject&&r.model.pdfObject.pdfViewer&&r.model.pdfObject.pdfViewer.container.focus()),r&&r.model instanceof Ma){const l=r.headElement.getAttribute("keep-cursor");if(l){let c;if(Array.from(r.model.editor.protyle.wysiwyg.element.querySelectorAll(`[data-node-id="${l}"]`)).find(d=>{if(!ge(d))return c=d,!0}),c){if(!r.model.editor.protyle.toolbar.range){const d=document.createRange();d.selectNodeContents(c),d.collapse(),r.model.editor.protyle.toolbar.range=d}kn(r.model.editor.protyle,c,"start")}else dn({app:this.app,id:l,action:[p.CB_GET_FOCUS,p.CB_GET_SCROLL]});r.headElement.removeAttribute("keep-cursor")}a&&sp({protyle:r.model.editor.protyle,focus:!0,pushBackStack:n,reload:!1,resize:i}),window.siyuan.editorIsFullscreen&&!r.model.editor.protyle.element.className.includes("fullscreen")&&(kd(r.model.editor.protyle.element),Ax(r.model.editor.protyle))}else Vo();s&&Fi()}addTab(e,n=!1,a=!0,i){var s;n&&((s=e.headElement)==null||s.classList.remove("item--focus"),e.panelElement.classList.add("fn__none"));let r=0;this.children.forEach((l,c)=>{var d;if(l.headElement&&l.headElement.classList.contains("item--focus")){r=c;let u=l.headElement.nextElementSibling;for(;u&&u.classList.contains("item--pin");)r++,u=u.nextElementSibling}n||((d=l.headElement)==null||d.classList.remove("item--focus"),l.panelElement.classList.add("fn__none"))}),this.children.splice(r+1,0,e),e.headElement&&(this.headersElement.parentElement.classList.remove("fn__none"),this.headersElement.childElementCount===0?this.headersElement.append(e.headElement):this.headersElement.children[r].after(e.headElement),e.headElement.querySelector(".item__close").addEventListener("click",l=>{e.headElement.classList.contains("item--pin")?e.unpin():e.parent.removeTab(e.id),window.siyuan.menus.menu.remove(),l.stopPropagation(),l.preventDefault()}),e.headElement.setAttribute("data-activetime",i||new Date().getTime().toString()));const o=this.element.querySelector(".layout-tab-container");o.querySelector(".fn__flex-1")?o.querySelector(".layout-tab-container__drag")?o.children[r+1].after(e.panelElement):o.children[r].after(e.panelElement):o.append(e.panelElement),e.parent=this,e.callback&&e.callback(e),this.parent.type==="center"&&this.children.length===2&&!this.children[0].headElement?this.removeTab(this.children[0].id):this.children.length>window.siyuan.config.fileTree.maxOpenTabCount&&this.removeOverCounter(a),a&&Fi()}renderTabList(e){if(!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_TAB_LIST){window.siyuan.menus.menu.remove();return}window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.classList.add("b3-menu--list"),Array.from(this.headersElement.children).forEach(a=>{var i;const s=a.querySelector(".item__icon"),r=a.querySelector(".item__graphic");let o;s?((i=s.firstElementChild)==null?void 0:i.tagName)==="IMG"?o=`<img src="${s.firstElementChild.getAttribute("src")}"  class="b3-menu__icon">`:o=`<span class="b3-menu__icon">${s.innerHTML}</span>`:r||(o=Yt(window.siyuan.storage[p.LOCAL_IMAGES].file,"b3-menu__icon",!0)),window.siyuan.menus.menu.append(new xe({label:he(a.querySelector(".item__text").textContent),action:"iconCloseRound",iconHTML:o,icon:r?r.firstElementChild.getAttribute("xlink:href").substring(1):"",bind:l=>{l.addEventListener("click",c=>{N(c.target,"b3-menu__action")?(this.removeTab(a.getAttribute("data-id")),l.previousElementSibling||l.nextElementSibling?(l.remove(),gn(window.siyuan.menus.menu.element,n.left+n.width-window.siyuan.menus.menu.element.clientWidth,n.top+n.height)):window.siyuan.menus.menu.remove()):(this.switchTab(a,!0),this.showHeading(),window.siyuan.menus.menu.remove()),c.preventDefault(),c.stopPropagation()})},current:a.classList.contains("item--focus")}).element)}),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_TAB_LIST);const n=e.getBoundingClientRect();window.siyuan.menus.menu.popup({x:n.left+n.width,y:n.top+n.height,isLeft:!0})}removeOverCounter(e=!1){let n,a,i=0;this.children.forEach((s,r)=>{s.headElement&&(s.headElement.classList.contains("item--pin")||s.headElement.classList.contains("item--focus")||(i++,a?s.headElement.getAttribute("data-activetime")<a&&(a=s.headElement.getAttribute("data-activetime"),n=this.children[r].id):(a=s.headElement.getAttribute("data-activetime"),n=this.children[r].id)))}),n&&(this.removeTab(n,!1,!1,e),i--),i>0&&this.children.length>window.siyuan.config.fileTree.maxOpenTabCount&&this.removeOverCounter(e)}destroyModel(e){if(e){if(e instanceof Ma&&e.editor){window.siyuan.blockPanels.forEach(n=>{n.element&&e.editor.protyle.wysiwyg.element.contains(n.element)&&n.destroy()}),e.editor.destroy();return}if(e instanceof Ll){e.editors.edit.destroy(),e.editors.unRefEdit.destroy();return}e instanceof El&&e.pdfObject&&e.pdfObject.pdfLoadingTask&&e.pdfObject.pdfLoadingTask.destroy(),e instanceof ko&&e.destroy&&e.destroy(),e.send("closews",{})}}removeTab(e,n=!1,a=!0,i=!0){var s;for(let r=0;r<this.children.length;r++){const o=this.children[r];if(o.id===e){if(o.model instanceof Ma&&((s=o.model.editor)!=null&&s.protyle)){if(o.model.editor.protyle.upload.isUploading){Q(window.siyuan.languages.uploading);return}this.removeTabAction(e,n,a,i)}else this.removeTabAction(e,n,a,i);return}}}moveTab(e,n){let a;if(e.model instanceof Ma&&e.model.editor.protyle.toolbar.range){const s=oe(e.model.editor.protyle.toolbar.range.startContainer);if(s){const r=ya(s,void 0,e.model.editor.protyle.toolbar.range);a={id:s.getAttribute("data-node-id"),start:r.start,end:r.end}}}if(this.element.querySelector(".layout-tab-container").append(e.panelElement),a&&e.model instanceof Ma){const s=nr(e.model.editor.protyle.wysiwyg.element.querySelector(`[data-node-id="${a.id}"]`),a.start,a.end);s&&(e.model.editor.protyle.toolbar.range=s)}n?this.children.find((s,r)=>{if(s.id===n)return this.children.splice(r,0,e),!0}):this.children.push(e),this.children.length>window.siyuan.config.fileTree.maxOpenTabCount&&this.removeOverCounter();const i=e.parent;if(i.children.length===1)i.children=[],i.remove();else if(i.children.find((s,r)=>{if(s.id===e.id)return i.children.splice(r,1),Ui(),!0}),!i.headersElement.querySelector(".item--focus")){let s;Array.from(i.headersElement.children).forEach(r=>{s?r.getAttribute("data-activetime")>s.getAttribute("data-activetime")&&(s=r):s=r}),s&&i.switchTab(s,!0)}this.switchTab(e.headElement),e.parent=this,rs(["toolbar"])}split(e){if(this.children.length===1&&!this.children[0].headElement)return this;ng();const n=new f2(this.app,e);return e===this.parent.direction?this.parent.addWnd(n,this.id):this.parent.children.length===1?(this.parent.direction=e,e==="tb"?(this.parent.element.classList.add("fn__flex-column"),this.parent.element.classList.remove("fn__flex")):(this.parent.element.classList.remove("fn__flex-column"),this.parent.element.classList.add("fn__flex")),this.parent.addWnd(n,this.id)):this.parent.children.find((a,i)=>{if(a.id===this.id){const s=new Gr({resize:a.resize,direction:e});this.parent.addLayout(s,a.id);const r=this.parent.children.splice(i,1)[0];return r.resize&&(r.element.previousElementSibling.remove(),r.resize=void 0),s.addWnd.call(s,r),s.addWnd.call(s,n),e==="tb"&&r.element.style.width?(s.element.style.width=r.element.style.width,s.element.classList.remove("fn__flex-1"),r.element.style.width="",r.element.classList.add("fn__flex-1")):e==="lr"&&r.element.style.height&&(s.element.style.height=r.element.style.height,s.element.classList.remove("fn__flex-1"),r.element.style.height="",r.element.classList.add("fn__flex-1")),!0}}),n}remove(){let e=this.parent,n=this.element,a=this.id;for(;e&&e.children.length===1&&e.type!=="center";)a=e.id,n=e.element,e=e.parent;e.children.find((i,s)=>{if(i.id===a){if(e.children.length>1){let r=e.children[s-1];s===0&&(r=e.children[1]),e.children.length===2&&(e.direction==="lr"?r.element.style.width="":r.element.style.height="",r.resize=void 0,r.element.classList.add("fn__flex-1")),e.children.length>2&&s===0&&(e.children[1].resize=void 0)}return e.children.splice(s,1),!0}}),n.previousElementSibling&&n.previousElementSibling.classList.contains("layout__resize")?n.previousElementSibling.remove():n.nextElementSibling&&n.nextElementSibling.classList.contains("layout__resize")&&n.nextElementSibling.remove(),n.remove(),ik(e),Ui()}};dw=new WeakSet,DE=function(t){t.preventDefault(),t.stopPropagation()};let zg=rW;const Es=()=>{const t=[],e=Cn();return e.editor.forEach(n=>{t.push(n.editor)}),e.search.forEach(n=>{t.push(n.editors.edit),t.push(n.editors.unRefEdit)}),e.custom.forEach(n=>{var a;(a=n.editors)==null||a.forEach(i=>{t.push(i)})}),e.backlink.forEach(n=>{n.editors.forEach(a=>{t.push(a)})}),window.siyuan.dialogs.forEach(n=>{n.editors&&Object.keys(n.editors).forEach(a=>{t.push(n.editors[a])})}),window.siyuan.blockPanels.forEach(n=>{n.editors.forEach(a=>{t.push(a)})}),t},Cn=()=>{const t={editor:[],graph:[],asset:[],outline:[],backlink:[],search:[],inbox:[],files:[],bookmark:[],tag:[],custom:[]},e=n=>{for(let a=0;a<n.children.length;a++){const i=n.children[a];if(i instanceof Sa){const s=i.model;s instanceof Ma?t.editor.push(s):s instanceof Il?t.graph.push(s):s instanceof cc?t.outline.push(s):s instanceof yl?t.backlink.push(s):s instanceof El?t.asset.push(s):s instanceof Ll?t.search.push(s):s instanceof js?t.files.push(s):s instanceof cu?t.bookmark.push(s):s instanceof Sc?t.tag.push(s):s instanceof ko&&t.custom.push(s)}else e(i)}};return window.siyuan.layout.layout&&e(window.siyuan.layout.layout),t},rp=(t,e)=>{for(let n=0;n<t.children.length;n++){const a=t.children[n];a instanceof zg?e.push(a):a instanceof Gr&&rp(a,e)}},So=()=>{const t=[],e=n=>{for(let a=0;a<n.children.length;a++){const i=n.children[a];i instanceof Sa?t.push(i):e(i)}};return window.siyuan.layout.centerLayout&&e(window.siyuan.layout.centerLayout),t},uw=()=>{const t=[];return window.siyuan.config.uiLayout.left.data.forEach(e=>{e.forEach(n=>{t.push(n)})}),window.siyuan.config.uiLayout.right.data.forEach(e=>{e.forEach(n=>{t.push(n)})}),window.siyuan.config.uiLayout.bottom.data.forEach(e=>{e.forEach(n=>{t.push(n)})}),t},Ml=(t=window.siyuan.languages._kernel[29])=>!1,CE=()=>!0;var oW=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const fw=(t,e,n)=>{ae("/api/block/getDocInfo",{id:t},a=>{e.updateTitle(a.data.name),n&&n.title&&n.title.setTitle(a.data.name)})},LE=(t,e,n=!0,a=!0,i=!1)=>{n&&ot();const s=Cn();s.editor.forEach(r=>{e.upsertRootIDs.includes(r.editor.protyle.block.rootID)?ae("/api/block/getDocInfo",{id:r.editor.protyle.block.rootID},o=>{r.editor.protyle.wysiwyg.renderCustom(o.data.ial),$o(r.editor.protyle,!1,a),fw(r.editor.protyle.block.rootID,r.parent,r.editor.protyle)}):e.removeRootIDs.includes(r.editor.protyle.block.rootID)&&(r.parent.parent.removeTab(r.parent.id,!1,!1),delete window.siyuan.storage[p.LOCAL_FILEPOSITION][r.editor.protyle.block.rootID],Gt(p.LOCAL_FILEPOSITION,window.siyuan.storage[p.LOCAL_FILEPOSITION]))}),s.graph.forEach(r=>{r.type==="local"&&e.removeRootIDs.includes(r.rootId)?r.parent.parent.removeTab(r.parent.id,!1,!1):(r.type!=="local"||e.upsertRootIDs.includes(r.rootId))&&(r.searchGraph(!1),r.type==="local"&&fw(r.rootId,r.parent))}),s.outline.forEach(r=>{r.type==="local"&&e.removeRootIDs.includes(r.blockId)?r.parent.parent.removeTab(r.parent.id,!1,!1):(r.type!=="local"||e.upsertRootIDs.includes(r.blockId))&&(ae("/api/outline/getDocOutline",{id:r.blockId,preview:r.isPreview},o=>{r.update(o)}),r.type==="local"&&fw(r.blockId,r.parent))}),s.backlink.forEach(r=>{r.type==="local"&&e.removeRootIDs.includes(r.rootId)?r.parent.parent.removeTab(r.parent.id,!1,!1):(r.refresh(),r.type==="local"&&fw(r.rootId,r.parent))}),i||s.files.forEach(r=>{fr(()=>{r.init(!1)})}),s.bookmark.forEach(r=>{r.update()}),s.tag.forEach(r=>{r.update()}),s.search.forEach(r=>{r.parent.panelElement.querySelector("#searchInput").dispatchEvent(new CustomEvent("input"))}),s.custom.forEach(r=>{r.update&&r.update()})},lW=t=>{Es().forEach(e=>{e.protyle.wysiwyg.element.querySelectorAll(`[data-node-id="${t.blockID}"] span[data-type~="block-ref"][data-subtype="d"][data-id="${t.defBlockID}"]`).forEach(n=>{n.innerHTML=t.refText})})},cW=t=>{Es().forEach(n=>{if(n.protyle.block.rootID===t.rootID&&n.protyle.title){const a=n.protyle.title.element.querySelector(".protyle-attr"),i=a.querySelector(".protyle-attr--refcount");i?t.rootRefCount===0?i.remove():i.textContent=t.rootRefCount.toString():t.rootRefCount>0&&a.insertAdjacentHTML("beforeend",`<div class="protyle-attr--refcount popover__block">${t.rootRefCount}</div>`)}t.rootID!==t.blockID&&n.protyle.wysiwyg.element.querySelectorAll(`[data-node-id="${t.blockID}"]`).forEach(a=>{const i=a.lastElementChild.querySelector(".protyle-attr--refcount");if(i)t.refCount===0?i.remove():i.textContent=t.refCount.toString();else if(t.refCount>0){const s=a.lastElementChild;s.childElementCount>0?s.lastElementChild.insertAdjacentHTML("afterend",`<div class="protyle-attr--refcount popover__block">${t.refCount}</div>`):s.innerHTML=`<div class="protyle-attr--refcount popover__block">${t.refCount}</div>${p.ZWSP}`}t.refCount===0?a.removeAttribute("refcount"):a.setAttribute("refcount",t.refCount.toString())})});let e;if(e=Vn("file").data.file.element.querySelector(`li[data-node-id="${t.rootID}"]`),e){const n=e.querySelector(".counter");n?t.rootRefCount===0?n.remove():n.textContent=t.rootRefCount.toString():t.rootRefCount>0&&e.insertAdjacentHTML("beforeend",`<span class="popover__block counter b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.ref}">${t.rootRefCount}</span>`)}},pw=t=>{window.siyuan.config.readonly||(t.plugins.forEach(e=>{e.eventBus.emit("lock-screen")}),ae("/api/system/logoutAuth",{},()=>{uv()}))},dL=()=>{if(document.querySelector("#errorLog"))return;let t=`\u{1F494} ${window.siyuan.languages.kernelFault0} <small>v${p.SIYUAN_VERSION}</small>`,e=`<div>${window.siyuan.languages.kernelFault1}</div><div class="fn__hr"></div><div>${window.siyuan.languages.kernelFault2}</div>`;Xt()&&(t=`\u{1F375} ${window.siyuan.languages.pleaseWait} <small>v${p.SIYUAN_VERSION}</small>`,e=`<div>${window.siyuan.languages.reconnectPrompt}</div><div class="fn__hr"></div><div class="fn__flex"><div class="fn__flex-1"></div><button class="b3-button">${window.siyuan.languages.retry}</button></div>`);const n=new fe({disableClose:!0,title:t,width:x()?"92vw":"520px",content:`<div class="b3-dialog__content">
<div class="ft__breakword">
    ${e}
</div>
</div>`});n.element.id="errorLog",n.element.setAttribute("data-key",p.DIALOG_KERNELFAULT);const a=n.element.querySelector(".b3-button");a&&a.addEventListener("click",()=>{n.destroy(),window.webkit.messageHandlers.startKernelFast.postMessage("startKernelFast")})},Yg=()=>{},Ac=()=>oW(void 0,null,function*(){rs(["util"]),ae("/api/system/exit",{force:!1},t=>{if(t.code===1){const e=Q(t.msg,t.data.closeTimeout,"error"),n=document.querySelector(`#message [data-id="${e}"] button`);n&&n.addEventListener("click",()=>{ae("/api/system/exit",{force:!0},()=>{(Xt()||St()||Qt())&&(window.location.href="siyuan://api/system/exit")})})}else t.code===2?(ot(),window.siyuan.config.system.container==="std"&&ipcRenderer.send(p.SIYUAN_SHOW_WINDOW),Sn(window.siyuan.languages.tip,t.msg,()=>{ae("/api/system/exit",{force:!0,execInstallPkg:2},()=>{})},()=>{ae("/api/system/exit",{force:!0,execInstallPkg:1},()=>{})})):(Xt()||St()||Qt())&&(window.location.href="siyuan://api/system/exit")})}),dW=()=>{if(document.getElementById("transactionError"))return;const t=new fe({disableClose:!0,title:`${window.siyuan.languages.stateExcepted} v${p.SIYUAN_VERSION}`,content:`<div class="b3-dialog__content" id="transactionError">${window.siyuan.languages.rebuildIndexTip}</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--text">${window.siyuan.languages._kernel[97]}</button>
    <div class="fn__space"></div>
    <button class="b3-button">${window.siyuan.languages.rebuildIndex}</button>
</div>`,width:x()?"92vw":"520px"});t.element.setAttribute("data-key",p.DIALOG_STATEEXCEPTED);const e=t.element.querySelectorAll(".b3-button");e[0].addEventListener("click",()=>{Ss({errorExit:!0,cb:Ac})}),e[1].addEventListener("click",()=>{uL(),t.destroy()})},uL=t=>{window.siyuan.storage[p.LOCAL_FILEPOSITION]={},Gt(p.LOCAL_FILEPOSITION,window.siyuan.storage[p.LOCAL_FILEPOSITION]),ae("/api/system/rebuildDataIndex",{},()=>{t&&t()})};let hw;const uW=t=>{const e=document.querySelector("#status");if(e)if(x()){if(!document.querySelector("#keyboardToolbar").classList.contains("fn__none"))return;clearTimeout(hw),e.innerHTML=t.msg,e.style.bottom="0",hw=window.setTimeout(()=>{e.style.bottom=""},12e3)}else{const n=e.querySelector(".status__msg");n&&(clearTimeout(hw),n.innerHTML=t.msg,hw=window.setTimeout(()=>{n.innerHTML=""},12e3))}},IE=t=>{let e=document.getElementById("progress");if(e||(document.body.insertAdjacentHTML("beforeend",`<div id="progress" style="z-index: ${++window.siyuan.zIndex}"></div>`),e=document.getElementById("progress")),t.code===2){e.remove();return}t.code===0?e.innerHTML=`<div class="b3-dialog__scrim" style="opacity: 1"></div>
<div class="b3-dialog__loading">
    <div style="text-align: right">${t.data.current}/${t.data.total}</div>
    <div style="margin: 8px 0;height: 8px;border-radius: var(--b3-border-radius);overflow: hidden;background-color:#fff;"><div style="width: ${t.data.current/t.data.total*100}%;transition: var(--b3-transition);background-color: var(--b3-theme-primary);height: 8px;"></div></div>
    <div class="ft__breakword">${he(t.msg)}</div>
</div>`:t.code===1&&(e.lastElementChild?e.lastElementChild.lastElementChild.innerHTML=he(t.msg):e.innerHTML=`<div class="b3-dialog__scrim" style="opacity: 1"></div>
<div class="b3-dialog__loading">
    <div style="margin: 8px 0;height: 8px;border-radius: var(--b3-border-radius);overflow: hidden;background-color:#fff;"><div style="background-color: var(--b3-theme-primary);height: 8px;background-image: linear-gradient(-45deg, rgba(255, 255, 255, 0.2) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.2) 50%, rgba(255, 255, 255, 0.2) 75%, transparent 75%, transparent);animation: stripMove 450ms linear infinite;background-size: 50px 50px;"></div></div>
    <div class="ft__breakword">${he(t.msg)}</div>
</div>`)},fW=t=>{const e=document.querySelector(".status__backgroundtask");e&&(t.length===0?(e.classList.add("fn__none"),!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_STATUS_BACKGROUND_TASK&&window.siyuan.menus.menu.remove()):(e.classList.remove("fn__none"),e.setAttribute("data-tasks",JSON.stringify(t)),e.innerHTML=t[0].action+"<div><div></div></div>"))},pW=()=>{ae("/api/sync/getBootSync",{},t=>{if(t.code===1){const e=new fe({width:x()?"92vw":"50vw",title:"\u{1F329}\uFE0F "+window.siyuan.languages.bootSyncFailed,content:`<div class="b3-dialog__content">${t.msg}</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.syncNow}</button>
</div>`});e.element.setAttribute("data-key",p.DIALOG_BOOTSYNCFAILED);const n=e.element.querySelectorAll(".b3-button");n[0].addEventListener("click",()=>{e.destroy()}),n[1].addEventListener("click",()=>{n[1].getAttribute("disabled")||(n[1].setAttribute("disabled","disabled"),ae("/api/sync/performBootSync",{},a=>{a.code===0&&e.destroy(),n[1].removeAttribute("disabled")}))})}})},Gg=t=>{const e=document.getElementById("drag"),n=gh();if(t===window.siyuan.languages.siyuanNote){const a=`${n} - ${window.siyuan.languages.siyuanNote} v${p.SIYUAN_VERSION}`;document.title=a,e&&(e.textContent=a,e.setAttribute("title",a))}else{if(t=t||window.siyuan.languages.untitled,document.title=`${t} - ${n} - ${window.siyuan.languages.siyuanNote} v${p.SIYUAN_VERSION}`,!e)return;e.setAttribute("title",t),e.innerHTML=he(t)}},hW=t=>{const e=document.querySelector("#configBazaarReadme .item__side");if(!e||t.id!==JSON.parse(e.getAttribute("data-obj")).repoURL)return;const n=e.querySelector('[data-type="install"]');n&&(t.percent>=1?(n.parentElement.classList.add("fn__none"),n.parentElement.nextElementSibling.classList.add("fn__none")):(n.classList.add("b3-button--progress"),n.parentElement.nextElementSibling.firstElementChild.classList.add("b3-button--progress"),n.innerHTML=`<span style="width: ${t.percent*100}%"></span>`,n.parentElement.nextElementSibling.firstElementChild.innerHTML=`<span style="width: ${t.percent*100}%"></span>`))},Ao=(t,e)=>{const n=document.querySelector("#barSync");if(!n)return;const a=n.querySelector("use");if(!t){n.classList.remove("toolbar__item--active"),!window.siyuan.config.sync.enabled||window.siyuan.config.sync.provider===0&&Ml("")?a.setAttribute("xlink:href","#iconCloudOff"):a.setAttribute("xlink:href","#iconCloudSucc");return}n.firstElementChild.classList.remove("fn__rotate"),t.code===0?(n.classList.add("toolbar__item--active"),n.firstElementChild.classList.add("fn__rotate"),a.setAttribute("xlink:href","#iconRefresh")):t.code===2?(n.classList.remove("toolbar__item--active"),a.setAttribute("xlink:href","#iconCloudError")):t.code===1&&(n.classList.remove("toolbar__item--active"),a.setAttribute("xlink:href","#iconCloudSucc")),e.forEach(i=>{t.code===0?i.eventBus.emit("sync-start",t):t.code===1?i.eventBus.emit("sync-end",t):t.code===2&&i.eventBus.emit("sync-fail",t)})};var gW=Object.defineProperty,mW=Object.defineProperties,bW=Object.getOwnPropertyDescriptors,fL=Object.getOwnPropertySymbols,yW=Object.prototype.hasOwnProperty,_W=Object.prototype.propertyIsEnumerable,pL=(t,e,n)=>e in t?gW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,jg=(t,e)=>{for(var n in e||(e={}))yW.call(e,n)&&pL(t,n,e[n]);if(fL)for(var n of fL(e))_W.call(e,n)&&pL(t,n,e[n]);return t},hL=(t,e)=>mW(t,bW(e)),wW=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const ME=t=>{var e;const a=`; ${document.cookie}`.split(`; ${t}=`);return a.length===2&&((e=a.pop())==null?void 0:e.split(";").shift())||null},ae=(t,e,n,a)=>{const i={method:"POST",headers:jg({"Content-Type":"application/json"},a)},s=localStorage.getItem("siyuan_token")||ME("siyuan_token");s&&(i.headers=hL(jg({},i.headers),{Authorization:`Bearer ${s}`})),e&&(["/api/search/searchRefBlock","/api/graph/getGraph","/api/graph/getLocalGraph","/api/block/getRecentUpdatedBlocks","/api/search/fullTextSearchBlock"].includes(t)&&(window.siyuan.reqIds[t]=new Date().getTime(),e.type==="local"&&t==="/api/graph/getLocalGraph"||(e.reqId=window.siyuan.reqIds[t])),t==="/api/transactions"&&(e.reqId=new Date().getTime()),e instanceof FormData?(delete i.headers["Content-Type"],i.body=e):i.body=JSON.stringify(e)),a&&(i.headers=jg(jg({},i.headers),a)),fetch(t,i).then(r=>{var o;switch(r.status){case 403:case 404:return{data:null,msg:r.statusText,code:-r.status};default:return r.status==401&&(localStorage.removeItem("siyuan_token"),localStorage.removeItem("siyuan_user"),document.cookie="siyuan_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",setTimeout(()=>{window.location.href=window.location.origin+"/notepads/"},1e3)),((o=r.headers.get("content-type"))==null?void 0:o.indexOf("application/json"))>-1?r.json():r.text()}}).then(r=>{if(typeof r=="string"){n&&n(r);return}["/api/search/searchRefBlock","/api/graph/getGraph","/api/graph/getLocalGraph","/api/block/getRecentUpdatedBlocks","/api/search/fullTextSearchBlock"].includes(t)&&r.data.reqId&&window.siyuan.reqIds[t]&&window.siyuan.reqIds[t]>r.data.reqId||(typeof r=="object"&&typeof r.msg=="string"&&typeof r.code=="number"?cr(r)&&n&&n(r):n&&n(r))}).catch(r=>{if(console.warn("fetch post failed ["+r+"], url ["+t+"]"),t==="/api/transactions"&&(r.message==="Failed to fetch"||r.message==="Unexpected end of JSON input")){dL();return}})},wn=(t,e,n=!0)=>wW(void 0,null,function*(){const a={method:"POST",headers:{"Content-Type":"application/json"}},i=localStorage.getItem("siyuan_token")||ME("siyuan_token");i&&(a.headers=hL(jg({},a.headers),{Authorization:`Bearer ${i}`})),e&&(e instanceof FormData?(delete a.headers["Content-Type"],a.body=e):a.body=JSON.stringify(e));const r=yield(yield fetch(t,a)).json();return n&&cr(r),r}),gL=(t,e)=>{const n={method:"GET",headers:{}},a=localStorage.getItem("siyuan_token")||ME("siyuan_token");a&&(n.headers={Authorization:`Bearer ${a}`}),fetch(t,n).then(i=>{var s;return((s=i.headers.get("content-type"))==null?void 0:s.indexOf("application/json"))>-1?i.json():i.text()}).then(i=>{e(i)})},vW=(t=!1)=>{let e="";t||(e=`<div id="barDock" class="toolbar__item ariaLabel${window.siyuan.config.readonly||t?" fn__none":""}" aria-label="${window.siyuan.languages.toggleDock} ${Mt(window.siyuan.config.keymap.general.toggleDock.custom)}">
    <svg>
        <use xlink:href="#${window.siyuan.config.uiLayout.hideDock?"iconDock":"iconHideDock"}"></use>
    </svg>
</div>`),document.getElementById("status").innerHTML=`${e}
<div class="status__msg"></div>
<div class="fn__flex-1"></div>
<div class="status__backgroundtask fn__none"></div>
<div class="status__counter"></div>
<div id="statusHelp" class="toolbar__item ariaLabel" aria-label="${window.siyuan.languages.help}">
    <svg><use xlink:href="#iconHelp"></use></svg>
</div>`,document.querySelector("#status").addEventListener("click",n=>{let a=n.target;for(;a.id!=="status";){if(a.id==="barDock"){xx(a.firstElementChild.firstElementChild),n.stopPropagation();break}else if(a.classList.contains("status__backgroundtask")){if(!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_STATUS_BACKGROUND_TASK){window.siyuan.menus.menu.remove();return}window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_STATUS_BACKGROUND_TASK),JSON.parse(a.getAttribute("data-tasks")).forEach(s=>{window.siyuan.menus.menu.append(new xe({type:"readonly",iconHTML:"",label:s.action}).element)});const i=a.getBoundingClientRect();window.siyuan.menus.menu.popup({x:i.right,y:i.top,isLeft:!0}),n.stopPropagation();break}else if(a.id==="statusHelp"){if(!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_STATUS_HELP){window.siyuan.menus.menu.remove();return}window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_STATUS_HELP),window.siyuan.menus.menu.append(new xe({label:window.siyuan.languages.feedback,icon:"iconFeedback",click:()=>{window.siyuan.config.lang==="zh_CN"||window.siyuan.config.lang==="zh_CHT"?window.open("https://ld246.com/article/1649901726096"):window.open("https://liuyun.io/article/1686530886208")}}).element),window.siyuan.menus.menu.append(new xe({label:window.siyuan.languages._trayMenu.officialWebsite,icon:"iconSiYuan",click:()=>{window.open("https://b3log.org/siyuan")}}).element),window.siyuan.menus.menu.append(new xe({label:window.siyuan.languages._trayMenu.openSource,icon:"iconGithub",click:()=>{window.open("https://github.com/siyuan-note/siyuan")}}).element);const i=a.getBoundingClientRect();window.siyuan.menus.menu.popup({x:i.right,y:i.top,isLeft:!0}),n.stopPropagation();break}else if(a.classList.contains("b3-menu__item")){const i=a.getAttribute("data-type");if(Vn(i).toggleModel(i),i==="file"&&getSelection().rangeCount>0){const s=getSelection().getRangeAt(0),r=N(s.startContainer,"protyle-wysiwyg",!0);r&&r.blur()}a.parentElement.classList.add("fn__none"),n.stopPropagation();break}a=a.parentElement}}),window.siyuan.config.appearance.hideStatusBar&&document.getElementById("status").classList.add("fn__none")};let Tc,Kg;const du=(t,e)=>{document.getElementById("status").classList.contains("fn__none")||(clearTimeout(Kg),Kg=window.setTimeout(()=>{t.toString()?(ae("/api/block/getContentWordCount",{content:t.toString()},a=>{gw(a.data.stat)}),Tc=""):e&&e!==Tc&&(Tc=e,ae("/api/block/getTreeStat",{id:e},a=>{gw(a.data.stat)}))},p.TIMEOUT_COUNT))},ss=(t,e,n=!1)=>{if(!document.getElementById("status").classList.contains("fn__none")){if(getSelection().rangeCount>0&&getSelection().getRangeAt(0).toString()&&t.length===0){du(getSelection().getRangeAt(0));return}clearTimeout(Kg),Kg=window.setTimeout(()=>{n&&(Tc=""),t.length>0?(ae("/api/block/getBlocksWordCount",{ids:t},a=>{gw(a.data.stat)}),Tc=""):e&&e!==Tc&&(Tc=e,ae("/api/block/getTreeStat",{id:e},a=>{gw(a.data.stat)}))},p.TIMEOUT_COUNT)}},xW=()=>{Tc="",document.querySelector("#status .status__counter").innerHTML="",clearTimeout(Kg)},gw=t=>{if(!t)return;let e=`<span class="ft__on-surface">${window.siyuan.languages.runeCount}</span>&nbsp;${t.runeCount}<span class="fn__space"></span>
<span class="ft__on-surface">${window.siyuan.languages.wordCount}</span>&nbsp;${t.wordCount}<span class="fn__space"></span>`;0<t.linkCount&&(e+=`<span class="ft__on-surface">${window.siyuan.languages.linkCount}</span>&nbsp;${t.linkCount}<span class="fn__space"></span>`),0<t.imageCount&&(e+=`<span class="ft__on-surface">${window.siyuan.languages.imgCount}</span>&nbsp;${t.imageCount}<span class="fn__space"></span>`),0<t.refCount&&(e+=`<span class="ft__on-surface">${window.siyuan.languages.refCount}</span>&nbsp;${t.refCount}<span class="fn__space"></span>`),0<t.blockCount&&(e+=`<span class="ft__on-surface">${window.siyuan.languages.blockCount}</span>&nbsp;${t.blockCount}<span class="fn__space"></span>`),document.querySelector("#status .status__counter").innerHTML=e},EW=(t,e)=>{if(!e){if(getSelection().rangeCount===0)return!1;e=getSelection().getRangeAt(0)}const n=e.commonAncestorContainer;return t.isEqualNode(n)||t.contains(n)},FE=t=>{const e=ue(t.startContainer,"data-type","NodeTable");if(t.toString()!==""&&e&&t.commonAncestorContainer.nodeType!==3){const n=t.commonAncestorContainer.tagName;if(n!=="TH"&&n!=="TD"){const a=A(t.startContainer,"TD")||A(t.startContainer,"TH"),i=A(t.endContainer,"TD")||A(t.endContainer,"TH");if(!a&&!i){const s=e.querySelector("th")||e.querySelector("td");t.setStart(s.firstChild,0),t.setEnd(s.lastChild,s.lastChild.textContent.length)}else a&&!a.contains(t.endContainer)&&qa(a,t,!1)}}},mw=(t,e,n)=>{const a=Ee(e);if(a){let r;if(a.tagName==="TABLE"){const o=A(n.startContainer,"TD")||A(n.startContainer,"TH");if(o&&(r=ya(o,e,n),r.start!==0||r.end!==o.textContent.length))return n.setStart(o.firstChild,0),n.setEndAfter(o.lastChild),t.toolbar.render(t,n),du(n,t.block.rootID),!0}else if(r=ya(a,e,n),r.start!==0||r.end!==a.textContent.length){let o=a.firstChild;for(;o;)if(o.nodeType===3){if(o.textContent!==""){n.setStart(o,0);break}o=o.nextSibling}else{if(o.classList.contains("render-node")||o.classList.contains("img")){n.setStartBefore(o);break}o=o.firstChild}let l=a.lastChild;for(;l;)if(l.nodeType===3){if(l.textContent!==""){n.setEnd(l,l.textContent.length);break}l=l.previousSibling}else{if(l.classList.contains("render-node")||l.classList.contains("img")||l.tagName==="BR"){n.setEndAfter(l);break}l=l.lastChild}return Pt(n),t.toolbar.render(t,n),du(n,t.block.rootID),!0}}n.collapse(!0);const i=t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(t.wysiwyg.element.childElementCount===i.length&&i[0].parentElement===t.wysiwyg.element)return!0;Ut(["select"],t);const s=[];Array.from(t.wysiwyg.element.children).forEach(r=>{const o=r.getAttribute("data-node-id");o&&(r.classList.add("protyle-wysiwyg--select"),s.push(o))}),ss(s,t.block.rootID)},PE=(t,e)=>{const n=document.caretRangeFromPoint(t,e),a=ue(n.startContainer,"data-type","img");return a&&(n.setStart(a.nextSibling,0),n.collapse()),n},hn=t=>{var e,n,a;let i;if(getSelection().rangeCount>0&&(i=getSelection().getRangeAt(0),t===i.startContainer||t.contains(i.startContainer))){if(i.toString()===""&&i.startContainer.nodeType===1){if(i.startOffset===0&&i.startContainer.classList.contains("protyle-wysiwyg")){const r=qt(i.startContainer.firstChild);if(r)return r}if(i.startContainer.getAttribute("contenteditable")!=="true"&&Ee(i.startContainer)){const r=oe(i.startContainer);if(r){const o=qt(r);if(o)return o}}}return i}if(t.classList.contains("li")||t.classList.contains("list")){const r=t.querySelector("[data-node-id]");if(r)return hn(r)}t.focus({preventScroll:!0}),i||(i=document.createRange());let s;if(t.classList.contains("table"))s=t.querySelector("th")||t.querySelector("td");else if(s=Ee(t),s)s.tagName==="TABLE"&&(s=s.querySelector("th")||t.querySelector("td"));else{const r=t.getAttribute("data-type");r==="NodeThematicBreak"?s=t.firstElementChild:r==="NodeBlockQueryEmbed"?s=(e=t.querySelector(".protyle-cursor"))==null?void 0:e.firstChild:["NodeMathBlock","NodeHTMLBlock"].includes(r)?s=(a=(n=t.lastElementChild.previousElementSibling)==null?void 0:n.lastElementChild)==null?void 0:a.firstChild:r==="NodeVideo"?s=t.firstElementChild.firstChild:r==="NodeAudio"&&(s=t.firstElementChild.lastChild)}return i.setStart(s||t,0),i.collapse(!0),i},Dr=(t,e,n=!1)=>{var a,i;if(e||(e=hn(t)),!t.contains(e.startContainer))return{left:0,top:0};let s;if(e.getClientRects().length===0)if(e.startContainer.nodeType===3){const r=(a=e.startContainer.parentElement)==null?void 0:a.getClientRects(),o=(i=e.startContainer.previousElementSibling)==null?void 0:i.getClientRects();if(r.length>0||o.length>0)r.length===0||o&&o.length>0&&r[0].top<o[o.length-1].bottom?s={left:o[o.length-1].left,top:o[o.length-1].bottom}:s=r[0];else return{left:0,top:0}}else{const r=e.startContainer.children;if(r[e.startOffset]&&r[e.startOffset].getClientRects().length>0)s=r[e.startOffset].getClientRects()[0];else if(e.startContainer.childNodes.length>0){const o=e.cloneRange();e.selectNode(e.startContainer.childNodes[Math.max(0,e.startOffset-1)]),s=e.getClientRects()[0],e.setEnd(o.endContainer,o.endOffset),e.setStart(o.startContainer,o.startOffset)}else s=e.startContainer.getClientRects()[0];if(!s){let o=e.startContainer.childNodes[e.startOffset];if(o||(o=e.startContainer.childNodes[e.startOffset-1]),!o)s=e.getBoundingClientRect();else{for(;!o.getClientRects||o.getClientRects&&o.getClientRects().length===0;)o=o.parentElement;s=o.getClientRects()[0]}}}else{const r=e.getClientRects();if(e.toString())if(n){const o=window.getSelection(),l=o&&"direction"in o&&o.direction!=="none"?o.direction==="backward":e.startContainer===(o==null?void 0:o.focusNode)&&e.startOffset===(o==null?void 0:o.focusOffset),c=!l&&r[0].top!==r[r.length-1].top;return{left:l?r[0].left:r[r.length-1].right,top:c?r[r.length-1].bottom:r[0].top,isBottom:c}}else return{left:r[r.length-1].left,top:r[0].top};else return{left:r[r.length-1].left,top:r[r.length-1].top}}return{left:s.left,top:s.top}},ya=(t,e,n)=>{const a={end:0,start:0};if(!n){if(getSelection().rangeCount===0)return a;n=window.getSelection().getRangeAt(0)}if(e&&!EW(e,n))return a;const i=n.cloneRange();return t.childNodes[0]&&t.childNodes[0].childNodes[0]?i.setStart(t.childNodes[0].childNodes[0],0):i.selectNodeContents(t),i.setEnd(n.startContainer,n.startOffset),a.start=i.toString().length+i.cloneContents().querySelectorAll("br").length,a.end=a.start+n.toString().length+n.cloneContents().querySelectorAll("br").length,a};function bw(t,e,n,a){if(!e)return!1;if(n(e))return!0;for(let i=0,s=e.childNodes.length;i<s;i++)if(bw(e,e.childNodes[i],n,!0))return!0;if(!a){let i=e;for(;i&&i!==t;){let s=i.nextSibling;for(;s;){if(bw(t,s,n,!0))return!0;s=s.nextSibling}i=i.parentNode}}return!1}const qa=(t,e,n=!0)=>{if(!t)return e;let a=t.lastChild;for(;a&&a.nodeType!==3&&a.lastChild;)a=a.lastChild;return a||(a=t),n?a.nodeType!==3&&(a.classList.contains("render-node")||a.tagName==="BR")&&a.innerHTML===""?e.setStartAfter(a):e.setStart(a,a.textContent.length):a.nodeType!==3&&(a.classList.contains("render-node")||a.tagName==="BR")&&a.innerHTML===""?e.setEndAfter(a):e.setEnd(a,a.textContent.length),e},uu=(t,e)=>{if(!t)return e;let n=t.firstChild;for(;n&&n.nodeType!==3&&!n.classList.contains("render-node");){if(n.classList.contains("img"))return e.setStartBefore(n),e;n=n.firstChild}return n?(n.nodeType!==3&&n.classList.contains("render-node")?e.setStartBefore(n):e.setStart(n,0),e):(e.selectNodeContents(t),e)},nr=(t,e,n,a=!0)=>{if(!t)return!1;const i=Ee(t);if(i)t=i;else if(a&&(pt(t)||t.classList.contains("av")))return qt(t);let s;bw(t,t.firstChild,l=>{if(l.nodeType===Node.TEXT_NODE){const c=l.data.length;return e<=c?(s=l,!0):(e-=c,n-=c,!1)}else if(l.nodeType===Node.ELEMENT_NODE&&l.tagName==="BR")return e<=1?(s=l,!0):(e-=1,n-=1,!1)});let r;s&&bw(t,s,l=>{if(l.nodeType===Node.TEXT_NODE){const c=l.data.length;return n<=c?(r=l,!0):(n-=c,!1)}});const o=document.createRange();return s?s.nodeType===Node.TEXT_NODE&&e<=s.data.length?o.setStart(s,e):o.setStartAfter(s):e===0?o.setStart(t,0):qa(Ee(t),o),r?n<=r.data.length?o.setEnd(r,n):o.setEndAfter(r):n===0?o.setEnd(t,0):qa(Ee(t),o,!1),a&&Pt(o),o},Xg=(t,e,n)=>{const a=Ee(t);if(!a)return;const i=ya(a,t,e),s=t.cloneNode(!0),r=nr(s,i.end,i.end,!1);r&&r.insertNode(document.createElement("wbr")),n.wysiwyg.lastHTMLs[t.getAttribute("data-node-id")]=s.outerHTML},cn=(t,e)=>{var n;const a=t.querySelectorAll("wbr");if(a.length===0)return;a.forEach((s,r)=>{r!==0&&s.remove()});const i=a[0];if(!i.previousElementSibling)i.previousSibling?e.setStart(i.previousSibling,i.previousSibling.textContent.length):i.nextSibling?i.nextSibling.nodeType===3?e.setStart(i.nextSibling,0):e.setStartAfter(i):e.setStart(i.parentElement,0);else{const s=zt(i);s&&i.previousElementSibling===s?((n=i.previousElementSibling.lastChild)==null?void 0:n.nodeType)===3?e.setStart(i.previousElementSibling.lastChild,i.previousElementSibling.lastChild.textContent.length):s.nodeType!==3&&s.classList.contains("img")?e.setStartAfter(s):e.setStartBefore(i):e.setStart(i.previousSibling,i.previousSibling.textContent.length)}e.collapse(!0),i.remove(),Pt(e)},Pt=t=>{if(!t)return;const e=t.startContainer.childNodes[t.startOffset];if(e&&e.nodeType!==3&&["INPUT","TEXTAREA"].includes(e.tagName)){e.focus();return}const n=window.getSelection();n.removeAllRanges(),n.addRange(t)},qt=(t,e,n=!0)=>{if(!t)return!1;if(t.classList.contains("render-node")||t.classList.contains("iframe")||t.classList.contains("hr")||t.classList.contains("av")){const i=document.createRange(),s=t.getAttribute("data-type");let r=!1;if(s==="NodeThematicBreak")i.selectNodeContents(t.firstElementChild),r=!0;else if(s==="NodeBlockQueryEmbed")Kl(t),i.setStart(t.querySelector(".protyle-cursor").firstChild,0),i.collapse(!0),r=!0;else if(s==="NodeMathBlock")Kl(t),i.setStart(t.firstElementChild.lastElementChild.firstChild,0),r=!0;else if(s==="NodeHTMLBlock")i.setStart(t.lastElementChild.previousElementSibling.lastElementChild.firstChild,0),i.collapse(!0),r=!0;else if(s==="NodeIFrame"||s==="NodeWidget")i.setStart(t,0),r=!0;else if(s==="NodeVideo")i.setStart(t.firstElementChild.firstChild,0),r=!0;else if(s==="NodeAudio")i.setStart(t.firstElementChild.lastChild,0),r=!0;else if(s==="NodeCodeBlock")i.selectNodeContents(t),i.collapse(!0),r=!0;else if(s==="NodeAttributeView"){const o=t.querySelector(".av__cursor");if(o)i.setStart(o.firstChild,0),r=!0;else return t.setAttribute("data-need-focus","true"),!1}return r?(Pt(i),i):(NE(t),!1)}let a;if(n?a=Ee(t):Array.from(t.querySelectorAll('[contenteditable="true"]')).reverse().find(i=>{if(i.getBoundingClientRect().width>0)return a=i,!0}),a){if(a.tagName==="TABLE")if(n)a=a.querySelector("th, td");else{const s=a.querySelectorAll("th, td");a=s[s.length-1]}let i;if(n)i=uu(a,hn(a)),i.collapse(!0);else{let s=!1;if(t.getAttribute("data-type")==="NodeCodeBlock"){let r=a.lastChild;if(r||(a.innerHTML=`
`,r=a.lastChild),r.textContent===""&&r.nodeType===3&&(r=zt(a.lastChild)),r&&r.textContent.endsWith(`
`)){if(r.nodeType===1)for(r=r.lastChild;r&&r.textContent.indexOf(`
`)===-1;)r=r.previousSibling;i=hn(a),i.setStart(r,r.textContent.length-1),s=!0}}s||(i=qa(a,hn(a))),i.collapse(!1)}return Pt(i),i}else if(e)e.focus();else if(t.classList.contains("li"))return qt(t.querySelector("[data-node-id]"),e,n);return!1},NE=t=>{if(t.getAttribute("data-node-id")){let n,a;t.nextElementSibling&&!t.nextElementSibling.classList.contains("protyle-attr")?(a=!0,n=Fe(t)):t.previousElementSibling&&(a=!1,n=ke(t)),n||(n=t),qt(n,void 0,a);return}const e=hn(t);t.nextSibling?(e.selectNodeContents(t.nextSibling),e.collapse(!0)):t.previousSibling&&(e.selectNodeContents(t.previousSibling),e.collapse(!1)),Pt(e)},yw=(t,e,n)=>{e&&(qa(Ee(n[n.length-1]),t.toolbar.range),t.toolbar.range.collapse(!0),Aa(t.lute.SpinBlockDOM(e),t,!0,!0),$n(t,t.wysiwyg.element),zn(t.wysiwyg.element),ra(t.wysiwyg.element))},kW=(t,e)=>{const n=new fe({title:window.siyuan.languages.update,content:`<div class="b3-dialog__content">
    <input class="b3-text-field fn__block" placeholder="${window.siyuan.languages.memo}">
    <div class="fn__hr"></div>
    <textarea class="b3-text-field fn__block" placeholder="${window.siyuan.languages.aiCustomAction}"></textarea>
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--remove">${window.siyuan.languages.delete}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"});n.element.setAttribute("data-key",p.DIALOG_AIUPDATECUSTOMACTION);const a=n.element.querySelector("input");a.value=t;const i=n.element.querySelector("textarea"),s=n.element.querySelectorAll(".b3-button");n.bindInput(i,()=>{s[2].click()}),i.value=e,s[1].addEventListener("click",()=>{n.destroy()}),s[2].addEventListener("click",()=>{window.siyuan.storage[p.LOCAL_AI].find(r=>{if(t===r.name&&e===r.memo)return r.name=a.value,r.memo=i.value,Gt(p.LOCAL_AI,window.siyuan.storage[p.LOCAL_AI]),!0}),n.destroy()}),s[0].addEventListener("click",()=>{window.siyuan.storage[p.LOCAL_AI].find((r,o)=>{if(t===r.name&&e===r.memo)return window.siyuan.storage[p.LOCAL_AI].splice(o,1),Gt(p.LOCAL_AI,window.siyuan.storage[p.LOCAL_AI]),!0}),n.destroy()}),a.focus()},mL=(t,e,n)=>{const a=new fe({title:window.siyuan.languages.aiCustomAction,content:`<div class="b3-dialog__content">
    <input class="b3-text-field fn__block" value="" placeholder="${window.siyuan.languages.memo}">
    <div class="fn__hr"></div>
    <textarea class="b3-text-field fn__block" placeholder="${window.siyuan.languages.aiCustomAction}"></textarea>
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.use}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.save}</button>
</div>`,width:x()?"92vw":"520px"});a.element.setAttribute("data-key",p.DIALOG_AICUSTOMACTION);const i=a.element.querySelector("input"),s=a.element.querySelector("textarea"),r=a.element.querySelectorAll(".b3-button");a.bindInput(s,()=>{r[1].click()}),r[0].addEventListener("click",()=>{a.destroy()}),r[1].addEventListener("click",()=>{if(!s.value){Q(window.siyuan.languages._kernel[142]);return}ae("/api/ai/chatGPTWithAction",{ids:e,action:s.value},o=>{a.destroy(),yw(t,o.data,n)})}),r[2].addEventListener("click",()=>{if(!i.value&&!s.value){Q(window.siyuan.languages._kernel[142]);return}window.siyuan.storage[p.LOCAL_AI].push({name:i.value,memo:s.value}),Gt(p.LOCAL_AI,window.siyuan.storage[p.LOCAL_AI]),a.destroy()}),i.focus()},bL=(t,e)=>{t.querySelectorAll(".b3-list-item").forEach(n=>{n.textContent.indexOf(e.value)>-1?n.classList.remove("fn__none"):n.classList.add("fn__none")}),t.querySelectorAll(".b3-menu__separator").forEach(n=>{e.value?n.classList.add("fn__none"):n.classList.remove("fn__none")}),t.querySelector(".b3-list-item--focus").classList.remove("b3-list-item--focus"),t.querySelector(".b3-list-item:not(.fn__none)").classList.add("b3-list-item--focus")},BE=(t,e)=>{window.siyuan.menus.menu.remove();const n=[];t.forEach(o=>{n.push(o.getAttribute("data-node-id"))});const a=new ta(p.MENU_AI,()=>{Pt(e.toolbar.range)});let i="";window.siyuan.storage[p.LOCAL_AI].forEach((o,l)=>{i+=`<div data-action="${ft(o.memo||o.name)}" data-index="${l}" class="b3-list-item b3-list-item--narrow ariaLabel" aria-label="${Ot(o.memo)}">
    <span class="b3-list-item__text">${he(o.name)}</span>
    <span data-type="edit" class="b3-list-item__action"><svg><use xlink:href="#iconEdit"></use></svg></span>
</div>`}),i&&(i=`<div class="b3-menu__separator"></div>${i}`);const s="Clear context";a.addItem({iconHTML:"",type:"empty",label:`<div class="fn__flex-column b3-menu__filter">
    <input class="b3-text-field fn__flex-shrink" placeholder="${window.siyuan.languages.ai}"/>
    <div class="fn__hr"></div>
    <div class="b3-list fn__flex-1 b3-list--background">
       <div class="b3-list-item b3-list-item--narrow b3-list-item--focus" data-action="Continue writing">
            ${window.siyuan.languages.aiContinueWrite}
        </div>
        <div class="b3-menu__separator"></div>
        <div class="b3-list-item b3-list-item--narrow" data-action="${window.siyuan.languages.aiExtractSummary}">
            ${window.siyuan.languages.aiExtractSummary}
        </div>
        <div class="b3-list-item b3-list-item--narrow" data-action="${window.siyuan.languages.aiBrainStorm}">
            ${window.siyuan.languages.aiBrainStorm}
        </div>
        <div class="b3-list-item b3-list-item--narrow" data-action="${window.siyuan.languages.aiFixGrammarSpell}">
            ${window.siyuan.languages.aiFixGrammarSpell}
        </div>
        <div class="b3-list-item b3-list-item--narrow" data-action="${s}">
            ${window.siyuan.languages.clearContext}
        </div>
        <div class="b3-menu__separator"></div>
        <div class="b3-list-item b3-list-item--narrow" data-type="custom">
            ${window.siyuan.languages.aiCustomAction}
        </div>
        ${i}
    </div>
</div>`,bind(o){const l=o.querySelector(".b3-list"),c=o.querySelector("input");c.addEventListener("keydown",d=>{if(d.isComposing)return;if(pi(l,d)&&d.stopPropagation(),d.key==="Enter"){d.preventDefault(),d.stopPropagation();const g=l.querySelector(".b3-list-item--focus");g.dataset.type==="custom"?(mL(e,n,t),a.close()):(ae("/api/ai/chatGPTWithAction",{ids:n,action:g.dataset.action},f=>{yw(e,f.data,t)}),g.dataset.action===s?Q(window.siyuan.languages.clearContextSucc):a.close())}}),c.addEventListener("compositionend",()=>{bL(o,c)}),c.addEventListener("input",d=>{d.isComposing||bL(o,c)}),o.addEventListener("click",d=>{let u=d.target;for(;u&&u!==o;){if(u.classList.contains("b3-list-item__action")){const g=window.siyuan.storage[p.LOCAL_AI][u.parentElement.dataset.index];kW(g.name,g.memo),a.close(),d.stopPropagation(),d.preventDefault();break}else if(u.classList.contains("b3-list-item")){u.dataset.type==="custom"?(mL(e,n,t),a.close()):(ae("/api/ai/chatGPTWithAction",{ids:n,action:u.dataset.action},g=>{yw(e,g.data,t)}),u.dataset.action===s?Q(window.siyuan.languages.clearContextSucc):a.close()),d.stopPropagation(),d.preventDefault();break}u=u.parentElement}})}}),a.element.querySelector(".b3-menu__items").setAttribute("style","overflow: initial");const r=t[t.length-1].getBoundingClientRect();a.open({x:r.left,y:r.bottom,h:r.height}),a.element.querySelector("input").focus()},yL=(t,e)=>{const n=new fe({title:"\u2728 "+window.siyuan.languages.aiWriting,content:`<div class="b3-dialog__content"><textarea class="b3-text-field fn__block"></textarea></div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"}),a=n.element.querySelector("textarea"),i=n.element.querySelectorAll(".b3-button");n.bindInput(a,()=>{i[1].click()}),a.focus(),i[0].addEventListener("click",()=>{n.destroy()}),i[1].addEventListener("click",()=>{let s=a.value;ae("/api/ai/chatGPT",{msg:s},r=>{n.destroy();let o="";r.data&&r.data!==""&&(o=`

`+r.data),s==="Clear context"&&(s=""),yw(t,`${s}${o}`,[e])})})};class SW{constructor(e){this.enableSlash=!0,this.enableEmoji=!0,this.enableExtend=!1,this.splitChar="",this.lastIndex=-1,this.element=document.createElement("div"),this.element.setAttribute("data-close","false"),this.element.className="protyle-hint b3-list b3-list--background fn__none",this.element.addEventListener("click",n=>{var a;const i=n.target;if(i.tagName==="INPUT"){n.stopPropagation();return}const s=A(i,"BUTTON");if(s&&!s.classList.contains("emojis__item")&&!s.classList.contains("emojis__type")){this.fill(decodeURIComponent(s.getAttribute("data-value")),e,!1,this.source==="search"?ct(n):je(n)),n.preventDefault(),n.stopPropagation();return}const r=this.element.querySelector(".emojis__panel"),o=N(i,"emojis__type");if(o){const c=r.querySelector(`[data-type="${o.getAttribute("data-type")}"]`);if(c){const d=c.nextElementSibling.getAttribute("data-index");if(d){let u="";window.siyuan.emojis[parseInt(d)].items.forEach(g=>{u+=`<button data-unicode="${g.unicode}" class="emojis__item ariaLabel" aria-label="${Fa(g)}">
${Yt(g.unicode)}</button>`}),c.nextElementSibling.innerHTML=u,c.nextElementSibling.removeAttribute("data-index")}r.scrollTo({top:c.offsetTop})}return}const l=N(i,"emojis__item");if(l){const c=l.getAttribute("data-unicode");if(this.element.querySelectorAll(".emojis__title").length>2){const d=getSelection().getRangeAt(0);d.endContainer.nodeType!==3?(a=d.endContainer.childNodes[d.endOffset-1])==null||a.remove():d.endContainer.textContent===":"&&(d.endContainer.textContent=""),Za(c);let u;c.indexOf(".")>-1?u=`:${c.split(".")[0]}: `:u=Yt(c)+" ",Aa(e.lute.SpinBlockDOM(u),e,!1,!0),this.element.classList.add("fn__none")}else this.fill(c,e)}})}render(e){if(!window.getSelection().focusNode){this.element.classList.add("fn__none"),clearTimeout(this.timeId);return}if(!this.enableExtend){clearTimeout(this.timeId);return}if(e.toolbar.range=getSelection().getRangeAt(0),e.toolbar.range.startContainer.nodeType===3&&e.toolbar.range.startContainer.textContent===""){const s=zt(e.toolbar.range.startContainer);if(s&&s.nodeType===3){if(s.wholeText!==s.textContent){let r=s.previousSibling;for(;r&&r.nodeType===3;)if(r.textContent==="")r=r.previousSibling,r.nextSibling.remove();else{s.textContent=r.textContent+s.textContent,r.remove();break}}e.toolbar.range.setStart(s,s.textContent.length),e.toolbar.range.collapse(!0)}}const n=ya(e.toolbar.range.startContainer,e.wysiwyg.element).start,a=e.toolbar.range.startContainer.textContent.substring(0,n)||"",i=this.getKey(a,e.options.hint.extend);if(typeof i=="undefined"||ue(e.toolbar.range.startContainer,"data-type","code")||ue(e.toolbar.range.startContainer,"data-type","NodeCodeBlock")){this.element.classList.add("fn__none"),clearTimeout(this.timeId);return}if(this.splitChar==="#"){const s=oe(e.toolbar.range.startContainer);if(s&&s.getAttribute("data-type")==="NodeHeading"){const r=ya(e.toolbar.range.startContainer,s).start;if(s.textContent.startsWith("#".repeat(r))){this.element.classList.add("fn__none"),clearTimeout(this.timeId);return}}}if(this.splitChar===":"){clearTimeout(this.timeId),i?this.genEmojiHTML(e,i):this.element.classList.add("fn__none");return}if(this.splitChar==="/"||this.splitChar==="\u3001"){clearTimeout(this.timeId),this.enableSlash&&!x()&&this.genHTML(Hv(i,e),e,!1,"hint");return}e.options.hint.extend.forEach(s=>{s.key===this.splitChar&&(clearTimeout(this.timeId),this.timeId=window.setTimeout(()=>{this.genHTML(s.hint(i,e,"hint"),e,!1,"hint")},e.options.hint.delay))})}genLoading(e){if(this.element.classList.contains("fn__none")){this.element.innerHTML='<div class="fn__loading" style="height: 128px;position: initial"><img width="64px" src="/stage/loading-pure.svg"></div>',this.element.classList.remove("fn__none");const n=Dr(e.wysiwyg.element);gn(this.element,n.left,n.top+26,30)}else this.element.insertAdjacentHTML("beforeend",'<div class="fn__loading"><img width="64px" src="/stage/loading-pure.svg"></div>')}bindUploadEvent(e,n){n.querySelectorAll('input[type="file"]').forEach(a=>{a.addEventListener("change",i=>{if(i.target.files.length===0)return;const s=hn(e.wysiwyg.element);this.lastIndex>-1&&s.setStart(s.startContainer,this.lastIndex),s.deleteContents(),_l(e,i.target.files,i.target),Ut(["hint","toolbar"],e)})})}getHTMLByData(e){let n='<div style="flex: 1;overflow:auto;">';return this.source!=="hint"&&(n='<input style="margin:0 8px 4px 8px" class="b3-text-field"><div style="flex: 1;overflow:auto;">'),e.forEach((a,i)=>{let s="";(i===1&&e[i].focus||i===0&&(e.length===1||!e[1].focus))&&(s=" b3-list-item--focus"),a.html==="separator"?n+=`<button data-id="${a.id||""}" class="b3-menu__separator"></button>`:n+=`<button data-id="${a.id||""}" style="width: calc(100% - 16px)" class="b3-list-item b3-list-item--two${s}" data-value="${encodeURIComponent(a.value)}">${a.html}</button>`}),`${n}</div>`}genHTML(e,n,a=!1,i){var s;if(this.source=i,e.length===0){(!this.element.querySelector(".fn__loading")||a)&&this.element.classList.add("fn__none");return}if(this.element.innerHTML=this.getHTMLByData(e),this.element.classList.remove("fn__none"),e[0].filter?this.element.classList.add("hint--menu"):this.element.classList.remove("hint--menu"),this.source==="av"){const o=N(n.toolbar.range.startContainer,"av__cell");if(o){const l=o.getBoundingClientRect();gn(this.element,l.left,l.bottom,l.height)}}else{const o=Dr(n.wysiwyg.element);gn(this.element,o.left,o.top+26,30)}this.element.scrollTop=0;let r=this.element.querySelector(".b3-list-item--focus");for(;No(r,"b3-list-item");)r.classList.remove("b3-list-item--focus"),r=r.nextElementSibling,r==null||r.classList.add("b3-list-item--focus");if(this.bindUploadEvent(n,this.element),this.source!=="hint"){const o=this.element.querySelector("input.b3-text-field"),l=((s=this.element.querySelector("mark"))==null?void 0:s.textContent)||"";o.value=l,o.select(),o.addEventListener("keydown",d=>{d.key!=="Meta"&&d.key!=="Control"&&d.stopPropagation(),!d.isComposing&&(pi(this.element.lastElementChild,d),d.key==="Enter"?(this.fill(decodeURIComponent(this.element.querySelector(".b3-list-item--focus").getAttribute("data-value")),n,!1,ct(d)),d.preventDefault()):d.key==="Escape"&&(this.element.classList.add("fn__none"),Pt(n.toolbar.range)))});const c=n.toolbar.range?oe(n.toolbar.range.startContainer):!1;o.addEventListener("input",d=>{d.isComposing||(d.stopPropagation(),this.genSearchHTML(n,o,c,l,i))}),o.addEventListener("compositionend",d=>{d.stopPropagation(),this.genSearchHTML(n,o,c,l,i)})}}genSearchHTML(e,n,a,i,s){this.element.lastElementChild.innerHTML='<div class="ft__center"><img style="height:32px;width:32px;" src="/stage/loading-pure.svg"></div>',ae("/api/search/searchRefBlock",{k:n.value,id:a?a.getAttribute("data-node-id"):e.block.parentID,beforeLen:Math.floor((Math.max(e.element.clientWidth/2,320)-58)/28.8),rootID:s==="av"?"":e.block.rootID,isDatabase:s==="av"},r=>{let o="";if(r.data.newDoc){const l=`((newFile "${i}"${p.ZWSP}'${r.data.k}${Lute.Caret}'))`;o+=`<button style="width: calc(100% - 16px)" class="b3-list-item b3-list-item--two${r.data.blocks.length===0?" b3-list-item--focus":""}" data-value="${encodeURIComponent(l)}"><div class="b3-list-item__first"><svg class="b3-list-item__graphic"><use xlink:href="#iconFile"></use></svg>
<span class="b3-list-item__text">${window.siyuan.languages.newFile} <mark>${r.data.k}</mark></span></div></button>`}r.data.blocks.forEach((l,c)=>{let d;if(s==="av"){let u=l.name||l.refText.replace(new RegExp(p.ZWSP,"g"),"");a&&(u=l.ial["custom-sy-av-s-text-"+a.getAttribute("data-av-id")]||u),d=`<span data-type="block-ref" data-id="${l.id}" data-subtype="s">${u}</span>`}else d=`<span data-type="block-ref" data-id="${l.id}" data-subtype="s">${i}</span>`;o+=`<button style="width: calc(100% - 16px)" class="b3-list-item b3-list-item--two${c===0?" b3-list-item--focus":""}" data-value="${encodeURIComponent(d)}">
${qv(l)}
</button>`}),o===""&&(o=`<button style="width: calc(100% - 16px)" class="b3-list-item b3-list-item--two" data-value="">${window.siyuan.languages.emptyContent}</button>`),this.element.lastElementChild.innerHTML=o,gn(this.element,parseInt(this.element.style.left),parseInt(this.element.style.right))})}genEmojiHTML(e,n=""){if(n&&!this.enableEmoji)return;const a=this.element.querySelector(".emojis__panel");a?(a.innerHTML=xi(n,256),n?a.nextElementSibling.classList.add("fn__none"):a.nextElementSibling.classList.remove("fn__none"),vi(a)):(this.element.innerHTML=`<div style="padding:0;max-height:min(402px,40vh);width:366px" class="emojis">
<div class="emojis__panel">${xi(n,256)}</div>
<div class="fn__flex${n?" fn__none":""}">
    ${[["2b50",window.siyuan.languages.recentEmoji],["1f527",Oa(0)],["1f60d",Oa(1)],["1f433",Oa(2)],["1f96a",Oa(3)],["1f3a8",Oa(4)],["1f3dd-fe0f",Oa(5)],["1f52e",Oa(6)],["267e-fe0f",Oa(7)],["1f6a9",Oa(8)]].map(([s,r],o)=>`<button data-type="${o}" class="emojis__type ariaLabel" aria-label="${r}">${Yt(s)}</button>`).join("")}
</div>
</div>`,wi(this.element),vi(this.element));const i=this.element.querySelector(".emojis__item");if(i){i.classList.add("emojis__item--current"),this.element.classList.remove("fn__none");const s=Dr(e.wysiwyg.element);gn(this.element,s.left,s.top+26,30),this.element.querySelector(".emojis__panel").scrollTop=0}else this.element.classList.add("fn__none")}fill(e,n,a=!0,i=!1){var s;Ut(["hint","toolbar"],n),a&&this.source!=="av"&&(n.toolbar.range=hn(n.wysiwyg.element));const r=n.toolbar.range;let o=oe(n.toolbar.range.startContainer);if(!o)return;if(this.source==="av"){let u=N(n.toolbar.range.startContainer,"av__cell");if(u||(u=o.querySelector(".av__cell--select")),!u)return;const g=N(u,o.getAttribute("data-av-type")==="table"?"av__row":"av__gallery-item");if(!g)return;const f=g.dataset.id,h=o.getAttribute("data-av-id");let m=document.createElement("div");if(m.innerHTML=e.replace(/<mark>/g,"").replace(/<\/mark>/g,""),m=m.firstElementChild,e.startsWith("((newFile ")&&e.endsWith(`${Lute.Caret}'))`)){const b=e.substring(11,e.length-4).split(`"${p.ZWSP}'`),y=b.length===1?b[0]:b[1],_=Lute.NewNodeID();g.dataset.id=_,kv(n.path,n.notebookId,(v,U)=>{ae("/api/filetree/createDocWithMd",{notebook:U,path:_n().join(v,y),parentID:n.notebookId===U?n.block.rootID:"",markdown:"",id:_},()=>{et(n,[{action:"replaceAttrViewBlock",avID:h,previousID:f,nextID:_,isDetached:!1}],[{action:"replaceAttrViewBlock",avID:h,previousID:_,nextID:f,isDetached:!0}])})}),us(u,{type:"block",isDetached:!1,block:{content:y,id:_}})}else{const b=m.getAttribute("data-id");g.dataset.id=b,et(n,[{action:"replaceAttrViewBlock",avID:h,previousID:f,nextID:b,isDetached:!1}],[{action:"replaceAttrViewBlock",avID:h,previousID:b,nextID:f,isDetached:!0}]),us(u,{type:"block",isDetached:!1,block:{content:m.textContent,id:b}})}return}this.enableExtend=!1;let l="";o&&(l=o.getAttribute("data-node-id"));const c=o.outerHTML,d=p.BLOCK_HINT_CLOSE_KEYS[this.splitChar];if(p.BLOCK_HINT_KEYS.includes(this.splitChar)&&d&&r.startContainer.nodeType===3&&r.startContainer.wholeText.indexOf(d)>-1&&r.startContainer.wholeText.indexOf(this.splitChar)>-1){let u=0,g=r.startContainer;for(;g&&u<2;){const f=g.textContent.indexOf(d),h=g.textContent.indexOf(this.splitChar);if(f>-1&&(f<h||h<0)){u=2,r.setEnd(g,f+2);break}const m=g.textContent.indexOf(d.substr(1));if(m>-1&&(u+=1),u===2){r.setEnd(g,m+1);break}g=g.nextSibling}}if(this.lastIndex>-1&&(r.setStart(r.startContainer,this.lastIndex),Pt(r)),p.BLOCK_HINT_KEYS.includes(this.splitChar)&&e.startsWith("((newFile ")&&e.endsWith(`${Lute.Caret}'))`)){const u=e.substring(11,e.length-4).split(`"${p.ZWSP}'`),g=u.length===1?u[0]:u[1];kv(n.path,n.notebookId,(f,h)=>{ae("/api/filetree/createDocWithMd",{notebook:h,path:_n().join(f,g),parentID:n.notebookId===h?n.block.rootID:"",markdown:""},m=>{n.toolbar.range=r;const b=n.toolbar.setInlineMark(n,"block-ref","range",{type:"id",color:`${m.data}${p.ZWSP}${i?"s":"d"}${p.ZWSP}${(i?u[0]:g).substring(0,window.siyuan.config.editor.blockRefDynamicAnchorTextMaxLen)}`});b[0]&&n.toolbar.range.setEnd(b[0].lastChild,b[0].lastChild.textContent.length),n.toolbar.range.collapse(!1)})});return}if(p.BLOCK_HINT_KEYS.includes(this.splitChar)){if(e===""){const f=Ee(o);f.textContent===""&&(f.innerHTML="<wbr>",cn(f,r));return}let u=document.createElement("div");if(u.innerHTML=e.replace(/<mark>/g,"").replace(/<\/mark>/g,""),u=u.firstElementChild,i){const f=r.toString().replace(this.splitChar,"");f&&(u.setAttribute("data-subtype","s"),u.innerText=f)}else{u.setAttribute("data-subtype","d");const f=u.innerText.split(p.ZWSP);f.length===2&&(u.innerText=f[1])}const g=n.toolbar.setInlineMark(n,"block-ref","range",{type:"id",color:`${u.getAttribute("data-id")}${p.ZWSP}${u.getAttribute("data-subtype")}${p.ZWSP}${u.textContent}`});g[0]&&n.toolbar.range.setEnd(g[0].lastChild,g[0].lastChild.textContent.length),n.toolbar.range.collapse(!1);return}else if(this.splitChar===":"){Za(e);let u;e.indexOf(".")>-1?u=`:${e.split(".")[0]}: `:u=Yt(e)+" ",Aa(n.lute.SpinBlockDOM(u),n)}else if(["\u300C\u300C","\u300C\u300E","\u300E\u300C","\u300E\u300E","{{"].includes(this.splitChar)||this.splitChar==="#"||this.splitChar===":"){if(e===""){const u=Ee(o);u.textContent===""&&(u.innerHTML="<wbr>",cn(u,r));return}Aa(n.lute.SpinBlockDOM(e),n,!1,x()),$n(n,n.wysiwyg.element);return}else if(this.splitChar==="/"||this.splitChar==="\u3001")if(this.enableExtend=!0,e==="(("||e==="{{"){e==="(("?ic("",n,"hint"):Tf("",n),this.splitChar=e,this.lastIndex=0,r.deleteContents();const u=document.createTextNode(e);r.insertNode(u),r.setEnd(u,e.length),r.collapse(!1),Pt(r);return}else if(e===p.ZWSP){r.deleteContents(),this.fixImageCursor(r),n.toolbar.showTpl(n,o,r),Ht(n,l,o.outerHTML,c);return}else if(e===p.ZWSP+1){r.deleteContents(),this.fixImageCursor(r),n.toolbar.showWidget(n,o,r),Ht(n,l,o.outerHTML,c);return}else if(e===p.ZWSP+2){r.deleteContents(),this.fixImageCursor(r),n.toolbar.range=r;const u=Dr(o,r);zv(n,{x:u.left,y:u.top+26,w:0,h:26}),Ht(n,l,o.outerHTML,c);return}else if(e===p.ZWSP+3){r.deleteContents();return}else if(e===p.ZWSP+4){Oo({app:n.app,notebookId:n.notebookId,useSavePath:!0,currentPath:n.path,afterCB:(u,g)=>{Aa(`<span data-type="block-ref" data-id="${u}" data-subtype="d">${g}</span>`,n)}});return}else if(e===p.ZWSP+6){const u=Lute.NewNodeID();ae("/api/filetree/createDoc",{notebook:n.notebookId,path:_n().join(ha(n.path,!1,!0),u+".sy"),title:window.siyuan.languages.untitled,md:""},()=>{Aa(`<span data-type="block-ref" data-id="${u}" data-subtype="d">${window.siyuan.languages.untitled}</span>`,n),dn({app:n.app,id:u,action:[p.CB_GET_CONTEXT,p.CB_GET_OPENNEW]})});return}else if(e===p.ZWSP+5){r.deleteContents(),yL(n,o);return}else if(p.INLINE_TYPE.includes(e)){if(r.deleteContents(),Pt(r),["a","block-ref","inline-math","inline-memo","text"].includes(e)){n.toolbar.element.querySelector(`[data-type="${e}"]`).dispatchEvent(new CustomEvent("click"));return}n.toolbar.setInlineMark(n,e,"range");return}else if(e==="emoji"){r.deleteContents(),r.insertNode(document.createTextNode(":")),r.collapse(!1),Pt(r),this.genEmojiHTML(n);return}else if(e.startsWith("style")){r.deleteContents(),this.fixImageCursor(r),o.setAttribute("style",e.split(p.ZWSP)[1]||""),Ht(n,l,o.outerHTML,c);return}else if(e.startsWith("plugin")){n.app.plugins.find(u=>{const g=e.split(p.ZWSP);if(g[1]===u.name)return u.protyleSlash.find(f=>{if(f.id===g[2])return f.callback(n.getInstance(),o),!0}),!0});return}else{r.deleteContents(),e!=="![]()"&&this.fixImageCursor(r);let u=e;e==="```"&&(u=e+(p.SIYUAN_RENDER_CODE_LANGUAGES.includes(window.siyuan.storage[p.LOCAL_CODELANG])?"":window.siyuan.storage[p.LOCAL_CODELANG])+Lute.Caret+"\n```");const g=Ee(o);if(e==="![]()"){let f="";r.insertNode(document.createElement("wbr")),r.insertNode(document.createTextNode(e)),f=n.lute.SpinBlockDOM(o.outerHTML),o.outerHTML=f,o=n.wysiwyg.element.querySelector(`[data-node-id="${l}"]`),cn(o,r),Ht(n,l,o.outerHTML,c);let h=r.startContainer.childNodes[r.startOffset-1]||r.startContainer;h&&h.nodeType!==3&&h.classList.contains("img")||(((s=h.previousSibling)==null?void 0:s.nodeType)!==3&&h.previousSibling.classList.contains("img")?h=h.previousSibling:Array.from(o.querySelectorAll(".img")).find(b=>{if(b.querySelector("img").getAttribute("data-src")==="")return h=b,!0}));const m=h.getBoundingClientRect();Kv(n,r,h,{clientX:m.left,clientY:m.top});return}else if(g.textContent===""&&o.getAttribute("data-type")==="NodeParagraph"){let f="";e==="<div>"?f=`<div data-node-id="${l}" data-type="NodeHTMLBlock" class="render-node" data-subtype="block">${pr()}<div><protyle-html data-content=""></protyle-html><span style="position: absolute">${p.ZWSP}</span></div><div class="protyle-attr" contenteditable="false"></div></div>`:(g.textContent=u,f=n.lute.SpinBlockDOM(o.outerHTML)),o.outerHTML=f,o=n.wysiwyg.element.querySelector(`[data-node-id="${l}"]`),o.getAttribute("data-type")==="NodeTable"&&(o.querySelectorAll("colgroup col").forEach(h=>{h.style.minWidth="60px"}),f=o.outerHTML),Ht(n,l,f,c)}else{let f=n.lute.SpinBlockDOM(u);e==="<div>"&&(f=`<div data-node-id="${Lute.NewNodeID()}" data-type="NodeHTMLBlock" class="render-node" data-subtype="block">${pr()}<div><protyle-html data-content=""></protyle-html><span style="position: absolute">${p.ZWSP}</span></div><div class="protyle-attr" contenteditable="false"></div></div>`);const h=o.outerHTML;let m;o.getAttribute("data-type")==="NodeHeading"&&o.getAttribute("fold")==="1"&&(m=La(n,o,!0,!1,!1,!0)),o.insertAdjacentHTML("afterend",f);const b=f.substr(f.indexOf('data-node-id="')+14,22);o=n.wysiwyg.element.querySelector(`[data-node-id="${b}"]`),o.getAttribute("data-type")==="NodeTable"&&o.querySelectorAll("colgroup col").forEach(v=>{v.style.minWidth="60px"});const y=[{data:h,id:l,action:"update"},{data:o.outerHTML,id:b,previousID:l,action:"insert"}],_=[{id:b,action:"delete"},{data:c,id:l,action:"update"}];m&&(y.push(...m.doOperations),_.push(...m.undoOperations)),et(n,y,_)}if(e==="<div>"||e==="$$"||e.indexOf("```")>-1&&(e.length>3||o.classList.contains("render-node")))n.toolbar.showRender(n,o),zn(o);else if(e.startsWith("```"))ra(o);else if(e.startsWith("<iframe")||e.startsWith("<video")||e.startsWith("<audio")){n.gutter.renderMenu(n,o);const f=o.getBoundingClientRect();window.siyuan.menus.menu.popup({x:f.left,y:f.top,isLeft:!0});const h=window.siyuan.menus.menu.element.querySelector('[data-id="assetVideo"], [data-id="assetAudio"], [data-id="assetIFrame"]');h.classList.add("b3-menu__item--show"),window.siyuan.menus.menu.showSubMenu(h.querySelector(".b3-menu__submenu")),window.siyuan.menus.menu.element.querySelector("textarea").focus()}else e==="---"?qt(o):o.classList.contains("av")?Ua(o,n,()=>{const f=o.querySelector(".av__title");f.focus(),r.setStart(f,0),r.collapse(!0),Pt(r)}):cn(o,r)}}select(e,n){var a,i,s,r,o;const l=this.element.firstElementChild.classList.contains("emojis");if(this.element.querySelectorAll("button").length===0&&!l)return!1;if(e.key==="Enter"){if(l){const c=this.element.querySelector(".emojis__item--current");if(!c)return!1;const d=c.getAttribute("data-unicode");if(this.element.querySelectorAll(".emojis__title").length>2){const u=getSelection().getRangeAt(0);u.endContainer.nodeType!==3&&((a=u.endContainer.childNodes[u.endOffset-1])==null||a.remove()),Za(d);let g;d.indexOf(".")>-1?g=`:${d.split(".")[0]}: `:g=Yt(d)+" ",Aa(n.lute.SpinBlockDOM(g),n),this.element.classList.add("fn__none")}else this.fill(d,n)}else{const c=decodeURIComponent(this.element.querySelector(".b3-list-item--focus").getAttribute("data-value"));c===p.ZWSP+3?this.element.querySelector(".b3-list-item--focus input").click():this.fill(c,n,!0,je(e))}return e.preventDefault(),e.stopPropagation(),!0}if(l){const c=this.element.querySelector(".emojis__item--current");if(!c)return!1;let d;if(e.key==="ArrowLeft")c.previousElementSibling?(c.classList.remove("emojis__item--current"),d=c.previousElementSibling):(i=c.parentElement.previousElementSibling)!=null&&i.previousElementSibling&&(c.classList.remove("emojis__item--current"),d=c.parentElement.previousElementSibling.previousElementSibling.lastElementChild);else if(e.key==="ArrowRight")c.nextElementSibling?(c.classList.remove("emojis__item--current"),d=c.nextElementSibling):(s=c.parentElement.nextElementSibling)!=null&&s.nextElementSibling&&(c.classList.remove("emojis__item--current"),d=c.parentElement.nextElementSibling.nextElementSibling.firstElementChild);else if(e.key==="ArrowDown"){if(c.nextElementSibling){c.classList.remove("emojis__item--current");let u=Math.floor(c.parentElement.clientWidth/(c.clientWidth+2));for(d=c;d.nextElementSibling&&u>0;)d=d.nextElementSibling,u--}else{const u=(r=c.parentElement.nextElementSibling)==null?void 0:r.nextElementSibling;u&&(d=u.firstElementChild,c.classList.remove("emojis__item--current"))}e.preventDefault(),e.stopPropagation()}else if(e.key==="ArrowUp"){if(c.previousElementSibling){c.classList.remove("emojis__item--current");let u=Math.floor(c.parentElement.clientWidth/(c.clientWidth+2));for(d=c;d.previousElementSibling&&u>0;)d=d.previousElementSibling,u--}else{const u=(o=c.parentElement.previousElementSibling)==null?void 0:o.previousElementSibling;u&&(d=u.lastElementChild,c.classList.remove("emojis__item--current"))}e.preventDefault(),e.stopPropagation()}if(d){d.classList.add("emojis__item--current");const u=this.element.querySelector(".emojis__panel");if(d.offsetTop-8<u.scrollTop)u.scrollTop=d.offsetTop-8;else{const g=u.nextElementSibling.classList.contains("fn__none")?8:36;d.offsetTop+g-this.element.clientHeight+d.clientHeight>u.scrollTop&&(u.scrollTop=d.offsetTop+g-this.element.clientHeight+d.clientHeight)}}return e.preventDefault(),e.stopPropagation(),!0}else if(e.key==="ArrowDown"||e.key==="ArrowUp")return pi(this.element.firstElementChild,e),e.preventDefault(),e.stopPropagation(),!0;return e.key==="ArrowLeft"||e.key==="ArrowRight"?(Ut(["hint"],n),!0):!1}fixImageCursor(e){const n=zt(e.startContainer);n&&n.nodeType!==3&&n.classList.contains("img")&&(_t(n)||(e.insertNode(document.createTextNode(p.ZWSP)),e.collapse(!1)))}getKey(e,n){const a=this.splitChar,i=this.lastIndex;if(this.lastIndex=-1,this.splitChar="",n.forEach(o=>{let l=e.lastIndexOf(o.key);p.BLOCK_HINT_KEYS.includes(o.key)&&l>-1&&e.lastIndexOf(o.key+o.key.substring(0,1))>-1&&(l=Math.min(l,e.lastIndexOf(o.key+o.key.substring(0,1)))),this.lastIndex<l&&(this.splitChar=o.key,this.lastIndex=l)}),this.lastIndex===-1)return;!this.element.classList.contains("fn__none")&&a&&a!==this.splitChar&&(this.splitChar=a,this.lastIndex=i),this.splitChar===":"&&(this.enableEmoji=!(/\d/.test(e.substr(this.lastIndex-1,1))||e.substr(this.lastIndex-1,2)==="::"));const s=e.split(this.splitChar),r=s[s.length-1];if(s.length>1&&r.trimStart()===r&&r.length<p.SIZE_TITLE)return this.splitChar==="\u3010\u3010"&&e.endsWith("\u3010\u3010\u3011")?"":r}}const AW=t=>{const e=Lute.New();if(e.SetSpellcheck(window.siyuan.config.editor.spellcheck),e.SetProtyleMarkNetImg(window.siyuan.config.editor.displayNetImgMark),e.SetFileAnnotationRef(!0),e.SetHTMLTag2TextMark(!0),e.SetTextMark(!0),e.SetHeadingID(!1),e.SetYamlFrontMatter(!1),e.PutEmojis(t.emojis),e.SetEmojiSite(t.emojiSite),e.SetHeadingAnchor(t.headingAnchor),e.SetInlineMathAllowDigitAfterOpenMarker(!0),e.SetToC(!1),e.SetIndentCodeBlock(!1),e.SetParagraphBeginningSpace(!0),e.SetSetext(!1),e.SetFootnotes(!1),e.SetLinkRef(!1),e.SetSanitize(t.sanitize),e.SetChineseParagraphBeginningSpace(t.paragraphBeginningSpace),e.SetRenderListStyle(t.listStyle),e.SetImgPathAllowSpace(!0),e.SetKramdownIAL(!0),e.SetTag(!0),e.SetSuperBlock(!0),e.SetInlineAsterisk(window.siyuan.config.editor.markdown.inlineAsterisk),e.SetInlineUnderscore(window.siyuan.config.editor.markdown.inlineUnderscore),e.SetSup(window.siyuan.config.editor.markdown.inlineSup),e.SetSub(window.siyuan.config.editor.markdown.inlineSub),e.SetTag(window.siyuan.config.editor.markdown.inlineTag),e.SetInlineMath(window.siyuan.config.editor.markdown.inlineMath),e.SetGFMStrikethrough1(!1),e.SetGFMStrikethrough(window.siyuan.config.editor.markdown.inlineStrikethrough),e.SetMark(window.siyuan.config.editor.markdown.inlineMark),e.SetSpin(!0),e.SetProtyleWYSIWYG(!0),t.lazyLoadImage&&e.SetImageLazyLoading(t.lazyLoadImage),e.SetBlockRef(!0),window.siyuan.emojis[0].items.length>0){const n={};window.siyuan.emojis[0].items.forEach(a=>{n[a.keywords]=t.emojiSite+"/"+a.unicode}),e.PutEmojis(n)}return e.SetUnorderedListMarker("-"),e},TW=(t,e)=>{if(typeof speechSynthesis=="undefined"||typeof SpeechSynthesisUtterance=="undefined")return;const n='<svg><use xlink:href="#iconPlay"></use></svg>',a='<svg><use xlink:href="#iconPause"></use></svg>';let i=document.querySelector(".protyle-speech");if(!i){i=document.createElement("div"),i.className="protyle-speech",document.body.insertAdjacentElement("beforeend",i);const s=()=>{const o=speechSynthesis.getVoices();let l,c;return o.forEach(d=>{d.lang===e.replace("_","-")&&(l=d),d.default&&(c=d)}),l||(l=c),l};speechSynthesis.onvoiceschanged!==void 0&&(speechSynthesis.onvoiceschanged=s);const r=s();i.onclick=()=>{if(i.className==="protyle-speech"){const o=new SpeechSynthesisUtterance(i.getAttribute("data-text"));o.voice=r,o.onend=()=>{i.className="protyle-speech",speechSynthesis.cancel(),i.innerHTML=n},speechSynthesis.speak(o),i.className="protyle-speech protyle-speech--current",i.innerHTML=a}else speechSynthesis.speaking&&(speechSynthesis.paused?(speechSynthesis.resume(),i.innerHTML=a):(speechSynthesis.pause(),i.innerHTML=n));Pt(window.protyleSpeechRange)},document.body.addEventListener("click",()=>{getSelection().toString().trim()===""&&i.style.display==="block"&&(i.className="protyle-speech",speechSynthesis.cancel(),i.style.display="none")})}t.addEventListener("mouseup",s=>{const r=getSelection().toString().trim();if(speechSynthesis.cancel(),getSelection().toString().trim()===""){i.style.display==="block"&&(i.className="protyle-speech",i.style.display="none");return}window.protyleSpeechRange=getSelection().getRangeAt(0).cloneRange();const o=getSelection().getRangeAt(0).getBoundingClientRect();i.innerHTML=n,i.style.display="block",i.style.top=o.top+o.height+document.querySelector("html").scrollTop-20+"px",i.style.left=s.screenX+2+"px",i.setAttribute("data-text",r)})};var DW=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class CW{constructor(e){this.element=document.createElement("div"),this.element.className="protyle-preview fn__none";const n=document.createElement("div");n.className="b3-typography",e.options.classes.preview&&n.classList.add(e.options.classes.preview);const a=e.options.preview.actions,i=document.createElement("div");i.className="protyle-preview__action";const s=[];for(let r=0;r<a.length;r++){const o=a[r];if(typeof o=="object"){s.push(`<button type="button" data-type="${o.key}" class="${o.className}">${o.text}</button>`);continue}switch(o){case"desktop":s.push(`<button type="button" class="protyle-preview__action--current" data-type="desktop">${window.siyuan.languages.desktop}</button>`);break;case"tablet":s.push(`<button type="button" data-type="tablet">${window.siyuan.languages.tablet}</button>`);break;case"mobile":s.push(`<button type="button" data-type="mobile">${window.siyuan.languages.mobile}</button>`);break;case"mp-wechat":s.push(`<button type="button" data-type="mp-wechat" class="b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.copyToWechatMP}"><svg><use xlink:href="#iconMp"></use></svg></button>`);break;case"zhihu":s.push(`<button type="button" data-type="zhihu" class="b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.copyToZhihu}"><svg><use xlink:href="#iconZhihu"></use></svg></button>`);break;case"yuque":s.push(`<button type="button" data-type="yuque" class="b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.copyToYuque}"><svg><use xlink:href="#iconYuque"></use></svg></button>`);break}}i.innerHTML=s.join(""),this.element.appendChild(i),this.element.appendChild(n),this.element.addEventListener("click",r=>{let o=r.target;for(;o&&!o.isEqualNode(this.element);){if(o.tagName==="A"){const c=o.getAttribute("href");if(c.startsWith("#")){const d=c.substring(1);n.querySelector('[data-node-id="'+d+'"], [id="'+d+'"]').scrollIntoView(),r.stopPropagation(),r.preventDefault();break}if(x()){$e(c),r.stopPropagation(),r.preventDefault();break}r.stopPropagation(),r.preventDefault(),Mo(c)?je(r)?rL(c,"folder"):r.shiftKey?rL(c,"app"):p.SIYUAN_ASSETS_EXTS.includes(_n().extname(c.split("?")[0]))&&kc(e.app,c.split("?page")[0],parseInt(O("page",c))):window.open(c);break}else if(o.tagName==="IMG"){LS(r.target.getAttribute("src"),e.block.rootID),r.stopPropagation(),r.preventDefault();break}else if(o.tagName==="BUTTON"){const c=o.getAttribute("data-type"),d=a.find(u=>(u==null?void 0:u.key)===c);d?d.click(c):c==="mp-wechat"||c==="zhihu"||c==="yuque"?this.copyToX(this.element.lastElementChild.cloneNode(!0),e,c):c==="desktop"?(n.style.width="",n.style.padding=e.wysiwyg.element.style.padding):c==="tablet"?(n.style.width="1024px",n.style.padding="8px 16px"):(n.style.width="360px",n.style.padding="8px"),c!=="mp-wechat"&&c!=="zhihu"&&c!=="yuque"&&(i.querySelectorAll("button").forEach(u=>{u.classList.remove("protyle-preview__action--current")}),o.classList.add("protyle-preview__action--current"))}o=o.parentElement}const l=ue(r.target,"id",void 0);l&&(this.element.querySelectorAll(".protyle-wysiwyg--select").forEach(c=>{c.classList.remove("selected")}),l.classList.add("selected"),e.model&&Cn().outline.forEach(c=>{c.blockId===e.block.rootID&&c.setCurrentByPreview(l)}))}),this.previewElement=n}render(e){var n;if(this.element.style.display==="none")return;if((n=this.element.querySelector('.protyle-preview__action [data-type="desktop"]'))!=null&&n.classList.contains("protyle-preview__action--current")){const i=PA(e);this.previewElement.style.padding=`${i.top}px ${i.left}px ${i.bottom}px ${i.right}px`}let a=this.element.querySelector(".fn__loading");a||(this.element.insertAdjacentHTML("beforeend",`<div style="flex-direction: column;" class="fn__loading">
    <img width="48px" src="/stage/loading-pure.svg">
</div>`),a=this.element.querySelector(".fn__loading")),this.mdTimeoutId=window.setTimeout(()=>{ae("/api/export/preview",{id:e.block.id||e.options.blockId||e.block.parentID},i=>{const s=e.preview.previewElement.scrollTop;e.preview.previewElement.innerHTML=i.data.html,zn(e.preview.previewElement),ra(e.preview.previewElement),Ua(e.preview.previewElement,e),TW(e.preview.previewElement,e.options.lang),e.preview.previewElement.scrollTop=s,a.remove()})},e.options.preview.delay)}link2online(e){Ml("")||e.querySelectorAll("[href],[src]").forEach(n=>{const a=n.getAttribute("href")||n.getAttribute("src");if(a&&a.startsWith("assets/")){const i=p.ASSETS_ADDRESS+window.siyuan.user.userId+"/"+a;n.getAttribute("href")?n.setAttribute("href",i):n.setAttribute("src",i)}})}copyToX(e,n,a){return DW(this,null,function*(){if(a==="mp-wechat")this.link2online(e),e.querySelectorAll(".katex-html .base").forEach(r=>{r.style.display="initial"}),e.querySelectorAll("mjx-container > svg").forEach(r=>{r.setAttribute("width",parseInt(r.getAttribute("width"))*8+"px")}),e.querySelectorAll("ul, ol").forEach(r=>{Array.from(r.children).forEach(o=>{const l=o.querySelector("ul, ol");l&&o.parentNode.insertBefore(l,o.nextSibling)})}),e.querySelectorAll("li.protyle-task").forEach(r=>{const o=r.querySelector('input[type="checkbox"]');o&&(o.style.opacity="0",o.checked?r.style.setProperty("list-style-type","'\u2705'","important"):r.style.setProperty("list-style-type","'\u25A2'","important"))}),typeof window.MathJax=="undefined"&&(window.MathJax={svg:{fontCache:"none"}}),yield hl(`${p.PROTYLE_CDN}/js/mathjax/tex-svg-full.js`,"protyleMathJaxScript"),yield window.MathJax.startup.promise,e.querySelectorAll('[data-subtype="math"]').forEach(r=>{const o=window.MathJax.tex2svg(Lute.UnEscapeHTMLStr(r.getAttribute("data-content")).trim(),{display:r.tagName==="DIV"});o.querySelector("mjx-assistive-mml").remove(),r.innerHTML=o.outerHTML});else if(a==="zhihu")this.link2online(e),e.querySelectorAll('[data-subtype="math"]').forEach(r=>{r.outerHTML=`<img class="Formula-image" data-eeimg="true" src="//www.zhihu.com/equation?tex=" alt="${r.getAttribute("data-content")}" style="${r.tagName==="DIV"?"display: block; max-width: 100%;":""}margin: 0 auto;">`}),e.querySelectorAll("blockquote").forEach(r=>{const o=[];this.processZHBlockquote(r,o),o.reverse().forEach(l=>{r.insertAdjacentElement("afterend",l)}),r.remove()}),this.processZHTable(e);else if(a==="yuque"){ae("/api/lute/copyStdMarkdown",{id:n.block.id||n.options.blockId||n.block.parentID,assetsDestSpace2Underscore:!0,fillCSSVar:!0,adjustHeadingLevel:!0},r=>{ut(r.data),Q(`${window.siyuan.languages.pasteToYuque}`)});return}e.style.backgroundColor="#fff",e.querySelectorAll("code").forEach(r=>{r.style.backgroundImage="none"}),this.element.append(e),e.insertAdjacentHTML("beforeend","<p>&zwj;</p>");let i;getSelection().rangeCount>0&&(i=getSelection().getRangeAt(0).cloneRange());const s=e.ownerDocument.createRange();s.selectNodeContents(e),Pt(s),document.execCommand("copy"),this.element.lastElementChild.remove(),Pt(i),a&&Q(`${a==="zhihu"?window.siyuan.languages.pasteToZhihu:window.siyuan.languages.pasteToWechatMP}`)})}processZHBlockquote(e,n){Array.from(e.children).forEach(a=>{if(a.tagName==="BLOCKQUOTE")this.processZHBlockquote(a,n);else if(a.tagName!=="P"||a.querySelector("img"))n.push(a);else{const i=n[n.length-1];(!i||i&&i.tagName!=="BLOCKQUOTE")&&n.push(document.createElement("blockquote")),n[n.length-1].append(a)}})}processZHTable(e){e.querySelectorAll("table").forEach(n=>{const a=n.querySelector("thead");if(!a)return;const i=n.querySelector("tbody");i?i.insertAdjacentElement("afterbegin",a.firstElementChild):n.innerHTML=`<tbody>${a.innerHTML}</tbody>`,a.remove()})}}const $E=(...t)=>{const e={},n=a=>{for(const i in a)a.hasOwnProperty(i)&&(Object.prototype.toString.call(a[i])==="[object Object]"?e[i]=$E(e[i],a[i]):e[i]=a[i])};for(let a=0;a<t.length;a++)n(t[a]);return e};class LW{constructor(e){this.defaultOptions={mode:"wysiwyg",blockId:"",render:{background:!1,title:!1,titleShowTop:!1,hideTitleOnZoom:!1,gutter:!0,scroll:!1,breadcrumb:!0,breadcrumbDocName:!1},action:[],after:void 0,classes:{preview:""},click:{preventInsetEmptyBlock:!1},hint:{delay:200,emoji:{"+1":"\u{1F44D}","-1":"\u{1F44E}",confused:"\u{1F615}",eyes:"\u{1F440}\uFE0F",heart:"\u2764\uFE0F",rocket:"\u{1F680}\uFE0F",smile:"\u{1F604}",tada:"\u{1F389}\uFE0F"},emojiPath:"/emojis",extend:[{key:"((",hint:ic},{key:"\u3010\u3010",hint:ic},{key:"\uFF08\uFF08",hint:ic},{key:"[[",hint:ic},{key:"{{",hint:Tf},{key:"\u300C\u300C",hint:Tf},{key:"\u300C\u300E",hint:Tf},{key:"\u300E\u300C",hint:Tf},{key:"\u300E\u300E",hint:Tf},{key:"#",hint:DM},{key:"/",hint:Hv},{key:"\u3001",hint:Hv},{key:":"}]},lang:window.siyuan.config.appearance.lang,preview:{actions:["desktop","tablet","mobile","mp-wechat","zhihu","yuque"],delay:0,markdown:{paragraphBeginningSpace:window.siyuan.config.export.paragraphBeginningSpace,listStyle:!1,sanitize:!0},mode:"both"},toolbar:p.PROTYLE_TOOLBAR,typewriterMode:!1,upload:{max:1024*1024*1024*8,url:p.UPLOAD_ADDRESS,extraData:{},fieldName:"file[]",filename:n=>n.replace(/[\\/:*?"'<>|\[\]\(\)~!`&{}=#%$]/g,""),linkToImgUrl:"",withCredentials:!1}},this.options=e}merge(){var e;return this.options&&(this.options.toolbar?this.options.toolbar=this.mergeToolbar(this.options.toolbar):this.options.toolbar=this.mergeToolbar(this.defaultOptions.toolbar),(e=this.options.hint)!=null&&e.emoji&&(this.defaultOptions.hint.emoji=this.options.hint.emoji)),$E(this.defaultOptions,this.options)}mergeToolbar(e){return e_(e)}}class IW{constructor(e){this.parentElement=document.createElement("div"),this.parentElement.classList.add("protyle-scroll"),this.parentElement.innerHTML=`<div class="protyle-scroll__up ariaLabel" data-position="north" aria-label="${Mt("\u2318Home")}">
    <svg><use xlink:href="#iconUp"></use></svg>
</div>
<div class="fn__none protyle-scroll__bar ariaLabel" data-position="2west" aria-label="Blocks 1/1">
    <input class="b3-slider" type="range" max="1" min="1" step="1" value="1" />
</div>
<div class="protyle-scroll__down ariaLabel" aria-label="${Mt("\u2318End")}">
    <svg><use xlink:href="#iconDown"></use></svg>
</div>`,this.element=this.parentElement.querySelector(".protyle-scroll__bar"),this.keepLazyLoad=!1,e.options.render.scroll||this.parentElement.classList.add("fn__none"),this.lastScrollTop=0,this.inputElement=this.element.firstElementChild,this.inputElement.addEventListener("input",()=>{this.element.setAttribute("aria-label",`Blocks ${this.inputElement.value}/${e.block.blockCount}`),hr(this.element.getAttribute("aria-label"),this.element)}),this.inputElement.addEventListener("change",()=>{this.setIndex(e)}),this.inputElement.addEventListener("touchend",()=>{this.setIndex(e)}),this.parentElement.addEventListener("click",n=>{const a=n.target;N(a,"protyle-scroll__up")?Uv(e):N(a,"protyle-scroll__down")?yS(e):a.classList.contains("b3-slider")&&this.setIndex(e)}),this.parentElement.addEventListener("mousewheel",n=>{n.deltaY!==0&&e.scroll.lastScrollTop!==-1&&(e.contentElement.scrollTop+=n.deltaY)},{passive:!0})}setIndex(e){e.wysiwyg.element.getAttribute("data-top")||(e.wysiwyg.element.setAttribute("data-top",e.wysiwyg.element.scrollTop.toString()),e.contentElement.style.overflow="hidden",ae("/api/filetree/getDoc",{index:parseInt(this.inputElement.value),id:e.block.parentID,mode:0,size:window.siyuan.config.editor.dynamicLoadBlocks},n=>{_a({data:n,protyle:e,action:[p.CB_GET_FOCUSFIRST,p.CB_GET_UNCHANGEID],afterCB:()=>{setTimeout(()=>{e.contentElement.style.overflow=""},p.TIMEOUT_INPUT),hr(this.element.getAttribute("aria-label"),this.element)}})}))}updateIndex(e,n,a){ae("/api/block/getBlockIndex",{id:n},i=>{if(!i.data)return;const s=e.scroll.element.querySelector(".b3-slider");s.value=i.data,e.scroll.element.setAttribute("aria-label",`Blocks ${i.data}/${e.block.blockCount}`),a&&a(i.data)})}update(e){typeof e.block.blockCount=="number"&&(this.inputElement.setAttribute("max",e.block.blockCount.toString()),this.element.setAttribute("aria-label",`Blocks ${this.inputElement.value}/${e.block.blockCount}`)),e.block.showAll?this.element.classList.add("fn__none"):e.block.scroll&&!e.contentElement.classList.contains("fn__none")?this.element.classList.remove("fn__none"):this.element.classList.add("fn__none")}}var _w=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const _L=(t,e,n,a,i,s)=>_w(void 0,null,function*(){var r,o,l,c,d,u,g,f,h;const m=[],b=[],y=[],_=n.getAttribute("data-node-id"),v=[];let U=n,ee=!0;e.find(S=>{if(!S.classList.contains("li")||!n.classList.contains("li")||n.getAttribute("data-subtype")!==S.getAttribute("data-subtype"))return ee=!1,!0});let Z,k;const w={};for(let S=e.length-1;S>=0;S--){const B=e[S],H=B.getAttribute("data-node-id"),j=B.parentElement.getAttribute("data-node-id")||t.block.parentID||t.block.rootID;B.getAttribute("data-type")==="NodeListItem"&&!k&&!ee&&(k=Lute.NewNodeID(),Z=document.createElement("div"),Z.innerHTML=`<div data-subtype="${B.getAttribute("data-subtype")}" data-node-id="${k}" data-type="NodeList" class="list"><div class="protyle-attr" contenteditable="false">${p.ZWSP}</div></div>`,Z=Z.firstElementChild,m.push({action:"insert",data:Z.outerHTML,id:k,previousID:i==="afterbegin"?null:i==="afterend"?_:(r=U.previousElementSibling)==null?void 0:r.getAttribute("data-node-id"),parentID:i==="afterbegin"?_:((o=U.parentElement)==null?void 0:o.getAttribute("data-node-id"))||t.block.parentID||t.block.rootID}),b.push({action:"delete",id:k}),U.insertAdjacentElement(i,Z),v.push(Z));const re=Lute.NewNodeID();s&&B.getAttribute("data-type")==="NodeHeading"&&B.getAttribute("fold")==="1"&&y.push({newId:re,oldId:H});let Te;if(s?b.push({action:"delete",id:re}):b.push({action:"move",id:H,previousID:(l=B.previousElementSibling)==null?void 0:l.getAttribute("data-node-id"),parentID:j}),!a&&!s){const Be=t.wysiwyg.element.querySelector(`[data-node-id="${H}"]`);Be&&Be.remove()}if(s)Te=B.cloneNode(!0),Te.setAttribute("data-node-id",re),Te.querySelectorAll("[data-node-id]").forEach(Be=>{const Ie=Lute.NewNodeID();Be.setAttribute("data-node-id",Ie),Be.setAttribute("updated",Ie.split("-")[0])}),k?(Z.insertAdjacentElement("afterbegin",Te),m.push({action:"insert",id:re,data:Te.outerHTML,parentID:k})):(U.insertAdjacentElement(i,Te),m.push({action:"insert",id:re,data:Te.outerHTML,previousID:i==="afterbegin"?null:i==="afterend"?_:(c=Te.previousElementSibling)==null?void 0:c.getAttribute("data-node-id"),parentID:i==="afterbegin"?_:((d=Te.parentElement)==null?void 0:d.getAttribute("data-node-id"))||t.block.parentID||t.block.rootID}),v.push(Te));else{const Be=It(B),Ie=B.parentElement;if(B.classList.contains("li")&&B.getAttribute("data-subtype")==="o"&&(w[B.parentElement.getAttribute("data-node-id")]=B.parentElement),k?(Z.insertAdjacentElement("afterbegin",B),m.push({action:"move",id:H,parentID:k})):(U.insertAdjacentElement(i,B),m.push({action:"move",id:H,previousID:i==="afterbegin"?null:i==="afterend"?_:(u=B.previousElementSibling)==null?void 0:u.getAttribute("data-node-id"),parentID:i==="afterbegin"?_:((g=B.parentElement)==null?void 0:g.getAttribute("data-node-id"))||t.block.parentID||t.block.rootID}),v.push(B)),Be!==B){m.push({action:"delete",id:Be.getAttribute("data-node-id")}),b.push({action:"insert",data:Be.outerHTML,id:Be.getAttribute("data-node-id"),previousID:(f=Be.previousElementSibling)==null?void 0:f.getAttribute("data-node-id"),parentID:((h=Be.parentElement)==null?void 0:h.getAttribute("data-node-id"))||t.block.parentID||t.block.rootID});const Ce=Be.parentElement;if(Be.remove(),!a){const Je=t.wysiwyg.element.querySelector(`[data-node-id="${Be.getAttribute("data-node-id")}"]`);Je&&Je.remove()}if(Ce.classList.contains("sb")&&Ce.childElementCount===2)if(a){const Je=yield Uo(t,Ce);m.push(Je.doOperations[0],Je.doOperations[1]),b.push(Je.undoOperations[1],Je.undoOperations[0])}else{const Je=Es();for(let ze=0;ze<Je.length;ze++)if(Je[ze].protyle.element.contains(Ce)){const Ze=yield Uo(Je[ze].protyle,Ce);m.push(Ze.doOperations[0],Ze.doOperations[1]),b.push(Ze.undoOperations[1],Ze.undoOperations[0]),Je[ze].protyle.undo.clear();break}}}else if(Ie.classList.contains("sb")&&Ie.childElementCount===2)if(a){const Ce=yield Uo(t,Ie);m.push(Ce.doOperations[0],Ce.doOperations[1]),b.push(Ce.undoOperations[1],Ce.undoOperations[0])}else{const Ce=Es();for(let Je=0;Je<Ce.length;Je++)if(Ce[Je].protyle.element.contains(Ie)){const ze=yield Uo(Ce[Je].protyle,Ie);m.push(ze.doOperations[0],ze.doOperations[1]),b.push(ze.undoOperations[1],ze.undoOperations[0]),Ce[Je].protyle.undo.clear();break}}else Ie.classList.contains("protyle-wysiwyg")&&Ie.childElementCount===0&&Es().find(Ce=>{if(Ce.protyle.element.contains(Ie)){if(Ce.protyle.block.showAll)hi({protyle:Ce.protyle,id:Ce.protyle.block.rootID});else{const Je=Lute.NewNodeID();m.splice(0,0,{action:"insert",id:Je,data:Fs(!1,!1,Je).outerHTML,parentID:Ce.protyle.block.parentID}),b.splice(0,0,{action:"delete",id:Je})}return!0}})}k&&(S===0||e[S-1].getAttribute("data-type")!=="NodeListItem"||e[S-1].getAttribute("data-subtype")!==B.getAttribute("data-subtype"))?(i==="beforebegin"&&(U=Z),k=null,Z.getAttribute("data-subtype")==="o"&&Z.firstElementChild.getAttribute("data-marker")!=="1."&&(Array.from(Z.children).forEach(Be=>{Be.classList.contains("protyle-attr")||b.push({action:"update",id:Be.getAttribute("data-node-id"),data:Be.outerHTML})}),xa(Z,1),Array.from(Z.children).forEach(Be=>{Be.classList.contains("protyle-attr")||m.push({action:"update",id:Be.getAttribute("data-node-id"),data:Be.outerHTML})}),xa(Z,1))):i==="beforebegin"&&(U=s?Te:B)}Object.keys(w).forEach(S=>{Array.from(w[S].children).forEach(B=>{B.classList.contains("protyle-attr")||b.push({action:"update",id:B.getAttribute("data-node-id"),data:B.outerHTML})}),xa(w[S],1),Array.from(w[S].children).forEach(B=>{B.classList.contains("protyle-attr")||m.push({action:"update",id:B.getAttribute("data-node-id"),data:B.outerHTML})})}),b.reverse();for(let S=0;S<y.length;S++){const B=y[S],H=yield wn("/api/block/getHeadingInsertTransaction",{id:B.oldId});H.data.doOperations.splice(0,1),H.data.doOperations[0].previousID=B.newId,H.data.undoOperations.splice(0,1),m.push(...H.data.doOperations),b.push(...H.data.undoOperations)}return{doOperations:m,undoOperations:b,newSourceElements:v}}),wL=(t,e,n,a,i,s)=>_w(void 0,null,function*(){var r,o,l,c;const d=t.element.contains(e[0]);if(d&&e[0].classList.contains("li")&&n===e[0].parentElement&&n.childElementCount===e.length+1&&!e.find(U=>{if(!n.contains(U))return!0}))return;const u=[],g={action:"move",id:n.getAttribute("data-node-id"),previousID:(r=n.previousElementSibling)==null?void 0:r.getAttribute("data-node-id"),parentID:((o=n.parentElement)==null?void 0:o.getAttribute("data-node-id"))||t.block.parentID||t.block.rootID},f=AS(i);n.parentElement.replaceChild(f,n);const h=[{action:"insert",data:f.outerHTML,id:f.getAttribute("data-node-id"),nextID:(l=f.nextElementSibling)==null?void 0:l.getAttribute("data-node-id"),previousID:(c=f.previousElementSibling)==null?void 0:c.getAttribute("data-node-id"),parentID:f.parentElement.getAttribute("data-node-id")||t.block.parentID||t.block.rootID}];f.lastElementChild.before(n);const m=yield _L(t,e,f,d,"afterbegin",s);h.push(...m.doOperations),u.push(...m.undoOperations);const b=m.newSourceElements;let y=h.length;h.find((v,U)=>{v.action==="delete"&&v.id===g.parentID&&(y=U),v.action==="delete"&&v.id===n.getAttribute("data-node-id")&&(n=f.querySelector(`[data-node-id="${h[U-1].id}"]`))}),a?(f.insertAdjacentElement("afterbegin",n),h.splice(y,0,{action:"move",id:n.getAttribute("data-node-id"),parentID:f.getAttribute("data-node-id")})):(f.lastElementChild.insertAdjacentElement("beforebegin",n),h.splice(y,0,{action:"move",id:n.getAttribute("data-node-id"),previousID:b[0].getAttribute("data-node-id")})),u.push(g),u.push({action:"delete",id:f.getAttribute("data-node-id")});let _=!1;b.forEach(v=>{if(v.getAttribute("data-type")==="NodeHeading"&&v.getAttribute("fold")==="1"){if(_=!0,v.nextElementSibling&&(v.nextElementSibling.getAttribute("data-type")!=="NodeHeading"||v.nextElementSibling.getAttribute("data-subtype")>v.getAttribute("data-subtype"))){const U=La(t,v,!0,!1,!1,!0);h.push(...U.doOperations)}return!0}}),d||s?et(t,h,u):et(t,h),(b.length>1||_)&&i==="col"&&Qs({protyle:t,selectsElement:b.reverse(),type:"BlocksMergeSuperBlock",level:"row"}),document.contains(e[0])?qt(e[0]):qt(n)}),vL=(t,e,n,a,i)=>_w(void 0,null,function*(){const s=t.element.contains(e[0]),r=[],o=[],l=yield _L(t,e,n,s,a?"afterend":"beforebegin",i);r.push(...l.doOperations),o.push(...l.undoOperations);const c=l.newSourceElements;let d;a&&n.getAttribute("data-type")==="NodeHeading"&&n.getAttribute("fold")==="1"?d=La(t,n,!0,!1,!1,!0):!a&&n.previousElementSibling&&n.previousElementSibling.getAttribute("data-type")==="NodeHeading"&&n.previousElementSibling.getAttribute("fold")==="1"&&(d=La(t,n.previousElementSibling,!0,!1,!1,!0)),d&&(d.doOperations[0].context={focusId:e[0].getAttribute("data-node-id")},r.push(...d.doOperations),o.push(...d.undoOperations)),n.getAttribute("data-type")==="NodeListItem"&&n.getAttribute("data-subtype")==="o"&&(Array.from(n.parentElement.children).forEach(g=>{g.classList.contains("protyle-attr")||o.splice(0,0,{action:"update",id:g.getAttribute("data-node-id"),data:g.outerHTML})}),xa(n.parentElement,1),Array.from(n.parentElement.children).forEach(g=>{g.classList.contains("protyle-attr")||r.push({action:"update",id:g.getAttribute("data-node-id"),data:g.outerHTML})}));let u=!1;c.forEach(g=>{if(g.getAttribute("data-type")==="NodeHeading"&&g.getAttribute("fold")==="1"){if(u=!0,g.nextElementSibling&&(g.nextElementSibling.getAttribute("data-type")!=="NodeHeading"||g.nextElementSibling.getAttribute("data-subtype")>g.getAttribute("data-subtype"))){const f=La(t,g,!0,!1,!1,!0);r.push(...f.doOperations)}return!0}}),s||i?et(t,r,o):et(t,r),(c.length>1||u)&&c[0].parentElement.classList.contains("sb")&&c[0].parentElement.getAttribute("data-sb-layout")==="col"&&Qs({protyle:t,selectsElement:c.reverse(),type:"BlocksMergeSuperBlock",level:"row"}),document.contains(e[0])?qt(e[0]):qt(n)}),MW=(t,e)=>{e.addEventListener("dragstart",s=>{var r,o,l;if(t.disabled){s.preventDefault(),s.stopPropagation();return}let c=s.target;if((r=c.classList)!=null&&r.contains("av__gallery-img")&&(c=N(c,"av__gallery-item")),!!c){if(c.tagName==="IMG"){window.siyuan.dragElement=void 0,s.preventDefault();return}if(c.classList){if(N(c,"protyle-wysiwyg__embed"))window.siyuan.dragElement=void 0,s.preventDefault();else if(c.parentElement.parentElement.classList.contains("av__views")){window.siyuan.dragElement=c,c.style.width=c.clientWidth+"px",c.style.opacity=".36",s.dataTransfer.setData(`${p.SIYUAN_DROP_GUTTER}NodeAttributeView${p.ZWSP}ViewTab${p.ZWSP}${[(o=c.previousElementSibling)==null?void 0:o.getAttribute("data-id")]}`,c.outerHTML);return}else if(c.classList.contains("protyle-action")){c.parentElement.classList.add("protyle-wysiwyg--select");const d=document.createElement("div");d.className=t.wysiwyg.element.className,d.append(Ji(c.parentElement.cloneNode(!0))),d.setAttribute("style",`position:fixed;opacity:.1;width:${c.parentElement.clientWidth}px;padding:0;`),document.body.append(d),s.dataTransfer.setDragImage(d,0,0),setTimeout(()=>{d.remove()}),window.siyuan.dragElement=t.wysiwyg.element,s.dataTransfer.setData(`${p.SIYUAN_DROP_GUTTER}NodeListItem${p.ZWSP}${c.parentElement.getAttribute("data-subtype")}${p.ZWSP}${[c.parentElement.getAttribute("data-node-id")]}`,t.wysiwyg.element.innerHTML);return}else if(c.classList.contains("av__cell--header")){window.siyuan.dragElement=c,s.dataTransfer.setData(`${p.SIYUAN_DROP_GUTTER}NodeAttributeView${p.ZWSP}Col${p.ZWSP}${[c.getAttribute("data-col-id")]}`,c.outerHTML);return}else if(c.classList.contains("av__gallery-item")){const d=oe(c);if(d){if((l=d.querySelector('.block__icon[data-type="av-sort"]'))!=null&&l.classList.contains("block__icon--active")){const y=d.querySelectorAll(".av__body");if(y.length===1){s.preventDefault(),s.stopPropagation();return}else if(["template","created","updated"].includes(y[0].getAttribute("data-dtype"))){s.preventDefault(),s.stopPropagation();return}}c.classList.contains("av__gallery-item--select")||(d.querySelectorAll(".av__gallery-item--select").forEach(y=>{y.classList.remove("av__gallery-item--select")}),c.classList.add("av__gallery-item--select"));const u=document.createElement("div");u.className="protyle-wysiwyg protyle-wysiwyg--attr";const g=d.getAttribute("data-av-type")==="kanban";g&&(u.innerHTML=`<div class="${d.querySelector(".av__kanban").className}"></div>`);let f,h=document.createElement("div");const m=d.querySelectorAll(".av__gallery-item--select");m.forEach(y=>{(!f||!f.contains(y))&&(f=y.parentElement,h=document.createElement("div"),g?(h.className="av__kanban-group",h.setAttribute("style",y.parentElement.parentElement.parentElement.getAttribute("style")),h.innerHTML='<div class="av__gallery"></div>',u.firstElementChild.appendChild(h)):(h.classList.add("av__gallery"),h.setAttribute("style",`width: 100vw;margin-bottom: 16px;grid-template-columns: repeat(auto-fill, ${m[0].clientWidth}px);`),u.appendChild(h)));const _=Ji(y.cloneNode(!0));_.setAttribute("style",`height:${y.clientHeight}px;`),_.classList.remove("av__gallery-item--select"),g?h.firstElementChild.appendChild(_):h.appendChild(_)}),u.setAttribute("style","left: 1px;top:100vh;position:fixed;opacity:.1;padding:0;z-index: 8"),document.body.append(u),s.dataTransfer.setDragImage(u,-10,-10),setTimeout(()=>{u.remove()}),window.siyuan.dragElement=c;const b=[];d.querySelectorAll(".av__gallery-item--select").forEach(y=>{const v=N(y,"av__body").getAttribute("data-group-id");b.push(y.getAttribute("data-id")+(v?`@${v}`:""))}),s.dataTransfer.setData(`${p.SIYUAN_DROP_GUTTER}NodeAttributeView${p.ZWSP}GalleryItem${p.ZWSP}${b}`,u.outerHTML)}return}}s.dataTransfer.setData(p.SIYUAN_DROP_EDITOR,p.SIYUAN_DROP_EDITOR),t.element.style.userSelect="auto",document.onmousemove=null,document.onmouseup=null}}),e.addEventListener("drop",s=>_w(void 0,null,function*(){var r,o,l,c,d,u;if(i=0,t.disabled||s.dataTransfer.getData(p.SIYUAN_DROP_EDITOR)){s.preventDefault(),s.stopPropagation();return}let g="";for(const h of s.dataTransfer.items)h.type.startsWith(p.SIYUAN_DROP_GUTTER)&&(g=h.type);if(g.startsWith(`${p.SIYUAN_DROP_GUTTER}NodeAttributeView${p.ZWSP}ViewTab${p.ZWSP}`.toLowerCase())){const h=oe(window.siyuan.dragElement);if(h){const m=h.getAttribute("data-av-id"),b=h.getAttribute("data-node-id"),y=window.siyuan.dragElement.getAttribute("data-id");et(t,[{action:"sortAttrViewView",avID:m,blockID:b,id:y,previousID:(r=window.siyuan.dragElement.previousElementSibling)==null?void 0:r.getAttribute("data-id"),data:"unRefresh"}],[{action:"sortAttrViewView",avID:m,blockID:b,id:y,previousID:g.split(p.ZWSP).pop()}])}return}const f=e.querySelector(".dragover__left, .dragover__right, .dragover__bottom, .dragover__top");if(f&&(f.classList.remove("dragover"),f.removeAttribute("select-start"),f.removeAttribute("select-end")),g){const h=[],m=g.replace(p.SIYUAN_DROP_GUTTER,"").split(p.ZWSP),b=m[2].split(",");if(s.altKey||s.shiftKey)if(s.y>t.wysiwyg.element.lastElementChild.getBoundingClientRect().bottom)Ms(t,"afterend",t.wysiwyg.element.lastElementChild.getAttribute("data-node-id"));else{const y=PE(s.clientX,s.clientY);if(ue(y.startContainer,"data-type","NodeBlockQueryEmbed"))return;Pt(y)}if(s.altKey){let y="";for(let _=0;_<b.length;_++){const v=yield wn("/api/block/getRefText",{id:b[_]});y+=t.lute.Md2BlockDOM(`((${b[_]} '${v.data}'))`)}Aa(y,t)}else if(s.shiftKey){let y="";b.forEach(_=>{y+=`{{select * from blocks where id='${_}'}}
`}),Aa(t.lute.SpinBlockDOM(y),t,!0),$n(t,t.wysiwyg.element)}else if(f&&f.className.indexOf("dragover__")>-1){let y="";if(b.forEach(ee=>{y+=`[data-node-id="${ee}"],`}),window.siyuan.dragElement)window.siyuan.dragElement.querySelectorAll(y.substring(0,y.length-1)).forEach(ee=>{ge(ee)||h.push(ee)});else if(window.siyuan.config.system.workspaceDir.toLowerCase()===m[3]){const ee=document.createElement("template");ee.innerHTML=`<div>${s.dataTransfer.getData(g)}</div>`,ee.content.querySelectorAll(y.substring(0,y.length-1)).forEach(Z=>{ge(Z)||h.push(Z)})}const _=[],v=[];h.forEach(ee=>{ee.classList.remove("protyle-wysiwyg--hl"),ee.removeAttribute("select-start"),ee.removeAttribute("select-end"),ee.querySelectorAll('[data-type="search-mark"]').forEach(k=>{k.outerHTML=k.innerHTML});const Z=ee.getAttribute("data-node-id");_.push(Z),v.push({itemID:Lute.NewNodeID(),id:Z,isDetached:!1})}),Ut(["gutter"],t);const U=f.className.split(" ");if(f.classList.remove("dragover__bottom","dragover__top","dragover__left","dragover__right"),f.classList.contains("av__cell")){const ee=oe(f);if(ee){const Z=ee.getAttribute("data-av-id");let k="";U.includes("dragover__left")?f.previousElementSibling&&(f.previousElementSibling.classList.contains("av__colsticky")?k=f.previousElementSibling.lastElementChild.getAttribute("data-col-id"):k=f.previousElementSibling.getAttribute("data-col-id")):k=f.getAttribute("data-col-id");let w="";const S=N(f,"av__row");if(S){const B=(o=S.querySelector(`[data-col-id="${m[2]}"`))==null?void 0:o.previousElementSibling;B&&(B.classList.contains("av__colsticky")?w=B.lastElementChild.getAttribute("data-col-id"):w=B.getAttribute("data-col-id"))}k!==w&&k!==m[2]&&et(t,[{action:"sortAttrViewCol",avID:Z,previousID:k,id:m[2],blockID:ee.dataset.nodeId}],[{action:"sortAttrViewCol",avID:Z,previousID:w,id:m[2],blockID:ee.dataset.nodeId}])}}else if(f.classList.contains("av__row")){const ee=oe(f);if(ee){let Z="";U.includes("dragover__bottom")?Z=f.getAttribute("data-id")||"":Z=((l=f.previousElementSibling)==null?void 0:l.getAttribute("data-id"))||"";const k=ee.getAttribute("data-av-id");if(m[0]==="nodeattributeviewrowmenu"){const w=[],S=[],B=f.parentElement.getAttribute("data-group-id");b.reverse().forEach(H=>{var j;const re=H.split("@"),Te=re[0],Be=re[1]||"",Ie=((j=ee.querySelector(`.av__body${Be?`[data-group-id="${Be}"]`:""} .av__row[data-id="${Te}"]`).previousElementSibling)==null?void 0:j.getAttribute("data-id"))||"";(Z!==Te&&Ie!==Z||Ie===""&&Z===""&&B!==Be)&&(w.push({action:"sortAttrViewRow",avID:k,previousID:Z,id:Te,blockID:ee.dataset.nodeId,groupID:Be,targetGroupID:B}),S.push({action:"sortAttrViewRow",avID:k,previousID:Ie,id:Te,blockID:ee.dataset.nodeId,groupID:B,targetGroupID:Be}))}),et(t,w,S)}else{const w=at().format("YYYYMMDDHHmmss"),S=N(f,"av__body"),B=S&&S.getAttribute("data-group-id");et(t,[{action:"insertAttrViewBlock",avID:k,previousID:Z,srcs:v,blockID:ee.dataset.nodeId,groupID:B},{action:"doUpdateUpdated",id:ee.dataset.nodeId,data:w}],[{action:"removeAttrViewBlock",srcIDs:_,avID:k},{action:"doUpdateUpdated",id:ee.dataset.nodeId,data:ee.getAttribute("updated")}]),ee.setAttribute("updated",w),Hy({protyle:t,blockElement:ee,srcIDs:_,previousId:Z,groupID:B})}}}else if(f.classList.contains("av__gallery-item")||f.classList.contains("av__gallery-add")){const ee=oe(f);if(ee){let Z="";U.includes("dragover__right")||U.includes("dragover__bottom")?Z=f.getAttribute("data-id")||"":(U.includes("dragover__top")||U.includes("dragover__left"))&&(Z=((c=f.previousElementSibling)==null?void 0:c.getAttribute("data-id"))||"");const k=ee.getAttribute("data-av-id");if(m[1]==="galleryitem"&&m[0]==="nodeattributeview"){const w=[],S=[],B=f.parentElement.parentElement.getAttribute("data-group-id");b.reverse().forEach(H=>{var j;const re=H.split("@"),Te=re[0],Be=re[1]||"",Ie=((j=ee.querySelector(`.av__body[data-group-id="${Be}"] .av__gallery-item[data-id="${Te}"]`).previousElementSibling)==null?void 0:j.getAttribute("data-id"))||"";(Z!==H&&Ie!==Z||Ie===""&&Z===""&&B!==Be)&&(w.push({action:"sortAttrViewRow",avID:k,previousID:Z,id:Te,blockID:ee.dataset.nodeId,groupID:Be,targetGroupID:B}),S.push({action:"sortAttrViewRow",avID:k,previousID:Ie,id:Te,blockID:ee.dataset.nodeId,groupID:B,targetGroupID:Be}))}),et(t,w,S)}else{const w=at().format("YYYYMMDDHHmmss"),S=N(f,"av__body");et(t,[{action:"insertAttrViewBlock",avID:k,previousID:Z,srcs:v,blockID:ee.dataset.nodeId,groupID:S&&S.getAttribute("data-group-id")},{action:"doUpdateUpdated",id:ee.dataset.nodeId,data:w}],[{action:"removeAttrViewBlock",srcIDs:_,avID:k},{action:"doUpdateUpdated",id:ee.dataset.nodeId,data:ee.getAttribute("updated")}]),ee.setAttribute("updated",w),C2({protyle:t,blockElement:ee,srcIDs:_,previousId:Z,groupID:f.parentElement.getAttribute("data-group-id")})}}}else h.length>0&&(f.parentElement.getAttribute("data-type")==="NodeSuperBlock"&&f.parentElement.getAttribute("data-sb-layout")==="col"?U.includes("dragover__left")||U.includes("dragover__right")?vL(t,h,f,U.includes("dragover__right"),s.ctrlKey):wL(t,h,f,U.includes("dragover__bottom"),"row",s.ctrlKey):U.includes("dragover__left")||U.includes("dragover__right")?wL(t,h,f,U.includes("dragover__right"),"col",s.ctrlKey):vL(t,h,f,U.includes("dragover__bottom"),s.ctrlKey),e.querySelectorAll(".protyle-wysiwyg--empty").forEach(ee=>{ee.classList.remove("protyle-wysiwyg--empty")}),t.wysiwyg.element.querySelectorAll('[data-type="NodeBlockQueryEmbed"]').forEach(ee=>{ee.removeAttribute("data-render"),$n(t,ee)}));n=void 0}}else if(((d=s.dataTransfer.getData(p.SIYUAN_DROP_FILE))==null?void 0:d.split("-").length)>1){const h=s.dataTransfer.getData(p.SIYUAN_DROP_FILE).split(",");if(!s.altKey&&(!f||!f.classList.contains("av__row")&&!f.classList.contains("av__gallery-item")&&!f.classList.contains("av__gallery-add"))){if(s.y>t.wysiwyg.element.lastElementChild.getBoundingClientRect().bottom)Ms(t,"afterend",t.wysiwyg.element.lastElementChild.getAttribute("data-node-id"));else{const b=PE(s.clientX,s.clientY);if(ue(b.startContainer,"data-type","NodeBlockQueryEmbed"))return;Pt(b)}let m="";for(let b=0;b<h.length;b++){h.length>1&&(m+="- ");const y=yield wn("/api/block/getRefText",{id:h[b]});m+=`((${h[b]} '${y.data}'))`,h.length>1&&b!==h.length-1&&(m+=`
`)}Aa(t.lute.Md2BlockDOM(m),t)}else if(f&&!t.options.backlinkData&&f.className.indexOf("dragover__")>-1){const m=t.contentElement.scrollTop;if(f.classList.contains("av__row")||f.classList.contains("av__gallery-item")||f.classList.contains("av__gallery-add")){const b=oe(f);if(b){let y="";f.classList.contains("dragover__bottom")||f.classList.contains("dragover__right")?y=f.getAttribute("data-id")||"":(f.classList.contains("dragover__top")||f.classList.contains("dragover__left"))&&(y=((u=f.previousElementSibling)==null?void 0:u.getAttribute("data-id"))||"");const _=b.getAttribute("data-av-id"),v=at().format("YYYYMMDDHHmmss"),U=[],ee=N(f,"av__body"),Z=ee&&ee.getAttribute("data-group-id");h.forEach(k=>{U.push({itemID:Lute.NewNodeID(),id:k,isDetached:!1})}),et(t,[{action:"insertAttrViewBlock",avID:_,previousID:y,srcs:U,blockID:b.dataset.nodeId,groupID:Z},{action:"doUpdateUpdated",id:b.dataset.nodeId,data:v}],[{action:"removeAttrViewBlock",srcIDs:h,avID:_},{action:"doUpdateUpdated",id:b.dataset.nodeId,data:b.getAttribute("updated")}]),Hy({protyle:t,blockElement:b,srcIDs:h,previousId:y,groupID:Z}),b.setAttribute("updated",v)}}else{if(f.classList.contains("dragover__bottom"))for(let b=h.length-1;b>-1;b--)h[b]&&(yield wn("/api/filetree/doc2Heading",{srcID:h[b],after:!0,targetID:f.getAttribute("data-node-id")}));else for(let b=0;b<h.length;b++)h[b]&&(yield wn("/api/filetree/doc2Heading",{srcID:h[b],after:!1,targetID:f.getAttribute("data-node-id")}));ae("/api/filetree/getDoc",{id:t.block.id,size:window.siyuan.config.editor.dynamicLoadBlocks},b=>{_a({data:b,protyle:t}),sp({protyle:t,focus:!1,pushBackStack:!1,reload:!0,resize:!1}),setTimeout(()=>{t.contentElement.scrollTop=m,t.scroll.lastScrollTop=m-1},p.TIMEOUT_LOAD)})}f.classList.remove("dragover__bottom","dragover__top","dragover__left","dragover__right")}}else if(!window.siyuan.dragElement&&(s.dataTransfer.types[0]==="Files"||s.dataTransfer.types.includes("text/html"))){s.preventDefault();const h=N(s.target,"av");if(h){const m=N(s.target,"av__cell");if(m&&Ns(m)==="mAsset"&&s.dataTransfer.types[0]==="Files"&&!W()){const b=[];for(let y=0;y<s.dataTransfer.files.length;y++)b.push(webUtils.getPathForFile(s.dataTransfer.files[y]));FS(b,t,m),si(["cell"],h)}}else{if(Pt(PE(s.clientX,s.clientY)),s.dataTransfer.types[0]==="Files"&&!W()){const m=[];for(let b=0;b<s.dataTransfer.files.length;b++)m.push(webUtils.getPathForFile(s.dataTransfer.files[b]));Qv(m,t,!s.altKey)}else _f(t,s);si(["av","img"],t.wysiwyg.element)}}window.siyuan.dragElement&&(window.siyuan.dragElement.style.opacity="",window.siyuan.dragElement=void 0)}));let n,a;e.addEventListener("dragover",s=>{var r,o,l,c,d;if(t.disabled||s.dataTransfer.types.includes(p.SIYUAN_DROP_EDITOR)){s.preventDefault(),s.stopPropagation(),s.dataTransfer.dropEffect="none";return}let u="";for(const _ of s.dataTransfer.items)_.type.startsWith(p.SIYUAN_DROP_GUTTER)&&(u=_.type);if(u.startsWith(`${p.SIYUAN_DROP_GUTTER}NodeAttributeView${p.ZWSP}ViewTab${p.ZWSP}`.toLowerCase())){R5(s),s.preventDefault();return}const g=t.contentElement.getBoundingClientRect();!N(s.target,"av__cell")&&(s.clientY<g.top+p.SIZE_SCROLL_TB||s.clientY>g.bottom-p.SIZE_SCROLL_TB)&&t.contentElement.scroll({top:t.contentElement.scrollTop+(s.clientY<g.top+p.SIZE_SCROLL_TB?-p.SIZE_SCROLL_STEP:p.SIZE_SCROLL_STEP),behavior:"smooth"});let f;if(s.dataTransfer.types.includes("Files")){if(f=N(s.target,"av__cell"),f&&f.getAttribute("data-dtype")==="mAsset"&&!f.classList.contains("av__cell--header")){if(s.preventDefault(),n&&f===n)return;const _=oe(f);_&&(si(["cell","row"],t.wysiwyg.element),f.classList.add("av__cell--select"),_.getAttribute("data-av-type")!=="gallery"&&Js(f),n=f)}return}if(!u&&!window.siyuan.dragElement){s.preventDefault();return}const h=u?u.replace(p.SIYUAN_DROP_GUTTER,"").split(p.ZWSP):[],m=s.dataTransfer.types.includes(p.SIYUAN_DROP_FILE)&&window.siyuan.dragElement?window.siyuan.dragElement.innerText:"";if(s.shiftKey||s.altKey&&m.indexOf("-")===-1){const _=oe(s.target);_?(_.classList.remove("dragover__top","protyle-wysiwyg--select","dragover__bottom","dragover__left","dragover__right"),_.removeAttribute("select-start"),_.removeAttribute("select-end")):e.querySelectorAll(".dragover__top, .protyle-wysiwyg--select, .dragover__bottom, .dragover__left, .dragover__right").forEach(v=>{v.classList.remove("dragover__top","protyle-wysiwyg--select","dragover__bottom","dragover__left","dragover__right"),v.removeAttribute("select-start"),v.removeAttribute("select-end")}),s.preventDefault();return}if(s.preventDefault(),f=N(s.target,"av__gallery-item")||N(s.target,"av__gallery-add")||N(s.target,"av__row")||N(s.target,"av__row--util")||oe(s.target),f&&["gallery","kanban"].includes(f.getAttribute("data-av-type"))&&s.target.classList.contains("av__gallery"))return;const b={x:s.clientX,y:s.clientY,className:""};if(f&&(f.classList.contains("bq")||f.classList.contains("sb")||f.classList.contains("list")||f.classList.contains("li"))){let _=oe(document.elementFromPoint(b.x,b.y-6));for(;_&&f.contains(_);)(r=_.nextElementSibling)!=null&&r.getAttribute("data-node-id")&&(f=_),_=_.parentElement}if(f)f&&f.classList.contains("list")&&(h[0]!=="nodelistitem"?f=oe(document.elementFromPoint(s.clientX,s.clientY-6)):f=N(document.elementFromPoint(s.clientX,s.clientY-6),"li"));else if(s.clientY>e.lastElementChild.getBoundingClientRect().bottom)f=e.lastElementChild,b.className="dragover__bottom";else if(s.clientY<e.firstElementChild.getBoundingClientRect().top)f=e.firstElementChild,b.className="dragover__top";else if(g){const _={left:g.left+parseInt(e.style.paddingLeft),right:g.left+t.contentElement.clientWidth-parseInt(e.style.paddingRight)};s.clientX<_.left?(b.x=_.left,b.className="dragover__left"):s.clientX>=_.right&&(b.x=_.right-6,b.className="dragover__right"),f=document.elementFromPoint(b.x,b.y),f.classList.contains("protyle-wysiwyg")&&(f=document.elementFromPoint(b.x,b.y-6)),f=le(f,"data-node-id",null)}if(u&&u.startsWith(`${p.SIYUAN_DROP_GUTTER}NodeAttributeView${p.ZWSP}Col${p.ZWSP}`.toLowerCase())){if(f=N(s.target,"av__cell"),f){const _=N(f,"av__row--header"),v=N(window.siyuan.dragElement,"av__row--header");(f===window.siyuan.dragElement||!_||!v||_&&v&&_!==v)&&(f=!1)}}else if(f&&u&&u.startsWith(`${p.SIYUAN_DROP_GUTTER}NodeAttributeViewRowMenu${p.ZWSP}`.toLowerCase()))if(!f.classList.contains("av__row")&&!f.classList.contains("av__row--util")||window.siyuan.dragElement&&!window.siyuan.dragElement.contains(f))f=!1;else{const _=N(f,"av__body");if(_){const v=oe(_),U=_.getAttribute("data-group-id"),ee=["template","created","updated"].includes(_.getAttribute("data-dtype")),Z=(o=v.querySelector('.block__icon[data-type="av-sort"]'))==null?void 0:o.classList.contains("block__icon--active");h[2].split(",").find(k=>{const w=k?k.split("@")[1]:"";if(w!==U&&ee||w===U&&Z)return f=!1,!0})}}else if(f&&u&&u.startsWith(`${p.SIYUAN_DROP_GUTTER}NodeAttributeView${p.ZWSP}GalleryItem${p.ZWSP}`.toLowerCase())){const _=N(s.target,"av__container");if(f.classList.contains("av")||!_||!_.contains(window.siyuan.dragElement)||f===window.siyuan.dragElement)f=!1;else{const v=N(f,"av__body");if(v){const U=oe(v),ee=v.getAttribute("data-group-id"),Z=["template","created","updated"].includes(v.getAttribute("data-dtype")),k=(l=U.querySelector('.block__icon[data-type="av-sort"]'))==null?void 0:l.classList.contains("block__icon--active");h[2].split(",").find(w=>{const S=w?w.split("@")[1]:"";if(S!==ee&&Z||S===ee&&k)return f=!1,!0})}}}if(!f){e.querySelectorAll(".dragover__bottom, .dragover__top, .dragover, .dragover__left, .dragover__right").forEach(_=>{_.classList.remove("dragover__top","dragover__bottom","dragover","dragover__left","dragover__right")});return}const y=!f.classList.contains("av__row")&&!f.classList.contains("av__row--util")&&!f.classList.contains("av__gallery-item")&&!f.classList.contains("av__gallery-add");if(f&&n&&f===n){const _=f.getBoundingClientRect();if(e.querySelectorAll(".dragover__left, .dragover__right, .dragover__bottom, .dragover__top, .dragover").forEach(v=>{v.classList.remove("dragover__top","dragover__bottom","dragover__left","dragover__right","dragover"),v.removeAttribute("select-start"),v.removeAttribute("select-end")}),m.indexOf("-")>-1&&y)if(s.altKey){if(m.split(",").includes(t.block.rootID)&&s.altKey)return}else return;if(f.getAttribute("data-type")==="NodeAttributeView"&&A(s.target,"TD"))return;if(b.className){f.classList.add(b.className),fu(f);return}if(f.getAttribute("data-type")==="NodeListItem"){s.clientY>_.top+_.height/2?(f.classList.add("dragover__bottom"),fu(f)):f.classList.contains("av__row--header")||(f.classList.add("dragover__top"),fu(f));return}if(f.classList.contains("av__cell")){s.clientX<_.left+_.width/2&&s.clientX>_.left&&!f.classList.contains("av__row")&&f.previousElementSibling!==window.siyuan.dragElement?f.classList.add("dragover__left"):s.clientX>_.right-_.width/2&&s.clientX<=_.right+1&&!f.classList.contains("av__row")&&f!==window.siyuan.dragElement.previousElementSibling&&(window.siyuan.dragElement.previousElementSibling.classList.contains("av__colsticky")&&f===window.siyuan.dragElement.previousElementSibling.lastElementChild||f.classList.add("dragover__right"));return}if(f.classList.contains("av__gallery-item")){if(N(f,"av__kanban-group")){const v=_.top+_.height/2;s.clientY<v&&s.clientY>_.top-13?f.classList.add("dragover__top"):s.clientY>v&&s.clientY<=_.bottom+13&&f.classList.add("dragover__bottom")}else{const v=_.left+_.width/2;s.clientX<v&&s.clientX>_.left-13?f.classList.add("dragover__left"):s.clientX>v&&s.clientX<=_.right+13&&f.classList.add("dragover__right")}return}if(f.classList.contains("av__gallery-add")){N(f,"av__kanban-group")?f.classList.add("dragover__top"):f.classList.add("dragover__left");return}s.clientX<_.left+32&&s.clientX>=_.left-1&&!f.classList.contains("av__row")?(f.classList.add("dragover__left"),fu(f)):s.clientX>_.right-32&&s.clientX<_.right&&!f.classList.contains("av__row")?(f.classList.add("dragover__right"),fu(f)):f.classList.contains("av__row--header")?f.classList.add("dragover__bottom"):f.classList.contains("av__row--util")?f.previousElementSibling.classList.add("dragover__bottom"):s.clientY>_.top+_.height/2&&a!=="bottom"?(f.classList.add("dragover__bottom"),fu(f)):a!=="top"&&(f.classList.add("dragover__top"),fu(f));return}if(m.indexOf("-")>-1){m.split(",").includes(t.block.rootID)&&y&&s.altKey?(n=void 0,e.querySelectorAll(".dragover__left, .dragover__right, .dragover__bottom, .dragover__top, .dragover").forEach(_=>{_.classList.remove("dragover__top","dragover__bottom","dragover__left","dragover__right","dragover"),_.removeAttribute("select-start"),_.removeAttribute("select-end")})):n=f;return}if(u){if(a="",h[0]==="nodeattributeview"&&h[1]==="col"&&f.getAttribute("data-id")===h[2]){pu(n);return}if(h[0]==="nodeattributeviewrowmenu"&&h[2].split("@")[0]===f.getAttribute("data-id")){pu(n);return}if(h[2].split(",").find(v=>{if(v&&ue(f,"data-node-id",v))return!0})&&h[0]!=="nodeattributeviewrowmenu"){pu(n);return}if(ge(f)){pu(n);return}if(h[0]==="nodelistitem"&&f.getAttribute("data-type")==="NodeListItem"){if(h[1]!==f.getAttribute("data-subtype")){pu(n);return}if(Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select")).find(U=>{if(!U.classList.contains("li"))return!0})){pu(n);return}}if(h[0]!=="nodelistitem"&&f.getAttribute("data-type")==="NodeListItem"){pu(n);return}h[0]==="nodelistitem"&&f.parentElement.classList.contains("li")&&((c=f.previousElementSibling)!=null&&c.classList.contains("protyle-action"))&&(a="top"),h[0]==="nodelistitem"&&((d=f.nextElementSibling)!=null&&d.classList.contains("list"))&&(a="bottom"),f&&f.classList.contains("av__row--header")&&(a="top"),n=f}});let i=0;e.addEventListener("dragleave",s=>{if(t.disabled){s.preventDefault(),s.stopPropagation();return}i--,i===0&&(e.querySelectorAll(".dragover__left, .dragover__right, .dragover__bottom, .dragover__top, .dragover").forEach(r=>{r.classList.remove("dragover__top","dragover__bottom","dragover__left","dragover__right","dragover")}),n=void 0)}),e.addEventListener("dragenter",s=>{s.preventDefault(),i++}),e.addEventListener("dragend",()=>{window.siyuan.dragElement&&(window.siyuan.dragElement.style.opacity="",window.siyuan.dragElement=void 0,document.onmousemove=null)})},fu=t=>{(t.classList.contains("sb")||t.classList.contains("li")||t.classList.contains("list")||t.classList.contains("bq"))&&t.classList.add("dragover")},pu=t=>{t&&(t.classList.remove("dragover__top","dragover__bottom","dragover__left","dragover__right","dragover"),t=void 0)},FW=(t,e,n)=>{if(!e.classList.contains("av")||!window.siyuan.menus.menu.element.classList.contains("fn__none"))return!1;if(t.isComposing)return!0;if(Qe("\u2318B",t)||Qe("\u2318I",t)||Qe("\u2318U",t))return t.preventDefault(),!0;const a=e.querySelector(".av__cell--select");if(a){const s=N(a,"av__row");if(!s||s.dataset.type==="ghost")return!1;const r=document.querySelector(".av__panel");if(r&&(t.key==="Backspace"||t.key==="Delete"||t.key==="Escape"||t.key.startsWith("ArrowLeft")||t.key==="Enter"||Qe("\u21E5",t)||Qe("\u21E7\u21E5",t)))return r.remove(),t.preventDefault(),t.stopPropagation(),!0;if(t.key==="Backspace"||t.key==="Delete")return fs(n,e,void 0,Array.from(e.querySelectorAll(".av__cell--active, .av__cell--select"))),t.preventDefault(),!0;if(t.key==="Escape")return si(["cell"],e),lo(s.querySelector(".av__firstcol"),"select"),t.preventDefault(),!0;if(t.key==="Enter")return Bs(n,[a]),t.preventDefault(),!0;let o;if(t.key==="ArrowLeft"||Qe("\u21E7\u21E5",t)){const l=s.previousElementSibling;if(a.previousElementSibling&&!a.previousElementSibling.classList.contains("av__firstcol")&&(a.previousElementSibling.classList.contains("av__colsticky")?(o=a.previousElementSibling.lastElementChild,o.classList.contains("av__firstcol")&&(o=void 0)):a.previousElementSibling.classList.contains("av__cell")&&(o=a.previousElementSibling)),!o&&l&&!l.classList.contains("av__row--header")){const c=l.querySelectorAll(".av__cell");o=c[c.length-1]}return o&&(si(["cell"],e),o.classList.add("av__cell--select"),Js(o),vl(e,o,!1)),t.preventDefault(),!0}if(t.key==="ArrowRight"||Qe("\u21E5",t)){const l=s.nextElementSibling;return a.nextElementSibling&&a.nextElementSibling.classList.contains("av__cell")?o=a.nextElementSibling:!a.nextElementSibling&&a.parentElement.nextElementSibling?o=a.parentElement.nextElementSibling:l&&!l.classList.contains("av__row--footer")&&(o=l.querySelector(".av__cell")),o?(si(["cell"],e),o.classList.add("av__cell--select"),Js(o),vl(e,o,!1)):t.key!=="ArrowRight"&&(si(["cell"],e),nc({blockElement:e,protyle:n,count:1,previousID:s.getAttribute("data-id"),groupID:s.parentElement.getAttribute("data-group-id")})),t.preventDefault(),!0}if(t.key==="ArrowUp"){const l=s.previousElementSibling;return l&&!l.classList.contains("av__row--header")&&(o=l.querySelector(`.av__cell[data-col-id="${a.dataset.colId}"]`)),o&&(si(["cell"],e),o.classList.add("av__cell--select"),Js(o),vl(e,o)),t.preventDefault(),!0}if(t.key==="ArrowDown"){const l=s.nextElementSibling;return l&&!l.classList.contains("av__row--footer")&&(o=l.querySelector(`.av__cell[data-col-id="${a.dataset.colId}"]`)),o&&(si(["cell"],e),o.classList.add("av__cell--select"),Js(o),vl(e,o)),t.preventDefault(),!0}if(!p.KEYCODELIST[t.keyCode]||p.KEYCODELIST[t.keyCode].length===1&&!t.metaKey&&!t.ctrlKey&&!["\u21E7","\u2303","\u2325","\u2318"].includes(p.KEYCODELIST[t.keyCode]))return a.style.backgroundColor?t.preventDefault():Bs(n,[a]),!0}const i=e.querySelectorAll(".av__row--select:not(.av__row--header)");if(i.length>0){if(Qe("\u2318/",t))return t.stopPropagation(),t.preventDefault(),Vh(n,i[0],{x:e.querySelector(".layout-tab-bar").getBoundingClientRect().left,y:i[0].getBoundingClientRect().bottom}),!0;if(t.key==="Escape")return t.preventDefault(),lo(i[0].querySelector(".av__firstcol"),"unselectAll"),!0;if(t.key==="Backspace")return t.preventDefault(),M2(e,n),!0;if(t.key==="Enter")return lo(i[0].querySelector(".av__firstcol"),"unselectAll"),Bs(n,[i[0].querySelector(".av__cell")]),t.preventDefault(),!0;if(t.key==="ArrowUp"){const s=i[0].previousElementSibling;return lo(i[0].querySelector(".av__firstcol"),"unselectAll"),s&&!s.classList.contains("av__row--header")?(lo(s.querySelector(".av__firstcol"),"select"),vl(e,s)):e.classList.add("protyle-wysiwyg--select"),t.preventDefault(),!0}if(t.key==="ArrowDown"){const s=i[i.length-1].nextElementSibling;return lo(i[0].querySelector(".av__firstcol"),"unselectAll"),s&&!s.classList.contains("av__row--util")?(lo(s.querySelector(".av__firstcol"),"select"),vl(e,s)):e.classList.add("protyle-wysiwyg--select"),t.preventDefault(),!0}}return!1},PW=t=>{const e=document.querySelector(".av__panel");if(e&&window.siyuan.menus.menu.element.classList.contains("fn__none")&&(e.querySelector('[data-type="goSearchRollupCol"]')&&!e.querySelector(".b3-text-field")||e.querySelector('[data-type="addAssetExist"]'))){const n=e.querySelector(".b3-menu__items");if(t.key==="Enter"){const a=n.querySelector(".b3-menu__item--current");if(a){const i=a.querySelector('[data-type="editAssetItem"]'),s=a.querySelector(".b3-form__upload");return i?e.dispatchEvent(new CustomEvent("click",{detail:{type:i.getAttribute("data-type"),target:i}})):s?s.dispatchEvent(new MouseEvent("click",{bubbles:!0})):e.dispatchEvent(new CustomEvent("click",{detail:{type:a.getAttribute("data-type"),target:a}})),!0}}else{if(t.key==="Escape")return e.dispatchEvent(new CustomEvent("click",{detail:"close"})),!0;if(pi(n,t,"b3-menu__item--current",n.firstElementChild))return!0}}return!1},Zg=t=>{var e;if(t.command==="switchReadonly")return _2(t.protyle.breadcrumb.element.parentElement.querySelector('.block__icon[data-type="readonly"]'),t.protyle),!0;if(t.command==="switchAdjust"){let a;const i=t.protyle.wysiwyg.element.getAttribute(p.CUSTOM_SY_FULLWIDTH);return i?a=i==="true"?"false":"true":a=window.siyuan.config.editor.fullWidth?"false":"true",ae("/api/attr/setBlockAttrs",{id:t.protyle.block.rootID,attrs:{[p.CUSTOM_SY_FULLWIDTH]:a}}),!0}const n=oe(t.previousRange.startContainer);if(!n)return!1;if(t.command==="enter"){let a=It(n);a.parentElement.classList.contains("li")&&a.parentElement.parentElement.classList.contains("list")&&((e=a.nextElementSibling)!=null&&e.classList.contains("list"))&&a.previousElementSibling.classList.contains("protyle-action")&&(a=a.parentElement);const i=a.getAttribute("data-node-id");return t.protyle.options.backlinkData?na(i,(s,r)=>{dn({app:t.protyle.app,id:i,action:r,zoomIn:s})}):hi({protyle:t.protyle,id:i}),!0}return t.command==="enterBack"?(jv(t.protyle,n.getAttribute("data-node-id")),!0):!1};var NW=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const OE=(t,e)=>{let n="";Array.from(t.cloneContents().childNodes).forEach(a=>{a.nodeType===3?n+=a.textContent:n+=a.outerHTML}),ae("/api/block/getDOMText",{dom:n},a=>{e(a.data)})},BW=(t,e)=>{e.addEventListener("keydown",n=>NW(void 0,null,function*(){var a,i,s,r,o,l,c,d,u,g;if(n.target.localName==="protyle-html"||n.target.localName==="input"){n.stopPropagation();return}if(t.disabled||!t.selectElement.classList.contains("fn__none")){n.stopPropagation(),n.preventDefault();return}t.wysiwyg.preventKeyup=!1,Ut(["util"],t),n.shiftKey&&n.key.indexOf("Arrow")>-1||!n.repeat&&n.code!==""&&Ut(["toolbar"],t);const f=hn(t.wysiwyg.element),h=oe(f.startContainer);if(!h)return;const m=oe(f.endContainer);if(!Qe("\u2318C",n)&&m&&h!==m){n.stopPropagation(),n.preventDefault();return}if(document.querySelector(".av__panel")||FW(n,h,t))return;if(h.classList.contains("protyle-wysiwyg--select")&&ct(n)&&!n.shiftKey&&!n.altKey){if(n.key.toLowerCase()==="a")return n.stopPropagation(),n.preventDefault(),t.wysiwyg.element.blur(),setTimeout(()=>{Ms(t,"afterend")},100),!1;if(n.key.toLowerCase()==="b")return n.stopPropagation(),n.preventDefault(),t.wysiwyg.element.blur(),setTimeout(()=>{Ms(t,"beforebegin")},100),!1}if(n.isComposing){n.stopPropagation();return}if(["\u2318","\u21E7","\u2325","\u2303"].includes(p.KEYCODELIST[n.keyCode])||(p.KEYCODELIST[n.keyCode]==="/"||n.key==="/"||n.code==="Slash"&&n.key==="Process"&&n.keyCode===229?t.hint.enableSlash=!0:(p.KEYCODELIST[n.keyCode]==="\\"||n.key==="\\"||n.key===","&&n.keyCode===229||n.code==="Backslash"&&n.key==="Process"&&n.keyCode===229)&&(t.hint.enableSlash=!1,Ut(["hint"],t))),n.key!=="PageUp"&&n.key!=="PageDown"&&n.key!=="Home"&&n.key!=="End"&&n.key.indexOf("Arrow")===-1&&n.key!=="Escape"&&n.key!=="Shift"&&n.key!=="Meta"&&n.key!=="Alt"&&n.key!=="Control"&&n.key!=="CapsLock"&&!pt(h)&&!/^F\d{1,2}$/.test(n.key)&&n.key!=="Process"&&(Xg(h,f,t),t.wysiwyg.preventKeyup=!0),!window.siyuan.menus.menu.element.classList.contains("fn__none")&&(["\u2190","\u2191","\u2192","\u2193"].includes(p.KEYCODELIST[n.keyCode])||p.KEYCODELIST[n.keyCode]==="\u21A9")&&!n.altKey&&!n.shiftKey&&ct(n)){n.preventDefault();return}else n.key!=="Escape"&&window.siyuan.menus.menu.remove();if(!["Alt","Meta","Shift","Control","CapsLock","Escape"].includes(n.key)&&t.options.render.breadcrumb&&t.breadcrumb.hide(),!n.altKey&&!n.shiftKey&&ct(n)&&(n.key==="ArrowDown"||n.key==="ArrowUp")){const k=t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(k.length>0){if(n.preventDefault(),n.stopPropagation(),Ut(["select"],t),n.key==="ArrowDown"){const w=k[k.length-1];let S=Fe(w);if(S)if(S.getBoundingClientRect().width===0){const H=le(S,"fold","1");H?(S=Fe(H),S?S=Le(S):S=w):S=w}else S.getAttribute("fold")==="1"&&(S.classList.contains("sb")||S.classList.contains("bq"))||(S=Le(S));else S=w;S.classList.add("protyle-wysiwyg--select"),ss([S.getAttribute("data-node-id")]);const B=S.getBoundingClientRect().bottom-t.contentElement.getBoundingClientRect().bottom;B>0&&(t.contentElement.scrollTop=t.contentElement.scrollTop+B,t.scroll.lastScrollTop=t.contentElement.scrollTop-1),qt(S)}else if(n.key==="ArrowUp"){let w=ke(k[0]);if(w){if(w=Ye(w),w.getBoundingClientRect().width===0){const S=le(w,"fold","1");S?w=Le(S):w=k[0]}else if(w){const S=le(w,"fold","1");S&&(S.classList.contains("sb")||S.classList.contains("bq"))&&(w=S)}}else if(t.title&&t.title.editElement&&(t.wysiwyg.element.firstElementChild.getAttribute("data-eof")==="1"||t.contentElement.scrollTop===0)){const S=qa(t.title.editElement,f,!1);S.collapse(!1),Pt(S),n.stopPropagation(),n.preventDefault()}else t.contentElement.scrollTop!==0?(t.contentElement.scrollTop=0,t.scroll.lastScrollTop=8):w=k[0];if(w){w.classList.add("protyle-wysiwyg--select"),ss([w.getAttribute("data-node-id")]);const S=w.getBoundingClientRect().top-t.contentElement.getBoundingClientRect().top;S<0&&(t.contentElement.scrollTop=t.contentElement.scrollTop+S,t.scroll.lastScrollTop=t.contentElement.scrollTop+1),qt(w)}}return}}if(n.key!=="PageUp"&&n.key!=="PageDown"&&n.key!=="Home"&&n.key!=="End"&&n.key.indexOf("Arrow")===-1&&ct(n)&&n.key!=="Escape"&&!n.shiftKey&&!n.altKey&&!/^F\d{1,2}$/.test(n.key)&&n.key!=="Enter"&&n.key!=="Tab"&&n.key!=="Backspace"&&n.key!=="Delete"&&n.key!=="ContextMenu")return n.stopPropagation(),Ut(["select"],t),h&&Ee(h)&&f.endContainer.nodeType===1&&f.endContainer.classList.contains("protyle-attr")&&f.collapse(!0),!1;if(Qe(window.siyuan.config.keymap.editor.general.collapse.custom,n)&&!n.repeat){const k=t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");return k.length>0?La(t,k[0]):h.parentElement.getAttribute("data-type")==="NodeListItem"?h.parentElement.childElementCount>3?La(t,h.parentElement):La(t,h):h.getAttribute("data-type")==="NodeHeading"?La(t,h):La(t,It(h)),n.stopPropagation(),n.preventDefault(),!1}if(Qe(window.siyuan.config.keymap.editor.general.expand.custom,n)&&!n.repeat){const k=t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");k.length>0?La(t,k[0],!0):h.parentElement.getAttribute("data-type")==="NodeListItem"?h.parentElement.childElementCount>3?La(t,h.parentElement,!0):La(t,h,!0):h.getAttribute("data-type")==="NodeHeading"?La(t,h,!0):La(t,It(h),!0),n.stopPropagation(),n.preventDefault();return}if(Qe(window.siyuan.config.keymap.editor.general.expandUp.custom,n)){mS({protyle:t,event:n,nodeElement:h,editorElement:e,range:f,cb(k){const w=k[0].previousElementSibling;if(w&&w.getAttribute("data-node-id")){w.classList.add("protyle-wysiwyg--select"),k.forEach(B=>{B.removeAttribute("select-end")}),w.setAttribute("select-end","true");const S=w.getBoundingClientRect().top-t.contentElement.getBoundingClientRect().top;S<0&&(t.contentElement.scrollTop=t.contentElement.scrollTop+S,t.scroll.lastScrollTop=t.contentElement.scrollTop+1)}else k[0].parentElement.classList.contains("protyle-wysiwyg")||(Ut(["select"],t),k[0].parentElement.classList.add("protyle-wysiwyg--select"))}});return}if(Qe(window.siyuan.config.keymap.editor.general.expandDown.custom,n)){bS({protyle:t,event:n,nodeElement:h,editorElement:e,range:f,cb(k){const w=k[k.length-1],S=w.nextElementSibling;if(S&&S.getAttribute("data-node-id")){S.classList.add("protyle-wysiwyg--select"),k.forEach(H=>{H.removeAttribute("select-end")}),S.setAttribute("select-end","true");const B=S.getBoundingClientRect().bottom-t.contentElement.getBoundingClientRect().bottom;B>0&&(t.contentElement.scrollTop=t.contentElement.scrollTop+B,t.scroll.lastScrollTop=t.contentElement.scrollTop-1)}else w.parentElement.classList.contains("protyle-wysiwyg")||(Ut(["select"],t),w.parentElement.classList.add("protyle-wysiwyg--select"))}});return}if(Qe("\u21E7\u2191",n)){mS({protyle:t,event:n,nodeElement:h,editorElement:e,range:f,cb(k){const w=t_(k);if(w.startElement.getBoundingClientRect().top>=w.endElement.getBoundingClientRect().top){const S=w.endElement.previousElementSibling;if(S&&S.getAttribute("data-node-id")){S.classList.add("protyle-wysiwyg--select"),S.setAttribute("select-end","true"),w.endElement.removeAttribute("select-end");const B=S.getBoundingClientRect().top-t.contentElement.getBoundingClientRect().top;B<0&&(t.contentElement.scrollTop=t.contentElement.scrollTop+B,t.scroll.lastScrollTop=t.contentElement.scrollTop+1)}else w.endElement.parentElement.classList.contains("protyle-wysiwyg")||(Ut(["select"],t),w.endElement.parentElement.classList.add("protyle-wysiwyg--select"))}else{w.endElement.classList.remove("protyle-wysiwyg--select"),w.endElement.removeAttribute("select-end");const S=ke(w.endElement);S&&(S.setAttribute("select-end","true"),S.getBoundingClientRect().top<=t.contentElement.getBoundingClientRect().top&&(es(t),S.scrollIntoView(!0)))}}});return}if(Qe("\u21E7\u2193",n)){bS({protyle:t,event:n,nodeElement:h,editorElement:e,range:f,cb(k){const w=t_(k);if(w.startElement.getBoundingClientRect().top<=w.endElement.getBoundingClientRect().top){const S=w.endElement.nextElementSibling;if(S&&S.getAttribute("data-node-id"))if(S.getBoundingClientRect().width===0)Ut(["select"],t),w.endElement.parentElement.classList.add("protyle-wysiwyg--select");else{S.classList.add("protyle-wysiwyg--select"),S.setAttribute("select-end","true"),w.endElement.removeAttribute("select-end");const B=S.getBoundingClientRect().bottom-t.contentElement.getBoundingClientRect().bottom;B>0&&(t.contentElement.scrollTop=t.contentElement.scrollTop+B,t.scroll.lastScrollTop=t.contentElement.scrollTop-1)}else w.endElement.parentElement.classList.contains("protyle-wysiwyg")||(Ut(["select"],t),w.endElement.parentElement.classList.add("protyle-wysiwyg--select"))}else{w.endElement.classList.remove("protyle-wysiwyg--select"),w.endElement.removeAttribute("select-end");const S=Fe(w.endElement);S&&(S.setAttribute("select-end","true"),S.getBoundingClientRect().bottom>=t.contentElement.getBoundingClientRect().bottom&&(es(t),S.scrollIntoView(!1)))}}});return}if(Qe(window.siyuan.config.keymap.general.enter.custom,n)){Zg({protyle:t,command:"enter",previousRange:f}),n.preventDefault(),n.stopPropagation();return}if(Qe(window.siyuan.config.keymap.general.enterBack.custom,n)){Zg({protyle:t,command:"enterBack",previousRange:f}),n.preventDefault(),n.stopPropagation();return}if(n.shiftKey&&!n.altKey&&ct(n)&&(n.key==="Home"||n.key==="End")&&Jt()||n.shiftKey&&!n.altKey&&je(n)&&(n.key==="Home"||n.key==="End")&&!Jt()){const k=le(h,"data-node-id",null);if(k){k.querySelectorAll(".protyle-wysiwyg--select").forEach(S=>{S.classList.remove("protyle-wysiwyg--select")}),k.classList.add("protyle-wysiwyg--select");let w=n.key==="Home"?k.previousElementSibling:k.nextElementSibling;for(;w;)w.classList.add("protyle-wysiwyg--select"),w=n.key==="Home"?w.previousElementSibling:w.nextElementSibling;n.key==="Home"?t.wysiwyg.element.firstElementChild.scrollIntoView():t.wysiwyg.element.lastElementChild.scrollIntoView(!1)}n.stopPropagation(),n.preventDefault();return}if((n.key==="Home"||n.key==="End")&&!n.shiftKey&&!n.altKey&&ct(n)&&Ut(["hint"],t),!n.altKey&&!n.shiftKey&&ct(n)&&(n.key==="PageUp"||n.key==="PageDown")){n.key==="PageUp"?(t.contentElement.scrollTop=t.contentElement.scrollTop-t.contentElement.clientHeight+60,t.scroll.lastScrollTop=t.contentElement.scrollTop+1):(t.contentElement.scrollTop=t.contentElement.scrollTop+t.contentElement.clientHeight-60,t.scroll.lastScrollTop=t.contentElement.scrollTop-1);const k=t.contentElement.getBoundingClientRect();let w=document.elementFromPoint(k.x+k.width/2,k.y+k.height/2);w.classList.contains("protyle-wysiwyg")&&(w=document.elementFromPoint(k.x+k.width/2,k.y+k.height/2+p.SIZE_TOOLBAR_HEIGHT));const S=oe(w);S&&S!==h&&qt(S,void 0,!1),n.stopPropagation(),n.preventDefault();return}if(!n.altKey&&!n.shiftKey&&(n.key.indexOf("Arrow")>-1&&ct(n)||n.key==="Enter")&&!t.hint.element.classList.contains("fn__none")&&t.hint.select(n,t))return;if(Qe("\u2318/",n)){n.stopPropagation(),n.preventDefault();const k=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));if(k.length===0){const S=ue(f.startContainer,"data-type",null);if(S&&S.tagName==="SPAN"){const B=S.getAttribute("data-type").split(" ");if(B.length>0&&(t.toolbar.range=f,hS(S)),B.includes("block-ref")){Gv(t,S);return}else if(B.includes("inline-memo")){t.toolbar.showRender(t,S);return}else if(B.includes("file-annotation-ref")){Yv(t,S);return}else if(B.includes("a")){Df(t,S);return}else if(B.includes("tag")){Xv(t,S);return}}if(f.startOffset===0&&f.startContainer.nodeType===3){const B=zt(f.startContainer);if(B&&B.nodeType!==3&&((a=B.getAttribute("data-type"))==null?void 0:a.indexOf("inline-math"))>-1){a_(t,B);return}else if(!B&&f.startContainer.parentElement.previousSibling&&f.startContainer.parentElement.previousSibling===f.startContainer.parentElement.previousElementSibling&&((i=f.startContainer.parentElement.previousElementSibling.getAttribute("data-type"))==null?void 0:i.indexOf("inline-math"))>-1){a_(t,f.startContainer.parentElement.previousElementSibling);return}}k.push(h)}k.length===1?t.gutter.renderMenu(t,k[0]):t.gutter.renderMultipleMenu(t,k);const w=h.getBoundingClientRect();window.siyuan.menus.menu.popup({x:w.left,y:w.top,isLeft:!0});return}if(ki(t,n,f)){n.preventDefault();return}const b=f.toString();if(!n.altKey&&!n.shiftKey&&ct(n)&&!n.isComposing&&n.key.indexOf("Arrow")>-1){const k=A(f.startContainer,"TD")||A(f.startContainer,"TH"),w=k||Ee(h)||h,S=ya(w,t.wysiwyg.element,f);if(h.classList.contains("code-block")&&S.end===w.innerText.length&&(S.end-=1),n.key==="ArrowDown"&&(w==null?void 0:w.innerText.trimRight().substr(S.start).indexOf(`
`))===-1&&(k&&!k.parentElement.nextElementSibling&&h.getAttribute("data-type")==="NodeTable"&&!Fe(h)||h.getAttribute("data-type")==="NodeCodeBlock"&&!Fe(h)||h.parentElement.getAttribute("data-type")==="NodeBlockquote"&&h.nextElementSibling.classList.contains("protyle-attr")&&!Fe(h.parentElement)))h.parentElement.getAttribute("data-type")==="NodeBlockquote"?Ms(t,"afterend",h.parentElement.getAttribute("data-node-id")):Ms(t,"afterend",h.getAttribute("data-node-id"));else if(n.key==="ArrowUp"){const B=Ee(t.wysiwyg.element.firstElementChild);if(!ke(h)&&h.contains(B)||!B&&h===t.wysiwyg.element.firstElementChild){if(Dr(w,f).top-w.getBoundingClientRect().top<20||h.classList.contains("av"))if(t.title&&t.title.editElement&&(t.wysiwyg.element.firstElementChild.getAttribute("data-eof")==="1"||t.contentElement.scrollTop===0)){const H=qa(t.title.editElement,f,!1);H.collapse(!1),Pt(H),n.stopPropagation(),n.preventDefault()}else t.contentElement.scrollTop=0,t.scroll.lastScrollTop=8}else if(((w==null?void 0:w.innerText.substr(0,S.end).indexOf(`
`))===-1||S.start===0)&&Dr(w,f).top-w.getBoundingClientRect().top<20){let H=ke(h);if(H&&(H=Ye(H),H)){const j=le(H,"fold","1");if(!j&&H.classList.contains("code-block"))qt(H,void 0,!1),kn(t,H),n.stopPropagation(),n.preventDefault();else if(j)j.scrollTop=0,qt(j,void 0,!0),kn(t,j),n.stopPropagation(),n.preventDefault();else{const re=Ee(H);if(re&&((s=re.lastChild)==null?void 0:s.nodeType)===3&&((r=re.lastChild)!=null&&r.textContent.endsWith(`
`))){qt(H,void 0,!1),n.preventDefault(),n.stopPropagation();return}}}}}else if(b===""&&(n.key==="ArrowDown"||n.key==="ArrowRight")&&h===Ye(t.wysiwyg.element.lastElementChild)&&!A(f.startContainer,"TD")&&!A(f.startContainer,"TH")){const B=Ee(h);B&&!B.querySelector(".emoji")&&B.textContent.replace(/\n$/,"").length<=ya(B,void 0,f).end&&(n.stopPropagation(),n.preventDefault(),Pt(f))}else if(b===""&&n.key==="ArrowLeft"&&h===Le(t.wysiwyg.element.firstElementChild)){const B=Ee(h);B&&ya(B,void 0,f).start===0&&(n.stopPropagation(),n.preventDefault(),Pt(f))}if(n.key==="ArrowDown"){if((w==null?void 0:w.innerText.trimRight().substr(S.start).indexOf(`
`))===-1&&h===t.wysiwyg.element.lastElementChild){qa(Ee(w),f,!1),f.collapse(!1),n.stopPropagation(),n.preventDefault();return}const B=ue(f.startContainer,"fold","1");if(B){let H=Fe(B);H&&(H.getAttribute("fold")==="1"&&(H.classList.contains("sb")||H.classList.contains("bq"))||(H=Le(H)),qt(H),kn(t,H)),n.stopPropagation(),n.preventDefault()}else if((w==null?void 0:w.innerText.substr(S.end).indexOf(`
`))===-1||S.end>=w.innerText.trimEnd().length){f.collapse(!1);const H=Fe(h);H&&(H.getAttribute("fold")==="1"||H.classList.contains("code-block"))&&w.getBoundingClientRect().bottom-Dr(h,f).top<40&&(qt(H),kn(t,H),n.stopPropagation(),n.preventDefault())}}return}if(!n.altKey&&(n.key==="Backspace"||n.key==="Delete")||Qe("\u2303D",n)){if(t.wysiwyg.element.querySelector(".protyle-wysiwyg--select")){gr(t,h,f,n.key==="Backspace"?"Backspace":"Delete"),n.stopPropagation(),n.preventDefault();return}if(b===""&&n.key==="Backspace"&&f.startOffset===f.startContainer.textContent.length&&f.startContainer.textContent.endsWith(`
`+p.ZWSP)){f.setStart(f.startContainer,f.startOffset-1),f.collapse(!0),n.stopPropagation(),n.preventDefault();return}const k=zt(f.startContainer);if(f.startOffset===1&&f.startContainer.textContent===p.ZWSP&&k&&k.nodeType!==3&&n.key==="Backspace"){if(k.classList.contains("img"))k.classList.add("img--select");else if(((o=k.getAttribute("data-type"))==null?void 0:o.indexOf("inline-math"))>-1){k.after(document.createElement("wbr"));const B=h.outerHTML;f.startContainer.textContent="",k.remove(),Ht(t,h.getAttribute("data-node-id"),h.outerHTML,B),cn(h,f),n.stopPropagation(),n.preventDefault();return}}const w=Ee(h),S=t.wysiwyg.element.querySelector(".img--select");if(S){if(S.classList.remove("img--select"),h.contains(S)){Zv(S,h,f,t),n.stopPropagation(),n.preventDefault();return}}else if(b===""){if(h.classList.contains("table")&&h.querySelector(".table__select").clientHeight>0){Eh(t,h),n.stopPropagation(),n.preventDefault();return}if(!w){h.classList.add("protyle-wysiwyg--select"),gr(t,h,f,n.key==="Backspace"?"Backspace":"Delete"),n.stopPropagation(),n.preventDefault();return}const B=ya(w,t.wysiwyg.element,f);if(n.key==="Delete"||Qe("\u2303D",n)){if(f.startOffset===0&&f.startContainer.textContent.length===1){const H=zt(f.startContainer),j=_t(f.startContainer);if(H&&H.nodeType===1&&H.classList.contains("img")&&j&&j.nodeType===1&&j.classList.contains("img")){const re=document.createElement("wbr");f.insertNode(re);const Te=h.outerHTML;re.nextSibling.textContent=p.ZWSP,Ht(t,h.getAttribute("data-node-id"),h.outerHTML,Te),cn(h,f),n.preventDefault();return}if(B.start===0&&f.startContainer.textContent!==p.ZWSP&&!H&&j&&j.nodeType===1&&j.classList.contains("img")){const re=document.createElement("wbr");f.insertNode(re);const Te=h.outerHTML;re.nextSibling.textContent=p.ZWSP,Ht(t,h.getAttribute("data-node-id"),h.outerHTML,Te),cn(h,f),n.preventDefault();return}}if(jt(f)||w.textContent.substring(B.start)===`
`){const H=f.cloneRange(),j=Fe(It(h));if(j){const re=qt(j);if(re){const Te=oe(re.startContainer);Te&&(!Te.classList.contains("code-block")||Te.classList.contains("code-block")&&Ee(Te).textContent==`
`||Te.parentElement.classList.contains("li"))&&(H.insertNode(document.createElement("wbr")),gr(t,Te,re,"Delete"))}n.stopPropagation(),n.preventDefault();return}}else if(B.end===w.innerText.length-1&&h.getAttribute("data-type")==="NodeCodeBlock"){n.stopPropagation(),n.preventDefault();return}else{let H=_t(f.startContainer);if(H){if(H.nodeType===3&&H.textContent===p.ZWSP){if(!H.nextSibling){const j=Fe(h);j&&gr(t,j,f,"remove"),n.stopPropagation(),n.preventDefault();return}H=H.nextSibling}if(H.nodeType===1&&H.classList.contains("img")&&ya(f.startContainer,t.wysiwyg.element,f).start===f.startContainer.textContent.length){Zv(H,h,f,t),n.stopPropagation(),n.preventDefault();return}}}}else{const H=f.startContainer.childNodes[f.startOffset-1];if(B.start===0&&(f.startOffset===0||H&&H.nodeType===3&&!zt(H)&&H.textContent==="")){(!h.classList.contains("code-block")||h.classList.contains("code-block")&&(w.textContent==`
`||h.parentElement.classList.contains("li")))&&gr(t,h,f,"Backspace"),n.stopPropagation(),n.preventDefault();return}if(f.startContainer.nodeType!==3&&h.getAttribute("data-type")==="NodeTable"&&((l=f.startContainer.children[f.startOffset-1])==null?void 0:l.tagName)==="TABLE"){h.classList.add("protyle-wysiwyg--select"),gr(t,h,f,"Backspace"),n.stopPropagation(),n.preventDefault();return}if(H&&H.nodeType!==3&&H.classList.contains("img")){Zv(H,h,f,t),n.stopPropagation(),n.preventDefault();return}const j=_t(f.startContainer);if(j&&j.nodeType===1&&["code","tag","kbd"].includes(j.dataset.type)&&(B.start===1||f.startContainer.textContent.slice(-2,-1)===`
`)&&(f.insertNode(document.createTextNode(p.ZWSP)),f.collapse(!0)),f.startOffset===1&&f.startContainer.textContent.length===1){const Te=zt(f.startContainer);if(Te&&Te.nodeType===1&&Te.classList.contains("img")&&j&&j.nodeType===1&&j.classList.contains("img")){const Be=document.createElement("wbr");f.insertNode(Be);const Ie=h.outerHTML;Be.previousSibling.textContent=p.ZWSP,Ht(t,h.getAttribute("data-node-id"),h.outerHTML,Ie),cn(h,f),n.preventDefault();return}if(B.start===1&&f.startContainer.textContent!==p.ZWSP&&!Te&&j&&j.nodeType===1&&j.classList.contains("img")){const Be=document.createElement("wbr");f.insertNode(Be);const Ie=h.outerHTML;Be.previousSibling.textContent=p.ZWSP,Ht(t,h.getAttribute("data-node-id"),h.outerHTML,Ie),cn(h,f),n.preventDefault();return}}if(h.classList.contains("code-block")&&je(n)&&f.startContainer.nodeType===3&&f.startContainer.textContent.substring(f.startOffset-1,f.startOffset)===`
`){n.stopPropagation(),n.preventDefault();return}const re=A(f.startContainer,"SPAN");if(B.start===2&&re&&ya(re,t.wysiwyg.element,f).start===1&&re.innerText.startsWith(p.ZWSP)&&re.innerText!==p.ZWSP&&w.innerText.startsWith(p.ZWSP)){qt(h),n.stopPropagation(),n.preventDefault();return}if(B.start===1&&!re&&w.innerText.startsWith(p.ZWSP)&&w.innerText.length>1){uu(w,f),gr(t,h,f,"Backspace"),n.stopPropagation(),n.preventDefault();return}}}else if(h.classList.contains("code-block")&&w.textContent===`
`){f.collapse(!0),n.stopPropagation(),n.preventDefault();return}else if(b!==""){const B=ya(w,t.wysiwyg.element,f);if(f.startOffset===0&&f.endContainer.textContent.length===f.endOffset){const H=zt(f.startContainer),j=_t(f.endContainer);if(H&&H.nodeType===1&&H.classList.contains("img")&&j&&j.nodeType===1&&j.classList.contains("img")||B.start===0&&f.startContainer.textContent!==p.ZWSP&&!H&&j&&j.nodeType===1&&j.classList.contains("img")){f.insertNode(document.createElement("wbr"));const re=h.outerHTML;f.deleteContents(),f.insertNode(document.createTextNode(p.ZWSP)),f.insertNode(document.createElement("wbr")),Ht(t,h.getAttribute("data-node-id"),h.outerHTML,re),cn(h,f),n.preventDefault();return}}}}if(Qe("\u21E7\u21A9",n)&&b===""&&wM(f,h,t)){n.stopPropagation(),n.preventDefault();return}if(Qe("\u2325\u21A9",n)&&b===""){const k=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));if(k.length===0&&k.push(h),k.length>0&&!sf("\u2325\u21A9")){if(k.find(S=>!S.classList.contains("code-block")))NM(t,h,f);else{const S=[];k.forEach(B=>{S.push(B.querySelector(".protyle-action__language"))}),t.toolbar.showCodeLanguage(t,S)}n.stopPropagation(),n.preventDefault();return}}if(Qe("\u21A9",n)){yM(h,f,t),n.stopPropagation(),n.preventDefault();return}if(Qe("\u2318A",n))return n.preventDefault(),mw(t,h,f),!0;if(Qe(window.siyuan.config.keymap.editor.general.undo.custom,n)){t.undo.undo(t),n.preventDefault(),n.stopPropagation();return}if(Qe(window.siyuan.config.keymap.editor.general.redo.custom,n)){t.undo.redo(t),n.preventDefault(),n.stopPropagation();return}if(gS(t,n,h))return!0;if(Qe(window.siyuan.config.keymap.editor.general.copyText.custom,n)){if(b!=="")OE(f,k=>{ut(`${k.trim()} ((${h.getAttribute("data-node-id")} "*"))`)});else{const k=t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");k.length>0?(k[0].setAttribute("data-reftext","true"),Pt(hn(h)),document.execCommand("copy")):ut(`((${h.getAttribute("data-node-id")} "*"))`)}return n.preventDefault(),n.stopPropagation(),!0}if(Qe(window.siyuan.config.keymap.editor.general.attr.custom,n)){const k=It(h);if(b===""){const w=t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");let S;w.length===1?S=w[0]:S=k,Ho(S,"bookmark",t)}else OE(f,w=>{const S=k.outerHTML,B=k.lastElementChild.querySelector(".protyle-attr--name");B?B.innerHTML=`<svg><use xlink:href="#iconN"></use></svg>${w.trim()}`:k.lastElementChild.insertAdjacentHTML("afterbegin",`<div class="protyle-attr--name"><svg><use xlink:href="#iconN"></use></svg>${w.trim()}</div>`),k.setAttribute("name",w.trim()),Ht(t,k.getAttribute("data-node-id"),k.outerHTML,S)});return n.preventDefault(),n.stopPropagation(),!0}if(Qe(window.siyuan.config.keymap.editor.general.rename.custom,n)&&!t.disabled){b===""?ae("/api/block/getDocInfo",{id:t.block.rootID},k=>{bf({notebookId:t.notebookId,path:t.path,name:k.data.ial.title,range:f,type:"file"})}):ae("/api/filetree/renameDoc",{notebook:t.notebookId,path:t.path,title:Wi(b)}),n.preventDefault(),n.stopPropagation();return}const y=Qe(window.siyuan.config.keymap.editor.general.newNameFile.custom,n);if(y||Qe(window.siyuan.config.keymap.editor.general.newNameSettingFile.custom,n)){!b.trim()&&(h.querySelector("tr")||h.querySelector("span"))||(!b.trim()&&Ee(h).textContent&&mw(t,h,f),y?ae("/api/filetree/getHPathByPath",{notebook:t.notebookId,path:t.path},k=>{q2(t,b,h,k.data,t.notebookId)}):kv(t.path,t.notebookId,(k,w)=>{q2(t,b,h,k,w)})),n.preventDefault(),n.stopPropagation();return}if(Qe(window.siyuan.config.keymap.editor.general.newContentFile.custom,n)){Sy(t),n.preventDefault(),n.stopPropagation();return}if(Qe(window.siyuan.config.keymap.editor.general.alignLeft.custom,n)){const k=h.querySelectorAll(".img--select");if(k.length>0)wS(t,h,Array.from(k),h.getAttribute("data-node-id"),h.outerHTML);else{let w=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));w.length===0&&(w=[h]),lc(w,t,S=>{S.classList.contains("av")?S.style.justifyContent="":S.style.textAlign="left"})}n.stopPropagation(),n.preventDefault();return}if(Qe(window.siyuan.config.keymap.editor.general.alignCenter.custom,n)){const k=h.querySelectorAll(".img--select");if(k.length>0)_S(t,h,Array.from(k),h.getAttribute("data-node-id"),h.outerHTML);else{let w=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));w.length===0&&(w=[h]),lc(w,t,S=>{S.classList.contains("av")?S.style.justifyContent="center":S.style.textAlign="center"})}n.stopPropagation(),n.preventDefault();return}if(Qe(window.siyuan.config.keymap.editor.general.alignRight.custom,n)){let k=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));k.length===0&&(k=[h]),lc(k,t,w=>{w.classList.contains("av")?w.style.justifyContent="flex-end":w.style.textAlign="right"}),n.stopPropagation(),n.preventDefault();return}if(Qe(window.siyuan.config.keymap.editor.general.rtl.custom,n)){let k=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));k.length===0&&(k=[h]),lc(k,t,w=>{w.style.direction="rtl"}),n.stopPropagation(),n.preventDefault();return}if(Qe(window.siyuan.config.keymap.editor.general.ltr.custom,n)){let k=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));k.length===0&&(k=[h]),lc(k,t,w=>{w.style.direction="ltr"}),n.stopPropagation(),n.preventDefault();return}if(n.key==="Escape"){if(n.repeat){const k=N(f.startContainer,"card__main",!0);k&&document.activeElement&&document.activeElement.classList.contains("protyle-wysiwyg")&&(k.querySelector(".card__action:not(.fn__none) button:not([disabled])").focus(),Ut(["select"],t))}else!t.toolbar.element.classList.contains("fn__none")||!t.hint.element.classList.contains("fn__none")||!t.toolbar.subElement.classList.contains("fn__none")?(Ut(["toolbar","hint","util"],t),t.hint.enableExtend=!1):window.siyuan.menus.menu.element.classList.contains("fn__none")?h.classList.contains("protyle-wysiwyg--select")?(Ut(["select"],t),ss([],t.block.rootID)):(Ut(["select"],t),f.collapse(!1),h.classList.add("protyle-wysiwyg--select"),ss([h.getAttribute("data-node-id")],t.block.rootID)):window.siyuan.menus.menu.remove(!0);n.stopPropagation(),n.preventDefault();return}if(Qe(window.siyuan.config.keymap.editor.heading.paragraph.custom,n)){const k=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));if(k.length===0&&k.push(h),k.length>1)mr({protyle:t,nodeElement:k[0],type:"Blocks2Ps"});else{const w=k[0].getAttribute("data-type");w==="NodeHeading"?mr({protyle:t,nodeElement:k[0],type:"Blocks2Ps"}):w==="NodeList"?Of({protyle:t,nodeElement:k[0],id:k[0].getAttribute("data-node-id"),type:"CancelList"}):w==="NodeBlockquote"&&Of({protyle:t,nodeElement:k[0],id:k[0].getAttribute("data-node-id"),type:"CancelBlockquote"})}return n.preventDefault(),n.stopPropagation(),!0}if(Qe(window.siyuan.config.keymap.editor.heading.heading1.custom,n))return mr({protyle:t,nodeElement:h,type:"Blocks2Hs",level:1}),n.preventDefault(),n.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.heading.heading2.custom,n))return mr({protyle:t,nodeElement:h,type:"Blocks2Hs",level:2}),n.preventDefault(),n.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.heading.heading3.custom,n))return mr({protyle:t,nodeElement:h,type:"Blocks2Hs",level:3}),n.preventDefault(),n.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.heading.heading4.custom,n))return mr({protyle:t,nodeElement:h,type:"Blocks2Hs",level:4}),n.preventDefault(),n.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.heading.heading5.custom,n))return mr({protyle:t,nodeElement:h,type:"Blocks2Hs",level:5}),n.preventDefault(),n.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.heading.heading6.custom,n))return mr({protyle:t,nodeElement:h,type:"Blocks2Hs",level:6}),n.preventDefault(),n.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.insert.code.custom,n)&&!["NodeCodeBlock","NodeHeading","NodeTable"].includes(h.getAttribute("data-type"))){const k=Ee(h);if(k){const w=h.getAttribute("data-node-id"),S=h.outerHTML;k.innerHTML="```"+window.siyuan.storage[p.LOCAL_CODELANG]+`
`+Lute.EscapeHTMLStr(k.textContent)+"<wbr>\n```";const B=t.lute.SpinBlockDOM(h.outerHTML);h.outerHTML=B;const H=t.wysiwyg.element.querySelector(`[data-node-id="${w}"]`);return Ht(t,w,B,S),ra(H),n.preventDefault(),n.stopPropagation(),!0}}if(Qe(window.siyuan.config.keymap.editor.insert.lastUsed.custom,n)){t.toolbar.range=f;const k=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));b===""&&k.length===0&&k.push(h),fo(t,k),n.stopPropagation(),n.preventDefault();return}if(!h.classList.contains("code-block")&&!n.repeat&&!ge(h)){let k=!1;if(t.options.toolbar.find(w=>{if(!w.hotkey)return!1;if(Qe(w.hotkey,n))return t.toolbar.range=f,["block-ref"].includes(w.name)&&t.toolbar.range.toString()===""||(k=!0,["a","block-ref","inline-math","inline-memo","text"].includes(w.name)?t.toolbar.element.querySelector(`[data-type="${w.name}"]`).dispatchEvent(new CustomEvent("click")):p.INLINE_TYPE.includes(w.name)?t.toolbar.setInlineMark(t,w.name,"range"):w.click&&w.click(t.getInstance())),!0}),k)return n.preventDefault(),n.stopPropagation(),t.wysiwyg.preventKeyup=!0,!0}if(Qe(window.siyuan.config.keymap.editor.list.outdent.custom,n)){const k=t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(k.length>0){let w=!0;return k.forEach((S,B)=>{S.nextElementSibling&&k[B+1]&&k[B+1]!==S.nextElementSibling&&(w=!1)}),w&&(k[0].classList.contains("li")||k[0].parentElement.classList.contains("li"))&&Uh(t,Array.from(k),f),n.preventDefault(),n.stopPropagation(),!0}else if(h.parentElement.classList.contains("li")&&h.getAttribute("data-type")!=="NodeCodeBlock")return Uh(t,[h.parentElement],f),n.preventDefault(),n.stopPropagation(),!0}if(Qe(window.siyuan.config.keymap.editor.list.indent.custom,n)){const k=t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(k.length>0){let w=!0;return k.forEach((S,B)=>{S.nextElementSibling&&k[B+1]&&k[B+1]!==S.nextElementSibling&&(w=!1)}),w&&(k[0].classList.contains("li")||k[0].parentElement.classList.contains("li"))&&Jv(t,Array.from(k),f),n.preventDefault(),n.stopPropagation(),!0}else if(h.parentElement.classList.contains("li")&&h.getAttribute("data-type")!=="NodeCodeBlock")return Jv(t,[h.parentElement],f),n.preventDefault(),n.stopPropagation(),!0}const _=Qe(window.siyuan.config.keymap.editor.insert.list.custom,n),v=Qe(window.siyuan.config.keymap.editor.insert.check.custom,n),U=Qe(window.siyuan.config.keymap.editor.insert["ordered-list"].custom,n),ee=Qe(window.siyuan.config.keymap.editor.insert.quote.custom,n);if(_||U||v||ee){const k=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));if(k.length===0&&k.push(h),k.length===1){const w=k[0].dataset.subtype,S=k[0].dataset.type;if(ee)["NodeHeading","NodeParagraph","NodeList"].includes(S)?Qs({protyle:t,selectsElement:k,type:"Blocks2Blockquote"}):(t.hint.splitChar="/",t.hint.lastIndex=-1,t.hint.fill(">"+Lute.Caret,t));else if(S==="NodeParagraph")Qs({protyle:t,selectsElement:k,type:v?"Blocks2TLs":_?"Blocks2ULs":"Blocks2OLs"});else if(S==="NodeList"){const B=k[0].dataset.nodeId;w==="o"&&(_||v)?Of({protyle:t,nodeElement:k[0],id:B,type:v?"UL2TL":"OL2UL"}):w==="t"&&(_||U)?Of({protyle:t,nodeElement:k[0],id:B,type:_?"TL2UL":"TL2OL"}):w==="u"&&(v||U)&&Of({protyle:t,nodeElement:k[0],id:B,type:v?"OL2TL":"UL2OL"})}else t.hint.splitChar="/",t.hint.lastIndex=-1,t.hint.fill((v?"- [ ] ":_?"- ":"1. ")+Lute.Caret,t)}else{let w=!1,S=!1;k.find((B,H)=>{if(B.classList.contains("li"))return w=!0,!0;if(B.nextElementSibling&&k[H+1]&&B.nextElementSibling===k[H+1])S=!0;else if(H!==k.length-1)return S=!1,!0}),!w&&S&&Qs({protyle:t,selectsElement:k,type:ee?"Blocks2Blockquote":v?"Blocks2TLs":_?"Blocks2ULs":"Blocks2OLs"})}n.preventDefault(),n.stopPropagation();return}if(Qe(window.siyuan.config.keymap.editor.insert.table.custom,n)){t.hint.splitChar="/",t.hint.lastIndex=-1,t.hint.fill(`| ${Lute.Caret} |  |  |
| --- | --- | --- |
|  |  |  |
|  |  |  |`,t),n.preventDefault(),n.stopPropagation();return}if(Qe(window.siyuan.config.keymap.editor.list.checkToggle.custom,n)){const k=ue(f.startContainer,"data-subtype","t");if(!k)return;const w=k.outerHTML;k.classList.contains("protyle-task--done")?(k.querySelector("use").setAttribute("xlink:href","#iconUncheck"),k.classList.remove("protyle-task--done")):(k.querySelector("use").setAttribute("xlink:href","#iconCheck"),k.classList.add("protyle-task--done")),k.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,k.getAttribute("data-node-id"),k.outerHTML,w),n.preventDefault(),n.stopPropagation();return}if(Qe(window.siyuan.config.keymap.editor.general.insertBefore.custom,n))return(c=h.querySelector(".img--select"))==null||c.classList.remove("img--select"),Ms(t,"beforebegin"),n.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.editor.general.insertAfter.custom,n))return(d=h.querySelector(".img--select"))==null||d.classList.remove("img--select"),Ms(t,"afterend"),n.preventDefault(),n.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.general.jumpToParentNext.custom,n))return Cf(t,h,"next"),n.preventDefault(),n.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.general.jumpToParent.custom,n))return Cf(t,h,"parent"),n.preventDefault(),n.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.general.jumpToParentPrev.custom,n))return Cf(t,h,"previous"),n.preventDefault(),n.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.general.moveToUp.custom,n)){n.preventDefault(),n.stopPropagation(),lM(t,h,f);return}if(Qe(window.siyuan.config.keymap.editor.general.moveToDown.custom,n)){n.preventDefault(),n.stopPropagation(),cM(t,h,f);return}if(Qe(window.siyuan.config.keymap.editor.general.vLayout.custom,n)){n.preventDefault(),n.stopPropagation();const k=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));if(k.length===1&&k[0].getAttribute("data-type")==="NodeSuperBlock"){if(k[0].getAttribute("data-sb-layout")==="col"){const w=k[0].outerHTML;k[0].setAttribute("data-sb-layout","row"),k[0].setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,k[0].getAttribute("data-node-id"),k[0].outerHTML,w)}else{f.insertNode(document.createElement("wbr"));const w=yield Uo(t,k[0]);et(t,w.doOperations,w.undoOperations),cn(t.wysiwyg.element,f)}return}if(k.length<2||(u=k[0])!=null&&u.classList.contains("li"))return;Qs({protyle:t,selectsElement:k,type:"BlocksMergeSuperBlock",level:"row"});return}if(Qe(window.siyuan.config.keymap.editor.general.hLayout.custom,n)){n.preventDefault(),n.stopPropagation();const k=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));if(k.length===1&&k[0].getAttribute("data-type")==="NodeSuperBlock"){if(k[0].getAttribute("data-sb-layout")==="row"){const w=k[0].outerHTML;k[0].setAttribute("data-sb-layout","col"),k[0].setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(t,k[0].getAttribute("data-node-id"),k[0].outerHTML,w)}else{f.insertNode(document.createElement("wbr"));const w=yield Uo(t,k[0]);et(t,w.doOperations,w.undoOperations),cn(t.wysiwyg.element,f)}return}if(k.length<2||(g=k[0])!=null&&g.classList.contains("li"))return;Qs({protyle:t,selectsElement:k,type:"BlocksMergeSuperBlock",level:"col"});return}if(!n.repeat&&Qe(window.siyuan.config.keymap.editor.general.ai.custom,n)){n.preventDefault(),n.stopPropagation();let k=Array.from(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));k.length===0&&(k=[h]),BE(k,t);return}if(!n.repeat&&Qe(window.siyuan.config.keymap.editor.general.aiWriting.custom,n)){n.preventDefault(),n.stopPropagation(),yL(t,h);return}if(!n.repeat&&Qe(window.siyuan.config.keymap.editor.general.openInNewTab.custom,n)){n.preventDefault(),n.stopPropagation();const k=window.siyuan.blockPanels.find(S=>{if(S.element.contains(h))return!0}),w=h.getAttribute("data-node-id");na(w,(S,B)=>{dn({app:t.app,id:w,action:B,zoomIn:S,openNewTab:!0}),k.destroy()});return}if(n.key==="Tab"&&ct(n)&&!n.altKey){n.preventDefault();const k=window.siyuan.config.editor.codeTabSpaces===0?"	":"".padStart(window.siyuan.config.editor.codeTabSpaces," ");if(h.getAttribute("data-type")==="NodeCodeBlock"&&b!==""){!_t(f.endContainer)&&f.endContainer.textContent.endsWith(`
`)&&f.endOffset>0&&f.setEnd(f.endContainer,f.endOffset-1);const w=document.createElement("wbr");f.insertNode(w),f.setStartAfter(w);const S=h.outerHTML;let B="";n.shiftKey?f.extractContents().textContent.split(`
`).forEach(re=>{re.startsWith(k)?B+=re.replace(k,"")+`
`:B+=re+`
`}):f.extractContents().textContent.split(`
`).forEach(re=>{B+=k+re+`
`});let H=h.querySelector(".protyle-action__language").textContent;if(f.commonAncestorContainer.nodeType===1){const re=f.commonAncestorContainer.className;re.startsWith("language-")&&(H=re.replace("language-",""),w.parentElement!==f.commonAncestorContainer&&(w.parentElement.after(w),w.previousElementSibling.remove()))}window.hljs.getLanguage(H)||(H="plaintext"),w.insertAdjacentHTML("afterend",window.hljs.highlight(B.substr(0,B.length-1),{language:H,ignoreIllegals:!0}).value+"<br>"),f.setStart(w.nextSibling,0);const j=w.parentElement.querySelector("br");qa(j.previousSibling,f,!1),j.remove(),Ht(t,h.getAttribute("data-node-id"),h.outerHTML,S),w.remove();return}if(!n.shiftKey){const w=f.startContainer.parentElement,S=t.toolbar.getCurrentType(f);S.length>0&&f.toString()===""&&f.startOffset===0&&w.tagName==="SPAN"&&!zt(f.startContainer)&&!zt(w)?(f.setStartBefore(w),f.collapse(!0)):w.tagName==="SPAN"&&!S.includes("search-mark")&&!S.includes("code")&&!S.includes("kbd")&&!S.includes("tag")&&f.toString()===""&&f.startContainer.nodeType===3&&(S.includes("inline-memo")||S.includes("block-ref")||S.includes("file-annotation-ref")||S.includes("a"))&&!_t(f.startContainer)&&f.startContainer.textContent.length===f.startOffset&&(f.setEndAfter(w),f.collapse(!1));const B=document.createElement("wbr");f.insertNode(B);const H=h.outerHTML;return f.extractContents(),f.insertNode(document.createTextNode(k)),f.collapse(!1),Pt(f),B.remove(),Ht(t,h.getAttribute("data-node-id"),h.outerHTML,H),!0}}if(n.key==="ContextMenu"){const k=Dr(h,f);t.wysiwyg.element.dispatchEvent(new CustomEvent("contextmenu",{detail:{target:h,y:k.top+8,x:k.left}})),n.preventDefault(),n.stopPropagation();return}const Z=ue(f.startContainer,"data-type","block-ref");if(Z){const k=Z.getAttribute("data-id");if(Qe(window.siyuan.config.keymap.editor.general.openBy.custom,n))return na(k,(w,S,B)=>{B||S.push(p.CB_GET_HL),dn({app:t.app,id:k,action:S,zoomIn:w})}),n.preventDefault(),n.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.general.refTab.custom,n))return na(k,w=>{dn({app:t.app,id:k,action:w?[p.CB_GET_HL,p.CB_GET_ALL]:[p.CB_GET_HL,p.CB_GET_CONTEXT,p.CB_GET_ROOTSCROLL],keepCursor:!0,zoomIn:w})}),n.preventDefault(),n.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.general.insertRight.custom,n))return na(k,(w,S,B)=>{B||S.push(p.CB_GET_HL),dn({app:t.app,id:k,position:"right",action:S,zoomIn:w})}),n.preventDefault(),n.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.general.insertBottom.custom,n))return na(k,(w,S,B)=>{B||S.push(p.CB_GET_HL),dn({app:t.app,id:k,position:"bottom",action:S,zoomIn:w})}),n.preventDefault(),n.stopPropagation(),!0;if(Qe(window.siyuan.config.keymap.editor.general.refPopover.custom,n))return window.siyuan.blockPanels.push(new Vg({app:t.app,isBacklink:!1,targetElement:Z,refDefs:[{refID:k}]})),n.preventDefault(),n.stopPropagation(),!0}if(Qe("\u21E7\u2318V",n)){n.returnValue=!1,n.preventDefault(),n.stopPropagation(),gv(t);return}if(Qe(window.siyuan.config.keymap.editor.general.openBy.custom,n)){const k=ue(f.startContainer,"data-type","a");if(k){Lf(t,k.getAttribute("data-href"),void 0,!1),n.preventDefault(),n.stopPropagation();return}const w=ue(f.startContainer,"data-type","file-annotation-ref");if(w){const B=`assets/${w.getAttribute("data-id").split("/")[1]}`;Lf(t,B,void 0,!1),n.preventDefault(),n.stopPropagation();return}return}if(n.shiftKey&&(n.key==="ArrowLeft"||n.key==="ArrowRight")){if(t.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select").length>0){n.stopPropagation(),n.preventDefault();return}if(!f.toString()){if(n.key==="ArrowRight"&&jt(f)&&!sf("\u2325\u21E7\u2192")){n.preventDefault(),n.stopPropagation();return}const w=Ee(h);if(ya(w,t.wysiwyg.element,f).start===0&&n.key==="ArrowLeft"&&!sf("\u2325\u21E7\u2190")){n.preventDefault(),n.stopPropagation();return}}}if(ct(n)&&n.key!=="Backspace"&&n.key!=="Escape"&&n.key!=="Delete"&&!n.shiftKey&&!n.altKey&&n.key!=="Enter"&&Ut(["select"],t),Qe("\u2318B",n)||Qe("\u2318I",n)||Qe("\u2318U",n)){n.preventDefault(),n.stopPropagation();return}}))},xL=(t,e,n)=>{const a=x(),i=N(t.target,"protyle-attr--bookmark");if(i)return!a&&je(t)?Ro(e.app,i.textContent.trim(),!0):n?Zs(n,"bookmark",e):Ho(i.parentElement.parentElement,"bookmark",e),t.stopPropagation(),!0;const s=N(t.target,"protyle-attr--name");if(s)return!a&&je(t)?Ro(e.app,s.textContent.trim(),!0):n?Zs(n,"name",e):Ho(s.parentElement.parentElement,"name",e),t.stopPropagation(),!0;const r=N(t.target,"protyle-attr--av");if(r)return n?Zs(n,"av",e):Ho(r.parentElement.parentElement,"av",e),t.stopPropagation(),!0;const o=N(t.target,"protyle-attr--alias");if(o)return!a&&je(t)?Ro(e.app,o.textContent.trim(),!0):n?Zs(n,"alias",e):Ho(o.parentElement.parentElement,"alias",e),t.stopPropagation(),!0;const l=N(t.target,"protyle-attr--memo");if(l)return!a&&je(t)?Ro(e.app,l.getAttribute("aria-label").trim(),!0):n?Zs(n,"memo",e):Ho(l.parentElement.parentElement,"memo",e),t.stopPropagation(),!0},EL=t=>{!window.siyuan.menus.menu.element.contains(t)&&!ue(t,"data-menu","true")&&(getSelection().rangeCount>0&&window.siyuan.menus.menu.element.contains(getSelection().getRangeAt(0).startContainer)&&window.siyuan.menus.menu.element.contains(document.activeElement)||window.siyuan.menus.menu.remove())},$W=t=>{kA(),EL(t.target);const e=N(t.target,"protyle",!0);if(e){const i=e.querySelector(".protyle-wysiwyg");(i.getAttribute("data-readonly")==="true"||!i.contains(t.target))&&i.dispatchEvent(new Event("focusin"))}!me(t.target,"protyle-util")&&!me(t.target,"protyle-toolbar")&&document.querySelectorAll(".protyle-font").forEach(i=>{i.parentElement.classList.add("fn__none")});const n=me(t.target,"protyle-action__copy");if(n){let i=n.parentElement.nextElementSibling.textContent.replace(/\n$/,"");i=i.replace(/\u00A0/g," "),ut(i),Q(window.siyuan.languages.copied,2e3),t.preventDefault();return}if(!E()&&window.siyuan.layout.leftDock&&!N(t.target,"b3-dialog--open",!0)&&!N(t.target,"b3-menu")&&!N(t.target,"block__popover")&&!N(t.target,"dock")&&!N(t.target,"layout--float",!0)&&(window.siyuan.layout.bottomDock.hideDock(),window.siyuan.layout.leftDock.hideDock(),window.siyuan.layout.rightDock.hideDock()),N(t.target,"pdf__outer")||rs(["pdfutil"]),ue(t.target,"id","secondaryToolbarToggleButton")||ue(t.target,"id","viewFindButton")||ue(t.target,"id","findbar"))return;let a;Cn().asset.find(i=>{if(i.pdfObject&&!i.pdfObject.appConfig.appContainer.classList.contains("fn__none"))return a=i.pdfObject,!0}),a&&(a.secondaryToolbar.isOpen&&a.secondaryToolbar.close(),!a.supportsIntegratedFind&&a.findBar.opened&&a.findBar.close())};var RE=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class OW{constructor(e){this.lastHTMLs={},this.element=document.createElement("div"),this.element.className="protyle-wysiwyg",this.element.setAttribute("spellcheck","false"),x()?this.element.setAttribute("contenteditable","false"):this.element.setAttribute("contenteditable","true"),window.siyuan.config.editor.displayBookmarkIcon&&this.element.classList.add("protyle-wysiwyg--attr"),this.bindCommonEvent(e),!e.options.action.includes(p.CB_GET_HISTORY)&&(this.bindEvent(e),BW(e,this.element),MW(e,this.element))}renderCustom(e){let n=e[p.CUSTOM_SY_FULLWIDTH];n||(n=window.siyuan.config.editor.fullWidth?"true":"false"),n==="true"?this.element.parentElement.setAttribute("data-fullwidth","true"):this.element.parentElement.removeAttribute("data-fullwidth");const a=Object.keys(e);for(let i=0;i<this.element.attributes.length;i++){const s=this.element.attributes[i].nodeName;!["type","class","spellcheck","contenteditable","data-doc-type","style","data-realwidth","data-readonly"].includes(s)&&!a.includes(s)&&(this.element.removeAttribute(s),i--)}a.forEach(i=>{["title-img","title","updated","icon","id","type","class","spellcheck","contenteditable","data-doc-type","style","data-realwidth","data-readonly"].includes(i)||this.element.setAttribute(i,e[i])})}escapeInline(e,n,a){if(!a.data&&a.inputType!=="insertLineBreak")return;const i=a.data;e.toolbar.range=n;const s=n.startContainer.parentElement,r=e.toolbar.getCurrentType();if(a.inputType==="insertLineBreak"){r.length>0&&n.toString()===""&&s.tagName==="SPAN"&&s.textContent.startsWith(`
`)&&n.startContainer.previousSibling&&n.startContainer.previousSibling.textContent===`
`&&s.before(n.startContainer.previousSibling);return}let o=i.length;if(i==="<"||i===">"?o=4:i==="&"&&(o=5),r.length>0&&n.toString()===""&&n.startOffset===i.length&&s.tagName==="SPAN"&&s.textContent.replace(p.ZWSP,"")!==i&&s.textContent.replace(p.ZWSP,"").length>=i.length&&!zt(n.startContainer)&&!zt(s)){const l=s.innerHTML.replace(p.ZWSP,"");s.innerHTML=l.substr(o);const c=document.createTextNode(i);s.before(c),n.selectNodeContents(c),n.collapse(!1);return}if(s.tagName==="SPAN"&&s.textContent!==i&&!r.includes("search-mark")&&!r.includes("code")&&!r.includes("kbd")&&!r.includes("tag")&&n.toString()===""&&n.startContainer.nodeType===3&&(r.includes("inline-memo")||r.includes("block-ref")||r.includes("file-annotation-ref")||r.includes("a"))&&!_t(n.startContainer)&&n.startContainer.textContent.length===n.startOffset&&s.textContent.length>i.length){const l=ya(s,e.wysiwyg.element,n),c=s.innerHTML;if(l.start===s.textContent.length){s.innerHTML=c.substr(0,c.length-o);const d=document.createTextNode(i);s.after(d),n.selectNodeContents(d),n.collapse(!1)}}}setEmptyOutline(e,n){let a=n;if(!n.getAttribute("data-node-id")){const i=oe(n);if(!i)return;a=i}e.model&&Cn().outline.forEach(i=>{i.blockId===e.block.rootID&&i.setCurrent(a)})}emojiToMd(e){e.querySelectorAll(".emoji").forEach(n=>{n.outerHTML=`:${n.getAttribute("alt")}:`})}bindCommonEvent(e){this.element.addEventListener("copy",n=>RE(this,null,function*(){var a;if(window.siyuan.ctrlIsPressed=!1,n.target.tagName==="PROTYLE-HTML"||n.target.localName==="input"){n.stopPropagation();return}n.stopPropagation(),n.preventDefault();const i=hn(e.wysiwyg.element),s=oe(i.startContainer);if(!s)return;const r=s.querySelector(".img--select"),o=s.querySelector(".av__row--select, .av__cell--select"),l=((a=s.querySelector(".table__select"))==null?void 0:a.clientWidth)>0;let c=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));c.length===0&&i.toString()===""&&!i.cloneContents().querySelector("img")&&!r&&!o&&!l&&(s.classList.add("protyle-wysiwyg--select"),ss([s.getAttribute("data-node-id")]),c=[s]);let d="",u="",g=!1,f=!1;if(c.length>0){const h=c[0].getAttribute("data-reftext")==="true";c[0].getAttribute("data-type")==="NodeListItem"&&c[0].parentElement.classList.contains("list")&&c[0].parentElement.childElementCount-1===c.length&&(c.find(y=>{if(!c[0].parentElement.contains(y))return!0})||(c=[c[0].parentElement]));let m="";for(let b=0;b<c.length;b++){const y=c[b];if(h)d+=p2(y)+`

`;else{let _="";y.getAttribute("data-type")==="NodeHeading"&&y.getAttribute("fold")==="1"?(f=!0,_=(yield wn("/api/block/getHeadingChildrenDOM",{id:y.getAttribute("data-node-id"),removeFoldAttr:!1})).data):y.getAttribute("data-type")!=="NodeBlockQueryEmbed"&&y.querySelector('[data-type="NodeHeading"][fold="1"]')?(f=!0,_=(yield wn("/api/block/getBlockDOM",{id:y.getAttribute("data-node-id")})).data.dom):_=vd(y),y.getAttribute("data-type")==="NodeListItem"?(m||(m=`<div data-subtype="${y.getAttribute("data-subtype")}" data-node-id="${Lute.NewNodeID()}" data-type="NodeList" class="list">`),m+=_,(b===c.length-1||c[b+1].getAttribute("data-type")!=="NodeListItem"||c[b+1].getAttribute("data-subtype")!==y.getAttribute("data-subtype"))&&(d+=`${m}<div class="protyle-attr" contenteditable="false">${p.ZWSP}</div></div>`,m="")):d+=_}}h&&(d=d.slice(0,-2),c[0].removeAttribute("data-reftext"))}else if(o){const h=Array.from(s.querySelectorAll(".av__cell--active, .av__cell--select"))||[];h.length===0&&s.querySelectorAll(".av__row--select:not(.av__row--header)").forEach(m=>{m.querySelectorAll(".av__cell").forEach(b=>{h.push(b)})}),h.length>0&&(d="[",h.forEach((m,b)=>{var y;const _=Rd(m);(b===0||h[b-1]!==m.previousElementSibling&&!((y=m.previousElementSibling)!=null&&y.classList.contains("av__colsticky")&&!h[b-1].nextElementSibling&&h[b-1].parentElement===m.previousElementSibling))&&(d+="["),d+=JSON.stringify(qo(Ns(m),m))+",",b===h.length-1||h[b+1]!==m.nextElementSibling&&!(!m.nextElementSibling&&m.parentElement.nextElementSibling===h[b+1])?(d=d.substring(0,d.length-1)+"],",u+=_+`
`):u+=_+"	"}),u=u.substring(0,u.length-1),d=d.substring(0,d.length-1)+"]")}else if(l){const h=[],m=s.firstElementChild.scrollLeft,b=s.querySelector("table").scrollTop,y=s.querySelector(".table__select");d="<table>",s.querySelectorAll("th, td").forEach(_=>{!_.classList.contains("fn__none")&&Ra({tableSelectElement:y,scrollLeft:m,scrollTop:b,item:_})&&h.push(_)}),h.forEach((_,v)=>{(v===0||!_.previousElementSibling||_.previousElementSibling!==h[v-1])&&(d+="<tr>"),d+=_.outerHTML,(!_.nextElementSibling||!h[v+1]||_.nextElementSibling!==h[v+1])&&(d+="</tr>")}),d+="</table>",u=e.lute.HTML2Md(d)}else{const h=document.createElement("div"),m=e.toolbar.getCurrentType(i),b=A(i.startContainer,"SPAN"),y=ue(i.startContainer,"data-type","NodeHeading"),_=y&&y.textContent.replace(p.ZWSP,"")===i.toString();if(m.length>0&&b&&b.textContent.replace(p.ZWSP,"")===i.toString()||_)_?(h.append(y.cloneNode(!0)),y.removeAttribute("fold")):["DIV","TD","TH","TR"].includes(i.startContainer.parentElement.tagName)?(h.append(i.cloneContents()),this.emojiToMd(h)):(h.append(i.startContainer.parentElement.cloneNode(!0)),this.emojiToMd(h)),d=h.innerHTML,u=i.toString();else if(r)d=r.outerHTML,u=r.querySelector("img").getAttribute("data-src");else if(m.length>0&&i.startContainer.nodeType===3&&i.startContainer.parentElement.tagName==="SPAN"&&i.startContainer.parentElement===i.endContainer.parentElement){const v=i.startContainer.parentElement.attributes,U=document.createElement("span");for(let ee=0;ee<v.length;ee++)U.setAttribute(v[ee].name,v[ee].value);U.getAttribute("data-type").indexOf("block-ref")>-1&&U.getAttribute("data-subtype")==="d"&&U.setAttribute("data-subtype","s"),U.textContent=i.toString(),d=U.outerHTML,u=i.toString()}else{h.append(i.cloneContents()),this.emojiToMd(h);const v=ue(i.commonAncestorContainer,"data-type","inline-math");v?d=v.outerHTML:d=h.innerHTML,u=h.textContent,ue(i.startContainer,"data-type","NodeCodeBlock")?(jt(i)&&(u=u.replace(/\n$/,"")),g=!0):A(i.startContainer,"TD")||A(i.startContainer,"TH")?(h.innerHTML=h.innerHTML.replace(/<br>/g,`
`).replace(/<br\/>/g,`
`),u=h.textContent.endsWith(`
`)?h.textContent.replace(/\n$/,""):h.textContent):A(i.startContainer,"CODE")||(u=i.toString())}}if(e.disabled&&(d=_h(d)),u=u||e.lute.BlockDOM2StdMd(d).trimEnd(),u=u.replace(/\u00A0/g," ").replace(new RegExp(p.ZWSP,"g"),""),n.clipboardData.setData("text/plain",u),!g){Sh(e);const h=l?e.lute.HTML2BlockDOM(d):d;n.clipboardData.setData("text/siyuan",h),yf(e);const m=`<!--data-siyuan='${ye(h)}'-->`+(l?d:e.lute.BlockDOM2HTML(o?u:d));if(n.clipboardData.setData("text/html",m),f)try{yield navigator.clipboard.write([new ClipboardItem({"text/plain":u,"text/html":m})])}catch(b){console.log("Copy write clipboard error:",b)}}})),this.element.addEventListener("mousedown",n=>{var a;if(e.wysiwyg.element.classList.remove("protyle-wysiwyg--hiderange"),n.button===2)return;const i=document;i.onmouseup=null;let s=n.target,r=oe(s);const o=this.element.querySelector(".protyle-wysiwyg--select"),l=N(s,"av__gallery-item");if(n.shiftKey){let j,re=r;if(getSelection().rangeCount>0&&(j=oe(getSelection().getRangeAt(0).startContainer)),!o&&l){l.classList.add("av__gallery-item--select");let Te=l.previousElementSibling,Be=[];for(;Te&&!Te.classList.contains("av__gallery-item--select");)if(Be.push(Te),Te=Te.previousElementSibling,!Te){Be=[];break}Te=l.nextElementSibling;let Ie=[];for(;Te&&!Te.classList.contains("av__gallery-item--select");)if(Ie.push(Te),Te=Te.nextElementSibling,!Te||Te.classList.contains("av__gallery-add")){Ie=[];break}Be.concat(Ie).forEach(Ce=>{Ce.classList.add("av__gallery-item--select")}),n.preventDefault()}else if(j&&re&&j!==re){let Te=!0;const Be=j.getBoundingClientRect(),Ie=re.getBoundingClientRect();let Ce=Be.top,Je=Ie.top;if(Ce===Je&&(Ce=Be.left,Je=Ie.left),Ce>Je){const De=re;re=j,j=De;const tt=Je;Je=Ce,Ce=tt,Te=!1}let ze=[],Ze=j,ht=!1;for(;Ze;)if(Ze&&!Ze.classList.contains("protyle-attr")){const De=Ze.getBoundingClientRect();if(Be.top===Ie.top?De.left<=Je:De.top<=Je)if(ht)if(Ze.nextElementSibling&&!Ze.nextElementSibling.classList.contains("protyle-attr")){const tt=Ze.nextElementSibling.getBoundingClientRect();if(Be.top===Ie.top?tt.left<=Je&&tt.bottom<=Ie.bottom:tt.top<=Je)ze=[Ze],Ze=Ze.nextElementSibling,ht=!1;else if(Ze.parentElement.classList.contains("sb"))Ze=oe(Ze.parentElement),ht=!0;else break}else Ze=oe(Ze.parentElement),ht=!0;else ze.push(Ze),Ze=Ze.nextElementSibling;else if(Ze.parentElement.classList.contains("sb"))Ze=oe(Ze.parentElement),ht=!0;else break}else Ze=oe(Ze.parentElement),ht=!0;if(!(ze.length===1&&!ze[0].classList.contains("list")&&!ze[0].classList.contains("bq")&&!ze[0].classList.contains("sb"))){const De=[];!o&&e.scroll&&!e.scroll.element.classList.contains("fn__none")&&!e.scroll.keepLazyLoad&&(j.getBoundingClientRect().top<-e.contentElement.clientHeight*2||re.getBoundingClientRect().bottom>e.contentElement.clientHeight*2)&&Q(window.siyuan.languages.crossKeepLazyLoad),ze.forEach(tt=>{N(Ze,"protyle-wysiwyg--select")||(tt.classList.add("protyle-wysiwyg--select"),De.push(tt.getAttribute("data-node-id")),tt.querySelectorAll(".protyle-wysiwyg--select").forEach(Ve=>{Ve.classList.remove("protyle-wysiwyg--select")}))}),ss(De),qt(Te?ze[ze.length-1]:ze[0],e.wysiwyg.element,!1)}n.preventDefault()}return}if(je(n)&&!n.shiftKey&&!n.altKey){let j=r;if(!o&&l)l.classList.toggle("av__gallery-item--select");else if(j){const re=ge(j);re&&(j=re),j=It(j),j.classList.contains("protyle-wysiwyg--select")?(j.classList.remove("protyle-wysiwyg--select"),j.removeAttribute("select-start"),j.removeAttribute("select-end")):j.classList.add("protyle-wysiwyg--select"),j.querySelectorAll(".protyle-wysiwyg--select").forEach(Ie=>{Ie.classList.remove("protyle-wysiwyg--select"),Ie.removeAttribute("select-start"),Ie.removeAttribute("select-end")});const Te=N(j.parentElement,"protyle-wysiwyg--select");Te&&(Te.classList.remove("protyle-wysiwyg--select"),Te.removeAttribute("select-start"),Te.removeAttribute("select-end"));const Be=[];e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select").forEach(Ie=>{Be.push(Ie.getAttribute("data-node-id"))}),ss(Be)}return}if(l&&!ue(s,"data-type","av-gallery-more")){i.onmouseup=()=>(i.onmousemove=null,i.onmouseup=null,i.ondragstart=null,i.onselectstart=null,i.onselect=null,si(["galleryItem"],e.wysiwyg.element),!1);return}const c=N(s,"av__drag-fill");if(Ut(["select"],e),ue(s,"data-type","av-gallery-more")?si(["img","row","cell"],e.wysiwyg.element):!N(s,"av__firstcol")&&!c&&si(["img","av"],e.wysiwyg.element),N(s,"protyle-action")&&!N(s,"code-block")||N(s,"av__cell--header")&&!N(s,"av__widthdrag"))return;const d=e.wysiwyg.element.getBoundingClientRect(),u=window.getComputedStyle(e.wysiwyg.element),g=d.left+(parseInt(u.paddingLeft)||24)+1,f=d.right-(parseInt(u.paddingRight)||16)-2,h=e.element.getBoundingClientRect(),m=h.bottom,b=n.clientY,y=e.contentElement.getBoundingClientRect();if(!e.disabled&&s.classList.contains("av__widthdrag")){if(!r)return;const j=r.getAttribute("data-av-id"),re=r.dataset.nodeId,Te=s.parentElement,Be=Te.clientWidth,Ie=Te.getAttribute("data-col-id");let Ce;const Je=r.querySelector(".av__scroll");i.onmousemove=ze=>{Ce=Math.max(Be+(ze.clientX-n.clientX),25),Je.querySelectorAll(".av__row, .av__row--footer").forEach(Ze=>{Ze.querySelector(`[data-col-id="${Ie}"]`).style.width=Ce+"px"}),tc(r,y,"bottom")},i.onmouseup=()=>{if(i.onmousemove=null,i.onmouseup=null,i.ondragstart=null,i.onselectstart=null,i.onselect=null,!Ce||Ce===Be)return;const ze=r.getAttribute(p.CUSTOM_SY_AV_VIEW);et(e,[{action:"setAttrViewColWidth",id:Ie,avID:j,data:Ce+"px",blockID:re,viewID:ze}],[{action:"setAttrViewColWidth",id:Ie,avID:j,data:Be+"px",blockID:re,viewID:ze}])},this.preventClick=!0,n.preventDefault();return}if(!e.disabled&&c){if(!r)return;const j={};let re;const Te=[];r.querySelectorAll(".av__cell--active").forEach(ze=>{const Ze=N(ze,"av__row");Ze&&(j[Ze.dataset.id]||(j[Ze.dataset.id]=[]),j[Ze.dataset.id].push(qo(Ns(ze),ze)),re=ze,Te.push(ze.dataset.id))});const Be=jh(re),Ie=jh(r.querySelector(".av__cell--active"));let Ce,Je;return i.onmousemove=ze=>{const Ze=N(ze.target,"av__cell");if(!(Ce&&Ze&&Ze===Ce)&&(Ce=Ze,Ce&&Ce.dataset.id)){const ht=jh(Ce);if(r.querySelectorAll(".av__cell--active").forEach(De=>{Te.includes(De.dataset.id)||De.classList.remove("av__cell--active")}),ht.celIndex!==Be.celIndex){Je=void 0;return}r.querySelectorAll(".av__row").forEach((De,tt)=>{(ht.rowIndex<Ie.rowIndex&&tt>=ht.rowIndex&&tt<Ie.rowIndex||ht.rowIndex>Be.rowIndex&&tt<=ht.rowIndex&&tt>Be.rowIndex)&&De.querySelectorAll(".av__cell").forEach((Ve,He)=>{He>=Ie.celIndex&&He<=ht.celIndex&&(Ve.classList.add("av__cell--active"),Je=Ve)})})}},i.onmouseup=()=>{if(i.onmousemove=null,i.onmouseup=null,i.ondragstart=null,i.onselectstart=null,i.onselect=null,Je){SF(e,r,j,Te,re);const ze=r.querySelectorAll(".av__cell--active");Js(ze[ze.length-1])}return!1},this.preventClick=!0,!1}const _=N(s,"av__cell");if(!e.disabled&&_&&_.dataset.id&&!ge(_)){if(!r||r.dataset.avType!=="table")return;r.querySelectorAll(".av__cell--select").forEach(Je=>{Je.classList.remove("av__cell--select")}),r.querySelectorAll(".av__drag-fill").forEach(Je=>{Je.remove()}),_.classList.add("av__cell--select");const j=jh(_);let re,Te;const Be=r.getBoundingClientRect(),Ie=r.querySelector(".av__scroll"),Ce=N(_,"av__body");return i.onmousemove=Je=>{const ze=N(Je.target,"av__cell");if(Ie.scrollWidth>Ie.clientWidth+2&&(Je.clientX>Be.right-10?Ie.scrollLeft+=10:Je.clientX<Be.left+34&&(Ie.scrollLeft-=10),Je.clientY<y.top+48?e.contentElement.scrollTop-=5:Je.clientY>y.bottom-48&&(e.contentElement.scrollTop+=5)),!(Ce!==N(ze,"av__body")||re&&ze&&ze===re)&&ze&&ze.dataset.id&&(n.clientX!==Je.clientX||n.clientY!==Je.clientY)){const Ze=jh(ze);r.querySelectorAll(".av__cell--active").forEach(ht=>{ht.classList.remove("av__cell--active")}),Ce.querySelectorAll(".av__row").forEach((ht,De)=>{De>=Math.min(j.rowIndex,Ze.rowIndex)&&De<=Math.max(j.rowIndex,Ze.rowIndex)&&ht.querySelectorAll(".av__cell").forEach((tt,Ve)=>{Ve>=Math.min(j.celIndex,Ze.celIndex)&&Ve<=Math.max(j.celIndex,Ze.celIndex)&&(tt.classList.add("av__cell--active"),Te=tt)})}),re=ze}},i.onmouseup=()=>(i.onmousemove=null,i.onmouseup=null,i.ondragstart=null,i.onselectstart=null,i.onselect=null,Te&&(lo(r.querySelector(".av__firstcol"),"unselectAll"),qt(r),Js(Te),this.preventClick=!0),!1),!1}if(!e.disabled&&s.classList.contains("protyle-action__drag")){if(!r)return;let j=!0;["NodeIFrame","NodeWidget","NodeVideo"].includes(r.getAttribute("data-type"))?(r.classList.add("iframe--drag"),(r.style.textAlign==="left"||r.style.textAlign==="right")&&(j=!1)):s.parentElement.parentElement.getAttribute("data-type")==="img"&&s.parentElement.parentElement.classList.add("img--drag");const re=r.getAttribute("data-node-id"),Te=r.outerHTML,Be=n.clientX,Ie=s.previousElementSibling,Ce=Ie.clientWidth,Je=Ie.clientHeight,ze=Ie.parentElement.parentElement;Ie.tagName==="IMG"&&Fd(ze),i.onmousemove=Ze=>{if(Ie.tagName==="IMG"&&(Ie.style.height=""),Ze.clientX>Be-Ce+8&&Ze.clientX<f){const ht=Ie.tagName==="IMG"&&!ze.style.minWidth&&r.style.textAlign!=="center"||!j?1:2;Ie.tagName==="IMG"?Ie.parentElement.style.width=Math.max(17,Ce+(Ze.clientX-Be)*ht)+"px":Ie.style.width=Math.max(17,Ce+(Ze.clientX-Be)*ht)+"px"}Ie.tagName!=="IMG"&&Ze.clientY>b-Je+8&&Ze.clientY<m&&(Ie.style.height=Je+(Ze.clientY-b)+"px")},i.onmouseup=()=>{i.onmousemove=null,i.onmouseup=null,i.ondragstart=null,i.onselectstart=null,i.onselect=null,s.classList.contains("protyle-action__drag")&&r&&Ht(e,re,r.outerHTML,Te),r.classList.remove("iframe--drag"),s.parentElement.parentElement.classList.remove("img--drag")};return}let v;const U=A(s,"TH")||A(s,"TD");if(U&&(s=U),(s.tagName==="TH"||s.tagName==="TD"||((a=s.firstElementChild)==null?void 0:a.tagName)==="TABLE"||s.classList.contains("table__resize")||s.classList.contains("table__select"))&&(v=r,v&&(v.querySelector(".table__select").removeAttribute("style"),window.siyuan.menus.menu.remove(),Ut(["toolbar"],e),s.classList.contains("table__select")&&(s=document.elementFromPoint(n.clientX,n.clientY),r=oe(s)),n.stopPropagation())),!e.disabled&&s.classList.contains("table__resize")){if(!r)return;const j=r.outerHTML;getSelection().rangeCount>0&&getSelection().getRangeAt(0).collapse(!1),r.firstElementChild.style.webkitUserModify="read-only",r.style.cursor="col-resize",s.removeAttribute("style");const re=r.getAttribute("data-node-id"),Te=n.clientX,Be=parseInt(s.getAttribute("data-col-index")),Ie=r.querySelectorAll("table col")[Be];Ie.style.minWidth&&(Ie.style.width=r.querySelectorAll("table td, table th")[Be].offsetWidth+"px",Ie.style.minWidth=""),r.querySelectorAll("tr").forEach(ze=>{ze.cells[Be].style.width=""});const Ce=Ie.clientWidth,Je=r.firstElementChild.clientWidth<r.firstElementChild.scrollWidth;i.onmousemove=ze=>{r.style.textAlign==="center"&&!Je?Ie.style.width=Ce+(ze.clientX-Te)*2+"px":Ie.style.width=Ce+(ze.clientX-Te)+"px"},i.onmouseup=()=>{r.firstElementChild.style.webkitUserModify="",r.style.cursor="",i.onmousemove=null,i.onmouseup=null,i.ondragstart=null,i.onselectstart=null,i.onselect=null,r&&Ht(e,re,r.outerHTML,j)};return}let ee=n.clientX;n.clientX>f?ee=f:n.clientX<g&&(ee=g);const Z=h.top+(e.options.render.breadcrumb?e.breadcrumb.element.parentElement.clientHeight:0);let k,w,S,B;this.element.querySelectorAll("iframe").forEach(j=>{j.style.pointerEvents="none"});const H=["IMG","VIDEO","AUDIO"].includes(s.tagName)||s.classList.contains("img");i.onmousemove=j=>{let re=j.target;if(v&&v.contains(re)&&!N(v,"protyle-wysiwyg__embed")){if(re.classList.contains("table__select")){re.classList.add("fn__none");const He=document.elementFromPoint(j.clientX,j.clientY);re.classList.remove("fn__none"),re=A(He,"TH")||A(He,"TD")}if(re&&re===s)return v.querySelector(".table__select").removeAttribute("style"),e.wysiwyg.element.classList.remove("protyle-wysiwyg--hiderange"),w=re,!1;if(re&&(re.tagName==="TH"||re.tagName==="TD")&&(!w||w!==re)){v.firstElementChild.style.webkitUserModify="read-only";let He=s.offsetLeft+s.clientWidth-re.offsetLeft,bt=re.offsetLeft;s.offsetLeft===re.offsetLeft?He=Math.max(s.clientWidth,re.clientWidth):s.offsetLeft<re.offsetLeft&&(He=re.offsetLeft+re.clientWidth-s.offsetLeft,bt=s.offsetLeft);let Kt=s.offsetTop+s.clientHeight-re.offsetTop,Vt=re.offsetTop;s.offsetTop===re.offsetTop?Kt=Math.max(s.clientHeight,re.clientHeight):s.offsetTop<re.offsetTop&&(Kt=re.offsetTop+re.clientHeight-s.offsetTop,Vt=s.offsetTop),Array.from(v.querySelectorAll("th, td")).find(At=>{const Ct=At.offsetLeft<bt+He&&At.offsetLeft+At.clientWidth>bt+He,Ln=At.offsetLeft<bt&&At.offsetLeft+At.clientWidth>bt;At.offsetTop<Vt&&At.offsetTop+At.clientHeight>Vt?((At.offsetLeft+6>bt&&At.offsetLeft+At.clientWidth-6<bt+He||Ct||Ln)&&(Kt=Vt+Kt-At.offsetTop,Vt=At.offsetTop),Ct&&(He=At.offsetLeft+At.clientWidth-bt),Ln&&(He=bt+He-At.offsetLeft,bt=At.offsetLeft)):At.offsetTop<Vt+Kt&&At.offsetTop+At.clientHeight>Vt+Kt?((At.offsetLeft+6>bt&&At.offsetLeft+At.clientWidth-6<bt+He||Ct||Ln)&&(Kt=At.clientHeight+At.offsetTop-Vt),Ct&&(He=At.offsetLeft+At.clientWidth-bt),Ln&&(He=bt+He-At.offsetLeft,bt=At.offsetLeft)):Ln&&At.offsetTop+6>Vt&&At.offsetTop+At.clientHeight-6<Vt+Kt?(He=bt+He-At.offsetLeft,bt=At.offsetLeft):Ct&&At.offsetTop+6>Vt&&At.offsetTop+At.clientHeight-6<Vt+Kt&&(He=At.offsetLeft+At.clientWidth-bt)}),e.wysiwyg.element.classList.add("protyle-wysiwyg--hiderange"),v.querySelector(".table__select").setAttribute("style",`left:${bt-v.firstElementChild.scrollLeft}px;top:${Vt-v.querySelector("table").scrollTop}px;height:${Kt}px;width:${He+1}px;`),w=re}return}H&&(j.clientY<y.top+p.SIZE_SCROLL_TB||j.clientY>y.bottom-p.SIZE_SCROLL_TB)&&e.contentElement.scroll({top:e.contentElement.scrollTop+(j.clientY<y.top+p.SIZE_SCROLL_TB?-p.SIZE_SCROLL_STEP:p.SIZE_SCROLL_STEP),behavior:"smooth"}),e.selectElement.classList.remove("fn__none"),Ut(["gutter"],e);let Te=0,Be=0,Ie=0,Ce=0;if(j.clientX<ee?(j.clientX<g?Be=g:Be=j.clientX,Ie=ee-Be):j.clientX>f?(Be=ee,Ie=f-Be):(Be=ee,Ie=j.clientX-ee),j.clientY>b?j.clientY>m?(Te=b,Ce=m-b):(Te=b,Ce=j.clientY-b):(j.clientY<Z?Te=Z:Te=j.clientY,Ce=b-Te),Ce<4)return;e.selectElement.setAttribute("style",`background-color: ${e.selectElement.style.backgroundColor};top:${Te}px;height:${Ce}px;left:${Be+2}px;width:${Ie-2}px;`);const Je=document.elementFromPoint(j.clientX,j.clientY);if(k&&k===Je&&!k.classList.contains("protyle-wysiwyg")&&!k.classList.contains("list")&&!k.classList.contains("bq")&&!k.classList.contains("sb"))return;k=Je,Ut(["select"],e);let ze;if(j.clientY>b?(ze=S||document.elementFromPoint(Be,Te),B=void 0):(ze=document.elementFromPoint(Be,Te),S=void 0),!ze||((ze.classList.contains("protyle-wysiwyg")||ze.classList.contains("list")||ze.classList.contains("li")||ze.classList.contains("sb")||ze.classList.contains("bq"))&&(ze=document.elementFromPoint(Be,Te+16)),!ze))return;let Ze=oe(ze);!Ze&&ze.classList.contains("protyle-breadcrumb__bar")&&(Ze=ze.nextElementSibling),j.clientY>b?S||(Ze||(Ze=e.wysiwyg.element.firstElementChild,Ze.classList.contains("protyle-breadcrumb__bar")&&(Ze=Ze.nextElementSibling)),S=Ze):!Ze&&j.clientY<e.wysiwyg.element.lastElementChild.getBoundingClientRect().bottom&&(Ze=e.wysiwyg.element.firstElementChild,Ze.classList.contains("protyle-breadcrumb__bar")&&(Ze=Ze.nextElementSibling));let ht=[],De=Ze;if(De){const He=ge(De);He&&(De=He)}let tt=!1;const Ve=B?B.getBoundingClientRect().bottom:Te+Ce;for(;De;)if(De&&!De.classList.contains("protyle-attr")){const He=De.getBoundingClientRect();if(He.height>0&&He.top<Ve&&He.left<Be+Ie)if(tt)if(De.nextElementSibling&&!De.nextElementSibling.classList.contains("protyle-attr")){const bt=De.nextElementSibling.getBoundingClientRect();if(bt.top<Ve&&bt.left<Be+Ie)ht=[De],De=De.nextElementSibling,tt=!1;else if(De.parentElement.classList.contains("sb"))De=oe(De.parentElement),tt=!0;else break}else De=oe(De.parentElement),tt=!0;else!De.classList.contains("protyle-breadcrumb__bar")&&!De.classList.contains("protyle-breadcrumb__item")&&ht.push(De),De=De.nextElementSibling;else if(De.parentElement.classList.contains("sb"))De=oe(De.parentElement),tt=!0;else if(He.height===0&&He.width===0&&De.parentElement.getAttribute("fold")==="1")De=De.parentElement,ht=[];else break}else De=oe(De.parentElement),tt=!0;j.clientY<=b&&!B&&(B=ht[ht.length-1]),ht.length===1&&!ht[0].classList.contains("list")&&!ht[0].classList.contains("bq")&&!ht[0].classList.contains("sb")?(e.selectElement.style.backgroundColor="transparent",e.wysiwyg.element.classList.remove("protyle-wysiwyg--hiderange")):(e.wysiwyg.element.classList.add("protyle-wysiwyg--hiderange"),ht.forEach(He=>{N(He,"protyle-wysiwyg__embed")||He.classList.add("protyle-wysiwyg--select")}),e.selectElement.style.backgroundColor="")},i.onmouseup=j=>{var re;if(i.onmousemove=null,i.onmouseup=null,i.ondragstart=null,i.onselectstart=null,i.onselect=null,S=void 0,B=void 0,e.wysiwyg.element.classList.remove("protyle-wysiwyg--hiderange"),this.element.querySelectorAll("iframe").forEach(Ie=>{Ie.style.pointerEvents=""}),e.selectElement.classList.add("fn__none"),e.selectElement.removeAttribute("style"),v){v.firstElementChild.style.webkitUserModify="";const Ie=v.querySelector(".table__select");if(Ie.getAttribute("style")){if(getSelection().rangeCount>0&&getSelection().getRangeAt(0).collapse(!1),window.siyuan.menus.menu.remove(),e.disabled||(window.siyuan.menus.menu.append(new xe({id:"mergeCell",label:window.siyuan.languages.mergeCell,click:()=>{if(v){const Ce=[],Je=[],ze=v.querySelectorAll("th").length;let Ze=0;const ht=v.firstElementChild.scrollLeft,De=v.querySelector("table").scrollTop;let tt=!1,Ve=!1;v.querySelectorAll("th, td").forEach((Oe,Xn)=>{Oe.classList.contains("fn__none")?(Oe.previousElementSibling&&Oe.previousElementSibling===Ce[Ce.length-1]||Xn<Ze&&Je.includes((Xn+1)%ze))&&(Ce.push(Oe),!tt&&Oe.parentElement.parentElement.tagName==="THEAD"?tt=!0:!Ve&&Oe.parentElement.parentElement.tagName==="TBODY"&&(Ve=!0)):Ra({tableSelectElement:Ie,scrollLeft:ht,scrollTop:De,item:Oe})&&(Ce.push(Oe),!tt&&Oe.parentElement.parentElement.tagName==="THEAD"?tt=!0:!Ve&&Oe.parentElement.parentElement.tagName==="TBODY"&&(Ve=!0),Je.push((Xn+1)%ze),Ze=Math.max((Oe.rowSpan-1)*ze+Xn+1,Ze))}),Ie.removeAttribute("style");const He=v.outerHTML;let bt=Ce[0],Kt=bt.colSpan,Vt=1;for(;bt.nextElementSibling&&bt.nextElementSibling===Ce[Vt];)bt=bt.nextElementSibling,bt.classList.contains("fn__none")||(Kt+=bt.colSpan),Vt++;let At="",Ct=Ce[0].parentElement,Ln=Ce[0].rowSpan;if(Ce.forEach((Oe,Xn)=>{let Rn=Oe.innerHTML.trim();Rn.endsWith("<br>")&&(Rn=Rn.substr(0,Rn.length-4)),At+=Rn+(!Rn||Xn===Ce.length-1?"":"<br>"),Xn!==0&&(Ct!==Oe.parentElement&&(Oe.classList.contains("fn__none")||(Ln+=Oe.rowSpan),Ct=Oe.parentElement,Ce[0].parentElement.parentElement.tagName==="THEAD"&&Oe.parentElement.parentElement.tagName!=="THEAD"&&Ce[0].parentElement.parentElement.insertAdjacentElement("beforeend",Oe.parentElement)),Oe.classList.add("fn__none"),Oe.innerHTML="")}),tt&&Ve)for(Ct=Ct.parentElement.nextElementSibling.firstElementChild;Ct&&Ct.parentElement.tagName!=="THEAD";){let Oe=0,Xn=0;if(Array.from(Ct.children).forEach(Rn=>{Oe+=Rn.colSpan-1,Rn.classList.contains("fn__none")&&Xn++}),Oe!==Xn)Ce[0].parentElement.parentElement.insertAdjacentElement("beforeend",Ct),Ct=Ct.parentElement.nextElementSibling.firstElementChild;else break}setTimeout(()=>{v&&(Ce[0].innerHTML=At+"<wbr>",Ce[0].colSpan=Kt,Ce[0].rowSpan=Ln,cn(Ce[0],document.createRange()),Ht(e,v.getAttribute("data-node-id"),v.outerHTML,He))})}}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_1",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"alignLeft",icon:"iconAlignLeft",accelerator:window.siyuan.config.keymap.editor.general.alignLeft.custom,label:window.siyuan.languages.alignLeft,click:()=>{if(v){const Ce=[],Je=v.firstElementChild.scrollLeft,ze=v.querySelector("table").scrollTop;v.querySelectorAll("th, td").forEach(Ze=>{!Ze.classList.contains("fn__none")&&Ra({tableSelectElement:Ie,scrollLeft:Je,scrollTop:ze,item:Ze})&&(Ce.length===0||Ce.length>0&&Ze.offsetTop===Ce[0].offsetTop)&&Ce.push(Ze)}),Ie.removeAttribute("style"),se(e,Ce,v,"left",hn(v))}}}).element),window.siyuan.menus.menu.append(new xe({id:"alignCenter",icon:"iconAlignCenter",accelerator:window.siyuan.config.keymap.editor.general.alignCenter.custom,label:window.siyuan.languages.alignCenter,click:()=>{if(v){const Ce=[],Je=v.firstElementChild.scrollLeft,ze=v.querySelector("table").scrollTop;v.querySelectorAll("th, td").forEach(Ze=>{!Ze.classList.contains("fn__none")&&Ra({tableSelectElement:Ie,scrollLeft:Je,scrollTop:ze,item:Ze})&&(Ce.length===0||Ce.length>0&&Ze.offsetTop===Ce[0].offsetTop)&&Ce.push(Ze)}),Ie.removeAttribute("style"),se(e,Ce,v,"center",hn(v))}}}).element),window.siyuan.menus.menu.append(new xe({id:"alignRight",icon:"iconAlignRight",accelerator:window.siyuan.config.keymap.editor.general.alignRight.custom,label:window.siyuan.languages.alignRight,click:()=>{if(v){const Ce=[],Je=v.firstElementChild.scrollLeft,ze=v.querySelector("table").scrollTop;v.querySelectorAll("th, td").forEach(Ze=>{!Ze.classList.contains("fn__none")&&Ra({tableSelectElement:Ie,scrollLeft:Je,scrollTop:ze,item:Ze})&&(Ce.length===0||Ce.length>0&&Ze.offsetTop===Ce[0].offsetTop)&&Ce.push(Ze)}),Ie.removeAttribute("style"),se(e,Ce,v,"right",hn(v))}}}).element),window.siyuan.menus.menu.append(new xe({id:"useDefaultAlign",icon:"",label:window.siyuan.languages.useDefaultAlign,click:()=>{if(v){const Ce=[],Je=v.firstElementChild.scrollLeft,ze=v.querySelector("table").scrollTop;v.querySelectorAll("th, td").forEach(Ze=>{!Ze.classList.contains("fn__none")&&Ra({tableSelectElement:Ie,scrollLeft:Je,scrollTop:ze,item:Ze})&&(Ce.length===0||Ce.length>0&&Ze.offsetTop===Ce[0].offsetTop)&&Ce.push(Ze)}),Ie.removeAttribute("style"),se(e,Ce,v,"",hn(v))}}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_2",type:"separator"}).element)),window.siyuan.menus.menu.append(new xe({id:"copyPlainText",label:window.siyuan.languages.copyPlainText,click(){if(v){const Ce=[],Je=v.firstElementChild.scrollLeft,ze=v.querySelector("table").scrollTop,Ze=v.querySelector(".table__select");v.querySelectorAll("th, td").forEach(De=>{!De.classList.contains("fn__none")&&Ra({tableSelectElement:Ze,scrollLeft:Je,scrollTop:ze,item:De})&&Ce.push(De)});let ht="";Ce.forEach((De,tt)=>{ht+=De.textContent.trim()+"	",(!De.nextElementSibling||!Ce[tt+1]||De.nextElementSibling!==Ce[tt+1])&&(ht=ht.slice(0,-1)+`
`)}),kt(ht.slice(0,-1)),qt(v)}}}).element),window.siyuan.menus.menu.append(new xe({id:"copy",icon:"iconCopy",accelerator:"\u2318C",label:window.siyuan.languages.copy,click(){v&&(Pt(hn(v)),document.execCommand("copy"))}}).element),!e.disabled){let Ce;window.siyuan.menus.menu.append(new xe({id:"cut",icon:"iconCut",accelerator:"\u2318X",label:window.siyuan.languages.cut,click(){v&&(Pt(hn(v)),document.execCommand("cut"))}}).element),window.siyuan.menus.menu.append(new xe({id:"clear",label:window.siyuan.languages.clear,icon:"iconTrashcan",accelerator:"\u2326",click(){Eh(e,v)}}).element),window.siyuan.menus.menu.append(new xe({id:"paste",label:window.siyuan.languages.paste,icon:"iconPaste",accelerator:"\u2318V",click(){return RE(this,null,function*(){if(document.queryCommandSupported("paste"))document.execCommand("paste");else if(v)try{const Je=yield nt();_f(e,Object.assign(Je,{target:v}))}catch(Je){console.log(Je)}})}}).element)}window.siyuan.menus.menu.popup({x:j.clientX-8,y:j.clientY-16})}}const Te=[],Be=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(Be.forEach(Ie=>{Te.push(Ie.getAttribute("data-node-id"))}),ss(Te),getSelection().rangeCount>0){const Ie=getSelection().getRangeAt(0);if((Ie.toString()===""||window.siyuan.shiftIsPressed)&&n.detail>2){let ze=oe(Ie.startContainer);if(ze){if((re=ze.nextElementSibling)!=null&&re.classList.contains("table"))qa(Ee(ze),Ie,!1);else if(ze.classList.contains("table")){const Ze=ze.querySelectorAll("th, td");ze=Ze[Ze.length-1],ze.contains(Ie.startContainer)&&qa(ze,Ie,!1)}}return}if(Be.length>0){Ie.collapse(!0),Ie.commonAncestorContainer.nodeType===1&&Ie.startContainer.childNodes[Ie.startOffset]&&Ie.startContainer.childNodes[Ie.startOffset].nodeType===1&&Ie.commonAncestorContainer.classList.contains("protyle-wysiwyg")&&qt(Ie.startContainer.childNodes[Ie.startOffset]);return}const Ce=oe(Ie.startContainer);let Je;if(j.detail>2&&Ie.endContainer.nodeType!==3&&["DIV","TD","TH"].includes(Ie.endContainer.tagName)&&Ie.endOffset===0){if(Ie.endContainer.classList.contains("protyle-attr")&&Ce)qa(Ee(Ce),Ie,!1);else if(["TD","TH"].includes(Ie.endContainer.tagName)){const ze=A(Ie.startContainer,"TH")||A(Ie.startContainer,"TD");ze&&qa(ze,Ie,!1)}}else Je=oe(Ie.endContainer);Ce&&Je&&Je!==Ce&&(Ie.startContainer.nodeType===1&&Ie.startContainer.tagName==="DIV"&&Ie.startContainer.classList.contains("protyle-attr")||n.clientY>j.clientY?uu(Ee(Je),Ie):Ie.endOffset===0&&Ie.endContainer.nodeType===1&&Ie.endContainer.tagName==="DIV"?qa(Ee(Ce),Ie,!1):Ie.collapse(!0))}}})}bindEvent(e){e.observer=new ResizeObserver(()=>{const o=e.contentElement.getBoundingClientRect();e.wysiwyg.element.querySelectorAll(".av").forEach(l=>{l.querySelector(".av__scroll")&&tc(l,o,"all")})}),this.element.addEventListener("focusout",()=>{if(getSelection().rangeCount===0)return;const o=getSelection().getRangeAt(0);(this.element===o.startContainer||this.element.contains(o.startContainer))&&(e.toolbar.range=o.cloneRange())}),this.element.addEventListener("cut",o=>RE(this,null,function*(){var l,c,d;if(window.siyuan.ctrlIsPressed=!1,e.disabled)return;if(o.target.tagName==="PROTYLE-HTML"||o.target.localName==="input"){o.stopPropagation();return}e.options.render.breadcrumb&&e.breadcrumb.hide();const u=hn(e.wysiwyg.element);let g=oe(u.startContainer);if(!g){o.stopPropagation(),o.preventDefault();return}const f=ge(g);f&&(g=f),o.stopPropagation(),o.preventDefault();const h=g.querySelector(".img--select"),m=g.querySelector(".av__row--select, .av__cell--select"),b=((l=g.querySelector(".table__select"))==null?void 0:l.clientWidth)>0;let y=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));y.length===0&&u.toString()===""&&!u.cloneContents().querySelector("img")&&!h&&!m&&!b&&(g.classList.add("protyle-wysiwyg--select"),y=[g]);let _="",v="",U=!1,ee=!1;if(y.length>0){y[0].getAttribute("data-type")==="NodeListItem"&&y[0].parentElement.classList.contains("list")&&y[0].parentElement.childElementCount-1===y.length&&(y.find(S=>{if(!y[0].parentElement.contains(S))return!0})||(y=[y[0].parentElement]));let Z="";for(let w=0;w<y.length;w++){const S=It(y[w]);let B="";S.getAttribute("data-type")==="NodeHeading"&&S.getAttribute("fold")==="1"?(ee=!0,B=(yield wn("/api/block/getHeadingChildrenDOM",{id:S.getAttribute("data-node-id"),removeFoldAttr:!1})).data):S.getAttribute("data-type")!=="NodeBlockQueryEmbed"&&S.querySelector('[data-type="NodeHeading"][fold="1"]')?(ee=!0,B=(yield wn("/api/block/getBlockDOM",{id:S.getAttribute("data-node-id")})).data.dom):B=vd(S),S.getAttribute("data-type")==="NodeListItem"?(Z||(Z=`<div data-subtype="${S.getAttribute("data-subtype")}" data-node-id="${Lute.NewNodeID()}" data-type="NodeList" class="list">`),Z+=B,(w===y.length-1||y[w+1].getAttribute("data-type")!=="NodeListItem"||y[w+1].getAttribute("data-subtype")!==S.getAttribute("data-subtype"))&&(_+=`${Z}<div class="protyle-attr" contenteditable="false">${p.ZWSP}</div></div>`,Z="")):_+=B}const k=Fe(y[y.length-1]);gr(e,g,u,"remove"),k&&qt(k)}else if(m){ee=!0;const Z=yield fs(e,g);_=JSON.stringify(Z.json),v=Z.text}else if(b){const Z=[],k=g.firstElementChild.scrollLeft,w=g.querySelector("table").scrollTop,S=g.querySelector(".table__select");if(_="<table>",g.querySelectorAll("th, td").forEach(H=>{!H.classList.contains("fn__none")&&Ra({tableSelectElement:S,scrollLeft:k,scrollTop:w,item:H})&&Z.push(H)}),S.removeAttribute("style"),getSelection().rangeCount>0){const H=getSelection().getRangeAt(0);g.contains(H.startContainer)&&H.insertNode(document.createElement("wbr"))}const B=g.outerHTML;(c=g.querySelector("wbr"))==null||c.remove(),g.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Z.forEach((H,j)=>{(j===0||!H.previousElementSibling||H.previousElementSibling!==Z[j-1])&&(_+="<tr>"),_+=H.outerHTML,(!H.nextElementSibling||!Z[j+1]||H.nextElementSibling!==Z[j+1])&&(_+="</tr>"),H.innerHTML=""}),_+="</table>",v=e.lute.HTML2Md(_),Ht(e,g.getAttribute("data-node-id"),g.outerHTML,B)}else{const Z=g.getAttribute("data-node-id");Xg(g,u,e);const k=e.wysiwyg.lastHTMLs[Z]||g.outerHTML,w=document.createElement("div");let S=u.startContainer;if(S.nodeType===3&&S.textContent===""){const H=_t(u.startContainer);H&&(S=H)}const B=ue(S,"data-type","NodeHeading");if(B&&u.toString()===B.firstElementChild.textContent)w.insertAdjacentHTML("afterbegin",B.firstElementChild.innerHTML),B.firstElementChild.innerHTML="";else if(u.toString()!==""&&S===u.endContainer&&u.startContainer.nodeType===3&&u.endOffset===u.endContainer.wholeText.length&&u.startOffset===0&&!["DIV","TD","TH","TR"].includes(u.startContainer.parentElement.tagName))w.append(u.startContainer.parentElement);else if(h)w.append(h);else if(u.startContainer.nodeType===3&&u.startContainer.parentElement.tagName==="SPAN"&&u.startContainer.parentElement.getAttribute("data-type")&&u.startContainer.parentElement===u.endContainer.parentElement){const H=u.startContainer.parentElement,j=H.attributes,re=document.createElement("span");for(let Te=0;Te<j.length;Te++)re.setAttribute(j[Te].name,j[Te].value);H.getAttribute("data-type").indexOf("block-ref")>-1&&H.getAttribute("data-subtype")==="d"&&(re.setAttribute("data-subtype","s"),H.setAttribute("data-subtype","s")),re.textContent=u.toString(),u.deleteContents(),w.append(re)}else if(u.cloneContents().querySelectorAll("td, th").length>0){const H=document.createElement("wbr");u.insertNode(H),u.setStartAfter(H),w.append(u.extractContents()),g.outerHTML=e.lute.SpinBlockDOM(g.outerHTML),g=e.wysiwyg.element.querySelector(`[data-node-id="${Z}"]`),Ei(g),cn(g,u)}else{const H=ue(u.commonAncestorContainer,"data-type","inline-math");if(H)w.append(H);else{w.append(u.extractContents());let j;g.classList.contains("av")?ox(e,g):g.classList.contains("table")?j=A(u.startContainer,"TD")||A(u.startContainer,"TH"):j=Ee(g),j&&Array.from(j.children).forEach(re=>{re.textContent===""&&re.nodeType===1&&!["BR","IMG"].includes(re.tagName)&&re.remove()})}}if(this.emojiToMd(w),_=w.innerHTML,(ue(u.startContainer,"data-type","NodeCodeBlock")||A(u.startContainer,"CODE"))&&(v=w.textContent.replace(p.ZWSP,""),U=!0),!g.classList.contains("table")){const H=Ee(g);H&&H.textContent===""&&(H.innerHTML="")}g.setAttribute("updated",at().format("YYYYMMDDHHmmss")),g.getAttribute("data-type")==="NodeCodeBlock"&&(u.insertNode(document.createElement("wbr")),(d=g.querySelector('[data-render="true"]'))==null||d.removeAttribute("data-render"),ra(g)),g.parentElement.parentElement&&!g.classList.contains("av")&&(Xg(g,u,e),Ht(e,Z,e.wysiwyg.lastHTMLs[Z]||g.outerHTML,k))}if(e.hint.render(e),m||(v=v||e.lute.BlockDOM2StdMd(_).trimEnd(),g.classList.contains("table")&&(v=v.replace(/<br>/g,`
`).replace(/<br\/>/g,`
`),v=v.endsWith(`
`)?v.replace(/\n$/,""):v)),v=v.replace(/\u00A0/g," "),o.clipboardData.setData("text/plain",v),!U){Sh(e);const Z=b?e.lute.HTML2BlockDOM(_):_;yf(e),o.clipboardData.setData("text/siyuan",Z);const k=`<!--data-siyuan='${ye(Z)}'-->`+(b?_:e.lute.BlockDOM2HTML(m?v:_));if(o.clipboardData.setData("text/html",k),ee)try{yield navigator.clipboard.write([new ClipboardItem({"text/plain":v,"text/html":k})])}catch(w){console.log("Cut write clipboard error:",w)}}}));let n;this.element.addEventListener("contextmenu",o=>{var l,c,d,u,g;if(o.shiftKey)return;o.stopPropagation(),o.preventDefault();const f=o.clientX||o.detail.x,h=o.clientY||o.detail.y,m=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(m.length>1){Ut(["util"],e),e.gutter.renderMenu(e,m[0]),window.siyuan.menus.menu.popup({x:f,y:h});return}const b=o.detail.target||o.target,y=ge(b);if(y)return getSelection().rangeCount===0&&NE(y),e.gutter.renderMenu(e,y),window.siyuan.menus.menu.popup({x:f,y:h}),!1;const _=oe(b);if(!_)return!1;const v=N(b,"av__gallery-item");if(v)return US({target:v.querySelector(".protyle-icon--last"),protyle:e,position:{x:o.clientX,y:o.clientY}}),o.stopPropagation(),o.preventDefault(),!1;const U=N(b,"av__cell");if(U){if(U.classList.contains("av__cell--header")){e.disabled||iA(e,_,U),o.stopPropagation(),o.preventDefault();return}if(Ns(U)==="mAsset"){const w=N(b,"av__cellassetimg")||N(b,"av__celltext--url");if(w){let S=0;Array.from(U.children).find((B,H)=>{if(B===w)return S=H,!0}),o_({protyle:e,cellElements:[U],blockElement:oe(w),content:b.tagName==="IMG"?b.getAttribute("src"):b.getAttribute("data-url"),type:b.tagName==="IMG"?"image":"file",name:b.tagName==="IMG"?"":b.getAttribute("data-name"),index:S,rect:b.getBoundingClientRect()}),o.stopPropagation(),o.preventDefault();return}}}const ee=N(b,"av__row");if(ee&&Vh(e,ee,{x:o.clientX,y:ee.getBoundingClientRect().bottom,h:ee.clientHeight})){o.stopPropagation(),o.preventDefault();return}const Z=N(b,"item");if(_.classList.contains("av")&&Z){Z.classList.contains("item--focus")?Fh({protyle:e,blockElement:_,element:Z}):(et(e,[{action:"setAttrViewBlockView",blockID:_.getAttribute("data-node-id"),id:Z.dataset.id,avID:_.getAttribute("data-av-id")}],[{action:"setAttrViewBlockView",blockID:_.getAttribute("data-node-id"),id:Z.parentElement.querySelector(".item--focus").getAttribute("data-id"),avID:_.getAttribute("data-av-id")}]),window.siyuan.menus.menu.remove(),Fh({protyle:e,blockElement:_,element:Z})),o.stopPropagation(),o.preventDefault();return}if(e.toolbar.range=hn(e.element),b.tagName==="SPAN"&&!pt(_)){let w=((l=b.getAttribute("data-type"))==null?void 0:l.split(" "))||[];if(w.length===0&&(w=(b.dataset.type||"").split(" ")),w.length>0&&hS(b),w.includes("block-ref"))return Gv(e,b),b.setAttribute("prevent-popover","true"),setTimeout(()=>{b.removeAttribute("prevent-popover")},620),!1;if(w.includes("file-annotation-ref")&&!e.disabled)return Yv(e,b),!1;if(w.includes("tag")&&!e.disabled)return Xv(e,b),!1;if(w.includes("inline-memo"))return e.toolbar.showRender(e,b),!1;if(w.includes("a"))return Df(e,b),window.siyuan.config.editor.floatWindowMode===0&&((c=b.getAttribute("data-href"))!=null&&c.startsWith("siyuan://blocks"))&&(b.setAttribute("prevent-popover","true"),setTimeout(()=>{b.removeAttribute("prevent-popover")},620)),!1}const k=ue(b,"data-type","inline-math");if(k)return a_(e,k),!1;if(b.tagName==="IMG"&&N(b,"img"))return Kv(e,e.toolbar.range,b.parentElement.parentElement,{clientX:f+4,clientY:h}),!1;!pt(_)&&!_.classList.contains("protyle-wysiwyg--select")&&!N(b,"protyle-action")&&(x()||o.detail.target||n&&_.contains(n.startContainer))?(!x()||(d=e.toolbar)!=null&&d.element.classList.contains("fn__none"))&&!_.classList.contains("av")&&(CM(e,_),window.siyuan.menus.menu.popup({x:f,y:h+13,h:26}),(u=e.toolbar)==null||u.element.classList.add("fn__none"),_.classList.contains("table")&&_.querySelector(".table__select").removeAttribute("style")):e.toolbar.range.toString()===""&&(Ut(["util"],e),e.gutter&&e.gutter.renderMenu(e,_),window.siyuan.menus.menu.popup({x:f,y:h}),(g=e.toolbar)==null||g.element.classList.add("fn__none"))}),this.element.addEventListener("pointerdown",()=>{if(getSelection().rangeCount>0?n=getSelection().getRangeAt(0):n=void 0,e.breadcrumb){const o=e.breadcrumb.element.parentElement.querySelector('[data-type="indent"]');o&&getSelection().rangeCount>0&&setTimeout(()=>{const l=getSelection().getRangeAt(0),c=oe(l.startContainer);if(!c)return;const d=e.breadcrumb.element.parentElement.querySelector('[data-type="outdent"]');c.parentElement.classList.contains("li")?(o.removeAttribute("disabled"),d.removeAttribute("disabled")):(o.setAttribute("disabled","true"),d.setAttribute("disabled","true"))},520)}});let a=!1;this.element.addEventListener("mousewheel",o=>{if(Pa(),!a&&o.deltaY<0&&!e.scroll.element.classList.contains("fn__none")&&e.contentElement.clientHeight===e.contentElement.scrollHeight&&e.wysiwyg.element.firstElementChild.getAttribute("data-eof")!=="1"&&(ae("/api/filetree/getDoc",{id:e.wysiwyg.element.firstElementChild.getAttribute("data-node-id"),mode:1,size:window.siyuan.config.editor.dynamicLoadBlocks},c=>{a=!1,_a({data:c,protyle:e,action:[p.CB_GET_BEFORE,p.CB_GET_UNCHANGEID]})}),a=!0),o.deltaX===0)return;const l=N(o.target,"table");if(l){const c=l.querySelector(".table__select");c!=null&&c.style.width&&(c.removeAttribute("style"),window.siyuan.menus.menu.remove())}},{passive:!0}),this.element.addEventListener("paste",o=>{if(o.target.localName==="input"&&o.target.getAttribute("data-type")==="av-search")return;if(e.disabled){o.stopPropagation(),o.preventDefault();return}if(window.siyuan.ctrlIsPressed=!1,o.target.tagName==="PROTYLE-HTML"||o.target.localName==="input"){o.stopPropagation();return}if(!ue(o.target,"contenteditable","true")){o.stopPropagation(),o.preventDefault();return}const l=oe(o.target);if(l&&!Ee(l)){o.stopPropagation(),o.preventDefault();return}if(!l)return;const c=getSelection().getRangeAt(0);e.toolbar.range=c;const d=c.startContainer.parentElement;if(c.toString()===""&&d.tagName==="SPAN"){const u=(d.getAttribute("data-type")||"").split(" ");if(u.includes("inline-memo")||u.includes("text")||u.includes("block-ref")||u.includes("file-annotation-ref")||u.includes("a")){const g=ya(d,l,c);g.start===0?(c.setStartBefore(d),c.collapse(!0)):g.start===d.textContent.length&&(c.setEndAfter(d),c.collapse(!1))}}_f(e,o)});let i=!1;this.element.addEventListener("compositionstart",o=>{i=!0;const l=hn(e.wysiwyg.element),c=oe(l.startContainer);!Jt()&&c&&Xg(c,l,e),o.stopPropagation()}),this.element.addEventListener("compositionend",o=>{o.stopPropagation(),i=!1;const l=hn(this.element),c=oe(l.startContainer);if(c)if(o.data!=="")this.escapeInline(e,l,o),s_(e,c,l,!0);else{const d=c.getAttribute("data-node-id");e.wysiwyg.lastHTMLs[d]&&Ht(e,d,c.outerHTML,e.wysiwyg.lastHTMLs[d])}});let s;this.element.addEventListener("input",o=>{const l=o.target;if(l.tagName==="VIDEO"||l.tagName==="AUDIO"||o.inputType==="historyRedo")return;if(o.inputType==="historyUndo"){window.siyuan.menus.menu.remove();return}const c=hn(this.element),d=oe(c.startContainer);d&&([":","(","\u3010","\uFF08","[","{","\u300C","\u300E","#","/","\u3001"].includes(o.data)&&(e.hint.enableExtend=!0),!(o.isComposing||i||o.inputType==="deleteByDrag"||o.inputType==="insertFromDrop")&&(this.escapeInline(e,c,o),/^\d{1}$/.test(o.data)||o.data==="\u2018"||o.data==="\u201C"||o.data==="\u201D"||o.data==="\u300C"?(clearTimeout(s),s=window.setTimeout(()=>{s_(e,d,c,!0)})):s_(e,d,c,!0,o),o.stopPropagation()))}),this.element.addEventListener("keyup",o=>{const l=hn(this.element).cloneRange(),c=oe(l.startContainer);if(o.key!=="PageUp"&&o.key!=="PageDown"&&o.key!=="Home"&&o.key!=="End"&&o.key.indexOf("Arrow")===-1&&o.key!=="Escape"&&o.key!=="Shift"&&o.key!=="Meta"&&o.key!=="Alt"&&o.key!=="Control"&&o.key!=="CapsLock"&&!o.ctrlKey&&!o.shiftKey&&!o.metaKey&&!o.altKey&&!/^F\d{1,2}$/.test(o.key)){!Jt()&&c&&!i&&(typeof e.wysiwyg.lastHTMLs[c.getAttribute("data-node-id")]=="undefined"||l.toString()!==""||!this.preventKeyup)&&Xg(c,l,e),this.preventKeyup=!1;return}if(this.preventKeyup){this.preventKeyup=!1;return}if((o.shiftKey||je(o))&&!o.isComposing&&l.toString()!==""&&(e.toolbar.render(e,l,o),du(l)),o.eventPhase!==3&&!o.shiftKey&&(o.key.indexOf("Arrow")>-1||o.key==="Home"||o.key==="End"||o.key==="PageUp"||o.key==="PageDown")&&!o.isComposing){if(c&&(si(["img","av"],e.wysiwyg.element),this.setEmptyOutline(e,c),l.toString()===""&&!c.classList.contains("protyle-wysiwyg--select")&&du(l,e.block.rootID),e.breadcrumb)){const d=e.breadcrumb.element.parentElement.querySelector('[data-type="indent"]');if(d){const u=e.breadcrumb.element.parentElement.querySelector('[data-type="outdent"]');c.parentElement.classList.contains("li")?(d.removeAttribute("disabled"),u.removeAttribute("disabled")):(d.setAttribute("disabled","true"),u.setAttribute("disabled","true"))}}o.stopPropagation()}if((o.key==="ArrowLeft"||o.key==="ArrowRight")&&c&&!c.classList.contains("protyle-wysiwyg--select")){const d=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));let u=!1;d.find(g=>{if(g.contains(l.startContainer))return u=!0,!0}),!u&&d.length>0&&(d.forEach(g=>{g.classList.remove("protyle-wysiwyg--select")}),c.classList.add("protyle-wysiwyg--select"))}}),this.element.addEventListener("dblclick",o=>{var l;if(o.target.tagName==="IMG"&&!o.target.classList.contains("emoji")){LS(o.target.getAttribute("src"),e.block.rootID);return}const c=ue(o.target,"data-type","a")||N(o.target,"av__celltext--url");if(c){let d=c.getAttribute("data-href")||"";if(!d&&c.classList.contains("av__celltext--url")&&(d=c.textContent.trim(),c.classList.contains("b3-chip")&&(d=c.dataset.url)),d&&jM(d)){o.stopPropagation(),o.preventDefault(),(l=window.getSelection())==null||l.removeAllRanges(),Lf(e,d,o,!1,!0);return}}});let r=!1;this.element.addEventListener("click",o=>{if(this.preventClick){this.preventClick=!1;return}e.app.plugins.forEach(H=>{H.eventBus.emit("click-editorcontent",{protyle:e,event:o})}),Ut(["hint","util"],e);const l=je(o),c=N(o.target,"protyle-breadcrumb__item");if(c){const H=c.getAttribute("data-id");H?l&&!o.shiftKey&&!o.altKey?na(H,j=>{dn({app:e.app,id:H,action:j?[p.CB_GET_FOCUS,p.CB_GET_ALL]:[p.CB_GET_FOCUS,p.CB_GET_CONTEXT],zoomIn:j})}):OF(e,c):RF(c),o.stopPropagation();return}this.setEmptyOutline(e,o.target);const d=N(o.target,"table");this.element.querySelectorAll(".table").forEach(H=>{H.tagName==="DIV"&&((!d||H!==d)&&H.querySelector(".table__select").removeAttribute("style"),d&&d===H&&H.querySelector(".table__select").getAttribute("style")&&o.stopPropagation())}),e.options.render.breadcrumb&&e.breadcrumb.render(e,!1,oe(o.target));const u=hn(this.element);u.startContainer.nodeType!==3&&u.startContainer.classList.contains("protyle-action")&&u.startContainer.parentElement.classList.contains("code-block")&&uu(u.startContainer.parentElement.querySelector(".hljs").lastElementChild,u);const g=ue(o.target,"data-type","a")||N(o.target,"av__celltext--url");let f=g&&g.getAttribute("data-href")||"";g&&!f&&g.classList.contains("av__celltext--url")&&(f=g.textContent.trim(),g.dataset.type==="phone"?f="tel:"+f:g.dataset.type==="email"?f="mailto:"+f:g.classList.contains("b3-chip")&&(f=g.dataset.url));const h=ue(o.target,"data-type","block-ref");if((h||f.startsWith("siyuan://blocks/"))&&(o.stopPropagation(),o.preventDefault(),Ut(["dialog","toolbar"],e),u.toString()===""||o.shiftKey)){let H;if(h?H=h.getAttribute("data-id"):g&&(H=f.substring(16,38)),na(H,(j,re,Te)=>{Te||re.push(p.CB_GET_HL),o.shiftKey?(dn({app:e.app,id:H,position:"bottom",action:re,zoomIn:j}),window.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"}))):o.altKey?dn({app:e.app,id:H,position:"right",action:re,zoomIn:j}):dn(l?{app:e.app,id:H,keepCursor:!0,action:j?[p.CB_GET_HL,p.CB_GET_ALL]:[p.CB_GET_HL,p.CB_GET_CONTEXT,p.CB_GET_ROOTSCROLL],zoomIn:j}:{app:e.app,id:H,action:re,zoomIn:j})}),e.model){let j;h?j=oe(h):g&&(j=oe(g)),j&&Hf(e,hn(this.element),j)}return}const m=ue(o.target,"data-type","file-annotation-ref");if(m&&u.toString()===""){o.stopPropagation(),o.preventDefault(),Lf(e,m.getAttribute("data-id"),o,l);return}if(g&&(o.shiftKey||u.toString()==="")&&f){o.stopPropagation(),o.preventDefault(),Lf(e,f,o,l);return}if(g&&g.classList.contains("av__celltext--url")&&!f){let H=0;Array.from(g.parentElement.children).find((j,re)=>{if(j===g)return H=re,!0}),o_({protyle:e,cellElements:[g.parentElement],blockElement:oe(g),content:g.getAttribute("data-url"),type:"file",name:g.getAttribute("data-name"),index:H,rect:g.getBoundingClientRect()});return}const b=ue(o.target,"data-type","tag");if(b&&!o.altKey&&!o.shiftKey&&u.toString()===""){Ro(e.app,`#${b.textContent}#`,!l,{method:0}),Ut(["dialog"]);return}const y=N(o.target,"protyle-wysiwyg__embed");if(y){const H=y.getAttribute("data-id");if(na(H,(j,re)=>{o.shiftKey?dn({app:e.app,id:H,position:"bottom",action:re,zoomIn:j}):o.altKey?dn({app:e.app,id:H,position:"right",action:re,zoomIn:j}):l?dn({app:e.app,id:H,action:j?[p.CB_GET_HL,p.CB_GET_ALL]:[p.CB_GET_HL,p.CB_GET_CONTEXT],zoomIn:j,keepCursor:!0}):e.disabled||window.siyuan.blockPanels.push(new Vg({app:e.app,targetElement:y,isBacklink:!1,refDefs:[{refID:H}]}))}),!l){o.stopPropagation();return}}if(xL(o,e)||me(o.target,"protyle-action__copy"))return;const _=N(o.target,"protyle-action__edit");if(_&&!e.disabled){e.toolbar.showRender(e,_.parentElement.parentElement),o.stopPropagation(),o.preventDefault();return}const v=N(o.target,"protyle-action__menu");if(v){e.gutter.renderMenu(e,v.parentElement.parentElement);const H=v.getBoundingClientRect();window.siyuan.menus.menu.popup({x:H.left,y:H.top,isLeft:!0}),o.stopPropagation(),o.preventDefault();return}const U=N(o.target,"protyle-action__reload");if(U){const H=ge(U);if(H)H.removeAttribute("data-render"),$n(e,H);else{const j=oe(U);j&&j.getAttribute("data-subtype")==="echarts"&&(j.removeAttribute("data-render"),df(j))}o.stopPropagation(),o.preventDefault();return}const ee=N(o.target,"protyle-action__language");if(ee&&!e.disabled&&!l){e.toolbar.showCodeLanguage(e,[ee]),o.stopPropagation(),o.preventDefault();return}const Z=ue(o.target,"data-subtype","math");if(!o.shiftKey&&!l&&Z&&!e.disabled){e.toolbar.showRender(e,Z),o.stopPropagation();return}const k=N(o.target,"protyle-action");if(k){if(k.parentElement.parentElement.getAttribute("data-type")==="img"&&!e.disabled){Kv(e,u,k.parentElement.parentElement,{clientX:o.clientX+4,clientY:o.clientY}),o.stopPropagation();return}else if(k.parentElement.classList.contains("li")){const j=k.parentElement.getAttribute("data-node-id");if(o.altKey&&!e.disabled){if(k.parentElement.parentElement.classList.contains("protyle-wysiwyg"))La(e,k.parentElement);else{let re=!0;const Te=k.parentElement.parentElement.outerHTML;Array.from(k.parentElement.parentElement.children).find(Be=>{if(Be.classList.contains("li")&&Be.getAttribute("fold")!=="1"&&Be.childElementCount>3)return re=!1,!0}),Array.from(k.parentElement.parentElement.children).find(Be=>{Be.classList.contains("li")&&(re?Be.removeAttribute("fold"):Be.childElementCount>3&&Be.setAttribute("fold","1"))}),Ht(e,k.parentElement.parentElement.getAttribute("data-node-id"),k.parentElement.parentElement.outerHTML,Te)}Ut(["gutter"],e)}else if(o.shiftKey&&!e.disabled)Ho(k.parentElement,"bookmark",e);else if(l)hi({protyle:e,id:j});else if(k.classList.contains("protyle-action--task")){if(!e.disabled){const re=k.parentElement.outerHTML;k.parentElement.classList.contains("protyle-task--done")?(k.querySelector("use").setAttribute("xlink:href","#iconUncheck"),k.parentElement.classList.remove("protyle-task--done")):(k.querySelector("use").setAttribute("xlink:href","#iconCheck"),k.parentElement.classList.add("protyle-task--done")),k.parentElement.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(e,j,k.parentElement.outerHTML,re)}}else window.siyuan.config.editor.listItemDotNumberClickFocus&&(e.block.showAll&&e.block.id===j?jv(e,j):hi({protyle:e,id:j}));o.stopPropagation();return}}const w=N(o.target,"hr")||N(o.target,"iframe");if(!o.shiftKey&&!l&&w){w.classList.add("protyle-wysiwyg--select"),EL(o.target),o.stopPropagation();return}const S=me(o.target,"img");if(!o.shiftKey&&!l&&S){S.classList.add("img--select");const H=_t(S);H&&(H.textContent.startsWith(p.ZWSP)?u.setStart(H,1):u.setStart(H,0),u.collapse(!0),Pt(u),e.options.render.breadcrumb&&e.breadcrumb.render(e));return}const B=me(o.target,"emoji");if(!e.disabled&&!o.shiftKey&&!l&&B){const H=oe(B);if(H){const j=B.getBoundingClientRect();Va("","av",{x:j.left,y:j.bottom,h:j.height,w:j.width},re=>{B.insertAdjacentHTML("afterend","<wbr>");const Te=H.outerHTML;let Be;if(re.startsWith("api/icon/getDynamicIcon"))Be=`<img class="emoji" src="${re}"/>`;else if(re.indexOf(".")>-1){const Ie=re.split(".");Be=`<img alt="${Ie[0]}" class="emoji" src="/emojis/${re}" title="${Ie[0]}">`}else Be=Yt(re);B.outerHTML=Be,Ut(["dialog"]),Ht(e,H.getAttribute("data-node-id"),H.outerHTML,Te),cn(H,u)},B)}return}rF(e,o)||(setTimeout(()=>{var H;let j=hn(this.element);if(oe(o.target)!==oe(j.startContainer)&&((H=this.element.querySelector("[data-node-id]"))!=null&&H.contains(j.startContainer))){const Be=this.element.getBoundingClientRect();let Ie=document.elementFromPoint(Be.left+Be.width/2,o.clientY);Ie===this.element&&(Ie=document.elementFromPoint(Be.left+Be.width/2,o.clientY+8));let Ce=oe(Ie);if(Ce){const Je=ge(Ce);Je&&(Ce=Je),j=qt(Ce,void 0,o.clientX<Be.left+parseInt(this.element.style.paddingLeft))||j,e.options.render.breadcrumb&&e.breadcrumb.render(e,!1,Ce)}}const re=N(j.endContainer,"protyle-attr");re&&(j=qa(re.previousElementSibling,j,!1));const Te=ue(j.startContainer,"data-type","inline-math");Te&&(j.setEndAfter(Te),j.collapse(!1),Pt(j)),j.toString().replace(p.ZWSP,"")!==""?e.toolbar.render(e,j):e.toolbar.range=j,e.wysiwyg.element.querySelector(".protyle-wysiwyg--select")||du(j,e.block.rootID),getSelection().rangeCount===0&&!r&&Pt(j),Hf(e,j),r=!1},x()||Xt()?520:0),e.hint.enableExtend=!1,this.element.querySelector(".protyle-wysiwyg--select")&&u.toString()!==""&&(u.collapse(!1),Pt(u)))})}}class RW{constructor(){this.element=document.createElement("div"),this.element.className="protyle-toolbar__divider"}}var UW=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class HW extends Md{constructor(e,n){super(e,n),this.element.addEventListener("click",a=>UW(this,null,function*(){e.toolbar.element.classList.add("fn__none"),a.stopPropagation();const i=e.toolbar.range;if(!oe(i.startContainer))return;const r=ue(i.startContainer,"data-type","a");if(r){Df(e,r);return}let o="",l=i.toString().trim().replace(p.ZWSP,""),c=!1;try{if(o=e.lute.GetLinkDest(l),!o){const u=yield nt(),g=u.textHTML||e.lute.Md2BlockDOM(u.textPlain);if(g){const f=document.createElement("template");f.innerHTML=g;const h=f.content.querySelector('span[data-type~="a"], a');h&&(l=l||h.textContent,o=h.getAttribute("data-href")||h.getAttribute("href"))}if(o||(o=e.lute.GetLinkDest(u.textPlain)),!o){const f=u.textPlain.lastIndexOf(" ");f>-1&&(o=e.lute.GetLinkDest(u.textPlain.substring(f)),o&&!l&&(l=u.textPlain.substring(0,f)))}!o&&u.textPlain.startsWith("assets/")&&(o=u.textPlain),o&&!l&&(l=decodeURIComponent(o.replace("https://","").replace("http://","")),o.length>p.SIZE_LINK_TEXT_MAX&&(l=o.substring(0,p.SIZE_LINK_TEXT_MAX)+"..."),c=!0)}}catch(u){console.log(u)}const d=e.toolbar.setInlineMark(e,"a","range",{type:"a",color:o+(l?p.ZWSP+l:"")});c&&Df(e,d[0],!0)}))}}class qW extends Md{constructor(e,n){super(e,n),this.element.addEventListener("click",a=>{e.toolbar.range.toString()!==""&&(FE(e.toolbar.range),ic(e.toolbar.range.toString(),e,"search"),e.toolbar.element.classList.add("fn__none"),a.stopPropagation())})}}var WW=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class VW extends Md{constructor(e,n){super(e,n),this.element.addEventListener("click",a=>WW(this,null,function*(){e.toolbar.element.classList.add("fn__none"),a.stopPropagation();const i=e.toolbar.range;if(!oe(i.startContainer))return;let r=ue(i.startContainer,"data-type","inline-math");if(!r&&i.startContainer.nodeType!==3&&i.startContainer.childNodes[i.startOffset]){const o=zt(i.startContainer.childNodes[i.startOffset]);o&&o.nodeType!==3&&o.getAttribute("data-type").indexOf("inline-math")>-1&&(r=o)}if(!r&&i.startOffset===i.startContainer.textContent.length&&i.startContainer.nodeType===3){let o=!0,l=!1;if(i.cloneContents().childNodes.forEach(c=>{c.nodeType!==3&&(c.getAttribute("data-type")||"").indexOf("inline-math")>-1||c.nodeType==3&&c.textContent===""?l=!0:o=!1}),o&&l){const c=_t(i.startContainer);if(c&&c.nodeType!==3&&c.getAttribute("data-type").indexOf("inline-math")>-1)r=c;else{const d=zt(i.startContainer);i.startOffset===0&&d&&d.nodeType!==3&&d.getAttribute("data-type").indexOf("inline-math")>-1&&(r=d)}}}if(r){e.toolbar.showRender(e,r);return}e.toolbar.setInlineMark(e,"inline-math","range",{type:"inline-math"})}))}}var zW=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class YW extends Md{constructor(e,n){super(e,n),this.element.addEventListener("click",a=>zW(this,null,function*(){e.toolbar.element.classList.add("fn__none"),a.stopPropagation();const i=e.toolbar.range;if(!oe(i.startContainer))return;const r=ue(i.startContainer,"data-type","inline-memo");if(r&&r.textContent===i.toString()){e.toolbar.showRender(e,r);return}i.toString()!==""&&e.toolbar.setInlineMark(e,"inline-memo","range",{type:"inline-memo"})}))}}var GW=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class jW{constructor(e){const n=e.options,a=document.createElement("div");a.className="protyle-toolbar fn__none",this.element=a,this.subElement=document.createElement("div"),this.subElement.className="protyle-util fn__none",this.toolbarHeight=29,e.app.plugins.forEach(i=>{const s=i.updateProtyleToolbar(n.toolbar);s.forEach(r=>{typeof r=="string"||p.INLINE_TYPE.concat("|").includes(r.name)||!r.hotkey||window.siyuan.config.keymap.plugin&&window.siyuan.config.keymap.plugin[i.name]&&window.siyuan.config.keymap.plugin[i.name][r.name]&&(r.hotkey=window.siyuan.config.keymap.plugin[i.name][r.name].custom)}),n.toolbar=e_(s)}),n.toolbar.forEach(i=>{const s=this.genItem(e,i);this.element.appendChild(s)})}update(e){this.element.innerHTML="",e.options.toolbar=e_(p.PROTYLE_TOOLBAR),e.app.plugins.forEach(n=>{const a=n.updateProtyleToolbar(e.options.toolbar);a.forEach(i=>{typeof i=="string"||p.INLINE_TYPE.concat("|").includes(i.name)||!i.hotkey||window.siyuan.config.keymap.plugin&&window.siyuan.config.keymap.plugin[n.name]&&window.siyuan.config.keymap.plugin[n.name][i.name]&&(i.hotkey=window.siyuan.config.keymap.plugin[n.name][i.name].custom)}),e.options.toolbar=e_(a)}),e.options.toolbar.forEach(n=>{const a=this.genItem(e,n);this.element.appendChild(a)})}render(e,n,a){this.range=n;let i=oe(n.startContainer);if(x()||!i||e.disabled||i.classList.contains("av")){this.element.classList.add("fn__none");return}let s=!1;if(Array.from(n.cloneContents().childNodes).find(u=>{if(u.textContent.length>0&&u.textContent!==p.ZWSP&&!(u.nodeType===1&&u.classList.contains("img")))return s=!0,!0}),!s||n.commonAncestorContainer.nodeType!==3&&n.commonAncestorContainer.classList.contains("img")){this.element.classList.add("fn__none");return}const r=oe(n.startContainer),o=oe(n.endContainer);if(r&&o&&r!==o){if(a)if(a.key==="ArrowLeft")this.range=qa(Ee(r),n,!1);else if(a.key==="ArrowRight")this.range=uu(Ee(o),n),this.range.collapse(!1);else if(a.key==="ArrowUp"){if(this.range=uu(Ee(o),n),i=oe(o),!i)return}else a.key==="ArrowDown"&&(this.range=qa(Ee(r),n,!1));else this.range=qa(Ee(i),n,!1);if(Pt(this.range),this.range.toString()===""){this.element.classList.add("fn__none");return}}if(i.getAttribute("data-type")==="NodeCodeBlock"){this.element.classList.add("fn__none");return}const l=Dr(i,n,!0);this.element.classList.remove("fn__none"),this.toolbarHeight=this.element.clientHeight;const c=l.isBottom?Math.min(l.top+4,e.element.getBoundingClientRect().bottom-this.toolbarHeight):Math.max(l.top-this.toolbarHeight-4,e.element.getBoundingClientRect().top+30);this.element.setAttribute("data-inity",c+p.ZWSP+e.contentElement.scrollTop.toString()),gn(this.element,l.left-this.element.clientWidth/4,c),this.element.querySelectorAll(".protyle-toolbar__item--current").forEach(u=>{u.classList.remove("protyle-toolbar__item--current")}),this.getCurrentType().forEach(u=>{if(["search-mark","a","block-ref","virtual-block-ref","text","file-annotation-ref","inline-math","inline-memo","","backslash"].includes(u))return;const g=this.element.querySelector(`[data-type="${u}"]`);g&&g.classList.add("protyle-toolbar__item--current")})}getCurrentType(e=this.range){var n,a;let i=[],s=e.startContainer;if(s.nodeType===3?s=s.parentElement:s.childElementCount>0&&((n=s.childNodes[e.startOffset])==null?void 0:n.nodeType)!==3&&(s=s.childNodes[e.startOffset],(s==null?void 0:s.tagName)==="WBR"&&(s=s.parentElement)),!s||s.nodeType===3)return[];["DIV","TD","TH","TR"].includes(s.tagName)||(i=(s.getAttribute("data-type")||"").split(" "));let r=e.endContainer;return r.nodeType===3?r=r.parentElement:r.childElementCount>0&&((a=r.childNodes[e.endOffset])==null?void 0:a.nodeType)!==3&&(r=r.childNodes[e.endOffset]),i.length===0&&(!r||r.nodeType===3)?[]:(r&&!["DIV","TD","TH","TR"].includes(r.tagName)&&s!==r&&(i=i.concat((r.getAttribute("data-type")||"").split(" "))),e.cloneContents().childNodes.forEach(o=>{o.nodeType!==3&&(i=i.concat((o.getAttribute("data-type")||"").split(" ")))}),i=[...new Set(i)],i.find((o,l)=>{if(o==="")return i.splice(l,1),!0}),i)}setInlineMark(e,n,a,i){const s=oe(this.range.startContainer);if(!s||s.getAttribute("data-type")==="NodeCodeBlock")return;const r=oe(this.range.endContainer);if(!r)return;s!==r&&(this.range=qa(Ee(s),this.range,!1));let o=[];this.range.cloneContents().childNodes.forEach(w=>{w.nodeType!==3&&(o=o.concat((w.getAttribute("data-type")||"").split(" ")))});let l=_t(this.range.startContainer);for(;l&&l.nodeType===1&&l.tagName==="BR";)l=_t(l);const c=this.range.startContainer===this.range.endContainer||l&&l===this.range.endContainer&&this.range.startContainer.parentElement===this.range.endContainer.parentElement;this.range.startContainer.nodeType===3&&this.range.startContainer.parentElement.tagName==="SPAN"&&c&&this.range.startOffset>-1&&this.range.endOffset<=this.range.endContainer.textContent.length&&(o=o.concat((this.range.startContainer.parentElement.getAttribute("data-type")||"").split(" ")));const d=this.range.toString();let u=!1;if(!d&&this.range.startOffset===1&&this.range.startContainer.textContent===p.ZWSP){let w;this.range.startContainer.nodeType===1?w=this.range.startContainer:w=this.range.startContainer.parentElement,w.tagName==="SPAN"&&(o=o.concat((w.getAttribute("data-type")||"").split(" ")),this.range.setStart(w.firstChild,0),this.range.setEnd(w.lastChild,w.lastChild.textContent.length||0),u=!0)}if(o.length===1&&["block-ref","virtual-block-ref","file-annotation-ref","a","inline-memo","inline-math","tag"].includes(o[0])&&n==="clear")return;if(o.includes("text")&&n==="text"&&i&&this.range.startContainer.nodeType===3&&this.range.startContainer===this.range.endContainer){const w=this.range.startContainer.parentElement;if(w&&oS(null,w,i))return}FE(this.range);let g,f,h;if(this.range.startContainer.nodeType===3&&this.range.startContainer.parentElement.tagName==="SPAN"&&c){this.range.startOffset>-1&&this.range.endOffset<=this.range.endContainer.textContent.length&&(h=this.range.startContainer.parentElement);const w=zt(this.range.startContainer),S=_t(this.range.endContainer);if((this.range.startOffset!==0||this.range.startOffset===0&&w&&(w.nodeType===3||w.tagName==="BR")&&this.range.startContainer.previousSibling.parentElement===this.range.startContainer.parentElement)&&(this.range.endOffset!==this.range.endContainer.textContent.length||this.range.endOffset===this.range.endContainer.textContent.length&&S&&(S.nodeType===3||S.tagName==="BR")&&this.range.endContainer.nextSibling.parentElement===this.range.endContainer.parentElement)&&!(this.range.startOffset===1&&this.range.startContainer.textContent.startsWith(p.ZWSP))){const B=this.range.startContainer.parentElement,H=document.createElement("span"),j=B.attributes;for(let re=0;re<j.length;re++)H.setAttribute(j[re].name,j[re].value);this.range.insertNode(document.createElement("wbr")),f=s.outerHTML,g=this.range.extractContents(),this.range.setEnd(B.lastChild,B.lastChild.textContent.length),H.append(this.range.extractContents()),B.after(H),this.range.setStartBefore(H),this.range.collapse(!0)}}let m=!1;if(this.range.endOffset===this.range.startContainer.textContent.length&&!["DIV","TD","TH","TR"].includes(this.range.endContainer.parentElement.tagName)&&!_t(this.range.endContainer)&&(this.range.setEndAfter(this.range.endContainer.parentElement),m=!0),this.range.startOffset===0&&!["DIV","TD","TH","TR"].includes(this.range.startContainer.parentElement.tagName)&&!zt(this.range.startContainer)&&this.range.setStartBefore(this.range.startContainer.parentElement),f||(this.range.insertNode(document.createElement("wbr")),f=s.outerHTML,g=this.range.extractContents()),this.mergeNode(g.childNodes),g.childNodes.forEach(w=>{w.nodeType===3&&w.textContent===p.ZWSP&&w.remove(),w.nodeType===1&&w.textContent===""&&w.tagName==="SPAN"&&w.remove()}),d&&this.range.startContainer.nodeType!==3){let w=this.range.startContainer.childNodes[this.range.startOffset];w||(w=this.range.startContainer.childNodes[this.range.startOffset-1]),w&&w.nodeType===3&&(this.range.startContainer.tagName==="DIV"?w=w.previousSibling:w=this.range.startContainer),w&&w.nodeType!==3&&w.textContent.replace(p.ZWSP,"")===""&&!["TD","TH","BR"].includes(w.tagName)&&w.remove()}if(h){const w=h.attributes;g.childNodes.forEach(S=>{if(S.nodeType===3){const B=document.createElement("span");for(let H=0;H<w.length;H++)B.setAttribute(w[H].name,w[H].value);B.innerHTML=S.textContent,S.replaceWith(B)}})}const b=x()?document.querySelector("#keyboardToolbar .keyboard__dynamic").nextElementSibling:this.element,y=a==="toolbar"?b.querySelector(`[data-type="${n}"]`):void 0,_=[];let v,U,ee,Z;if(n==="clear"||y!=null&&y.classList.contains("protyle-toolbar__item--current")||a==="range"&&o.length>0&&o.includes(n)&&!i){if(n==="clear"?b.querySelectorAll('[data-type="strong"],[data-type="em"],[data-type="u"],[data-type="s"],[data-type="mark"],[data-type="sup"],[data-type="sub"],[data-type="kbd"],[data-type="mark"],[data-type="code"]').forEach(w=>{w.classList.remove("protyle-toolbar__item--current")}):y&&y.classList.remove("protyle-toolbar__item--current"),g.childNodes.length===0){if(o.find((w,S)=>{if(n===w)return o.splice(S,1),!0}),o.length===0||n==="clear")_.push(document.createTextNode(p.ZWSP)),v=_[0];else{let w=0;for(;w<o.length;)["inline-memo","text","block-ref","virtual-block-ref","file-annotation-ref","a"].includes(o[w])?o.splice(w,1):++w;const S=document.createElement("span");S.setAttribute("data-type",o.join(" ")),S.textContent=p.ZWSP,_.push(S),v=_[0].firstChild}u=!0,ee=1}g.childNodes.forEach(w=>{if(w.nodeType!==3&&w.tagName!=="BR"&&w.tagName!=="IMG"&&!w.classList.contains("img")){const S=(w.getAttribute("data-type")||"").split(" ");if(n==="clear")for(let B=0;B<S.length;B++)i&&i.type==="text"?S[B]==="text"&&(S.splice(B,1),B--):["kbd","text","strong","em","u","s","mark","sup","sub","code"].includes(S[B])&&(S.splice(B,1),B--);else S.find((B,H)=>{if(n===B)return S.splice(H,1),!0});S.length===0?_.push(document.createTextNode(w.textContent)):(n==="clear"&&(w.style.color="",w.style.webkitTextFillColor="",w.style.webkitTextStroke="",w.style.textShadow="",w.style.backgroundColor="",w.style.fontSize=""),w.setAttribute("data-type",S.join(" ")),_.push(w))}else _.push(w)})}else if(!this.element.classList.contains("fn__none")&&n!=="text"&&y&&y.classList.add("protyle-toolbar__item--current"),d===""){const w=document.createElement("span");if(o.push(n),m){let S=0;for(;S<o.length;)["inline-memo","text","block-ref","virtual-block-ref","file-annotation-ref","a"].includes(o[S])?o.splice(S,1):++S;o.length===0&&o.push(n)}w.setAttribute("data-type",[...new Set(o)].join(" ")),w.textContent=p.ZWSP,Pv(w,i),_.push(w),u=!0}else{if(n==="block-ref")for(;g.childNodes.length>1;)g.childNodes[0].remove();g.childNodes.forEach(w=>{let S="";if(w.nodeType===3&&w.textContent){for(;w.textContent.endsWith(`
`);)w.textContent=w.textContent.substring(0,w.textContent.length-1),S+=`
`;if(w.textContent){const B=document.createElement("span");B.setAttribute("data-type",n),B.textContent=w.textContent,n==="a"&&(B.textContent||(B.textContent="*"),i.color=i.color.split(p.ZWSP)[0]),Pv(B,i),n==="text"&&!B.getAttribute("style")?_.push(w):_.push(B)}}else if(w.nodeType===1){let B=(w.getAttribute("data-type")||"").split(" ");for(let H=0;H<B.length;H++)["backslash","virtual-block-ref","search-mark"].includes(B[H])&&(B.splice(H,1),H--);if(B.includes("img")||B.push(n),n==="sub"&&B.includes("sup")?B.find((H,j)=>{if(H==="sup")return B.splice(j,1),b.querySelector('[data-type="sup"]').classList.remove("protyle-toolbar__item--current"),!0}):n==="sup"&&B.includes("sub")?B.find((H,j)=>{if(H==="sub")return B.splice(j,1),b.querySelector('[data-type="sub"]').classList.remove("protyle-toolbar__item--current"),!0}):n==="block-ref"&&(B.includes("a")||B.includes("file-annotation-ref"))?B.find((H,j)=>{if(H==="a"||H==="file-annotation-ref")return B.splice(j,1),!0}):n==="a"&&(B.includes("block-ref")||B.includes("file-annotation-ref"))?B.find((H,j)=>{if(H==="block-ref"||H==="file-annotation-ref")return B.splice(j,1),!0}):n==="file-annotation-ref"&&(B.includes("block-ref")||B.includes("a"))?B.find((H,j)=>{if(H==="block-ref"||H==="a")return B.splice(j,1),!0}):n==="inline-memo"&&B.includes("inline-math")?(B.find((H,j)=>{if(H==="inline-math")return B.splice(j,1),!0}),w.querySelector(".katex")&&(w.textContent=w.getAttribute("data-content"))):n==="inline-math"&&B.includes("inline-memo")&&B.find((H,j)=>{if(H==="inline-memo")return B.splice(j,1),!0}),B=[...new Set(B)],w.tagName!=="BR"&&w.tagName!=="IMG"&&!B.includes("img"))if(w.setAttribute("data-type",B.join(" ")),n==="a"&&(w.textContent||(w.textContent="*"),i.color=i.color.split(p.ZWSP)[0]),Pv(w,i),B.includes("text")&&!w.getAttribute("style"))if(B.length===1){const H=document.createTextNode(w.textContent);_.push(H)}else B.splice(B.indexOf("text"),1),w.setAttribute("data-type",B.join(" ")),_.push(w);else _.push(w);else _.push(w)}S&&_.push(document.createTextNode(S))})}for(let w=_.length-1;w>-1;w--)this.range.insertNode(_[w]);if(_.length===1&&_[0].textContent===p.ZWSP&&(this.range.setStart(_[0],1),this.range.collapse(!0),_[0].nodeType!==3)){const w=(_[0].getAttribute("data-type")||"").split(" ");(w.includes("code")||w.includes("tag")||w.includes("kbd"))&&(u=!1)}if(!u){for(let w=0;w<=_.length;w++){let S=w===_.length?_[w-1]:zt(_[w]);S.nodeType===3&&S.textContent===p.ZWSP&&(S=zt(S),S&&S.nextSibling.remove());let B=_[w];if(B||(B=_t(_[w-1]),B&&B.nodeType===3&&B.textContent===p.ZWSP&&(B=_t(B),B&&B.previousSibling.remove())),B&&B.nodeType!==3){const H=(B.getAttribute("data-type")||"").split(" ");if(B.tagName!=="BR"&&S&&S.nodeType!==3&&B.nodeType!==3&&L(H,(S.getAttribute("data-type")||"").split(" "))&&oS(B,S)&&((H.includes("code")||H.includes("tag")||H.includes("kbd"))&&B.textContent.startsWith(p.ZWSP)&&(B.textContent=B.textContent.substring(1)),H.includes("inline-math")?B.setAttribute("data-content",S.getAttribute("data-content")+B.getAttribute("data-content")):H.includes("block-ref")&&S.getAttribute("data-id")===B.getAttribute("data-id")?(S.dataset.subtype!=="d"||S.dataset.subtype!=="d")&&(B.setAttribute("data-subtype","s"),B.textContent=S.textContent+B.textContent):(B.textContent=S.innerText+B.innerText,H.includes("inline-memo")&&B.setAttribute("data-inline-memo-content",(S.getAttribute("data-inline-memo-content")||"")+(B.getAttribute("data-inline-memo-content")||""))),H.includes("inline-math")||(w===0?(v=B,ee=S.textContent.length):w===_.length&&(U=B,Z=S.textContent.length,v?v===S&&(v=B):v=B)),S.remove(),w>0&&(_.splice(w-1,1),w--),_.length===0)){_.push(B);break}}}for(let w=0;w<=_.length;w++){const S=w===_.length?_[w-1]:zt(_[w]);let B=_[w];if(B||(B=_t(_[w-1])),!B){if(S.nodeType!==3){const H=(S.getAttribute("data-type")||"").split(" ");(H.includes("code")||H.includes("tag")||H.includes("kbd"))&&S.insertAdjacentText("afterend",p.ZWSP)}break}if(B.nodeType===3)if(S&&S.nodeType===3)B.textContent.startsWith(p.ZWSP)&&(B.textContent=B.textContent.substring(1)),S.textContent.endsWith(p.ZWSP)&&(S.textContent=S.textContent.substring(0,S.textContent.length-2));else{const H=S?(S.getAttribute("data-type")||"").split(" "):[];H.includes("code")||H.includes("tag")||H.includes("kbd")?B.textContent.startsWith(p.ZWSP)||(B.textContent=p.ZWSP+B.textContent):B.textContent.startsWith(p.ZWSP)&&(B.textContent=B.textContent.substring(1))}else{const H=B.nodeType===3?[]:(B.getAttribute("data-type")||"").split(" ");if(H.includes("code")||H.includes("tag")||H.includes("kbd")?(B.textContent.startsWith(p.ZWSP)||B.insertAdjacentText("afterbegin",p.ZWSP),(!S||S.nodeType===3&&S.textContent.endsWith(`
`))&&B.insertAdjacentText("beforebegin",p.ZWSP)):B.textContent.startsWith(p.ZWSP)&&(B.textContent=B.textContent.substring(1)),S&&S.nodeType!==3){const j=(S.getAttribute("data-type")||"").split(" ");(j.includes("code")||j.includes("tag")||j.includes("kbd"))&&B.insertAdjacentText("beforebegin",p.ZWSP)}}}}s.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(e,s.getAttribute("data-node-id"),s.outerHTML,f),s.querySelectorAll("wbr").forEach(w=>{w.remove()}),v&&typeof ee=="number"&&(v.nodeType===3?this.range.setStart(v,ee):this.range.setStart(v.firstChild,ee)),U&&typeof Z=="number"&&(U.nodeType===3?this.range.setEnd(U,Z):this.range.setEnd(U.firstChild,Z)),Pt(this.range);const k=_[0];if(k.nodeType!==3){const w=(k.getAttribute("data-type")||"").split(" ");n==="inline-math"?(Ei(s),d===""&&w.includes("inline-math")&&e.toolbar.showRender(e,k,void 0,f)):n==="inline-memo"?!k.getAttribute("data-inline-memo-content")&&w.includes("inline-memo")&&e.toolbar.showRender(e,k,_,f):n==="a"&&w.includes("a")&&(k.textContent.replace(p.ZWSP,"")===""||!k.getAttribute("data-href"))&&Df(e,k,!!k.getAttribute("data-href"))}return _}showRender(e,n,a,i){var s;const r=oe(n);if(!r)return;Ut(["hint"],e),window.siyuan.menus.menu.remove();const o=r.getAttribute("data-node-id"),l=(n.getAttribute("data-type")||"").split(" "),c=i||r.outerHTML;let d="HTML",u="";const g=l.includes("inline-memo");switch(n.getAttribute("data-subtype")){case"abc":d=window.siyuan.languages.staff;break;case"echarts":d=window.siyuan.languages.chart;break;case"flowchart":d="Flow Chart";break;case"graphviz":d="Graphviz";break;case"mermaid":d="Mermaid";break;case"mindmap":u=`- foo
  - bar
- baz`,d=window.siyuan.languages.mindmap;break;case"plantuml":d="UML";break;case"math":l.includes("NodeMathBlock")?d=window.siyuan.languages.math:d=window.siyuan.languages["inline-math"];break}l.includes("NodeBlockQueryEmbed")?d=window.siyuan.languages.blockEmbed:g&&(d=window.siyuan.languages.memo);const f=((s=this.subElement.querySelector('[data-type="pin"]'))==null?void 0:s.getAttribute("aria-label"))===window.siyuan.languages.unpin,h={};if(f){const ee=this.subElement.querySelector(".b3-text-field");h.styleH=ee.style.height,h.styleW=ee.style.width}else this.subElement.style.width="",this.subElement.style.padding="0";this.subElement.innerHTML=`<div ${f&&this.subElement.firstElementChild.getAttribute("data-drag")==="true"?'data-drag="true"':""}><div class="block__icons block__icons--menu fn__flex" style="border-radius: var(--b3-border-radius-b) var(--b3-border-radius-b) 0 0;">
    <span class="fn__flex-1 resize__move" style="line-height: 24px;">
        ${d}
    </span>
    <span class="fn__space"></span>
    <button data-type="refresh" class="block__icon block__icon--show b3-tooltips b3-tooltips__nw${f&&!this.subElement.querySelector('[data-type="refresh"]').classList.contains("block__icon--active")?"":" block__icon--active"}${l.includes("NodeBlockQueryEmbed")?" fn__none":""}" aria-label="${window.siyuan.languages.refresh}"><svg><use xlink:href="#iconRefresh"></use></svg></button>
    <span class="fn__space"></span>
    <button data-type="before" class="block__icon block__icon--show b3-tooltips b3-tooltips__nw${e.disabled?" fn__none":""}" aria-label="${window.siyuan.languages.insertBefore}"><svg><use xlink:href="#iconBefore"></use></svg></button>
    <span class="fn__space${e.disabled?" fn__none":""}"></span>
    <button data-type="after" class="block__icon block__icon--show b3-tooltips b3-tooltips__nw${e.disabled?" fn__none":""}" aria-label="${window.siyuan.languages.insertAfter}"><svg><use xlink:href="#iconAfter"></use></svg></button>
    <span class="fn__space${e.disabled?" fn__none":""}"></span>
    <button data-type="export" class="block__icon block__icon--show b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.export} ${window.siyuan.languages.image}"><svg><use xlink:href="#iconImage"></use></svg></button>
    <span class="fn__space"></span>
    <button data-type="pin" class="block__icon block__icon--show b3-tooltips b3-tooltips__nw" aria-label="${f?window.siyuan.languages.unpin:window.siyuan.languages.pin}"><svg><use xlink:href="#icon${f?"Unpin":"Pin"}"></use></svg></button>
    <span class="fn__space"></span>
    <button data-type="close" class="block__icon block__icon--show b3-tooltips b3-tooltips__nw" aria-label="${window.siyuan.languages.close}"><svg style="width: 10px;margin: 0 2px;"><use xlink:href="#iconClose"></use></svg></button>
</div>
<textarea ${e.disabled?" readonly":""} spellcheck="false" class="b3-text-field b3-text-field--text fn__block" placeholder="${u}" style="${x()?"":"width:"+Math.max(480,n.clientWidth*.7)+"px"};max-height:calc(80vh - 44px);min-height: 48px;min-width: 268px;border-radius: 0 0 var(--b3-border-radius-b) var(--b3-border-radius-b);font-family: var(--b3-font-family-code);"></textarea></div>`;const m=()=>{if(_.style.height=_.scrollHeight+"px",x()){gn(this.subElement,0,0);return}if(this.subElement.firstElementChild.getAttribute("data-drag")==="true"){_.getBoundingClientRect().bottom>window.innerHeight&&(this.subElement.style.top=window.innerHeight-this.subElement.clientHeight+"px");return}const ee=U.bottom===U.top?U.bottom+26:U.bottom;this.subElement.clientHeight<=window.innerHeight-ee||this.subElement.clientHeight<=U.top?l.includes("inline-math")||g?gn(this.subElement,U.left,ee,U.height||26):gn(this.subElement,U.left+(U.width-this.subElement.clientWidth)/2,ee,U.height||26):gn(this.subElement,U.right,ee)},b=this.subElement.querySelector(".block__icons");b.addEventListener("click",ee=>{const Z=ee.target,k=N(Z,"b3-tooltips");if(!k){if(ee.detail===2){const w=b.querySelector('[data-type="pin"]');w.getAttribute("aria-label")===window.siyuan.languages.unpin?(w.querySelector("svg use").setAttribute("xlink:href","#iconPin"),w.setAttribute("aria-label",window.siyuan.languages.pin)):(w.querySelector("svg use").setAttribute("xlink:href","#iconUnpin"),w.setAttribute("aria-label",window.siyuan.languages.unpin)),ee.preventDefault(),ee.stopPropagation()}return}switch(ee.stopPropagation(),k.getAttribute("data-type")){case"close":this.subElement.querySelector('[data-type="pin"]').setAttribute("aria-label",window.siyuan.languages.pin),Ut(["util"],e);break;case"pin":k.getAttribute("aria-label")===window.siyuan.languages.unpin?(k.querySelector("svg use").setAttribute("xlink:href","#iconPin"),k.setAttribute("aria-label",window.siyuan.languages.pin)):(k.querySelector("svg use").setAttribute("xlink:href","#iconUnpin"),k.setAttribute("aria-label",window.siyuan.languages.unpin));break;case"refresh":k.classList.toggle("block__icon--active");break;case"before":Ms(e,"beforebegin",o),Ut(["util"],e);break;case"after":Ms(e,"afterend",o),Ut(["util"],e);break;case"export":y();break}});const y=()=>{const ee=Q(window.siyuan.languages.exporting,0);if(n.getAttribute("data-subtype")==="plantuml"){fetch(n.querySelector("object").getAttribute("data")).then(function(Z){return Z.blob()}).then(function(Z){const k=new FormData;k.append("file",Z),k.append("type","image/svg+xml"),ae("/api/export/exportAsFile",k,w=>{$e(w.data.file),ot(ee)})});return}setTimeout(()=>{va("/stage/protyle/js/html-to-image.min.js?v=1.11.13","protyleHtml2image").then(()=>{n.style.display="inline-block",window.htmlToImage.toBlob(n).then(Z=>{n.style.display="";const k=new FormData;k.append("file",Z),k.append("type","image/png"),ae("/api/export/exportAsFile",k,w=>{$e(w.data.file),ot(ee)})})})},p.TIMEOUT_LOAD)},_=this.subElement.querySelector(".b3-text-field");l.includes("NodeHTMLBlock")?_.value=Lute.UnEscapeHTMLStr(n.querySelector("protyle-html").getAttribute("data-content")||""):g?_.value=Lute.UnEscapeHTMLStr(n.getAttribute("data-inline-memo-content")||""):_.value=Lute.UnEscapeHTMLStr(n.getAttribute("data-content")||"");const v=_.value;_.addEventListener("input",ee=>{if(n.parentElement&&(_.clientHeight!==_.scrollHeight&&m(),!!this.subElement.querySelector('[data-type="refresh"]').classList.contains("block__icon--active"))){if(l.includes("NodeHTMLBlock"))n.querySelector("protyle-html").setAttribute("data-content",Lute.EscapeHTMLStr(_.value));else if(g){let Z;a?Z=a:Z=[n],Z.forEach(k=>{k.nodeType!==3&&k.setAttribute("data-inline-memo-content",window.DOMPurify.sanitize(_.value))})}else n.setAttribute("data-content",Lute.EscapeHTMLStr(_.value)),n.removeAttribute("data-render");(!l.includes("NodeBlockQueryEmbed")||!l.includes("NodeHTMLBlock")||!g)&&zn(n),ee.stopPropagation()}}),_.addEventListener("keydown",ee=>{if(ee.stopPropagation(),Qe(window.siyuan.config.keymap.editor.insert["inline-math"].custom,ee)){ee.preventDefault();return}if(!ee.isComposing){if(ee.key==="Escape"||Qe("\u2318\u21A9",ee))this.subElement.querySelector('[data-type="pin"]').setAttribute("aria-label",window.siyuan.languages.pin),Ut(["util"],e);else if(ee.key==="Tab")document.execCommand("insertText",!1,"	"),ee.preventDefault();else if(uo(ee))return}}),this.subElementCloseCB=()=>{var ee;if(!n.parentElement||e.disabled||v===_.value&&_.value)return;let Z;if(l.includes("NodeHTMLBlock")){let k=_.value;k&&(k=k.trim().replace(/\n+/g,`
`),k.startsWith("<div>")&&k.endsWith("</div>")||(k=`<div>
${k}
</div>`)),n.querySelector("protyle-html").setAttribute("data-content",Lute.EscapeHTMLStr(k))}else if(g){let k;a?k=a:k=[n],k.forEach((w,S)=>{if(_.value)w.nodeType!==3&&w.setAttribute("data-inline-memo-content",window.DOMPurify.sanitize(_.value));else{const B=w.getAttribute("data-type").split(" ");B.length===1&&B[0]==="inline-memo"?w.outerHTML=w.innerHTML+(S===k.length-1?"<wbr>":""):(B.find((H,j)=>{if(H==="inline-memo")return B.splice(j,1),!0}),w.setAttribute("data-type",B.join(" ")),w.removeAttribute("data-inline-memo-content")),S===k.length-1&&(Z=w)}})}else l.includes("inline-math")?_.value?(n.setAttribute("data-content",Lute.EscapeHTMLStr(_.value)),n.removeAttribute("data-render"),zn(n)):(Z=n,n.outerHTML="<wbr>"):(n.setAttribute("data-content",Lute.EscapeHTMLStr(_.value)),n.removeAttribute("data-render"),l.includes("NodeBlockQueryEmbed")?($n(e,n),n.style.height=""):zn(n));if(getSelection().rangeCount===0||getSelection().rangeCount>0&&N(getSelection().getRangeAt(0).startContainer,"protyle-util")?n.tagName==="SPAN"?Z?Z.parentElement?(this.range.setStartAfter(Z),this.range.collapse(!0),Pt(this.range)):cn(r,this.range):n.parentElement&&(this.range.setStartAfter(n),this.range.collapse(!0),Pt(this.range)):(qt(n),n.classList.add("protyle-wysiwyg--select")):(ee=r.querySelector("wbr"))==null||ee.remove(),r.setAttribute("updated",at().format("YYYYMMDDHHmmss")),l.includes("NodeHTMLBlock")){const k=document.createElement("template");k.innerHTML=e.lute.SpinBlockDOM(r.outerHTML),k.content.childElementCount>1&&Q(window.siyuan.languages.htmlBlockTip)}Ht(e,o,r.outerHTML,c)},this.subElement.style.zIndex=(++window.siyuan.zIndex).toString(),this.subElement.classList.remove("fn__none");const U=n.getBoundingClientRect();this.element.classList.add("fn__none"),f?(_.style.width=h.styleW,_.style.height=h.styleH):m(),e.disabled||_.select(),e.app.plugins.forEach(ee=>{ee.eventBus.emit("open-noneditableblock",{protyle:e,toolbar:this,blockElement:r,renderElement:n})})}showCodeLanguage(e,n){var a,i;const s=oe(n[0]);if(!s)return;Ut(["hint"],e),window.siyuan.menus.menu.remove(),this.range=hn(s),this.subElement.style.width="",this.subElement.style.padding="",this.subElement.innerHTML=`<div data-id="codeLanguage" class="fn__flex-column" style="max-height:50vh">
    <input placeholder="${window.siyuan.languages.search}" style="margin: 0 8px 4px 8px" class="b3-text-field"/>
    <div class="b3-list fn__flex-1 b3-list--background" style="position: relative"></div>
</div>`;const r=this.subElement.lastElementChild.lastElementChild;let o=`<div data-id="clearLanguage" class="b3-list-item">${window.siyuan.languages.clear}</div>`,l=p.ALIAS_CODE_LANGUAGES.concat((i=(a=window.hljs)==null?void 0:a.listLanguages())!=null?i:[]).sort();const c={languages:l,type:"init",listElement:r};e.app&&e.app.plugins&&e.app.plugins.forEach(f=>{f.eventBus.emit("code-language-update",c)}),l=c.languages,l.forEach(f=>{o+=`<div data-id="${f}" class="b3-list-item">${f}</div>`}),r.innerHTML=o,r.firstElementChild.nextElementSibling.classList.add("b3-list-item--focus");const d=this.subElement.querySelector("input");d.addEventListener("keydown",f=>{if(f.stopPropagation(),!f.isComposing){if(pi(r,f),f.key==="Enter"){this.updateLanguage(n,e,this.subElement.querySelector(".b3-list-item--focus").textContent),f.preventDefault();return}f.key==="Escape"&&(this.subElement.classList.add("fn__none"),Pt(this.range))}});const u=(f,h)=>{const m=h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),b=new RegExp(m,"gi");return f.replace(b,y=>`<b>${y}</b>`)};d.addEventListener("input",f=>{var h;const m=d.value.trim();let b,y=`<div data-id="clearLanguage" class="b3-list-item">${window.siyuan.languages.clear}</div>`,_=!1;if(m){const U=m.toLowerCase();b=l.filter(ee=>ee.toLowerCase().includes(U)).sort((ee,Z)=>{const k=ee.toLowerCase().startsWith(U),w=Z.toLowerCase().startsWith(U);return k&&w?ee.length-Z.length:k?-1:w?1:0}),(h=window.hljs)!=null&&h.getLanguage(m)&&(b=[m].concat(b.filter(ee=>ee!==m)))}const v={languages:m?b:l,type:"match",value:m,listElement:r};e.app&&e.app.plugins&&e.app.plugins.forEach(U=>{U.eventBus.emit("code-language-update",v)}),b=v.languages,m?b.forEach(U=>{m===U?(_=!0,y+=`<div data-id="${U}" class="b3-list-item"><b>${U}</b></div>`):y+=`<div data-id="${U}" class="b3-list-item">${u(U,m)}</div>`}):b.forEach(U=>{y+=`<div data-id="${U}" class="b3-list-item">${U}</div>`}),m&&!_&&(y+=`<div data-id="customLanguage" class="b3-list-item"><b>${he(m.replace(/`| /g,"_"))}</b></div>`),r.innerHTML=y,r.firstElementChild.nextElementSibling.classList.add("b3-list-item--focus"),f.stopPropagation()}),r.addEventListener("click",f=>{const h=f.target,m=N(h,"b3-list-item");m&&this.updateLanguage(n,e,m.textContent)}),this.subElement.style.zIndex=(++window.siyuan.zIndex).toString(),this.subElement.classList.remove("fn__none"),this.subElementCloseCB=void 0;const g=n[0].getBoundingClientRect();gn(this.subElement,g.left,g.bottom,g.height),this.element.classList.add("fn__none"),d.select()}showTpl(e,n,a){this.range=a,Ut(["hint"],e),window.siyuan.menus.menu.remove(),this.subElement.style.width="",this.subElement.style.padding="",this.subElement.innerHTML=`<div style="max-height:50vh" class="fn__flex">
<div class="fn__flex-column" style="${x()?"width: 100%":"width: 256px"}">
    <div class="fn__flex" style="margin: 0 8px 4px 8px">
        <input class="b3-text-field fn__flex-1"/>
        <span class="fn__space"></span>
        <span data-type="previous" class="block__icon block__icon--show"><svg><use xlink:href="#iconLeft"></use></svg></span>
        <span class="fn__space"></span>
        <span data-type="next" class="block__icon block__icon--show"><svg><use xlink:href="#iconRight"></use></svg></span>
    </div>
    <div class="b3-list fn__flex-1 b3-list--background" style="position: relative"><img style="margin: 0 auto;display: block;width: 64px;height: 64px" src="/stage/loading-pure.svg"></div>
</div>
<div class="toolbarResize" style="    cursor: col-resize;
    box-shadow: 2px 0 0 0 var(--b3-theme-surface) inset, 3px 0 0 0 var(--b3-border-color) inset;
    width: 5px;
    margin-left: -2px;"></div>
<div style="width: 520px;${x()||window.outerWidth<window.outerWidth/2+520?"display:none;":""}overflow: auto;"></div>
</div>`;const i=this.subElement.querySelector(".b3-list");Oy(this.subElement.querySelector(".toolbarResize"),i.parentElement);const s=this.subElement.firstElementChild.lastElementChild;let r;i.addEventListener("mouseover",l=>{const c=l.target,d=N(c,"b3-list-item");if(!d)return;const u=d.getAttribute("data-value");r!==u&&(r=u,Af(r,s,e.block.parentID),l.stopPropagation())});const o=this.subElement.querySelector("input");o.addEventListener("keydown",l=>{if(l.stopPropagation(),l.isComposing)return;const c=!this.subElement.querySelector(".b3-list-item");if(!c){const d=pi(i,l);if(d){const u=d.getAttribute("data-value");if(r===u)return;r=u,Af(r,s,e.block.parentID)}}l.key==="Enter"?(c?Pt(this.range):vS(decodeURIComponent(this.subElement.querySelector(".b3-list-item--focus").getAttribute("data-value")),e,n),this.subElement.classList.add("fn__none"),l.preventDefault()):l.key==="Escape"&&(this.subElement.classList.add("fn__none"),Pt(this.range))}),o.addEventListener("input",l=>{l.stopPropagation(),ae("/api/search/searchTemplate",{k:o.value},c=>{var d;let u="";c.data.blocks.forEach((f,h)=>{u+=`<div data-value="${f.path}" class="b3-list-item--hide-action b3-list-item${h===0?" b3-list-item--focus":""}">
<span class="b3-list-item__text">${f.content}</span>`,u+=`<span data-type="remove" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.remove}">
    <svg><use xlink:href="#iconTrashcan"></use></svg>
</span></div>`}),i.innerHTML=u||`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`;const g=(d=c.data.blocks[0])==null?void 0:d.path;r!==g&&(r=g,Af(r,s,e.block.parentID))})}),this.subElement.lastElementChild.addEventListener("click",l=>{const c=l.target;if(c.classList.contains("b3-list--empty")){this.subElement.classList.add("fn__none"),Pt(this.range),l.stopPropagation();return}const d=N(c,"b3-list-item__action");if(d&&d.getAttribute("data-type")==="remove"){Sn(window.siyuan.languages.remove,window.siyuan.languages.confirmDelete+"?",()=>{ae("/api/search/removeTemplate",{path:d.parentElement.getAttribute("data-value")},()=>{if(d.parentElement.parentElement.childElementCount===1)d.parentElement.parentElement.innerHTML=`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`,Af("",s,e.block.parentID);else{if(d.parentElement.classList.contains("b3-list-item--focus")){const h=d.parentElement.previousElementSibling||d.parentElement.nextElementSibling;h.classList.add("b3-list-item--focus");const m=h.getAttribute("data-value");if(r===m)return;r=m,Af(r,s,e.block.parentID)}d.parentElement.remove()}})}),l.stopPropagation();return}if(ue(c,"data-type","previous")){o.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"})),l.stopPropagation();return}if(ue(c,"data-type","next")){o.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"})),l.stopPropagation();return}const f=N(c,"b3-list-item");f&&(vS(decodeURIComponent(f.getAttribute("data-value")),e,n),l.stopPropagation())}),this.subElement.style.zIndex=(++window.siyuan.zIndex).toString(),this.subElement.classList.remove("fn__none"),this.subElementCloseCB=void 0,this.element.classList.add("fn__none"),o.select(),ae("/api/search/searchTemplate",{k:""},l=>{let c="";l.data.blocks.forEach((u,g)=>{c+=`<div data-value="${u.path}" class="b3-list-item--hide-action b3-list-item${g===0?" b3-list-item--focus":""}">
<span class="b3-list-item__text">${u.content}</span>`,c+=`<span data-type="remove" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.remove}">
    <svg><use xlink:href="#iconTrashcan"></use></svg>
</span></div>`}),this.subElement.querySelector(".b3-list--background").innerHTML=c||`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`;const d=Dr(n,a);gn(this.subElement,d.left,d.top+18,p.SIZE_TOOLBAR_HEIGHT),this.subElement.firstElementChild.style.maxHeight=Math.min(window.innerHeight*.8,window.innerHeight-this.subElement.getBoundingClientRect().top)-16+"px",r=i.firstElementChild.getAttribute("data-value"),Af(r,s,e.block.parentID)})}showWidget(e,n,a){this.range=a,Ut(["hint"],e),window.siyuan.menus.menu.remove(),this.subElement.style.width="",this.subElement.style.padding="",this.subElement.innerHTML=`<div class="fn__flex-column" style="max-height:50vh">
    <input style="margin: 0 8px 4px 8px" class="b3-text-field"/>
    <div class="b3-list fn__flex-1 b3-list--background" style="position: relative"><img style="margin: 0 auto;display: block;width: 64px;height:64px" src="/stage/loading-pure.svg"></div>
</div>`;const i=this.subElement.lastElementChild.lastElementChild,s=this.subElement.querySelector("input");s.addEventListener("keydown",r=>{r.stopPropagation(),!r.isComposing&&(pi(i,r),r.key==="Enter"?(xS(this.subElement.querySelector(".b3-list-item--focus").getAttribute("data-content"),e),this.subElement.classList.add("fn__none"),r.preventDefault()):r.key==="Escape"&&(this.subElement.classList.add("fn__none"),Pt(this.range)))}),s.addEventListener("input",r=>{r.stopPropagation(),ae("/api/search/searchWidget",{k:s.value},o=>{let l="";o.data.blocks.forEach((c,d)=>{l+=`<div data-value="${c.path}" data-content="${c.content}" class="b3-list-item${d===0?" b3-list-item--focus":""}">
    ${c.name}
    <span class="b3-list-item__meta">${c.content}</span>
</div>`}),i.innerHTML=l})}),this.subElement.lastElementChild.addEventListener("click",r=>{const o=r.target,l=N(o,"b3-list-item");l&&xS(l.dataset.content,e)}),this.subElement.style.zIndex=(++window.siyuan.zIndex).toString(),this.subElement.classList.remove("fn__none"),this.subElementCloseCB=void 0,this.element.classList.add("fn__none"),s.select(),ae("/api/search/searchWidget",{k:""},r=>{let o="";r.data.blocks.forEach((c,d)=>{o+=`<div class="b3-list-item${d===0?" b3-list-item--focus":""}" data-content="${c.content}">
${c.name}
<span class="b3-list-item__meta">${c.content}</span>
</div>`}),this.subElement.querySelector(".b3-list--background").innerHTML=o;const l=Dr(n,a);gn(this.subElement,l.left,l.top+18,p.SIZE_TOOLBAR_HEIGHT)})}showContent(e,n,a){var i,s;this.range=n,Ut(["hint"],e),this.subElement.style.width="auto",this.subElement.style.padding="0 8px";let r="";const o=n.toString()!==""||((s=(i=n.cloneContents().childNodes[0])==null?void 0:i.classList)==null?void 0:s.contains("emoji"));o&&(r+='<button class="keyboard__action" data-action="copy"><svg><use xlink:href="#iconCopy"></use></svg></button>',e.disabled||(r+=`<button class="keyboard__action" data-action="cut"><svg><use xlink:href="#iconCut"></use></svg></button>
<button class="keyboard__action" data-action="delete"><svg><use xlink:href="#iconTrashcan"></use></svg></button>`)),e.disabled||(r+=`<button class="keyboard__action" data-action="paste"><svg><use xlink:href="#iconPaste"></use></svg></button>
<button class="keyboard__action" data-action="select"><svg><use xlink:href="#iconSelect"></use></svg></button>`),(o||!e.disabled)&&(r+='<button class="keyboard__action" data-action="more"><svg><use xlink:href="#iconMore"></use></svg></button>'),this.subElement.innerHTML=`<div class="fn__flex">${r}</div>`,this.subElement.lastElementChild.addEventListener("click",c=>GW(this,null,function*(){const d=N(c.target,"keyboard__action");if(!d)return;const u=d.getAttribute("data-action");if(u==="copy")Pt(hn(a)),document.execCommand("copy"),this.subElement.classList.add("fn__none");else if(u==="cut")Pt(hn(a)),document.execCommand("cut"),this.subElement.classList.add("fn__none");else if(u==="delete"){const g=hn(a);g.insertNode(document.createElement("wbr"));const f=a.outerHTML;g.extractContents(),cn(a,g),Pt(g),Ht(e,a.getAttribute("data-node-id"),a.outerHTML,f),this.subElement.classList.add("fn__none")}else if(u==="paste"){if(Pt(hn(a)),document.queryCommandSupported("paste"))document.execCommand("paste");else try{const g=yield nt();_f(e,Object.assign(g,{target:a}))}catch(g){console.log(g)}this.subElement.classList.add("fn__none")}else u==="select"?(mw(e,a,n),this.subElement.classList.add("fn__none")):u==="copyPlainText"?(Pt(hn(a)),kt(getSelection().getRangeAt(0).toString()),this.subElement.classList.add("fn__none")):u==="pasteAsPlainText"?(Pt(hn(a)),gv(e),this.subElement.classList.add("fn__none")):u==="pasteEscaped"?(Pt(hn(a)),h2(e,a),this.subElement.classList.add("fn__none")):u==="back"?this.subElement.lastElementChild.innerHTML=r:u==="more"&&(this.subElement.lastElementChild.innerHTML=`<button class="keyboard__action${o?"":" fn__none"}" data-action="copyPlainText"><span>${window.siyuan.languages.copyPlainText}</span></button>
<div class="keyboard__split${o?"":" fn__none"}"></div>
<button class="keyboard__action${e.disabled?" fn__none":""}" data-action="pasteAsPlainText"><span>${window.siyuan.languages.pasteAsPlainText}</span></button>
<div class="keyboard__split${e.disabled?" fn__none":""}"></div>
<button class="keyboard__action${e.disabled?" fn__none":""}" data-action="pasteEscaped"><span>${window.siyuan.languages.pasteEscaped}</span></button>
<div class="keyboard__split${e.disabled?" fn__none":""}"></div>
<button class="keyboard__action" data-action="back"><svg><use xlink:href="#iconBack"></use></svg></button>`,gn(this.subElement,l.left,l.top+28,p.SIZE_TOOLBAR_HEIGHT))})),this.subElement.style.zIndex=(++window.siyuan.zIndex).toString(),this.subElement.classList.remove("fn__none"),this.subElementCloseCB=void 0,this.element.classList.add("fn__none");const l=Dr(a,n);gn(this.subElement,l.left,l.top-48,p.SIZE_TOOLBAR_HEIGHT)}genItem(e,n){let a;switch(n.name){case"strong":case"em":case"s":case"code":case"mark":case"tag":case"u":case"sup":case"clear":case"sub":case"kbd":a=new Md(e,n);break;case"block-ref":a=new qW(e,n);break;case"inline-math":a=new VW(e,n);break;case"inline-memo":a=new YW(e,n);break;case"|":a=new RW;break;case"text":a=new bM(e,n);break;case"a":a=new HW(e,n);break;default:a=new Md(e,n);break}if(a)return a.element}mergeNode(e){for(let n=0;n<e.length;n++)e[n].nodeType!==3&&e[n].tagName==="WBR"&&(e[n].remove(),n--);for(let n=0;n<e.length;n++)e[n].nodeType===3&&(e[n].textContent===""?(e[n].remove(),n--):e[n+1]&&e[n+1].nodeType===3&&(e[n].textContent=e[n].textContent+e[n+1].textContent,e[n+1].remove(),n--))}updateLanguage(e,n,a){const i=a===window.siyuan.languages.clear?"":a;n.app&&n.app.plugins&&n.app.plugins.forEach(o=>{o.eventBus.emit("code-language-change",{language:i,languageElements:e,protyle:n})}),p.SIYUAN_RENDER_CODE_LANGUAGES.includes(i)||(window.siyuan.storage[p.LOCAL_CODELANG]=i,Gt(p.LOCAL_CODELANG,window.siyuan.storage[p.LOCAL_CODELANG]));const s=[],r=[];e.forEach(o=>{const l=oe(o);if(l){const c=l.getAttribute("data-node-id");r.push({id:c,data:l.outerHTML,action:"update"}),o.textContent=a===window.siyuan.languages.clear?"":a;const d=Ee(l);p.SIYUAN_RENDER_CODE_LANGUAGES.includes(i)?(l.dataset.content=d.textContent.trim(),l.dataset.subtype=i,l.className="render-node",l.innerHTML=`<div spin="1"></div><div class="protyle-attr" contenteditable="false">${p.ZWSP}</div>`,zn(l)):(d.textContent=d.textContent,d.parentElement.removeAttribute("data-render"),ra(l)),l.setAttribute("updated",at().format("YYYYMMDDHHmmss")),s.push({id:c,data:l.outerHTML,action:"update"})}}),et(n,s,r),this.subElement.classList.add("fn__none"),Pt(this.range)}}const kL=t=>{window.siyuan.menus.menu.append(new xe({id:"transferBlockRef",label:window.siyuan.languages.transferBlockRef,icon:"iconScrollHoriz",click(){const e=new fe({title:window.siyuan.languages.transferBlockRef,content:`<div class="b3-dialog__content">
    <input class="b3-text-field fn__block" placeholder="${window.siyuan.languages.targetBlockID}">
    <div class="b3-label__text">${window.siyuan.languages.transferBlockRefTip}</div>
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"});e.element.setAttribute("data-key",p.DIALOG_TRANSFERBLOCKREF);const n=e.element.querySelector("input"),a=e.element.querySelectorAll(".b3-button");e.bindInput(n,()=>{a[1].click()}),n.focus(),a[0].addEventListener("click",()=>{e.destroy()}),a[1].addEventListener("click",()=>{ae("/api/block/transferBlockRef",{fromID:t,toID:n.value}),e.destroy()})}}).element)};var KW=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class XW{constructor(e){Jt()?this.gutterTip=window.siyuan.languages.gutterTip.replace("\u2325\u2192",un(window.siyuan.config.keymap.general.enter.custom,"/")).replace("\u2318\u2191",un(window.siyuan.config.keymap.editor.general.collapse.custom,"/")).replace("\u2325\u2318A",un(window.siyuan.config.keymap.editor.general.attr.custom,"/")):this.gutterTip=window.siyuan.languages.gutterTip.replace("\u2325\u2192",un(window.siyuan.config.keymap.general.enter.custom,"/")).replace("\u2318\u2191",un(window.siyuan.config.keymap.editor.general.collapse.custom,"/")).replace("\u2325\u2318A",un(window.siyuan.config.keymap.editor.general.attr.custom,"/")).replace(//g,"Ctrl+").replace(//g,"Alt+").replace(//g,"Shift+").replace(//g,"Ctrl+"),e.options.backlinkData&&(this.gutterTip=this.gutterTip.replace(window.siyuan.languages.enter,window.siyuan.languages.openBy)),this.element=document.createElement("div"),this.element.className="protyle-gutters",this.element.addEventListener("dragstart",n=>{var a;Pa(),window.siyuan.menus.menu.remove();const i=n.target.parentElement;let s=[],r=[],o;if(i.dataset.rowId){if(o=Array.from(e.wysiwyg.element.querySelectorAll(`.av[data-node-id="${i.dataset.nodeId}"]`)).find(d=>{if(!ge(d)&&!ve(d))return!0}),(a=o.querySelector('.block__icon[data-type="av-sort"]'))!=null&&a.classList.contains("block__icon--active")){const d=o.querySelectorAll(".av__body");if(d.length===1){n.preventDefault(),n.stopPropagation();return}else if(["template","created","updated"].includes(d[0].getAttribute("data-dtype"))){n.preventDefault(),n.stopPropagation();return}}const c=o.querySelector(`.av__body${i.dataset.groupId?`[data-group-id="${i.dataset.groupId}"]`:""} .av__row[data-id="${i.dataset.rowId}"]`);c.classList.contains("av__row--select")||o.querySelectorAll(".av__row--select:not(.av__row--header)").forEach(d=>{d.classList.remove("av__row--select"),d.querySelector("use").setAttribute("xlink:href","#iconUncheck")}),c.classList.add("av__row--select"),c.querySelector(".av__firstcol use").setAttribute("xlink:href","#iconCheck"),ec(c),o.querySelectorAll(".av__row--select:not(.av__row--header)").forEach(d=>{var u;const g=((u=N(d,"av__body"))==null?void 0:u.dataset.groupId)||"";s.push(d.getAttribute("data-id")+(g?"@"+g:"")),r.push(d)})}else{const c=i.getAttribute("data-node-id");r=Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));let d=!1;if(r.forEach(u=>{const g=u.getAttribute("data-node-id");g===c&&(d=!0),s.push(g)}),!d){let u;Array.from(e.wysiwyg.element.querySelectorAll(`[data-node-id="${c}"]`)).find(g=>{if(!ge(g)&&this.isMatchNode(g))return u=g,!0}),u&&(r.forEach(g=>{g.classList.remove("protyle-wysiwyg--select")}),u.classList.add("protyle-wysiwyg--select"),r=[u],s=[c])}}const l=document.createElement("div");l.className=e.wysiwyg.element.className,r.forEach(c=>{if(c.querySelector("iframe")){const d=c.getAttribute("data-type"),u=Fs();u.classList.add("protyle-wysiwyg--select"),Ee(u).innerHTML=`<svg class="svg"><use xlink:href="${i.querySelector("use").getAttribute("xlink:href")}"></use></svg> ${OM(d)}`,l.append(u)}else l.append(Ji(c.cloneNode(!0)))}),l.setAttribute("style",`position:fixed;opacity:.1;width:${r[0].clientWidth}px;padding:0;`),document.body.append(l),n.dataTransfer.setDragImage(l,0,0),setTimeout(()=>{l.remove()}),i.style.opacity="0.38",window.siyuan.dragElement=o||e.wysiwyg.element,n.dataTransfer.setData(`${p.SIYUAN_DROP_GUTTER}${i.getAttribute("data-type")}${p.ZWSP}${i.getAttribute("data-subtype")}${p.ZWSP}${s}${p.ZWSP}${window.siyuan.config.system.workspaceDir}`,e.wysiwyg.element.innerHTML)}),this.element.addEventListener("dragend",()=>{this.element.querySelectorAll("button").forEach(n=>{n.style.opacity=""}),window.siyuan.dragElement=void 0}),this.element.addEventListener("click",n=>{var a;const i=A(n.target,"BUTTON");if(!i)return;n.preventDefault(),n.stopPropagation(),Pa(),si(["av","img"],e.wysiwyg.element);const s=i.getAttribute("data-node-id");if(!s){if(i.getAttribute("disabled"))return;i.setAttribute("disabled","disabled");let o;if(Array.from(e.wysiwyg.element.querySelectorAll(`[data-node-id="${(i.previousElementSibling||i.nextElementSibling).getAttribute("data-node-id")}"]`)).find(l=>{if(!ge(l)&&this.isMatchNode(l))return o=l,!0}),!o)return;if(n.altKey){let l=!0;Array.from(o.children).find(u=>{if(u.classList.contains("list")&&Array.from(u.children).find(f=>{if(f.classList.contains("li")&&f.getAttribute("fold")!=="1"&&f.childElementCount>3)return l=!1,!0}))return!0});const c=[],d=[];Array.from(o.children).forEach(u=>{u.classList.contains("list")&&Array.from(u.children).forEach(g=>{if(g.classList.contains("li")){l?g.removeAttribute("fold"):g.childElementCount>3&&g.setAttribute("fold","1");const f=g.getAttribute("data-node-id");c.push({action:"setAttrs",id:f,data:JSON.stringify({fold:l?"":"1"})}),d.push({action:"setAttrs",id:f,data:JSON.stringify({fold:l?"1":""})})}})}),et(e,c,d),i.removeAttribute("disabled")}else{const l=La(e,o).fold;l===1?i.firstElementChild.style.transform="":l===0&&(i.firstElementChild.style.transform="rotate(90deg)")}Ut(["select"],e),window.siyuan.menus.menu.remove();return}const r=i.getBoundingClientRect();if(i.dataset.type==="NodeAttributeViewRowMenu"||i.dataset.type==="NodeAttributeViewRow"){const o=Array.from(e.wysiwyg.element.querySelectorAll(`.av[data-node-id="${i.dataset.nodeId}"] .av__row[data-id="${i.dataset.rowId}"]`)).find(c=>{if(!ge(c))return!0});if(!o)return;const l=oe(o);if(!l)return;if(i.dataset.type==="NodeAttributeViewRow"){const c=l.getAttribute("data-av-id"),d=[Lute.NewNodeID()],u=n.altKey?o.previousElementSibling.getAttribute("data-id")||"":i.dataset.rowId,g=at().format("YYYYMMDDHHmmss"),f=o.parentElement.getAttribute("data-group-id");et(e,[{action:"insertAttrViewBlock",avID:c,previousID:u,srcs:[{itemID:Lute.NewNodeID(),id:d[0],isDetached:!0,content:""}],blockID:s,groupID:f},{action:"doUpdateUpdated",id:s,data:g}],[{action:"removeAttrViewBlock",srcIDs:d,avID:c},{action:"doUpdateUpdated",id:s,data:l.getAttribute("updated")}]),Hy({protyle:e,blockElement:l,srcIDs:d,previousId:u,groupID:f}),n.altKey&&this.element.querySelectorAll("button").forEach(h=>{h.dataset.rowId=d[0]}),l.setAttribute("updated",g)}else{if(!e.disabled&&n.shiftKey){const c=(a=o.querySelector('[data-dtype="block"] .av__celltext--ref'))==null?void 0:a.getAttribute("data-id");if(c){ae("/api/attr/getBlockAttrs",{id:c},d=>{Zs(d.data,"av",e)});return}}Vh(e,o,{x:r.left,y:r.bottom,w:r.width,h:r.height,isLeft:!0})}return}if(je(n))e.options.backlinkData?na(s,(o,l)=>{dn({app:e.app,id:s,action:l,zoomIn:o})}):hi({protyle:e,id:s});else if(n.altKey){let o;if(Array.from(e.wysiwyg.element.querySelectorAll(`[data-node-id="${s}"]`)).find(l=>{if(!ge(l)&&this.isMatchNode(l))return o=l,!0}),!o)return;if(i.getAttribute("data-type")==="NodeListItem"&&o.parentElement.getAttribute("data-node-id")){let l=!0;Array.from(o.parentElement.children).find(u=>{if(u.classList.contains("li")&&u.getAttribute("fold")!=="1"&&u.childElementCount>3)return l=!1,!0}),i.parentElement.querySelector("[data-type='fold'] > svg").style.transform=l?"rotate(90deg)":"";const c=[],d=[];Array.from(o.parentElement.children).find(u=>{if(u.classList.contains("li")){l?u.removeAttribute("fold"):u.childElementCount>3&&u.setAttribute("fold","1");const g=u.getAttribute("data-node-id");c.push({action:"setAttrs",id:g,data:JSON.stringify({fold:l?"":"1"})}),d.push({action:"setAttrs",id:g,data:JSON.stringify({fold:l?"1":""})})}}),et(e,c,d)}else{const l=La(e,o).fold,c=i.parentElement.querySelector("[data-type='fold'] > svg");l!==-1&&c&&(c.style.transform=l===0?"rotate(90deg)":"")}o.classList.remove("protyle-wysiwyg--hl")}else if(n.shiftKey&&!e.disabled)Ho(e.wysiwyg.element.querySelector(`[data-node-id="${s}"]`),"bookmark",e);else if(!window.siyuan.ctrlIsPressed&&!window.siyuan.altIsPressed&&!window.siyuan.shiftIsPressed){this.renderMenu(e,i),e.toolbar.range||(e.toolbar.range=hn(e.wysiwyg.element.querySelector(`[data-node-id="${s}"]`)||e.wysiwyg.element.firstElementChild)),window.siyuan.menus.menu.popup({x:r.left,y:r.bottom,isLeft:!0});const o=me(e.element,"block__popover",!0);window.siyuan.menus.menu.element.setAttribute("data-from",o?o.dataset.level+"popover":"app"),Pt(e.toolbar.range)}}),this.element.addEventListener("contextmenu",n=>{const a=A(n.target,"BUTTON");if(!(!a||a.getAttribute("data-type")==="fold")){if(!window.siyuan.ctrlIsPressed&&!window.siyuan.altIsPressed&&!window.siyuan.shiftIsPressed){Pa(),si(["av","img"],e.wysiwyg.element);const i=a.getBoundingClientRect();if(a.dataset.type==="NodeAttributeViewRowMenu"){const s=Array.from(e.wysiwyg.element.querySelectorAll(`.av[data-node-id="${a.dataset.nodeId}"] .av__row[data-id="${a.dataset.rowId}"]`)).find(r=>{if(!ge(r))return!0});s&&Vh(e,s,{x:i.left,y:i.bottom,w:i.width,h:i.height,isLeft:!0})}else if(a.dataset.type!=="NodeAttributeViewRow"){this.renderMenu(e,a),e.toolbar.range||(e.toolbar.range=hn(e.wysiwyg.element.querySelector(`[data-node-id="${a.getAttribute("data-node-id")}"]`)||e.wysiwyg.element.firstElementChild)),window.siyuan.menus.menu.popup({x:i.left,y:i.bottom,isLeft:!0});const s=me(e.element,"block__popover",!0);window.siyuan.menus.menu.element.setAttribute("data-from",s?s.dataset.level+"popover":"app"),Pt(e.toolbar.range)}}n.preventDefault(),n.stopPropagation()}}),this.element.addEventListener("mouseleave",n=>{Array.from(e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--hl, .av__row--hl")).forEach(a=>{a.classList.remove("protyle-wysiwyg--hl","av__row--hl")}),n.preventDefault(),n.stopPropagation()}),this.element.addEventListener("mousewheel",n=>{Ut(["gutter"],e),n.stopPropagation()},{passive:!0})}isMatchNode(e){const n=e.getBoundingClientRect();let a=this.element.getBoundingClientRect().top+6;return n.height<Math.floor(window.siyuan.config.editor.fontSize*1.625)+8&&(a=a-(n.height-this.element.clientHeight)/2),n.top<=a&&n.bottom>=a}turnsOneInto(e){return{id:e.menuId,icon:e.icon,label:e.label,accelerator:e.accelerator,click(){Of(e)}}}turnsIntoOne(e){return{id:e.menuId,icon:e.icon,label:e.label,accelerator:e.accelerator,click(){Qs(e)}}}turnsInto(e){return{id:e.menuId,icon:e.icon,label:e.label,accelerator:e.accelerator,click(){mr(e)}}}showMobileAppearance(e){const n=document.getElementById("keyboardToolbar"),a=n.querySelectorAll("#keyboardToolbar .keyboard__dynamic");a[0].classList.add("fn__none"),a[1].classList.remove("fn__none"),n.querySelector('.keyboard__action[data-type="text"]').classList.add("protyle-toolbar__item--current"),n.querySelector('.keyboard__action[data-type="done"] use').setAttribute("xlink:href","#iconCloseRound"),n.classList.remove("fn__none");const i=e.contentElement.scrollTop+333.5;uS(e,n),Nv(i)}renderMultipleMenu(e,n){var a;let i=!1,s=!1;if(n.find((l,c)=>{if(l.classList.contains("li"))return i=!0,!0;if(l.nextElementSibling&&n[c+1]&&l.nextElementSibling===n[c+1])s=!0;else if(c!==n.length-1)return s=!1,!0}),!i&&!e.disabled){const l=[];s&&(l.push(this.turnsIntoOne({menuId:"list",icon:"iconList",label:window.siyuan.languages.list,protyle:e,accelerator:window.siyuan.config.keymap.editor.insert.list.custom,selectsElement:n,type:"Blocks2ULs"})),l.push(this.turnsIntoOne({menuId:"orderedList",icon:"iconOrderedList",label:window.siyuan.languages["ordered-list"],accelerator:window.siyuan.config.keymap.editor.insert["ordered-list"].custom,protyle:e,selectsElement:n,type:"Blocks2OLs"})),l.push(this.turnsIntoOne({menuId:"check",icon:"iconCheck",label:window.siyuan.languages.check,accelerator:window.siyuan.config.keymap.editor.insert.check.custom,protyle:e,selectsElement:n,type:"Blocks2TLs"})),l.push(this.turnsIntoOne({menuId:"quote",icon:"iconQuote",label:window.siyuan.languages.quote,accelerator:window.siyuan.config.keymap.editor.insert.quote.custom,protyle:e,selectsElement:n,type:"Blocks2Blockquote"}))),l.push(this.turnsInto({menuId:"paragraph",icon:"iconParagraph",label:window.siyuan.languages.paragraph,accelerator:window.siyuan.config.keymap.editor.heading.paragraph.custom,protyle:e,selectsElement:n,type:"Blocks2Ps",isContinue:s})),l.push(this.turnsInto({menuId:"heading1",icon:"iconH1",label:window.siyuan.languages.heading1,accelerator:window.siyuan.config.keymap.editor.heading.heading1.custom,protyle:e,selectsElement:n,level:1,type:"Blocks2Hs",isContinue:s})),l.push(this.turnsInto({menuId:"heading2",icon:"iconH2",label:window.siyuan.languages.heading2,accelerator:window.siyuan.config.keymap.editor.heading.heading2.custom,protyle:e,selectsElement:n,level:2,type:"Blocks2Hs",isContinue:s})),l.push(this.turnsInto({menuId:"heading3",icon:"iconH3",label:window.siyuan.languages.heading3,accelerator:window.siyuan.config.keymap.editor.heading.heading3.custom,protyle:e,selectsElement:n,level:3,type:"Blocks2Hs",isContinue:s})),l.push(this.turnsInto({menuId:"heading4",icon:"iconH4",label:window.siyuan.languages.heading4,accelerator:window.siyuan.config.keymap.editor.heading.heading4.custom,protyle:e,selectsElement:n,level:4,type:"Blocks2Hs",isContinue:s})),l.push(this.turnsInto({menuId:"heading5",icon:"iconH5",label:window.siyuan.languages.heading5,accelerator:window.siyuan.config.keymap.editor.heading.heading5.custom,protyle:e,selectsElement:n,level:5,type:"Blocks2Hs",isContinue:s})),l.push(this.turnsInto({menuId:"heading6",icon:"iconH6",label:window.siyuan.languages.heading6,accelerator:window.siyuan.config.keymap.editor.heading.heading6.custom,protyle:e,selectsElement:n,level:6,type:"Blocks2Hs",isContinue:s})),window.siyuan.menus.menu.append(new xe({id:"turnInto",icon:"iconRefresh",label:window.siyuan.languages.turnInto,type:"submenu",submenu:l}).element),s&&!(n[0].parentElement.classList.contains("sb")&&n.length+1===n[0].parentElement.childElementCount)&&window.siyuan.menus.menu.append(new xe({id:"mergeSuperBlock",icon:"iconSuper",label:window.siyuan.languages.merge+" "+window.siyuan.languages.superBlock,type:"submenu",submenu:[this.turnsIntoOne({menuId:"hLayout",label:window.siyuan.languages.hLayout,accelerator:window.siyuan.config.keymap.editor.general.hLayout.custom,icon:"iconSplitLR",protyle:e,selectsElement:n,type:"BlocksMergeSuperBlock",level:"col"}),this.turnsIntoOne({menuId:"vLayout",label:window.siyuan.languages.vLayout,accelerator:window.siyuan.config.keymap.editor.general.vLayout.custom,icon:"iconSplitTB",protyle:e,selectsElement:n,type:"BlocksMergeSuperBlock",level:"row"})]}).element)}e.disabled||window.siyuan.menus.menu.append(new xe({id:"ai",icon:"iconSparkles",label:window.siyuan.languages.ai,accelerator:window.siyuan.config.keymap.editor.general.ai.custom,click(){BE(n,e)}}).element);const r=sc(Array.from(n).map(l=>l.getAttribute("data-node-id")),!0,n[0]).concat([{id:"copyPlainText",iconHTML:"",label:window.siyuan.languages.copyPlainText,accelerator:window.siyuan.config.keymap.editor.general.copyPlainText.custom,click(){let l="";n.forEach(c=>{l+=kh(c)+`
`}),kt(l.trimEnd()),qt(n[0])}},{id:"copy",iconHTML:"",label:window.siyuan.languages.copy,accelerator:"\u2318C",click(){pt(n[0])?qt(n[0]):Pt(hn(n[0])),document.execCommand("copy")}}]),o=this.genCopyTextRef(n);if(o&&r.splice(7,0,o),e.disabled||r.push({id:"duplicate",iconHTML:"",label:window.siyuan.languages.duplicate,accelerator:window.siyuan.config.keymap.editor.general.duplicate.custom,click(){n_(n,e)}}),window.siyuan.menus.menu.append(new xe({id:"copy",label:window.siyuan.languages.copy,icon:"iconCopy",type:"submenu",submenu:r}).element),!e.disabled){window.siyuan.menus.menu.append(new xe({id:"cut",label:window.siyuan.languages.cut,accelerator:"\u2318X",icon:"iconCut",click:()=>{qt(n[0]),document.execCommand("cut")}}).element),window.siyuan.menus.menu.append(new xe({id:"move",label:window.siyuan.languages.move,accelerator:window.siyuan.config.keymap.general.move.custom,icon:"iconMove",click:()=>{ur(c=>{Wv(c[0],n,e)})}}).element),window.siyuan.menus.menu.append(new xe({id:"addToDatabase",label:window.siyuan.languages.addToDatabase,accelerator:window.siyuan.config.keymap.general.addToDatabase.custom,icon:"iconDatabase",click:()=>{qy(e,hn(n[0]))}}).element),window.siyuan.menus.menu.append(new xe({id:"delete",label:window.siyuan.languages.delete,icon:"iconTrashcan",accelerator:"\u232B",click:()=>{var c;(c=e.breadcrumb)==null||c.hide(),gr(e,n[0],hn(n[0]),"Backspace")}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_appearance",type:"separator"}).element);const l=new xe({id:"appearance",label:window.siyuan.languages.appearance,icon:"iconFont",accelerator:window.siyuan.config.keymap.editor.insert.appearance.custom,click:()=>{e.toolbar.element.classList.add("fn__none"),e.toolbar.subElement.innerHTML="",e.toolbar.subElement.style.width="",e.toolbar.subElement.style.padding="",e.toolbar.subElement.append(Fv(e,n)),e.toolbar.subElement.style.zIndex=(++window.siyuan.zIndex).toString(),e.toolbar.subElement.classList.remove("fn__none"),e.toolbar.subElementCloseCB=void 0;const c=n[0].getBoundingClientRect();gn(e.toolbar.subElement,c.left,c.top)}}).element;window.siyuan.menus.menu.append(l),x()||l.lastElementChild.classList.add("b3-menu__submenu--row"),this.genAlign(n,e),this.genWidths(n,e)}if(!window.siyuan.config.readonly){window.siyuan.menus.menu.append(new xe({id:"separator_quickMakeCard",type:"separator"}).element);const l=!n.some(c=>!c.hasAttribute(p.CUSTOM_RIFF_DECKS)&&c.getAttribute("data-type")!=="NodeThematicBreak");window.siyuan.menus.menu.append(new xe({id:l?"removeCard":"quickMakeCard",label:l?window.siyuan.languages.removeCard:window.siyuan.languages.quickMakeCard,accelerator:window.siyuan.config.keymap.editor.general.quickMakeCard.custom,icon:"iconRiffCard",click(){Mh(e,n)}}).element),window.siyuan.menus.menu.append(new xe({id:"addToDeck",label:window.siyuan.languages.addToDeck,icon:"iconRiffCard",ignore:!window.siyuan.config.flashcard.deck,click(){const c=[];n.forEach(d=>{d.getAttribute("data-type")!=="NodeThematicBreak"&&c.push(d.getAttribute("data-node-id"))}),Ih(e.app,c)}}).element)}return(a=e==null?void 0:e.app)!=null&&a.plugins&&Is({plugins:e.app.plugins,type:"click-blockicon",detail:{protyle:e,blockElements:n},separatorPosition:"top"}),window.siyuan.menus.menu}renderMenu(e,n){var a,i;if(!n)return;Ut(["util","toolbar","hint"],e),window.siyuan.menus.menu.remove(),x()&&Qy();const s=n.getAttribute("data-node-id"),r=e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select");if(r.length>1){if(window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_BLOCK_MULTI),Array.from(r).find(m=>{if(s===m.getAttribute("data-node-id"))return!0}))return this.renderMultipleMenu(e,Array.from(r))}else window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_BLOCK_SINGLE);let o;if(n.tagName==="BUTTON"?Array.from(e.wysiwyg.element.querySelectorAll(`[data-node-id="${s}"]`)).find(h=>{if(!ge(h)&&this.isMatchNode(h))return o=h,!0}):o=n,!o)return;const l=o.getAttribute("data-type"),c=o.getAttribute("data-subtype"),d=[];Ut(["select"],e),o.classList.add("protyle-wysiwyg--select"),ss([s],e.block.rootID),l==="NodeParagraph"&&!e.disabled?(d.push(this.turnsIntoOne({menuId:"list",icon:"iconList",label:window.siyuan.languages.list,accelerator:window.siyuan.config.keymap.editor.insert.list.custom,protyle:e,selectsElement:[o],type:"Blocks2ULs"})),d.push(this.turnsIntoOne({menuId:"orderedList",icon:"iconOrderedList",label:window.siyuan.languages["ordered-list"],accelerator:window.siyuan.config.keymap.editor.insert["ordered-list"].custom,protyle:e,selectsElement:[o],type:"Blocks2OLs"})),d.push(this.turnsIntoOne({menuId:"check",icon:"iconCheck",label:window.siyuan.languages.check,accelerator:window.siyuan.config.keymap.editor.insert.check.custom,protyle:e,selectsElement:[o],type:"Blocks2TLs"})),d.push(this.turnsIntoOne({menuId:"quote",icon:"iconQuote",label:window.siyuan.languages.quote,accelerator:window.siyuan.config.keymap.editor.insert.quote.custom,protyle:e,selectsElement:[o],type:"Blocks2Blockquote"})),d.push(this.turnsInto({menuId:"heading1",icon:"iconH1",label:window.siyuan.languages.heading1,accelerator:window.siyuan.config.keymap.editor.heading.heading1.custom,protyle:e,selectsElement:[o],level:1,type:"Blocks2Hs"})),d.push(this.turnsInto({menuId:"heading2",icon:"iconH2",label:window.siyuan.languages.heading2,accelerator:window.siyuan.config.keymap.editor.heading.heading2.custom,protyle:e,selectsElement:[o],level:2,type:"Blocks2Hs"})),d.push(this.turnsInto({menuId:"heading3",icon:"iconH3",label:window.siyuan.languages.heading3,accelerator:window.siyuan.config.keymap.editor.heading.heading3.custom,protyle:e,selectsElement:[o],level:3,type:"Blocks2Hs"})),d.push(this.turnsInto({menuId:"heading4",icon:"iconH4",label:window.siyuan.languages.heading4,accelerator:window.siyuan.config.keymap.editor.heading.heading4.custom,protyle:e,selectsElement:[o],level:4,type:"Blocks2Hs"})),d.push(this.turnsInto({menuId:"heading5",icon:"iconH5",label:window.siyuan.languages.heading5,accelerator:window.siyuan.config.keymap.editor.heading.heading5.custom,protyle:e,selectsElement:[o],level:5,type:"Blocks2Hs"})),d.push(this.turnsInto({menuId:"heading6",icon:"iconH6",label:window.siyuan.languages.heading6,accelerator:window.siyuan.config.keymap.editor.heading.heading6.custom,protyle:e,selectsElement:[o],level:6,type:"Blocks2Hs"}))):l==="NodeHeading"&&!e.disabled?(d.push(this.turnsInto({menuId:"paragraph",icon:"iconParagraph",label:window.siyuan.languages.paragraph,accelerator:window.siyuan.config.keymap.editor.heading.paragraph.custom,protyle:e,selectsElement:[o],type:"Blocks2Ps"})),d.push(this.turnsIntoOne({menuId:"quote",icon:"iconQuote",label:window.siyuan.languages.quote,accelerator:window.siyuan.config.keymap.editor.insert.quote.custom,protyle:e,selectsElement:[o],type:"Blocks2Blockquote"})),c!=="h1"&&d.push(this.turnsInto({menuId:"heading1",icon:"iconH1",label:window.siyuan.languages.heading1,accelerator:window.siyuan.config.keymap.editor.heading.heading1.custom,protyle:e,selectsElement:[o],level:1,type:"Blocks2Hs"})),c!=="h2"&&d.push(this.turnsInto({menuId:"heading2",icon:"iconH2",label:window.siyuan.languages.heading2,accelerator:window.siyuan.config.keymap.editor.heading.heading2.custom,protyle:e,selectsElement:[o],level:2,type:"Blocks2Hs"})),c!=="h3"&&d.push(this.turnsInto({menuId:"heading3",icon:"iconH3",label:window.siyuan.languages.heading3,accelerator:window.siyuan.config.keymap.editor.heading.heading3.custom,protyle:e,selectsElement:[o],level:3,type:"Blocks2Hs"})),c!=="h4"&&d.push(this.turnsInto({menuId:"heading4",icon:"iconH4",label:window.siyuan.languages.heading4,accelerator:window.siyuan.config.keymap.editor.heading.heading4.custom,protyle:e,selectsElement:[o],level:4,type:"Blocks2Hs"})),c!=="h5"&&d.push(this.turnsInto({menuId:"heading5",icon:"iconH5",label:window.siyuan.languages.heading5,accelerator:window.siyuan.config.keymap.editor.heading.heading5.custom,protyle:e,selectsElement:[o],level:5,type:"Blocks2Hs"})),c!=="h6"&&d.push(this.turnsInto({menuId:"heading6",icon:"iconH6",label:window.siyuan.languages.heading6,accelerator:window.siyuan.config.keymap.editor.heading.heading6.custom,protyle:e,selectsElement:[o],level:6,type:"Blocks2Hs"}))):l==="NodeList"&&!e.disabled?(d.push(this.turnsOneInto({menuId:"paragraph",id:s,icon:"iconParagraph",label:window.siyuan.languages.paragraph,accelerator:window.siyuan.config.keymap.editor.heading.paragraph.custom,protyle:e,nodeElement:o,type:"CancelList"})),d.push(this.turnsIntoOne({menuId:"quote",icon:"iconQuote",label:window.siyuan.languages.quote,accelerator:window.siyuan.config.keymap.editor.insert.quote.custom,protyle:e,selectsElement:[o],type:"Blocks2Blockquote"})),o.getAttribute("data-subtype")==="o"?(d.push(this.turnsOneInto({menuId:"list",id:s,icon:"iconList",label:window.siyuan.languages.list,accelerator:window.siyuan.config.keymap.editor.insert.list.custom,protyle:e,nodeElement:o,type:"OL2UL"})),d.push(this.turnsOneInto({menuId:"check",id:s,icon:"iconCheck",label:window.siyuan.languages.check,accelerator:window.siyuan.config.keymap.editor.insert.check.custom,protyle:e,nodeElement:o,type:"UL2TL"}))):o.getAttribute("data-subtype")==="t"?(d.push(this.turnsOneInto({menuId:"list",id:s,icon:"iconList",label:window.siyuan.languages.list,accelerator:window.siyuan.config.keymap.editor.insert.list.custom,protyle:e,nodeElement:o,type:"TL2UL"})),d.push(this.turnsOneInto({menuId:"orderedList",id:s,icon:"iconOrderedList",label:window.siyuan.languages["ordered-list"],accelerator:window.siyuan.config.keymap.editor.insert["ordered-list"].custom,protyle:e,nodeElement:o,type:"TL2OL"}))):(d.push(this.turnsOneInto({menuId:"orderedList",id:s,icon:"iconOrderedList",label:window.siyuan.languages["ordered-list"],accelerator:window.siyuan.config.keymap.editor.insert["ordered-list"].custom,protyle:e,nodeElement:o,type:"UL2OL"})),d.push(this.turnsOneInto({menuId:"check",id:s,icon:"iconCheck",label:window.siyuan.languages.check,accelerator:window.siyuan.config.keymap.editor.insert.check.custom,protyle:e,nodeElement:o,type:"OL2TL"})))):l==="NodeBlockquote"&&!e.disabled&&d.push(this.turnsOneInto({menuId:"paragraph",id:s,icon:"iconParagraph",label:window.siyuan.languages.paragraph,accelerator:window.siyuan.config.keymap.editor.heading.paragraph.custom,protyle:e,nodeElement:o,type:"CancelBlockquote"})),d.length>0&&!e.disabled&&window.siyuan.menus.menu.append(new xe({id:"turnInto",icon:"iconRefresh",label:window.siyuan.languages.turnInto,type:"submenu",submenu:d}).element),!e.disabled&&!o.classList.contains("hr")&&window.siyuan.menus.menu.append(new xe({id:"ai",icon:"iconSparkles",label:window.siyuan.languages.ai,accelerator:window.siyuan.config.keymap.editor.general.ai.custom,click(){BE([o],e)}}).element);const u=sc([s],!0,o).concat([{id:"copyPlainText",iconHTML:"",label:window.siyuan.languages.copyPlainText,accelerator:window.siyuan.config.keymap.editor.general.copyPlainText.custom,click(){kt(kh(o).trimEnd()),qt(o)}},{id:l==="NodeAttributeView"?"copyMirror":"copy",iconHTML:"",label:l==="NodeAttributeView"?window.siyuan.languages.copyMirror:window.siyuan.languages.copy,accelerator:"\u2318C",click(){pt(o)?qt(o):Pt(hn(o)),document.execCommand("copy")}}]),g=this.genCopyTextRef([o]);if(g&&u.splice(7,0,g),l==="NodeAttributeView"?(u.splice(6,0,{iconHTML:"",label:window.siyuan.languages.copyAVID,click(){ut(o.getAttribute("data-av-id"))}}),e.disabled||(u.push({id:"duplicateMirror",iconHTML:"",label:window.siyuan.languages.duplicateMirror,accelerator:window.siyuan.config.keymap.editor.general.duplicate.custom,click(){n_([o],e)}}),u.push({id:"duplicateCompletely",iconHTML:"",label:window.siyuan.languages.duplicateCompletely,accelerator:window.siyuan.config.keymap.editor.general.duplicateCompletely.custom,click(){qS(e,o)}}))):e.disabled||u.push({id:"duplicate",iconHTML:"",label:window.siyuan.languages.duplicate,accelerator:window.siyuan.config.keymap.editor.general.duplicate.custom,click(){n_([o],e)}}),window.siyuan.menus.menu.append(new xe({id:"copy",icon:"iconCopy",label:window.siyuan.languages.copy,type:"submenu",submenu:u}).element),e.disabled||(window.siyuan.menus.menu.append(new xe({id:"cut",icon:"iconCut",label:window.siyuan.languages.cut,accelerator:"\u2318X",click:()=>{qt(o),document.execCommand("cut")}}).element),window.siyuan.menus.menu.append(new xe({id:"move",icon:"iconMove",label:window.siyuan.languages.move,accelerator:window.siyuan.config.keymap.general.move.custom,click:()=>{ur(h=>{Wv(h[0],[o],e)})}}).element),window.siyuan.menus.menu.append(new xe({id:"addToDatabase",icon:"iconDatabase",label:window.siyuan.languages.addToDatabase,accelerator:window.siyuan.config.keymap.general.addToDatabase.custom,click:()=>{qy(e,hn(o))}}).element),window.siyuan.menus.menu.append(new xe({id:"delete",icon:"iconTrashcan",label:window.siyuan.languages.delete,accelerator:"\u232B",click:()=>{var h;(h=e.breadcrumb)==null||h.hide(),gr(e,o,hn(o),"Backspace")}}).element)),l==="NodeSuperBlock"&&!e.disabled){let h;window.siyuan.menus.menu.append(new xe({id:"separator_cancelSuperBlock",type:"separator"}).element);const m=o.getAttribute("data-sb-layout")==="col";window.siyuan.menus.menu.append(new xe({id:"cancelSuperBlock",label:window.siyuan.languages.cancel+" "+window.siyuan.languages.superBlock,accelerator:window.siyuan.config.keymap.editor.general[m?"hLayout":"vLayout"].custom,click(){return KW(this,null,function*(){const b=yield Uo(e,o);et(e,b.doOperations,b.undoOperations),qt(e.wysiwyg.element.querySelector(`[data-node-id="${b.previousId}"]`)),Ut(["gutter"],e)})}}).element),window.siyuan.menus.menu.append(new xe({id:"turnInto"+(m?"VLayout":"HLayout"),accelerator:window.siyuan.config.keymap.editor.general[m?"vLayout":"hLayout"].custom,label:window.siyuan.languages.turnInto+" "+window.siyuan.languages[m?"vLayout":"hLayout"],click(){const b=o.outerHTML;m?o.setAttribute("data-sb-layout","row"):o.setAttribute("data-sb-layout","col"),o.setAttribute("updated",at().format("YYYYMMDDHHmmss")),Ht(e,s,o.outerHTML,b),Pt(e.toolbar.range),Ut(["gutter"],e)}}).element)}else if(l==="NodeCodeBlock"&&!e.disabled&&!o.getAttribute("data-subtype")){window.siyuan.menus.menu.append(new xe({id:"separator_code",type:"separator"}).element);const h=o.getAttribute("linewrap"),m=o.getAttribute("ligatures"),b=o.getAttribute("linenumber");window.siyuan.menus.menu.append(new xe({id:"code",type:"submenu",icon:"iconCode",label:window.siyuan.languages.code,submenu:[{id:"md31",iconHTML:"",label:`<div class="fn__flex" style="margin-bottom: 4px"><span>${window.siyuan.languages.md31}</span><span class="fn__space fn__flex-1"></span>
<input type="checkbox" class="b3-switch fn__flex-center"${h==="true"||window.siyuan.config.editor.codeLineWrap&&h!=="false"?" checked":""}></div>`,bind(y){y.addEventListener("click",_=>{const v=y.querySelector("input");_.target.tagName!=="INPUT"&&(v.checked=!v.checked),o.setAttribute("linewrap",v.checked.toString()),o.querySelector(".hljs").removeAttribute("data-render"),ra(o),ae("/api/attr/setBlockAttrs",{id:s,attrs:{linewrap:v.checked.toString()}}),window.siyuan.menus.menu.remove()})}},{id:"md2",iconHTML:"",label:`<div class="fn__flex" style="margin-bottom: 4px"><span>${window.siyuan.languages.md2}</span><span class="fn__space fn__flex-1"></span>
<input type="checkbox" class="b3-switch fn__flex-center"${m==="true"||window.siyuan.config.editor.codeLigatures&&m!=="false"?" checked":""}></div>`,bind(y){y.addEventListener("click",_=>{const v=y.querySelector("input");_.target.tagName!=="INPUT"&&(v.checked=!v.checked),o.setAttribute("ligatures",v.checked.toString()),o.querySelector(".hljs").removeAttribute("data-render"),ra(o),ae("/api/attr/setBlockAttrs",{id:s,attrs:{ligatures:v.checked.toString()}}),window.siyuan.menus.menu.remove()})}},{id:"md27",iconHTML:"",label:`<div class="fn__flex" style="margin-bottom: 4px"><span>${window.siyuan.languages.md27}</span><span class="fn__space fn__flex-1"></span>
<input type="checkbox" class="b3-switch fn__flex-center"${b==="true"||window.siyuan.config.editor.codeSyntaxHighlightLineNum&&b!=="false"?" checked":""}></div>`,bind(y){y.addEventListener("click",_=>{const v=y.querySelector("input");_.target.tagName!=="INPUT"&&(v.checked=!v.checked),o.setAttribute("linenumber",v.checked.toString()),o.querySelector(".hljs").removeAttribute("data-render"),ra(o),ae("/api/attr/setBlockAttrs",{id:s,attrs:{linenumber:v.checked.toString()}}),window.siyuan.menus.menu.remove()})}}]}).element)}else if(l==="NodeCodeBlock"&&!e.disabled&&["echarts","mindmap"].includes(o.getAttribute("data-subtype"))){window.siyuan.menus.menu.append(new xe({id:"separator_chart",type:"separator"}).element);const h=o.style.height;let m=o.outerHTML;window.siyuan.menus.menu.append(new xe({id:"chart",label:window.siyuan.languages.chart,icon:"iconCode",submenu:[{id:"height",iconHTML:"",type:"readonly",label:`<div class="fn__flex"><input class="b3-text-field fn__flex-1" value="${h?parseInt(h):"420"}" step="1" min="148" style="margin: 4px 8px 4px 0" placeholder="${window.siyuan.languages.height}"><span class="fn__flex-center">px</span></div>`,bind:b=>{b.querySelector("input").addEventListener("change",y=>{const _=(y.target.value||"420")+"px";o.style.height=_,Ht(e,s,o.outerHTML,m),m=o.outerHTML,y.stopPropagation();const v=o.querySelector('[contenteditable="false"]');if(v){v.style.height=_;const U=window.echarts.getInstanceById(v.getAttribute("_echarts_instance_"));U&&U.resize()}})}},{id:"update",label:window.siyuan.languages.update,icon:"iconEdit",click(){e.toolbar.showRender(e,o)}}]}).element)}else if(l==="NodeTable"&&!e.disabled){let h=hn(o);const m=o.querySelector("table");m.contains(h.startContainer)||(h=hn(m.querySelector("th")));const b=A(h.startContainer,"TD")||A(h.startContainer,"TH");b&&(window.siyuan.menus.menu.append(new xe({id:"separator_table",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"table",type:"submenu",icon:"iconTable",label:window.siyuan.languages.table,submenu:SS(e,o,b,h).menus}).element))}else if(l==="NodeAttributeView")window.siyuan.menus.menu.append(new xe({id:"separator_exportCSV",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"exportCSV",icon:"iconDatabase",label:window.siyuan.languages.export+" CSV",click(){ae("/api/export/exportAttributeView",{id:o.getAttribute("data-av-id"),blockID:s},h=>{$e(h.data.zip)})}}).element),window.siyuan.menus.menu.append(new xe({id:"showDatabaseInFolder",icon:"iconFolder",label:window.siyuan.languages.showInFolder,click(){hy("showItemInFolder",gl.join(window.siyuan.config.system.dataDir,"storage","av",o.getAttribute("data-av-id"))+".json")}}).element);else if((l==="NodeVideo"||l==="NodeAudio")&&!e.disabled)window.siyuan.menus.menu.append(new xe({id:"separator_VideoOrAudio",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:l==="NodeVideo"?"assetVideo":"assetAudio",type:"submenu",icon:l==="NodeVideo"?"iconVideo":"iconRecord",label:window.siyuan.languages.assets,submenu:IM(e,o,l)}).element);else if(l==="NodeIFrame"&&!e.disabled)window.siyuan.menus.menu.append(new xe({id:"separator_IFrame",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"assetIFrame",type:"submenu",icon:"iconLanguage",label:window.siyuan.languages.assets,submenu:LM(e,o)}).element);else if(l==="NodeHTMLBlock"&&!e.disabled)window.siyuan.menus.menu.append(new xe({id:"separator_html",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"html",icon:"iconHTML5",label:"HTML",click(){e.toolbar.showRender(e,o)}}).element);else if(l==="NodeBlockQueryEmbed"&&!e.disabled){window.siyuan.menus.menu.append(new xe({id:"separator_blockEmbed",type:"separator"}).element);const h=o.getAttribute("breadcrumb");window.siyuan.menus.menu.append(new xe({id:"blockEmbed",type:"submenu",icon:"iconSQL",label:window.siyuan.languages.blockEmbed,submenu:[{id:"refresh",icon:"iconRefresh",label:`${window.siyuan.languages.refresh} SQL`,click(){o.removeAttribute("data-render"),$n(e,o)}},{id:"update",icon:"iconEdit",label:`${window.siyuan.languages.update} SQL`,click(){e.toolbar.showRender(e,o)}},{type:"separator"},{id:"embedBlockBreadcrumb",label:`<div class="fn__flex" style="margin-bottom: 4px"><span>${window.siyuan.languages.embedBlockBreadcrumb}</span><span class="fn__space fn__flex-1"></span>
<input type="checkbox" class="b3-switch fn__flex-center"${h==="true"||window.siyuan.config.editor.embedBlockBreadcrumb&&h!=="false"?" checked":""}></div>`,bind(m){m.addEventListener("click",b=>{const y=m.querySelector("input");b.target.tagName!=="INPUT"&&(y.checked=!y.checked),o.setAttribute("breadcrumb",y.checked.toString()),ae("/api/attr/setBlockAttrs",{id:s,attrs:{breadcrumb:y.checked.toString()}}),o.removeAttribute("data-render"),$n(e,o),window.siyuan.menus.menu.remove()})}},{id:"headingEmbedMode",label:window.siyuan.languages.headingEmbedMode,type:"submenu",submenu:[{id:"showHeadingWithBlocks",label:window.siyuan.languages.showHeadingWithBlocks,iconHTML:"",checked:o.getAttribute("custom-heading-mode")==="0",click(){o.setAttribute("custom-heading-mode","0"),ae("/api/attr/setBlockAttrs",{id:s,attrs:{"custom-heading-mode":"0"}}),o.removeAttribute("data-render"),$n(e,o)}},{id:"showHeadingOnlyTitle",label:window.siyuan.languages.showHeadingOnlyTitle,iconHTML:"",checked:o.getAttribute("custom-heading-mode")==="1",click(){o.setAttribute("custom-heading-mode","1"),ae("/api/attr/setBlockAttrs",{id:s,attrs:{"custom-heading-mode":"1"}}),o.removeAttribute("data-render"),$n(e,o)}},{id:"showHeadingOnlyBlocks",label:window.siyuan.languages.showHeadingOnlyBlocks,iconHTML:"",checked:o.getAttribute("custom-heading-mode")==="2",click(){o.setAttribute("custom-heading-mode","2"),ae("/api/attr/setBlockAttrs",{id:s,attrs:{"custom-heading-mode":"2"}}),o.removeAttribute("data-render"),$n(e,o)}},{id:"default",label:window.siyuan.languages.default,iconHTML:"",checked:!o.getAttribute("custom-heading-mode"),click(){o.removeAttribute("custom-heading-mode"),ae("/api/attr/setBlockAttrs",{id:s,attrs:{"custom-heading-mode":""}}),o.removeAttribute("data-render"),$n(e,o)}}]}]}).element)}else if(l==="NodeHeading"&&!e.disabled){window.siyuan.menus.menu.append(new xe({id:"separator_1",type:"separator"}).element);const h=[];c!=="h1"&&h.push(this.genHeadingTransform(e,s,1)),c!=="h2"&&h.push(this.genHeadingTransform(e,s,2)),c!=="h3"&&h.push(this.genHeadingTransform(e,s,3)),c!=="h4"&&h.push(this.genHeadingTransform(e,s,4)),c!=="h5"&&h.push(this.genHeadingTransform(e,s,5)),c!=="h6"&&h.push(this.genHeadingTransform(e,s,6)),window.siyuan.menus.menu.append(new xe({id:"tWithSubtitle",type:"submenu",icon:"iconRefresh",label:window.siyuan.languages.tWithSubtitle,submenu:h}).element),window.siyuan.menus.menu.append(new xe({id:"copyHeadings1",icon:"iconCopy",label:`${window.siyuan.languages.copy} ${window.siyuan.languages.headings1}`,click(){ae("/api/block/getHeadingChildrenDOM",{id:s,removeFoldAttr:o.getAttribute("fold")!=="1"},m=>{St()?window.JSAndroid.writeHTMLClipboard(e.lute.BlockDOM2StdMd(m.data).trimEnd(),m.data+p.ZWSP):Qt()?window.JSHarmony.writeHTMLClipboard(e.lute.BlockDOM2StdMd(m.data).trimEnd(),m.data+p.ZWSP):ut(m.data+p.ZWSP)})}}).element),window.siyuan.menus.menu.append(new xe({id:"cutHeadings1",icon:"iconCut",label:`${window.siyuan.languages.cut} ${window.siyuan.languages.headings1}`,click(){ae("/api/block/getHeadingChildrenDOM",{id:s,removeFoldAttr:o.getAttribute("fold")!=="1"},m=>{St()?window.JSAndroid.writeHTMLClipboard(e.lute.BlockDOM2StdMd(m.data).trimEnd(),m.data+p.ZWSP):Qt()?window.JSHarmony.writeHTMLClipboard(e.lute.BlockDOM2StdMd(m.data).trimEnd(),m.data+p.ZWSP):ut(m.data+p.ZWSP),ae("/api/block/getHeadingDeleteTransaction",{id:s},b=>{if(b.data.doOperations.forEach(y=>{e.wysiwyg.element.querySelectorAll(`[data-node-id="${y.id}"]`).forEach(_=>{_.remove()})}),e.wysiwyg.element.childElementCount===0){const y=Lute.NewNodeID(),_=Fs(!1,!1,y);e.wysiwyg.element.insertAdjacentElement("afterbegin",_),b.data.doOperations.push({action:"insert",data:_.outerHTML,id:y,parentID:e.block.parentID}),b.data.undoOperations.push({action:"delete",id:y}),qt(_)}et(e,b.data.doOperations,b.data.undoOperations)})})}}).element),window.siyuan.menus.menu.append(new xe({id:"deleteHeadings1",icon:"iconTrashcan",label:`${window.siyuan.languages.delete} ${window.siyuan.languages.headings1}`,click(){ae("/api/block/getHeadingDeleteTransaction",{id:s},m=>{if(m.data.doOperations.forEach(b=>{e.wysiwyg.element.querySelectorAll(`[data-node-id="${b.id}"]`).forEach(y=>{y.remove()})}),e.wysiwyg.element.childElementCount===0){const b=Lute.NewNodeID(),y=Fs(!1,!1,b);e.wysiwyg.element.insertAdjacentElement("afterbegin",y),m.data.doOperations.push({action:"insert",data:y.outerHTML,id:b,parentID:e.block.parentID}),m.data.undoOperations.push({action:"delete",id:b}),qt(y)}et(e,m.data.doOperations,m.data.undoOperations)})}}).element)}if(window.siyuan.menus.menu.append(new xe({id:"separator_2",type:"separator"}).element),e.options.backlinkData?window.siyuan.menus.menu.append(new xe({id:"enter",accelerator:`${Mt(window.siyuan.config.keymap.general.enter.custom)}/${Mt("\u2318"+window.siyuan.languages.click)}`,label:window.siyuan.languages.openBy,click:()=>{na(s,(h,m)=>{dn({app:e.app,id:s,action:m,zoomIn:h})})}}).element):(window.siyuan.menus.menu.append(new xe({id:"enter",accelerator:`${window.siyuan.config.keymap.general.enter.custom?Mt(window.siyuan.config.keymap.general.enter.custom)+"/":""}${un("\u2318"+window.siyuan.languages.click)}`,label:window.siyuan.languages.enter,click:()=>{hi({protyle:e,id:s})}}).element),window.siyuan.menus.menu.append(new xe({id:"enterBack",accelerator:window.siyuan.config.keymap.general.enterBack.custom,label:window.siyuan.languages.enterBack,click:()=>{jv(e,s)}}).element)),!e.disabled){window.siyuan.menus.menu.append(new xe({id:"insertBefore",icon:"iconBefore",label:window.siyuan.languages.insertBefore,accelerator:window.siyuan.config.keymap.editor.general.insertBefore.custom,click(){Ut(["select"],e),ss([],e.block.rootID),Ms(e,"beforebegin",s)}}).element),window.siyuan.menus.menu.append(new xe({id:"insertAfter",icon:"iconAfter",label:window.siyuan.languages.insertAfter,accelerator:window.siyuan.config.keymap.editor.general.insertAfter.custom,click(){Ut(["select"],e),ss([],e.block.rootID),Ms(e,"afterend",s)}}).element);const h=o.lastElementChild.querySelector(".protyle-attr--refcount");h&&h.textContent&&kL(s)}if(window.siyuan.menus.menu.append(new xe({id:"jumpTo",type:"submenu",label:window.siyuan.languages.jumpTo,submenu:[{id:"jumpToParentPrev",iconHTML:"",label:window.siyuan.languages.jumpToParentPrev,accelerator:window.siyuan.config.keymap.editor.general.jumpToParentPrev.custom,click(){Ut(["select"],e),Cf(e,o,"previous")}},{iconHTML:"",id:"jumpToParentNext",label:window.siyuan.languages.jumpToParentNext,accelerator:window.siyuan.config.keymap.editor.general.jumpToParentNext.custom,click(){Ut(["select"],e),Cf(e,o,"next")}},{iconHTML:"",id:"jumpToParent",label:window.siyuan.languages.jumpToParent,accelerator:window.siyuan.config.keymap.editor.general.jumpToParent.custom,click(){Ut(["select"],e),Cf(e,o,"parent")}}]}).element),window.siyuan.menus.menu.append(new xe({id:"separator_3",type:"separator"}).element),l!=="NodeThematicBreak"&&(window.siyuan.menus.menu.append(new xe({id:"fold",label:window.siyuan.languages.fold,accelerator:`${Mt(window.siyuan.config.keymap.editor.general.collapse.custom)}/${Mt("\u2325"+window.siyuan.languages.click)}`,click(){La(e,o),qt(o)}}).element),e.disabled||window.siyuan.menus.menu.append(new xe({id:"attr",label:window.siyuan.languages.attr,icon:"iconAttr",accelerator:window.siyuan.config.keymap.editor.general.attr.custom+"/"+Mt("\u21E7"+window.siyuan.languages.click),click(){Ho(o,"bookmark",e)}}).element)),!e.disabled){const h=new xe({id:"appearance",label:window.siyuan.languages.appearance,icon:"iconFont",accelerator:window.siyuan.config.keymap.editor.insert.appearance.custom,click:()=>{e.toolbar.element.classList.add("fn__none"),e.toolbar.subElement.innerHTML="",e.toolbar.subElement.style.width="",e.toolbar.subElement.style.padding="",e.toolbar.subElement.append(Fv(e,[o])),e.toolbar.subElement.style.zIndex=(++window.siyuan.zIndex).toString(),e.toolbar.subElement.classList.remove("fn__none"),e.toolbar.subElementCloseCB=void 0;const m=o.getBoundingClientRect();gn(e.toolbar.subElement,m.left,m.top)}}).element;window.siyuan.menus.menu.append(h),x()||h.lastElementChild.classList.add("b3-menu__submenu--row"),this.genAlign([o],e),this.genWidths([o],e)}if(window.siyuan.menus.menu.append(new xe({id:"separator_4",type:"separator"}).element),window.siyuan.config.cloudRegion===0&&!["NodeThematicBreak","NodeBlockQueryEmbed","NodeIFrame","NodeHTMLBlock","NodeWidget","NodeVideo","NodeAudio"].includes(l)&&((a=Ee(o))==null?void 0:a.textContent.trim())!==""&&(l!=="NodeCodeBlock"||l==="NodeCodeBlock"&&!o.getAttribute("data-subtype"))&&window.siyuan.menus.menu.append(new xe({id:"wechatReminder",icon:"iconMp",label:window.siyuan.languages.wechatReminder,ignore:window.siyuan.config.readonly,click(){ZM(o)}}).element),l!=="NodeThematicBreak"&&!window.siyuan.config.readonly){const h=o.hasAttribute(p.CUSTOM_RIFF_DECKS);window.siyuan.menus.menu.append(new xe({id:h?"removeCard":"quickMakeCard",icon:"iconRiffCard",label:h?window.siyuan.languages.removeCard:window.siyuan.languages.quickMakeCard,accelerator:window.siyuan.config.keymap.editor.general.quickMakeCard.custom,click(){Mh(e,[o])}}).element),window.siyuan.menus.menu.append(new xe({id:"addToDeck",label:window.siyuan.languages.addToDeck,ignore:!window.siyuan.config.flashcard.deck,icon:"iconRiffCard",click(){Ih(e.app,[s])}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_5",type:"separator"}).element)}(i=e==null?void 0:e.app)!=null&&i.plugins&&Is({plugins:e.app.plugins,type:"click-blockicon",detail:{protyle:e,blockElements:[o]},separatorPosition:"bottom"});let f=o.getAttribute("updated")||"";return f&&(f=`${window.siyuan.languages.modifiedAt} ${at(f).format("YYYY-MM-DD HH:mm:ss")}<br>`),window.siyuan.menus.menu.append(new xe({id:"updateAndCreatedAt",iconHTML:"",type:"readonly",label:`${f}${window.siyuan.languages.createdAt} ${at(s.substr(0,14)).format("YYYY-MM-DD HH:mm:ss")}`}).element),window.siyuan.menus.menu}genHeadingTransform(e,n,a){return{id:"heading"+a,iconHTML:"",icon:"iconHeading"+a,label:window.siyuan.languages["heading"+a],click(){ae("/api/block/getHeadingLevelTransaction",{id:n,level:a},i=>{i.data.doOperations.forEach((s,r)=>{e.wysiwyg.element.querySelectorAll(`[data-node-id="${s.id}"]`).forEach(o=>{o.outerHTML=s.data}),e.wysiwyg.element.querySelectorAll(`[data-node-id="${s.id}"]`).forEach(o=>{Ei(o)}),r===0&&qt(e.wysiwyg.element.querySelector(`[data-node-id="${s.id}"]`),e.wysiwyg.element,!0)}),et(e,i.data.doOperations,i.data.undoOperations)})}}}genClick(e,n,a){lc(e,n,a),qt(e[0])}genAlign(e,n){window.siyuan.menus.menu.append(new xe({id:"layout",label:window.siyuan.languages.layout,type:"submenu",submenu:[{id:"alignLeft",icon:"iconAlignLeft",label:window.siyuan.languages.alignLeft,accelerator:window.siyuan.config.keymap.editor.general.alignLeft.custom,click:()=>{this.genClick(e,n,a=>{a.classList.contains("av")?a.style.justifyContent="":a.style.textAlign="left"})}},{id:"alignCenter",icon:"iconAlignCenter",label:window.siyuan.languages.alignCenter,accelerator:window.siyuan.config.keymap.editor.general.alignCenter.custom,click:()=>{this.genClick(e,n,a=>{a.classList.contains("av")?a.style.justifyContent="center":a.style.textAlign="center"})}},{id:"alignRight",icon:"iconAlignRight",label:window.siyuan.languages.alignRight,accelerator:window.siyuan.config.keymap.editor.general.alignRight.custom,click:()=>{this.genClick(e,n,a=>{a.classList.contains("av")?a.style.justifyContent="flex-end":a.style.textAlign="right"})}},{id:"justify",icon:"iconMenu",label:window.siyuan.languages.justify,click:()=>{this.genClick(e,n,a=>{a.style.textAlign="justify"})}},{id:"separator_1",type:"separator"},{id:"ltr",icon:"iconLtr",label:window.siyuan.languages.ltr,accelerator:window.siyuan.config.keymap.editor.general.ltr.custom,click:()=>{this.genClick(e,n,a=>{a.style.direction="ltr"})}},{id:"rtl",icon:"iconRtl",label:window.siyuan.languages.rtl,accelerator:window.siyuan.config.keymap.editor.general.rtl.custom,click:()=>{this.genClick(e,n,a=>{a.classList.contains("av")||(a.style.direction="rtl")})}},{id:"separator_2",type:"separator"},{id:"clearFontStyle",icon:"iconTrashcan",label:window.siyuan.languages.clearFontStyle,click:()=>{this.genClick(e,n,a=>{a.classList.contains("av")?a.style.justifyContent="":(a.style.textAlign="",a.style.direction="")})}}]}).element)}updateNodeElements(e,n,a){const i=[],s=[];e.forEach(r=>{i.push({action:"update",id:r.getAttribute("data-node-id"),data:r.outerHTML})}),a.addEventListener(a.type==="number"?"blur":"change",()=>{e.forEach(r=>{s.push({action:"update",id:r.getAttribute("data-node-id"),data:r.outerHTML})}),et(n,s,i),window.siyuan.menus.menu.remove(),qt(e[0])})}genWidths(e,n){let a;const i=e[0],s=[{id:"widthInput",iconHTML:"",type:"readonly",label:`<div class="fn__flex"><input class="b3-text-field fn__flex-1" value="${i.style.width.endsWith("px")?parseInt(i.style.width):""}" type="number" style="margin: 4px 8px 4px 0" placeholder="${window.siyuan.languages.width}"><span class="fn__flex-center">px</span></div>`,bind:o=>{const l=o.querySelector("input");l.addEventListener("input",()=>{e.forEach(c=>{c.style.width=l.value+"px",c.style.flex="none"}),a.value="0",a.parentElement.setAttribute("aria-label",l.value+"px")}),this.updateNodeElements(e,n,l)}}];["25%","33%","50%","67%","75%","100%"].forEach(o=>{s.push({id:"width_"+o,iconHTML:"",label:o,click:()=>{this.genClick(e,n,l=>{l.style.width=o,l.style.flex="none"})}})}),s.push({id:"separator_1",type:"separator"});const r=i.style.width.endsWith("%")?parseInt(i.style.width):0;window.siyuan.menus.menu.append(new xe({id:"width",label:window.siyuan.languages.width,submenu:s.concat([{id:"widthDrag",iconHTML:"",type:"readonly",label:`<div style="margin: 4px 0;" aria-label="${i.style.width.endsWith("px")?i.style.width:i.style.width||window.siyuan.languages.default}" class="b3-tooltips b3-tooltips__n"><input style="box-sizing: border-box" value="${r}" class="b3-slider fn__block" max="100" min="1" step="1" type="range"></div>`,bind:o=>{a=o.querySelector("input"),a.addEventListener("input",()=>{e.forEach(l=>{l.style.width=a.value+"%",l.style.flex="none"}),a.parentElement.setAttribute("aria-label",`${a.value}%`)}),this.updateNodeElements(e,n,a)}},{id:"separator_2",type:"separator"},{id:"default",iconHTML:"",label:window.siyuan.languages.default,click:()=>{this.genClick(e,n,o=>{o.style.width&&(o.style.width="",o.style.flex="")})}}])}).element)}genHeights(e,n){if(e.find(l=>{if(!l.classList.contains("p")&&!l.classList.contains("code-block")&&!l.classList.contains("render-node"))return!0}))return;let i;const s=e[0],r=[{id:"heightInput",iconHTML:"",type:"readonly",label:`<div class="fn__flex"><input class="b3-text-field fn__flex-1" value="${s.style.height.endsWith("px")?parseInt(s.style.height):""}" type="number" style="margin: 4px 8px 4px 0" placeholder="${window.siyuan.languages.height}"><span class="fn__flex-center">px</span></div>`,bind:l=>{const c=l.querySelector("input");c.addEventListener("input",()=>{e.forEach(d=>{d.style.height=c.value+"px",d.style.flex="none"}),i.value="0",i.parentElement.setAttribute("aria-label",c.value+"px")}),this.updateNodeElements(e,n,c)}}];["25%","33%","50%","67%","75%","100%"].forEach(l=>{r.push({id:"height_"+l,iconHTML:"",label:l,click:()=>{this.genClick(e,n,c=>{c.style.height=l,c.style.flex="none"})}})}),r.push({type:"separator"});const o=s.style.height.endsWith("%")?parseInt(s.style.height):0;window.siyuan.menus.menu.append(new xe({id:"heightDrag",label:window.siyuan.languages.height,submenu:r.concat([{iconHTML:"",type:"readonly",label:`<div style="margin: 4px 0;" aria-label="${s.style.height.endsWith("px")?s.style.height:s.style.height||window.siyuan.languages.default}" class="b3-tooltips b3-tooltips__n"><input style="box-sizing: border-box" value="${o}" class="b3-slider fn__block" max="100" min="1" step="1" type="range"></div>`,bind:l=>{i=l.querySelector("input"),i.addEventListener("input",()=>{e.forEach(c=>{c.style.height=i.value+"%",c.style.flex="none"}),i.parentElement.setAttribute("aria-label",`${i.value}%`)}),this.updateNodeElements(e,n,i)}},{type:"separator"},{id:"default",iconHTML:"",label:window.siyuan.languages.default,click:()=>{this.genClick(e,n,l=>{l.style.height&&(l.style.height="",l.style.overflow="")})}}])}).element)}genCopyTextRef(e){return pt(e[0])?!1:{id:"copyText",iconHTML:"",accelerator:window.siyuan.config.keymap.editor.general.copyText.custom,label:window.siyuan.languages.copyText,click(){e[0].setAttribute("data-reftext","true"),Pt(hn(e[0])),document.execCommand("copy")}}}render(e,n,a,i){var s;if(e.title&&e.title.element.getAttribute("data-render")!=="true")return;const r=a.parentElement.parentElement.querySelector(".protyle-select");if(r&&!r.classList.contains("fn__none"))return;let o="",l=n,c=0,d=0,u,g=!1;for(;l;){let v=oe(l.parentElement);if(!ge(l)){let U;g||(U=l.getAttribute("data-type"));let ee=l.getAttribute("data-node-id");if(U==="NodeAttributeView"&&i){const B=N(i,"av__row");if(B&&!B.classList.contains("av__row--header")&&B.dataset.id){n=B;const H=N(B,"av__body");let j=Jt()?window.siyuan.languages.rowTip:window.siyuan.languages.rowTip.replace("\u21E7","Shift+");e.disabled?j=window.siyuan.languages.rowTip.substring(0,window.siyuan.languages.rowTip.indexOf("<br")):((s=B.querySelector('[data-dtype="block"]'))==null?void 0:s.getAttribute("data-detached"))==="true"&&(j=window.siyuan.languages.rowTip.substring(0,window.siyuan.languages.rowTip.lastIndexOf("<br"))),o=`<button data-type="NodeAttributeViewRowMenu" data-node-id="${ee}" data-row-id="${B.dataset.id}" data-group-id="${H.dataset.groupId||""}" class="ariaLabel" data-position="parentW" aria-label="${j}"><svg><use xlink:href="#iconDrag"></use></svg><span ${e.disabled?"":'draggable="true" class="fn__grab"'}></span></button>`,e.disabled||(o=`<button data-type="NodeAttributeViewRow" data-node-id="${ee}" data-row-id="${B.dataset.id}" data-group-id="${H.dataset.groupId||""}" class="ariaLabel" data-position="parentW" aria-label="${Jt()?window.siyuan.languages.addBelowAbove:window.siyuan.languages.addBelowAbove.replace("\u2325","Alt+")}"><svg><use xlink:href="#iconAdd"></use></svg></button>${o}`);break}}if(d===0){if(["NodeBlockquote","NodeList","NodeSuperBlock"].includes(U))return;const B=It(l);u=B.querySelector(".li")||B.querySelector(".list"),(ge(u)||ve(u))&&(u=void 0),B!==l&&U!=="NodeHeading"&&(l=B,v=oe(l.parentElement),U=l.getAttribute("data-type"),ee=l.getAttribute("data-node-id"))}U==="NodeListItem"&&d===1&&(o=""),d+=1;let Z=this.gutterTip;e.disabled&&(Z=this.gutterTip.split("<br>").splice(0,2).join("<br>"));let k="";e.options.backlinkData&&(k=`class="popover__block" data-id="${ee}"`);const w=`<button class="ariaLabel" data-position="parentW" aria-label="${Z}" 
data-type="${U}" data-subtype="${l.getAttribute("data-subtype")}" data-node-id="${ee}">
    <svg><use xlink:href="#${Qi(U,l.getAttribute("data-subtype"))}"></use></svg>
    <span ${k} ${e.disabled?"":'draggable="true"'}></span>
</button>`;g||(o=w+o);let S="";if(U==="NodeListItem"&&l.childElementCount>3||U==="NodeHeading"){const B=l.getAttribute("fold");S=`<button class="ariaLabel" data-position="parentW" aria-label="${window.siyuan.languages.fold}" 
data-type="fold" style="cursor:inherit;"><svg style="width: 10px${B&&B==="1"?"":";transform:rotate(90deg)"}"><use xlink:href="#iconPlay"></use></svg></button>`}if((U==="NodeListItem"||U==="NodeList")&&(u=l,U==="NodeListItem"&&l.childElementCount>3&&(o=w+S)),U==="NodeHeading"&&(o=o+S),U==="NodeBlockquote"&&(c+=8),l.previousElementSibling&&l.previousElementSibling.getAttribute("data-node-id")){if(g=!0,v&&v.getAttribute("fold")==="1")return;v&&v.getAttribute("data-type")==="NodeBlockquote"&&(c+=8)}}if(v)l=v;else break}let f=!0;const h=this.element.querySelectorAll("button");if(h.length!==o.split("</button>").length-1?f=!1:Array.from(h).find(v=>{const U=v.getAttribute("data-node-id");if(U&&o.indexOf(U)===-1)return f=!1,!0;const ee=v.getAttribute("data-row-id");if(ee&&o.indexOf(ee)===-1||!ee&&o.indexOf("NodeAttributeViewRowMenu")>-1)return f=!1,!0}),f&&this.element.childElementCount>0){this.element.classList.remove("fn__none");return}this.element.innerHTML=o,this.element.classList.remove("fn__none"),this.element.style.width="";const m=a.parentElement.getBoundingClientRect().top;let b=n.getBoundingClientRect(),y=0;u&&!window.siyuan.config.editor.rtl&&getComputedStyle(n).direction!=="rtl"?(b=u.firstElementChild.getBoundingClientRect(),c=0):l.getAttribute("data-type")==="NodeBlockQueryEmbed"?(b=l.getBoundingClientRect(),c=0):n.classList.contains("av__row")||(b.height<Math.floor(window.siyuan.config.editor.fontSize*1.625)+8||b.height>Math.floor(window.siyuan.config.editor.fontSize*1.625)+8&&b.height<Math.floor(window.siyuan.config.editor.fontSize*1.625)*2+8?y=(b.height-this.element.clientHeight)/2:(l.getAttribute("data-type")==="NodeAttributeView"||n.getAttribute("data-type")==="NodeAttributeView")&&m<b.top&&(y=8)),this.element.style.top=`${Math.max(b.top,m)+y}px`;let _=b.left-this.element.clientWidth-c;l.getAttribute("data-type")==="NodeBlockQueryEmbed"&&this.element.childElementCount===1?_=l.getBoundingClientRect().left-this.element.clientWidth-c:n.classList.contains("av__row")&&(_=l.getBoundingClientRect().left-this.element.clientWidth-c+parseInt(getComputedStyle(l).paddingLeft)),this.element.style.left=`${_}px`,_<this.element.parentElement.getBoundingClientRect().left?(this.element.style.width="24px",this.element.style.left=`${b.left-this.element.clientWidth-c/2+3}px`,o="",Array.from(this.element.children).reverse().forEach((v,U)=>{U!==0&&(v.firstElementChild.style.height="14px"),o+=v.outerHTML}),this.element.innerHTML=o):this.element.querySelectorAll("svg").forEach(v=>{v.style.height=""})}}class ZW{constructor(e){this.SAMPLE_RATE=44100,this.isRecording=!1,this.readyFlag=!1,this.leftChannel=[],this.rightChannel=[],this.recordingLength=0;let n;if(typeof AudioContext!="undefined")n=new AudioContext;else if(webkitAudioContext)n=new webkitAudioContext;else return;this.DEFAULT_SAMPLE_RATE=n.sampleRate;const a=n.createGain();n.createMediaStreamSource(e).connect(a),this.recorder=n.createScriptProcessor(2048,2,1),this.recorder.onaudioprocess=null,a.connect(this.recorder),this.recorder.connect(n.destination),this.readyFlag=!0}cloneChannelData(e,n){this.leftChannel.push(new Float32Array(e)),this.rightChannel.push(new Float32Array(n)),this.recordingLength+=2048}startRecordingNewWavFile(){this.readyFlag&&(this.isRecording=!0,this.leftChannel.length=this.rightChannel.length=0,this.recordingLength=0)}stopRecording(){this.isRecording=!1}buildWavFileBlob(){const e=this.mergeBuffers(this.leftChannel),n=this.mergeBuffers(this.rightChannel);let a=new Float32Array(e.length);for(let u=0;u<e.length;++u)a[u]=.5*(e[u]+n[u]);this.DEFAULT_SAMPLE_RATE>this.SAMPLE_RATE&&(a=this.downSampleBuffer(a,this.SAMPLE_RATE));const i=44+a.length*2,s=new ArrayBuffer(i),r=new DataView(s);this.writeUTFBytes(r,0,"RIFF"),r.setUint32(4,i,!0),this.writeUTFBytes(r,8,"WAVE"),this.writeUTFBytes(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,1,!0),r.setUint32(24,this.SAMPLE_RATE,!0),r.setUint32(28,this.SAMPLE_RATE*2,!0),r.setUint16(32,2,!0),r.setUint16(34,16,!0);const o=a.length*2;this.writeUTFBytes(r,36,"data"),r.setUint32(40,o,!0);const l=a.length;let c=44;const d=1;for(let u=0;u<l;u++)r.setInt16(c,a[u]*(32767*d),!0),c+=2;return new Blob([r],{type:"audio/wav"})}downSampleBuffer(e,n){if(n===this.DEFAULT_SAMPLE_RATE||n>this.DEFAULT_SAMPLE_RATE)return e;const a=this.DEFAULT_SAMPLE_RATE/n,i=Math.round(e.length/a),s=new Float32Array(i);let r=0,o=0;for(;r<s.length;){const l=Math.round((r+1)*a);let c=0,d=0;for(let u=o;u<l&&u<e.length;u++)c+=e[u],d++;s[r]=c/d,r++,o=l}return s}mergeBuffers(e){const n=new Float32Array(this.recordingLength);let a=0;const i=e.length;for(let s=0;s<i;++s){const r=e[s];n.set(r,a),a+=r.length}return n}writeUTFBytes(e,n,a){const i=a.length;for(let s=0;s<i;s++)e.setUint8(n+s,a.charCodeAt(s))}}var JW=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const UE=(t,e,n)=>{if(Pa(),!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_TITLE){window.siyuan.menus.menu.remove();return}ae("/api/block/getDocInfo",{id:t.block.rootID},a=>{var i;window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_TITLE);const s=me(t.element,"block__popover",!0);if(window.siyuan.menus.menu.element.setAttribute("data-from",s?s.dataset.level+"popover-"+n:"app-"+n),window.siyuan.menus.menu.append(new xe({id:"copy",label:window.siyuan.languages.copy,icon:"iconCopy",type:"submenu",submenu:sc([t.block.rootID],!0,void 0,t.block.showAll?t.block.id:t.block.rootID)}).element),!t.disabled){window.siyuan.menus.menu.append(ix([t.path]));const r=getSelection().rangeCount>0?getSelection().getRangeAt(0):void 0;window.siyuan.menus.menu.append(new xe({id:"addToDatabase",label:window.siyuan.languages.addToDatabase,accelerator:window.siyuan.config.keymap.general.addToDatabase.custom,icon:"iconDatabase",click:()=>{qy(t,r,"title")}}).element),window.siyuan.menus.menu.append(new xe({id:"delete",icon:"iconTrashcan",label:window.siyuan.languages.delete,click:()=>{y2(t.notebookId,t.path)}}).element)}if(window.siyuan.menus.menu.append(new xe({id:"separator_1",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"outline",icon:"iconAlignCenter",label:window.siyuan.languages.outline,accelerator:window.siyuan.config.keymap.editor.general.outline.custom,click:()=>{wx({app:t.app,rootId:t.block.rootID,title:t.options.render.title?t.title.editElement.textContent||window.siyuan.languages.untitled:"",isPreview:!t.preview.element.classList.contains("fn__none")})}}).element),window.siyuan.menus.menu.append(new xe({id:"backlinks",icon:"iconLink",label:window.siyuan.languages.backlinks,accelerator:window.siyuan.config.keymap.editor.general.backlinks.custom,click:()=>{Jh({app:t.app,blockId:t.block.id,rootId:t.block.rootID,useBlockId:t.block.showAll,title:t.title?t.title.editElement.textContent||window.siyuan.languages.untitled:null})}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_2",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"attr",label:window.siyuan.languages.attr,icon:"iconAttr",accelerator:window.siyuan.config.keymap.editor.general.attr.custom+"/"+Mt("\u21E7"+window.siyuan.languages.click),click(){Zs(a.data.ial,"bookmark",t)}}).element),!window.siyuan.config.readonly){window.siyuan.config.cloudRegion===0&&window.siyuan.menus.menu.append(new xe({id:"wechatReminder",label:window.siyuan.languages.wechatReminder,icon:"iconMp",click(){JM(t)}}).element);const r=!!a.data.ial[p.CUSTOM_RIFF_DECKS],o=[{id:"spaceRepetition",iconHTML:"",label:window.siyuan.languages.spaceRepetition,accelerator:window.siyuan.config.keymap.editor.general.spaceRepetition.custom,click:()=>{ae("/api/riff/getTreeRiffDueCards",{rootID:t.block.rootID},l=>{Sd(t.app,l.data,"doc",t.block.rootID,l.data.name)})}},{id:"manage",iconHTML:"",label:window.siyuan.languages.manage,click:()=>{ae("/api/filetree/getHPathByID",{id:t.block.rootID},l=>{vf(t.app,t.block.rootID,_n().join(Ds(t.notebookId),l.data),"Tree")})}},{id:r?"removeCard":"quickMakeCard",iconHTML:"",label:r?window.siyuan.languages.removeCard:window.siyuan.languages.quickMakeCard,accelerator:window.siyuan.config.keymap.editor.general.quickMakeCard.custom,click:()=>{var l;let c=(l=t.title)==null?void 0:l.element;c||(c=document.createElement("div"),c.setAttribute("data-node-id",t.block.rootID),c.setAttribute(p.CUSTOM_RIFF_DECKS,a.data.ial[p.CUSTOM_RIFF_DECKS])),Mh(t,[c])}}];window.siyuan.config.flashcard.deck&&o.push({id:"addToDeck",iconHTML:"",label:window.siyuan.languages.addToDeck,click:()=>{Ih(t.app,[t.block.rootID])}}),window.siyuan.menus.menu.append(new xe({id:"riffCard",label:window.siyuan.languages.riffCard,type:"submenu",icon:"iconRiffCard",submenu:o}).element)}window.siyuan.menus.menu.append(new xe({id:"search",label:window.siyuan.languages.search,icon:"iconSearch",accelerator:window.siyuan.config.keymap.general.search.custom,click(){return JW(this,null,function*(){const r=ha(t.path,!1,!0);ds({app:t.app,hotkey:p.DIALOG_SEARCH,notebookId:t.notebookId,searchPath:r})})}}).element),t.disabled||kL(t.block.rootID),window.siyuan.menus.menu.append(new xe({id:"separator_3",type:"separator"}).element),t.model||window.siyuan.menus.menu.append(new xe({id:"openBy",label:window.siyuan.languages.openBy,icon:"iconOpen",click(){dn({app:t.app,id:t.block.id,action:t.block.rootID!==t.block.id?[p.CB_GET_ALL,p.CB_GET_FOCUS]:[p.CB_GET_CONTEXT]})}}).element),t.disabled||window.siyuan.menus.menu.append(new xe({id:"fileHistory",label:window.siyuan.languages.fileHistory,icon:"iconHistory",click(){x2({app:t.app,id:t.block.rootID,notebookId:t.notebookId,pathString:a.data.name})}}).element),window.siyuan.menus.menu.append($S(t.block.showAll?t.block.id:t.block.rootID)),window.siyuan.menus.menu.append(new xe({id:"separator_4",type:"separator"}).element),(i=t==null?void 0:t.app)!=null&&i.plugins&&Is({plugins:t.app.plugins,type:"click-editortitleicon",detail:{protyle:t,data:a.data},separatorPosition:"bottom"}),window.siyuan.menus.menu.append(new xe({id:"updateAndCreatedAt",iconHTML:"",type:"readonly",label:`${window.siyuan.languages.modifiedAt} ${at(a.data.ial.updated).format("YYYY-MM-DD HH:mm:ss")}<br>${window.siyuan.languages.createdAt} ${at(a.data.ial.id.substr(0,14)).format("YYYY-MM-DD HH:mm:ss")}`}).element),window.siyuan.menus.menu.popup(e)})},QW=()=>{const t=new fe({title:window.siyuan.languages.about5,content:`<div class="b3-dialog__content">
    <input class="b3-text-field fn__block" placeholder="${window.siyuan.languages.about5}" value="${window.siyuan.config.accessAuthCode}">
    <div class="b3-label__text">${window.siyuan.languages.about6}</div>
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"}),e=t.element.querySelector("input"),n=t.element.querySelectorAll(".b3-button");t.element.setAttribute("data-key",p.DIALOG_ACCESSAUTHCODE),t.bindInput(e,()=>{n[1].click()}),e.select(),n[0].addEventListener("click",()=>{t.destroy()}),n[1].addEventListener("click",()=>{ae("/api/system/setAccessAuthCode",{accessAuthCode:e.value})})},ks=t=>{const e=window.siyuan.config.cloudRegion===0?"https://ld246.com":"https://liuyun.io";return!t||t===""?e:`${e}/${t}`},SL=t=>`https://b3log.org/siyuan${window.siyuan.config.lang==="zh_CN"?"":"/en"}/${t}`;var eV=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class tV{constructor(e){const n=document.createElement("div");n.className="protyle-breadcrumb";let a="";(yn()||St()||Qt())&&(a=`<button class="block__icon fn__flex-center ariaLabel" disabled aria-label="${window.siyuan.languages.undo}" data-type="undo"><svg><use xlink:href="#iconUndo"></use></svg></button>
<button class="block__icon fn__flex-center ariaLabel" disabled aria-label="${window.siyuan.languages.redo}" data-type="redo"><svg><use xlink:href="#iconRedo"></use></svg></button>
<button class="block__icon fn__flex-center ariaLabel" disabled aria-label="${window.siyuan.languages.outdent}" data-type="outdent"><svg><use xlink:href="#iconOutdent"></use></svg></button>
<button class="block__icon fn__flex-center ariaLabel" disabled aria-label="${window.siyuan.languages.indent}" data-type="indent"><svg><use xlink:href="#iconIndent"></use></svg></button>`),n.innerHTML=`${x()?`<button class="protyle-breadcrumb__icon" data-type="mobile-menu">${window.siyuan.languages.breadcrumb}</button>`:'<div class="protyle-breadcrumb__bar"></div>'}
<span class="protyle-breadcrumb__space"></span>
<button class="protyle-breadcrumb__icon fn__none ariaLabel" aria-label="${Mt(window.siyuan.config.keymap.editor.general.exitFocus.custom)}" data-type="exit-focus">${window.siyuan.languages.exitFocus}</button>
${a}
<button class="block__icon fn__flex-center ariaLabel${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.lockEdit}" data-type="readonly" data-subtype="unlock"><svg><use xlink:href="#iconUnlock"></use></svg></button>

<button class="block__icon fn__flex-center ariaLabel" data-type="doc" aria-label="${Jt()?window.siyuan.languages.gutterTip2:window.siyuan.languages.gutterTip2.replace("\u21E7","Shift+")}"><svg><use xlink:href="#iconFile"></use></svg></button>
<button class="block__icon fn__flex-center ariaLabel" data-type="more" aria-label="${window.siyuan.languages.more}"><svg><use xlink:href="#iconMore"></use></svg></button>
<button class="block__icon fn__flex-center fn__none ariaLabel" data-type="context" aria-label="${window.siyuan.languages.context}"><svg><use xlink:href="#iconAlignCenter"></use></svg></button>`,this.element=n.firstElementChild,n.addEventListener("click",i=>{let s=i.target;for(;s&&!s.isEqualNode(n);){const r=s.getAttribute("data-node-id"),o=s.getAttribute("data-type");if(r){e.options.render.breadcrumbDocName&&window.siyuan.ctrlIsPressed?dn({app:e.app,id:r,action:r===e.block.rootID?[p.CB_GET_FOCUS]:[p.CB_GET_FOCUS,p.CB_GET_ALL]}):hi({protyle:e,id:r}),i.preventDefault();break}else if(o==="mobile-menu"){this.genMobileMenu(e),i.preventDefault(),i.stopPropagation();break}else if(o==="doc"){if(i.shiftKey)ae("/api/block/getDocInfo",{id:e.block.rootID},l=>{Zs(l.data.ial,"bookmark",e)});else{const l=s.getBoundingClientRect();UE(e,{x:l.right,y:l.bottom,isLeft:!0},p.MENU_FROM_TITLE_BREADCRUMB)}i.stopPropagation(),i.preventDefault();break}else if(o==="more"){const l=s.getBoundingClientRect();this.showMenu(e,{x:l.right,y:l.bottom,isLeft:!0}),i.stopPropagation(),i.preventDefault();break}else if(o==="readonly"){_2(s,e),i.stopPropagation(),i.preventDefault();break}else if(o==="exit-focus"){hi({protyle:e,id:e.block.rootID,focusId:e.block.id}),i.stopPropagation(),i.preventDefault();break}else if(o==="context"){i.stopPropagation(),i.preventDefault(),s.classList.contains("block__icon--active")?(hi({protyle:e,id:e.options.blockId}),s.classList.remove("block__icon--active")):(ae("/api/filetree/getDoc",{id:e.options.blockId,mode:3,size:window.siyuan.config.editor.dynamicLoadBlocks},l=>{_a({data:l,protyle:e,action:[p.CB_GET_HL]})}),s.classList.add("block__icon--active"));break}else if(o==="undo"){e.undo.undo(e),i.preventDefault(),i.stopPropagation();break}else if(o==="redo"){e.undo.redo(e),i.preventDefault(),i.stopPropagation();break}else if(o==="outdent"){if(e.toolbar.range){const l=oe(e.toolbar.range.startContainer);l&&Uh(e,[l.parentElement],e.toolbar.range)}i.preventDefault(),i.stopPropagation();break}else if(o==="indent"){if(e.toolbar.range){const l=oe(e.toolbar.range.startContainer);l&&Jv(e,[l.parentElement],e.toolbar.range)}i.preventDefault(),i.stopPropagation();break}s=s.parentElement}}),n.addEventListener("mouseleave",()=>{e.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--hl").forEach(i=>{i.classList.remove("protyle-wysiwyg--hl")})}),this.element.addEventListener("mousewheel",i=>{this.element.scrollLeft=this.element.scrollLeft+i.deltaY},{passive:!0})}startRecord(e){this.messageId=Q(`<div class="fn__flex fn__flex-wrap">
<span class="fn__flex-center">${window.siyuan.languages.recording}</span><span class="fn__space"></span>
<button class="b3-button b3-button--white">${window.siyuan.languages.endRecord}</button></div>`,-1),document.querySelector(`#message [data-id="${this.messageId}"] button`).addEventListener("click",()=>{this.stopRecordingAndUpload(e)}),this.mediaRecorder.startRecordingNewWavFile()}stopRecordingAndUpload(e){this.mediaRecorder.stopRecording(),ot(this.messageId);const n=new File([this.mediaRecorder.buildWavFileBlob()],`record${new Date().getTime()}.wav`,{type:"video/webm"});_l(e,[n])}handleRecordClick(e,n){return eV(this,null,function*(){var a;console.log("NEURALINK_BREADCRUMB_RECORD_CLICKED"),(a=this.mediaRecorder)!=null&&a.isRecording?this.stopRecordingAndUpload(e):this.mediaRecorder?(ot(this.messageId),this.startRecord(e)):navigator.mediaDevices.getUserMedia({audio:!0}).then(i=>{this.mediaRecorder=new ZW(i),this.mediaRecorder.recorder.onaudioprocess=s=>{if(!this.mediaRecorder.isRecording)return;const r=s.inputBuffer.getChannelData(0),o=s.inputBuffer.getChannelData(1);this.mediaRecorder.cloneChannelData(r,o)},this.startRecord(e)}).catch(()=>{Q(window.siyuan.languages["record-tip"])}),this.updateRecordButtonState(n)})}updateRecordButtonState(e){var n;const a=(n=this.mediaRecorder)==null?void 0:n.isRecording;e.setAttribute("aria-label",a?window.siyuan.languages.endRecord:window.siyuan.languages.startRecord),e.classList.toggle("block__icon--active",a)}genMobileMenu(e){const n=new ta(p.MENU_BREADCRUMB_MOBILE_PATH);let a;if(getSelection().rangeCount>0){const s=getSelection().getRangeAt(0);!e.wysiwyg.element.isEqualNode(s.startContainer)&&!e.wysiwyg.element.contains(s.startContainer)?a=st(e.wysiwyg.element.firstElementChild)||e.wysiwyg.element.firstElementChild:a=oe(s.startContainer)}a||(a=st(e.wysiwyg.element.firstElementChild)||e.wysiwyg.element.firstElementChild);const i=a.getAttribute("data-node-id");ae("/api/block/getBlockBreadcrumb",{id:i,excludeTypes:[]},s=>{s.data.forEach(r=>{let o=!1;(!e.block.showAll&&r.id===e.block.parentID||e.block.showAll&&r.id===e.block.id)&&(o=!0),n.addItem({current:o,icon:Qi(r.type,r.subType),label:r.name,click(){hi({protyle:e,id:r.id})}})}),n.fullscreen()})}toggleExit(e){const n=this.element.parentElement.querySelector('[data-type="exit-focus"]');e?n.classList.add("fn__none"):n.classList.remove("fn__none")}showMenu(e,n){if(!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_BREADCRUMB_MORE){window.siyuan.menus.menu.remove();return}let a;const i=oe(hn(e.element).startContainer);i&&(a=i.getAttribute("data-node-id")),ae("/api/block/getTreeStat",{id:a||(e.block.showAll?e.block.id:e.block.rootID)},s=>{var r,o;if(window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_BREADCRUMB_MORE),!e.contentElement.classList.contains("fn__none")&&!e.disabled){let c="";c='<input class="b3-form__upload" type="file" multiple="multiple"',e.options.upload.accept?c+=` accept="${e.options.upload.accept}">`:c+=">";const d=new xe({id:"insertAsset",icon:"iconDownload",label:`${window.siyuan.languages.insertAsset}${c}`}).element;d.querySelector("input").addEventListener("change",u=>{u.target.files.length!==0&&(_l(e,u.target.files,u.target),window.siyuan.menus.menu.remove())}),window.siyuan.menus.menu.append(d)}if(e.disabled||(window.siyuan.menus.menu.append(new xe({id:"netImg2LocalAsset",label:window.siyuan.languages.netImg2LocalAsset,icon:"iconImgDown",accelerator:window.siyuan.config.keymap.editor.general.netImg2LocalAsset.custom,click(){Iy(e,"Img")}}).element),window.siyuan.menus.menu.append(new xe({id:"netAssets2LocalAssets",label:window.siyuan.languages.netAssets2LocalAssets,icon:"iconTransform",accelerator:window.siyuan.config.keymap.editor.general.netAssets2LocalAssets.custom,click(){Iy(e,"Assets")}}).element),window.siyuan.menus.menu.append(new xe({id:"uploadAssets2CDN",label:window.siyuan.languages.uploadAssets2CDN,icon:"iconCloudSucc",click(){Ml()||Sn("\u{1F4E6} "+window.siyuan.languages.uploadAssets2CDN,window.siyuan.languages.uploadAssets2CDNConfirmTip,()=>{ae("/api/asset/uploadCloud",{id:e.block.id})})}}).element),window.siyuan.user&&window.siyuan.menus.menu.append(new xe({id:"share2Liandi",label:window.siyuan.languages.share2Liandi,icon:"iconLiandi",click(){Sn("\u{1F929} "+window.siyuan.languages.share2Liandi,window.siyuan.languages.share2LiandiConfirmTip.replace("${accountServer}",ks("")),()=>{ae("/api/export/export2Liandi",{id:e.block.parentID})})}}).element)),(r=e.scroll)!=null&&r.element.classList.contains("fn__none")||window.siyuan.menus.menu.append(new xe({id:"keepLazyLoad",current:e.scroll.keepLazyLoad,label:window.siyuan.languages.keepLazyLoad,click:()=>{e.scroll.keepLazyLoad=!e.scroll.keepLazyLoad}}).element),window.siyuan.menus.menu.element.lastElementChild.childElementCount>0&&window.siyuan.menus.menu.append(new xe({id:"separator_1",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"refresh",icon:"iconRefresh",accelerator:window.siyuan.config.keymap.editor.general.refresh.custom,label:window.siyuan.languages.refresh,click:()=>{$o(e,!x())}}).element),e.disabled||window.siyuan.menus.menu.append(new xe({id:"optimizeTypography",label:window.siyuan.languages.optimizeTypography,accelerator:window.siyuan.config.keymap.editor.general.optimizeTypography.custom,icon:"iconFormat",click:()=>{Ut(["toolbar"],e),ae("/api/format/autoSpace",{id:e.block.rootID})}}).element),window.siyuan.menus.menu.append(new xe({id:"fullscreen",icon:e.element.className.includes("fullscreen")?"iconFullscreenExit":"iconFullscreen",accelerator:window.siyuan.config.keymap.editor.general.fullscreen.custom,label:window.siyuan.languages.fullscreen,click:()=>{kd(e.element),Ai(e)}}).element),window.siyuan.menus.menu.append(new xe({id:"editMode",icon:"iconEdit",label:window.siyuan.languages["edit-mode"],type:"submenu",submenu:[{id:"wysiwyg",current:!e.contentElement.classList.contains("fn__none"),label:window.siyuan.languages.wysiwyg,accelerator:window.siyuan.config.keymap.editor.general.wysiwyg.custom,click:()=>{Hd(e,"wysiwyg"),e.scroll.lastScrollTop=0,ae("/api/filetree/getDoc",{id:e.block.id,size:e.block.id===e.block.rootID?window.siyuan.config.editor.dynamicLoadBlocks:p.SIZE_GET_MAX},c=>{_a({data:c,protyle:e,action:e.block.id===e.block.rootID?[p.CB_GET_FOCUS,p.CB_GET_HTML,p.CB_GET_UNUNDO]:[p.CB_GET_ALL,p.CB_GET_FOCUS,p.CB_GET_UNUNDO,p.CB_GET_HTML]})}),Fi()}},{id:"preview",current:!e.preview.element.classList.contains("fn__none"),icon:"iconPreview",label:window.siyuan.languages.preview,accelerator:window.siyuan.config.keymap.editor.general.preview.custom,click:()=>{Hd(e,"preview"),window.siyuan.menus.menu.remove(),Fi()}}]}).element),!window.siyuan.config.editor.readOnly&&!window.siyuan.config.readonly){const c=e.wysiwyg.element.getAttribute(p.CUSTOM_SY_READONLY);window.siyuan.menus.menu.append(new xe({id:"editReadonly",label:window.siyuan.languages.editReadonly,icon:"iconLock",type:"submenu",submenu:[{id:"enable",iconHTML:"",current:c==="true",label:window.siyuan.languages.enable,click(){ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{[p.CUSTOM_SY_READONLY]:"true"}})}},{id:"disable",iconHTML:"",current:!c||c==="false",label:window.siyuan.languages.disable,click(){ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{[p.CUSTOM_SY_READONLY]:"false"}})}}]}).element)}if(!e.disabled){const c=e.wysiwyg.element.getAttribute(p.CUSTOM_SY_FULLWIDTH);window.siyuan.menus.menu.append(new xe({id:"fullWidth",label:window.siyuan.languages.fullWidth,icon:"iconDock",type:"submenu",submenu:[{id:"enable",iconHTML:"",current:c==="true",label:window.siyuan.languages.enable,click(){ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{[p.CUSTOM_SY_FULLWIDTH]:"true"}})}},{id:"disable",iconHTML:"",current:c==="false",label:window.siyuan.languages.disable,click(){ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{[p.CUSTOM_SY_FULLWIDTH]:"false"}})}},{id:"default",iconHTML:"",current:!c,label:window.siyuan.languages.default,click(){ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{[p.CUSTOM_SY_FULLWIDTH]:""}})}}]}).element)}(o=e==null?void 0:e.app)!=null&&o.plugins&&Is({plugins:e.app.plugins,type:"open-menu-breadcrumbmore",detail:{protyle:e,data:s.data.stat},separatorPosition:"top"}),window.siyuan.menus.menu.append(new xe({id:"separator_2",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"docInfo",iconHTML:"",type:"readonly",label:`<div class="fn__flex">${window.siyuan.languages.runeCount}<span class="fn__space fn__flex-1"></span>${s.data.stat.runeCount}</div><div class="fn__flex">${window.siyuan.languages.wordCount}<span class="fn__space fn__flex-1"></span>${s.data.stat.wordCount}</div><div class="fn__flex">${window.siyuan.languages.linkCount}<span class="fn__space fn__flex-1"></span>${s.data.stat.linkCount}</div><div class="fn__flex">${window.siyuan.languages.imgCount}<span class="fn__space fn__flex-1"></span>${s.data.stat.imageCount}</div><div class="fn__flex">${window.siyuan.languages.refCount}<span class="fn__space fn__flex-1"></span>${s.data.stat.refCount}</div><div class="fn__flex">${window.siyuan.languages.blockCount}<span class="fn__space fn__flex-1"></span>${s.data.stat.blockCount}</div>`}).element),window.siyuan.menus.menu.popup(n);const l=me(e.element,"block__popover",!0);window.siyuan.menus.menu.element.setAttribute("data-from",l?l.dataset.level+"popover":"app")})}render(e,n=!1,a){var i;let s,r;a&&!a.classList.contains("list")?r=a:getSelection().rangeCount>0&&(s=getSelection().getRangeAt(0),!e.wysiwyg.element.isEqualNode(s.startContainer)&&!e.wysiwyg.element.contains(s.startContainer)?e.element.id==="searchPreview"?r=oe(e.wysiwyg.element.querySelector('[data-type="search-mark"]')):r=st(e.wysiwyg.element.firstElementChild)||e.wysiwyg.element.firstElementChild:r=oe(s.startContainer)),r||(r=st(e.wysiwyg.element.firstElementChild)||e.wysiwyg.element.firstElementChild);const o=r.getAttribute("data-node-id");if(o===this.id&&!n){e.breadcrumb.element.querySelectorAll(".protyle-breadcrumb__item--active").forEach(d=>{d.classList.remove("protyle-breadcrumb__item--active")});const c=e.breadcrumb.element.querySelector(`[data-node-id="${e.block.showAll?e.block.id:e.block.parentID}"]`);c&&c.classList.add("protyle-breadcrumb__item--active");return}this.id=o;const l=[];(i=this.element.parentElement)!=null&&i.parentElement&&this.element.parentElement.parentElement.classList.contains("card__block")&&l.push("NodeTextMark-mark"),ae("/api/block/getBlockBreadcrumb",{id:o,excludeTypes:l},c=>{let d="";c.data.forEach((u,g)=>{let f=!1;(!e.block.showAll&&u.id===e.block.parentID||e.block.showAll&&u.id===e.block.id)&&(f=!0),g===0&&!e.options.render.breadcrumbDocName?d+=`<span class="protyle-breadcrumb__item${f?" protyle-breadcrumb__item--active":""}" data-node-id="${u.id}"${c.data.length===1?' style="max-width:none"':""}>
    <svg class="popover__block" data-id="${u.id}"><use xlink:href="#${Qi(u.type,u.subType)}"></use></svg>
</span>`:d+=`<span class="protyle-breadcrumb__item${f?" protyle-breadcrumb__item--active":""}" data-node-id="${u.id}"${c.data.length===1||g===0?' style="max-width:none"':""}>
    <svg class="popover__block" data-id="${u.id}"><use xlink:href="#${Qi(u.type,u.subType)}"></use></svg>
    ${u.name?`<span class="protyle-breadcrumb__text" title="${u.name}">${u.name}</span>`:""}
</span>`,g!==c.data.length-1&&(d+='<svg class="protyle-breadcrumb__arrow"><use xlink:href="#iconRight"></use></svg>')}),this.element.innerHTML=d,bx(this.element.parentElement)})}hide(){x()||(this.element.classList.add("protyle-breadcrumb__bar--hide"),window.siyuan.hideBreadcrumb=!0)}}const AL=t=>t.replace(/\u00a0/g," ");var HE=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class nV{constructor(e){var n;if(this.element=document.createElement("div"),this.element.className="protyle-title",window.siyuan.config.editor.displayBookmarkIcon&&this.element.classList.add("protyle-wysiwyg--attr"),(n=e.options.render)!=null&&n.titleShowTop)this.element.innerHTML='<div class="protyle-attr"></div>';else{this.element.innerHTML=`<span aria-label="${Jt()?window.siyuan.languages.gutterTip2:window.siyuan.languages.gutterTip2.replace("\u21E7","Shift+")}" data-position="west" class="protyle-title__icon ariaLabel"><svg><use xlink:href="#iconFile"></use></svg></span>
<div contenteditable="true" spellcheck="${window.siyuan.config.editor.spellcheck}" class="protyle-title__input" data-tip="${window.siyuan.languages._kernel[16]}"> </div><div class="protyle-attr"></div>`,this.editElement=this.element.querySelector(".protyle-title__input"),this.editElement.addEventListener("paste",i=>{i.stopPropagation(),i.preventDefault();let s=i.clipboardData.getData("text/siyuan");if(s){try{JSON.parse(s),s=i.clipboardData.getData("text/plain")}catch(r){}s=e.lute.BlockDOM2Content(s)}else s=i.clipboardData.getData("text/plain");setTimeout(function(){document.execCommand("insertText",!1,Wi(s))},0),this.rename(e)}),this.editElement.addEventListener("click",()=>{var i;(i=e.toolbar)==null||i.element.classList.add("fn__none")}),this.editElement.addEventListener("input",i=>{i.isComposing||(this.editElement.textContent===""&&this.editElement.querySelectorAll("br").forEach(s=>{s.remove()}),this.rename(e))}),this.editElement.addEventListener("compositionend",()=>{this.rename(e)}),this.editElement.addEventListener("drop",i=>{i.stopPropagation(),i.preventDefault()}),this.editElement.addEventListener("keydown",i=>HE(this,null,function*(){if(!i.isComposing){if(gS(e,i))return!0;if(Qe("\u21E7\u2318V",i)){i.preventDefault(),i.stopPropagation();let s=(yield yt())||"";if(s){s=s.replace(/</g,";;;lt;;;").replace(/>/g,";;;gt;;;"),Sh(e);let r=e.lute.BlockDOM2EscapeMarkerContent(e.lute.Md2BlockDOM(s));yf(e),r=r.replace(/;;;lt;;;[^;]+;;;gt;;;/g,""),document.execCommand("insertText",!1,Wi(r)),this.rename(e)}return}if(Qe(window.siyuan.config.keymap.general.enterBack.custom,i)){const s=e.path.split("/");s.length>2&&dn({app:e.app,id:s[s.length-2],action:[p.CB_GET_FOCUS,p.CB_GET_SCROLL]}),i.preventDefault(),i.stopPropagation();return}if(!uo(i))if(i.key==="ArrowDown"){const s=getSelection().getRangeAt(0).getClientRects();if(s.length===0||this.editElement.getBoundingClientRect().bottom-s[s.length-1].bottom<25){const r=st(e.wysiwyg.element.firstElementChild);r&&qt(r,e.wysiwyg.element),i.preventDefault(),i.stopPropagation()}}else if(i.key==="Enter"){const s=Ee(e.wysiwyg.element.firstElementChild);if(s&&s.textContent===""&&s.getAttribute("placeholder"))qt(e.wysiwyg.element.firstElementChild,e.wysiwyg.element);else{const r=Lute.NewNodeID(),o=Fs(!1,!0,r);e.wysiwyg.element.insertAdjacentElement("afterbegin",o),cn(o,e.toolbar.range||hn(o)),et(e,[{action:"insert",data:o.outerHTML,id:r,parentID:e.block.parentID}],[{action:"delete",id:r}])}i.preventDefault(),i.stopPropagation()}else Qe(window.siyuan.config.keymap.editor.general.attr.custom,i)?(ae("/api/block/getDocInfo",{id:e.block.rootID},s=>{Zs(s.data.ial,"bookmark",e)}),i.preventDefault(),i.stopPropagation()):Qe("\u2318A",i)&&(hn(this.editElement).selectNodeContents(this.editElement),i.preventDefault(),i.stopPropagation())}}));const a=this.element.querySelector(".protyle-title__icon");a.addEventListener("click",i=>{if(i.shiftKey)ae("/api/block/getDocInfo",{id:e.block.rootID},s=>{Zs(s.data.ial,"bookmark",e)});else{const s=a.getBoundingClientRect();UE(e,{x:s.left,y:s.bottom},p.MENU_FROM_TITLE_PROTYLE)}}),this.element.addEventListener("contextmenu",i=>{var s;if(i.shiftKey)return;if(getSelection().rangeCount===0||a.contains(i.target)){UE(e,{x:i.clientX,y:i.clientY},p.MENU_FROM_TITLE_PROTYLE);return}(s=e.toolbar)==null||s.element.classList.add("fn__none"),window.siyuan.menus.menu.remove();const r=hn(this.editElement);r.toString()!==""&&(window.siyuan.menus.menu.append(new xe({id:"copy",icon:"iconCopy",accelerator:"\u2318C",label:window.siyuan.languages.copy,click:()=>{Pt(hn(this.editElement)),document.execCommand("copy")}}).element),window.siyuan.menus.menu.append(new xe({id:"cut",icon:"iconCut",accelerator:"\u2318X",label:window.siyuan.languages.cut,click:()=>{Pt(hn(this.editElement)),document.execCommand("cut"),setTimeout(()=>{this.rename(e)},p.TIMEOUT_INPUT)}}).element),window.siyuan.menus.menu.append(new xe({id:"delete",icon:"iconTrashcan",accelerator:"\u232B",label:window.siyuan.languages.delete,click:()=>{const o=hn(this.editElement);o.extractContents(),Pt(o),setTimeout(()=>{this.rename(e)},p.TIMEOUT_INPUT)}}).element)),window.siyuan.menus.menu.append(new xe({id:"paste",label:window.siyuan.languages.paste,icon:"iconPaste",accelerator:"\u2318V",click:()=>HE(this,null,function*(){if(Pt(hn(this.editElement)),document.queryCommandSupported("paste"))document.execCommand("paste");else try{const o=(yield yt())||"";document.execCommand("insertText",!1,Wi(o)),this.rename(e)}catch(o){console.log(o)}})}).element),window.siyuan.menus.menu.append(new xe({id:"pasteAsPlainText",label:window.siyuan.languages.pasteAsPlainText,accelerator:"\u21E7\u2318V",click:()=>HE(this,null,function*(){let o=(yield yt())||"";o=o.replace(/</g,";;;lt;;;").replace(/>/g,";;;gt;;;"),Sh(e);let l=e.lute.BlockDOM2EscapeMarkerContent(e.lute.Md2BlockDOM(o));yf(e),l=l.replace(/;;;lt;;;[^;]+;;;gt;;;/g,""),document.execCommand("insertText",!1,Wi(l)),this.rename(e)})}).element),window.siyuan.menus.menu.append(new xe({id:"selectAll",label:window.siyuan.languages.selectAll,icon:"iconSelect",accelerator:"\u2318A",click:()=>{r.selectNodeContents(this.editElement),Pt(r)}}).element),window.siyuan.menus.menu.popup({x:i.clientX,y:i.clientY})})}this.element.querySelector(".protyle-attr").addEventListener("click",a=>{ae("/api/block/getDocInfo",{id:e.block.rootID},i=>{xL(a,e,i.data.ial)})})}rename(e){var n,a;if(clearTimeout(this.timeout),!xd(this.editElement.textContent,this.editElement)){const r=ya(this.editElement);return this.setTitle(this.editElement.textContent.substring(0,p.SIZE_TITLE)),nr(this.editElement,r.start,r.end),!1}Pa();const i=Wi(this.editElement.textContent)||window.siyuan.languages.untitled;e.model&&e.model.parent.updateTitle(i);const s=(a=(n=Vn("file"))==null?void 0:n.data)==null?void 0:a.file;if(s instanceof js){const r=s.element.querySelector(`ul[data-url="${e.notebookId}"] li[data-path="${e.path}"]`);if(r){const o=r.querySelector(".b3-list-item__text");o&&(o.innerHTML=he(i)),r.setAttribute("data-name",Lute.EscapeHTMLStr(i))}}this.timeout=window.setTimeout(()=>{const r=Wi(this.editElement.textContent);if(ae("/api/filetree/renameDoc",{notebook:e.notebookId,path:e.path,title:r}),r!==this.editElement.textContent){const o=ya(this.editElement);this.setTitle(r),nr(this.editElement,o.start,o.end)}Gg(r)},p.TIMEOUT_INPUT)}setTitle(e){AL(e)!==AL(this.editElement.textContent)&&(this.editElement.textContent=e===window.siyuan.languages.untitled?"":e)}render(e,n){var a;if(e.options.render.hideTitleOnZoom&&(e.block.showAll?this.element.classList.add("fn__none"):this.element.classList.remove("fn__none")),this.element.getAttribute("data-render")==="true"&&this.element.dataset.nodeId===e.block.rootID)return!1;this.element.setAttribute("data-node-id",e.block.rootID),n.data.ial[p.CUSTOM_RIFF_DECKS]&&this.element.setAttribute(p.CUSTOM_RIFF_DECKS,n.data.ial[p.CUSTOM_RIFF_DECKS]),(a=e.background)==null||a.render(n.data.ial,e.block.rootID),e.wysiwyg.renderCustom(n.data.ial),this.element.setAttribute("data-render","true"),this.setTitle(n.data.ial.title);let i="";if(n.data.ial.bookmark&&(i+=`<div class="protyle-attr--bookmark">${Lute.EscapeHTMLStr(n.data.ial.bookmark)}</div>`),n.data.ial.name&&(i+=`<div class="protyle-attr--name"><svg><use xlink:href="#iconN"></use></svg>${Lute.EscapeHTMLStr(n.data.ial.name)}</div>`),n.data.ial.alias&&(i+=`<div class="protyle-attr--alias"><svg><use xlink:href="#iconA"></use></svg>${Lute.EscapeHTMLStr(n.data.ial.alias)}</div>`),n.data.ial.memo&&(i+=`<div class="protyle-attr--memo ariaLabel" aria-label="${Lute.EscapeHTMLStr(n.data.ial.memo)}" data-position="north"><svg><use xlink:href="#iconM"></use></svg></div>`),n.data.ial["custom-avs"]){let s="";n.data.attrViews.forEach(r=>{s+=`<span data-av-id="${r.id}" data-popover-url="/api/av/getMirrorDatabaseBlocks" class="popover__block">${r.name}</span>&nbsp;`}),s&&(s=s.substring(0,s.length-6)),i+=`<div class="protyle-attr--av"><svg><use xlink:href="#iconDatabase"></use></svg>${s}</div>`}if(this.element.querySelector(".protyle-attr").innerHTML=i,n.data.refCount!==0&&this.element.querySelector(".protyle-attr").insertAdjacentHTML("beforeend",`<div class="protyle-attr--refcount popover__block">${n.data.refCount}</div>`),this.editElement&&new Date().getTime()-at(n.data.id.split("-")[0]).toDate().getTime()<2e3){const s=this.editElement.ownerDocument.createRange();s.selectNodeContents(this.editElement),Pt(s)}}}var TL=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const ww=["background:radial-gradient(black 3px, transparent 4px),radial-gradient(black 3px, transparent 4px),linear-gradient(#fff 4px, transparent 0),linear-gradient(45deg, transparent 74px, transparent 75px, #a4a4a4 75px, #a4a4a4 76px, transparent 77px, transparent 109px),linear-gradient(-45deg, transparent 75px, transparent 76px, #a4a4a4 76px, #a4a4a4 77px, transparent 78px, transparent 109px),#fff;background-size: 109px 109px, 109px 109px,100% 6px, 109px 109px, 109px 109px;background-position: 54px 55px, 0px 0px, 0px 0px, 0px 0px, 0px 0px;","background: linear-gradient(45deg, #dca 12%, transparent 0, transparent 88%, #dca 0),linear-gradient(135deg, transparent 37%, #a85 0, #a85 63%, transparent 0),linear-gradient(45deg, transparent 37%, #dca 0, #dca 63%, transparent 0) #753;background-size: 25px 25px;","background: linear-gradient(315deg, transparent 75%, #d45d55 0)-10px 0, linear-gradient(45deg, transparent 75%, #d45d55 0)-10px 0, linear-gradient(135deg, #a7332b 50%, transparent 0) 0 0, linear-gradient(45deg, #6a201b 50%, #561a16 0) 0 0 #561a16;background-size: 20px 20px;","background: linear-gradient(#ffffff 50%, rgba(255,255,255,0) 0) 0 0, radial-gradient(circle closest-side, #FFFFFF 53%, rgba(255,255,255,0) 0) 0 0, radial-gradient(circle closest-side, #FFFFFF 50%, rgba(255,255,255,0) 0) 55px 0 #48B;background-size: 110px 200px;background-repeat: repeat-x;","background:radial-gradient(circle farthest-side at 0% 50%,#fb1 23.5%,rgba(240,166,17,0) 0)21px 30px, radial-gradient(circle farthest-side at 0% 50%,#B71 24%,rgba(240,166,17,0) 0)19px 30px, linear-gradient(#fb1 14%,rgba(240,166,17,0) 0, rgba(240,166,17,0) 85%,#fb1 0)0 0, linear-gradient(150deg,#fb1 24%,#B71 0,#B71 26%,rgba(240,166,17,0) 0,rgba(240,166,17,0) 74%,#B71 0,#B71 76%,#fb1 0)0 0, linear-gradient(30deg,#fb1 24%,#B71 0,#B71 26%,rgba(240,166,17,0) 0,rgba(240,166,17,0) 74%,#B71 0,#B71 76%,#fb1 0)0 0, linear-gradient(90deg,#B71 2%,#fb1 0,#fb1 98%,#B71 0%)0 0 #fb1;background-size: 40px 60px;","background-color: gray;background-image: linear-gradient(transparent 50%, rgba(255,255,255,.5) 50%);background-size: 50px 50px;","background-color: gray;background-image: linear-gradient(90deg, transparent 50%, rgba(255,255,255,.5) 50%);background-size: 50px 50px;","background-color: #026873;background-image: linear-gradient(90deg, rgba(255,255,255,.07) 50%, transparent 50%),linear-gradient(90deg, rgba(255,255,255,.13) 50%, transparent 50%),linear-gradient(90deg, transparent 50%, rgba(255,255,255,.17) 50%),linear-gradient(90deg, transparent 50%, rgba(255,255,255,.19) 50%);background-size: 13px, 29px, 37px, 53px;","background-color: gray;background-image: repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255,255,255,.5) 35px, rgba(255,255,255,.5) 70px);","background-color:white;background-image: linear-gradient(90deg, rgba(200,0,0,.5) 50%, transparent 50%),linear-gradient(rgba(200,0,0,.5) 50%, transparent 50%);background-size:50px 50px;","background-color:#269;background-image: linear-gradient(white 2px, transparent 2px),linear-gradient(90deg, white 2px, transparent 2px),linear-gradient(rgba(255,255,255,.3) 1px, transparent 1px),linear-gradient(90deg, rgba(255,255,255,.3) 1px, transparent 1px);background-size: 100px 100px, 100px 100px, 20px 20px, 20px 20px;background-position:-2px -2px, -2px -2px, -1px -1px, -1px -1px;","background-color: #fff;background-image:linear-gradient(90deg, transparent 79px, #abced4 79px, #abced4 81px, transparent 81px),linear-gradient(#eee .1em, transparent .1em);background-size: 100% 1.2em;","background-color: hsl(34, 53%, 82%);background-image: repeating-linear-gradient(45deg, transparent 5px, hsla(197, 62%, 11%, 0.5) 5px, hsla(197, 62%, 11%, 0.5) 10px, hsla(5, 53%, 63%, 0) 10px, hsla(5, 53%, 63%, 0) 35px, hsla(5, 53%, 63%, 0.5) 35px, hsla(5, 53%, 63%, 0.5) 40px, hsla(197, 62%, 11%, 0.5) 40px, hsla(197, 62%, 11%, 0.5) 50px, hsla(197, 62%, 11%, 0) 50px, hsla(197, 62%, 11%, 0) 60px, hsla(5, 53%, 63%, 0.5) 60px, hsla(5, 53%, 63%, 0.5) 70px, hsla(35, 91%, 65%, 0.5) 70px, hsla(35, 91%, 65%, 0.5) 80px, hsla(35, 91%, 65%, 0) 80px, hsla(35, 91%, 65%, 0) 90px, hsla(5, 53%, 63%, 0.5) 90px, hsla(5, 53%, 63%, 0.5) 110px, hsla(5, 53%, 63%, 0) 110px, hsla(5, 53%, 63%, 0) 120px, hsla(197, 62%, 11%, 0.5) 120px, hsla(197, 62%, 11%, 0.5) 140px),repeating-linear-gradient(135deg, transparent 5px, hsla(197, 62%, 11%, 0.5) 5px, hsla(197, 62%, 11%, 0.5) 10px, hsla(5, 53%, 63%, 0) 10px, hsla(5, 53%, 63%, 0) 35px, hsla(5, 53%, 63%, 0.5) 35px, hsla(5, 53%, 63%, 0.5) 40px, hsla(197, 62%, 11%, 0.5) 40px, hsla(197, 62%, 11%, 0.5) 50px, hsla(197, 62%, 11%, 0) 50px, hsla(197, 62%, 11%, 0) 60px, hsla(5, 53%, 63%, 0.5) 60px, hsla(5, 53%, 63%, 0.5) 70px, hsla(35, 91%, 65%, 0.5) 70px, hsla(35, 91%, 65%, 0.5) 80px, hsla(35, 91%, 65%, 0) 80px, hsla(35, 91%, 65%, 0) 90px, hsla(5, 53%, 63%, 0.5) 90px, hsla(5, 53%, 63%, 0.5) 110px, hsla(5, 53%, 63%, 0) 110px, hsla(5, 53%, 63%, 0) 140px, hsla(197, 62%, 11%, 0.5) 140px, hsla(197, 62%, 11%, 0.5) 160px);","background-color: hsl(2, 57%, 40%);background-image: repeating-linear-gradient(transparent, transparent 50px, rgba(0,0,0,.4) 50px, rgba(0,0,0,.4) 53px, transparent 53px, transparent 63px, rgba(0,0,0,.4) 63px, rgba(0,0,0,.4) 66px, transparent 66px, transparent 116px, rgba(0,0,0,.5) 116px, rgba(0,0,0,.5) 166px, rgba(255,255,255,.2) 166px, rgba(255,255,255,.2) 169px, rgba(0,0,0,.5) 169px, rgba(0,0,0,.5) 179px, rgba(255,255,255,.2) 179px, rgba(255,255,255,.2) 182px, rgba(0,0,0,.5) 182px, rgba(0,0,0,.5) 232px, transparent 232px),repeating-linear-gradient(270deg, transparent, transparent 50px, rgba(0,0,0,.4) 50px, rgba(0,0,0,.4) 53px, transparent 53px, transparent 63px, rgba(0,0,0,.4) 63px, rgba(0,0,0,.4) 66px, transparent 66px, transparent 116px, rgba(0,0,0,.5) 116px, rgba(0,0,0,.5) 166px, rgba(255,255,255,.2) 166px, rgba(255,255,255,.2) 169px, rgba(0,0,0,.5) 169px, rgba(0,0,0,.5) 179px, rgba(255,255,255,.2) 179px, rgba(255,255,255,.2) 182px, rgba(0,0,0,.5) 182px, rgba(0,0,0,.5) 232px, transparent 232px),repeating-linear-gradient(125deg, transparent, transparent 2px, rgba(0,0,0,.2) 2px, rgba(0,0,0,.2) 3px, transparent 3px, transparent 5px, rgba(0,0,0,.2) 5px);","background-color: #eee;background-image: linear-gradient(45deg, black 25%, transparent 25%, transparent 75%, black 75%, black),linear-gradient(-45deg, black 25%, transparent 25%, transparent 75%, black 75%, black);background-size: 60px 60px;","background-color: #eee;background-image: linear-gradient(45deg, black 25%, transparent 25%, transparent 75%, black 75%, black),linear-gradient(45deg, black 25%, transparent 25%, transparent 75%, black 75%, black);background-size: 60px 60px;background-position: 0 0, 30px 30px;","background:linear-gradient(-45deg, white 25%, transparent 25%, transparent 75%, black 75%, black) 0 0, linear-gradient(-45deg, black 25%, transparent 25%, transparent 75%, white 75%, white) 1em 1em, linear-gradient(45deg, black 17%, transparent 17%, transparent 25%, black 25%, black 36%, transparent 36%, transparent 64%, black 64%, black 75%, transparent 75%, transparent 83%, black 83%) 1em 1em;background-color: white;background-size: 2em 2em;","background-color:#001;background-image: radial-gradient(white 15%, transparent 16%),radial-gradient(white 15%, transparent 16%);background-size: 60px 60px;background-position: 0 0, 30px 30px;","background-color:#556;background-image: linear-gradient(30deg, #445 12%, transparent 12.5%, transparent 87%, #445 87.5%, #445),linear-gradient(150deg, #445 12%, transparent 12.5%, transparent 87%, #445 87.5%, #445),linear-gradient(30deg, #445 12%, transparent 12.5%, transparent 87%, #445 87.5%, #445),linear-gradient(150deg, #445 12%, transparent 12.5%, transparent 87%, #445 87.5%, #445),linear-gradient(60deg, #99a 25%, transparent 25.5%, transparent 75%, #99a 75%, #99a),linear-gradient(60deg, #99a 25%, transparent 25.5%, transparent 75%, #99a 75%, #99a);background-size:80px 140px;background-position: 0 0, 0 0, 40px 70px, 40px 70px, 0 0, 40px 70px;","background-color:silver;background-image:radial-gradient(circle at 100% 150%, silver 24%, white 24%, white 28%, silver 28%, silver 36%, white 36%, white 40%, transparent 40%, transparent),radial-gradient(circle at 0    150%, silver 24%, white 24%, white 28%, silver 28%, silver 36%, white 36%, white 40%, transparent 40%, transparent),radial-gradient(circle at 50%  100%, white 10%, silver 10%, silver 23%, white 23%, white 30%, silver 30%, silver 43%, white 43%, white 50%, silver 50%, silver 63%, white 63%, white 71%, transparent 71%, transparent),radial-gradient(circle at 100% 50%, white 5%, silver 5%, silver 15%, white 15%, white 20%, silver 20%, silver 29%, white 29%, white 34%, silver 34%, silver 44%, white 44%, white 49%, transparent 49%, transparent),radial-gradient(circle at 0    50%, white 5%, silver 5%, silver 15%, white 15%, white 20%, silver 20%, silver 29%, white 29%, white 34%, silver 34%, silver 44%, white 44%, white 49%, transparent 49%, transparent);background-size: 100px 50px;","background-color: silver;background-image: linear-gradient(335deg, #b00 23px, transparent 23px),linear-gradient(155deg, #d00 23px, transparent 23px),linear-gradient(335deg, #b00 23px, transparent 23px),linear-gradient(155deg, #d00 23px, transparent 23px);background-size: 58px 58px;background-position: 0px 2px, 4px 35px, 29px 31px, 34px 6px;","background-color:#def;background-image: radial-gradient(closest-side, transparent 98%, rgba(0,0,0,.3) 99%),radial-gradient(closest-side, transparent 98%, rgba(0,0,0,.3) 99%);background-size:80px 80px;background-position:0 0, 40px 40px;","background-image:radial-gradient(closest-side, transparent 0%, transparent 75%, #B6CC66 76%, #B6CC66 85%, #EDFFDB 86%, #EDFFDB 94%, #FFFFFF 95%, #FFFFFF 103%, #D9E6A7 104%, #D9E6A7 112%, #798B3C 113%, #798B3C 121%, #FFFFFF 122%, #FFFFFF 130%, #E0EAD7 131%, #E0EAD7 140%),radial-gradient(closest-side, transparent 0%, transparent 75%, #B6CC66 76%, #B6CC66 85%, #EDFFDB 86%, #EDFFDB 94%, #FFFFFF 95%, #FFFFFF 103%, #D9E6A7 104%, #D9E6A7 112%, #798B3C 113%, #798B3C 121%, #FFFFFF 122%, #FFFFFF 130%, #E0EAD7 131%, #E0EAD7 140%);background-size: 110px 110px;background-color: #C8D3A7;background-position: 0 0, 55px 55px;","background:linear-gradient(324deg, #232927 4%,   transparent 4%) -70px 43px, linear-gradient( 36deg, #232927 4%,   transparent 4%) 30px 43px, linear-gradient( 72deg, #e3d7bf 8.5%, transparent 8.5%) 30px 43px, linear-gradient(288deg, #e3d7bf 8.5%, transparent 8.5%) -70px 43px, linear-gradient(216deg, #e3d7bf 7.5%, transparent 7.5%) -70px 23px, linear-gradient(144deg, #e3d7bf 7.5%, transparent 7.5%) 30px 23px, linear-gradient(324deg, #232927 4%,   transparent 4%) -20px 93px, linear-gradient( 36deg, #232927 4%,   transparent 4%) 80px 93px, linear-gradient( 72deg, #e3d7bf 8.5%, transparent 8.5%) 80px 93px, linear-gradient(288deg, #e3d7bf 8.5%, transparent 8.5%) -20px 93px, linear-gradient(216deg, #e3d7bf 7.5%, transparent 7.5%) -20px 73px, linear-gradient(144deg, #e3d7bf 7.5%, transparent 7.5%) 80px 73px;background-color: #232927;background-size: 100px 100px;","background:radial-gradient(circle at 50% 59%, #D2CAAB 3%, #364E27 4%, #364E27 11%, rgba(54,78,39,0) 12%, rgba(54,78,39,0)) 50px 0, radial-gradient(circle at 50% 41%, #364E27 3%, #D2CAAB 4%, #D2CAAB 11%, rgba(210,202,171,0) 12%, rgba(210,202,171,0)) 50px 0, radial-gradient(circle at 50% 59%, #D2CAAB 3%, #364E27 4%, #364E27 11%, rgba(54,78,39,0) 12%, rgba(54,78,39,0)) 0 50px, radial-gradient(circle at 50% 41%, #364E27 3%, #D2CAAB 4%, #D2CAAB 11%, rgba(210,202,171,0) 12%, rgba(210,202,171,0)) 0 50px, radial-gradient(circle at 100% 50%, #D2CAAB 16%, rgba(210,202,171,0) 17%),radial-gradient(circle at 0% 50%, #364E27 16%, rgba(54,78,39,0) 17%),radial-gradient(circle at 100% 50%, #D2CAAB 16%, rgba(210,202,171,0) 17%) 50px 50px, radial-gradient(circle at 0% 50%, #364E27 16%, rgba(54,78,39,0) 17%) 50px 50px;background-color:#63773F;background-size:100px 100px;","background:radial-gradient(circle, transparent 20%, slategray 20%, slategray 80%, transparent 80%, transparent),radial-gradient(circle, transparent 20%, slategray 20%, slategray 80%, transparent 80%, transparent) 50px 50px, linear-gradient(#A8B1BB 8px, transparent 8px) 0 -4px, linear-gradient(90deg, #A8B1BB 8px, transparent 8px) -4px 0;background-color: slategray;background-size:100px 100px, 100px 100px, 50px 50px, 50px 50px;","background:radial-gradient(circle at 100% 50%, transparent 20%, rgba(255,255,255,.3) 21%, rgba(255,255,255,.3) 34%, transparent 35%, transparent),radial-gradient(circle at 0% 50%, transparent 20%, rgba(255,255,255,.3) 21%, rgba(255,255,255,.3) 34%, transparent 35%, transparent) 0 -50px;background-color: slategray;background-size:75px 100px;","background-color: #FF7D9D;background-size: 58px 58px;background-position: 0px 2px, 4px 35px, 29px 31px, 33px 6px, 0px 36px, 4px 2px, 29px 6px, 33px 30px;background-image:linear-gradient(335deg, #C90032 23px, transparent 23px),linear-gradient(155deg, #C90032 23px, transparent 23px),linear-gradient(335deg, #C90032 23px, transparent 23px),linear-gradient(155deg, #C90032 23px, transparent 23px),linear-gradient(335deg, #C90032 10px, transparent 10px),linear-gradient(155deg, #C90032 10px, transparent 10px),linear-gradient(335deg, #C90032 10px, transparent 10px),linear-gradient(155deg, #C90032 10px, transparent 10px);","background-color: #6d695c;background-image:repeating-linear-gradient(120deg, rgba(255,255,255,.1), rgba(255,255,255,.1) 1px, transparent 1px, transparent 60px),repeating-linear-gradient(60deg, rgba(255,255,255,.1), rgba(255,255,255,.1) 1px, transparent 1px, transparent 60px),linear-gradient(60deg, rgba(0,0,0,.1) 25%, transparent 25%, transparent 75%, rgba(0,0,0,.1) 75%, rgba(0,0,0,.1)),linear-gradient(120deg, rgba(0,0,0,.1) 25%, transparent 25%, transparent 75%, rgba(0,0,0,.1) 75%, rgba(0,0,0,.1));background-size: 70px 120px;","background:radial-gradient(circle closest-side at 60% 43%, #b03 26%, rgba(187,0,51,0) 27%),radial-gradient(circle closest-side at 40% 43%, #b03 26%, rgba(187,0,51,0) 27%),radial-gradient(circle closest-side at 40% 22%, #d35 45%, rgba(221,51,85,0) 46%),radial-gradient(circle closest-side at 60% 22%, #d35 45%, rgba(221,51,85,0) 46%),radial-gradient(circle closest-side at 50% 35%, #d35 30%, rgba(221,51,85,0) 31%),radial-gradient(circle closest-side at 60% 43%, #b03 26%, rgba(187,0,51,0) 27%) 50px 50px, radial-gradient(circle closest-side at 40% 43%, #b03 26%, rgba(187,0,51,0) 27%) 50px 50px, radial-gradient(circle closest-side at 40% 22%, #d35 45%, rgba(221,51,85,0) 46%) 50px 50px, radial-gradient(circle closest-side at 60% 22%, #d35 45%, rgba(221,51,85,0) 46%) 50px 50px, radial-gradient(circle closest-side at 50% 35%, #d35 30%, rgba(221,51,85,0) 31%) 50px 50px;background-color:#b03;background-size:100px 100px;","background:radial-gradient(black 15%, transparent 16%) 0 0, radial-gradient(black 15%, transparent 16%) 8px 8px, radial-gradient(rgba(255,255,255,.1) 15%, transparent 20%) 0 1px, radial-gradient(rgba(255,255,255,.1) 15%, transparent 20%) 8px 9px;background-color:#282828;background-size:16px 16px;","background:linear-gradient(27deg, #151515 5px, transparent 5px) 0 5px, linear-gradient(207deg, #151515 5px, transparent 5px) 10px 0px, linear-gradient(27deg, #222 5px, transparent 5px) 0px 10px, linear-gradient(207deg, #222 5px, transparent 5px) 10px 5px, linear-gradient(90deg, #1b1b1b 10px, transparent 10px),linear-gradient(#1d1d1d 25%, #1a1a1a 25%, #1a1a1a 50%, transparent 50%, transparent 75%, #242424 75%, #242424);background-color: #131313;background-size: 20px 20px;","background:radial-gradient(rgba(255,255,255,0) 0, rgba(255,255,255,.15) 30%, rgba(255,255,255,.3) 32%, rgba(255,255,255,0) 33%) 0 0, radial-gradient(rgba(255,255,255,0) 0, rgba(255,255,255,.1) 11%, rgba(255,255,255,.3) 13%, rgba(255,255,255,0) 14%) 0 0, radial-gradient(rgba(255,255,255,0) 0, rgba(255,255,255,.2) 17%, rgba(255,255,255,.43) 19%, rgba(255,255,255,0) 20%) 0 110px, radial-gradient(rgba(255,255,255,0) 0, rgba(255,255,255,.2) 11%, rgba(255,255,255,.4) 13%, rgba(255,255,255,0) 14%) -130px -170px, radial-gradient(rgba(255,255,255,0) 0, rgba(255,255,255,.2) 11%, rgba(255,255,255,.4) 13%, rgba(255,255,255,0) 14%) 130px 370px, radial-gradient(rgba(255,255,255,0) 0, rgba(255,255,255,.1) 11%, rgba(255,255,255,.2) 13%, rgba(255,255,255,0) 14%) 0 0, linear-gradient(45deg, #343702 0%, #184500 20%, #187546 30%, #006782 40%, #0b1284 50%, #760ea1 60%, #83096e 70%, #840b2a 80%, #b13e12 90%, #e27412 100%);background-size: 470px 470px, 970px 970px, 410px 410px, 610px 610px, 530px 530px, 730px 730px, 100% 100%;background-color: #840b2a;","background-color:white;background-image:radial-gradient(midnightblue 9px, transparent 10px),repeating-radial-gradient(midnightblue 0, midnightblue 4px, transparent 5px, transparent 20px, midnightblue 21px, midnightblue 25px, transparent 26px, transparent 50px);background-size: 30px 30px, 90px 90px;background-position: 0 0;","background-color:black;background-image:radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 40px),radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 30px),radial-gradient(white, rgba(255,255,255,.1) 2px, transparent 40px),radial-gradient(rgba(255,255,255,.4), rgba(255,255,255,.1) 2px, transparent 30px);background-size: 550px 550px, 350px 350px, 250px 250px, 150px 150px;background-position: 0 0, 40px 60px, 130px 270px, 70px 100px;","background:radial-gradient(hsl(0, 100%, 27%) 4%, hsl(0, 100%, 18%) 9%, hsla(0, 100%, 20%, 0) 9%) 0 0, radial-gradient(hsl(0, 100%, 27%) 4%, hsl(0, 100%, 18%) 8%, hsla(0, 100%, 20%, 0) 10%) 50px 50px, radial-gradient(hsla(0, 100%, 30%, 0.8) 20%, hsla(0, 100%, 20%, 0)) 50px 0, radial-gradient(hsla(0, 100%, 30%, 0.8) 20%, hsla(0, 100%, 20%, 0)) 0 50px, radial-gradient(hsla(0, 100%, 20%, 1) 35%, hsla(0, 100%, 20%, 0) 60%) 50px 0, radial-gradient(hsla(0, 100%, 20%, 1) 35%, hsla(0, 100%, 20%, 0) 60%) 100px 50px, radial-gradient(hsla(0, 100%, 15%, 0.7), hsla(0, 100%, 20%, 0)) 0 0, radial-gradient(hsla(0, 100%, 15%, 0.7), hsla(0, 100%, 20%, 0)) 50px 50px, linear-gradient(45deg, hsla(0, 100%, 20%, 0) 49%, hsla(0, 100%, 0%, 1) 50%, hsla(0, 100%, 20%, 0) 70%) 0 0, linear-gradient(-45deg, hsla(0, 100%, 20%, 0) 49%, hsla(0, 100%, 0%, 1) 50%, hsla(0, 100%, 20%, 0) 70%) 0 0;background-color: #300;background-size: 100px 100px;","background:linear-gradient(135deg, #708090 21px, #d9ecff 22px, #d9ecff 24px, transparent 24px, transparent 67px, #d9ecff 67px, #d9ecff 69px, transparent 69px),linear-gradient(225deg, #708090 21px, #d9ecff 22px, #d9ecff 24px, transparent 24px, transparent 67px, #d9ecff 67px, #d9ecff 69px, transparent 69px)0 64px;background-color:#708090;background-size: 64px 128px;","background:linear-gradient(135deg, #ECEDDC 25%, transparent 25%) -50px 0, linear-gradient(225deg, #ECEDDC 25%, transparent 25%) -50px 0, linear-gradient(315deg, #ECEDDC 25%, transparent 25%),linear-gradient(45deg, #ECEDDC 25%, transparent 25%);background-size: 100px 100px;background-color: #EC173A;","background:linear-gradient(45deg, #92baac 45px, transparent 45px)64px 64px, linear-gradient(45deg, #92baac 45px, transparent 45px,transparent 91px, #e1ebbd 91px, #e1ebbd 135px, transparent 135px),linear-gradient(-45deg, #92baac 23px, transparent 23px, transparent 68px,#92baac 68px,#92baac 113px,transparent 113px,transparent 158px,#92baac 158px);background-color:#e1ebbd;background-size: 128px 128px;","background:linear-gradient(63deg, #999 23%, transparent 23%) 7px 0,linear-gradient(63deg, transparent 74%, #999 78%),linear-gradient(63deg, transparent 34%, #999 38%, #999 58%, transparent 62%),#444;background-size: 16px 48px;","background:#36c;background:linear-gradient(115deg, transparent 75%, rgba(255,255,255,.8) 75%) 0 0,linear-gradient(245deg, transparent 75%, rgba(255,255,255,.8) 75%) 0 0,linear-gradient(115deg, transparent 75%, rgba(255,255,255,.8) 75%) 7px -15px,linear-gradient(245deg, transparent 75%, rgba(255,255,255,.8) 75%) 7px -15px,#36c;background-size: 15px 30px;","background:radial-gradient(circle at 0% 50%, rgba(96, 16, 48, 0) 9px, #613 10px, rgba(96, 16, 48, 0) 11px) 0px 10px,radial-gradient(at 100% 100%,rgba(96, 16, 48, 0) 9px, #613 10px, rgba(96, 16, 48, 0) 11px),#8a3;background-size: 20px 20px;","background-image:linear-gradient(to top, #a18cd1 0%, #fbc2eb 100%)","background-image:linear-gradient(to top, #fbc2eb 0%, #a6c1ee 100%)","background-image:linear-gradient(120deg, #a6c0fe 0%, #f68084 100%)","background-image:linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%)","background-image:linear-gradient(to right, #fa709a 0%, #fee140 100%)","background-image:linear-gradient(to top, #30cfd0 0%, #330867 100%)","background-image:linear-gradient(to top, #a8edea 0%, #fed6e3 100%)","background-image:linear-gradient(to top, #d299c2 0%, #fef9d7 100%)","background-image:linear-gradient(to top, #fddb92 0%, #d1fdff 100%)","background-image:linear-gradient(to top, #9890e3 0%, #b1f4cf 100%)","background-image:linear-gradient(to top, #96fbc4 0%, #f9f586 100%)","background-image:linear-gradient(to right, #eea2a2 0%, #bbc1bf 19%, #57c6e1 42%, #b49fda 79%, #7ac5d8 100%)","background-image:linear-gradient(to top, #9795f0 0%, #fbc8d4 100%)","background-image:linear-gradient(to top, #3f51b1 0%, #5a55ae 13%, #7b5fac 25%, #8f6aae 38%, #a86aa4 50%, #cc6b8e 62%, #f18271 75%, #f3a469 87%, #f7c978 100%)","background-image:linear-gradient(to top, #f43b47 0%, #453a94 100%)","background-image:linear-gradient(to top, #88d3ce 0%, #6e45e2 100%)","background-image:linear-gradient(to top, #d9afd9 0%, #97d9e1 100%)","background-image:linear-gradient(-20deg, #b721ff 0%, #21d4fd 100%)","background-image:linear-gradient(60deg, #abecd6 0%, #fbed96 100%)","background-image:linear-gradient(to top, #3b41c5 0%, #a981bb 49%, #ffc8a9 100%)","background-image:linear-gradient(to top, #0fd850 0%, #f9f047 100%)","background-image:linear-gradient(to top, #d5dee7 0%, #ffafbd 0%, #c9ffbf 100%)","background-image:linear-gradient(to top, #65bd60 0%, #5ac1a8 25%, #3ec6ed 50%, #b7ddb7 75%, #fef381 100%)","background-image:linear-gradient(to top, #50cc7f 0%, #f5d100 100%)","background-image:linear-gradient(to top, #df89b5 0%, #bfd9fe 100%)","background-image:linear-gradient(to top, #e14fad 0%, #f9d423 100%)","background-image:linear-gradient(to right, #ec77ab 0%, #7873f5 100%)","background-image:linear-gradient(-225deg, #2CD8D5 0%, #C5C1FF 56%, #FFBAC3 100%)","background-image:linear-gradient(-225deg, #5271C4 0%, #B19FFF 48%, #ECA1FE 100%)","background-image:linear-gradient(-225deg, #FF3CAC 0%, #562B7C 52%, #2B86C5 100%)","background-image:linear-gradient(-225deg, #69EACB 0%, #EACCF8 48%, #6654F1 100%)","background-image:linear-gradient(-225deg, #231557 0%, #44107A 29%, #FF1361 67%, #FFF800 100%)"];class aV{constructor(e){this.transparentData="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",this.element=document.createElement("div"),this.element.className="protyle-background",this.element.innerHTML=`<div class="protyle-background__img">
    <img src="${this.transparentData}">
    <div class="protyle-icons">
        <span class="protyle-icon protyle-icon--first" style="position: relative;overflow: hidden"><input aria-label="${window.siyuan.languages.upload}" class="ariaLabel b3-form__upload" type="file"><svg><use xlink:href="#iconUpload"></use></svg></span>
        <span class="protyle-icon ariaLabel" data-type="link" aria-label="${window.siyuan.languages.link}"><svg><use xlink:href="#iconLink"></use></svg></span>
        <span class="protyle-icon ariaLabel" data-type="asset" aria-label="${window.siyuan.languages.assets}"><svg><use xlink:href="#iconImage"></use></svg></span>
        <span class="protyle-icon ariaLabel" data-type="show-random" aria-label="${window.siyuan.languages.builtIn}"><svg><use xlink:href="#iconRefresh"></use></svg></span>
        <span class="protyle-icon ariaLabel fn__none" data-type="position" aria-label="${window.siyuan.languages.dragPosition}"><svg><use xlink:href="#iconMove"></use></svg></span>
        <span class="protyle-icon protyle-icon--last ariaLabel" data-type="remove" aria-label="${window.siyuan.languages.remove}"><svg><use xlink:href="#iconTrashcan"></use></svg></span>
    </div>
    <div class="protyle-icons fn__none"><span class="protyle-icon protyle-icon--text">${window.siyuan.languages.dragPosition}</span></div>
    <div class="protyle-icons fn__none" style="opacity: .86;">
        <span class="protyle-icon protyle-icon--first" data-type="cancel">${window.siyuan.languages.cancel}</span>
        <span class="protyle-icon protyle-icon--last" data-type="confirm">${window.siyuan.languages.confirm}</span>
    </div>
</div>
<div class="protyle-background__ia">
    <div class="protyle-background__icon" data-menu="true" data-type="open-emoji"></div>
    <div class="b3-chips b3-chips__doctag fn__none"></div>
    <div class="protyle-background__action">
        <button class="b3-button b3-button--cancel" data-menu="true" data-type="tag">
            <svg><use xlink:href="#iconTags"></use></svg>
            ${window.siyuan.languages.addTag}
        </button>
        <button class="b3-button b3-button--cancel" data-type="icon">
            <svg><use xlink:href="#iconEmoji"></use></svg>
            ${window.siyuan.languages.addIcon}
        </button>
        <button class="b3-button b3-button--cancel" data-type="random">
            <svg><use xlink:href="#iconImage"></use></svg>
            ${window.siyuan.languages.titleBg}
        </button>
    </div>
</div>`,this.tagsElement=this.element.querySelector(".b3-chips"),this.iconElement=this.element.querySelector(".protyle-background__icon"),this.imgElement=this.element.querySelector(".protyle-background__img img"),this.actionElements=this.element.querySelectorAll(".protyle-background__action:not(.fn__flex-center) .b3-button"),this.element.addEventListener("dragover",n=>TL(this,null,function*(){n.preventDefault()})),this.element.addEventListener("drop",n=>TL(this,null,function*(){n.dataTransfer.types[0]==="Files"&&n.dataTransfer.files[0].type.indexOf("image")!==-1&&_l(e,[n.dataTransfer.files[0]],void 0,a=>{const i=JSON.parse(a),s=`background-image:url("${i.data.succMap[Object.keys(i.data.succMap)[0]]}")`;this.ial["title-img"]=s,this.render(this.ial,e.block.rootID),ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{"title-img":s}})})})),this.imgElement.addEventListener("mousedown",n=>{if(n.preventDefault(),!this.element.firstElementChild.querySelector(".protyle-icons").classList.contains("fn__none"))return;const a=n.clientY,i=document,s=this.imgElement.naturalHeight*this.imgElement.clientWidth/this.imgElement.naturalWidth-this.imgElement.clientHeight;let r=parseFloat(this.imgElement.style.objectPosition.substring(7))||50;this.imgElement.style.objectPosition.endsWith("px")&&(r=-parseInt(this.imgElement.style.objectPosition.substring(7))/s*100),i.onmousemove=o=>{this.imgElement.style.objectPosition=`center ${((a-o.clientY)/s*100+r).toFixed(2)}%`,n.preventDefault()},i.onmouseup=()=>{i.onmousemove=null,i.onmouseup=null,i.ondragstart=null,i.onselectstart=null,i.onselect=null}}),this.element.querySelector("input").addEventListener("change",n=>{n.target.files.length!==0&&_l(e,n.target.files,n.target,a=>{const i=JSON.parse(a),s=`background-image:url("${i.data.succMap[Object.keys(i.data.succMap)[0]]}")`;this.ial["title-img"]=s,this.render(this.ial,e.block.rootID),ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{"title-img":s}})})}),this.element.addEventListener(Ne(),n=>{let a=n.target;for(Ut(["gutter"],e);a&&!a.isEqualNode(this.element);){const i=a.getAttribute("data-type");if(a.tagName==="IMG"&&a.parentElement.classList.contains("protyle-background__img")){const s=a.getAttribute("src");n.detail>1&&!s.startsWith("data:image/png;base64")&&(r_([s]),n.preventDefault(),n.stopPropagation()),window.siyuan.menus.menu.remove();break}else if(i==="position"&&!e.disabled){const s=this.element.firstElementChild.querySelectorAll(".protyle-icons");s[0].classList.add("fn__none"),s[1].classList.remove("fn__none"),s[2].classList.remove("fn__none"),this.imgElement.style.cursor="move",n.preventDefault(),n.stopPropagation();break}else if(i==="cancel"||i==="confirm"){this.imgElement.style.cursor="";const s=this.element.firstElementChild.querySelectorAll(".protyle-icons");if(s[0].classList.remove("fn__none"),s[1].classList.add("fn__none"),s[2].classList.add("fn__none"),i==="confirm"){const r=`background-image:url("${this.imgElement.getAttribute("src")}");object-position:${this.imgElement.style.objectPosition}`;this.ial["title-img"]=r,ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{"title-img":r}})}else this.render(this.ial,e.block.rootID);n.preventDefault(),n.stopPropagation();break}else if(i==="open-emoji"&&!e.disabled){const s=this.iconElement.getBoundingClientRect();Va(e.block.rootID,"doc",{x:s.left,y:s.bottom,h:s.height,w:s.width},void 0,a.querySelector("img")),n.preventDefault(),n.stopPropagation();break}else if(i==="show-random"&&!e.disabled){let s="";ww.forEach((o,l)=>{s+=`<div data-index="${l}" style="height: 128px;${o}" class="b3-card b3-card--wrap"></div>`});const r=new fe({title:window.siyuan.languages.builtIn,content:`<div class="b3-cards">${s}</div>`,width:x()?"92vw":"912px",height:x()?"80vh":"70vh"});r.element.setAttribute("data-key",p.DIALOG_BACKGROUNDRANDOM),r.element.addEventListener("click",o=>{const l=o.target;l.classList.contains("b3-card")&&(this.ial["title-img"]=ww[parseInt(l.getAttribute("data-index"))],this.render(this.ial,e.block.rootID),ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{"title-img":this.ial["title-img"]}}),r.destroy())}),n.preventDefault(),n.stopPropagation();break}else if(i==="random"&&!e.disabled){this.ial["title-img"]=ww[T(0,ww.length-1)],this.render(this.ial,e.block.rootID),ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{"title-img":this.ial["title-img"]}}),n.preventDefault(),n.stopPropagation();break}else if(i==="asset"&&!e.disabled){const s=a.getBoundingClientRect();zv(e,{x:a.parentElement.getBoundingClientRect().right,y:s.bottom+8,isLeft:!0},r=>{this.ial["title-img"]=`background-image:url("${r}")`,this.render(this.ial,e.block.rootID),ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{"title-img":this.ial["title-img"]}})},p.SIYUAN_ASSETS_IMAGE),n.preventDefault(),n.stopPropagation();break}else if(i==="remove"&&!e.disabled){delete this.ial["title-img"],this.render(this.ial,e.block.rootID),ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{"title-img":""}}),n.preventDefault(),n.stopPropagation();break}else if(i==="icon"&&!e.disabled){const s=fa();if(s){Ca(s,e.block.rootID),Zi(s,e.block.rootID),ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{icon:s}}),e.model&&e.model.parent.setDocIcon(s),this.iconElement.classList.remove("fn__none");const r=this.iconElement.getBoundingClientRect();Va(e.block.rootID,"doc",{x:r.left,y:r.bottom,h:r.height,w:r.width})}n.preventDefault(),n.stopPropagation();break}else if(i==="tag"&&!e.disabled){this.openTag(e,a),n.preventDefault(),n.stopPropagation();break}else if(i==="link"&&!e.disabled){const s=new fe({title:window.siyuan.languages.link,width:x()?"92vw":"520px",content:`<div class="b3-dialog__content">
        <input class="b3-text-field fn__block" value="${this.imgElement.src.startsWith("data:")?"":this.imgElement.getAttribute("src")}">
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`});s.element.setAttribute("data-key",p.DIALOG_BACKGROUNDLINK);const r=s.element.querySelectorAll(".b3-button");r[0].addEventListener("click",()=>{s.destroy()}),r[1].addEventListener("click",()=>{const o=`background-image:url("${s.element.querySelector("input").value}");`;this.ial["title-img"]=o,this.render(this.ial,e.block.rootID),ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{"title-img":this.ial["title-img"]}}),s.destroy()}),s.element.querySelector("input").focus(),n.preventDefault(),n.stopPropagation();break}else if(i==="open-search"){Ro(e.app,`#${a.textContent}#`,!window.siyuan.ctrlIsPressed,{method:0}),n.preventDefault(),n.stopPropagation();break}else if(i==="remove-tag"&&!e.disabled){a.parentElement.remove(),this.removeTag(e),n.preventDefault(),n.stopPropagation();break}a=a.parentElement}})}removeTag(e,n){const a=this.getTags();ae("/api/attr/setBlockAttrs",{id:e.block.rootID,attrs:{tags:a.toString()}},()=>{n&&n()}),a.length===0?delete this.ial.tags:this.ial.tags=a.toString(),this.render(this.ial,e.block.rootID)}render(e,n){var a;const i=e["title-img"],s=e.icon,r=e.tags;if(this.ial=e,this.element.setAttribute("data-node-id",n),r){let o="";const l=["secondary","primary","info","success","warning","error","pink"];Array.from(new Set(r.split(",").map(c=>c.trim()))).forEach((c,d)=>{c.replace(/ /g,"")&&(o+=`<div class="b3-chip b3-chip--middle b3-chip--pointer b3-chip--${l[d%7]}" data-type="open-search">${he(c)}<svg class="b3-chip__close" data-type="remove-tag"><use xlink:href="#iconCloseRound"></use></svg></div>`)}),this.tagsElement.innerHTML=`${o}
<div class="protyle-background__action fn__flex-center">
    <button class="b3-button b3-button--cancel" style="margin-bottom: 8px" data-menu="true" data-type="tag"><svg><use xlink:href="#iconAdd"></use></svg>${window.siyuan.languages.addTag}</button>
</div>`,this.tagsElement.classList.remove("fn__none"),this.actionElements[0].classList.add("fn__none")}else this.tagsElement.classList.add("fn__none"),this.actionElements[0].classList.remove("fn__none");if(s?(this.iconElement.classList.remove("fn__none"),this.iconElement.innerHTML=Yt(s),this.actionElements[1].classList.add("fn__none")):(this.actionElements[1].classList.remove("fn__none"),this.iconElement.classList.add("fn__none")),i){if(this.imgElement.setAttribute("style",Lute.UnEscapeHTMLStr(i)),i.indexOf("url(")>-1){const o=this.imgElement.style.backgroundPosition||this.imgElement.style.objectPosition,l=(a=this.imgElement.style.backgroundImage)==null?void 0:a.replace(/^url\(["']?/,"").replace(/["']?\)$/,"");this.imgElement.removeAttribute("style"),this.imgElement.setAttribute("src",l),this.imgElement.style.objectPosition=o,this.element.querySelector('[data-type="position"]').classList.remove("fn__none")}else this.imgElement.setAttribute("src",this.transparentData),this.element.querySelector('[data-type="position"]').classList.add("fn__none");this.actionElements[2].classList.add("fn__none"),this.imgElement.parentElement.classList.remove("fn__none"),this.iconElement.style.marginTop=""}else this.imgElement.parentElement.classList.add("fn__none"),this.actionElements[2].classList.remove("fn__none"),this.iconElement.style.marginTop="8px";i||s?this.iconElement.parentElement.style.marginTop="":this.iconElement.parentElement.style.marginTop="8px"}openTag(e,n){window.siyuan.menus.menu.remove();const a=new ta;a.addItem({iconHTML:"",type:"empty",label:`<div class="fn__flex-column b3-menu__filter">
    <input class="b3-text-field fn__flex-shrink" placeholder="${window.siyuan.languages.tag}"/>
    <div class="fn__hr"></div>
    <div class="b3-list fn__flex-1 b3-list--background">
        <img style="margin: 0 auto;display: block;width: 64px;height: 64px" src="/stage/loading-pure.svg">
    </div>
</div>`,bind:r=>{const o=r.querySelector(".b3-list--background");ae("/api/search/searchTag",{k:""},c=>{let d="";const u=this.getTags();c.data.tags.forEach((g,f)=>{d+=`<div class="b3-list-item b3-list-item--narrow${f===0?" b3-list-item--focus":""}">
    <div class="fn__flex-1">${g}</div>
    ${u.includes(Lute.UnEscapeHTMLStr(g))?'<svg class="b3-menu__checked"><use xlink:href="#iconSelect"></use></svg>':""}
</div>`}),o.innerHTML=d});const l=r.querySelector("input");l.addEventListener("keydown",c=>{if(c.stopPropagation(),!c.isComposing)if(pi(o,c),c.key==="Enter"){const d=o.querySelector(".b3-list-item--focus");this.addTags(d?d.dataset.type==="new"?d.querySelector("mark").textContent.trim():d.textContent.trim():l.value.trim(),e,()=>{l.value="",l.dispatchEvent(new CustomEvent("input"))})}else c.key==="Escape"&&window.siyuan.menus.menu.remove()}),l.addEventListener("input",c=>{c.stopPropagation(),ae("/api/search/searchTag",{k:l.value.trim()},d=>{let u="",g=!1;const f=this.getTags();d.data.tags.forEach((h,m)=>{u+=`<div class="b3-list-item b3-list-item--narrow${m===0?" b3-list-item--focus":""}">
    <div class="fn__flex-1">${h}</div>
    ${f.includes(Lute.UnEscapeHTMLStr(h.replace(/<mark>/g,"").replace(/<\/mark>/g,"")))?'<svg class="b3-menu__checked"><use xlink:href="#iconSelect"></use></svg>':""}
</div>`,h===`<mark>${d.data.k}</mark>`&&(g=!0)}),!g&&d.data.k&&(u=`<div data-type="new" class="b3-list-item b3-list-item--narrow${u?"":" b3-list-item--focus"}"><div class="fn__flex-1">${window.siyuan.languages.new} <mark>${he(d.data.k)}</mark></div></div>`+u),o.innerHTML=u})}),o.addEventListener("click",c=>{const d=c.target,u=N(d,"b3-list-item");u&&this.addTags(u.dataset.type==="new"?u.querySelector("mark").textContent.trim():u.textContent.trim(),e,()=>{l.value="",l.dispatchEvent(new CustomEvent("input")),l.focus()})})}}),a.element.querySelector(".b3-menu__items").setAttribute("style","overflow: initial");const s=n.getBoundingClientRect();a.open({x:s.left,y:s.top+s.height}),a.element.querySelector("input").focus()}getTags(e){const n=[];return this.tagsElement.querySelectorAll(".b3-chip").forEach(a=>{const i=a.textContent.trim();e&&i===e&&a.remove(),n.push(i)}),n}addTags(e,n,a){const i=this.getTags(e);if(i.includes(e)){this.removeTag(n,a);return}i.push(e),ae("/api/attr/setBlockAttrs",{id:n.block.rootID,attrs:{tags:i.toString()}},()=>{a()}),this.ial.tags=i.toString(),this.render(this.ial,n.block.rootID)}}class ar{constructor(e,n,a){this.version=p.SIYUAN_VERSION;let i=a;e.plugins.forEach(o=>{o.protyleOptions&&(i=$E(i,o.protyleOptions))});const r=new LW(i).merge();if(this.protyle={getInstance:()=>this,app:e,transactionTime:new Date().getTime(),id:K(),disabled:!1,updated:!1,element:n,options:r,block:{},highlight:{mark:Gs()?new Highlight:void 0,markHL:Gs()?new Highlight:void 0,ranges:[],rangeIndex:0,styleElement:document.createElement("style")}},Gs()){const o=K();this.protyle.highlight.styleElement.dataset.uuid=o,this.protyle.highlight.styleElement.textContent=`.protyle-content::highlight(search-mark-${o}) {background-color: var(--b3-highlight-background);color: var(--b3-highlight-color);}
  .protyle-content::highlight(search-mark-hl-${o}) {color: var(--b3-highlight-color);background-color: var(--b3-highlight-current-background)}`}if(this.protyle.hint=new SW(this.protyle),r.render.breadcrumb&&(this.protyle.breadcrumb=new tV(this.protyle)),r.render.title&&(this.protyle.title=new nV(this.protyle)),r.render.background&&(this.protyle.background=new aV(this.protyle)),this.protyle.element.innerHTML="",this.protyle.element.classList.add("protyle"),r.render.breadcrumb&&this.protyle.element.appendChild(this.protyle.breadcrumb.element.parentElement),this.protyle.undo=new oM,this.protyle.wysiwyg=new OW(this.protyle),this.protyle.toolbar=new jW(this.protyle),this.protyle.scroll=new IW(this.protyle),this.protyle.options.render.gutter&&(this.protyle.gutter=new XW(this.protyle)),(r.upload.url||r.upload.handler)&&(this.protyle.upload=new YM),this.init(),this.protyle.element.protyle=this,r.action.includes(p.CB_GET_HISTORY))this.protyle.contentElement.classList.add("protyle-content--transition");else{if(this.protyle.ws=new Wa({app:e,id:this.protyle.id,type:"protyle",msgCallback:o=>{var l;switch(o.cmd){case"reload":o.data===this.protyle.block.rootID&&($o(this.protyle,!1),Cn().outline.forEach(c=>{c.blockId===o.data&&ae("/api/outline/getDocOutline",{id:c.blockId,preview:c.isPreview},d=>{c.update(d)})}));break;case"refreshAttributeView":Array.from(this.protyle.wysiwyg.element.querySelectorAll(`.av[data-av-id="${o.data.id}"]`)).forEach(c=>{c.removeAttribute("data-render"),Ua(c,this.protyle)});break;case"addLoading":o.data===this.protyle.block.rootID&&Ud(this.protyle,o.msg);break;case"unfoldHeading":MM(o.data,this.protyle);break;case"transactions":this.onTransaction(o);break;case"readonly":window.siyuan.config.editor.readOnly=o.data,MA(this.protyle,!0);break;case"heading2doc":case"li2doc":this.protyle.block.rootID===o.data.srcRootBlockID&&(this.protyle.block.showAll&&o.cmd==="heading2doc"&&!this.protyle.options.backlinkData?ae("/api/filetree/getDoc",{id:this.protyle.block.rootID,size:window.siyuan.config.editor.dynamicLoadBlocks},c=>{_a({data:c,protyle:this.protyle})}):$o(this.protyle,!1),o.cmd==="heading2doc"&&sp({protyle:this.protyle,focus:!1,pushBackStack:!1,reload:!0,resize:!1}));break;case"rename":this.protyle.path===o.data.path&&(this.protyle.model&&this.protyle.model.parent.updateTitle(o.data.title),this.protyle.background&&(this.protyle.background.ial.title=o.data.title)),this.protyle.options.render.title&&this.protyle.block.parentID===o.data.id&&(!document.body.classList.contains("body--blur")&&getSelection().rangeCount>0&&((l=this.protyle.title.editElement)!=null&&l.contains(getSelection().getRangeAt(0).startContainer))||this.protyle.title.setTitle(o.data.title)),this.protyle.wysiwyg.element.querySelectorAll(`[data-type~="block-ref"][data-id="${o.data.id}"]`).forEach(c=>{c.getAttribute("data-subtype")==="d"&&(c.innerHTML=o.data.refText)});break;case"moveDoc":this.protyle.path===o.data.fromPath&&(this.protyle.path=o.data.newPath,this.protyle.notebookId=o.data.toNotebook);break;case"unmount":this.protyle.notebookId===o.data.box&&this.protyle.model&&this.protyle.model.parent.parent.removeTab(this.protyle.model.parent.id,!1);break;case"removeDoc":o.data.ids.includes(this.protyle.block.rootID)&&(this.protyle.model&&this.protyle.model.parent.parent.removeTab(this.protyle.model.parent.id,!1),delete window.siyuan.storage[p.LOCAL_FILEPOSITION][this.protyle.block.rootID],Gt(p.LOCAL_FILEPOSITION,window.siyuan.storage[p.LOCAL_FILEPOSITION]));break}}}),a.backlinkData){this.protyle.block.rootID=a.blockId,fA(this.protyle,a.backlinkData),this.protyle.wysiwyg.element.style.padding="4px 16px 4px 24px";return}if(!a.blockId){tg(this.protyle);return}this.protyle.options.mode!=="preview"&&a.rootId&&window.siyuan.storage[p.LOCAL_FILEPOSITION][a.rootId]&&(r.action.includes(p.CB_GET_SCROLL)||r.action.includes(p.CB_GET_ROOTSCROLL)&&a.rootId===a.blockId)?mv({protyle:this.protyle,scrollAttr:window.siyuan.storage[p.LOCAL_FILEPOSITION][a.rootId],mergedOptions:r,cb:()=>{this.afterOnGet(r)}}):this.getDoc(r)}}onTransaction(e){let n="";e.data[0].doOperations.find(a=>{var i;if(!this.protyle.preview.element.classList.contains("fn__none"))this.protyle.preview.render(this.protyle),a.action==="updateAttrs"&&f_(this.protyle,a,!1);else{if(this.protyle.options.backlinkData&&["delete","move"].includes(a.action))return Cn().backlink.find(s=>{if(s.element.contains(this.protyle.element))return s.refresh(),!0}),!0;f_(this.protyle,a,!1),a.action==="delete"&&typeof((i=a.data)==null?void 0:i.createEmptyParagraph)=="boolean"&&!a.data.createEmptyParagraph||(n=a.action)}}),this.protyle.wysiwyg.element.childElementCount===0&&this.protyle.block.parentID&&n&&(n==="delete"&&this.protyle.block.showAll?this.protyle.options.handleEmptyContent?this.protyle.options.handleEmptyContent():hi({protyle:this.protyle,id:this.protyle.block.rootID,focusId:this.protyle.block.id}):(this.protyle.undo.clear(),this.reload(!1)))}getDoc(e){var n;ae("/api/filetree/getDoc",{id:e.blockId,isBacklink:e.action.includes(p.CB_GET_BACKLINK),originalRefBlockIDs:e.originalRefBlockIDs,mode:e.action&&e.action.includes(p.CB_GET_CONTEXT)?3:0,size:(n=e.action)!=null&&n.includes(p.CB_GET_ALL)?p.SIZE_GET_MAX:window.siyuan.config.editor.dynamicLoadBlocks},a=>{_a({data:a,protyle:this.protyle,action:e.action,afterCB:()=>{this.afterOnGet(e)}})})}afterOnGet(e){var n,a;this.protyle.model&&(((n=e.action)!=null&&n.includes(p.CB_GET_FOCUS)||(a=e.action)!=null&&a.includes(p.CB_GET_OPENNEW))&&ca(this.protyle.model.element.parentElement.parentElement),sp({protyle:this.protyle,focus:!1,pushBackStack:!1,reload:!1,resize:!1})),Ai(this.protyle),this.protyle.wysiwyg.element.addEventListener("focusin",()=>{if(this.protyle&&this.protyle.model){let i=!0;if(this.protyle.model.element.parentElement.parentElement.classList.contains("layout__wnd--active")&&this.protyle.model.headElement.classList.contains("item--focus")&&(i=!1),!i)return;ca(this.protyle.model.element.parentElement.parentElement),sp({protyle:this.protyle,focus:!1,pushBackStack:!1,reload:!1,resize:!1})}else document.querySelectorAll(".layout__tab--active").forEach(i=>{i.classList.remove("layout__tab--active")}),document.querySelectorAll(".layout__wnd--active").forEach(i=>{i.classList.remove("layout__wnd--active")})}),e.after&&e.after(this),this.protyle.contentElement.classList.add("protyle-content--transition")}init(){this.protyle.lute=AW({emojiSite:this.protyle.options.hint.emojiPath,emojis:this.protyle.options.hint.emoji,headingAnchor:!1,listStyle:this.protyle.options.preview.markdown.listStyle,paragraphBeginningSpace:this.protyle.options.preview.markdown.paragraphBeginningSpace,sanitize:this.protyle.options.preview.markdown.sanitize}),this.protyle.preview=new CW(this.protyle),jF(this.protyle)}focus(){this.protyle.wysiwyg.element.focus()}isUploading(){return this.protyle.upload.isUploading}clearStack(){this.protyle.undo.clear()}destroy(){TS(this.protyle)}resize(){Ai(this.protyle)}reload(e){$o(this.protyle,e)}insert(e,n=!1,a=!1){Aa(e,this.protyle,n,a)}transaction(e,n){et(this.protyle,e,n)}turnIntoOneTransaction(e,n,a){Qs({protyle:this.protyle,selectsElement:e,type:n,level:a})}turnIntoTransaction(e,n,a){mr({protyle:this.protyle,nodeElement:e,type:n,level:a})}updateTransaction(e,n,a){Ht(this.protyle,e,n,a)}updateBatchTransaction(e,n){lc(e,this.protyle,n)}getRange(e){return hn(e)}hasClosestBlock(e){return oe(e)}focusBlock(e,n=!0){return qt(e,void 0,n)}disable(){br(this.protyle)}enable(){eg(this.protyle)}renderAVAttribute(e,n,a){nx(e,n,this.protyle,a)}}class Ma extends Wa{constructor(e){super({app:e.app,id:e.tab.id}),window.siyuan.config.fileTree.openFilesUseCurrentTab&&e.tab.headElement.classList.add("item--unupdate"),this.headElement=e.tab.headElement,this.element=e.tab.panelElement,this.initProtyle(e),ae("/api/storage/updateRecentDocOpenTime",{rootID:e.rootId})}initProtyle(e){this.editor=new ar(this.app,this.element,{action:e.action||[],blockId:e.blockId,rootId:e.rootId,mode:e.mode,render:{title:!0,background:!0,scroll:!0},typewriterMode:!0,after:n=>{window.siyuan.editorIsFullscreen&&(kd(n.protyle.element),Ax(n.protyle)),ss([],n.protyle.block.rootID),e.afterInitProtyle&&e.afterInitProtyle(n)}}),this.editor.protyle.model=this}}class Sa{constructor(e){if(this.id=K(),this.callback=e.callback,e.title||e.icon){this.title=e.title,this.icon=e.icon,this.docIcon=e.docIcon,this.headElement=document.createElement("li"),this.headElement.setAttribute("data-type","tab-header"),this.headElement.setAttribute("draggable","true"),this.headElement.setAttribute("data-id",this.id),this.headElement.classList.add("item","item--focus");let n="";e.icon?n=`<svg class="item__graphic"><use xlink:href="#${e.icon}"></use></svg>`:e.docIcon&&(n=`<span class="item__icon">${Yt(e.docIcon)}</span>`),this.headElement.innerHTML=`${n}<span class="item__text">${he(e.title)}</span>
<span class="item__close"><svg><use xlink:href="#iconClose"></use></svg></span>`,this.headElement.addEventListener("mouseenter",a=>{var i,s,r;if(a.stopPropagation(),a.preventDefault(),Array.from(this.headElement.parentElement.childNodes).find(c=>{var d;if(((d=c.style)==null?void 0:d.opacity)==="0.38")return!0})){Pa();return}let l="";if(this.model instanceof Ma&&((r=(s=(i=this.model.editor)==null?void 0:i.protyle)==null?void 0:s.block)!=null&&r.rootID))l=this.model.editor.protyle.block.rootID;else if(!this.model){const c=JSON.parse(this.headElement.getAttribute("data-initdata")||"{}");c&&c.instance==="Editor"&&(l=c.blockId)}l?ae("/api/filetree/getFullHPathByID",{id:l},c=>{this.headElement.getAttribute("aria-label")||hr(Ge(c.data),this.headElement),this.headElement.setAttribute("aria-label",Ge(c.data))}):this.headElement.setAttribute("aria-label",Ge(this.title))}),this.headElement.addEventListener("dragstart",a=>{if(R()){a.stopPropagation(),a.preventDefault();return}window.getSelection().removeAllRanges(),Pa();const i=A(a.target,"LI");if(i){a.dataTransfer.setData("text/html",i.outerHTML);const s={id:this.id};el(this,s),a.dataTransfer.setData(p.SIYUAN_DROP_TAB,JSON.stringify(s)),a.dataTransfer.dropEffect="move",i.style.opacity="0.38",window.siyuan.dragElement=this.headElement}ipcRenderer.send(p.SIYUAN_SEND_WINDOWS,{cmd:"resetTabsStyle",data:"removeRegionStyle"})}),this.headElement.addEventListener("dragend",a=>{const i=A(a.target,"LI");i&&(i.style.opacity="1"),document.querySelectorAll(".layout-tab-bars--drag").forEach(s=>{s.classList.remove("layout-tab-bars--drag")}),document.querySelectorAll(".layout-tab-bar li[data-clone='true']").forEach(s=>{s.remove()}),window.siyuan.dragElement=void 0,a.dataTransfer.dropEffect==="none"&&this.parent.children.forEach((s,r)=>{const o=this.headElement.parentElement.children[r];s.headElement!==o&&(r===0?this.headElement.parentElement.firstElementChild.before(s.headElement):this.headElement.parentElement.children[r-1].after(s.headElement))}),ipcRenderer.send(p.SIYUAN_SEND_WINDOWS,{cmd:"resetTabsStyle",data:"addRegionStyle"})})}this.panelElement=document.createElement("div"),this.panelElement.classList.add("fn__flex-1"),this.panelElement.innerHTML=e.panel||"",this.panelElement.setAttribute("data-id",this.id)}updateTitle(e){this.title=e,this.headElement.querySelector(".item__text").innerHTML=he(e)}addModel(e){this.model=e,e.parent=this}pin(){if(!(!this.headElement.previousElementSibling||this.headElement.previousElementSibling&&this.headElement.previousElementSibling.classList.contains("item--pin"))){let e,n=0,a;this.parent.children.find((i,s)=>{if(i.headElement.classList.contains("item--pin")&&(n=s+1,a=i.headElement),i.id===this.id)return e=this.parent.children.splice(s,1)[0],!0}),a?a.after(e.headElement):this.parent.children[0].headElement.before(e.headElement),this.parent.children.splice(n,0,e)}this.headElement.classList.add("item--pin"),(this.docIcon||this.icon)&&this.headElement.querySelector(".item__text").classList.add("fn__none"),Fi()}setDocIcon(e){var n;if(this.docIcon=e,this.docIcon){const a=this.headElement.querySelector(".item__icon");a?a.innerHTML=Yt(e):this.headElement.querySelector(".item__text").insertAdjacentHTML("beforebegin",`<span class="item__icon">${Yt(e)}</span>`),this.headElement.classList.contains("item--pin")&&this.headElement.querySelector(".item__text").classList.add("fn__none")}else(n=this.headElement.querySelector(".item__icon"))==null||n.remove(),this.headElement.querySelector(".item__text").classList.remove("fn__none")}unpin(){if(!(!this.headElement.nextElementSibling||this.headElement.nextElementSibling&&!this.headElement.nextElementSibling.classList.contains("item--pin"))){let e,n=0,a;for(let i=0;i<this.parent.children.length;i++)this.parent.children[i].id===this.id&&(e=this.parent.children.splice(i,1)[0],i--),i>-1&&this.parent.children[i].headElement.classList.contains("item--pin")&&(n=i+1,a=this.parent.children[i].headElement);a.after(e.headElement),this.parent.children.splice(n,0,e)}this.headElement.classList.remove("item--pin"),(this.docIcon||this.icon)&&this.headElement.querySelector(".item__text").classList.remove("fn__none"),Fi()}close(){this.parent.removeTab(this.id)}}var iV=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const Jg=(t,e,n,a="viewedAt")=>iV(void 0,null,function*(){let i="",s=0;[...t].sort((d,u)=>{const g=d[a]||0;return(u[a]||0)-g}).forEach(d=>{(!n||d.title.toLowerCase().includes(n.toLowerCase()))&&(i+=`<li data-index="${s}" data-node-id="${d.rootID}" class="b3-list-item${s===0?" b3-list-item--focus":""}">
${Yt(d.icon||window.siyuan.storage[p.LOCAL_IMAGES].file,"b3-list-item__graphic",!0)}
<span class="b3-list-item__text">${he(d.title)}</span>
</li>`,s++)});let o="";if(i){const d=yield wn("/api/filetree/getFullHPathByID",{id:t[0].rootID});o=he(d.data)}let l="";if(!E()){l='<ul class="b3-list b3-list--background" style="overflow: auto;width: 200px;">',(!n||window.siyuan.languages.riffCard.toLowerCase().includes(n.toLowerCase()))&&(l+=`<li data-type="riffCard" data-index="0" class="b3-list-item${o?"":" b3-list-item--focus"}">
    <svg class="b3-list-item__graphic"><use xlink:href="#iconRiffCard"></use></svg>
    <span class="b3-list-item__text">${window.siyuan.languages.riffCard}</span>
    <span class="b3-list-item__meta">${Mt(window.siyuan.config.keymap.general.riffCard.custom)}</span>
</li>`,o||(o=window.siyuan.languages.riffCard));let d=1;uw().forEach(u=>{(!n||u.title.toLowerCase().includes(n.toLowerCase()))&&(l+=`<li data-type="${u.type}" data-index="${d}" class="b3-list-item${o?"":" b3-list-item--focus"}">
    <svg class="b3-list-item__graphic"><use xlink:href="#${u.icon}"></use></svg>
    <span class="b3-list-item__text">${u.title}</span>
    <span class="b3-list-item__meta">${Mt(u.hotkey||"")}</span>
</li>`,d++,o||(o=window.siyuan.languages.riffCard))}),l=l+"</ul>"}const c=e.querySelector(".switch-doc__path");c.innerHTML=o,c.previousElementSibling.innerHTML=`<div class="fn__flex fn__flex-1" style="overflow:auto;">
        ${l}
        <ul style="${E()?"border-left:0;":""}min-width:360px;" class="b3-list b3-list--background fn__flex-1">${i}</ul>
    </div>`}),vw=()=>{if(window.siyuan.dialogs.find(e=>{if(e.element.getAttribute("data-key")===p.DIALOG_RECENTDOCS)return!0})){Ut(["dialog"]);return}ae("/api/storage/getRecentDocs",{sortBy:"viewedAt"},e=>{let n;getSelection().rangeCount>0&&(n=getSelection().getRangeAt(0));const a=new fe({positionId:p.DIALOG_RECENTDOCS,title:`<div class="fn__flex">
<div class="fn__flex-center">${window.siyuan.languages.recentDocs}</div>
<div class="fn__flex-1"></div>
<div class="b3-form__icon fn__size200">
    <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>
    <input placeholder="${window.siyuan.languages.search}" class="b3-text-field fn__block b3-form__icon-input">
</div>
<span class="fn__space"></span>
<div class="fn__flex-center">
    <select class="b3-select" id="recentDocsSort">
        <option value="viewedAt"${window.siyuan.storage[p.LOCAL_RECENT_DOCS].type==="viewedAt"?" selected":""}>${window.siyuan.languages.recentViewed}</option>
        <option value="updated"${window.siyuan.storage[p.LOCAL_RECENT_DOCS].type==="updated"?" selected":""}>${window.siyuan.languages.recentModified}</option>
        <option value="openAt"${window.siyuan.storage[p.LOCAL_RECENT_DOCS].type==="openAt"?" selected":""}>${window.siyuan.languages.recentOpened}</option>
        <option value="closedAt"${window.siyuan.storage[p.LOCAL_RECENT_DOCS].type==="closedAt"?" selected":""}>${window.siyuan.languages.recentClosed}</option>
    </select>
</div>
</div>`,content:`<div class="fn__flex-column switch-doc">
    <div class="fn__flex fn__flex-1" style="overflow:auto;"></div>
    <div class="switch-doc__path"></div>
</div>`,height:"80vh",destroyCallback:()=>{n&&n.getBoundingClientRect().height!==0&&Pt(n)}}),i=a.element.querySelector("input");i.focus(),i.addEventListener("compositionend",()=>{Jg(e.data,a.element,i.value,s.value)}),i.addEventListener("input",r=>{r.isComposing||Jg(e.data,a.element,i.value,s.value)}),a.element.setAttribute("data-key",p.DIALOG_RECENTDOCS),a.element.addEventListener("click",r=>{const o=N(r.target,"b3-list-item");o&&(a.element.querySelector(".b3-list-item--focus").classList.remove("b3-list-item--focus"),o.classList.add("b3-list-item--focus"),window.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter"})),r.stopPropagation(),r.preventDefault())});const s=a.element.querySelector("#recentDocsSort");s.addEventListener("change",()=>{s.value==="updated"?wn("/api/query/sql",{stmt:"SELECT * FROM blocks WHERE type = 'd' ORDER BY updated DESC LIMIT 33"}).then(o=>{if(o.data&&o.data.length>0){const l=o.data.map(c=>{let d="";if(c.ial){const u=c.ial.match(/icon="([^"]*)"/);u&&(d=u[1])}return{rootID:c.id,icon:d,title:c.content,updated:c.updated}});Jg(l,a.element,i.value,"updated")}}):ae("/api/storage/getRecentDocs",{sortBy:s.value},r=>{Jg(r.data,a.element,i.value,s.value)}),window.siyuan.storage[p.LOCAL_RECENT_DOCS].type=s.value,Gt(p.LOCAL_RECENT_DOCS,window.siyuan.storage[p.LOCAL_RECENT_DOCS])}),Jg(e.data,a.element)})};var sV=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const ir=(t=!0)=>{const e=document.querySelector(".layout__wnd--active .item--focus");let n;return e&&(n=mi(e.getAttribute("data-id"))),!n&&!t&&So().find(a=>{var i;(i=a.headElement)!=null&&i.classList.contains("item--focus")&&(n=a)}),n},ui=t=>{var e;const n=document.querySelector(".dock .dock__item--activefocus");if(n){let i=n.parentElement.children[t];t===-1?(i=n.parentElement.lastElementChild,i.getAttribute("data-type")||(i=i.previousElementSibling)):t===-2?(i=n.previousElementSibling,i||(i=n.parentElement.lastElementChild,i.classList.contains("dock__item--pin")&&(i=i.previousElementSibling))):t===-3&&(i=n.nextElementSibling,(!i||i.classList.contains("dock__item--pin"))&&(i=n.parentElement.firstElementChild));const s=i==null?void 0:i.getAttribute("data-type");s&&((e=Vn(s))==null||e.toggleModel(s,!0,!1));return}const a=ir(!1);if(a){let i=a.parent.headersElement.children[t];t===-1?i=a.parent.headersElement.lastElementChild:t===-2?(i=a.headElement.previousElementSibling,i||(i=a.headElement.parentElement.lastElementChild)):t===-3&&(i=a.headElement.nextElementSibling,i||(i=a.headElement.parentElement.firstElementChild)),i&&(a.parent.switchTab(i,!0),a.parent.showHeading())}};let DL;const Ui=(t=!0)=>{clearTimeout(DL),DL=window.setTimeout(()=>{const e=Cn();e.editor.forEach(n=>{n.editor&&n.editor.protyle&&n.element.parentElement&&!n.element.classList.contains("fn__none")&&n.editor.resize()}),e.backlink.forEach(n=>{const a=n.element.querySelector(".backlinkMList");a.style.height&&a.style.height!=="0px"&&n.element.clientHeight!==0&&(a.style.height=n.element.clientHeight-a.previousElementSibling.clientHeight*2+"px"),n.editors.forEach(i=>{Ut(["gutter"],i.protyle),i.resize()})}),e.search.forEach(n=>{n.element.querySelector("#searchUnRefPanel").classList.contains("fn__none")?n.editors.edit.resize():n.editors.unRefEdit.resize()}),e.custom.forEach(n=>{n.resize&&n.resize()}),fM(),rs(["gutter"]),t&&Fi()},200)},Vn=t=>{if(window.siyuan.layout.leftDock){if(window.siyuan.layout.leftDock.data[t])return window.siyuan.layout.leftDock;if(window.siyuan.layout.rightDock.data[t])return window.siyuan.layout.rightDock;if(window.siyuan.layout.bottomDock.data[t])return window.siyuan.layout.bottomDock}},CL=t=>new Sa({panel:`<div class="layout__empty">
        <div class="${window.siyuan.config.readonly?"":" fn__none"}">
            <div class="config-about__logo">
                <img src="/stage/icon.png">
                ${window.siyuan.languages.siyuanNote}
            </div>
            <div class="b3-label__text">${window.siyuan.languages.slogan}</div>
        </div>
        <div class="fn__hr"></div>
    <div class="b3-list" style="margin: 0 auto">
        <div class="b3-list-item" id="editorEmptySearch">
            <svg class="b3-list-item__graphic"><use xlink:href="#iconSearch"></use></svg>
            <span>${window.siyuan.languages.search}</span>
            <span class="b3-list-item__meta">${Mt(window.siyuan.config.keymap.general.globalSearch.custom)}</span>
        </div>
        <div id="editorEmptyRecent" class="b3-list-item">
            <svg class="b3-list-item__graphic"><use xlink:href="#iconList"></use></svg>
            <span>${window.siyuan.languages.recentDocs}</span>
            <span class="b3-list-item__meta">${Mt(window.siyuan.config.keymap.general.recentDocs.custom)}</span>
        </div>
        <div id="editorEmptyHistory" class="b3-list-item${window.siyuan.config.readonly?" fn__none":""}">
            <svg class="b3-list-item__graphic"><use xlink:href="#iconHistory"></use></svg>
            <span>${window.siyuan.languages.dataHistory}</span>
            <span class="b3-list-item__meta">${Mt(window.siyuan.config.keymap.general.dataHistory.custom)}</span>
        </div>
        <div class="b3-list-item${window.siyuan.config.readonly?" fn__none":""}" id="editorEmptyFile">
            <svg class="b3-list-item__graphic"><use xlink:href="#iconFile"></use></svg>
            <span>${window.siyuan.languages.newFile}</span>
            <span class="b3-list-item__meta">${Mt(window.siyuan.config.keymap.general.newFile.custom)}</span>
        </div>
        <div class="b3-list-item${window.siyuan.config.readonly?" fn__none":""}" id="editorEmptyNewNotebook">
            <svg class="b3-list-item__graphic"><use xlink:href="#iconFilesRoot"></use></svg>
            <span>${window.siyuan.languages.newNotebook}</span>
        </div>
        <div class="b3-list-item${yn()||window.siyuan.config.readonly?" fn__none":""}" id="editorEmptyHelp">
            <svg class="b3-list-item__graphic"><use xlink:href="#iconHelp"></use></svg>
            <span>${window.siyuan.languages.userGuide}</span>
        </div>
    </div>
</div>`,callback(e){e.panelElement.addEventListener("click",n=>{let a=n.target;for(;a&&!a.isEqualNode(e.panelElement);){if(a.id==="editorEmptySearch"){ds({app:t,hotkey:p.DIALOG_GLOBALSEARCH}),n.stopPropagation(),n.preventDefault();break}else if(a.id==="editorEmptyRecent"){vw(),n.stopPropagation(),n.preventDefault();break}else if(a.id==="editorEmptyHistory"){Xy(t),n.stopPropagation(),n.preventDefault();break}else if(a.id==="editorEmptyFile"){Oo({app:t,useSavePath:!0}),n.stopPropagation(),n.preventDefault();break}else if(a.id==="editorEmptyNewNotebook"){U2(),n.stopPropagation(),n.preventDefault();break}a=a.parentElement}})}}),xw=(t,e)=>new Sa({icon:e.icon,docIcon:e.docIcon,title:e.title,callback(n){let a;if(e.model instanceof Ma){const i=[];e.model.editor.protyle.block.action.forEach(s=>{s!==p.CB_GET_APPEND&&s!==p.CB_GET_BEFORE&&s!==p.CB_GET_HTML&&i.push(s)}),a=new Ma({app:t,tab:n,blockId:e.model.editor.protyle.block.id,rootId:e.model.editor.protyle.block.rootID,action:i,afterInitProtyle(s){var r;if(e.model instanceof Ma){const o=e.model.editor.protyle.wysiwyg.element.querySelector("[data-resize-top]");if(o){const l=s.protyle.wysiwyg.element.querySelector(`[data-node-id="${o.getAttribute("data-node-id")}"]`);l&&((r=s.protyle.observerLoad)==null||r.disconnect(),l.scrollIntoView(),s.protyle.contentElement.scrollTop+=parseInt(o.getAttribute("data-resize-top")))}}}})}else if(e.model instanceof El)a=new El({app:t,tab:n,path:e.model.path});else if(e.model instanceof Il)a=new Il({app:t,tab:n,blockId:e.model.blockId,rootId:e.model.rootId,type:e.model.type});else if(e.model instanceof js)a=new js({app:t,tab:n});else if(e.model instanceof cc)a=new cc({app:t,tab:n,blockId:e.model.blockId,type:e.model.type,isPreview:e.model.isPreview});else if(e.model instanceof yl)a=new yl({app:t,tab:n,blockId:e.model.blockId,rootId:e.model.rootId,type:e.model.type});else if(e.model instanceof cu)a=new cu(t,n);else if(e.model instanceof Sc)a=new Sc(t,n);else if(e.model instanceof Ll)a=new Ll({app:t,tab:n,config:e.model.config});else if(e.model instanceof ko){const i=e.model;i.type==="siyuan-card"?a=kE({app:t,tab:n,data:i.data}):t.plugins.find(s=>{if(s.models[i.type])return a=s.models[i.type]({tab:n,data:i.data}),!0})}else if(!e.model&&e.headElement){const i=JSON.parse(e.headElement.getAttribute("data-initdata")||"{}");i&&(a=tI(t,n,i))}n.addModel(a)}}),Fl=(t,e,n)=>sV(void 0,null,function*(){if(e==="closeOthers")for(let a=0;a<t.parent.children.length;a++)t.parent.children[a].id!==t.id&&!t.parent.children[a].headElement.classList.contains("item--pin")&&(yield t.parent.children[a].parent.removeTab(t.parent.children[a].id,!0,!1),a--);else if(e==="closeAll")for(let a=0;a<t.parent.children.length;a++)t.parent.children[a].headElement.classList.contains("item--pin")||(yield t.parent.children[a].parent.removeTab(t.parent.children[a].id,!0),a--);else if(n.length>0)for(let a=0;a<n.length;a++)n[a].headElement.classList.contains("item--pin")||(yield n[a].parent.removeTab(n[a].id));t.headElement.parentElement&&!t.headElement.parentElement.querySelector(".item--focus")?t.parent.switchTab(t.headElement,!0):t.parent.children.length>0&&t.parent.switchTab(t.parent.children[t.parent.children.length-1].headElement,!0)});class Gr{constructor(e){const n=Object.assign({direction:"tb",size:"auto",type:"normal"},e);this.id=K(),this.direction=n.direction,this.type=n.type,this.size=n.size,this.resize=e.resize,this.children=[],this.element=e.element||document.createElement("div"),this.type==="center"&&this.element.classList.add("layout__center"),n.direction==="tb"?this.element.classList.add("fn__flex-column"):this.element.classList.add("fn__flex")}addLayout(e,n){n?this.children.find((a,i)=>{if(a.id===n)return this.children.splice(i+1,0,e),a.element.after(e.element),!0}):(this.children.splice(this.children.length,0,e),this&&this.element.append(e.element)),e.size==="auto"?e.element.classList.add("fn__flex-1"):e.element.style[this&&this.direction==="lr"?"width":"height"]=e.size,nI(e),e.parent=this}addWnd(e,n){n?this.children.find((a,i)=>{if(a.id===n)return this.children.splice(i+1,0,e),this.direction==="lr"&&a.element.querySelectorAll(".protyle-content").forEach(s=>{s.parentElement.classList.contains("fn__none")||(s.classList.remove("protyle-content--transition"),s.querySelector(".protyle-wysiwyg").style.padding="",s.classList.add("protyle-content--transition"))}),a.element.after(e.element),!0}):(this.children.splice(this.children.length,0,e),this.element.append(e.element)),n&&ik(this),nI(e),Ui(!1),e.parent=this}}var rV=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class oV extends Wa{constructor(e,n){super({app:e,id:n.id}),this.selectIds=[],this.currentPage=1,this.pageCount=1,this.data={},n instanceof Element?this.element=n:this.element=n.panelElement,this.element.classList.add("fn__flex-column","file-tree","sy__inbox"),this.element.innerHTML=`<div class="block__icons">
    <div class="block__logo">
        <svg class="block__logoicon"><use xlink:href="#iconInbox"></use></svg>${window.siyuan.languages.inbox}&nbsp;
        <span class="inboxSelectCount"></span>
    </div>
    <span class="fn__flex-1"></span>
    <span class="fn__space"></span>
    <span data-type="selectall" class="block__icon"><svg><use xlink:href="#iconUncheck"></use></svg></span>
    <span class="fn__space"></span>
    <span data-type="previous" class="block__icon b3-tooltips b3-tooltips__w" disabled="disabled" aria-label="${window.siyuan.languages.previousLabel}"><svg><use xlink:href="#iconLeft"></use></svg></span>
    <span class="fn__space"></span>
    <span data-type="next" class="block__icon b3-tooltips b3-tooltips__w" disabled="disabled" aria-label="${window.siyuan.languages.nextLabel}"><svg><use xlink:href="#iconRight"></use></svg></span>
    <span class="fn__space"></span>
    <span data-type="more" data-menu="true" class="block__icon b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.more}"><svg><use xlink:href="#iconMore"></use></svg></span>
    <span class="fn__space"></span>
    <span data-type="min" class="block__icon b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.min}${un(window.siyuan.config.keymap.general.closeTab.custom)}"><svg><use xlink:href="#iconMin"></use></svg></span>
</div>
<div class="fn__loading fn__none">
    <img width="64px" src="/stage/loading-pure.svg"></div>
</div>
<div class="fn__flex-1 fn__none inboxDetails fn__flex-column" style="min-height: auto;background-color: var(--b3-theme-background)"></div>
<div class="fn__flex-1"></div>`;const a=this.element.querySelector(".inboxSelectCount"),i=this.element.querySelector(".inboxDetails"),s=this.element.firstElementChild.querySelector('[data-type="selectall"]');this.element.lastElementChild.addEventListener("contextmenu",r=>{const o=N(r.target,"b3-list-item");o&&this.more(r,o)}),this.element.addEventListener("click",r=>{ca(this.element);let o=r.target;for(;o&&!o.isEqualNode(this.element);){if(o.tagName==="A"){r.stopPropagation();break}const l=o.getAttribute("data-type");if(l==="min"){Vn("inbox").toggleModel("inbox",!1,!0),r.preventDefault();break}else if(l==="selectall"){const c=o.querySelector("use");c.getAttribute("xlink:href")==="#iconUncheck"?(this.element.lastElementChild.querySelectorAll(".b3-list-item").forEach(d=>{d.querySelector("use").setAttribute("xlink:href","#iconCheck"),this.selectIds.push(d.getAttribute("data-id")),this.selectIds=[...new Set(this.selectIds)]}),c.setAttribute("xlink:href","#iconCheck")):(this.element.lastElementChild.querySelectorAll(".b3-list-item").forEach(d=>{d.querySelector("use").setAttribute("xlink:href","#iconUncheck"),this.selectIds.splice(this.selectIds.indexOf(d.getAttribute("data-id")),1)}),c.setAttribute("xlink:href","#iconUncheck")),a.innerHTML=`${this.selectIds.length.toString()}/${this.pageCount.toString()}`,window.siyuan.menus.menu.remove(),r.stopPropagation();break}else if(l==="select"){const c=o.querySelector("use");c.getAttribute("xlink:href")==="#iconUncheck"?(this.selectIds.push(o.parentElement.getAttribute("data-id")),this.selectIds=[...new Set(this.selectIds)],c.setAttribute("xlink:href","#iconCheck")):(this.selectIds.splice(this.selectIds.indexOf(o.parentElement.getAttribute("data-id")),1),c.setAttribute("xlink:href","#iconUncheck")),a.innerHTML=`${this.selectIds.length.toString()}/${this.pageCount.toString()}`,s.querySelector("use").setAttribute("xlink:href",this.element.lastElementChild.querySelectorAll('[*|href="#iconCheck"]').length===this.element.lastElementChild.querySelectorAll(".b3-list-item").length?"#iconCheck":"#iconUncheck"),window.siyuan.menus.menu.remove(),r.stopPropagation();break}else if(l==="previous"){o.getAttribute("disabled")!=="disabled"&&(this.currentPage--,this.update()),r.preventDefault();break}else if(l==="next"){o.getAttribute("disabled")!=="disabled"&&(this.currentPage++,this.update()),r.preventDefault();break}else if(l==="back"){this.back(),r.preventDefault();break}else if(l==="more"){this.more(r),r.stopPropagation(),r.preventDefault();break}else if(o.classList.contains("b3-list-item")){const c=this.data[o.getAttribute("data-id")];s.classList.add("fn__none"),this.element.firstElementChild.querySelector('[data-type="previous"]').classList.add("fn__none"),this.element.firstElementChild.querySelector('[data-type="next"]').classList.add("fn__none"),i.innerHTML=this.genDetail(c),i.setAttribute("data-id",c.oId),i.classList.remove("fn__none"),i.scrollTop=0,this.element.lastElementChild.classList.add("fn__none"),r.preventDefault();break}o=o.parentElement}}),this.update()}back(){this.element.firstElementChild.querySelector('[data-type="selectall"]').classList.remove("fn__none"),this.element.firstElementChild.querySelector('[data-type="previous"]').classList.remove("fn__none"),this.element.firstElementChild.querySelector('[data-type="next"]').classList.remove("fn__none"),this.element.querySelector(".inboxDetails").classList.add("fn__none"),this.element.lastElementChild.classList.remove("fn__none")}genDetail(e){let n="";return e.shorthandURL&&(n=`<span class="fn__space"></span><a href="${e.shorthandURL}" target="_blank" class="block__icon block__icon--show b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.link}">
        <svg><use xlink:href="#iconLink"></use></svg>
    </a>`),`<div class="block__icons">
    <div class="block__logo fn__pointer fn__flex-1" data-type="back">
        <svg class="block__logoicon"><use xlink:href="#iconLeft"></use></svg><span class="ft__breakword">${e.shorthandTitle}</span>
    </div>
    ${n}
</div>
<div class="b3-typography b3-typography--default" style="padding: 0 8px 8px;user-select: text" data-type="textMenu">
${e.shorthandContent}
</div>`}genItemHTML(e){return`<li style="padding-left: 0" data-id="${e.oId}" class="b3-list-item">
    <span data-type="select" class="b3-list-item__action">
        <svg><use xlink:href="#icon${this.selectIds.includes(e.oId)?"Check":"Uncheck"}"></use></svg> 
    </span>
    <span class="fn__space--small"></span>
    <span class="b3-list-item__text" title="${e.shorthandTitle}${e.shorthandTitle===e.shorthandDesc?"":`
`+e.shorthandDesc}">${e.shorthandTitle}</span>
    <span class="b3-list-item__meta">${e.hCreated}</span>
</li>`}more(e,n){const a=this.element.querySelector(".inboxDetails");window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(new xe({label:window.siyuan.languages.refresh,icon:"iconRefresh",click:()=>{n?ae("/api/inbox/getShorthand",{id:n.dataset.id},s=>{this.data[s.data.oId]=s.data,n.outerHTML=this.genItemHTML(s.data)}):a.classList.contains("fn__none")?(this.currentPage=1,this.update()):ae("/api/inbox/getShorthand",{id:a.getAttribute("data-id")},s=>{this.data[s.data.oId]=s.data,a.innerHTML=this.genDetail(s.data),a.scrollTop=0})}}).element);let i=[];n?i=[n.dataset.id]:a.classList.contains("fn__none")?i=this.selectIds:i=[a.getAttribute("data-id")],i.length>0&&(window.siyuan.menus.menu.append(new xe({label:window.siyuan.languages.move,icon:"iconMove",click:()=>{this.move(i)}}).element),window.siyuan.menus.menu.append(new xe({label:window.siyuan.languages.remove,icon:"iconTrashcan",click:()=>{let s="";i.forEach((r,o)=>{s+='<code class="fn__code">'+he(this.data[r].shorthandTitle)+"</code>"+(o===i.length-1?"":", ")}),Sn(window.siyuan.languages.deleteOpConfirm,`${window.siyuan.languages.confirmDelete} ${s}?`,()=>{n?this.remove([n.dataset.id]):a.classList.contains("fn__none")?this.remove():this.remove([a.getAttribute("data-id")])},void 0,!0)}}).element)),this.app.plugins&&Is({plugins:this.app.plugins,type:"open-menu-inbox",detail:{ids:i,element:n||a},separatorPosition:"top"}),window.siyuan.menus.menu.popup({x:e.clientX,y:e.clientY+16})}remove(e){e||(e=this.selectIds),ae("/api/inbox/removeShorthands",{ids:e},()=>{if(e){this.back();for(let n=this.selectIds.length-1;n>=0;n--)e.includes(this.selectIds[n])&&this.selectIds.splice(n,1)}else this.selectIds=[];this.currentPage=1,this.update()})}move(e){ur((n,a)=>rV(this,null,function*(){for(let i=0;i<e.length;i++){const s=e[i],r=yield wn("/api/inbox/getShorthand",{id:s});this.data[r.data.oId]=r.data;let o=r.data.shorthandMd;o===""&&r.data.shorthandContent===""&&r.data.shorthandURL!=""&&(o="["+r.data.shorthandTitle+"]("+r.data.shorthandURL+")"),yield wn("/api/filetree/createDoc",{notebook:a[0],path:_n().join(ha(n[0],!1,!0),Lute.NewNodeID()+".sy"),title:Wi(r.data.shorthandTitle),md:o,listDocTree:!0})}this.remove(e)}))}update(){const e=this.element.querySelector(".fn__loading");if(Ml("")){this.element.lastElementChild.innerHTML=`<ul class="b3-list b3-list--background">
    <li class="b3-list--empty">
        ${window.siyuan.languages.inboxTip}
    </li>
    <li class="b3-list--empty">
        ${window.siyuan.config.system.container==="ios"?window.siyuan.languages._kernel[122]:window.siyuan.languages._kernel[29].replaceAll("${accountServer}",ks(""))}
    </li>
</ul>`,e.classList.add("fn__none");return}e.classList.contains("fn__none")&&(e.classList.remove("fn__none"),ae("/api/inbox/getShorthands",{page:this.currentPage},n=>{e.classList.add("fn__none");let a="";n.data.data.shorthands.length===0?a=`<ul class="b3-list b3-list--background"><li class="b3-list--empty">${window.siyuan.languages.inboxTip}</li></ul>`:(a='<ul style="padding: 8px 0" class="b3-list b3-list--background">',n.data.data.shorthands.forEach(o=>{a+=this.genItemHTML(o),this.data[o.oId]=o}),a+="</ul>"),this.element.lastElementChild.innerHTML=a,this.pageCount=n.data.data.pagination.paginationRecordCount,this.element.querySelector(".inboxSelectCount").innerHTML=`${this.selectIds.length}/${this.pageCount}`;const i=this.element.querySelector('[data-type="previous"]'),s=this.element.querySelector('[data-type="next"]');n.data.data.pagination.paginationPageCount>this.currentPage?s.removeAttribute("disabled"):s.setAttribute("disabled","disabled"),this.currentPage===1?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled");const r=this.element.lastElementChild.querySelectorAll(".b3-list-item").length;this.element.firstElementChild.querySelector('[data-type="selectall"] use').setAttribute("xlink:href",this.element.lastElementChild.querySelectorAll('[*|href="#iconCheck"]').length===r&&r!==0?"#iconCheck":"#iconUncheck"),this.element.lastElementChild.scrollTop=0}))}}var LL=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class To{constructor(){this.audioContext=null,this.processor=null,this.source=null,this.pcmBuffer=[],this.audioProcessCount=0,this.lastAudioCheck=0,this.totalSamplesCollected=0,this.intervalTimer=null,this.startTime=0,this.intervalSeconds=60,this.statusCallback=null,this.countdownSec=0,this._isTranscribing=!1,this.stream=null}static getInstance(){return To.instance||(To.instance=new To),To.instance}startRecording(e=60){return LL(this,null,function*(){this.intervalSeconds=e,this.countdownSec=this.intervalSeconds,this.pcmBuffer=[];try{this.stream=yield navigator.mediaDevices.getUserMedia({audio:!0}),this.audioContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3}),this.source=this.audioContext.createMediaStreamSource(this.stream),this.processor=this.audioContext.createScriptProcessor(4096,1,1),this.processor.onaudioprocess=n=>{const a=n.inputBuffer.getChannelData(0);this.pcmBuffer.push(new Float32Array(a)),this.audioProcessCount++,this.totalSamplesCollected+=a.length,this.audioProcessCount%100===0&&console.log("Audio process diagnostic:",{processCount:this.audioProcessCount,bufferChunks:this.pcmBuffer.length,totalSamples:this.totalSamplesCollected,estimatedDuration:(this.totalSamplesCollected/16e3).toFixed(2)+"\u79D2"})},this.source.connect(this.processor),this.processor.connect(this.audioContext.destination),this.startTime=Date.now(),this.startTimer(),console.log("Meeting recording started (PCM 16k), interval:",e,"s")}catch(n){throw Q("\u65E0\u6CD5\u8BBF\u95EE\u9EA6\u514B\u98CE: "+n),n}})}stopRecording(){this.clearTimer(),this.processor&&(this.processor.onaudioprocess=null,this.processor.disconnect(),this.processor=null),this.source&&(this.source.disconnect(),this.source=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null),this.statusCallback&&this.statusCallback({isRecording:!1,isTranscribing:!1,duration:0,nextUploadCountdown:0}),console.log("Meeting recording stopped")}get isRecording(){var e;return((e=this.audioContext)==null?void 0:e.state)==="running"}setStatusCallback(e){this.statusCallback=e}setInterval(e){this.intervalSeconds=e,this.countdownSec=e}getInterval(){return this.intervalSeconds}startTimer(){this.intervalTimer=setInterval(()=>{const e=Date.now(),n=Math.floor((e-this.startTime)/1e3);this.countdownSec--,this.countdownSec<=0&&(this.uploadAndTranscribe(),this.countdownSec=this.intervalSeconds),this.statusCallback&&this.statusCallback({isRecording:!0,isTranscribing:this._isTranscribing,duration:n,nextUploadCountdown:this.countdownSec})},1e3)}clearTimer(){this.intervalTimer&&(clearInterval(this.intervalTimer),this.intervalTimer=null)}uploadAndTranscribe(){return LL(this,null,function*(){if(this.pcmBuffer.length===0){console.warn("No PCM data to upload, skipping transcription");return}const e=this.encodeWAV(this.pcmBuffer),n=this.pcmBuffer.reduce((r,o)=>r+o.length,0),a=(n/16e3).toFixed(2);let i=0;for(const r of this.pcmBuffer)for(let o=0;o<r.length;o++){const l=Math.abs(r[o]);l>i&&(i=l)}console.log("Audio encoding completed:",{maxAmplitude:i.toFixed(4),blobSize:e.size,totalSamples:n,estimatedDuration:a+"\u79D2"}),i<.01&&console.warn("Detected very low audio amplitude. Mic might be muted or not working."),this.pcmBuffer=[];const s=new FormData;s.append("audio",e,`meeting_${Date.now()}.wav`),this._isTranscribing=!0,console.log("Uploading audio for transcription..."),fetch("/api/meeting/transcribe",{method:"POST",body:s}).then(r=>r.json()).then(r=>{console.log("Transcription API response:",r),r.code===0&&r.data?(console.log("Transcription successful:",{transcription:r.data.transcription,summary:r.data.summary}),this.insertTranscriptionToEditor(r.data)):(console.error("Transcription failed:",r.msg),Q("\u8F6C\u5F55\u5931\u8D25: "+r.msg))}).catch(r=>{console.error("Upload error:",r),Q("\u8F6C\u5F55\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC")}).finally(()=>{this._isTranscribing=!1})})}encodeWAV(e){const a=e.reduce((l,c)=>l+c.length,0),i=new ArrayBuffer(44+a*2),s=new DataView(i),r=(l,c)=>{for(let d=0;d<c.length;d++)s.setUint8(l+d,c.charCodeAt(d))};r(0,"RIFF"),s.setUint32(4,32+a*2,!0),r(8,"WAVE"),r(12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,1,!0),s.setUint32(24,16e3,!0),s.setUint32(28,16e3*2,!0),s.setUint16(32,2,!0),s.setUint16(34,16,!0),r(36,"data"),s.setUint32(40,a*2,!0);let o=44;for(let l=0;l<e.length;l++){const c=e[l];for(let d=0;d<c.length;d++){const u=Math.max(-1,Math.min(1,c[d]));s.setInt16(o,u<0?u*32768:u*32767,!0),o+=2}}return new Blob([i],{type:"audio/wav"})}insertTranscriptionToEditor(e){if(!e.transcription)return;let n=e.summary.replace(/<think>[\s\S]*?<\/think>/gi,"").replace(/<think>[\s\S]*/gi,"").replace(/<\/think>/gi,"").trim();const a=e.transcription.replace(/<think>[\s\S]*?<\/think>/gi,"").replace(/<think>[\s\S]*/gi,"").trim(),i=this.parseMeetingSummary(n),r=`> \u2728 **AI \u7EAA\u8981** <span style="opacity: 0.6; font-size: 0.9em;">${new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}</span>
> \u{1F4CC} **\u4E3B\u9898**\uFF1A${i.theme}
> \u{1F4AC} **\u8981\u70B9**\uFF1A${i.discussion}
> \u26A1 **\u540E\u7EED**\uFF1A${i.actions}

> \u{1F53D} **\u8F6C\u5F55\u539F\u6587**\uFF08\u70B9\u51FB\u5C55\u5F00\uFF09
> ${a.split(`
`).map(l=>"> "+l).join(`
`)}
`,o=new CustomEvent("neura-meeting-transcription",{detail:r});window.dispatchEvent(o),Q("AI \u8F6C\u5F55\u5DF2\u5B9E\u65F6\u540C\u6B65")}parseMeetingSummary(e){const n={theme:"\u672A\u63D0\u53D6\u5230\u4E3B\u9898",discussion:"\u672A\u63D0\u53D6\u5230\u8981\u70B9",actions:"\u672A\u63D0\u53D6\u5230\u540E\u7EED"};if(!e)return n;const a=e.split(`
`).map(i=>i.trim()).filter(i=>i.length>0);for(const i of a){const s=i.replace(/^\s*[-*>]+\s*/g,"").replace(/^\*\*[^*]+\*\*[:]?\s*/g,"").trim();i.includes("\u4E3B\u9898")||i.includes("\u4F1A\u8BAE\u4E3B\u9898")?n.theme=s||n.theme:i.includes("\u8981\u70B9")||i.includes("\u8BA8\u8BBA")||i.includes("\u5173\u952E\u8BA8\u8BBA")?n.discussion=s||n.discussion:(i.includes("\u540E\u7EED")||i.includes("\u884C\u52A8")||i.includes("\u884C\u52A8\u9879")||i.includes("\u51B3\u8BAE")||i.includes("\u7ED3\u8BBA"))&&(n.actions=s||n.actions)}return n.theme==="\u672A\u63D0\u53D6\u5230\u4E3B\u9898"&&a.length>0&&(n.theme=a[0].replace(/^\s*[-*>]+\s*/g,"").replace(/^\*\*[^*]+\*\*[:]?\s*/g,"").trim()||a[0]),n.discussion==="\u672A\u63D0\u53D6\u5230\u8981\u70B9"&&a.length>1&&(n.discussion=a[1].replace(/^\s*[-*>]+\s*/g,"").replace(/^\*\*[^*]+\*\*[:]?\s*/g,"").trim()||a[1]),n.actions==="\u672A\u63D0\u53D6\u5230\u540E\u7EED"&&a.length>2&&(n.actions=a[2].replace(/^\s*[-*>]+\s*/g,"").replace(/^\*\*[^*]+\*\*[:]?\s*/g,"").trim()||a[2]),n}}var Ew=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class qE extends Wa{constructor(e,n){super({app:e,id:n.id}),this.messages=[],this.currentEditor=null,this.activeTab="chat",this.meetingTimer=null,n instanceof Element?this.element=n:this.element=n.panelElement,this.injectStyles(),this.element.classList.add("fn__flex-column","file-tree","sy__ai"),this.renderLayout(),this.bindEvents(),this.initMeetingListener()}injectStyles(){const e="ai-dock-styles";if(document.getElementById(e))return;const n=document.createElement("style");n.id=e,n.textContent=`
            .ai-tabs {
                display: flex;
                background: var(--b3-theme-surface);
                border-bottom: 1px solid var(--b3-border-color);
                padding: 0 8px;
            }
            .ai-tab {
                padding: 10px 16px;
                cursor: pointer;
                font-size: 13px;
                color: var(--b3-theme-on-surface-light);
                border-bottom: 2px solid transparent;
                transition: all 0.2s;
                opacity: 0.7;
            }
            .ai-tab:hover {
                color: var(--b3-theme-on-surface);
                opacity: 1;
            }
            .ai-tab.active {
                color: var(--b3-theme-primary);
                border-bottom-color: var(--b3-theme-primary);
                font-weight: bold;
                opacity: 1;
            }
            .ai-panel {
                display: none;
                flex: 1;
                flex-direction: column;
                height: 100%;
                overflow: hidden;
            }
            .ai-panel.active {
                display: flex;
            }
            
            /* \u4F1A\u8BAE\u8BB0\u5F55\u6309\u94AE\u52A8\u6548 */
            .record-btn-wrapper {
                position: relative;
                width: 80px;
                height: 80px;
                margin: 0 auto;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
            }
            .record-btn {
                width: 64px;
                height: 64px;
                border-radius: 50%;
                background: var(--b3-theme-primary);
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                color: #fff;
                z-index: 2;
            }
            .record-btn:hover {
                transform: scale(1.05);
                box-shadow: 0 6px 16px rgba(0,0,0,0.3);
            }
            .record-btn.recording {
                background: #ff4d4f;
                transform: scale(0.95);
                border-radius: 20px;
            }
            .record-ripple {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 100%;
                height: 100%;
                border-radius: 50%;
                background: var(--b3-theme-primary);
                opacity: 0.2;
                animation: ripple 1.5s infinite;
                display: none;
            }
            .record-btn-wrapper.active .record-ripple {
                display: block;
                background: #ff4d4f;
            }
            @keyframes ripple {
                0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.4; }
                100% { transform: translate(-50%, -50%) scale(1.6); opacity: 0; }
            }
            
            .meeting-stat-card {
                background: var(--b3-theme-surface-lighter);
                border-radius: 8px;
                padding: 12px;
                margin-bottom: 12px;
                border: 1px solid var(--b3-border-color);
            }
            /* \u89E3\u51B3\u65E0\u6CD5\u9009\u62E9\u548C\u590D\u5236\u6587\u672C\u7684\u95EE\u9898 */
            .sy__ai .ai-messages {
                user-select: text !important;
                -webkit-user-select: text !important;
            }
            .ai-messages div {
                user-select: text !important;
                -webkit-user-select: text !important;
            }
            /* \u4F18\u5316\u9009\u4E2D\u65F6\u7684\u80CC\u666F\u8272 */
            .ai-messages ::selection {
                background: var(--b3-theme-primary-lighter);
                color: var(--b3-theme-on-primary);
            }
        `,document.head.appendChild(n)}renderLayout(){this.element.innerHTML=`
            <div class="block__icons">
                <div class="block__logo">
                    <svg class="block__logoicon"><use xlink:href="#iconSparkles"></use></svg>AI \u52A9\u624B&nbsp;
                </div>
                <span class="fn__flex-1"></span>
                <span data-type="min" class="block__icon b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.min}${un(window.siyuan.config.keymap.general.closeTab.custom)}"><svg><use xlink:href="#iconMin"></use></svg></span>
            </div>
            
            <div class="ai-tabs">
                <div class="ai-tab ${this.activeTab==="chat"?"active":""}" data-tab="chat">
                    <span style="font-size: 14px; margin-right: 4px;">\u{1F4AC}</span>\u667A\u80FD\u95EE\u7B54
                </div>
                <div class="ai-tab ${this.activeTab==="meeting"?"active":""}" data-tab="meeting">
                    <span style="font-size: 14px; margin-right: 4px;">\u{1F399}\uFE0F</span>\u4F1A\u8BAE\u7EAA\u8981
                </div>
            </div>

            <div class="fn__flex-1" style="position: relative; overflow: hidden;">
                <!-- \u804A\u5929\u9762\u677F -->
                <div class="ai-panel ${this.activeTab==="chat"?"active":""}" data-panel="chat">
                    ${this.getChatHTML()}
                </div>

                <!-- \u4F1A\u8BAE\u9762\u677F -->
                <div class="ai-panel ${this.activeTab==="meeting"?"active":""}" data-panel="meeting">
                    ${this.getMeetingHTML()}
                </div>
            </div>
        `}getChatHTML(){return`
        <div class="fn__flex-1 ai-chat-container" style="background-color: var(--b3-theme-background); display: flex; flex-direction: column; height: 100%; overflow: hidden;">
            <div class="ai-messages" style="flex: 1; overflow-y: auto; padding: 16px; background: var(--b3-theme-surface);" data-type="messages">
                <div class="ai-welcome" style="color: var(--b3-theme-on-surface-light); text-align: center; padding: 40px 10px;">
                    <div style="font-size: 32px; margin-bottom: 12px;">\u{1F916}</div>
                    <div style="font-weight: bold; margin-bottom: 8px;">AI \u667A\u80FD\u52A9\u624B</div>
                    <div style="font-size: 13px; opacity: 0.8; line-height: 1.6;">
                        \u60A8\u53EF\u4EE5\u9488\u5BF9\u5F53\u524D\u5185\u5BB9\u63D0\u95EE\uFF0C<br>\u6216\u4F7F\u7528\u4E0B\u65B9\u7684\u5FEB\u6377\u529F\u80FD\u3002
                    </div>
                </div>
            </div>
            
            <div style="padding: 12px; background: var(--b3-theme-surface); border-top: 1px solid var(--b3-border-color); flex-shrink: 0;">
                <div class="ai-prompts" style="margin-bottom: 10px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px;">
                    <button class="b3-button b3-button--outline" data-prompt="\u603B\u7ED3" style="font-size: 11px; padding: 6px 2px;">\u{1F4DD} \u603B\u7ED3\u5168\u6587</button>
                    <button class="b3-button b3-button--outline" data-prompt="\u8981\u70B9" style="font-size: 11px; padding: 6px 2px;">\u{1F3AF} \u63D0\u53D6\u8981\u70B9</button>
                    <button class="b3-button b3-button--outline" data-prompt="\u7FFB\u8BD1" style="font-size: 11px; padding: 6px 2px;">\u{1F310} \u7FFB\u8BD1\u5185\u5BB9</button>
                    <button class="b3-button b3-button--outline" data-prompt="\u6DA6\u8272" style="font-size: 11px; padding: 6px 2px;">\u270D\uFE0F \u6587\u7AE0\u6DA6\u8272</button>
                    <button class="b3-button b3-button--outline" data-prompt="\u89E3\u91CA" style="font-size: 11px; padding: 6px 2px;">\u{1F4A1} \u89E3\u91CA\u6982\u5FF5</button>
                    <button class="b3-button b3-button--outline" data-prompt="\u7EED\u5199" style="font-size: 11px; padding: 6px 2px;">\uFFFD \u7EE7\u7EED\u5199\u4F5C</button>
                </div>
                
                <div class="ai-input-container" style="display: flex; flex-direction: column; gap: 8px;">
                    <div class="ai-input" style="display: flex; gap: 8px;">
                        <input type="text" class="b3-text-field fn__flex-1" placeholder="\u5728\u6B64\u8F93\u5165\u60A8\u7684\u95EE\u9898..." data-type="input" style="padding: 8px 12px; font-size: 13px;">
                        <button class="b3-button b3-button--info" data-type="send" style="padding: 0 16px;">\u53D1\u9001</button>
                    </div>
                    <div class="ai-actions" style="display: none; justify-content: space-between; align-items: center;">
                        <button class="b3-button b3-button--cancel" data-type="save" style="font-size: 11px; padding: 4px 12px;">\u{1F4BE} \u4FDD\u5B58\u81F3\u7B14\u8BB0</button>
                        <button class="b3-button b3-button--text" data-type="clear" style="font-size: 11px; color: var(--b3-theme-on-surface-light);">\u6E05\u7A7A\u5BF9\u8BDD</button>
                    </div>
                </div>
            </div>
        </div>`}getMeetingHTML(){const n=To.getInstance().isRecording;return`
        <div class="fn__flex-1" style="background-color: var(--b3-theme-background); padding: 16px; display: flex; flex-direction: column; align-items: center;">
            
            <!-- \u8BA1\u65F6\u5668\u533A\u57DF -->
            <div style="text-align: center; margin: 32px 0 32px 0; width: 100%;">
                <div class="meeting-timer" style="font-family: monospace; font-size: 36px; font-weight: bold; color: var(--b3-theme-on-surface); line-height: 1.2; letter-spacing: 2px;">
                    00:00
                </div>
                <div class="meeting-status" style="font-size: 13px; color: var(--b3-theme-on-surface-light); margin-top: 8px;">
                    ${n?"\u6B63\u5728\u5F55\u97F3...":"\u51C6\u5907\u5C31\u7EEA"}
                </div>
            </div>

            <!-- \u63A7\u5236\u6309\u94AE\u533A\u57DF -->
            <div style="width: 100%; display: flex; justify-content: center; margin-bottom: 32px;">
                <!-- \u5F00\u59CB\u6309\u94AE (\u672A\u5F55\u97F3\u65F6\u663E\u793A) -->
                <button class="b3-button" id="btn-start-record" data-type="start-record" style="width: 140px; height: 44px; font-size: 16px; font-weight: bold; display: ${n?"none":"flex"}; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <svg style="width: 18px; height: 18px; margin-right: 8px;"><use xlink:href="#iconMic"></use></svg>\u5F00\u59CB\u5F55\u97F3
                </button>

                <!-- \u5F55\u97F3\u4E2D\u63A7\u5236\u7EC4 (\u5F55\u97F3\u65F6\u663E\u793A) -->
                <div id="recording-controls" style="display: ${n?"flex":"none"}; gap: 16px; width: 100%; justify-content: center;">
                     <button class="b3-button" data-type="summarize-record" style="flex: 1; height: 44px; font-size: 14px; font-weight: 600; background-color: var(--b3-theme-primary); color: #fff; display: flex; align-items: center; justify-content: center;">
                        <svg style="width: 16px; height: 16px; margin-right: 6px;"><use xlink:href="#iconSparkles"></use></svg>\u603B\u7ED3
                    </button>
                    <button class="b3-button b3-button--error" data-type="stop-record" style="flex: 1; height: 44px; font-size: 14px; font-weight: 600; background-color: var(--b3-theme-error); color: #fff; display: flex; align-items: center; justify-content: center;">
                        <svg style="width: 16px; height: 16px; margin-right: 6px;"><use xlink:href="#iconSquare"></use></svg>\u505C\u6B62
                    </button>
                </div>
            </div>

            <!-- \u7D27\u51D1\u8BBE\u7F6E\u5361\u7247 -->
            <div style="width: 100%; background: var(--b3-theme-surface); border-radius: 8px; padding: 12px; border: 1px solid var(--b3-border-color); margin-bottom: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center;">
                        <span style="font-size: 14px; margin-right: 6px;">\u26A1</span>
                        <span style="font-size: 13px; font-weight: 500;">\u81EA\u52A8\u540C\u6B65</span>
                    </div>
                    <select class="b3-select" id="meeting-interval" style="width: 90px; height: 30px; font-size: 12px;">
                        <option value="10">10\u79D2</option>
                        <option value="30">30\u79D2</option>
                        <option value="60">1\u5206\u949F</option>
                        <option value="120">2\u5206\u949F</option>
                        <option value="300">5\u5206\u949F</option>
                    </select>
                </div>
            </div>

            <div style="flex: 1;"></div>
            
            <!-- \u5E95\u90E8\u7B80\u8981\u7EDF\u8BA1 -->
            <div style="width: 100%; display: flex; justify-content: space-between; padding: 12px 16px; border-top: 1px solid var(--b3-border-color); font-size: 12px; color: var(--b3-theme-on-surface-light);">
                <span>\u4ECA\u65E5\u4F1A\u8BAE: <strong id="meeting-count" style="color: var(--b3-theme-on-surface);">0</strong></span>
                <span>\u603B\u65F6\u957F: <strong id="meeting-duration" style="color: var(--b3-theme-on-surface);">0m</strong></span>
            </div>

        </div>`}bindEvents(){this.element.addEventListener("click",n=>{ca(this.element);let a=n.target;for(;a&&!a.isEqualNode(this.element);){const i=a.getAttribute("data-type"),s=a.getAttribute("data-prompt"),r=a.getAttribute("data-tab");if(i==="min"){Vn("ai").toggleModel("ai",!1,!0),n.preventDefault();break}else if(i==="send"){this.handleSend(),n.preventDefault();break}else if(i==="save"){this.saveToNote(),n.preventDefault();break}else if(i==="clear"){this.clearMessages(),n.preventDefault();break}else if(i==="start-record"){this.startRecord(),n.preventDefault();break}else if(i==="stop-record"){this.stopRecord(),n.preventDefault();break}else if(i==="summarize-record"){this.summarizeRecord(),n.preventDefault();break}else if(r){this.switchTab(r),n.preventDefault();break}else if(s){this.handlePromptClick(s),n.preventDefault();break}a=a.parentElement}}),this.element.addEventListener("change",n=>{const a=n.target;a.id==="meeting-interval"&&To.getInstance().setInterval(parseInt(a.value))});const e=this.element.querySelector('[data-type="input"]');e&&e.addEventListener("keydown",n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),this.handleSend())})}switchTab(e){this.activeTab=e,this.element.querySelectorAll(".ai-tab").forEach(n=>{n.getAttribute("data-tab")===e?n.classList.add("active"):n.classList.remove("active")}),this.element.querySelectorAll(".ai-panel").forEach(n=>{n.getAttribute("data-panel")===e?n.classList.add("active"):n.classList.remove("active")})}startRecord(){return Ew(this,null,function*(){const e=To.getInstance(),n=this.element.querySelector("#meeting-interval"),a=n?parseInt(n.value):1;yield e.startRecording(a)})}stopRecord(){To.getInstance().stopRecording(),this.updateMeetingUI({isRecording:!1,isTranscribing:!1,duration:0})}summarizeRecord(){To.getInstance().uploadAndTranscribe()}handlePromptClick(e){const n=this.element.querySelector('[data-type="input"]'),a={\u603B\u7ED3:"\u8BF7\u603B\u7ED3\u8FD9\u7BC7\u6587\u6863\u7684\u5185\u5BB9",\u8981\u70B9:"\u8BF7\u63D0\u53D6\u8FD9\u7BC7\u6587\u6863\u7684\u6838\u5FC3\u8981\u70B9",\u7FFB\u8BD1:"\u8BF7\u5C06\u8FD9\u6BB5\u5185\u5BB9\u7FFB\u8BD1\u6210\u4E2D\u6587",\u6DA6\u8272:"\u8BF7\u6DA6\u8272\u8FD9\u6BB5\u6587\u5B57\uFF0C\u4F7F\u5176\u8868\u8FBE\u66F4\u4E13\u4E1A",\u89E3\u91CA:"\u8BF7\u8BE6\u7EC6\u89E3\u91CA\u63D0\u5230\u7684\u6838\u5FC3\u6982\u5FF5",\u7EED\u5199:"\u8BF7\u57FA\u4E8E\u5F53\u524D\u4E0A\u4E0B\u6587\u7EE7\u7EED\u5199\u4F5C"};n&&a[e]&&(n.value=a[e],n.focus(),e!=="\u95EE\u7B54"&&setTimeout(()=>this.handleSend(),100))}handleSend(){var e,n;const a=this.element.querySelector('[data-type="input"]');if(!a||!a.value.trim())return;const i=a.value.trim();a.value="",this.addMessage("user",i);const s=this.getCurrentDocContent(),r=this.getDocumentAttachments(),o=((n=(e=this.currentEditor)==null?void 0:e.protyle)==null?void 0:n.notebookId)||"";this.addMessage("assistant","\u{1F914} \u6B63\u5728\u601D\u8003\u4E2D..."),this.callAI(i,s,r,o).then(c=>{this.messages.pop(),this.addMessage("assistant",c);const d=this.element.querySelector(".ai-actions");d&&(d.style.display="flex")}).catch(c=>{this.messages.pop();const d=`\u274C AI\u8C03\u7528\u5931\u8D25: ${c.message||"\u672A\u77E5\u9519\u8BEF"}

\u8BF7\u68C0\u67E5AI\u914D\u7F6E\u662F\u5426\u6B63\u786E\u3002`;this.addMessage("assistant",d),console.error("AI\u8C03\u7528\u5931\u8D25:",c)})}initMeetingListener(){const e=To.getInstance(),n=this.element.querySelector("#meeting-interval");n&&(n.value=e.getInterval().toString()),e.setStatusCallback(a=>{this.updateMeetingUI(a)}),window.addEventListener("neura-meeting-transcription",a=>{var i,s,r;const o=a.detail;if(!o)return;const l=this.getBestEditor();if(l&&((i=l.editor)!=null&&i.protyle)){const c=l.editor.protyle,d=c.lute.Md2BlockDOM(o);Aa(d,c,!0),setTimeout(()=>{const u=c.wysiwyg.element.lastElementChild;u&&(qt(u),u.scrollIntoView({behavior:"smooth",block:"end"}))},200)}else(r=(s=window.siyuan).showMessage)==null||r.call(s,"\u672A\u627E\u5230\u6D3B\u52A8\u6587\u6863\uFF0C\u4F1A\u8BAE\u7EAA\u8981\u65E0\u6CD5\u63D2\u5165",3e3,"error")})}updateMeetingUI(e){const n=this.element.querySelector("#btn-start-record"),a=this.element.querySelector("#recording-controls"),i=this.element.querySelector(".meeting-status"),s=this.element.querySelector(".meeting-timer");if(e.isRecording?(n&&(n.style.display="none"),a&&(a.style.display="flex"),i&&(i.textContent=e.isTranscribing?"\u2728 \u6B63\u5728\u8F6C\u5F55\u4E2D...":"\u{1F534} \u6B63\u5728\u5F55\u97F3...")):(n&&(n.style.display="flex"),a&&(a.style.display="none"),i&&(i.textContent="\u51C6\u5907\u5C31\u7EEA")),s){const r=Math.floor(e.duration/60).toString().padStart(2,"0"),o=(e.duration%60).toString().padStart(2,"0");s.textContent=`${r}:${o}`}}getBestEditor(){const e=Cn();let n=null;if(n=e.editor.find(a=>{var i,s;return(s=(i=a.parent)==null?void 0:i.headElement)==null?void 0:s.classList.contains("item--focus")}),n||(n=e.editor.find(a=>{var i,s;return(s=(i=a.parent)==null?void 0:i.headElement)==null?void 0:s.classList.contains("fn__flex-1--focus")})),!n&&e.editor.length>0){let a=0;e.editor.forEach(i=>{var s,r;const o=parseInt(((r=(s=i.parent)==null?void 0:s.headElement)==null?void 0:r.getAttribute("data-activetime"))||"0");o>a&&(a=o,n=i)})}return!n&&e.editor.length>0&&(n=e.editor[0]),n}getCurrentDocContent(){var e;const n=this.getBestEditor();return n&&((e=n.editor)!=null&&e.protyle)?(this.currentEditor=n.editor,n.editor.protyle.wysiwyg.element.textContent||""):""}getDocumentAttachments(){var e;if(!((e=this.currentEditor)!=null&&e.protyle))return console.log("[AI] getDocumentAttachments: currentEditor\u4E0D\u5B58\u5728"),[];const n=[],a=this.currentEditor.protyle.wysiwyg.element,i=[".pdf",".doc",".docx",".xls",".xlsx",".pptx",".txt",".md",".markdown",".csv",".rtf",".odt",".json",".xml",".html",".htm",".yaml",".yml",".toml",".ini",".conf",".log",".py",".js",".ts",".go",".java",".c",".cpp",".h",".sh"],s=g=>{const f=`${g}.ocr.json`;return console.log(`[AI] \u68C0\u67E5OCR\u6587\u4EF6: ${f} (\u5BF9\u5E94PDF: ${g})`),f},r=g=>{if(g&&i.some(f=>g.toLowerCase().endsWith(f)))if(g.toLowerCase().endsWith(".pdf")){const f=s(g);f&&!n.includes(f)&&(n.push(f),console.log("[AI] \u627E\u5230OCR JSON\u6587\u4EF6:",f))}else n.includes(g)||(n.push(g),console.log("[AI] \u627E\u5230\u9644\u4EF6:",g))};a.querySelectorAll('span[data-type="a"]').forEach(g=>{r(g.getAttribute("data-href")||"")}),a.querySelectorAll('[data-href*="assets/"]').forEach(g=>{r(g.getAttribute("data-href")||"")}),a.querySelectorAll('[data-subtype="a"]').forEach(g=>{r(g.getAttribute("data-href")||"")});const l=a.innerHTML.match(/assets\/[^"'\s<>]+\.(pdf|docx?|xlsx?|pptx?|txt|md|csv|rtf|odt)/gi);return l&&l.forEach(g=>r(g)),console.log("[AI] \u9644\u4EF6\u626B\u63CF\u5B8C\u6210\uFF0C\u5171\u627E\u5230:",n.length,"\u4E2A\u9644\u4EF6"),a.querySelectorAll('span[data-type="a"]').forEach(g=>{const f=g.getAttribute("data-href")||"";i.some(h=>f.toLowerCase().endsWith(h))&&(n.includes(f)||n.push(f))}),a.querySelectorAll("a").forEach(g=>{const f=g.getAttribute("href")||"";i.some(h=>f.toLowerCase().endsWith(h))&&(n.includes(f)||n.push(f))}),a.querySelectorAll('[data-type="NodeFile"]').forEach(g=>{const f=g.getAttribute("data-src")||"";i.some(h=>f.toLowerCase().endsWith(h))&&(n.includes(f)||n.push(f))}),n}parseAttachments(e){return Ew(this,null,function*(){var n,a;if(e.length===0)return"";let i="";for(const s of e)try{if(s.toLowerCase().endsWith(".ocr.json")){console.log("[AI] \u8BFB\u53D6OCR JSON\u6587\u4EF6:",s);const r=s.replace(".ocr.json",""),o=yield wn("/api/ai/getOCRResult",{assetPath:r});if(o.code===0&&o.data){const l=o.data.fullText||"",c=((n=s.split("/").pop())==null?void 0:n.replace(".ocr.json",""))||s,d=l.length>5e3?l.substring(0,5e3)+"...(\u5185\u5BB9\u5DF2\u622A\u65AD)":l;i+=`

--- OCR\u6587\u6863: ${c} ---
${d}`,console.log("[AI] \u6210\u529F\u8BFB\u53D6OCR JSON\u6587\u4EF6\uFF0C\u5185\u5BB9\u957F\u5EA6:",d.length)}else console.warn("[AI] \u8BFB\u53D6OCR JSON\u6587\u4EF6\u5931\u8D25:",s,o.msg)}else{console.log("[AI] \u4F7F\u7528\u6279\u91CF\u89E3\u6790\u63A5\u53E3\u5904\u7406\u6587\u4EF6:",s);const r=yield wn("/api/ai/batchParseAttachments",{paths:[s]});if(r.code===0){const o=((a=r.data)==null?void 0:a.results)||[];for(const l of o)if(l.content&&!l.error){const c=l.path.split("/").pop()||l.path,d=l.content.length>5e3?l.content.substring(0,5e3)+"...(\u5185\u5BB9\u5DF2\u622A\u65AD)":l.content;i+=`

--- \u9644\u4EF6: ${c} ---
${d}`}}else console.warn("[AI] \u6279\u91CF\u89E3\u6790\u9644\u4EF6\u5931\u8D25:",r.msg)}}catch(r){console.error("[AI] \u89E3\u6790\u9644\u4EF6\u5931\u8D25:",s,r)}return i})}callAI(e,n){return Ew(this,arguments,function*(a,i,s=[],r=""){const o=[];console.log("[AI] callAI\u88AB\u8C03\u7528\uFF0C\u51C6\u5907\u4F9D\u9760\u540E\u7AEF RAG \u589E\u5F3A");let l="";return i&&i.trim()&&(l+=`\u3010\u5F53\u524D\u6D3B\u52A8\u6587\u6863\u6B63\u6587\u3011
${i.substring(0,5e4)}${i.length>5e4?"...(\u6B63\u6587\u5DF2\u622A\u65AD)":""}
`),o.push({role:"system",content:`\u4F60\u662F\u4E00\u4E2A\u62E5\u6709\u8D85\u957F\u4E0A\u4E0B\u6587\u7A97\u53E3\u7684\u667A\u80FD\u6587\u6863\u52A9\u624B\uFF08\u9002\u914D 72k Token \u6A21\u578B\uFF09\u3002\u540E\u7AEF\u5DF2\u4E3A\u4F60\u6CE8\u5165\u4E86\u6D77\u91CF\u7684\u9644\u4EF6 RAG \u4E0A\u4E0B\u6587\u6216\u957F\u6587\u672C\u603B\u7ED3\u3002
\u8BF7\u5145\u5206\u5229\u7528\u8FD9\u4E9B\u8BE6\u7EC6\u4FE1\u606F\uFF0C\u4F18\u5148\u53C2\u8003\u6CE8\u5165\u7684\u3010\u76F8\u5173\u7247\u6BB5\u3011\u6216\u3010\u6240\u6709\u76F8\u5173\u9644\u4EF6\u3011\u5185\u5BB9\uFF0C\u5BF9\u7528\u6237\u95EE\u9898\u8FDB\u884C\u6DF1\u5EA6\u3001\u5168\u9762\u7684\u56DE\u7B54\uFF0C\u65E0\u9700\u62C5\u5FC3\u957F\u5EA6\u9650\u5236\u3002
${l}`}),this.messages.slice(0,-1).forEach(d=>{let u=d.content;d.role==="assistant"&&(u=u.replace(/<think>[\s\S]*?<\/think>/g,"").trim(),u=u.replace(/<think>[\s\S]*/g,"").trim()),u&&o.push({role:d.role,content:u})}),console.log("[AI] \u53D1\u9001\u7ED9\u540E\u7AEF\u7684\u6D88\u606F\u6761\u6570:",o.length),this.callAIStream(o,s,r)})}callAIStream(e){return Ew(this,arguments,function*(n,a=[],i=""){return new Promise((s,r)=>{let o="";const l=localStorage.getItem("siyuan_token")||"";fetch("/api/ai/chatStream",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`,"X-Auth-Token":l},body:JSON.stringify({messages:n,activeAttachments:a,notebookId:i}),credentials:"include"}).then(c=>{var d;if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const u=(d=c.body)==null?void 0:d.getReader();if(!u)throw new Error("\u65E0\u6CD5\u83B7\u53D6\u54CD\u5E94\u6D41");const g=new TextDecoder,f=()=>{u.read().then(({done:h,value:m})=>{if(h){s(o||"AI \u6CA1\u6709\u8FD4\u56DE\u5185\u5BB9");return}const y=g.decode(m,{stream:!0}).split(`
`);for(const _ of y)if(_.startsWith("data: "))try{const v=JSON.parse(_.slice(6));if(v.error){r(new Error(v.error));return}if(v.token&&(o+=v.token,this.updateStreamingMessage(o)),v.done){s(o||"AI \u6CA1\u6709\u8FD4\u56DE\u5185\u5BB9");return}}catch(v){}f()}).catch(r)};f()}).catch(r)})})}updateStreamingMessage(e){const n=this.element.querySelector('[data-type="messages"]');if(!n)return;const a=n.lastElementChild;if(a){const i=a.querySelector("div:last-child");i&&(i.innerHTML=this.escapeHtml(e),n.scrollTop=n.scrollHeight)}}generateMockResponse(e,n){return e.includes("\u603B\u7ED3")?`\u{1F4CB} **\u6587\u6863\u603B\u7ED3**

\u6839\u636E\u5F53\u524D\u6587\u6863\u5185\u5BB9\uFF0C\u4E3B\u8981\u8BA8\u8BBA\u4E86\u4EE5\u4E0B\u51E0\u4E2A\u65B9\u9762\uFF1A

1. \u6838\u5FC3\u89C2\u70B9\u548C\u4E3B\u9898
2. \u5173\u952E\u8BBA\u636E\u548C\u652F\u6491\u6750\u6599
3. \u7ED3\u8BBA\u548C\u542F\u793A

_\uFF08\u8FD9\u662F\u4E00\u4E2A\u793A\u4F8B\u54CD\u5E94\uFF0C\u5B9E\u9645\u5E94\u7528\u4E2D\u9700\u8981\u63A5\u5165AI\u670D\u52A1\uFF09_`:e.includes("\u8981\u70B9")?`\u{1F3AF} **\u5173\u952E\u8981\u70B9**

\u2022 \u8981\u70B9\u4E00\uFF1A\u6838\u5FC3\u6982\u5FF5\u8BF4\u660E
\u2022 \u8981\u70B9\u4E8C\uFF1A\u91CD\u8981\u8BBA\u636E
\u2022 \u8981\u70B9\u4E09\uFF1A\u5B9E\u8DF5\u5E94\u7528
\u2022 \u8981\u70B9\u56DB\uFF1A\u6CE8\u610F\u4E8B\u9879

_\uFF08\u8FD9\u662F\u4E00\u4E2A\u793A\u4F8B\u54CD\u5E94\uFF0C\u5B9E\u9645\u5E94\u7528\u4E2D\u9700\u8981\u63A5\u5165AI\u670D\u52A1\uFF09_`:e.includes("\u7EED\u5199")?`\u270D\uFE0F **\u7EED\u5199\u5EFA\u8BAE**

\u57FA\u4E8E\u5F53\u524D\u5185\u5BB9\uFF0C\u53EF\u4EE5\u4ECE\u4EE5\u4E0B\u89D2\u5EA6\u7EE7\u7EED\u5C55\u5F00\uFF1A

1. \u6DF1\u5165\u5206\u6790\u73B0\u6709\u89C2\u70B9
2. \u8865\u5145\u76F8\u5173\u6848\u4F8B
3. \u63D0\u51FA\u53EF\u80FD\u7684\u89E3\u51B3\u65B9\u6848
4. \u603B\u7ED3\u548C\u5C55\u671B

_\uFF08\u8FD9\u662F\u4E00\u4E2A\u793A\u4F8B\u54CD\u5E94\uFF0C\u5B9E\u9645\u5E94\u7528\u4E2D\u9700\u8981\u63A5\u5165AI\u670D\u52A1\uFF09_`:e.includes("\u4F18\u5316")?`\u2728 **\u4F18\u5316\u5EFA\u8BAE**

**\u7ED3\u6784\u4F18\u5316\uFF1A**
- \u5EFA\u8BAE\u8C03\u6574\u6BB5\u843D\u987A\u5E8F\uFF0C\u4F7F\u903B\u8F91\u66F4\u6E05\u6670
- \u53EF\u4EE5\u6DFB\u52A0\u5C0F\u6807\u9898\uFF0C\u589E\u5F3A\u53EF\u8BFB\u6027

**\u8868\u8FBE\u4F18\u5316\uFF1A**
- \u90E8\u5206\u53E5\u5B50\u53EF\u4EE5\u66F4\u7B80\u6D01
- \u4E13\u4E1A\u672F\u8BED\u9700\u8981\u9002\u5F53\u89E3\u91CA

_\uFF08\u8FD9\u662F\u4E00\u4E2A\u793A\u4F8B\u54CD\u5E94\uFF0C\u5B9E\u9645\u5E94\u7528\u4E2D\u9700\u8981\u63A5\u5165AI\u670D\u52A1\uFF09_`:`\u{1F4A1} **AI \u56DE\u590D**

\u5173\u4E8E\u60A8\u7684\u95EE\u9898"${e}"\uFF1A

\u6839\u636E\u6587\u6863\u5185\u5BB9\u5206\u6790\uFF0C\u6211\u7684\u7406\u89E3\u662F...

_\uFF08\u8FD9\u662F\u4E00\u4E2A\u793A\u4F8B\u54CD\u5E94\uFF0C\u5B9E\u9645\u5E94\u7528\u4E2D\u9700\u8981\u63A5\u5165\u771F\u5B9E\u7684AI\u670D\u52A1\u8FDB\u884C\u5206\u6790\uFF09_`}addMessage(e,n){const a={role:e,content:n,timestamp:Date.now()};this.messages.push(a),this.renderMessages()}renderMessages(){const e=this.element.querySelector('[data-type="messages"]');if(!e)return;const n=e.querySelector(".ai-welcome");n&&n.remove(),e.innerHTML=this.messages.map(a=>{const i=a.role==="user";return`
                <div style="display: flex; justify-content: ${i?"flex-end":"flex-start"}; margin-bottom: 12px;">
                    <div style="max-width: 85%; background: ${i?"var(--b3-theme-primary-lighter)":"var(--b3-theme-surface)"}; padding: 8px 12px; border-radius: 8px; word-wrap: break-word;">
                        <div style="font-size: 11px; color: var(--b3-theme-on-surface-light); margin-bottom: 4px;">
                            ${i?"\u{1F464}":"\u{1F916}"} ${i?"\u6211":"AI\u52A9\u624B"}
                        </div>
                        <div style="line-height: 1.6; white-space: pre-wrap; font-size: 13px;">${this.escapeHtml(a.content)}</div>
                    </div>
                </div>
            `}).join(""),e.scrollTop=e.scrollHeight}escapeHtml(e){let n=e,a="";const i=n.match(/<think>([\s\S]*?)<\/think>/);if(i)a=i[1],n=n.replace(/<think>[\s\S]*?<\/think>/,"");else{const o=n.match(/<think>([\s\S]*)/);o&&(a=o[1],n=n.replace(/<think>[\s\S]*/,""))}const s=o=>o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,'<code style="background: var(--b3-theme-surface-lighter); padding: 2px 4px; border-radius: 2px;">$1</code>').replace(/\n/g,"<br>");let r=s(n.trim());return a&&(r=`<div class="ai-thought" style="margin-bottom: 8px; border-left: 2px solid var(--b3-theme-surface-lighter); padding-left: 8px; font-size: 12px; color: var(--b3-theme-on-surface-light); opacity: 0.8;">
                <div style="font-weight: bold; margin-bottom: 2px; display: flex; align-items: center; opacity: 0.6;">
                    <svg style="width: 12px; height: 12px; margin-right: 4px;"><use xlink:href="#iconSparkles"></use></svg>\u601D\u8003\u8FC7\u7A0B
                </div>
                <div style="font-style: italic;">${s(a.trim())}</div>
            </div>`+r),r}saveToNote(){var e,n,a,i,s,r,o,l,c,d;if(!this.currentEditor||!this.currentEditor.protyle){(n=(e=window.siyuan).showMessage)==null||n.call(e,"\u8BF7\u5148\u6253\u5F00\u4E00\u4E2A\u6587\u6863",3e3,"error");return}const u=[...this.messages].reverse().find(g=>g.role==="assistant");if(!u){(i=(a=window.siyuan).showMessage)==null||i.call(a,"\u6CA1\u6709\u53EF\u4FDD\u5B58\u7684AI\u56DE\u590D",3e3,"error");return}try{const g=this.currentEditor.protyle;if(g.wysiwyg.element.lastElementChild){let h=u.content;if(h=h.replace(/<think>[\s\S]*?<\/think>/g,""),h=h.replace(/<think>[\s\S]*/g,""),h=h.trim(),!h){(r=(s=window.siyuan).showMessage)==null||r.call(s,"AI \u8FD8\u6CA1\u6709\u751F\u6210\u6B63\u5F0F\u56DE\u590D",3e3,"info");return}const m=`

---

## \u{1F916} AI \u5206\u6790\u7ED3\u679C

${h}

*\u751F\u6210\u65F6\u95F4\uFF1A${new Date(u.timestamp).toLocaleString()}*
`,b=g.lute.Md2BlockDOM(m);Aa(b,g,!0),setTimeout(()=>{const y=g.wysiwyg.element.lastElementChild;y&&qt(y,void 0,!1)},100),(l=(o=window.siyuan).showMessage)==null||l.call(o,"\u2705 \u5DF2\u4FDD\u5B58\u5230\u7B14\u8BB0\u672B\u5C3E",2e3,"info")}}catch(g){console.error("\u4FDD\u5B58\u5230\u7B14\u8BB0\u5931\u8D25:",g),(d=(c=window.siyuan).showMessage)==null||d.call(c,"\u4FDD\u5B58\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5",3e3,"error")}}clearMessages(){this.messages=[];const e=this.element.querySelector('[data-type="messages"]');e&&(e.innerHTML=`
                <div class="ai-welcome" style="color: var(--b3-theme-on-surface-light); text-align: center; padding: 20px 10px;">
                    <div style="font-size: 24px; margin-bottom: 8px;">\u{1F916}</div>
                    <div style="font-weight: bold; margin-bottom: 8px;">AI \u6587\u6863\u5206\u6790\u52A9\u624B</div>
                    <div style="font-size: 12px; line-height: 1.6;">
                        \u9009\u62E9\u4E00\u4E2A\u63D0\u793A\u8BCD\u5FEB\u901F\u5F00\u59CB\u5206\u6790\u5F53\u524D\u6587\u6863<br>
                        \u5206\u6790\u5B8C\u6210\u540E\u53EF\u4EE5\u4FDD\u5B58\u5230\u7B14\u8BB0\u672B\u5C3E
                    </div>
                </div>
            `);const n=this.element.querySelector(".ai-actions");n&&(n.style.display="none")}}const WE=["file","outline","inbox","bookmark","tag","backlink","ai"];class VE{constructor(e){this.pin=!0;var n;switch(e.position){case"Left":this.layout=window.siyuan.layout.layout.children[0].children[0],this.resizeElement=this.layout.element.nextElementSibling,this.layout.element.classList.add("layout__dockl"),this.layout.element.insertAdjacentHTML("beforeend",'<div class="layout__dockresize layout__dockresize--lr"></div>');break;case"Right":this.layout=window.siyuan.layout.layout.children[0].children[2],this.resizeElement=this.layout.element.previousElementSibling,this.layout.element.classList.add("layout__dockr"),this.layout.element.insertAdjacentHTML("beforeend",'<div class="layout__dockresize layout__dockresize--lr"></div>');break;case"Bottom":this.layout=window.siyuan.layout.layout.children[1],this.resizeElement=this.layout.element.previousElementSibling,this.layout.element.classList.add("layout__dockb"),this.layout.element.insertAdjacentHTML("beforeend",'<div class="layout__dockresize"></div>');break}this.app=e.app,this.element=document.getElementById("dock"+e.position);const a=e.position==="Bottom"?' class="fn__flex dock__items"':' class="dock__items"';this.element.innerHTML=`<div${a}></div><div class="fn__flex-1 dock__item--space"></div><div${a}></div>`,this.position=e.position,this.pin=e.data.pin,this.data={};let i=!1;e.data.data.length!==0&&(i||e.data.data[0].find(r=>{if(WE.includes(r.type))return i=!0,!0}),!i&&e.data.data[1]&&e.data.data[1].find(r=>{if(WE.includes(r.type))return i=!0,!0})),i?(this.genButton(e.data.data[0],0),e.data.data[1]&&this.genButton(e.data.data[1],1),this.element.classList.remove("fn__none")):(this.element.firstElementChild.innerHTML=`<span class="dock__item dock__item--pin ariaLabel" aria-label="${this.pin?window.siyuan.languages.unpin:window.siyuan.languages.pin}">
    <svg><use xlink:href="#icon${this.pin?"Unpin":"Pin"}"></use></svg>
</span>`,this.element.classList.add("fn__none"));const s=this.element.querySelectorAll(".dock__item--active");this.element.querySelectorAll(".dock__item").forEach(r=>{r.getAttribute("data-type")==="file"&&!r.classList.contains("dock__item--active")&&(this.toggleModel("file",!0,!1,!1,!1),this.toggleModel("file",!1,!1,!1,!1))}),s.length===0?(this.resizeElement.classList.add("fn__none"),this.layout.children.length>1&&(this.layout.children.forEach(r=>{r.element.classList.add("fn__none")}),(n=this.layout.children[0].element.nextElementSibling)==null||n.classList.add("fn__none"))):s.forEach(r=>{this.toggleModel(r.getAttribute("data-type"),!0,!1,!1,!1)}),this.element.addEventListener("click",r=>{let o=r.target;for(;o&&!o.isEqualNode(this.element);){const l=o.getAttribute("data-type");if(l){this.toggleModel(l,!1,!0),r.preventDefault();break}else if(o.classList.contains("dock__item")){this.togglePin(),o.setAttribute("aria-label",this.pin?window.siyuan.languages.unpin:window.siyuan.languages.pin),o.querySelector("use").setAttribute("xlink:href",this.pin?"#iconUnpin":"#iconPin"),r.preventDefault();break}o=o.parentElement}}),this.element.addEventListener("mousedown",r=>{const o=N(r.target,"dock__item");if(!o||!o.getAttribute("data-type"))return;const l=document;l.ondragstart=()=>!1;let c,d;const u=document.createElement("span");u.classList.add("dock__item","fn__none"),u.style.background="var(--b3-theme-primary-light)",u.innerHTML="<svg></svg>",u.id="dockMoveItem",l.onmousemove=g=>{var f;if(window.siyuan.config.readonly||Math.abs(g.clientY-r.clientY)<3&&Math.abs(g.clientX-r.clientX)<3)return;g.preventDefault(),g.stopPropagation(),c||(o.style.opacity="0.38",c=o.cloneNode(!0),c.setAttribute("data-ghost-type","dock"),this.element.append(c),c.setAttribute("data-original",JSON.stringify({position:this.position,index:o.getAttribute("data-index"),previousType:(f=o.previousElementSibling)==null?void 0:f.getAttribute("data-type"),type:o.getAttribute("data-type")})),c.setAttribute("id","dragGhost"),c.setAttribute("style",`background-color:var(--b3-theme-background-light);position: fixed; top: ${r.clientY}px; left: ${r.clientX}px; z-index:999997;`)),this.position==="Bottom"?(c.style.top=g.clientY-40+"px",c.style.left=g.clientX-20+"px"):(c.style.top=g.clientY-20+"px",this.position==="Left"?c.style.left=g.clientX+"px":c.style.left=g.clientX-40+"px");const h=N(g.target,"dock__item")||N(g.target,"dock__items")||N(g.target,"dock__item--space");if(h&&d&&h===d){if(d.classList.contains("dock__item--space")){const m=d.getBoundingClientRect();if(d.parentElement.id==="dockBottom"){if(g.clientX<m.right&&g.clientX>m.right-40){const b=d.nextElementSibling.firstElementChild;b&&b===o?u.classList.add("fn__none"):(u.classList.remove("fn__none"),b.before(u))}}else if(g.clientY<m.bottom&&g.clientY>m.bottom-40){const b=d.nextElementSibling.firstElementChild;b&&b===o?u.classList.add("fn__none"):(u.classList.remove("fn__none"),b.before(u))}}else if(d.classList.contains("dock__item--pin"))o.nextElementSibling&&o.nextElementSibling===d?u.classList.add("fn__none"):(u.classList.remove("fn__none"),d.before(u));else if(d.classList.contains("dock__item")){const m=d.getBoundingClientRect();d.parentElement.parentElement.id==="dockBottom"?m.left+m.width/2>g.clientX?o.nextElementSibling&&o.nextElementSibling===d?u.classList.add("fn__none"):(u.classList.remove("fn__none"),d.before(u)):o.previousElementSibling&&o.previousElementSibling===d?u.classList.add("fn__none"):(u.classList.remove("fn__none"),d.after(u)):m.top+m.height/2>g.clientY?o.nextElementSibling&&o.nextElementSibling===d?u.classList.add("fn__none"):(u.classList.remove("fn__none"),d.before(u)):o.previousElementSibling&&o.previousElementSibling===d?u.classList.add("fn__none"):(u.classList.remove("fn__none"),d.after(u))}else d.childElementCount===0?(u.classList.remove("fn__none"),d.append(u)):d.childElementCount===1&&d.firstElementChild.id==="dockMoveItem"?u.classList.remove("fn__none"):d.childElementCount===1&&d.firstElementChild.classList.contains("dock__item--pin")?(u.classList.remove("fn__none"),d.insertAdjacentElement("afterbegin",u)):d.childElementCount===2&&d.firstElementChild.id==="dockMoveItem"&&d.lastElementChild.classList.contains("dock__item--pin")&&u.classList.remove("fn__none");return}if(!h||h.style.position==="fixed"||h===o||h.id==="dockMoveItem"){h&&h===o&&u.classList.add("fn__none");return}d=h},l.onmouseup=()=>{var g;if(l.onmousemove=null,l.onmouseup=null,l.ondragstart=null,l.onselectstart=null,l.onselect=null,c==null||c.remove(),o.style.opacity==="0.38"){if(o.style.opacity="",!u.classList.contains("fn__none")){let f;u.parentElement.parentElement.id==="dockBottom"?f=window.siyuan.layout.bottomDock:u.parentElement.parentElement.id==="dockLeft"?f=window.siyuan.layout.leftDock:u.parentElement.parentElement.id==="dockRight"&&(f=window.siyuan.layout.rightDock),f.add(u.parentElement===f.element.firstElementChild?0:1,o,(g=u.previousElementSibling)==null?void 0:g.getAttribute("data-type"))}u.remove()}}}),this.layout.element.addEventListener("mouseleave",r=>{var o,l;r.buttons!==0||this.pin||(o=r.toElement)!=null&&o.classList.contains("b3-menu")||(l=r.toElement)!=null&&l.classList.contains("tooltip")||this.position==="Left"&&r.clientX<43||this.position==="Right"&&r.clientX>window.innerWidth-43||this.position==="Bottom"&&r.clientY>window.innerHeight-73||this.hideDock()}),this.layout.element.querySelector(".layout__dockresize").addEventListener("mousedown",r=>{const o=document,l=this.position==="Bottom"?"tb":"lr",c=r[l==="lr"?"clientX":"clientY"],d=l==="lr"?this.layout.element.clientWidth:this.layout.element.clientHeight;o.onmousemove=u=>{u.preventDefault(),u.stopPropagation();let g;this.position==="Left"?g=d+(u.clientX-c):this.position==="Right"?g=d+(c-u.clientX):g=d+(c-u.clientY);let f=232;Array.from(this.layout.element.querySelectorAll(".file-tree")).find(h=>{if((h.classList.contains("sy__backlink")||h.classList.contains("sy__graph")||h.classList.contains("sy__globalGraph")||h.classList.contains("sy__inbox"))&&!h.classList.contains("fn__none")&&!N(h,"fn__none"))return f=320,!0}),!(g<f&&l==="lr")&&(g<64&&l==="tb"||(this.layout.element.style[l==="lr"?"width":"height"]=g+"px"))},o.onmouseup=()=>{o.onmousemove=null,o.onmouseup=null,o.ondragstart=null,o.onselectstart=null,o.onselect=null,this.setSize(),this.element.querySelectorAll(".dock__item--active").forEach(u=>{const g=this.data[u.getAttribute("data-type")];g&&g instanceof ko&&g.resize&&g.resize()})}}),window.siyuan.config.uiLayout.hideDock&&this.element.classList.add("fn__none"),this.pin||setTimeout(()=>{this.resetDockPosition(!1),this.hideDock(!0),this.layout.element.classList.add("layout--float"),this.resizeElement.classList.add("fn__none")})}togglePin(){this.pin=!this.pin;const e=this.element.querySelector(".dock__item--active");this.pin?(this.layout.element.style.opacity="",this.layout.element.style.transform="",this.layout.element.style.zIndex="",e&&this.resizeElement.classList.remove("fn__none")):(this.resetDockPosition(!!e),this.resizeElement.classList.add("fn__none"),e?this.showDock(!0):this.hideDock(!0)),this.layout.element.classList.toggle("layout--float"),Ui()}resetDockPosition(e){this.position==="Left"?this.layout.element.setAttribute("style",`width:${this.layout.element.clientWidth}px;opacity:${e?1:0};`):this.position==="Right"?this.layout.element.setAttribute("style",`width:${this.layout.element.clientWidth}px;opacity:${e?1:0};`):this.layout.element.setAttribute("style",`height:${this.layout.element.clientHeight}px;opacity:${e?1:0};`)}showDock(e=!1){var n,a,i;!e&&(this.pin||!this.element.querySelector(".dock__item--active")||this.layout.element.style.opacity==="1")||!e&&(this.position==="Left"||this.position==="Right")&&this.layout.element.clientWidth===0&&this.layout.element.style.width.startsWith("0")||!e&&this.position==="Bottom"&&this.layout.element.clientHeight===0&&this.layout.element.style.height.startsWith("0")||(document.querySelector(".b3-dialog")||document.querySelector(".block__popover")||document.querySelector("#commonMenu:not(.fn__none)"))&&(((n=window.siyuan.layout.leftDock)==null?void 0:n.layout.element.style.opacity)==="1"||((a=window.siyuan.layout.rightDock)==null?void 0:a.layout.element.style.opacity)==="1"||((i=window.siyuan.layout.bottomDock)==null?void 0:i.layout.element.style.opacity)==="1")||(e||(this.layout.element.style.opacity="1"),this.layout.element.style.transform="",this.layout.element.style.zIndex=(++window.siyuan.zIndex).toString(),this.position==="Left"?this.layout.element.style.left=`${this.element.clientWidth}px`:this.position==="Right"?this.layout.element.style.right=`${this.element.clientWidth}px`:this.position==="Bottom"&&(this.layout.element.style.bottom=`${this.element.offsetHeight+document.getElementById("status").offsetHeight}px`))}hideDock(e=!1){var n,a;if(!e&&(this.layout.element.style.opacity==="0"||this.pin))return;const i=this.layout.element.querySelector(".fullscreen");if(i&&i.clientHeight>0||document.activeElement&&this.layout.element.contains(document.activeElement)&&document.activeElement.classList.contains("b3-text-field"))return;const s=document.querySelector(".b3-dialog"),r=document.querySelector(".block__popover"),o=document.querySelector("#commonMenu:not(.fn__none)");s&&s.style.zIndex>this.layout.element.style.zIndex||r&&r.style.zIndex>this.layout.element.style.zIndex||o&&o.style.zIndex>this.layout.element.style.zIndex||(this.position==="Left"?(this.layout.element.style.transform=`translateX(-${this.layout.element.clientWidth+8}px)`,this.layout.element.style.left=""):this.position==="Right"?(this.layout.element.style.transform=`translateX(${this.layout.element.clientWidth+8}px)`,this.layout.element.style.right=""):this.position==="Bottom"&&(this.layout.element.style.transform=`translateY(${this.layout.element.clientHeight+8}px)`,this.layout.element.style.bottom=""),!e&&(this.layout.element.style.opacity="0",(n=this.element.querySelector(".dock__item--activefocus"))==null||n.classList.remove("dock__item--activefocus"),(a=this.layout.element.querySelector(".layout__tab--active"))==null||a.classList.remove("layout__tab--active")))}toggleModel(e,n=!1,a=!1,i=!1,s=!0){var r,o;if(!e)return;this.pin&&ng();const l=this.element.querySelector(`[data-type="${e}"]`);n&&l.classList.contains("dock__item--active")&&l.classList.remove("dock__item--active","dock__item--activefocus");const c=parseInt(l.getAttribute("data-index")),d=this.layout.children[c];if(l.classList.contains("dock__item--active")||i){if(!a){let m=!1;if(Array.from(d.element.querySelector(".layout-tab-container").children).find(b=>{if(b.getAttribute("data-id")===l.getAttribute("data-id"))return b.classList.contains("layout__tab--active")||(ca(b),m=!0),!0}),m){document.activeElement&&document.activeElement.blur(),KF(),this.showDock();return}}if(l.classList.remove("dock__item--active","dock__item--activefocus"),this.element.querySelectorAll(".dock__item--active").length===0&&(this.position==="Left"||this.position==="Right"?this.layout.element.style.width="0px":this.layout.element.style.height="0px",this.resizeElement.classList.add("fn__none"),clearTimeout(this.hideResizeTimeout),this.hideDock()),(e==="graph"||e==="globalGraph")&&(this.layout.element.querySelector(".fullscreen")&&((r=document.getElementById("drag"))==null||r.classList.remove("fn__hidden")),this.data[e].destroy()),s&&!document.querySelector(".layout__center .layout__wnd--active")){const m=document.querySelector(".layout__center ul.layout-tab-bar .item--focus");m&&So().find(b=>{if(b.id===m.getAttribute("data-id"))return b.parent.switchTab(b.headElement,!1,!0,!1),!0})}}else{if(this.element.querySelectorAll(`.dock__item--active[data-index="${c}"]`).forEach(m=>{m.classList.remove("dock__item--active","dock__item--activefocus")}),l.classList.add("dock__item--active","dock__item--activefocus"),l.getAttribute("data-id"))Array.from(d.element.querySelector(".layout-tab-container").children).forEach(m=>{m.getAttribute("data-id")===l.getAttribute("data-id")?(m.classList.remove("fn__none"),ca(m)):m.classList.add("fn__none")});else{let m;Cn().editor.find(_=>{var v,U;if(_.parent.headElement.classList.contains("item--focus")&&((U=(v=_.editor)==null?void 0:v.protyle)!=null&&U.path))return m=_.editor,!0});let y;switch(e){case"file":y=new Sa({callback:_=>{_.addModel(new js({tab:_,app:this.app}))}});break;case"bookmark":y=new Sa({callback:_=>{_.addModel(new cu(this.app,_))}});break;case"tag":y=new Sa({callback:_=>{_.addModel(new Sc(this.app,_))}});break;case"outline":y=new Sa({callback:_=>{var v,U,ee;const Z=new cc({app:this.app,type:"pin",tab:_,blockId:(U=(v=m==null?void 0:m.protyle)==null?void 0:v.block)==null?void 0:U.rootID,isPreview:(ee=m==null?void 0:m.protyle)!=null&&ee.preview?!m.protyle.preview.element.classList.contains("fn__none"):!1});_.addModel(Z)}});break;case"graph":y=new Sa({callback:_=>{var v,U;_.addModel(new Il({app:this.app,tab:_,blockId:(U=(v=m==null?void 0:m.protyle)==null?void 0:v.block)==null?void 0:U.rootID,type:"pin"}))}});break;case"globalGraph":y=new Sa({callback:_=>{_.addModel(new Il({app:this.app,tab:_,type:"global"}))}});break;case"backlink":y=new Sa({callback:_=>{var v,U;_.addModel(new yl({app:this.app,type:"pin",tab:_,blockId:(U=(v=m==null?void 0:m.protyle)==null?void 0:v.block)==null?void 0:U.rootID}))}});break;case"inbox":y=new Sa({callback:_=>{_.addModel(new oV(this.app,_))}});break;case"ai":y=new Sa({callback:_=>{_.addModel(new qE(this.app,_))}});break;default:y=new Sa({callback:_=>{let v;this.app.plugins.find(U=>{if(U.docks[e])return v=U.docks[e].model({tab:_}),!0}),v&&_.addModel(v)}});break}d.addTab(y,!1,!1),l.setAttribute("data-id",y.id),this.data[e]=y.model,ca(y.panelElement)}this.position==="Left"||this.position==="Right"?this.layout.element.style.width=this.getMaxSize()+"px":this.layout.element.style.height=this.getMaxSize()+"px",(e==="graph"||e==="globalGraph")&&this.layout.element.querySelector(".fullscreen")&&((o=document.getElementById("drag"))==null||o.classList.add("fn__hidden")),this.pin&&(this.layout.element.style.opacity="",this.hideResizeTimeout=window.setTimeout(()=>{this.resizeElement.classList.remove("fn__none"),im()},p.TIMEOUT_TRANSITION)),document.activeElement&&document.activeElement.blur()}const u=c===0?1:0,g=this.layout.children[u],f=this.element.querySelectorAll(`.dock__item--active[data-index="${u}"]`).length>0,h=this.element.querySelectorAll(`.dock__item--active[data-index="${c}"]`).length>0;if(h&&f){let m=d;u===0?g.element.nextElementSibling.classList.remove("fn__none"):(m=g,g.element.previousElementSibling.classList.remove("fn__none"));const b=this.element.querySelector('.dock__item--active[data-index="1"]');if(this.position==="Left"||this.position==="Right"){const y=parseInt(b.getAttribute("data-height"));y!==0&&!isNaN(y)&&(m.element.style.height=y+"px",m.element.classList.remove("fn__flex-1"))}else{const y=parseInt(b.getAttribute("data-width"));y!==0&&!isNaN(y)&&(m.element.style.width=y+"px",m.element.classList.remove("fn__flex-1"))}}else u===0?g.element.nextElementSibling.classList.add("fn__none"):g.element.previousElementSibling.classList.add("fn__none");f?g.element.classList.remove("fn__none"):g.element.classList.add("fn__none"),h?d.element.classList.remove("fn__none"):d.element.classList.add("fn__none"),h&&!f?(d.element.classList.add("fn__flex-1"),d.element.style.height="",d.element.style.width=""):!h&&f&&(g.element.classList.add("fn__flex-1"),g.element.style.height="",g.element.style.width=""),Ui(s),this.showDock(),l.classList.contains("dock__item--active")&&!i&&(e==="graph"||e==="globalGraph")&&this.data[e].onGraph(!1)}add(e,n,a){n.setAttribute("data-height",""),n.setAttribute("data-width","");const i=n.getAttribute("data-type"),s=Vn(i);s.element.querySelectorAll(".dock__item").length===2&&s.element.classList.add("fn__none");const r=s.layout.children[parseInt(n.getAttribute("data-index"))];n.getAttribute("data-id")&&(r.removeTab(n.getAttribute("data-id"),!1,!0,!1),n.removeAttribute("data-id"));const l=n.classList.contains("dock__item--active");l&&s.toggleModel(i,!1,!1,!1,!1),delete s.data[i],n.setAttribute("data-index",e.toString()),a?this.element.querySelector(`[data-type="${a}"]`).after(n):e===0?this.element.firstElementChild.insertAdjacentElement("afterbegin",n):this.element.lastElementChild.insertAdjacentElement("afterbegin",n),this.element.classList.remove("fn__none"),vx(),this.data[i]=!0,l&&this.toggleModel(i,!0,!1,!1,!1),setTimeout(()=>{Fi()},p.TIMEOUT_TRANSITION)}remove(e){this.toggleModel(e,!1,!0,!0),this.element.querySelector(`[data-type="${e}"]`).remove();const n=this.data[e];n.parent&&n.parent.parent.removeTab(n.parent.id),delete this.data[e]}setSize(){const e=this.element.querySelectorAll(".dock__item--active");e.forEach(n=>{if(this.position==="Left"||this.position==="Right"){if(n.getAttribute("data-index")==="1"&&e.length>1){const a=this.data[n.getAttribute("data-type")].parent.parent.element;n.setAttribute("data-height",a.style.height?a.clientHeight.toString():"")}n.setAttribute("data-width",this.layout.element.clientWidth.toString())}else{if(n.getAttribute("data-index")==="1"&&e.length>1){const a=this.data[n.getAttribute("data-type")].parent.parent.element;n.setAttribute("data-width",a.style.width?a.clientWidth.toString():"")}n.setAttribute("data-height",this.layout.element.clientHeight.toString())}})}getMaxSize(){let e=0;return this.element.querySelectorAll(".dock__item--active").forEach(n=>{let a;this.position==="Left"||this.position==="Right"?a=parseInt(n.getAttribute("data-width"))||(["graph","globalGraph","backlink"].includes(n.getAttribute("data-type"))?320:232):a=parseInt(n.getAttribute("data-height"))||232,a>e&&(e=a)}),e}genButton(e,n,a){let i="";e.forEach(s=>{typeof a=="undefined"&&!WE.includes(s.type)||(i+=`<span data-height="${s.size.height}" data-width="${s.size.width}" data-type="${s.type}" data-index="${n}" data-hotkey="${s.hotkey||""}" data-hotkeyLangId="${s.hotkeyLangId||""}" data-title="${s.title}" class="dock__item${s.show?" dock__item--active":""} ariaLabel" aria-label="<span style='white-space:pre'>${s.title} ${s.hotkey?Mt(s.hotkey):""}${window.siyuan.languages.dockTip}</span>">
    <svg><use xlink:href="#${s.icon}"></use></svg>
</span>`,this.data[s.type]=!0)}),n===0?typeof a=="number"?this.element.firstElementChild.children[a]?this.element.firstElementChild.children[a].insertAdjacentHTML("beforebegin",i):this.element.firstElementChild.lastElementChild.insertAdjacentHTML("beforebegin",i):this.element.firstElementChild.innerHTML=`${i}<span class="dock__item dock__item--pin ariaLabel" aria-label="${this.pin?window.siyuan.languages.unpin:window.siyuan.languages.pin}">
    <svg><use xlink:href="#icon${this.pin?"Unpin":"Pin"}"></use></svg>
</span>`:typeof a=="number"?this.element.lastElementChild.children[a]?this.element.lastElementChild.children[a].insertAdjacentHTML("beforebegin",i):this.element.lastElementChild.insertAdjacentHTML("beforeend",i):this.element.lastElementChild.innerHTML=i,typeof a=="number"&&(window.siyuan.config.uiLayout.hideDock||this.element.classList.remove("fn__none"),e[0].show&&this.toggleModel(e[0].type,!0,!1,!1,!1))}}var lV=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class IL{constructor(e){this.data={},this.protyleSlash=[],this.customBlockRenders={},this.topBarIcons=[],this.statusBarIcons=[],this.commands=[],this.models={},this.docks={},this.addFloatLayer=n=>{window.siyuan.blockPanels.push(new Vg({app:this.app,originalRefBlockIDs:n.originalRefBlockIDs,targetElement:n.targetElement,isBacklink:n.isBacklink,x:n.x,y:n.y,refDefs:n.refDefs}))},this.app=e.app,this.i18n=e.i18n,this.displayName=e.displayName,this.eventBus=new B5(e.name),Object.defineProperty(this,"name",{value:e.name,writable:!1}),this.updateProtyleToolbar([]).forEach(n=>{typeof n=="string"||p.INLINE_TYPE.concat("|").includes(n.name)||!n.hotkey||(window.siyuan.config.keymap.plugin||(window.siyuan.config.keymap.plugin={}),window.siyuan.config.keymap.plugin[e.name]||(window.siyuan.config.keymap.plugin[e.name]={[n.name]:{default:n.hotkey,custom:n.hotkey}}),window.siyuan.config.keymap.plugin[e.name][n.name]||(window.siyuan.config.keymap.plugin[e.name][n.name]={default:n.hotkey,custom:n.hotkey}))})}onload(){}onunload(){}uninstall(){}updateCards(e){return lV(this,null,function*(){return e})}onLayoutReady(){}addCommand(e){window.siyuan.config.keymap.plugin||(window.siyuan.config.keymap.plugin={}),window.siyuan.config.keymap.plugin[this.name]?window.siyuan.config.keymap.plugin[this.name][e.langKey]?window.siyuan.config.keymap.plugin[this.name][e.langKey]&&(typeof window.siyuan.config.keymap.plugin[this.name][e.langKey].custom=="string"?e.customHotkey=window.siyuan.config.keymap.plugin[this.name][e.langKey].custom:e.customHotkey=e.hotkey,window.siyuan.config.keymap.plugin[this.name][e.langKey].default=e.hotkey):(e.customHotkey=e.hotkey,window.siyuan.config.keymap.plugin[this.name][e.langKey]={default:e.hotkey,custom:e.hotkey}):(e.customHotkey=e.hotkey,window.siyuan.config.keymap.plugin[this.name]={[e.langKey]:{default:e.hotkey,custom:e.hotkey}}),typeof e.customHotkey!="string"?console.error(`${this.name} - commands data is error and has been removed.`):this.commands.push(e)}addIcons(e){const n=document.querySelector(`svg[data-name="${this.name}"] defs`);if(n)n.insertAdjacentHTML("afterbegin",e);else{const a=document.querySelector("body > svg:last-of-type");a?a.insertAdjacentHTML("afterend",`<svg data-name="${this.name}" style="position: absolute; width: 0; height: 0; overflow: hidden;" xmlns="http://www.w3.org/2000/svg">
<defs>${e}</defs></svg>`):document.body.insertAdjacentHTML("afterbegin",`<svg data-name="${this.name}" style="position: absolute; width: 0; height: 0; overflow: hidden;" xmlns="http://www.w3.org/2000/svg">
<defs>${e}</defs></svg>`)}}addTopBar(e){var n,a;if(!e.icon.startsWith("icon")&&!e.icon.startsWith("<svg")){console.error(`plugin ${this.name} addTopBar error: icon must be svg id or svg tag`);return}const i=document.createElement("div");return i.setAttribute("data-menu","true"),i.addEventListener("click",e.callback),i.id=`plugin_${this.name}_${this.topBarIcons.length}`,x()?(i.className="b3-menu__item",i.innerHTML=(e.icon.startsWith("icon")?`<svg class="b3-menu__icon"><use xlink:href="#${e.icon}"></use></svg>`:e.icon)+`<span class="b3-menu__label">${e.title}</span>`):E()||(i.className="toolbar__item ariaLabel",i.setAttribute("aria-label",e.title),i.innerHTML=e.icon.startsWith("icon")?`<svg><use xlink:href="#${e.icon}"></use></svg>`:e.icon,i.addEventListener("click",e.callback),i.setAttribute("data-location",e.position||"right"),am()),x()&&window.siyuan.storage?window.siyuan.storage[p.LOCAL_PLUGINTOPUNPIN].includes(i.id)||(n=document.querySelector("#menuAbout"))==null||n.after(i):!E()&&window.siyuan.storage&&(window.siyuan.storage[p.LOCAL_PLUGINTOPUNPIN].includes(i.id)&&i.classList.add("fn__none"),(a=document.querySelector("#"+(i.getAttribute("data-location")==="right"?"barPlugins":"drag")))==null||a.before(i)),this.topBarIcons.push(i),i}addStatusBar(e){e.element.setAttribute("data-location",e.position||"right"),this.statusBarIcons.push(e.element);const n=document.getElementById("status");return n&&(e.element.getAttribute("data-location")==="right"?n.insertAdjacentElement("beforeend",e.element):n.insertAdjacentElement("afterbegin",e.element)),e.element}openSetting(){this.setting&&this.setting.open(this.displayName||this.name)}loadData(e){return typeof this.data[e]=="undefined"&&(this.data[e]=""),new Promise(n=>{ae("/api/file/getFile",{path:`/data/storage/petal/${this.name}/${e}`},a=>{a.code!==404&&(this.data[e]=a),n(this.data[e])})})}saveData(e,n){if(!(window.siyuan.config.readonly||window.siyuan.isPublish))return new Promise(a=>{const i=`/data/storage/petal/${this.name}/${e}`;let s;typeof n=="object"?s=new File([new Blob([JSON.stringify(n)],{type:"application/json"})],i.split("/").pop()):s=new File([new Blob([n])],i.split("/").pop());const r=new FormData;r.append("path",i),r.append("file",s),r.append("isDir","false"),ae("/api/file/putFile",r,o=>{this.data[e]=n,a(o)})})}removeData(e){if(!(window.siyuan.config.readonly||window.siyuan.isPublish))return new Promise(n=>{this.data||(this.data={}),ae("/api/file/removeFile",{path:`/data/storage/petal/${this.name}/${e}`},a=>{delete this.data[e],n(a)})})}getOpenedTab(){const e={},n=Object.keys(this.models);return n.forEach(a=>{e[a.replace(this.name,"")]=[]}),Cn().custom.find(a=>{n.includes(a.type)&&e[a.type.replace(this.name,"")].push(a)}),e}addTab(e){const n=this.name+e.type;return this.models[n]=a=>{const i=new ko({app:this.app,tab:a.tab,type:n,data:a.data,init:e.init,beforeDestroy:e.beforeDestroy,destroy:e.destroy,resize:e.resize,update:e.update});return i.element.addEventListener("click",()=>{Vo(),ca(i.element.parentElement.parentElement)}),i},this.models[n]}addDock(e){const n=this.name+e.type;return typeof e.config.index=="undefined"&&(e.config.index=1e3),this.docks[n]={config:e.config,model:a=>{const i=new ko({app:this.app,tab:a.tab,type:n,data:e.data,init:e.init,destroy:e.destroy,resize:e.resize,update:e.update});return i.element.addEventListener("click",s=>{ca(i.element),ue(s.target,"data-type","min")&&Vn(n).toggleModel(n)}),i.element.classList.add("sy__"+n),i}},window.siyuan.config.keymap.plugin||(window.siyuan.config.keymap.plugin={}),e.config.hotkey&&(window.siyuan.config.keymap.plugin[this.name]?window.siyuan.config.keymap.plugin[this.name][n]?window.siyuan.config.keymap.plugin[this.name][n]&&(typeof window.siyuan.config.keymap.plugin[this.name][n].custom!="string"&&(window.siyuan.config.keymap.plugin[this.name][n].custom=e.config.hotkey),window.siyuan.config.keymap.plugin[this.name][n].default=e.config.hotkey):window.siyuan.config.keymap.plugin[this.name][n]={default:e.config.hotkey,custom:e.config.hotkey}:window.siyuan.config.keymap.plugin[this.name]={[n]:{default:e.config.hotkey,custom:e.config.hotkey}}),this.docks[n]}updateProtyleToolbar(e){return e}set protyleOptions(e){this.protyleOptionsValue=e}get protyleOptions(){return this.protyleOptionsValue}}var cV=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const ML=(t,e={})=>{el(t,{}),t.parent.removeTab(t.id)},dV=(t,...e)=>cV(void 0,[t,...e],function*(n,a={}){let i=n;typeof i=="string"&&(i=[i]);const s=[];for(let r=0;r<i.length;r++){const o=yield wn("/api/block/getBlockInfo",{id:i[r]});if(o.code===3){Q(o.msg);return}s.push({title:o.data.rootTitle,docIcon:o.data.rootIcon,pin:!1,active:!0,instance:"Tab",action:"Tab",children:{notebookId:o.data.box,blockId:i[r],rootId:o.data.rootID,mode:"wysiwyg",instance:"Editor",action:o.data.rootID===i[r]?p.CB_GET_SCROLL:p.CB_GET_ALL}})}}),nY=(t,e={})=>{};class uV{constructor(e){this.items=[],this.confirmCallback=e.confirmCallback,this.destroyCallback=e.destroyCallback,this.width=e.width||(x()?"92vw":"768px"),this.height=e.height||"80vh"}addItem(e){this.items.push(e)}open(e){var n;const a=new fe({title:e,content:`<div class="b3-dialog__content">
</div>
<div class="b3-dialog__action${this.confirmCallback?"":" fn__none"}">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button>
    <div class="fn__space${this.confirmCallback?"":" fn__none"}"></div>
    <button class="b3-button b3-button--text${this.confirmCallback?"":" fn__none"}">${window.siyuan.languages.save}</button>
</div>`,width:this.width,height:this.height,destroyCallback:()=>{this.destroyCallback&&this.destroyCallback()}}),i=a.element.querySelector(".b3-dialog__content");this.items.forEach(r=>{let o="",l=r.actionElement;!r.actionElement&&r.createActionElement&&(l=r.createActionElement());const c=l!=null&&l.classList.contains("b3-switch")?"label":"div";typeof r.direction=="undefined"&&(r.direction=!l||l.tagName==="TEXTAREA"?"row":"column"),r.direction==="row"?o=`<${c} class="b3-label">
    <div class="fn__block">
        ${r.title}
        ${r.description?`<div class="b3-label__text">${r.description}</div>`:""}
        <div class="fn__hr"></div>
    </div>
</${c}>`:o=`<${c} class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${r.title}
        ${r.description?`<div class="b3-label__text">${r.description}</div>`:""}
    </div>
    <span class="fn__space${l?"":" fn__none"}"></span>
</${c}>`,i.insertAdjacentHTML("beforeend",o),l&&(["INPUT","TEXTAREA"].includes(l.tagName)&&a.bindInput(l,()=>{s[1].dispatchEvent(new CustomEvent("click"))},l.tagName==="INPUT"),r.direction==="row"?(i.lastElementChild.lastElementChild.insertAdjacentElement("beforeend",l),l.classList.add("fn__block")):(l.classList.remove("fn__block"),l.classList.add("fn__flex-center","fn__size200"),i.lastElementChild.insertAdjacentElement("beforeend",l)))}),(n=i.querySelector("input, textarea"))==null||n.focus();const s=a.element.querySelectorAll(".b3-dialog__action .b3-button");s[0].addEventListener("click",()=>{a.destroy()}),s[1].addEventListener("click",()=>{this.confirmCallback&&this.confirmCallback(),a.destroy()}),this.dialog=a}}const zE=t=>{window.siyuan.config.editor.readOnly=t,ae("/api/setting/setEditor",window.siyuan.config.editor)},In={element:void 0,genHTML:()=>`<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.fullWidth}
        <div class="b3-label__text">${window.siyuan.languages.fullWidthTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="fullWidth" type="checkbox"${window.siyuan.config.editor.fullWidth?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.justify}
        <div class="b3-label__text">${window.siyuan.languages.justifyTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="justify" type="checkbox"${window.siyuan.config.editor.justify?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.rtl}
        <div class="b3-label__text">${window.siyuan.languages.rtlTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="rtl" type="checkbox"${window.siyuan.config.editor.rtl?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.editReadonly} 
        <code class="fn__code${window.siyuan.config.keymap.general.editReadonly.custom?"":" fn__none"}">${Mt(window.siyuan.config.keymap.general.editReadonly.custom)}</code>
        <div class="b3-label__text">${window.siyuan.languages.editReadonlyTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="readOnly" type="checkbox"${window.siyuan.config.editor.readOnly?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.md12}
        <div class="b3-label__text">${window.siyuan.languages.md16}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="displayBookmarkIcon" type="checkbox"${window.siyuan.config.editor.displayBookmarkIcon?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.md7}
        <div class="b3-label__text">${window.siyuan.languages.md8}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="displayNetImgMark" type="checkbox"${window.siyuan.config.editor.displayNetImgMark?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.embedBlockBreadcrumb}
        <div class="b3-label__text">${window.siyuan.languages.embedBlockBreadcrumbTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="embedBlockBreadcrumb" type="checkbox"${window.siyuan.config.editor.embedBlockBreadcrumb?" checked":""}/>
</label>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.headingEmbedMode}
        <div class="b3-label__text">${window.siyuan.languages.headingEmbedModeTip}</div>
    </div>
    <span class="fn__space"></span>
    <select class="b3-select fn__flex-center fn__size200" id="headingEmbedMode">
      <option value="0" ${window.siyuan.config.editor.headingEmbedMode===0?"selected":""}>${window.siyuan.languages.showHeadingWithBlocks}</option>
      <option value="1" ${window.siyuan.config.editor.headingEmbedMode===1?"selected":""}>${window.siyuan.languages.showHeadingOnlyTitle}</option>
      <option value="2" ${window.siyuan.config.editor.headingEmbedMode===2?"selected":""}>${window.siyuan.languages.showHeadingOnlyBlocks}</option>
    </select>
</div>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.outlineOutdent}
        <div class="b3-label__text">${window.siyuan.languages.outlineOutdentTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="listLogicalOutdent" type="checkbox"${window.siyuan.config.editor.listLogicalOutdent?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.listItemDotNumberClickFocus}
        <div class="b3-label__text">${window.siyuan.languages.listItemDotNumberClickFocusTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="listItemDotNumberClickFocus" type="checkbox"${window.siyuan.config.editor.listItemDotNumberClickFocus?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.spellcheck}
        <div class="b3-label__text">${window.siyuan.languages.spellcheckTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="spellcheck" type="checkbox"${window.siyuan.config.editor.spellcheck?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.onlySearchForDoc}
        <div class="b3-label__text">${window.siyuan.languages.onlySearchForDocTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="onlySearchForDoc" type="checkbox"${window.siyuan.config.editor.onlySearchForDoc?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.md31}
        <div class="b3-label__text">${window.siyuan.languages.md32}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="codeLineWrap" type="checkbox"${window.siyuan.config.editor.codeLineWrap?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.md2}
        <div class="b3-label__text">${window.siyuan.languages.md3}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="codeLigatures" type="checkbox"${window.siyuan.config.editor.codeLigatures?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.md27}
        <div class="b3-label__text">${window.siyuan.languages.md28}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="codeSyntaxHighlightLineNum" type="checkbox"${window.siyuan.config.editor.codeSyntaxHighlightLineNum?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.md33}
        <div class="b3-label__text">${window.siyuan.languages.md34}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="virtualBlockRef" type="checkbox"${window.siyuan.config.editor.virtualBlockRef?" checked":""}/>
</label>
<div class="b3-label">
    <div class="fn__block">
        ${window.siyuan.languages.md9}
        <div class="b3-label__text">${window.siyuan.languages.md36}</div>
        <div class="fn__hr"></div>
        <textarea class="b3-text-field fn__block" id="virtualBlockRefInclude">${window.siyuan.config.editor.virtualBlockRefInclude}</textarea>
    </div>
</div>
<div class="b3-label">
    <div class="fn__block">
        ${window.siyuan.languages.md35}
        <div class="b3-label__text">${window.siyuan.languages.md36}</div>
        <div class="b3-label__text">${window.siyuan.languages.md41}</div>
        <div class="fn__hr"></div>
        <textarea class="b3-text-field fn__block" id="virtualBlockRefExclude">${window.siyuan.config.editor.virtualBlockRefExclude}</textarea>
    </div>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.md39}
        <div class="b3-label__text">${window.siyuan.languages.md40}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" id="plantUMLServePath" value="${window.siyuan.config.editor.plantUMLServePath}"/>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.dynamicLoadBlocks}
        <div class="b3-label__text">${window.siyuan.languages.dynamicLoadBlocksTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" id="dynamicLoadBlocks" type="number" min="48" value="${window.siyuan.config.editor.dynamicLoadBlocks}"/>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.md37}
        <div class="b3-label__text">${window.siyuan.languages.md38}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" id="blockRefDynamicAnchorTextMaxLen" type="number" min="1" max="5120" value="${window.siyuan.config.editor.blockRefDynamicAnchorTextMaxLen}"/>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.backlinkExpand}
        <div class="b3-label__text">${window.siyuan.languages.backlinkExpandTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" id="backlinkExpandCount" type="number" min="0" max="512" value="${window.siyuan.config.editor.backlinkExpandCount}"/>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.backmentionExpand}
        <div class="b3-label__text">${window.siyuan.languages.backmentionExpandTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" id="backmentionExpandCount" type="number" min="-1" max="512" value="${window.siyuan.config.editor.backmentionExpandCount}"/>
</div>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.backlinkContainChildren}
        <div class="b3-label__text">${window.siyuan.languages.backlinkContainChildrenTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="backlinkContainChildren" type="checkbox"${window.siyuan.config.editor.backlinkContainChildren?" checked":""}/>
</label>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.generateHistory}
        <div class="b3-label__text">${window.siyuan.languages.generateHistoryInterval}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" id="generateHistoryInterval" type="number" min="0" max="120" value="${window.siyuan.config.editor.generateHistoryInterval}"/>
</div>
<div class="b3-label">
    <div>
        ${window.siyuan.languages.historyRetentionDaysTip}
    </div>
    <div class="fn__hr"></div>
    <div class="fn__flex config__item">
        <div class="fn__flex-center fn__flex-1 ft__on-surface">${window.siyuan.languages.clearHistory}</div>
        <span class="fn__space"></span>
        <button id="clearHistory" class="b3-button b3-button--outline fn__size200 fn__flex-center">
            <svg><use xlink:href="#iconTrashcan"></use></svg>${window.siyuan.languages.purge}
        </button>
    </div>
    <div class="fn__hr"></div>
    <div class="fn__flex config__item">
        <div class="fn__flex-center fn__flex-1 ft__on-surface">${window.siyuan.languages.historyRetentionDays}</div>
        <span class="fn__space"></span>
        <input class="b3-text-field fn__flex-center fn__size200" id="historyRetentionDays" type="number" min="1" max="3650" value="${window.siyuan.config.editor.historyRetentionDays}"/>
    </div>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.floatWindowMode}
        <div class="b3-label__text">${window.siyuan.languages.floatWindowModeTip}</div>
    </div>
    <span class="fn__space"></span>
    <select class="b3-select fn__flex-center fn__size200" id="floatWindowMode">
      <option value="0" ${window.siyuan.config.editor.floatWindowMode===0?"selected":""}>${window.siyuan.languages.floatWindowMode0}</option>
      <option value="1" ${window.siyuan.config.editor.floatWindowMode===1?"selected":""}>${window.siyuan.languages.floatWindowMode1.replace("${hotkey}",Mt("\u2318"))}</option>
      <option value="2" ${window.siyuan.config.editor.floatWindowMode===2?"selected":""}>${window.siyuan.languages.floatWindowMode2}</option>
    </select>    
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.font}
        <div class="b3-label__text">${window.siyuan.languages.font1}</div>
    </div>
    <span class="fn__space"></span>
    <input readonly="readonly" placeholder="${window.siyuan.languages.default}" id="fontFamily" class="b3-text-field fn__flex-center fn__size200" style="font-family:'${window.siyuan.config.editor.fontFamily}',var(--b3-font-family);" value="${window.siyuan.config.editor.fontFamily}"/>
</div>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.fontSizeScrollZoom}
        <div class="b3-label__text">${window.siyuan.languages.fontSizeScrollZoomTip.replace("Ctrl",Mt("\u2318"))}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="fontSizeScrollZoom" type="checkbox"${window.siyuan.config.editor.fontSizeScrollZoom?" checked":""}/>
</label>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.fontSize}
        <div class="b3-label__text">${window.siyuan.languages.fontSizeTip}</div>
    </div>
    <span class="fn__space"></span>
    <div class="b3-tooltips b3-tooltips__n fn__flex-center" aria-label="${window.siyuan.config.editor.fontSize}">   
        <input class="b3-slider fn__size200" id="fontSize" max="72" min="9" step="1" type="range" value="${window.siyuan.config.editor.fontSize}">
    </div>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.md29}
        <div class="b3-label__text">${window.siyuan.languages.md30}</div>
    </div>
    <span class="fn__space"></span>
    <div class="b3-tooltips b3-tooltips__n fn__flex-center" aria-label="${window.siyuan.config.editor.codeTabSpaces}">   
        <input class="b3-slider fn__size200" id="codeTabSpaces" max="8" min="0" step="2" type="range" value="${window.siyuan.config.editor.codeTabSpaces}">
    </div>
</div>
<div class="b3-label">
    <div class="fn__block">
        ${window.siyuan.languages.katexMacros}
        <div class="b3-label__text">${window.siyuan.languages.katexMacrosTip}</div>
        <div class="fn__hr"></div>
        <textarea class="b3-text-field fn__block" id="katexMacros" spellcheck="false">${window.siyuan.config.editor.katexMacros}</textarea>
    </div>
</div>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.allowHTMLBLockScript}
        <div class="b3-label__text">${window.siyuan.languages.allowHTMLBLockScriptTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="allowHTMLBLockScript" type="checkbox"${window.siyuan.config.editor.allowHTMLBLockScript?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.editorMarkdownInlineAsterisk}
        <div class="b3-label__text">${window.siyuan.languages.editorMarkdownInlineAsteriskTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="editorMarkdownInlineAsterisk" type="checkbox"${window.siyuan.config.editor.markdown.inlineAsterisk?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.editorMarkdownInlineUnderscore}
        <div class="b3-label__text">${window.siyuan.languages.editorMarkdownInlineUnderscoreTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="editorMarkdownInlineUnderscore" type="checkbox"${window.siyuan.config.editor.markdown.inlineUnderscore?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.editorMarkdownInlineSup}
        <div class="b3-label__text">${window.siyuan.languages.editorMarkdownInlineSupTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="editorMarkdownInlineSup" type="checkbox"${window.siyuan.config.editor.markdown.inlineSup?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.editorMarkdownInlineSub}
        <div class="b3-label__text">${window.siyuan.languages.editorMarkdownInlineSubTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="editorMarkdownInlineSub" type="checkbox"${window.siyuan.config.editor.markdown.inlineSub?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.editorMarkdownInlineTag}
        <div class="b3-label__text">${window.siyuan.languages.editorMarkdownInlineTagTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="editorMarkdownInlineTag" type="checkbox"${window.siyuan.config.editor.markdown.inlineTag?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.editorMarkdownInlineMath}
        <div class="b3-label__text">${window.siyuan.languages.editorMarkdownInlineMathTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="editorMarkdownInlineMath" type="checkbox"${window.siyuan.config.editor.markdown.inlineMath?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.editorMarkdownInlineStrikethrough}
        <div class="b3-label__text">${window.siyuan.languages.editorMarkdownInlineStrikethroughTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="editorMarkdownInlineStrikethrough" type="checkbox"${window.siyuan.config.editor.markdown.inlineStrikethrough?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.editorMarkdownInlineMark}
        <div class="b3-label__text">${window.siyuan.languages.editorMarkdownInlineMarkTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="editorMarkdownInlineMark" type="checkbox"${window.siyuan.config.editor.markdown.inlineMark?" checked":""}/>
</label>`,bindEvent:()=>{const t=In.element.querySelector("#fontFamily");t.addEventListener("click",()=>{ae("/api/system/getSysFonts",{},n=>{const a=new ta;a.addItem({iconHTML:"",checked:window.siyuan.config.editor.fontFamily==="",label:`<div style='var(--b3-font-family);'>${window.siyuan.languages.default}</div>`,click:()=>{window.siyuan.config.editor.fontFamily!==""&&(t.value="",t.style.fontFamily="",e())}}),n.data.forEach(s=>{a.addItem({iconHTML:"",checked:window.siyuan.config.editor.fontFamily===s,label:`<div style='font-family:"${s}",var(--b3-font-family);'>${s}</div>`,click:()=>{s!==window.siyuan.config.editor.fontFamily&&(t.value=s,t.style.fontFamily=s+",var(--b3-font-family)",e())}})});const i=t.getBoundingClientRect();a.open({x:i.left,y:i.bottom})})}),In.element.querySelector("#clearHistory").addEventListener("click",()=>{Sn(window.siyuan.languages.clearHistory,window.siyuan.languages.confirmClearHistory,()=>{ae("/api/history/clearWorkspaceHistory",{})})});const e=()=>{let n=parseInt(In.element.querySelector("#dynamicLoadBlocks").value);48>n&&(n=48,In.element.querySelector("#dynamicLoadBlocks").value="48"),ae("/api/setting/setEditor",{fullWidth:In.element.querySelector("#fullWidth").checked,markdown:{inlineAsterisk:In.element.querySelector("#editorMarkdownInlineAsterisk").checked,inlineUnderscore:In.element.querySelector("#editorMarkdownInlineUnderscore").checked,inlineSup:In.element.querySelector("#editorMarkdownInlineSup").checked,inlineSub:In.element.querySelector("#editorMarkdownInlineSub").checked,inlineTag:In.element.querySelector("#editorMarkdownInlineTag").checked,inlineMath:In.element.querySelector("#editorMarkdownInlineMath").checked,inlineStrikethrough:In.element.querySelector("#editorMarkdownInlineStrikethrough").checked,inlineMark:In.element.querySelector("#editorMarkdownInlineMark").checked},allowHTMLBLockScript:In.element.querySelector("#allowHTMLBLockScript").checked,justify:In.element.querySelector("#justify").checked,rtl:In.element.querySelector("#rtl").checked,readOnly:In.element.querySelector("#readOnly").checked,displayBookmarkIcon:In.element.querySelector("#displayBookmarkIcon").checked,displayNetImgMark:In.element.querySelector("#displayNetImgMark").checked,codeSyntaxHighlightLineNum:In.element.querySelector("#codeSyntaxHighlightLineNum").checked,embedBlockBreadcrumb:In.element.querySelector("#embedBlockBreadcrumb").checked,headingEmbedMode:parseInt(In.element.querySelector("#headingEmbedMode").value),listLogicalOutdent:In.element.querySelector("#listLogicalOutdent").checked,listItemDotNumberClickFocus:In.element.querySelector("#listItemDotNumberClickFocus").checked,spellcheck:In.element.querySelector("#spellcheck").checked,onlySearchForDoc:In.element.querySelector("#onlySearchForDoc").checked,floatWindowMode:parseInt(In.element.querySelector("#floatWindowMode").value),plantUMLServePath:In.element.querySelector("#plantUMLServePath").value,katexMacros:In.element.querySelector("#katexMacros").value,codeLineWrap:In.element.querySelector("#codeLineWrap").checked,virtualBlockRef:In.element.querySelector("#virtualBlockRef").checked,virtualBlockRefInclude:In.element.querySelector("#virtualBlockRefInclude").value,virtualBlockRefExclude:In.element.querySelector("#virtualBlockRefExclude").value,blockRefDynamicAnchorTextMaxLen:parseInt(In.element.querySelector("#blockRefDynamicAnchorTextMaxLen").value),backlinkExpandCount:parseInt(In.element.querySelector("#backlinkExpandCount").value),backmentionExpandCount:parseInt(In.element.querySelector("#backmentionExpandCount").value),backlinkContainChildren:In.element.querySelector("#backlinkContainChildren").checked,dynamicLoadBlocks:n,codeLigatures:In.element.querySelector("#codeLigatures").checked,codeTabSpaces:parseInt(In.element.querySelector("#codeTabSpaces").value),fontSize:parseInt(In.element.querySelector("#fontSize").value),fontSizeScrollZoom:In.element.querySelector("#fontSizeScrollZoom").checked,generateHistoryInterval:parseInt(In.element.querySelector("#generateHistoryInterval").value),historyRetentionDays:parseInt(In.element.querySelector("#historyRetentionDays").value),fontFamily:t.value,emoji:window.siyuan.config.editor.emoji},a=>{In._onSetEditor(a.data)})};In.element.querySelectorAll("input.b3-switch, select.b3-select, input.b3-slider").forEach(n=>{n.addEventListener("change",()=>{e()})}),In.element.querySelectorAll("textarea.b3-text-field, input.b3-text-field, input.b3-slider").forEach(n=>{n.getAttribute("readonly")||n.addEventListener("blur",()=>{e()})}),In.element.querySelectorAll("input.b3-slider").forEach(n=>{n.addEventListener("input",a=>{const i=a.target;i.parentElement.setAttribute("aria-label",i.value)})})},_onSetEditor:t=>{t.readOnly!==window.siyuan.config.editor.readOnly&&zE(t.readOnly),window.siyuan.config.editor=t,Cn().editor.forEach(n=>{$o(n.editor.protyle,!1);let a=n.editor.protyle.wysiwyg.element.getAttribute(p.CUSTOM_SY_FULLWIDTH);a||(a=window.siyuan.config.editor.fullWidth?"true":"false"),!(a==="true"&&n.editor.protyle.contentElement.getAttribute("data-fullwidth")==="true")&&(Ai(n.editor.protyle),a==="true"?n.editor.protyle.contentElement.setAttribute("data-fullwidth","true"):n.editor.protyle.contentElement.removeAttribute("data-fullwidth"))}),Qh()}},fV=t=>{const e=new fe({title:window.siyuan.languages.cloudSyncDir,content:`<div class="b3-dialog__content">
    <input class="b3-text-field fn__block" value="main">
    <div class="b3-label__text">${window.siyuan.languages.reposTip}</div>
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:x()?"92vw":"520px"});e.element.setAttribute("data-key",p.DIALOG_SYNCADDCLOUDDIR);const n=e.element.querySelector("input"),a=e.element.querySelectorAll(".b3-button");e.bindInput(n,()=>{a[1].click()}),n.focus(),n.select(),a[0].addEventListener("click",()=>{e.destroy()}),a[1].addEventListener("click",()=>{t.innerHTML='<img style="margin: 0 auto;display: block;width: 64px;height: 100%" src="/stage/loading-pure.svg">',ae("/api/sync/createCloudSyncDir",{name:n.value},()=>{e.destroy(),Qg(t,!0)})})},FL=(t,e)=>{t.addEventListener("click",n=>{let a=n.target;for(;a&&!a.isEqualNode(t);){const i=a.getAttribute("data-type");if(i){switch(i){case"addCloud":fV(t);break;case"removeCloud":Sn(window.siyuan.languages.deleteOpConfirm,`${window.siyuan.languages.confirmDeleteCloudDir} <i>${a.parentElement.getAttribute("data-name")}</i>`,()=>{t.innerHTML='<img style="margin: 0 auto;display: block;width: 64px;height: 100%" src="/stage/loading-pure.svg">',ae("/api/sync/removeCloudSyncDir",{name:a.parentElement.getAttribute("data-name")},s=>{window.siyuan.config.sync.cloudName=s.data,Qg(t,!0,e)})},void 0,!0);break;case"selectCloud":t.innerHTML='<img style="margin: 0 auto;display: block;width: 64px;height: 100%" src="/stage/loading-pure.svg">',ae("/api/sync/setCloudSyncDir",{name:a.getAttribute("data-name")},()=>{window.siyuan.config.sync.cloudName=a.getAttribute("data-name"),Qg(t,!0,e)});break}n.preventDefault(),n.stopPropagation();break}a=a.parentElement}})},Qg=(t,e=!1,n)=>{!e&&t.firstElementChild.tagName!=="IMG"||ae("/api/sync/listCloudSyncDir",{},a=>{let i=`<ul><li style="padding: 0 16px" class="b3-list--empty">${window.siyuan.languages.emptyCloudSyncList}</li></ul>`;a.code===1?i=`<ul>
    <li class="b3-list--empty ft__error">
        ${a.msg}
    </li>
    <li class="b3-list--empty">
        ${window.siyuan.languages.cloudConfigTip}
    </li>
</ul>`:a.code!==1&&(i='<ul class="b3-list b3-list--background fn__flex-1" style="overflow: auto;">',a.data.syncDirs.forEach(s=>{i+=`<li data-type="selectCloud" data-name="${s.cloudName}" class="b3-list-item b3-list-item--narrow b3-list-item--hide-action">
<input type="radio" name="cloudName"${s.cloudName===a.data.checkedSyncDir?" checked":""}/>
<span class="fn__space"></span>
<span>${s.cloudName}</span>
<span class="fn__space"></span>
<span class="ft__on-surface">${s.hSize}</span>
<span class="b3-list-item__meta">${s.updated}</span>
<span class="fn__flex-1 fn__space"></span>
<span data-type="removeCloud" class="b3-tooltips b3-tooltips__w b3-list-item__action${window.siyuan.config.sync.provider===2||window.siyuan.config.sync.provider===3?" fn__none":""}" aria-label="${window.siyuan.languages.delete}">
    <svg><use xlink:href="#iconTrashcan"></use></svg>
</span></li>`}),i+=`</ul>
<div class="fn__hr"></div>
<div class="fn__flex">
    <div class="fn__flex-1"></div>
    <button class="b3-button b3-button--outline${window.siyuan.config.sync.provider===2||window.siyuan.config.sync.provider===3?" fn__none":""}" data-type="addCloud"><svg><use xlink:href="#iconAdd"></use></svg>${window.siyuan.languages.addAttr}</button>
</div>`),t.innerHTML=i,n&&n()})},kw=t=>{var e;if(!window.siyuan.config.readonly&&!((e=document.querySelector("#barSync"))!=null&&e.classList.contains("toolbar__item--active"))){if(window.siyuan.config.sync.provider===0&&Ml("")&&t){const n=Dc(t);window.siyuan.user?n.element.querySelector('.b3-tab-bar [data-name="repos"]').dispatchEvent(new CustomEvent("click")):(n.element.querySelector('.b3-tab-bar [data-name="account"]').dispatchEvent(new CustomEvent("click")),n.element.querySelector('.config__tab-container[data-name="account"]').setAttribute("data-action","go-repos"));return}if(window.siyuan.config.sync.provider!==0&&!CE()&&t){Q(window.siyuan.languages._kernel[214].replaceAll("${accountServer}",ks("")));return}if(!window.siyuan.config.repo.key){Q("\u26A0\uFE0F \u8BF7\u5148\u8BBE\u7F6E\u6570\u636E\u4ED3\u5E93\u5BC6\u94A5",5e3,"error"),t&&Dc(t).element.querySelector('.b3-tab-bar [data-name="repos"]').dispatchEvent(new CustomEvent("click"));return}if(!window.siyuan.config.sync.enabled){pV();return}YE()}},YE=()=>{const t=new fe({title:"\u{1F504} \u9009\u62E9\u540C\u6B65\u65B9\u5F0F",content:`<div class="b3-dialog__content">
    <div style="background: var(--b3-theme-error-lighter); padding: 12px; border-radius: 4px; margin-bottom: 16px;">
        <div style="font-weight: 500; margin-bottom: 8px;">\u26A0\uFE0F \u68C0\u6D4B\u5230\u4E91\u7AEF\u6570\u636E\u5BC6\u94A5\u4E0D\u5339\u914D</div>
        <div style="font-size: 12px; line-height: 1.6;">
            \u4E91\u7AEF\u6570\u636E\u662F\u7528\u4E0D\u540C\u7684\u5BC6\u94A5\u52A0\u5BC6\u7684\u3002\u5EFA\u8BAE\u9009\u62E9"\u4E0A\u4F20\u5230\u4E91\u7AEF"\u8986\u76D6\u65E7\u6570\u636E\uFF0C\u6216\u5148\u5907\u4EFD\u540E\u6E05\u7A7A\u4E91\u7AEF\u3002
        </div>
    </div>
    <label class="fn__flex b3-label" style="margin-bottom: 16px;">
        <input type="radio" name="syncMode" value="upload" checked>
        <span class="fn__space"></span>
        <div>
            <div style="font-weight: 500;">\u2B06\uFE0F \u4E0A\u4F20\u5230\u4E91\u7AEF\uFF08\u63A8\u8350\uFF09</div>
            <div class="b3-label__text">
                \u7528\u672C\u5730\u6570\u636E\u8986\u76D6\u4E91\u7AEF\u6570\u636E\uFF0C\u89E3\u51B3\u5BC6\u94A5\u4E0D\u5339\u914D\u95EE\u9898
            </div>
        </div>
    </label>
    <label class="fn__flex b3-label" style="margin-bottom: 16px;">
        <input type="radio" name="syncMode" value="merge">
        <span class="fn__space"></span>
        <div>
            <div style="font-weight: 500;">\u{1F500} \u667A\u80FD\u5408\u5E76</div>
            <div class="b3-label__text">
                \u81EA\u52A8\u5408\u5E76\u672C\u5730\u548C\u4E91\u7AEF\u6570\u636E\uFF08\u5982\u679C\u5BC6\u94A5\u4E0D\u5339\u914D\u4F1A\u5931\u8D25\uFF09
            </div>
        </div>
    </label>
    <label class="fn__flex b3-label">
        <input type="radio" name="syncMode" value="download">
        <span class="fn__space"></span>
        <div>
            <div style="font-weight: 500;">\u2B07\uFE0F \u4ECE\u4E91\u7AEF\u4E0B\u8F7D</div>
            <div class="b3-label__text">
                \u7528\u4E91\u7AEF\u6570\u636E\u8986\u76D6\u672C\u5730\u6570\u636E\uFF08\u5982\u679C\u5BC6\u94A5\u4E0D\u5339\u914D\u4F1A\u5931\u8D25\uFF09
            </div>
        </div>
    </label>
    <div class="fn__hr"></div>
    <div style="background: var(--b3-theme-surface-lighter); padding: 12px; border-radius: 4px; font-size: 12px; line-height: 1.6;">
        \u{1F4A1} <strong>\u63D0\u793A</strong>\uFF1A\u5982\u679C\u4E91\u7AEF\u6570\u636E\u4E0D\u91CD\u8981\uFF0C\u9009\u62E9"\u4E0A\u4F20\u5230\u4E91\u7AEF"\u662F\u6700\u7B80\u5355\u7684\u89E3\u51B3\u65B9\u6848\u3002
    </div>
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">\u5F00\u59CB\u540C\u6B65</button>
</div>`,width:x()?"92vw":"560px"});t.element.setAttribute("data-key",p.DIALOG_SYNCCHOOSEDIRECTION);const e=t.element.querySelectorAll(".b3-button");e[0].addEventListener("click",()=>{t.destroy()}),e[1].addEventListener("click",()=>{const n=t.element.querySelector("input[name=syncMode]:checked");if(!n){Q("\u8BF7\u9009\u62E9\u540C\u6B65\u65B9\u5F0F");return}const a=n.value;a==="merge"?ae("/api/sync/performSync",{merge:!0}):a==="upload"?ae("/api/sync/performSync",{upload:!0}):ae("/api/sync/performSync",{upload:!1}),t.destroy()})},pV=(t,e)=>{if(t&&(window.siyuan.config.repo.key=t),window.siyuan.config.sync.enabled)e&&e.destroy(),Sn("\u{1F504} "+window.siyuan.languages.syncConfGuide4,window.siyuan.languages.syncConfGuide5,()=>{YE()});else{const n=`<div class="b3-dialog__content">
    <div class="ft__on-surface">${window.siyuan.languages.syncConfGuide3}</div>
    <div class="fn__hr--b"></div>
    <div style="display: flex;flex-direction: column;height: 40vh;">
        <img style="margin: 0 auto;display: block;width: 64px;height: 100%" src="/stage/loading-pure.svg">
    </div>
</div>
<div class="b3-dialog__action">
    <button class="b3-button" disabled="disabled">${window.siyuan.languages.openSyncTip1}</button>
</div>`;e?(e.element.querySelector(".b3-dialog__header").innerHTML="\u{1F5C2}\uFE0F "+window.siyuan.languages.cloudSyncDir,e.element.querySelector(".b3-dialog__body").innerHTML=n):e=new fe({title:"\u{1F5C2}\uFE0F "+window.siyuan.languages.cloudSyncDir,content:n,width:x()?"92vw":"520px"}),e.element.setAttribute("data-key",p.DIALOG_SYNCCHOOSEDIR);const a=e.element.querySelector(".b3-dialog__content").lastElementChild,i=e.element.querySelector(".b3-button");FL(a,()=>{a.querySelector("input[checked]")?i.removeAttribute("disabled"):i.setAttribute("disabled","disabled")}),Qg(a,!1,()=>{a.querySelector("input[checked]")?i.removeAttribute("disabled"):i.setAttribute("disabled","disabled")}),i.addEventListener("click",()=>{e.destroy(),ae("/api/sync/setSyncEnable",{enabled:!0},()=>{window.siyuan.config.sync.enabled=!0,Ao(),Sn("\u{1F504} "+window.siyuan.languages.syncConfGuide4,window.siyuan.languages.syncConfGuide5,()=>{YE()})})})}},hV=(t,e)=>{Sn("\u{1F511} \u540C\u6B65\u5BC6\u94A5\u8BBE\u7F6E",`<div class="b3-dialog__content">
            <div class="ft__on-surface" style="margin-bottom: 12px;">
                \u7CFB\u7EDF\u5DF2\u4E3A\u60A8\u81EA\u52A8\u751F\u6210\u540C\u6B65\u5BC6\u94A5\uFF0C\u65E0\u9700\u624B\u52A8\u8BBE\u7F6E\u5BC6\u7801\u3002
            </div>
            <div class="ft__secondary" style="font-size: 12px; line-height: 1.6;">
                \u{1F4A1} \u81EA\u52A8\u751F\u6210\u7684\u5BC6\u94A5\u5DF2\u8DB3\u591F\u5B89\u5168<br>
                \u{1F4A1} \u5982\u9700\u81EA\u5B9A\u4E49\u5BC6\u7801\uFF0C\u8BF7\u524D\u5F80\u8BBE\u7F6E\u9875\u9762
            </div>
        </div>`,()=>{autoInitKey()},()=>{})};var gV=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const $a={element:void 0,genHTML:()=>{const t=window.siyuan.config.system.isMicrosoftStore?`<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.currentVer} v${p.SIYUAN_VERSION}
        <span id="isInsider"></span>
        <div class="b3-label__text">${window.siyuan.languages.isMsStoreVerTip}</div>
    </div>
</div>`:`<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.currentVer} v${p.SIYUAN_VERSION}
        <span id="isInsider"></span>
        <div class="b3-label__text">${window.siyuan.languages.downloadLatestVer}</div>
    </div>
    <div class="fn__space"></div>
    <div class="fn__flex-center fn__size200 config__item-line">
        <button id="checkUpdateBtn" class="b3-button b3-button--outline fn__block">
            <svg><use xlink:href="#iconRefresh"></use></svg>${window.siyuan.languages.checkUpdate}
        </button>
    </div>
</div>`;return`<div class="fn__flex b3-label config__item${W()||window.siyuan.config.system.isMicrosoftStore||window.siyuan.config.system.container!=="std"||window.siyuan.config.system.os==="linux"?" fn__none":""}">
    <div class="fn__flex-1">
        ${window.siyuan.languages.autoLaunch}
        <div class="b3-label__text">${window.siyuan.languages.autoLaunchTip}</div>
    </div>
    <span class="fn__space"></span>
    <select class="b3-select fn__flex-center fn__size200" id="autoLaunch">
      <option value="0" ${window.siyuan.config.system.autoLaunch2===0?"selected":""}>${window.siyuan.languages.autoLaunchMode0}</option>
      <option value="1" ${window.siyuan.config.system.autoLaunch2===1?"selected":""}>${window.siyuan.languages.autoLaunchMode1}</option>
      ${Jt()?"":`<option value="2" ${window.siyuan.config.system.autoLaunch2===2?"selected":""}>${window.siyuan.languages.autoLaunchMode2}</option>`}
    </select>    
</div>
<label class="fn__flex b3-label${W()||window.siyuan.config.system.isMicrosoftStore||window.siyuan.config.system.container!=="std"||window.siyuan.config.system.os==="linux"?" fn__none":""}">
    <div class="fn__flex-1">
        ${window.siyuan.languages.autoDownloadUpdatePkg}
        <div class="b3-label__text">${window.siyuan.languages.autoDownloadUpdatePkgTip}</div>
    </div>
    <div class="fn__space"></div>
    <input class="b3-switch fn__flex-center" id="downloadInstallPkg" type="checkbox"${window.siyuan.config.system.downloadInstallPkg?" checked":""}>
</label>
<label class="b3-label fn__flex">
    <div class="fn__flex-1">
        ${window.siyuan.languages.about11}
        <div class="b3-label__text">${window.siyuan.languages.about12}</div>
    </div>
    <div class="fn__space"></div>
    <input class="b3-switch fn__flex-center" id="networkServe" type="checkbox"${window.siyuan.config.system.networkServe?" checked":""}>
</label>
<div class="b3-label${window.siyuan.config.readonly||W()&&!Xt()&&!St()&&!yn()&&!Qt()?" fn__none":""}">
    <div class="fn__flex">
        <div class="fn__flex-1">
            ${window.siyuan.languages.about5}
            <div class="b3-label__text">${window.siyuan.languages.about6}</div>
        </div>
        <div class="fn__space"></div>
        <button class="fn__flex-center b3-button b3-button--outline fn__size200" id="authCode">
            <svg><use xlink:href="#iconLock"></use></svg>${window.siyuan.languages.config}
        </button>
    </div>
    <label class="b3-label fn__flex${!window.siyuan.config.accessAuthCode||W()?" fn__none":""}">
        <div class="fn__flex-1">
            ${window.siyuan.languages.about7}
            <div class="b3-label__text">${window.siyuan.languages.about8}</div>
        </div>
        <div class="fn__space"></div>
        <input class="b3-switch fn__flex-center" id="lockScreenMode" type="checkbox"${window.siyuan.config.system.lockScreenMode===1?" checked":""}>
    </label>
</div>
<div class="b3-label config__item${W()&&!St()&&!Xt()&&!Qt()?" fn__none":" fn__flex"}">
    <div class="fn__flex-1">
       ${window.siyuan.languages.about2}
        <div class="b3-label__text">${window.siyuan.languages.about3.replace("${port}",location.port)}</div>
        ${(()=>{const e=[],n=[];for(const a of window.siyuan.config.localIPs){if(!a.trim())break;a.startsWith("[")&&a.endsWith("]")?n.push(`<code class="fn__code">${a}</code>`):e.push(`<code class="fn__code">${a}</code>`)}return`<div class="b3-label__text${e.length?"":" fn__none"}">${e.join(" ")}</div>
                    <div class="b3-label__text${n.length?"":" fn__none"}">${n.join(" ")}</div>`})()}
        <div class="b3-label__text">${window.siyuan.languages.about18}</div>
    </div>
    <div class="fn__space"></div>
    <button data-type="open" data-url="http://${window.siyuan.config.system.networkServe?window.siyuan.config.localIPs[0]:"127.0.0.1"}:${location.port}" class="b3-button b3-button--outline fn__size200 fn__flex-center">
        <svg><use xlink:href="#iconLink"></use></svg>${window.siyuan.languages.about4}
    </button>
</div>
<div class="b3-label fn__flex config__item">
    <div class="fn__flex-1 fn__flex-center">
        ${window.siyuan.languages.dataRepoKey}
        <div class="b3-label__text">${window.siyuan.languages.dataRepoKeyTip1}</div>
        <div class="b3-label__text"><span class="ft__error">${window.siyuan.languages.dataRepoKeyTip2}</span></div>
    </div>
    <div class="fn__space"></div>
    <div class="fn__size200 config__item-line fn__flex-center${window.siyuan.config.repo.key?" fn__none":""}">
        <button class="b3-button b3-button--outline fn__block" id="importKey">
            <svg><use xlink:href="#iconDownload"></use></svg>${window.siyuan.languages.importKey}
        </button>
        <div class="fn__hr"></div>
        <button class="b3-button b3-button--outline fn__block" id="initKey">
            <svg><use xlink:href="#iconLock"></use></svg>${window.siyuan.languages.genKey}
        </button>
        <div class="fn__hr"></div>
        <button class="b3-button b3-button--outline fn__block" id="initKeyByPW">
            <svg><use xlink:href="#iconHand"></use></svg>${window.siyuan.languages.genKeyByPW}
        </button>
    </div>
    <div class="fn__size200 config__item-line fn__flex-center${window.siyuan.config.repo.key?"":" fn__none"}">
        <button class="b3-button b3-button--outline fn__block" id="copyKey">
            <svg><use xlink:href="#iconCopy"></use></svg>${window.siyuan.languages.copyKey}
        </button>
        <div class="fn__hr"></div>
        <button class="b3-button b3-button--outline fn__block" id="resetRepo">
            <svg><use xlink:href="#iconUndo"></use></svg>${window.siyuan.languages.resetRepo}
        </button>
    </div>
</div>
<div class="b3-label">
    <div>
        ${window.siyuan.languages.dataRepoPurge}
    </div>
    <div class="fn__hr"></div>
    <div class="fn__flex config__item">
        <div class="fn__flex-center fn__flex-1 ft__on-surface">${window.siyuan.languages.dataRepoPurgeTip}</div>
        <span class="fn__space"></span>
        <button id="purgeRepo" class="b3-button b3-button--outline fn__size200 fn__flex-center">
            <svg><use xlink:href="#iconTrashcan"></use></svg>${window.siyuan.languages.purge}
        </button>
    </div>
    <div class="fn__hr"></div>
    <div class="fn__flex config__item">
        <div class="fn__flex-center fn__flex-1 ft__on-surface">${window.siyuan.languages.dataRepoAutoPurgeIndexRetentionDays}</div>
        <span class="fn__space"></span>
        <input class="b3-text-field fn__flex-center fn__size200" min="1" type="number" id="indexRetentionDays" value="${window.siyuan.config.repo.indexRetentionDays}">
    </div>
    <div class="fn__hr"></div>
    <div class="fn__flex config__item">
        <div class="fn__flex-center fn__flex-1 ft__on-surface">${window.siyuan.languages.dataRepoAutoPurgeRetentionIndexesDaily}</div>
        <span class="fn__space"></span>
        <input class="b3-text-field fn__flex-center fn__size200" min="1" type="number" id="retentionIndexesDaily" value="${window.siyuan.config.repo.retentionIndexesDaily}">
    </div>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.vacuumDataIndex}
        <div class="b3-label__text">${window.siyuan.languages.vacuumDataIndexTip}</div>
    </div>
    <div class="fn__space"></div>
    <button id="vacuumDataIndex" class="b3-button b3-button--outline fn__size200 fn__flex-center">
        <svg><use xlink:href="#iconRefresh"></use></svg>${window.siyuan.languages.vacuumDataIndex}
    </button>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.rebuildDataIndex}
        <div class="b3-label__text">${window.siyuan.languages.rebuildDataIndexTip}</div>
    </div>
    <div class="fn__space"></div>
    <button id="rebuildDataIndex" class="b3-button b3-button--outline fn__size200 fn__flex-center">
        <svg><use xlink:href="#iconRefresh"></use></svg>${window.siyuan.languages.rebuildDataIndex}
    </button>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.systemLog}
        <div class="b3-label__text">${window.siyuan.languages.systemLogTip}</div>
    </div>
    <div class="fn__space"></div>
    <button id="exportLog" class="b3-button b3-button--outline fn__size200 fn__flex-center">
        <svg><use xlink:href="#iconUpload"></use></svg>${window.siyuan.languages.export}
    </button>
</div>
${t}
<div class="fn__flex config__item  b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.about13}
         <div class="b3-label__text" id="tokenTip">${window.siyuan.languages.about14.replace("${token}",window.siyuan.config.api.token)}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" id="token" value="${window.siyuan.config.api.token}">
</div>
<div class="b3-label">
    ${window.siyuan.languages.networkProxy}
    <div class="b3-label__text">
        ${window.siyuan.languages.about17}
    </div>
    <div class="b3-label__text fn__flex config__item">
        <select id="aboutScheme" class="b3-select">
            <option value="" ${window.siyuan.config.system.networkProxy.scheme===""?"selected":""}>${window.siyuan.languages.directConnection}</option>
            <option value="socks5" ${window.siyuan.config.system.networkProxy.scheme==="socks5"?"selected":""}>SOCKS5</option>
            <option value="https" ${window.siyuan.config.system.networkProxy.scheme==="https"?"selected":""}>HTTPS</option>
            <option value="http" ${window.siyuan.config.system.networkProxy.scheme==="http"?"selected":""}>HTTP</option>
        </select>
        <span class="fn__space"></span>
        <input id="aboutHost" placeholder="user:pass@IP" class="b3-text-field fn__block" value="${window.siyuan.config.system.networkProxy.host}"/>
        <span class="fn__space"></span>
        <input id="aboutPort" placeholder="Port" class="b3-text-field fn__block" value="${window.siyuan.config.system.networkProxy.port}" type="number"/>
        <span class="fn__space"></span>
        <button id="aboutConfirm" class="b3-button fn__size200 b3-button--outline">${window.siyuan.languages.confirm}</button>
    </div>
</div>
<div class="b3-label">
    <div class="config-about__logo">
        <img src="/stage/icon.png">
        <span>${window.siyuan.languages.siyuanNote}</span>
        <span class="fn__space"></span>
        <span class="ft__on-surface">${window.siyuan.languages.slogan}</span>
        <span class="fn__space"></span>
        <span style="color:var(--b3-theme-background);font-family: cursive;">\u4F1A\u6CFD\u767E\u5BB6&nbsp;\u81F3\u516C\u5929\u4E0B</span>
    </div>
    <div class='fn__hr'></div>
    ${window.siyuan.languages.about1} ${window.siyuan.config.system.container==="harmony"?" \u2022 "+window.siyuan.languages.feedback+" 845765@qq.com":""} 
</div>`},bindEvent:()=>{window.siyuan.config.system.isInsider&&($a.element.querySelector("#isInsider").innerHTML="<span class='ft__secondary'>Insider Preview</span>");const t=$a.element.querySelector("#indexRetentionDays");t.addEventListener("change",()=>{ae("/api/repo/setRepoIndexRetentionDays",{days:parseInt(t.value)},()=>{window.siyuan.config.repo.indexRetentionDays=parseInt(t.value)})});const e=$a.element.querySelector("#retentionIndexesDaily");e.addEventListener("change",()=>{ae("/api/repo/setRetentionIndexesDaily",{indexes:parseInt(e.value)},()=>{window.siyuan.config.repo.retentionIndexesDaily=parseInt(e.value)})});const n=$a.element.querySelector("#token");n.addEventListener("click",()=>{n.select()}),n.addEventListener("change",()=>{ae("/api/system/setAPIToken",{token:n.value},()=>{window.siyuan.config.api.token=n.value,$a.element.querySelector("#tokenTip").innerHTML=window.siyuan.languages.about14.replace("${token}",window.siyuan.config.api.token)})}),$a.element.querySelector("#vacuumDataIndex").addEventListener("click",()=>{ae("/api/system/vacuumDataIndex",{},()=>{})}),$a.element.querySelector("#rebuildDataIndex").addEventListener("click",()=>{ae("/api/system/rebuildDataIndex",{},()=>{})}),$a.element.querySelector("#exportLog").addEventListener("click",()=>{ae("/api/system/exportLog",{},l=>{$e(l.data.zip)})});const a=$a.element.querySelector("#checkUpdateBtn");a==null||a.addEventListener("click",()=>{a.firstElementChild.classList.contains("fn__rotate")||(a.innerHTML=`<svg class="fn__rotate"><use xlink:href="#iconRefresh"></use></svg>${window.siyuan.languages.checkUpdate}`,ae("/api/system/checkUpdate",{showMsg:!0},()=>{a.innerHTML=`<svg><use xlink:href="#iconRefresh"></use></svg>${window.siyuan.languages.checkUpdate}`}))}),$a.element.querySelectorAll('[data-type="open"]').forEach(l=>{l.addEventListener("click",()=>{const c=l.getAttribute("data-url");window.open(c)})}),$a.element.querySelector("#authCode").addEventListener("click",()=>{QW()});const i=$a.element.querySelector("#importKey");i.addEventListener("click",()=>{const l=new fe({title:"\u{1F511} "+window.siyuan.languages.key,content:`<div class="b3-dialog__content">
    <textarea spellcheck="false" style="resize: vertical;" class="b3-text-field fn__block" placeholder="${window.siyuan.languages.keyPlaceholder}"></textarea>
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:"520px"});l.element.setAttribute("data-key",p.DIALOG_PASSWORD);const c=l.element.querySelector("textarea");c.focus();const d=l.element.querySelectorAll(".b3-button");d[0].addEventListener("click",()=>{l.destroy()}),d[1].addEventListener("click",()=>{ae("/api/repo/importRepoKey",{key:c.value},u=>{window.siyuan.config.repo.key=u.data.key,i.parentElement.classList.add("fn__none"),i.parentElement.nextElementSibling.classList.remove("fn__none"),l.destroy()})})}),$a.element.querySelector("#initKey").addEventListener("click",()=>{Sn("\u{1F511} "+window.siyuan.languages.genKey,window.siyuan.languages.initRepoKeyTip,()=>{ae("/api/repo/initRepoKey",{},l=>{window.siyuan.config.repo.key=l.data.key,i.parentElement.classList.add("fn__none"),i.parentElement.nextElementSibling.classList.remove("fn__none")})})}),$a.element.querySelector("#initKeyByPW").addEventListener("click",()=>{hV(!1,()=>{i.parentElement.classList.add("fn__none"),i.parentElement.nextElementSibling.classList.remove("fn__none")})}),$a.element.querySelector("#copyKey").addEventListener("click",()=>{Q(window.siyuan.languages.copied),ut(window.siyuan.config.repo.key)}),$a.element.querySelector("#resetRepo").addEventListener("click",()=>{Sn("\u26A0\uFE0F "+window.siyuan.languages.resetRepo,window.siyuan.languages.resetRepoTip,()=>{ae("/api/repo/resetRepo",{},()=>{window.siyuan.config.repo.key="",window.siyuan.config.sync.enabled=!1,Ao(),i.parentElement.classList.remove("fn__none"),i.parentElement.nextElementSibling.classList.add("fn__none")})})}),$a.element.querySelector("#purgeRepo").addEventListener("click",()=>{Sn("\u267B\uFE0F "+window.siyuan.languages.dataRepoPurge,window.siyuan.languages.dataRepoPurgeConfirm,()=>{ae("/api/repo/purgeRepo")})});const s=$a.element.querySelector("#networkServe");s.addEventListener("change",()=>{ae("/api/system/setNetworkServe",{networkServe:s.checked},()=>{Ss({errorExit:!0,cb:Ac})})});const r=$a.element.querySelector("#lockScreenMode");r.addEventListener("change",()=>{ae("/api/system/setFollowSystemLockScreen",{lockScreenMode:r.checked?1:0},()=>{window.siyuan.config.system.lockScreenMode=r.checked?1:0})});const o=$a.element.querySelector("#downloadInstallPkg");o.addEventListener("change",()=>{ae("/api/system/setDownloadInstallPkg",{downloadInstallPkg:o.checked},()=>{window.siyuan.config.system.downloadInstallPkg=o.checked})}),$a.element.querySelector("#aboutConfirm").addEventListener("click",()=>{const l=$a.element.querySelector("#aboutScheme").value,c=$a.element.querySelector("#aboutHost").value,d=$a.element.querySelector("#aboutPort").value;ae("/api/system/setNetworkProxy",{scheme:l,host:c,port:d},()=>gV(void 0,null,function*(){window.siyuan.config.system.networkProxy.scheme=l,window.siyuan.config.system.networkProxy.host=c,window.siyuan.config.system.networkProxy.port=d}))})}},jr={element:void 0,genHTML:()=>{const t=x();return`<div class="fn__flex-column" style="height: 100%">
    <div class="layout-tab-bar fn__flex">
        <div class="item item--full item--focus" data-type="remove">
            <span class="fn__flex-1"></span>
            <span class="item__text">${window.siyuan.languages.unreferencedAssets}</span>
            <span class="fn__flex-1"></span>
        </div>
        <div class="item item--full" data-type="missing">
            <span class="fn__flex-1"></span>
            <span class="item__text">${window.siyuan.languages.missingAssets}</span>
            <span class="fn__flex-1"></span>
        </div>
    </div>
    <div class="fn__flex-1">
        <div class="config-assets${t?" b3-list--mobile":""}" data-type="remove" data-init="true">
            <div class="fn__hr--b"></div>
            <div class="fn__flex">
                <div class="fn__space"></div>
                <button id="removeAll" class="b3-button b3-button--outline fn__flex-center fn__size200">
                    <svg class="svg"><use xlink:href="#iconTrashcan"></use></svg>
                    ${window.siyuan.languages.delete}
                </button>
            </div>
            <div class="fn__hr"></div>
            <ul class="b3-list b3-list--background config-assets__list">
                <li class="fn__loading"><img src="/stage/loading-pure.svg"></li>
            </ul>
            <div class="config-assets__preview"></div>
        </div>
        <div class="fn__none config-assets${t?" b3-list--mobile":""}" data-type="missing">
            <div class="fn__hr"></div>
            <ul class="b3-list b3-list--background config-assets__list">
                <li class="fn__loading"><img src="/stage/loading-pure.svg"></li>
            </ul>
            <div class="fn__hr"></div>
        </div>
    </div>
</div>`},bindEvent:()=>{const t=jr.element.querySelector(".config-assets__list");jr.element.addEventListener("click",e=>{let n=e.target;for(;n&&!n.isEqualNode(jr.element);){const a=n.getAttribute("data-type");if(n.id==="removeAll")Sn(window.siyuan.languages.deleteOpConfirm,`${window.siyuan.languages.clearAll}`,()=>{ae("/api/asset/removeUnusedAssets",{},i=>{Cn().asset.forEach(s=>{i.data.paths.includes(s.path)&&s.parent.close()}),t.innerHTML=`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`,jr.element.querySelector(".config-assets__preview").innerHTML=""})},void 0,!0);else if(n.classList.contains("item")&&!n.classList.contains("item--focus")){jr.element.querySelector(".layout-tab-bar .item--focus").classList.remove("item--focus"),n.classList.add("item--focus"),jr.element.querySelectorAll(".config-assets").forEach(i=>{a===i.getAttribute("data-type")?(i.classList.remove("fn__none"),i.getAttribute("data-init")||(ae("/api/asset/getMissingAssets",{},s=>{jr._renderList(s.data.missingAssets,i.querySelector(".config-assets__list"),!1)}),i.setAttribute("data-init","true"))):i.classList.add("fn__none")}),e.preventDefault(),e.stopPropagation();break}else if(a==="copy")ut(n.parentElement.querySelector(".b3-list-item__text").textContent.trim().replace("assets/",""));else if(a!=="open"){if(a==="clear"){const i=n.parentElement.getAttribute("data-path");Sn(window.siyuan.languages.deleteOpConfirm,`${window.siyuan.languages.delete} <b>${_n().basename(i)}</b>`,()=>{ae("/api/asset/removeUnusedAsset",{path:i},s=>{Cn().asset.forEach(o=>{s.data.path===o.path&&o.parent.parent.removeTab(o.parent.id)});const r=n.parentElement;r.parentElement.querySelectorAll("li").length===1?r.parentElement.innerHTML=`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`:r.remove(),jr.element.querySelector(".config-assets__preview").innerHTML=""})},void 0,!0),e.preventDefault(),e.stopPropagation();break}}n=n.parentElement}}),t.addEventListener("mouseover",e=>{const n=N(e.target,"b3-list-item");if(n&&n.getAttribute("data-path")!==t.nextElementSibling.getAttribute("data-path")){const a=n.getAttribute("data-path");t.nextElementSibling.setAttribute("data-path",a),t.nextElementSibling.innerHTML=Cd(a)}}),ae("/api/asset/getUnusedAssets",{},e=>{jr._renderList(e.data.unusedAssets,t)})},_renderList:(t,e,n=!0)=>{let a="",i="";!W()&&n&&(i=`<span data-type="open" class="ariaLabel b3-list-item__action" aria-label="${window.siyuan.languages.showInFolder}">
    <svg><use xlink:href="#iconFolder"></use></svg>
</span>`);let s="";n&&(s=`<span data-type="clear" class="ariaLabel b3-list-item__action" aria-label="${window.siyuan.languages.delete}">
    <svg><use xlink:href="#iconTrashcan"></use></svg>
</span>`);const r=x();t.forEach(o=>{const l=o.indexOf("assets/"),c=o.substr(l);a+=`<li data-path="${c}"  class="b3-list-item${r?"":" b3-list-item--hide-action"}">
    <span class="b3-list-item__text">${he(o)}</span>
    <span data-type="copy" class="ariaLabel b3-list-item__action" aria-label="${window.siyuan.languages.copy}">
        <svg><use xlink:href="#iconCopy"></use></svg>
    </span>
    ${i}
    ${s}
</li>`}),e.innerHTML=a||`<li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li>`}},PL=t=>{const e=new fe({positionId:p.DIALOG_SAVEWORKSPACE,title:t?window.siyuan.languages.edit:window.siyuan.languages.save,content:`<div class="b3-dialog__content">
        <input class="b3-text-field fn__block" value="${t||""}" placeholder="${window.siyuan.languages.memo}">
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--remove${t?"":" fn__none"}">${window.siyuan.languages.delete}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text${t?"":" fn__none"}">${window.siyuan.languages.rename}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages[t?"updateLayout":"confirm"]}</button>
</div>`,width:"520px"});e.element.setAttribute("data-key",p.DIALOG_SAVEWORKSPACE);const n=e.element.querySelectorAll(".b3-button"),a=e.element.querySelector("input");a.select(),a.focus(),e.bindInput(a,()=>{n[3].dispatchEvent(new CustomEvent("click"))}),n[0].addEventListener("click",()=>{window.siyuan.storage[p.LOCAL_LAYOUTS].find((i,s)=>{if(i.name===t)return window.siyuan.storage[p.LOCAL_LAYOUTS].splice(s,1),Gt(p.LOCAL_LAYOUTS,window.siyuan.storage[p.LOCAL_LAYOUTS]),!0}),e.destroy()}),n[1].addEventListener("click",()=>{e.destroy()}),n[2].addEventListener("click",()=>{const i=a.value;if(!i){Q(window.siyuan.languages._kernel[142]);return}e.destroy(),window.siyuan.storage[p.LOCAL_LAYOUTS].find(s=>{if(s.name===t)return s.name=i,s.time=new Date().getTime(),Gt(p.LOCAL_LAYOUTS,window.siyuan.storage[p.LOCAL_LAYOUTS]),!0})}),n[3].addEventListener("click",()=>{const i=a.value;if(!i){Q(window.siyuan.languages._kernel[142]);return}if(e.destroy(),t){window.siyuan.storage[p.LOCAL_LAYOUTS].find(r=>{if(r.name===t)return r.name=i,r.time=new Date().getTime(),r.layout=tk(),r.filesPaths=window.siyuan.storage[p.LOCAL_FILESPATHS],Gt(p.LOCAL_LAYOUTS,window.siyuan.storage[p.LOCAL_LAYOUTS]),!0});return}window.siyuan.storage[p.LOCAL_LAYOUTS].find(r=>{if(r.name===i)return Sn(window.siyuan.languages.save,window.siyuan.languages.exportTplTip,()=>{r.layout=tk(),r.time=new Date().getTime(),r.filesPaths=window.siyuan.storage[p.LOCAL_FILESPATHS],Gt(p.LOCAL_LAYOUTS,window.siyuan.storage[p.LOCAL_LAYOUTS])}),!0})||(window.siyuan.storage[p.LOCAL_LAYOUTS].push({name:i,time:new Date().getTime(),layout:tk(),filesPaths:window.siyuan.storage[p.LOCAL_FILESPATHS]}),Gt(p.LOCAL_LAYOUTS,window.siyuan.storage[p.LOCAL_LAYOUTS]))})},GE=(t,e,n)=>({id:t,label:`${e.pin?window.siyuan.languages.unpin:window.siyuan.languages.pin}`,icon:n,current:!e.pin,click(){e.togglePin()}}),jE=(t,e)=>{if(!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_BAR_WORKSPACE){window.siyuan.menus.menu.remove();return}ae("/api/system/getWorkspaces",{},n=>{window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_BAR_WORKSPACE);const a=[];if(uw().forEach(s=>{a.push({id:s.type,icon:s.icon,accelerator:s.hotkey,label:s.title,click(){Vn(s.type).toggleModel(s.type)}})}),window.siyuan.config.readonly||(a.push({id:"separator_1",type:"separator"}),a.push(GE("leftDock",window.siyuan.layout.leftDock,"iconLeftTop")),a.push(GE("rightDock",window.siyuan.layout.rightDock,"iconRightTop")),a.push(GE("bottomDock",window.siyuan.layout.bottomDock,"iconBottomLeft"))),window.siyuan.menus.menu.append(new xe({id:"panels",label:window.siyuan.languages.panels,icon:"iconDock",type:"submenu",submenu:a}).element),!window.siyuan.config.readonly){let s;s=[{id:"new",label:window.siyuan.languages.new,iconHTML:"",click(){const r=new fe({title:window.siyuan.languages.new,content:`<div class="b3-dialog__content">
    <input class="b3-text-field fn__block">
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:"520px"});r.element.setAttribute("data-key",p.DIALOG_CREATEWORKSPACE);const o=r.element.querySelector("input");o.focus();const l=r.element.querySelectorAll(".b3-button");l[0].addEventListener("click",()=>{r.destroy()}),l[1].addEventListener("click",()=>{ae("/api/system/createWorkspaceDir",{path:_n().join(_n().dirname(window.siyuan.config.system.workspaceDir),o.value)},()=>{r.destroy()})})}},{id:"openBy",label:`${window.siyuan.languages.openBy}...`,iconHTML:"",click(){ae("/api/system/getMobileWorkspaces",{},r=>{let o="";r.data.forEach((d,u)=>{o+=`<option value="${d}"${u===0?' selected="selected"':""}>${_n().basename(d)}</option>`});const l=new fe({title:window.siyuan.languages.openBy,content:`<div class="b3-dialog__content">
    <select class="b3-text-field fn__block">${o}</select>
</div>
<div class="b3-dialog__action">
    <button class="b3-button b3-button--cancel">${window.siyuan.languages.cancel}</button><div class="fn__space"></div>
    <button class="b3-button b3-button--text">${window.siyuan.languages.confirm}</button>
</div>`,width:"520px"});l.element.setAttribute("data-key",p.DIALOG_OPENWORKSPACE);const c=l.element.querySelectorAll(".b3-button");c[0].addEventListener("click",()=>{l.destroy()}),c[1].addEventListener("click",()=>{const d=l.element.querySelector("select").value;if(d===window.siyuan.config.system.workspaceDir){l.destroy();return}Sn(window.siyuan.languages.confirm,`${_n().basename(window.siyuan.config.system.workspaceDir)} -> ${_n().basename(d)}?`,()=>{ae("/api/system/setWorkspaceDir",{path:d},()=>{Ac()})})})})}}],s.push({id:"separator_1",type:"separator"}),n.data.forEach(r=>{s.push({iconHTML:"",action:"iconCloseRound",current:window.siyuan.config.system.workspaceDir===r.path,label:_n().basename(r.path),bind(o){o.addEventListener("click",l=>{if(N(l.target,"b3-menu__action")){l.preventDefault(),l.stopPropagation(),ae("/api/system/removeWorkspaceDir",{path:r.path},()=>{Sn(window.siyuan.languages.deleteOpConfirm,window.siyuan.languages.removeWorkspacePhysically.replace("${x}",r.path),()=>{ae("/api/system/removeWorkspaceDirPhysically",{path:r.path})},void 0,!0)});return}Sn(window.siyuan.languages.confirm,`${_n().basename(window.siyuan.config.system.workspaceDir)} -> ${_n().basename(r.path)}?`,()=>{ae("/api/system/setWorkspaceDir",{path:r.path},()=>{Ac()})})})}})}),(!W()||Xt()||St()||Qt())&&window.siyuan.menus.menu.append(new xe({id:"workspaceList",label:window.siyuan.languages.workspaceList,icon:"iconWorkspace",type:"submenu",submenu:s}).element)}const i=[{id:"save",iconHTML:"",label:window.siyuan.languages.save,click(){PL()}}];if(window.siyuan.storage[p.LOCAL_LAYOUTS].length>0&&(i.push({id:"separator_1",type:"separator"}),i.push({iconHTML:"",type:"empty",label:`<input class="b3-text-field fn__block" style="margin: 4px 0" placeholder="${window.siyuan.languages.search}">
<div class="b3-list b3-list--background" style="max-width: 50vw"></div>`,bind(s){const r=()=>{let c="";return window.siyuan.storage[p.LOCAL_LAYOUTS].sort((d,u)=>d.name.localeCompare(u.name,void 0,{numeric:!0})).forEach(d=>{(o.value===""||d.name.toLowerCase().indexOf(o.value.toLowerCase())>-1)&&(c+=`<div data-name="${d.name}" class="b3-list-item b3-list-item--narrow b3-list-item--hide-action ${c?"":"b3-list-item--focus"}">
    <div class="b3-list-item__text">${d.name}</div>
    <span class="b3-list-item__meta">${d.time?at(d.time).format("YYYY-MM-DD HH:mm"):""}</span>
    <span class="b3-list-item__action">
        <svg><use xlink:href="#iconEdit"></use></svg>
    </span>
</div>`)}),c},o=s.querySelector(".b3-text-field"),l=s.querySelector(".b3-list");o.addEventListener("keydown",c=>{if(c.stopPropagation(),!c.isComposing){if(pi(l,c),c.key==="Escape")window.siyuan.menus.menu.remove();else if(c.key==="Enter"){const d=l.querySelector(".b3-list-item--focus");d&&l.dispatchEvent(new CustomEvent("click",{detail:d.getAttribute("data-name")}))}}}),o.addEventListener("compositionend",()=>{l.innerHTML=r()}),o.addEventListener("input",c=>{c.isComposing||(c.stopPropagation(),l.innerHTML=r())}),l.addEventListener("click",c=>{if(window.siyuan.config.readonly)return;const d=N(c.target,"b3-list-item__action");if(d){c.preventDefault(),c.stopPropagation(),PL(d.parentElement.dataset.name),window.siyuan.menus.menu.remove();return}const u=N(c.target,"b3-list-item");if(u||c.detail){const g=window.siyuan.storage[p.LOCAL_LAYOUTS].find(f=>{if(typeof c.detail=="string")return f.name===c.detail;if(u)return f.name===u.dataset.name});g&&ae("/api/system/setUILayout",{layout:g.layout},()=>{g.filesPaths?(window.siyuan.storage[p.LOCAL_FILESPATHS]=g.filesPaths,Gt(p.LOCAL_FILESPATHS,g.filesPaths,()=>{window.location.reload()})):window.location.reload()}),c.preventDefault(),c.stopPropagation()}}),l.innerHTML=r()}})),window.siyuan.config.readonly||window.siyuan.menus.menu.append(new xe({id:"layout",label:window.siyuan.languages.layout,icon:"iconLayout",type:"submenu",submenu:i}).element),window.siyuan.menus.menu.append(new xe({id:"separator_1",type:"separator"}).element),!window.siyuan.config.readonly){if(cf()<2)window.siyuan.menus.menu.append(new xe({id:"dailyNote",label:window.siyuan.languages.dailyNote,icon:"iconCalendar",accelerator:window.siyuan.config.keymap.general.dailyNote.custom,click:()=>{xv(t)}}).element);else{const s=[];window.siyuan.notebooks.forEach(r=>{r.closed||s.push({label:he(r.name),iconHTML:Yt(r.icon||window.siyuan.storage[p.LOCAL_IMAGES].note,"b3-menu__icon",!0),accelerator:window.siyuan.storage[p.LOCAL_DAILYNOTEID]===r.id?window.siyuan.config.keymap.general.dailyNote.custom:"",click:()=>{zy(t,r.id),window.siyuan.storage[p.LOCAL_DAILYNOTEID]=r.id,Gt(p.LOCAL_DAILYNOTEID,window.siyuan.storage[p.LOCAL_DAILYNOTEID])}})}),window.siyuan.menus.menu.append(new xe({id:"dailyNote",label:window.siyuan.languages.dailyNote,icon:"iconCalendar",type:"submenu",submenu:s}).element)}window.siyuan.config.readonly||window.siyuan.menus.menu.append(new xe({id:"riffCard",label:window.siyuan.languages.riffCard,type:"submenu",icon:"iconRiffCard",submenu:[{id:"spaceRepetition",iconHTML:"",label:window.siyuan.languages.spaceRepetition,accelerator:window.siyuan.config.keymap.general.riffCard.custom,click:()=>{wf(t)}},{id:"manage",iconHTML:"",label:window.siyuan.languages.manage,click:()=>{vf(t,"",window.siyuan.languages.all,"")}}]}).element),window.siyuan.menus.menu.append(new xe({id:"recentDocs",label:window.siyuan.languages.recentDocs,icon:"iconFile",accelerator:window.siyuan.config.keymap.general.recentDocs.custom,click:()=>{vw()}}).element),window.siyuan.menus.menu.append(new xe({id:"lockScreen",label:window.siyuan.languages.lockScreen,icon:"iconLock",accelerator:window.siyuan.config.keymap.general.lockScreen.custom,click:()=>{pw(t)}}).element),window.siyuan.menus.menu.append(new xe({id:"dataHistory",label:window.siyuan.languages.dataHistory,icon:"iconHistory",accelerator:window.siyuan.config.keymap.general.dataHistory.custom,click:()=>{Xy(t)}}).element),window.siyuan.menus.menu.append(new xe({id:"separator_2",type:"separator"}).element)}window.siyuan.menus.menu.append(new xe({id:"feedback",label:window.siyuan.languages.feedback,icon:"iconFeedback",click:()=>{window.open("https://www.cheman.top")}}).element),window.siyuan.menus.menu.append(new xe({id:"feedbackEmail",label:window.siyuan.languages.feedback+" (Email)",icon:"iconEmail",click:()=>{window.open("mailto:125607565@qq.com?subject=\u601D\u6E90\u7B14\u8BB0\u95EE\u9898\u53CD\u9988")}}).element),(yn()||St()||Qt()||!W())&&(window.siyuan.menus.menu.append(new xe({id:"separator_3",type:"separator"}).element),window.siyuan.menus.menu.append(new xe({id:"safeQuit",label:window.siyuan.languages.safeQuit,icon:"iconQuit",warning:!0,click:()=>{Ss({errorExit:!0,cb:Ac})}}).element)),window.siyuan.menus.menu.popup({x:e.left,y:e.bottom})})},aY=t=>{},iY=t=>{},NL=t=>(window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(new xe({id:"copy",icon:"iconCopy",label:window.siyuan.languages.copy,type:"submenu",submenu:sc([t])}).element),window.siyuan.menus.menu),mV=(t,e)=>{if(getSelection().rangeCount===0)return!1;const n=getSelection().getRangeAt(0);if(N(n.startContainer,"protyle",!0))return!1;let a,i,s,r,o;if(window.siyuan.dialogs.find(_=>{if(_.element.contains(n.startContainer)&&_.element.querySelector("#searchList"))return a=_.element.querySelector(".b3-dialog__body"),i=_,o=i.data,s=i.editors.edit,r=i.editors.unRefEdit,!0}),a||Cn().search.find(_=>{if(_.element.contains(n.startContainer))return a=_.element,s=_.editors.edit,o=_.config,r=_.editors.unRefEdit,!0}),!a)return!1;const l=a.querySelector("#searchAssets"),c=a.querySelector("#searchUnRefPanel"),d=l.classList.contains("fn__none")?c.classList.contains("fn__none")?"doc":"unRef":"asset",u=d==="asset"?l.querySelector("#searchAssetList"):d==="doc"?a.querySelector("#searchList"):c.querySelector("#searchUnRefList"),g=a.querySelector("#searchInput");if(d==="doc"&&Qe(window.siyuan.config.keymap.general.newFile.custom,e))return o.method===0&&Sv(t,g.value),!0;const f=e.target.id;if(e.key==="ArrowDown"&&e.altKey)return d==="asset"?G2(l):d==="doc"&&(f==="replaceInput"?z2(a.querySelector("#replaceInput")):Y2(a,o,s)),!0;const h=window.siyuan.storage[p.LOCAL_SEARCHASSET];if(!window.siyuan.menus.menu.element.classList.contains("fn__none"))return!1;let m=u.querySelector(".b3-list-item--focus");if(!m)return!1;if(m.getAttribute("data-type")==="search-new")return e.key==="Enter"&&o.method===0?(Sv(t,g.value),!0):!1;if(d!=="asset"){if(Qe(window.siyuan.config.keymap.editor.general.insertRight.custom,e)){const v=m.getAttribute("data-node-id");return na(v,(U,ee)=>{dn({app:t,id:v,position:"right",action:ee,zoomIn:U}),i&&i.destroy({focus:"false"})}),!0}const _=m.getAttribute("data-node-id");if(Qe("\u2318/",e)){const v=m.getBoundingClientRect();return NL(_).popup({x:v.left+30,y:v.bottom}),!0}if(Qe(window.siyuan.config.keymap.editor.general.copyBlockRef.custom,e))return ae("/api/block/getRefText",{id:_},v=>{ut(`((${_} '${v.data}'))`)}),!0;if(Qe(window.siyuan.config.keymap.editor.general.copyBlockEmbed.custom,e))return ut(`{{select * from blocks where id='${_}'}}`),!0;if(Qe(window.siyuan.config.keymap.editor.general.copyProtocol.custom,e))return ut(`siyuan://blocks/${_}`),!0;if(Qe(window.siyuan.config.keymap.editor.general.copyProtocolInMd.custom,e))return ae("/api/block/getRefText",{id:_},v=>{ut(`[${v.data}](siyuan://blocks/${_})`)}),!0;if(Qe(window.siyuan.config.keymap.editor.general.copyHPath.custom,e))return ae("/api/filetree/getHPathByID",{id:_},v=>{ut(v.data)}),!0;if(Qe(window.siyuan.config.keymap.editor.general.copyID.custom,e))return ut(_),!0}if(p.KEYCODELIST[e.keyCode]==="PageUp"){if(d==="asset"){if(!l.querySelector('[data-type="assetPrevious"]').getAttribute("disabled")){let _=parseInt(l.querySelector("#searchAssetResult .fn__flex-center").textContent.split("/")[0]);_>1&&(_--,Ks(l,h,_))}}else if(d==="doc")a.querySelector('[data-type="previous"]').getAttribute("disabled")||o.page>1&&(o.page--,$i(a,o,s));else if(d==="unRef"&&!a.querySelector('[data-type="unRefPrevious"]').getAttribute("disabled")){let _=parseInt(c.querySelector("#searchUnRefResult").textContent);_>1&&(_--,Ef(c,r,_))}return!0}if(p.KEYCODELIST[e.keyCode]==="PageDown"){if(d==="asset"){if(!l.querySelector('[data-type="assetNext"]').getAttribute("disabled")){const _=l.querySelector("#searchAssetResult .fn__flex-center").textContent.split("/");let v=parseInt(_[0]);v<parseInt(_[1])&&(v++,Ks(l,h,v))}}else if(d==="doc"){const _=a.querySelector('[data-type="next"]');_.getAttribute("disabled")||o.page<parseInt(_.parentElement.querySelector("#searchResult").getAttribute("data-pagecount"))&&(o.page++,$i(a,o,s))}else if(d==="unRef"&&!a.querySelector('[data-type="unRefNext"]').getAttribute("disabled")){let _=parseInt(c.querySelector("#searchUnRefResult").textContent);_<parseInt(c.querySelector("#searchUnRefResult").textContent.split("/")[1])&&(_++,Ef(c,r,_))}return!0}if(!window.siyuan.menus.menu.element.classList.contains("fn__none"))return!1;if(e.key==="Enter"){if(d!=="asset")if(f==="replaceInput")Dv(a,o,s,!1);else{const _=m.getAttribute("data-node-id");na(_,(v,U)=>{dn({app:t,id:_,action:U,zoomIn:v}),i&&i.destroy({focus:"false"})})}return!0}const b=28,y=l.querySelector("#searchAssetPreview");return e.key==="ArrowDown"?(m.classList.remove("b3-list-item--focus"),m.nextElementSibling?m.nextElementSibling.classList.add("b3-list-item--focus"):o.group===1&&d==="doc"?m.parentElement.nextElementSibling?m.parentElement.nextElementSibling.nextElementSibling.firstElementChild.classList.add("b3-list-item--focus"):u.children[1].firstElementChild.classList.add("b3-list-item--focus"):u.firstElementChild.classList.add("b3-list-item--focus"),m=u.querySelector(".b3-list-item--focus"),(u.scrollTop<m.offsetTop-u.clientHeight+b||u.scrollTop>m.offsetTop)&&(u.scrollTop=m.offsetTop-u.clientHeight+b),d==="asset"?Gy(y,m.dataset.id,g.value,h.method):Dd(d==="doc"?{id:m.getAttribute("data-node-id"),config:o,value:g.value,edit:s}:{id:m.getAttribute("data-node-id"),edit:r}),!0):e.key==="ArrowUp"?(m.classList.remove("b3-list-item--focus"),m.previousElementSibling?m.previousElementSibling.classList.add("b3-list-item--focus"):o.group===1&&d==="doc"?m.parentElement.previousElementSibling.previousElementSibling?m.parentElement.previousElementSibling.previousElementSibling.lastElementChild.classList.add("b3-list-item--focus"):u.lastElementChild.lastElementChild.classList.add("b3-list-item--focus"):u.lastElementChild.classList.add("b3-list-item--focus"),m=u.querySelector(".b3-list-item--focus"),(u.scrollTop<m.offsetTop-u.clientHeight+b||u.scrollTop>m.offsetTop-b*2)&&(u.scrollTop=m.offsetTop-b*2),d==="asset"?Gy(y,m.dataset.id,g.value,h.method):d==="doc"?Dd({id:m.getAttribute("data-node-id"),config:o,value:g.value,edit:s}):d==="unRef"&&Dd({id:m.getAttribute("data-node-id"),edit:r}),!0):!1},bV=(t,e)=>{let n=e.element.querySelector(".history__side .b3-list-item--focus");const a=Array.from(e.element.querySelectorAll(".history__side .b3-list-item[data-id]"));if(a.length<2)return;n?(n.classList.remove("b3-list-item--focus"),t.key==="Home"?n=a[0]:t.key==="End"?n=a[a.length-1]:a.find((o,l)=>{if(o===n)return t.key==="ArrowUp"?l===0?n=a[a.length-1]:n=a[l-1]:t.key==="ArrowDown"&&(l===a.length-1?n=a[0]:n=a[l+1]),!0})):n=a[0],n.classList.add("b3-list-item--focus"),n.parentElement.classList.contains("fn__none")&&(n.parentElement.classList.remove("fn__none"),n.parentElement.previousElementSibling.querySelector("svg").classList.add("b3-list-item__arrow--open"));const i=n.getBoundingClientRect(),r=e.element.querySelector(".history__side").getBoundingClientRect();i.bottom>r.bottom?n.scrollIntoView(!1):i.top<r.top&&n.scrollIntoView(),e.element.dispatchEvent(new CustomEvent("click",{detail:t.key.toLowerCase()}))};var yV=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const _V=t=>{const e=[],n=[],a=[];let i=-1;t.parent.children.forEach((s,r)=>{var o,l;const c=s.model;(!c||(o=c.editor)!=null&&o.protyle&&!((l=c.editor)!=null&&l.protyle.updated))&&e.push(s),s.id===t.id&&(i=r),i===-1?n.push(s):r>i&&a.push(s)}),window.siyuan.menus.menu.append(new xe({id:"close",icon:"iconClose",label:window.siyuan.languages.close,accelerator:window.siyuan.config.keymap.general.closeTab.custom,click:()=>{t.parent.removeTab(t.id)}}).element),t.parent.children.length>1&&(window.siyuan.menus.menu.append(new xe({id:"closeOthers",label:window.siyuan.languages.closeOthers,accelerator:window.siyuan.config.keymap.general.closeOthers.custom,click(){Fl(t,"closeOthers")}}).element),window.siyuan.menus.menu.append(new xe({id:"closeAll",label:window.siyuan.languages.closeAll,accelerator:window.siyuan.config.keymap.general.closeAll.custom,click(){Fl(t,"closeAll")}}).element),e.length>0&&window.siyuan.menus.menu.append(new xe({id:"closeUnmodified",label:window.siyuan.languages.closeUnmodified,accelerator:window.siyuan.config.keymap.general.closeUnmodified.custom,click(){Fl(t,"other",e)}}).element),n.length>0&&window.siyuan.menus.menu.append(new xe({id:"closeLeft",label:window.siyuan.languages.closeLeft,accelerator:window.siyuan.config.keymap.general.closeLeft.custom,click:()=>yV(void 0,null,function*(){Fl(t,"other",n)})}).element),a.length>0&&window.siyuan.menus.menu.append(new xe({id:"closeRight",label:window.siyuan.languages.closeRight,accelerator:window.siyuan.config.keymap.general.closeRight.custom,click(){Fl(t,"other",a)}}).element)),window.siyuan.menus.menu.append(new xe({id:"separator_1",type:"separator"}).element)},wV=(t,e)=>{const n=[{id:"splitLR",icon:"iconSplitLR",accelerator:window.siyuan.config.keymap.general.splitLR.custom,label:window.siyuan.languages.splitLR,click:()=>{e.parent.split("lr").addTab(xw(t,e))}}];e.parent.children.length>1&&n.push({id:"splitMoveR",icon:"iconLayoutRight",accelerator:window.siyuan.config.keymap.general.splitMoveR.custom,label:window.siyuan.languages.splitMoveR,click:()=>{const i=e.parent.split("lr");i.headersElement.append(e.headElement),i.headersElement.parentElement.classList.remove("fn__none"),i.moveTab(e),Ui()}}),n.push({id:"splitTB",icon:"iconSplitTB",accelerator:window.siyuan.config.keymap.general.splitTB.custom,label:window.siyuan.languages.splitTB,click:()=>{e.parent.split("tb").addTab(xw(t,e))}}),e.parent.children.length>1&&n.push({id:"splitMoveB",icon:"iconLayoutBottom",accelerator:window.siyuan.config.keymap.general.splitMoveB.custom,label:window.siyuan.languages.splitMoveB,click:()=>{const i=e.parent.split("tb");i.headersElement.append(e.headElement),i.headersElement.parentElement.classList.remove("fn__none"),i.moveTab(e),Ui()}});let a=[];return rp(window.siyuan.layout.centerLayout,a),a.length>1&&(n.push({id:"unsplit",label:window.siyuan.languages.unsplit,accelerator:window.siyuan.config.keymap.general.unsplit.custom,click:()=>{let i=e.parent.parent;for(;i.id!==window.siyuan.layout.centerLayout.id&&(a=[],rp(i,a),!(a.length>1));)i=i.parent;em(e.parent.parent.children[0],i,!0),Ui()}}),n.push({id:"unsplitAll",label:window.siyuan.languages.unsplitAll,accelerator:window.siyuan.config.keymap.general.unsplitAll.custom,click:()=>{em(window.siyuan.layout.centerLayout,window.siyuan.layout.centerLayout,!1),Ui()}})),n},BL=(t,e)=>{window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_TAB),_V(e),window.siyuan.menus.menu.append(new xe({id:"split",label:window.siyuan.languages.split,submenu:wV(t,e)}).element);const n=e.model;let a;if(n&&n instanceof Ma)a=n.editor.protyle.block.rootID;else{const i=e.headElement.getAttribute("data-initdata");if(i){const s=JSON.parse(i);s&&s.instance==="Editor"&&(a=s.rootId||s.blockId)}}return a?window.siyuan.menus.menu.append(new xe({id:"copy",label:window.siyuan.languages.copy,icon:"iconCopy",type:"submenu",submenu:sc([a],!1)}).element):n&&n instanceof El&&window.siyuan.menus.menu.append(new xe({id:"copy",label:window.siyuan.languages.copy,icon:"iconCopy",click(){ut(`[${pd(n.parent.title)}${_n().extname(n.path)}](${n.path})`)}}).element),e.headElement.classList.contains("item--pin")?window.siyuan.menus.menu.append(new xe({id:"unpin",label:window.siyuan.languages.unpin,icon:"iconUnpin",click:()=>{e.unpin()}}).element):window.siyuan.menus.menu.append(new xe({id:"pin",label:window.siyuan.languages.pin,icon:"iconPin",click:()=>{e.pin()}}).element),window.siyuan.menus.menu},em=(t,e,n)=>{let a=t;for(;a instanceof Gr;)a=a.children[0];for(let i=0;i<e.children.length;i++){const s=e.children[i];if(s instanceof Gr&&!n)em(a,s,n);else if(s instanceof zg&&s.id!==a.id&&s.children.length>0){for(let r=0;r<s.children.length;r++){const o=s.children[r];a.headersElement.append(o.headElement),a.moveTab(o),r--}i--}}},Do=(t,e)=>{var n,a;switch(t){case"fileTree":return Vn("file").toggleModel("file"),!0;case"outline":return Vn("outline").toggleModel("outline"),!0;case"bookmark":case"tag":case"inbox":return Vn(t).toggleModel(t),!0;case"backlinks":return Vn("backlink").toggleModel("backlink"),!0;case"config":return Dc(e),!0;case"globalSearch":return ds({app:e,hotkey:p.DIALOG_GLOBALSEARCH,key:(getSelection().rangeCount>0?getSelection().getRangeAt(0):document.createRange()).toString()}),!0;case"stickSearch":return Ro(e,(getSelection().rangeCount>0?getSelection().getRangeAt(0):document.createRange()).toString(),!0),!0;case"goBack":return m_(e),!0;case"goForward":return b_(e),!0;case"goToTab1":return ui(0),!0;case"goToTab2":return ui(1),!0;case"goToTab3":return ui(2),!0;case"goToTab4":return ui(3),!0;case"goToTab5":return ui(4),!0;case"goToTab6":return ui(5),!0;case"goToTab7":return ui(6),!0;case"goToTab8":return ui(7),!0;case"goToTab9":return ui(-1),!0;case"goToTabNext":return ui(-3),!0;case"goToTabPrev":return ui(-2),!0;case"mainMenu":return E()||jE(e,document.querySelector("#barWorkspace").getBoundingClientRect()),!0;case"recentDocs":return vw(),!0;case"recentClosed":if(window.siyuan.closedTabs.length>0){const i=window.siyuan.closedTabs.pop(),s=i.children;s.instance==="Editor"?qs({app:e,fileName:i.title,id:s.blockId,rootID:s.rootId,mode:s.mode,action:[s.action]}):s.instance==="Asset"?qs({app:e,assetPath:s.path,page:s.page}):s.instance==="Backlink"?Jh({app:e,blockId:s.blockId,rootId:s.rootId,title:i.title}):s.instance==="Outline"?wx({app:e,rootId:s.blockId,title:i.title,isPreview:s.isPreview}):s.instance==="Search"?qs({app:e,searchData:s.config}):s.instance==="Custom"&&qs({app:e,custom:{icon:i.icon,title:i.title,data:s.customModelData,id:s.customModelType}})}return!0;case"toggleDock":return xx(document.querySelector("#barDock use")),!0;case"toggleWin":return!0}if(t==="goToEditTabNext"||t==="goToEditTabPrev"){let i=document.querySelector(".layout__wnd--active ul.layout-tab-bar > .item--focus");if(i||(i=document.querySelector("ul.layout-tab-bar > .item--focus")),!i)return!0;const s=So().sort((o,l)=>o.headElement.getAttribute("data-activetime")>l.headElement.getAttribute("data-activetime")?-1:1),r=i.getAttribute("data-id");return s.find((o,l)=>{if(r===o.id){let c;t==="goToEditTabPrev"?l===0?c=s[s.length-1]:c=s[l-1]:l===s.length-1?c=s[0]:c=s[l+1];const d=mi(c.id);d.parent.switchTab(c.headElement),d.parent.showHeading()}}),!0}if(t==="closeUnmodified"){const i=ir(!1);if(i){const s=[];i.parent.children.forEach(r=>{var o,l;const c=r.model;(!c||(o=c.editor)!=null&&o.protyle&&!((l=c.editor)!=null&&l.protyle.updated))&&s.push(r)}),s.length>0&&Fl(i,"other",s)}return!0}if(t==="unsplitAll")return em(window.siyuan.layout.centerLayout,window.siyuan.layout.centerLayout,!1),!0;if(t==="unsplit"){const i=ir(!1);if(i){let s=[],r=i.parent.parent;for(;r.id!==window.siyuan.layout.centerLayout.id&&(s=[],rp(r,s),!(s.length>1));)r=r.parent;em(i.parent.parent.children[0],r,!0),Ui()}return!0}if(t==="closeTab"){const i=document.querySelector(".layout__tab--active");if(i&&i.getBoundingClientRect().width>0){let o;return Array.from(i.classList).find(l=>{if(l.startsWith("sy__"))return o=l.replace("sy__",""),!0}),o&&((n=Vn(o))==null||n.toggleModel(o,!1,!0)),!0}const s=ir();if(s)return s.parent.removeTab(s.id),!0;if(window.siyuan.blockPanels.length>0)return(a=window.siyuan.blockPanels[window.siyuan.blockPanels.length-1])==null||a.destroy(),!0;const r=ir(!1);if(r)return r.parent.removeTab(r.id),!0}if(t==="closeOthers"||t==="closeAll"){const i=ir(!1);return i&&Fl(i,t),!0}if(t==="closeLeft"||t==="closeRight"){const i=ir(!1);if(i){const s=[],r=[];let o=-1;i.parent.children.forEach((l,c)=>{l.id===i.id&&(o=c),o===-1?s.push(l):c>o&&r.push(l)}),t==="closeLeft"?s.length>0&&Fl(i,"other",s):r.length>0&&Fl(i,"other",r)}return!0}if(t==="splitLR"){const i=ir(!1);return i&&i.parent.split("lr").addTab(xw(e,i)),!0}if(t==="splitTB"){const i=ir(!1);return i&&i.parent.split("tb").addTab(xw(e,i)),!0}if(t==="splitMoveB"||t==="splitMoveR"){const i=ir(!1);if(i&&i.parent.children.length>1){const s=i.parent.split(t==="splitMoveB"?"tb":"lr");s.headersElement.append(i.headElement),s.headersElement.parentElement.classList.remove("fn__none"),s.moveTab(i),Ui()}return!0}if(t==="tabToWindow"){const i=ir(!1);return i&&ML(i),!0}switch(t){case"dailyNote":return xv(e),!0;case"dataHistory":return Xy(e),!0;case"editReadonly":return zE(!window.siyuan.config.editor.readOnly),!0;case"lockScreen":return pw(e),!0;case"newFile":return Oo({app:e,useSavePath:!0}),!0;case"riffCard":return wf(e),!0;case"selectOpen1":return AA(),!0;case"syncNow":return kw(e),!0}return!1};var vV=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const $L=t=>{const e=getSelection().rangeCount>0?getSelection().getRangeAt(0):void 0,n=new fe({width:x()?"92vw":"80vw",height:x()?"80vh":"70vh",title:window.siyuan.languages.commandPanel,content:`<div class="fn__flex-column">
    <div class="b3-form__icon search__header" style="border-top: 0;border-bottom: 1px solid var(--b3-theme-surface-lighter);">
        <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>
        <input class="b3-text-field b3-text-field--text" style="padding-left: 32px !important;">
    </div>
    <ul class="b3-list b3-list--background search__list" id="commands"></ul>
    <div class="search__tip">
        <kbd>\u2191/\u2193</kbd> ${window.siyuan.languages.searchTip1}
        <kbd>${window.siyuan.languages.enterKey}/${window.siyuan.languages.click}</kbd> ${window.siyuan.languages.confirm}
        <kbd>Esc</kbd> ${window.siyuan.languages.close}
    </div>
</div>`,destroyCallback(){e&&Pt(e)}});n.element.setAttribute("data-key",p.DIALOG_COMMANDPANEL);const a=n.element.querySelector("#commands");let i="";if(Object.keys(window.siyuan.config.keymap.general).forEach(r=>{let o;o=["addToDatabase","fileTree","outline","bookmark","tag","dailyNote","inbox","backlinks","closeAll","closeLeft","closeOthers","closeRight","closeTab","closeUnmodified","config","dataHistory","editReadonly","enter","enterBack","globalSearch","goBack","goForward","goToEditTabNext","goToEditTabPrev","goToTab1","goToTab2","goToTab3","goToTab4","goToTab5","goToTab6","goToTab7","goToTab8","goToTab9","goToTabNext","goToTabPrev","lockScreen","mainMenu","move","newFile","recentDocs","replace","riffCard","search","selectOpen1","syncNow","splitLR","splitMoveB","splitMoveR","splitTB","tabToWindow","stickSearch","toggleDock","unsplitAll","unsplit","recentClosed"],o.includes(r)&&(i+=`<li class="b3-list-item" data-command="${r}">
    <span class="b3-list-item__text">${window.siyuan.languages[r]}</span>
    <span class="b3-list-item__meta${x()?" fn__none":""}">${Mt(window.siyuan.config.keymap.general[r].custom)}</span>
</li>`)}),Object.keys(window.siyuan.config.keymap.editor.general).forEach(r=>{["switchReadonly","switchAdjust"].includes(r)&&(i+=`<li class="b3-list-item" data-command="${r}">
    <span class="b3-list-item__text">${window.siyuan.languages[r]}</span>
    <span class="b3-list-item__meta${x()?" fn__none":""}">${Mt(window.siyuan.config.keymap.editor.general[r].custom)}</span>
</li>`)}),a.insertAdjacentHTML("beforeend",i),t.plugins.forEach(r=>{r.commands.forEach(o=>{const l=document.createElement("li");l.classList.add("b3-list-item"),l.innerHTML=`<span class="b3-list-item__text">${r.displayName}: ${o.langText||r.i18n[o.langKey]}</span>
<span class="b3-list-item__meta${x()?" fn__none":""}">${Mt(o.customHotkey)}</span>`,l.addEventListener("click",c=>{o.callback?o.callback():o.globalCallback&&o.globalCallback(),n.destroy(),c.preventDefault(),c.stopPropagation()}),a.insertAdjacentElement("beforeend",l)})}),a.childElementCount===0){const r=document.createElement("li");r.classList.add("b3-list-item","b3-list-item--focus"),r.innerHTML=`<span class="b3-list-item__text" style="-webkit-line-clamp: inherit;">${window.siyuan.languages._kernel[122]}</span>`,r.addEventListener("click",()=>{n.destroy()}),a.insertAdjacentElement("beforeend",r)}else a.firstElementChild.classList.add("b3-list-item--focus");const s=n.element.querySelector(".b3-text-field");s.focus(),a.addEventListener("click",r=>{const o=N(r.target,"b3-list-item");if(o){const l=o.getAttribute("data-command");l&&(Mi({command:l,app:t,previousRange:e}),n.destroy(),r.preventDefault(),r.stopPropagation())}}),s.addEventListener("keydown",r=>{if(r.stopPropagation(),!r.isComposing)if(pi(a,r),r.key==="Enter"){const o=a.querySelector(".b3-list-item--focus");if(o){const l=o.getAttribute("data-command");l?Mi({command:l,app:t,previousRange:e}):o.dispatchEvent(new CustomEvent("click"))}n.destroy()}else r.key==="Escape"&&n.destroy()}),s.addEventListener("compositionend",()=>{OL(s,a)}),s.addEventListener("input",r=>{r.isComposing||(r.stopPropagation(),OL(s,a))})},OL=(t,e)=>{var n;const a=t.value.toLowerCase();(n=e.querySelector(".b3-list-item--focus"))==null||n.classList.remove("b3-list-item--focus");let i=!1;Array.from(e.children).forEach(s=>{const r=s.querySelector(".b3-list-item__text").textContent.toLowerCase(),o=s.dataset.command;a.indexOf(r)>-1||r.indexOf(a)>-1||a.indexOf(o)>-1||(o==null?void 0:o.indexOf(a))>-1?(i||s.classList.add("b3-list-item--focus"),i=!0,s.classList.remove("fn__none")):s.classList.add("fn__none")})},Mi=t=>vV(void 0,null,function*(){var e,n,a;if(Do(t.command,t.app))return;const i=(e=document.querySelector(".layout__tab--active"))==null?void 0:e.classList.contains("sy__file");let s=t.protyle;const r=t.previousRange||(getSelection().rangeCount>0?getSelection().getRangeAt(0):document.createRange());let o=t.fileLiElements;if(!i&&!s){r&&window.siyuan.dialogs.find(c=>{if(c.editors&&(Object.keys(c.editors).find(d=>{if(c.editors[d].protyle.element.contains(r.startContainer))return s=c.editors[d].protyle,!0}),s))return!0});const l=ir();if(!s&&l)l.model instanceof Ma?s=l.model.editor.protyle:l.model instanceof Ll?l.model.element.querySelector("#searchUnRefPanel").classList.contains("fn__none")?s=l.model.editors.edit.protyle:s=l.model.editors.unRefEdit.protyle:l.model instanceof ko&&((n=l.model.editors)==null?void 0:n.length)>0&&r&&l.model.editors.find(c=>{if(c.protyle.element.contains(r.startContainer))return s=c.protyle,!0});else if(!s){!s&&r&&window.siyuan.blockPanels.find(d=>{if(d.editors.find(u=>{if(u.protyle.element.contains(r.startContainer))return s=u.protyle,!0}),s)return!0});const c=Cn();s||c.backlink.find(d=>{if(d.element.classList.contains("layout__tab--active"))return r&&d.editors.find(u=>{if(u.protyle.element.contains(r.startContainer))return s=u.protyle,!0}),!s&&d.editors.length>0&&(s=d.editors[0].protyle),!0}),s||c.editor.find(d=>{if(d.parent.headElement.classList.contains("item--focus"))return s=d.editor.protyle,!0})}}if(!(!i&&s&&Zg({command:t.command,previousRange:r,protyle:s}))){if(i&&!o){const l=Vn("file");if(!l)return!1;const c=l.data.file;o=Array.from(c.element.querySelectorAll(".b3-list-item--focus"))}if(!s&&!i||i&&(!o||o.length===0)||x()&&!document.getElementById("empty").classList.contains("fn__none")){t.command==="replace"?ds({app:t.app,hotkey:p.DIALOG_REPLACE,key:r.toString()}):t.command==="search"&&ds({app:t.app,hotkey:p.DIALOG_SEARCH,key:r.toString()});return}switch(t.command){case"replace":if(!i)ds({app:t.app,hotkey:p.DIALOG_REPLACE,key:r.toString(),notebookId:s.notebookId,searchPath:s.path});else{const l=pe(o[0],"UL");if(!l)return!1;const c=l.getAttribute("data-url"),d=o[0].getAttribute("data-path"),u=o[0].getAttribute("data-type")==="navigation-file";ds(u?{app:t.app,hotkey:p.DIALOG_REPLACE,notebookId:c,searchPath:ha(d,!1,!0)}:{app:t.app,hotkey:p.DIALOG_REPLACE,notebookId:c})}break;case"search":if(!i)ds({app:t.app,hotkey:p.DIALOG_SEARCH,key:r.toString(),notebookId:s.notebookId,searchPath:s.path});else{const l=pe(o[0],"UL");if(!l)return!1;const c=l.getAttribute("data-url"),d=o[0].getAttribute("data-path"),u=o[0].getAttribute("data-type")==="navigation-file";ds(u?{app:t.app,hotkey:p.DIALOG_SEARCH,notebookId:c,searchPath:ha(d,!1,!0)}:{app:t.app,hotkey:p.DIALOG_SEARCH,notebookId:c})}break;case"addToDatabase":i?vv(o):qy(s,r);break;case"move":if(i){const l=of(o);ur((c,d)=>{lf(l,d[0],c[0])},l)}else{const l=oe(r.startContainer);if((a=s.title)!=null&&a.editElement.contains(r.startContainer)||!l||window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_TITLE)ur((c,d)=>{lf([s.path],d[0],c[0])},[s.path],r);else if(l&&r&&s.element.contains(r.startContainer)){let c=Array.from(s.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));c.length===0&&(c=[l]),ur(d=>{Wv(d[0],c,s)})}}break}}});var xV=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});let Mn,hu;const EV=t=>{let e,n;document.addEventListener("mouseover",a=>{var i;if(!window.siyuan.config||!window.siyuan.menus||window.siyuan.dragElement||document.onmousemove){Pa();return}const s=ue(a.target,"data-type","a",!0)||N(a.target,"ariaLabel")||ue(a.target,"data-type","tab-header")||ue(a.target,"data-type","inline-memo")||N(a.target,"av__calc--ashow")||N(a.target,"av__cell");if(s){let r="",o=s.getAttribute("aria-label")||"";if(s.classList.contains("av__cell")&&!s.classList.contains("ariaLabel"))if(s.classList.contains("av__cell--header")){const l=s.querySelector(".av__celltext"),c=s.getAttribute("data-desc");(l.scrollWidth>l.clientWidth+.5||c)&&(c?o=`${Rd(s)}<div class='ft__on-surface'>${Ot(c)}</div>`:o=Rd(s))}else((i=s.firstElementChild)==null?void 0:i.getAttribute("data-type"))==="url"&&s.firstElementChild.textContent.indexOf("...")>-1&&(o=Lute.EscapeHTMLStr(s.firstElementChild.getAttribute("data-href")),r="href"),o="",!o&&s.dataset.wrap!=="true"&&a.target.dataset.type!=="block-more"&&!N(a.target,"block__icon")&&(s.style.overflow="auto",s.scrollWidth>s.clientWidth+2&&(o=Lute.EscapeHTMLStr(Rd(s))),s.style.overflow="");else if(s.parentElement.parentElement.classList.contains("av__views")&&s.parentElement.classList.contains("layout-tab-bar")){const l=s.querySelector(".item__text"),c=s.getAttribute("data-desc");(l.scrollWidth>l.clientWidth+.5||c)&&(c?o=`${l.textContent}<div class='ft__on-surface'>${Ot(c)}</div>`:o=l.textContent)}else if(s.classList.contains("av__celltext--url")){const l=s.getAttribute("data-name")||"";o=o?`<span style="word-break: break-all">${o.substring(0,p.SIZE_TITLE)}</span>${l?'<div class="fn__hr"></div><span>'+l+"</span>":""}`:l,r="href"}else if(s.classList.contains("av__calc--ashow")&&s.clientWidth+2<s.scrollWidth)o=s.lastChild.textContent+" "+s.firstElementChild.textContent;else if(s.getAttribute("data-type")==="setRelationCell"){const l=s.querySelector(".b3-menu__label");l&&l.clientWidth<l.scrollWidth&&(o=l.textContent)}if(o||(o=s.getAttribute("data-inline-memo-content"),o&&(r="memo")),!o){const l=s.getAttribute("data-href")||"";l&&(o=`<span style="word-break: break-all">${l.substring(0,p.SIZE_TITLE)}</span>`,r="href");const c=s.getAttribute("data-title");if(o&&Mo(l)&&!s.classList.contains("b3-tooltips")){let d=o;ae("/api/asset/statAsset",{path:l},u=>{u.code===1?c&&(d+='<div class="fn__hr"></div><span>'+c+"</span>"):d+=` ${u.data.hSize}${c?'<div class="fn__hr"></div><span>'+c+"</span>":""}<br>${window.siyuan.languages.modifiedAt} ${u.data.hUpdated}<br>${window.siyuan.languages.createdAt} ${u.data.hCreated}`,hr(d,s,r)}),o=""}else c&&(o=(o?o+'<div class="fn__hr"></div>':"")+"<span>"+c+"</span>")}if(hu=N(a.target,"b3-list-item__text"),hu&&hu.parentElement.getAttribute("data-type")==="navigation-root"&&ae("/api/notebook/getNotebookInfo",{notebook:hu.parentElement.parentElement.getAttribute("data-url")},l=>{const c=l.data.boxInfo,d=`${c.name} <small class='ft__on-surface'>${c.hSize}</small>${c.docCount!==0?window.siyuan.languages.includeSubFile.replace("x",c.docCount):""}<br>${window.siyuan.languages.modifiedAt} ${c.hMtime}<br>${window.siyuan.languages.createdAt} ${c.hCtime}`,u=N(a.target,"b3-list-item__text");hu&&u&&hu===u&&hr(d,hu),u&&u.parentElement.getAttribute("data-type")==="navigation-root"&&u.parentElement.parentElement.getAttribute("data-url")===c.id&&u.setAttribute("aria-label",d)}),o&&!s.classList.contains("b3-tooltips")){try{hr(decodeURIComponent(o),s,r)}catch(l){hr(o,s,r)}a.stopPropagation()}else Pa()}else if(!s){const r=ue(a.target,"id","tooltip",!0);(!r||r&&r.clientHeight>=r.scrollHeight&&r.clientWidth>=r.scrollWidth)&&Pa()}if(window.siyuan.config.editor.floatWindowMode===1||window.siyuan.shiftIsPressed){if(clearTimeout(n),n=window.setTimeout(()=>{RL(a)},p.TIMEOUT_INPUT),!UL(a,s)||a.relatedTarget&&!document.contains(a.relatedTarget))return;window.siyuan.ctrlIsPressed?(clearTimeout(n),tm(t)):window.siyuan.shiftIsPressed&&(clearTimeout(n),tm(t,!0));return}clearTimeout(e),clearTimeout(n),n=window.setTimeout(()=>{RL(a)&&!Mn&&!s&&clearTimeout(e)},p.TIMEOUT_INPUT),e=window.setTimeout(()=>{!UL(a,s)||R()||(clearTimeout(n),tm(t))},620)})},RL=t=>{var e;const n=R()?document.elementFromPoint(t.clientX,t.clientY):t.target;if(!n||n.id&&n.tagName!=="svg"&&(n.id.startsWith("minder_node")||n.id.startsWith("kity_")||n.id.startsWith("node_"))||n.classList.contains("counter")||n.tagName==="circle")return!1;const a=N(n,"av__panel")||N(n,"av__mask");if(a){if(window.siyuan.blockPanels.find(r=>{if(r.element.style.zIndex<a.style.zIndex)return!0}))return!1}else{const s=N(n,"b3-menu");if(s&&s.getAttribute("data-name")!==p.MENU_DOC_TREE_MORE&&window.siyuan.blockPanels.find(o=>{if(o.element.style.zIndex<s.style.zIndex)return!0}))return!1}Mn=ue(n,"data-type","block-ref")||ue(n,"data-type","virtual-block-ref"),Mn&&Mn.classList.contains("b3-tooltips")&&(Mn=void 0),Mn||(Mn=N(n,"popover__block"));const i=ue(n,"data-type","a",!0);if(!Mn&&i&&((e=i.getAttribute("data-href"))!=null&&e.startsWith("siyuan://blocks"))&&(Mn=i),!Mn||Mn&&window.siyuan.menus.menu.data&&window.siyuan.menus.menu.data===Mn){let s=n;!s.parentElement&&t.path&&t.path[1]&&(s=t.path[1]);const r=N(s,"block__popover",!0),o={oid:0};window.siyuan.blockPanels.forEach(c=>{if((c.targetElement||typeof c.x=="number")&&c.element.getAttribute("data-pin")==="true"){const d=parseInt(c.element.getAttribute("data-level")),u=c.element.getAttribute("data-oid");o[u]?d>o[u]&&(o[u]=d):o[u]=d}});const l=parseInt(window.siyuan.menus.menu.element.dataset.from);if(r)for(let c=window.siyuan.blockPanels.length-1;c>=0;c--){const d=window.siyuan.blockPanels[c],u=parseInt(d.element.getAttribute("data-level"));if((d.targetElement||typeof d.x=="number")&&u>(o[d.element.getAttribute("data-oid")]||0)&&d.element.getAttribute("data-pin")==="false"&&u>parseInt(r.getAttribute("data-level"))){if(l&&l>=u)break;if(d.editors.find(f=>{if(!f.protyle.toolbar.subElement.classList.contains("fn__none"))return!0}))break;d.destroy()}}else for(let c=window.siyuan.blockPanels.length-1;c>=0;c--){const d=window.siyuan.blockPanels[c],u=parseInt(d.element.getAttribute("data-level"));if((d.targetElement||typeof d.x=="number")&&d.element.getAttribute("data-pin")==="false"){if(l&&l>=u)break;if(d.targetElement&&d.targetElement.classList.contains("protyle-wysiwyg__embed")&&d.targetElement.contains(s))break;if(d.editors.find(f=>{if(!f.protyle.toolbar.subElement.classList.contains("fn__none"))return!0}))break;d.destroy()}}}},UL=(t,e)=>{var n,a;if(window.siyuan.config.editor.floatWindowMode===2||N(t.target,"history__repo",!0))return!1;if(Mn=ue(t.target,"data-type","block-ref")||ue(t.target,"data-type","virtual-block-ref"),Mn&&Mn.classList.contains("b3-tooltips")&&(Mn=void 0),Mn||(Mn=N(t.target,"popover__block")),!Mn&&e){if((n=e.getAttribute("data-href"))!=null&&n.startsWith("siyuan://blocks")&&e.getAttribute("prevent-popover")!=="true")Mn=e;else if(e.classList.contains("av__cell")){const i=e.querySelector(".av__celltext--url");i&&i.dataset.type==="url"&&((a=i.dataset.href)!=null&&a.startsWith("siyuan://blocks"))&&(Mn=i)}}if(!Mn||window.siyuan.altIsPressed||window.siyuan.config.editor.floatWindowMode===0&&window.siyuan.ctrlIsPressed||Mn&&Mn.getAttribute("prevent-popover")==="true")return!1;if(Mn&&getSelection().rangeCount>0){const i=getSelection().getRangeAt(0);if(i.toString()!==""&&Mn.contains(i.startContainer))return!1}return!0},tm=(t,e=!1)=>xV(void 0,null,function*(){var n,a;if(!Mn||window.siyuan.menus.menu.data&&window.siyuan.menus.menu.data===Mn)return;let i=[],s;const r=Mn.getAttribute("data-id");if(r)if(e){const l=yield wn("/api/block/getRefIDs",{id:r});i=l.data.refDefs,s=l.data.originalRefBlockIDs}else r.startsWith("[")?JSON.parse(r).forEach(l=>{i.push({refID:l})}):i=[{refID:r}];else if(((n=Mn.getAttribute("data-type"))==null?void 0:n.indexOf("virtual-block-ref"))>-1){const l=oe(Mn);l&&(i=(yield wn("/api/block/getBlockDefIDsByRefText",{anchor:Mn.textContent,excludeIDs:[l.getAttribute("data-node-id")]})).data.refDefs)}else if((a=Mn.getAttribute("data-type"))!=null&&a.split(" ").includes("a"))i=[{refID:rf(Mn.getAttribute("data-href"))}];else if(Mn.dataset.type==="url")i=[{refID:rf(Mn.textContent.trim())}];else if(Mn.dataset.popoverUrl)i=(yield wn(Mn.dataset.popoverUrl,{avID:Mn.dataset.avId})).data.refDefs;else{let l,c="/api/block/getRefIDs";if(Mn.classList.contains("protyle-attr--refcount"))l=Mn.parentElement.parentElement.getAttribute("data-node-id");else if(Mn.classList.contains("pdf__rect")){const d=Mn.getAttribute("data-relations");d?(d.split(",").forEach(u=>{i.push({refID:u})}),c=""):(l=Mn.getAttribute("data-node-id"),c="/api/block/getRefIDsByFileAnnotationID")}else l||(l=Mn.parentElement.getAttribute("data-node-id"));if(c){const d=yield wn(c,{id:l});i=d.data.refDefs,s=d.data.originalRefBlockIDs}}if(i.length===0)return;let o=!1;window.siyuan.blockPanels.find(l=>{if((l.targetElement||typeof l.x=="number")&&l.element.getAttribute("data-pin")==="true"&&JSON.stringify(i)===JSON.stringify(l.refDefs))return o=!0,!0}),!o&&Mn.parentElement&&Mn.parentElement.style.opacity!=="0.38"&&window.siyuan.blockPanels.push(new Vg({app:t,targetElement:Mn,isBacklink:e||Mn.classList.contains("protyle-attr--refcount")||Mn.classList.contains("counter"),refDefs:i,originalRefBlockIDs:s}))}),op=(t,e,n)=>{if(e==="general"){if(!window.siyuan.config.keymap[e])return window.siyuan.config.keymap[e]=t,!1}else{if(!window.siyuan.config.keymap[e])return window.siyuan.config.keymap[e]=JSON.parse(JSON.stringify(p.SIYUAN_KEYMAP.editor)),!1;if(!window.siyuan.config.keymap[e][n])return window.siyuan.config.keymap[e][n]=t,!1}let a=!0;return Object.keys(t).forEach(i=>{e==="general"?(!window.siyuan.config.keymap[e][i]||window.siyuan.config.keymap[e][i].default!==t[i].default)&&(a=!1,window.siyuan.config.keymap[e][i]=t[i]):(!window.siyuan.config.keymap[e][n][i]||window.siyuan.config.keymap[e][n][i].default!==t[i].default)&&(a=!1,window.siyuan.config.keymap[e][n][i]=t[i])}),a},lp=(t,e,n)=>{let a=!0;return e==="editor"?Object.keys(window.siyuan.config.keymap[e][n]).length!==Object.keys(p.SIYUAN_KEYMAP[e][n]).length&&Object.keys(window.siyuan.config.keymap[e][n]).forEach(i=>{p.SIYUAN_KEYMAP[e][n][i]||(a=!1,delete window.siyuan.config.keymap[e][n][i])}):Object.keys(window.siyuan.config.keymap[e]).length!==Object.keys(p.SIYUAN_KEYMAP[e]).length&&Object.keys(window.siyuan.config.keymap[e]).forEach(i=>{p.SIYUAN_KEYMAP[e][i]||(a=!1,delete window.siyuan.config.keymap[e][i])}),a},kV=t=>{const e=op(p.SIYUAN_KEYMAP.general,"general"),n=op(p.SIYUAN_KEYMAP.editor.general,"editor","general"),a=op(p.SIYUAN_KEYMAP.editor.insert,"editor","insert"),i=op(p.SIYUAN_KEYMAP.editor.heading,"editor","heading"),s=op(p.SIYUAN_KEYMAP.editor.list,"editor","list"),r=op(p.SIYUAN_KEYMAP.editor.table,"editor","table"),o=lp(p.SIYUAN_KEYMAP.general,"general"),l=lp(p.SIYUAN_KEYMAP.editor.general,"editor","general"),c=lp(p.SIYUAN_KEYMAP.editor.insert,"editor","insert"),d=lp(p.SIYUAN_KEYMAP.editor.heading,"editor","heading"),u=lp(p.SIYUAN_KEYMAP.editor.list,"editor","list"),g=lp(p.SIYUAN_KEYMAP.editor.table,"editor","table");!window.siyuan.config.readonly&&(!e||!n||!a||!i||!s||!r||!o||!l||!c||!d||!u||!g)&&ae("/api/setting/setKeymap",{data:window.siyuan.config.keymap},()=>{})},SV=(t,e)=>{if(document.getElementById("progress")||document.getElementById("errorLog")||t.isComposing)return!0;const n=t.target;if(t.isTrusted&&ct(t)&&!t.shiftKey&&!t.altKey&&!["INPUT","TEXTAREA"].includes(n.tagName)&&["0","1","2","3","4","j","k","l",";","s"," ","p","enter","a","s","d","f","q","x"].includes(t.key.toLowerCase())){let a;if(window.siyuan.dialogs.find(i=>{if(i.element.getAttribute("data-key")===p.DIALOG_OPENCARD)return a=i.element,!0}),a||(a=document.querySelector(`.layout__wnd--active div[data-key="${p.DIALOG_OPENCARD}"]:not(.fn__none)`)),a)return t.preventDefault(),a.firstElementChild.dispatchEvent(new CustomEvent("click",{detail:t.key.toLowerCase()})),!0}if(ct(t)&&t.key!=="Escape"&&!t.shiftKey&&!t.altKey&&p.KEYCODELIST[t.keyCode]!=="PageUp"&&p.KEYCODELIST[t.keyCode]!=="PageDown"&&t.key!=="Home"&&t.key!=="End"&&!/^F\d{1,2}$/.test(t.key)&&t.key.indexOf("Arrow")===-1&&t.key!=="Enter"&&t.key!=="Backspace"&&t.key!=="Delete")return!0;!t.altKey&&!t.shiftKey&&je(t)&&((Jt()?t.key==="Meta":t.key==="Control")||je(t)?(window.siyuan.ctrlIsPressed=!0,(t.key==="Meta"||t.key==="Control")&&window.siyuan.config.editor.floatWindowMode===1&&!t.repeat&&tm(e)):window.siyuan.ctrlIsPressed=!1),!t.altKey&&t.shiftKey&&ct(t)&&(t.key==="Shift"?(window.siyuan.shiftIsPressed=!0,t.repeat||tm(e,!0)):window.siyuan.shiftIsPressed=!1),t.altKey&&!t.shiftKey&&ct(t)&&(t.key==="Alt"?window.siyuan.altIsPressed=!0:window.siyuan.altIsPressed=!1)},HL=(t,e)=>{e.preventDefault();let n=e.target;for(;n!==Kr.element;){if(n.classList.contains("b3-list-item")){const a=n.getAttribute("data-type");if(a)a==="riffCard"?wf(t):Vn(a).toggleModel(a,!0);else{const i=n.getAttribute("data-id");So().find(s=>{if(s.id===i)return s.parent.switchTab(s.headElement),s.parent.showHeading(),!0})}Kr.destroy(),Kr=void 0;break}n=n.parentElement}},qL=(t,e,n)=>{let a=e.querySelector(".b3-list-item--focus");if(a){if(a.classList.remove("b3-list-item--focus"),n.key==="ArrowUp")a.previousElementSibling?a.previousElementSibling.classList.add("b3-list-item--focus"):a.parentElement.lastElementChild.classList.add("b3-list-item--focus");else if(n.key==="ArrowDown")a.nextElementSibling?a.nextElementSibling.classList.add("b3-list-item--focus"):a.parentElement.firstElementChild.classList.add("b3-list-item--focus");else if(n.key==="ArrowLeft"||n.key==="ArrowRight"){const l=a.parentElement.previousElementSibling||a.parentElement.nextElementSibling;if(l){const c=l.querySelector(`[data-index="${a.getAttribute("data-index")}"]`)||l.lastElementChild;c?c.classList.add("b3-list-item--focus"):a.classList.add("b3-list-item--focus")}else a.classList.add("b3-list-item--focus")}else if(n.key==="Enter"){const l=a.getAttribute("data-type");l?l==="riffCard"?wf(t):Vn(l).toggleModel(l,!0):dn({app:t,id:a.getAttribute("data-node-id"),action:[p.CB_GET_FOCUS,p.CB_GET_SCROLL]}),Ut(["dialog"]);return}a=e.querySelector(".b3-list-item--focus");const i=a.getAttribute("data-node-id"),s=e.querySelector(".switch-doc__path");i?ae("/api/filetree/getFullHPathByID",{id:i},l=>{s.innerHTML=he(l.data)}):s.innerHTML=a.querySelector(".b3-list-item__text").innerHTML;const r=a.getBoundingClientRect(),o=a.parentElement.getBoundingClientRect();r.top<o.top?a.scrollIntoView(!0):r.bottom>o.bottom&&a.scrollIntoView(!1)}},AV=(t,e)=>{var n,a;let i,s;getSelection().rangeCount>0&&(s=getSelection().getRangeAt(0));const r=document.querySelector(".layout__tab--active");let o=!1;r&&r.classList.contains("sy__file")&&(o=!0),s&&window.siyuan.dialogs.find(d=>{if(d.editors&&(Object.keys(d.editors).find(u=>{if(d.editors[u].protyle.element.contains(s.startContainer))return i=d.editors[u].protyle,o=!1,!0}),i))return!0});const l=ir();if(!i&&l){if(l.model instanceof Ma?i=l.model.editor.protyle:l.model instanceof Ll?l.model.element.querySelector("#searchUnRefPanel").classList.contains("fn__none")?i=l.model.editors.edit.protyle:i=l.model.editors.unRefEdit.protyle:l.model instanceof ko&&((n=l.model.editors)==null?void 0:n.length)>0&&s&&l.model.editors.find(d=>{if(d.protyle.element.contains(s.startContainer))return i=d.protyle,!0}),!i)return}else if(!i){!i&&s&&window.siyuan.blockPanels.find(u=>{if(u.editors.find(g=>{if(g.protyle.element.contains(s.startContainer))return i=g.protyle,!0}),i)return!0});const d=Cn();if(i||d.backlink.find(u=>{if(u.element.classList.contains("layout__tab--active"))return s&&u.editors.find(g=>{if(g.protyle.element.contains(s.startContainer))return i=g.protyle,!0}),!i&&u.editors.length>0&&(i=u.editors[0].protyle),!0}),i||d.editor.find(u=>{if(u.parent.headElement.classList.contains("item--focus"))return i=u.editor.protyle,!0}),!i)return!1}if(!o&&Qe(window.siyuan.config.keymap.general.replace.custom,e))return Mi({command:"replace",app:t,protyle:i,previousRange:s}),e.preventDefault(),!0;if(!o&&Qe(window.siyuan.config.keymap.general.search.custom,e))return Mi({command:"search",app:t,protyle:i,previousRange:s}),e.preventDefault(),!0;if(!o&&Qe(window.siyuan.config.keymap.editor.general.quickMakeCard.custom,e)&&!window.siyuan.config.readonly){if((a=i.title)!=null&&a.editElement.contains(s.startContainer))Mh(i,[i.title.element]);else{const d=[];if(i.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select").forEach(u=>{d.push(u)}),d.length===0){const u=oe(s.startContainer);u&&d.push(u)}Mh(i,d)}return e.preventDefault(),!0}if(!o&&Qe(window.siyuan.config.keymap.general.addToDatabase.custom,e))return Mi({command:"addToDatabase",app:t,protyle:i,previousRange:s}),e.preventDefault(),!0;if(!o&&Qe(window.siyuan.config.keymap.editor.general.spaceRepetition.custom,e)&&!window.siyuan.config.readonly)return ae("/api/riff/getTreeRiffDueCards",{rootID:i.block.rootID},d=>{var u;Sd(t,d.data,"doc",i.block.rootID,((u=i.title)==null?void 0:u.editElement.textContent)||window.siyuan.languages.untitled)}),e.preventDefault(),!0;if(!o&&Qe(window.siyuan.config.keymap.general.move.custom,e))return Mi({command:"move",app:t,protyle:i,previousRange:s}),e.preventDefault(),!0;if(!o&&!e.repeat&&!i.disabled&&Qe(window.siyuan.config.keymap.editor.general.duplicate.custom,e)){e.preventDefault(),e.stopPropagation();let d=Array.from(i.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));if(d.length===0){const u=oe(s.startContainer);u&&(d=[u])}return n_(d,i),!0}const c=e.target;if(c.tagName!=="TABLE"&&["INPUT","TEXTAREA"].includes(c.tagName))return!1;if(!e.altKey&&!e.shiftKey&&je(e)&&e.key==="Home"){Uv(i),Ut(["select"],i),e.stopPropagation(),e.preventDefault();return}if(!e.altKey&&!e.shiftKey&&je(e)&&e.key==="End"){yS(i),Ut(["select"],i),e.stopPropagation(),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.editor.general.exitFocus.custom,e))return e.preventDefault(),hi({protyle:i,id:i.block.rootID,focusId:i.block.id}),!0;if(Qe(window.siyuan.config.keymap.editor.general.switchReadonly.custom,e))return e.preventDefault(),Zg({protyle:i,command:"switchReadonly",previousRange:s}),!0;if(Qe(window.siyuan.config.keymap.editor.general.switchAdjust.custom,e))return e.preventDefault(),Zg({protyle:i,command:"switchAdjust",previousRange:s}),!0;if(Qe(window.siyuan.config.keymap.editor.general.backlinks.custom,e)){if(e.preventDefault(),s){const d=ue(s.startContainer,"data-type","block-ref");if(d)return Jh({app:i.app,blockId:d.dataset.id}),!0}return Jh({app:i.app,blockId:i.block.id,rootId:i.block.rootID,useBlockId:i.block.showAll,title:i.title?i.title.editElement.textContent||window.siyuan.languages.untitled:null}),!0}if(Qe(window.siyuan.config.keymap.editor.general.outline.custom,e)){e.preventDefault();const d=ya(c);return wx({app:t,rootId:i.block.rootID,title:i.options.render.title?i.title.editElement.textContent||window.siyuan.languages.untitled:"",isPreview:!i.preview.element.classList.contains("fn__none")}),nr(c,d.start,d.end),!0}if(Qe(window.siyuan.config.keymap.editor.general.copyPlainText.custom,e)){const d=oe(s.startContainer);if(!d)return!1;if(s.toString()===""){const u=Array.from(i.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select"));let g="";u.length===0&&u.push(d),u.forEach(f=>{g+=kh(f)+`
`}),kt(g.trimEnd())}else kt(s.toString());return e.preventDefault(),!0}if(Qe(window.siyuan.config.keymap.editor.general.duplicateCompletely.custom,e)){const d=oe(s.startContainer);return!d||!d.classList.contains("av")?!1:(qS(i,d),e.preventDefault(),!0)}if(Qe(window.siyuan.config.keymap.editor.general.refresh.custom,e))return $o(i,!0),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.editor.general.fullscreen.custom,e))return kd(i.element),Ai(i),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.editor.general.preview.custom,e))return Hd(i,"preview"),Fi(),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.editor.general.wysiwyg.custom,e)&&!i.options.backlinkData)return Hd(i,"wysiwyg"),i.scroll.lastScrollTop=0,ae("/api/filetree/getDoc",{id:i.block.id,size:i.block.id===i.block.rootID?window.siyuan.config.editor.dynamicLoadBlocks:p.SIZE_GET_MAX},d=>{_a({data:d,protyle:i,action:i.block.id===i.block.rootID?[p.CB_GET_FOCUS,p.CB_GET_HTML,p.CB_GET_UNUNDO]:[p.CB_GET_ALL,p.CB_GET_FOCUS,p.CB_GET_UNUNDO,p.CB_GET_HTML]})}),Fi(),e.preventDefault(),!0;if(s&&!o&&Qe(window.siyuan.config.keymap.editor.general.copyBlockRef.custom,e)){if(e.preventDefault(),e.stopPropagation(),N(s.startContainer,"protyle-title"))Ja([i.block.rootID],"ref");else{const d=oe(s.startContainer);if(!d)return!1;const u=d.querySelector(".img--select");if(u)return wd(u.querySelector("img").getAttribute("src")),!0;const g=Array.from(i.wysiwyg.element.querySelectorAll(".protyle-wysiwyg--select")).map(f=>f.getAttribute("data-node-id"));if(g.length>0)return Ja(g,"ref"),!0;s.toString()!==""?OE(s,f=>{ut(`((${d.getAttribute("data-node-id")} "${f.trim()}"))`)}):Ja([d.getAttribute("data-node-id")],"ref")}return!0}return N(c,"protyle-title__input")?!1:Qe(window.siyuan.config.keymap.editor.general.undo.custom,e)?(i.undo.undo(i),e.preventDefault(),!0):Qe(window.siyuan.config.keymap.editor.general.redo.custom,e)?(i.undo.redo(i),e.preventDefault(),!0):!1},TV=(t,e)=>{var n,a;const i=Vn("file");if(!i)return!1;const s=i.data.file;if(typeof i.data.file=="boolean")return!0;if(Qe(window.siyuan.config.keymap.general.selectOpen1.custom,e)){e.preventDefault(),Do("selectOpen1",t);return}if(!s.element.parentElement.classList.contains("layout__tab--active"))return!1;let r=!1;if(t.plugins.find(h=>{if(h.commands.find(m=>{if(m.fileTreeCallback&&Qe(m.customHotkey,e))return r=!0,m.fileTreeCallback(s),!0}),r)return!0}),r)return!0;const o=Array.from(s.element.querySelectorAll(".b3-list-item--focus"));if(o.length===0){if(e.key.startsWith("Arrow")&&ct(e)){const h=s.element.querySelector(".b3-list-item");h&&(h.classList.add("b3-list-item--focus"),s.lastSelectedElement=h),e.preventDefault()}return!1}const l=pe(o[0],"UL");if(!l)return!1;const c=l.getAttribute("data-url"),d=o[0].getAttribute("data-path"),u=o[0].getAttribute("data-type")==="navigation-file",g=[];if(o.forEach(h=>{h.getAttribute("data-type")==="navigation-file"&&g.push(h.getAttribute("data-node-id"))}),Qe(window.siyuan.config.keymap.editor.general.spaceRepetition.custom,e)&&!window.siyuan.config.readonly){if(u){const h=o[0].getAttribute("data-node-id");ae("/api/riff/getTreeRiffDueCards",{rootID:h},m=>{Sd(t,m.data,"doc",h,ha(o[0].getAttribute("data-name"),!1,!0))})}else ae("/api/riff/getNotebookRiffDueCards",{notebook:c},h=>{Sd(t,h.data,"notebook",c,Ds(c))});return e.preventDefault(),!0}if(Qe(window.siyuan.config.keymap.editor.general.quickMakeCard.custom,e))return g.length>0&&et(void 0,[{action:"addFlashcards",deckID:p.QUICK_DECK_ID,blockIDs:g}],[{action:"removeFlashcards",deckID:p.QUICK_DECK_ID,blockIDs:g}]),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.general.addToDatabase.custom,e))return Mi({command:"addToDatabase",app:t,fileLiElements:o}),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.editor.general.rename.custom,e))return window.siyuan.menus.menu.remove(),bf({notebookId:c,path:d,name:u?ha(o[0].getAttribute("data-name"),!1,!0):Ds(c),type:u?"file":"notebook"}),e.preventDefault(),!0;if(Qe("\u2318/",e)){const h=o[0].getBoundingClientRect();return u?Vy(t,c,d,o[0]).popup({x:h.right-15,y:h.top+15}):Wy(t,o[0]).popup({x:h.right-15,y:h.top+15}),!0}if(!e.repeat&&Qe(window.siyuan.config.keymap.editor.general.duplicate.custom,e))return e.preventDefault(),e.stopPropagation(),g.forEach(h=>{ae("/api/filetree/duplicateDoc",{id:h})}),!0;if(!e.repeat&&Qe(window.siyuan.config.keymap.editor.general.copyBlockRef.custom,e))return e.preventDefault(),e.stopPropagation(),Ja(g,"ref"),!0;if(!e.repeat&&Qe(window.siyuan.config.keymap.editor.general.copyBlockEmbed.custom,e))return e.preventDefault(),e.stopPropagation(),Ja(g,"blockEmbed"),!0;if(!e.repeat&&Qe(window.siyuan.config.keymap.editor.general.copyProtocol.custom,e))return e.preventDefault(),e.stopPropagation(),Ja(g,"protocol"),!0;if(!e.repeat&&Qe(window.siyuan.config.keymap.editor.general.copyProtocolInMd.custom,e))return e.preventDefault(),e.stopPropagation(),Ja(g,"protocolMd"),!0;if(!e.repeat&&Qe(window.siyuan.config.keymap.editor.general.copyHPath.custom,e))return e.preventDefault(),e.stopPropagation(),Ja(g,"hPath"),!0;if(!e.repeat&&Qe(window.siyuan.config.keymap.editor.general.copyID.custom,e))return e.preventDefault(),e.stopPropagation(),Ja(g,"id"),!0;if(u&&Qe(window.siyuan.config.keymap.general.move.custom,e))return window.siyuan.menus.menu.remove(),Mi({command:"move",app:t,fileLiElements:o}),e.preventDefault(),!0;if(u&&Qe(window.siyuan.config.keymap.editor.general.insertRight.custom,e))return window.siyuan.menus.menu.remove(),dn({app:t,id:o[0].getAttribute("data-node-id"),action:[p.CB_GET_FOCUS],position:"right"}),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.general.replace.custom,e))return window.siyuan.menus.menu.remove(),Mi({command:"replace",app:t,fileLiElements:o}),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.general.search.custom,e))return window.siyuan.menus.menu.remove(),Mi({command:"search",app:t,fileLiElements:o}),e.preventDefault(),!0;const f=e.target;if(["INPUT","TEXTAREA"].includes(f.tagName)||ue(f,"contenteditable",null)||N(f,"protyle",!0))return!1;if(e.shiftKey){if(e.key==="ArrowUp"){const h=t_(o);let m;if(h.startElement.getBoundingClientRect().top>=h.endElement.getBoundingClientRect().top?(m=Qn(h.endElement),m&&(m.classList.add("b3-list-item--focus"),m.setAttribute("select-end","true"),h.endElement.removeAttribute("select-end"))):(h.endElement.classList.remove("b3-list-item--focus"),h.endElement.removeAttribute("select-end"),m=Qn(h.endElement),m&&m.setAttribute("select-end","true")),m){const b=m.getBoundingClientRect(),y=s.element.getBoundingClientRect();(b.top<y.top||b.bottom>y.bottom)&&m.scrollIntoView(b.top<y.top)}}else if(e.key==="ArrowDown"){const h=t_(o);let m;if(h.startElement.getBoundingClientRect().top<=h.endElement.getBoundingClientRect().top?(m=mn(h.endElement),m&&(m.classList.add("b3-list-item--focus"),m.setAttribute("select-end","true"),h.endElement.removeAttribute("select-end"))):(h.endElement.classList.remove("b3-list-item--focus"),h.endElement.removeAttribute("select-end"),m=mn(h.endElement),m&&m.setAttribute("select-end","true")),m){const b=m.getBoundingClientRect(),y=s.element.getBoundingClientRect();(b.top<y.top||b.bottom>y.bottom)&&m.scrollIntoView(b.top<y.top)}}return}else if(ct(e)){if((n=s.element.querySelector('[select-end="true"]'))==null||n.removeAttribute("select-end"),(a=s.element.querySelector('[select-start="true"]'))==null||a.removeAttribute("select-start"),e.key==="ArrowRight"&&!o[0].querySelector(".b3-list-item__arrow--open")&&!o[0].querySelector(".b3-list-item__toggle").classList.contains("fn__hidden")||e.key==="ArrowLeft"&&o[0].querySelector(".b3-list-item__arrow--open"))return s.getLeaf(o[0],c),o.forEach((h,m)=>{m!==0&&h.classList.remove("b3-list-item--focus")}),e.preventDefault(),!0;if(e.key==="ArrowLeft"){let h=o[0].parentElement.previousElementSibling;if(h){h.tagName!=="LI"&&(h=s.element.querySelector(".b3-list-item")),o.forEach(y=>{y.classList.remove("b3-list-item--focus")}),h.classList.add("b3-list-item--focus"),s.lastSelectedElement=h;const m=h.getBoundingClientRect(),b=s.element.getBoundingClientRect();(m.top<b.top||m.bottom>b.bottom)&&h.scrollIntoView(m.top<b.top)}return e.preventDefault(),!0}if(e.key==="ArrowDown"||e.key==="ArrowRight"){let h=o[0];for(;h;)if(h.nextElementSibling){h.nextElementSibling.tagName==="UL"?h=h.nextElementSibling.firstElementChild:h=h.nextElementSibling;break}else{if(h.parentElement.classList.contains("fn__flex-1"))break;h=h.parentElement}if(h.classList.contains("b3-list-item")){o.forEach(y=>{y.classList.remove("b3-list-item--focus")}),h.classList.add("b3-list-item--focus"),s.lastSelectedElement=h;const m=h.getBoundingClientRect(),b=s.element.getBoundingClientRect();(m.top<b.top||m.bottom>b.bottom)&&h.scrollIntoView(m.top<b.top)}return e.preventDefault(),!0}if(e.key==="ArrowUp"){let h=o[0];for(;h;)if(h.previousElementSibling){if(h.previousElementSibling.tagName==="LI")h=h.previousElementSibling;else{const m=h.previousElementSibling.querySelectorAll(".b3-list-item");h=m[m.length-1]}break}else{if(h.parentElement.classList.contains("fn__flex-1"))break;h=h.parentElement}if(h.classList.contains("b3-list-item")){o.forEach(y=>{y.classList.remove("b3-list-item--focus")}),h.classList.add("b3-list-item--focus"),s.lastSelectedElement=h;const m=h.getBoundingClientRect(),b=s.element.getBoundingClientRect();(m.top<b.top||m.bottom>b.bottom)&&h.scrollIntoView(m.top<b.top)}return e.preventDefault(),!0}}if(e.key==="Delete"||e.key==="Backspace"&&Jt())return window.siyuan.menus.menu.remove(),document.querySelector(`.b3-dialog--open[data-key="${p.DIALOG_CONFIRM}"]`)?void 0:(Ly(o),!0);if(e.key==="Enter")return window.siyuan.menus.menu.remove(),o.forEach(h=>{if(h.getAttribute("data-type")==="navigation-file")dn({app:t,id:h.getAttribute("data-node-id"),action:[p.CB_GET_FOCUS]});else{const m=pe(h,"UL");m&&s.getLeaf(h,m.getAttribute("data-url"))}}),!0},DV=(t,e)=>{var n;const a=e.target;if(["INPUT","TEXTAREA"].includes(a.tagName)||ue(a,"contenteditable",null)||N(a,"protyle",!0))return!1;let i=document.querySelector(".layout__tab--active");if(i||Array.from(document.querySelectorAll(".layout__wnd--active .layout-tab-container > div")).find(u=>{if(!u.classList.contains("fn__none")&&u.className.indexOf("sy__")>-1)return i=u,!0}),!i||i.className.indexOf("sy__")===-1)return!1;let s=!1;if(t.plugins.find(u=>{if(u.commands.find(g=>{if(g.dockCallback&&Qe(g.customHotkey,e))return s=!0,g.dockCallback(i),!0}),s)return!0}),s)return!0;if(!Qe(window.siyuan.config.keymap.editor.general.collapse.custom,e)&&!Qe(window.siyuan.config.keymap.editor.general.expand.custom,e)&&!e.key.startsWith("Arrow")&&e.key!=="Enter")return!1;if(!e.repeat&&Qe(window.siyuan.config.keymap.editor.general.collapse.custom,e)){const u=i.querySelector('.block__icon[data-type="collapse"]');if(u)return u.dispatchEvent(new CustomEvent("click")),e.preventDefault(),!0}if(!e.repeat&&Qe(window.siyuan.config.keymap.editor.general.expand.custom,e)){const u=i.querySelector('.block__icon[data-type="expand"]');if(u)return u.dispatchEvent(new CustomEvent("click")),e.preventDefault(),!0}if(i.classList.contains("sy__inbox")||i.classList.contains("sy__globalGraph")||i.classList.contains("sy__graph"))return!1;const r=(n=mi(i.getAttribute("data-id"),window.siyuan.layout.layout))==null?void 0:n.model;if(!r)return!1;let o=i.querySelector(".b3-list-item--focus");if(!o)return o=i.querySelector(".b3-list .b3-list-item"),o&&o.classList.add("b3-list-item--focus"),!1;let l=r.tree;if(o.parentElement.parentElement.classList.contains("backlinkMList")&&(l=r.mTree),!l)return!1;if(e.key==="Enter")return l.click(o),e.preventDefault(),!0;const c=o.querySelector(".b3-list-item__arrow");if(e.key==="ArrowRight"&&!c.classList.contains("b3-list-item__arrow--open")&&!c.parentElement.classList.contains("fn__hidden")||e.key==="ArrowLeft"&&c.classList.contains("b3-list-item__arrow--open")&&!c.parentElement.classList.contains("fn__hidden"))return l.toggleBlocks(o),e.preventDefault(),!0;const d=N(o,"b3-list");if(!d)return!1;if(e.key==="ArrowLeft"){let u=o.parentElement.previousElementSibling;if(u){u.tagName!=="LI"&&(u=d.querySelector(".b3-list-item")),o.classList.remove("b3-list-item--focus"),u.classList.add("b3-list-item--focus");const g=u.getBoundingClientRect(),f=d.parentElement.getBoundingClientRect();(g.top<f.top||g.bottom>f.bottom)&&u.scrollIntoView(g.top<f.top)}return e.preventDefault(),!0}if(e.key==="ArrowDown"||e.key==="ArrowRight"){let u=o;for(;u;)if(u.nextElementSibling){u.nextElementSibling.tagName==="UL"?u.nextElementSibling.classList.contains("fn__none")?u.nextElementSibling.nextElementSibling&&(u=u.nextElementSibling.nextElementSibling):u=u.nextElementSibling.firstElementChild:u.nextElementSibling.classList.contains("protyle")?u.nextElementSibling.nextElementSibling&&(u=u.nextElementSibling.nextElementSibling):u=u.nextElementSibling;break}else{if(u.parentElement.classList.contains("fn__flex-1"))break;u=u.parentElement}if(u.classList.contains("b3-list-item")&&!u.classList.contains("b3-list-item--focus")){o.classList.remove("b3-list-item--focus"),u.classList.add("b3-list-item--focus");const g=u.getBoundingClientRect(),f=d.parentElement.getBoundingClientRect();(g.top<f.top||g.bottom>f.bottom)&&u.scrollIntoView(g.top<f.top)}return e.preventDefault(),!0}if(e.key==="ArrowUp"){let u=o;for(;u;)if(u.previousElementSibling){if(u.previousElementSibling.tagName==="LI")u=u.previousElementSibling;else if(u.previousElementSibling.classList.contains("protyle"))u.previousElementSibling.previousElementSibling&&(u=u.previousElementSibling.previousElementSibling);else if(u.previousElementSibling.tagName==="UL"&&u.previousElementSibling.classList.contains("fn__none"))u.previousElementSibling.previousElementSibling&&(u=u.previousElementSibling.previousElementSibling);else{const g=u.previousElementSibling.querySelectorAll(".b3-list-item");u=g[g.length-1]}break}else{if(u.parentElement.classList.contains("fn__flex-1"))break;u=u.parentElement}if(u.classList.contains("b3-list-item")&&!u.classList.contains("b3-list-item--focus")){o.classList.remove("b3-list-item--focus"),u.classList.add("b3-list-item--focus");const g=u.getBoundingClientRect(),f=d.parentElement.getBoundingClientRect();(g.top<f.top||g.bottom>f.bottom)&&u.scrollIntoView(g.top<f.top)}return e.preventDefault(),!0}return!1};let Kr;const CV=(t,e)=>{if(SV(e,t))return;if(Kr&&(fd(window.siyuan.config.keymap.general.goToEditTabNext.custom,e)||fd(window.siyuan.config.keymap.general.goToEditTabPrev.custom,e))&&e.key.startsWith("Arrow")){qL(t,Kr.element,e);return}if(mV(t,e)){e.preventDefault(),e.stopPropagation();return}const n=E();if(Qe(window.siyuan.config.keymap.general.goToEditTabNext.custom,e)||Qe(window.siyuan.config.keymap.general.goToEditTabPrev.custom,e)){if(Kr&&Kr.element.parentElement)return;let o="",l=document.querySelector(".layout__wnd--active ul.layout-tab-bar > .item--focus");if(l||(l=document.querySelector("ul.layout-tab-bar > .item--focus")),l){const d=l.getAttribute("data-id");So().sort((u,g)=>u.headElement.getAttribute("data-activetime")>g.headElement.getAttribute("data-activetime")?-1:1).forEach((u,g)=>{let f=`<svg class="b3-list-item__graphic"><use xlink:href="#${u.icon}"></use></svg>`,h="";const m=u.headElement.getAttribute("data-initdata");if(u.model instanceof Ma)h=` data-node-id="${u.model.editor.protyle.block.rootID}"`,f=Yt(u.docIcon||window.siyuan.storage[p.LOCAL_IMAGES].file,"b3-list-item__graphic",!0);else if(m){const b=JSON.parse(m);b.instance==="Editor"&&(h=` data-node-id="${b.rootId}"`,f=Yt(u.docIcon||window.siyuan.storage[p.LOCAL_IMAGES].file,"b3-list-item__graphic",!0))}o+=`<li data-index="${g}" data-id="${u.id}"${h} class="b3-list-item${d===u.id?" b3-list-item--focus":""}"${d===u.id?' data-original="true"':""}>${f}<span class="b3-list-item__text">${he(u.title)}</span></li>`})}let c="";n||(c=`<ul class="b3-list b3-list--background" style="overflow: auto;width: 200px;">
<li data-type="riffCard" data-index="0" class="b3-list-item${o?"":" b3-list-item--focus"}">
    <svg class="b3-list-item__graphic"><use xlink:href="#iconRiffCard"></use></svg>
    <span class="b3-list-item__text">${window.siyuan.languages.riffCard}</span>
    <span class="b3-list-item__meta">${Mt(window.siyuan.config.keymap.general.riffCard.custom)}</span>
</li>`,uw().forEach((d,u)=>{c+=`<li data-type="${d.type}" data-index="${u+1}" class="b3-list-item">
    <svg class="b3-list-item__graphic"><use xlink:href="#${d.icon}"></use></svg>
    <span class="b3-list-item__text">${d.title}</span>
    <span class="b3-list-item__meta">${Mt(d.hotkey||"")}</span>
</li>`}),c=c+"</ul>"),Ut(["dialog"]),Kr=new fe({positionId:p.DIALOG_SWITCHTAB,title:window.siyuan.languages.switchTab,content:`<div class="fn__flex-column switch-doc">
    <input style="opacity: 0;height: 0.1px;box-sizing: border-box;margin: 0;padding: 0;border: 0;">
    <div class="fn__flex" style="overflow:auto;">${c}
        <ul${n?' style="border-left:0"':""} class="b3-list b3-list--background fn__flex-1">${o}</ul>
    </div>
    <div class="switch-doc__path"></div>
</div>`}),Kr.element.setAttribute("data-key",p.DIALOG_SWITCHTAB),Kr.element.querySelector("input").focus(),Jt()&&Kr.element.addEventListener("contextmenu",d=>{HL(t,d)}),Kr.element.addEventListener("click",d=>{HL(t,d)});return}if(ct(e)&&!e.shiftKey&&!e.altKey&&(e.key.startsWith("Arrow")||e.key==="Enter")){const o=window.siyuan.dialogs.find(l=>{if(l.element.getAttribute("data-key")===p.DIALOG_RECENTDOCS)return!0});if(o){e.preventDefault(),qL(t,o.element,e);return}}if(Qe(window.siyuan.config.keymap.general.recentDocs.custom,e)){vw(),e.preventDefault();return}if(hv(e)){e.preventDefault();return}if(PW(e)){e.preventDefault();return}if(["Home","End","ArrowUp","ArrowDown"].includes(e.key)){let o;if(window.siyuan.dialogs.forEach(l=>{[p.DIALOG_VIEWCARDS,p.DIALOG_HISTORYCOMPARE].includes(l.element.getAttribute("data-key"))&&(o=l)}),o){o.element.getAttribute("data-key")===p.DIALOG_VIEWCARDS?o.element.dispatchEvent(new CustomEvent("click",{detail:e.key.toLowerCase()})):o.element.getAttribute("data-key")===p.DIALOG_HISTORYCOMPARE&&bV(e,o),e.preventDefault();return}}const a=e.target;if(!n&&Qe(window.siyuan.config.keymap.general.syncNow.custom,e)){e.preventDefault(),kw(t);return}if(Qe(window.siyuan.config.keymap.general.commandPanel.custom,e)){e.preventDefault(),$L(t);return}if(Qe(window.siyuan.config.keymap.general.editReadonly.custom,e)){e.preventDefault(),zE(!window.siyuan.config.editor.readOnly);return}if(Qe(window.siyuan.config.keymap.general.lockScreen.custom,e)){pw(t),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.dataHistory.custom,e)){Xy(t),e.preventDefault();return}if(!n&&Qe(window.siyuan.config.keymap.general.toggleDock.custom,e)){xx(document.querySelector("#barDock use")),e.preventDefault();return}if(!n&&!window.siyuan.config.readonly&&Qe(window.siyuan.config.keymap.general.config.custom,e)){Dc(t),e.preventDefault();return}if(Qe("\u2318A",e)&&!["INPUT","TEXTAREA"].includes(a.tagName)){e.preventDefault();return}if(uw().find(o=>{if(Qe(o.hotkey,e))return Vn(o.type).toggleModel(o.type),e.preventDefault(),!0}))return;if(!n&&Qe(window.siyuan.config.keymap.general.riffCard.custom,e)){wf(t),document.activeElement&&document.activeElement.blur(),e.preventDefault();return}if(!n&&Qe(window.siyuan.config.keymap.general.dailyNote.custom,e)){xv(t),e.stopPropagation(),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.newFile.custom,e)){Oo({app:t,useSavePath:!0}),e.preventDefault();return}const s=document.querySelector('.b3-dialog--open[data-key="dialog-confirm"]');if(s){if(e.key==="Enter"){s.dispatchEvent(new CustomEvent("click",{detail:e.key})),e.preventDefault();return}else if(e.key==="Escape"){s.dispatchEvent(new CustomEvent("click",{detail:e.key})),e.preventDefault();return}}if(e.key==="Escape"&&!e.isComposing){kA();const o=document.querySelector(".protyle-img");if(o){o.remove();return}if(!window.siyuan.menus.menu.element.classList.contains("fn__none")&&!(window.siyuan.dialogs.length>0&&window.siyuan.menus.menu.element.style.zIndex<window.siyuan.dialogs[0].element.querySelector(".b3-dialog").style.zIndex)){window.siyuan.menus.menu.remove(!0);return}const l=document.querySelector(".av__panel");if(l){const g=document.querySelector(".av__cell--select");g&&qt(oe(g)),l.remove();return}if(e.repeat&&document.activeElement&&N(document.activeElement,"card__action"))return;if(window.siyuan.dialogs.length>0){window.siyuan.dialogs[window.siyuan.dialogs.length-1].destroy();return}const c={oid:0};window.siyuan.blockPanels.forEach(g=>{if((g.targetElement||typeof g.x=="number")&&g.element.getAttribute("data-pin")==="true"){const f=parseInt(g.element.getAttribute("data-level")),h=g.element.getAttribute("data-oid");c[h]?f>c[h]&&(c[h]=f):c[h]=1}});let d=!1;for(let g=0;g<window.siyuan.blockPanels.length;g++){const f=window.siyuan.blockPanels[g];(f.targetElement||typeof f.x=="number")&&f.element.getAttribute("data-pin")==="false"&&(f.destroy(),d=!0,g--)}if(d)return;if(getSelection().rangeCount>0){const g=getSelection().getRangeAt(0);if(N(g.startContainer,"protyle-content",!0)){Pt(g);return}}const u=window.siyuan.backStack[window.siyuan.backStack.length-1];if(u&&u.protyle.toolbar.range)Pt(u.protyle.toolbar.range);else{const g=Cn().editor[0];g&&qt(g.editor.protyle.wysiwyg.element.firstElementChild)}e.preventDefault();return}if(!n&&Qe(window.siyuan.config.keymap.general.mainMenu.custom,e)){jE(t,document.querySelector("#barWorkspace").getBoundingClientRect()),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.goForward.custom,e)){b_(t),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.goBack.custom,e)){m_(t),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.closeTab.custom,e)&&!e.repeat){Mi({command:"closeTab"}),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.recentClosed.custom,e)){Mi({command:"recentClosed",app:t}),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.goToTab1.custom,e)&&!e.repeat){ui(0),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.goToTab2.custom,e)&&!e.repeat){ui(1),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.goToTab3.custom,e)&&!e.repeat){ui(2),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.goToTab4.custom,e)&&!e.repeat){ui(3),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.goToTab5.custom,e)&&!e.repeat){ui(4),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.goToTab6.custom,e)&&!e.repeat){ui(5),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.goToTab7.custom,e)&&!e.repeat){ui(6),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.goToTab8.custom,e)&&!e.repeat){ui(7),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.goToTab9.custom,e)&&!e.repeat){ui(-1),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.goToTabNext.custom,e)&&!e.repeat){ui(-3),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.goToTabPrev.custom,e)&&!e.repeat){ui(-2),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.closeOthers.custom,e)&&!e.repeat){Mi({command:"closeOthers"}),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.closeAll.custom,e)&&!e.repeat){Mi({command:"closeAll"}),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.closeUnmodified.custom,e)&&!e.repeat){Mi({command:"closeUnmodified"}),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.closeLeft.custom,e)&&!e.repeat){Mi({command:"closeLeft"}),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.closeRight.custom,e)&&!e.repeat){Mi({command:"closeRight"}),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.splitLR.custom,e)&&!e.repeat){e.preventDefault(),Do("splitLR",t);return}if(Qe(window.siyuan.config.keymap.general.splitMoveR.custom,e)&&!e.repeat){e.preventDefault(),Do("splitMoveR",t);return}if(Qe(window.siyuan.config.keymap.general.splitTB.custom,e)&&!e.repeat){e.preventDefault(),Do("splitTB",t);return}if(Qe(window.siyuan.config.keymap.general.tabToWindow.custom,e)&&!e.repeat){e.preventDefault(),Do("tabToWindow",t);return}if(Qe(window.siyuan.config.keymap.general.splitMoveB.custom,e)&&!e.repeat){e.preventDefault(),Do("splitMoveB",t);return}if(Qe(window.siyuan.config.keymap.general.stickSearch.custom,e)){Do("stickSearch",t),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.unsplit.custom,e)&&!e.repeat){e.preventDefault(),Do("unsplit",t);return}if(Qe(window.siyuan.config.keymap.general.unsplitAll.custom,e)&&!e.repeat){e.preventDefault(),Do("unsplitAll",t);return}if(AV(t,e)||!n&&TV(t,e)||!n&&DV(t,e))return;let r=!1;if(t.plugins.find(o=>{if(o.commands.find(l=>{if(l.callback&&!l.fileTreeCallback&&!l.editorCallback&&!l.dockCallback&&!l.globalCallback&&Qe(l.customHotkey,e))return r=!0,l.callback(),!0}),r)return!0}),r)return e.stopPropagation(),e.preventDefault(),!0;if(Qe(window.siyuan.config.keymap.general.replace.custom,e)){Mi({command:"replace",app:t}),e.preventDefault();return}if(Qe(window.siyuan.config.keymap.general.globalSearch.custom,e)){Mi({command:"globalSearch",app:t}),e.preventDefault();return}if(!N(a,"pdf__outer")&&Qe(window.siyuan.config.keymap.general.search.custom,e)){Mi({command:"search",app:t}),e.preventDefault();return}if(Qe("\u2318S",e))return e.preventDefault(),!0},WL=t=>{},sY=t=>{},wa={element:void 0,_genItem(t,e){let n="";return Object.keys(t).forEach(a=>{if(window.siyuan.languages[a]){const i=Mt(t[a].custom);let s=window.siyuan.languages[a];"editor"+p.ZWSP+"general"===e&&a==="duplicate"&&(s=`${window.siyuan.languages.duplicate} / ${window.siyuan.languages.duplicateMirror}`),n+=`<label class="b3-list-item b3-list-item--narrow b3-list-item--hide-action">
    <span class="b3-list-item__text">${s}</span>
    <span data-type="reset" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.reset}">
        <svg><use xlink:href="#iconUndo"></use></svg>
    </span>
    <span data-type="clear" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.remove}">
        <svg><use xlink:href="#iconTrashcan"></use></svg>
    </span>
    <span data-type="update" class="config-keymap__key">${i}</span>
    <input data-key="${e+p.ZWSP+a}" data-value="${t[a].custom}" data-default="${t[a].default}" class="b3-text-field fn__none" value="${i}" spellcheck="false">
</label>`}}),n},genHTML(t){let e="";return t.plugins.forEach(n=>{let a="";n.commands.forEach(i=>{const s=Mt(i.customHotkey);a+=`<label class="b3-list-item b3-list-item--narrow b3-list-item--hide-action">
    <span class="b3-list-item__text">${i.langText||(n.i18n?n.i18n[i.langKey]:"")||i.langKey}</span>
    <span data-type="reset" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.reset}">
        <svg><use xlink:href="#iconUndo"></use></svg>
    </span>
    <span data-type="clear" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.remove}">
        <svg><use xlink:href="#iconTrashcan"></use></svg>
    </span>
    <span data-type="update" class="config-keymap__key">${s}</span>
    <input data-key="plugin${p.ZWSP}${n.name}${p.ZWSP}${i.langKey}" data-value="${i.customHotkey}" data-default="${i.hotkey}" class="b3-text-field fn__none" value="${s}" spellcheck="false">
</label>`}),n.updateProtyleToolbar([]).forEach(i=>{if(typeof i=="string"||p.INLINE_TYPE.concat("|").includes(i.name)||!i.hotkey)return;const s=window.siyuan.config.keymap.plugin[n.name][i.name],r=Mt(s.custom);a+=`<label class="b3-list-item b3-list-item--narrow b3-list-item--hide-action">
    <span class="b3-list-item__text">${i.tip||window.siyuan.languages[i.lang]}</span>
    <span data-type="reset" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.reset}">
        <svg><use xlink:href="#iconUndo"></use></svg>
    </span>
    <span data-type="clear" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.remove}">
        <svg><use xlink:href="#iconTrashcan"></use></svg>
    </span>
    <span data-type="update" class="config-keymap__key">${r}</span>
    <input data-key="plugin${p.ZWSP}${n.name}${p.ZWSP}${i.name}" data-value="${s.custom}" data-default="${s.default}" class="b3-text-field fn__none" value="${r}" spellcheck="false">
</label>`}),Object.keys(n.docks).forEach(i=>{const s=n.docks[i].config;if(!s.hotkey)return;const r=window.siyuan.config.keymap.plugin[n.name][i],o=Mt(r.custom);a+=`<label class="b3-list-item b3-list-item--narrow b3-list-item--hide-action">
    <span class="b3-list-item__text">${s.title}</span>
    <span data-type="reset" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.reset}">
        <svg><use xlink:href="#iconUndo"></use></svg>
    </span>
    <span data-type="clear" class="b3-list-item__action b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.remove}">
        <svg><use xlink:href="#iconTrashcan"></use></svg>
    </span>
    <span data-type="update" class="config-keymap__key">${o}</span>
    <input data-key="plugin${p.ZWSP}${n.name}${p.ZWSP}${i}" data-value="${r.custom}" data-default="${r.default}" class="b3-text-field fn__none" value="${o}" spellcheck="false">
</label>`}),a&&(e+=`<div class="b3-list-item b3-list-item--narrow toggle">
    <span class="b3-list-item__toggle b3-list-item__toggle--hl">
        <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>
    </span>
    <span class="b3-list-item__text ft__on-surface">${n.displayName}</span>
</div>
<div class="fn__none b3-list__panel">
    ${a}
</div>`)}),e&&(e=`<div class="b3-list b3-list--border b3-list--background">
    <div class="b3-list-item b3-list-item--narrow toggle">
        <span class="b3-list-item__toggle b3-list-item__toggle--hl">
            <svg class="b3-list-item__arrow b3-list-item__arrow--open"><use xlink:href="#iconRight"></use></svg>
        </span>
        <span class="b3-list-item__text ft__on-surface">${window.siyuan.languages.plugin}</span>
    </div>
    <div class="b3-list__panel">
        ${e}
    </div>
</div>`),`<div class="fn__flex b3-label config__item">
    <span class="fn__flex-center">${window.siyuan.languages.keymapTip}</span>
    <span class="fn__flex-1"></span>
    <button id="keymapRefreshBtn" class="b3-button b3-button--outline fn__flex-center fn__size200">
        <svg><use xlink:href="#iconRefresh"></use></svg>
        ${window.siyuan.languages.refresh}
    </button>
</div>
<div class="fn__flex b3-label config__item">
    <span class="fn__flex-center">${window.siyuan.languages.keymapTip2}</span>
    <span class="fn__flex-1"></span>
    <span class="fn__space"></span>
    <button id="keymapResetBtn" class="b3-button b3-button--outline fn__flex-center fn__size200">
        <svg><use xlink:href="#iconUndo"></use></svg>
        ${window.siyuan.languages.reset}
    </button>
</div>
<div class="b3-label file-tree config-keymap" id="keymapList">
    <div class="fn__flex config__item">
        <label class="b3-form__icon fn__block">
            <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>
            <input id="keymapInput" class="b3-form__icon-input b3-text-field fn__block" placeholder="${window.siyuan.languages.search}">
        </label>
        <div class="fn__space"></div>
        <label class="b3-form__icon fn__block searchByKeyLabel">
            <svg class="b3-form__icon-icon"><use xlink:href="#iconKeymap"></use></svg>
            <input id="searchByKey" data-value="" class="b3-form__icon-input b3-text-field fn__block" spellcheck="false" placeholder="${window.siyuan.languages.keymap}">
        </label>
        <div class="fn__space"></div>
        <button id="clearSearchBtn" class="b3-button b3-button--outline fn__flex-center fn__size200">
            <svg style="height: 14px"><use xlink:href="#iconClose"></use></svg>
            ${window.siyuan.languages.clear}
        </button>
    </div>
    <div class="fn__hr"></div>
    <div class="b3-list b3-list--border b3-list--background">
        <div class="b3-list-item b3-list-item--narrow toggle">
            <span class="b3-list-item__toggle b3-list-item__toggle--hl"><svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg></span>
            <span class="b3-list-item__text ft__on-surface">${window.siyuan.languages.general}</span>
        </div>
        <div class="fn__none b3-list__panel">${wa._genItem(window.siyuan.config.keymap.general,"general")}</div>
    </div>
    <div class="b3-list b3-list--border b3-list--background">
        <div class="b3-list-item b3-list-item--narrow toggle">
            <span class="b3-list-item__toggle b3-list-item__toggle--hl">
                <svg class="b3-list-item__arrow b3-list-item__arrow--open"><use xlink:href="#iconRight"></use></svg>
            </span>
            <span class="b3-list-item__text ft__on-surface">${window.siyuan.languages.editor}</span>
        </div>
        <div class="b3-list__panel">
            <div class="b3-list-item b3-list-item--narrow toggle">
                <span class="b3-list-item__toggle b3-list-item__toggle--hl">
                    <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>
                </span>
                <span class="b3-list-item__text ft__on-surface">${window.siyuan.languages.general}</span>
            </div>
            <div class="fn__none b3-list__panel">${wa._genItem(window.siyuan.config.keymap.editor.general,"editor"+p.ZWSP+"general")}</div>
            <div class="b3-list-item b3-list-item--narrow toggle">
                <span class="b3-list-item__toggle b3-list-item__toggle--hl">
                    <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>
                </span>
                <span class="b3-list-item__text ft__on-surface">${window.siyuan.languages.element}</span>
            </div>
            <div class="fn__none b3-list__panel">${wa._genItem(window.siyuan.config.keymap.editor.insert,"editor"+p.ZWSP+"insert")}</div>
            <div class="b3-list-item b3-list-item--narrow toggle">
                <span class="b3-list-item__toggle b3-list-item__toggle--hl">
                    <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>
                </span>
                <span class="b3-list-item__text ft__on-surface">${window.siyuan.languages.headings}</span>
            </div>
            <div class="fn__none b3-list__panel">${wa._genItem(window.siyuan.config.keymap.editor.heading,"editor"+p.ZWSP+"heading")}</div>
            <div class="b3-list-item b3-list-item--narrow toggle">
                <span class="b3-list-item__toggle b3-list-item__toggle--hl">
                    <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>
                </span>
                <span class="b3-list-item__text ft__on-surface">${window.siyuan.languages.list1}</span>
            </div>
            <div class="fn__none b3-list__panel">${wa._genItem(window.siyuan.config.keymap.editor.list,"editor"+p.ZWSP+"list")}</div>
            <div class="b3-list-item b3-list-item--narrow toggle">
                <span class="b3-list-item__toggle b3-list-item__toggle--hl">
                    <svg class="b3-list-item__arrow"><use xlink:href="#iconRight"></use></svg>
                </span>
                <span class="b3-list-item__text ft__on-surface">${window.siyuan.languages.table}</span>
            </div>
            <div class="fn__none b3-list__panel">${wa._genItem(window.siyuan.config.keymap.editor.table,"editor"+p.ZWSP+"table")}</div>
        </div>
    </div>
    ${e}
</div>`},_setkeymap(t){const e=JSON.parse(JSON.stringify(p.SIYUAN_KEYMAP)),n=window.siyuan.config.keymap.general.toggleWin.custom;wa.element.querySelectorAll("label.b3-list-item input").forEach(a=>{const i=a.getAttribute("data-key").split(p.ZWSP),s=a.getAttribute("data-value");i[0]==="plugin"?(window.siyuan.config.keymap.plugin[i[1]][i[2]].custom=s,e.plugin=window.siyuan.config.keymap.plugin,t.plugins.forEach(r=>{r.name===i[1]&&r.commands.forEach(o=>{o.langKey===i[2]&&(o.customHotkey=s)})})):i[0]==="general"?e[i[0]][i[1]].custom=s:i[0]==="editor"&&(i[1]==="general"||i[1]==="insert"||i[1]==="heading"||i[1]==="list"||i[1]==="table")&&(e[i[0]][i[1]][i[2]].custom=s)}),window.siyuan.config.keymap=e,ae("/api/setting/setKeymap",{data:e},()=>{})},search(t,e){const n=wa.element.querySelector("#keymapList");n.querySelectorAll(".b3-list-item--hide-action > .b3-list-item__text").forEach(a=>{const i=a.parentElement;let s=!1;if((e===""||i.querySelector(".b3-text-field").getAttribute("data-value").indexOf(e)>-1)&&(s=!0),(a.textContent.toLowerCase().indexOf(t.toLowerCase())>-1||t.toLowerCase().indexOf(a.textContent.toLowerCase())>-1||t==="")&&s?(i.classList.remove("fn__none"),i.parentElement.classList.remove("fn__none"),i.parentElement.parentElement.classList.remove("fn__none")):i.classList.add("fn__none"),!i.nextElementSibling){const r=i.parentElement.previousElementSibling;t===""&&e===""&&(r.querySelector(".b3-list-item__arrow").classList.contains("b3-list-item__arrow--open")?i.parentElement.classList.remove("fn__none"):i.parentElement.classList.add("fn__none")),i.parentElement.childElementCount===i.parentElement.querySelectorAll(".b3-list-item.fn__none").length?r.classList.add("fn__none"):r.classList.remove("fn__none")}}),this._toggleSearchItem(n.lastElementChild,t,e),n.childElementCount===5&&this._toggleSearchItem(n.lastElementChild.previousElementSibling,t,e)},_toggleSearchItem(t,e,n){e===""&&n===""&&(t.querySelector(".b3-list-item__arrow").classList.contains("b3-list-item__arrow--open")?t.lastElementChild.classList.remove("fn__none"):t.lastElementChild.classList.add("fn__none")),t.querySelectorAll(".b3-list-item--hide-action.fn__none").length===t.querySelectorAll(".b3-list-item--hide-action").length?t.firstElementChild.classList.add("fn__none"):t.firstElementChild.classList.remove("fn__none")},_getTip(t){const e=t.parentElement;let n=e.querySelector(".b3-list-item__text").textContent.trim();const a=e.parentElement.previousElementSibling;n=a.textContent.trim()+"-"+n;const i=a.parentElement.previousElementSibling;return i.classList.contains("b3-list-item")&&(n=i.textContent.trim()+"-"+n),n},bindEvent(t){wa.element.querySelector("#keymapRefreshBtn").addEventListener("click",()=>{Ss({cb(){window.location.reload()},errorExit:!1})});const e=wa.element.querySelector("#keymapInput"),n=wa.element.querySelector("#searchByKey");e.addEventListener("compositionend",()=>{wa.search(e.value,n.dataset.value)}),e.addEventListener("input",s=>{s.isComposing||wa.search(e.value,n.dataset.value)}),n.addEventListener("blur",()=>{WL(t)}),n.addEventListener("keydown",function(s){s.stopPropagation(),s.preventDefault();const r=wa._getKeymapString(s);setTimeout(()=>{this.value=Mt(r)}),this.dataset.keymap=r,wa.search(e.value,r)}),wa.element.querySelector("#clearSearchBtn").addEventListener("click",()=>{e.value="",n.value="",wa.search("","")}),wa.element.querySelector("#keymapResetBtn").addEventListener("click",()=>{Sn("\u26A0\uFE0F "+window.siyuan.languages.reset,window.siyuan.languages.confirmReset,()=>{ae("/api/setting/setKeymap",{data:p.SIYUAN_KEYMAP},()=>{window.location.reload()})})});const a=wa.element.querySelector("#keymapList");a.addEventListener("click",s=>{let r=s.target;for(;r&&!r.isEqualNode(a);){const o=r.getAttribute("data-type");if(o==="reset"){const l=r.parentElement.querySelector(".b3-text-field");l.value=Mt(l.getAttribute("data-default")),l.setAttribute("data-value",l.getAttribute("data-default")),l.previousElementSibling.textContent=l.value,wa._setkeymap(t),s.preventDefault(),s.stopPropagation();break}else if(o==="clear"){const l=r.parentElement.querySelector(".b3-text-field");l.value="",l.previousElementSibling.textContent="",l.setAttribute("data-value",""),wa._setkeymap(t),s.preventDefault(),s.stopPropagation();break}else if(o==="update"){r.classList.add("fn__none");const l=r.nextElementSibling;l.classList.remove("fn__none"),l.focus(),s.preventDefault(),s.stopPropagation();break}else if(r.classList.contains("b3-list-item--hide-action")){const l=r.querySelector(".b3-text-field");l.classList.remove("fn__none"),l.focus(),l.previousElementSibling.classList.add("fn__none"),s.preventDefault(),s.stopPropagation();break}else if(r.classList.contains("toggle")){r.nextElementSibling.classList.contains("fn__none")?(r.firstElementChild.firstElementChild.classList.add("b3-list-item__arrow--open"),r.nextElementSibling.classList.remove("fn__none")):(r.firstElementChild.firstElementChild.classList.remove("b3-list-item__arrow--open"),r.nextElementSibling.classList.add("fn__none")),s.preventDefault(),s.stopPropagation();break}r=r.parentElement}});let i;a.querySelectorAll("label.b3-list-item input").forEach(s=>{s.addEventListener("keydown",function(r){r.stopPropagation(),r.preventDefault();const o=wa._getKeymapString(r),l=Mt(o);clearTimeout(i),i=window.setTimeout(()=>{const c=this.getAttribute("data-key").split(p.ZWSP);c[1]==="list"&&(c[1]="list1"),c[1]==="heading"&&(c[1]="headings");let d=!1;const u=["\u2318","\u21E7","\u2325","\u2303"].includes(o.substr(o.length-1,1));if((u||["\u2318A","\u2318X","\u2318C","\u2318V","\u2318-","\u2318=","\u23180","\u21E7\u2318V","\u2318/","\u21E7\u2191","\u21E7\u2193","\u21E7\u2192","\u21E7\u2190","\u21E7\u21E5","\u2303D","\u21E7\u2318\u2192","\u21E7\u2318\u2190","\u2318Home","\u2318End","\u21E7\u21A9","\u21A9","PageUp","PageDown","\u232B","\u2326","Escape"].includes(o)||Jt()&&c[0]==="general"&&["goToEditTabNext","goToEditTabPrev"].includes(c[1])&&o.includes("\u2318"))&&(u||Q(`${window.siyuan.languages.invalid} [${l}]`),d=!0),Array.from(wa.element.querySelectorAll("label.b3-list-item input")).find(g=>{if(g!==this&&g.getAttribute("data-value")===o){const f=g.getAttribute("data-key").split(p.ZWSP);return f[1]==="list"&&(f[1]="list1"),f[1]==="heading"&&(f[1]="headings"),Q(`${window.siyuan.languages.conflict} [${wa._getTip(g)} ${l}]`),d=!0,!0}}),d){this.value=Mt(this.getAttribute("data-value"));return}ot(),this.setAttribute("data-value",o),this.value=l,wa._setkeymap(t)},p.TIMEOUT_TRANSITION)}),s.addEventListener("blur",function(){WL(t),setTimeout(()=>{this.classList.add("fn__none"),this.previousElementSibling.textContent=this.value,this.previousElementSibling.classList.remove("fn__none")},p.TIMEOUT_INPUT)})})},_getKeymapString(t){let e="";return t.ctrlKey&&Jt()&&(e+="\u2303"),t.altKey&&(e+="\u2325"),t.shiftKey&&(e+="\u21E7"),(t.metaKey||!Jt()&&t.ctrlKey)&&(e+="\u2318"),t.key!=="Shift"&&t.key!=="Alt"&&t.key!=="Meta"&&t.key!=="Control"&&t.key!=="Unidentified"&&(t.keyCode===229?t.code==="Minus"?e+="-":t.code==="Semicolon"?e+=";":t.code==="Quote"?e+="'":t.code==="Comma"?e+=",":t.code==="Period"?e+=".":t.code==="Slash"&&(e+="/"):e+=p.KEYCODELIST[t.keyCode]||(t.key.length>1?t.key:t.key.toUpperCase())),e}},sr=t=>{const e=[];return t.forEach(n=>{e.push(window.siyuan.languages[n])}),e},LV=(t,e)=>{const n=[sr(["config","fullWidth","md7","md8","md37","md38","editor","md2","md3","md12","md16","md27","md28","md29","md30","md31","md32","md33","md34","md39","md40","fontSizeTip","fontSize","font","font1","generateHistory","generateHistoryInterval","historyRetentionDays","historyRetentionDaysTip","clearHistory","katexMacros","katexMacrosTip","editReadonly","editReadonlyTip","embedBlockBreadcrumb","embedBlockBreadcrumbTip","outlineOutdentTip","outdent","floatWindowMode","floatWindowModeTip","justify","justifyTip","rtl","rtlTip","spellcheck","spellcheckTip","backlinkExpand","backlinkExpandTip","backmentionExpand","backmentionExpandTip","onlySearchForDoc","onlySearchForDocTip","dynamicLoadBlocks","dynamicLoadBlocksTip","fontSizeScrollZoom","fontSizeScrollZoomTip","listItemDotNumberClickFocus","listItemDotNumberClickFocusTip","editorMarkdownInlineAsterisk","editorMarkdownInlineUnderscore","editorMarkdownInlineSup","editorMarkdownInlineSupTip","editorMarkdownInlineSub","editorMarkdownInlineSubTip","editorMarkdownInlineTag","editorMarkdownInlineTagTip","editorMarkdownInlineMath","editorMarkdownInlineMathTip","editorMarkdownInlineStrikethrough","editorMarkdownInlineStrikethroughTip","editorMarkdownInlineMark","editorMarkdownInlineMarkTip","allowHTMLBLockScript","allowHTMLBLockScriptTip","backlinkExpandTip","backmentionExpandTip","backlinkContainChildren","backlinkContainChildrenTip"]),sr(["selectOpen","tabLimit","fileTree","fileTree2","fileTree3","fileTree4","fileTree5","fileTree6","fileTree7","fileTree8","fileTree9","fileTree10","fileTree12","fileTree13","fileTree15","fileTree16","fileTree17","fileTree18","fileTree19","fileTree20","fileTree21","fileTree22","fileTree23","fileTree24","fileTree25"]),sr(["riffCard","flashcardNewCardLimit","flashcardNewCardLimitTip","flashcardReviewCardLimit","flashcardNewCardLimit","flashcardReviewCardLimitTip","flashcardMark","flashcardMarkTip","flashcardList","flashcardSuperBlock","flashcardHeading","flashcardDeck","flashcardDeckTip","flashcardFSRSParamRequestRetention","flashcardFSRSParamRequestRetentionTip","flashcardFSRSParamMaximumInterval","flashcardFSRSParamMaximumIntervalTip","flashcardFSRSParamWeights","flashcardFSRSParamWeightsTip","reviewMode","reviewModeTip"]),["AI"].concat(sr(["ai","apiTimeout","apiTimeoutTip","apiMaxTokens","apiMaxTokensTip","apiKey","apiKeyTip","apiProxy","apiProxyTip","apiBaseURL","apiBaseURLTip","apiUserAgentTip","apiVersion","apiVersionTip","apiProvider","apiProviderTip","apiTemperature","apiTemperatureTip","apiMaxContexts","apiMaxContextsTip"])),sr(["assets","unreferencedAssets","missingAssets"]),sr(["paragraphBeginningSpace","md4","export","export1","export2","export5","export11","export13","export14","export15","export19","export20","ref","blockEmbed","export17","export18","export23","export24","export25","export26","export27","export28","export29"]),sr(["language","language1","appearance","appearance1","appearance2","appearance3","appearance4","appearance5","appearance6","appearance8","appearance9","appearance10","appearance11","appearance16","appearance17","appearance18","resetLayout","reset","icon","themeLight","themeDark","close","themeOS","theme","theme2","theme11","theme12","customEmoji","customEmojiTip","refresh"]),sr(["bazaar","theme","template","icon","widget"]),sr(["search","searchLimit","searchLimit1","memo","name","alias","keywordsLimit","doc","headings","list1","listItem","code","math","table","quote","superBlock","paragraph","indexAssetPath","embedBlock","database","searchBackmention","searchVirtualRef","searchBlockAttr","searchBlockType","searchCaseSensitive"]),sr(["keymap","keymapTip2"].concat(Object.keys(p.SIYUAN_KEYMAP.general)).concat(Object.keys(p.SIYUAN_KEYMAP.editor.general)).concat(Object.keys(p.SIYUAN_KEYMAP.editor.heading)).concat(Object.keys(p.SIYUAN_KEYMAP.editor.insert)).concat(Object.keys(p.SIYUAN_KEYMAP.editor.list)).concat(Object.keys(p.SIYUAN_KEYMAP.editor.table))),sr(["accountTip","accountName","password","captcha","forgetPassword","login","register","twoFactorCaptcha","account1","account2","account5"]),sr(["cloudStorage","trafficStat","sync","backup","cdn","total","sizeLimit","cloudBackup","cloudBackupTip","updatePath","cloudSync","upload","download","syncMode","syncModeTip","generateConflictDoc","generateConflictDocTip","syncProvider","syncProviderTip","syncMode1","syncMode2","reposTip","openSyncTip1","openSyncTip2","cloudSyncDir","cloudSyncDirTip","config"]),sr(["publishService","publishServiceTip","publishServicePort","publishServicePortTip","publishServiceAddresses","publishServiceAddressesTip","publishServiceAuth","publishServiceAuthTip","publishServiceAuthAccounts","publishServiceAuthAccountsTip"]),sr(["autoLaunch","autoLaunchTip","about","about1","about2","about3","about4","about5","about6","about7","about8","about11","about12","about13","about14","about17","config","dataRepoKey","dataRepoKeyTip1","dataRepoKeyTip2","slogan","currentVer","checkUpdate","updatePath","systemLog","importKey","genKey","genKeyByPW","copyKey","resetRepo","systemLogTip","export","downloadLatestVer","safeQuit","directConnection","siyuanNote","key","password","copied","resetRepoTip","autoDownloadUpdatePkg","autoDownloadUpdatePkgTip","networkProxy","keyPlaceholder","initRepoKeyTip","dataRepoPurge","dataRepoPurgeTip","dataRepoAutoPurgeIndexRetentionDays","dataRepoAutoPurgeRetentionIndexesDaily","vacuumDataIndex","vacuumDataIndexTip","rebuildDataIndex","rebuildDataIndexTip"])],a=t.querySelector(".b3-form__icon input"),i=()=>{const s=[],r=a.value;n.map((c,d)=>{c.map(u=>{u||console.warn("Search config miss language: ",c,d),u&&(r.toLowerCase().indexOf(u.toLowerCase())>-1||u.toLowerCase().indexOf(r.toLowerCase())>-1)&&s.push(d)})});let o;t.querySelectorAll(".b3-tab-bar li").forEach((c,d)=>{if(s.includes(d)){o||(o=c);const u=c.getAttribute("data-name");if(c.style.display="",["image","bazaar","account"].includes(u))return;const g=t.querySelector(`.config__tab-container[data-name="${u}"]`);if(g.innerHTML===""&&zL(u,g,e),u==="keymap"){const f=wa.element.querySelector("#keymapInput"),h=wa.element.querySelector("#searchByKey");f.value=r,h.value="",wa.search(f.value,h.value)}else u==="search"?g.querySelectorAll(`.config__tab-container[data-name="${u}"] .b3-label`).forEach(f=>{let h=!1,m=!1;const b=f.firstElementChild.textContent.toLowerCase();(b.indexOf(r.toLowerCase())>-1||r.toLowerCase().indexOf(b)>-1)&&(m=!0),f.querySelectorAll(".fn__flex-1").forEach(y=>{if(!y.parentElement.classList.contains("fn__none")){const _=y.textContent.toLowerCase();_.indexOf(r.toLowerCase())>-1||r.toLowerCase().indexOf(_)>-1||m?(y.parentElement.style.display="",h=!0):y.parentElement.style.display="none"}}),f.classList.contains("fn__none")||(h?f.style.display="":f.style.display="none")}):g.querySelectorAll(`.config__tab-container[data-name="${u}"] .b3-label`).forEach(f=>{if(!f.classList.contains("fn__none")){const h=f.textContent.toLowerCase();h.indexOf(r.toLowerCase())>-1||r.toLowerCase().indexOf(h)>-1?f.style.display="":f.style.display="none"}})}else c.style.display="none"});const l=t.querySelectorAll(".config__tab-container");o?o.click():l.forEach(c=>{c.classList.add("fn__none")}),a.focus()};a.addEventListener("compositionend",()=>{i()}),a.addEventListener("input",s=>{s.isComposing||i()})},ni={element:void 0,genHTML:()=>`<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.selectOpen}
        <div class="b3-label__text">${window.siyuan.languages.fileTree2}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="alwaysSelectOpenedFile" type="checkbox"${window.siyuan.config.fileTree.alwaysSelectOpenedFile?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.fileTree7}
        <div class="b3-label__text">${window.siyuan.languages.fileTree8}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="openFilesUseCurrentTab" type="checkbox"${window.siyuan.config.fileTree.openFilesUseCurrentTab?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.fileTree9}
        <div class="b3-label__text">${window.siyuan.languages.fileTree10}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="closeTabsOnStart" type="checkbox"${window.siyuan.config.fileTree.closeTabsOnStart?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.fileTree18}
        <div class="b3-label__text">${window.siyuan.languages.fileTree19}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="allowCreateDeeper" type="checkbox"${window.siyuan.config.fileTree.allowCreateDeeper?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.fileTree3}
        <div class="b3-label__text">${window.siyuan.languages.fileTree4}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="removeDocWithoutConfirm" type="checkbox"${window.siyuan.config.fileTree.removeDocWithoutConfirm?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.fileTree20}
        <div class="b3-label__text">${window.siyuan.languages.fileTree21}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="useSingleLineSave" type="checkbox"${window.siyuan.config.fileTree.useSingleLineSave?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.fileTree24}
        <div class="b3-label__text">${window.siyuan.languages.fileTree25}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="createDocAtTop" type="checkbox"${window.siyuan.config.fileTree.createDocAtTop?" checked":""}/>
</label>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.fileTree22}
        <div class="b3-label__text">${window.siyuan.languages.fileTree23}</div>
    </div>
    <span class="fn__space"></span>
    <div class="fn__size200 fn__flex-center fn__flex">
        <input class="b3-text-field fn__flex-1" id="largeFileWarningSize" type="number" min="2" max="10240" value="${window.siyuan.config.fileTree.largeFileWarningSize}">
        <span class="fn__space"></span>
        <span class="ft__on-surface fn__flex-center">MB</span>
    </div>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.fileTree16}
        <div class="b3-label__text">${window.siyuan.languages.fileTree17}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" id="maxListCount" type="number" min="1" max="10240" value="${window.siyuan.config.fileTree.maxListCount}">
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.tabLimit}
        <div class="b3-label__text">${window.siyuan.languages.tabLimit1}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" id="maxOpenTabCount" type="number" min="1" max="32" value="${window.siyuan.config.fileTree.maxOpenTabCount}">
</div>
<div class="b3-label config__item">
    ${window.siyuan.languages.fileTree12}
    <div class="b3-label__text">${window.siyuan.languages.fileTree13}</div>
    <span class="fn__hr"></span>
    <div class="fn__flex">
        <select style="min-width: 200px" class="b3-select" id="docCreateSaveBox">${Cy(window.siyuan.config.fileTree.docCreateSaveBox)}</select>
        <div class="fn__space"></div>
        <input class="b3-text-field fn__flex-1" id="docCreateSavePath" value="">
    </div>
</div>
<div class="b3-label config__item">
    ${window.siyuan.languages.fileTree5}
    <div class="b3-label__text">${window.siyuan.languages.fileTree6}</div>
    <span class="fn__hr"></span>
    <div class="fn__flex">
        <select style="min-width: 200px" class="b3-select" id="refCreateSaveBox">${Cy(window.siyuan.config.fileTree.refCreateSaveBox)}</select>
        <div class="fn__space"></div>
        <input class="b3-text-field fn__flex-1" id="refCreateSavePath" value="${window.siyuan.config.fileTree.refCreateSavePath}">
    </div>
</div>`,_send(){let t=parseInt(ni.element.querySelector("#maxOpenTabCount").value);32<t&&(t=32,ni.element.querySelector("#maxOpenTabCount").value="32"),1>t&&(t=1,ni.element.querySelector("#maxOpenTabCount").value="1"),ae("/api/setting/setFiletree",{sort:window.siyuan.config.fileTree.sort,alwaysSelectOpenedFile:ni.element.querySelector("#alwaysSelectOpenedFile").checked,refCreateSavePath:ni.element.querySelector("#refCreateSavePath").value,refCreateSaveBox:ni.element.querySelector("#refCreateSaveBox").value,docCreateSavePath:ni.element.querySelector("#docCreateSavePath").value,docCreateSaveBox:ni.element.querySelector("#docCreateSaveBox").value,openFilesUseCurrentTab:ni.element.querySelector("#openFilesUseCurrentTab").checked,closeTabsOnStart:ni.element.querySelector("#closeTabsOnStart").checked,allowCreateDeeper:ni.element.querySelector("#allowCreateDeeper").checked,removeDocWithoutConfirm:ni.element.querySelector("#removeDocWithoutConfirm").checked,useSingleLineSave:ni.element.querySelector("#useSingleLineSave").checked,createDocAtTop:ni.element.querySelector("#createDocAtTop").checked,largeFileWarningSize:parseInt(ni.element.querySelector("#largeFileWarningSize").value),maxListCount:parseInt(ni.element.querySelector("#maxListCount").value),maxOpenTabCount:t},e=>{window.siyuan.config.fileTree=e.data})},bindEvent:()=>{ni.element.querySelector("#docCreateSavePath").value=window.siyuan.config.fileTree.docCreateSavePath,ni.element.querySelector("#refCreateSavePath").value=window.siyuan.config.fileTree.refCreateSavePath,ni.element.querySelectorAll("input, select").forEach(t=>{t.addEventListener("change",()=>{ni._send()})})}};var VL=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const la={element:void 0,genHTML:()=>`<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.paragraphBeginningSpace}
        <div class="b3-label__text">${window.siyuan.languages.md4}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="paragraphBeginningSpace" type="checkbox"${window.siyuan.config.export.paragraphBeginningSpace?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.export17}
        <div class="b3-label__text">${window.siyuan.languages.export18}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="addTitle" type="checkbox"${window.siyuan.config.export.addTitle?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.export23}
        <div class="b3-label__text">${window.siyuan.languages.export24}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="markdownYFM" type="checkbox"${window.siyuan.config.export.markdownYFM?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.export31}
        <div class="b3-label__text">${window.siyuan.languages.export32}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="inlineMemo" type="checkbox"${window.siyuan.config.export.inlineMemo?" checked":""}/>
</label>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.ref}
        <div class="b3-label__text">${window.siyuan.languages.export11}</div>
    </div>
    <span class="fn__space"></span>
    <select id="blockRefMode" class="b3-select fn__flex-center fn__size200">
        <option value="2" ${window.siyuan.config.export.blockRefMode===2?"selected":""}>${window.siyuan.languages.export2}</option>
        <option value="3" ${window.siyuan.config.export.blockRefMode===3?"selected":""}>${window.siyuan.languages.export3}</option>
        <option value="4" ${window.siyuan.config.export.blockRefMode===4?"selected":""}>${window.siyuan.languages.export4}</option>
    </select>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.blockEmbed}
        <div class="b3-label__text">${window.siyuan.languages.export12}</div>
    </div>
    <span class="fn__space"></span>
    <select id="blockEmbedMode" class="b3-select fn__flex-center fn__size200">
        <option value="0" ${window.siyuan.config.export.blockEmbedMode===0?"selected":""}>${window.siyuan.languages.export0}</option>
        <option value="1" ${window.siyuan.config.export.blockEmbedMode===1?"selected":""}>${window.siyuan.languages.export1}</option>
    </select>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.export5}
        <div class="b3-label__text">${window.siyuan.languages.export6}</div>
    </div>
    <span class="fn__space"></span>
    <select id="fileAnnotationRefMode" class="b3-select fn__flex-center fn__size200">
        <option value="0" ${window.siyuan.config.export.fileAnnotationRefMode===0?"selected":""}>${window.siyuan.languages.export7}</option>
        <option value="1" ${window.siyuan.config.export.fileAnnotationRefMode===1?"selected":""}>${window.siyuan.languages.export8}</option>
    </select>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.export21}
        <div class="b3-label__text">${window.siyuan.languages.export22}</div>
    </div>
    <input class="b3-text-field fn__flex-center fn__size200" id="pdfFooter">
</div>
<div class="b3-label config__item">
    ${window.siyuan.languages.export27}
    <div class="b3-label__text">${window.siyuan.languages.export28}</div>
    <div class="fn__hr"></div>
    <input class="b3-text-field fn__block" id="pdfWatermarkStr">
    <div class="fn__hr"></div>
    <div class="b3-label__text"><a href="https://pdfcpu.io/core/watermark#description" target="_blank">${window.siyuan.languages.export29}</a></div>
    <div class="fn__hr"></div>
    <textarea class="b3-text-field fn__block" id="pdfWatermarkDesc"></textarea>
</div>
<div class="b3-label config__item">
    ${window.siyuan.languages.export30}
    <div class="b3-label__text">${window.siyuan.languages.export28}</div>
    <div class="fn__hr"></div>
    <input class="b3-text-field fn__block" id="imageWatermarkStr">
    <div class="fn__hr"></div>
    <div class="b3-label__text">    
        ${window.siyuan.languages.export29}<br>
        ${window.siyuan.languages.export10}
    </div>
    <div class="fn__hr"></div>
    <textarea class="b3-text-field fn__block" id="imageWatermarkDesc"></textarea>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.export25}
        <div class="b3-label__text">${window.siyuan.languages.export26}</div>
    </div>
    <input class="b3-text-field fn__flex-center fn__size200" id="docxTemplate" placeholder="F:\\template.docx">
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.export13}
        <div class="b3-label__text">${window.siyuan.languages.export14}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size96" id="blockRefTextLeft">
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size96" id="blockRefTextRight">
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.export15}
        <div class="b3-label__text">${window.siyuan.languages.export16}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size96" id="tagOpenMarker">
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size96" id="tagCloseMarker">
</div>
<div class="fn__flex b3-label config__item${W()?" fn__none":""}">
    <div class="fn__flex-1">
        ${window.siyuan.languages.export19}
        <span class="fn__space"></span>
        <a href="javascript:void(0)" id="pandocBinPath" style="word-break: break-all">${window.siyuan.config.export.pandocBin}</a>
        <div class="b3-label__text">${window.siyuan.languages.export20}</div>
    </div>
    <span class="fn__space"></span>
    <button class="b3-button b3-button--outline fn__flex-center fn__size200" id="pandocBin"><svg><use xlink:href="#iconSettings"></use></svg>${window.siyuan.languages.config}</button>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1 fn__flex-center">
        ${window.siyuan.languages.export} Data
        <div class="b3-label__text">${window.siyuan.languages.exportDataTip}</div>
    </div>
    <span class="fn__space"></span>
    <button class="b3-button b3-button--outline fn__flex-center fn__size200" id="exportData">
        <svg><use xlink:href="#iconUpload"></use></svg>${window.siyuan.languages.export}
    </button>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1 fn__flex-center">
        ${window.siyuan.languages.import} Data
        <div class="b3-label__text">${window.siyuan.languages.importDataTip}</div>
    </div>
    <span class="fn__space"></span>
    <button class="b3-button b3-button--outline fn__flex-center fn__size200" style="position: relative">
        <input id="importData" class="b3-form__upload" type="file">
        <svg><use xlink:href="#iconDownload"></use></svg>${window.siyuan.languages.import}
    </button>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1 fn__flex-center">
        ${window.siyuan.languages.exportConf}
        <div class="b3-label__text">${window.siyuan.languages.exportConfTip}</div>
    </div>
    <span class="fn__space"></span>
    <button class="b3-button b3-button--outline fn__flex-center fn__size200" id="exportConf">
        <svg><use xlink:href="#iconUpload"></use></svg>${window.siyuan.languages.export}
    </button>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1 fn__flex-center">
        ${window.siyuan.languages.importConf}
        <div class="b3-label__text">${window.siyuan.languages.importConfTip}</div>
    </div>
    <span class="fn__space"></span>
    <button class="b3-button b3-button--outline fn__flex-center fn__size200" style="position: relative">
        <input id="importConf" class="b3-form__upload" type="file">
        <svg><use xlink:href="#iconDownload"></use></svg>${window.siyuan.languages.import}
    </button>
</div>`,bindEvent:()=>{la.element.querySelector("#docxTemplate").value=window.siyuan.config.export.docxTemplate,la.element.querySelector("#pdfFooter").value=window.siyuan.config.export.pdfFooter,la.element.querySelector("#pdfWatermarkStr").value=window.siyuan.config.export.pdfWatermarkStr,la.element.querySelector("#pdfWatermarkDesc").value=window.siyuan.config.export.pdfWatermarkDesc,la.element.querySelector("#imageWatermarkStr").value=window.siyuan.config.export.imageWatermarkStr,la.element.querySelector("#imageWatermarkDesc").value=window.siyuan.config.export.imageWatermarkDesc,la.element.querySelector("#blockRefTextLeft").value=window.siyuan.config.export.blockRefTextLeft,la.element.querySelector("#blockRefTextRight").value=window.siyuan.config.export.blockRefTextRight,la.element.querySelector("#tagOpenMarker").value=window.siyuan.config.export.tagOpenMarker,la.element.querySelector("#tagCloseMarker").value=window.siyuan.config.export.tagCloseMarker;const t=la.element.querySelector("#pandocBinPath"),e=n=>{ae("/api/setting/setExport",{paragraphBeginningSpace:la.element.querySelector("#paragraphBeginningSpace").checked,addTitle:la.element.querySelector("#addTitle").checked,markdownYFM:la.element.querySelector("#markdownYFM").checked,inlineMemo:la.element.querySelector("#inlineMemo").checked,blockRefMode:parseInt(la.element.querySelector("#blockRefMode").value,10),blockEmbedMode:parseInt(la.element.querySelector("#blockEmbedMode").value,10),fileAnnotationRefMode:parseInt(la.element.querySelector("#fileAnnotationRefMode").value,10),pdfFooter:la.element.querySelector("#pdfFooter").value,pdfWatermarkStr:la.element.querySelector("#pdfWatermarkStr").value,pdfWatermarkDesc:la.element.querySelector("#pdfWatermarkDesc").value,imageWatermarkStr:la.element.querySelector("#imageWatermarkStr").value,imageWatermarkDesc:la.element.querySelector("#imageWatermarkDesc").value,docxTemplate:la.element.querySelector("#docxTemplate").value,blockRefTextLeft:la.element.querySelector("#blockRefTextLeft").value,blockRefTextRight:la.element.querySelector("#blockRefTextRight").value,tagOpenMarker:la.element.querySelector("#tagOpenMarker").value,tagCloseMarker:la.element.querySelector("#tagCloseMarker").value,pandocBin:n||window.siyuan.config.export.pandocBin},a=>{la.onSetexport(a.data),t.textContent=a.data.pandocBin})};la.element.querySelectorAll("select").forEach(n=>{n.addEventListener("change",()=>{e()})}),la.element.querySelectorAll("input, textarea").forEach(n=>{n.id=="importData"?n.addEventListener("change",a=>{const i=new FormData;i.append("file",a.target.files[0]),ae("/api/import/importData",i)}):n.id==="importConf"?n.addEventListener("change",a=>{const i=new FormData;i.append("file",a.target.files[0]),ae("/api/system/importConf",i,s=>{if(s.code!==0){Q(s.msg);return}Q(window.siyuan.languages.imported),Ss({errorExit:!0,cb:Ac})})}):n.addEventListener("change",()=>{e()})}),la.element.querySelector("#exportData").addEventListener("click",()=>VL(void 0,null,function*(){ae("/api/export/exportData",{},n=>{$e(n.data.zip)})})),la.element.querySelector("#exportConf").addEventListener("click",()=>VL(void 0,null,function*(){ae("/api/system/exportConf",{},n=>{$e(n.data.zip)})}))},onSetexport:t=>{window.siyuan.config.export=t}};var IV=Tn(5043);const KE=t=>t===0?Ml("")?`<div class="b3-label b3-label--inner">${window.siyuan.config.system.container==="ios"?window.siyuan.languages._kernel[122]:window.siyuan.languages._kernel[29].replaceAll("${accountServer}",ks(""))}</div>
<div class="b3-label b3-label--inner">
    ${window.siyuan.languages.cloudIntro1}
    <div class="b3-label__text">
        <ul class="fn__list">
            <li>${window.siyuan.languages.cloudIntro2}</li>
            <li>${window.siyuan.languages.cloudIntro3}</li>
            <li>${window.siyuan.languages.cloudIntro4}</li>
            <li>${window.siyuan.languages.cloudIntro5}</li>
            <li>${window.siyuan.languages.cloudIntro6}</li>
            <li>${window.siyuan.languages.cloudIntro7}</li>
            <li>${window.siyuan.languages.cloudIntro8}</li>
        </ul>
    </div>
</div>
<div class="b3-label b3-label--inner">
    ${window.siyuan.languages.cloudIntro9}
    <div class="b3-label__text">
        <ul style="padding-left: 2em">
            <li>${window.siyuan.languages.cloudIntro10}</li>
            <li>${window.siyuan.languages.cloudIntro11}</li>
        </ul>
    </div>
</div>`:`<div class="b3-label b3-label--inner">
    ${window.siyuan.languages.syncOfficialProviderIntro}
</div>`:CE()?t===2?`<div class="b3-label b3-label--inner">
    ${window.siyuan.languages.syncThirdPartyProviderS3Intro}
    <div class="fn__hr"></div>
    <em>${window.siyuan.languages.proFeature}</em>
    <div class="fn__hr"></div>
    ${window.siyuan.languages.syncThirdPartyProviderTip}
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Endpoint</div>
    <div class="fn__space"></div>
    <input id="endpoint" class="b3-text-field fn__block" value="${window.siyuan.config.sync.s3.endpoint}">
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Access Key</div>
    <div class="fn__space"></div>
    <input id="accessKey" class="b3-text-field fn__block" value="${window.siyuan.config.sync.s3.accessKey}">
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Secret Key</div>
    <div class="fn__space"></div>
    <div class="b3-form__icona fn__block">
        <input id="secretKey" type="password" class="b3-text-field b3-form__icona-input" value="${window.siyuan.config.sync.s3.secretKey}">
        <svg class="b3-form__icona-icon" data-action="togglePassword"><use xlink:href="#iconEye"></use></svg>
    </div>
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Bucket</div>
    <div class="fn__space"></div>
    <input id="bucket" class="b3-text-field fn__block" value="${window.siyuan.config.sync.s3.bucket}">
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Region ID</div>
    <div class="fn__space"></div>
    <input id="region" class="b3-text-field fn__block" value="${window.siyuan.config.sync.s3.region}">
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Timeout (s)</div>
    <div class="fn__space"></div>
    <input id="timeout" class="b3-text-field fn__block" type="number" min="7" max="300" value="${window.siyuan.config.sync.s3.timeout}">
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Addressing</div>
    <div class="fn__space"></div>
    <select class="b3-select fn__block" id="pathStyle">
        <option ${window.siyuan.config.sync.s3.pathStyle?"selected":""} value="true">Path-style</option>
        <option ${window.siyuan.config.sync.s3.pathStyle?"":"selected"} value="false">Virtual-hosted-style</option>
    </select>
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">TLS Verify</div>
    <div class="fn__space"></div>
    <select class="b3-select fn__block" id="s3SkipTlsVerify">
        <option ${window.siyuan.config.sync.s3.skipTlsVerify?"":"selected"} value="false">Verify</option>
        <option ${window.siyuan.config.sync.s3.skipTlsVerify?"selected":""} value="true">Skip</option>
    </select>
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Concurrent Reqs</div>
    <div class="fn__space"></div>
    <input id="s3ConcurrentReqs" class="b3-text-field fn__block" type="number" min="1" max="16" value="${window.siyuan.config.sync.s3.concurrentReqs}">
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-1"></div>
    <button class="b3-button b3-button--outline fn__size200" data-action="purgeData">
        <svg><use xlink:href="#iconTrashcan"></use></svg>${window.siyuan.languages.purge}
    </button>
    <div class="fn__space"></div>
    <button class="b3-button b3-button--outline fn__size200" style="position: relative">
        <input id="importData" class="b3-form__upload" type="file" data-type="s3">
        <svg><use xlink:href="#iconDownload"></use></svg>${window.siyuan.languages.import}
    </button>
    <div class="fn__space"></div>
    <button class="b3-button b3-button--outline fn__size200" data-action="exportData" data-type="s3">
        <svg><use xlink:href="#iconUpload"></use></svg>${window.siyuan.languages.export}
    </button>
</div>`:t===3?`<div class="b3-label b3-label--inner">
    ${window.siyuan.languages.syncThirdPartyProviderWebDAVIntro}
    <div class="fn__hr"></div>
    <em>${window.siyuan.languages.proFeature}</em>
    <div class="fn__hr"></div>
    ${window.siyuan.languages.syncThirdPartyProviderTip}
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Endpoint</div>
    <div class="fn__space"></div>
    <input id="endpoint" class="b3-text-field fn__block" value="${window.siyuan.config.sync.webdav.endpoint}">
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Username</div>
    <div class="fn__space"></div>
    <input id="username" class="b3-text-field fn__block" value="${window.siyuan.config.sync.webdav.username}">
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Password</div>
    <div class="fn__space"></div>
    <div class="b3-form__icona fn__block">
        <input id="password" type="password" class="b3-text-field b3-form__icona-input" value="${window.siyuan.config.sync.webdav.password}">
        <svg class="b3-form__icona-icon" data-action="togglePassword"><use xlink:href="#iconEye"></use></svg>
    </div>
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Timeout (s)</div>
    <div class="fn__space"></div>
    <input id="timeout" class="b3-text-field fn__block" type="number" min="7" max="300" value="${window.siyuan.config.sync.webdav.timeout}">
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">TLS Verify</div>
    <div class="fn__space"></div>
    <select class="b3-select fn__block" id="webdavSkipTlsVerify">
        <option ${window.siyuan.config.sync.webdav.skipTlsVerify?"":"selected"} value="false">Verify</option>
        <option ${window.siyuan.config.sync.webdav.skipTlsVerify?"selected":""} value="true">Skip</option>
    </select>
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Concurrent Reqs</div>
    <div class="fn__space"></div>
    <input id="webdavConcurrentReqs" class="b3-text-field fn__block" type="number" min="1" max="16" value="${window.siyuan.config.sync.webdav.concurrentReqs}">
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-1"></div>
    <button class="b3-button b3-button--outline fn__size200" data-action="purgeData">
        <svg><use xlink:href="#iconTrashcan"></use></svg>${window.siyuan.languages.purge}
    </button>
    <div class="fn__space"></div>
    <button class="b3-button b3-button--outline fn__size200" style="position: relative">
        <input id="importData" class="b3-form__upload" type="file" data-type="webdav">
        <svg><use xlink:href="#iconDownload"></use></svg>${window.siyuan.languages.import}
    </button>
    <div class="fn__space"></div>
    <button class="b3-button b3-button--outline fn__size200" data-action="exportData" data-type="webdav">
        <svg><use xlink:href="#iconUpload"></use></svg>${window.siyuan.languages.export}
    </button>
</div>`:t===4?`<div class="b3-label b3-label--inner">
    <div class="ft__error">
        ${window.siyuan.languages.mobileNotSupport}
    </div>
    <div class="fn__hr"></div>
    ${window.siyuan.languages.syncThirdPartyProviderLocalIntro}
    <div class="fn__hr"></div>
    <em>${window.siyuan.languages.proFeature}</em>
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Endpoint</div>
    <div class="fn__space"></div>
    <input id="endpoint" class="b3-text-field fn__block" value="${window.siyuan.config.sync.local.endpoint}">
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Timeout (s)</div>
    <div class="fn__space"></div>
    <input id="timeout" class="b3-text-field fn__block" type="number" min="7" max="300" value="${window.siyuan.config.sync.local.timeout}">
</div>
<div class="b3-label b3-label--inner fn__flex">
    <div class="fn__flex-center fn__size200">Concurrent Reqs</div>
    <div class="fn__space"></div>
    <input id="localConcurrentReqs" class="b3-text-field fn__block" type="number" min="1" max="1024" value="${window.siyuan.config.sync.local.concurrentReqs}">
</div>`:"":`<div>
    ${window.siyuan.languages._kernel[214].replaceAll("${accountServer}",ks(""))}
</div>
<div class="ft__error${t==4?"":" fn__none"}">
    <div class="fn__hr--b"></div>
    ${window.siyuan.languages.mobileNotSupport}
</div>`,XE=()=>{const t=ai.element.querySelector("#importData");t&&t.addEventListener("change",()=>{const s=new FormData;s.append("file",t.files[0]);const r=t.getAttribute("data-type")==="s3";ae(r?"/api/sync/importSyncProviderS3":"/api/sync/importSyncProviderWebDAV",s,o=>{r?window.siyuan.config.sync.s3=o.data.s3:window.siyuan.config.sync.webdav=o.data.webdav,ai.element.querySelector("#syncProviderPanel").innerHTML=KE(window.siyuan.config.sync.provider),XE(),Q(window.siyuan.languages.imported),t.value=""})});const e=ai.element.querySelector("#reposData"),n=ai.element.querySelector("#reposLoading");if(window.siyuan.config.sync.provider===0){if(Ml("")){n.classList.add("fn__none");let s=e;for(;s;)s.classList.add("fn__none"),s=s.nextElementSibling;return}ae("/api/cloud/getCloudSpace",{},s=>{if(n.classList.add("fn__none"),s.code===1){e.innerHTML=s.msg;return}else e.innerHTML=`<div class="fn__flex">
    <div class="fn__flex-1">
        ${window.siyuan.languages.cloudStorage}
        <div class="fn__hr"></div>
        <ul class="b3-list" style="margin-left: 12px">
            <li class="b3-list-item" style="cursor: auto;">${window.siyuan.languages.sync}<span class="b3-list-item__meta">${s.data.sync?s.data.sync.hSize:"0B"}</span></li>
            <li class="b3-list-item" style="cursor: auto;">${window.siyuan.languages.backup}<span class="b3-list-item__meta">${s.data.backup?s.data.backup.hSize:"0B"}</span></li>
            <li class="b3-list-item" style="cursor: auto;"><a href="${ks("settings/file?type=3")}" target="_blank">${window.siyuan.languages.cdn}</a><span class="b3-list-item__meta">${s.data.hAssetSize}</span></li>
            <li class="b3-list-item" style="cursor: auto;">${window.siyuan.languages.total}<span class="b3-list-item__meta">${s.data.hSize}</span></li>
            <li class="b3-list-item" style="cursor: auto;">${window.siyuan.languages.sizeLimit}<span class="b3-list-item__meta">${s.data.hTotalSize}</span></li>
            <li class="b3-list-item" style="cursor: auto;"><a href="${ks("settings/point")}" target="_blank">${window.siyuan.languages.pointExchangeSize}</a><span class="b3-list-item__meta">${s.data.hExchangeSize}</span></li>
        </ul>
    </div>
    <div class="fn__flex-1">
        ${window.siyuan.languages.trafficStat}
        <div class="fn__hr"></div>
        <ul class="b3-list" style="margin-left: 12px">
            <li class="b3-list-item" style="cursor: auto;">${window.siyuan.languages.upload}<span class="fn__space"></span><span class="ft__on-surface">${s.data.hTrafficUploadSize}</span></li>
            <li class="b3-list-item" style="cursor: auto;">${window.siyuan.languages.download}<span class="fn__space"></span><span class="ft__on-surface">${s.data.hTrafficDownloadSize}</span></li>
            <li class="b3-list-item" style="cursor: auto;">API GET<span class="fn__space"></span><span class="ft__on-surface">${s.data.hTrafficAPIGet}</span></li>
            <li class="b3-list-item" style="cursor: auto;">API PUT<span class="fn__space"></span><span class="ft__on-surface">${s.data.hTrafficAPIPut}</span></li>
        </ul>
    </div>
</div>`}),e.classList.remove("fn__none");return}n.classList.add("fn__none");let a=e.nextElementSibling;for(;a;)CE()?a.classList.remove("fn__none"):a.classList.add("fn__none"),a=a.nextElementSibling;e.classList.add("fn__none");const i=ai.element.querySelector("#syncProviderPanel");i.querySelectorAll(".b3-text-field, .b3-select").forEach(s=>{s.addEventListener("blur",()=>{if(window.siyuan.config.sync.provider===2){let r=parseInt(i.querySelector("#timeout").value,10);7>r&&(1>r?r=30:r=7),300<r&&(r=300);let o=parseInt(i.querySelector("#s3ConcurrentReqs").value,10);1>o&&(o=1),16<o&&(o=16),i.querySelector("#timeout").value=r.toString();let l=i.querySelector("#endpoint").value;l=l.trim().replace("http://http(s)://","https://"),l=l.replace("http(s)://","https://"),l.startsWith("http")||(l="http://"+l);const c={endpoint:l,accessKey:i.querySelector("#accessKey").value.trim(),secretKey:i.querySelector("#secretKey").value.trim(),bucket:i.querySelector("#bucket").value.trim(),pathStyle:i.querySelector("#pathStyle").value==="true",region:i.querySelector("#region").value.trim(),skipTlsVerify:i.querySelector("#s3SkipTlsVerify").value==="true",timeout:r,concurrentReqs:o};ae("/api/sync/setSyncProviderS3",{s3:c},()=>{window.siyuan.config.sync.s3=c})}else if(window.siyuan.config.sync.provider===3){let r=parseInt(i.querySelector("#timeout").value,10);7>r&&(r=7),300<r&&(r=300);let o=parseInt(i.querySelector("#webdavConcurrentReqs").value,10);1>o&&(o=1),16<o&&(o=16),i.querySelector("#timeout").value=r.toString();let l=i.querySelector("#endpoint").value;l=l.trim().replace("http://http(s)://","https://"),l=l.replace("http(s)://","https://"),l.startsWith("http")||(l="http://"+l);const c={endpoint:l,username:i.querySelector("#username").value.trim(),password:i.querySelector("#password").value.trim(),skipTlsVerify:i.querySelector("#webdavSkipTlsVerify").value==="true",timeout:r,concurrentReqs:o};ae("/api/sync/setSyncProviderWebDAV",{webdav:c},()=>{window.siyuan.config.sync.webdav=c})}else if(window.siyuan.config.sync.provider===4){let r=parseInt(i.querySelector("#timeout").value,10);7>r&&(r=7),300<r&&(r=300);let o=parseInt(i.querySelector("#localConcurrentReqs").value,10);1>o&&(o=1),1024<o&&(o=1024),i.querySelector("#timeout").value=r.toString();const l={endpoint:i.querySelector("#endpoint").value,timeout:r,concurrentReqs:o};ae("/api/sync/setSyncProviderLocal",{local:l},c=>{if(c.code===0){window.siyuan.config.sync.local=c.data.local;const d=i.querySelector("#endpoint");d&&(d.value=c.data.local.endpoint)}else window.siyuan.config.sync.local=l})}})})},ai={element:void 0,genHTML:()=>`<div>
<div style="position: fixed;width: 800px;height: 434px;box-sizing: border-box;text-align: center;display: flex;align-items: center;justify-content: center;z-index: 1;" id="reposLoading">
    <img src="/stage/loading-pure.svg">
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.syncProvider}
        <div class="b3-label__text">${window.siyuan.languages.syncProviderTip}</div>
    </div>
    <span class="fn__space"></span>
    <select id="syncProvider" class="b3-select fn__flex-center fn__size200">
        <option value="2" ${window.siyuan.config.sync.provider===2?"selected":""}>S3</option>
        <option value="3" ${window.siyuan.config.sync.provider===3?"selected":""}>WebDAV</option>
        <option value="4" ${window.siyuan.config.sync.provider===4?"selected":""}>${window.siyuan.languages.localFileSystem}</option>
    </select>
</div>
<div id="syncProviderPanel" class="b3-label">
    ${KE(window.siyuan.config.sync.provider)}
</div>
<div id="reposData" class="b3-label">
    <div class="fn__flex">
        <div class="fn__flex-1">
            ${window.siyuan.languages.cloudStorage}
        </div>
        <div class="fn__flex-1">
            ${window.siyuan.languages.trafficStat}
        </div>
    </div>
</div>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.openSyncTip1}
        <div class="b3-label__text">${window.siyuan.languages.openSyncTip2}</div>
    </div>
    <span class="fn__space"></span>
    <input type="checkbox" id="reposCloudSyncSwitch"${window.siyuan.config.sync.enabled?" checked='checked'":""} class="b3-switch fn__flex-center">
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.generateConflictDoc}
        <div class="b3-label__text">${window.siyuan.languages.generateConflictDocTip}</div>
    </div>
    <span class="fn__space"></span>
    <input type="checkbox" id="generateConflictDoc"${window.siyuan.config.sync.generateConflictDoc?" checked='checked'":""} class="b3-switch fn__flex-center">
</label>
<div class="b3-label">
    <div class="fn__flex config__item">
        <div class="fn__flex-1">
            ${window.siyuan.languages.syncMode}
            <div class="b3-label__text">${window.siyuan.languages.syncModeTip}</div>
        </div>
        <span class="fn__space"></span>
        <select id="syncMode" class="b3-select fn__flex-center fn__size200">
            <option value="1" ${window.siyuan.config.sync.mode===1?"selected":""}>${window.siyuan.languages.syncMode1}</option>
            <option value="2" ${window.siyuan.config.sync.mode===2?"selected":""}>${window.siyuan.languages.syncMode2}</option>
            <option value="3" ${window.siyuan.config.sync.mode===3?"selected":""}>${window.siyuan.languages.syncMode3}</option>
        </select>
    </div>
    <div class="fn__flex b3-label${window.siyuan.config.sync.mode!==1?" fn__none":""}">
        <div class="fn__flex-1">
            ${window.siyuan.languages.syncInterval}
            <div class="b3-label__text">${window.siyuan.languages.syncIntervalTip}</div>
        </div>
        <span class="fn__space"></span>
        <input type="number" min="30" max="43200" id="syncInterval" class="b3-text-field fn__flex-center" value="${window.siyuan.config.sync.interval}" >
        <span class="fn__space"></span>        
        <span class="fn__flex-center ft__on-surface">${window.siyuan.languages.second}</span> 
    </div>
    <label class="fn__flex b3-label${window.siyuan.config.sync.mode!==1||window.siyuan.config.system.container==="docker"||window.siyuan.config.sync.provider!==0?" fn__none":""}">
        <div class="fn__flex-1">
            ${window.siyuan.languages.syncPerception}
            <div class="b3-label__text">${window.siyuan.languages.syncPerceptionTip}</div>
        </div>
        <span class="fn__space"></span>
        <input type="checkbox" id="syncPerception"${window.siyuan.config.sync.perception?" checked='checked'":""} class="b3-switch fn__flex-center">
    </label>
</div>
<div class="b3-label">
    <div class="fn__flex config__item">
        <div class="fn__flex-1">
            ${window.siyuan.languages.cloudSyncDir}
            <div class="b3-label__text">${window.siyuan.languages.cloudSyncDirTip}</div>
        </div>
        <div class="fn__space"></div>
        <button class="b3-button b3-button--outline fn__flex-center fn__size200" data-action="config">
            <svg><use xlink:href="#iconSettings"></use></svg>${window.siyuan.languages.config}
        </button>
    </div>
    <div id="reposCloudSyncList" class="fn__none b3-label"><img style="margin: 0 auto;display: block;width: 64px;height: 100%" src="/stage/loading-pure.svg"></div>
</div>
<div class="b3-label fn__flex">
    <div class="fn__flex-center">${window.siyuan.languages.cloudBackup}</div>
    <div class="b3-list-item__meta fn__flex-center">${window.siyuan.languages.cloudBackupTip}</div>
</div>
</div>`,bindEvent:()=>{XE();const t=ai.element.querySelector("#reposCloudSyncSwitch");t.addEventListener("change",()=>{if(t.checked&&window.siyuan.config.sync.cloudName===""){t.checked=!1,Q(window.siyuan.languages._kernel[123]);return}ae("/api/sync/setSyncEnable",{enabled:t.checked},()=>{window.siyuan.config.sync.enabled=t.checked,Ao()})});const e=ai.element.querySelector("#syncInterval");e.addEventListener("change",()=>{let l=parseInt(e.value);30>l&&(l=30),43200<l&&(l=43200),e.value=l.toString(),ae("/api/sync/setSyncInterval",{interval:l},()=>{window.siyuan.config.sync.interval=l,Ao()})});const n=ai.element.querySelector("#syncPerception");n.addEventListener("change",()=>{ae("/api/sync/setSyncPerception",{enabled:n.checked},()=>{window.siyuan.config.sync.perception=n.checked,Ao()})});const a=ai.element.querySelector("#generateConflictDoc");a.addEventListener("change",()=>{ae("/api/sync/setSyncGenerateConflictDoc",{enabled:a.checked},()=>{window.siyuan.config.sync.generateConflictDoc=a.checked})});const i=ai.element.querySelector("#syncMode");i.addEventListener("change",()=>{ae("/api/sync/setSyncMode",{mode:parseInt(i.value,10)},()=>{i.value==="1"&&window.siyuan.config.sync.provider===0&&window.siyuan.config.system.container!=="docker"?n.parentElement.classList.remove("fn__none"):n.parentElement.classList.add("fn__none"),i.value==="1"?e.parentElement.classList.remove("fn__none"):e.parentElement.classList.add("fn__none"),window.siyuan.config.sync.mode=parseInt(i.value,10)})});const s=ai.element.querySelector("#reposCloudSyncList"),r=ai.element.querySelector("#syncProvider");r.addEventListener("change",()=>{ae("/api/sync/setSyncProvider",{provider:parseInt(r.value,10)},l=>{l.code===1?(Q(l.msg),r.value="0",window.siyuan.config.sync.provider=0):window.siyuan.config.sync.provider=parseInt(r.value,10),ai.element.querySelector("#syncProviderPanel").innerHTML=KE(window.siyuan.config.sync.provider),XE(),s.innerHTML="",s.classList.add("fn__none"),window.siyuan.config.sync.mode!==1||window.siyuan.config.system.container==="docker"||window.siyuan.config.sync.provider!==0?n.parentElement.classList.add("fn__none"):n.parentElement.classList.remove("fn__none"),window.siyuan.config.sync.mode!==1?e.parentElement.classList.add("fn__none"):e.parentElement.classList.remove("fn__none")})});const o=ai.element.querySelector("#reposLoading");o.style.width=ai.element.clientWidth+"px",o.style.height=ai.element.clientHeight+"px",FL(s),ai.element.firstElementChild.addEventListener("click",l=>{let c=l.target;for(;c&&c!==ai.element;){const d=c.getAttribute("data-action");if(d==="config"){s.classList.contains("fn__none")?(Qg(s,!0),s.classList.remove("fn__none")):s.classList.add("fn__none");break}else if(d==="togglePassword"){const u=c.firstElementChild.getAttribute("xlink:href")==="#iconEye";c.firstElementChild.setAttribute("xlink:href",u?"#iconEyeoff":"#iconEye"),c.previousElementSibling.setAttribute("type",u?"text":"password");break}else if(d==="exportData"){ae(c.getAttribute("data-type")==="s3"?"/api/sync/exportSyncProviderS3":"/api/sync/exportSyncProviderWebDAV",{},u=>{$e(u.data.zip)});break}else if(d==="purgeData"){Sn("\u267B\uFE0F "+window.siyuan.languages.cloudStoragePurge,`<div class="b3-typography">${window.siyuan.languages.cloudStoragePurgeConfirm}</div>`,()=>{ae("/api/repo/purgeCloudRepo")});break}c=c.parentElement}})}},MV=t=>{if(IE({code:2,msg:""}),t===0)document.querySelector('.config__tab-container[data-name="account"] #refresh').dispatchEvent(new Event("click"));else{let e="";switch(t){case-1:e="Invalid cloud region.";break;case-2:e="Server communication failed, need to retry.";break;case-3:e="Non-iOS device.";break;case-4:e="Account not logged in.";break;case-5:e="Account status abnormal.";break;case-6:e="Parameter error.";break;case-7:e="AccountToken verification failed.";break;case-8:e="Transaction verification failed.";break;case-9:e="Unknown product.";break;case-10:e="User canceled the transaction.";break;case-11:e="Purchase transaction was suspended.";break;case-12:e="Purchase failed.";break}Q(e,0,"error")}},FV=t=>{window.siyuan.user?ae("/api/setting/getCloudUser",{token:window.siyuan.user.userToken},e=>{if(window.siyuan.user.userSiYuanOneTimePayStatus!==e.data.userSiYuanOneTimePayStatus||window.siyuan.user.userSiYuanProExpireTime!==e.data.userSiYuanProExpireTime||window.siyuan.user.userSiYuanSubscriptionPlan!==e.data.userSiYuanSubscriptionPlan||window.siyuan.user.userSiYuanSubscriptionType!==e.data.userSiYuanSubscriptionType||window.siyuan.user.userSiYuanSubscriptionStatus!==e.data.userSiYuanSubscriptionStatus){Q(window.siyuan.languages._kernel[19]);return}window.siyuan.user=e.data;let n;window.siyuan.config.cloudRegion===0?n=t==="function"?"china00":"china02":n=t==="function"?"00":"02",window.webkit.messageHandlers.purchase.postMessage(`${n} ${K().substring(0,19)}${window.siyuan.config.cloudRegion}00${window.siyuan.user.userId.substring(0,1)}-${window.siyuan.user.userId.substring(1)}`),IE({code:1,msg:""})}):Q(window.siyuan.languages.needLogin)},Sw=t=>{const e=document.cookie.split(";");for(let n of e){const[a,i]=n.trim().split("=");if(a===t)return i}return null},cp=()=>{let t="";const e=[];return document.querySelectorAll("body > svg > defs > symbol").forEach(n=>{e.push(n.id)}),Array.from({length:45},()=>{const n=Math.floor(Math.random()*e.length);t+=`<svg><use xlink:href="#${e[n]}"></use></svg>`,e.splice(n,1)}),`<div class="fn__flex config-account__svg">${t}</div>`},ii={element:void 0,genHTML:(t=!1)=>{var e,n;const a=Xt();let i;if(a?((e=window.siyuan.user)==null?void 0:e.userSiYuanOneTimePayStatus)===1?i=`<button class="b3-button b3-button--big" data-action="iOSPay" data-type="subscribe">
    <svg><use xlink:href="#iconVIP"></use></svg>${window.siyuan.languages.account4}
</button>`:i=`<button class="b3-button b3-button--big" data-action="iOSPay" data-type="subscribe">
    <svg><use xlink:href="#iconVIP"></use></svg>${window.siyuan.languages.account10}
</button>
<div class="fn__hr"></div>
<button class="b3-button b3-button--success" data-action="iOSPay" data-type="function">
    <svg><use xlink:href="#iconVIP"></use></svg>${window.siyuan.languages.onepay}
</button>`:i=`<a class="b3-button b3-button--big" href="${SL("pricing.html")}" target="_blank">
    <svg><use xlink:href="#iconVIP"></use></svg>${window.siyuan.languages[((n=window.siyuan.user)==null?void 0:n.userSiYuanOneTimePayStatus)===1?"account4":"account1"]}
</a>`,i+=`<div class="fn__hr--b"></div>
<span class="b3-chip b3-chip--primary b3-chip--hover${window.siyuan.user&&window.siyuan.user.userSiYuanSubscriptionStatus===2?" fn__none":""}" id="trialSub">
    <svg class="ft__secondary"><use xlink:href="#iconVIP"></use></svg>
    ${window.siyuan.languages.freeSub}
</span>
<div class="fn__hr${window.siyuan.user&&window.siyuan.user.userSiYuanSubscriptionStatus===2?" fn__none":""}"></div>
<a href="${ks("sponsor")}" target="_blank" class="${a?"fn__none ":""}b3-chip b3-chip--pink b3-chip--hover">
    <svg version='1.1' xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'><path fill='#ffe43c' d='M6.4 0h19.2c4.268 0 6.4 2.132 6.4 6.4v19.2c0 4.268-2.132 6.4-6.4 6.4h-19.2c-4.268 0-6.4-2.132-6.4-6.4v-19.2c0-4.268 2.135-6.4 6.4-6.4z'></path> <path fill='#00f5d4' d='M25.6 0h-8.903c-7.762 1.894-14.043 7.579-16.697 15.113v10.487c0 3.533 2.867 6.4 6.4 6.4h19.2c3.533 0 6.4-2.867 6.4-6.4v-19.2c0-3.537-2.863-6.4-6.4-6.4z'></path> <path fill='#01beff' d='M25.6 0h-0.119c-12.739 2.754-20.833 15.316-18.079 28.054 0.293 1.35 0.702 2.667 1.224 3.946h16.974c3.533 0 6.4-2.867 6.4-6.4v-19.2c0-3.537-2.863-6.4-6.4-6.4z'></path> <path fill='#9a5ce5' d='M31.005 2.966c-0.457-0.722-1.060-1.353-1.784-1.849-8.342 3.865-13.683 12.223-13.679 21.416-0.003 3.256 0.67 6.481 1.978 9.463h8.081c0.602 0 1.185-0.084 1.736-0.238-2.1-3.189-3.401-7.624-3.401-12.526 0-7.337 2.921-13.628 7.070-16.266z'></path> <path fill='#f15bb5' d='M32 25.6v-19.2c0-1.234-0.354-2.419-0.998-3.43-4.149 2.638-7.067 8.928-7.067 16.266 0 4.902 1.301 9.334 3.401 12.526 2.693-0.757 4.664-3.231 4.664-6.162z'></path> <path fill='#fff' opacity='0.2' d='M26.972 22.415c-2.889 0.815-4.297 2.21-6.281 3.182 1.552 0.348 3.105 0.461 4.902 0.461 2.644 0 5.363-1.449 6.406-2.519v-1.085c-1.598-0.399-2.664-0.705-5.028-0.039zM4.773 21.612c-0.003 0-0.006-0.003-0.006-0.003-1.726-0.863-3.382-1.205-4.767-1.301v2.487c0.779-0.341 2.396-0.921 4.773-1.182zM17.158 26.599c1.472-0.158 2.57-0.531 3.533-1.002-1.063-0.238-2.126-0.583-3.269-1.079-2.767-1.205-5.63-3.092-10.491-3.034-0.779 0.010-1.495 0.058-2.158 0.132 4.503 2.248 7.882 5.463 12.384 4.983z'></path> <path fill='#fff' opacity='0.2' d='M20.691 25.594c-0.963 0.47-2.061 0.844-3.533 1.002-4.503 0.483-7.882-2.731-12.381-4.983-2.38 0.261-3.994 0.841-4.773 1.179v2.809c0 4.268 2.132 6.4 6.4 6.4h19.197c4.268 0 6.4-2.132 6.4-6.4v-2.065c-1.044 1.069-3.762 2.519-6.406 2.519-1.797 0-3.35-0.113-4.902-0.461z'></path> <path fill='#fff' opacity='0.5' d='M3.479 19.123c0 0.334 0.271 0.606 0.606 0.606s0.606-0.271 0.606-0.606v0c0-0.334-0.271-0.606-0.606-0.606s-0.606 0.271-0.606 0.606v0z'></path> <path fill='#fff' opacity='0.5' d='M29.027 14.266c0 0.334 0.271 0.606 0.606 0.606s0.606-0.271 0.606-0.606v0c0-0.334-0.271-0.606-0.606-0.606s-0.606 0.271-0.606 0.606v0z'></path> <path fill='#fff' d='M9.904 1.688c0 0.167 0.136 0.303 0.303 0.303s0.303-0.136 0.303-0.303v0c0-0.167-0.136-0.303-0.303-0.303s-0.303 0.136-0.303 0.303v0z'></path> <path fill='#fff' d='M2.673 10.468c0 0.167 0.136 0.303 0.303 0.303s0.303-0.136 0.303-0.303v0c0-0.167-0.136-0.303-0.303-0.303s-0.303 0.136-0.303 0.303v0z'></path> <path fill='#fff' opacity='0.6' d='M30.702 9.376c0 0.167 0.136 0.303 0.303 0.303s0.303-0.136 0.303-0.303v0c0-0.167-0.136-0.303-0.303-0.303s-0.303 0.136-0.303 0.303v0z'></path> <path fill='#fff' opacity='0.8' d='M29.236 20.881c0 0.276 0.224 0.499 0.499 0.499s0.499-0.224 0.499-0.499v0c0-0.276-0.224-0.499-0.499-0.499s-0.499 0.224-0.499 0.499v0z'></path> <path fill='#fff' opacity='0.8' d='M15.38 1.591c0.047 0.016 0.101 0.026 0.158 0.026 0.276 0 0.499-0.224 0.499-0.499 0-0.219-0.141-0.406-0.338-0.473l-0.004-0.001c-0.047-0.016-0.101-0.026-0.158-0.026-0.276 0-0.499 0.224-0.499 0.499 0 0.219 0.141 0.406 0.338 0.473l0.004 0.001z'></path> <path fill='#ffdeeb' d='M25.732 8.268c-2.393-2.371-6.249-2.371-8.642 0l-1.089 1.085-1.079-1.089c-2.38-2.39-6.249-2.393-8.639-0.013s-2.393 6.249-0.013 8.639l2.158 2.158 6.474 6.464c0.596 0.593 1.562 0.593 2.158 0l6.474-6.464 2.193-2.158c2.384-2.383 2.384-6.242 0.003-8.622z'></path> <path fill='#fff' d='M17.081 8.268l-1.079 1.085-1.079-1.089c-2.38-2.39-6.249-2.393-8.639-0.013s-2.393 6.249-0.013 8.639l2.158 2.158 2.548 2.487c4.097-1.044 7.627-3.646 9.837-7.254 1.424-2.271 2.284-4.848 2.503-7.518-2.193-0.715-4.606-0.132-6.236 1.504z'></path> </svg>
    ${window.siyuan.languages.sponsor}
</a>
<div class="fn__hr--b"></div>
<div class="fn__flex-1"></div>
<div>
${window.siyuan.languages.accountSupport1}
</div>
<div class="fn__hr--b"></div>
<div>
${window.siyuan.languages.accountSupport2}
</div>`,t)return`<div class="fn__flex-1 fn__hr--b"></div>
${cp()}
<div class="fn__flex-1 fn__hr--b"></div>    
${i}
<div class="fn__flex-1 fn__hr--b"></div>
${cp()}
<div class="fn__flex-1 fn__hr--b"></div>`;if(localStorage.getItem("siyuan_token")||Sw("siyuan_token")){let r=null;try{const o=localStorage.getItem("siyuan_user");o&&(r=JSON.parse(o))}catch(o){console.error("Failed to parse web user data:",o)}if(r){const l=(d=>{const u=["linear-gradient(135deg, #667eea 0%, #764ba2 100%)","linear-gradient(135deg, #f093fb 0%, #f5576c 100%)","linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)","linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)","linear-gradient(135deg, #fa709a 0%, #fee140 100%)","linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)","linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)","linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)"],g=d?d.charCodeAt(0)%u.length:0;return u[g]})(r.username||""),c=r.username?r.username.charAt(0).toUpperCase():"U";return`<div class="fn__flex config-account" style="height: 100%; background: var(--b3-theme-background);">
    <!-- \u5DE6\u4FA7\uFF1A\u7528\u6237\u8D44\u6599\u5361\u7247 -->
    <div class="config-account__center" style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding: 40px 24px; overflow: auto;">
        <!-- \u5934\u50CF\u533A\u57DF -->
        <div style="position: relative; margin-bottom: 24px;">
            <div style="width: 120px; height: 120px; border-radius: 50%; background: ${l}; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3); border: 4px solid var(--b3-theme-surface);">
                <span style="color: white; font-size: 48px; font-weight: 600; text-shadow: 0 2px 4px rgba(0,0,0,0.1);">${c}</span>
            </div>
            <div style="position: absolute; bottom: 4px; right: 4px; width: 24px; height: 24px; background: #22c55e; border-radius: 50%; border: 3px solid var(--b3-theme-surface);"></div>
        </div>
        
        <!-- \u7528\u6237\u540D -->
        <h2 style="margin: 0 0 8px 0; font-size: 24px; font-weight: 600; color: var(--b3-theme-on-background);">${r.username||"Unknown"}</h2>
        <span style="display: inline-flex; align-items: center; padding: 4px 12px; background: var(--b3-theme-primary-lightest); color: var(--b3-theme-primary); border-radius: 20px; font-size: 12px; font-weight: 500;">
            <svg style="width: 14px; height: 14px; margin-right: 4px;"><use xlink:href="#iconAccount"></use></svg>
            \u7EDF\u4E00\u6CE8\u518C\u670D\u52A1
        </span>
        
        <!-- \u64CD\u4F5C\u6309\u94AE -->
        <div style="display: flex; gap: 12px; margin-top: 24px;">
            <button class="b3-button b3-button--outline" id="refreshWebProfile" style="display: flex; align-items: center; gap: 6px; padding: 8px 20px; border-radius: 8px;">
                <svg style="width: 16px; height: 16px;"><use xlink:href="#iconRefresh"></use></svg>
                \u5237\u65B0
            </button>
            <button class="b3-button b3-button--cancel" id="logoutWeb" style="display: flex; align-items: center; gap: 6px; padding: 8px 20px; border-radius: 8px;">
                <svg style="width: 16px; height: 16px;"><use xlink:href="#iconClose"></use></svg>
                ${window.siyuan.languages.logout}
            </button>
        </div>
        
        <!-- \u4FE1\u606F\u5361\u7247 -->
        <div style="width: 100%; max-width: 400px; margin-top: 32px; background: var(--b3-theme-surface); border-radius: 16px; padding: 24px; box-shadow: 0 2px 12px rgba(0,0,0,0.04);">
            <!-- \u7528\u6237\u540D -->
            <div style="display: flex; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--b3-border-color);">
                <div style="width: 40px; height: 40px; border-radius: 10px; background: var(--b3-theme-primary-lightest); display: flex; align-items: center; justify-content: center; margin-right: 16px;">
                    <svg style="width: 20px; height: 20px; color: var(--b3-theme-primary);"><use xlink:href="#iconAccount"></use></svg>
                </div>
                <div style="flex: 1;">
                    <div style="font-size: 12px; color: var(--b3-theme-on-surface-light); margin-bottom: 4px;">\u7528\u6237\u540D</div>
                    <div style="font-size: 15px; color: var(--b3-theme-on-background); font-weight: 500;">${r.username||"N/A"}</div>
                </div>
            </div>
            
            <!-- \u90AE\u7BB1 -->
            <div style="display: flex; align-items: center; padding: 16px 0;">
                <div style="width: 40px; height: 40px; border-radius: 10px; background: rgba(34, 197, 94, 0.1); display: flex; align-items: center; justify-content: center; margin-right: 16px;">
                    <svg style="width: 20px; height: 20px; color: #22c55e;"><use xlink:href="#iconEmail"></use></svg>
                </div>
                <div style="flex: 1;">
                    <div style="font-size: 12px; color: var(--b3-theme-on-surface-light); margin-bottom: 4px;">\u90AE\u7BB1\u5730\u5740</div>
                    <div style="font-size: 15px; color: var(--b3-theme-on-background); font-weight: 500;">${r.email||"N/A"}</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- \u53F3\u4FA7\uFF1A\u8BF4\u660E\u533A\u57DF -->
    <div class="config-account__center config-account__center--text" style="flex: 1; display: flex; flex-direction: column; justify-content: center; padding: 40px; background: var(--b3-theme-surface); overflow: auto;">
        <div style="max-width: 360px; margin: 0 auto;">
            ${cp()}
            <div style="margin: 32px 0;">
                <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600; color: var(--b3-theme-on-background);">
                    <svg style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;"><use xlink:href="#iconInfo"></use></svg>
                    \u5173\u4E8E\u7EDF\u4E00\u6CE8\u518C\u670D\u52A1
                </h3>
                <p style="margin: 0; font-size: 14px; line-height: 1.8; color: var(--b3-theme-on-surface);">
                    \u60A8\u7684\u8D26\u6237\u7531<strong style="color: var(--b3-theme-primary);">\u7EDF\u4E00\u6CE8\u518C\u670D\u52A1</strong>\u7BA1\u7406\uFF0C\u53EF\u4EE5\u5728\u591A\u4E2A\u5E94\u7528\u4E4B\u95F4\u5171\u4EAB\u767B\u5F55\u72B6\u6001\u3002
                </p>
                <div style="margin-top: 20px; padding: 16px; background: var(--b3-theme-background); border-radius: 12px; border-left: 4px solid var(--b3-theme-primary);">
                    <div style="font-size: 13px; color: var(--b3-theme-on-surface-light);">
                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                            <svg style="width: 16px; height: 16px; margin-right: 8px; color: var(--b3-theme-primary);"><use xlink:href="#iconMark"></use></svg>
                            \u7075\u67A2\u7B14\u8BB0
                        </div>
                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                            <svg style="width: 16px; height: 16px; margin-right: 8px; color: var(--b3-theme-primary);"><use xlink:href="#iconMark"></use></svg>
                            \u667A\u80FD\u65E5\u5386
                        </div>
                        <div style="display: flex; align-items: center;">
                            <svg style="width: 16px; height: 16px; margin-right: 8px; color: var(--b3-theme-primary);"><use xlink:href="#iconMark"></use></svg>
                            \u66F4\u591A\u5E94\u7528...
                        </div>
                    </div>
                </div>
            </div>
            ${cp()}
        </div>
    </div>
</div>`}}if(window.siyuan.user){let r="";window.siyuan.user.userTitles.length>0&&(r='<div class="b3-chips" style="position: absolute">',window.siyuan.user.userTitles.forEach(c=>{r+=`<div class="b3-chip b3-chip--middle b3-chip--primary">${c.icon} ${c.name}</div>`}),r+="</div>");let o="",l=a?"":`<div class="b3-form__icon fn__block">
   <svg class="ft__secondary b3-form__icon-icon"><use xlink:href="#iconVIP"></use></svg>
   <input class="b3-text-field fn__block b3-form__icon-input" style="padding-right: 44px;" placeholder="${window.siyuan.languages.activationCodePlaceholder}">
   <button id="activationCode" class="b3-button b3-button--text" style="position: absolute;right: 0;top: 0;">${window.siyuan.languages.confirm}</button>
</div>`;if(window.siyuan.user.userSiYuanProExpireTime===-1)l="",o=`<div class="b3-chip b3-chip--secondary">${p.SIYUAN_IMAGE_VIP}${window.siyuan.languages.account12}</div>`;else if(window.siyuan.user.userSiYuanProExpireTime>0){const c=`<div class="fn__hr--b"></div>
<div class="ft__on-surface ft__smaller">
    ${window.siyuan.languages.account6} 
    ${Math.max(0,Math.floor((window.siyuan.user.userSiYuanProExpireTime-new Date().getTime())/1e3/60/60/24))} 
    ${window.siyuan.languages.day} 
    ${a?`<a href="javascript:void(0)" data-action="iOSPay" data-type="subscribe">${window.siyuan.languages.clickMeToRenew}</a>`:`<a href="${ks("subscribe/siyuan")}" target="_blank">${window.siyuan.languages.clickMeToRenew}</a>`}
</div>`;window.siyuan.user.userSiYuanOneTimePayStatus===1&&(o=`<div class="b3-chip b3-chip--success"><svg><use xlink:href="#iconVIP"></use></svg>${window.siyuan.languages.account7}</div>
<div class="fn__hr--b"></div>`),window.siyuan.user.userSiYuanSubscriptionPlan===2?o+=`<div class="b3-chip b3-chip--primary"><svg><use xlink:href="#iconVIP"></use></svg>${window.siyuan.languages.account3}</div>
${c}<div class="fn__hr--b"></div>`:o+=`<div class="b3-chip b3-chip--primary"><svg class="ft__secondary"><use xlink:href="#iconVIP"></use></svg>${window.siyuan.languages.account8}</div>
${c}<div class="fn__hr--b"></div>`,window.siyuan.user.userSiYuanOneTimePayStatus===0&&(o+=a?`<button class="b3-button b3-button--success" data-action="iOSPay" data-type="function">
    <svg><use xlink:href="#iconVIP"></use></svg>${window.siyuan.languages.onepay}
</button>`:`<a class="b3-button b3-button--success" href="${SL("pricing.html")}" target="_blank">
    <svg><use xlink:href="#iconVIP"></use></svg>${window.siyuan.languages.onepay}
</a>`)}else window.siyuan.user.userSiYuanOneTimePayStatus===1?o=`<div class="b3-chip b3-chip--success"><svg><use xlink:href="#iconVIP"></use></svg>${window.siyuan.languages.account7}</div>
<div class="fn__hr--b"></div>${i}`:o=i;return`<div class="fn__flex config-account">
<div class="config-account__center">
    <div class="config-account__bg">
        <div class="config-account__cover" style="background-image: url(${window.siyuan.user.userHomeBImgURL})"></div>
        <a href="${ks("settings/avatar")}" class="config-account__avatar" style="background-image: url(${window.siyuan.user.userAvatarURL})" target="_blank"></a>
        <h1 class="config-account__name">
            <a target="_blank" class="fn__a" href="${ks("member/"+window.siyuan.user.userName)}">${window.siyuan.user.userName}</a>
            <span class="ft__on-surface ft__smaller">${window.siyuan.config.cloudRegion===0?"ld246.com":"liuyun.io"}</span>
        </h1>
        ${r}
    </div>
    <div class="config-account__info">
        <div class="fn__flex">
            <a class="b3-button b3-button--text${a?" fn__none":""}" href="${ks("settings")}" target="_blank">${window.siyuan.languages.manage}</a>
            <span class="fn__space${a?" fn__none":""}"></span>
            <button class="b3-button b3-button--cancel" id="logout">
                ${window.siyuan.languages.logout}
            </button>
            <span class="fn__space"></span>
            <button class="b3-button b3-button--cancel${window.siyuan.config.system.container==="ios"?"":" fn__none"}" id="deactivateUser">
                ${window.siyuan.languages.deactivateUser}
            </button>
            <span class="fn__flex-1"></span>
            <button class="b3-button b3-button--cancel b3-tooltips b3-tooltips__n" id="refresh" aria-label="${window.siyuan.languages.refresh}">
                <svg style="margin-right: 0"><use xlink:href="#iconRefresh"></use></svg>
            </button>
        </div>
        <div class="fn__hr--b"></div>
        <div class="fn__flex">  
            <label>
                ${window.siyuan.languages.accountDisplayTitle}
                <input class="b3-switch fn__flex-center" id="displayTitle" type="checkbox"${window.siyuan.config.account.displayTitle?" checked":""}/>
            </label>
            <div class="fn__flex-1"></div>
            <label>
                ${window.siyuan.languages.accountDisplayVIP}
                <input class="b3-switch fn__flex-center" id="displayVIP" type="checkbox"${window.siyuan.config.account.displayVIP?" checked":""}/>
            </label>
        </div>
    </div>
</div>
<div class="config-account__center config-account__center--text">
    <div class="fn__flex-1 fn__hr--b"></div>
    ${o}
    <div class="fn__flex-1 fn__hr--b"></div>
    ${l}
</div></div>`}return`<div class="fn__flex config-account" style="height: 100%; background: var(--b3-theme-background);">
    <!-- \u5DE6\u4FA7\uFF1A\u767B\u5F55\u63D0\u793A -->
    <div class="config-account__center" style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 24px;">
        <div style="text-align: center; max-width: 360px;">
            <!-- \u56FE\u6807 -->
            <div style="width: 100px; height: 100px; margin: 0 auto 24px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);">
                <svg style="width: 48px; height: 48px; color: white;"><use xlink:href="#iconAccount"></use></svg>
            </div>
            
            <!-- \u6807\u9898 -->
            <h2 style="margin: 0 0 12px 0; font-size: 24px; font-weight: 600; color: var(--b3-theme-on-background);">\u6B22\u8FCE\u4F7F\u7528\u7075\u67A2\u7B14\u8BB0</h2>
            <p style="margin: 0 0 32px 0; font-size: 15px; line-height: 1.6; color: var(--b3-theme-on-surface);">
                \u767B\u5F55\u60A8\u7684\u8D26\u6237\u4EE5\u540C\u6B65\u6570\u636E\u548C\u8BBF\u95EE\u66F4\u591A\u529F\u80FD
            </p>
            
            <!-- \u767B\u5F55\u6309\u94AE -->
            <button class="b3-button b3-button--big" onclick="window.location.href='/stage/login.html'" style="width: 100%; padding: 14px 32px; border-radius: 12px; font-size: 16px; font-weight: 500; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);">
                <svg style="width: 18px; height: 18px; margin-right: 8px;"><use xlink:href="#iconAccount"></use></svg>
                \u7ACB\u5373\u767B\u5F55
            </button>
            
            <p style="margin: 16px 0 0 0; font-size: 13px; color: var(--b3-theme-on-surface-light);">
                \u8FD8\u6CA1\u6709\u8D26\u6237\uFF1F<a href="/stage/register.html" style="color: var(--b3-theme-primary); text-decoration: none; font-weight: 500;">\u7ACB\u5373\u6CE8\u518C</a>
            </p>
        </div>
    </div>
    
    <!-- \u53F3\u4FA7\uFF1A\u8BF4\u660E\u533A\u57DF -->
    <div class="config-account__center config-account__center--text" style="flex: 1; display: flex; flex-direction: column; justify-content: center; padding: 40px; background: var(--b3-theme-surface); overflow: auto;">
        <div style="max-width: 360px; margin: 0 auto;">
            ${cp()}
            <div style="margin: 32px 0;">
                <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600; color: var(--b3-theme-on-background);">
                    <svg style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;"><use xlink:href="#iconInfo"></use></svg>
                    \u5173\u4E8E\u7EDF\u4E00\u6CE8\u518C\u670D\u52A1
                </h3>
                <p style="margin: 0; font-size: 14px; line-height: 1.8; color: var(--b3-theme-on-surface);">
                    \u7075\u67A2\u7B14\u8BB0\u4F7F\u7528<strong style="color: var(--b3-theme-primary);">\u7EDF\u4E00\u6CE8\u518C\u670D\u52A1</strong>\u8FDB\u884C\u8D26\u6237\u7BA1\u7406\uFF0C\u4E00\u4E2A\u8D26\u6237\u5373\u53EF\u767B\u5F55\u591A\u4E2A\u5E94\u7528\u3002
                </p>
                <div style="margin-top: 20px; padding: 16px; background: var(--b3-theme-background); border-radius: 12px; border-left: 4px solid var(--b3-theme-primary);">
                    <div style="font-size: 13px; color: var(--b3-theme-on-surface-light);">
                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                            <svg style="width: 16px; height: 16px; margin-right: 8px; color: var(--b3-theme-primary);"><use xlink:href="#iconMark"></use></svg>
                            \u7075\u67A2\u7B14\u8BB0
                        </div>
                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                            <svg style="width: 16px; height: 16px; margin-right: 8px; color: var(--b3-theme-primary);"><use xlink:href="#iconMark"></use></svg>
                            \u667A\u80FD\u65E5\u5386
                        </div>
                        <div style="display: flex; align-items: center;">
                            <svg style="width: 16px; height: 16px; margin-right: 8px; color: var(--b3-theme-primary);"><use xlink:href="#iconMark"></use></svg>
                            \u66F4\u591A\u5E94\u7528...
                        </div>
                    </div>
                </div>
            </div>
            ${cp()}
        </div>
    </div>
</div>`},bindEvent:t=>{const e=t.querySelector("#logoutWeb");e&&e.addEventListener("click",()=>{if(!confirm(`\u786E\u5B9A\u8981\u9000\u51FA\u767B\u5F55\u5417\uFF1F

\u9000\u51FA\u540E\u60A8\u53EF\u4EE5\u5207\u6362\u5230\u5176\u4ED6\u8D26\u6237\u767B\u5F55\u3002`))return;(localStorage.getItem("siyuan_token")||Sw("siyuan_token"))&&ae("/api/web/auth/logout",{},()=>{localStorage.removeItem("siyuan_token"),localStorage.removeItem("siyuan_user"),document.cookie="siyuan_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",Q("\u5DF2\u9000\u51FA\u767B\u5F55",3e3),setTimeout(()=>{window.location.href="/stage/login.html"},1e3)})});const n=t.querySelector("#refreshWebProfile");n&&n.addEventListener("click",()=>{(localStorage.getItem("siyuan_token")||Sw("siyuan_token"))&&ae("/api/web/auth/profile",{},y=>{y.code===0&&y.data&&(localStorage.setItem("siyuan_user",JSON.stringify(y.data)),t.innerHTML=ii.genHTML(),ii.bindEvent(t),Q("\u8D26\u6237\u4FE1\u606F\u5DF2\u5237\u65B0",3e3))})}),t.querySelectorAll('[data-action="iOSPay"]').forEach(b=>{b.addEventListener("click",()=>{FV(b.getAttribute("data-type"))})});const a=t.querySelector("#trialSub");a&&a.addEventListener("click",()=>{ae("/api/account/startFreeTrial",{},()=>{const b=t.querySelector("#refresh");b&&b.dispatchEvent(new Event("click"))})});const i=t.querySelector("#agreeLogin"),s=t.querySelector("#userName");if((localStorage.getItem("siyuan_token")||Sw("siyuan_token"))&&t.querySelector("#logoutWeb"))return;if(!s){const b=t.querySelector("#refresh");if(!b)return;b.addEventListener("click",()=>{const U=b.firstElementChild;U.classList.contains("fn__rotate")||(U.classList.add("fn__rotate"),ae("/api/setting/getCloudUser",{token:window.siyuan.user.userToken},ee=>{window.siyuan.user=ee.data,t.innerHTML=ii.genHTML(),ii.bindEvent(t),Q(window.siyuan.languages.refreshUser,3e3),ii.onSetaccount(),Ao()}))});const y=t.querySelector("#logout");y&&y.addEventListener("click",()=>{ae("/api/setting/logoutCloudUser",{},()=>{ae("/api/setting/getCloudUser",{},U=>{window.siyuan.user=U.data,t.innerHTML=ii.genHTML(),ii.bindEvent(t),ii.onSetaccount(),Ao()})})});const _=t.querySelector("#deactivateUser");_&&_.addEventListener(Ne(),()=>{Sn("\u26A0\uFE0F "+window.siyuan.languages.deactivateUser,window.siyuan.languages.deactivateUserTip,()=>{ae("/api/account/deactivate",{},()=>{window.siyuan.user=null,t.innerHTML=ii.genHTML(),ii.bindEvent(t),ii.onSetaccount(),Ao()})})}),t.querySelectorAll("input[type='checkbox']").forEach(U=>{U.addEventListener("change",()=>{ae("/api/setting/setAccount",{displayTitle:t.querySelector("#displayTitle").checked,displayVIP:t.querySelector("#displayVIP").checked},ee=>{window.siyuan.config.account.displayTitle=ee.data.displayTitle,window.siyuan.config.account.displayVIP=ee.data.displayVIP,ii.onSetaccount()})})});const v=t.querySelector("#activationCode");v==null||v.addEventListener("click",()=>{const U=v.previousElementSibling;ae("/api/account/checkActivationcode",{data:U.value},ee=>{ee.code!==0&&(U.value=""),Sn(window.siyuan.languages.activationCode,ee.msg,()=>{ee.code===0&&ae("/api/account/useActivationcode",{data:v.previousElementSibling.value},()=>{b.dispatchEvent(new CustomEvent("click"))})})})});return}const o=t.querySelector("#userPassword"),l=t.querySelector("#captchaImg"),c=t.querySelector("#captcha"),d=t.querySelector("#twofactorAuthCode"),u=t.querySelector("#login"),g=t.querySelector("#login2");i.addEventListener("click",()=>{i.checked?u.removeAttribute("disabled"):u.setAttribute("disabled","disabled")}),s.focus(),s.addEventListener("keydown",b=>{if(b.isComposing){b.preventDefault();return}b.key==="Enter"&&(u.click(),b.preventDefault())}),d.addEventListener("keydown",b=>{if(b.isComposing){b.preventDefault();return}b.key==="Enter"&&(g.click(),b.preventDefault())}),c.addEventListener("keydown",b=>{if(b.isComposing){b.preventDefault();return}b.key==="Enter"&&(u.click(),b.preventDefault())}),o.addEventListener("keydown",b=>{if(b.isComposing){b.preventDefault();return}b.key==="Enter"&&(u.click(),b.preventDefault())});let f,h;l.addEventListener("click",()=>{l.setAttribute("src",ks("captcha")+`/login?needCaptcha=${h}&t=${new Date().getTime()}`)});const m=t.querySelector("#cloudRegion");m.addEventListener("change",()=>{window.siyuan.config.cloudRegion=parseInt(m.value),t.querySelector(".config-account__center--text").innerHTML=ii.genHTML(!0),t.querySelector("#form1").lastElementChild.innerHTML=`<a href="${ks("forget-pwd")}" class="b3-button b3-button--cancel" target="_blank">${window.siyuan.languages.forgetPassword}</a>
<span class="fn__space${window.siyuan.config.system.container==="ios"?" fn__none":""}"></span>
<a href="${ks("register")}" class="b3-button b3-button--cancel${window.siyuan.config.system.container==="ios"?" fn__none":""}" target="_blank">${window.siyuan.languages.register}</a>`}),u.addEventListener("click",()=>{ae("/api/account/login",{userName:s.value.replace(/(^\s*)|(\s*$)/g,""),userPassword:IV(o.value),captcha:c.value.replace(/(^\s*)|(\s*$)/g,""),cloudRegion:window.siyuan.config.cloudRegion},b=>{let y;if(b.code===1){if(y=Q(b.msg),b.data.needCaptcha){h=b.data.needCaptcha,c.parentElement.classList.remove("fn__none"),c.previousElementSibling.setAttribute("src",ks("captcha")+`/login?needCaptcha=${b.data.needCaptcha}`),c.value="";return}return}if(b.code===10){t.querySelector("#form1").classList.add("fn__none"),t.querySelector("#form2").classList.remove("fn__none"),d.focus(),f=b.data.token;return}ot(y),ae("/api/setting/getCloudUser",{token:b.data.token},_=>{ii._afterLogin(_,t)})})}),g.addEventListener("click",()=>{ae("/api/setting/login2faCloudUser",{code:d.value,token:f},b=>{ae("/api/setting/getCloudUser",{token:b.data.token},y=>{ii._afterLogin(y,t)})})})},_afterLogin(t,e){if(window.siyuan.user=t.data,Ao(),e.innerHTML=ii.genHTML(),ii.bindEvent(e),ii.onSetaccount(),e.getAttribute("data-action")==="go-repos")if(Ml("")&&window.siyuan.config.sync.provider===0){const n=N(e,"b3-dialog--open");n&&(n.querySelector('.b3-tab-bar [data-name="repos"]').dispatchEvent(new CustomEvent("click")),e.removeAttribute("data-action"))}else Ut(["dialog"]),kw()},onSetaccount(){ai.element&&(ai.element.innerHTML="")}},Aw=(t,e,n)=>{t.plugins.find((a,i)=>{var s,r;if(a.name===e){try{a.onunload()}catch(c){console.error(`plugin ${a.name} onunload error:`,c)}if(n){try{a.uninstall()}catch(c){console.error(`plugin ${a.name} uninstall error:`,c)}window.siyuan.storage[p.LOCAL_PLUGIN_DOCKS][a.name]={},Gt(p.LOCAL_PLUGIN_DOCKS,window.siyuan.storage[p.LOCAL_PLUGIN_DOCKS])}const o=Object.keys(a.models);Cn().custom.forEach(c=>{o.includes(c.type)&&c.parent.parent.removeTab(c.parent.id)});for(let c=0;c<a.topBarIcons.length;c++)a.topBarIcons[c].remove(),a.topBarIcons.splice(c,1),c--;return am(),a.statusBarIcons.forEach(c=>{c.remove()}),Object.keys(a.docks).forEach(c=>{Object.keys(window.siyuan.layout.leftDock.data).includes(c)?window.siyuan.layout.leftDock.remove(c):Object.keys(window.siyuan.layout.rightDock.data).includes(c)?window.siyuan.layout.rightDock.remove(c):Object.keys(window.siyuan.layout.bottomDock.data).includes(c)&&window.siyuan.layout.bottomDock.remove(c)}),Array.from(document.childNodes).find(c=>{if(c.nodeType===8&&c.textContent===e)return c.remove(),!0}),t.plugins.splice(i,1),(s=document.querySelector(`svg[data-name="${a.name}"]`))==null||s.remove(),Es().forEach(c=>{c.protyle.toolbar.update(c.protyle)}),(r=document.getElementById("pluginsStyle"+e))==null||r.remove(),!0}})};var ZE=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const vn={element:void 0,genHTML(){if(!window.siyuan.config.bazaar.trust)return`<div class="fn__flex-column">
<div class="fn__flex-1"></div>
<div class="b3-label">
    <div>${window.siyuan.languages.bazaarTrust}</div>
    <div class="fn__hr--b"></div>
    <div>${window.siyuan.languages.bazaarTrust3}</div>
</div>
<div class="fn__flex b3-label">
    <svg class="b3-label__icon"><use xlink:href="#iconEye"></use></svg>
    <div>
        ${window.siyuan.languages.bazaarTrustCodeReview}
        <div class="b3-label__text">${window.siyuan.languages.bazaarTrustCodeReviewTip}</div>
    </div>
</div>
<div class="fn__flex b3-label">
    <svg class="b3-label__icon"><use xlink:href="#iconGithub"></use></svg>
    <div>
        ${window.siyuan.languages.bazaarTrustOpenSource}
        <div class="b3-label__text">${window.siyuan.languages.bazaarTrustOpenSourceTip}</div>
    </div>
</div>
<div class="fn__flex b3-label">
    <svg class="b3-label__icon"><use xlink:href="#iconUsers"></use></svg>
    <div>
        ${window.siyuan.languages.bazaarCommunityReview}
        <div class="b3-label__text">${window.siyuan.languages.bazaarPeerReviewTip}</div>
    </div>
</div>
<div class="fn__flex b3-label">
    <svg class="b3-label__icon"><use xlink:href="#iconInfo"></use></svg>
    <div>
        ${window.siyuan.languages.bazaarUserReport}
        <div class="b3-label__text">${window.siyuan.languages.bazaarUserReportTip}</div>
    </div>
</div>
<div class="b3-label b3-label--noborder">
    <div>${window.siyuan.languages.bazaarTrust1}</div>
    <div class="fn__hr--b"></div>
    <diiv>${window.siyuan.languages.bazaarTrust2}</diiv>
</div>
<div class="ft__center b3-label b3-label--noborder">
    <button class="b3-button fn__size200">${window.siyuan.languages.trust}</button>
</div>
<div class="fn__flex-1"></div>
</div>`;const t=window.siyuan.storage[p.LOCAL_BAZAAR],e=`<div style="height: ${vn.element.clientHeight-80}px;display: flex;align-items: center;justify-content: center;"><img src="/stage/loading-pure.svg"></div>`;return`<div class="fn__flex-column" style="height: 100%">
<div class="layout-tab-bar fn__flex">
    <div data-type="downloaded" class="item item--full item--focus"><span class="fn__flex-1"></span><span class="item__text">${window.siyuan.languages.downloaded}</span><span class="fn__flex-1"></span></div>
    <div data-type="plugin" class="item item--full"><span class="fn__flex-1"></span><span class="item__text">${window.siyuan.languages.plugin}</span><span class="fn__flex-1"></span></div>
    <div data-type="theme" class="item item--full"><span class="fn__flex-1"></span><span class="item__text">${window.siyuan.languages.theme}</span><span class="fn__flex-1"></span></div>
    <div data-type="icon" class="item item--full"><span class="fn__flex-1"></span><span class="item__text">${window.siyuan.languages.icon}</span><span class="fn__flex-1"></span></div>
    <div data-type="template" class="item item--full"><span class="fn__flex-1"></span><span class="item__text">${window.siyuan.languages.template}</span><span class="fn__flex-1"></span></div>
    <div data-type="widget" class="item item--full"><span class="fn__flex-1"></span><span class="item__text">${window.siyuan.languages.widget}</span><span class="fn__flex-1"></span></div>
</div>
<div class="fn__flex-1">
    <div class="config-bazaar__panel" data-type="downloaded" data-init="true">
        <div data-type="downloaded-update"></div>
        <div class="fn__flex config-bazaar__title">
            <button data-type="myPlugin" class="b3-button">${window.siyuan.languages.plugin}</button>
            <div class="fn__space"></div>
            <button data-type="myTheme" class="b3-button b3-button--outline">${window.siyuan.languages.theme}</button>
            <div class="fn__space"></div>
            <button data-type="myIcon" class="b3-button b3-button--outline">${window.siyuan.languages.icon}</button>
            <div class="fn__space"></div>
            <button data-type="myTemplate" class="b3-button b3-button--outline">${window.siyuan.languages.template}</button>
            <div class="fn__space"></div>
            <button data-type="myWidget" class="b3-button b3-button--outline">${window.siyuan.languages.widget}</button>
            <div class="fn__space"></div>
            <div class="b3-form__icon">
                <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>
                <input class="b3-text-field b3-form__icon-input fn__block" placeholder="${window.siyuan.languages.enterKey} ${window.siyuan.languages.search}">
            </div>
            <div class="fn__space"></div>
            <div class="fn__flex-1"></div>
            <input ${window.siyuan.config.bazaar.petalDisabled?"":" checked"} data-type="plugins-enable" type="checkbox" class="b3-switch fn__flex-center" style="margin-right: 8px">
            <div class="counter counter--bg fn__none fn__flex-center b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.total}"></div>
        </div>
        <div id="configBazaarDownloaded" class="config-bazaar__content">
            ${e}
        </div>
    </div>
    <div data-type="theme" class="config-bazaar__panel fn__none">
        <div class="fn__flex config-bazaar__title">
            <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconSort"></use></svg>
            <div class="fn__space"></div>
            <select class="b3-select">
                <option ${t.theme==="0"?"selected":""} value="0">${window.siyuan.languages.sortByUpdateTimeDesc}</option>
                <option ${t.theme==="1"?"selected":""} value="1">${window.siyuan.languages.sortByUpdateTimeAsc}</option>
                <option ${t.theme==="2"?"selected":""} value="2">${window.siyuan.languages.sortByDownloadsDesc}</option>
                <option ${t.theme==="3"?"selected":""} value="3">${window.siyuan.languages.sortByDownloadsAsc}</option>
            </select>
            <div class="fn__space"></div>
            <select id="bazaarSelect" class="b3-select">
                <option selected value="2">${window.siyuan.languages.all}</option>
                <option value="0">${window.siyuan.languages.themeLight}</option>
                <option value="1">${window.siyuan.languages.themeDark}</option>
            </select>
            <div class="fn__space"></div>
            <div class="b3-form__icon">
                <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>
                <input class="b3-text-field b3-form__icon-input fn__block" placeholder="${window.siyuan.languages.enterKey} ${window.siyuan.languages.search}">
            </div>
            <div class="fn__space"></div>
            <div class="fn__flex-1"></div>
            <div class="counter counter--bg fn__flex-center b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.total}"></div>
        </div>
        <div id="configBazaarTheme" class="config-bazaar__content">
            ${e}
        </div>
    </div>
    <div class="fn__none config-bazaar__panel" data-type="template">
        <div class="fn__flex config-bazaar__title">
            <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconSort"></use></svg>
            <div class="fn__space"></div>
            <select class="b3-select">
                <option ${t.template==="0"?"selected":""} value="0">${window.siyuan.languages.sortByUpdateTimeDesc}</option>
                <option ${t.template==="1"?"selected":""} value="1">${window.siyuan.languages.sortByUpdateTimeAsc}</option>
                <option ${t.template==="2"?"selected":""} value="2">${window.siyuan.languages.sortByDownloadsDesc}</option>
                <option ${t.template==="3"?"selected":""} value="3">${window.siyuan.languages.sortByDownloadsAsc}</option>
            </select>
            <div class="fn__space"></div>
            <div class="b3-form__icon">
                <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>
                <input class="b3-text-field b3-form__icon-input fn__block" placeholder="${window.siyuan.languages.enterKey} ${window.siyuan.languages.search}">
            </div>
            <div class="fn__space"></div>
            <div class="fn__flex-1"></div>
            <div class="counter counter--bg fn__flex-center b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.total}"></div>
        </div>
        <div id="configBazaarTemplate" class="config-bazaar__content">
            ${e}
        </div>
    </div>
    <div class="fn__none config-bazaar__panel" data-type="plugin">
        <div class="fn__flex config-bazaar__title">
            <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconSort"></use></svg>
            <div class="fn__space"></div>
            <select class="b3-select">
                <option ${t.plugin==="0"?"selected":""} value="0">${window.siyuan.languages.sortByUpdateTimeDesc}</option>
                <option ${t.plugin==="1"?"selected":""} value="1">${window.siyuan.languages.sortByUpdateTimeAsc}</option>
                <option ${t.plugin==="2"?"selected":""} value="2">${window.siyuan.languages.sortByDownloadsDesc}</option>
                <option ${t.plugin==="3"?"selected":""} value="3">${window.siyuan.languages.sortByDownloadsAsc}</option>
            </select>
            <div class="fn__space"></div>
            <div class="b3-form__icon">
                <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>
                <input class="b3-text-field b3-form__icon-input fn__block" placeholder="${window.siyuan.languages.enterKey} ${window.siyuan.languages.search}">
            </div>
            <div class="fn__space"></div>
            <div class="fn__flex-1"></div>
            <div class="counter counter--bg fn__flex-center b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.total}"></div>
        </div>
        <div id="configBazaarPlugin" class="config-bazaar__content">
            ${e}
        </div>
    </div>
    <div class="fn__none config-bazaar__panel" data-type="icon">
        <div class="fn__flex config-bazaar__title">
            <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconSort"></use></svg>
            <div class="fn__space"></div>
            <select class="b3-select">
                <option ${t.icon==="0"?"selected":""} value="0">${window.siyuan.languages.sortByUpdateTimeDesc}</option>
                <option ${t.icon==="1"?"selected":""} value="1">${window.siyuan.languages.sortByUpdateTimeAsc}</option>
                <option ${t.icon==="2"?"selected":""} value="2">${window.siyuan.languages.sortByDownloadsDesc}</option>
                <option ${t.icon==="3"?"selected":""} value="3">${window.siyuan.languages.sortByDownloadsAsc}</option>
            </select>
            <div class="fn__space"></div>
            <div class="b3-form__icon">
                <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>
                <input class="b3-text-field b3-form__icon-input fn__block" placeholder="${window.siyuan.languages.enterKey} ${window.siyuan.languages.search}">
            </div>
            <div class="fn__space"></div>
            <div class="fn__flex-1"></div>
            <div class="counter counter--bg fn__flex-center b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.total}"></div>
        </div>
        <div id="configBazaarIcon" class="config-bazaar__content">
            ${e}
        </div>
    </div>
    <div class="fn__none config-bazaar__panel" data-type="widget">
        <div class="fn__flex config-bazaar__title">
            <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconSort"></use></svg>
            <div class="fn__space"></div>
            <select class="b3-select">
                <option ${t.widget==="0"?"selected":""} value="0">${window.siyuan.languages.sortByUpdateTimeDesc}</option>
                <option ${t.widget==="1"?"selected":""} value="1">${window.siyuan.languages.sortByUpdateTimeAsc}</option>
                <option ${t.widget==="2"?"selected":""} value="2">${window.siyuan.languages.sortByDownloadsDesc}</option>
                <option ${t.widget==="3"?"selected":""} value="3">${window.siyuan.languages.sortByDownloadsAsc}</option>
            </select>
            <div class="fn__space"></div>
            <div class="b3-form__icon">
                <svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg>
                <input class="b3-text-field b3-form__icon-input fn__block" placeholder="${window.siyuan.languages.enterKey} ${window.siyuan.languages.search}">
            </div>
            <div class="fn__space"></div>
            <div class="fn__flex-1"></div>
            <div class="counter counter--bg fn__flex-center b3-tooltips b3-tooltips__w" aria-label="${window.siyuan.languages.total}"></div>
        </div>
        <div id="configBazaarWidget" class="config-bazaar__content">
            ${e}
        </div>
    </div>
</div>
<div id="configBazaarReadme" class="config-bazaar__readme"></div>
</div>`},_genCardHTML(t,e){let n=!1,a="";if(e==="themes"){const r=vn.element.querySelector("#bazaarSelect").value;(r==="0"&&t.modes.includes("dark")||r==="1"&&t.modes.includes("light"))&&(n=!0),a=t.modes.toString()}let i=!1;["icons","themes"].includes(e)&&(i=!0);const s={bazaarType:e,themeMode:a,updated:t.updated,name:t.name,repoURL:t.repoURL,repoHash:t.repoHash,downloads:t.downloads,downloaded:!1};return`<div data-obj='${JSON.stringify(s)}' class="b3-card b3-card--wrap${n?" fn__none":""}${t.current?" b3-card--current":""}">
    <div class="b3-card__img">
        <img src="${t.iconURL}" onerror="this.src='/stage/images/icon.png'"/>
    </div>
    <div class="fn__flex-1 fn__flex-column">
        <div class="b3-card__info fn__flex-1">
            ${t.preferredName} <span class="ft__on-surface ft__smaller">${t.name}</span>
            <div class="b3-card__desc" title="${ft(t.preferredDesc)||""}">
                ${t.preferredDesc||""}
            </div>
        </div>
        <div class="b3-card__actions">
            <span class="block__icon block__icon--show ft__primary">
                <svg><use xlink:href="#iconDownload"></use></svg>
                <span class="fn__space"></span>
                ${t.downloads}
            </span>
            <span class="fn__space"></span>
            ${t.preferredFunding?`<a target="_blank" href="${t.preferredFunding}" class="block__icon block__icon--show ariaLabel" aria-label="${window.siyuan.languages.sponsor} ${t.preferredFunding}"><svg class="ft__pink"><use xlink:href="#iconHeart"></use></svg></a><span class="fn__space"></span>`:""}
            <div class="fn__flex-1"></div>
            <span class="b3-tooltips b3-tooltips__nw block__icon block__icon--show${t.installed?"":" fn__none"}" data-type="uninstall" aria-label="${window.siyuan.languages.uninstall}">
                <svg><use xlink:href="#iconTrashcan"></use></svg>
            </span>
            <div class="fn__space${!t.current&&t.installed&&i?"":" fn__none"}"></div>
            <span class="b3-tooltips b3-tooltips__nw block__icon block__icon--show${!t.current&&t.installed&&i?"":" fn__none"}" data-type="switch" aria-label="${window.siyuan.languages.use}">
                <svg><use xlink:href="#iconSelect"></use></svg>
            </span>
            <div class="fn__space${t.outdated?"":" fn__none"}"></div>
            <span data-type="install-t" class="b3-tooltips b3-tooltips__nw block__icon block__icon--show${t.outdated?"":" fn__none"}" aria-label="${window.siyuan.languages.update}">
                <svg class="ft__primary"><use xlink:href="#iconRefresh"></use></svg>
            </span>
        </div>
    </div>
</div>`},_genUpdateItemHTML(t,e){var n;const a={bazaarType:e,themeMode:(n=t.modes)==null?void 0:n.toString(),updated:t.updated,name:t.name,repoURL:t.repoURL,repoHash:t.repoHash,downloaded:!0};return`<div class="b3-card" data-obj='${JSON.stringify(a)}'>
    <div class="b3-card__img"><img src="${t.iconURL}" onerror="this.src='/stage/images/icon.png'"/></div>
    <div class="fn__flex-1 fn__flex-column">
        <div class="b3-card__info b3-card__info--left fn__flex-1">
            ${t.preferredName} <span class="ft__on-surface ft__smaller">${t.name}</span>
            <div class="b3-card__desc" title="${ft(t.preferredDesc)||""}">${t.preferredDesc||""}</div>
        </div>
    </div>
    <div class="b3-card__actions b3-card__actions--right">
        ${t.incompatible?`<span class="fn__space"></span><span class="fn__flex-center b3-tooltips b3-tooltips__nw b3-chip b3-chip--error b3-chip--small" aria-label="${window.siyuan.languages.incompatiblePluginTip}">${window.siyuan.languages.incompatible}</span>`:""}
        ${t.preferredFunding?`<a target="_blank" href="${t.preferredFunding}" class="block__icon block__icon--show ariaLabel" aria-label="${window.siyuan.languages.sponsor} ${t.preferredFunding}"><svg class="ft__pink"><use xlink:href="#iconHeart"></use></svg></a>`:""}
        <span class="b3-tooltips b3-tooltips__nw block__icon block__icon--show${W()?" fn__none":""}" data-type="open" aria-label="${window.siyuan.languages.showInFolder}">
            <svg><use xlink:href="#iconFolder"></use></svg>
        </span>
        <span data-type="install-t" aria-label="${window.siyuan.languages.update}" class="b3-tooltips b3-tooltips__nw block__icon block__icon--show">
            <svg class="ft__primary"><use xlink:href="#iconRefresh"></use></svg>
        </span>
    </div>
</div>`},_getUpdate(){ae("/api/bazaar/getUpdatedPackage",{frontend:C()},t=>{let e="";t.data.plugins.forEach(a=>{e+=this._genUpdateItemHTML(a,"plugins")}),t.data.themes.forEach(a=>{e+=this._genUpdateItemHTML(a,"themes")}),t.data.icons.forEach(a=>{e+=this._genUpdateItemHTML(a,"icons")}),t.data.templates.forEach(a=>{e+=this._genUpdateItemHTML(a,"templates")}),t.data.widgets.forEach(a=>{e+=this._genUpdateItemHTML(a,"widgets")}),this._data.update=t.data;const n=t.data.themes.length+t.data.icons.length+t.data.widgets.length+t.data.plugins.length+t.data.templates.length;if(n===0){this.element.querySelector('[data-type="downloaded-update"]').innerHTML="";return}this.element.querySelector('[data-type="downloaded-update"]').innerHTML=`<div class="fn__flex config-bazaar__title">
    <div class="fn__flex-1"></div>
    <button class="b3-button" data-type="install-all">${window.siyuan.languages.updateAll}</button>
    <span class="fn__space"></span>
    <div class="counter counter--bg fn__flex-center">${n}</div>
</div>
<div class="config-bazaar__content">${e}</div>`})},_genMyHTML(t,e,n=!0){var a;n&&this._getUpdate();const i=vn.element.querySelector("#configBazaarDownloaded");if(i.getAttribute("data-loading")==="true"||i.previousElementSibling.querySelector(`[data-type="my${t.replace(t[0],t[0].toUpperCase()).substring(0,t.length-1)}"]`).classList.contains("b3-button--outline"))return;i.setAttribute("data-loading","true");let s="/api/bazaar/getInstalledTheme";t==="icons"?s="/api/bazaar/getInstalledIcon":t==="widgets"?s="/api/bazaar/getInstalledWidget":t==="templates"?s="/api/bazaar/getInstalledTemplate":t==="plugins"&&(s="/api/bazaar/getInstalledPlugin"),ae(s,{frontend:C(),keyword:((a=i.previousElementSibling.querySelector(".b3-text-field"))==null?void 0:a.value)||""},r=>{i.removeAttribute("data-loading");let o="",l=!1;["icons","themes"].includes(t)&&(l=!0);const c=i.previousElementSibling.querySelector(".counter");r.data.packages.length===0?c.classList.add("fn__none"):(c.classList.remove("fn__none"),c.textContent=r.data.packages.length,r.data.packages.forEach(u=>{var g;const f={bazaarType:t,themeMode:(g=u.modes)==null?void 0:g.toString(),updated:u.updated,name:u.name,repoURL:u.repoURL,repoHash:u.repoHash,downloaded:!0};let h=!1;t==="plugins"&&e.plugins.find(m=>{if(m.name===f.name)return h=m.setting||m.__proto__.hasOwnProperty("openSetting"),!0}),o+=`<div data-obj='${JSON.stringify(f)}' class="b3-card${u.current?" b3-card--current":""}${window.siyuan.config.bazaar.petalDisabled&&t==="plugins"?" b3-card--disabled":""}">
    <div class="b3-card__img"><img src="${u.iconURL}" onerror="this.src='/stage/images/icon.png'"/></div>
    <div class="fn__flex-1 fn__flex-column">
        <div class="b3-card__info b3-card__info--left fn__flex-1">
            ${u.preferredName} <span class="ft__on-surface ft__smaller">${u.name}</span>
            <div class="b3-card__desc" title="${ft(u.preferredDesc)||""}">${u.preferredDesc||""}</div>
        </div>
    </div>
    <div class="b3-card__actions b3-card__actions--right">
        ${u.incompatible?`<span class="fn__space"></span><span class="fn__flex-center b3-tooltips b3-tooltips__nw b3-chip b3-chip--error b3-chip--small" aria-label="${window.siyuan.languages.incompatiblePluginTip}">${window.siyuan.languages.incompatible}</span>`:""}
        ${u.preferredFunding?`<a target="_blank" href="${u.preferredFunding}" class="block__icon block__icon--show ariaLabel" aria-label="${window.siyuan.languages.sponsor} ${u.preferredFunding}"><svg class="ft__pink"><use xlink:href="#iconHeart"></use></svg></a>`:""}
        <span class="b3-tooltips b3-tooltips__nw block__icon block__icon--show${h?"":" fn__none"}" data-type="setting" aria-label="${window.siyuan.languages.config}">
            <svg><use xlink:href="#iconSettings"></use></svg>
        </span>
        <span class="b3-tooltips b3-tooltips__nw block__icon block__icon--show" data-type="uninstall" aria-label="${window.siyuan.languages.uninstall}">
            <svg><use xlink:href="#iconTrashcan"></use></svg>
        </span>
        <span class="b3-tooltips b3-tooltips__nw block__icon block__icon--show${W()?" fn__none":""}" data-type="open" aria-label="${window.siyuan.languages.showInFolder}">
            <svg><use xlink:href="#iconFolder"></use></svg>
        </span>
        <span class="b3-tooltips b3-tooltips__nw block__icon block__icon--show${!u.current&&l?"":" fn__none"}" data-type="switch" aria-label="${window.siyuan.languages.use}">
            <svg><use xlink:href="#iconSelect"></use></svg>
        </span>
        <span data-type="install-t" aria-label="${window.siyuan.languages.update}" class="b3-tooltips b3-tooltips__nw block__icon block__icon--show${u.outdated?"":" fn__none"}">
            <svg class="ft__primary"><use xlink:href="#iconRefresh"></use></svg>
        </span>
        <span class="fn__space${t==="plugins"?"":" fn__none"}"></span>
        <span class="fn__space${t==="plugins"?"":" fn__none"}"></span>
        <input class="b3-switch fn__flex-center${t==="plugins"?"":" fn__none"}" ${u.enabled?"checked":""} data-type="plugin-enable" type="checkbox" ${u.incompatible?" disabled":""}>
    </div>
</div>`})),vn._data.downloaded=r.data.packages;const d=i.parentElement.querySelector(".b3-switch");t==="plugins"?d.classList.remove("fn__none"):d.classList.add("fn__none"),i.innerHTML=o||`<div class="fn__hr"></div><ul class="b3-list b3-list--background"><li class="b3-list--empty">${window.siyuan.languages.emptyContent}</li></ul>`})},_data:{themes:[],templates:[],icons:[],widgets:[],plugins:[],downloaded:[],update:{themes:[],templates:[],icons:[],widgets:[],plugins:[]}},_renderReadme(t,e,n){var a;const i=vn.element.querySelector("#configBazaarReadme"),s=e.repoURL.split("/");s.pop();let r=window.siyuan.languages.icon;t==="themes"?r=window.siyuan.languages.theme:t==="widgets"?r=window.siyuan.languages.widget:t==="templates"?r=window.siyuan.languages.template:t==="plugins"&&(r=window.siyuan.languages.plugin);const o={bazaarType:t,themeMode:(a=e.modes)==null?void 0:a.toString(),name:e.name,repoURL:e.repoURL,repoHash:e.repoHash,downloaded:n};if(i.innerHTML=` <div class="item__side" data-obj='${JSON.stringify(o)}'>
    <div class="fn__flex">
        <div style="padding-right: 8px" class="block__icon block__icon--show b3-tooltips b3-tooltips__e" data-type="goBack" aria-label="${window.siyuan.languages.back}">
            <svg><use xlink:href="#iconLeft"></use></svg>
            <span class="fn__space"></span>
            ${r}
        </div>
    </div>
    <img class="item__img" src="${e.iconURL}" onerror="this.src='/stage/images/icon.png'">
    <div>
        <a href="${e.repoURL}" target="_blank" class="item__title" title="GitHub Repo">${e.preferredName}</a>
    </div>
    <div class="fn__hr"></div>
    <div>
        <a href="${e.repoURL}" target="_blank" class="ft__on-surface ft__smaller" title="GitHub Repo">${e.name}</a>
    </div>
    <div class="block__icons">
        <span class="fn__flex-1"></span>
        ${e.preferredFunding?`<a target="_blank" href="${e.preferredFunding}" class="block__icon block__icon--show ariaLabel" aria-label="${window.siyuan.languages.sponsor} ${e.preferredFunding}"><svg class="ft__pink"><use xlink:href="#iconHeart"></use></svg></a>`:`<span class="b3-tooltips b3-tooltips__ne block__icon block__icon--show ft__primary" aria-label="${window.siyuan.languages.author}"><svg><use xlink:href="#iconAccount"></use></svg></span>`}
        <span class="fn__space"></span>
        <a href="${s.join("/")}" target="_blank" title="Creator">${e.author}</a>
        <span class="fn__flex-1"></span>
    </div>
    <div class="fn__hr--b"></div>
    <div class="fn__hr--b"></div>
    <div class="ft__on-surface ft__smaller" style="line-height: 20px;">${window.siyuan.languages.currentVer}<br>v${e.version}</div>
    <div class="fn__hr"></div>
    <div class="ft__on-surface ft__smaller" style="line-height: 20px;">${n?window.siyuan.languages.installDate:window.siyuan.languages.releaseDate}<br>${n?e.hInstallDate:e.hUpdated}</div>
    <div class="fn__hr${n?" fn__none":""}"></div>
    <div class="ft__on-surface ft__smaller${n?" fn__none":""}" style="line-height: 20px;">${window.siyuan.languages.pkgSize}<br>${e.hSize}</div>
    <div class="fn__hr"></div>
    <div class="ft__on-surface ft__smaller" style="line-height: 20px;">${window.siyuan.languages.installSize}<br>${e.hInstallSize}</div>
    <div class="fn__hr--b"></div>
    <div class="fn__hr--b"></div>
    <div${e.installed||n?' class="fn__none"':""}>
        <button class="b3-button" style="width: 168px"  data-type="install">${window.siyuan.languages.download}</button>
    </div>
    <div${e.outdated&&(e.installed||n)?"":' class="fn__none"'}>
        <button class="b3-button" style="width: 168px" data-type="install-t">${window.siyuan.languages.update}</button>
    </div>
    <div class="fn__hr--b"></div>
    <div>
        <a href="${e.repoURL}/issues" target="_blank" title="Feedback via GitHub Issues" class="b3-button b3-button--success" style="width: 168px" data-type="feedback">${window.siyuan.languages.feedback}</a>
    </div>
    <div class="fn__hr--b${n?" fn__none":""}"></div>
    <div class="fn__hr--b${n?" fn__none":""}"></div>
    <div class="fn__flex${n?" fn__none":""}" style="justify-content: center;">
        <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconGithub"></use></svg>
        <span class="fn__space"></span>
        <a href="${e.repoURL}" target="_blank" title="GitHub Repo">Repo</a>
        <span class="fn__space"></span>
        <span class="fn__space"></span>
        <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconStar"></use></svg>
        <span class="fn__space"></span>
        <a href="${e.repoURL}/stargazers" target="_blank" title="Stars">${e.stars}</a>
        <span class="fn__space"></span>
        <span class="fn__space"></span>
        <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconGitHubI"></use></svg>
        <span class="fn__space"></span>
        <a href="${e.repoURL}/issues" target="_blank" title="Open issues">${e.openIssues}</a>
        <span class="fn__space"></span>
        <span class="fn__space"></span>
        <svg class="svg ft__on-surface fn__flex-center"><use xlink:href="#iconDownload"></use></svg>
        <span class="fn__space"></span>
        ${e.downloads}
    </div>
    <div class="fn__hr--b"></div>
    <div class="fn__hr--b"></div>
    <div class="fn__flex-1"></div>
</div>
<div class="item__main">
    <div class="item__preview" style="background-image: url(${e.previewURL})"></div>
    <div class="b3-typography${e.preferredDesc?"":" fn__none"}">
        <blockquote>
            <p>
                ${e.preferredDesc||""}
            </p>
         </blockquote>
    </div>
    <div class="item__readme b3-typography b3-typography--default">
        <img data-type="img-loading" style="height: 64px;width: 100%;padding: 16px 0;" src="/stage/loading-pure.svg">
    </div>
</div>`,n&&e.preferredReadme){const l=i.querySelector(".item__readme");l.innerHTML=e.preferredReadme,ra(l)}else ae("/api/bazaar/getBazaarPackageREAME",{repoURL:e.repoURL,repoHash:e.repoHash,packageType:t},l=>{const c=i.querySelector(".item__readme");c.innerHTML=l.data.html,ra(c)});i.classList.add("config-bazaar__readme--show")},bindEvent(t){if(!window.siyuan.config.bazaar.trust){vn.element.querySelector("button").addEventListener("click",()=>{ae("/api/setting/setBazaar",{trust:!0,petalDisabled:window.siyuan.config.bazaar.petalDisabled},()=>{window.siyuan.config.bazaar.trust=!0,vn.element.innerHTML=vn.genHTML(),vn.bindEvent(t)})});return}this._genMyHTML("plugins",t),vn.element.firstElementChild.addEventListener("click",e=>{let n=e.target;const a=ue(n,"data-obj",null);let i;for(a&&(i=JSON.parse(a.getAttribute("data-obj")));n&&!n.isEqualNode(vn.element);){const s=n.getAttribute("data-type");if(n.tagName==="A")break;if(s==="open"&&i){e.preventDefault(),e.stopPropagation();break}else if(["myTheme","myTemplate","myIcon","myWidget","myPlugin"].includes(s)){n.classList.contains("b3-button--outline")&&!vn.element.querySelector("#configBazaarDownloaded").getAttribute("data-loading")&&(n.parentElement.childNodes.forEach(r=>{r.nodeType!==3&&r.classList.contains("b3-button")&&r.classList.add("b3-button--outline")}),n.classList.remove("b3-button--outline"),this._genMyHTML(s.replace("my","").toLowerCase()+"s",t,!1)),e.preventDefault(),e.stopPropagation();break}else if(s==="goBack"){vn.element.querySelector("#configBazaarReadme").classList.remove("config-bazaar__readme--show"),e.preventDefault(),e.stopPropagation();break}else if(s==="install"){if(!n.classList.contains("b3-button--progress")){const r=i.bazaarType;let o="/api/bazaar/installBazaarTemplate";r==="themes"?o="/api/bazaar/installBazaarTheme":r==="icons"?o="/api/bazaar/installBazaarIcon":r==="widgets"?o="/api/bazaar/installBazaarWidget":r==="plugins"&&(o="/api/bazaar/installBazaarPlugin"),ae(o,{keyword:vn.element.querySelector(".config-bazaar__panel:not(.fn__none) .b3-form__icon-input").value,repoURL:i.repoURL,packageName:i.name,repoHash:i.repoHash,mode:i.themeMode==="dark"?1:0,frontend:C()},l=>ZE(this,null,function*(){if(window.siyuan.config.appearance.themeJS&&r==="themes")if(window.destroyTheme){try{yield window.destroyTheme(),window.destroyTheme=void 0,document.getElementById("themeScript").remove()}catch(c){console.error("destroyTheme error: "+c)}window.siyuan.config.appearance=l.data.appearance,h_(window.siyuan.config.appearance)}else{Ss({cb(){window.location.reload()},errorExit:!1});return}vn._onBazaar(l,r,["themes","icons"].includes(r)),vn._genMyHTML(r,t,!1),r==="plugins"&&(window.siyuan.config.bazaar.petalDisabled?Sn(window.siyuan.languages.confirm,window.siyuan.languages.enablePluginTip2):Sn("\u{1F4A1} "+window.siyuan.languages.enablePlugin,window.siyuan.languages.enablePluginTip,()=>{ae("/api/petal/setPetalEnabled",{packageName:i.name,enabled:!0,frontend:C(),app:p.SIYUAN_APPID},c=>{ZL(t,c.data),vn._genMyHTML(r,t,!1)})}))}))}e.preventDefault(),e.stopPropagation();break}else if(s==="install-all"){Sn("\u2B06\uFE0F "+window.siyuan.languages.updateAll,window.siyuan.languages.confirmUpdateAll,()=>{ae("/api/bazaar/batchUpdatePackage",{frontend:C()})}),e.preventDefault(),e.stopPropagation();break}else if(s==="feedback"){e.preventDefault(),e.stopPropagation();break}else if(s==="install-t"){n.classList.contains("b3-button--progress")||Sn("\u2B06\uFE0F "+window.siyuan.languages.update,window.siyuan.languages.confirmUpdate,()=>{const r=i.bazaarType;let o="/api/bazaar/installBazaarTemplate";r==="themes"?o="/api/bazaar/installBazaarTheme":r==="icons"?o="/api/bazaar/installBazaarIcon":r==="widgets"?o="/api/bazaar/installBazaarWidget":r==="plugins"&&(o="/api/bazaar/installBazaarPlugin"),n.classList.contains("b3-button")||n.parentElement.insertAdjacentHTML("afterend",'<img data-type="img-loading" style="position: absolute;top: 0;left: 0;height: 100%;width: 100%;padding: 16px;box-sizing: border-box;" src="/stage/loading-pure.svg">'),ae(o,{keyword:vn.element.querySelector(".config-bazaar__panel:not(.fn__none) .b3-form__icon-input").value,repoURL:i.repoURL,packageName:i.name,repoHash:i.repoHash,mode:i.themeMode==="dark"?1:0,update:!0,frontend:C()},l=>ZE(this,null,function*(){var c;if(this._genMyHTML(r,t),vn._onBazaar(l,r,["icons"].includes(r)),r==="themes"&&((c=l.data.appearance)!=null&&c.themeVer)&&(window.siyuan.config.appearance.themeVer=l.data.appearance.themeVer),r==="themes"&&(window.siyuan.config.appearance.mode===0&&window.siyuan.config.appearance.themeLight===i.name||window.siyuan.config.appearance.mode===1&&window.siyuan.config.appearance.themeDark===i.name)){const d=window.siyuan.config.appearance.mode===1?window.siyuan.config.appearance.themeDark:window.siyuan.config.appearance.themeLight;if(window.siyuan.config.appearance.themeJS)if(window.destroyTheme)try{yield window.destroyTheme(),window.destroyTheme=void 0,document.getElementById("themeScript").remove(),va(`/appearance/themes/${d}/theme.js?v=${l.data.appearance.themeVer}`,"themeScript")}catch(u){console.error("destroyTheme error: "+u)}else{Ss({cb(){window.location.reload()},errorExit:!1});return}window.siyuan.config.appearance.mode===1&&d==="midnight"||window.siyuan.config.appearance.mode!==1&&d==="daylight"?document.getElementById("themeDefaultStyle").href=`/appearance/themes/${window.siyuan.config.appearance.mode===1?"midnight":"daylight"}/theme.css?v=${p.SIYUAN_VERSION}`:document.getElementById("themeStyle").href=`/appearance/themes/${d}/theme.css?v=${l.data.appearance.themeVer}`}else r==="plugins"&&t.plugins.find(d=>{if(d.name===i.name)return JL(t,{upsertPlugins:[i.name],removePlugins:[]}),!0})}))}),e.preventDefault(),e.stopPropagation();break}else if(s==="uninstall"){const r=i.bazaarType;let o="/api/bazaar/uninstallBazaarTemplate";r==="themes"?o="/api/bazaar/uninstallBazaarTheme":r==="icons"?o="/api/bazaar/uninstallBazaarIcon":r==="widgets"?o="/api/bazaar/uninstallBazaarWidget":r==="plugins"&&(o="/api/bazaar/uninstallBazaarPlugin");const l=i.name;window.siyuan.config.appearance.themeDark===l||window.siyuan.config.appearance.themeLight===l||window.siyuan.config.appearance.icon===l?Q(window.siyuan.languages.uninstallTip):Sn("\u26A0\uFE0F "+window.siyuan.languages.uninstall,window.siyuan.languages.confirmUninstall.replace("${name}",l),()=>{ae(o,{packageName:l,keyword:vn.element.querySelector(".config-bazaar__panel:not(.fn__none) .b3-form__icon-input").value,frontend:C()},c=>{this._genMyHTML(r,t),vn._onBazaar(c,r,["themes","icons"].includes(r))})}),e.preventDefault(),e.stopPropagation();break}else if(s==="switch"){const r=i.bazaarType,o=i.name,l=i.themeMode==="dark"?1:0;r==="icons"?ae("/api/setting/setAppearance",Object.assign({},window.siyuan.config.appearance,{icon:o}),c=>{this._genMyHTML(r,t,!1),ae("/api/bazaar/getBazaarIcon",{},d=>{d.data.appearance=c.data,vn._onBazaar(d,"icons",!0),vn._data.icons=d.data.packages,Yg()})}):r==="themes"&&ae("/api/setting/setAppearance",Object.assign({},window.siyuan.config.appearance,{mode:l,modeOS:!1,themeDark:l===1?o:window.siyuan.config.appearance.themeDark,themeLight:l===0?o:window.siyuan.config.appearance.themeLight}),c=>ZE(this,null,function*(){if(Yg(),(l!==window.siyuan.config.appearance.mode||l===1&&window.siyuan.config.appearance.themeDark!==o||l===0&&window.siyuan.config.appearance.themeLight!==o)&&window.siyuan.config.appearance.themeJS)if(window.destroyTheme){try{yield window.destroyTheme(),window.destroyTheme=void 0,document.getElementById("themeScript").remove()}catch(d){console.error("destroyTheme error: "+d)}window.siyuan.config.appearance=c.data,h_(window.siyuan.config.appearance)}else{Ss({cb(){window.location.reload()},errorExit:!1});return}this._genMyHTML("themes",t,!1),ae("/api/bazaar/getBazaarTheme",{},d=>{d.data.appearance=c.data,vn._onBazaar(d,"themes",!0),vn._data.themes=d.data.packages})})),e.preventDefault(),e.stopPropagation();break}else if(s==="setting"){t.plugins.find(r=>{if(r.name===i.name)return r.openSetting(),!0}),e.preventDefault(),e.stopPropagation();break}else if(s==="plugins-enable"){n.getAttribute("disabled")||(n.setAttribute("disabled","disabled"),window.siyuan.config.bazaar.petalDisabled=!n.checked,ae("/api/setting/setBazaar",window.siyuan.config.bazaar,()=>{n.removeAttribute("disabled"),window.siyuan.config.bazaar.petalDisabled?vn.element.querySelectorAll("#configBazaarDownloaded .b3-card").forEach(r=>{r.classList.add("b3-card--disabled"),Aw(t,JSON.parse(r.getAttribute("data-obj")).name,!1)}):(vn.element.querySelectorAll("#configBazaarDownloaded .b3-card").forEach(r=>{r.classList.remove("b3-card--disabled")}),JE(t).then(()=>{t.plugins.forEach(r=>{Dw(r)})}),Fi())})),e.stopPropagation();break}else if(s==="plugin-enable"){if(!n.getAttribute("disabled")){n.setAttribute("disabled","disabled");const r=n.checked;ae("/api/petal/setPetalEnabled",{packageName:i.name,enabled:r,frontend:C(),app:p.SIYUAN_APPID},o=>{n.removeAttribute("disabled"),r?ZL(t,o.data).then(l=>{l.setting||l.__proto__.hasOwnProperty("openSetting")?n.parentElement.querySelector('[data-type="setting"]').classList.remove("fn__none"):n.parentElement.querySelector('[data-type="setting"]').classList.add("fn__none")}):(Aw(t,i.name,!1),n.parentElement.querySelector('[data-type="setting"]').classList.add("fn__none"))})}e.stopPropagation();break}else if(n.classList.contains("b3-card")){if(!N(e.target,"b3-card__actions--right")){const r=JSON.parse(n.getAttribute("data-obj")),o=r.bazaarType;let l;ue(n,"data-type","downloaded-update")?l=vn._data.update[r.bazaarType].find(c=>c.repoURL===r.repoURL):l=(r.downloaded?vn._data.downloaded:vn._data[o]).find(c=>c.repoURL===r.repoURL),vn._renderReadme(o,l,r.downloaded)}e.preventDefault(),e.stopPropagation();break}else if(n.classList.contains("item")&&!n.classList.contains("item--focus")){vn.element.querySelector(".layout-tab-bar .item--focus").classList.remove("item--focus"),n.classList.add("item--focus"),vn.element.querySelectorAll(".config-bazaar__panel").forEach(r=>{s===r.getAttribute("data-type")?(r.classList.remove("fn__none"),r.getAttribute("data-init")||(s==="template"?ae("/api/bazaar/getBazaarTemplate",{},o=>{vn._onBazaar(o,"templates",!1),vn._data.templates=o.data.packages}):s==="icon"?ae("/api/bazaar/getBazaarIcon",{},o=>{vn._onBazaar(o,"icons",!1),vn._data.icons=o.data.packages}):s==="widget"?ae("/api/bazaar/getBazaarWidget",{},o=>{vn._onBazaar(o,"widgets",!1),vn._data.widgets=o.data.packages}):s==="theme"?ae("/api/bazaar/getBazaarTheme",{},o=>{vn._onBazaar(o,"themes",!1),vn._data.themes=o.data.packages}):s==="plugin"&&ae("/api/bazaar/getBazaarPlugin",{frontend:C()},o=>{vn._onBazaar(o,"plugins",!1),vn._data.plugins=o.data.packages}),r.setAttribute("data-init","true"))):r.classList.add("fn__none")}),e.preventDefault(),e.stopPropagation();break}else if(n.classList.contains("item__preview")){n.classList.toggle("item__preview--fullscreen"),e.preventDefault(),e.stopPropagation();break}n=n.parentElement}}),vn.element.querySelectorAll(".config-bazaar__panel .b3-form__icon > .b3-text-field").forEach(e=>{e.addEventListener("keydown",n=>{if(!n.isComposing&&n.key==="Enter"){const a=e.value.trim(),i=N(e,"config-bazaar__panel").getAttribute("data-type");if(i==="template")ae("/api/bazaar/getBazaarTemplate",{keyword:a},s=>{vn._onBazaar(s,"templates",!1),vn._data.templates=s.data.packages});else if(i==="icon")ae("/api/bazaar/getBazaarIcon",{keyword:a},s=>{vn._onBazaar(s,"icons",!1),vn._data.icons=s.data.packages});else if(i==="widget")ae("/api/bazaar/getBazaarWidget",{keyword:a},s=>{vn._onBazaar(s,"widgets",!1),vn._data.widgets=s.data.packages});else if(i==="theme")ae("/api/bazaar/getBazaarTheme",{keyword:a},s=>{vn._onBazaar(s,"themes",!1),vn._data.themes=s.data.packages});else if(i==="plugin")ae("/api/bazaar/getBazaarPlugin",{frontend:C(),keyword:a},s=>{vn._onBazaar(s,"plugins",!1),vn._data.plugins=s.data.packages});else if(i==="downloaded"){const s=e.parentElement.parentElement.querySelector(".b3-button:not(.b3-button--outline)").getAttribute("data-type").replace("my","").toLowerCase()+"s";this._genMyHTML(s,t)}n.preventDefault();return}})}),vn.element.querySelectorAll(".b3-select").forEach(e=>{e.addEventListener("change",n=>{if(e.id==="bazaarSelect")vn.element.querySelectorAll("#configBazaarTheme .b3-card").forEach(a=>{const i=JSON.parse(a.getAttribute("data-obj"));e.value==="0"?i.themeMode.indexOf("light")>-1?a.classList.remove("fn__none"):a.classList.add("fn__none"):e.value==="1"?i.themeMode.indexOf("dark")>-1?a.classList.remove("fn__none"):a.classList.add("fn__none"):a.classList.remove("fn__none")}),n.target.parentElement.querySelector(".counter").textContent=vn.element.querySelectorAll("#configBazaarTheme .b3-card:not(.fn__none)").length.toString();else{const a=window.siyuan.storage[p.LOCAL_BAZAAR],i=e.parentElement.parentElement;let s="";const r=Array.from(i.querySelectorAll(".b3-card"));e.value==="0"?r.sort((o,l)=>JSON.parse(l.getAttribute("data-obj")).updated<JSON.parse(o.getAttribute("data-obj")).updated?-1:1).forEach(o=>{s+=o.outerHTML}):e.value==="1"?r.sort((o,l)=>JSON.parse(l.getAttribute("data-obj")).updated<JSON.parse(o.getAttribute("data-obj")).updated?1:-1).forEach(o=>{s+=o.outerHTML}):e.value==="2"?r.sort((o,l)=>JSON.parse(l.getAttribute("data-obj")).downloads<JSON.parse(o.getAttribute("data-obj")).downloads?-1:1).forEach(o=>{s+=o.outerHTML}):e.value==="3"&&r.sort((o,l)=>JSON.parse(l.getAttribute("data-obj")).downloads<JSON.parse(o.getAttribute("data-obj")).downloads?1:-1).forEach(o=>{s+=o.outerHTML}),a[e.parentElement.parentElement.getAttribute("data-type")]=e.value,Gt(p.LOCAL_BAZAAR,window.siyuan.storage[p.LOCAL_BAZAAR]),r.length>1&&(s+='<div class="fn__flex-1" style="margin-left: 15px;min-width: 342px;"></div><div class="fn__flex-1" style="margin-left: 15px;min-width: 342px;"></div>'),i.querySelector(".b3-cards").innerHTML=s}})})},_onBazaar(t,e,n){if(vn.element.querySelector("#configBazaarReadme").classList.contains("config-bazaar__readme--show")){const o=JSON.parse(vn.element.querySelector("#configBazaarReadme > .item__side").getAttribute("data-obj"));vn._renderReadme(o.bazaarType,t.data.packages.find(l=>l.repoURL===o.repoURL),o.downloaded)}let a="#configBazaarTemplate";e==="themes"?a="#configBazaarTheme":e==="icons"?a="#configBazaarIcon":e==="widgets"?a="#configBazaarWidget":e==="plugins"&&(a="#configBazaarPlugin");const i=vn.element.querySelector(a);t.code===1&&(Q(t.msg),i.querySelectorAll("img[data-type='img-loading']").forEach(o=>{o.remove()}));let s="";t.data.packages.forEach(o=>{s+=this._genCardHTML(o,e)}),vn._data[e]=t.data.packages,i.innerHTML=`<div class="b3-cards">${s}</div>`,i.parentElement.querySelector(".counter").textContent=i.querySelectorAll(".b3-card:not(.fn__none)").length.toString();const r=window.siyuan.storage[p.LOCAL_BAZAAR];r[e.replace("s","")]==="1"?(s="",Array.from(i.querySelectorAll(".b3-card")).sort((o,l)=>JSON.parse(l.getAttribute("data-obj")).updated<JSON.parse(o.getAttribute("data-obj")).updated?1:-1).forEach(o=>{s+=o.outerHTML})):r[e.replace("s","")]==="2"?(s="",Array.from(i.querySelectorAll(".b3-card")).sort((o,l)=>JSON.parse(l.getAttribute("data-obj")).downloads<JSON.parse(o.getAttribute("data-obj")).downloads?-1:1).forEach(o=>{s+=o.outerHTML})):r[e.replace("s","")]==="3"&&(s="",Array.from(i.querySelectorAll(".b3-card")).sort((o,l)=>JSON.parse(l.getAttribute("data-obj")).downloads<JSON.parse(o.getAttribute("data-obj")).downloads?1:-1).forEach(o=>{s+=o.outerHTML})),t.data.packages.length>1&&(s+='<div class="fn__flex-1" style="margin-left: 15px;min-width: 342px;"></div><div class="fn__flex-1" style="margin-left: 15px;min-width: 342px;"></div>'),i.innerHTML=`<div class="b3-cards">${s}</div>`,n&&Ta.onSetAppearance(t.data.appearance)}},ia={element:void 0,genHTML:()=>`<div class="b3-label">
    <div>${window.siyuan.languages.searchBlockType}</div>
    <div class="fn__flex config-query">
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconMath"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.math}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="mathBlock" type="checkbox"${window.siyuan.config.search.mathBlock?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconTable"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.table}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="table" type="checkbox"${window.siyuan.config.search.table?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconParagraph"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.paragraph}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="paragraph" type="checkbox"${window.siyuan.config.search.paragraph?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconHeadings"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.headings}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="heading" type="checkbox"${window.siyuan.config.search.heading?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconCode"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.code}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="codeBlock" type="checkbox"${window.siyuan.config.search.codeBlock?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconHTML5"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                HTML
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="htmlBlock" type="checkbox"${window.siyuan.config.search.htmlBlock?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconDatabase"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.database}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="databaseBlock" type="checkbox"${window.siyuan.config.search.databaseBlock?" checked":""}/>
        </label>        
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconSQL"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.embedBlock}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="embedBlock" type="checkbox"${window.siyuan.config.search.embedBlock?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconVideo"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.video}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="videoBlock" type="checkbox"${window.siyuan.config.search.videoBlock?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconRecord"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.audio}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="audioBlock" type="checkbox"${window.siyuan.config.search.audioBlock?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconLanguage"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                IFrame
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="iframeBlock" type="checkbox"${window.siyuan.config.search.iframeBlock?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconBoth"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.widget}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="widgetBlock" type="checkbox"${window.siyuan.config.search.widgetBlock?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconQuote"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.quote} <sup>[1]</sup>
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="blockquote" type="checkbox"${window.siyuan.config.search.blockquote?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconSuper"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.superBlock} <sup>[1]</sup>
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="superBlock" type="checkbox"${window.siyuan.config.search.superBlock?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconList"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.list1} <sup>[1]</sup>
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="list" type="checkbox"${window.siyuan.config.search.list?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconListItem"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.listItem} <sup>[1]</sup>
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="listItem" type="checkbox"${window.siyuan.config.search.listItem?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconFile"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.doc}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="document" type="checkbox"${window.siyuan.config.search.document?" checked":""}/>
        </label>
    </div>
    <span class="fn__space"></span>
    <div class="fn__flex-1">
        <div class="b3-label__text">[1] ${window.siyuan.languages.containerBlockTip1}</div>
    </div>
</div>
<div class="b3-label">
    <div>${window.siyuan.languages.searchBlockAttr}</div>
    <div class="config-query">
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconN"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.name}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="name" type="checkbox"${window.siyuan.config.search.name?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconA"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.alias}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="alias" type="checkbox"${window.siyuan.config.search.alias?" checked":""}/>
        </label>
        <label class="fn__flex">
            <svg class="svg"><use xlink:href="#iconM"></use></svg>
            <span class="fn__space"></span>
            <div class="fn__flex-1">
                ${window.siyuan.languages.memo}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="memo" type="checkbox"${window.siyuan.config.search.memo?" checked":""}/>
        </label>
        <label class="fn__flex">
            <div class="fn__flex-1">
                ${window.siyuan.languages.allAttrs}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="ial" type="checkbox"${window.siyuan.config.search.ial?" checked":""}/>
        </label>
    </div>
</div>
<div class="b3-label">
    <div>${window.siyuan.languages.searchBackmention}</div>
    <div class="config-query">
        <label class="fn__flex">
            <div class="fn__flex-1">
                ${window.siyuan.languages.name}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="backlinkMentionName" type="checkbox"${window.siyuan.config.search.backlinkMentionName?" checked":""}/>
        </label>
        <label class="fn__flex">
            <div class="fn__flex-1">
                ${window.siyuan.languages.alias}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="backlinkMentionAlias" type="checkbox"${window.siyuan.config.search.backlinkMentionAlias?" checked":""}/>
        </label>
        <label class="fn__flex">
            <div class="fn__flex-1">
                ${window.siyuan.languages.anchor}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="backlinkMentionAnchor" type="checkbox"${window.siyuan.config.search.backlinkMentionAnchor?" checked":""}/>
        </label>
        <label class="fn__flex">
            <div class="fn__flex-1">
                ${window.siyuan.languages.docName}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="backlinkMentionDoc" type="checkbox"${window.siyuan.config.search.backlinkMentionDoc?" checked":""}/>
        </label>
        <div class="fn__flex label fn__flex-1" style="flex: 2">
            <div>
                ${window.siyuan.languages.keywordsLimit}
            </div>
            <span class="fn__space"></span>
            <input class="b3-text-field" id="backlinkMentionKeywordsLimit" type="number" min="1" max="10240" value="${window.siyuan.config.search.backlinkMentionKeywordsLimit}">
        </div>
    </div>
</div>
<div class="b3-label">
    <div>${window.siyuan.languages.searchVirtualRef}</div>
    <div class="config-query">
        <label class="fn__flex">
            <div class="fn__flex-1">
                ${window.siyuan.languages.name}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="virtualRefName" type="checkbox"${window.siyuan.config.search.virtualRefName?" checked":""}/>
        </label>
        <label class="fn__flex">
            <div class="fn__flex-1">
                ${window.siyuan.languages.alias}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="virtualRefAlias" type="checkbox"${window.siyuan.config.search.virtualRefAlias?" checked":""}/>
        </label>
        <label class="fn__flex">
            <div class="fn__flex-1">
                ${window.siyuan.languages.anchor}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="virtualRefAnchor" type="checkbox"${window.siyuan.config.search.virtualRefAnchor?" checked":""}/>
        </label>
        <label class="fn__flex">
            <div class="fn__flex-1">
                ${window.siyuan.languages.docName}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="virtualRefDoc" type="checkbox"${window.siyuan.config.search.virtualRefDoc?" checked":""}/>
        </label>
    </div>
</div>
<div class="b3-label">
    <div>${window.siyuan.languages.searchIndex}</div>
    <div class="config-query">
        <label class="fn__flex">
            <div class="fn__flex-1">
                ${window.siyuan.languages.indexAssetPath}
            </div>
            <span class="fn__space"></span>
            <input class="b3-switch" id="indexAssetPath" type="checkbox"${window.siyuan.config.search.indexAssetPath?" checked":""}/>
        </label>
    </div>
</div>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.searchLimit}
         <div class="b3-label__text">${window.siyuan.languages.searchLimit1}</div>
         <div class="b3-label__text">${window.siyuan.languages.searchLimit2}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" id="limit" type="number" min="32" max="10240" value="${window.siyuan.config.search.limit}">
</div>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.searchCaseSensitive}
         <div class="b3-label__text">${window.siyuan.languages.searchCaseSensitive1}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="caseSensitive" type="checkbox"${window.siyuan.config.search.caseSensitive?" checked":""}/>
</label>`,bindEvent:()=>{ia.element.querySelectorAll("input").forEach(t=>{t.addEventListener("change",()=>{ae("/api/setting/setSearch",{document:ia.element.querySelector("#document").checked,heading:ia.element.querySelector("#heading").checked,list:ia.element.querySelector("#list").checked,listItem:ia.element.querySelector("#listItem").checked,codeBlock:ia.element.querySelector("#codeBlock").checked,htmlBlock:ia.element.querySelector("#htmlBlock").checked,embedBlock:ia.element.querySelector("#embedBlock").checked,databaseBlock:ia.element.querySelector("#databaseBlock").checked,audioBlock:ia.element.querySelector("#audioBlock").checked,videoBlock:ia.element.querySelector("#videoBlock").checked,iframeBlock:ia.element.querySelector("#iframeBlock").checked,widgetBlock:ia.element.querySelector("#widgetBlock").checked,mathBlock:ia.element.querySelector("#mathBlock").checked,table:ia.element.querySelector("#table").checked,blockquote:ia.element.querySelector("#blockquote").checked,superBlock:ia.element.querySelector("#superBlock").checked,paragraph:ia.element.querySelector("#paragraph").checked,name:ia.element.querySelector("#name").checked,alias:ia.element.querySelector("#alias").checked,memo:ia.element.querySelector("#memo").checked,ial:ia.element.querySelector("#ial").checked,indexAssetPath:ia.element.querySelector("#indexAssetPath").checked,limit:parseInt(ia.element.querySelector("#limit").value),caseSensitive:ia.element.querySelector("#caseSensitive").checked,backlinkMentionName:ia.element.querySelector("#backlinkMentionName").checked,backlinkMentionAlias:ia.element.querySelector("#backlinkMentionAlias").checked,backlinkMentionAnchor:ia.element.querySelector("#backlinkMentionAnchor").checked,backlinkMentionDoc:ia.element.querySelector("#backlinkMentionDoc").checked,backlinkMentionKeywordsLimit:parseInt(ia.element.querySelector("#backlinkMentionKeywordsLimit").value),virtualRefName:ia.element.querySelector("#virtualRefName").checked,virtualRefAlias:ia.element.querySelector("#virtualRefAlias").checked,virtualRefAnchor:ia.element.querySelector("#virtualRefAnchor").checked,virtualRefDoc:ia.element.querySelector("#virtualRefDoc").checked},e=>{window.siyuan.config.search=e.data})})})}},on={element:void 0,genHTML:()=>{let t="";return t=`<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        AI\u670D\u52A1\u63D0\u4F9B\u5546
        <div class="b3-label__text">\u9009\u62E9AI\u5BF9\u8BDD\u670D\u52A1\u63D0\u4F9B\u5546\uFF0C\u652F\u6301\u591A\u79CD\u4E3B\u6D41AI\u6A21\u578B</div>
    </div>
    <span class="fn__space"></span>
    <select id="apiProvider" class="b3-select fn__flex-center fn__size200">
        <option value="builtin" ${window.siyuan.config.ai.openAI.apiProvider==="builtin"?"selected":""}>\u{1F381} \u5185\u7F6E\u514D\u8D39\u6A21\u578B</option>
        <option value="OpenAI" ${window.siyuan.config.ai.openAI.apiProvider==="OpenAI"?"selected":""}>OpenAI</option>
        <option value="Azure" ${window.siyuan.config.ai.openAI.apiProvider==="Azure"?"selected":""}>Azure OpenAI</option>
        <option value="SiliconFlow" ${window.siyuan.config.ai.openAI.apiProvider==="SiliconFlow"?"selected":""}>\u7845\u57FA\u6D41\u52A8</option>
        <option value="Qwen" ${window.siyuan.config.ai.openAI.apiProvider==="Qwen"?"selected":""}>\u901A\u4E49\u5343\u95EE</option>
        <option value="ZhipuAI" ${window.siyuan.config.ai.openAI.apiProvider==="ZhipuAI"?"selected":""}>\u667A\u8C31AI</option>
        <option value="DeepSeek" ${window.siyuan.config.ai.openAI.apiProvider==="DeepSeek"?"selected":""}>DeepSeek</option>
        <option value="Moonshot" ${window.siyuan.config.ai.openAI.apiProvider==="Moonshot"?"selected":""}>\u6708\u4E4B\u6697\u9762</option>
        <option value="Custom" ${window.siyuan.config.ai.openAI.apiProvider==="Custom"?"selected":""}>\u81EA\u5B9A\u4E49API</option>
    </select>
</div>
<div class="fn__flex b3-label${window.siyuan.config.ai.openAI.apiProvider==="builtin"?" fn__none":""}" data-field="apiKey">
    <div class="fn__block">
        API\u5BC6\u94A5
        <div class="b3-label__text">\u60A8\u7684API\u5BC6\u94A5${on.getProviderKeyTip()}</div>
        <div class="fn__hr"></div>
        <div class="b3-form__icona fn__block">
            <input id="apiKey" type="password" class="b3-text-field b3-form__icona-input" value="${window.siyuan.config.ai.openAI.apiKey}" placeholder="sk-xxx">
            <svg class="b3-form__icona-icon" data-action="togglePassword"><use xlink:href="#iconEye"></use></svg>
        </div>
    </div>
</div>
<div class="fn__flex b3-label">
    <div class="fn__block">
        AI\u6A21\u578B
        <div class="b3-label__text">\u9009\u62E9\u8981\u4F7F\u7528\u7684AI\u6A21\u578B</div>
        <div class="fn__hr"></div>
        <select id="apiModel" class="b3-select fn__block">
            ${on.getModelOptions()}
        </select>
        <div class="b3-label__text" id="modelDescription" style="margin-top: 8px;">${on.getModelDescription()}</div>
    </div>
</div>
<div class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.apiTimeout}
        <div class="b3-label__text">${window.siyuan.languages.apiTimeoutTip}</div>
    </div>
    <span class="fn__space"></span>
    <div class="fn__size200 fn__flex-center fn__flex">
        <input class="b3-text-field fn__flex-1" type="number" step="1" min="5" max="600" id="apiTimeout" value="${window.siyuan.config.ai.openAI.apiTimeout}"/>
        <span class="fn__space"></span>
        <span class="ft__on-surface fn__flex-center">s</span>
    </div>
</div>
<div class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.apiMaxTokens}
        <div class="b3-label__text">${window.siyuan.languages.apiMaxTokensTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" type="number" step="1" min="0" id="apiMaxTokens" value="${window.siyuan.config.ai.openAI.apiMaxTokens}"/>
</div>
<div class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.apiTemperature}
        <div class="b3-label__text">${window.siyuan.languages.apiTemperatureTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" type="number" step="0.1" min="0" max="2" id="apiTemperature" value="${window.siyuan.config.ai.openAI.apiTemperature}"/>
</div>
<div class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.apiMaxContexts}
        <div class="b3-label__text">${window.siyuan.languages.apiMaxContextsTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" type="number" step="1" min="1" max="64" id="apiMaxContexts" value="${window.siyuan.config.ai.openAI.apiMaxContexts}"/>
</div>
<div class="fn__flex b3-label${window.siyuan.config.ai.openAI.apiProvider==="builtin"?" fn__none":""}" data-field="apiBaseURL">
    <div class="fn__block">
        ${window.siyuan.languages.apiBaseURL}
        <div class="b3-label__text">${window.siyuan.languages.apiBaseURLTip}</div>
        <span class="fn__hr"></span>
        <input class="b3-text-field fn__block" id="apiBaseURL" value="${window.siyuan.config.ai.openAI.apiBaseURL}" placeholder="${on.getDefaultBaseURL()}"/>
    </div>
</div>
<div class="fn__flex b3-label${window.siyuan.config.ai.openAI.apiProvider!=="Custom"?" fn__none":""}" data-field="apiProxy">
    <div class="fn__block">
        ${window.siyuan.languages.apiProxy}
        <div class="b3-label__text">${window.siyuan.languages.apiProxyTip}</div>
        <span class="fn__hr"></span>
        <input class="b3-text-field fn__block" id="apiProxy" value="${window.siyuan.config.ai.openAI.apiProxy}"/>
    </div>
</div>
<div class="fn__flex b3-label${window.siyuan.config.ai.openAI.apiProvider!=="Azure"?" fn__none":""}" data-field="apiVersion">
    <div class="fn__block">
        ${window.siyuan.languages.apiVersion}
        <div class="b3-label__text">${window.siyuan.languages.apiVersionTip}</div>
        <span class="fn__hr"></span>
        <input class="b3-text-field fn__block" id="apiVersion" value="${window.siyuan.config.ai.openAI.apiVersion}"/>
    </div>
</div>
<div class="fn__flex b3-label${window.siyuan.config.ai.openAI.apiProvider==="builtin"?" fn__none":""}" data-field="apiUserAgent">
    <div class="fn__block">
        User-Agent
        <div class="b3-label__text">${window.siyuan.languages.apiUserAgentTip}</div>
        <span class="fn__hr"></span>
        <input class="b3-text-field fn__block" id="apiUserAgent" value="${window.siyuan.config.ai.openAI.apiUserAgent}"/>
    </div>
</div>`,`<div class="fn__flex-column" style="height: 100%">
<div class="layout-tab-bar fn__flex">
    <div data-type="openai" class="item item--full item--focus"><span class="fn__flex-1"></span><span class="item__text">AI\u5BF9\u8BDD</span><span class="fn__flex-1"></span></div>
    <div data-type="embedding" class="item item--full"><span class="fn__flex-1"></span><span class="item__text">\u5411\u91CF\u5316</span><span class="fn__flex-1"></span></div>
    <div data-type="ai-features" class="item item--full"><span class="fn__flex-1"></span><span class="item__text">AI\u529F\u80FD</span><span class="fn__flex-1"></span></div>
</div>
<div class="fn__flex-1">
    <div data-type="openai">
        ${t}
    </div>
    <div data-type="embedding" style="display: none;">
        ${on.genEmbeddingHTML()}
    </div>
    <div data-type="ai-features" style="display: none;">
        ${on.genAIFeaturesHTML()}
    </div>
</div>
</div>`},getModelOptions:t=>{const e=t||window.siyuan.config.ai.openAI.apiProvider||"builtin",n=window.siyuan.config.ai.openAI.apiModel||"",a={builtin:[{value:"builtin-free",label:"\u601D\u6E90\u5185\u7F6E\u514D\u8D39\u6A21\u578B",desc:"\u514D\u8D39\u4F7F\u7528\uFF0C\u9002\u5408\u65E5\u5E38\u5BF9\u8BDD"}],OpenAI:[{value:"gpt-4o",label:"GPT-4o",desc:"\u6700\u65B0\u6700\u5F3A\u6A21\u578B\uFF0C\u652F\u6301\u591A\u6A21\u6001"},{value:"gpt-4o-mini",label:"GPT-4o Mini",desc:"\u8F7B\u91CF\u5FEB\u901F\uFF0C\u6027\u4EF7\u6BD4\u9AD8"},{value:"gpt-4-turbo",label:"GPT-4 Turbo",desc:"\u5F3A\u5927\u7684GPT-4\u6A21\u578B"},{value:"gpt-4",label:"GPT-4",desc:"\u7ECF\u5178GPT-4\u6A21\u578B"},{value:"gpt-3.5-turbo",label:"GPT-3.5 Turbo",desc:"\u5FEB\u901F\u4E14\u7ECF\u6D4E"}],Azure:[{value:"gpt-4",label:"GPT-4 (Azure)",desc:"Azure\u90E8\u7F72\u7684GPT-4"},{value:"gpt-35-turbo",label:"GPT-3.5 Turbo (Azure)",desc:"Azure\u90E8\u7F72\u7684GPT-3.5"}],SiliconFlow:[{value:"Qwen/Qwen2.5-72B-Instruct",label:"\u901A\u4E49\u5343\u95EE 2.5 (72B)",desc:"\u5F3A\u5927\u7684\u4E2D\u6587\u6A21\u578B"},{value:"Qwen/Qwen2.5-7B-Instruct",label:"\u901A\u4E49\u5343\u95EE 2.5 (7B)",desc:"\u8F7B\u91CF\u5FEB\u901F"},{value:"THUDM/glm-4-9b-chat",label:"GLM-4 (9B)",desc:"\u667A\u8C31\u6700\u65B0\u6A21\u578B"},{value:"deepseek-ai/DeepSeek-V2.5",label:"DeepSeek V2.5",desc:"\u63A8\u7406\u80FD\u529B\u5F3A"},{value:"meta-llama/Meta-Llama-3.1-70B-Instruct",label:"Llama 3.1 (70B)",desc:"Meta\u5F00\u6E90\u5927\u6A21\u578B"},{value:"meta-llama/Meta-Llama-3.1-8B-Instruct",label:"Llama 3.1 (8B)",desc:"\u8F7B\u91CF\u5F00\u6E90\u6A21\u578B"}],Qwen:[{value:"qwen-max",label:"\u901A\u4E49\u5343\u95EE Max",desc:"\u6700\u5F3A\u6027\u80FD"},{value:"qwen-plus",label:"\u901A\u4E49\u5343\u95EE Plus",desc:"\u5E73\u8861\u6027\u80FD"},{value:"qwen-turbo",label:"\u901A\u4E49\u5343\u95EE Turbo",desc:"\u5FEB\u901F\u54CD\u5E94"}],ZhipuAI:[{value:"glm-4-plus",label:"GLM-4 Plus",desc:"\u8D85\u5927\u89C4\u6A21\u6A21\u578B"},{value:"glm-4",label:"GLM-4",desc:"\u7EFC\u5408\u6027\u80FD\u5F3A"},{value:"glm-3-turbo",label:"GLM-3 Turbo",desc:"\u5FEB\u901F\u9AD8\u6548"}],DeepSeek:[{value:"deepseek-chat",label:"DeepSeek Chat",desc:"\u5BF9\u8BDD\u6A21\u578B"},{value:"deepseek-coder",label:"DeepSeek Coder",desc:"\u4EE3\u7801\u4E13\u7528\u6A21\u578B"}],Moonshot:[{value:"moonshot-v1-128k",label:"Kimi (128K)",desc:"\u8D85\u957F\u4E0A\u4E0B\u6587"},{value:"moonshot-v1-32k",label:"Kimi (32K)",desc:"\u957F\u4E0A\u4E0B\u6587"},{value:"moonshot-v1-8k",label:"Kimi (8K)",desc:"\u6807\u51C6\u4E0A\u4E0B\u6587"}],Custom:[{value:"custom-model",label:"\u81EA\u5B9A\u4E49\u6A21\u578B",desc:"\u517C\u5BB9OpenAI API\u7684\u4EFB\u4F55\u6A21\u578B"}]};return(a[e]||a.builtin).map(s=>`<option value="${s.value}">${s.label}</option>`).join("")},getModelDescription:(t,e)=>{const n=t||window.siyuan.config.ai.openAI.apiModel||"builtin-free";return{"builtin-free":"\u5B8C\u5168\u514D\u8D39\u7684\u5185\u7F6EAI\u6A21\u578B\uFF0C\u9002\u5408\u65E5\u5E38\u5BF9\u8BDD\u548C\u6587\u6863\u5206\u6790","gpt-4o":"OpenAI\u6700\u65B0\u6700\u5F3A\u6A21\u578B\uFF0C\u652F\u6301\u89C6\u89C9\u7406\u89E3\u548C\u591A\u6A21\u6001\u8F93\u5165","gpt-4o-mini":"\u8F7B\u91CF\u7248GPT-4o\uFF0C\u54CD\u5E94\u66F4\u5FEB\uFF0C\u6210\u672C\u66F4\u4F4E","gpt-4-turbo":"GPT-4\u7684\u4F18\u5316\u7248\u672C\uFF0C\u5904\u7406\u901F\u5EA6\u66F4\u5FEB","gpt-4":"\u7ECF\u5178\u7684GPT-4\u6A21\u578B\uFF0C\u5F3A\u5927\u7684\u63A8\u7406\u80FD\u529B","gpt-3.5-turbo":"\u6027\u4EF7\u6BD4\u6700\u9AD8\u7684\u9009\u62E9\uFF0C\u54CD\u5E94\u8FC5\u901F","gpt-35-turbo":"Azure\u90E8\u7F72\u7684GPT-3.5\u6A21\u578B","Qwen/Qwen2.5-72B-Instruct":"\u963F\u91CC\u6700\u5F3A\u4E2D\u6587\u6A21\u578B\uFF0C\u7406\u89E3\u80FD\u529B\u51FA\u8272","Qwen/Qwen2.5-7B-Instruct":"\u8F7B\u91CF\u5FEB\u901F\uFF0C\u9002\u5408\u65E5\u5E38\u4F7F\u7528","THUDM/glm-4-9b-chat":"\u667A\u8C31\u6700\u65B0\u5BF9\u8BDD\u6A21\u578B\uFF0C\u4E2D\u6587\u8868\u73B0\u4F18\u79C0","deepseek-ai/DeepSeek-V2.5":"\u5F3A\u5927\u7684\u63A8\u7406\u548C\u4EE3\u7801\u80FD\u529B","qwen-max":"\u901A\u4E49\u5343\u95EE\u6700\u5F3A\u6A21\u578B\uFF0C\u7EFC\u5408\u80FD\u529B\u7A81\u51FA","qwen-plus":"\u901A\u4E49\u5343\u95EE\u5E73\u8861\u6027\u80FD\u6A21\u578B","qwen-turbo":"\u901A\u4E49\u5343\u95EE\u5FEB\u901F\u54CD\u5E94\u6A21\u578B","glm-4-plus":"\u667A\u8C31AI\u8D85\u5927\u6A21\u578B\uFF0C\u5904\u7406\u590D\u6742\u4EFB\u52A1","glm-4":"\u667A\u8C31AI\u7EFC\u5408\u6027\u80FD\u6A21\u578B","glm-3-turbo":"\u667A\u8C31AI\u5FEB\u901F\u6A21\u578B","deepseek-chat":"DeepSeek\u901A\u7528\u5BF9\u8BDD\u6A21\u578B","deepseek-coder":"DeepSeek\u4EE3\u7801\u4E13\u7528\u6A21\u578B","moonshot-v1-128k":"\u652F\u6301128K\u8D85\u957F\u4E0A\u4E0B\u6587\uFF0C\u9002\u5408\u957F\u6587\u6863\u5206\u6790","moonshot-v1-32k":"\u652F\u630132K\u957F\u4E0A\u4E0B\u6587","moonshot-v1-8k":"\u652F\u63018K\u6807\u51C6\u4E0A\u4E0B\u6587","custom-model":"\u517C\u5BB9OpenAI API\u7684\u81EA\u5B9A\u4E49\u6A21\u578B","meta-llama/Meta-Llama-3.1-70B-Instruct":"Meta\u5F00\u6E90\u5927\u6A21\u578B\uFF0C\u901A\u7528\u80FD\u529B\u5F3A","meta-llama/Meta-Llama-3.1-8B-Instruct":"\u8F7B\u91CF\u7EA7\u5F00\u6E90\u6A21\u578B"}[n]||"\u8BF7\u9009\u62E9\u4E00\u4E2AAI\u6A21\u578B"},getDefaultBaseURL:t=>{const e=t||window.siyuan.config.ai.openAI.apiProvider||"builtin";return{OpenAI:"https://api.openai.com/v1",Azure:"https://YOUR_RESOURCE.openai.azure.com",SiliconFlow:"https://api.siliconflow.cn/v1",Qwen:"https://dashscope.aliyuncs.com/compatible-mode/v1",ZhipuAI:"https://open.bigmodel.cn/api/paas/v4",DeepSeek:"https://api.deepseek.com/v1",Moonshot:"https://api.moonshot.cn/v1",Custom:"https://your-api-endpoint.com/v1"}[e]||""},getProviderKeyTip:t=>{const e=t||window.siyuan.config.ai.openAI.apiProvider||"builtin";return{OpenAI:"\uFF0C\u5728 platform.openai.com \u83B7\u53D6",Azure:"\uFF0C\u5728Azure\u95E8\u6237\u83B7\u53D6",SiliconFlow:"\uFF0C\u5728 siliconflow.cn \u514D\u8D39\u83B7\u53D6",Qwen:"\uFF0C\u5728\u963F\u91CC\u4E91\u63A7\u5236\u53F0\u83B7\u53D6",ZhipuAI:"\uFF0C\u5728 open.bigmodel.cn \u83B7\u53D6",DeepSeek:"\uFF0C\u5728 platform.deepseek.com \u83B7\u53D6",Moonshot:"\uFF0C\u5728 platform.moonshot.cn \u83B7\u53D6"}[e]||""},genEmbeddingHTML:()=>{var t;const e=((t=window.siyuan.config.ai)==null?void 0:t.embedding)||{provider:"siliconflow",apiKey:"",model:"BAAI/bge-large-zh-v1.5",apiBaseUrl:"https://api.siliconflow.cn/v1",encodingFormat:"float",timeout:30,enabled:!1};return`<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        \u5411\u91CF\u5316\u63D0\u4F9B\u5546
        <div class="b3-label__text">\u9009\u62E9\u5411\u91CF\u5316\u670D\u52A1\u63D0\u4F9B\u5546\uFF0C\u652F\u6301\u591A\u79CDAI\u6A21\u578B</div>
    </div>
    <span class="fn__space"></span>
    <select id="embeddingProvider" class="b3-select fn__flex-center fn__size200">
        <option value="siliconflow" ${e.provider==="siliconflow"?"selected":""}>SiliconFlow</option>
        <option value="openai" ${e.provider==="openai"?"selected":""}>OpenAI</option>
    </select>
</div>
<div class="fn__flex b3-label">
    <div class="fn__flex-1">
        \u542F\u7528\u5411\u91CF\u5316\u529F\u80FD
        <div class="b3-label__text">\u5F00\u542F\u540E\u53EF\u4F7F\u7528\u8BED\u4E49\u641C\u7D22\u548CAI\u5206\u6790\u529F\u80FD</div>
    </div>
    <span class="fn__space"></span>
    <input type="checkbox" id="embeddingEnabled" class="b3-switch" ${e.enabled?"checked":""}/>
</div>
<div class="fn__flex b3-label">
    <div class="fn__block">
        API\u5BC6\u94A5
        <div class="b3-label__text">\u5411\u91CF\u5316\u670D\u52A1\u7684API\u5BC6\u94A5</div>
        <div class="fn__hr"></div>
        <div class="b3-form__icona fn__block">
            <input id="embeddingApiKey" type="password" class="b3-text-field b3-form__icona-input" value="${e.apiKey}" placeholder="sk-xxx">
            <svg class="b3-form__icona-icon" data-action="toggleEmbeddingPassword"><use xlink:href="#iconEye"></use></svg>
        </div>
    </div>
</div>
<div class="fn__flex b3-label">
    <div class="fn__block">
        \u5411\u91CF\u5316\u6A21\u578B
        <div class="b3-label__text">\u9009\u62E9\u7528\u4E8E\u5411\u91CF\u5316\u7684AI\u6A21\u578B</div>
        <div class="fn__hr"></div>
        <select id="embeddingModel" class="b3-text-field fn__block">
            <option value="BAAI/bge-large-zh-v1.5" ${e.model==="BAAI/bge-large-zh-v1.5"?"selected":""}>BAAI/bge-large-zh-v1.5 (\u4E2D\u6587\u5927\u578B)</option>
            <option value="BAAI/bge-m3" ${e.model==="BAAI/bge-m3"?"selected":""}>BAAI/bge-m3 (\u591A\u8BED\u8A00)</option>
            <option value="netease-youdao/bce-embedding-base_v1" ${e.model==="netease-youdao/bce-embedding-base_v1"?"selected":""}>BCE-Embedding-Base</option>
            <option value="text-embedding-3-small" ${e.model==="text-embedding-3-small"?"selected":""}>text-embedding-3-small (OpenAI)</option>
            <option value="text-embedding-3-large" ${e.model==="text-embedding-3-large"?"selected":""}>text-embedding-3-large (OpenAI)</option>
            <option value="text-embedding-ada-002" ${e.model==="text-embedding-ada-002"?"selected":""}>text-embedding-ada-002 (OpenAI)</option>
        </select>
    </div>
</div>
<div class="fn__flex b3-label">
    <div class="fn__block">
        API\u5730\u5740
        <div class="b3-label__text">\u5411\u91CF\u5316\u670D\u52A1\u7684API\u7AEF\u70B9\u5730\u5740</div>
        <div class="fn__hr"></div>
        <input class="b3-text-field fn__block" id="embeddingApiBaseUrl" value="${e.apiBaseUrl}" placeholder="https://api.siliconflow.cn/v1"/>
    </div>
</div>
<div class="fn__flex b3-label">
    <div class="fn__flex-1">
        \u7F16\u7801\u683C\u5F0F
        <div class="b3-label__text">\u5411\u91CF\u6570\u636E\u7684\u7F16\u7801\u683C\u5F0F</div>
    </div>
    <span class="fn__space"></span>
    <select id="embeddingEncodingFormat" class="b3-select fn__flex-center fn__size200">
        <option value="float" ${e.encodingFormat==="float"?"selected":""}>float</option>
        <option value="base64" ${e.encodingFormat==="base64"?"selected":""}>base64</option>
    </select>
</div>
<div class="fn__flex b3-label">
    <div class="fn__flex-1">
        \u8BF7\u6C42\u8D85\u65F6\u65F6\u95F4
        <div class="b3-label__text">\u5411\u91CF\u5316\u8BF7\u6C42\u7684\u6700\u5927\u7B49\u5F85\u65F6\u95F4</div>
    </div>
    <span class="fn__space"></span>
    <div class="fn__size200 fn__flex-center fn__flex">
        <input class="b3-text-field fn__flex-1" type="number" step="1" min="5" max="300" id="embeddingTimeout" value="${e.timeout}"/>
        <span class="fn__space"></span>
        <span class="ft__on-surface fn__flex-center">\u79D2</span>
    </div>
</div>
<div class="fn__flex b3-label">
    <div class="fn__block">
        <button id="testEmbeddingConnection" class="b3-button b3-button--outline">\u6D4B\u8BD5\u8FDE\u63A5</button>
        <span class="fn__space"></span>
        <button id="getEmbeddingModels" class="b3-button b3-button--outline">\u83B7\u53D6\u53EF\u7528\u6A21\u578B</button>
    </div>
</div>`},genAIFeaturesHTML:()=>`<div class="b3-label">
    <h3>AI\u529F\u80FD\u6D4B\u8BD5</h3>
    <div class="b3-label__text">\u6D4B\u8BD5\u65B0\u589E\u7684AI\u5411\u91CF\u5316\u548C\u5206\u6790\u529F\u80FD</div>
</div>
<div class="b3-label">
    <div class="fn__block">
        <button id="semanticSearchTest" class="b3-button b3-button--outline">\u8BED\u4E49\u641C\u7D22\u6D4B\u8BD5</button>
        <span class="fn__space"></span>
        <input id="semanticSearchQuery" class="b3-text-field fn__flex-1" placeholder="\u8F93\u5165\u641C\u7D22\u5173\u952E\u8BCD..." value="\u4EBA\u5DE5\u667A\u80FD">
    </div>
</div>
<div class="b3-label">
    <div class="fn__block">
        <button id="notebookSummaryTest" class="b3-button b3-button--outline">\u7B14\u8BB0\u672C\u6458\u8981\u751F\u6210\u6D4B\u8BD5</button>
        <span class="fn__space"></span>
        <input id="notebookSummaryId" class="b3-text-field fn__flex-1" placeholder="\u8F93\u5165\u7B14\u8BB0\u672CID...">
    </div>
</div>
<div class="b3-label">
    <div class="fn__block">
        <button id="batchVectorizeTest" class="b3-button b3-button--outline">\u6279\u91CF\u5411\u91CF\u5316\u6D4B\u8BD5</button>
        <span class="fn__space"></span>
        <input id="batchVectorizeNotebook" class="b3-text-field fn__flex-1" placeholder="\u8F93\u5165\u7B14\u8BB0\u672CID...">
    </div>
</div>
<div class="b3-label">
    <div class="fn__block">
        <div id="aiTestResults" class="b3-form__space-small" style="background: var(--b3-theme-background-contrast); padding: 12px; border-radius: 4px; min-height: 60px; font-family: monospace; white-space: pre-wrap;">\u6D4B\u8BD5\u7ED3\u679C\u5C06\u5728\u8FD9\u91CC\u663E\u793A...</div>
    </div>
</div>`,bindEvent:()=>{on.element.querySelectorAll(".layout-tab-bar .item").forEach(c=>{c.addEventListener("click",()=>{const d=c.getAttribute("data-type");on.element.querySelectorAll(".layout-tab-bar .item").forEach(u=>{u.classList.remove("item--focus")}),c.classList.add("item--focus"),on.element.querySelectorAll(".fn__flex-1 > div").forEach(u=>{u.getAttribute("data-type")===d?u.style.display="block":u.style.display="none"})})});const t=on.element.querySelector("#apiProvider");t&&t.addEventListener("change",()=>{const c=t.value,d=on.element.querySelector("#apiModel");if(d&&(d.innerHTML=on.getModelOptions(c),d.options.length>0)){d.selectedIndex=0;const f=on.element.querySelector("#modelDescription");f&&(f.textContent=on.getModelDescription(d.value,c))}const u=on.element.querySelector("#apiBaseURL");u&&(u.placeholder=on.getDefaultBaseURL(c)),["apiKey","apiBaseURL","apiProxy","apiVersion","apiUserAgent"].forEach(f=>{const h=on.element.querySelector(`[data-field="${f}"]`);h&&(c==="builtin"||f==="apiProxy"&&c!=="Custom"||f==="apiVersion"&&c!=="Azure"?h.classList.add("fn__none"):h.classList.remove("fn__none"))})});const e=on.element.querySelector("#apiModel");e&&e.addEventListener("change",()=>{const c=on.element.querySelector("#modelDescription");c&&(c.textContent=on.getModelDescription(e.value))});const n=on.element.querySelector('.b3-form__icona-icon[data-action="togglePassword"]');n&&n.addEventListener("click",()=>{const c=n.firstElementChild.getAttribute("xlink:href")==="#iconEye";n.firstElementChild.setAttribute("xlink:href",c?"#iconEyeoff":"#iconEye"),n.previousElementSibling.setAttribute("type",c?"text":"password")});const a=on.element.querySelector('.b3-form__icona-icon[data-action="toggleEmbeddingPassword"]');a&&a.addEventListener("click",()=>{const c=a.firstElementChild.getAttribute("xlink:href")==="#iconEye";a.firstElementChild.setAttribute("xlink:href",c?"#iconEyeoff":"#iconEye"),a.previousElementSibling.setAttribute("type",c?"text":"password")}),on.element.querySelectorAll("#apiKey, #apiModel, #apiMaxTokens, #apiTemperature, #apiMaxContexts, #apiProxy, #apiTimeout, #apiProvider, #apiBaseURL, #apiVersion, #apiUserAgent").forEach(c=>{c.addEventListener("change",()=>{const d=on.element.querySelector("#apiProvider").value,u=on.element.querySelector("#apiModel").value,g=d==="builtin",f={openAI:{apiUserAgent:on.element.querySelector("#apiUserAgent").value,apiBaseURL:g?"USE_DEFAULT_CONFIG":on.element.querySelector("#apiBaseURL").value,apiVersion:on.element.querySelector("#apiVersion").value,apiKey:g?"USE_DEFAULT_CONFIG":on.element.querySelector("#apiKey").value,apiModel:g?"USE_DEFAULT_CONFIG":u,apiMaxTokens:parseInt(on.element.querySelector("#apiMaxTokens").value),apiTemperature:parseFloat(on.element.querySelector("#apiTemperature").value),apiMaxContexts:parseInt(on.element.querySelector("#apiMaxContexts").value),apiProxy:on.element.querySelector("#apiProxy").value,apiTimeout:parseInt(on.element.querySelector("#apiTimeout").value),apiProvider:d}};ae("/api/setting/setAI",f,h=>{var m;if(window.siyuan.config.ai=h.data,g&&((m=window.siyuan.config.system)==null?void 0:m.container)==="web"){const b=localStorage.getItem("siyuan_jwt_token");b&&fetch(`${window.siyuan.config.system.unifiedAuthServiceUrl||"http://localhost:3002"}/api/settings/neuralink_llm`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({provider:"builtin",model:"USE_DEFAULT_CONFIG",api_key:"USE_DEFAULT_CONFIG",base_url:"USE_DEFAULT_CONFIG"})}).then(y=>y.json()).then(y=>{y.success&&console.log("\u5185\u7F6E\u514D\u8D39\u6A21\u578B\u914D\u7F6E\u5DF2\u4FDD\u5B58\u5230\u7528\u6237\u8BBE\u7F6E")}).catch(y=>{console.error("\u4FDD\u5B58\u7528\u6237\u8BBE\u7F6E\u5931\u8D25:",y)})}})})}),on.element.querySelectorAll("#embeddingProvider, #embeddingApiKey, #embeddingModel, #embeddingApiBaseUrl, #embeddingEncodingFormat, #embeddingTimeout, #embeddingEnabled").forEach(c=>{c.addEventListener("change",()=>{const d={provider:on.element.querySelector("#embeddingProvider").value,apiKey:on.element.querySelector("#embeddingApiKey").value,model:on.element.querySelector("#embeddingModel").value,apiBaseUrl:on.element.querySelector("#embeddingApiBaseUrl").value,encodingFormat:on.element.querySelector("#embeddingEncodingFormat").value,timeout:parseInt(on.element.querySelector("#embeddingTimeout").value),enabled:on.element.querySelector("#embeddingEnabled").checked};ae("/api/ai/setEmbeddingConfig",d,u=>{u.code===0?(window.siyuan.config.ai.embedding=u.data.data,on.showMessage("\u5411\u91CF\u5316\u914D\u7F6E\u5DF2\u4FDD\u5B58","success")):on.showMessage("\u4FDD\u5B58\u5931\u8D25: "+u.msg,"error")})})});const i=on.element.querySelector("#testEmbeddingConnection");i&&i.addEventListener("click",()=>{on.showMessage("\u6B63\u5728\u6D4B\u8BD5\u5411\u91CF\u5316\u670D\u52A1\u8FDE\u63A5...","info"),ae("/api/ai/testEmbeddingConnection",{},c=>{const d=on.element.querySelector("#aiTestResults");c.code===0?(d.textContent=`\u2705 \u8FDE\u63A5\u6D4B\u8BD5\u6210\u529F!
`+JSON.stringify(c.data,null,2),on.showMessage("\u8FDE\u63A5\u6D4B\u8BD5\u6210\u529F","success")):(d.textContent="\u274C \u8FDE\u63A5\u6D4B\u8BD5\u5931\u8D25: "+c.msg,on.showMessage("\u8FDE\u63A5\u6D4B\u8BD5\u5931\u8D25","error"))})});const s=on.element.querySelector("#getEmbeddingModels");s&&s.addEventListener("click",()=>{const c=on.element.querySelector("#embeddingProvider").value;on.showMessage(`\u6B63\u5728\u83B7\u53D6${c}\u7684\u53EF\u7528\u6A21\u578B...`,"info"),ae("/api/ai/getEmbeddingModels",{provider:c},d=>{const u=on.element.querySelector("#aiTestResults");d.code===0?(u.textContent=`\u2705 ${c}\u53EF\u7528\u6A21\u578B:
`+JSON.stringify(d.data,null,2),on.showMessage("\u6A21\u578B\u5217\u8868\u83B7\u53D6\u6210\u529F","success")):(u.textContent="\u274C \u83B7\u53D6\u6A21\u578B\u5217\u8868\u5931\u8D25: "+d.msg,on.showMessage("\u83B7\u53D6\u6A21\u578B\u5217\u8868\u5931\u8D25","error"))})});const r=on.element.querySelector("#semanticSearchTest");r&&r.addEventListener("click",()=>{const c=on.element.querySelector("#semanticSearchQuery").value;if(!c.trim()){on.showMessage("\u8BF7\u8F93\u5165\u641C\u7D22\u67E5\u8BE2","warning");return}on.showMessage("\u6B63\u5728\u6267\u884C\u8BED\u4E49\u641C\u7D22...","info"),ae("/api/ai/semanticSearch",{query:c,limit:10},d=>{const u=on.element.querySelector("#aiTestResults");d.code===0?(u.textContent=`\u2705 \u8BED\u4E49\u641C\u7D22\u7ED3\u679C:
`+JSON.stringify(d.data,null,2),on.showMessage("\u8BED\u4E49\u641C\u7D22\u5B8C\u6210","success")):(u.textContent="\u274C \u8BED\u4E49\u641C\u7D22\u5931\u8D25: "+d.msg,on.showMessage("\u8BED\u4E49\u641C\u7D22\u5931\u8D25","error"))})});const o=on.element.querySelector("#notebookSummaryTest");o&&o.addEventListener("click",()=>{const c=on.element.querySelector("#notebookSummaryId").value;if(!c.trim()){on.showMessage("\u8BF7\u8F93\u5165\u7B14\u8BB0\u672CID","warning");return}on.showMessage("\u6B63\u5728\u751F\u6210\u7B14\u8BB0\u672C\u6458\u8981...","info"),ae("/api/ai/generateNotebookSummary",{notebookId:c},d=>{const u=on.element.querySelector("#aiTestResults");d.code===0?(u.textContent=`\u2705 \u7B14\u8BB0\u672C\u6458\u8981:
`+JSON.stringify(d.data,null,2),on.showMessage("\u6458\u8981\u751F\u6210\u5B8C\u6210","success")):(u.textContent="\u274C \u6458\u8981\u751F\u6210\u5931\u8D25: "+d.msg,on.showMessage("\u6458\u8981\u751F\u6210\u5931\u8D25","error"))})});const l=on.element.querySelector("#batchVectorizeTest");l&&l.addEventListener("click",()=>{const c=on.element.querySelector("#batchVectorizeNotebook").value;if(!c.trim()){on.showMessage("\u8BF7\u8F93\u5165\u7B14\u8BB0\u672CID","warning");return}confirm("\u6279\u91CF\u5411\u91CF\u5316\u4F1A\u6D88\u8017API\u989D\u5EA6\uFF0C\u786E\u5B9A\u8981\u7EE7\u7EED\u5417\uFF1F")&&(on.showMessage("\u6B63\u5728\u6267\u884C\u6279\u91CF\u5411\u91CF\u5316\uFF0C\u8BF7\u7A0D\u5019...","info"),ae("/api/ai/batchVectorizeNotebook",{notebookId:c},d=>{const u=on.element.querySelector("#aiTestResults");d.code===0?(u.textContent=`\u2705 \u6279\u91CF\u5411\u91CF\u5316\u5B8C\u6210:
`+JSON.stringify(d.data,null,2),on.showMessage("\u6279\u91CF\u5411\u91CF\u5316\u5B8C\u6210","success")):(u.textContent="\u274C \u6279\u91CF\u5411\u91CF\u5316\u5931\u8D25: "+d.msg,on.showMessage("\u6279\u91CF\u5411\u91CF\u5316\u5931\u8D25","error"))}))})},showMessage:(t,e="info")=>{const n=document.createElement("div");n.className=`b3-dialog__message b3-dialog__message--${e}`,n.textContent=t,n.style.position="fixed",n.style.top="20px",n.style.right="20px",n.style.zIndex="1000",document.body.appendChild(n),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},3e3)}},Ws={element:void 0,genHTML:()=>{let t=`<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.flashcardMark}
        <div class="b3-label__text">${window.siyuan.languages.flashcardMarkTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="mark" type="checkbox"${window.siyuan.config.flashcard.mark?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.flashcardList}
        <div class="b3-label__text">${window.siyuan.languages.flashcardListTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="list" type="checkbox"${window.siyuan.config.flashcard.list?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.flashcardHeading}
        <div class="b3-label__text">${window.siyuan.languages.flashcardHeadingTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="heading" type="checkbox"${window.siyuan.config.flashcard.heading?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.flashcardSuperBlock}
        <div class="b3-label__text">${window.siyuan.languages.flashcardSuperBlockTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="superBlock" type="checkbox"${window.siyuan.config.flashcard.superBlock?" checked":""}/>
</label>
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.flashcardDeck}
        <div class="b3-label__text">${window.siyuan.languages.flashcardDeckTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="deck" type="checkbox"${window.siyuan.config.flashcard.deck?" checked":""}/>
</label>
<div class="fn__flex b3-label config__item">
    <div class="fn__flex-1">
        ${window.siyuan.languages.reviewMode}
        <div class="b3-label__text">${window.siyuan.languages.reviewModeTip}</div>
    </div>
    <span class="fn__space"></span>
    <select class="b3-select fn__flex-center fn__size200" id="reviewMode">
      <option value="0" ${window.siyuan.config.flashcard.reviewMode===0?"selected":""}>${window.siyuan.languages.reviewMode0}</option>
      <option value="1" ${window.siyuan.config.flashcard.reviewMode===1?"selected":""}>${window.siyuan.languages.reviewMode1}</option>
      <option value="2" ${window.siyuan.config.flashcard.reviewMode===2?"selected":""}>${window.siyuan.languages.reviewMode2}</option>
    </select>    
</div>`;return t=`${t}<div class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.flashcardNewCardLimit}
        <div class="b3-label__text">${window.siyuan.languages.flashcardNewCardLimitTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" id="newCardLimit" step="1" min="0" type="number"${window.siyuan.config.flashcard.newCardLimit?" checked":""} value="${window.siyuan.config.flashcard.newCardLimit}"/>
</div>
<div class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.flashcardReviewCardLimit}
        <div class="b3-label__text">${window.siyuan.languages.flashcardReviewCardLimitTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" id="reviewCardLimit" step="1" min="0" type="number"${window.siyuan.config.flashcard.reviewCardLimit?" checked":""} value="${window.siyuan.config.flashcard.reviewCardLimit}"/>
</div>
<div class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.flashcardFSRSParamRequestRetention}
        <div class="b3-label__text">${window.siyuan.languages.flashcardFSRSParamRequestRetentionTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" id="requestRetention" step="0.01" min="0" max="1" type="number" value="${window.siyuan.config.flashcard.requestRetention}"/>
</div>
<div class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.flashcardFSRSParamMaximumInterval}
        <div class="b3-label__text">${window.siyuan.languages.flashcardFSRSParamMaximumIntervalTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" id="maximumInterval" step="1" min="365" max="36500" type="number" value="${window.siyuan.config.flashcard.maximumInterval}"/>
</div>
<div class="fn__flex b3-label">
    <div class="fn__block">
        ${window.siyuan.languages.flashcardFSRSParamWeights}
        <div class="b3-label__text">${window.siyuan.languages.flashcardFSRSParamWeightsTip}</div>
        <span class="fn__hr"></span>
        <input class="b3-text-field fn__block" id="weights" value="${window.siyuan.config.flashcard.weights}"/>
    </div>
</div>`,t},bindEvent:()=>{Ws.element.querySelectorAll("input, select.b3-select").forEach(t=>{t.addEventListener("change",()=>{ae("/api/setting/setFlashcard",{reviewMode:parseInt(Ws.element.querySelector("#reviewMode").value),newCardLimit:parseInt(Ws.element.querySelector("#newCardLimit").value),reviewCardLimit:parseInt(Ws.element.querySelector("#reviewCardLimit").value),mark:Ws.element.querySelector("#mark").checked,list:Ws.element.querySelector("#list").checked,superBlock:Ws.element.querySelector("#superBlock").checked,heading:Ws.element.querySelector("#heading").checked,deck:Ws.element.querySelector("#deck").checked,requestRetention:parseFloat(Ws.element.querySelector("#requestRetention").value),maximumInterval:parseInt(Ws.element.querySelector("#maximumInterval").value),weights:Ws.element.querySelector("#weights").value},e=>{window.siyuan.config.flashcard=e.data})})})}},fi={element:void 0,genHTML:()=>{const t=x();return`
<label class="fn__flex b3-label">
    <div class="fn__flex-1">
        ${window.siyuan.languages.publishService}
        <div class="b3-label__text">${window.siyuan.languages.publishServiceTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-switch fn__flex-center" id="publishEnable" type="checkbox"${window.siyuan.config.publish.enable?" checked":""}/>
</label>
<div class="b3-label">
    ${t?`
${window.siyuan.languages.publishServicePort}
<span class="fn__hr"></span>
<input class="b3-text-field fn__block" id="publishPort" type="number" min="0" max="65535" value="${window.siyuan.config.publish.port}">
<div class="b3-label__text">${window.siyuan.languages.publishServicePortTip}</div>`:`
<div class="fn__flex">
    <div class="fn__flex-1">
        ${window.siyuan.languages.publishServicePort}
        <div class="b3-label__text">${window.siyuan.languages.publishServicePortTip}</div>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__flex-center fn__size200" id="publishPort" type="number" min="0" max="65535" value="${window.siyuan.config.publish.port}">
</div>`}
</div>
<div class="b3-label">
    <div class="fn__flex">
        <div class="fn__flex-1">
            ${window.siyuan.languages.publishServiceAddresses}
            <div class="b3-label__text">${window.siyuan.languages.publishServiceAddressesTip}</div>
        </div>
        <div class="fn__space"></div>
    </div>
    <div class="fn__hr"></div>
    <div id="publishAddresses">
    </div>
</div>
<div class="b3-label">
    <label class="fn__flex">
        <div class="fn__flex-1">
            ${window.siyuan.languages.publishServiceAuth}
            <div class="b3-label__text">${window.siyuan.languages.publishServiceAuthTip}</div>
        </div>
        <span class="fn__space"></span>
        <input class="b3-switch fn__flex-center" id="publishAuthEnable" type="checkbox"${window.siyuan.config.publish.auth.enable?" checked":""}/>
    </label>
</div>
<div class="b3-label">
    ${t?`
${window.siyuan.languages.publishServiceAuthAccounts}
<div class="b3-label__text">${window.siyuan.languages.publishServiceAuthAccountsTip}</div>
<div class="b3-label b3-label--inner fn__flex">
    <span class="fn__flex-1"></span>
    <button class="b3-button b3-button--outline fn__size200 fn__flex-center" id="publishAuthAccountAdd">
        <svg><use xlink:href="#iconAdd"></use></svg>${window.siyuan.languages.publishServiceAuthAccountAdd}
    </button>
</div>`:`
<div class="fn__flex">
    <div class="fn__flex-1">
        ${window.siyuan.languages.publishServiceAuthAccounts}
        <div class="b3-label__text">${window.siyuan.languages.publishServiceAuthAccountsTip}</div>
    </div>
    <div class="fn__space"></div>
    <button class="b3-button b3-button--outline fn__size200 fn__flex-center" id="publishAuthAccountAdd">
        <svg><use xlink:href="#iconAdd"></use></svg>${window.siyuan.languages.publishServiceAuthAccountAdd}
    </button>
</div>`}
    <div class="fn__flex-1" id="publishAuthAccounts">
    </div>
</div>
`},bindEvent:()=>{fi.element.querySelector("#publishAuthAccountAdd").addEventListener("click",()=>{window.siyuan.config.publish.auth.accounts.push({username:"",password:"",memo:""}),fi._renderPublishAuthAccounts(fi.element)}),fi.element.querySelectorAll("input").forEach(e=>{e.addEventListener("change",()=>{fi._savePublish()})}),fi._refreshPublish()},_refreshPublish:()=>{ae("/api/setting/getPublish",{},fi._updatePublishConfig.bind(null,!0))},_savePublish:(t=!0)=>{const e=fi.element.querySelector("#publishEnable"),n=fi.element.querySelector("#publishPort"),a=fi.element.querySelector("#publishAuthEnable");ae("/api/setting/setPublish",{enable:e.checked,port:n.valueAsNumber,auth:{enable:a.checked,accounts:window.siyuan.config.publish.auth.accounts}},fi._updatePublishConfig.bind(null,t))},_updatePublishConfig:(t,e)=>{e.code===0?(window.siyuan.config.publish=e.data.publish,t&&fi._renderPublishAuthAccounts(fi.element),fi._renderPublishAddressList(fi.element,e.data.port)):fi._renderPublishAddressList(fi.element,0)},_renderPublishAuthAccounts:(t,e=window.siyuan.config.publish.auth.accounts)=>{const n=x(),a=t.querySelector("#publishAuthAccounts");a.innerHTML=`<div class="fn__hr"></div><ul class="fn__flex-1">${e.map((i,s)=>`
<li class="b3-label b3-label--inner fn__flex" data-index="${s}">
    <input class="b3-text-field fn__block" data-name="username" value="${i.username}" placeholder="${window.siyuan.languages.userName}">
    <span class="fn__space"></span>
    <div class="b3-form__icona fn__block">
        <input class="b3-text-field fn__block b3-form__icona-input" type="password" data-name="password" value="${i.password}" placeholder="${window.siyuan.languages.password}">
        <svg class="b3-form__icona-icon" data-action="togglePassword"><use xlink:href="#iconEye"></use></svg>
    </div>
    <span class="fn__space"></span>
    <input class="b3-text-field fn__block" data-name="memo" value="${i.memo}" placeholder="${window.siyuan.languages.memo}">
    <span class="fn__space"></span>
    ${n?`
<button class="b3-button b3-button--outline fn__block" data-action="remove">
    <svg><use xlink:href="#iconTrashcan"></use></svg>${window.siyuan.languages.delete}
</button>`:`
<span data-action="remove" class="block__icon block__icon--show">
    <svg><use xlink:href="#iconTrashcan"></use></svg>
</span>`}
</li>
`).join("")}</ul>`,a.querySelectorAll("input").forEach(i=>{i.addEventListener("change",()=>{const s=A(i,"LI");if(s){const r=parseInt(s.dataset.index),o=i.dataset.name;o in window.siyuan.config.publish.auth.accounts[r]&&(window.siyuan.config.publish.auth.accounts[r][o]=i.value,fi._savePublish(!1))}})}),a.querySelectorAll('[data-action="remove"]').forEach(i=>{i.addEventListener("click",()=>{const s=A(i,"LI");if(s){const r=parseInt(s.dataset.index);window.siyuan.config.publish.auth.accounts.splice(r,1),fi._savePublish()}})}),a.querySelectorAll('.b3-form__icona-icon[data-action="togglePassword"]').forEach(i=>{i.addEventListener("click",()=>{const s=i.firstElementChild.getAttribute("xlink:href")==="#iconEye";i.firstElementChild.setAttribute("xlink:href",s?"#iconEyeoff":"#iconEye"),i.previousElementSibling.setAttribute("type",s?"text":"password")})})},_renderPublishAddressList:(t,e)=>{const n=t.querySelector("#publishAddresses");e===0?n.innerText=window.siyuan.languages.publishServiceNotStarted:n.innerHTML=`<ul class="b3-list fn__flex-1" style="padding: 2px 0;">${window.siyuan.config.localIPs.filter(a=>!(a.startsWith("[")&&a.endsWith("]"))).map(a=>`<li><code class="fn__code">${a}:${e}</code></li>`).join("")}${window.siyuan.config.localIPs.filter(a=>a.startsWith("[")&&a.endsWith("]")).map(a=>`<li><code class="fn__code">${a}:${e}</code></li>`).join("")}</ul>`}},zL=(t,e,n)=>{switch(t){case"filetree":e.innerHTML=ni.genHTML(),ni.element=e,ni.bindEvent();break;case"AI":e.innerHTML=on.genHTML(),on.element=e,on.bindEvent();break;case"card":e.innerHTML=Ws.genHTML(),Ws.element=e,Ws.bindEvent();break;case"image":e.innerHTML=jr.genHTML(),jr.element=e,jr.bindEvent();break;case"export":e.innerHTML=la.genHTML(),la.element=e,la.bindEvent();break;case"appearance":e.innerHTML=Ta.genHTML(),Ta.element=e,Ta.bindEvent();break;case"keymap":e.innerHTML=wa.genHTML(n),wa.element=e,wa.bindEvent(n);break;case"bazaar":vn.element=e,e.innerHTML=vn.genHTML(),vn.bindEvent(n);break;case"account":e.innerHTML=ii.genHTML(),ii.element=e,ii.bindEvent(ii.element);break;case"repos":e.innerHTML=ai.genHTML(),ai.element=e,ai.bindEvent();break;case"about":e.innerHTML=$a.genHTML(),$a.element=e,$a.bindEvent();break;case"search":e.innerHTML=ia.genHTML(),ia.element=e,ia.bindEvent();break;case"publish":e.innerHTML=fi.genHTML(),fi.element=e,fi.bindEvent();break;default:break}},Dc=t=>{const e=window.siyuan.dialogs.find(i=>{if(i.element.querySelector(".config__tab-container"))return i.destroy(),!0});if(e)return e;let n;getSelection().rangeCount>0&&(n=getSelection().getRangeAt(0));const a=new fe({content:`<div class="fn__flex-1 fn__flex config__panel" style="overflow: hidden;position: relative">
  <ul class="b3-tab-bar b3-list b3-list--background">
    <div class="config__tab-title resize__move">
        <svg class="b3-list-item__graphic"><use xlink:href="#iconSettings"></use></svg>
        <span class="b3-list-item__text">${window.siyuan.languages.config}</span>
    </div>
    <div class="b3-form__icon"><svg class="b3-form__icon-icon"><use xlink:href="#iconSearch"></use></svg><input placeholder="${window.siyuan.languages.search}" class="b3-text-field fn__block b3-form__icon-input"></div>
    <div class="config__tab-hr"></div>
    <li data-name="editor" class="b3-list-item--focus b3-list-item"><svg class="b3-list-item__graphic"><use xlink:href="#iconEdit"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.editor}</span></li>
    <li data-name="filetree" class="b3-list-item"><svg class="b3-list-item__graphic"><use xlink:href="#iconFiles"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.fileTree}</span></li>
    <li data-name="card" class="b3-list-item"><svg class="b3-list-item__graphic"><use xlink:href="#iconRiffCard"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.riffCard}</span></li>
    <li data-name="AI" class="b3-list-item"><svg class="b3-list-item__graphic"><use xlink:href="#iconSparkles"></use></svg><span class="b3-list-item__text">AI</span></li>
    <li data-name="image" class="b3-list-item"><svg class="b3-list-item__graphic"><use xlink:href="#iconImage"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.assets}</span></li>
    <li data-name="export" class="b3-list-item"><svg class="b3-list-item__graphic"><use xlink:href="#iconUpload"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.export}</span></li>
    <li data-name="appearance" class="b3-list-item"><svg class="b3-list-item__graphic"><use xlink:href="#iconTheme"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.appearance}</span></li>
    <li data-name="bazaar" class="b3-list-item${Tt()||Qt()?" fn__none":""}"><svg class="b3-list-item__graphic"><use xlink:href="#iconBazaar"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.bazaar}</span></li>
    <li data-name="search" class="b3-list-item"><svg class="b3-list-item__graphic"><use xlink:href="#iconSearch"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.search}</span></li>
    <li data-name="keymap" class="b3-list-item"><svg class="b3-list-item__graphic"><use xlink:href="#iconKeymap"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.keymap}</span></li>
    <li data-name="account" class="b3-list-item"><svg class="b3-list-item__graphic"><use xlink:href="#iconAccount"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.account}</span></li>
    <li data-name="repos" class="b3-list-item"><svg class="b3-list-item__graphic"><use xlink:href="#iconCloud"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.cloud}</span></li>
    <li data-name="publish" class="b3-list-item"><svg class="b3-list-item__graphic"><use xlink:href="#iconLanguage"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.publish}</span></li>
    <li data-name="about" class="b3-list-item"><svg class="b3-list-item__graphic"><use xlink:href="#iconInfo"></use></svg><span class="b3-list-item__text">${window.siyuan.languages.about}</span></li>
  </ul>
  <div class="config__tab-wrap">
      <div class="fn__hr--b resize__move"></div>
      <div class="config__tab-container" data-name="editor">${In.genHTML()}</div>
      <div class="config__tab-container fn__none" data-name="filetree"></div>
      <div class="config__tab-container fn__none" data-name="card"></div>
      <div class="config__tab-container config__tab-container--top fn__none" data-name="AI"></div>
      <div class="config__tab-container config__tab-container--top fn__none" data-name="image"></div>
      <div class="config__tab-container fn__none" data-name="export"></div>
      <div class="config__tab-container fn__none" data-name="appearance"></div>
      <div class="config__tab-container config__tab-container--top fn__none" data-name="bazaar"></div>
      <div class="config__tab-container fn__none" data-name="search"></div>
      <div class="config__tab-container fn__none" style="overflow: scroll" data-name="keymap"></div>
      <div class="config__tab-container config__tab-container--full fn__none" data-name="account"></div>
      <div class="config__tab-container fn__none" data-name="repos"></div>
      <div class="config__tab-container fn__none" data-name="publish"></div>
      <div class="config__tab-container fn__none" data-name="about"></div>
      <div class="fn__hr--b"></div>
  </div>
</div>`,width:"90vw",height:"90vh",destroyCallback(){n&&Pt(n)}});return a.element.setAttribute("data-key",p.DIALOG_SETTING),LV(a.element,t),a.element.querySelector(".b3-dialog__container").style.maxWidth="1280px",a.element.querySelectorAll(".b3-tab-bar .b3-list-item").forEach(i=>{i.addEventListener("click",()=>{const s=i.getAttribute("data-name"),r=a.element.querySelector(`.config__tab-container[data-name="${s}"]`);a.element.querySelectorAll(".config__tab-container").forEach(o=>{o.classList.add("fn__none")}),a.element.querySelector(".b3-tab-bar .b3-list-item.b3-list-item--focus").classList.remove("b3-list-item--focus"),i.classList.add("b3-list-item--focus"),r.classList.remove("fn__none"),(r.innerHTML===""||s==="repos"||s==="bazaar")&&zL(s,r,t)})}),In.element=a.element.querySelector('.config__tab-container[data-name="editor"]'),In.bindEvent(),a};var PV=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});let YL,GL;GL=t=>{if(t.doc&&t.doc.id){dV(t.doc.id,{position:t.position,width:t.width,height:t.height});return}if(t.tab){ML(t.tab,{position:t.position,width:t.width,height:t.height});return}},YL=t=>{if(t.doc)return t.doc.zoomIn&&(t.doc.action&&!t.doc.action.includes(p.CB_GET_ALL)?t.doc.action.push(p.CB_GET_ALL):t.doc.action=[p.CB_GET_ALL]),t.doc.action||(t.doc.action=[]),dn({app:t.app,keepCursor:t.keepCursor,removeCurrentTab:t.removeCurrentTab,position:t.position,afterOpen:t.afterOpen,id:t.doc.id,action:t.doc.action,zoomIn:t.doc.zoomIn});if(t.asset)return qs({app:t.app,keepCursor:t.keepCursor,removeCurrentTab:t.removeCurrentTab,position:t.position,afterOpen:t.afterOpen,assetPath:t.asset.path});if(t.pdf)return qs({app:t.app,keepCursor:t.keepCursor,removeCurrentTab:t.removeCurrentTab,position:t.position,afterOpen:t.afterOpen,assetPath:t.pdf.path,page:t.pdf.id||t.pdf.page});if(t.search)return t.search.idPath||(t.search.idPath=[]),t.search.hPath||(t.search.hPath=""),qs({app:t.app,keepCursor:t.keepCursor,removeCurrentTab:t.removeCurrentTab,position:t.position,afterOpen:t.afterOpen,searchData:t.search});if(t.card)return qs({app:t.app,keepCursor:t.keepCursor,removeCurrentTab:t.removeCurrentTab,position:t.position,afterOpen:t.afterOpen,custom:{icon:"iconRiffCard",title:window.siyuan.languages.spaceRepetition,data:{cardType:t.card.type,id:t.card.id||"",title:t.card.title},id:"siyuan-card"}});if(t.custom)return qs(t)};const jL=t=>Vn(t).data[t],NV={adaptHotkey:Mt,confirm:Sn,Constants:p,showMessage:Q,hideMessage:ot,fetchPost:ae,fetchSyncPost:wn,fetchGet:gL,getFrontend:C,getBackend:M,getModelByDockType:jL,openTab:YL,openWindow:GL,openMobileFileById:mM,lockScreen:pw,exitSiYuan:Ac,Protyle:ar,Plugin:IL,Dialog:fe,Menu:ta,Setting:uV,getAllEditor:Es,getActiveTab:ir,getAllModels:Cn,getActiveEditor:(t=!0)=>{let e;const n=getSelection().rangeCount>0?getSelection().getRangeAt(0):null,a=Es();if(n&&(e=a.find(i=>{if(i.protyle.element.contains(n.startContainer))return!0})),e||(e=a.find(i=>{if(N(i.protyle.element,"layout__wnd--active",!0))return!0})),!e&&!t){let i=0;a.forEach(s=>{var r;let o=(r=s.protyle.model)==null?void 0:r.parent.headElement;if(!o&&s.protyle.element.getBoundingClientRect().height>0){const l=s.protyle.element.closest(".fn__flex-1[data-id]");l&&(o=document.querySelector(`.layout-tab-bar .item[data-id="${l.getAttribute("data-id")}"]`))}o?o.classList.contains("item--focus")&&parseInt(o.dataset.activetime)>i&&(i=parseInt(o.dataset.activetime),e=s):s.protyle.element.getBoundingClientRect().height>0&&(e=s)})}return e},platformUtils:Xe,openSetting:Dc,openAttributePanel:t=>{t.data?Zs(t.data,t.focusName,t.protyle):Ho(t.nodeElement,t.focusName,t.protyle)},saveLayout:t=>{Ss({cb:t,errorExit:!1})},globalCommand:Do,expandDocTree:t=>PV(void 0,null,function*(){var e;let n=!1;window.siyuan.notebooks.find(o=>{if(t.id===o.id)return n=!0,!0});let a,i=t.id;const s=jL("file");if(typeof t.isSetCurrent=="undefined"&&(t.isSetCurrent=!0),n)a=(e=s.element.querySelector(`.b3-list[data-url="${t.id}"]`))==null?void 0:e.firstElementChild;else{const o=yield wn("api/block/getBlockInfo",{id:t.id});if(o.code===-1)return;i=o.data.box,a=yield s.selectItem(o.data.box,o.data.path,void 0,void 0,t.isSetCurrent)}!a||((t.isSetCurrent||typeof t.isSetCurrent=="undefined")&&s.setCurrent(a),a.querySelector(".b3-list-item__arrow").classList.contains("b3-list-item__arrow--open"))||s.getLeaf(a,i)})};var Tw=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const KL=t=>{var e,n;return(n={siyuan:NV}[t])!=null?n:(e=window.require)==null?void 0:e.call(window,t)};window.require instanceof Function&&(KL.__proto__=window.require);const BV=(t,e)=>window.eval("(function anonymous(require, module, exports){".concat(t,`
})
//# sourceURL=`).concat(e,`
`)),JE=(t,e)=>Tw(void 0,null,function*(){const n=yield wn("/api/petal/loadPetals",{frontend:C()});let a='<style id="pluginsStyle"></style>';n.data.forEach(s=>{(!e||e&&e.includes(s.name))&&XL(t,s),s.css&&(a+=`<style id="pluginsStyle${s.name}">${s.css}</style>`)});const i=document.getElementById("pluginsStyle");i?i.insertAdjacentHTML("afterend",a):document.head.insertAdjacentHTML("beforeend",a)}),XL=(t,e)=>Tw(void 0,null,function*(){const n={},a={exports:n};try{BV(e.js,"plugin:"+encodeURIComponent(e.name))(KL,a,n)}catch(r){console.error(`plugin ${e.name} run error:`,r);return}const i=(a.exports||n).default||a.exports;if(typeof i!="function"){console.error(`plugin ${e.name} has no export`);return}if(!(i.prototype instanceof IL)){console.error(`plugin ${e.name} does not extends Plugin`);return}const s=new i({app:t,displayName:e.displayName,name:e.name,i18n:e.i18n});t.plugins.push(s);try{yield s.onload()}catch(r){console.error(`plugin ${e.name} onload error:`,r)}return s}),ZL=(t,e)=>Tw(void 0,null,function*(){const n=yield XL(t,e);if(e.css){const a=document.createElement("style");a.id="pluginsStyle"+e.name,a.textContent=e.css,document.head.append(a)}return Dw(n),Fi(),Es().forEach(a=>{a.protyle.toolbar.update(a.protyle)}),n}),QE=(t,e,n,a)=>{const i=Object.keys(n.docks);t.forEach((s,r)=>{i.includes(s.type)&&(a==="Left"?n.docks[s.type].config.position=e===0?"LeftTop":"LeftBottom":a==="Right"?n.docks[s.type].config.position=e===0?"RightTop":"RightBottom":a==="Bottom"&&(n.docks[s.type].config.position=e===0?"BottomLeft":"BottomRight"),n.docks[s.type].config.index=r,n.docks[s.type].config.show=s.show,n.docks[s.type].config.size=s.size,window.siyuan.storage[p.LOCAL_PLUGIN_DOCKS][n.name]||(window.siyuan.storage[p.LOCAL_PLUGIN_DOCKS][n.name]={}),window.siyuan.storage[p.LOCAL_PLUGIN_DOCKS][n.name][s.type]=n.docks[s.type].config,Gt(p.LOCAL_PLUGIN_DOCKS,window.siyuan.storage[p.LOCAL_PLUGIN_DOCKS]))})},Dw=t=>{try{t.onLayoutReady()}catch(e){console.error(`plugin ${t.name} onLayoutReady error:`,e)}(!E()||x())&&t.topBarIcons.forEach(e=>{document.contains(e)||(x()?window.siyuan.storage[p.LOCAL_PLUGINTOPUNPIN].includes(e.id)||document.querySelector("#menuAbout").after(e):E()||(window.siyuan.storage[p.LOCAL_PLUGINTOPUNPIN].includes(e.id)&&e.classList.add("fn__none"),document.querySelector("#"+(e.getAttribute("data-location")==="right"?"barPlugins":"drag")).before(e)))}),am(),t.statusBarIcons.forEach(e=>{if(document.contains(e))return;const n=document.getElementById("status");e.getAttribute("data-location")==="right"?n.insertAdjacentElement("beforeend",e):n.insertAdjacentElement("afterbegin",e)}),!E()&&(window.siyuan.config.uiLayout.left.data.forEach((e,n)=>{QE(e,n,t,"Left")}),window.siyuan.config.uiLayout.right.data.forEach((e,n)=>{QE(e,n,t,"Right")}),window.siyuan.config.uiLayout.bottom.data.forEach((e,n)=>{QE(e,n,t,"Bottom")}),Object.keys(t.docks).forEach(e=>{var n;window.siyuan.storage[p.LOCAL_PLUGIN_DOCKS][t.name]&&window.siyuan.storage[p.LOCAL_PLUGIN_DOCKS][t.name][e]&&(t.docks[e].config=window.siyuan.storage[p.LOCAL_PLUGIN_DOCKS][t.name][e]);const a=t.docks[e],i=window.siyuan.config.keymap.plugin[t.name]?(n=window.siyuan.config.keymap.plugin[t.name][e])==null?void 0:n.custom:void 0;a.config.position.startsWith("Left")?window.siyuan.layout.leftDock.genButton([{type:e,size:a.config.size,show:a.config.show,icon:a.config.icon,title:a.config.title,hotkey:i}],a.config.position==="LeftBottom"?1:0,a.config.index):a.config.position.startsWith("Bottom")?window.siyuan.layout.bottomDock.genButton([{type:e,size:a.config.size,show:a.config.show,icon:a.config.icon,title:a.config.title,hotkey:i}],a.config.position==="BottomRight"?1:0,a.config.index):a.config.position.startsWith("Right")&&window.siyuan.layout.rightDock.genButton([{type:e,size:a.config.size,show:a.config.show,icon:a.config.icon,title:a.config.title,hotkey:i}],a.config.position==="RightBottom"?1:0,a.config.index)}))},JL=(t,e)=>Tw(void 0,null,function*(){e.removePlugins.forEach(n=>{Aw(t,n,!0)}),e.upsertPlugins.forEach(n=>{Aw(t,n,!1)}),JE(t,e.upsertPlugins).then(()=>{t.plugins.forEach(n=>{e.upsertPlugins.includes(n.name)&&Dw(n)})}),Fi()});var $V=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const ca=(t,e=!0)=>{var n,a;t.getAttribute("data-type")==="wnd"&&Gg(((n=t.querySelector('.layout-tab-bar .item--focus[data-type="tab-header"] .item__text'))==null?void 0:n.textContent)||window.siyuan.languages.siyuanNote),!(t.classList.contains("layout__tab--active")||t.classList.contains("layout__wnd--active"))&&(document.querySelectorAll(".layout__tab--active").forEach(i=>{i.classList.remove("layout__tab--active")}),document.querySelectorAll(".dock__item--activefocus").forEach(i=>{i.classList.remove("dock__item--activefocus")}),document.querySelectorAll(".layout__wnd--active").forEach(i=>{i.classList.remove("layout__wnd--active")}),t.getAttribute("data-type")==="wnd"?(t.classList.add("layout__wnd--active"),(a=t.querySelector(".layout-tab-bar .item--focus"))==null||a.setAttribute("data-activetime",new Date().getTime().toString()),e&&Fi()):(t.classList.add("layout__tab--active"),Array.from(t.classList).find(i=>{if(i.startsWith("sy__"))return document.querySelector(`.dock__item[data-type="${i.substring(4)}"]`).classList.add("dock__item--activefocus"),!0})))},ek=(t,e)=>{const n=[];e.children.forEach(a=>{if(a.model instanceof Ma&&a.model.editor.protyle.toolbar.range){const i=oe(a.model.editor.protyle.toolbar.range.startContainer);if(i){const s=ya(i,void 0,a.model.editor.protyle.toolbar.range);n.push({id:i.getAttribute("data-node-id"),start:s.start,end:s.end})}}}),t.element.after(e.element),e.children.forEach(a=>{if(a.model instanceof Ma){const i=n.splice(0,1)[0];if(!i)return;const s=nr(a.model.editor.protyle.wysiwyg.element.querySelector(`[data-node-id="${i.id}"]`),i.start,i.end);s&&(a.model.editor.protyle.toolbar.range=s)}}),t.element.after(t.element.previousElementSibling),t.parent.children.find((a,i)=>{if(a.id===t.id){const s=t.parent.children[i].resize;t.parent.children[i].resize=t.parent.children[i-1].resize,t.parent.children[i-1].resize=s;const r=a;return t.parent.children[i]=t.parent.children[i-1],t.parent.children[i-1]=r,!0}})},nm=t=>{const e=[];return rp(t,e),e.sort((n,a)=>{var i,s;if(((i=n.element.querySelector(".fn__flex .item--focus"))==null?void 0:i.getAttribute("data-activetime"))>((s=a.element.querySelector(".fn__flex .item--focus"))==null?void 0:s.getAttribute("data-activetime")))return-1})[0]},Pl=t=>{const e=[],n=s=>{const r=[];return t.element.querySelectorAll(`span[data-index="${s}"]`).forEach(o=>{r.push({type:o.getAttribute("data-type"),size:{height:parseInt(o.getAttribute("data-height")),width:parseInt(o.getAttribute("data-width"))},title:o.getAttribute("data-title"),show:o.classList.contains("dock__item--active"),icon:o.querySelector("use").getAttribute("xlink:href").substring(1),hotkey:o.getAttribute("data-hotkey")||"",hotkeyLangId:o.getAttribute("data-hotkeyLangId")||""})}),r},a=n(0),i=n(1);return(a.length>0||i.length>0)&&e.push(a),i.length>0&&e.push(i),{pin:t.pin,data:e}},QL=()=>{window.siyuan.config.readonly?window.location.reload():ae("/api/system/setUILayout",{layout:{}},()=>{window.siyuan.storage[p.LOCAL_FILEPOSITION]={},Gt(p.LOCAL_FILEPOSITION,window.siyuan.storage[p.LOCAL_FILEPOSITION]),window.siyuan.storage[p.LOCAL_DIALOGPOSITION]={},Gt(p.LOCAL_DIALOGPOSITION,window.siyuan.storage[p.LOCAL_DIALOGPOSITION]),window.location.reload()})};let Cw=0;const Fi=()=>{const t={};let e={};if(E())e={layout:{}},el(window.siyuan.layout.layout,e.layout,t);else{const n=document.querySelector("#barDock use");n&&(e={hideDock:n.getAttribute("xlink:href")==="#iconDock",layout:{},bottom:Pl(window.siyuan.layout.bottomDock),left:Pl(window.siyuan.layout.leftDock),right:Pl(window.siyuan.layout.rightDock)},el(window.siyuan.layout.layout,e.layout,t),window.siyuan.config.uiLayout=e)}Object.keys(t).length>0&&Cw<10?(Cw++,setTimeout(()=>{Fi()},p.TIMEOUT_LOAD*Cw)):(Cw=0,E()?sessionStorage.setItem("layout",JSON.stringify(e)):window.siyuan.config.readonly||ae("/api/system/setUILayout",{layout:e,errorExit:!1}))},Ss=t=>$V(void 0,null,function*(){const e=Cn().editor;for(let i=0;i<e.length;i++)yield Th(e[i].editor.protyle);if(E()){const i={layout:{}};el(window.siyuan.layout.layout,i.layout),sessionStorage.setItem("layout",JSON.stringify(i)),t.cb();return}const n=document.querySelector("#barDock use");if(!n)return;const a={hideDock:n.getAttribute("xlink:href")==="#iconDock",layout:{},bottom:Pl(window.siyuan.layout.bottomDock),left:Pl(window.siyuan.layout.leftDock),right:Pl(window.siyuan.layout.rightDock)};el(window.siyuan.layout.layout,a.layout),window.siyuan.config.readonly?t.cb():ae("/api/system/setUILayout",{layout:a,errorExit:t.errorExit},()=>{t.cb()})}),tk=()=>{const t={hideDock:document.querySelector("#barDock use").getAttribute("xlink:href")==="#iconDock",layout:{},bottom:Pl(window.siyuan.layout.bottomDock),left:Pl(window.siyuan.layout.leftDock),right:Pl(window.siyuan.layout.rightDock)};return el(window.siyuan.layout.layout,t.layout),t},nk=t=>{t.forEach(e=>{var n;e.hotkeyLangId&&(e.title=window.siyuan.languages[e.hotkeyLangId]||e.hotkeyLangId,e.hotkeyLangId==="ai"&&(e.title="AI Chat"),e.hotkey=((n=window.siyuan.config.keymap.general[e.hotkeyLangId])==null?void 0:n.custom)||"")})},OV=(t,e)=>{let n=!1;t.left.data.forEach(i=>{i.forEach(s=>{s.type==="backlink"&&(n=!0)})}),n||(t.right.data.forEach((i,s)=>{t.right.data[s]=i.filter(r=>r.type!=="backlink")}),t.left.data[1]||(t.left.data[1]=[]),t.left.data[1].push({type:"backlink",size:{width:320,height:0},show:!1,icon:"iconLink",hotkeyLangId:"backlinks"})),t.left.data.forEach((i,s)=>{t.left.data[s]=i.filter(r=>r.type!=="ai")});let a=!1;t.right.data.forEach(i=>{i.forEach(s=>{s.type==="ai"&&(a=!0)})}),a||(t.right.data[0]||(t.right.data[0]=[]),t.right.data[0].unshift({type:"ai",size:{width:360,height:0},show:!1,icon:"iconSparkles",hotkeyLangId:"ai"})),t.left.data.forEach(i=>{nk(i)}),t.right.data.forEach(i=>{nk(i)}),t.bottom.data.forEach(i=>{nk(i)}),window.siyuan.layout.centerLayout=window.siyuan.layout.layout.children[0].children[1],window.siyuan.layout.leftDock=new VE({position:"Left",data:t.left,app:e}),window.siyuan.layout.rightDock=new VE({position:"Right",data:t.right,app:e}),window.siyuan.layout.bottomDock=new VE({position:"Bottom",data:t.bottom,app:e})},eI=[],ak=(t,e,n)=>{let a;if(e.instance==="Layout"){for(;e.children.length===1&&e.children[0].instance==="Layout"&&e.children[0].type==="normal"&&e.children[0].children.length===1;)e.children=e.children[0].children;n?(a=new Gr({direction:e.direction,size:e.size,type:e.type,resize:e.resize}),n.addLayout(a)):window.siyuan.layout.layout=new Gr({element:document.getElementById("layouts"),direction:e.direction,size:e.size,type:e.type,resize:e.resize})}else if(e.instance==="Wnd")a=new zg(t,e.resize,n.type),n.addWnd(a),e.width&&(a.element.classList.remove("fn__flex-1"),a.element.style.width=e.width),e.height&&(a.element.classList.remove("fn__flex-1"),a.element.style.height=e.height);else if(e.instance==="Tab"){if(!e.title)a=CL(t);else{let i=e.title;e.lang&&(i=window.siyuan.languages[e.lang]),a=new Sa({icon:e.icon,docIcon:e.docIcon,title:i})}e.pin&&(a.headElement.classList.add("item--pin"),(e.docIcon||e.icon)&&a.headElement.querySelector(".item__text").classList.add("fn__none")),e.active&&a.headElement&&a.headElement.setAttribute("data-init-active","true"),n.addTab(a,!1,!1,e.activeTime)}else e.instance==="Editor"&&e.blockId?(window.siyuan.config.fileTree.openFilesUseCurrentTab&&n.headElement.classList.add("item--unupdate"),n.headElement.setAttribute("data-initdata",JSON.stringify(e))):e.instance==="Asset"?n.addModel(new El({app:t,tab:n,path:e.path,page:e.page})):e.instance==="Backlink"?n.addModel(new yl({app:t,tab:n,blockId:e.blockId,rootId:e.rootId,type:e.type})):e.instance==="Bookmark"?n.addModel(new cu(t,n)):e.instance==="Files"?n.addModel(new js({app:t,tab:n})):e.instance==="Graph"?n.addModel(new Il({app:t,tab:n,blockId:e.blockId,rootId:e.rootId,type:e.type})):e.instance==="Outline"?n.addModel(new cc({app:t,tab:n,blockId:e.blockId,type:e.type,isPreview:e.isPreview})):e.instance==="Tag"?n.addModel(new Sc(t,n)):e.instance==="AI"?n.addModel(new qE(t,n)):e.instance==="Search"?n.addModel(new Ll({app:t,tab:n,config:e.config})):e.instance==="Custom"&&(window.siyuan.config.fileTree.openFilesUseCurrentTab&&n.headElement.classList.add("item--unupdate"),n.headElement.setAttribute("data-initdata",JSON.stringify(e)));"children"in e&&(Array.isArray(e.children)?e.children.forEach(i=>{ak(t,i,n?a:window.siyuan.layout.layout)}):e.children&&Object.keys(e.children).length>0?ak(t,e.children,a):a instanceof Sa&&eI.push(a))},RV=(t,e)=>{ak(t,window.siyuan.config.uiLayout.layout,void 0),OV(window.siyuan.config.uiLayout,t),window.siyuan.config.fileTree.closeTabsOnStart&&(sessionStorage.getItem(p.LOCAL_SESSION_FIRSTLOAD)||(So().forEach(a=>{a.headElement&&!a.headElement.classList.contains("item--pin")&&a.parent.removeTab(a.id,!1,!1,!1)}),sessionStorage.setItem(p.LOCAL_SESSION_FIRSTLOAD,"true"))),document.querySelectorAll('li[data-type="tab-header"]').forEach(a=>{const i=a.getAttribute("data-initdata");if(i){const s=JSON.parse(i);if(s.instance==="Custom"&&s.customModelType!=="siyuan-card"){let r=!1;if(t.plugins.find(o=>{if(Object.keys(o.models).includes(s.customModelType))return r=!0,!0}),!r){const o=a.getAttribute("data-id"),l=mi(o);l&&l.parent.removeTab(o,!1,!1,!1)}}}});const n=gy();if(n.id)dn({app:t,id:n.id,action:n.isZoomIn?[p.CB_GET_ALL,p.CB_GET_FOCUS]:[p.CB_GET_FOCUS,p.CB_GET_CONTEXT,p.CB_GET_ROOTSCROLL],zoomIn:n.isZoomIn});else{let a;document.querySelectorAll('li[data-type="tab-header"][data-init-active="true"]').forEach(i=>{a?i.dataset.activetime>a.dataset.activetime&&(a=i):a=i;const s=mi(i.getAttribute("data-id"));s.parent.switchTab(i,!1,!1,!0,!1),s.parent.showHeading()}),a&&ca(a.parentElement.parentElement.parentElement,!1),eI.forEach(i=>{i.parent.removeTab(i.id,!1,!1,!1)})}t.plugins.forEach(a=>{Dw(a)}),Fi(),am()},el=(t,e,n)=>{var a;t instanceof Gr?(e.direction=t.direction,t.parent&&(t.element.classList.contains("fn__flex-1")?e.size="auto":e.size=(t.parent.direction==="tb"?t.element.clientHeight:t.element.clientWidth)+"px"),e.resize=t.resize,e.type=t.type,e.instance="Layout"):t instanceof zg?(e.resize=t.resize,e.height=t.element.style.height,e.width=t.element.style.width,e.instance="Wnd"):t instanceof Sa?(t.headElement&&(e.title=t.title,e.icon=t.icon,e.docIcon=t.docIcon,e.pin=t.headElement.classList.contains("item--pin"),t.model instanceof js?e.lang="fileTree":t.model instanceof yl&&t.model.type==="pin"?e.lang="backlinks":t.model instanceof cu?e.lang="bookmark":t.model instanceof Il&&t.model.type!=="local"?e.lang="graphView":t.model instanceof cc&&t.model.type!=="local"?e.lang="outline":t.model instanceof Sc&&(e.lang="tag"),t.headElement.classList.contains("item--focus")&&(e.active=!0)),e.instance="Tab",e.activeTime=(a=t.headElement)==null?void 0:a.getAttribute("data-activetime")):t instanceof Ma?(!t.editor.protyle.notebookId&&n&&(n.editor="true"),e.notebookId=t.editor.protyle.notebookId,e.blockId=t.editor.protyle.block.id,e.rootId=t.editor.protyle.block.rootID,e.mode=t.editor.protyle.preview.element.classList.contains("fn__none")?"wysiwyg":"preview",e.action=t.editor.protyle.block.showAll&&t.editor.protyle.block.id!==t.editor.protyle.block.rootID?p.CB_GET_ALL:p.CB_GET_SCROLL,e.instance="Editor"):t instanceof El?(e.path=t.path,t.pdfObject&&(e.page=t.pdfObject.page),e.instance="Asset"):t instanceof yl?(e.blockId=t.blockId,e.rootId=t.rootId,e.type=t.type,e.instance="Backlink"):t instanceof cu?e.instance="Bookmark":t instanceof js?e.instance="Files":t instanceof Il?(e.blockId=t.blockId,e.rootId=t.rootId,e.type=t.type,e.instance="Graph"):t instanceof cc?(e.blockId=t.blockId,e.type=t.type,e.isPreview=t.isPreview,e.instance="Outline"):t instanceof Sc?e.instance="Tag":t instanceof qE?e.instance="AI":t instanceof Ll?(e.instance="Search",e.config=t.config):t instanceof ko&&(e.instance="Custom",e.customModelType=t.type,e.customModelData=Object.assign({},t.data)),t instanceof Gr||t instanceof zg?t instanceof Gr&&(t.type==="bottom"||t.type==="left"||t.type==="right")?t.type==="bottom"?e.children=[{instance:"Wnd",children:[]},{instance:"Wnd",resize:"lr",children:[]}]:e.children=[{instance:"Wnd",children:[]},{instance:"Wnd",resize:"tb",children:[]}]:(e.children=[],t.children.forEach(i=>{const s={};e.children.push(s),el(i,s,n)})):t instanceof Sa&&(t.model?(e.children={},el(t.model,e.children,n)):t.headElement?e.children=JSON.parse(t.headElement.getAttribute("data-initdata")||"{}"):e.children={})},am=()=>{const t=document.querySelector("#toolbar");if(!t)return;const e=t.querySelector("#drag");if(!e)return;e.style.padding="";const n=t.querySelector("#barMore");n.classList.remove("fn__none"),n.removeAttribute("data-hideids"),Array.from(t.querySelectorAll('[data-hide="true"]')).forEach(d=>{d.classList.remove("fn__none"),d.removeAttribute("data-hide")});let a=e.nextElementSibling;const i=[];for(;t.scrollWidth>t.clientWidth+2&&(i.push(a.id),a.classList.add("fn__none"),a.setAttribute("data-hide","true"),a=a.nextElementSibling,a.id!=="barMore"););let s=e.previousElementSibling;for(;t.scrollWidth>t.clientWidth+2&&(i.push(s.id),s.classList.add("fn__none"),s.setAttribute("data-hide","true"),s=s.previousElementSibling,s.id!=="barWorkspace"););i.length>0?n.classList.remove("fn__none"):n.classList.add("fn__none"),n.setAttribute("data-hideids",i.join(","));const r=e.clientWidth,o=e.getBoundingClientRect(),l=o.left,c=window.innerWidth-o.right;l>c&&l-c<r/3?e.style.paddingRight=l-c+"px":l<c&&c-l<r/3&&(e.style.paddingLeft=c-l+"px"),window.siyuan.storage[p.LOCAL_PLUGINTOPUNPIN].forEach(d=>{var u;(u=t.querySelector("#"+d))==null||u.classList.add("fn__none")})},tI=(t,e,n)=>{let a;return n.instance==="Custom"?n.customModelType==="siyuan-card"?a=kE({app:t,tab:e,data:n.customModelData}):t.plugins.find(i=>{if(i.models[n.customModelType])return a=i.models[n.customModelType]({tab:e,data:n.customModelData}),!0}):n.instance==="Editor"&&(n.rootId===n.blockId&&n.action&&(typeof n.action=="string"?n.action=n.action.replace(p.CB_GET_ALL,""):typeof n.action=="object"&&Array.isArray(n.action)&&(n.action=n.action.filter(i=>i!==p.CB_GET_ALL))),a=new Ma({app:t,tab:e,rootId:n.rootId,blockId:n.blockId,mode:n.mode,action:typeof n.action=="string"?n.action?[n.action,p.CB_GET_FOCUS]:[p.CB_GET_FOCUS]:n.action.concat(p.CB_GET_FOCUS)})),a},gu=t=>{const e=!!t.querySelector('.layout-tab-container > [data-loading="true"]');return e&&Q(window.siyuan.languages.pdfIsLoading),e},mi=(t,e=window.siyuan.layout.centerLayout)=>{const n=(a,i)=>{if(a.id===i)return a;if(!a.children)return;let s;for(let r=0;r<a.children.length;r++)if(s=n(a.children[r],i),s)return s};return n(e,t)},nI=t=>{if(!t.resize)return;const e=i=>{let s=232;return Array.from(i.querySelectorAll(".file-tree")).find(r=>{if((r.classList.contains("sy__backlink")||r.classList.contains("sy__graph")||r.classList.contains("sy__globalGraph")||r.classList.contains("sy__inbox"))&&!r.classList.contains("fn__none")&&!N(r,"fn__none"))return s=320,!0}),s},n=(i,s)=>{const r=(l,c)=>{l.classList.contains("fn__flex-1")&&(c==="lr"?l.style.width=l.clientWidth+"px":l.style.height=l.clientHeight+"px",l.classList.remove("fn__flex-1"))};let o;i.addEventListener("mousedown",l=>{Cn().editor.forEach(m=>{m.editor&&m.editor.protyle&&m.element.parentElement&&Ut(["gutter"],m.editor.protyle)}),getSelection().rangeCount>0&&(o=getSelection().getRangeAt(0));const c=document,d=i.nextElementSibling,u=i.previousElementSibling;d.style.overflow="auto",u.style.overflow="auto",d.style.transition="none",u.style.transition="none",!d.nextElementSibling||d.nextElementSibling.classList.contains("layout__dockresize")?r(d,s):r(u,s);const g=l[s==="lr"?"clientX":"clientY"],f=s==="lr"?u.clientWidth:u.clientHeight,h=s==="lr"?d.clientWidth:d.clientHeight;c.ondragstart=()=>(document.querySelectorAll(".sy__file .b3-list-item").forEach(m=>{m.style.opacity==="0.38"&&(m.style.opacity="")}),!1),c.onmousemove=m=>{m.preventDefault(),m.stopPropagation();const b=f+(m[s==="lr"?"clientX":"clientY"]-g),y=h-(m[s==="lr"?"clientX":"clientY"]-g);b<8||y<8||window.siyuan.layout.leftDock&&window.siyuan.layout.leftDock.layout.element===u&&b<e(u)&&b<f||window.siyuan.layout.rightDock&&window.siyuan.layout.rightDock.layout.element===d&&y<e(d)&&y<h||window.siyuan.layout.bottomDock&&window.siyuan.layout.bottomDock.layout.element===d&&y<64&&y<h||(u.classList.contains("fn__flex-1")||(u.style[s==="lr"?"width":"height"]=b+"px"),d.classList.contains("fn__flex-1")||(d.style[s==="lr"?"width":"height"]=y+"px"))},c.onmouseup=()=>{c.onmousemove=null,c.onmouseup=null,c.ondragstart=null,c.onselectstart=null,c.onselect=null,im(E()?window.siyuan.layout.centerLayout:void 0),Ui(),E()||(window.siyuan.layout.leftDock.setSize(),window.siyuan.layout.bottomDock.setSize(),window.siyuan.layout.rightDock.setSize()),o&&Pt(o),d.style.overflow="",u.style.overflow="",d.style.transition="",u.style.transition=""}})},a=document.createElement("div");t.resize==="lr"&&a.classList.add("layout__resize--lr"),a.classList.add("layout__resize"),t.element.insertAdjacentElement("beforebegin",a),n(a,t.resize),a.addEventListener("dblclick",()=>{const i=a.previousElementSibling,s=a.nextElementSibling;if(i&&s){const r=["graph","inbox","globalGraph","backlink"];let o=232;s.style.transition="none",i.style.transition="none",a.classList.contains("layout__resize--lr")?i.classList.contains("layout__dockl")?(document.querySelectorAll("#dockLeft .dock__item--active").forEach(l=>{r.includes(l.getAttribute("data-type"))&&(o=320)}),i.style.width=o+"px",window.siyuan.layout.leftDock.setSize()):s.classList.contains("layout__dockr")?(document.querySelectorAll("#dockRight .dock__item--active").forEach(l=>{r.includes(l.getAttribute("data-type"))&&(o=320)}),s.style.width=o+"px",window.siyuan.layout.rightDock.setSize()):(i.style.width="",s.style.width="",i.classList.add("fn__flex-1"),s.classList.add("fn__flex-1"),a.parentElement.classList.contains("layout__dockb")&&window.siyuan.layout.bottomDock.setSize()):s.classList.contains("layout__dockb")?(s.style.height="232px",window.siyuan.layout.bottomDock.setSize()):(i.style.height="",s.style.height="",i.classList.add("fn__flex-1"),s.classList.add("fn__flex-1"),a.parentElement.classList.contains("layout__dockl")?window.siyuan.layout.leftDock.setSize():a.parentElement.classList.contains("layout__dockr")&&window.siyuan.layout.rightDock.setSize()),Ui(),s.style.transition="",i.style.transition=""}})},im=(t=window.siyuan.layout.centerLayout.parent)=>{if(t.children.forEach(e=>{e.element.style.maxWidth="",!e.element.style.width&&!e.element.classList.contains("layout__center")?e.element.style.minWidth="8px":e.element.style.minWidth=""}),t.direction==="lr"&&t.element.scrollWidth>t.element.clientWidth+2){let e=Math.ceil(screen.width/8);for(;e>0;){let n=0;if(t.children.find(a=>{a.element.style.width&&a.element.style.width!=="0px"&&(a.element.style.maxWidth=Math.max(Math.min(a.element.clientWidth,window.innerWidth)-8,64)+"px"),n+=a.element.clientWidth}),e--,n<=t.element.clientWidth)break}}t.children.forEach(e=>{e instanceof Gr&&e.size!=="0px"&&im(e)})},ik=t=>{if(t.children.length<2||t.children[t.children.length-2].element.classList.contains("fn__flex-1"))return;t.children.forEach((n,a)=>{a!==t.children.length-2&&(t.direction==="lr"?n.element.classList.contains("fn__flex-1")&&(n.element.style.width=n.element.clientWidth+"px",n.element.classList.remove("fn__flex-1")):n.element.classList.contains("fn__flex-1")&&(n.element.style.height=n.element.clientHeight+"px",n.element.classList.remove("fn__flex-1")))});const e=t.children[t.children.length-2].element;t.direction==="lr"?e.style.width&&(e.style.width="",e.classList.add("fn__flex-1")):e.style.height&&(e.style.height="",e.classList.add("fn__flex-1"))},dp=(t,e)=>new xe({label:window.siyuan.languages[t],icon:t.replace("moveTo","icon"),click:()=>{t.indexOf("moveToLeft")>-1?window.siyuan.layout.leftDock.add(t.endsWith("Top")?0:1,e):t.indexOf("moveToRight")>-1?window.siyuan.layout.rightDock.add(t.endsWith("Top")?0:1,e):t.indexOf("moveToBottom")>-1&&window.siyuan.layout.bottomDock.add(t.endsWith("Left")?0:1,e)}}),aI=t=>(window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.append(dp("moveToLeftTop",t).element),window.siyuan.menus.menu.append(dp("moveToLeftBottom",t).element),window.siyuan.menus.menu.append(dp("moveToRightTop",t).element),window.siyuan.menus.menu.append(dp("moveToRightBottom",t).element),window.siyuan.menus.menu.append(dp("moveToBottomLeft",t).element),window.siyuan.menus.menu.append(dp("moveToBottomRight",t).element),window.siyuan.menus.menu);class UV{constructor(e){this.menu=new wy,window.addEventListener("contextmenu",n=>{if(n.shiftKey)return;let a=n.target;if(N(a,"av__panel")&&!N(a,"b3-menu")){document.querySelector(".av__panel").dispatchEvent(new CustomEvent("click",{detail:"close"})),n.stopPropagation(),n.preventDefault();return}for(a.classList.contains("b3-text-field")||a.tagName==="INPUT"&&a.type==="text"?n.stopPropagation():n.preventDefault();a&&a.parentElement&&!a.parentElement.isEqualNode(document.querySelector("body"));){const i=a.getAttribute("data-type");if(i==="tab-header"){this.unselect(),BL(e,mi(a.getAttribute("data-id"))).popup({x:n.clientX,y:n.clientY}),n.stopPropagation();break}else if(i==="navigation-root"&&!window.siyuan.config.readonly){if(a.querySelector(".b3-list-item__text").classList.contains("ft__on-surface"))return;this.unselect(),Wy(e,a).popup({x:n.clientX,y:n.clientY}),ca(N(a,"sy__file")),n.stopPropagation();break}else if(i==="navigation-file"){this.unselect(),Vy(e,this.getDir(a),a.getAttribute("data-path"),a).popup({x:n.clientX,y:n.clientY}),ca(N(a,"sy__file")),n.stopPropagation();break}else if(i==="search-item"){const s=a.getAttribute("data-node-id");s&&NL(s).popup({x:n.clientX,y:n.clientY}),n.stopPropagation();break}else if(i&&a.classList.contains("dock__item")){Pa(),aI(a).popup({x:n.clientX,y:n.clientY}),n.stopPropagation();break}a=a.parentElement}},!1)}getDir(e){const n=pe(e,"UL");if(n)return n.getAttribute("data-url")}unselect(){getSelection().rangeCount>0&&getSelection().getRangeAt(0).collapse(!0)}}const HV=(t,e)=>{var n;const a=new ta(p.MENU_BAR_PLUGIN);a.addItem({id:"manage",icon:"iconSettings",label:window.siyuan.languages.manage,ignore:Tt()||window.siyuan.config.readonly,click(){Dc(t).element.querySelector('.b3-tab-bar [data-name="bazaar"]').dispatchEvent(new CustomEvent("click"))}}),a.addSeparator({id:"separator_1",ignore:Tt()||window.siyuan.config.readonly});let i=!1;if(t.plugins.forEach(s=>{const r=s.setting||s.__proto__.hasOwnProperty("openSetting");let o=!1;for(let l=0;l<s.topBarIcons.length;l++){const c=s.topBarIcons[l];if(!document.contains(c)){s.topBarIcons.splice(l,1),l--;continue}const d=window.siyuan.storage[p.LOCAL_PLUGINTOPUNPIN].includes(c.id),u=[{id:d?"pin":"unpin",icon:d?"iconPin":"iconUnpin",label:d?window.siyuan.languages.pin:window.siyuan.languages.unpin,click(){d?(window.siyuan.storage[p.LOCAL_PLUGINTOPUNPIN].splice(window.siyuan.storage[p.LOCAL_PLUGINTOPUNPIN].indexOf(c.id),1),c.classList.remove("fn__none")):(window.siyuan.storage[p.LOCAL_PLUGINTOPUNPIN].push(c.id),window.siyuan.storage[p.LOCAL_PLUGINTOPUNPIN]=Array.from(new Set(window.siyuan.storage[p.LOCAL_PLUGINTOPUNPIN])),c.classList.add("fn__none")),Gt(p.LOCAL_PLUGINTOPUNPIN,window.siyuan.storage[p.LOCAL_PLUGINTOPUNPIN])}}];r&&u.push({id:"config",icon:"iconSettings",label:window.siyuan.languages.config,click(){s.openSetting()}});const g=e?c.getAttribute("aria-label"):c.textContent.trim();e||u.push({id:"play",icon:"iconPlay",label:g,click(){return c.dispatchEvent(new CustomEvent("click")),!0}});const f={id:c.id,icon:"iconInfo",label:g,click:e?()=>{c.dispatchEvent(new CustomEvent("click"))}:void 0,type:"submenu",submenu:u};if(c.querySelector("use"))f.icon=c.querySelector("use").getAttribute("xlink:href").replace("#","");else{const h=c.querySelector("svg").cloneNode(!0);h.classList.add("b3-menu__icon"),f.iconHTML=h.outerHTML}a.addItem(f),i=!0,o=!0}!o&&r&&(i=!0,a.addItem({id:s.name,icon:"iconSettings",label:s.displayName,click(){s.openSetting()}}))}),i||(e?(n=window.siyuan.menus.menu.element.querySelector(".b3-menu__separator"))==null||n.remove():a.addItem({id:"emptyContent",iconHTML:"",type:"readonly",label:window.siyuan.languages.emptyContent})),e){let s=e.getBoundingClientRect();s.width===0&&(s=document.querySelector("#barMore").getBoundingClientRect()),a.open({x:s.right,y:s.bottom,isLeft:!0})}else a.fullscreen()},qV=t=>{const e=document.getElementById("toolbar");e.innerHTML=`
<div id="barWorkspace" class="ariaLabel toolbar__item toolbar__item--active" aria-label="${window.siyuan.languages.mainMenu} ${Mt(window.siyuan.config.keymap.general.mainMenu.custom)}">
    <span class="toolbar__text">${gh()}</span>
    <svg class="toolbar__svg"><use xlink:href="#iconDown"></use></svg>
</div>
<div id="barSync" class="ariaLabel toolbar__item${window.siyuan.config.readonly?" fn__none":""}">
    <svg><use xlink:href="#iconCloudSucc"></use></svg>
</div>
<button id="barBack" class="ariaLabel toolbar__item toolbar__item--disabled" aria-label="${window.siyuan.languages.goBack} ${Mt(window.siyuan.config.keymap.general.goBack.custom)}">
    <svg><use xlink:href="#iconBack"></use></svg>
</button>
<button id="barForward" class="ariaLabel toolbar__item toolbar__item--disabled" aria-label="${window.siyuan.languages.goForward} ${Mt(window.siyuan.config.keymap.general.goForward.custom)}">
    <svg><use xlink:href="#iconForward"></use></svg>
</button>
<div class="fn__flex-1 fn__ellipsis" id="drag"><span class="fn__none">\u5F00\u53D1\u7248\uFF0C\u4F7F\u7528\u524D\u8BF7\u8FDB\u884C\u5907\u4EFD Development version, please backup before use</span></div>
<div id="barAccount" class="toolbar__item ariaLabel${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.account}">
    <svg><use xlink:href="#iconAccount"></use></svg>
</div>
<div id="barSettings" class="toolbar__item ariaLabel${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.config} ${Mt(window.siyuan.config.keymap.general.config.custom)}">
    <svg><use xlink:href="#iconSettings"></use></svg>
</div>
<div id="barPlugins" class="toolbar__item ariaLabel" aria-label="${window.siyuan.languages.plugin}">
    <svg><use xlink:href="#iconPlugin"></use></svg>
</div>
<div id="barCommand" class="toolbar__item ariaLabel" aria-label="${window.siyuan.languages.commandPanel} ${Mt(window.siyuan.config.keymap.general.commandPanel.custom)}">
    <svg><use xlink:href="#iconTerminal"></use></svg>
</div>
<div id="barSearch" class="toolbar__item ariaLabel" aria-label="${window.siyuan.languages.globalSearch} ${Mt(window.siyuan.config.keymap.general.globalSearch.custom)}">
    <svg><use xlink:href="#iconSearch"></use></svg>
</div>
<div id="barAI" class="toolbar__item ariaLabel" aria-label="AI \u6587\u6863\u5206\u6790">
    <svg><use xlink:href="#iconSparkles"></use></svg>
</div>
<div id="barZoom" class="toolbar__item ariaLabel${window.siyuan.storage[p.LOCAL_ZOOM]===1||W()?" fn__none":""}" aria-label="${window.siyuan.languages.zoom}">
    <svg><use xlink:href="#iconZoom${window.siyuan.storage[p.LOCAL_ZOOM]>1?"In":"Out"}"></use></svg>
</div>
<div id="barMode" class="toolbar__item ariaLabel${window.siyuan.config.readonly?" fn__none":""}" aria-label="${window.siyuan.languages.appearanceMode}">
    <svg><use xlink:href="#icon${window.siyuan.config.appearance.modeOS?"Mode":window.siyuan.config.appearance.mode===0?"Light":"Dark"}"></use></svg>
</div>
<div id="barExit" class="ft__error toolbar__item ariaLabel${Xt()||St()||Qt()?"":" fn__none"}" aria-label="${window.siyuan.languages.safeQuit}">
    <svg><use xlink:href="#iconQuit"></use></svg>
</div>
<div id="barMore" class="toolbar__item ariaLabel" aria-label="${window.siyuan.languages.more}">
    <svg><use xlink:href="#iconMore"></use></svg>
</div>
<div class="fn__flex" id="windowControls"></div>`,Ao(),e.addEventListener("click",a=>{let i=a.target;for(typeof a.detail=="string"&&(i=e.querySelector("#"+a.detail));!i.classList.contains("toolbar");){const s=typeof a.detail=="string"?a.detail:i.id;if(s==="barBack"){m_(t),a.stopPropagation();break}else if(s==="barMore"){if(!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_BAR_MORE){window.siyuan.menus.menu.remove();return}window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_BAR_MORE),(i.getAttribute("data-hideids")||"").split(",").forEach(o=>{const l=e.querySelector("#"+o),c=l.querySelector("use"),d={label:l.getAttribute("aria-label"),icon:c?c.getAttribute("xlink:href").substring(1):void 0,click:()=>{o.startsWith("plugin")?l.dispatchEvent(new CustomEvent("click")):e.dispatchEvent(new CustomEvent("click",{detail:o}))}};if(!c&&l.querySelector("svg")){const u=l.querySelector("svg").cloneNode(!0);u.classList.add("b3-menu__icon"),d.iconHTML=u.outerHTML}window.siyuan.menus.menu.append(new xe(d).element)});const r=i.getBoundingClientRect();window.siyuan.menus.menu.popup({x:r.right,y:r.bottom,isLeft:!0}),a.stopPropagation();break}else if(s==="barForward"){b_(t),a.stopPropagation();break}else if(s==="barSync"){kw(t),a.stopPropagation();break}else if(s==="barWorkspace"){jE(t,i.getBoundingClientRect()),a.stopPropagation();break}else if(s==="barExit"){a.stopPropagation(),Ss({errorExit:!0,cb:Ac});break}else if(s==="barMode"){if(!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_BAR_MODE){window.siyuan.menus.menu.remove();return}window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_BAR_MODE),window.siyuan.menus.menu.append(new xe({id:"themeLight",label:window.siyuan.languages.themeLight,icon:"iconLight",current:window.siyuan.config.appearance.mode===0&&!window.siyuan.config.appearance.modeOS,click:()=>{kx(0)}}).element),window.siyuan.menus.menu.append(new xe({id:"themeDark",label:window.siyuan.languages.themeDark,current:window.siyuan.config.appearance.mode===1&&!window.siyuan.config.appearance.modeOS,icon:"iconDark",click:()=>{kx(1)}}).element),window.siyuan.menus.menu.append(new xe({id:"themeOS",label:window.siyuan.languages.themeOS,current:window.siyuan.config.appearance.modeOS,icon:"iconMode",click:()=>{kx(2)}}).element);let r=i.getBoundingClientRect();r.width===0&&(r=e.querySelector("#barMore").getBoundingClientRect()),window.siyuan.menus.menu.popup({x:r.right,y:r.bottom,isLeft:!0}),a.stopPropagation();break}else if(s==="barSearch"){ds({app:t,hotkey:p.DIALOG_GLOBALSEARCH}),a.stopPropagation();break}else if(s==="barAI"){const r=Vn("ai");r&&r.toggleModel("ai",!1,!1),a.stopPropagation();break}else if(s==="barPlugins"){HV(t,i),a.stopPropagation();break}else if(s==="barCommand"){$L(t),a.stopPropagation();break}else if(s==="barZoom"){if(!window.siyuan.menus.menu.element.classList.contains("fn__none")&&window.siyuan.menus.menu.element.getAttribute("data-name")===p.MENU_BAR_ZOOM){window.siyuan.menus.menu.remove();return}window.siyuan.menus.menu.remove(),window.siyuan.menus.menu.element.setAttribute("data-name",p.MENU_BAR_ZOOM),window.siyuan.menus.menu.append(new xe({label:window.siyuan.languages.zoomIn,icon:"iconZoomIn",accelerator:"\u2318=",click:()=>{sk("zoomIn")}}).element),window.siyuan.menus.menu.append(new xe({label:window.siyuan.languages.zoomOut,accelerator:"\u2318-",icon:"iconZoomOut",click:()=>{sk("zoomOut")}}).element),window.siyuan.menus.menu.append(new xe({label:window.siyuan.languages.reset,accelerator:"\u23180",click:()=>{sk("restore")}}).element);let r=i.getBoundingClientRect();r.width===0&&(r=e.querySelector("#barMore").getBoundingClientRect()),window.siyuan.menus.menu.popup({x:r.right,y:r.bottom,isLeft:!0}),a.stopPropagation();break}else if(s==="barSettings"){Dc(t),a.stopPropagation();break}else if(s==="barAccount"){window.siyuan.config.readonly||Dc(t).element.querySelector('.b3-tab-bar [data-name="account"]').dispatchEvent(new CustomEvent("click")),a.stopPropagation();break}i=i.parentElement}});const n=e.querySelector("#barSync");n.addEventListener("mouseenter",a=>{a.stopPropagation(),a.preventDefault(),ae("/api/sync/getSyncInfo",{},i=>{let s="";!window.siyuan.config.sync.enabled||window.siyuan.config.sync.provider===0&&Ml("")?s=i.data.stat:(s=window.siyuan.languages._kernel[82].replace("%s",at(i.data.synced).format("YYYY-MM-DD HH:mm"))+"<br>",s+="&emsp;"+i.data.stat,i.data.kernels.length>0&&(s+="<br>",s+=window.siyuan.languages.currentKernel+"<br>",s+="&emsp;"+i.data.kernel+"/"+window.siyuan.config.system.kernelVersion+" ("+window.siyuan.config.system.os+"/"+window.siyuan.config.system.name+")<br>",s+=window.siyuan.languages.otherOnlineKernels+"<br>",i.data.kernels.forEach(r=>{s+=`&emsp;${r.id}/${r.ver} (${r.os}/${r.hostname}) <br>`}))),n.setAttribute("aria-label",s)})}),n.setAttribute("aria-label",window.siyuan.config.sync.stat||window.siyuan.languages.syncNow+" "+Mt(window.siyuan.config.keymap.general.syncNow.custom))},sk=t=>{},WV=()=>{ae("/api/system/getChangelog",{},t=>{if(!t.data.show)return;const e=new fe({title:`\u2728 ${window.siyuan.languages.whatsNewInSiYuan} v${window.siyuan.config.system.kernelVersion}`,width:x()?"92vw":"768px",height:x()?"80vh":"70vh",content:`<div style="overflow:auto;" class="b3-dialog__content b3-typography b3-typography--default">${t.data.html}</div>`});e.element.setAttribute("data-key",p.DIALOG_CHANGELOG),ra(e.element)})},iI=(t,e,n)=>{let a=1,i=t;if(i&&i.classList.contains("protyle-action"))return i;for(;i&&(i.classList.contains("list")||i.classList.contains("li"));)i=document.elementFromPoint(e+73*a,n),i=oe(i),a++;return i},VV=(t,e)=>{var n;if(document.body.classList.contains("body--blur")||document.getElementById("progress"))return;const a=(n=window.siyuan.coordinates)!=null?n:window.siyuan.coordinates={pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0};a.pageX=t.pageX,a.pageY=t.pageY,a.clientX=t.clientX,a.clientY=t.clientY,a.screenX=t.screenX,a.screenY=t.screenY,window.siyuan.hideBreadcrumb&&(window.siyuan.hideBreadcrumb=!1,Es().forEach(o=>{var l;(l=o.protyle.breadcrumb)!=null&&l.element.classList.contains("protyle-breadcrumb__bar--hide")&&(o.protyle.breadcrumb.element.classList.remove("protyle-breadcrumb__bar--hide"),o.protyle.breadcrumb.render(o.protyle,!0))}));const i=t.target;!e&&t.buttons===0&&window.siyuan.layout.bottomDock&&!E()&&(t.clientX<Math.max(document.getElementById("dockLeft").clientWidth+1,16)?!window.siyuan.layout.leftDock.pin&&window.siyuan.layout.leftDock.layout.element.clientWidth>0&&(window.siyuan.layout.leftDock.element.clientWidth>0||window.siyuan.layout.leftDock.element.clientWidth===0&&t.clientX<8)&&(t.clientY>document.getElementById("toolbar").clientHeight&&t.clientY<window.innerHeight-document.getElementById("status").clientHeight-document.getElementById("dockBottom").clientHeight?!N(i,"b3-menu")&&!N(i,"protyle-toolbar")&&!N(i,"protyle-util")&&!N(i,"b3-dialog",!0)&&!N(i,"layout--float")&&window.siyuan.layout.leftDock.showDock():window.siyuan.layout.leftDock.hideDock()):t.clientX>window.innerWidth-Math.max(document.getElementById("dockRight").clientWidth-2,16)&&!window.siyuan.layout.rightDock.pin&&window.siyuan.layout.rightDock.layout.element.clientWidth>0&&(window.siyuan.layout.rightDock.element.clientWidth>0||window.siyuan.layout.rightDock.element.clientWidth===0&&t.clientX>window.innerWidth-8)&&(t.clientY>document.getElementById("toolbar").clientHeight&&t.clientY<window.innerHeight-document.getElementById("status").clientHeight-document.getElementById("dockBottom").clientHeight?!N(i,"b3-menu")&&!N(i,"layout--float")&&!N(i,"protyle-toolbar")&&!N(i,"protyle-util")&&!N(i,"b3-dialog",!0)&&window.siyuan.layout.rightDock.showDock():window.siyuan.layout.rightDock.hideDock()),t.clientY>Math.min(window.innerHeight-10,window.innerHeight-(window.siyuan.config.uiLayout.hideDock?0:document.getElementById("dockBottom").clientHeight)-document.querySelector("#status").clientHeight)&&window.siyuan.layout.bottomDock.showDock());const s=t.composedPath()[0];if(s&&s.nodeType!==3&&s.classList.contains("protyle-wysiwyg")&&s.style.paddingLeft){const o=document.elementFromPoint(s.getBoundingClientRect().left+parseInt(s.style.paddingLeft)+13,t.clientY),l=oe(o);if(l){const c=iI(l,l.getBoundingClientRect().left+1,t.clientY);if(!c)return;let d;c.classList.contains("av")&&(d=N(o,"av__row"));const u=Cn();let g=!1;u.editor.find(f=>{if(f.editor.protyle.wysiwyg.element===s)return f.editor.protyle.gutter.render(f.editor.protyle,c,f.editor.protyle.wysiwyg.element,d),g=!0,!0}),g||window.siyuan.blockPanels.find(f=>{if(f.editors.find(h=>{if(h.protyle.wysiwyg.element.contains(s))return h.protyle.gutter.render(h.protyle,c,h.protyle.wysiwyg.element,d),g=!0,!0}),g)return!0}),g||u.backlink.find(f=>{if(f.editors.find(h=>{if(h.protyle.wysiwyg.element===s)return h.protyle.gutter.render(h.protyle,c,h.protyle.wysiwyg.element,d),g=!0,!0}),g)return!0})}return}if(s&&s.nodeType!==3&&(s.classList.contains("li")||s.classList.contains("list")||s.classList.contains("protyle-action")&&s.getAttribute("data-type")==="NodeListItem")){const o=iI(s,s.getBoundingClientRect().left+1,t.clientY);if(!o)return;const l=Cn();let c=!1;l.editor.find(d=>{if(d.editor.protyle.wysiwyg.element.contains(s))return d.editor.protyle.gutter.render(d.editor.protyle,o,d.editor.protyle.wysiwyg.element),c=!0,!0}),c||window.siyuan.blockPanels.find(d=>{if(d.editors.find(u=>{if(u.protyle.wysiwyg.element.contains(s))return u.protyle.gutter.render(u.protyle,o,u.protyle.wysiwyg.element),c=!0,!0}),c)return!0}),c||l.backlink.find(d=>{if(d.editors.find(u=>{if(u.protyle.wysiwyg.element.contains(s))return u.protyle.gutter.render(u.protyle,o,u.protyle.wysiwyg.element),c=!0,!0}),c)return!0});return}if(s&&s.nodeType!==3&&s.classList.contains("av")&&s.getAttribute("data-type")==="NodeAttributeView"){const o=N(document.elementFromPoint(s.firstElementChild.getBoundingClientRect().left+10,t.clientY),"av__row");if(o&&!o.classList.contains("av__row--header")){Es().find(l=>{if(l.protyle.wysiwyg.element.contains(s))return l.protyle.gutter.render(l.protyle,s,l.protyle.wysiwyg.element,o),!0});return}}N(i,"protyle",!0)||document.querySelectorAll(".protyle-gutters").forEach(o=>{o.classList.add("fn__none"),o.innerHTML=""});const r=N(i,"table");if(r&&r.style.cursor!=="col-resize"&&!N(r,"protyle-wysiwyg__embed")){const o=A(i,"TH")||A(i,"TD"),l=r.querySelector("table");if(o&&l&&l.getAttribute("contenteditable")==="true"){const c=r.querySelector("table").clientHeight,d=r.querySelector(".table__resize");r.style.textAlign==="center"||r.style.textAlign==="right"?d.parentElement.style.left=l.offsetLeft+"px":d.parentElement.style.left="";const u=o.getBoundingClientRect();u.right-t.clientX<3&&u.right-t.clientX>0?(d.setAttribute("data-col-index",(cs(o)+o.colSpan-1).toString()),d.setAttribute("style",`height:${c}px;left: ${Math.round(o.offsetWidth+o.offsetLeft-r.firstElementChild.scrollLeft-3)}px;display:block`)):t.clientX-u.left<3&&t.clientX-u.left>0&&o.previousElementSibling&&(d.setAttribute("data-col-index",(cs(o)-1).toString()),d.setAttribute("style",`height:${c}px;left: ${Math.round(o.offsetLeft-r.firstElementChild.scrollLeft-3)}px;display:block`))}}},zV=(t,e)=>{window.siyuan.ctrlIsPressed=!1,window.siyuan.shiftIsPressed=!1,window.siyuan.altIsPressed=!1;const n=window.siyuan.dialogs.find(a=>{if(a.element.getAttribute("data-key")===p.DIALOG_SWITCHTAB)return!0});if(n&&n.element.parentElement){if(window.siyuan.config.keymap.general.goToEditTabNext.custom.endsWith(p.KEYCODELIST[e.keyCode])||window.siyuan.config.keymap.general.goToEditTabPrev.custom.endsWith(p.KEYCODELIST[e.keyCode])){let a=n.element.querySelector(".b3-list-item--focus");if(a.classList.remove("b3-list-item--focus"),Qe(window.siyuan.config.keymap.general.goToEditTabPrev.custom,e)){for(;a.previousElementSibling?a=a.previousElementSibling:a.getAttribute("data-original")?(a.removeAttribute("data-original"),a=a.parentElement.lastElementChild):a.parentElement.nextElementSibling?a.parentElement.nextElementSibling.lastElementChild?a=a.parentElement.nextElementSibling.lastElementChild:a=a.parentElement.lastElementChild:a.parentElement.previousElementSibling?a=a.parentElement.previousElementSibling.lastElementChild:E()&&(a=a.parentElement.lastElementChild),a.getBoundingClientRect().height===0;);a.classList.add("b3-list-item--focus")}else{for(;a.nextElementSibling?a=a.nextElementSibling:a.getAttribute("data-original")?(a.removeAttribute("data-original"),a=a.parentElement.firstElementChild):a.parentElement.nextElementSibling?a.parentElement.nextElementSibling.firstElementChild?a=a.parentElement.nextElementSibling.firstElementChild:a=a.parentElement.firstElementChild:a.parentElement.previousElementSibling?a=a.parentElement.previousElementSibling.firstElementChild:E()&&(a=a.parentElement.firstElementChild),a.getBoundingClientRect().height===0;);a.classList.add("b3-list-item--focus")}if(a){const s=a.getAttribute("data-node-id");s?ae("/api/filetree/getFullHPathByID",{id:s},l=>{a.parentElement.parentElement.nextElementSibling.innerHTML=he(l.data)}):a.parentElement.parentElement.nextElementSibling.innerHTML=a.querySelector(".b3-list-item__text").innerHTML;const r=a.getBoundingClientRect(),o=a.parentElement.getBoundingClientRect();r.top<o.top?a.scrollIntoView(!0):r.bottom>o.bottom&&a.scrollIntoView(!1)}const i=n.element.querySelector('[data-original="true"]');i&&i.removeAttribute("data-original")}else if(window.siyuan.config.keymap.general.goToEditTabNext.custom.startsWith(p.KEYCODELIST[e.keyCode])||window.siyuan.config.keymap.general.goToEditTabPrev.custom.startsWith(p.KEYCODELIST[e.keyCode])){let a=n.element.querySelector(".b3-list-item--focus");a.getAttribute("data-original")&&(a.classList.remove("b3-list-item--focus"),Qe(window.siyuan.config.keymap.general.goToEditTabPrev.custom,e)?a.previousElementSibling?a.previousElementSibling.classList.add("b3-list-item--focus"):(a.parentElement.lastElementChild.classList.add("b3-list-item--focus"),a.removeAttribute("data-original")):a.nextElementSibling?a.nextElementSibling.classList.add("b3-list-item--focus"):a.parentElement.firstElementChild.classList.add("b3-list-item--focus"),a.removeAttribute("data-original"),a=n.element.querySelector(".b3-list-item--focus"));const i=a.getAttribute("data-type");if(i)i==="riffCard"?wf(t):Vn(i).toggleModel(i,!0),document.activeElement&&document.activeElement.blur();else{const s=a.getAttribute("data-id");So().find(r=>{if(r.id===s)return r.parent.switchTab(r.headElement),r.parent.showHeading(),!0})}n.destroy()}}},YV=t=>{var e;const n=t.target,a=N(n,"protyle-background");if(a&&n.tagName==="IMG"&&a.firstElementChild.querySelector(".protyle-icons").classList.contains("fn__none")){const i=N(n,"protyle-content",!0);if(!i)return!1;i.style.overflow="hidden";const s=t.touches[0].clientY,r=n.naturalHeight*n.clientWidth/n.naturalWidth-n.clientHeight;let o=parseFloat(n.style.objectPosition.substring(7))||50;n.style.objectPosition.endsWith("px")&&(o=-parseInt(n.style.objectPosition.substring(7))/r*100);const l=document;return l.ontouchmove=c=>{n.style.objectPosition=`center ${((s-c.touches[0].clientY)/r*100+o).toFixed(2)}%`},l.ontouchend=()=>{i.style.overflow="",l.ontouchmove=null,l.ontouchstart=null,l.ondragstart=null,l.onselectstart=null,l.onselect=null},t.stopImmediatePropagation(),!0}return a?a.classList.contains("protyle-background--enable")&&a.classList.add("protyle-background--mobileshow"):(e=document.querySelector(".protyle-background--mobileshow"))==null||e.classList.remove("protyle-background--mobileshow"),!1},GV=(t,e,n,a)=>{const i=t.target,s=yn();if(typeof e=="undefined"&&new Date().getTime()-n>900){const r=ue(i,"data-type","navigation-root")||ue(i,"data-type","navigation-file");if(r){if(!window.siyuan.config.readonly&&r.dataset.type==="navigation-root"){const o=Wy(a,r);if(s){const l=r.getBoundingClientRect();o.popup({x:l.right-52,y:l.bottom,h:l.height}),Pa()}else window.siyuan.menus.menu.fullscreen("bottom")}else if(r.dataset.type==="navigation-file"){const o=pe(r,"UL");if(o){const l=Vy(a,o.dataset.url,r.dataset.path,r);if(s){const c=r.getBoundingClientRect();l.popup({x:c.right-52,y:c.bottom,h:c.height}),Pa()}else window.siyuan.menus.menu.fullscreen("bottom")}}return!0}if(i.tagName==="SPAN"&&!ge(i)){let o;const l=N(i,"protyle",!0);if(l){const u=mi(l.dataset.id);u instanceof Sa&&u.model instanceof Ma&&(o=u.model.editor)}if(!o)return!1;const c=(i.getAttribute("data-type")||"").split(" ");if(c.includes("inline-memo")&&o.protyle.toolbar.showRender(o.protyle,i),o.protyle.disabled)return t.stopImmediatePropagation(),t.preventDefault(),!0;if(c.includes("block-ref"))return Gv(o.protyle,i),!0;if(c.includes("file-annotation-ref"))return Yv(o.protyle,i),!0;if(c.includes("tag"))return Xv(o.protyle,i),!0;if(c.includes("a"))return Df(o.protyle,i),!0;const d=ue(i,"data-type","inline-math");if(d)return a_(o.protyle,d),!0}}return!1},jV=t=>{document.body.addEventListener("mouseleave",()=>{window.siyuan.layout.leftDock&&(window.siyuan.layout.leftDock.hideDock(),window.siyuan.layout.rightDock.hideDock(),window.siyuan.layout.bottomDock.hideDock()),document.querySelectorAll(".protyle-gutters").forEach(a=>{a.classList.add("fn__none"),a.innerHTML=""}),Pa()});let e=!1;document.body.addEventListener("mouseenter",()=>{window.siyuan.layout.leftDock&&(e=!0,setTimeout(()=>{e=!1},p.TIMEOUT_TRANSITION))}),window.addEventListener("mousemove",a=>{VV(a,e)}),window.addEventListener("mouseup",a=>{a.button===3?(a.preventDefault(),m_(t)):a.button===4&&(a.preventDefault(),b_(t))}),window.addEventListener("mousedown",a=>{N(a.target,"protyle-toolbar")||rs(["toolbar"])}),window.addEventListener("keyup",a=>{zV(t,a)}),window.addEventListener("keydown",a=>{CV(t,a)}),window.addEventListener("blur",()=>{window.siyuan.ctrlIsPressed=!1,window.siyuan.shiftIsPressed=!1,window.siyuan.altIsPressed=!1}),window.addEventListener("click",a=>{$W(a)});let n=0;document.addEventListener("touchstart",a=>{n=new Date().getTime();const i=a.target;if(N(i,"protyle-icons")||N(i,"item")||i.classList.contains("protyle-background__icon"))return;const s=ge(i);if(s){s.firstElementChild.classList.toggle("protyle-icons--show");return}YV(a)},!1),document.addEventListener("touchend",a=>{if(yn()){if(GV(a,void 0,n,t)){a.stopImmediatePropagation(),a.preventDefault();return}if(new Date().getTime()-n<=900)return;const i=a.target,s=N(i,"dock__item");if(s&&s.getAttribute("data-type")){const l=s.getBoundingClientRect();aI(s).popup({x:l.right,y:l.top}),a.stopImmediatePropagation(),a.preventDefault();return}const r=ue(i,"data-type","tab-header");if(r){const l=r.getBoundingClientRect();BL(t,mi(r.getAttribute("data-id"))).popup({x:l.left,y:l.bottom}),Pa(),a.stopImmediatePropagation(),a.preventDefault();return}const o=N(i,"protyle-breadcrumb__item");if(o){const l=o.getAttribute("data-id")||o.getAttribute("data-node-id");l&&na(l,c=>{dn({app:t,id:l,action:c?[p.CB_GET_FOCUS,p.CB_GET_ALL]:[p.CB_GET_FOCUS,p.CB_GET_CONTEXT],zoomIn:c}),window.siyuan.menus.menu.remove()}),a.stopImmediatePropagation(),a.preventDefault();return}}},!1)};var sI=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});const KV=(t,e)=>{kV(e),(!window.siyuan.config.uiLayout||window.siyuan.config.uiLayout&&!window.siyuan.config.uiLayout.left)&&(window.siyuan.config.uiLayout=p.SIYUAN_EMPTY_LAYOUT),jV(e),ae("/api/system/getEmojiConf",{},i=>{window.siyuan.emojis=i.data;try{RV(e,t),setTimeout(()=>{im()}),WV()}catch(s){QL()}}),qV(e),vW(),XV(e),Ta.onSetAppearance(window.siyuan.config.appearance),VF(),Qh(),md();let n=0,a=!0;window.addEventListener("resize",()=>{a&&(ng(),a=!1),window.clearTimeout(n),n=window.setTimeout(()=>{im(),Ui(),am(),a=!0},200)})},dY=()=>sI(void 0,null,function*(){}),XV=t=>sI(void 0,null,function*(){E()||document.querySelector(".toolbar").classList.add("toolbar--browser")}),ZV=(t,e={scope:"/",type:"classic",updateViaCache:"all"})=>{var n;(n=window.webkit)!=null&&n.messageHandlers||window.JSAndroid||window.JSHarmony||!("serviceWorker"in window.navigator)||!("caches"in window)||!("fetch"in window)||navigator.serviceWorker==null||console.log("[Service Worker] \u5DF2\u7981\u7528 Service Worker \u4EE5\u907F\u514D\u4EE3\u7406\u8DEF\u5F84\u95EE\u9898")};var JV=(t,e,n)=>new Promise((a,i)=>{var s=l=>{try{o(n.next(l))}catch(c){i(c)}},r=l=>{try{o(n.throw(l))}catch(c){i(c)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(s,r);o((n=n.apply(t,e)).next())});class QV{constructor(){this.plugins=[],ZV(`${p.SERVICE_WORKER_PATH}?v=${p.SIYUAN_VERSION}`),fv(),this.appId=p.SIYUAN_APPID,window.siyuan={zIndex:10,transactions:[],reqIds:{},backStack:[],layout:{},dialogs:[],blockPanels:[],closedTabs:[],ctrlIsPressed:!1,altIsPressed:!1,ws:new Wa({app:this,id:K(),type:"main",msgCallback:e=>{var n;if(this.plugins.forEach(a=>{a.eventBus.emit("ws-main",e)}),e)switch(e.cmd){case"setDefRefCount":cW(e.data);break;case"reloadTag":((n=Vn("tag"))==null?void 0:n.data.tag)instanceof Sc&&Vn("tag").data.tag.update();break;case"setLocalShorthandCount":xy();break;case"setRefDynamicText":lW(e.data);break;case"reloadPlugin":JL(this,e.data);break;case"reloadEmojiConf":ud();break;case"syncMergeResult":LE(this,e.data);break;case"reloaddoc":LE(this,{upsertRootIDs:[e.data],removeRootIDs:[]},!1,!1,!0);break;case"readonly":window.siyuan.config.editor.readOnly=e.data,rs(["util"]);break;case"setConf":window.siyuan.config=e.data,oh();break;case"progress":IE(e);break;case"setLocalStorageVal":window.siyuan.storage[e.data.key]=e.data.val;break;case"rename":So().forEach(a=>{if(a.headElement){const i=a.headElement.getAttribute("data-initdata");if(i){const s=JSON.parse(i);s.instance==="Editor"&&s.rootId===e.data.id&&a.updateTitle(e.data.title)}}});break;case"unmount":So().forEach(a=>{if(a.headElement){const i=a.headElement.getAttribute("data-initdata");if(i){const s=JSON.parse(i);s.instance==="Editor"&&e.data.box===s.notebookId&&a.parent.removeTab(a.id)}}});break;case"removeDoc":So().forEach(a=>{if(a.headElement){const i=a.headElement.getAttribute("data-initdata");if(i){const s=JSON.parse(i);s.instance==="Editor"&&e.data.ids.includes(s.rootId)&&a.parent.removeTab(a.id)}}});break;case"statusbar":uW(e);break;case"downloadProgress":hW(e.data);break;case"txerr":dW();break;case"syncing":Ao(e,this.plugins);break;case"backgroundtask":fW(e.data.tasks);break;case"refreshtheme":window.siyuan.config.appearance.mode===1&&window.siyuan.config.appearance.themeDark!=="midnight"||window.siyuan.config.appearance.mode===0&&window.siyuan.config.appearance.themeLight!=="daylight"?document.getElementById("themeStyle").href=e.data.theme:document.getElementById("themeDefaultStyle").href=e.data.theme;break;case"openFileById":dn({app:this,id:e.data.id,action:[p.CB_GET_FOCUS]});break}}})},ae("/api/system/getConf",{},e=>JV(this,null,function*(){hl(`${p.PROTYLE_CDN}/js/lute/lute.min.js?v=${p.SIYUAN_VERSION}`,"protyleLuteScript"),va(`${p.PROTYLE_CDN}/js/protyle-html.js?v=${p.SIYUAN_VERSION}`,"protyleWcHtmlScript"),window.siyuan.config=e.data.conf,oh(),window.siyuan.isPublish=e.data.isPublish,yield JE(this),ua(()=>{gL(`/appearance/langs/${window.siyuan.config.appearance.lang}.json?v=${p.SIYUAN_VERSION}`,n=>{window.siyuan.languages=n,window.siyuan.menus=new UV(this),pW(),ae("/api/setting/getCloudUser",{},a=>{window.siyuan.user=a.data,KV(e.data.start,this),ii.onSetaccount(),Gg(window.siyuan.languages.siyuanNote),En()})})})})),fr(),EV(this)}}const ez=new QV;window.openFileByURL=t=>{if(t&&lh(t)){const e=O("focus",t)==="1";return dn({app:ez,id:rf(t),action:e?[p.CB_GET_ALL,p.CB_GET_FOCUS]:[p.CB_GET_FOCUS,p.CB_GET_CONTEXT,p.CB_GET_ROOTSCROLL],zoomIn:e}),!0}return!1},window.showKeyboardToolbar=()=>{},window.processIOSPurchaseResponse=MV})()})();})();
