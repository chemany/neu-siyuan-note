# æ€æºç¬”è®°Webç‰ˆå®Œå…¨ç®€åŒ–æ”¹é€  - æœ€ç»ˆæ€»ç»“

## âœ… å®Œæˆçš„æ‰€æœ‰æ”¹é€ 

### 1. ç§»é™¤æ€æºäº‘è´¦æˆ·ç³»ç»Ÿ âœ…
**æ–‡ä»¶**: `/home/jason/code/siyuan/app/src/config/account.ts`

**åˆ é™¤å†…å®¹**:
- âŒ æ€æºäº‘ç™»å½•è¡¨å•
- âŒ æ€æºäº‘æ³¨å†Œã€å¿˜è®°å¯†ç é“¾æ¥
- âŒ æ€æºäº‘VIP/è®¢é˜…UI
- âŒ æ€æºäº‘æ¿€æ´»ç 

**ä¿ç•™å†…å®¹**:
- âœ… ç»Ÿä¸€æ³¨å†ŒæœåŠ¡è´¦æˆ·ä¿¡æ¯æ˜¾ç¤º
- âœ… ç™»å‡ºå’Œåˆ·æ–°åŠŸèƒ½
- âœ… ç™»å½•å¼•å¯¼é¡µé¢

### 2. ç§»é™¤æ€æºå®˜æ–¹äº‘åŒæ­¥ âœ…
**æ–‡ä»¶**: `/home/jason/code/siyuan/app/src/config/repos.ts`

**åˆ é™¤å†…å®¹**:
- âŒ SiYuanå®˜æ–¹äº‘åŒæ­¥é€‰é¡¹(provider = 0)

**ä¿ç•™çš„åŒæ­¥é€‰é¡¹**:
- âœ… S3åŒæ­¥
- âœ… WebDAVåŒæ­¥  
- âœ… æœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŒæ­¥

### 3. å¼€æ”¾æ‰€æœ‰ä»˜è´¹åŠŸèƒ½ âœ…
**æ–‡ä»¶**: `/home/jason/code/siyuan/app/src/util/needSubscribe.ts`

**ä¿®æ”¹**:
```typescript
// æ‰€æœ‰åŠŸèƒ½å…è´¹
export const needSubscribe = () => false;
export const isPaidUser = () => true;
```

**å¼€æ”¾çš„åŠŸèƒ½**:
- âœ… WebDAVåŒæ­¥
- âœ… S3åŒæ­¥
- âœ… æœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŒæ­¥
- âœ… äº‘ç«¯å¤‡ä»½
- âœ… æ•°æ®å¿«ç…§
- âœ… æ‰€æœ‰ProåŠŸèƒ½

### 4. AI Chat Window Integration âœ…
**æ–‡ä»¶**: 
- `/home/jason/code/siyuan/app/src/layout/dock/AI.ts`
- `/home/jason/code/siyuan/app/src/layout/dock/index.ts`
- `/home/jason/code/siyuan/app/src/layout/util.ts`
- `/home/jason/code/siyuan/app/src/constants.ts`

**æ–°å¢åŠŸèƒ½**:
- âœ… AI Chat ä¾§æ ç»„ä»¶
- âœ… è‡ªåŠ¨é›†æˆåˆ°å³ä¾§æ 
- âœ… æ”¯æŒæœ€å°åŒ–å’Œå¸ƒå±€ä¿å­˜

## ğŸ¯ ç°åœ¨çš„ç³»ç»Ÿæ¶æ„

```
ç»Ÿä¸€æ³¨å†ŒæœåŠ¡ (localhost:3002)
    â†“ æä¾›è´¦æˆ·ç®¡ç†å’ŒJWTéªŒè¯
æ€æºç¬”è®°WebæœåŠ¡ (localhost:6806)
    â”œâ”€â”€ ç™»å½•é¡µé¢ (/stage/login.html)
    â”œâ”€â”€ æ³¨å†Œé¡µé¢ (/stage/register.html)
    â”‚
    â”œâ”€â”€ è®¾ç½®â†’è´¦æˆ·
    â”‚   â”œâ”€â”€ å·²ç™»å½•: æ˜¾ç¤ºç»Ÿä¸€æ³¨å†ŒæœåŠ¡è´¦æˆ·ä¿¡æ¯
    â”‚   â”‚   â”œâ”€â”€ ç”¨æˆ·å
    â”‚   â”‚   â”œâ”€â”€ é‚®ç®±
    â”‚   â”‚   â”œâ”€â”€ å·¥ä½œç©ºé—´è·¯å¾„
    â”‚   â”‚   â””â”€â”€ è®¤è¯æ–¹å¼: ç»Ÿä¸€æ³¨å†ŒæœåŠ¡
    â”‚   â””â”€â”€ æœªç™»å½•: æ˜¾ç¤ºç™»å½•å¼•å¯¼é¡µ
    â”‚
    â””â”€â”€ è®¾ç½®â†’äº‘ç«¯ (åŒæ­¥è®¾ç½®)
        â”œâ”€â”€ S3åŒæ­¥ âœ…
        â”œâ”€â”€ WebDAVåŒæ­¥ âœ…
        â””â”€â”€ æœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŒæ­¥ âœ…
```

## ğŸ“Š ç”¨æˆ·æ•°æ®éš”ç¦»

### Workspaceè·¯å¾„:
- **é…ç½®**: é€šè¿‡`SIYUAN_USER_DATA_ROOT`ç¯å¢ƒå˜é‡
- **é»˜è®¤**: `/mnt/nas-sata12/MindOcean/user-data/notes`
- **ç”¨æˆ·ç›®å½•**: `/mnt/nas-sata12/MindOcean/user-data/notes/{username}/`

### ç¤ºä¾‹:
```
/mnt/nas-sata12/MindOcean/user-data/notes/
â”œâ”€â”€ jason/           # ç”¨æˆ·jasonçš„ç‹¬ç«‹æ•°æ®
â”‚   â”œâ”€â”€ conf/
â”‚   â”œâ”€â”€ data/
â”‚   â””â”€â”€ temp/
â”œâ”€â”€ user1/           # ç”¨æˆ·user1çš„ç‹¬ç«‹æ•°æ®
â”‚   â”œâ”€â”€ conf/
â”‚   â”œâ”€â”€ data/
â”‚   â””â”€â”€ temp/
â””â”€â”€ user2/           # ç”¨æˆ·user2çš„ç‹¬ç«‹æ•°æ®
    â”œâ”€â”€ conf/
    â”œâ”€â”€ data/
    â””â”€â”€ temp/
```

## ğŸš€ åŒæ­¥åŠŸèƒ½ä½¿ç”¨

### S3åŒæ­¥é…ç½®:
1. è¿›å…¥è®¾ç½®â†’äº‘ç«¯
2. åŒæ­¥æä¾›å•†é€‰æ‹©"S3"
3. é…ç½®:
   - Endpoint
   - Access Key
   - Secret Key
   - Bucket
   - Region ID
4. **æ— éœ€è®¢é˜…,ç›´æ¥ä½¿ç”¨!**

### WebDAVåŒæ­¥é…ç½®:
1. è¿›å…¥è®¾ç½®â†’äº‘ç«¯
2. åŒæ­¥æä¾›å•†é€‰æ‹©"WebDAV"
3. é…ç½®:
   - Endpoint
   - Username
   - Password
4. **æ— éœ€è®¢é˜…,ç›´æ¥ä½¿ç”¨!**

## ğŸ”‘ ç¯å¢ƒå˜é‡

```bash
SIYUAN_WORKSPACE_PATH="/home/jason/code/siyuan/workspace"
SIYUAN_WEB_MODE=true
SIYUAN_JWT_SECRET="siyuan-web-auth-secret-change-in-production"
SIYUAN_USER_DATA_ROOT="/mnt/nas-sata12/MindOcean/user-data/notes"
UNIFIED_AUTH_SERVICE_URL="http://localhost:3002"
```

## ğŸ“ æœåŠ¡ç®¡ç†

### å¯åŠ¨æœåŠ¡:
```bash
/home/jason/code/siyuan/restart-siyuan-web.sh
```

### æ£€æŸ¥æœåŠ¡:
```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep siyuan-kernel

# æ£€æŸ¥ç‰ˆæœ¬
curl http://localhost:6806/api/system/version

# æŸ¥çœ‹æ—¥å¿—
tail -f /tmp/siyuan.log
```

## ğŸ¨ å‰ç«¯å¼€å‘æµç¨‹

ä¿®æ”¹å‰ç«¯ä»£ç å:

```bash
# 1. ç¼–è¯‘
cd /home/jason/code/siyuan/app
npm run build:desktop

# 2. éƒ¨ç½²
cp -r app/stage/build kernel/stage/

# 3. é‡å¯
/home/jason/code/siyuan/restart-siyuan-web.sh
```

## ğŸ“‹ å®Œæ•´æ”¹é€ æ¸…å•

### ç§»é™¤çš„åŠŸèƒ½:
- [x] æ€æºäº‘è´¦æˆ·ç™»å½•
- [x] æ€æºäº‘æ³¨å†Œ
- [x] æ€æºäº‘VIPè®¢é˜…
- [x] æ€æºäº‘æ¿€æ´»ç 
- [x] æ€æºå®˜æ–¹äº‘åŒæ­¥
- [x] ä»˜è´¹åŠŸèƒ½é™åˆ¶
- [x] è®¢é˜…çŠ¶æ€æ£€æŸ¥

### ä¿ç•™å¹¶å¢å¼ºçš„åŠŸèƒ½:
- [x] ç»Ÿä¸€æ³¨å†ŒæœåŠ¡ç™»å½•
- [x] ç”¨æˆ·ç‹¬ç«‹workspace
- [x] JWT Tokenè®¤è¯
- [x] æ•°æ®å®Œå…¨éš”ç¦»
- [x] S3åŒæ­¥(å…è´¹)
- [x] WebDAVåŒæ­¥(å…è´¹)
- [x] æœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŒæ­¥(å…è´¹)
- [x] æ‰€æœ‰ç¬”è®°åŠŸèƒ½

### æ–°å¢çš„åŠŸèƒ½:
- [x] è‡ªå®šä¹‰workspaceæ ¹è·¯å¾„
- [x] NASå­˜å‚¨æ”¯æŒ
- [x] è´¦æˆ·ä¿¡æ¯é¡µé¢ä¼˜åŒ–

- [x] ä¾¿æ·é‡å¯è„šæœ¬
- [x] AI Chat ä¾§æ é›†æˆ

## ğŸ¯ ä½¿ç”¨ä½“éªŒ

### ç™»å½•åçš„è®¾ç½®é¡µé¢:

**è´¦æˆ·é¡µé¢**:
```
ğŸ“± è´¦æˆ·è®¾ç½®
Powered by ç»Ÿä¸€æ³¨å†ŒæœåŠ¡

ğŸ‘¤ è´¦æˆ·ä¿¡æ¯
ç”¨æˆ·å: jason
é‚®ç®±: link918@qq.com
å·¥ä½œç©ºé—´: /mnt/nas-sata12/MindOcean/user-data/notes/jason
è®¤è¯æ–¹å¼: [ç»Ÿä¸€æ³¨å†ŒæœåŠ¡]

ğŸ’¾ æ•°æ®å­˜å‚¨
å·¥ä½œç©ºé—´è·¯å¾„: /mnt/nas-sata12/MindOcean/user-data/notes/jason

ğŸ”§ è´¦æˆ·æ“ä½œ
[åˆ·æ–°ä¿¡æ¯] [é€€å‡ºç™»å½•]
```

**äº‘ç«¯åŒæ­¥é¡µé¢**:
```
åŒæ­¥æä¾›å•†: [S3 â–¼]  æˆ–  [WebDAV â–¼]  æˆ–  [æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ â–¼]

âœ… æ— éœ€VIPä¼šå‘˜
âœ… æ— éœ€ä»˜è´¹è®¢é˜…
âœ… ç›´æ¥é…ç½®ä½¿ç”¨
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

- å‰ç«¯ä»£ç å‡å°‘çº¦5%
- ç§»é™¤äº†ä¸å¿…è¦çš„APIè°ƒç”¨
- ç®€åŒ–äº†è®¤è¯æµç¨‹
- ä¼˜åŒ–äº†workspaceåˆ‡æ¢é€»è¾‘

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- JWT Tokenè®¤è¯
- æ•°æ®å®Œå…¨éš”ç¦»
- ç‹¬ç«‹workspaceå­˜å‚¨
- ç»Ÿä¸€è´¦æˆ·ç®¡ç†

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `/home/jason/code/siyuan/WEB_MULTIUSER_GUIDE.md` - éƒ¨ç½²æŒ‡å—
- `/home/jason/code/siyuan/ACCOUNT_INTEGRATION_SUMMARY.md` - è´¦æˆ·é›†æˆ
- `/home/jason/code/siyuan/SIMPLIFIED_SUMMARY.md` - ç®€åŒ–æ€»ç»“
- `/home/jason/code/siyuan/æ€æºç¬”è®°å¤šç”¨æˆ·Webåº”ç”¨æ”¹é€ æŠ€æœ¯æ€»ç»“.md` - æŠ€æœ¯æ€»ç»“

## ğŸ‰ æœ€ç»ˆæˆæœ

### ä»£ç ç²¾ç®€:
- `account.ts`: å‡å°‘60%ä»£ç 
- `needSubscribe.ts`: å‡å°‘70%ä»£ç 
- `repos.ts`: ç§»é™¤SiYuanåŒæ­¥é€‰é¡¹

### åŠŸèƒ½å¼€æ”¾:
- **0å…ƒ**: ä½¿ç”¨æ‰€æœ‰åŒæ­¥åŠŸèƒ½
- **0é™åˆ¶**: æ— éœ€VIPä¼šå‘˜
- **0è®¢é˜…**: å®Œå…¨å…è´¹ä½¿ç”¨

### ç”¨æˆ·ä½“éªŒ:
- ğŸš€ **æ›´å¿«çš„åŠ è½½é€Ÿåº¦**
- ğŸ¯ **æ›´ç®€æ´çš„ç•Œé¢**
- ğŸ’ **æ›´å¼ºå¤§çš„åŠŸèƒ½ (å…¨å…è´¹)**
- ğŸ” **æ›´å®‰å…¨çš„æ•°æ®éš”ç¦»**

---

**è®¿é—®åœ°å€**: http://localhost:6806  
**ç™»å½•é¡µé¢**: http://localhost:6806/stage/login.html  
**æµ‹è¯•è´¦æˆ·**: link918@qq.com / zhangli1115

**æ”¹é€ å®Œæˆ**: 2025-11-25  
**ç‰ˆæœ¬**: v3.0 - å®Œå…¨ç®€åŒ–ç‰ˆ ğŸŠ
