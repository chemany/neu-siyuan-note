# 资源文件自动向量化与 RAG 系统 - 使用手册

## 🚀 功能概览

本系统实现了基于 RAG（检索增强生成）的文档分析功能。

### 核心特性

1.  **自动向量化**：当您上传或插入文档（PDF, DOC, XLS, MD 等）时，系统会自动在后台进行向量化，无需人工干预。
2.  **RAG 增强聊天**：在使用 AI 聊天时，系统会自动搜索与您问题相关的文档内容，并将其作为上下文提供给 AI，从而实现基于文档的精准问答。
3.  **支持格式**：PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, MD, TXT。

## 📖 使用指南

### 1. 自动向量化

只需像往常一样在思源笔记中插入附件即可：

1.  将文件拖入笔记，或使用 `/Upload` 命令上传。
2.  系统会自动检测文件类型。
3.  如果是支持的文档格式，后台会自动开始向量化。
4.  向量化完成后，数据会自动存储。

**注意**：
- 向量化是异步进行的，大文件可能需要几秒到几分钟。
- 您可以在日志中查看向量化进度（如果开启了日志）。

### 2. RAG 增强聊天

在 AI 聊天界面（或使用 AI 辅助写作功能）提问：

1.  输入您的问题，例如："总结一下刚才上传的报告的主要内容"。
2.  系统会自动搜索最相关的 3 个文档片段。
3.  AI 会基于这些文档内容进行回答。

**示例**：
> **用户**：2025年的销售目标是多少？
> **系统**：（自动检索到《2025年度计划.docx》）
> **AI**：根据《2025年度计划.docx》，2025年的销售目标设定为 5000 万，同比增长 20%。

### 3. 手动管理（高级）

如果您需要手动处理，可以使用 API：

- **向量化单个文件**：`POST /api/ai/vectorizeAsset`
- **查看已向量化列表**：`POST /api/ai/getVectorizedAssets`

## ⚙️ 配置说明

确保在 **设置 -> AI -> 向量化** 中正确配置了向量化服务：

- **API Provider**: SiliconFlow (或其他兼容 OpenAI 的服务)
- **API Key**: 您的 API 密钥
- **API Base URL**: `https://api.siliconflow.cn/v1` (针对 SiliconFlow)
- **Model**: `BAAI/bge-large-zh-v1.5` (推荐用于中文文档)

## ❓ 常见问题

**Q: 为什么我上传的文档没有被 AI 识别？**
A: 
1. 确认文档格式是否支持。
2. 确认向量化服务配置正确且可用。
3. 向量化需要时间，请稍等片刻后再试。
4. 检查文档内容是否为空或无法解析（如加密的 PDF）。

**Q: 如何知道文档是否已向量化？**
A: 可以调用 `/api/ai/getVectorizedAssets` 接口查看列表。

**Q: RAG 会消耗多少 Token？**
A: 每次 RAG 检索会加载最多 3 个文档片段（每个片段最多 2000 字符），这会增加 Prompt 的长度，从而消耗更多的 Token。

---
**版本**: v1.0.0
**更新时间**: 2025-12-03
